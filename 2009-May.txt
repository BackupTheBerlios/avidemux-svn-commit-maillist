From mean at mail.berlios.de  Sat May  2 10:02:38 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 10:02:38 +0200
Subject: [Avidemux-svn-commit] r4772 - in branches/avidemux_2.6_branch_mean:
	avidemux avidemux/ADM_coreDemuxerMpeg/src
	avidemux/ADM_coreUtils/src avidemux/ADM_editor
	plugins/ADM_demuxers/MpegTS
Message-ID: <200905020802.n4282c24000811@sheep.berlios.de>

Author: mean
Date: 2009-05-02 10:02:37 +0200 (Sat, 02 May 2009)
New Revision: 4772

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreDemuxerMpeg/src/dmxPSPacket.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils/src/ADM_infoExtractor.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edRender.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edit.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk_gui.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp
Log:
[TsDemuxer] Mostly working seeking in TS/H264, still buggy

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreDemuxerMpeg/src/dmxPSPacket.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreDemuxerMpeg/src/dmxPSPacket.cpp	2009-04-30 17:07:07 UTC (rev 4771)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreDemuxerMpeg/src/dmxPSPacket.cpp	2009-05-02 08:02:37 UTC (rev 4772)
@@ -481,6 +481,7 @@
     }
     // v>delta
     v-=delta;
+    consumed+=delta;
     if(!refill()) return false;
     goto next;
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils/src/ADM_infoExtractor.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils/src/ADM_infoExtractor.cpp	2009-04-30 17:07:07 UTC (rev 4771)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils/src/ADM_infoExtractor.cpp	2009-05-02 08:02:37 UTC (rev 4772)
@@ -321,7 +321,9 @@
     return outlen;
     
 }
-
+/**
+        \fn extractVUIInfo
+*/
 static uint8_t extractVUIInfo(GetBitContext *s, uint32_t *fps1000, uint32_t *darNum, uint32_t *darDen)
 {
 	*fps1000 = *darNum = *darDen = 0;
@@ -470,8 +472,14 @@
 		   }
 
 		   if(get_bits1(&s))
+           {
 			   extractVUIInfo(&s, fps1000, darNum, darDen);
-
+               printf("[H264] Fps %"LU", a.r. %"LU",%"LU"\n",*fps1000,*darNum,*darDen);
+           }else
+            {
+                printf("[H264] Unknown FPS, setting 25\n");
+                *fps1000=25000;
+            }
            return 1;
 }
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edRender.cpp	2009-04-30 17:07:07 UTC (rev 4771)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edRender.cpp	2009-05-02 08:02:37 UTC (rev 4772)
@@ -128,7 +128,7 @@
     //cache->flush();
     // The PTS associated with our frame is the one we are looking for
     uint64_t wantedPts=vid->_aviheader->estimatePts(frame);
-    uint32_t tries=8;
+    uint32_t tries=16; // Max Ref frames for H264=Max delay
 
     while(found==false && tries--)
     {
@@ -158,6 +158,7 @@
             {
                 cache->updateFrameNum(result,vid->lastSentFrame);
                 uint64_t pts=result->Pts;
+                printf("[Decoder] Frame %"LU" pts=%"LLU" ms, %"LLU" us\n",vid->lastSentFrame,result->Pts,result->Pts);
                 if(pts==ADM_COMPRESSED_NO_PTS) // No PTS available ?
                 {
                     // increment it using average fps

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edit.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edit.cpp	2009-04-30 17:07:07 UTC (rev 4771)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edit.cpp	2009-05-02 08:02:37 UTC (rev 4772)
@@ -423,7 +423,7 @@
   _videos[_nb_video]._aviheader->getExtraHeaderData (&l, &d);
   _videos[_nb_video].decoder = getDecoder (info.fcc,  info.width, info.height, l, d,info.bpp);
 
-  _videos[_nb_video]._videoCache   =   new EditorCache(10,info.width,info.height) ;
+  _videos[_nb_video]._videoCache   =   new EditorCache(32,info.width,info.height) ;
 
   float frameD=info.fps1000;
   frameD=frameD/1000;

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk_gui.cpp	2009-04-30 17:07:07 UTC (rev 4771)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk_gui.cpp	2009-05-02 08:02:37 UTC (rev 4772)
@@ -895,7 +895,7 @@
   /* Zoom out if needed */
   uint32_t phyW,phyH;
   UI_getPhysicalScreenSize(NULL, &phyW,&phyH);
-  if(phyW<avifileinfo->width || phyH<avifileinfo->height)
+  if(3*phyW<4*avifileinfo->width || 3*phyH<4*avifileinfo->height)
   {
       if(phyW<avifileinfo->width/2 || phyH<avifileinfo->height/2)
       {

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp	2009-04-30 17:07:07 UTC (rev 4771)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp	2009-05-02 08:02:37 UTC (rev 4772)
@@ -76,6 +76,7 @@
     idx_startAtImage,
     idx_startAtGopOrSeq
 }indexerState;
+
 typedef struct
 {
     uint64_t pts,dts; //startAt;
@@ -110,10 +111,10 @@
         uint32_t        beginConsuming;
         indexerState    currentIndexState;
 protected:
-        FILE *index;
-        tsPacketLinearTracker  *pkt;
-        listOfTsAudioTracks    *audioTracks;
-        DIA_workingBase  *ui;
+        FILE                    *index;
+        tsPacketLinearTracker   *pkt;
+        listOfTsAudioTracks     *audioTracks;
+        DIA_workingBase         *ui;
 public:
                 TsIndexer(listOfTsAudioTracks *tr);
                 ~TsIndexer();
@@ -215,6 +216,8 @@
 uint64_t fullSize;
 dmxPacketInfo info;
 
+bool result=false;
+
     printf("Starting H264 indexer\n");
     if(!videoTrac) return false;
     if(videoTrac[0].trackType!=ADM_TS_H264)
@@ -241,9 +244,13 @@
     pkt->open(file,append);
     data.pkt=pkt;
     fullSize=pkt->getSize();
+
+    //******************
+    // 1 search SPS
+    //******************
+#define SPS_READ_AHEAD 32
       while(1)
       {
-
         uint32_t code=0xffff+0xffff0000;
         while((code!=1) && pkt->stillOk())
         {
@@ -251,122 +258,112 @@
         }
         if(!pkt->stillOk()) break;
         uint8_t startCode=pkt->readi8(); // Read 5 bytes so far
+        if(startCode&0x80) continue; // Marker missing
+        startCode&=0x1f;
+        if(startCode!=NAL_SPS) continue;
 
-       
+          // Got SPS!
+          uint8_t buffer[60] ; // should be enough
+          uint32_t xA,xR;
+          // Get info
+          pkt->getInfo(&info);
+          pkt->read(SPS_READ_AHEAD,buffer);
+          if (extractSPSInfo(buffer, SPS_READ_AHEAD, &video.w,&video.h,&video.fps,&xA,&xR))
+          {
+              
+              printf("[TsIndexer] Found video %"LU"x%"LU", fps=%"LU"\n",video.w,video.h,video.fps);
+              seq_found=1;
+              writeVideo(&video,ADM_TS_H264);
+              writeAudio();
+              qfprintf(index,"[Data]");
+              // Rewind
+              pkt->seek(info.startAt,info.offset-5);
+              break;              
+          };
+      }
+        if(!seq_found) goto the_end;
+    //******************
+    // 2 Index
+    //******************
+      while(1)
+      {
 
+        uint32_t code=0xffff+0xffff0000;
+        while((code!=1) && pkt->stillOk())
+        {
+            code=(code<<8)+pkt->readi8();
+        }
+        if(!pkt->stillOk()) break;
+        uint8_t startCode=pkt->readi8(); // Read 5 bytes so far
 //  1:0 2:Nal ref idc 5:Nal Type
         if(startCode&0x80) continue; // Marker missing
-        
-
-#define T(x) case NAL_##x: aprintf(#x" found\n");break;
         startCode&=0x1f;
-#ifdef ADM_H264_VERBOSE
-        switch(startCode)
-        {
-            T(NON_IDR);
-            T(IDR);
-            T(SPS);
-            T(PPS);
-            T(SEI);
-            T(AU_DELIMITER);
-            T(FILLER);
-          default :aprintf("0x%02x ?\n",startCode);
-        }
-#endif
-          
-              /* Till we have a SPS no need to continue */
-              if(!seq_found && startCode!=NAL_SPS) continue;
-              if(!seq_found) // It is a SPS
-              {
-                    // Our firt frame is here
-                    // Important to initialize the H264 decoder !
-                      uint8_t buffer[60] ; // should be enough
-                      uint32_t xA,xR;
-                      // Get info
-                      pkt->read(16,buffer);
-                      if (extractSPSInfo(buffer, 16, &video.w,&video.h,&video.fps,&xA,&xR))
-                      {
-						  
-                          printf("[TsIndexer] Found video %"LU"x%"LU", fps=%"LU"\n",video.w,video.h,video.fps);
-                          seq_found=1;
+          // Ignore multiple chunk of the same pic
+          if((startCode==NAL_NON_IDR || startCode==NAL_IDR)&&pic_started) 
+          {
+           // aprintf("Still capturing, ignore\n");
+            continue;
+          }
+                     
+          switch(startCode)
+                  {
+                  case NAL_AU_DELIMITER:
+                          pic_started = false;
+                          break;
+
+                  case NAL_SPS:
+                          pic_started = false;
+                          aprintf("Sps \n");
+                          pkt->getInfo(&info);
+                          data.frameType=1;
+                          Mark(&data,&info,5);
                           data.state=idx_startAtGopOrSeq;
-                          writeVideo(&video,ADM_TS_H264);
-                          writeAudio();
-                          qfprintf(index,"[Data]");
-                          data.frameType=1; // Force dump
-                          pkt->getInfo(&info);                          
-                          Mark(&data,&info,5+16);
-                          // Rewind
-#warning TODO
-                      }
-                      continue;
-              }
-              
-              // Ignore multiple chunk of the same pic
-              if((startCode==NAL_NON_IDR || startCode==NAL_IDR)&&pic_started) 
-              {
-                aprintf("Still capturing, ignore\n");
-                continue;
-              }
-           
-              
-              switch(startCode)
-                      {
-                      case NAL_AU_DELIMITER:
-							  pic_started = false;
-                              break;
-#if 0
-                      case NAL_SPS:
-                              pic_started = false;
-                              aprintf("Sps \n");
-                              pkt->getInfo(&info);
-                              data.frameType=1;
-							  Mark(&data,&info,5);
-                              data.state=idx_startAtGopOrSeq;
-							  break;
-#endif
-                      case NAL_IDR:
-                      case NAL_NON_IDR:
-                        {
+                          break;
+
+                  case NAL_IDR:
+                  case NAL_NON_IDR:
+                    {
 #define NON_IDR_PRE_READ 8
-                          uint8_t header[NON_IDR_PRE_READ+4];
-                          GetBitContext s;
-                       
-                            pkt->read(4,header);
-                            init_get_bits(&s, header, NON_IDR_PRE_READ*8);
-                            int first_mb_in_slice,slice_type;
+                      uint8_t header[NON_IDR_PRE_READ+4];
+                      GetBitContext s;
+                   
+                        pkt->read(4,header);
+                        init_get_bits(&s, header, NON_IDR_PRE_READ*8);
+                        int first_mb_in_slice,slice_type;
 
-                            first_mb_in_slice= get_ue_golomb(&s);
-                            slice_type= get_ue_golomb_31(&s);
-                            if(slice_type>4) slice_type-=5;
-                            switch(slice_type)
-                            {
+                        first_mb_in_slice= get_ue_golomb(&s);
+                        slice_type= get_ue_golomb_31(&s);
+                        if(slice_type>4) slice_type-=5;
+                        switch(slice_type)
+                        {
 
-                                case 0 : data.frameType=2;break; // P
-                                case 1 : data.frameType=3;break; // B
-                                case 2 : data.frameType=1;break; // I
-                                default : data.frameType=2;break; // SP/SI
-                            }
-
-                          if(data.state==idx_startAtGopOrSeq) 
-                          {
-                                  currentFrameType=data.frameType;;
-                                  
-                          }else
-                          {
-                                pkt->getInfo(&info);
-                                Mark(&data,&info,5+4);
-                           }
-                          data.state=idx_startAtImage;
-                          data.nbPics++;
-						  pic_started = true;
+                            case 0 : data.frameType=2;break; // P
+                            case 1 : data.frameType=3;break; // B
+                            case 2 : data.frameType=1;break; // I
+                            default : data.frameType=2;break; // SP/SI
                         }
-					  
-                        break;
-					  default:
-						  break;
-			  }
-      }
+
+                      if(data.state==idx_startAtGopOrSeq) 
+                      {
+                              currentFrameType=data.frameType;;
+                              
+                      }else
+                      {
+                            pkt->getInfo(&info);
+                            Mark(&data,&info,5+4);
+                       }
+                      data.state=idx_startAtImage;
+                      data.nbPics++;
+                      pic_started = true;
+                    }
+                  
+                    break;
+                  default:
+                      break;
+          }
+      } // End while
+      result=true;
+the_end:
         printf("\n");
         Mark(&data,&info,0);
         qfprintf(index,"\n[End]\n");
@@ -375,7 +372,7 @@
         audioTracks=NULL;
         delete pkt;
         pkt=NULL;
-        return true; 
+        return result; 
 }
 //***********************************************************************
 /**
@@ -552,8 +549,8 @@
             beginConsuming=consumed;
         }else
         {  // Our first Pic
-            beginConsuming=overRead;
-            pkt->setConsumed(beginConsuming);
+            beginConsuming=0;
+            pkt->setConsumed(overRead);
         }
             
         // If audio, also dump audio

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp	2009-04-30 17:07:07 UTC (rev 4771)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp	2009-05-02 08:02:37 UTC (rev 4772)
@@ -598,6 +598,7 @@
     }
     // v>delta
     v-=delta;
+    consumed+=delta;
     if(!refill()) return false;
     goto next;
 }



From mean at mail.berlios.de  Sat May  2 10:02:39 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 10:02:39 +0200
Subject: [Avidemux-svn-commit] r4773 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <200905020802.n4282dot000821@sheep.berlios.de>

Author: mean
Date: 2009-05-02 10:02:39 +0200 (Sat, 02 May 2009)
New Revision: 4773

Modified:
   branches/avidemux_2.6_branch_mean/cmake/Ts.cmake
Log:
[QT ] Disable .ts file translation, does not work well on jaunty

Modified: branches/avidemux_2.6_branch_mean/cmake/Ts.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/Ts.cmake	2009-05-02 08:02:37 UTC (rev 4772)
+++ branches/avidemux_2.6_branch_mean/cmake/Ts.cmake	2009-05-02 08:02:39 UTC (rev 4773)
@@ -106,6 +106,6 @@
 	FIND_XSLTPROC()
 	FIND_LRELEASE()
 	
-	COMPILE_AVIDEMUX_TS_FILES(${ts_subdir} ${_sources})
-	COMPILE_QT_TS_FILES(${ts_subdir} ${_sources})
+	#COMPILE_AVIDEMUX_TS_FILES(${ts_subdir} ${_sources})
+	#COMPILE_QT_TS_FILES(${ts_subdir} ${_sources})
 ENDMACRO(COMPILE_TS_FILES)



From mean at mail.berlios.de  Sat May  2 10:02:42 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 10:02:42 +0200
Subject: [Avidemux-svn-commit] r4774 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_editor
Message-ID: <200905020802.n4282gYE000831@sheep.berlios.de>

Author: mean
Date: 2009-05-02 10:02:40 +0200 (Sat, 02 May 2009)
New Revision: 4774

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edCache.cpp
Log:
[Editor] Fix stupid typo in cache handling

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edCache.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edCache.cpp	2009-05-02 08:02:39 UTC (rev 4773)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edCache.cpp	2009-05-02 08:02:40 UTC (rev 4774)
@@ -121,7 +121,7 @@
     printf("[edCache] Flush\n");
     for(int i=0;i<_nbImage;i++)
     {
-        _elem[i].frameNum==ADM_INVALID_CACHE;
+        _elem[i].frameNum=ADM_INVALID_CACHE;
     }
 }
 /**
@@ -133,15 +133,15 @@
    
     for(int i=0;i<_nbImage;i++)
     {
-        if(_elem[i].image==image);
+        if(_elem[i].image==image)
             {
-                   _elem[i].lastUse=ADM_INVALID_CACHE;;
                    _elem[i].frameNum=ADM_INVALID_CACHE;
                     aprintf("[edCache] Invalidating %d\n",i);
                   return;
             }
     }
-    ADM_assert("Image not in cache\n");
+    printf("[edCache]Image not in cache\n");
+    ADM_assert(0);
 }
 /**
         \fn updateFrameNum



From mean at mail.berlios.de  Sat May  2 10:02:43 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 10:02:43 +0200
Subject: [Avidemux-svn-commit] r4775 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_editor
Message-ID: <200905020802.n4282hj4000841@sheep.berlios.de>

Author: mean
Date: 2009-05-02 10:02:43 +0200 (Sat, 02 May 2009)
New Revision: 4775

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edRender.cpp
Log:
[Editor] Dont use frame if decoding failed

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edRender.cpp	2009-05-02 08:02:40 UTC (rev 4774)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edRender.cpp	2009-05-02 08:02:43 UTC (rev 4775)
@@ -135,7 +135,8 @@
         // Last frame ? if so repeat
         if(vid->lastSentFrame>=nbFrames-1) vid->lastSentFrame=nbFrames-1;
         // Fetch frame
-         aprintf("[Editor] Decoding I frame %u\n",vid->lastSentFrame);
+         printf("[Editor] Decoding  frame %u\n",vid->lastSentFrame);
+         
          if (!demuxer->getFrame (vid->lastSentFrame,&img))
          {
                 printf("[DecodePictureUpToIntra] getFrame failed for frame %"LU"\n",vid->lastSentFrame);
@@ -153,7 +154,11 @@
           if(!decompressImage(result,&img,ref))
           {
              printf("[DecodePictureUpToIntra] decode error for frame %"LU"\n",vid->lastSentFrame);
+             //cache->dump();
              cache->invalidate(result);
+             //cache->dump();
+             vid->lastSentFrame++;
+             continue;
           }else
             {
                 cache->updateFrameNum(result,vid->lastSentFrame);



From mean at mail.berlios.de  Sat May  2 10:02:45 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 10:02:45 +0200
Subject: [Avidemux-svn-commit] r4776 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905020802.n4282jl1000855@sheep.berlios.de>

Author: mean
Date: 2009-05-02 10:02:45 +0200 (Sat, 02 May 2009)
New Revision: 4776

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_ts.h
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsReadIndex.cpp
Log:
[TS/H264] Store IDR as IDR

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_ts.h
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_ts.h	2009-05-02 08:02:43 UTC (rev 4775)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_ts.h	2009-05-02 08:02:45 UTC (rev 4776)
@@ -140,6 +140,7 @@
     tsPacketLinear *tsPacket;
     uint64_t        timeConvert(uint64_t x);
     bool            updatePtsDts(void);
+    bool            updateIdr(void);
 protected:
     vector <ADM_tsTrackDescriptor *>listOfAudioTracks;
     uint32_t        videoPid;             

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsReadIndex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsReadIndex.cpp	2009-05-02 08:02:43 UTC (rev 4775)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsReadIndex.cpp	2009-05-02 08:02:45 UTC (rev 4776)
@@ -145,6 +145,7 @@
                     case 'I': frame->type=1;break;
                     case 'P': frame->type=2;break;
                     case 'B': frame->type=3;break;
+                    case 'D': frame->type=4;break;
                     default: ADM_assert(0);
                 }
                 frame->len=len;



From mean at mail.berlios.de  Sat May  2 10:02:46 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 10:02:46 +0200
Subject: [Avidemux-svn-commit] r4777 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905020802.n4282kpp000868@sheep.berlios.de>

Author: mean
Date: 2009-05-02 10:02:46 +0200 (Sat, 02 May 2009)
New Revision: 4777

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_ts.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp
Log:
[TS/H264] Store IDR as IDR

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_ts.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_ts.cpp	2009-05-02 08:02:45 UTC (rev 4776)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_ts.cpp	2009-05-02 08:02:46 UTC (rev 4777)
@@ -81,6 +81,7 @@
         printf("[tsDemux] Cannot read index for file %s\n",idxName);
         goto abt;
     }
+    updateIdr();
     updatePtsDts();
     _videostream.dwLength= _mainaviheader.dwTotalFrames=ListOfFrames.size();
     printf("[tsDemux] Found %d video frames\n",_videostream.dwLength);
@@ -124,9 +125,35 @@
         f*=ListOfFrames.size();
      return (uint64_t)f;
 }
-
-
 /**
+    \fn updateIdr
+    \brief if IDR are present, handle them as intra and I as P frame
+            if not, handle I as intra, there might be some badly decoded frames (missing ref)
+*/
+bool tsHeader::updateIdr()
+{
+    int nbIdr=0;
+    if(!ListOfFrames.size()) return false;
+    for(int i=0;i<ListOfFrames.size();i++)
+    {
+        if(ListOfFrames[i]->type==4) nbIdr++;
+    }
+    printf("[TsH264] Found %d IDR\n",nbIdr);
+    if(nbIdr) // Change IDR to I and I to P...
+    { 
+        printf("[TsH264] Remapping IDR to I and I TO P\n");
+        for(int i=0;i<ListOfFrames.size();i++)
+        {
+            switch(ListOfFrames[i]->type)
+            {
+                case 4: ListOfFrames[i]->type=1;break;
+                case 1: ListOfFrames[i]->type=2;break;
+                default: break;
+            }
+        }
+    }
+}
+/**
     \fn getAudioInfo
     \brief returns wav header for stream i (=0)
 */

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp	2009-05-02 08:02:45 UTC (rev 4776)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp	2009-05-02 08:02:46 UTC (rev 4777)
@@ -40,7 +40,7 @@
 }
 
 
-static const char Type[5]={'X','I','P','B','P'};
+static const char Type[5]={'X','I','P','B','D'};
 
 static const uint32_t FPS[16]={
                 0,                      // 0
@@ -342,7 +342,7 @@
                             case 2 : data.frameType=1;break; // I
                             default : data.frameType=2;break; // SP/SI
                         }
-
+                      if(startCode==NAL_IDR) data.frameType=4; // IDR
                       if(data.state==idx_startAtGopOrSeq) 
                       {
                               currentFrameType=data.frameType;;



From mean at mail.berlios.de  Sat May  2 10:02:48 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 10:02:48 +0200
Subject: [Avidemux-svn-commit] r4778 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905020802.n4282mcB000880@sheep.berlios.de>

Author: mean
Date: 2009-05-02 10:02:48 +0200 (Sat, 02 May 2009)
New Revision: 4778

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsPlugin.cpp
Log:
[TsDemuxer] Avoid going beyond buffer when probing for TS files

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsPlugin.cpp	2009-05-02 08:02:46 UTC (rev 4777)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsPlugin.cpp	2009-05-02 08:02:48 UTC (rev 4778)
@@ -133,7 +133,7 @@
     int syncOk=0;
     int syncKo=0;
     // Search Marker    
-    while(buffer<end)
+    while(buffer+block<end)
     {
         if(*buffer!=TS_MARKER)
         {
@@ -144,7 +144,7 @@
             syncKo++;
         }
         if(*buffer!=TS_MARKER) break;
-        while(buffer<end && buffer[block]==TS_MARKER)
+        while(buffer+block<end && buffer[block]==TS_MARKER)
         {   
                 syncOk++,
                 buffer+=block;



From mean at mail.berlios.de  Sat May  2 10:02:49 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 10:02:49 +0200
Subject: [Avidemux-svn-commit] r4779 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905020802.n4282nPX000890@sheep.berlios.de>

Author: mean
Date: 2009-05-02 10:02:49 +0200 (Sat, 02 May 2009)
New Revision: 4779

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsComputeTimeStamp.cpp
Log:
[TsDemuxer] Cosmetic Ps vs Ts

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsComputeTimeStamp.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsComputeTimeStamp.cpp	2009-05-02 08:02:48 UTC (rev 4778)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsComputeTimeStamp.cpp	2009-05-02 08:02:49 UTC (rev 4779)
@@ -135,7 +135,7 @@
                     uint64_t oldDts=lastDts;
                     frame->dts=lastDts=timeConvert(frame->dts);
                     frame->pts=lastPts=timeConvert(frame->pts);
-                    if(oldDts>lastDts) printf("[psRead] Warning DTS going backward frame %d, old:%"LLD" new:%"LLD" delta=%"LLD"\n",
+                    if(oldDts>lastDts) printf("[tsRead] Warning DTS going backward frame %d, old:%"LLD" new:%"LLD" delta=%"LLD"\n",
                                                        i,oldDts/1000,lastDts/1000,(oldDts-lastDts)/1000);
 
                 }else



From mean at mail.berlios.de  Sat May  2 15:54:06 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:54:06 +0200
Subject: [Avidemux-svn-commit] r4783 - in
	branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg:
	libavcodec libswscale
Message-ID: <200905021354.n42Ds6Wv010978@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:54:05 +0200 (Sat, 02 May 2009)
New Revision: 4783

Added:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ADM_lavcodec.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/ADM_mp.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/ADM_mp.h
Log:
[FFmpeg update] Baseline

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ADM_lavcodec.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ADM_lavcodec.cpp	2009-05-02 13:53:52 UTC (rev 4782)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ADM_lavcodec.cpp	2009-05-02 13:54:05 UTC (rev 4783)
@@ -0,0 +1,34 @@
+#include "ADM_default.h"
+#ifdef ADM_CPU_X86
+#include "ADM_lavcodec.h"
+#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/dsputil_cpu.h"
+#endif
+/**
+ * 		\fn lavcodec_mm_support
+ * 		\brief Give lavcodec CPU supported ( FF_MM_MMX)
+ */
+extern "C"
+{
+int ADM_lavcodec_mm_support(void);
+}
+int ADM_lavcodec_mm_support(void)
+{
+int rval=0;
+
+#ifdef ADM_CPU_X86
+#undef MATCH
+#define MATCH(x,y) if(CpuCaps::myCpuCaps &  CpuCaps::myCpuMask & ADM_CPUCAP_##x) rval|=MM_##x;
+
+	MATCH(MMX,MMX);
+	MATCH(MMXEXT,MMXEXT);
+	MATCH(SSE,SSE);
+	MATCH(SSE2,SSE2);
+	MATCH(SSE3,SSE3);
+	MATCH(SSSE3,SSSE3);
+	MATCH(3DNOW,3DNOW);
+	MATCH(3DNOWEXT,3DNOWEXT);
+#endif
+
+	return rval;
+}
+// EOF

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/ADM_mp.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/ADM_mp.cpp	2009-05-02 13:53:52 UTC (rev 4782)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/ADM_mp.cpp	2009-05-02 13:54:05 UTC (rev 4783)
@@ -0,0 +1,103 @@
+/***************************************************************************
+
+    copyright            : (C) 2005 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <math.h>
+
+#include "config.h"
+#include "fourcc.h"
+
+
+extern "C" {
+#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
+#include "ADM_libraries/ADM_ffmpeg/libavutil/avutil.h"
+#include "ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h"
+}
+
+
+#include "ADM_mp.h"
+
+
+#define Context ((SwsContext *)_context)
+
+ADM_MplayerResize::ADM_MplayerResize(uint32_t fromw, uint32_t fromh, uint32_t tow, uint32_t toh)
+{
+SwsFilter                  *srcFilter=NULL;
+SwsFilter                  *dstFilter=NULL;
+int                       flags=0;
+
+                           flags=SWS_BILINEAR;
+
+#ifdef ADM_CPU_X86
+                
+                #define ADD(x,y) if( CpuCaps::has##x()) flags|=SWS_CPU_CAPS_##y;
+                ADD(MMX,MMX);           
+                ADD(3DNOW,3DNOW);
+                ADD(MMXEXT,MMX2);
+#endif
+#ifdef ADM_CPU_ALTIVEC
+                flags|=SWS_CPU_CAPS_ALTIVEC;
+#endif
+
+                srcW=fromw;
+                srcH=fromh;
+                tgtW=tow;
+                tgtH=toh;
+
+                _context=(void *)sws_getContext(
+                                                srcW,srcH,
+                                                PIX_FMT_YUV420P,
+                                                tgtW,tgtH,
+                                                PIX_FMT_YUV420P,
+                                                flags, srcFilter, dstFilter,NULL);
+
+                if(!_context) ADM_assert(0);
+}
+ADM_MplayerResize::~ADM_MplayerResize()
+{
+        sws_freeContext(Context);
+        _context=NULL;
+}
+
+uint8_t ADM_MplayerResize::resize(uint8_t *datasrc, uint8_t *datadst)
+{
+uint8_t *src[3];
+uint8_t *dst[3];
+int ssrc[3];
+int ddst[3];
+
+uint32_t page;
+
+                        page=srcW*srcH;
+                        src[0]=datasrc;
+                        src[1]=datasrc+page;
+                        src[2]=datasrc+((page*5)/4);
+
+                        ssrc[0]=srcW;
+                        ssrc[1]=ssrc[2]=srcW>>1;
+
+                        page=tgtW*tgtH;
+                        dst[0]=datadst;
+                        dst[1]=datadst+page;
+                        dst[2]=datadst+(page*5)/4;
+                        ddst[0]=tgtW;
+                        ddst[1]=ddst[2]=tgtW>>1;
+
+                        sws_scale(Context,src,ssrc,0,srcH,dst,ddst);
+
+                        return 1;
+}

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/ADM_mp.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/ADM_mp.h	2009-05-02 13:53:52 UTC (rev 4782)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/ADM_mp.h	2009-05-02 13:54:05 UTC (rev 4783)
@@ -0,0 +1,23 @@
+
+
+#ifndef ADM_MPLAYER_H
+#define ADM_MPLAYER_H
+
+class ADM_MplayerResize
+{
+protected:
+                void *_context;
+                uint32_t srcW,srcH;
+                uint32_t tgtW,tgtH;
+        
+public:
+                ADM_MplayerResize(uint32_t fromw, uint32_t fromh, uint32_t tow, uint32_t toh);
+                ~ADM_MplayerResize();
+                uint8_t resize(uint8_t *src, uint8_t *dst);
+
+
+};
+
+#endif
+
+



From mean at mail.berlios.de  Sat May  2 15:54:08 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:54:08 +0200
Subject: [Avidemux-svn-commit] r4784 - in
	branches/avidemux_2.6_branch_mean/avidemux: .
	ADM_libraries/ADM_ffmpeg ADM_libraries/ADM_ffmpeg/libavcodec
	ADM_libraries/ADM_ffmpeg/libavutil ADM_libraries/ADM_ffmpeg/patches
Message-ID: <200905021354.n42Ds8up010989@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:54:07 +0200 (Sat, 02 May 2009)
New Revision: 4784

Added:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h
Removed:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/common.mak.patch
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavcodec_Makefile.patch
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavdevice_Makefile.patch
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavfilter_Makefile.patch
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavformat_Makefile.patch
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavutil_Makefile.patch
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libpostproc_Makefile.patch
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libswscale_Makefile.patch
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/CMakeLists.txt
Log:
[FFmpeg upgrade] Preparing set of patches

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/CMakeLists.txt	2009-05-02 13:54:05 UTC (rev 4783)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/CMakeLists.txt	2009-05-02 13:54:07 UTC (rev 4784)
@@ -28,8 +28,8 @@
 	SET(CMAKE_SHARED_LINKER_FLAGS "${CMAKE_SHARED_LINKER_FLAGS} -Wl,--enable-runtime-pseudo-reloc -Wl,--enable-auto-image-base")
 ENDIF (WIN32)
 
-ADD_SUBDIRECTORY(ADM_lavcodec)
-ADD_SUBDIRECTORY(ADM_lavformat)
+ADD_SUBDIRECTORY(libavcodec)
+ADD_SUBDIRECTORY(libavformat)
 ADD_SUBDIRECTORY(libavutil)
-ADD_SUBDIRECTORY(ADM_libswscale)
-ADD_SUBDIRECTORY(ADM_libpostproc)
+ADD_SUBDIRECTORY(libswscale)
+ADD_SUBDIRECTORY(libpostproc)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/CMakeLists.txt	2009-05-02 13:54:05 UTC (rev 4783)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/CMakeLists.txt	2009-05-02 13:54:07 UTC (rev 4784)
@@ -9,8 +9,11 @@
 	golomb.c  4xm.c  cabac.c  asv1.c  vcr1.c  cljr.c  faandct.c  parser.c  roqvideo.c
 	xan.c  rpza.c  msrle.c  msrledec.c msvideo1.c  cinepak.c  vqavideo.c  idcinvideo.c  smc.c
 	flicvideo.c  interplayvideo.c  dpcm.c  8bps.c  vmdav.c  truemotion1.c  flac.c
-	g726.c  qtrle.c  lcl.c  snow.c  rangecoder.c  bitstream.c  h264idct.c  h261.c
-	amr.c  tscc.c  resample2.c    qdm2.c  bitstream_filter.c  eval.c  vc1.c
+	g726.c  qtrle.c  
+        #lcl.c  
+        snow.c  rangecoder.c  bitstream.c  h264idct.c  h261.c
+	#amr.c  
+        tscc.c  resample2.c    qdm2.c  bitstream_filter.c  eval.c  vc1.c
 	vc1dsp.c  vp56.c  vp6.c  vp5.c  indeo2.c  smacker.c  opt.c  fraps.c  dnxhddec.c
 	mpeg12data.c  mpegaudiodata.c  msmpeg4data.c  vc1data.c  vp56data.c  mjpegbdec.c
 	h263_parser.c  h264_parser.c  mpeg4video_parser.c  mpegvideo_enc.c  mpeg12enc.c

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h	2009-05-02 13:54:05 UTC (rev 4783)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h	2009-05-02 13:54:07 UTC (rev 4784)
@@ -0,0 +1,3622 @@
+/*
+ * copyright (c) 2001 Fabrice Bellard
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
+#ifndef AVCODEC_AVCODEC_H
+#define AVCODEC_AVCODEC_H
+
+/**
+ * @file libavcodec/avcodec.h
+ * external API header
+ */
+
+#include <errno.h>
+#include "libavutil/avutil.h"
+
+#define LIBAVCODEC_VERSION_MAJOR 52
+#define LIBAVCODEC_VERSION_MINOR 28
+#define LIBAVCODEC_VERSION_MICRO  0
+
+#define LIBAVCODEC_VERSION_INT  AV_VERSION_INT(LIBAVCODEC_VERSION_MAJOR, \
+                                               LIBAVCODEC_VERSION_MINOR, \
+                                               LIBAVCODEC_VERSION_MICRO)
+#define LIBAVCODEC_VERSION      AV_VERSION(LIBAVCODEC_VERSION_MAJOR,    \
+                                           LIBAVCODEC_VERSION_MINOR,    \
+                                           LIBAVCODEC_VERSION_MICRO)
+#define LIBAVCODEC_BUILD        LIBAVCODEC_VERSION_INT
+
+#define LIBAVCODEC_IDENT        "Lavc" AV_STRINGIFY(LIBAVCODEC_VERSION)
+
+#define AV_NOPTS_VALUE          INT64_C(0x8000000000000000)
+#define AV_TIME_BASE            1000000
+#define AV_TIME_BASE_Q          (AVRational){1, AV_TIME_BASE}
+
+/**
+ * Identifies the syntax and semantics of the bitstream.
+ * The principle is roughly:
+ * Two decoders with the same ID can decode the same streams.
+ * Two encoders with the same ID can encode compatible streams.
+ * There may be slight deviations from the principle due to implementation
+ * details.
+ *
+ * If you add a codec ID to this list, add it so that
+ * 1. no value of a existing codec ID changes (that would break ABI),
+ * 2. it is as close as possible to similar codecs.
+ */
+enum CodecID {
+    CODEC_ID_NONE,
+
+    /* video codecs */
+    CODEC_ID_MPEG1VIDEO,
+    CODEC_ID_MPEG2VIDEO, ///< preferred ID for MPEG-1/2 video decoding
+    CODEC_ID_MPEG2VIDEO_XVMC,
+    CODEC_ID_H261,
+    CODEC_ID_H263,
+    CODEC_ID_RV10,
+    CODEC_ID_RV20,
+    CODEC_ID_MJPEG,
+    CODEC_ID_MJPEGB,
+    CODEC_ID_LJPEG,
+    CODEC_ID_SP5X,
+    CODEC_ID_JPEGLS,
+    CODEC_ID_MPEG4,
+    CODEC_ID_RAWVIDEO,
+    CODEC_ID_MSMPEG4V1,
+    CODEC_ID_MSMPEG4V2,
+    CODEC_ID_MSMPEG4V3,
+    CODEC_ID_WMV1,
+    CODEC_ID_WMV2,
+    CODEC_ID_H263P,
+    CODEC_ID_H263I,
+    CODEC_ID_FLV1,
+    CODEC_ID_SVQ1,
+    CODEC_ID_SVQ3,
+    CODEC_ID_DVVIDEO,
+    CODEC_ID_HUFFYUV,
+    CODEC_ID_CYUV,
+    CODEC_ID_H264,
+    CODEC_ID_INDEO3,
+    CODEC_ID_VP3,
+    CODEC_ID_THEORA,
+    CODEC_ID_ASV1,
+    CODEC_ID_ASV2,
+    CODEC_ID_FFV1,
+    CODEC_ID_4XM,
+    CODEC_ID_VCR1,
+    CODEC_ID_CLJR,
+    CODEC_ID_MDEC,
+    CODEC_ID_ROQ,
+    CODEC_ID_INTERPLAY_VIDEO,
+    CODEC_ID_XAN_WC3,
+    CODEC_ID_XAN_WC4,
+    CODEC_ID_RPZA,
+    CODEC_ID_CINEPAK,
+    CODEC_ID_WS_VQA,
+    CODEC_ID_MSRLE,
+    CODEC_ID_MSVIDEO1,
+    CODEC_ID_IDCIN,
+    CODEC_ID_8BPS,
+    CODEC_ID_SMC,
+    CODEC_ID_FLIC,
+    CODEC_ID_TRUEMOTION1,
+    CODEC_ID_VMDVIDEO,
+    CODEC_ID_MSZH,
+    CODEC_ID_ZLIB,
+    CODEC_ID_QTRLE,
+    CODEC_ID_SNOW,
+    CODEC_ID_TSCC,
+    CODEC_ID_ULTI,
+    CODEC_ID_QDRAW,
+    CODEC_ID_VIXL,
+    CODEC_ID_QPEG,
+    CODEC_ID_XVID,
+    CODEC_ID_PNG,
+    CODEC_ID_PPM,
+    CODEC_ID_PBM,
+    CODEC_ID_PGM,
+    CODEC_ID_PGMYUV,
+    CODEC_ID_PAM,
+    CODEC_ID_FFVHUFF,
+    CODEC_ID_RV30,
+    CODEC_ID_RV40,
+    CODEC_ID_VC1,
+    CODEC_ID_WMV3,
+    CODEC_ID_LOCO,
+    CODEC_ID_WNV1,
+    CODEC_ID_AASC,
+    CODEC_ID_INDEO2,
+    CODEC_ID_FRAPS,
+    CODEC_ID_TRUEMOTION2,
+    CODEC_ID_BMP,
+    CODEC_ID_CSCD,
+    CODEC_ID_MMVIDEO,
+    CODEC_ID_ZMBV,
+    CODEC_ID_AVS,
+    CODEC_ID_SMACKVIDEO,
+    CODEC_ID_NUV,
+    CODEC_ID_KMVC,
+    CODEC_ID_FLASHSV,
+    CODEC_ID_CAVS,
+    CODEC_ID_JPEG2000,
+    CODEC_ID_VMNC,
+    CODEC_ID_VP5,
+    CODEC_ID_VP6,
+    CODEC_ID_VP6F,
+    CODEC_ID_TARGA,
+    CODEC_ID_DSICINVIDEO,
+    CODEC_ID_TIERTEXSEQVIDEO,
+    CODEC_ID_TIFF,
+    CODEC_ID_GIF,
+    CODEC_ID_FFH264,
+    CODEC_ID_DXA,
+    CODEC_ID_DNXHD,
+    CODEC_ID_THP,
+    CODEC_ID_SGI,
+    CODEC_ID_C93,
+    CODEC_ID_BETHSOFTVID,
+    CODEC_ID_PTX,
+    CODEC_ID_TXD,
+    CODEC_ID_VP6A,
+    CODEC_ID_AMV,
+    CODEC_ID_VB,
+    CODEC_ID_PCX,
+    CODEC_ID_SUNRAST,
+    CODEC_ID_INDEO4,
+    CODEC_ID_INDEO5,
+    CODEC_ID_MIMIC,
+    CODEC_ID_RL2,
+    CODEC_ID_8SVX_EXP,
+    CODEC_ID_8SVX_FIB,
+    CODEC_ID_ESCAPE124,
+    CODEC_ID_DIRAC,
+    CODEC_ID_BFI,
+    CODEC_ID_CMV,
+    CODEC_ID_MOTIONPIXELS,
+    CODEC_ID_TGV,
+    CODEC_ID_TGQ,
+    CODEC_ID_TQI,
+    CODEC_ID_AURA,
+    CODEC_ID_AURA2,
+    CODEC_ID_V210X,
+
+    /* various PCM "codecs" */
+    CODEC_ID_PCM_S16LE= 0x10000,
+    CODEC_ID_PCM_S16BE,
+    CODEC_ID_PCM_U16LE,
+    CODEC_ID_PCM_U16BE,
+    CODEC_ID_PCM_S8,
+    CODEC_ID_PCM_U8,
+    CODEC_ID_PCM_MULAW,
+    CODEC_ID_PCM_ALAW,
+    CODEC_ID_PCM_S32LE,
+    CODEC_ID_PCM_S32BE,
+    CODEC_ID_PCM_U32LE,
+    CODEC_ID_PCM_U32BE,
+    CODEC_ID_PCM_S24LE,
+    CODEC_ID_PCM_S24BE,
+    CODEC_ID_PCM_U24LE,
+    CODEC_ID_PCM_U24BE,
+    CODEC_ID_PCM_S24DAUD,
+    CODEC_ID_PCM_ZORK,
+    CODEC_ID_PCM_S16LE_PLANAR,
+    CODEC_ID_PCM_DVD,
+    CODEC_ID_PCM_F32BE,
+    CODEC_ID_PCM_F32LE,
+    CODEC_ID_PCM_F64BE,
+    CODEC_ID_PCM_F64LE,
+
+    /* various ADPCM codecs */
+    CODEC_ID_ADPCM_IMA_QT= 0x11000,
+    CODEC_ID_ADPCM_IMA_WAV,
+    CODEC_ID_ADPCM_IMA_DK3,
+    CODEC_ID_ADPCM_IMA_DK4,
+    CODEC_ID_ADPCM_IMA_WS,
+    CODEC_ID_ADPCM_IMA_SMJPEG,
+    CODEC_ID_ADPCM_MS,
+    CODEC_ID_ADPCM_4XM,
+    CODEC_ID_ADPCM_XA,
+    CODEC_ID_ADPCM_ADX,
+    CODEC_ID_ADPCM_EA,
+    CODEC_ID_ADPCM_G726,
+    CODEC_ID_ADPCM_CT,
+    CODEC_ID_ADPCM_SWF,
+    CODEC_ID_ADPCM_YAMAHA,
+    CODEC_ID_ADPCM_SBPRO_4,
+    CODEC_ID_ADPCM_SBPRO_3,
+    CODEC_ID_ADPCM_SBPRO_2,
+    CODEC_ID_ADPCM_THP,
+    CODEC_ID_ADPCM_IMA_AMV,
+    CODEC_ID_ADPCM_EA_R1,
+    CODEC_ID_ADPCM_EA_R3,
+    CODEC_ID_ADPCM_EA_R2,
+    CODEC_ID_ADPCM_IMA_EA_SEAD,
+    CODEC_ID_ADPCM_IMA_EA_EACS,
+    CODEC_ID_ADPCM_EA_XAS,
+    CODEC_ID_ADPCM_EA_MAXIS_XA,
+    CODEC_ID_ADPCM_IMA_ISS,
+
+    /* AMR */
+    CODEC_ID_AMR_NB= 0x12000,
+    CODEC_ID_AMR_WB,
+
+    /* RealAudio codecs*/
+    CODEC_ID_RA_144= 0x13000,
+    CODEC_ID_RA_288,
+
+    /* various DPCM codecs */
+    CODEC_ID_ROQ_DPCM= 0x14000,
+    CODEC_ID_INTERPLAY_DPCM,
+    CODEC_ID_XAN_DPCM,
+    CODEC_ID_SOL_DPCM,
+
+    /* audio codecs */
+    CODEC_ID_MP2= 0x15000,
+    CODEC_ID_MP3, ///< preferred ID for decoding MPEG audio layer 1, 2 or 3
+    CODEC_ID_AAC,
+    CODEC_ID_AC3,
+    CODEC_ID_DTS,
+    CODEC_ID_VORBIS,
+    CODEC_ID_DVAUDIO,
+    CODEC_ID_WMAV1,
+    CODEC_ID_WMAV2,
+    CODEC_ID_MACE3,
+    CODEC_ID_MACE6,
+    CODEC_ID_VMDAUDIO,
+    CODEC_ID_SONIC,
+    CODEC_ID_SONIC_LS,
+    CODEC_ID_FLAC,
+    CODEC_ID_MP3ADU,
+    CODEC_ID_MP3ON4,
+    CODEC_ID_SHORTEN,
+    CODEC_ID_ALAC,
+    CODEC_ID_WESTWOOD_SND1,
+    CODEC_ID_GSM, ///< as in Berlin toast format
+    CODEC_ID_QDM2,
+    CODEC_ID_COOK,
+    CODEC_ID_TRUESPEECH,
+    CODEC_ID_TTA,
+    CODEC_ID_SMACKAUDIO,
+    CODEC_ID_QCELP,
+    CODEC_ID_WAVPACK,
+    CODEC_ID_DSICINAUDIO,
+    CODEC_ID_IMC,
+    CODEC_ID_MUSEPACK7,
+    CODEC_ID_MLP,
+    CODEC_ID_GSM_MS, /* as found in WAV */
+    CODEC_ID_ATRAC3,
+    CODEC_ID_VOXWARE,
+    CODEC_ID_APE,
+    CODEC_ID_NELLYMOSER,
+    CODEC_ID_MUSEPACK8,
+    CODEC_ID_SPEEX,
+    CODEC_ID_WMAVOICE,
+    CODEC_ID_WMAPRO,
+    CODEC_ID_WMALOSSLESS,
+    CODEC_ID_ATRAC3P,
+    CODEC_ID_EAC3,
+    CODEC_ID_SIPR,
+    CODEC_ID_MP1,
+    CODEC_ID_TWINVQ,
+    CODEC_ID_TRUEHD,
+    CODEC_ID_MP4ALS,
+
+    /* subtitle codecs */
+    CODEC_ID_DVD_SUBTITLE= 0x17000,
+    CODEC_ID_DVB_SUBTITLE,
+    CODEC_ID_TEXT,  ///< raw UTF-8 text
+    CODEC_ID_XSUB,
+    CODEC_ID_SSA,
+    CODEC_ID_MOV_TEXT,
+
+    /* other specific kind of codecs (generally used for attachments) */
+    CODEC_ID_TTF= 0x18000,
+
+    CODEC_ID_PROBE= 0x19000, ///< codec_id is not known (like CODEC_ID_NONE) but lavf should attempt to identify it
+
+    CODEC_ID_MPEG2TS= 0x20000, /**< _FAKE_ codec to indicate a raw MPEG-2 TS
+                                * stream (only used by libavformat) */
+};
+
+enum CodecType {
+    CODEC_TYPE_UNKNOWN = -1,
+    CODEC_TYPE_VIDEO,
+    CODEC_TYPE_AUDIO,
+    CODEC_TYPE_DATA,
+    CODEC_TYPE_SUBTITLE,
+    CODEC_TYPE_ATTACHMENT,
+    CODEC_TYPE_NB
+};
+
+/**
+ * all in native-endian format
+ */
+enum SampleFormat {
+    SAMPLE_FMT_NONE = -1,
+    SAMPLE_FMT_U8,              ///< unsigned 8 bits
+    SAMPLE_FMT_S16,             ///< signed 16 bits
+    SAMPLE_FMT_S32,             ///< signed 32 bits
+    SAMPLE_FMT_FLT,             ///< float
+    SAMPLE_FMT_DBL,             ///< double
+    SAMPLE_FMT_NB               ///< Number of sample formats. DO NOT USE if dynamically linking to libavcodec
+};
+
+/* Audio channel masks */
+#define CH_FRONT_LEFT             0x00000001
+#define CH_FRONT_RIGHT            0x00000002
+#define CH_FRONT_CENTER           0x00000004
+#define CH_LOW_FREQUENCY          0x00000008
+#define CH_BACK_LEFT              0x00000010
+#define CH_BACK_RIGHT             0x00000020
+#define CH_FRONT_LEFT_OF_CENTER   0x00000040
+#define CH_FRONT_RIGHT_OF_CENTER  0x00000080
+#define CH_BACK_CENTER            0x00000100
+#define CH_SIDE_LEFT              0x00000200
+#define CH_SIDE_RIGHT             0x00000400
+#define CH_TOP_CENTER             0x00000800
+#define CH_TOP_FRONT_LEFT         0x00001000
+#define CH_TOP_FRONT_CENTER       0x00002000
+#define CH_TOP_FRONT_RIGHT        0x00004000
+#define CH_TOP_BACK_LEFT          0x00008000
+#define CH_TOP_BACK_CENTER        0x00010000
+#define CH_TOP_BACK_RIGHT         0x00020000
+#define CH_STEREO_LEFT            0x20000000  ///< Stereo downmix.
+#define CH_STEREO_RIGHT           0x40000000  ///< See CH_STEREO_LEFT.
+
+/* Audio channel convenience macros */
+#define CH_LAYOUT_MONO              (CH_FRONT_CENTER)
+#define CH_LAYOUT_STEREO            (CH_FRONT_LEFT|CH_FRONT_RIGHT)
+#define CH_LAYOUT_2_1               (CH_LAYOUT_STEREO|CH_BACK_CENTER)
+#define CH_LAYOUT_SURROUND          (CH_LAYOUT_STEREO|CH_FRONT_CENTER)
+#define CH_LAYOUT_4POINT0           (CH_LAYOUT_SURROUND|CH_BACK_CENTER)
+#define CH_LAYOUT_2_2               (CH_LAYOUT_STEREO|CH_SIDE_LEFT|CH_SIDE_RIGHT)
+#define CH_LAYOUT_QUAD              (CH_LAYOUT_STEREO|CH_BACK_LEFT|CH_BACK_RIGHT)
+#define CH_LAYOUT_5POINT0           (CH_LAYOUT_SURROUND|CH_SIDE_LEFT|CH_SIDE_RIGHT)
+#define CH_LAYOUT_5POINT1           (CH_LAYOUT_5POINT0|CH_LOW_FREQUENCY)
+#define CH_LAYOUT_5POINT0_BACK      (CH_LAYOUT_SURROUND|CH_BACK_LEFT|CH_BACK_RIGHT)
+#define CH_LAYOUT_5POINT1_BACK      (CH_LAYOUT_5POINT0_BACK|CH_LOW_FREQUENCY)
+#define CH_LAYOUT_7POINT1           (CH_LAYOUT_5POINT1|CH_BACK_LEFT|CH_BACK_RIGHT)
+#define CH_LAYOUT_7POINT1_WIDE      (CH_LAYOUT_5POINT1_BACK|\
+                                          CH_FRONT_LEFT_OF_CENTER|CH_FRONT_RIGHT_OF_CENTER)
+#define CH_LAYOUT_STEREO_DOWNMIX    (CH_STEREO_LEFT|CH_STEREO_RIGHT)
+
+/* in bytes */
+#define AVCODEC_MAX_AUDIO_FRAME_SIZE 192000 // 1 second of 48khz 32bit audio
+
+/**
+ * Required number of additionally allocated bytes at the end of the input bitstream for decoding.
+ * This is mainly needed because some optimized bitstream readers read
+ * 32 or 64 bit at once and could read over the end.<br>
+ * Note: If the first 23 bits of the additional bytes are not 0, then damaged
+ * MPEG bitstreams could cause overread and segfault.
+ */
+#define FF_INPUT_BUFFER_PADDING_SIZE 8
+
+/**
+ * minimum encoding buffer size
+ * Used to avoid some checks during header writing.
+ */
+#define FF_MIN_BUFFER_SIZE 16384
+
+
+/**
+ * motion estimation type.
+ */
+enum Motion_Est_ID {
+    ME_ZERO = 1,    ///< no search, that is use 0,0 vector whenever one is needed
+    ME_FULL,
+    ME_LOG,
+    ME_PHODS,
+    ME_EPZS,        ///< enhanced predictive zonal search
+    ME_X1,          ///< reserved for experiments
+    ME_HEX,         ///< hexagon based search
+    ME_UMH,         ///< uneven multi-hexagon search
+    ME_ITER,        ///< iterative search
+    ME_TESA,        ///< transformed exhaustive search algorithm
+};
+
+enum AVDiscard{
+    /* We leave some space between them for extensions (drop some
+     * keyframes for intra-only or drop just some bidir frames). */
+    AVDISCARD_NONE   =-16, ///< discard nothing
+    AVDISCARD_DEFAULT=  0, ///< discard useless packets like 0 size packets in avi
+    AVDISCARD_NONREF =  8, ///< discard all non reference
+    AVDISCARD_BIDIR  = 16, ///< discard all bidirectional frames
+    AVDISCARD_NONKEY = 32, ///< discard all frames except keyframes
+    AVDISCARD_ALL    = 48, ///< discard all
+};
+
+typedef struct RcOverride{
+    int start_frame;
+    int end_frame;
+    int qscale; // If this is 0 then quality_factor will be used instead.
+    float quality_factor;
+} RcOverride;
+
+#define FF_MAX_B_FRAMES 16
+
+/* encoding support
+   These flags can be passed in AVCodecContext.flags before initialization.
+   Note: Not everything is supported yet.
+*/
+
+#define CODEC_FLAG_QSCALE 0x0002  ///< Use fixed qscale.
+#define CODEC_FLAG_4MV    0x0004  ///< 4 MV per MB allowed / advanced prediction for H.263.
+#define CODEC_FLAG_QPEL   0x0010  ///< Use qpel MC.
+#define CODEC_FLAG_GMC    0x0020  ///< Use GMC.
+#define CODEC_FLAG_MV0    0x0040  ///< Always try a MB with MV=<0,0>.
+#define CODEC_FLAG_PART   0x0080  ///< Use data partitioning.
+/**
+ * The parent program guarantees that the input for B-frames containing
+ * streams is not written to for at least s->max_b_frames+1 frames, if
+ * this is not set the input will be copied.
+ */
+#define CODEC_FLAG_INPUT_PRESERVED 0x0100
+#define CODEC_FLAG_PASS1           0x0200   ///< Use internal 2pass ratecontrol in first pass mode.
+#define CODEC_FLAG_PASS2           0x0400   ///< Use internal 2pass ratecontrol in second pass mode.
+#define CODEC_FLAG_EXTERN_HUFF     0x1000   ///< Use external Huffman table (for MJPEG).
+#define CODEC_FLAG_GRAY            0x2000   ///< Only decode/encode grayscale.
+#define CODEC_FLAG_EMU_EDGE        0x4000   ///< Don't draw edges.
+#define CODEC_FLAG_PSNR            0x8000   ///< error[?] variables will be set during encoding.
+#define CODEC_FLAG_TRUNCATED       0x00010000 /** Input bitstream might be truncated at a random
+                                                  location instead of only at frame boundaries. */
+#define CODEC_FLAG_NORMALIZE_AQP  0x00020000 ///< Normalize adaptive quantization.
+#define CODEC_FLAG_INTERLACED_DCT 0x00040000 ///< Use interlaced DCT.
+#define CODEC_FLAG_LOW_DELAY      0x00080000 ///< Force low delay.
+#define CODEC_FLAG_ALT_SCAN       0x00100000 ///< Use alternate scan.
+#define CODEC_FLAG_GLOBAL_HEADER  0x00400000 ///< Place global headers in extradata instead of every keyframe.
+#define CODEC_FLAG_BITEXACT       0x00800000 ///< Use only bitexact stuff (except (I)DCT).
+/* Fx : Flag for h263+ extra options */
+#define CODEC_FLAG_AC_PRED        0x01000000 ///< H.263 advanced intra coding / MPEG-4 AC prediction
+#define CODEC_FLAG_H263P_UMV      0x02000000 ///< unlimited motion vector
+#define CODEC_FLAG_CBP_RD         0x04000000 ///< Use rate distortion optimization for cbp.
+#define CODEC_FLAG_QP_RD          0x08000000 ///< Use rate distortion optimization for qp selectioon.
+#define CODEC_FLAG_H263P_AIV      0x00000008 ///< H.263 alternative inter VLC
+#define CODEC_FLAG_OBMC           0x00000001 ///< OBMC
+#define CODEC_FLAG_LOOP_FILTER    0x00000800 ///< loop filter
+#define CODEC_FLAG_H263P_SLICE_STRUCT 0x10000000
+#define CODEC_FLAG_INTERLACED_ME  0x20000000 ///< interlaced motion estimation
+#define CODEC_FLAG_SVCD_SCAN_OFFSET 0x40000000 ///< Will reserve space for SVCD scan offset user data.
+#define CODEC_FLAG_CLOSED_GOP     0x80000000
+#define CODEC_FLAG2_FAST          0x00000001 ///< Allow non spec compliant speedup tricks.
+#define CODEC_FLAG2_STRICT_GOP    0x00000002 ///< Strictly enforce GOP size.
+#define CODEC_FLAG2_NO_OUTPUT     0x00000004 ///< Skip bitstream encoding.
+#define CODEC_FLAG2_LOCAL_HEADER  0x00000008 ///< Place global headers at every keyframe instead of in extradata.
+#define CODEC_FLAG2_BPYRAMID      0x00000010 ///< H.264 allow B-frames to be used as references.
+#define CODEC_FLAG2_WPRED         0x00000020 ///< H.264 weighted biprediction for B-frames
+#define CODEC_FLAG2_MIXED_REFS    0x00000040 ///< H.264 one reference per partition, as opposed to one reference per macroblock
+#define CODEC_FLAG2_8X8DCT        0x00000080 ///< H.264 high profile 8x8 transform
+#define CODEC_FLAG2_FASTPSKIP     0x00000100 ///< H.264 fast pskip
+#define CODEC_FLAG2_AUD           0x00000200 ///< H.264 access unit delimiters
+#define CODEC_FLAG2_BRDO          0x00000400 ///< B-frame rate-distortion optimization
+#define CODEC_FLAG2_INTRA_VLC     0x00000800 ///< Use MPEG-2 intra VLC table.
+#define CODEC_FLAG2_MEMC_ONLY     0x00001000 ///< Only do ME/MC (I frames -> ref, P frame -> ME+MC).
+#define CODEC_FLAG2_DROP_FRAME_TIMECODE 0x00002000 ///< timecode is in drop frame format.
+#define CODEC_FLAG2_SKIP_RD       0x00004000 ///< RD optimal MB level residual skipping
+#define CODEC_FLAG2_CHUNKS        0x00008000 ///< Input bitstream might be truncated at a packet boundaries instead of only at frame boundaries.
+#define CODEC_FLAG2_NON_LINEAR_QUANT 0x00010000 ///< Use MPEG-2 nonlinear quantizer.
+#define CODEC_FLAG2_BIT_RESERVOIR 0x00020000 ///< Use a bit reservoir when encoding if possible
+
+/* Unsupported options :
+ *              Syntax Arithmetic coding (SAC)
+ *              Reference Picture Selection
+ *              Independent Segment Decoding */
+/* /Fx */
+/* codec capabilities */
+
+#define CODEC_CAP_DRAW_HORIZ_BAND 0x0001 ///< Decoder can use draw_horiz_band callback.
+/**
+ * Codec uses get_buffer() for allocating buffers.
+ * direct rendering method 1
+ */
+#define CODEC_CAP_DR1             0x0002
+/* If 'parse_only' field is true, then avcodec_parse_frame() can be used. */
+#define CODEC_CAP_PARSE_ONLY      0x0004
+#define CODEC_CAP_TRUNCATED       0x0008
+/* Codec can export data for HW decoding (XvMC). */
+#define CODEC_CAP_HWACCEL         0x0010
+/**
+ * Codec has a nonzero delay and needs to be fed with NULL at the end to get the delayed data.
+ * If this is not set, the codec is guaranteed to never be fed with NULL data.
+ */
+#define CODEC_CAP_DELAY           0x0020
+/**
+ * Codec can be fed a final frame with a smaller size.
+ * This can be used to prevent truncation of the last audio samples.
+ */
+#define CODEC_CAP_SMALL_LAST_FRAME 0x0040
+/**
+ * Codec can export data for HW decoding (VDPAU).
+ */
+#define CODEC_CAP_HWACCEL_VDPAU    0x0080
+
+//The following defines may change, don't expect compatibility if you use them.
+#define MB_TYPE_INTRA4x4   0x0001
+#define MB_TYPE_INTRA16x16 0x0002 //FIXME H.264-specific
+#define MB_TYPE_INTRA_PCM  0x0004 //FIXME H.264-specific
+#define MB_TYPE_16x16      0x0008
+#define MB_TYPE_16x8       0x0010
+#define MB_TYPE_8x16       0x0020
+#define MB_TYPE_8x8        0x0040
+#define MB_TYPE_INTERLACED 0x0080
+#define MB_TYPE_DIRECT2    0x0100 //FIXME
+#define MB_TYPE_ACPRED     0x0200
+#define MB_TYPE_GMC        0x0400
+#define MB_TYPE_SKIP       0x0800
+#define MB_TYPE_P0L0       0x1000
+#define MB_TYPE_P1L0       0x2000
+#define MB_TYPE_P0L1       0x4000
+#define MB_TYPE_P1L1       0x8000
+#define MB_TYPE_L0         (MB_TYPE_P0L0 | MB_TYPE_P1L0)
+#define MB_TYPE_L1         (MB_TYPE_P0L1 | MB_TYPE_P1L1)
+#define MB_TYPE_L0L1       (MB_TYPE_L0   | MB_TYPE_L1)
+#define MB_TYPE_QUANT      0x00010000
+#define MB_TYPE_CBP        0x00020000
+//Note bits 24-31 are reserved for codec specific use (h264 ref0, mpeg1 0mv, ...)
+
+/**
+ * Pan Scan area.
+ * This specifies the area which should be displayed.
+ * Note there may be multiple such areas for one frame.
+ */
+typedef struct AVPanScan{
+    /**
+     * id
+     * - encoding: Set by user.
+     * - decoding: Set by libavcodec.
+     */
+    int id;
+
+    /**
+     * width and height in 1/16 pel
+     * - encoding: Set by user.
+     * - decoding: Set by libavcodec.
+     */
+    int width;
+    int height;
+
+    /**
+     * position of the top left corner in 1/16 pel for up to 3 fields/frames
+     * - encoding: Set by user.
+     * - decoding: Set by libavcodec.
+     */
+    int16_t position[3][2];
+}AVPanScan;
+
+#define FF_COMMON_FRAME \
+    /**\
+     * pointer to the picture planes.\
+     * This might be different from the first allocated byte\
+     * - encoding: \
+     * - decoding: \
+     */\
+    uint8_t *data[4];\
+    int linesize[4];\
+    /**\
+     * pointer to the first allocated byte of the picture. Can be used in get_buffer/release_buffer.\
+     * This isn't used by libavcodec unless the default get/release_buffer() is used.\
+     * - encoding: \
+     * - decoding: \
+     */\
+    uint8_t *base[4];\
+    /**\
+     * 1 -> keyframe, 0-> not\
+     * - encoding: Set by libavcodec.\
+     * - decoding: Set by libavcodec.\
+     */\
+    int key_frame;\
+\
+    /**\
+     * Picture type of the frame, see ?_TYPE below.\
+     * - encoding: Set by libavcodec. for coded_picture (and set by user for input).\
+     * - decoding: Set by libavcodec.\
+     */\
+    int pict_type;\
+\
+    /**\
+     * presentation timestamp in time_base units (time when frame should be shown to user)\
+     * If AV_NOPTS_VALUE then frame_rate = 1/time_base will be assumed.\
+     * - encoding: MUST be set by user.\
+     * - decoding: Set by libavcodec.\
+     */\
+    int64_t pts;\
+\
+    /**\
+     * picture number in bitstream order\
+     * - encoding: set by\
+     * - decoding: Set by libavcodec.\
+     */\
+    int coded_picture_number;\
+    /**\
+     * picture number in display order\
+     * - encoding: set by\
+     * - decoding: Set by libavcodec.\
+     */\
+    int display_picture_number;\
+\
+    /**\
+     * quality (between 1 (good) and FF_LAMBDA_MAX (bad)) \
+     * - encoding: Set by libavcodec. for coded_picture (and set by user for input).\
+     * - decoding: Set by libavcodec.\
+     */\
+    int quality; \
+\
+    /**\
+     * buffer age (1->was last buffer and dint change, 2->..., ...).\
+     * Set to INT_MAX if the buffer has not been used yet.\
+     * - encoding: unused\
+     * - decoding: MUST be set by get_buffer().\
+     */\
+    int age;\
+\
+    /**\
+     * is this picture used as reference\
+     * The values for this are the same as the MpegEncContext.picture_structure\
+     * variable, that is 1->top field, 2->bottom field, 3->frame/both fields.\
+     * Set to 4 for delayed, non-reference frames.\
+     * - encoding: unused\
+     * - decoding: Set by libavcodec. (before get_buffer() call)).\
+     */\
+    int reference;\
+\
+    /**\
+     * QP table\
+     * - encoding: unused\
+     * - decoding: Set by libavcodec.\
+     */\
+    int8_t *qscale_table;\
+    /**\
+     * QP store stride\
+     * - encoding: unused\
+     * - decoding: Set by libavcodec.\
+     */\
+    int qstride;\
+\
+    /**\
+     * mbskip_table[mb]>=1 if MB didn't change\
+     * stride= mb_width = (width+15)>>4\
+     * - encoding: unused\
+     * - decoding: Set by libavcodec.\
+     */\
+    uint8_t *mbskip_table;\
+\
+    /**\
+     * motion vector table\
+     * @code\
+     * example:\
+     * int mv_sample_log2= 4 - motion_subsample_log2;\
+     * int mb_width= (width+15)>>4;\
+     * int mv_stride= (mb_width << mv_sample_log2) + 1;\
+     * motion_val[direction][x + y*mv_stride][0->mv_x, 1->mv_y];\
+     * @endcode\
+     * - encoding: Set by user.\
+     * - decoding: Set by libavcodec.\
+     */\
+    int16_t (*motion_val[2])[2];\
+\
+    /**\
+     * macroblock type table\
+     * mb_type_base + mb_width + 2\
+     * - encoding: Set by user.\
+     * - decoding: Set by libavcodec.\
+     */\
+    uint32_t *mb_type;\
+\
+    /**\
+     * log2 of the size of the block which a single vector in motion_val represents: \
+     * (4->16x16, 3->8x8, 2-> 4x4, 1-> 2x2)\
+     * - encoding: unused\
+     * - decoding: Set by libavcodec.\
+     */\
+    uint8_t motion_subsample_log2;\
+\
+    /**\
+     * for some private data of the user\
+     * - encoding: unused\
+     * - decoding: Set by user.\
+     */\
+    void *opaque;\
+\
+    /**\
+     * error\
+     * - encoding: Set by libavcodec. if flags&CODEC_FLAG_PSNR.\
+     * - decoding: unused\
+     */\
+    uint64_t error[4];\
+\
+    /**\
+     * type of the buffer (to keep track of who has to deallocate data[*])\
+     * - encoding: Set by the one who allocates it.\
+     * - decoding: Set by the one who allocates it.\
+     * Note: User allocated (direct rendering) & internal buffers cannot coexist currently.\
+     */\
+    int type;\
+    \
+    /**\
+     * When decoding, this signals how much the picture must be delayed.\
+     * extra_delay = repeat_pict / (2*fps)\
+     * - encoding: unused\
+     * - decoding: Set by libavcodec.\
+     */\
+    int repeat_pict;\
+    \
+    /**\
+     * \
+     */\
+    int qscale_type;\
+    \
+    /**\
+     * The content of the picture is interlaced.\
+     * - encoding: Set by user.\
+     * - decoding: Set by libavcodec. (default 0)\
+     */\
+    int interlaced_frame;\
+    \
+    /**\
+     * If the content is interlaced, is top field displayed first.\
+     * - encoding: Set by user.\
+     * - decoding: Set by libavcodec.\
+     */\
+    int top_field_first;\
+    \
+    /**\
+     * Pan scan.\
+     * - encoding: Set by user.\
+     * - decoding: Set by libavcodec.\
+     */\
+    AVPanScan *pan_scan;\
+    \
+    /**\
+     * Tell user application that palette has changed from previous frame.\
+     * - encoding: ??? (no palette-enabled encoder yet)\
+     * - decoding: Set by libavcodec. (default 0).\
+     */\
+    int palette_has_changed;\
+    \
+    /**\
+     * codec suggestion on buffer type if != 0\
+     * - encoding: unused\
+     * - decoding: Set by libavcodec. (before get_buffer() call)).\
+     */\
+    int buffer_hints;\
+\
+    /**\
+     * DCT coefficients\
+     * - encoding: unused\
+     * - decoding: Set by libavcodec.\
+     */\
+    short *dct_coeff;\
+\
+    /**\
+     * motion referece frame index\
+     * - encoding: Set by user.\
+     * - decoding: Set by libavcodec.\
+     */\
+    int8_t *ref_index[2];\
+\
+    /**\
+     * reordered opaque 64bit number (generally a PTS) from AVCodecContext.reordered_opaque\
+     * output in AVFrame.reordered_opaque\
+     * - encoding: unused\
+     * - decoding: Read by user.\
+     */\
+    int64_t reordered_opaque;\
+\
+    /**\
+     * hardware accelerator private data (FFmpeg allocated)\
+     * - encoding: unused\
+     * - decoding: Set by libavcodec\
+     */\
+    void *hwaccel_picture_private;\
+
+
+#define FF_QSCALE_TYPE_MPEG1 0
+#define FF_QSCALE_TYPE_MPEG2 1
+#define FF_QSCALE_TYPE_H264  2
+
+#define FF_BUFFER_TYPE_INTERNAL 1
+#define FF_BUFFER_TYPE_USER     2 ///< direct rendering buffers (image is (de)allocated by user)
+#define FF_BUFFER_TYPE_SHARED   4 ///< Buffer from somewhere else; don't deallocate image (data/base), all other tables are not shared.
+#define FF_BUFFER_TYPE_COPY     8 ///< Just a (modified) copy of some other buffer, don't deallocate anything.
+
+
+#define FF_I_TYPE  1 ///< Intra
+#define FF_P_TYPE  2 ///< Predicted
+#define FF_B_TYPE  3 ///< Bi-dir predicted
+#define FF_S_TYPE  4 ///< S(GMC)-VOP MPEG4
+#define FF_SI_TYPE 5 ///< Switching Intra
+#define FF_SP_TYPE 6 ///< Switching Predicted
+#define FF_BI_TYPE 7
+
+#define FF_BUFFER_HINTS_VALID    0x01 // Buffer hints value is meaningful (if 0 ignore).
+#define FF_BUFFER_HINTS_READABLE 0x02 // Codec will read from buffer.
+#define FF_BUFFER_HINTS_PRESERVE 0x04 // User must not alter buffer content.
+#define FF_BUFFER_HINTS_REUSABLE 0x08 // Codec will reuse the buffer (update).
+
+typedef struct AVPacket {
+    /**
+     * Presentation timestamp in AVStream->time_base units; the time at which
+     * the decompressed packet will be presented to the user.
+     * Can be AV_NOPTS_VALUE if it is not stored in the file.
+     * pts MUST be larger or equal to dts as presentation cannot happen before
+     * decompression, unless one wants to view hex dumps. Some formats misuse
+     * the terms dts and pts/cts to mean something different. Such timestamps
+     * must be converted to true pts/dts before they are stored in AVPacket.
+     */
+    int64_t pts;
+    /**
+     * Decompression timestamp in AVStream->time_base units; the time at which
+     * the packet is decompressed.
+     * Can be AV_NOPTS_VALUE if it is not stored in the file.
+     */
+    int64_t dts;
+    uint8_t *data;
+    int   size;
+    int   stream_index;
+    int   flags;
+    /**
+     * Duration of this packet in AVStream->time_base units, 0 if unknown.
+     * Equals next_pts - this_pts in presentation order.
+     */
+    int   duration;
+    void  (*destruct)(struct AVPacket *);
+    void  *priv;
+    int64_t pos;                            ///< byte position in stream, -1 if unknown
+
+    /**
+     * Time difference in AVStream->time_base units from the pts of this
+     * packet to the point at which the output from the decoder has converged
+     * independent from the availability of previous frames. That is, the
+     * frames are virtually identical no matter if decoding started from
+     * the very first frame or from this keyframe.
+     * Is AV_NOPTS_VALUE if unknown.
+     * This field is not the display duration of the current packet.
+     *
+     * The purpose of this field is to allow seeking in streams that have no
+     * keyframes in the conventional sense. It corresponds to the
+     * recovery point SEI in H.264 and match_time_delta in NUT. It is also
+     * essential for some types of subtitle streams to ensure that all
+     * subtitles are correctly displayed after seeking.
+     */
+    int64_t convergence_duration;
+} AVPacket;
+#define PKT_FLAG_KEY   0x0001
+
+/**
+ * Audio Video Frame.
+ * New fields can be added to the end of FF_COMMON_FRAME with minor version
+ * bumps.
+ * Removal, reordering and changes to existing fields require a major
+ * version bump. No fields should be added into AVFrame before or after
+ * FF_COMMON_FRAME!
+ * sizeof(AVFrame) must not be used outside libav*.
+ */
+typedef struct AVFrame {
+    FF_COMMON_FRAME
+} AVFrame;
+
+/**
+ * main external API structure.
+ * New fields can be added to the end with minor version bumps.
+ * Removal, reordering and changes to existing fields require a major
+ * version bump.
+ * sizeof(AVCodecContext) must not be used outside libav*.
+ */
+typedef struct AVCodecContext {
+    /**
+     * information on struct for av_log
+     * - set by avcodec_alloc_context
+     */
+    const AVClass *av_class;
+    /**
+     * the average bitrate
+     * - encoding: Set by user; unused for constant quantizer encoding.
+     * - decoding: Set by libavcodec. 0 or some bitrate if this info is available in the stream.
+     */
+    int bit_rate;
+
+    /**
+     * number of bits the bitstream is allowed to diverge from the reference.
+     *           the reference can be CBR (for CBR pass1) or VBR (for pass2)
+     * - encoding: Set by user; unused for constant quantizer encoding.
+     * - decoding: unused
+     */
+    int bit_rate_tolerance;
+
+    /**
+     * CODEC_FLAG_*.
+     * - encoding: Set by user.
+     * - decoding: Set by user.
+     */
+    int flags;
+
+    /**
+     * Some codecs need additional format info. It is stored here.
+     * If any muxer uses this then ALL demuxers/parsers AND encoders for the
+     * specific codec MUST set it correctly otherwise stream copy breaks.
+     * In general use of this field by muxers is not recommanded.
+     * - encoding: Set by libavcodec.
+     * - decoding: Set by libavcodec. (FIXME: Is this OK?)
+     */
+    int sub_id;
+
+    /**
+     * Motion estimation algorithm used for video coding.
+     * 1 (zero), 2 (full), 3 (log), 4 (phods), 5 (epzs), 6 (x1), 7 (hex),
+     * 8 (umh), 9 (iter), 10 (tesa) [7, 8, 10 are x264 specific, 9 is snow specific]
+     * - encoding: MUST be set by user.
+     * - decoding: unused
+     */
+    int me_method;
+
+    /**
+     * some codecs need / can use extradata like Huffman tables.
+     * mjpeg: Huffman tables
+     * rv10: additional flags
+     * mpeg4: global headers (they can be in the bitstream or here)
+     * The allocated memory should be FF_INPUT_BUFFER_PADDING_SIZE bytes larger
+     * than extradata_size to avoid prolems if it is read with the bitstream reader.
+     * The bytewise contents of extradata must not depend on the architecture or CPU endianness.
+     * - encoding: Set/allocated/freed by libavcodec.
+     * - decoding: Set/allocated/freed by user.
+     */
+    uint8_t *extradata;
+    int extradata_size;
+
+    /**
+     * This is the fundamental unit of time (in seconds) in terms
+     * of which frame timestamps are represented. For fixed-fps content,
+     * timebase should be 1/framerate and timestamp increments should be
+     * identically 1.
+     * - encoding: MUST be set by user.
+     * - decoding: Set by libavcodec.
+     */
+    AVRational time_base;
+
+    /* video only */
+    /**
+     * picture width / height.
+     * - encoding: MUST be set by user.
+     * - decoding: Set by libavcodec.
+     * Note: For compatibility it is possible to set this instead of
+     * coded_width/height before decoding.
+     */
+    int width, height;
+
+#define FF_ASPECT_EXTENDED 15
+
+    /**
+     * the number of pictures in a group of pictures, or 0 for intra_only
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int gop_size;
+
+    /**
+     * Pixel format, see PIX_FMT_xxx.
+     * - encoding: Set by user.
+     * - decoding: Set by libavcodec.
+     */
+    enum PixelFormat pix_fmt;
+
+    /**
+     * Frame rate emulation. If not zero, the lower layer (i.e. format handler)
+     * has to read frames at native frame rate.
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int rate_emu;
+
+    /**
+     * If non NULL, 'draw_horiz_band' is called by the libavcodec
+     * decoder to draw a horizontal band. It improves cache usage. Not
+     * all codecs can do that. You must check the codec capabilities
+     * beforehand.
+     * The function is also used by hardware acceleration APIs.
+     * It is called at least once during frame decoding to pass
+     * the data needed for hardware render.
+     * In that mode instead of pixel data, AVFrame points to
+     * a structure specific to the acceleration API. The application
+     * reads the structure and can change some fields to indicate progress
+     * or mark state.
+     * - encoding: unused
+     * - decoding: Set by user.
+     * @param height the height of the slice
+     * @param y the y position of the slice
+     * @param type 1->top field, 2->bottom field, 3->frame
+     * @param offset offset into the AVFrame.data from which the slice should be read
+     */
+    void (*draw_horiz_band)(struct AVCodecContext *s,
+                            const AVFrame *src, int offset[4],
+                            int y, int type, int height);
+
+    /* audio only */
+    int sample_rate; ///< samples per second
+    int channels;    ///< number of audio channels
+
+    /**
+     * audio sample format
+     * - encoding: Set by user.
+     * - decoding: Set by libavcodec.
+     */
+    enum SampleFormat sample_fmt;  ///< sample format, currently unused
+
+    /* The following data should not be initialized. */
+    /**
+     * Samples per packet, initialized when calling 'init'.
+     */
+    int frame_size;
+    int frame_number;   ///< audio or video frame number
+    int real_pict_num;  ///< Returns the real picture number of previous encoded frame.
+
+    /**
+     * Number of frames the decoded output will be delayed relative to
+     * the encoded input.
+     * - encoding: Set by libavcodec.
+     * - decoding: unused
+     */
+    int delay;
+
+    /* - encoding parameters */
+    float qcompress;  ///< amount of qscale change between easy & hard scenes (0.0-1.0)
+    float qblur;      ///< amount of qscale smoothing over time (0.0-1.0)
+
+    /**
+     * minimum quantizer
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int qmin;
+
+    /**
+     * maximum quantizer
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int qmax;
+
+    /**
+     * maximum quantizer difference between frames
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int max_qdiff;
+
+    /**
+     * maximum number of B-frames between non-B-frames
+     * Note: The output will be delayed by max_b_frames+1 relative to the input.
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int max_b_frames;
+
+    /**
+     * qscale factor between IP and B-frames
+     * If > 0 then the last P-frame quantizer will be used (q= lastp_q*factor+offset).
+     * If < 0 then normal ratecontrol will be done (q= -normal_q*factor+offset).
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    float b_quant_factor;
+
+    /** obsolete FIXME remove */
+    int rc_strategy;
+#define FF_RC_STRATEGY_XVID 1
+
+    int b_frame_strategy;
+
+    /**
+     * hurry up amount
+     * - encoding: unused
+     * - decoding: Set by user. 1-> Skip B-frames, 2-> Skip IDCT/dequant too, 5-> Skip everything except header
+     * @deprecated Deprecated in favor of skip_idct and skip_frame.
+     */
+    int hurry_up;
+
+    struct AVCodec *codec;
+
+    void *priv_data;
+
+    int rtp_payload_size;   /* The size of the RTP payload: the coder will  */
+                            /* do its best to deliver a chunk with size     */
+                            /* below rtp_payload_size, the chunk will start */
+                            /* with a start code on some codecs like H.263. */
+                            /* This doesn't take account of any particular  */
+                            /* headers inside the transmitted RTP payload.  */
+
+
+    /* The RTP callback: This function is called    */
+    /* every time the encoder has a packet to send. */
+    /* It depends on the encoder if the data starts */
+    /* with a Start Code (it should). H.263 does.   */
+    /* mb_nb contains the number of macroblocks     */
+    /* encoded in the RTP payload.                  */
+    void (*rtp_callback)(struct AVCodecContext *avctx, void *data, int size, int mb_nb);
+
+    /* statistics, used for 2-pass encoding */
+    int mv_bits;
+    int header_bits;
+    int i_tex_bits;
+    int p_tex_bits;
+    int i_count;
+    int p_count;
+    int skip_count;
+    int misc_bits;
+
+    /**
+     * number of bits used for the previously encoded frame
+     * - encoding: Set by libavcodec.
+     * - decoding: unused
+     */
+    int frame_bits;
+
+    /**
+     * Private data of the user, can be used to carry app specific stuff.
+     * - encoding: Set by user.
+     * - decoding: Set by user.
+     */
+    void *opaque;
+
+    char codec_name[32];
+    enum CodecType codec_type; /* see CODEC_TYPE_xxx */
+    enum CodecID codec_id; /* see CODEC_ID_xxx */
+
+    /**
+     * fourcc (LSB first, so "ABCD" -> ('D'<<24) + ('C'<<16) + ('B'<<8) + 'A').
+     * This is used to work around some encoder bugs.
+     * A demuxer should set this to what is stored in the field used to identify the codec.
+     * If there are multiple such fields in a container then the demuxer should choose the one
+     * which maximizes the information about the used codec.
+     * If the codec tag field in a container is larger then 32 bits then the demuxer should
+     * remap the longer ID to 32 bits with a table or other structure. Alternatively a new
+     * extra_codec_tag + size could be added but for this a clear advantage must be demonstrated
+     * first.
+     * - encoding: Set by user, if not then the default based on codec_id will be used.
+     * - decoding: Set by user, will be converted to uppercase by libavcodec during init.
+     */
+    unsigned int codec_tag;
+
+    /**
+     * Work around bugs in encoders which sometimes cannot be detected automatically.
+     * - encoding: Set by user
+     * - decoding: Set by user
+     */
+    int workaround_bugs;
+#define FF_BUG_AUTODETECT       1  ///< autodetection
+#define FF_BUG_OLD_MSMPEG4      2
+#define FF_BUG_XVID_ILACE       4
+#define FF_BUG_UMP4             8
+#define FF_BUG_NO_PADDING       16
+#define FF_BUG_AMV              32
+#define FF_BUG_AC_VLC           0  ///< Will be removed, libavcodec can now handle these non-compliant files by default.
+#define FF_BUG_QPEL_CHROMA      64
+#define FF_BUG_STD_QPEL         128
+#define FF_BUG_QPEL_CHROMA2     256
+#define FF_BUG_DIRECT_BLOCKSIZE 512
+#define FF_BUG_EDGE             1024
+#define FF_BUG_HPEL_CHROMA      2048
+#define FF_BUG_DC_CLIP          4096
+#define FF_BUG_MS               8192 ///< Work around various bugs in Microsoft's broken decoders.
+//#define FF_BUG_FAKE_SCALABILITY 16 //Autodetection should work 100%.
+
+    /**
+     * luma single coefficient elimination threshold
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int luma_elim_threshold;
+
+    /**
+     * chroma single coeff elimination threshold
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int chroma_elim_threshold;
+
+    /**
+     * strictly follow the standard (MPEG4, ...).
+     * - encoding: Set by user.
+     * - decoding: Set by user.
+     * Setting this to STRICT or higher means the encoder and decoder will
+     * generally do stupid things. While setting it to inofficial or lower
+     * will mean the encoder might use things that are not supported by all
+     * spec compliant decoders. Decoders make no difference between normal,
+     * inofficial and experimental, that is they always try to decode things
+     * when they can unless they are explicitly asked to behave stupid
+     * (=strictly conform to the specs)
+     */
+    int strict_std_compliance;
+#define FF_COMPLIANCE_VERY_STRICT   2 ///< Strictly conform to a older more strict version of the spec or reference software.
+#define FF_COMPLIANCE_STRICT        1 ///< Strictly conform to all the things in the spec no matter what consequences.
+#define FF_COMPLIANCE_NORMAL        0
+#define FF_COMPLIANCE_INOFFICIAL   -1 ///< Allow inofficial extensions.
+#define FF_COMPLIANCE_EXPERIMENTAL -2 ///< Allow nonstandardized experimental things.
+
+    /**
+     * qscale offset between IP and B-frames
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    float b_quant_offset;
+
+    /**
+     * Error recognization; higher values will detect more errors but may
+     * misdetect some more or less valid parts as errors.
+     * - encoding: unused
+     * - decoding: Set by user.
+     */
+    int error_recognition;
+#define FF_ER_CAREFUL         1
+#define FF_ER_COMPLIANT       2
+#define FF_ER_AGGRESSIVE      3
+#define FF_ER_VERY_AGGRESSIVE 4
+
+    /**
+     * Called at the beginning of each frame to get a buffer for it.
+     * If pic.reference is set then the frame will be read later by libavcodec.
+     * avcodec_align_dimensions() should be used to find the required width and
+     * height, as they normally need to be rounded up to the next multiple of 16.
+     * - encoding: unused
+     * - decoding: Set by libavcodec., user can override.
+     */
+    int (*get_buffer)(struct AVCodecContext *c, AVFrame *pic);
+
+    /**
+     * Called to release buffers which were allocated with get_buffer.
+     * A released buffer can be reused in get_buffer().
+     * pic.data[*] must be set to NULL.
+     * - encoding: unused
+     * - decoding: Set by libavcodec., user can override.
+     */
+    void (*release_buffer)(struct AVCodecContext *c, AVFrame *pic);
+
+    /**
+     * Size of the frame reordering buffer in the decoder.
+     * For MPEG-2 it is 1 IPB or 0 low delay IP.
+     * - encoding: Set by libavcodec.
+     * - decoding: Set by libavcodec.
+     */
+    int has_b_frames;
+
+    /**
+     * number of bytes per packet if constant and known or 0
+     * Used by some WAV based audio codecs.
+     */
+    int block_align;
+
+    int parse_only; /* - decoding only: If true, only parsing is done
+                       (function avcodec_parse_frame()). The frame
+                       data is returned. Only MPEG codecs support this now. */
+
+    /**
+     * 0-> h263 quant 1-> mpeg quant
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int mpeg_quant;
+
+    /**
+     * pass1 encoding statistics output buffer
+     * - encoding: Set by libavcodec.
+     * - decoding: unused
+     */
+    char *stats_out;
+
+    /**
+     * pass2 encoding statistics input buffer
+     * Concatenated stuff from stats_out of pass1 should be placed here.
+     * - encoding: Allocated/set/freed by user.
+     * - decoding: unused
+     */
+    char *stats_in;
+
+    /**
+     * ratecontrol qmin qmax limiting method
+     * 0-> clipping, 1-> use a nice continous function to limit qscale wthin qmin/qmax.
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    float rc_qsquish;
+
+    float rc_qmod_amp;
+    int rc_qmod_freq;
+
+    /**
+     * ratecontrol override, see RcOverride
+     * - encoding: Allocated/set/freed by user.
+     * - decoding: unused
+     */
+    RcOverride *rc_override;
+    int rc_override_count;
+
+    /**
+     * rate control equation
+     * - encoding: Set by user
+     * - decoding: unused
+     */
+    const char *rc_eq;
+
+    /**
+     * maximum bitrate
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int rc_max_rate;
+
+    /**
+     * minimum bitrate
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int rc_min_rate;
+
+    /**
+     * decoder bitstream buffer size
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int rc_buffer_size;
+    float rc_buffer_aggressivity;
+
+    /**
+     * qscale factor between P and I-frames
+     * If > 0 then the last p frame quantizer will be used (q= lastp_q*factor+offset).
+     * If < 0 then normal ratecontrol will be done (q= -normal_q*factor+offset).
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    float i_quant_factor;
+
+    /**
+     * qscale offset between P and I-frames
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    float i_quant_offset;
+
+    /**
+     * initial complexity for pass1 ratecontrol
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    float rc_initial_cplx;
+
+    /**
+     * DCT algorithm, see FF_DCT_* below
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int dct_algo;
+#define FF_DCT_AUTO    0
+#define FF_DCT_FASTINT 1
+#define FF_DCT_INT     2
+#define FF_DCT_MMX     3
+#define FF_DCT_MLIB    4
+#define FF_DCT_ALTIVEC 5
+#define FF_DCT_FAAN    6
+
+    /**
+     * luminance masking (0-> disabled)
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    float lumi_masking;
+
+    /**
+     * temporary complexity masking (0-> disabled)
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    float temporal_cplx_masking;
+
+    /**
+     * spatial complexity masking (0-> disabled)
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    float spatial_cplx_masking;
+
+    /**
+     * p block masking (0-> disabled)
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    float p_masking;
+
+    /**
+     * darkness masking (0-> disabled)
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    float dark_masking;
+
+    /**
+     * IDCT algorithm, see FF_IDCT_* below.
+     * - encoding: Set by user.
+     * - decoding: Set by user.
+     */
+    int idct_algo;
+#define FF_IDCT_AUTO          0
+#define FF_IDCT_INT           1
+#define FF_IDCT_SIMPLE        2
+#define FF_IDCT_SIMPLEMMX     3
+#define FF_IDCT_LIBMPEG2MMX   4
+#define FF_IDCT_PS2           5
+#define FF_IDCT_MLIB          6
+#define FF_IDCT_ARM           7
+#define FF_IDCT_ALTIVEC       8
+#define FF_IDCT_SH4           9
+#define FF_IDCT_SIMPLEARM     10
+#define FF_IDCT_H264          11
+#define FF_IDCT_VP3           12
+#define FF_IDCT_IPP           13
+#define FF_IDCT_XVIDMMX       14
+#define FF_IDCT_CAVS          15
+#define FF_IDCT_SIMPLEARMV5TE 16
+#define FF_IDCT_SIMPLEARMV6   17
+#define FF_IDCT_SIMPLEVIS     18
+#define FF_IDCT_WMV2          19
+#define FF_IDCT_FAAN          20
+#define FF_IDCT_EA            21
+#define FF_IDCT_SIMPLENEON    22
+#define FF_IDCT_SIMPLEALPHA   23
+
+    /**
+     * slice count
+     * - encoding: Set by libavcodec.
+     * - decoding: Set by user (or 0).
+     */
+    int slice_count;
+    /**
+     * slice offsets in the frame in bytes
+     * - encoding: Set/allocated by libavcodec.
+     * - decoding: Set/allocated by user (or NULL).
+     */
+    int *slice_offset;
+
+    /**
+     * error concealment flags
+     * - encoding: unused
+     * - decoding: Set by user.
+     */
+    int error_concealment;
+#define FF_EC_GUESS_MVS   1
+#define FF_EC_DEBLOCK     2
+
+    /**
+     * dsp_mask could be add used to disable unwanted CPU features
+     * CPU features (i.e. MMX, SSE. ...)
+     *
+     * With the FORCE flag you may instead enable given CPU features.
+     * (Dangerous: Usable in case of misdetection, improper usage however will
+     * result into program crash.)
+     */
+    unsigned dsp_mask;
+#define FF_MM_FORCE    0x80000000 /* Force usage of selected flags (OR) */
+    /* lower 16 bits - CPU features */
+#define FF_MM_MMX      0x0001 ///< standard MMX
+#define FF_MM_3DNOW    0x0004 ///< AMD 3DNOW
+#if LIBAVCODEC_VERSION_MAJOR < 53
+#define FF_MM_MMXEXT   0x0002 ///< SSE integer functions or AMD MMX ext
+#endif
+#define FF_MM_MMX2     0x0002 ///< SSE integer functions or AMD MMX ext
+#define FF_MM_SSE      0x0008 ///< SSE functions
+#define FF_MM_SSE2     0x0010 ///< PIV SSE2 functions
+#define FF_MM_3DNOWEXT 0x0020 ///< AMD 3DNowExt
+#define FF_MM_SSE3     0x0040 ///< Prescott SSE3 functions
+#define FF_MM_SSSE3    0x0080 ///< Conroe SSSE3 functions
+#define FF_MM_SSE4     0x0100 ///< Penryn SSE4.1 functions
+#define FF_MM_SSE42    0x0200 ///< Nehalem SSE4.2 functions
+#define FF_MM_IWMMXT   0x0100 ///< XScale IWMMXT
+#define FF_MM_ALTIVEC  0x0001 ///< standard AltiVec
+
+    /**
+     * bits per sample/pixel from the demuxer (needed for huffyuv).
+     * - encoding: Set by libavcodec.
+     * - decoding: Set by user.
+     */
+     int bits_per_coded_sample;
+
+    /**
+     * prediction method (needed for huffyuv)
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+     int prediction_method;
+#define FF_PRED_LEFT   0
+#define FF_PRED_PLANE  1
+#define FF_PRED_MEDIAN 2
+
+    /**
+     * sample aspect ratio (0 if unknown)
+     * That is the width of a pixel divided by the height of the pixel.
+     * Numerator and denominator must be relatively prime and smaller than 256 for some video standards.
+     * - encoding: Set by user.
+     * - decoding: Set by libavcodec.
+     */
+    AVRational sample_aspect_ratio;
+
+    /**
+     * the picture in the bitstream
+     * - encoding: Set by libavcodec.
+     * - decoding: Set by libavcodec.
+     */
+    AVFrame *coded_frame;
+
+    /**
+     * debug
+     * - encoding: Set by user.
+     * - decoding: Set by user.
+     */
+    int debug;
+#define FF_DEBUG_PICT_INFO   1
+#define FF_DEBUG_RC          2
+#define FF_DEBUG_BITSTREAM   4
+#define FF_DEBUG_MB_TYPE     8
+#define FF_DEBUG_QP          16
+#define FF_DEBUG_MV          32
+#define FF_DEBUG_DCT_COEFF   0x00000040
+#define FF_DEBUG_SKIP        0x00000080
+#define FF_DEBUG_STARTCODE   0x00000100
+#define FF_DEBUG_PTS         0x00000200
+#define FF_DEBUG_ER          0x00000400
+#define FF_DEBUG_MMCO        0x00000800
+#define FF_DEBUG_BUGS        0x00001000
+#define FF_DEBUG_VIS_QP      0x00002000
+#define FF_DEBUG_VIS_MB_TYPE 0x00004000
+#define FF_DEBUG_BUFFERS     0x00008000
+
+    /**
+     * debug
+     * - encoding: Set by user.
+     * - decoding: Set by user.
+     */
+    int debug_mv;
+#define FF_DEBUG_VIS_MV_P_FOR  0x00000001 //visualize forward predicted MVs of P frames
+#define FF_DEBUG_VIS_MV_B_FOR  0x00000002 //visualize forward predicted MVs of B frames
+#define FF_DEBUG_VIS_MV_B_BACK 0x00000004 //visualize backward predicted MVs of B frames
+
+    /**
+     * error
+     * - encoding: Set by libavcodec if flags&CODEC_FLAG_PSNR.
+     * - decoding: unused
+     */
+    uint64_t error[4];
+
+    /**
+     * minimum MB quantizer
+     * - encoding: unused
+     * - decoding: unused
+     */
+    int mb_qmin;
+
+    /**
+     * maximum MB quantizer
+     * - encoding: unused
+     * - decoding: unused
+     */
+    int mb_qmax;
+
+    /**
+     * motion estimation comparison function
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int me_cmp;
+    /**
+     * subpixel motion estimation comparison function
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int me_sub_cmp;
+    /**
+     * macroblock comparison function (not supported yet)
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int mb_cmp;
+    /**
+     * interlaced DCT comparison function
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int ildct_cmp;
+#define FF_CMP_SAD    0
+#define FF_CMP_SSE    1
+#define FF_CMP_SATD   2
+#define FF_CMP_DCT    3
+#define FF_CMP_PSNR   4
+#define FF_CMP_BIT    5
+#define FF_CMP_RD     6
+#define FF_CMP_ZERO   7
+#define FF_CMP_VSAD   8
+#define FF_CMP_VSSE   9
+#define FF_CMP_NSSE   10
+#define FF_CMP_W53    11
+#define FF_CMP_W97    12
+#define FF_CMP_DCTMAX 13
+#define FF_CMP_DCT264 14
+#define FF_CMP_CHROMA 256
+
+    /**
+     * ME diamond size & shape
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int dia_size;
+
+    /**
+     * amount of previous MV predictors (2a+1 x 2a+1 square)
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int last_predictor_count;
+
+    /**
+     * prepass for motion estimation
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int pre_me;
+
+    /**
+     * motion estimation prepass comparison function
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int me_pre_cmp;
+
+    /**
+     * ME prepass diamond size & shape
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int pre_dia_size;
+
+    /**
+     * subpel ME quality
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int me_subpel_quality;
+
+    /**
+     * callback to negotiate the pixelFormat
+     * @param fmt is the list of formats which are supported by the codec,
+     * it is terminated by -1 as 0 is a valid format, the formats are ordered by quality.
+     * The first is always the native one.
+     * @return the chosen format
+     * - encoding: unused
+     * - decoding: Set by user, if not set the native format will be chosen.
+     */
+    enum PixelFormat (*get_format)(struct AVCodecContext *s, const enum PixelFormat * fmt);
+
+    /**
+     * DTG active format information (additional aspect ratio
+     * information only used in DVB MPEG-2 transport streams)
+     * 0 if not set.
+     *
+     * - encoding: unused
+     * - decoding: Set by decoder.
+     */
+    int dtg_active_format;
+#define FF_DTG_AFD_SAME         8
+#define FF_DTG_AFD_4_3          9
+#define FF_DTG_AFD_16_9         10
+#define FF_DTG_AFD_14_9         11
+#define FF_DTG_AFD_4_3_SP_14_9  13
+#define FF_DTG_AFD_16_9_SP_14_9 14
+#define FF_DTG_AFD_SP_4_3       15
+
+    /**
+     * maximum motion estimation search range in subpel units
+     * If 0 then no limit.
+     *
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int me_range;
+
+    /**
+     * intra quantizer bias
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int intra_quant_bias;
+#define FF_DEFAULT_QUANT_BIAS 999999
+
+    /**
+     * inter quantizer bias
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int inter_quant_bias;
+
+    /**
+     * color table ID
+     * - encoding: unused
+     * - decoding: Which clrtable should be used for 8bit RGB images.
+     *             Tables have to be stored somewhere. FIXME
+     */
+    int color_table_id;
+
+    /**
+     * internal_buffer count
+     * Don't touch, used by libavcodec default_get_buffer().
+     */
+    int internal_buffer_count;
+
+    /**
+     * internal_buffers
+     * Don't touch, used by libavcodec default_get_buffer().
+     */
+    void *internal_buffer;
+
+#define FF_LAMBDA_SHIFT 7
+#define FF_LAMBDA_SCALE (1<<FF_LAMBDA_SHIFT)
+#define FF_QP2LAMBDA 118 ///< factor to convert from H.263 QP to lambda
+#define FF_LAMBDA_MAX (256*128-1)
+
+#define FF_QUALITY_SCALE FF_LAMBDA_SCALE //FIXME maybe remove
+    /**
+     * Global quality for codecs which cannot change it per frame.
+     * This should be proportional to MPEG-1/2/4 qscale.
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int global_quality;
+
+#define FF_CODER_TYPE_VLC       0
+#define FF_CODER_TYPE_AC        1
+#define FF_CODER_TYPE_RAW       2
+#define FF_CODER_TYPE_RLE       3
+#define FF_CODER_TYPE_DEFLATE   4
+    /**
+     * coder type
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int coder_type;
+
+    /**
+     * context model
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int context_model;
+#if 0
+    /**
+     *
+     * - encoding: unused
+     * - decoding: Set by user.
+     */
+    uint8_t * (*realloc)(struct AVCodecContext *s, uint8_t *buf, int buf_size);
+#endif
+
+    /**
+     * slice flags
+     * - encoding: unused
+     * - decoding: Set by user.
+     */
+    int slice_flags;
+#define SLICE_FLAG_CODED_ORDER    0x0001 ///< draw_horiz_band() is called in coded order instead of display
+#define SLICE_FLAG_ALLOW_FIELD    0x0002 ///< allow draw_horiz_band() with field slices (MPEG2 field pics)
+#define SLICE_FLAG_ALLOW_PLANE    0x0004 ///< allow draw_horiz_band() with 1 component at a time (SVQ1)
+
+    /**
+     * XVideo Motion Acceleration
+     * - encoding: forbidden
+     * - decoding: set by decoder
+     */
+    int xvmc_acceleration;
+
+    /**
+     * macroblock decision mode
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int mb_decision;
+#define FF_MB_DECISION_SIMPLE 0        ///< uses mb_cmp
+#define FF_MB_DECISION_BITS   1        ///< chooses the one which needs the fewest bits
+#define FF_MB_DECISION_RD     2        ///< rate distortion
+
+    /**
+     * custom intra quantization matrix
+     * - encoding: Set by user, can be NULL.
+     * - decoding: Set by libavcodec.
+     */
+    uint16_t *intra_matrix;
+
+    /**
+     * custom inter quantization matrix
+     * - encoding: Set by user, can be NULL.
+     * - decoding: Set by libavcodec.
+     */
+    uint16_t *inter_matrix;
+
+    /**
+     * fourcc from the AVI stream header (LSB first, so "ABCD" -> ('D'<<24) + ('C'<<16) + ('B'<<8) + 'A').
+     * This is used to work around some encoder bugs.
+     * - encoding: unused
+     * - decoding: Set by user, will be converted to uppercase by libavcodec during init.
+     */
+    unsigned int stream_codec_tag;
+
+    /**
+     * scene change detection threshold
+     * 0 is default, larger means fewer detected scene changes.
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int scenechange_threshold;
+
+    /**
+     * minimum Lagrange multipler
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int lmin;
+
+    /**
+     * maximum Lagrange multipler
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int lmax;
+
+    /**
+     * palette control structure
+     * - encoding: ??? (no palette-enabled encoder yet)
+     * - decoding: Set by user.
+     */
+    struct AVPaletteControl *palctrl;
+
+    /**
+     * noise reduction strength
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int noise_reduction;
+
+    /**
+     * Called at the beginning of a frame to get cr buffer for it.
+     * Buffer type (size, hints) must be the same. libavcodec won't check it.
+     * libavcodec will pass previous buffer in pic, function should return
+     * same buffer or new buffer with old frame "painted" into it.
+     * If pic.data[0] == NULL must behave like get_buffer().
+     * - encoding: unused
+     * - decoding: Set by libavcodec., user can override
+     */
+    int (*reget_buffer)(struct AVCodecContext *c, AVFrame *pic);
+
+    /**
+     * Number of bits which should be loaded into the rc buffer before decoding starts.
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int rc_initial_buffer_occupancy;
+
+    /**
+     *
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int inter_threshold;
+
+    /**
+     * CODEC_FLAG2_*
+     * - encoding: Set by user.
+     * - decoding: Set by user.
+     */
+    int flags2;
+
+    /**
+     * Simulates errors in the bitstream to test error concealment.
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int error_rate;
+
+    /**
+     * MP3 antialias algorithm, see FF_AA_* below.
+     * - encoding: unused
+     * - decoding: Set by user.
+     */
+    int antialias_algo;
+#define FF_AA_AUTO    0
+#define FF_AA_FASTINT 1 //not implemented yet
+#define FF_AA_INT     2
+#define FF_AA_FLOAT   3
+    /**
+     * quantizer noise shaping
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int quantizer_noise_shaping;
+
+    /**
+     * thread count
+     * is used to decide how many independent tasks should be passed to execute()
+     * - encoding: Set by user.
+     * - decoding: Set by user.
+     */
+    int thread_count;
+
+    /**
+     * The codec may call this to execute several independent things.
+     * It will return only after finishing all tasks.
+     * The user may replace this with some multithreaded implementation,
+     * the default implementation will execute the parts serially.
+     * @param count the number of things to execute
+     * - encoding: Set by libavcodec, user can override.
+     * - decoding: Set by libavcodec, user can override.
+     */
+    int (*execute)(struct AVCodecContext *c, int (*func)(struct AVCodecContext *c2, void *arg), void *arg2, int *ret, int count, int size);
+
+    /**
+     * thread opaque
+     * Can be used by execute() to store some per AVCodecContext stuff.
+     * - encoding: set by execute()
+     * - decoding: set by execute()
+     */
+    void *thread_opaque;
+
+    /**
+     * Motion estimation threshold below which no motion estimation is
+     * performed, but instead the user specified motion vectors are used.
+     *
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+     int me_threshold;
+
+    /**
+     * Macroblock threshold below which the user specified macroblock types will be used.
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+     int mb_threshold;
+
+    /**
+     * precision of the intra DC coefficient - 8
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+     int intra_dc_precision;
+
+    /**
+     * noise vs. sse weight for the nsse comparsion function
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+     int nsse_weight;
+
+    /**
+     * Number of macroblock rows at the top which are skipped.
+     * - encoding: unused
+     * - decoding: Set by user.
+     */
+     int skip_top;
+
+    /**
+     * Number of macroblock rows at the bottom which are skipped.
+     * - encoding: unused
+     * - decoding: Set by user.
+     */
+     int skip_bottom;
+
+    /**
+     * profile
+     * - encoding: Set by user.
+     * - decoding: Set by libavcodec.
+     */
+     int profile;
+#define FF_PROFILE_UNKNOWN -99
+#define FF_PROFILE_AAC_MAIN 0
+#define FF_PROFILE_AAC_LOW  1
+#define FF_PROFILE_AAC_SSR  2
+#define FF_PROFILE_AAC_LTP  3
+
+    /**
+     * level
+     * - encoding: Set by user.
+     * - decoding: Set by libavcodec.
+     */
+     int level;
+#define FF_LEVEL_UNKNOWN -99
+
+    /**
+     * low resolution decoding, 1-> 1/2 size, 2->1/4 size
+     * - encoding: unused
+     * - decoding: Set by user.
+     */
+     int lowres;
+
+    /**
+     * Bitstream width / height, may be different from width/height if lowres
+     * or other things are used.
+     * - encoding: unused
+     * - decoding: Set by user before init if known. Codec should override / dynamically change if needed.
+     */
+    int coded_width, coded_height;
+
+    /**
+     * frame skip threshold
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int frame_skip_threshold;
+
+    /**
+     * frame skip factor
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int frame_skip_factor;
+
+    /**
+     * frame skip exponent
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int frame_skip_exp;
+
+    /**
+     * frame skip comparison function
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int frame_skip_cmp;
+
+    /**
+     * Border processing masking, raises the quantizer for mbs on the borders
+     * of the picture.
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    float border_masking;
+
+    /**
+     * minimum MB lagrange multipler
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int mb_lmin;
+
+    /**
+     * maximum MB lagrange multipler
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int mb_lmax;
+
+    /**
+     *
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int me_penalty_compensation;
+
+    /**
+     *
+     * - encoding: unused
+     * - decoding: Set by user.
+     */
+    enum AVDiscard skip_loop_filter;
+
+    /**
+     *
+     * - encoding: unused
+     * - decoding: Set by user.
+     */
+    enum AVDiscard skip_idct;
+
+    /**
+     *
+     * - encoding: unused
+     * - decoding: Set by user.
+     */
+    enum AVDiscard skip_frame;
+
+    /**
+     *
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int bidir_refine;
+
+    /**
+     *
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int brd_scale;
+
+    /**
+     * constant rate factor - quality-based VBR - values ~correspond to qps
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    float crf;
+
+    /**
+     * constant quantization parameter rate control method
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int cqp;
+
+    /**
+     * minimum GOP size
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int keyint_min;
+
+    /**
+     * number of reference frames
+     * - encoding: Set by user.
+     * - decoding: Set by lavc.
+     */
+    int refs;
+
+    /**
+     * chroma qp offset from luma
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int chromaoffset;
+
+    /**
+     * Influences how often B-frames are used.
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int bframebias;
+
+    /**
+     * trellis RD quantization
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int trellis;
+
+    /**
+     * Reduce fluctuations in qp (before curve compression).
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    float complexityblur;
+
+    /**
+     * in-loop deblocking filter alphac0 parameter
+     * alpha is in the range -6...6
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int deblockalpha;
+
+    /**
+     * in-loop deblocking filter beta parameter
+     * beta is in the range -6...6
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int deblockbeta;
+
+    /**
+     * macroblock subpartition sizes to consider - p8x8, p4x4, b8x8, i8x8, i4x4
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int partitions;
+#define X264_PART_I4X4 0x001  /* Analyze i4x4 */
+#define X264_PART_I8X8 0x002  /* Analyze i8x8 (requires 8x8 transform) */
+#define X264_PART_P8X8 0x010  /* Analyze p16x8, p8x16 and p8x8 */
+#define X264_PART_P4X4 0x020  /* Analyze p8x4, p4x8, p4x4 */
+#define X264_PART_B8X8 0x100  /* Analyze b16x8, b8x16 and b8x8 */
+
+    /**
+     * direct MV prediction mode - 0 (none), 1 (spatial), 2 (temporal), 3 (auto)
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int directpred;
+
+    /**
+     * Audio cutoff bandwidth (0 means "automatic")
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int cutoff;
+
+    /**
+     * Multiplied by qscale for each frame and added to scene_change_score.
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int scenechange_factor;
+
+    /**
+     *
+     * Note: Value depends upon the compare function used for fullpel ME.
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int mv0_threshold;
+
+    /**
+     * Adjusts sensitivity of b_frame_strategy 1.
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int b_sensitivity;
+
+    /**
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int compression_level;
+#define FF_COMPRESSION_DEFAULT -1
+
+    /**
+     * Sets whether to use LPC mode - used by FLAC encoder.
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int use_lpc;
+
+    /**
+     * LPC coefficient precision - used by FLAC encoder
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int lpc_coeff_precision;
+
+    /**
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int min_prediction_order;
+
+    /**
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int max_prediction_order;
+
+    /**
+     * search method for selecting prediction order
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int prediction_order_method;
+
+    /**
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int min_partition_order;
+
+    /**
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int max_partition_order;
+
+    /**
+     * GOP timecode frame start number, in non drop frame format
+     * - encoding: Set by user.
+     * - decoding: unused
+     */
+    int64_t timecode_frame_start;
+
+#if LIBAVCODEC_VERSION_MAJOR < 53
+    /**
+     * Decoder should decode to this many channels if it can (0 for default)
+     * - encoding: unused
+     * - decoding: Set by user.
+     * @deprecated Deprecated in favor of request_channel_layout.
+     */
+    int request_channels;
+#endif
+
+    /**
+     * Percentage of dynamic range compression to be applied by the decoder.
+     * The default value is 1.0, corresponding to full compression.
+     * - encoding: unused
+     * - decoding: Set by user.
+     */
+    float drc_scale;
+
+    /**
+     * opaque 64bit number (generally a PTS) that will be reordered and
+     * output in AVFrame.reordered_opaque
+     * - encoding: unused
+     * - decoding: Set by user.
+     */
+    int64_t reordered_opaque;
+
+    /**
+     * Bits per sample/pixel of internal libavcodec pixel/sample format.
+     * This field is applicable only when sample_fmt is SAMPLE_FMT_S32.
+     * - encoding: set by user.
+     * - decoding: set by libavcodec.
+     */
+    int bits_per_raw_sample;
+
+    /**
+     * Audio channel layout.
+     * - encoding: set by user.
+     * - decoding: set by libavcodec.
+     */
+    int64_t channel_layout;
+
+    /**
+     * Request decoder to use this channel layout if it can (0 for default)
+     * - encoding: unused
+     * - decoding: Set by user.
+     */
+    int64_t request_channel_layout;
+
+    /**
+     * Ratecontrol attempt to use, at maximum, <value> of what can be used without an underflow.
+     * - encoding: Set by user.
+     * - decoding: unused.
+     */
+    float rc_max_available_vbv_use;
+
+    /**
+     * Ratecontrol attempt to use, at least, <value> times the amount needed to prevent a vbv overflow.
+     * - encoding: Set by user.
+     * - decoding: unused.
+     */
+    float rc_min_vbv_overflow_use;
+
+    /**
+     * Hardware accelerator in use
+     * - encoding: unused.
+     * - decoding: Set by libavcodec
+     */
+    struct AVHWAccel *hwaccel;
+
+    /**
+     * For some codecs, the time base is closer to the field rate than the frame rate.
+     * Most notably, H.264 and MPEG-2 specify time_base as half of frame duration
+     * if no telecine is used ...
+     *
+     * Set to time_base ticks per frame. Default 1, e.g., H.264/MPEG-2 set it to 2.
+     */
+    int ticks_per_frame;
+
+    /**
+     * Hardware accelerator context.
+     * For some hardware accelerators, a global context needs to be
+     * provided by the user. In that case, this holds display-dependent
+     * data FFmpeg cannot instantiate itself. Please refer to the
+     * FFmpeg HW accelerator documentation to know how to fill this
+     * is. e.g. for VA API, this is a struct vaapi_context.
+     * - encoding: unused
+     * - decoding: Set by user
+     */
+    void *hwaccel_context;
+} AVCodecContext;
+
+/**
+ * AVCodec.
+ */
+typedef struct AVCodec {
+    /**
+     * Name of the codec implementation.
+     * The name is globally unique among encoders and among decoders (but an
+     * encoder and a decoder can share the same name).
+     * This is the primary way to find a codec from the user perspective.
+     */
+    const char *name;
+    enum CodecType type;
+    enum CodecID id;
+    int priv_data_size;
+    int (*init)(AVCodecContext *);
+    int (*encode)(AVCodecContext *, uint8_t *buf, int buf_size, void *data);
+    int (*close)(AVCodecContext *);
+    int (*decode)(AVCodecContext *, void *outdata, int *outdata_size, AVPacket *avpkt);
+    /**
+     * Codec capabilities.
+     * see CODEC_CAP_*
+     */
+    int capabilities;
+    struct AVCodec *next;
+    /**
+     * Flush buffers.
+     * Will be called when seeking
+     */
+    void (*flush)(AVCodecContext *);
+    const AVRational *supported_framerates; ///< array of supported framerates, or NULL if any, array is terminated by {0,0}
+    const enum PixelFormat *pix_fmts;       ///< array of supported pixel formats, or NULL if unknown, array is terminated by -1
+    /**
+     * Descriptive name for the codec, meant to be more human readable than \p name.
+     * You \e should use the NULL_IF_CONFIG_SMALL() macro to define it.
+     */
+    const char *long_name;
+    const int *supported_samplerates;       ///< array of supported audio samplerates, or NULL if unknown, array is terminated by 0
+    const enum SampleFormat *sample_fmts;   ///< array of supported sample formats, or NULL if unknown, array is terminated by -1
+    const int64_t *channel_layouts;         ///< array of support channel layouts, or NULL if unknown. array is terminated by 0
+} AVCodec;
+
+/**
+ * AVHWAccel.
+ */
+typedef struct AVHWAccel {
+    /**
+     * Name of the hardware accelerated codec.
+     * The name is globally unique among encoders and among decoders (but an
+     * encoder and a decoder can share the same name).
+     */
+    const char *name;
+
+    /**
+     * Type of codec implemented by the hardware accelerator.
+     *
+     * See CODEC_TYPE_xxx
+     */
+    enum CodecType type;
+
+    /**
+     * Codec implemented by the hardware accelerator.
+     *
+     * See CODEC_ID_xxx
+     */
+    enum CodecID id;
+
+    /**
+     * Supported pixel format.
+     *
+     * Only hardware accelerated formats are supported here.
+     */
+    enum PixelFormat pix_fmt;
+
+    /**
+     * Hardware accelerated codec capabilities.
+     * see FF_HWACCEL_CODEC_CAP_*
+     */
+    int capabilities;
+
+    struct AVHWAccel *next;
+
+    /**
+     * Called at the beginning of each frame or field picture.
+     *
+     * Meaningful frame information (codec specific) is guaranteed to
+     * be parsed at this point. This function is mandatory.
+     *
+     * Note that \p buf can be NULL along with \p buf_size set to 0.
+     * Otherwise, this means the whole frame is available at this point.
+     *
+     * @param avctx the codec context
+     * @param buf the frame data buffer base
+     * @param buf_size the size of the frame in bytes
+     * @return zero if successful, a negative value otherwise
+     */
+    int (*start_frame)(AVCodecContext *avctx, const uint8_t *buf, uint32_t buf_size);
+
+    /**
+     * Callback for each slice.
+     *
+     * Meaningful slice information (codec specific) is guaranteed to
+     * be parsed at this point. This function is mandatory.
+     *
+     * @param avctx the codec context
+     * @param buf the slice data buffer base
+     * @param buf_size the size of the slice in bytes
+     * @return zero if successful, a negative value otherwise
+     */
+    int (*decode_slice)(AVCodecContext *avctx, const uint8_t *buf, uint32_t buf_size);
+
+    /**
+     * Called at the end of each frame or field picture.
+     *
+     * The whole picture is parsed at this point and can now be sent
+     * to the hardware accelerator. This function is mandatory.
+     *
+     * @param avctx the codec context
+     * @return zero if successful, a negative value otherwise
+     */
+    int (*end_frame)(AVCodecContext *avctx);
+
+    /**
+     * Size of HW accelerator private data.
+     *
+     * Private data is allocated with av_mallocz() before
+     * AVCodecContext.get_buffer() and deallocated after
+     * AVCodecContext.release_buffer().
+     */
+    int priv_data_size;
+} AVHWAccel;
+
+/**
+ * four components are given, that's all.
+ * the last component is alpha
+ */
+typedef struct AVPicture {
+    uint8_t *data[4];
+    int linesize[4];       ///< number of bytes per line
+} AVPicture;
+
+#if LIBAVCODEC_VERSION_MAJOR < 53
+/**
+ * AVPaletteControl
+ * This structure defines a method for communicating palette changes
+ * between and demuxer and a decoder.
+ *
+ * @deprecated Use AVPacket to send palette changes instead.
+ * This is totally broken.
+ */
+#define AVPALETTE_SIZE 1024
+#define AVPALETTE_COUNT 256
+typedef struct AVPaletteControl {
+
+    /* Demuxer sets this to 1 to indicate the palette has changed;
+     * decoder resets to 0. */
+    int palette_changed;
+
+    /* 4-byte ARGB palette entries, stored in native byte order; note that
+     * the individual palette components should be on a 8-bit scale; if
+     * the palette data comes from an IBM VGA native format, the component
+     * data is probably 6 bits in size and needs to be scaled. */
+    unsigned int palette[AVPALETTE_COUNT];
+
+} AVPaletteControl attribute_deprecated;
+#endif
+
+enum AVSubtitleType {
+    SUBTITLE_NONE,
+
+    SUBTITLE_BITMAP,                ///< A bitmap, pict will be set
+
+    /**
+     * Plain text, the text field must be set by the decoder and is
+     * authoritative. ass and pict fields may contain approximations.
+     */
+    SUBTITLE_TEXT,
+
+    /**
+     * Formatted text, the ass field must be set by the decoder and is
+     * authoritative. pict and text fields may contain approximations.
+     */
+    SUBTITLE_ASS,
+};
+
+typedef struct AVSubtitleRect {
+    int x;         ///< top left corner  of pict, undefined when pict is not set
+    int y;         ///< top left corner  of pict, undefined when pict is not set
+    int w;         ///< width            of pict, undefined when pict is not set
+    int h;         ///< height           of pict, undefined when pict is not set
+    int nb_colors; ///< number of colors in pict, undefined when pict is not set
+
+    /**
+     * data+linesize for the bitmap of this subtitle.
+     * can be set for text/ass as well once they where rendered
+     */
+    AVPicture pict;
+    enum AVSubtitleType type;
+
+    char *text;                     ///< 0 terminated plain UTF-8 text
+
+    /**
+     * 0 terminated ASS/SSA compatible event line.
+     * The pressentation of this is unaffected by the other values in this
+     * struct.
+     */
+    char *ass;
+} AVSubtitleRect;
+
+typedef struct AVSubtitle {
+    uint16_t format; /* 0 = graphics */
+    uint32_t start_display_time; /* relative to packet pts, in ms */
+    uint32_t end_display_time; /* relative to packet pts, in ms */
+    unsigned num_rects;
+    AVSubtitleRect **rects;
+} AVSubtitle;
+
+/* packet functions */
+
+/**
+ * @deprecated use NULL instead
+ */
+attribute_deprecated void av_destruct_packet_nofree(AVPacket *pkt);
+
+/**
+ * Default packet destructor.
+ */
+void av_destruct_packet(AVPacket *pkt);
+
+/**
+ * Initialize optional fields of a packet with default values.
+ *
+ * @param pkt packet
+ */
+void av_init_packet(AVPacket *pkt);
+
+/**
+ * Allocate the payload of a packet and initialize its fields with
+ * default values.
+ *
+ * @param pkt packet
+ * @param size wanted payload size
+ * @return 0 if OK, AVERROR_xxx otherwise
+ */
+int av_new_packet(AVPacket *pkt, int size);
+
+/**
+ * Reduce packet size, correctly zeroing padding
+ *
+ * @param pkt packet
+ * @param size new size
+ */
+void av_shrink_packet(AVPacket *pkt, int size);
+
+/**
+ * @warning This is a hack - the packet memory allocation stuff is broken. The
+ * packet is allocated if it was not really allocated.
+ */
+int av_dup_packet(AVPacket *pkt);
+
+/**
+ * Free a packet.
+ *
+ * @param pkt packet to free
+ */
+void av_free_packet(AVPacket *pkt);
+
+/* resample.c */
+
+struct ReSampleContext;
+struct AVResampleContext;
+
+typedef struct ReSampleContext ReSampleContext;
+
+#if LIBAVCODEC_VERSION_MAJOR < 53
+/**
+ * @deprecated Use av_audio_resample_init() instead.
+ */
+attribute_deprecated ReSampleContext *audio_resample_init(int output_channels, int input_channels,
+                                                          int output_rate, int input_rate);
+#endif
+/**
+ *  Initializes audio resampling context
+ *
+ * @param output_channels  number of output channels
+ * @param input_channels   number of input channels
+ * @param output_rate      output sample rate
+ * @param input_rate       input sample rate
+ * @param sample_fmt_out   requested output sample format
+ * @param sample_fmt_in    input sample format
+ * @param filter_length    length of each FIR filter in the filterbank relative to the cutoff freq
+ * @param log2_phase_count log2 of the number of entries in the polyphase filterbank
+ * @param linear           If 1 then the used FIR filter will be linearly interpolated
+                           between the 2 closest, if 0 the closest will be used
+ * @param cutoff           cutoff frequency, 1.0 corresponds to half the output sampling rate
+ * @return allocated ReSampleContext, NULL if error occured
+ */
+ReSampleContext *av_audio_resample_init(int output_channels, int input_channels,
+                                        int output_rate, int input_rate,
+                                        enum SampleFormat sample_fmt_out,
+                                        enum SampleFormat sample_fmt_in,
+                                        int filter_length, int log2_phase_count,
+                                        int linear, double cutoff);
+
+int audio_resample(ReSampleContext *s, short *output, short *input, int nb_samples);
+void audio_resample_close(ReSampleContext *s);
+
+
+/**
+ * Initializes an audio resampler.
+ * Note, if either rate is not an integer then simply scale both rates up so they are.
+ * @param filter_length length of each FIR filter in the filterbank relative to the cutoff freq
+ * @param log2_phase_count log2 of the number of entries in the polyphase filterbank
+ * @param linear If 1 then the used FIR filter will be linearly interpolated
+                 between the 2 closest, if 0 the closest will be used
+ * @param cutoff cutoff frequency, 1.0 corresponds to half the output sampling rate
+ */
+struct AVResampleContext *av_resample_init(int out_rate, int in_rate, int filter_length, int log2_phase_count, int linear, double cutoff);
+
+/**
+ * resamples.
+ * @param src an array of unconsumed samples
+ * @param consumed the number of samples of src which have been consumed are returned here
+ * @param src_size the number of unconsumed samples available
+ * @param dst_size the amount of space in samples available in dst
+ * @param update_ctx If this is 0 then the context will not be modified, that way several channels can be resampled with the same context.
+ * @return the number of samples written in dst or -1 if an error occurred
+ */
+int av_resample(struct AVResampleContext *c, short *dst, short *src, int *consumed, int src_size, int dst_size, int update_ctx);
+
+
+/**
+ * Compensates samplerate/timestamp drift. The compensation is done by changing
+ * the resampler parameters, so no audible clicks or similar distortions occur
+ * @param compensation_distance distance in output samples over which the compensation should be performed
+ * @param sample_delta number of output samples which should be output less
+ *
+ * example: av_resample_compensate(c, 10, 500)
+ * here instead of 510 samples only 500 samples would be output
+ *
+ * note, due to rounding the actual compensation might be slightly different,
+ * especially if the compensation_distance is large and the in_rate used during init is small
+ */
+void av_resample_compensate(struct AVResampleContext *c, int sample_delta, int compensation_distance);
+void av_resample_close(struct AVResampleContext *c);
+
+/**
+ * Allocate memory for a picture.  Call avpicture_free to free it.
+ *
+ * @param picture the picture to be filled in
+ * @param pix_fmt the format of the picture
+ * @param width the width of the picture
+ * @param height the height of the picture
+ * @return zero if successful, a negative value if not
+ */
+int avpicture_alloc(AVPicture *picture, enum PixelFormat pix_fmt, int width, int height);
+
+/**
+ * Free a picture previously allocated by avpicture_alloc().
+ *
+ * @param picture the AVPicture to be freed
+ */
+void avpicture_free(AVPicture *picture);
+
+/**
+ * Fill in the AVPicture fields.
+ * The fields of the given AVPicture are filled in by using the 'ptr' address
+ * which points to the image data buffer. Depending on the specified picture
+ * format, one or multiple image data pointers and line sizes will be set.
+ * If a planar format is specified, several pointers will be set pointing to
+ * the different picture planes and the line sizes of the different planes
+ * will be stored in the lines_sizes array.
+ * Call with ptr == NULL to get the required size for the ptr buffer.
+ *
+ * @param picture AVPicture whose fields are to be filled in
+ * @param ptr Buffer which will contain or contains the actual image data
+ * @param pix_fmt The format in which the picture data is stored.
+ * @param width the width of the image in pixels
+ * @param height the height of the image in pixels
+ * @return size of the image data in bytes
+ */
+int avpicture_fill(AVPicture *picture, uint8_t *ptr,
+                   int pix_fmt, int width, int height);
+int avpicture_layout(const AVPicture* src, enum PixelFormat pix_fmt, int width, int height,
+                     unsigned char *dest, int dest_size);
+
+/**
+ * Calculate the size in bytes that a picture of the given width and height
+ * would occupy if stored in the given picture format.
+ * Note that this returns the size of a compact representation as generated
+ * by avpicture_layout, which can be smaller than the size required for e.g.
+ * avpicture_fill.
+ *
+ * @param pix_fmt the given picture format
+ * @param width the width of the image
+ * @param height the height of the image
+ * @return Image data size in bytes or -1 on error (e.g. too large dimensions).
+ */
+int avpicture_get_size(enum PixelFormat pix_fmt, int width, int height);
+void avcodec_get_chroma_sub_sample(enum PixelFormat pix_fmt, int *h_shift, int *v_shift);
+const char *avcodec_get_pix_fmt_name(enum PixelFormat pix_fmt);
+void avcodec_set_dimensions(AVCodecContext *s, int width, int height);
+
+/**
+ * Returns the pixel format corresponding to the name \p name.
+ *
+ * If there is no pixel format with name \p name, then looks for a
+ * pixel format with the name corresponding to the native endian
+ * format of \p name.
+ * For example in a little-endian system, first looks for "gray16",
+ * then for "gray16le".
+ *
+ * Finally if no pixel format has been found, returns \c PIX_FMT_NONE.
+ */
+enum PixelFormat avcodec_get_pix_fmt(const char* name);
+unsigned int avcodec_pix_fmt_to_codec_tag(enum PixelFormat p);
+
+#define FF_LOSS_RESOLUTION  0x0001 /**< loss due to resolution change */
+#define FF_LOSS_DEPTH       0x0002 /**< loss due to color depth change */
+#define FF_LOSS_COLORSPACE  0x0004 /**< loss due to color space conversion */
+#define FF_LOSS_ALPHA       0x0008 /**< loss of alpha bits */
+#define FF_LOSS_COLORQUANT  0x0010 /**< loss due to color quantization */
+#define FF_LOSS_CHROMA      0x0020 /**< loss of chroma (e.g. RGB to gray conversion) */
+
+/**
+ * Computes what kind of losses will occur when converting from one specific
+ * pixel format to another.
+ * When converting from one pixel format to another, information loss may occur.
+ * For example, when converting from RGB24 to GRAY, the color information will
+ * be lost. Similarly, other losses occur when converting from some formats to
+ * other formats. These losses can involve loss of chroma, but also loss of
+ * resolution, loss of color depth, loss due to the color space conversion, loss
+ * of the alpha bits or loss due to color quantization.
+ * avcodec_get_fix_fmt_loss() informs you about the various types of losses
+ * which will occur when converting from one pixel format to another.
+ *
+ * @param[in] dst_pix_fmt destination pixel format
+ * @param[in] src_pix_fmt source pixel format
+ * @param[in] has_alpha Whether the source pixel format alpha channel is used.
+ * @return Combination of flags informing you what kind of losses will occur.
+ */
+int avcodec_get_pix_fmt_loss(enum PixelFormat dst_pix_fmt, enum PixelFormat src_pix_fmt,
+                             int has_alpha);
+
+/**
+ * Finds the best pixel format to convert to given a certain source pixel
+ * format.  When converting from one pixel format to another, information loss
+ * may occur.  For example, when converting from RGB24 to GRAY, the color
+ * information will be lost. Similarly, other losses occur when converting from
+ * some formats to other formats. avcodec_find_best_pix_fmt() searches which of
+ * the given pixel formats should be used to suffer the least amount of loss.
+ * The pixel formats from which it chooses one, are determined by the
+ * \p pix_fmt_mask parameter.
+ *
+ * @code
+ * src_pix_fmt = PIX_FMT_YUV420P;
+ * pix_fmt_mask = (1 << PIX_FMT_YUV422P) || (1 << PIX_FMT_RGB24);
+ * dst_pix_fmt = avcodec_find_best_pix_fmt(pix_fmt_mask, src_pix_fmt, alpha, &loss);
+ * @endcode
+ *
+ * @param[in] pix_fmt_mask bitmask determining which pixel format to choose from
+ * @param[in] src_pix_fmt source pixel format
+ * @param[in] has_alpha Whether the source pixel format alpha channel is used.
+ * @param[out] loss_ptr Combination of flags informing you what kind of losses will occur.
+ * @return The best pixel format to convert to or -1 if none was found.
+ */
+enum PixelFormat avcodec_find_best_pix_fmt(int64_t pix_fmt_mask, enum PixelFormat src_pix_fmt,
+                              int has_alpha, int *loss_ptr);
+
+
+/**
+ * Print in buf the string corresponding to the pixel format with
+ * number pix_fmt, or an header if pix_fmt is negative.
+ *
+ * @param[in] buf the buffer where to write the string
+ * @param[in] buf_size the size of buf
+ * @param[in] pix_fmt the number of the pixel format to print the corresponding info string, or
+ * a negative value to print the corresponding header.
+ * Meaningful values for obtaining a pixel format info vary from 0 to PIX_FMT_NB -1.
+ */
+void avcodec_pix_fmt_string (char *buf, int buf_size, enum PixelFormat pix_fmt);
+
+#define FF_ALPHA_TRANSP       0x0001 /* image has some totally transparent pixels */
+#define FF_ALPHA_SEMI_TRANSP  0x0002 /* image has some transparent pixels */
+
+/**
+ * Tell if an image really has transparent alpha values.
+ * @return ored mask of FF_ALPHA_xxx constants
+ */
+int img_get_alpha_info(const AVPicture *src,
+                       enum PixelFormat pix_fmt, int width, int height);
+
+/* deinterlace a picture */
+/* deinterlace - if not supported return -1 */
+int avpicture_deinterlace(AVPicture *dst, const AVPicture *src,
+                          enum PixelFormat pix_fmt, int width, int height);
+
+/* external high level API */
+
+/**
+ * If c is NULL, returns the first registered codec,
+ * if c is non-NULL, returns the next registered codec after c,
+ * or NULL if c is the last one.
+ */
+AVCodec *av_codec_next(AVCodec *c);
+
+/**
+ * Returns the LIBAVCODEC_VERSION_INT constant.
+ */
+unsigned avcodec_version(void);
+
+/**
+ * Initializes libavcodec.
+ *
+ * @warning This function \e must be called before any other libavcodec
+ * function.
+ */
+void avcodec_init(void);
+
+#if LIBAVCODEC_VERSION_MAJOR < 53
+/**
+ * @deprecated Deprecated in favor of avcodec_register().
+ */
+attribute_deprecated void register_avcodec(AVCodec *codec);
+#endif
+
+/**
+ * Register the codec \p codec and initialize libavcodec.
+ *
+ * @see avcodec_init()
+ */
+void avcodec_register(AVCodec *codec);
+
+/**
+ * Finds a registered encoder with a matching codec ID.
+ *
+ * @param id CodecID of the requested encoder
+ * @return An encoder if one was found, NULL otherwise.
+ */
+AVCodec *avcodec_find_encoder(enum CodecID id);
+
+/**
+ * Finds a registered encoder with the specified name.
+ *
+ * @param name name of the requested encoder
+ * @return An encoder if one was found, NULL otherwise.
+ */
+AVCodec *avcodec_find_encoder_by_name(const char *name);
+
+/**
+ * Finds a registered decoder with a matching codec ID.
+ *
+ * @param id CodecID of the requested decoder
+ * @return A decoder if one was found, NULL otherwise.
+ */
+AVCodec *avcodec_find_decoder(enum CodecID id);
+
+/**
+ * Finds a registered decoder with the specified name.
+ *
+ * @param name name of the requested decoder
+ * @return A decoder if one was found, NULL otherwise.
+ */
+AVCodec *avcodec_find_decoder_by_name(const char *name);
+void avcodec_string(char *buf, int buf_size, AVCodecContext *enc, int encode);
+
+/**
+ * Sets the fields of the given AVCodecContext to default values.
+ *
+ * @param s The AVCodecContext of which the fields should be set to default values.
+ */
+void avcodec_get_context_defaults(AVCodecContext *s);
+
+/** THIS FUNCTION IS NOT YET PART OF THE PUBLIC API!
+ *  we WILL change its arguments and name a few times! */
+void avcodec_get_context_defaults2(AVCodecContext *s, enum CodecType);
+
+/**
+ * Allocates an AVCodecContext and sets its fields to default values.  The
+ * resulting struct can be deallocated by simply calling av_free().
+ *
+ * @return An AVCodecContext filled with default values or NULL on failure.
+ * @see avcodec_get_context_defaults
+ */
+AVCodecContext *avcodec_alloc_context(void);
+
+/** THIS FUNCTION IS NOT YET PART OF THE PUBLIC API!
+ *  we WILL change its arguments and name a few times! */
+AVCodecContext *avcodec_alloc_context2(enum CodecType);
+
+/**
+ * Sets the fields of the given AVFrame to default values.
+ *
+ * @param pic The AVFrame of which the fields should be set to default values.
+ */
+void avcodec_get_frame_defaults(AVFrame *pic);
+
+/**
+ * Allocates an AVFrame and sets its fields to default values.  The resulting
+ * struct can be deallocated by simply calling av_free().
+ *
+ * @return An AVFrame filled with default values or NULL on failure.
+ * @see avcodec_get_frame_defaults
+ */
+AVFrame *avcodec_alloc_frame(void);
+
+int avcodec_default_get_buffer(AVCodecContext *s, AVFrame *pic);
+void avcodec_default_release_buffer(AVCodecContext *s, AVFrame *pic);
+int avcodec_default_reget_buffer(AVCodecContext *s, AVFrame *pic);
+void avcodec_align_dimensions(AVCodecContext *s, int *width, int *height);
+
+/**
+ * Checks if the given dimension of a picture is valid, meaning that all
+ * bytes of the picture can be addressed with a signed int.
+ *
+ * @param[in] w Width of the picture.
+ * @param[in] h Height of the picture.
+ * @return Zero if valid, a negative value if invalid.
+ */
+int avcodec_check_dimensions(void *av_log_ctx, unsigned int w, unsigned int h);
+enum PixelFormat avcodec_default_get_format(struct AVCodecContext *s, const enum PixelFormat * fmt);
+
+int avcodec_thread_init(AVCodecContext *s, int thread_count);
+void avcodec_thread_free(AVCodecContext *s);
+int avcodec_thread_execute(AVCodecContext *s, int (*func)(AVCodecContext *c2, void *arg2),void *arg, int *ret, int count, int size);
+int avcodec_default_execute(AVCodecContext *c, int (*func)(AVCodecContext *c2, void *arg2),void *arg, int *ret, int count, int size);
+//FIXME func typedef
+
+/**
+ * Initializes the AVCodecContext to use the given AVCodec. Prior to using this
+ * function the context has to be allocated.
+ *
+ * The functions avcodec_find_decoder_by_name(), avcodec_find_encoder_by_name(),
+ * avcodec_find_decoder() and avcodec_find_encoder() provide an easy way for
+ * retrieving a codec.
+ *
+ * @warning This function is not thread safe!
+ *
+ * @code
+ * avcodec_register_all();
+ * codec = avcodec_find_decoder(CODEC_ID_H264);
+ * if (!codec)
+ *     exit(1);
+ *
+ * context = avcodec_alloc_context();
+ *
+ * if (avcodec_open(context, codec) < 0)
+ *     exit(1);
+ * @endcode
+ *
+ * @param avctx The context which will be set up to use the given codec.
+ * @param codec The codec to use within the context.
+ * @return zero on success, a negative value on error
+ * @see avcodec_alloc_context, avcodec_find_decoder, avcodec_find_encoder
+ */
+int avcodec_open(AVCodecContext *avctx, AVCodec *codec);
+
+#if LIBAVCODEC_VERSION_MAJOR < 53
+/**
+ * Decodes an audio frame from \p buf into \p samples.
+ * Wrapper function which calls avcodec_decode_audio3.
+ *
+ * @deprecated Use avcodec_decode_audio3 instead.
+ * @param avctx the codec context
+ * @param[out] samples the output buffer
+ * @param[in,out] frame_size_ptr the output buffer size in bytes
+ * @param[in] buf the input buffer
+ * @param[in] buf_size the input buffer size in bytes
+ * @return On error a negative value is returned, otherwise the number of bytes
+ * used or zero if no frame could be decompressed.
+ */
+attribute_deprecated int avcodec_decode_audio2(AVCodecContext *avctx, int16_t *samples,
+                         int *frame_size_ptr,
+                         const uint8_t *buf, int buf_size);
+#endif
+
+/**
+ * Decodes the audio frame of size avpkt->size from avpkt->data into samples.
+ * Some decoders may support multiple frames in a single AVPacket, such
+ * decoders would then just decode the first frame.
+ * If no frame
+ * could be decompressed, \p frame_size_ptr is zero. Otherwise, it is the
+ * decompressed frame size in \e bytes.
+ *
+ * @warning You \e must set \p frame_size_ptr to the allocated size of the
+ * output buffer before calling avcodec_decode_audio3().
+ *
+ * @warning The input buffer must be \c FF_INPUT_BUFFER_PADDING_SIZE larger than
+ * the actual read bytes because some optimized bitstream readers read 32 or 64
+ * bits at once and could read over the end.
+ *
+ * @warning The end of the input buffer \p avpkt->data should be set to 0 to ensure that
+ * no overreading happens for damaged MPEG streams.
+ *
+ * @note You might have to align the input buffer \p avpkt->data and output buffer \p
+ * samples. The alignment requirements depend on the CPU: On some CPUs it isn't
+ * necessary at all, on others it won't work at all if not aligned and on others
+ * it will work but it will have an impact on performance. In practice, the
+ * bitstream should have 4 byte alignment at minimum and all sample data should
+ * be 16 byte aligned unless the CPU doesn't need it (AltiVec and SSE do). If
+ * the linesize is not a multiple of 16 then there's no sense in aligning the
+ * start of the buffer to 16.
+ *
+ * @param avctx the codec context
+ * @param[out] samples the output buffer
+ * @param[in,out] frame_size_ptr the output buffer size in bytes
+ * @param[in] avpkt The input AVPacket containing the input buffer.
+ * @return On error a negative value is returned, otherwise the number of bytes
+ * used or zero if no frame could be decompressed.
+ */
+int avcodec_decode_audio3(AVCodecContext *avctx, int16_t *samples,
+                         int *frame_size_ptr,
+                         AVPacket *avpkt);
+
+#if LIBAVCODEC_VERSION_MAJOR < 53
+/**
+ * Decodes a video frame from \p buf into \p picture.
+ * Wrapper function which calls avcodec_decode_video2.
+ *
+ * @deprecated Use avcodec_decode_video2 instead.
+ * @param avctx the codec context
+ * @param[out] picture The AVFrame in which the decoded video frame will be stored.
+ * @param[in] buf the input buffer
+ * @param[in] buf_size the size of the input buffer in bytes
+ * @param[in,out] got_picture_ptr Zero if no frame could be decompressed, otherwise, it is nonzero.
+ * @return On error a negative value is returned, otherwise the number of bytes
+ * used or zero if no frame could be decompressed.
+ */
+attribute_deprecated int avcodec_decode_video(AVCodecContext *avctx, AVFrame *picture,
+                         int *got_picture_ptr,
+                         const uint8_t *buf, int buf_size);
+#endif
+
+/**
+ * Decodes the video frame of size avpkt->size from avpkt->data into picture.
+ * Some decoders may support multiple frames in a single AVPacket, such
+ * decoders would then just decode the first frame.
+ *
+ * @warning The input buffer must be \c FF_INPUT_BUFFER_PADDING_SIZE larger than
+ * the actual read bytes because some optimized bitstream readers read 32 or 64
+ * bits at once and could read over the end.
+ *
+ * @warning The end of the input buffer \p buf should be set to 0 to ensure that
+ * no overreading happens for damaged MPEG streams.
+ *
+ * @note You might have to align the input buffer \p avpkt->data and output buffer \p
+ * samples. The alignment requirements depend on the CPU: on some CPUs it isn't
+ * necessary at all, on others it won't work at all if not aligned and on others
+ * it will work but it will have an impact on performance. In practice, the
+ * bitstream should have 4 byte alignment at minimum and all sample data should
+ * be 16 byte aligned unless the CPU doesn't need it (AltiVec and SSE do). If
+ * the linesize is not a multiple of 16 then there's no sense in aligning the
+ * start of the buffer to 16.
+ *
+ * @note Some codecs have a delay between input and output, these need to be
+ * feeded with avpkt->data=NULL, avpkt->size=0 at the end to return the remaining frames.
+ *
+ * @param avctx the codec context
+ * @param[out] picture The AVFrame in which the decoded video frame will be stored.
+ * @param[in] avpkt The input AVpacket containing the input buffer.
+ * @param[in,out] got_picture_ptr Zero if no frame could be decompressed, otherwise, it is nonzero.
+ * @return On error a negative value is returned, otherwise the number of bytes
+ * used or zero if no frame could be decompressed.
+ */
+int avcodec_decode_video2(AVCodecContext *avctx, AVFrame *picture,
+                         int *got_picture_ptr,
+                         AVPacket *avpkt);
+
+#if LIBAVCODEC_VERSION_MAJOR < 53
+/* Decode a subtitle message. Return -1 if error, otherwise return the
+ * number of bytes used. If no subtitle could be decompressed,
+ * got_sub_ptr is zero. Otherwise, the subtitle is stored in *sub. */
+attribute_deprecated int avcodec_decode_subtitle(AVCodecContext *avctx, AVSubtitle *sub,
+                            int *got_sub_ptr,
+                            const uint8_t *buf, int buf_size);
+#endif
+
+/**
+ * Decodes a subtitle message.
+ * Returns a negative value on error, otherwise returns the number of bytes used.
+ * If no subtitle could be decompressed, \p got_sub_ptr is zero.
+ * Otherwise, the subtitle is stored in \p *sub.
+ *
+ * @param avctx the codec context
+ * @param[out] sub The AVSubtitle in which the decoded subtitle will be stored.
+ * @param[in,out] got_sub_ptr Zero if no subtitle could be decompressed, otherwise, it is nonzero.
+ * @param[in] avpkt The input AVPacket containing the input buffer.
+ */
+int avcodec_decode_subtitle2(AVCodecContext *avctx, AVSubtitle *sub,
+                            int *got_sub_ptr,
+                            AVPacket *avpkt);
+int avcodec_parse_frame(AVCodecContext *avctx, uint8_t **pdata,
+                        int *data_size_ptr,
+                        uint8_t *buf, int buf_size);
+
+/**
+ * Encodes an audio frame from \p samples into \p buf.
+ *
+ * @note The output buffer should be at least \c FF_MIN_BUFFER_SIZE bytes large.
+ * However, for PCM audio the user will know how much space is needed
+ * because it depends on the value passed in \p buf_size as described
+ * below. In that case a lower value can be used.
+ *
+ * @param avctx the codec context
+ * @param[out] buf the output buffer
+ * @param[in] buf_size the output buffer size
+ * @param[in] samples the input buffer containing the samples
+ * The number of samples read from this buffer is frame_size*channels,
+ * both of which are defined in \p avctx.
+ * For PCM audio the number of samples read from \p samples is equal to
+ * \p buf_size * input_sample_size / output_sample_size.
+ * @return On error a negative value is returned, on success zero or the number
+ * of bytes used to encode the data read from the input buffer.
+ */
+int avcodec_encode_audio(AVCodecContext *avctx, uint8_t *buf, int buf_size,
+                         const short *samples);
+
+/**
+ * Encodes a video frame from \p pict into \p buf.
+ * The input picture should be
+ * stored using a specific format, namely \c avctx.pix_fmt.
+ *
+ * @param avctx the codec context
+ * @param[out] buf the output buffer for the bitstream of encoded frame
+ * @param[in] buf_size the size of the output buffer in bytes
+ * @param[in] pict the input picture to encode
+ * @return On error a negative value is returned, on success zero or the number
+ * of bytes used from the output buffer.
+ */
+int avcodec_encode_video(AVCodecContext *avctx, uint8_t *buf, int buf_size,
+                         const AVFrame *pict);
+int avcodec_encode_subtitle(AVCodecContext *avctx, uint8_t *buf, int buf_size,
+                            const AVSubtitle *sub);
+
+int avcodec_close(AVCodecContext *avctx);
+
+/**
+ * Register all the codecs, parsers and bitstream filters which were enabled at
+ * configuration time. If you do not call this function you can select exactly
+ * which formats you want to support, by using the individual registration
+ * functions.
+ *
+ * @see avcodec_register
+ * @see av_register_codec_parser
+ * @see av_register_bitstream_filter
+ */
+void avcodec_register_all(void);
+
+/**
+ * Flush buffers, should be called when seeking or when switching to a different stream.
+ */
+void avcodec_flush_buffers(AVCodecContext *avctx);
+
+void avcodec_default_free_buffers(AVCodecContext *s);
+
+/* misc useful functions */
+
+/**
+ * Returns a single letter to describe the given picture type \p pict_type.
+ *
+ * @param[in] pict_type the picture type
+ * @return A single character representing the picture type.
+ */
+char av_get_pict_type_char(int pict_type);
+
+/**
+ * Returns codec bits per sample.
+ *
+ * @param[in] codec_id the codec
+ * @return Number of bits per sample or zero if unknown for the given codec.
+ */
+int av_get_bits_per_sample(enum CodecID codec_id);
+
+/**
+ * Returns sample format bits per sample.
+ *
+ * @param[in] sample_fmt the sample format
+ * @return Number of bits per sample or zero if unknown for the given sample format.
+ */
+int av_get_bits_per_sample_format(enum SampleFormat sample_fmt);
+
+/* frame parsing */
+typedef struct AVCodecParserContext {
+    void *priv_data;
+    struct AVCodecParser *parser;
+    int64_t frame_offset; /* offset of the current frame */
+    int64_t cur_offset; /* current offset
+                           (incremented by each av_parser_parse()) */
+    int64_t next_frame_offset; /* offset of the next frame */
+    /* video info */
+    int pict_type; /* XXX: Put it back in AVCodecContext. */
+    /**
+     * This field is used for proper frame duration computation in lavf.
+     * It signals, how much longer the frame duration of the current frame
+     * is compared to normal frame duration.
+     *
+     * frame_duration = (1 + repeat_pict) * time_base
+     *
+     * It is used by codecs like H.264 to display telecined material.
+     */
+    int repeat_pict; /* XXX: Put it back in AVCodecContext. */
+    int64_t pts;     /* pts of the current frame */
+    int64_t dts;     /* dts of the current frame */
+
+    /* private data */
+    int64_t last_pts;
+    int64_t last_dts;
+    int fetch_timestamp;
+
+#define AV_PARSER_PTS_NB 4
+    int cur_frame_start_index;
+    int64_t cur_frame_offset[AV_PARSER_PTS_NB];
+    int64_t cur_frame_pts[AV_PARSER_PTS_NB];
+    int64_t cur_frame_dts[AV_PARSER_PTS_NB];
+
+    int flags;
+#define PARSER_FLAG_COMPLETE_FRAMES           0x0001
+
+    int64_t offset;      ///< byte offset from starting packet start
+    int64_t cur_frame_end[AV_PARSER_PTS_NB];
+
+    /*!
+     * Set by parser to 1 for key frames and 0 for non-key frames.
+     * It is initialized to -1, so if the parser doesn't set this flag,
+     * old-style fallback using FF_I_TYPE picture type as key frames
+     * will be used.
+     */
+    int key_frame;
+
+    /**
+     * Time difference in stream time base units from the pts of this
+     * packet to the point at which the output from the decoder has converged
+     * independent from the availability of previous frames. That is, the
+     * frames are virtually identical no matter if decoding started from
+     * the very first frame or from this keyframe.
+     * Is AV_NOPTS_VALUE if unknown.
+     * This field is not the display duration of the current frame.
+     *
+     * The purpose of this field is to allow seeking in streams that have no
+     * keyframes in the conventional sense. It corresponds to the
+     * recovery point SEI in H.264 and match_time_delta in NUT. It is also
+     * essential for some types of subtitle streams to ensure that all
+     * subtitles are correctly displayed after seeking.
+     */
+    int64_t convergence_duration;
+
+    // Timestamp generation support:
+    /**
+     * Synchronization point for start of timestamp generation.
+     *
+     * Set to >0 for sync point, 0 for no sync point and <0 for undefined
+     * (default).
+     *
+     * For example, this corresponds to presence of H.264 buffering period
+     * SEI message.
+     */
+    int dts_sync_point;
+
+    /**
+     * Offset of the current timestamp against last timestamp sync point in
+     * units of AVCodecContext.time_base.
+     *
+     * Set to INT_MIN when dts_sync_point unused. Otherwise, it must
+     * contain a valid timestamp offset.
+     *
+     * Note that the timestamp of sync point has usually a nonzero
+     * dts_ref_dts_delta, which refers to the previous sync point. Offset of
+     * the next frame after timestamp sync point will be usually 1.
+     *
+     * For example, this corresponds to H.264 cpb_removal_delay.
+     */
+    int dts_ref_dts_delta;
+
+    /**
+     * Presentation delay of current frame in units of AVCodecContext.time_base.
+     *
+     * Set to INT_MIN when dts_sync_point unused. Otherwise, it must
+     * contain valid non-negative timestamp delta (presentation time of a frame
+     * must not lie in the past).
+     *
+     * This delay represents the difference between decoding and presentation
+     * time of the frame.
+     *
+     * For example, this corresponds to H.264 dpb_output_delay.
+     */
+    int pts_dts_delta;
+
+    /**
+     * Position of the packet in file.
+     *
+     * Analogous to cur_frame_pts/dts
+     */
+    int64_t cur_frame_pos[AV_PARSER_PTS_NB];
+
+    /**
+     * Byte position of currently parsed frame in stream.
+     */
+    int64_t pos;
+
+    /**
+     * Previous frame byte position.
+     */
+    int64_t last_pos;
+} AVCodecParserContext;
+
+typedef struct AVCodecParser {
+    int codec_ids[5]; /* several codec IDs are permitted */
+    int priv_data_size;
+    int (*parser_init)(AVCodecParserContext *s);
+    int (*parser_parse)(AVCodecParserContext *s,
+                        AVCodecContext *avctx,
+                        const uint8_t **poutbuf, int *poutbuf_size,
+                        const uint8_t *buf, int buf_size);
+    void (*parser_close)(AVCodecParserContext *s);
+    int (*split)(AVCodecContext *avctx, const uint8_t *buf, int buf_size);
+    struct AVCodecParser *next;
+} AVCodecParser;
+
+AVCodecParser *av_parser_next(AVCodecParser *c);
+
+void av_register_codec_parser(AVCodecParser *parser);
+AVCodecParserContext *av_parser_init(int codec_id);
+
+#if LIBAVCODEC_VERSION_MAJOR < 53
+attribute_deprecated
+int av_parser_parse(AVCodecParserContext *s,
+                    AVCodecContext *avctx,
+                    uint8_t **poutbuf, int *poutbuf_size,
+                    const uint8_t *buf, int buf_size,
+                    int64_t pts, int64_t dts);
+#endif
+
+/**
+ * Parse a packet.
+ *
+ * @param s             parser context.
+ * @param avctx         codec context.
+ * @param poutbuf       set to pointer to parsed buffer or NULL if not yet finished.
+ * @param poutbuf_size  set to size of parsed buffer or zero if not yet finished.
+ * @param buf           input buffer.
+ * @param buf_size      input length, to signal EOF, this should be 0 (so that the last frame can be output).
+ * @param pts           input presentation timestamp.
+ * @param dts           input decoding timestamp.
+ * @param pos           input byte position in stream.
+ * @return the number of bytes of the input bitstream used.
+ *
+ * Example:
+ * @code
+ *   while(in_len){
+ *       len = av_parser_parse2(myparser, AVCodecContext, &data, &size,
+ *                                        in_data, in_len,
+ *                                        pts, dts, pos);
+ *       in_data += len;
+ *       in_len  -= len;
+ *
+ *       if(size)
+ *          decode_frame(data, size);
+ *   }
+ * @endcode
+ */
+int av_parser_parse2(AVCodecParserContext *s,
+                     AVCodecContext *avctx,
+                     uint8_t **poutbuf, int *poutbuf_size,
+                     const uint8_t *buf, int buf_size,
+                     int64_t pts, int64_t dts,
+                     int64_t pos);
+
+int av_parser_change(AVCodecParserContext *s,
+                     AVCodecContext *avctx,
+                     uint8_t **poutbuf, int *poutbuf_size,
+                     const uint8_t *buf, int buf_size, int keyframe);
+void av_parser_close(AVCodecParserContext *s);
+
+
+typedef struct AVBitStreamFilterContext {
+    void *priv_data;
+    struct AVBitStreamFilter *filter;
+    AVCodecParserContext *parser;
+    struct AVBitStreamFilterContext *next;
+} AVBitStreamFilterContext;
+
+
+typedef struct AVBitStreamFilter {
+    const char *name;
+    int priv_data_size;
+    int (*filter)(AVBitStreamFilterContext *bsfc,
+                  AVCodecContext *avctx, const char *args,
+                  uint8_t **poutbuf, int *poutbuf_size,
+                  const uint8_t *buf, int buf_size, int keyframe);
+    void (*close)(AVBitStreamFilterContext *bsfc);
+    struct AVBitStreamFilter *next;
+} AVBitStreamFilter;
+
+void av_register_bitstream_filter(AVBitStreamFilter *bsf);
+AVBitStreamFilterContext *av_bitstream_filter_init(const char *name);
+int av_bitstream_filter_filter(AVBitStreamFilterContext *bsfc,
+                               AVCodecContext *avctx, const char *args,
+                               uint8_t **poutbuf, int *poutbuf_size,
+                               const uint8_t *buf, int buf_size, int keyframe);
+void av_bitstream_filter_close(AVBitStreamFilterContext *bsf);
+
+AVBitStreamFilter *av_bitstream_filter_next(AVBitStreamFilter *f);
+
+/* memory */
+
+/**
+ * Reallocates the given block if it is not large enough, otherwise it
+ * does nothing.
+ *
+ * @see av_realloc
+ */
+void *av_fast_realloc(void *ptr, unsigned int *size, unsigned int min_size);
+
+/**
+ * Allocates a buffer, reusing the given one if large enough.
+ *
+ * Contrary to av_fast_realloc the current buffer contents might not be
+ * preserved and on error the old buffer is freed, thus no special
+ * handling to avoid memleaks is necessary.
+ *
+ * @param ptr pointer to pointer to already allocated buffer, overwritten with pointer to new buffer
+ * @param size size of the buffer *ptr points to
+ * @param min_size minimum size of *ptr buffer after returning, *ptr will be NULL and
+ *                 *size 0 if an error occurred.
+ */
+void av_fast_malloc(void *ptr, unsigned int *size, unsigned int min_size);
+
+/**
+ * Copy image 'src' to 'dst'.
+ */
+void av_picture_copy(AVPicture *dst, const AVPicture *src,
+                     enum PixelFormat pix_fmt, int width, int height);
+
+/**
+ * Crop image top and left side.
+ */
+int av_picture_crop(AVPicture *dst, const AVPicture *src,
+                    enum PixelFormat pix_fmt, int top_band, int left_band);
+
+/**
+ * Pad image.
+ */
+int av_picture_pad(AVPicture *dst, const AVPicture *src, int height, int width, enum PixelFormat pix_fmt,
+            int padtop, int padbottom, int padleft, int padright, int *color);
+
+unsigned int av_xiphlacing(unsigned char *s, unsigned int v);
+
+/**
+ * Parses \p str and put in \p width_ptr and \p height_ptr the detected values.
+ *
+ * @return 0 in case of a successful parsing, a negative value otherwise
+ * @param[in] str the string to parse: it has to be a string in the format
+ * <width>x<height> or a valid video frame size abbreviation.
+ * @param[in,out] width_ptr pointer to the variable which will contain the detected
+ * frame width value
+ * @param[in,out] height_ptr pointer to the variable which will contain the detected
+ * frame height value
+ */
+int av_parse_video_frame_size(int *width_ptr, int *height_ptr, const char *str);
+
+/**
+ * Parses \p str and put in \p frame_rate the detected values.
+ *
+ * @return 0 in case of a successful parsing, a negative value otherwise
+ * @param[in] str the string to parse: it has to be a string in the format
+ * <frame_rate_num>/<frame_rate_den>, a float number or a valid video rate abbreviation
+ * @param[in,out] frame_rate pointer to the AVRational which will contain the detected
+ * frame rate
+ */
+int av_parse_video_frame_rate(AVRational *frame_rate, const char *str);
+
+/* error handling */
+#if EINVAL > 0
+#define AVERROR(e) (-(e)) /**< Returns a negative error code from a POSIX error code, to return from library functions. */
+#define AVUNERROR(e) (-(e)) /**< Returns a POSIX error code from a library function error return value. */
+#else
+/* Some platforms have E* and errno already negated. */
+#define AVERROR(e) (e)
+#define AVUNERROR(e) (e)
+#endif
+#define AVERROR_UNKNOWN     AVERROR(EINVAL)  /**< unknown error */
+#define AVERROR_IO          AVERROR(EIO)     /**< I/O error */
+#define AVERROR_NUMEXPECTED AVERROR(EDOM)    /**< Number syntax expected in filename. */
+#define AVERROR_INVALIDDATA AVERROR(EINVAL)  /**< invalid data found */
+#define AVERROR_NOMEM       AVERROR(ENOMEM)  /**< not enough memory */
+#define AVERROR_NOFMT       AVERROR(EILSEQ)  /**< unknown format */
+#define AVERROR_NOTSUPP     AVERROR(ENOSYS)  /**< Operation not supported. */
+#define AVERROR_NOENT       AVERROR(ENOENT)  /**< No such file or directory. */
+#define AVERROR_EOF         AVERROR(EPIPE)   /**< End of file. */
+#define AVERROR_PATCHWELCOME    -MKTAG('P','A','W','E') /**< Not yet implemented in FFmpeg. Patches welcome. */
+
+/**
+ * Registers the hardware accelerator \p hwaccel.
+ */
+void av_register_hwaccel(AVHWAccel *hwaccel);
+
+/**
+ * If hwaccel is NULL, returns the first registered hardware accelerator,
+ * if hwaccel is non-NULL, returns the next registered hardware accelerator
+ * after hwaccel, or NULL if hwaccel is the last one.
+ */
+AVHWAccel *av_hwaccel_next(AVHWAccel *hwaccel);
+
+#endif /* AVCODEC_AVCODEC_H */

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/CMakeLists.txt	2009-05-02 13:54:05 UTC (rev 4783)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/CMakeLists.txt	2009-05-02 13:54:07 UTC (rev 4784)
@@ -14,11 +14,11 @@
 lzo.c
 mathematics.c
 md5.c
-random.c
+#random.c
 rational.c
 rc4.c
 sha1.c
-string.c
+#string.c
 tree.c
 )
 

Deleted: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/common.mak.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/common.mak.patch	2009-05-02 13:54:05 UTC (rev 4783)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/common.mak.patch	2009-05-02 13:54:07 UTC (rev 4784)
@@ -1,13 +0,0 @@
-Index: common.mak
-===================================================================
---- common.mak	(revision 18300)
-+++ common.mak	(working copy)
-@@ -69,7 +69,7 @@
- OBJS      := $(addprefix $(SUBDIR),$(OBJS))
- TESTPROGS := $(addprefix $(SUBDIR),$(addsuffix -test$(EXESUF),$(TESTPROGS)))
- 
--DEP_LIBS := $(foreach NAME,$(FFLIBS),lib$(NAME)/$($(BUILD_SHARED:yes=S)LIBNAME))
-+DEP_LIBS := $(foreach NAME,$(FFLIBS),lib$(NAME)/ADM$($(BUILD_SHARED:yes=S)LIBNAME))
- 
- ALLHEADERS := $(subst $(SRC_DIR)/,$(SUBDIR),$(wildcard $(SRC_DIR)/*.h $(SRC_DIR)/$(ARCH)/*.h))
- checkheaders: $(filter-out %_template.ho,$(ALLHEADERS:.h=.ho))

Deleted: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavcodec_Makefile.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavcodec_Makefile.patch	2009-05-02 13:54:05 UTC (rev 4783)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavcodec_Makefile.patch	2009-05-02 13:54:07 UTC (rev 4784)
@@ -1,14 +0,0 @@
-Index: libavcodec/Makefile
-===================================================================
---- libavcodec/Makefile	(revision 18300)
-+++ libavcodec/Makefile	(working copy)
-@@ -1,7 +1,7 @@
- include $(SUBDIR)../config.mak
- 
--NAME = avcodec
--FFLIBS = avutil
-+NAME = ADMavcodec
-+FFLIBS = ADMavutil
- 
- HEADERS = avcodec.h opt.h vdpau.h xvmc.h
- 

Deleted: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavdevice_Makefile.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavdevice_Makefile.patch	2009-05-02 13:54:05 UTC (rev 4783)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavdevice_Makefile.patch	2009-05-02 13:54:07 UTC (rev 4784)
@@ -1,14 +0,0 @@
-Index: Makefile
-===================================================================
---- Makefile	(revision 18300)
-+++ Makefile	(working copy)
-@@ -1,7 +1,7 @@
- include $(SUBDIR)../config.mak
- 
--NAME    = avdevice
--FFLIBS  = avformat avcodec avutil
-+NAME    = ADMavdevice
-+FFLIBS  = ADMavformat ADMavcodec ADMavutil
- 
- HEADERS = avdevice.h
- 

Deleted: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavfilter_Makefile.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavfilter_Makefile.patch	2009-05-02 13:54:05 UTC (rev 4783)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavfilter_Makefile.patch	2009-05-02 13:54:07 UTC (rev 4784)
@@ -1,16 +0,0 @@
-Index: libavfilter/Makefile
-===================================================================
---- libavfilter/Makefile	(revision 18300)
-+++ libavfilter/Makefile	(working copy)
-@@ -1,8 +1,8 @@
- include $(SUBDIR)../config.mak
- 
--NAME = avfilter
--FFLIBS = avcodec avutil swscale
--FFLIBS-$(CONFIG_AVFILTER_LAVF) += avformat
-+NAME = ADMavfilter
-+FFLIBS = ADMavcodec ADMavutil ADMswscale
-+FFLIBS-$(CONFIG_AVFILTER_LAVF) += ADMavformat
- 
- HEADERS = avfilter.h
- 

Deleted: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavformat_Makefile.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavformat_Makefile.patch	2009-05-02 13:54:05 UTC (rev 4783)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavformat_Makefile.patch	2009-05-02 13:54:07 UTC (rev 4784)
@@ -1,14 +0,0 @@
-Index: libavformat/Makefile
-===================================================================
---- libavformat/Makefile	(revision 18300)
-+++ libavformat/Makefile	(working copy)
-@@ -1,7 +1,7 @@
- include $(SUBDIR)../config.mak
- 
--NAME = avformat
--FFLIBS = avcodec avutil
-+NAME = ADMavformat
-+FFLIBS = ADMavcodec ADMavutil
- 
- HEADERS = avformat.h avio.h
- 

Deleted: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavutil_Makefile.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavutil_Makefile.patch	2009-05-02 13:54:05 UTC (rev 4783)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavutil_Makefile.patch	2009-05-02 13:54:07 UTC (rev 4784)
@@ -1,12 +0,0 @@
-Index: libavutil/Makefile
-===================================================================
---- libavutil/Makefile	(revision 18300)
-+++ libavutil/Makefile	(working copy)
-@@ -1,6 +1,6 @@
- include $(SUBDIR)../config.mak
- 
--NAME = avutil
-+NAME = ADMavutil
- 
- HEADERS = adler32.h                                                     \
-           avstring.h                                                    \

Deleted: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libpostproc_Makefile.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libpostproc_Makefile.patch	2009-05-02 13:54:05 UTC (rev 4783)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libpostproc_Makefile.patch	2009-05-02 13:54:07 UTC (rev 4784)
@@ -1,14 +0,0 @@
-Index: Makefile
-===================================================================
---- Makefile	(revision 18300)
-+++ Makefile	(working copy)
-@@ -1,7 +1,7 @@
- include $(SUBDIR)../config.mak
- 
--NAME = postproc
--FFLIBS = avutil
-+NAME = ADMpostproc
-+FFLIBS = ADMavutil
- 
- HEADERS = postprocess.h
- 

Deleted: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libswscale_Makefile.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libswscale_Makefile.patch	2009-05-02 13:54:05 UTC (rev 4783)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libswscale_Makefile.patch	2009-05-02 13:54:07 UTC (rev 4784)
@@ -1,14 +0,0 @@
-Index: Makefile
-===================================================================
---- Makefile	(revision 29120)
-+++ Makefile	(working copy)
-@@ -1,7 +1,7 @@
- include $(SUBDIR)../config.mak
- 
--NAME = swscale
--FFLIBS = avutil
-+NAME = ADMswscale
-+FFLIBS = ADMavutil
- 
- HEADERS = swscale.h
- 

Modified: branches/avidemux_2.6_branch_mean/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/CMakeLists.txt	2009-05-02 13:54:05 UTC (rev 4783)
+++ branches/avidemux_2.6_branch_mean/avidemux/CMakeLists.txt	2009-05-02 13:54:07 UTC (rev 4784)
@@ -58,7 +58,7 @@
 INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/ADM_libraries/")
 INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/ADM_libraries/ADM_ffmpeg/libavutil")
 INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/ADM_libraries/ADM_ffmpeg/")
-INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/ADM_libraries/ADM_ffmpeg/ADM_lavcodec")
+INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/ADM_libraries/ADM_ffmpeg/libavcodec")
 INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/ADM_muxerGate/include/")
 
 IF (GETTEXT_FOUND)



From mean at mail.berlios.de  Sat May  2 15:54:10 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:54:10 +0200
Subject: [Avidemux-svn-commit] r4785 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg
Message-ID: <200905021354.n42DsAmB011000@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:54:10 +0200 (Sat, 02 May 2009)
New Revision: 4785

Added:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/dopatch.sh
Log:
[FFmpeg upgrade] Preparing set of patches

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/dopatch.sh
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/dopatch.sh	2009-05-02 13:54:07 UTC (rev 4784)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/dopatch.sh	2009-05-02 13:54:10 UTC (rev 4785)
@@ -0,0 +1,8 @@
+#
+
+for i in patches/*.patch ; do
+        echo $i
+        patch -p0 --dry-run < $i
+done
+
+



From mean at mail.berlios.de  Sat May  2 15:54:11 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:54:11 +0200
Subject: [Avidemux-svn-commit] r4786 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec
Message-ID: <200905021354.n42DsB1W011011@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:54:11 +0200 (Sat, 02 May 2009)
New Revision: 4786

Added:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/dsputil.h
Log:
[xx]

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/dsputil.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/dsputil.h	2009-05-02 13:54:10 UTC (rev 4785)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/dsputil.h	2009-05-02 13:54:11 UTC (rev 4786)
@@ -0,0 +1,912 @@
+/*
+ * DSP utils
+ * Copyright (c) 2000, 2001, 2002 Fabrice Bellard
+ * Copyright (c) 2002-2004 Michael Niedermayer <michaelni at gmx.at>
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
+/**
+ * @file libavcodec/dsputil.h
+ * DSP utils.
+ * note, many functions in here may use MMX which trashes the FPU state, it is
+ * absolutely necessary to call emms_c() between dsp & float/double code
+ */
+
+#ifndef AVCODEC_DSPUTIL_H
+#define AVCODEC_DSPUTIL_H
+
+#include "libavutil/intreadwrite.h"
+#include "avcodec.h"
+
+
+//#define DEBUG
+/* dct code */
+typedef short DCTELEM;
+typedef int DWTELEM;
+typedef short IDWTELEM;
+
+void fdct_ifast (DCTELEM *data);
+void fdct_ifast248 (DCTELEM *data);
+void ff_jpeg_fdct_islow (DCTELEM *data);
+void ff_fdct248_islow (DCTELEM *data);
+
+void j_rev_dct (DCTELEM *data);
+void j_rev_dct4 (DCTELEM *data);
+void j_rev_dct2 (DCTELEM *data);
+void j_rev_dct1 (DCTELEM *data);
+void ff_wmv2_idct_c(DCTELEM *data);
+
+void ff_fdct_mmx(DCTELEM *block);
+void ff_fdct_mmx2(DCTELEM *block);
+void ff_fdct_sse2(DCTELEM *block);
+
+void ff_h264_idct8_add_c(uint8_t *dst, DCTELEM *block, int stride);
+void ff_h264_idct_add_c(uint8_t *dst, DCTELEM *block, int stride);
+void ff_h264_idct8_dc_add_c(uint8_t *dst, DCTELEM *block, int stride);
+void ff_h264_idct_dc_add_c(uint8_t *dst, DCTELEM *block, int stride);
+void ff_h264_lowres_idct_add_c(uint8_t *dst, int stride, DCTELEM *block);
+void ff_h264_lowres_idct_put_c(uint8_t *dst, int stride, DCTELEM *block);
+void ff_h264_idct_add16_c(uint8_t *dst, const int *blockoffset, DCTELEM *block, int stride, const uint8_t nnzc[6*8]);
+void ff_h264_idct_add16intra_c(uint8_t *dst, const int *blockoffset, DCTELEM *block, int stride, const uint8_t nnzc[6*8]);
+void ff_h264_idct8_add4_c(uint8_t *dst, const int *blockoffset, DCTELEM *block, int stride, const uint8_t nnzc[6*8]);
+void ff_h264_idct_add8_c(uint8_t **dest, const int *blockoffset, DCTELEM *block, int stride, const uint8_t nnzc[6*8]);
+
+void ff_vector_fmul_add_add_c(float *dst, const float *src0, const float *src1,
+                              const float *src2, int src3, int blocksize, int step);
+void ff_vector_fmul_window_c(float *dst, const float *src0, const float *src1,
+                             const float *win, float add_bias, int len);
+void ff_float_to_int16_c(int16_t *dst, const float *src, long len);
+void ff_float_to_int16_interleave_c(int16_t *dst, const float **src, long len, int channels);
+
+/* encoding scans */
+extern const uint8_t ff_alternate_horizontal_scan[64];
+extern const uint8_t ff_alternate_vertical_scan[64];
+extern const uint8_t ff_zigzag_direct[64];
+extern const uint8_t ff_zigzag248_direct[64];
+
+/* pixel operations */
+#define MAX_NEG_CROP 1024
+
+/* temporary */
+extern uint32_t ff_squareTbl[512];
+extern uint8_t ff_cropTbl[256 + 2 * MAX_NEG_CROP];
+
+/* VP3 DSP functions */
+void ff_vp3_idct_c(DCTELEM *block/* align 16*/);
+void ff_vp3_idct_put_c(uint8_t *dest/*align 8*/, int line_size, DCTELEM *block/*align 16*/);
+void ff_vp3_idct_add_c(uint8_t *dest/*align 8*/, int line_size, DCTELEM *block/*align 16*/);
+
+void ff_vp3_v_loop_filter_c(uint8_t *src, int stride, int *bounding_values);
+void ff_vp3_h_loop_filter_c(uint8_t *src, int stride, int *bounding_values);
+
+/* VP6 DSP functions */
+void ff_vp6_filter_diag4_c(uint8_t *dst, uint8_t *src, int stride,
+                           const int16_t *h_weights, const int16_t *v_weights);
+
+/* 1/2^n downscaling functions from imgconvert.c */
+void ff_img_copy_plane(uint8_t *dst, int dst_wrap, const uint8_t *src, int src_wrap, int width, int height);
+void ff_shrink22(uint8_t *dst, int dst_wrap, const uint8_t *src, int src_wrap, int width, int height);
+void ff_shrink44(uint8_t *dst, int dst_wrap, const uint8_t *src, int src_wrap, int width, int height);
+void ff_shrink88(uint8_t *dst, int dst_wrap, const uint8_t *src, int src_wrap, int width, int height);
+
+void ff_gmc_c(uint8_t *dst, uint8_t *src, int stride, int h, int ox, int oy,
+              int dxx, int dxy, int dyx, int dyy, int shift, int r, int width, int height);
+
+/* minimum alignment rules ;)
+If you notice errors in the align stuff, need more alignment for some ASM code
+for some CPU or need to use a function with less aligned data then send a mail
+to the ffmpeg-devel mailing list, ...
+
+!warning These alignments might not match reality, (missing attribute((align))
+stuff somewhere possible).
+I (Michael) did not check them, these are just the alignments which I think
+could be reached easily ...
+
+!future video codecs might need functions with less strict alignment
+*/
+
+/*
+void get_pixels_c(DCTELEM *block, const uint8_t *pixels, int line_size);
+void diff_pixels_c(DCTELEM *block, const uint8_t *s1, const uint8_t *s2, int stride);
+void put_pixels_clamped_c(const DCTELEM *block, uint8_t *pixels, int line_size);
+void add_pixels_clamped_c(const DCTELEM *block, uint8_t *pixels, int line_size);
+void clear_blocks_c(DCTELEM *blocks);
+*/
+
+/* add and put pixel (decoding) */
+// blocksizes for op_pixels_func are 8x4,8x8 16x8 16x16
+//h for op_pixels_func is limited to {width/2, width} but never larger than 16 and never smaller then 4
+typedef void (*op_pixels_func)(uint8_t *block/*align width (8 or 16)*/, const uint8_t *pixels/*align 1*/, int line_size, int h);
+typedef void (*tpel_mc_func)(uint8_t *block/*align width (8 or 16)*/, const uint8_t *pixels/*align 1*/, int line_size, int w, int h);
+typedef void (*qpel_mc_func)(uint8_t *dst/*align width (8 or 16)*/, uint8_t *src/*align 1*/, int stride);
+typedef void (*h264_chroma_mc_func)(uint8_t *dst/*align 8*/, uint8_t *src/*align 1*/, int srcStride, int h, int x, int y);
+typedef void (*h264_weight_func)(uint8_t *block, int stride, int log2_denom, int weight, int offset);
+typedef void (*h264_biweight_func)(uint8_t *dst, uint8_t *src, int stride, int log2_denom, int weightd, int weights, int offset);
+
+#define DEF_OLD_QPEL(name)\
+void ff_put_        ## name (uint8_t *dst/*align width (8 or 16)*/, uint8_t *src/*align 1*/, int stride);\
+void ff_put_no_rnd_ ## name (uint8_t *dst/*align width (8 or 16)*/, uint8_t *src/*align 1*/, int stride);\
+void ff_avg_        ## name (uint8_t *dst/*align width (8 or 16)*/, uint8_t *src/*align 1*/, int stride);
+
+DEF_OLD_QPEL(qpel16_mc11_old_c)
+DEF_OLD_QPEL(qpel16_mc31_old_c)
+DEF_OLD_QPEL(qpel16_mc12_old_c)
+DEF_OLD_QPEL(qpel16_mc32_old_c)
+DEF_OLD_QPEL(qpel16_mc13_old_c)
+DEF_OLD_QPEL(qpel16_mc33_old_c)
+DEF_OLD_QPEL(qpel8_mc11_old_c)
+DEF_OLD_QPEL(qpel8_mc31_old_c)
+DEF_OLD_QPEL(qpel8_mc12_old_c)
+DEF_OLD_QPEL(qpel8_mc32_old_c)
+DEF_OLD_QPEL(qpel8_mc13_old_c)
+DEF_OLD_QPEL(qpel8_mc33_old_c)
+
+#define CALL_2X_PIXELS(a, b, n)\
+static void a(uint8_t *block, const uint8_t *pixels, int line_size, int h){\
+    b(block  , pixels  , line_size, h);\
+    b(block+n, pixels+n, line_size, h);\
+}
+
+/* motion estimation */
+// h is limited to {width/2, width, 2*width} but never larger than 16 and never smaller then 2
+// although currently h<4 is not used as functions with width <8 are neither used nor implemented
+typedef int (*me_cmp_func)(void /*MpegEncContext*/ *s, uint8_t *blk1/*align width (8 or 16)*/, uint8_t *blk2/*align 1*/, int line_size, int h)/* __attribute__ ((const))*/;
+
+
+// for snow slices
+typedef struct slice_buffer_s slice_buffer;
+
+/**
+ * Scantable.
+ */
+typedef struct ScanTable{
+    const uint8_t *scantable;
+    uint8_t permutated[64];
+    uint8_t raster_end[64];
+#if ARCH_PPC
+                /** Used by dct_quantize_altivec to find last-non-zero */
+    DECLARE_ALIGNED(16, uint8_t, inverse[64]);
+#endif
+} ScanTable;
+
+void ff_init_scantable(uint8_t *, ScanTable *st, const uint8_t *src_scantable);
+
+void ff_emulated_edge_mc(uint8_t *buf, uint8_t *src, int linesize,
+                         int block_w, int block_h,
+                         int src_x, int src_y, int w, int h);
+
+/**
+ * DSPContext.
+ */
+typedef struct DSPContext {
+    /* pixel ops : interface with DCT */
+    void (*get_pixels)(DCTELEM *block/*align 16*/, const uint8_t *pixels/*align 8*/, int line_size);
+    void (*diff_pixels)(DCTELEM *block/*align 16*/, const uint8_t *s1/*align 8*/, const uint8_t *s2/*align 8*/, int stride);
+    void (*put_pixels_clamped)(const DCTELEM *block/*align 16*/, uint8_t *pixels/*align 8*/, int line_size);
+    void (*put_signed_pixels_clamped)(const DCTELEM *block/*align 16*/, uint8_t *pixels/*align 8*/, int line_size);
+    void (*add_pixels_clamped)(const DCTELEM *block/*align 16*/, uint8_t *pixels/*align 8*/, int line_size);
+    void (*add_pixels8)(uint8_t *pixels, DCTELEM *block, int line_size);
+    void (*add_pixels4)(uint8_t *pixels, DCTELEM *block, int line_size);
+    int (*sum_abs_dctelem)(DCTELEM *block/*align 16*/);
+    /**
+     * translational global motion compensation.
+     */
+    void (*gmc1)(uint8_t *dst/*align 8*/, uint8_t *src/*align 1*/, int srcStride, int h, int x16, int y16, int rounder);
+    /**
+     * global motion compensation.
+     */
+    void (*gmc )(uint8_t *dst/*align 8*/, uint8_t *src/*align 1*/, int stride, int h, int ox, int oy,
+                    int dxx, int dxy, int dyx, int dyy, int shift, int r, int width, int height);
+    void (*clear_block)(DCTELEM *block/*align 16*/);
+    void (*clear_blocks)(DCTELEM *blocks/*align 16*/);
+    int (*pix_sum)(uint8_t * pix, int line_size);
+    int (*pix_norm1)(uint8_t * pix, int line_size);
+// 16x16 8x8 4x4 2x2 16x8 8x4 4x2 8x16 4x8 2x4
+
+    me_cmp_func sad[6]; /* identical to pix_absAxA except additional void * */
+    me_cmp_func sse[6];
+    me_cmp_func hadamard8_diff[6];
+    me_cmp_func dct_sad[6];
+    me_cmp_func quant_psnr[6];
+    me_cmp_func bit[6];
+    me_cmp_func rd[6];
+    me_cmp_func vsad[6];
+    me_cmp_func vsse[6];
+    me_cmp_func nsse[6];
+    me_cmp_func w53[6];
+    me_cmp_func w97[6];
+    me_cmp_func dct_max[6];
+    me_cmp_func dct264_sad[6];
+
+    me_cmp_func me_pre_cmp[6];
+    me_cmp_func me_cmp[6];
+    me_cmp_func me_sub_cmp[6];
+    me_cmp_func mb_cmp[6];
+    me_cmp_func ildct_cmp[6]; //only width 16 used
+    me_cmp_func frame_skip_cmp[6]; //only width 8 used
+
+    int (*ssd_int8_vs_int16)(const int8_t *pix1, const int16_t *pix2,
+                             int size);
+
+    /**
+     * Halfpel motion compensation with rounding (a+b+1)>>1.
+     * this is an array[4][4] of motion compensation functions for 4
+     * horizontal blocksizes (8,16) and the 4 halfpel positions<br>
+     * *pixels_tab[ 0->16xH 1->8xH ][ xhalfpel + 2*yhalfpel ]
+     * @param block destination where the result is stored
+     * @param pixels source
+     * @param line_size number of bytes in a horizontal line of block
+     * @param h height
+     */
+    op_pixels_func put_pixels_tab[4][4];
+
+    /**
+     * Halfpel motion compensation with rounding (a+b+1)>>1.
+     * This is an array[4][4] of motion compensation functions for 4
+     * horizontal blocksizes (8,16) and the 4 halfpel positions<br>
+     * *pixels_tab[ 0->16xH 1->8xH ][ xhalfpel + 2*yhalfpel ]
+     * @param block destination into which the result is averaged (a+b+1)>>1
+     * @param pixels source
+     * @param line_size number of bytes in a horizontal line of block
+     * @param h height
+     */
+    op_pixels_func avg_pixels_tab[4][4];
+
+    /**
+     * Halfpel motion compensation with no rounding (a+b)>>1.
+     * this is an array[2][4] of motion compensation functions for 2
+     * horizontal blocksizes (8,16) and the 4 halfpel positions<br>
+     * *pixels_tab[ 0->16xH 1->8xH ][ xhalfpel + 2*yhalfpel ]
+     * @param block destination where the result is stored
+     * @param pixels source
+     * @param line_size number of bytes in a horizontal line of block
+     * @param h height
+     */
+    op_pixels_func put_no_rnd_pixels_tab[4][4];
+
+    /**
+     * Halfpel motion compensation with no rounding (a+b)>>1.
+     * this is an array[2][4] of motion compensation functions for 2
+     * horizontal blocksizes (8,16) and the 4 halfpel positions<br>
+     * *pixels_tab[ 0->16xH 1->8xH ][ xhalfpel + 2*yhalfpel ]
+     * @param block destination into which the result is averaged (a+b)>>1
+     * @param pixels source
+     * @param line_size number of bytes in a horizontal line of block
+     * @param h height
+     */
+    op_pixels_func avg_no_rnd_pixels_tab[4][4];
+
+    void (*put_no_rnd_pixels_l2[2])(uint8_t *block/*align width (8 or 16)*/, const uint8_t *a/*align 1*/, const uint8_t *b/*align 1*/, int line_size, int h);
+
+    /**
+     * Thirdpel motion compensation with rounding (a+b+1)>>1.
+     * this is an array[12] of motion compensation functions for the 9 thirdpe
+     * positions<br>
+     * *pixels_tab[ xthirdpel + 4*ythirdpel ]
+     * @param block destination where the result is stored
+     * @param pixels source
+     * @param line_size number of bytes in a horizontal line of block
+     * @param h height
+     */
+    tpel_mc_func put_tpel_pixels_tab[11]; //FIXME individual func ptr per width?
+    tpel_mc_func avg_tpel_pixels_tab[11]; //FIXME individual func ptr per width?
+
+    qpel_mc_func put_qpel_pixels_tab[2][16];
+    qpel_mc_func avg_qpel_pixels_tab[2][16];
+    qpel_mc_func put_no_rnd_qpel_pixels_tab[2][16];
+    qpel_mc_func avg_no_rnd_qpel_pixels_tab[2][16];
+    qpel_mc_func put_mspel_pixels_tab[8];
+
+    /**
+     * h264 Chroma MC
+     */
+    h264_chroma_mc_func put_h264_chroma_pixels_tab[3];
+    h264_chroma_mc_func avg_h264_chroma_pixels_tab[3];
+    /* This is really one func used in VC-1 decoding */
+    h264_chroma_mc_func put_no_rnd_vc1_chroma_pixels_tab[3];
+    h264_chroma_mc_func avg_no_rnd_vc1_chroma_pixels_tab[3];
+
+    qpel_mc_func put_h264_qpel_pixels_tab[4][16];
+    qpel_mc_func avg_h264_qpel_pixels_tab[4][16];
+
+    qpel_mc_func put_2tap_qpel_pixels_tab[4][16];
+    qpel_mc_func avg_2tap_qpel_pixels_tab[4][16];
+
+    h264_weight_func weight_h264_pixels_tab[10];
+    h264_biweight_func biweight_h264_pixels_tab[10];
+
+    /* AVS specific */
+    qpel_mc_func put_cavs_qpel_pixels_tab[2][16];
+    qpel_mc_func avg_cavs_qpel_pixels_tab[2][16];
+    void (*cavs_filter_lv)(uint8_t *pix, int stride, int alpha, int beta, int tc, int bs1, int bs2);
+    void (*cavs_filter_lh)(uint8_t *pix, int stride, int alpha, int beta, int tc, int bs1, int bs2);
+    void (*cavs_filter_cv)(uint8_t *pix, int stride, int alpha, int beta, int tc, int bs1, int bs2);
+    void (*cavs_filter_ch)(uint8_t *pix, int stride, int alpha, int beta, int tc, int bs1, int bs2);
+    void (*cavs_idct8_add)(uint8_t *dst, DCTELEM *block, int stride);
+
+    me_cmp_func pix_abs[2][4];
+
+    /* huffyuv specific */
+    void (*add_bytes)(uint8_t *dst/*align 16*/, uint8_t *src/*align 16*/, int w);
+    void (*add_bytes_l2)(uint8_t *dst/*align 16*/, uint8_t *src1/*align 16*/, uint8_t *src2/*align 16*/, int w);
+    void (*diff_bytes)(uint8_t *dst/*align 16*/, uint8_t *src1/*align 16*/, uint8_t *src2/*align 1*/,int w);
+    /**
+     * subtract huffyuv's variant of median prediction
+     * note, this might read from src1[-1], src2[-1]
+     */
+    void (*sub_hfyu_median_prediction)(uint8_t *dst, uint8_t *src1, uint8_t *src2, int w, int *left, int *left_top);
+    void (*add_hfyu_median_prediction)(uint8_t *dst, uint8_t *top, uint8_t *diff, int w, int *left, int *left_top);
+    /* this might write to dst[w] */
+    void (*add_png_paeth_prediction)(uint8_t *dst, uint8_t *src, uint8_t *top, int w, int bpp);
+    void (*bswap_buf)(uint32_t *dst, const uint32_t *src, int w);
+
+    void (*h264_v_loop_filter_luma)(uint8_t *pix/*align 16*/, int stride, int alpha, int beta, int8_t *tc0);
+    void (*h264_h_loop_filter_luma)(uint8_t *pix/*align 4 */, int stride, int alpha, int beta, int8_t *tc0);
+    /* v/h_loop_filter_luma_intra: align 16 */
+    void (*h264_v_loop_filter_luma_intra)(uint8_t *pix, int stride, int alpha, int beta);
+    void (*h264_h_loop_filter_luma_intra)(uint8_t *pix, int stride, int alpha, int beta);
+    void (*h264_v_loop_filter_chroma)(uint8_t *pix/*align 8*/, int stride, int alpha, int beta, int8_t *tc0);
+    void (*h264_h_loop_filter_chroma)(uint8_t *pix/*align 4*/, int stride, int alpha, int beta, int8_t *tc0);
+    void (*h264_v_loop_filter_chroma_intra)(uint8_t *pix/*align 8*/, int stride, int alpha, int beta);
+    void (*h264_h_loop_filter_chroma_intra)(uint8_t *pix/*align 8*/, int stride, int alpha, int beta);
+    // h264_loop_filter_strength: simd only. the C version is inlined in h264.c
+    void (*h264_loop_filter_strength)(int16_t bS[2][4][4], uint8_t nnz[40], int8_t ref[2][40], int16_t mv[2][40][2],
+                                      int bidir, int edges, int step, int mask_mv0, int mask_mv1, int field);
+
+    void (*h263_v_loop_filter)(uint8_t *src, int stride, int qscale);
+    void (*h263_h_loop_filter)(uint8_t *src, int stride, int qscale);
+
+    void (*h261_loop_filter)(uint8_t *src, int stride);
+
+    void (*x8_v_loop_filter)(uint8_t *src, int stride, int qscale);
+    void (*x8_h_loop_filter)(uint8_t *src, int stride, int qscale);
+
+    void (*vp3_v_loop_filter)(uint8_t *src, int stride, int *bounding_values);
+    void (*vp3_h_loop_filter)(uint8_t *src, int stride, int *bounding_values);
+
+    void (*vp6_filter_diag4)(uint8_t *dst, uint8_t *src, int stride,
+                             const int16_t *h_weights,const int16_t *v_weights);
+
+    /* assume len is a multiple of 4, and arrays are 16-byte aligned */
+    void (*vorbis_inverse_coupling)(float *mag, float *ang, int blocksize);
+    void (*ac3_downmix)(float (*samples)[256], float (*matrix)[2], int out_ch, int in_ch, int len);
+    /* no alignment needed */
+    void (*flac_compute_autocorr)(const int32_t *data, int len, int lag, double *autoc);
+    /* assume len is a multiple of 8, and arrays are 16-byte aligned */
+    void (*vector_fmul)(float *dst, const float *src, int len);
+    void (*vector_fmul_reverse)(float *dst, const float *src0, const float *src1, int len);
+    /* assume len is a multiple of 8, and src arrays are 16-byte aligned */
+    void (*vector_fmul_add_add)(float *dst, const float *src0, const float *src1, const float *src2, int src3, int len, int step);
+    /* assume len is a multiple of 4, and arrays are 16-byte aligned */
+    void (*vector_fmul_window)(float *dst, const float *src0, const float *src1, const float *win, float add_bias, int len);
+    /* assume len is a multiple of 8, and arrays are 16-byte aligned */
+    void (*int32_to_float_fmul_scalar)(float *dst, const int *src, float mul, int len);
+
+    /* C version: convert floats from the range [384.0,386.0] to ints in [-32768,32767]
+     * simd versions: convert floats from [-32768.0,32767.0] without rescaling and arrays are 16byte aligned */
+    void (*float_to_int16)(int16_t *dst, const float *src, long len);
+    void (*float_to_int16_interleave)(int16_t *dst, const float **src, long len, int channels);
+
+    /* (I)DCT */
+    void (*fdct)(DCTELEM *block/* align 16*/);
+    void (*fdct248)(DCTELEM *block/* align 16*/);
+
+    /* IDCT really*/
+    void (*idct)(DCTELEM *block/* align 16*/);
+
+    /**
+     * block -> idct -> clip to unsigned 8 bit -> dest.
+     * (-1392, 0, 0, ...) -> idct -> (-174, -174, ...) -> put -> (0, 0, ...)
+     * @param line_size size in bytes of a horizontal line of dest
+     */
+    void (*idct_put)(uint8_t *dest/*align 8*/, int line_size, DCTELEM *block/*align 16*/);
+
+    /**
+     * block -> idct -> add dest -> clip to unsigned 8 bit -> dest.
+     * @param line_size size in bytes of a horizontal line of dest
+     */
+    void (*idct_add)(uint8_t *dest/*align 8*/, int line_size, DCTELEM *block/*align 16*/);
+
+    /**
+     * idct input permutation.
+     * several optimized IDCTs need a permutated input (relative to the normal order of the reference
+     * IDCT)
+     * this permutation must be performed before the idct_put/add, note, normally this can be merged
+     * with the zigzag/alternate scan<br>
+     * an example to avoid confusion:
+     * - (->decode coeffs -> zigzag reorder -> dequant -> reference idct ->...)
+     * - (x -> referece dct -> reference idct -> x)
+     * - (x -> referece dct -> simple_mmx_perm = idct_permutation -> simple_idct_mmx -> x)
+     * - (->decode coeffs -> zigzag reorder -> simple_mmx_perm -> dequant -> simple_idct_mmx ->...)
+     */
+    uint8_t idct_permutation[64];
+    int idct_permutation_type;
+#define FF_NO_IDCT_PERM 1
+#define FF_LIBMPEG2_IDCT_PERM 2
+#define FF_SIMPLE_IDCT_PERM 3
+#define FF_TRANSPOSE_IDCT_PERM 4
+#define FF_PARTTRANS_IDCT_PERM 5
+#define FF_SSE2_IDCT_PERM 6
+
+    int (*try_8x8basis)(int16_t rem[64], int16_t weight[64], int16_t basis[64], int scale);
+    void (*add_8x8basis)(int16_t rem[64], int16_t basis[64], int scale);
+#define BASIS_SHIFT 16
+#define RECON_SHIFT 6
+
+    void (*draw_edges)(uint8_t *buf, int wrap, int width, int height, int w);
+#define EDGE_WIDTH 16
+
+    /* h264 functions */
+    /* NOTE!!! if you implement any of h264_idct8_add, h264_idct8_add4 then you must implement all of them
+       NOTE!!! if you implement any of h264_idct_add, h264_idct_add16, h264_idct_add16intra, h264_idct_add8 then you must implement all of them
+        The reason for above, is that no 2 out of one list may use a different permutation.
+    */
+    void (*h264_idct_add)(uint8_t *dst/*align 4*/, DCTELEM *block/*align 16*/, int stride);
+    void (*h264_idct8_add)(uint8_t *dst/*align 8*/, DCTELEM *block/*align 16*/, int stride);
+    void (*h264_idct_dc_add)(uint8_t *dst/*align 4*/, DCTELEM *block/*align 16*/, int stride);
+    void (*h264_idct8_dc_add)(uint8_t *dst/*align 8*/, DCTELEM *block/*align 16*/, int stride);
+    void (*h264_dct)(DCTELEM block[4][4]);
+    void (*h264_idct_add16)(uint8_t *dst/*align 16*/, const int *blockoffset, DCTELEM *block/*align 16*/, int stride, const uint8_t nnzc[6*8]);
+    void (*h264_idct8_add4)(uint8_t *dst/*align 16*/, const int *blockoffset, DCTELEM *block/*align 16*/, int stride, const uint8_t nnzc[6*8]);
+    void (*h264_idct_add8)(uint8_t **dst/*align 16*/, const int *blockoffset, DCTELEM *block/*align 16*/, int stride, const uint8_t nnzc[6*8]);
+    void (*h264_idct_add16intra)(uint8_t *dst/*align 16*/, const int *blockoffset, DCTELEM *block/*align 16*/, int stride, const uint8_t nnzc[6*8]);
+
+    /* snow wavelet */
+    void (*vertical_compose97i)(IDWTELEM *b0, IDWTELEM *b1, IDWTELEM *b2, IDWTELEM *b3, IDWTELEM *b4, IDWTELEM *b5, int width);
+    void (*horizontal_compose97i)(IDWTELEM *b, int width);
+    void (*inner_add_yblock)(const uint8_t *obmc, const int obmc_stride, uint8_t * * block, int b_w, int b_h, int src_x, int src_y, int src_stride, slice_buffer * sb, int add, uint8_t * dst8);
+
+    void (*prefetch)(void *mem, int stride, int h);
+
+    void (*shrink[4])(uint8_t *dst, int dst_wrap, const uint8_t *src, int src_wrap, int width, int height);
+
+    /* mlp/truehd functions */
+    void (*mlp_filter_channel)(int32_t *firbuf, const int32_t *fircoeff, int firorder,
+                               int32_t *iirbuf, const int32_t *iircoeff, int iirorder,
+                               unsigned int filter_shift, int32_t mask, int blocksize,
+                               int32_t *sample_buffer);
+
+    /* vc1 functions */
+    void (*vc1_inv_trans_8x8)(DCTELEM *b);
+    void (*vc1_inv_trans_8x4)(uint8_t *dest, int line_size, DCTELEM *block);
+    void (*vc1_inv_trans_4x8)(uint8_t *dest, int line_size, DCTELEM *block);
+    void (*vc1_inv_trans_4x4)(uint8_t *dest, int line_size, DCTELEM *block);
+    void (*vc1_v_overlap)(uint8_t* src, int stride);
+    void (*vc1_h_overlap)(uint8_t* src, int stride);
+    void (*vc1_v_loop_filter4)(uint8_t *src, int stride, int pq);
+    void (*vc1_h_loop_filter4)(uint8_t *src, int stride, int pq);
+    void (*vc1_v_loop_filter8)(uint8_t *src, int stride, int pq);
+    void (*vc1_h_loop_filter8)(uint8_t *src, int stride, int pq);
+    void (*vc1_v_loop_filter16)(uint8_t *src, int stride, int pq);
+    void (*vc1_h_loop_filter16)(uint8_t *src, int stride, int pq);
+    /* put 8x8 block with bicubic interpolation and quarterpel precision
+     * last argument is actually round value instead of height
+     */
+    op_pixels_func put_vc1_mspel_pixels_tab[16];
+    op_pixels_func avg_vc1_mspel_pixels_tab[16];
+
+    /* intrax8 functions */
+    void (*x8_spatial_compensation[12])(uint8_t *src , uint8_t *dst, int linesize);
+    void (*x8_setup_spatial_compensation)(uint8_t *src, uint8_t *dst, int linesize,
+           int * range, int * sum,  int edges);
+
+    /* ape functions */
+    /**
+     * Add contents of the second vector to the first one.
+     * @param len length of vectors, should be multiple of 16
+     */
+    void (*add_int16)(int16_t *v1/*align 16*/, int16_t *v2, int len);
+    /**
+     * Add contents of the second vector to the first one.
+     * @param len length of vectors, should be multiple of 16
+     */
+    void (*sub_int16)(int16_t *v1/*align 16*/, int16_t *v2, int len);
+    /**
+     * Calculate scalar product of two vectors.
+     * @param len length of vectors, should be multiple of 16
+     * @param shift number of bits to discard from product
+     */
+    int32_t (*scalarproduct_int16)(int16_t *v1, int16_t *v2/*align 16*/, int len, int shift);
+
+    /* rv30 functions */
+    qpel_mc_func put_rv30_tpel_pixels_tab[4][16];
+    qpel_mc_func avg_rv30_tpel_pixels_tab[4][16];
+
+    /* rv40 functions */
+    qpel_mc_func put_rv40_qpel_pixels_tab[4][16];
+    qpel_mc_func avg_rv40_qpel_pixels_tab[4][16];
+    h264_chroma_mc_func put_rv40_chroma_pixels_tab[3];
+    h264_chroma_mc_func avg_rv40_chroma_pixels_tab[3];
+} DSPContext;
+
+void dsputil_static_init(void);
+void dsputil_init(DSPContext* p, AVCodecContext *avctx);
+
+int ff_check_alignment(void);
+
+/**
+ * permute block according to permuatation.
+ * @param last last non zero element in scantable order
+ */
+void ff_block_permute(DCTELEM *block, uint8_t *permutation, const uint8_t *scantable, int last);
+
+void ff_set_cmp(DSPContext* c, me_cmp_func *cmp, int type);
+
+#define         BYTE_VEC32(c)   ((c)*0x01010101UL)
+
+static inline uint32_t rnd_avg32(uint32_t a, uint32_t b)
+{
+    return (a | b) - (((a ^ b) & ~BYTE_VEC32(0x01)) >> 1);
+}
+
+static inline uint32_t no_rnd_avg32(uint32_t a, uint32_t b)
+{
+    return (a & b) + (((a ^ b) & ~BYTE_VEC32(0x01)) >> 1);
+}
+
+static inline int get_penalty_factor(int lambda, int lambda2, int type){
+    switch(type&0xFF){
+    default:
+    case FF_CMP_SAD:
+        return lambda>>FF_LAMBDA_SHIFT;
+    case FF_CMP_DCT:
+        return (3*lambda)>>(FF_LAMBDA_SHIFT+1);
+    case FF_CMP_W53:
+        return (4*lambda)>>(FF_LAMBDA_SHIFT);
+    case FF_CMP_W97:
+        return (2*lambda)>>(FF_LAMBDA_SHIFT);
+    case FF_CMP_SATD:
+    case FF_CMP_DCT264:
+        return (2*lambda)>>FF_LAMBDA_SHIFT;
+    case FF_CMP_RD:
+    case FF_CMP_PSNR:
+    case FF_CMP_SSE:
+    case FF_CMP_NSSE:
+        return lambda2>>FF_LAMBDA_SHIFT;
+    case FF_CMP_BIT:
+        return 1;
+    }
+}
+
+/**
+ * Empty mmx state.
+ * this must be called between any dsp function and float/double code.
+ * for example sin(); dsp->idct_put(); emms_c(); cos()
+ */
+#define emms_c()
+
+/* should be defined by architectures supporting
+   one or more MultiMedia extension */
+int mm_support(void);
+
+void dsputil_init_alpha(DSPContext* c, AVCodecContext *avctx);
+void dsputil_init_arm(DSPContext* c, AVCodecContext *avctx);
+void dsputil_init_bfin(DSPContext* c, AVCodecContext *avctx);
+void dsputil_init_mlib(DSPContext* c, AVCodecContext *avctx);
+void dsputil_init_mmi(DSPContext* c, AVCodecContext *avctx);
+void dsputil_init_mmx(DSPContext* c, AVCodecContext *avctx);
+void dsputil_init_ppc(DSPContext* c, AVCodecContext *avctx);
+void dsputil_init_sh4(DSPContext* c, AVCodecContext *avctx);
+void dsputil_init_vis(DSPContext* c, AVCodecContext *avctx);
+
+#define DECLARE_ALIGNED_16(t, v) DECLARE_ALIGNED(16, t, v)
+
+#if HAVE_MMX
+
+#undef emms_c
+
+extern int mm_flags;
+
+void add_pixels_clamped_mmx(const DCTELEM *block, uint8_t *pixels, int line_size);
+void put_pixels_clamped_mmx(const DCTELEM *block, uint8_t *pixels, int line_size);
+void put_signed_pixels_clamped_mmx(const DCTELEM *block, uint8_t *pixels, int line_size);
+
+static inline void emms(void)
+{
+    __asm__ volatile ("emms;":::"memory");
+}
+
+
+#define emms_c() \
+{\
+    if (mm_flags & FF_MM_MMX)\
+        emms();\
+}
+
+void dsputil_init_pix_mmx(DSPContext* c, AVCodecContext *avctx);
+
+#elif ARCH_ARM
+
+extern int mm_flags;
+
+#if HAVE_NEON
+#   define DECLARE_ALIGNED_8(t, v) DECLARE_ALIGNED(16, t, v)
+#   define STRIDE_ALIGN 16
+#endif
+
+#elif ARCH_PPC
+
+extern int mm_flags;
+
+#define DECLARE_ALIGNED_8(t, v) DECLARE_ALIGNED(16, t, v)
+#define STRIDE_ALIGN 16
+
+#elif HAVE_MMI
+
+#define DECLARE_ALIGNED_8(t, v) DECLARE_ALIGNED(16, t, v)
+#define STRIDE_ALIGN 16
+
+#else
+
+#define mm_flags 0
+#define mm_support() 0
+
+#endif
+
+#ifndef DECLARE_ALIGNED_8
+#   define DECLARE_ALIGNED_8(t, v) DECLARE_ALIGNED(8, t, v)
+#endif
+
+#ifndef STRIDE_ALIGN
+#   define STRIDE_ALIGN 8
+#endif
+
+/* PSNR */
+void get_psnr(uint8_t *orig_image[3], uint8_t *coded_image[3],
+              int orig_linesize[3], int coded_linesize,
+              AVCodecContext *avctx);
+
+/* FFT computation */
+
+/* NOTE: soon integer code will be added, so you must use the
+   FFTSample type */
+typedef float FFTSample;
+
+struct MDCTContext;
+
+typedef struct FFTComplex {
+    FFTSample re, im;
+} FFTComplex;
+
+typedef struct FFTContext {
+    int nbits;
+    int inverse;
+    uint16_t *revtab;
+    FFTComplex *exptab;
+    FFTComplex *exptab1; /* only used by SSE code */
+    FFTComplex *tmp_buf;
+    void (*fft_permute)(struct FFTContext *s, FFTComplex *z);
+    void (*fft_calc)(struct FFTContext *s, FFTComplex *z);
+    void (*imdct_calc)(struct MDCTContext *s, FFTSample *output, const FFTSample *input);
+    void (*imdct_half)(struct MDCTContext *s, FFTSample *output, const FFTSample *input);
+} FFTContext;
+
+extern FFTSample* ff_cos_tabs[13];
+
+/**
+ * Sets up a complex FFT.
+ * @param nbits           log2 of the length of the input array
+ * @param inverse         if 0 perform the forward transform, if 1 perform the inverse
+ */
+int ff_fft_init(FFTContext *s, int nbits, int inverse);
+void ff_fft_permute_c(FFTContext *s, FFTComplex *z);
+void ff_fft_permute_sse(FFTContext *s, FFTComplex *z);
+void ff_fft_calc_c(FFTContext *s, FFTComplex *z);
+void ff_fft_calc_sse(FFTContext *s, FFTComplex *z);
+void ff_fft_calc_3dn(FFTContext *s, FFTComplex *z);
+void ff_fft_calc_3dn2(FFTContext *s, FFTComplex *z);
+void ff_fft_calc_altivec(FFTContext *s, FFTComplex *z);
+
+/**
+ * Do the permutation needed BEFORE calling ff_fft_calc().
+ */
+static inline void ff_fft_permute(FFTContext *s, FFTComplex *z)
+{
+    s->fft_permute(s, z);
+}
+/**
+ * Do a complex FFT with the parameters defined in ff_fft_init(). The
+ * input data must be permuted before. No 1.0/sqrt(n) normalization is done.
+ */
+static inline void ff_fft_calc(FFTContext *s, FFTComplex *z)
+{
+    s->fft_calc(s, z);
+}
+void ff_fft_end(FFTContext *s);
+
+/* MDCT computation */
+
+typedef struct MDCTContext {
+    int n;  /* size of MDCT (i.e. number of input data * 2) */
+    int nbits; /* n = 2^nbits */
+    /* pre/post rotation tables */
+    FFTSample *tcos;
+    FFTSample *tsin;
+    FFTContext fft;
+} MDCTContext;
+
+static inline void ff_imdct_calc(MDCTContext *s, FFTSample *output, const FFTSample *input)
+{
+    s->fft.imdct_calc(s, output, input);
+}
+static inline void ff_imdct_half(MDCTContext *s, FFTSample *output, const FFTSample *input)
+{
+    s->fft.imdct_half(s, output, input);
+}
+
+/**
+ * Generate a Kaiser-Bessel Derived Window.
+ * @param   window  pointer to half window
+ * @param   alpha   determines window shape
+ * @param   n       size of half window
+ */
+void ff_kbd_window_init(float *window, float alpha, int n);
+
+/**
+ * Generate a sine window.
+ * @param   window  pointer to half window
+ * @param   n       size of half window
+ */
+void ff_sine_window_init(float *window, int n);
+extern float ff_sine_128 [ 128];
+extern float ff_sine_256 [ 256];
+extern float ff_sine_512 [ 512];
+extern float ff_sine_1024[1024];
+extern float ff_sine_2048[2048];
+extern float ff_sine_4096[4096];
+extern float *ff_sine_windows[6];
+
+int ff_mdct_init(MDCTContext *s, int nbits, int inverse);
+void ff_imdct_calc_c(MDCTContext *s, FFTSample *output, const FFTSample *input);
+void ff_imdct_half_c(MDCTContext *s, FFTSample *output, const FFTSample *input);
+void ff_imdct_calc_3dn(MDCTContext *s, FFTSample *output, const FFTSample *input);
+void ff_imdct_half_3dn(MDCTContext *s, FFTSample *output, const FFTSample *input);
+void ff_imdct_calc_3dn2(MDCTContext *s, FFTSample *output, const FFTSample *input);
+void ff_imdct_half_3dn2(MDCTContext *s, FFTSample *output, const FFTSample *input);
+void ff_imdct_calc_sse(MDCTContext *s, FFTSample *output, const FFTSample *input);
+void ff_imdct_half_sse(MDCTContext *s, FFTSample *output, const FFTSample *input);
+void ff_mdct_calc(MDCTContext *s, FFTSample *out, const FFTSample *input);
+void ff_mdct_end(MDCTContext *s);
+
+/* Real Discrete Fourier Transform */
+
+enum RDFTransformType {
+    RDFT,
+    IRDFT,
+    RIDFT,
+    IRIDFT,
+};
+
+typedef struct {
+    int nbits;
+    int inverse;
+    int sign_convention;
+
+    /* pre/post rotation tables */
+    FFTSample *tcos;
+    FFTSample *tsin;
+    FFTContext fft;
+} RDFTContext;
+
+/**
+ * Sets up a real FFT.
+ * @param nbits           log2 of the length of the input array
+ * @param trans           the type of transform
+ */
+int ff_rdft_init(RDFTContext *s, int nbits, enum RDFTransformType trans);
+void ff_rdft_calc(RDFTContext *s, FFTSample *data);
+void ff_rdft_end(RDFTContext *s);
+
+#define WRAPPER8_16(name8, name16)\
+static int name16(void /*MpegEncContext*/ *s, uint8_t *dst, uint8_t *src, int stride, int h){\
+    return name8(s, dst           , src           , stride, h)\
+          +name8(s, dst+8         , src+8         , stride, h);\
+}
+
+#define WRAPPER8_16_SQ(name8, name16)\
+static int name16(void /*MpegEncContext*/ *s, uint8_t *dst, uint8_t *src, int stride, int h){\
+    int score=0;\
+    score +=name8(s, dst           , src           , stride, 8);\
+    score +=name8(s, dst+8         , src+8         , stride, 8);\
+    if(h==16){\
+        dst += 8*stride;\
+        src += 8*stride;\
+        score +=name8(s, dst           , src           , stride, 8);\
+        score +=name8(s, dst+8         , src+8         , stride, 8);\
+    }\
+    return score;\
+}
+
+
+static inline void copy_block2(uint8_t *dst, const uint8_t *src, int dstStride, int srcStride, int h)
+{
+    int i;
+    for(i=0; i<h; i++)
+    {
+        AV_WN16(dst   , AV_RN16(src   ));
+        dst+=dstStride;
+        src+=srcStride;
+    }
+}
+
+static inline void copy_block4(uint8_t *dst, const uint8_t *src, int dstStride, int srcStride, int h)
+{
+    int i;
+    for(i=0; i<h; i++)
+    {
+        AV_WN32(dst   , AV_RN32(src   ));
+        dst+=dstStride;
+        src+=srcStride;
+    }
+}
+
+static inline void copy_block8(uint8_t *dst, const uint8_t *src, int dstStride, int srcStride, int h)
+{
+    int i;
+    for(i=0; i<h; i++)
+    {
+        AV_WN32(dst   , AV_RN32(src   ));
+        AV_WN32(dst+4 , AV_RN32(src+4 ));
+        dst+=dstStride;
+        src+=srcStride;
+    }
+}
+
+static inline void copy_block9(uint8_t *dst, const uint8_t *src, int dstStride, int srcStride, int h)
+{
+    int i;
+    for(i=0; i<h; i++)
+    {
+        AV_WN32(dst   , AV_RN32(src   ));
+        AV_WN32(dst+4 , AV_RN32(src+4 ));
+        dst[8]= src[8];
+        dst+=dstStride;
+        src+=srcStride;
+    }
+}
+
+static inline void copy_block16(uint8_t *dst, const uint8_t *src, int dstStride, int srcStride, int h)
+{
+    int i;
+    for(i=0; i<h; i++)
+    {
+        AV_WN32(dst   , AV_RN32(src   ));
+        AV_WN32(dst+4 , AV_RN32(src+4 ));
+        AV_WN32(dst+8 , AV_RN32(src+8 ));
+        AV_WN32(dst+12, AV_RN32(src+12));
+        dst+=dstStride;
+        src+=srcStride;
+    }
+}
+
+static inline void copy_block17(uint8_t *dst, const uint8_t *src, int dstStride, int srcStride, int h)
+{
+    int i;
+    for(i=0; i<h; i++)
+    {
+        AV_WN32(dst   , AV_RN32(src   ));
+        AV_WN32(dst+4 , AV_RN32(src+4 ));
+        AV_WN32(dst+8 , AV_RN32(src+8 ));
+        AV_WN32(dst+12, AV_RN32(src+12));
+        dst[16]= src[16];
+        dst+=dstStride;
+        src+=srcStride;
+    }
+}
+
+#endif /* AVCODEC_DSPUTIL_H */



From mean at mail.berlios.de  Sat May  2 15:54:17 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:54:17 +0200
Subject: [Avidemux-svn-commit] r4787 - in
	branches/avidemux_2.6_branch_mean/avidemux: ADM_core/src
	ADM_libraries/ADM_ffmpeg ADM_libraries/ADM_ffmpeg/libavcodec
	ADM_libraries/ADM_ffmpeg/libavformat
	ADM_libraries/ADM_ffmpeg/libavutil
	ADM_libraries/ADM_ffmpeg/libswscale
Message-ID: <200905021354.n42DsHD6011030@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:54:13 +0200 (Sat, 02 May 2009)
New Revision: 4787

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_core/src/ADM_cpuCap.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_core/src/ADM_memcpy.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/dopatch.sh
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ffv1.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h263dec.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h264.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12enc.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo_enc.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/utils.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/file.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/flvenc.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/isom.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/matroskaenc.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/movenc.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/movenc.c.orig
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/avutil.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/internal.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/mem.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/swscale_internal.h
Log:
[FFmpeg] Applied 1set of patches

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_core/src/ADM_cpuCap.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_core/src/ADM_cpuCap.cpp	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_core/src/ADM_cpuCap.cpp	2009-05-02 13:54:13 UTC (rev 4787)
@@ -37,7 +37,7 @@
 #ifdef ADM_CPU_X86
 extern "C" 
 {
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/dsputil_cpu.h"
+#include "ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h"
 }
 #endif
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_core/src/ADM_memcpy.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_core/src/ADM_memcpy.cpp	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_core/src/ADM_memcpy.cpp	2009-05-02 13:54:13 UTC (rev 4787)
@@ -38,7 +38,7 @@
 
 extern "C"
 {
-	#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/dsputil_cpu.h"
+	#include "ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h"
 
 adm_fast_memcpy myAdmMemcpy=NULL;
 /* Original comments from mplayer (file: aclib.c)
@@ -389,14 +389,14 @@
 #if defined(ADM_CPU_X86)
   { "linux kernel memcpy()", linux_kernel_memcpy, 0, 0 },
 #if defined(ADM_CPU_X86)
-  { "MMX optimized memcpy()", mmx_memcpy, 0, MM_MMX },
-  { "MMXEXT optimized memcpy()", mmx2_memcpy, 0, MM_MMXEXT },
-  { "SSE optimized memcpy()", sse_memcpy, 0, MM_MMXEXT|MM_SSE },
+  { "MMX optimized memcpy()", mmx_memcpy, 0, FF_MM_MMX },
+  { "MMXEXT optimized memcpy()", mmx2_memcpy, 0, FF_MM_MMXEXT },
+  { "SSE optimized memcpy()", sse_memcpy, 0, FF_MM_MMXEXT|FF_MM_SSE },
 #endif
 #endif /* ARCH_X86 */
 #if 0 && defined(ADM_CPU_PPC) && !defined (__APPLE__)
   { "ppcasm_memcpy()", ppcasm_memcpy, 0, 0 },
-  { "ppcasm_cacheable_memcpy()", ppcasm_cacheable_memcpy, 0, MM_ACCEL_PPC_CACHE32 },
+  { "ppcasm_cacheable_memcpy()", ppcasm_cacheable_memcpy, 0, FF_MM_ACCEL_PPC_CACHE32 },
 #endif /* ARCH_PPC && !HOST_OS_DARWIN */
   { NULL, NULL, 0, 0 }
 };

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/dopatch.sh
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/dopatch.sh	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/dopatch.sh	2009-05-02 13:54:13 UTC (rev 4787)
@@ -2,7 +2,7 @@
 
 for i in patches/*.patch ; do
         echo $i
-        patch -p0 --dry-run < $i
+        patch -p0  < $i
 done
 
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h	2009-05-02 13:54:13 UTC (rev 4787)
@@ -511,6 +511,8 @@
 #define CODEC_FLAG2_CHUNKS        0x00008000 ///< Input bitstream might be truncated at a packet boundaries instead of only at frame boundaries.
 #define CODEC_FLAG2_NON_LINEAR_QUANT 0x00010000 ///< Use MPEG-2 nonlinear quantizer.
 #define CODEC_FLAG2_BIT_RESERVOIR 0x00020000 ///< Use a bit reservoir when encoding if possible
+//MEANX: NEVER EVER USE CLOSED GOP ?
+#define CODEC_FLAG2_32_PULLDOWN   0x80000000 
 
 /* Unsupported options :
  *              Syntax Arithmetic coding (SAC)
@@ -1357,6 +1359,7 @@
      * - decoding: unused
      */
     int rc_max_rate;
+    int rc_max_rate_header; /*< That one is set in the header MEANX */
 
     /**
      * minimum bitrate
@@ -1371,6 +1374,8 @@
      * - decoding: unused
      */
     int rc_buffer_size;
+    int rc_buffer_size_header;  /*< That one is set in the header MEANX*/
+
     float rc_buffer_aggressivity;
 
     /**

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ffv1.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ffv1.c	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ffv1.c	2009-05-02 13:54:13 UTC (rev 4787)
@@ -1072,6 +1072,8 @@
         clear_state(f);
     }else{
         p->key_frame= 0;
+         p->pict_type= FF_P_TYPE; // MEANX : looks more like a P to me as user
+
     }
     if(!f->plane[0].state && !f->plane[0].vlc_state)
         return -1;

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h263dec.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h263dec.c	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h263dec.c	2009-05-02 13:54:13 UTC (rev 4787)
@@ -120,7 +120,24 @@
 
     return 0;
 }
+/* MeanX : Ugly patch to detect vo ppacked stuff ... */
+int av_is_voppacked(AVCodecContext *avctx, int *vop_packed, int *gmc, int *qpel)
+{
+    MpegEncContext *s = avctx->priv_data;
+    // set sane default
+    *vop_packed=0;
+    *gmc=0;
+    *qpel=0;
+    if(avctx->codec->id!=CODEC_ID_MPEG4) return 0;
+    	
+  	*vop_packed=(s->divx_packed);
+	*qpel=s->quarter_sample;
+	*gmc=0;	// FIXME
+	return 1;
 
+  }
+  /* MeanX */
+
 av_cold int ff_h263_decode_end(AVCodecContext *avctx)
 {
     MpegEncContext *s = avctx->priv_data;
@@ -420,6 +437,12 @@
     } else {
         ret = h263_decode_picture_header(s);
     }
+	//MEANX we need to do it here also for quicktime file / ctts atom 
+        // we need the correct frame type, and qt file may contain 
+        // vop not coded frame.
+        pict->pict_type=s->current_picture.pict_type= s->pict_type;
+        pict->key_frame=s->current_picture.key_frame= s->pict_type == FF_I_TYPE;
+        //MEANX
 
     if(ret==FRAME_SKIPPED) return get_consumed_bytes(s, buf_size);
 
@@ -710,6 +733,14 @@
 
 assert(s->current_picture.pict_type == s->current_picture_ptr->pict_type);
 assert(s->current_picture.pict_type == s->pict_type);
+/* MEANX */
+  if(s->current_picture_ptr)
+      s->current_picture_ptr->opaque=pict->opaque;
+/* MEANX */
+
+
+
+
     if (s->pict_type == FF_B_TYPE || s->low_delay) {
         *pict= *(AVFrame*)s->current_picture_ptr;
     } else if (s->last_picture_ptr != NULL) {

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h264.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h264.c	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h264.c	2009-05-02 13:54:13 UTC (rev 4787)
@@ -8130,7 +8130,18 @@
     return 0;
 }
 
+/* MEANX */
+int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc)
+{
+      H264Context *h = avctx->priv_data;
+      assert(h);
+      *nalSize=h->nal_length_size;
+      *isAvc=h->is_avc;
+	return 1;
 
+  }
+/* MeanX */
+
 AVCodec h264_decoder = {
     "h264",
     CODEC_TYPE_VIDEO,

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12.c	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12.c	2009-05-02 13:54:13 UTC (rev 4787)
@@ -1947,7 +1947,12 @@
         ff_er_frame_end(s);
 
         MPV_frame_end(s);
+/* MEANX */
+  if(s->current_picture_ptr)
+      s->current_picture_ptr->opaque=pict->opaque;
+/* MEANX */
 
+
         if (s->pict_type == FF_B_TYPE || s->low_delay) {
             *pict= *(AVFrame*)s->current_picture_ptr;
             ff_print_debug_info(s, pict);

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12enc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12enc.c	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12enc.c	2009-05-02 13:54:13 UTC (rev 4787)
@@ -127,10 +127,19 @@
             s->frame_rate_index= i;
         }
     }
+ /* MEANX 
+
     if(dmin)
         return -1;
     else
         return 0;
+  */
+        if(dmin>4)
+   {
+        av_log(0,AV_LOG_ERROR,"We did a roundup ! Expect async!\n");
+   }
+        return 0; //MEANX
+
 }
 
 static av_cold int encode_init(AVCodecContext *avctx)
@@ -209,6 +218,7 @@
             put_sbits(&s->pb, 12, s->width );
             put_sbits(&s->pb, 12, s->height);
 
+#if 0 //MEANX
             for(i=1; i<15; i++){
                 float error= aspect_ratio;
                 if(s->codec_id == CODEC_ID_MPEG1VIDEO || i <=1)
@@ -223,20 +233,44 @@
                     s->aspect_ratio_info= i;
                 }
             }
+#endif // MEANX
+            //MEANX put_bits(&s->pb, 4, s->aspect_ratio_info);
+            //MEANX put_bits(&s->pb, 4, s->frame_rate_index);
+ // MEANX 4:3
+  if(s->avctx->sample_aspect_ratio.num==16 && s->avctx->sample_aspect_ratio.den==9)
+            {
+                //printf("FFmpeg : Wide\n");
+                put_bits(&s->pb,4,3); //16:9
+            }
+            else        //4:3
+            {
+              if(s->codec_id == CODEC_ID_MPEG2VIDEO)
+                put_bits(&s->pb, 4, 2);
+              else
+                put_bits(&s->pb, 4, 12); // MPEG1
+            }
+// /MEANX
 
-            put_bits(&s->pb, 4, s->aspect_ratio_info);
-            put_bits(&s->pb, 4, s->frame_rate_index);
+// //MEANX PULLDOWN            put_bits(&s->pb, 4, s->frame_rate_index);
+if((s->flags2 & CODEC_FLAG2_32_PULLDOWN) && (s->codec_id == CODEC_ID_MPEG2VIDEO))
+            {           
+                put_bits(&s->pb, 4,4);
+            }
+            else
+            {                                  
+                put_bits(&s->pb, 4, s->frame_rate_index);
+            } //MEANX pulldown
 
-            if(s->avctx->rc_max_rate){
-                v = (s->avctx->rc_max_rate + 399) / 400;
+            if(s->avctx->rc_max_rate_header){ //MEANX we use header
+                v = (s->avctx->rc_max_rate_header + 399) / 400;
                 if (v > 0x3ffff && s->codec_id == CODEC_ID_MPEG1VIDEO)
                     v = 0x3ffff;
             }else{
                 v= 0x3FFFF;
             }
 
-            if(s->avctx->rc_buffer_size)
-                vbv_buffer_size = s->avctx->rc_buffer_size;
+            if(s->avctx->rc_buffer_size_header) // MEANX we use header
+                vbv_buffer_size = s->avctx->rc_buffer_size_header;
             else
                 /* VBV calculation: Scaled so that a VCD has the proper VBV size of 40 kilobytes */
                 vbv_buffer_size = (( 20 * s->bit_rate) / (1151929 / 2)) * 8 * 1024;
@@ -269,8 +303,17 @@
 
                 put_bits(&s->pb, 3, s->avctx->profile); //profile
                 put_bits(&s->pb, 4, s->avctx->level); //level
+   // MEANX pulldown put_bits(&s->pb, 1, s->progressive_sequence);
+  // MEANX Pulldown
+ if(s->flags2 & CODEC_FLAG2_32_PULLDOWN) //MEANX
+                        put_bits(&s->pb, 1, 0);
+                else
+                        put_bits(&s->pb, 1, s->progressive_sequence);
 
-                put_bits(&s->pb, 1, s->progressive_sequence);
+
+// /MEANX
+
+
                 put_bits(&s->pb, 2, s->chroma_format);
                 put_bits(&s->pb, 2, s->width >>12);
                 put_bits(&s->pb, 2, s->height>>12);
@@ -334,6 +377,8 @@
 
 void mpeg1_encode_picture_header(MpegEncContext *s, int picture_number)
 {
+	int tff,rff; //MEANX
+
     mpeg1_encode_sequence_header(s);
 
     /* mpeg1 picture header */
@@ -370,6 +415,49 @@
 
     s->frame_pred_frame_dct = 1;
     if(s->codec_id == CODEC_ID_MPEG2VIDEO){
+ /* MEANX -- Pulldown */
+        if(s->flags2 & CODEC_FLAG2_32_PULLDOWN)
+        {
+        
+                switch((s->picture_number - 
+                          s->gop_picture_number)&3)
+                {
+                        case 0:
+                        default:
+                                rff=1;
+                                tff=1;
+                                break;
+                        case 1:
+                                rff=0;
+                                tff=0;
+                                break;
+                        case 2:
+                                rff=1;
+                                tff=0;
+                                break;
+                        case 3:
+                                rff=0;
+                                tff=1;
+                                break;
+                }               
+           }
+        else
+        {
+                if (s->progressive_sequence) 
+                {
+                        tff=0; /* no repeat */
+                } else 
+                {
+                        tff= s->current_picture_ptr->top_field_first;
+                }
+                rff=s->repeat_first_field;
+        
+        }
+
+//               /MEANX pulldown
+
+
+
         put_header(s, EXT_START_CODE);
         put_bits(&s->pb, 4, 8); //pic ext
         if (s->pict_type == FF_P_TYPE || s->pict_type == FF_B_TYPE) {
@@ -388,11 +476,16 @@
 
         assert(s->picture_structure == PICT_FRAME);
         put_bits(&s->pb, 2, s->picture_structure);
+#if 0 //MEANX
+
         if (s->progressive_sequence) {
             put_bits(&s->pb, 1, 0); /* no repeat */
         } else {
             put_bits(&s->pb, 1, s->current_picture_ptr->top_field_first);
         }
+#endif
+         put_bits(&s->pb, 1, tff);  //MEANX PULLDOWN
+
         /* XXX: optimize the generation of this flag with entropy
            measures */
         s->frame_pred_frame_dct = s->progressive_sequence;
@@ -402,7 +495,10 @@
         put_bits(&s->pb, 1, s->q_scale_type);
         put_bits(&s->pb, 1, s->intra_vlc_format);
         put_bits(&s->pb, 1, s->alternate_scan);
-        put_bits(&s->pb, 1, s->repeat_first_field);
+ // MEANX put_bits(&s->pb, 1, s->repeat_first_field);
+	put_bits(&s->pb, 1, rff);
+      // /MEANX
+
         s->progressive_frame = s->progressive_sequence;
         put_bits(&s->pb, 1, s->chroma_format == CHROMA_420 ? s->progressive_frame : 0); /* chroma_420_type */
         put_bits(&s->pb, 1, s->progressive_frame);

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo.c	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo.c	2009-05-02 13:54:13 UTC (rev 4787)
@@ -610,7 +610,11 @@
     CHECKED_ALLOCZ(s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE);
 
     s->parse_context.state= -1;
-    if((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
+ //MEANX: Allocate them always, as they may be free when we decode 1st image
+
+    // MEANXif((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
+if(1){ // MEANX
+
        s->visualization_buffer[0] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
        s->visualization_buffer[1] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
        s->visualization_buffer[2] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo_enc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo_enc.c	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo_enc.c	2009-05-02 13:54:13 UTC (rev 4787)
@@ -349,12 +349,14 @@
 
         av_log(avctx, AV_LOG_INFO, "Warning vbv_delay will be set to 0xFFFF (=VBR) as the specified vbv buffer is too large for the given bitrate!\n");
     }
+#if 0 //MEANX
 
     if((s->flags & CODEC_FLAG_4MV) && s->codec_id != CODEC_ID_MPEG4
        && s->codec_id != CODEC_ID_H263 && s->codec_id != CODEC_ID_H263P && s->codec_id != CODEC_ID_FLV1){
         av_log(avctx, AV_LOG_ERROR, "4MV not supported by codec\n");
         return -1;
     }
+#endif
 
     if(s->obmc && s->avctx->mb_decision != FF_MB_DECISION_SIMPLE){
         av_log(avctx, AV_LOG_ERROR, "OBMC is only supported with simple mb decision\n");
@@ -387,10 +389,12 @@
         return -1;
     }
 
+#if 0 //MEANX
     if(s->mpeg_quant && s->codec_id != CODEC_ID_MPEG4){ //FIXME mpeg2 uses that too
         av_log(avctx, AV_LOG_ERROR, "mpeg2 style quantization not supported by codec\n");
         return -1;
     }
+#endif
 
     if((s->flags & CODEC_FLAG_CBP_RD) && !avctx->trellis){
         av_log(avctx, AV_LOG_ERROR, "CBP RD needs trellis quant\n");

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/utils.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/utils.c	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/utils.c	2009-05-02 13:54:13 UTC (rev 4787)
@@ -596,10 +596,12 @@
 
     if((avctx->codec->capabilities & CODEC_CAP_DELAY) || avpkt->size){
         //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
+#if 0 // MEANX : Silence
         if(*frame_size_ptr < AVCODEC_MAX_AUDIO_FRAME_SIZE){
             av_log(avctx, AV_LOG_ERROR, "buffer smaller than AVCODEC_MAX_AUDIO_FRAME_SIZE\n");
             return -1;
         }
+#endif
         if(*frame_size_ptr < FF_MIN_BUFFER_SIZE ||
         *frame_size_ptr < avctx->channels * avctx->frame_size * sizeof(int16_t)){
             av_log(avctx, AV_LOG_ERROR, "buffer %d too small\n", *frame_size_ptr);
@@ -1023,7 +1025,7 @@
         return -1;
     }
 #if !HAVE_MKSTEMP
-    fd = open(*filename, O_RDWR | O_BINARY | O_CREAT, 0444);
+    fd = open(*filename, O_RDWR /* MEANX | O_BINARY*/ | O_CREAT, 0444);
 #else
     snprintf(*filename, len, "/tmp/%sXXXXXX", prefix);
     fd = mkstemp(*filename);

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/file.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/file.c	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/file.c	2009-05-02 13:54:13 UTC (rev 4787)
@@ -30,7 +30,73 @@
 #include <stdlib.h>
 #include "os_support.h"
 
+// GRUNTSTER start
+#ifdef __WIN32
+#include <windows.h>
 
+int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString)
+{
+	int wideCharStringLength = MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, NULL, 0);
+
+	if (wideCharString)
+		MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, wideCharString, wideCharStringLength);
+
+	return wideCharStringLength;
+}
+
+int ADM_open(const char *path, int oflag, ...)
+{
+	int fileNameLength = utf8StringToWideChar(path, -1, NULL);
+	wchar_t wcFile[fileNameLength];
+	int creation = 0, access = 0;
+	HANDLE hFile;
+
+	utf8StringToWideChar(path, -1, wcFile);
+
+	if (oflag & O_WRONLY || oflag & O_RDWR)
+	{
+		access = GENERIC_WRITE;
+
+		if (oflag & O_RDWR)
+			access |= GENERIC_READ;
+
+		if (oflag & O_CREAT)
+		{
+			if (oflag & O_EXCL)
+				creation = CREATE_NEW;
+			else if (oflag & O_TRUNC)
+				creation = CREATE_ALWAYS;
+			else
+				creation = OPEN_ALWAYS;
+		}
+		else if (oflag & O_TRUNC)
+			creation = TRUNCATE_EXISTING;
+	}
+	else if (oflag & O_RDONLY)
+		creation = OPEN_EXISTING;
+
+	if (creation & GENERIC_WRITE)
+	{
+		hFile = CreateFileW(wcFile, access, 0, NULL, creation, 0, NULL);
+
+		if (hFile == INVALID_HANDLE_VALUE)
+			return -1;
+		else
+			CloseHandle(hFile);
+	}
+
+	hFile = CreateFileW(wcFile, access, FILE_SHARE_READ, NULL, creation, 0, NULL);
+
+	if (hFile == INVALID_HANDLE_VALUE)
+		return -1;
+	else
+		return _open_osfhandle((intptr_t)hFile, oflag);
+}
+
+#define open ADM_open
+#endif
+// GRUNTSTER end
+
 /* standard file protocol */
 
 static int file_open(URLContext *h, const char *filename, int flags)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/flvenc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/flvenc.c	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/flvenc.c	2009-05-02 13:54:13 UTC (rev 4787)
@@ -389,7 +389,8 @@
     "video/x-flv",
     "flv",
     sizeof(FLVContext),
-#if CONFIG_LIBMP3LAME
+//MEANX #if CONFIG_LIBMP3LAME
+#ifdef HAVE_LIBMP3LAME
     CODEC_ID_MP3,
 #else // CONFIG_LIBMP3LAME
     CODEC_ID_ADPCM_SWF,
@@ -401,3 +402,9 @@
     .codec_tag= (const AVCodecTag* const []){flv_video_codec_ids, flv_audio_codec_ids, 0},
     .flags= AVFMT_GLOBALHEADER,
 };
+// MEANX
+int flvenc_init(void)
+{
+    av_register_output_format(&flv_muxer);
+    return 0;
+}
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/isom.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/isom.c	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/isom.c	2009-05-02 13:54:13 UTC (rev 4787)
@@ -187,7 +187,10 @@
     { CODEC_ID_MACE3, MKTAG('M', 'A', 'C', '3') }, /* Macintosh Audio Compression and Expansion 3:1 */
     { CODEC_ID_MACE6, MKTAG('M', 'A', 'C', '6') }, /* Macintosh Audio Compression and Expansion 6:1 */
 
-    { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at http://www.3ivx.com/showcase.html use this tag */
+    //MEANX { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at http://www.3ivx.com/showcase.html use this tag */
+     { CODEC_ID_MP3, MKTAG( 'm', 'p', '4','a') },
+     { CODEC_ID_MP2, MKTAG( 'm', 'p', '4', 'a') },
+    // /MEANX
     { CODEC_ID_MP3, 0x6D730055 }, /* MPEG layer 3 */
 
 /*  { CODEC_ID_OGG_VORBIS, MKTAG('O', 'g', 'g', 'S') }, *//* sample files at http://heroinewarrior.com/xmovie.php3 use this tag */

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/matroskaenc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/matroskaenc.c	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/matroskaenc.c	2009-05-02 13:54:13 UTC (rev 4787)
@@ -395,6 +395,7 @@
 
 static int put_xiph_codecpriv(AVFormatContext *s, ByteIOContext *pb, AVCodecContext *codec)
 {
+#if 0 // MEANX avidemux does thing differently
     uint8_t *header_start[3];
     int header_len[3];
     int first_header_size;
@@ -419,6 +420,28 @@
         put_buffer(pb, header_start[j], header_len[j]);
 
     return 0;
+#else
+   // Not endian safe....
+      uint32_t packetLen[3],*ptr=(uint32_t *)codec->extradata;
+      uint8_t *data[3],i,j;
+      if( 3*4+ptr[0]+ptr[1]+ptr[2]!=codec->extradata_size)
+      {
+        av_log(s, AV_LOG_ERROR, "Broken avidemux xiph header.\n");
+        return -1;
+      }
+      data[0]=codec->extradata+3*4;
+      data[1]=data[0]+ptr[0];
+      data[2]=data[1]+ptr[1];
+      put_byte(pb, 2);                    // number packets - 1
+      for (j = 0; j < 2; j++) 
+      {
+          put_xiph_size(pb, ptr[j]);
+      }
+      for (j = 0; j < 3; j++)
+        put_buffer(pb, data[j], ptr[j]);
+      
+      return 0; // /MEANX
+#endif
 }
 
 static void get_aac_sample_rates(AVFormatContext *s, AVCodecContext *codec, int *sample_rate, int *output_sample_rate)
@@ -534,6 +557,23 @@
         put_ebml_uint (pb, MATROSKA_ID_TRACKNUMBER     , i + 1);
         put_ebml_uint (pb, MATROSKA_ID_TRACKUID        , i + 1);
         put_ebml_uint (pb, MATROSKA_ID_TRACKFLAGLACING , 0);    // no lacing (yet)
+/**  MEANX : Add a default duration for video **/
+        if(codec->codec_type==CODEC_TYPE_VIDEO)
+        {
+          if(codec->time_base.den && codec->time_base.num)
+          {
+            int num=codec->time_base.num;
+            int den=codec->time_base.den;
+            unsigned int default_duration;
+            float period=num;
+                  period/=den;
+                  period*=1000*1000*1000; // in ns
+                  default_duration=(unsigned int)floor(period);
+                  put_ebml_uint (pb, MATROSKA_ID_TRACKDEFAULTDURATION ,default_duration);
+          }
+        }
+        
+/**  MEANX : Add a default duration for video **/
 
         if ((tag = av_metadata_get(st->metadata, "description", NULL, 0)))
             put_ebml_string(pb, MATROSKA_ID_TRACKNAME, tag->value);
@@ -907,3 +947,13 @@
     .flags = AVFMT_GLOBALHEADER,
     .codec_tag = (const AVCodecTag* const []){codec_wav_tags, 0},
 };
+// MEANX
+//
+int matroskaenc_init(void)
+{
+    av_register_output_format(&matroska_muxer);
+    return 0;
+}
+// /MEANX
+
+

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/movenc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/movenc.c	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/movenc.c	2009-05-02 13:54:13 UTC (rev 4787)
@@ -2017,3 +2017,15 @@
     .codec_tag = (const AVCodecTag* const []){codec_ipod_tags, 0},
 };
 #endif
+/* MEANX */
+int movenc_init(void)
+{
+    av_register_output_format(&mov_muxer);
+    av_register_output_format(&tgp_muxer);
+    av_register_output_format(&mp4_muxer);
+    av_register_output_format(&psp_muxer);
+    av_register_output_format(&tg2_muxer);
+    av_register_output_format(&ipod_muxer);
+    return 0;
+}
+/* MEANX */

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/movenc.c.orig
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/movenc.c.orig	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/movenc.c.orig	2009-05-02 13:54:13 UTC (rev 4787)
@@ -26,12 +26,8 @@
 #include "avio.h"
 #include "isom.h"
 #include "avc.h"
-<<<<<<< HEAD:libavformat/movenc.c
-#include "ADM_lavcodec/bitstream.h"
-=======
 #include "libavcodec/get_bits.h"
 #include "libavcodec/put_bits.h"
->>>>>>> master:libavformat/movenc.c
 
 #undef NDEBUG
 #include <assert.h>
@@ -1140,11 +1136,8 @@
 
     put_be32(pb, av_rescale_rnd(track->trackDuration, globalTimescale, track->timescale, AV_ROUND_UP)); /* duration   ... doesn't seem to effect psp */
 
-    // MEANX : NO put_be32(pb, track->cluster[0].cts); /* first pts is cts since dts is 0 */
-    // MEANX : NO put_be32(pb, 0x00010000);
- put_be32(pb, 0x00000000);
- put_be32(pb, 0x00000001);
-
+    put_be32(pb, track->cluster[0].cts); /* first pts is cts since dts is 0 */
+    put_be32(pb, 0x00010000);
     return 0x24;
 }
 
@@ -2024,15 +2017,3 @@
     .codec_tag = (const AVCodecTag* const []){codec_ipod_tags, 0},
 };
 #endif
-/* MEANX */
-int movenc_init(void)
-{
-    av_register_output_format(&mov_muxer);
-    av_register_output_format(&tgp_muxer);
-    av_register_output_format(&mp4_muxer);
-    av_register_output_format(&psp_muxer);
-    av_register_output_format(&tg2_muxer);
-    // FIXME av_register_output_format(&ipod_muxer);
-    return 0;
-}
-/* MEANX */

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/avutil.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/avutil.h	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/avutil.h	2009-05-02 13:54:13 UTC (rev 4787)
@@ -26,7 +26,14 @@
  * external API header
  */
 
+/* MEANX
+ * - */
+#define ASMALIGN(ZEROBITS) ".p2align " #ZEROBITS "\n\t"
+/* /MEANX
+ */
 
+
+
 #define AV_STRINGIFY(s)         AV_TOSTRING(s)
 #define AV_TOSTRING(s) #s
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/internal.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/internal.h	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/internal.h	2009-05-02 13:54:13 UTC (rev 4787)
@@ -215,12 +215,14 @@
 #endif
 
 /* avoid usage of dangerous/inappropriate system functions */
+#if 0 //MEANX
 #undef  malloc
 #define malloc please_use_av_malloc
 #undef  free
 #define free please_use_av_free
 #undef  realloc
 #define realloc please_use_av_realloc
+#endif
 #undef  time
 #define time time_is_forbidden_due_to_security_issues
 #undef  rand

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/mem.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/mem.c	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/mem.c	2009-05-02 13:54:13 UTC (rev 4787)
@@ -46,87 +46,110 @@
 
 void *av_malloc(unsigned int size)
 {
-    void *ptr = NULL;
-#if CONFIG_MEMALIGN_HACK
-    long diff;
-#endif
+#ifdef __APPLE__
+	return malloc(size);
+#else
+	char *c;
 
-    /* let's disallow possible ambiguous cases */
-    if(size > (INT_MAX-16) )
-        return NULL;
+	uint64_t l, lorg;
+	uint32_t *backdoor;
 
-#if CONFIG_MEMALIGN_HACK
-    ptr = malloc(size+16);
-    if(!ptr)
-        return ptr;
-    diff= ((-(long)ptr - 1)&15) + 1;
-    ptr = (char*)ptr + diff;
-    ((char*)ptr)[-1]= diff;
-#elif HAVE_POSIX_MEMALIGN
-    if (posix_memalign(&ptr,16,size))
-        ptr = NULL;
-#elif HAVE_MEMALIGN
-    ptr = memalign(16,size);
-    /* Why 64?
-       Indeed, we should align it:
-         on 4 for 386
-         on 16 for 486
-         on 32 for 586, PPro - K6-III
-         on 64 for K7 (maybe for P3 too).
-       Because L1 and L2 caches are aligned on those values.
-       But I don't want to code such logic here!
-     */
-     /* Why 16?
-        Because some CPUs need alignment, for example SSE2 on P4, & most RISC CPUs
-        it will just trigger an exception and the unaligned load will be done in the
-        exception handler or it will just segfault (SSE2 on P4).
-        Why not larger? Because I did not see a difference in benchmarks ...
-     */
-     /* benchmarks with P3
-        memalign(64)+1          3071,3051,3032
-        memalign(64)+2          3051,3032,3041
-        memalign(64)+4          2911,2896,2915
-        memalign(64)+8          2545,2554,2550
-        memalign(64)+16         2543,2572,2563
-        memalign(64)+32         2546,2545,2571
-        memalign(64)+64         2570,2533,2558
+	l = (uint64_t)malloc(size + 32);
 
-        BTW, malloc seems to do 8-byte alignment by default here.
-     */
-#else
-    ptr = malloc(size);
+	// Get next boundary
+	lorg = l;
+	l = (l + 15) & 0xfffffffffffffff0LL;
+	l += 16;
+	c = (char*)l;
+	backdoor = (uint32_t*)(c - 8);
+	*backdoor = (0xdead << 16) + l - lorg;
+	backdoor[1] = size;
+
+	return c;
 #endif
-    return ptr;
 }
 
-void *av_realloc(void *ptr, unsigned int size)
+void *av_realloc(void *ptr, unsigned int newsize)
 {
-#if CONFIG_MEMALIGN_HACK
-    int diff;
-#endif
+#ifdef __APPLE__
+	if (!ptr)
+		return av_malloc(newsize);
 
-    /* let's disallow possible ambiguous cases */
-    if(size > (INT_MAX-16) )
-        return NULL;
+	if (!newsize)
+	{
+		av_free(ptr);
+		return NULL;
+	}
 
-#if CONFIG_MEMALIGN_HACK
-    //FIXME this isn't aligned correctly, though it probably isn't needed
-    if(!ptr) return av_malloc(size);
-    diff= ((char*)ptr)[-1];
-    return (char*)realloc((char*)ptr - diff, size + diff) + diff;
+	return realloc(ptr, newsize);
 #else
-    return realloc(ptr, size);
+	void *nalloc;
+
+	if (!ptr)
+		return av_malloc(newsize);
+
+	if (!newsize) 
+	{
+		av_free(ptr);
+		return NULL;
+	}
+
+	// now we either shrink them or expand them
+	// in case of shrink, we do nothing
+	// in case of expand we have to copy
+	// Do copy everytime (slower)
+	uint32_t *backdoor;
+	uint32_t size, offset;
+	char *c = (char*)ptr;
+
+	backdoor = (uint32_t*)ptr;
+	backdoor -= 2;
+
+	assert(((*backdoor) >> 16) == 0xdead);
+
+	offset = backdoor[0] & 0xffff;
+	size = backdoor[1];
+
+	if(size >= newsize) // do nothing
+		return ptr;
+
+	// Allocate a new one
+	nalloc = av_malloc(newsize);
+	memcpy(nalloc, ptr, size);
+	av_free(ptr);
+
+	return nalloc;
 #endif
 }
 
 void av_free(void *ptr)
 {
-    /* XXX: this test should not be needed on most libcs */
-    if (ptr)
-#if CONFIG_MEMALIGN_HACK
-        free((char*)ptr - ((char*)ptr)[-1]);
+#ifdef __APPLE__
+	if (!ptr)
+		return;
+
+	free(ptr);
 #else
-        free(ptr);
+	uint32_t *backdoor;
+	uint32_t size, offset;
+	char *c = (char*)ptr;
+
+	if (!ptr)
+		return;
+
+	backdoor = (uint32_t*)ptr;
+	backdoor -= 2;
+
+	if (*backdoor == 0xbeefbeef)
+		assert(0);
+
+	assert(((*backdoor) >> 16) == 0xdead);
+
+	offset = backdoor[0] & 0xffff;
+	size = backdoor[1];
+	*backdoor = 0xbeefbeef; // Scratch sig
+
+	free(c - offset);
 #endif
 }
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/swscale_internal.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/swscale_internal.h	2009-05-02 13:54:11 UTC (rev 4786)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/swscale_internal.h	2009-05-02 13:54:13 UTC (rev 4787)
@@ -33,7 +33,7 @@
 
 #define MAX_FILTER_SIZE 256
 
-#define VOFW 2048
+#define VOFW 4096
 #define VOF  (VOFW*2)
 
 #ifdef WORDS_BIGENDIAN



From mean at mail.berlios.de  Sat May  2 15:54:23 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:54:23 +0200
Subject: [Avidemux-svn-commit] r4788 - in
	branches/avidemux_2.6_branch_mean/avidemux:
	ADM_audioParser/src ADM_libraries/ADM_ffmpeg/libavcodec
	ADM_libraries/ADM_ffmpeg/libavformat
	ADM_libraries/ADM_ffmpeg/libavutil
Message-ID: <200905021354.n42DsNED011050@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:54:19 +0200 (Sat, 02 May 2009)
New Revision: 4788

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audioParser/src/ADM_dcainfo.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ffv1.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h263dec.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h264.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12enc.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo_enc.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/utils.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/file.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/flvenc.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/isom.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/matroskaenc.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/movenc.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/avutil.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/internal.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/mem.c
Log:
[FFmpeg] Raw import, part 2

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_audioParser/src/ADM_dcainfo.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audioParser/src/ADM_dcainfo.cpp	2009-05-02 13:54:13 UTC (rev 4787)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audioParser/src/ADM_dcainfo.cpp	2009-05-02 13:54:19 UTC (rev 4788)
@@ -13,7 +13,7 @@
 {
 #include "ADM_libraries/ADM_ffmpeg/libavutil/common.h"
 #include "ADM_libraries/ADM_ffmpeg/libavutil/bswap.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/bitstream.h"
+#include "ADM_libraries/ADM_ffmpeg/libavcodec/get_bits.h"
 
 }
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h	2009-05-02 13:54:13 UTC (rev 4787)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h	2009-05-02 13:54:19 UTC (rev 4788)
@@ -511,8 +511,6 @@
 #define CODEC_FLAG2_CHUNKS        0x00008000 ///< Input bitstream might be truncated at a packet boundaries instead of only at frame boundaries.
 #define CODEC_FLAG2_NON_LINEAR_QUANT 0x00010000 ///< Use MPEG-2 nonlinear quantizer.
 #define CODEC_FLAG2_BIT_RESERVOIR 0x00020000 ///< Use a bit reservoir when encoding if possible
-//MEANX: NEVER EVER USE CLOSED GOP ?
-#define CODEC_FLAG2_32_PULLDOWN   0x80000000 
 
 /* Unsupported options :
  *              Syntax Arithmetic coding (SAC)
@@ -1359,7 +1357,6 @@
      * - decoding: unused
      */
     int rc_max_rate;
-    int rc_max_rate_header; /*< That one is set in the header MEANX */
 
     /**
      * minimum bitrate
@@ -1374,8 +1371,6 @@
      * - decoding: unused
      */
     int rc_buffer_size;
-    int rc_buffer_size_header;  /*< That one is set in the header MEANX*/
-
     float rc_buffer_aggressivity;
 
     /**

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ffv1.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ffv1.c	2009-05-02 13:54:13 UTC (rev 4787)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ffv1.c	2009-05-02 13:54:19 UTC (rev 4788)
@@ -1072,8 +1072,6 @@
         clear_state(f);
     }else{
         p->key_frame= 0;
-         p->pict_type= FF_P_TYPE; // MEANX : looks more like a P to me as user
-
     }
     if(!f->plane[0].state && !f->plane[0].vlc_state)
         return -1;

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h263dec.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h263dec.c	2009-05-02 13:54:13 UTC (rev 4787)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h263dec.c	2009-05-02 13:54:19 UTC (rev 4788)
@@ -120,24 +120,7 @@
 
     return 0;
 }
-/* MeanX : Ugly patch to detect vo ppacked stuff ... */
-int av_is_voppacked(AVCodecContext *avctx, int *vop_packed, int *gmc, int *qpel)
-{
-    MpegEncContext *s = avctx->priv_data;
-    // set sane default
-    *vop_packed=0;
-    *gmc=0;
-    *qpel=0;
-    if(avctx->codec->id!=CODEC_ID_MPEG4) return 0;
-    	
-  	*vop_packed=(s->divx_packed);
-	*qpel=s->quarter_sample;
-	*gmc=0;	// FIXME
-	return 1;
 
-  }
-  /* MeanX */
-
 av_cold int ff_h263_decode_end(AVCodecContext *avctx)
 {
     MpegEncContext *s = avctx->priv_data;
@@ -437,12 +420,6 @@
     } else {
         ret = h263_decode_picture_header(s);
     }
-	//MEANX we need to do it here also for quicktime file / ctts atom 
-        // we need the correct frame type, and qt file may contain 
-        // vop not coded frame.
-        pict->pict_type=s->current_picture.pict_type= s->pict_type;
-        pict->key_frame=s->current_picture.key_frame= s->pict_type == FF_I_TYPE;
-        //MEANX
 
     if(ret==FRAME_SKIPPED) return get_consumed_bytes(s, buf_size);
 
@@ -733,14 +710,6 @@
 
 assert(s->current_picture.pict_type == s->current_picture_ptr->pict_type);
 assert(s->current_picture.pict_type == s->pict_type);
-/* MEANX */
-  if(s->current_picture_ptr)
-      s->current_picture_ptr->opaque=pict->opaque;
-/* MEANX */
-
-
-
-
     if (s->pict_type == FF_B_TYPE || s->low_delay) {
         *pict= *(AVFrame*)s->current_picture_ptr;
     } else if (s->last_picture_ptr != NULL) {

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h264.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h264.c	2009-05-02 13:54:13 UTC (rev 4787)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h264.c	2009-05-02 13:54:19 UTC (rev 4788)
@@ -8130,18 +8130,7 @@
     return 0;
 }
 
-/* MEANX */
-int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc)
-{
-      H264Context *h = avctx->priv_data;
-      assert(h);
-      *nalSize=h->nal_length_size;
-      *isAvc=h->is_avc;
-	return 1;
 
-  }
-/* MeanX */
-
 AVCodec h264_decoder = {
     "h264",
     CODEC_TYPE_VIDEO,

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12.c	2009-05-02 13:54:13 UTC (rev 4787)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12.c	2009-05-02 13:54:19 UTC (rev 4788)
@@ -1947,12 +1947,7 @@
         ff_er_frame_end(s);
 
         MPV_frame_end(s);
-/* MEANX */
-  if(s->current_picture_ptr)
-      s->current_picture_ptr->opaque=pict->opaque;
-/* MEANX */
 
-
         if (s->pict_type == FF_B_TYPE || s->low_delay) {
             *pict= *(AVFrame*)s->current_picture_ptr;
             ff_print_debug_info(s, pict);

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12enc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12enc.c	2009-05-02 13:54:13 UTC (rev 4787)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12enc.c	2009-05-02 13:54:19 UTC (rev 4788)
@@ -127,19 +127,10 @@
             s->frame_rate_index= i;
         }
     }
- /* MEANX 
-
     if(dmin)
         return -1;
     else
         return 0;
-  */
-        if(dmin>4)
-   {
-        av_log(0,AV_LOG_ERROR,"We did a roundup ! Expect async!\n");
-   }
-        return 0; //MEANX
-
 }
 
 static av_cold int encode_init(AVCodecContext *avctx)
@@ -218,7 +209,6 @@
             put_sbits(&s->pb, 12, s->width );
             put_sbits(&s->pb, 12, s->height);
 
-#if 0 //MEANX
             for(i=1; i<15; i++){
                 float error= aspect_ratio;
                 if(s->codec_id == CODEC_ID_MPEG1VIDEO || i <=1)
@@ -233,44 +223,20 @@
                     s->aspect_ratio_info= i;
                 }
             }
-#endif // MEANX
-            //MEANX put_bits(&s->pb, 4, s->aspect_ratio_info);
-            //MEANX put_bits(&s->pb, 4, s->frame_rate_index);
- // MEANX 4:3
-  if(s->avctx->sample_aspect_ratio.num==16 && s->avctx->sample_aspect_ratio.den==9)
-            {
-                //printf("FFmpeg : Wide\n");
-                put_bits(&s->pb,4,3); //16:9
-            }
-            else        //4:3
-            {
-              if(s->codec_id == CODEC_ID_MPEG2VIDEO)
-                put_bits(&s->pb, 4, 2);
-              else
-                put_bits(&s->pb, 4, 12); // MPEG1
-            }
-// /MEANX
 
-// //MEANX PULLDOWN            put_bits(&s->pb, 4, s->frame_rate_index);
-if((s->flags2 & CODEC_FLAG2_32_PULLDOWN) && (s->codec_id == CODEC_ID_MPEG2VIDEO))
-            {           
-                put_bits(&s->pb, 4,4);
-            }
-            else
-            {                                  
-                put_bits(&s->pb, 4, s->frame_rate_index);
-            } //MEANX pulldown
+            put_bits(&s->pb, 4, s->aspect_ratio_info);
+            put_bits(&s->pb, 4, s->frame_rate_index);
 
-            if(s->avctx->rc_max_rate_header){ //MEANX we use header
-                v = (s->avctx->rc_max_rate_header + 399) / 400;
+            if(s->avctx->rc_max_rate){
+                v = (s->avctx->rc_max_rate + 399) / 400;
                 if (v > 0x3ffff && s->codec_id == CODEC_ID_MPEG1VIDEO)
                     v = 0x3ffff;
             }else{
                 v= 0x3FFFF;
             }
 
-            if(s->avctx->rc_buffer_size_header) // MEANX we use header
-                vbv_buffer_size = s->avctx->rc_buffer_size_header;
+            if(s->avctx->rc_buffer_size)
+                vbv_buffer_size = s->avctx->rc_buffer_size;
             else
                 /* VBV calculation: Scaled so that a VCD has the proper VBV size of 40 kilobytes */
                 vbv_buffer_size = (( 20 * s->bit_rate) / (1151929 / 2)) * 8 * 1024;
@@ -303,17 +269,8 @@
 
                 put_bits(&s->pb, 3, s->avctx->profile); //profile
                 put_bits(&s->pb, 4, s->avctx->level); //level
-   // MEANX pulldown put_bits(&s->pb, 1, s->progressive_sequence);
-  // MEANX Pulldown
- if(s->flags2 & CODEC_FLAG2_32_PULLDOWN) //MEANX
-                        put_bits(&s->pb, 1, 0);
-                else
-                        put_bits(&s->pb, 1, s->progressive_sequence);
 
-
-// /MEANX
-
-
+                put_bits(&s->pb, 1, s->progressive_sequence);
                 put_bits(&s->pb, 2, s->chroma_format);
                 put_bits(&s->pb, 2, s->width >>12);
                 put_bits(&s->pb, 2, s->height>>12);
@@ -377,8 +334,6 @@
 
 void mpeg1_encode_picture_header(MpegEncContext *s, int picture_number)
 {
-	int tff,rff; //MEANX
-
     mpeg1_encode_sequence_header(s);
 
     /* mpeg1 picture header */
@@ -415,49 +370,6 @@
 
     s->frame_pred_frame_dct = 1;
     if(s->codec_id == CODEC_ID_MPEG2VIDEO){
- /* MEANX -- Pulldown */
-        if(s->flags2 & CODEC_FLAG2_32_PULLDOWN)
-        {
-        
-                switch((s->picture_number - 
-                          s->gop_picture_number)&3)
-                {
-                        case 0:
-                        default:
-                                rff=1;
-                                tff=1;
-                                break;
-                        case 1:
-                                rff=0;
-                                tff=0;
-                                break;
-                        case 2:
-                                rff=1;
-                                tff=0;
-                                break;
-                        case 3:
-                                rff=0;
-                                tff=1;
-                                break;
-                }               
-           }
-        else
-        {
-                if (s->progressive_sequence) 
-                {
-                        tff=0; /* no repeat */
-                } else 
-                {
-                        tff= s->current_picture_ptr->top_field_first;
-                }
-                rff=s->repeat_first_field;
-        
-        }
-
-//               /MEANX pulldown
-
-
-
         put_header(s, EXT_START_CODE);
         put_bits(&s->pb, 4, 8); //pic ext
         if (s->pict_type == FF_P_TYPE || s->pict_type == FF_B_TYPE) {
@@ -476,16 +388,11 @@
 
         assert(s->picture_structure == PICT_FRAME);
         put_bits(&s->pb, 2, s->picture_structure);
-#if 0 //MEANX
-
         if (s->progressive_sequence) {
             put_bits(&s->pb, 1, 0); /* no repeat */
         } else {
             put_bits(&s->pb, 1, s->current_picture_ptr->top_field_first);
         }
-#endif
-         put_bits(&s->pb, 1, tff);  //MEANX PULLDOWN
-
         /* XXX: optimize the generation of this flag with entropy
            measures */
         s->frame_pred_frame_dct = s->progressive_sequence;
@@ -495,10 +402,7 @@
         put_bits(&s->pb, 1, s->q_scale_type);
         put_bits(&s->pb, 1, s->intra_vlc_format);
         put_bits(&s->pb, 1, s->alternate_scan);
- // MEANX put_bits(&s->pb, 1, s->repeat_first_field);
-	put_bits(&s->pb, 1, rff);
-      // /MEANX
-
+        put_bits(&s->pb, 1, s->repeat_first_field);
         s->progressive_frame = s->progressive_sequence;
         put_bits(&s->pb, 1, s->chroma_format == CHROMA_420 ? s->progressive_frame : 0); /* chroma_420_type */
         put_bits(&s->pb, 1, s->progressive_frame);

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo.c	2009-05-02 13:54:13 UTC (rev 4787)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo.c	2009-05-02 13:54:19 UTC (rev 4788)
@@ -610,11 +610,7 @@
     CHECKED_ALLOCZ(s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE);
 
     s->parse_context.state= -1;
- //MEANX: Allocate them always, as they may be free when we decode 1st image
-
-    // MEANXif((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
-if(1){ // MEANX
-
+    if((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
        s->visualization_buffer[0] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
        s->visualization_buffer[1] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
        s->visualization_buffer[2] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo_enc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo_enc.c	2009-05-02 13:54:13 UTC (rev 4787)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo_enc.c	2009-05-02 13:54:19 UTC (rev 4788)
@@ -349,14 +349,12 @@
 
         av_log(avctx, AV_LOG_INFO, "Warning vbv_delay will be set to 0xFFFF (=VBR) as the specified vbv buffer is too large for the given bitrate!\n");
     }
-#if 0 //MEANX
 
     if((s->flags & CODEC_FLAG_4MV) && s->codec_id != CODEC_ID_MPEG4
        && s->codec_id != CODEC_ID_H263 && s->codec_id != CODEC_ID_H263P && s->codec_id != CODEC_ID_FLV1){
         av_log(avctx, AV_LOG_ERROR, "4MV not supported by codec\n");
         return -1;
     }
-#endif
 
     if(s->obmc && s->avctx->mb_decision != FF_MB_DECISION_SIMPLE){
         av_log(avctx, AV_LOG_ERROR, "OBMC is only supported with simple mb decision\n");
@@ -389,12 +387,10 @@
         return -1;
     }
 
-#if 0 //MEANX
     if(s->mpeg_quant && s->codec_id != CODEC_ID_MPEG4){ //FIXME mpeg2 uses that too
         av_log(avctx, AV_LOG_ERROR, "mpeg2 style quantization not supported by codec\n");
         return -1;
     }
-#endif
 
     if((s->flags & CODEC_FLAG_CBP_RD) && !avctx->trellis){
         av_log(avctx, AV_LOG_ERROR, "CBP RD needs trellis quant\n");

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/utils.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/utils.c	2009-05-02 13:54:13 UTC (rev 4787)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/utils.c	2009-05-02 13:54:19 UTC (rev 4788)
@@ -596,12 +596,10 @@
 
     if((avctx->codec->capabilities & CODEC_CAP_DELAY) || avpkt->size){
         //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
-#if 0 // MEANX : Silence
         if(*frame_size_ptr < AVCODEC_MAX_AUDIO_FRAME_SIZE){
             av_log(avctx, AV_LOG_ERROR, "buffer smaller than AVCODEC_MAX_AUDIO_FRAME_SIZE\n");
             return -1;
         }
-#endif
         if(*frame_size_ptr < FF_MIN_BUFFER_SIZE ||
         *frame_size_ptr < avctx->channels * avctx->frame_size * sizeof(int16_t)){
             av_log(avctx, AV_LOG_ERROR, "buffer %d too small\n", *frame_size_ptr);
@@ -1025,7 +1023,7 @@
         return -1;
     }
 #if !HAVE_MKSTEMP
-    fd = open(*filename, O_RDWR /* MEANX | O_BINARY*/ | O_CREAT, 0444);
+    fd = open(*filename, O_RDWR | O_BINARY | O_CREAT, 0444);
 #else
     snprintf(*filename, len, "/tmp/%sXXXXXX", prefix);
     fd = mkstemp(*filename);

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/file.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/file.c	2009-05-02 13:54:13 UTC (rev 4787)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/file.c	2009-05-02 13:54:19 UTC (rev 4788)
@@ -30,73 +30,7 @@
 #include <stdlib.h>
 #include "os_support.h"
 
-// GRUNTSTER start
-#ifdef __WIN32
-#include <windows.h>
 
-int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString)
-{
-	int wideCharStringLength = MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, NULL, 0);
-
-	if (wideCharString)
-		MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, wideCharString, wideCharStringLength);
-
-	return wideCharStringLength;
-}
-
-int ADM_open(const char *path, int oflag, ...)
-{
-	int fileNameLength = utf8StringToWideChar(path, -1, NULL);
-	wchar_t wcFile[fileNameLength];
-	int creation = 0, access = 0;
-	HANDLE hFile;
-
-	utf8StringToWideChar(path, -1, wcFile);
-
-	if (oflag & O_WRONLY || oflag & O_RDWR)
-	{
-		access = GENERIC_WRITE;
-
-		if (oflag & O_RDWR)
-			access |= GENERIC_READ;
-
-		if (oflag & O_CREAT)
-		{
-			if (oflag & O_EXCL)
-				creation = CREATE_NEW;
-			else if (oflag & O_TRUNC)
-				creation = CREATE_ALWAYS;
-			else
-				creation = OPEN_ALWAYS;
-		}
-		else if (oflag & O_TRUNC)
-			creation = TRUNCATE_EXISTING;
-	}
-	else if (oflag & O_RDONLY)
-		creation = OPEN_EXISTING;
-
-	if (creation & GENERIC_WRITE)
-	{
-		hFile = CreateFileW(wcFile, access, 0, NULL, creation, 0, NULL);
-
-		if (hFile == INVALID_HANDLE_VALUE)
-			return -1;
-		else
-			CloseHandle(hFile);
-	}
-
-	hFile = CreateFileW(wcFile, access, FILE_SHARE_READ, NULL, creation, 0, NULL);
-
-	if (hFile == INVALID_HANDLE_VALUE)
-		return -1;
-	else
-		return _open_osfhandle((intptr_t)hFile, oflag);
-}
-
-#define open ADM_open
-#endif
-// GRUNTSTER end
-
 /* standard file protocol */
 
 static int file_open(URLContext *h, const char *filename, int flags)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/flvenc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/flvenc.c	2009-05-02 13:54:13 UTC (rev 4787)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/flvenc.c	2009-05-02 13:54:19 UTC (rev 4788)
@@ -389,8 +389,7 @@
     "video/x-flv",
     "flv",
     sizeof(FLVContext),
-//MEANX #if CONFIG_LIBMP3LAME
-#ifdef HAVE_LIBMP3LAME
+#if CONFIG_LIBMP3LAME
     CODEC_ID_MP3,
 #else // CONFIG_LIBMP3LAME
     CODEC_ID_ADPCM_SWF,
@@ -402,9 +401,3 @@
     .codec_tag= (const AVCodecTag* const []){flv_video_codec_ids, flv_audio_codec_ids, 0},
     .flags= AVFMT_GLOBALHEADER,
 };
-// MEANX
-int flvenc_init(void)
-{
-    av_register_output_format(&flv_muxer);
-    return 0;
-}
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/isom.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/isom.c	2009-05-02 13:54:13 UTC (rev 4787)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/isom.c	2009-05-02 13:54:19 UTC (rev 4788)
@@ -187,10 +187,7 @@
     { CODEC_ID_MACE3, MKTAG('M', 'A', 'C', '3') }, /* Macintosh Audio Compression and Expansion 3:1 */
     { CODEC_ID_MACE6, MKTAG('M', 'A', 'C', '6') }, /* Macintosh Audio Compression and Expansion 6:1 */
 
-    //MEANX { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at http://www.3ivx.com/showcase.html use this tag */
-     { CODEC_ID_MP3, MKTAG( 'm', 'p', '4','a') },
-     { CODEC_ID_MP2, MKTAG( 'm', 'p', '4', 'a') },
-    // /MEANX
+    { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at http://www.3ivx.com/showcase.html use this tag */
     { CODEC_ID_MP3, 0x6D730055 }, /* MPEG layer 3 */
 
 /*  { CODEC_ID_OGG_VORBIS, MKTAG('O', 'g', 'g', 'S') }, *//* sample files at http://heroinewarrior.com/xmovie.php3 use this tag */

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/matroskaenc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/matroskaenc.c	2009-05-02 13:54:13 UTC (rev 4787)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/matroskaenc.c	2009-05-02 13:54:19 UTC (rev 4788)
@@ -395,7 +395,6 @@
 
 static int put_xiph_codecpriv(AVFormatContext *s, ByteIOContext *pb, AVCodecContext *codec)
 {
-#if 0 // MEANX avidemux does thing differently
     uint8_t *header_start[3];
     int header_len[3];
     int first_header_size;
@@ -420,28 +419,6 @@
         put_buffer(pb, header_start[j], header_len[j]);
 
     return 0;
-#else
-   // Not endian safe....
-      uint32_t packetLen[3],*ptr=(uint32_t *)codec->extradata;
-      uint8_t *data[3],i,j;
-      if( 3*4+ptr[0]+ptr[1]+ptr[2]!=codec->extradata_size)
-      {
-        av_log(s, AV_LOG_ERROR, "Broken avidemux xiph header.\n");
-        return -1;
-      }
-      data[0]=codec->extradata+3*4;
-      data[1]=data[0]+ptr[0];
-      data[2]=data[1]+ptr[1];
-      put_byte(pb, 2);                    // number packets - 1
-      for (j = 0; j < 2; j++) 
-      {
-          put_xiph_size(pb, ptr[j]);
-      }
-      for (j = 0; j < 3; j++)
-        put_buffer(pb, data[j], ptr[j]);
-      
-      return 0; // /MEANX
-#endif
 }
 
 static void get_aac_sample_rates(AVFormatContext *s, AVCodecContext *codec, int *sample_rate, int *output_sample_rate)
@@ -557,23 +534,6 @@
         put_ebml_uint (pb, MATROSKA_ID_TRACKNUMBER     , i + 1);
         put_ebml_uint (pb, MATROSKA_ID_TRACKUID        , i + 1);
         put_ebml_uint (pb, MATROSKA_ID_TRACKFLAGLACING , 0);    // no lacing (yet)
-/**  MEANX : Add a default duration for video **/
-        if(codec->codec_type==CODEC_TYPE_VIDEO)
-        {
-          if(codec->time_base.den && codec->time_base.num)
-          {
-            int num=codec->time_base.num;
-            int den=codec->time_base.den;
-            unsigned int default_duration;
-            float period=num;
-                  period/=den;
-                  period*=1000*1000*1000; // in ns
-                  default_duration=(unsigned int)floor(period);
-                  put_ebml_uint (pb, MATROSKA_ID_TRACKDEFAULTDURATION ,default_duration);
-          }
-        }
-        
-/**  MEANX : Add a default duration for video **/
 
         if ((tag = av_metadata_get(st->metadata, "description", NULL, 0)))
             put_ebml_string(pb, MATROSKA_ID_TRACKNAME, tag->value);
@@ -947,13 +907,3 @@
     .flags = AVFMT_GLOBALHEADER,
     .codec_tag = (const AVCodecTag* const []){codec_wav_tags, 0},
 };
-// MEANX
-//
-int matroskaenc_init(void)
-{
-    av_register_output_format(&matroska_muxer);
-    return 0;
-}
-// /MEANX
-
-

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/movenc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/movenc.c	2009-05-02 13:54:13 UTC (rev 4787)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/movenc.c	2009-05-02 13:54:19 UTC (rev 4788)
@@ -2017,15 +2017,3 @@
     .codec_tag = (const AVCodecTag* const []){codec_ipod_tags, 0},
 };
 #endif
-/* MEANX */
-int movenc_init(void)
-{
-    av_register_output_format(&mov_muxer);
-    av_register_output_format(&tgp_muxer);
-    av_register_output_format(&mp4_muxer);
-    av_register_output_format(&psp_muxer);
-    av_register_output_format(&tg2_muxer);
-    av_register_output_format(&ipod_muxer);
-    return 0;
-}
-/* MEANX */

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/avutil.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/avutil.h	2009-05-02 13:54:13 UTC (rev 4787)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/avutil.h	2009-05-02 13:54:19 UTC (rev 4788)
@@ -26,14 +26,7 @@
  * external API header
  */
 
-/* MEANX
- * - */
-#define ASMALIGN(ZEROBITS) ".p2align " #ZEROBITS "\n\t"
-/* /MEANX
- */
 
-
-
 #define AV_STRINGIFY(s)         AV_TOSTRING(s)
 #define AV_TOSTRING(s) #s
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/internal.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/internal.h	2009-05-02 13:54:13 UTC (rev 4787)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/internal.h	2009-05-02 13:54:19 UTC (rev 4788)
@@ -215,14 +215,12 @@
 #endif
 
 /* avoid usage of dangerous/inappropriate system functions */
-#if 0 //MEANX
 #undef  malloc
 #define malloc please_use_av_malloc
 #undef  free
 #define free please_use_av_free
 #undef  realloc
 #define realloc please_use_av_realloc
-#endif
 #undef  time
 #define time time_is_forbidden_due_to_security_issues
 #undef  rand

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/mem.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/mem.c	2009-05-02 13:54:13 UTC (rev 4787)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/mem.c	2009-05-02 13:54:19 UTC (rev 4788)
@@ -46,110 +46,87 @@
 
 void *av_malloc(unsigned int size)
 {
-#ifdef __APPLE__
-	return malloc(size);
-#else
-	char *c;
+    void *ptr = NULL;
+#if CONFIG_MEMALIGN_HACK
+    long diff;
+#endif
 
-	uint64_t l, lorg;
-	uint32_t *backdoor;
+    /* let's disallow possible ambiguous cases */
+    if(size > (INT_MAX-16) )
+        return NULL;
 
-	l = (uint64_t)malloc(size + 32);
+#if CONFIG_MEMALIGN_HACK
+    ptr = malloc(size+16);
+    if(!ptr)
+        return ptr;
+    diff= ((-(long)ptr - 1)&15) + 1;
+    ptr = (char*)ptr + diff;
+    ((char*)ptr)[-1]= diff;
+#elif HAVE_POSIX_MEMALIGN
+    if (posix_memalign(&ptr,16,size))
+        ptr = NULL;
+#elif HAVE_MEMALIGN
+    ptr = memalign(16,size);
+    /* Why 64?
+       Indeed, we should align it:
+         on 4 for 386
+         on 16 for 486
+         on 32 for 586, PPro - K6-III
+         on 64 for K7 (maybe for P3 too).
+       Because L1 and L2 caches are aligned on those values.
+       But I don't want to code such logic here!
+     */
+     /* Why 16?
+        Because some CPUs need alignment, for example SSE2 on P4, & most RISC CPUs
+        it will just trigger an exception and the unaligned load will be done in the
+        exception handler or it will just segfault (SSE2 on P4).
+        Why not larger? Because I did not see a difference in benchmarks ...
+     */
+     /* benchmarks with P3
+        memalign(64)+1          3071,3051,3032
+        memalign(64)+2          3051,3032,3041
+        memalign(64)+4          2911,2896,2915
+        memalign(64)+8          2545,2554,2550
+        memalign(64)+16         2543,2572,2563
+        memalign(64)+32         2546,2545,2571
+        memalign(64)+64         2570,2533,2558
 
-	// Get next boundary
-	lorg = l;
-	l = (l + 15) & 0xfffffffffffffff0LL;
-	l += 16;
-	c = (char*)l;
-	backdoor = (uint32_t*)(c - 8);
-	*backdoor = (0xdead << 16) + l - lorg;
-	backdoor[1] = size;
-
-	return c;
+        BTW, malloc seems to do 8-byte alignment by default here.
+     */
+#else
+    ptr = malloc(size);
 #endif
+    return ptr;
 }
 
-void *av_realloc(void *ptr, unsigned int newsize)
+void *av_realloc(void *ptr, unsigned int size)
 {
-#ifdef __APPLE__
-	if (!ptr)
-		return av_malloc(newsize);
+#if CONFIG_MEMALIGN_HACK
+    int diff;
+#endif
 
-	if (!newsize)
-	{
-		av_free(ptr);
-		return NULL;
-	}
+    /* let's disallow possible ambiguous cases */
+    if(size > (INT_MAX-16) )
+        return NULL;
 
-	return realloc(ptr, newsize);
+#if CONFIG_MEMALIGN_HACK
+    //FIXME this isn't aligned correctly, though it probably isn't needed
+    if(!ptr) return av_malloc(size);
+    diff= ((char*)ptr)[-1];
+    return (char*)realloc((char*)ptr - diff, size + diff) + diff;
 #else
-	void *nalloc;
-
-	if (!ptr)
-		return av_malloc(newsize);
-
-	if (!newsize) 
-	{
-		av_free(ptr);
-		return NULL;
-	}
-
-	// now we either shrink them or expand them
-	// in case of shrink, we do nothing
-	// in case of expand we have to copy
-	// Do copy everytime (slower)
-	uint32_t *backdoor;
-	uint32_t size, offset;
-	char *c = (char*)ptr;
-
-	backdoor = (uint32_t*)ptr;
-	backdoor -= 2;
-
-	assert(((*backdoor) >> 16) == 0xdead);
-
-	offset = backdoor[0] & 0xffff;
-	size = backdoor[1];
-
-	if(size >= newsize) // do nothing
-		return ptr;
-
-	// Allocate a new one
-	nalloc = av_malloc(newsize);
-	memcpy(nalloc, ptr, size);
-	av_free(ptr);
-
-	return nalloc;
+    return realloc(ptr, size);
 #endif
 }
 
 void av_free(void *ptr)
 {
-#ifdef __APPLE__
-	if (!ptr)
-		return;
-
-	free(ptr);
+    /* XXX: this test should not be needed on most libcs */
+    if (ptr)
+#if CONFIG_MEMALIGN_HACK
+        free((char*)ptr - ((char*)ptr)[-1]);
 #else
-	uint32_t *backdoor;
-	uint32_t size, offset;
-	char *c = (char*)ptr;
-
-	if (!ptr)
-		return;
-
-	backdoor = (uint32_t*)ptr;
-	backdoor -= 2;
-
-	if (*backdoor == 0xbeefbeef)
-		assert(0);
-
-	assert(((*backdoor) >> 16) == 0xdead);
-
-	offset = backdoor[0] & 0xffff;
-	size = backdoor[1];
-	*backdoor = 0xbeefbeef; // Scratch sig
-
-	free(c - offset);
+        free(ptr);
 #endif
 }
 



From mean at mail.berlios.de  Sat May  2 15:54:37 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:54:37 +0200
Subject: [Avidemux-svn-commit] r4790 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config
Message-ID: <200905021354.n42DsbXC011111@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:54:37 +0200 (Sat, 02 May 2009)
New Revision: 4790

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/config.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/ffconf.c
Log:
[FFconf]

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/config.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/config.h	2009-05-02 13:54:26 UTC (rev 4789)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/config.h	2009-05-02 13:54:37 UTC (rev 4790)
@@ -1,389 +1,385 @@
 #include "ADM_coreConfig.h"
-#define ENABLE_NELLYMOSER_DECODER 1
+#define CONFIG_H263_VAAPI_HWACCEL 0
+#define CONFIG_MPEG2_VAAPI_HWACCEL 0
+#define CONFIG_MPEG4_VAAPI_HWACCEL 0
+#define CONFIG_VC1_VAAPI_HWACCEL 0
+#define CONFIG_WMV3_VAAPI_HWACCEL 0
+#define CONFIG_MPEG_VDPAU_DECODER 0
+#define CONFIG_MPEG1_VDPAU_DECODER 0
+#define CONFIG_VDPAU_VDPAU_DECODER 0
+#define CONFIG_VC1_VDPAU_DECODER 0
+#define CONFIG_WMV3_VDPAU_DECODER 0
+#define CONFIG_H264_VDPAU_DECODER 0
 #define CONFIG_NELLYMOSER_DECODER 1
-#define ENABLE_ADPCM_IMA_AMV_DECODER 1
 #define CONFIG_ADPCM_IMA_AMV_DECODER 1
-#define ENABLE_CINEPAK_DECODER 1
 #define CONFIG_CINEPAK_DECODER 1
-#define ENABLE_DNXHD_DECODER 1
 #define CONFIG_DNXHD_DECODER 1
-#define ENABLE_FOURXM_DECODER 1
 #define CONFIG_FOURXM_DECODER 1
-#define ENABLE_FRAPS_DECODER 1
 #define CONFIG_FRAPS_DECODER 1
-#define ENABLE_H263_DECODER 1
 #define CONFIG_H263_DECODER 1
-#define ENABLE_H264_DECODER 1
 #define CONFIG_H264_DECODER 1
-#define ENABLE_INDEO2_DECODER 1
 #define CONFIG_INDEO2_DECODER 1
-#define ENABLE_INDEO3_DECODER 1
 #define CONFIG_INDEO3_DECODER 1
-#define ENABLE_INTERPLAY_VIDEO_DECODER 1
 #define CONFIG_INTERPLAY_VIDEO_DECODER 1
-#define ENABLE_MPEGVIDEO_DECODER 1
 #define CONFIG_MPEGVIDEO_DECODER 1
-#define ENABLE_MSVIDEO1_DECODER 1
 #define CONFIG_MSVIDEO1_DECODER 1
-#define ENABLE_VC1_DECODER 1
 #define CONFIG_VC1_DECODER 1
-#define ENABLE_VCR1_DECODER 1
 #define CONFIG_VCR1_DECODER 1
-#define ENABLE_VP5_DECODER 1
 #define CONFIG_VP5_DECODER 1
-#define ENABLE_VP6_DECODER 1
 #define CONFIG_VP6_DECODER 1
-#define ENABLE_VP6A_DECODER 1
 #define CONFIG_VP6A_DECODER 1
-#define ENABLE_VP6F_DECODER 1
 #define CONFIG_VP6F_DECODER 1
-#define ENABLE_WMV3_DECODER 1
 #define CONFIG_WMV3_DECODER 1
-#define ENABLE_WMV1_DECODER 1
 #define CONFIG_WMV1_DECODER 1
-#define ENABLE_WMV2_DECODER 1
 #define CONFIG_WMV2_DECODER 1
-#define ENABLE_VP3_DECODER 1
 #define CONFIG_VP3_DECODER 1
-#define ENABLE_MPEG4_DECODER 1
 #define CONFIG_MPEG4_DECODER 1
-#define ENABLE_MSMPEG4V1_DECODER 1
 #define CONFIG_MSMPEG4V1_DECODER 1
-#define ENABLE_MSMPEG4V2_DECODER 1
 #define CONFIG_MSMPEG4V2_DECODER 1
-#define ENABLE_MSMPEG4V3_DECODER 1
 #define CONFIG_MSMPEG4V3_DECODER 1
-#define ENABLE_MJPEGB_DECODER 1
 #define CONFIG_MJPEGB_DECODER 1
-#define ENABLE_MJPEG_DECODER 1
 #define CONFIG_MJPEG_DECODER 1
-#define ENABLE_WMAV2_DECODER 1
 #define CONFIG_WMAV2_DECODER 1
-#define ENABLE_DVVIDEO_DECODER 1
 #define CONFIG_DVVIDEO_DECODER 1
-#define ENABLE_HUFFYUV_DECODER 1
 #define CONFIG_HUFFYUV_DECODER 1
-#define ENABLE_FFVHUFF_DECODER 1
 #define CONFIG_FFVHUFF_DECODER 1
-#define ENABLE_SVQ3_DECODER 1
 #define CONFIG_SVQ3_DECODER 1
-#define ENABLE_TSCC_DECODER 1
 #define CONFIG_TSCC_DECODER 1
-#define ENABLE_QDM2_DECODER 1
 #define CONFIG_QDM2_DECODER 1
-#define ENABLE_FFV1_DECODER 1
 #define CONFIG_FFV1_DECODER 1
-#define ENABLE_MPEG1VIDEO_DECODER 1
 #define CONFIG_MPEG1VIDEO_DECODER 1
-#define ENABLE_MPEG2VIDEO_DECODER 1
 #define CONFIG_MPEG2VIDEO_DECODER 1
-#define ENABLE_RV10_DECODER 1
 #define CONFIG_RV10_DECODER 1
-#define ENABLE_RV20_DECODER 1
 #define CONFIG_RV20_DECODER 1
-#define ENABLE_DVBSUB_DECODER 1
 #define CONFIG_DVBSUB_DECODER 1
-#define ENABLE_FLV_DECODER 1
 #define CONFIG_FLV_DECODER 1
-#define ENABLE_SNOW_DECODER 1
 #define CONFIG_SNOW_DECODER 1
-#define ENABLE_AMV_DECODER 1
 #define CONFIG_AMV_DECODER 1
-#define ENABLE_H264_VDPAU_DECODER 0
-#define ENABLE_EATGQ_DECODER 0
-#define ENABLE_PCX_DECODER 0
-#define ENABLE_SUNRAST_DECODER 0
-#define ENABLE_VB_DECODER 0
-#define ENABLE_XSUB_DECODER 0
-#define ENABLE_AC3_DECODER 0
-#define ENABLE_APE_DECODER 0
-#define ENABLE_MPC8_DECODER 0
-#define ENABLE_PCM_S16LE_PLANAR_DECODER 0
-#define ENABLE_PCM_ZORK_DECODER 0
-#define ENABLE_ADPCM_EA_R1_DECODER 0
-#define ENABLE_ADPCM_EA_R2_DECODER 0
-#define ENABLE_ADPCM_EA_R3_DECODER 0
-#define ENABLE_ADPCM_EA_XAS_DECODER 0
-#define ENABLE_ADPCM_IMA_EA_EACS_DECODER 0
-#define ENABLE_ADPCM_IMA_EA_SEAD_DECODER 0
-#define ENABLE_AASC_DECODER 0
-#define ENABLE_AVS_DECODER 0
-#define ENABLE_BETHSOFTVID_DECODER 0
-#define ENABLE_C93_DECODER 0
-#define ENABLE_CAVS_DECODER 0
-#define ENABLE_CLJR_DECODER 0
-#define ENABLE_CSCD_DECODER 0
-#define ENABLE_CYUV_DECODER 0
-#define ENABLE_DSICINVIDEO_DECODER 0
-#define ENABLE_DXA_DECODER 0
-#define ENABLE_EIGHTBPS_DECODER 0
-#define ENABLE_FLIC_DECODER 0
-#define ENABLE_IDCIN_DECODER 0
-#define ENABLE_KMVC_DECODER 0
-#define ENABLE_LOCO_DECODER 0
-#define ENABLE_MDEC_DECODER 0
-#define ENABLE_MMVIDEO_DECODER 0
-#define ENABLE_MPEG_XVMC_DECODER 0
-#define ENABLE_MSRLE_DECODER 0
-#define ENABLE_MSZH_DECODER 0
-#define ENABLE_NUV_DECODER 0
-#define ENABLE_PTX_DECODER 0
-#define ENABLE_QDRAW_DECODER 0
-#define ENABLE_QPEG_DECODER 0
-#define ENABLE_RPZA_DECODER 0
-#define ENABLE_SMACKER_DECODER 0
-#define ENABLE_SMC_DECODER 0
-#define ENABLE_SP5X_DECODER 0
-#define ENABLE_THEORA_DECODER 0
-#define ENABLE_THP_DECODER 0
-#define ENABLE_TIERTEXSEQVIDEO_DECODER 0
-#define ENABLE_TRUEMOTION1_DECODER 0
-#define ENABLE_TRUEMOTION2_DECODER 0
-#define ENABLE_TXD_DECODER 0
-#define ENABLE_ULTI_DECODER 0
-#define ENABLE_VMDVIDEO_DECODER 0
-#define ENABLE_VMNC_DECODER 0
-#define ENABLE_VQA_DECODER 0
-#define ENABLE_WNV1_DECODER 0
-#define ENABLE_XAN_WC3_DECODER 0
-#define ENABLE_XL_DECODER 0
-#define ENABLE_MPEG4AAC_DECODER 0
-#define ENABLE_ALAC_DECODER 0
-#define ENABLE_ATRAC3_DECODER 0
-#define ENABLE_COOK_DECODER 0
-#define ENABLE_DCA_DECODER 0
-#define ENABLE_DSICINAUDIO_DECODER 0
-#define ENABLE_IMC_DECODER 0
-#define ENABLE_LIBA52_DECODER 0
-#define ENABLE_LIBFAAD_DECODER 0
-#define ENABLE_MACE3_DECODER 0
-#define ENABLE_MACE6_DECODER 0
-#define ENABLE_MP3_DECODER 0
-#define ENABLE_MP3ADU_DECODER 0
-#define ENABLE_MP3ON4_DECODER 0
-#define ENABLE_MPC7_DECODER 0
-#define ENABLE_RA_144_DECODER 0
-#define ENABLE_RA_288_DECODER 0
-#define ENABLE_SHORTEN_DECODER 0
-#define ENABLE_SMACKAUD_DECODER 0
-#define ENABLE_TRUESPEECH_DECODER 0
-#define ENABLE_TTA_DECODER 0
-#define ENABLE_VMDAUDIO_DECODER 0
-#define ENABLE_WAVPACK_DECODER 0
-#define ENABLE_WS_SND1_DECODER 0
-#define ENABLE_INTERPLAY_DPCM_DECODER 0
-#define ENABLE_SOL_DPCM_DECODER 0
-#define ENABLE_XAN_DPCM_DECODER 0
-#define ENABLE_ADPCM_THP_DECODER 0
-#define ENABLE_ASV1_DECODER 0
-#define ENABLE_ASV2_DECODER 0
-#define ENABLE_BMP_DECODER 0
-#define ENABLE_FLASHSV_DECODER 0
-#define ENABLE_GIF_DECODER 0
-#define ENABLE_H261_DECODER 0
-#define ENABLE_H263I_DECODER 0
-#define ENABLE_JPEGLS_DECODER 0
-#define ENABLE_PNG_DECODER 0
-#define ENABLE_QTRLE_DECODER 0
-#define ENABLE_RAWVIDEO_DECODER 0
-#define ENABLE_ROQ_DECODER 0
-#define ENABLE_SGI_DECODER 0
-#define ENABLE_SVQ1_DECODER 0
-#define ENABLE_TARGA_DECODER 0
-#define ENABLE_TIFF_DECODER 0
-#define ENABLE_ZLIB_DECODER 0
-#define ENABLE_ZMBV_DECODER 0
-#define ENABLE_FLAC_DECODER 0
-#define ENABLE_LIBAMR_NB_DECODER 0
-#define ENABLE_LIBAMR_WB_DECODER 0
-#define ENABLE_LIBGSM_DECODER 0
-#define ENABLE_LIBGSM_MS_DECODER 0
-#define ENABLE_MP2_DECODER 0
-#define ENABLE_SONIC_DECODER 0
-#define ENABLE_VORBIS_DECODER 0
-#define ENABLE_WMAV1_DECODER 0
-#define ENABLE_PCM_ALAW_DECODER 0
-#define ENABLE_PCM_MULAW_DECODER 0
-#define ENABLE_PCM_S8_DECODER 0
-#define ENABLE_PCM_S16BE_DECODER 0
-#define ENABLE_PCM_S16LE_DECODER 0
-#define ENABLE_PCM_S24BE_DECODER 0
-#define ENABLE_PCM_S24DAUD_DECODER 0
-#define ENABLE_PCM_S24LE_DECODER 0
-#define ENABLE_PCM_S32BE_DECODER 0
-#define ENABLE_PCM_S32LE_DECODER 0
-#define ENABLE_PCM_U8_DECODER 0
-#define ENABLE_PCM_U16BE_DECODER 0
-#define ENABLE_PCM_U16LE_DECODER 0
-#define ENABLE_PCM_U24BE_DECODER 0
-#define ENABLE_PCM_U24LE_DECODER 0
-#define ENABLE_PCM_U32BE_DECODER 0
-#define ENABLE_PCM_U32LE_DECODER 0
-#define ENABLE_ROQ_DPCM_DECODER 0
-#define ENABLE_ADPCM_4XM_DECODER 0
-#define ENABLE_ADPCM_ADX_DECODER 0
-#define ENABLE_ADPCM_CT_DECODER 0
-#define ENABLE_ADPCM_EA_DECODER 0
-#define ENABLE_ADPCM_G726_DECODER 0
-#define ENABLE_ADPCM_IMA_DK3_DECODER 0
-#define ENABLE_ADPCM_IMA_DK4_DECODER 0
-#define ENABLE_ADPCM_IMA_QT_DECODER 0
-#define ENABLE_ADPCM_IMA_SMJPEG_DECODER 0
-#define ENABLE_ADPCM_IMA_WAV_DECODER 0
-#define ENABLE_ADPCM_IMA_WS_DECODER 0
-#define ENABLE_ADPCM_MS_DECODER 0
-#define ENABLE_ADPCM_SBPRO_2_DECODER 0
-#define ENABLE_ADPCM_SBPRO_3_DECODER 0
-#define ENABLE_ADPCM_SBPRO_4_DECODER 0
-#define ENABLE_ADPCM_SWF_DECODER 0
-#define ENABLE_ADPCM_XA_DECODER 0
-#define ENABLE_ADPCM_YAMAHA_DECODER 0
-#define ENABLE_DVDSUB_DECODER 0
-#define ENABLE_LIBVORBIS_DECODER 0
-#define ENABLE_H263_PARSER 1
-#define ENABLE_H264_PARSER 1
-#define ENABLE_MPEG4VIDEO_PARSER 1
-#define ENABLE_AAC_PARSER 0
-#define ENABLE_AC3_PARSER 0
-#define ENABLE_CAVSVIDEO_PARSER 0
-#define ENABLE_DCA_PARSER 0
-#define ENABLE_DVBSUB_PARSER 0
-#define ENABLE_DVDSUB_PARSER 0
-#define ENABLE_H261_PARSER 0
-#define ENABLE_MJPEG_PARSER 0
-#define ENABLE_MPEGAUDIO_PARSER 0
-#define ENABLE_MPEGVIDEO_PARSER 0
-#define ENABLE_PNM_PARSER 0
-#define ENABLE_VC1_PARSER 0
-#define ENABLE_MJPEG_ENCODER 1
+#define CONFIG_LIBSPEEX_DECODER 0
+#define CONFIG_LIBSCHROEDINGER_DECODER 0
+#define CONFIG_LIBOPENJPEG_DECODER 0
+#define CONFIG_LIBDIRAC_DECODER 0
+#define CONFIG_ADPCM_IMA_ISS_DECODER 0
+#define CONFIG_ADPCM_EA_MAXIS_XA_DECODER 0
+#define CONFIG_PCM_F64LE_DECODER 0
+#define CONFIG_PCM_F64BE_DECODER 0
+#define CONFIG_PCM_F32LE_DECODER 0
+#define CONFIG_PCM_F32BE_DECODER 0
+#define CONFIG_PCM_DVD_DECODER 0
+#define CONFIG_TRUEHD_DECODER 0
+#define CONFIG_QCELP_DECODER 0
+#define CONFIG_MP1_DECODER 0
+#define CONFIG_MLP_DECODER 0
+#define CONFIG_ALAC_DECODER 0
+#define CONFIG_EAC3_DECODER 0
+#define CONFIG_AAC_DECODER 0
+#define CONFIG_PGMYUV_DECODER 0
+#define CONFIG_PPM_DECODER 0
+#define CONFIG_EATGV_DECODER 0
+#define CONFIG_EATQI_DECODER 0
+#define CONFIG_EIGHTSVX_EXP_DECODER 0
+#define CONFIG_EIGHTSVX_FIB_DECODER 0
+#define CONFIG_ESCAPE124_DECODER 0
+#define CONFIG_MIMIC_DECODER 0
+#define CONFIG_MOTIONPIXELS_DECODER 0
+#define CONFIG_PAM_DECODER 0
+#define CONFIG_PBM_DECODER 0
+#define CONFIG_PGM_DECODER 0
+#define CONFIG_RL2_DECODER 0
+#define CONFIG_RV30_DECODER 0
+#define CONFIG_RV40_DECODER 0
+#define CONFIG_V210X_DECODER 0
+#define CONFIG_BFI_DECODER 0
+#define CONFIG_EACMV_DECODER 0
+#define CONFIG_EATGQ_DECODER 0
+#define CONFIG_PCX_DECODER 0
+#define CONFIG_SUNRAST_DECODER 0
+#define CONFIG_VB_DECODER 0
+#define CONFIG_XSUB_DECODER 0
+#define CONFIG_AC3_DECODER 0
+#define CONFIG_APE_DECODER 0
+#define CONFIG_MPC8_DECODER 0
+#define CONFIG_PCM_S16LE_PLANAR_DECODER 0
+#define CONFIG_PCM_ZORK_DECODER 0
+#define CONFIG_ADPCM_EA_R1_DECODER 0
+#define CONFIG_ADPCM_EA_R2_DECODER 0
+#define CONFIG_ADPCM_EA_R3_DECODER 0
+#define CONFIG_ADPCM_EA_XAS_DECODER 0
+#define CONFIG_ADPCM_IMA_EA_EACS_DECODER 0
+#define CONFIG_ADPCM_IMA_EA_SEAD_DECODER 0
+#define CONFIG_AASC_DECODER 0
+#define CONFIG_AVS_DECODER 0
+#define CONFIG_BETHSOFTVID_DECODER 0
+#define CONFIG_C93_DECODER 0
+#define CONFIG_CAVS_DECODER 0
+#define CONFIG_CLJR_DECODER 0
+#define CONFIG_CSCD_DECODER 0
+#define CONFIG_CYUV_DECODER 0
+#define CONFIG_DSICINVIDEO_DECODER 0
+#define CONFIG_DXA_DECODER 0
+#define CONFIG_EIGHTBPS_DECODER 0
+#define CONFIG_FLIC_DECODER 0
+#define CONFIG_IDCIN_DECODER 0
+#define CONFIG_KMVC_DECODER 0
+#define CONFIG_LOCO_DECODER 0
+#define CONFIG_MDEC_DECODER 0
+#define CONFIG_MMVIDEO_DECODER 0
+#define CONFIG_MPEG_XVMC_DECODER 0
+#define CONFIG_MSRLE_DECODER 0
+#define CONFIG_MSZH_DECODER 0
+#define CONFIG_NUV_DECODER 0
+#define CONFIG_PTX_DECODER 0
+#define CONFIG_QDRAW_DECODER 0
+#define CONFIG_QPEG_DECODER 0
+#define CONFIG_RPZA_DECODER 0
+#define CONFIG_SMACKER_DECODER 0
+#define CONFIG_SMC_DECODER 0
+#define CONFIG_SP5X_DECODER 0
+#define CONFIG_THEORA_DECODER 0
+#define CONFIG_THP_DECODER 0
+#define CONFIG_TIERTEXSEQVIDEO_DECODER 0
+#define CONFIG_TRUEMOTION1_DECODER 0
+#define CONFIG_TRUEMOTION2_DECODER 0
+#define CONFIG_TXD_DECODER 0
+#define CONFIG_ULTI_DECODER 0
+#define CONFIG_VMDVIDEO_DECODER 0
+#define CONFIG_VMNC_DECODER 0
+#define CONFIG_VQA_DECODER 0
+#define CONFIG_WNV1_DECODER 0
+#define CONFIG_XAN_WC3_DECODER 0
+#define CONFIG_XL_DECODER 0
+#define CONFIG_MPEG4AAC_DECODER 0
+#define CONFIG_ALAC_DECODER 0
+#define CONFIG_ATRAC3_DECODER 0
+#define CONFIG_COOK_DECODER 0
+#define CONFIG_DCA_DECODER 0
+#define CONFIG_DSICINAUDIO_DECODER 0
+#define CONFIG_IMC_DECODER 0
+#define CONFIG_LIBA52_DECODER 0
+#define CONFIG_LIBFAAD_DECODER 0
+#define CONFIG_MACE3_DECODER 0
+#define CONFIG_MACE6_DECODER 0
+#define CONFIG_MP3_DECODER 0
+#define CONFIG_MP3ADU_DECODER 0
+#define CONFIG_MP3ON4_DECODER 0
+#define CONFIG_MPC7_DECODER 0
+#define CONFIG_RA_144_DECODER 0
+#define CONFIG_RA_288_DECODER 0
+#define CONFIG_SHORTEN_DECODER 0
+#define CONFIG_SMACKAUD_DECODER 0
+#define CONFIG_TRUESPEECH_DECODER 0
+#define CONFIG_TTA_DECODER 0
+#define CONFIG_VMDAUDIO_DECODER 0
+#define CONFIG_WAVPACK_DECODER 0
+#define CONFIG_WS_SND1_DECODER 0
+#define CONFIG_INTERPLAY_DPCM_DECODER 0
+#define CONFIG_SOL_DPCM_DECODER 0
+#define CONFIG_XAN_DPCM_DECODER 0
+#define CONFIG_ADPCM_THP_DECODER 0
+#define CONFIG_ASV1_DECODER 0
+#define CONFIG_ASV2_DECODER 0
+#define CONFIG_BMP_DECODER 0
+#define CONFIG_FLASHSV_DECODER 0
+#define CONFIG_GIF_DECODER 0
+#define CONFIG_H261_DECODER 0
+#define CONFIG_H263I_DECODER 0
+#define CONFIG_JPEGLS_DECODER 0
+#define CONFIG_PNG_DECODER 0
+#define CONFIG_QTRLE_DECODER 0
+#define CONFIG_RAWVIDEO_DECODER 0
+#define CONFIG_ROQ_DECODER 0
+#define CONFIG_SGI_DECODER 0
+#define CONFIG_SVQ1_DECODER 0
+#define CONFIG_TARGA_DECODER 0
+#define CONFIG_TIFF_DECODER 0
+#define CONFIG_ZLIB_DECODER 0
+#define CONFIG_ZMBV_DECODER 0
+#define CONFIG_FLAC_DECODER 0
+#define CONFIG_LIBAMR_NB_DECODER 0
+#define CONFIG_LIBAMR_WB_DECODER 0
+#define CONFIG_LIBGSM_DECODER 0
+#define CONFIG_LIBGSM_MS_DECODER 0
+#define CONFIG_MP2_DECODER 0
+#define CONFIG_SONIC_DECODER 0
+#define CONFIG_VORBIS_DECODER 0
+#define CONFIG_WMAV1_DECODER 0
+#define CONFIG_PCM_ALAW_DECODER 0
+#define CONFIG_PCM_MULAW_DECODER 0
+#define CONFIG_PCM_S8_DECODER 0
+#define CONFIG_PCM_S16BE_DECODER 0
+#define CONFIG_PCM_S16LE_DECODER 0
+#define CONFIG_PCM_S24BE_DECODER 0
+#define CONFIG_PCM_S24DAUD_DECODER 0
+#define CONFIG_PCM_S24LE_DECODER 0
+#define CONFIG_PCM_S32BE_DECODER 0
+#define CONFIG_PCM_S32LE_DECODER 0
+#define CONFIG_PCM_U8_DECODER 0
+#define CONFIG_PCM_U16BE_DECODER 0
+#define CONFIG_PCM_U16LE_DECODER 0
+#define CONFIG_PCM_U24BE_DECODER 0
+#define CONFIG_PCM_U24LE_DECODER 0
+#define CONFIG_PCM_U32BE_DECODER 0
+#define CONFIG_PCM_U32LE_DECODER 0
+#define CONFIG_ROQ_DPCM_DECODER 0
+#define CONFIG_ADPCM_4XM_DECODER 0
+#define CONFIG_ADPCM_ADX_DECODER 0
+#define CONFIG_ADPCM_CT_DECODER 0
+#define CONFIG_ADPCM_EA_DECODER 0
+#define CONFIG_ADPCM_G726_DECODER 0
+#define CONFIG_ADPCM_IMA_DK3_DECODER 0
+#define CONFIG_ADPCM_IMA_DK4_DECODER 0
+#define CONFIG_ADPCM_IMA_QT_DECODER 0
+#define CONFIG_ADPCM_IMA_SMJPEG_DECODER 0
+#define CONFIG_ADPCM_IMA_WAV_DECODER 0
+#define CONFIG_ADPCM_IMA_WS_DECODER 0
+#define CONFIG_ADPCM_MS_DECODER 0
+#define CONFIG_ADPCM_SBPRO_2_DECODER 0
+#define CONFIG_ADPCM_SBPRO_3_DECODER 0
+#define CONFIG_ADPCM_SBPRO_4_DECODER 0
+#define CONFIG_ADPCM_SWF_DECODER 0
+#define CONFIG_ADPCM_XA_DECODER 0
+#define CONFIG_ADPCM_YAMAHA_DECODER 0
+#define CONFIG_DVDSUB_DECODER 0
+#define CONFIG_LIBVORBIS_DECODER 0
+#define CONFIG_H263_PARSER 1
+#define CONFIG_H264_PARSER 1
+#define CONFIG_MPEG4VIDEO_PARSER 1
+#define CONFIG_AAC_PARSER 0
+#define CONFIG_AC3_PARSER 0
+#define CONFIG_CAVSVIDEO_PARSER 0
+#define CONFIG_DCA_PARSER 0
+#define CONFIG_DVBSUB_PARSER 0
+#define CONFIG_DVDSUB_PARSER 0
+#define CONFIG_H261_PARSER 0
+#define CONFIG_MJPEG_PARSER 0
+#define CONFIG_MPEGAUDIO_PARSER 0
+#define CONFIG_MPEGVIDEO_PARSER 0
+#define CONFIG_PNM_PARSER 0
+#define CONFIG_VC1_PARSER 0
+#define CONFIG_VP3_PARSER 0
+#define CONFIG_DNXHD_PARSER 0
+#define CONFIG_DIRAC_PARSER 0
 #define CONFIG_MJPEG_ENCODER 1
-#define ENABLE_MSMPEG4V3_ENCODER 1
 #define CONFIG_MSMPEG4V3_ENCODER 1
-#define ENABLE_H263P_ENCODER 1
 #define CONFIG_H263P_ENCODER 1
-#define ENABLE_AC3_ENCODER 1
 #define CONFIG_AC3_ENCODER 1
-#define ENABLE_FFV1_ENCODER 1
 #define CONFIG_FFV1_ENCODER 1
-#define ENABLE_FLV1_ENCODER 1
 #define CONFIG_FLV1_ENCODER 1
-#define ENABLE_FFVHUFF_ENCODER 1
 #define CONFIG_FFVHUFF_ENCODER 1
-#define ENABLE_H263_ENCODER 1
 #define CONFIG_H263_ENCODER 1
-#define ENABLE_MPEG1VIDEO_ENCODER 1
 #define CONFIG_MPEG1VIDEO_ENCODER 1
-#define ENABLE_MPEG2VIDEO_ENCODER 1
 #define CONFIG_MPEG2VIDEO_ENCODER 1
-#define ENABLE_MPEG4_ENCODER 1
 #define CONFIG_MPEG4_ENCODER 1
-#define ENABLE_FLV_ENCODER 1
 #define CONFIG_FLV_ENCODER 1
-#define ENABLE_MP2_ENCODER 1
 #define CONFIG_MP2_ENCODER 1
-#define ENABLE_DVVIDEO_ENCODER 1
 #define CONFIG_DVVIDEO_ENCODER 1
-#define ENABLE_HUFFYUV_ENCODER 1
 #define CONFIG_HUFFYUV_ENCODER 1
-#define ENABLE_DVBSUB_ENCODER 1
 #define CONFIG_DVBSUB_ENCODER 1
-#define ENABLE_SNOW_ENCODER 1
 #define CONFIG_SNOW_ENCODER 1
-#define ENABLE_DNXHD_ENCODER 0
-#define ENABLE_PCM_ZORK_ENCODER 0
-#define ENABLE_ADPCM_IMA_AMV_ENCODER 0
-#define ENABLE_LIBX264_ENCODER 0
-#define ENABLE_LIBXVID_ENCODER 0
-#define ENABLE_LJPEG_ENCODER 0
-#define ENABLE_PAM_ENCODER 0
-#define ENABLE_PBM_ENCODER 0
-#define ENABLE_PGM_ENCODER 0
-#define ENABLE_PGMYUV_ENCODER 0
-#define ENABLE_PPM_ENCODER 0
-#define ENABLE_LIBFAAC_ENCODER 0
-#define ENABLE_LIBMP3LAME_ENCODER 0
-#define ENABLE_LIBTHEORA_ENCODER 0
-#define ENABLE_SONIC_LS_ENCODER 0
-#define ENABLE_ASV1_ENCODER 0
-#define ENABLE_ASV2_ENCODER 0
-#define ENABLE_BMP_ENCODER 0
-#define ENABLE_FLASHSV_ENCODER 0
-#define ENABLE_GIF_ENCODER 0
-#define ENABLE_H261_ENCODER 0
-#define ENABLE_JPEGLS_ENCODER 0
-#define ENABLE_MSMPEG4V1_ENCODER 0
-#define ENABLE_MSMPEG4V2_ENCODER 0
-#define ENABLE_PNG_ENCODER 0
-#define ENABLE_QTRLE_ENCODER 0
-#define ENABLE_RAWVIDEO_ENCODER 0
-#define ENABLE_ROQ_ENCODER 0
-#define ENABLE_RV10_ENCODER 0
-#define ENABLE_RV20_ENCODER 0
-#define ENABLE_SGI_ENCODER 0
-#define ENABLE_SVQ1_ENCODER 0
-#define ENABLE_TARGA_ENCODER 0
-#define ENABLE_TIFF_ENCODER 0
-#define ENABLE_WMV1_ENCODER 0
-#define ENABLE_WMV2_ENCODER 0
-#define ENABLE_ZLIB_ENCODER 0
-#define ENABLE_ZMBV_ENCODER 0
-#define ENABLE_FLAC_ENCODER 0
-#define ENABLE_LIBAMR_NB_ENCODER 0
-#define ENABLE_LIBAMR_WB_ENCODER 0
-#define ENABLE_LIBGSM_ENCODER 0
-#define ENABLE_LIBGSM_MS_ENCODER 0
-#define ENABLE_SONIC_ENCODER 0
-#define ENABLE_VORBIS_ENCODER 0
-#define ENABLE_WMAV1_ENCODER 0
-#define ENABLE_WMAV2_ENCODER 0
-#define ENABLE_PCM_ALAW_ENCODER 0
-#define ENABLE_PCM_MULAW_ENCODER 0
-#define ENABLE_PCM_S8_ENCODER 0
-#define ENABLE_PCM_S16BE_ENCODER 0
-#define ENABLE_PCM_S16LE_ENCODER 0
-#define ENABLE_PCM_S24BE_ENCODER 0
-#define ENABLE_PCM_S24DAUD_ENCODER 0
-#define ENABLE_PCM_S24LE_ENCODER 0
-#define ENABLE_PCM_S32BE_ENCODER 0
-#define ENABLE_PCM_S32LE_ENCODER 0
-#define ENABLE_PCM_U8_ENCODER 0
-#define ENABLE_PCM_U16BE_ENCODER 0
-#define ENABLE_PCM_U16LE_ENCODER 0
-#define ENABLE_PCM_U24BE_ENCODER 0
-#define ENABLE_PCM_U24LE_ENCODER 0
-#define ENABLE_PCM_U32BE_ENCODER 0
-#define ENABLE_PCM_U32LE_ENCODER 0
-#define ENABLE_ROQ_DPCM_ENCODER 0
-#define ENABLE_ADPCM_4XM_ENCODER 0
-#define ENABLE_ADPCM_ADX_ENCODER 0
-#define ENABLE_ADPCM_CT_ENCODER 0
-#define ENABLE_ADPCM_EA_ENCODER 0
-#define ENABLE_ADPCM_G726_ENCODER 0
-#define ENABLE_ADPCM_IMA_DK3_ENCODER 0
-#define ENABLE_ADPCM_IMA_DK4_ENCODER 0
-#define ENABLE_ADPCM_IMA_QT_ENCODER 0
-#define ENABLE_ADPCM_IMA_SMJPEG_ENCODER 0
-#define ENABLE_ADPCM_IMA_WAV_ENCODER 0
-#define ENABLE_ADPCM_IMA_WS_ENCODER 0
-#define ENABLE_ADPCM_MS_ENCODER 0
-#define ENABLE_ADPCM_SBPRO_2_ENCODER 0
-#define ENABLE_ADPCM_SBPRO_3_ENCODER 0
-#define ENABLE_ADPCM_SBPRO_4_ENCODER 0
-#define ENABLE_ADPCM_SWF_ENCODER 0
-#define ENABLE_ADPCM_XA_ENCODER 0
-#define ENABLE_ADPCM_YAMAHA_ENCODER 0
-#define ENABLE_DVDSUB_ENCODER 0
-#define ENABLE_LIBVORBIS_ENCODER 0
-#define ENABLE_MP3_HEADER_COMPRESS_BSF 0
-#define ENABLE_IMX_DUMP_HEADER_BSF 0
-#define ENABLE_DUMP_EXTRADATA_BSF 0
-#define ENABLE_REMOVE_EXTRADATA_BSF 0
-#define ENABLE_NOISE_BSF 0
-#define ENABLE_MP3_HEADER_DECOMPRESS_BSF 0
-#define ENABLE_MJPEGA_DUMP_HEADER_BSF 0
-#define ENABLE_H264_MP4TOANNEXB_BSF 0
-#define ENABLE_MOV2TEXTSUB_BSF 0
-#define ENABLE_TEXT2MOVSUB_BSF 0
+#define CONFIG_LIBSCHROEDINGER_ENCODER 0
+#define CONFIG_LIBDIRAC_ENCODER 0
+#define CONFIG_PCM_F64LE_ENCODER 0
+#define CONFIG_PCM_F64BE_ENCODER 0
+#define CONFIG_PCM_F32BE_ENCODER 0
+#define CONFIG_PCM_F32LE_ENCODER 0
+#define CONFIG_NELLYMOSER_ENCODER 0
+#define CONFIG_ALAC_ENCODER 0
+#define CONFIG_PCX_ENCODER 0
+#define CONFIG_DNXHD_ENCODER 0
+#define CONFIG_PCM_ZORK_ENCODER 0
+#define CONFIG_ADPCM_IMA_AMV_ENCODER 0
+#define CONFIG_LIBX264_ENCODER 0
+#define CONFIG_LIBXVID_ENCODER 0
+#define CONFIG_LJPEG_ENCODER 0
+#define CONFIG_PAM_ENCODER 0
+#define CONFIG_PBM_ENCODER 0
+#define CONFIG_PGM_ENCODER 0
+#define CONFIG_PGMYUV_ENCODER 0
+#define CONFIG_PPM_ENCODER 0
+#define CONFIG_LIBFAAC_ENCODER 0
+#define CONFIG_LIBMP3LAME_ENCODER 0
+#define CONFIG_LIBTHEORA_ENCODER 0
+#define CONFIG_SONIC_LS_ENCODER 0
+#define CONFIG_ASV1_ENCODER 0
+#define CONFIG_ASV2_ENCODER 0
+#define CONFIG_BMP_ENCODER 0
+#define CONFIG_FLASHSV_ENCODER 0
+#define CONFIG_GIF_ENCODER 0
+#define CONFIG_H261_ENCODER 0
+#define CONFIG_JPEGLS_ENCODER 0
+#define CONFIG_MSMPEG4V1_ENCODER 0
+#define CONFIG_MSMPEG4V2_ENCODER 0
+#define CONFIG_PNG_ENCODER 0
+#define CONFIG_QTRLE_ENCODER 0
+#define CONFIG_RAWVIDEO_ENCODER 0
+#define CONFIG_ROQ_ENCODER 0
+#define CONFIG_RV10_ENCODER 0
+#define CONFIG_RV20_ENCODER 0
+#define CONFIG_SGI_ENCODER 0
+#define CONFIG_SVQ1_ENCODER 0
+#define CONFIG_TARGA_ENCODER 0
+#define CONFIG_TIFF_ENCODER 0
+#define CONFIG_WMV1_ENCODER 0
+#define CONFIG_WMV2_ENCODER 0
+#define CONFIG_ZLIB_ENCODER 0
+#define CONFIG_ZMBV_ENCODER 0
+#define CONFIG_FLAC_ENCODER 0
+#define CONFIG_LIBAMR_NB_ENCODER 0
+#define CONFIG_LIBAMR_WB_ENCODER 0
+#define CONFIG_LIBGSM_ENCODER 0
+#define CONFIG_LIBGSM_MS_ENCODER 0
+#define CONFIG_SONIC_ENCODER 0
+#define CONFIG_VORBIS_ENCODER 0
+#define CONFIG_WMAV1_ENCODER 0
+#define CONFIG_WMAV2_ENCODER 0
+#define CONFIG_PCM_ALAW_ENCODER 0
+#define CONFIG_PCM_MULAW_ENCODER 0
+#define CONFIG_PCM_S8_ENCODER 0
+#define CONFIG_PCM_S16BE_ENCODER 0
+#define CONFIG_PCM_S16LE_ENCODER 0
+#define CONFIG_PCM_S24BE_ENCODER 0
+#define CONFIG_PCM_S24DAUD_ENCODER 0
+#define CONFIG_PCM_S24LE_ENCODER 0
+#define CONFIG_PCM_S32BE_ENCODER 0
+#define CONFIG_PCM_S32LE_ENCODER 0
+#define CONFIG_PCM_U8_ENCODER 0
+#define CONFIG_PCM_U16BE_ENCODER 0
+#define CONFIG_PCM_U16LE_ENCODER 0
+#define CONFIG_PCM_U24BE_ENCODER 0
+#define CONFIG_PCM_U24LE_ENCODER 0
+#define CONFIG_PCM_U32BE_ENCODER 0
+#define CONFIG_PCM_U32LE_ENCODER 0
+#define CONFIG_ROQ_DPCM_ENCODER 0
+#define CONFIG_ADPCM_4XM_ENCODER 0
+#define CONFIG_ADPCM_ADX_ENCODER 0
+#define CONFIG_ADPCM_CT_ENCODER 0
+#define CONFIG_ADPCM_EA_ENCODER 0
+#define CONFIG_ADPCM_G726_ENCODER 0
+#define CONFIG_ADPCM_IMA_DK3_ENCODER 0
+#define CONFIG_ADPCM_IMA_DK4_ENCODER 0
+#define CONFIG_ADPCM_IMA_QT_ENCODER 0
+#define CONFIG_ADPCM_IMA_SMJPEG_ENCODER 0
+#define CONFIG_ADPCM_IMA_WAV_ENCODER 0
+#define CONFIG_ADPCM_IMA_WS_ENCODER 0
+#define CONFIG_ADPCM_MS_ENCODER 0
+#define CONFIG_ADPCM_SBPRO_2_ENCODER 0
+#define CONFIG_ADPCM_SBPRO_3_ENCODER 0
+#define CONFIG_ADPCM_SBPRO_4_ENCODER 0
+#define CONFIG_ADPCM_SWF_ENCODER 0
+#define CONFIG_ADPCM_XA_ENCODER 0
+#define CONFIG_ADPCM_YAMAHA_ENCODER 0
+#define CONFIG_DVDSUB_ENCODER 0
+#define CONFIG_LIBVORBIS_ENCODER 0
+#define CONFIG_MP3_HEADER_COMPRESS_BSF 0
+#define CONFIG_IMX_DUMP_HEADER_BSF 0
+#define CONFIG_DUMP_EXTRADATA_BSF 0
+#define CONFIG_REMOVE_EXTRADATA_BSF 0
+#define CONFIG_NOISE_BSF 0
+#define CONFIG_MP3_HEADER_DECOMPRESS_BSF 0
+#define CONFIG_MJPEGA_DUMP_HEADER_BSF 0
+#define CONFIG_H264_MP4TOANNEXB_BSF 0
+#define CONFIG_MOV2TEXTSUB_BSF 0
+#define CONFIG_TEXT2MOVSUB_BSF 0
 #define CONFIG_MUXERS 1
 #define CONFIG_MOV_MUXER 1
 #define CONFIG_MP4_MUXER 1
@@ -404,16 +400,25 @@
 #define CONFIG_MPEGAUDIO_HP 1
 #define CONFIG_ZLIB 1
 #define CONFIG_GPL 1
-#define ENABLE_ARMV4L 0
-#define ENABLE_MLIB 0
-#define ENABLE_SPARC 0
-#define ENABLE_ALPHA 0
-#define ENABLE_MMI 0
-#define ENABLE_SH4 0
-#define ENABLE_BFIN 0
-#define ENABLE_SMALL 0
-#define ENABLE_MLP_PARSER 0
+#define CONFIG_ARMV4L 0
+#define CONFIG_MLIB 0
+#define CONFIG_SPARC 0
+#define CONFIG_ALPHA 0
+#define CONFIG_MMI 0
+#define CONFIG_SH4 0
+#define CONFIG_BFIN 0
+#define CONFIG_SMALL 0
+#define CONFIG_MLP_PARSER 0
 //****************** SYSTEM *******************
+#	define ARCH_ARM 0
+#	define ARCH_ALPHA 0
+#	define ARCH_PPC 0
+#	define ARCH_SH4 0
+#	define ARCH_BFIN 0
+#	define HAVE_MMI 0
+#	define HAVE_VIS 0
+#	define CONFIG_GRAY 0
+#	define HAVE_TRUNCF 1
 #ifdef __APPLE__
 #	define CONFIG_DARWIN 1
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/ffconf.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/ffconf.c	2009-05-02 13:54:26 UTC (rev 4789)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/ffconf.c	2009-05-02 13:54:37 UTC (rev 4790)
@@ -8,7 +8,25 @@
 {
 	printf("#include \"ADM_coreConfig.h\"\n");
 
-#define DECLARE_DECODER(a,b); printf("#define ENABLE_"#a"_DECODER 1\n"); printf("#define CONFIG_"#a"_DECODER 1\n");
+
+// VDPAU
+#define DECLARE_HW(a,b); printf("#define CONFIG_"#a"_HWACCEL 0\n");
+    DECLARE_HW(H263_VAAPI,nellymoser);
+    DECLARE_HW(MPEG2_VAAPI,nellymoser);
+    DECLARE_HW(MPEG4_VAAPI,nellymoser);
+    DECLARE_HW(VC1_VAAPI,nellymoser);
+    DECLARE_HW(WMV3_VAAPI,nellymoser);
+
+#define DECLARE_VDPAU(a,b); printf("#define CONFIG_"#a"_VDPAU_DECODER 0\n");
+    DECLARE_VDPAU(MPEG,nellymoser);
+    DECLARE_VDPAU(MPEG1,nellymoser);
+    DECLARE_VDPAU(VDPAU,nellymoser);
+    DECLARE_VDPAU(VC1,nellymoser);
+    DECLARE_VDPAU(WMV3,nellymoser);
+    DECLARE_VDPAU(H264, h264_vdpau);
+
+
+#define DECLARE_DECODER(a,b); printf("#define CONFIG_"#a"_DECODER 1\n");
   
     DECLARE_DECODER(NELLYMOSER,nellymoser);
     DECLARE_DECODER(ADPCM_IMA_AMV, amv);
@@ -56,9 +74,48 @@
     DECLARE_DECODER (SNOW, snow);
     DECLARE_DECODER (AMV, amv);
 #undef DECLARE_DECODER
-#define DECLARE_DECODER(a,b); printf("#define ENABLE_"#a"_DECODER 0\n"); 
+#define DECLARE_DECODER(a,b); printf("#define CONFIG_"#a"_DECODER 0\n"); 
 
-    DECLARE_DECODER(H264_VDPAU, h264_vdpau);
+    DECLARE_DECODER(LIBSPEEX, eatgq);
+    DECLARE_DECODER(LIBSCHROEDINGER, eatgq);
+    DECLARE_DECODER(LIBOPENJPEG, eatgq);
+    DECLARE_DECODER(LIBDIRAC, eatgq);
+    DECLARE_DECODER(ADPCM_IMA_ISS, eatgq);
+    DECLARE_DECODER(ADPCM_EA_MAXIS_XA, eatgq);
+
+    DECLARE_DECODER(PCM_F64LE, eatgq);
+    DECLARE_DECODER(PCM_F64BE, eatgq);
+    DECLARE_DECODER(PCM_F32LE, eatgq);
+    DECLARE_DECODER(PCM_F32BE, eatgq);
+    DECLARE_DECODER(PCM_DVD, eatgq);
+    DECLARE_DECODER(TRUEHD, eatgq);
+    DECLARE_DECODER(QCELP, eatgq);
+    DECLARE_DECODER(MP1, eatgq);
+    DECLARE_DECODER(MLP, eatgq);
+    DECLARE_DECODER(ALAC, eatgq);
+    DECLARE_DECODER(EAC3, eatgq);
+    DECLARE_DECODER(AAC, eatgq);
+    DECLARE_DECODER(PGMYUV, eatgq);
+    DECLARE_DECODER(PPM, eatgq);
+
+
+    DECLARE_DECODER(EATGV, eatgq);
+    DECLARE_DECODER(EATQI, eatgq);
+    DECLARE_DECODER(EIGHTSVX_EXP, eatgq);
+    DECLARE_DECODER(EIGHTSVX_FIB, eatgq);
+    DECLARE_DECODER(ESCAPE124, eatgq);
+    DECLARE_DECODER(MIMIC, eatgq);
+    DECLARE_DECODER(MOTIONPIXELS, eatgq);
+    DECLARE_DECODER(PAM, eatgq);
+    DECLARE_DECODER(PBM, eatgq);
+    DECLARE_DECODER(PGM, eatgq);
+    DECLARE_DECODER(RL2, eatgq);
+    DECLARE_DECODER(RV30, eatgq);
+    DECLARE_DECODER(RV40, eatgq);
+    DECLARE_DECODER(V210X, eatgq);
+
+    DECLARE_DECODER(BFI, eatgq);
+    DECLARE_DECODER(EACMV, eatgq);
     DECLARE_DECODER(EATGQ, eatgq);
     DECLARE_DECODER(PCX, aasc);
     DECLARE_DECODER(SUNRAST, aasc);
@@ -213,13 +270,13 @@
     DECLARE_DECODER (DVDSUB, dvdsub);
 	DECLARE_DECODER (LIBVORBIS, libvorbis);
 
-#define DECLARE_PARSER(a,b); printf("#define ENABLE_"#a"_PARSER 1\n"); 
+#define DECLARE_PARSER(a,b); printf("#define CONFIG_"#a"_PARSER 1\n"); 
     DECLARE_PARSER (H263, h263);
     DECLARE_PARSER (H264, h264);
     DECLARE_PARSER (MPEG4VIDEO, mpeg4video);
 
 #undef DECLARE_PARSER
-#define DECLARE_PARSER(a,b); printf("#define ENABLE_"#a"_PARSER 0\n"); 
+#define DECLARE_PARSER(a,b); printf("#define CONFIG_"#a"_PARSER 0\n"); 
     DECLARE_PARSER (AAC, aac);
     DECLARE_PARSER (AC3, ac3);
     DECLARE_PARSER (CAVSVIDEO, cavsvideo);
@@ -232,8 +289,11 @@
     DECLARE_PARSER (MPEGVIDEO, mpegvideo);
     DECLARE_PARSER (PNM, pnm);
     DECLARE_PARSER (VC1, vc1);
+    DECLARE_PARSER (VP3, vp3);
+    DECLARE_PARSER (DNXHD, dnxhd);
+    DECLARE_PARSER (DIRAC, dirac);
 
-#define DECLARE_ENCODER(a,b); printf("#define ENABLE_"#a"_ENCODER 1\n"); printf("#define CONFIG_"#a"_ENCODER 1\n");
+#define DECLARE_ENCODER(a,b); printf("#define CONFIG_"#a"_ENCODER 1\n");
 
     DECLARE_ENCODER (MJPEG, mjpeg);
     DECLARE_ENCODER (MSMPEG4V3, msmpeg4v3);
@@ -254,7 +314,18 @@
     DECLARE_ENCODER (SNOW, snow);
 
 #undef DECLARE_ENCODER
-#define DECLARE_ENCODER(a,b); printf("#define ENABLE_"#a"_ENCODER 0\n"); 
+#define DECLARE_ENCODER(a,b); printf("#define CONFIG_"#a"_ENCODER 0\n"); 
+    DECLARE_ENCODER(LIBSCHROEDINGER, amv);
+    DECLARE_ENCODER(LIBDIRAC, amv);
+
+    DECLARE_ENCODER(PCM_F64LE, amv);
+    DECLARE_ENCODER(PCM_F64BE, amv);
+    DECLARE_ENCODER(PCM_F32BE, amv);
+    DECLARE_ENCODER(PCM_F32LE, amv);
+    DECLARE_ENCODER(NELLYMOSER, amv);
+    DECLARE_ENCODER(ALAC, amv);
+
+    DECLARE_ENCODER(PCX, amv);
     DECLARE_ENCODER(DNXHD, amv);
     DECLARE_ENCODER(PCM_ZORK, amv);
     DECLARE_ENCODER(ADPCM_IMA_AMV, amv);
@@ -342,7 +413,7 @@
     DECLARE_ENCODER (DVDSUB, dvdsub);
 	DECLARE_ENCODER (LIBVORBIS, libvorbis);
 
-#define DECLARE_BSF(a,b); printf("#define ENABLE_"#a"_BSF 0\n");
+#define DECLARE_BSF(a,b); printf("#define CONFIG_"#a"_BSF 0\n");
 
 	DECLARE_BSF(MP3_HEADER_COMPRESS, mp3_header_compress);
 	DECLARE_BSF(IMX_DUMP_HEADER, imx_dump_header);
@@ -383,7 +454,7 @@
 	printf("#define CONFIG_ZLIB 1\n");
 	printf("#define CONFIG_GPL 1\n");
 
-#define ENABLE(a,b); printf("#define ENABLE_"#a" 0\n");
+#define ENABLE(a,b); printf("#define CONFIG_"#a" 0\n");
 
 	ENABLE(ARMV4L, armv4l);
 	ENABLE(MLIB, mlib);
@@ -393,9 +464,20 @@
 	ENABLE(SH4, sh4);
 	ENABLE(BFIN, bfin);
 	ENABLE(SMALL, small);
-#define DECLARE_ENABLE_PARSER(a,b); printf("#define ENABLE_"#a"_PARSER 0\n");
+#define DECLARE_ENABLE_PARSER(a,b); printf("#define CONFIG_"#a"_PARSER 0\n");
 	DECLARE_ENABLE_PARSER(MLP, wmv3);
         printf("//****************** SYSTEM *******************\n");
+	printf("#	define ARCH_ARM 0\n");
+	printf("#	define ARCH_ALPHA 0\n");
+	printf("#	define ARCH_PPC 0\n");
+	printf("#	define ARCH_SH4 0\n");
+	printf("#	define ARCH_BFIN 0\n");
+	printf("#	define HAVE_MMI 0\n");
+	printf("#	define HAVE_VIS 0\n");
+	printf("#	define CONFIG_GRAY 0\n");
+	printf("#	define HAVE_TRUNCF 1\n");
+
+
 	printf("#ifdef __APPLE__\n");
 	printf("#	define CONFIG_DARWIN 1\n");
 	printf("#endif\n");



From mean at mail.berlios.de  Sat May  2 15:54:39 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:54:39 +0200
Subject: [Avidemux-svn-commit] r4791 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec
Message-ID: <200905021354.n42DsdQQ011121@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:54:38 +0200 (Sat, 02 May 2009)
New Revision: 4791

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ADM_lavcodec.cpp
Log:
[FFconf]

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ADM_lavcodec.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ADM_lavcodec.cpp	2009-05-02 13:54:37 UTC (rev 4790)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ADM_lavcodec.cpp	2009-05-02 13:54:38 UTC (rev 4791)
@@ -1,8 +1,8 @@
 #include "ADM_default.h"
-#ifdef ADM_CPU_X86
-#include "ADM_lavcodec.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/dsputil_cpu.h"
-#endif
+extern "C"
+{
+#include "avcodec.h"
+}
 /**
  * 		\fn lavcodec_mm_support
  * 		\brief Give lavcodec CPU supported ( FF_MM_MMX)
@@ -17,7 +17,7 @@
 
 #ifdef ADM_CPU_X86
 #undef MATCH
-#define MATCH(x,y) if(CpuCaps::myCpuCaps &  CpuCaps::myCpuMask & ADM_CPUCAP_##x) rval|=MM_##x;
+#define MATCH(x,y) if(CpuCaps::myCpuCaps &  CpuCaps::myCpuMask & ADM_CPUCAP_##x) rval|=FF_MM_##x;
 
 	MATCH(MMX,MMX);
 	MATCH(MMXEXT,MMXEXT);



From mean at mail.berlios.de  Sat May  2 15:54:40 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:54:40 +0200
Subject: [Avidemux-svn-commit] r4792 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config
Message-ID: <200905021354.n42DseaH011133@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:54:40 +0200 (Sat, 02 May 2009)
New Revision: 4792

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/config.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/ffconf.c
Log:
[ffmpeg] config update

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/config.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/config.h	2009-05-02 13:54:38 UTC (rev 4791)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/config.h	2009-05-02 13:54:40 UTC (rev 4792)
@@ -382,6 +382,7 @@
 #define CONFIG_TEXT2MOVSUB_BSF 0
 #define CONFIG_MUXERS 1
 #define CONFIG_MOV_MUXER 1
+#define CONFIG_IPOD_MUXER 1
 #define CONFIG_MP4_MUXER 1
 #define CONFIG_PSP_MUXER 1
 #define CONFIG_TG2_MUXER 1

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/ffconf.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/ffconf.c	2009-05-02 13:54:38 UTC (rev 4791)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/ffconf.c	2009-05-02 13:54:40 UTC (rev 4792)
@@ -430,6 +430,7 @@
 
 	printf("#define CONFIG_MUXERS 1\n");
 	DECLARE_MUXER(MOV, mov)
+	DECLARE_MUXER(IPOD, mov)
 	DECLARE_MUXER(MP4, mp4)
 	DECLARE_MUXER(PSP, psp)
 	DECLARE_MUXER(TG2, tg2)



From mean at mail.berlios.de  Sat May  2 15:54:42 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:54:42 +0200
Subject: [Avidemux-svn-commit] r4793 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale
Message-ID: <200905021354.n42DsgbF011146@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:54:42 +0200 (Sat, 02 May 2009)
New Revision: 4793

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/swscale_avoption.c
Log:
[ffmpeg] back to normal naming

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/swscale_avoption.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/swscale_avoption.c	2009-05-02 13:54:40 UTC (rev 4792)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/swscale_avoption.c	2009-05-02 13:54:42 UTC (rev 4793)
@@ -19,7 +19,7 @@
  */
 
 #include "libavutil/avutil.h"
-#include "ADM_lavcodec/opt.h"
+#include "libavcodec/opt.h"
 #include "swscale.h"
 #include "swscale_internal.h"
 



From mean at mail.berlios.de  Sat May  2 15:54:43 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:54:43 +0200
Subject: [Avidemux-svn-commit] r4794 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale
Message-ID: <200905021354.n42Dsh2j011159@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:54:43 +0200 (Sat, 02 May 2009)
New Revision: 4794

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/ADM_mp.cpp
Log:
[ffmpegupdate]

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/ADM_mp.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/ADM_mp.cpp	2009-05-02 13:54:42 UTC (rev 4793)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/ADM_mp.cpp	2009-05-02 13:54:43 UTC (rev 4794)
@@ -23,9 +23,9 @@
 
 
 extern "C" {
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
+#include "ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h"
 #include "ADM_libraries/ADM_ffmpeg/libavutil/avutil.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h"
+#include "ADM_libraries/ADM_ffmpeg/libswscale/swscale.h"
 }
 
 



From mean at mail.berlios.de  Sat May  2 15:54:48 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:54:48 +0200
Subject: [Avidemux-svn-commit] r4796 - in
	branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg:
	ffmpeg_config libswscale patches
Message-ID: <200905021354.n42Dsmrf011190@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:54:47 +0200 (Sat, 02 May 2009)
New Revision: 4796

Added:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/update.sh
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/wrapper.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/bswap_h.patch
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/intreadwrite_h.patch
Log:
[FFmpeg]

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/update.sh
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/update.sh	2009-05-02 13:54:45 UTC (rev 4795)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/update.sh	2009-05-02 13:54:47 UTC (rev 4796)
@@ -0,0 +1,2 @@
+gcc ffconf.c -o ffconf
+./ffconf > config.h

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/wrapper.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/wrapper.h	2009-05-02 13:54:45 UTC (rev 4795)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/wrapper.h	2009-05-02 13:54:47 UTC (rev 4796)
@@ -0,0 +1,20 @@
+/*
+
+	Replacement for assert
+*/
+#include "ADM_default.h"
+#undef memcpy
+//******************
+#undef malloc
+#undef realloc
+#undef memalign
+#undef free
+#undef strdup
+//******************
+#define malloc ADM_alloc
+#define realloc ADM_realloc
+#define memalign ADM_memalign
+#define free  ADM_dealloc
+#define strdup ADM_strdup
+
+

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/bswap_h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/bswap_h.patch	2009-05-02 13:54:45 UTC (rev 4795)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/bswap_h.patch	2009-05-02 13:54:47 UTC (rev 4796)
@@ -0,0 +1,17 @@
+diff --git a/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/bswap.h b/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/bswap.h
+index cf68c43..9b299a6 100644
+--- libavutil/bswap.h
++++ libavutil/bswap.h
+@@ -27,7 +27,12 @@
+ #define AVUTIL_BSWAP_H
+ 
+ #include <stdint.h>
++// MEANX
++#ifndef ADM_NO_CONFIG_H
+ #include "config.h"
++#endif
++// MEANX
++
+ #include "common.h"
+ 
+ #if   ARCH_ARM

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/intreadwrite_h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/intreadwrite_h.patch	2009-05-02 13:54:45 UTC (rev 4795)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/intreadwrite_h.patch	2009-05-02 13:54:47 UTC (rev 4796)
@@ -0,0 +1,17 @@
+diff --git a/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/intreadwrite.h b/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/intreadwrite.h
+index 5e55327..2c5c68d 100644
+--- libavutil/intreadwrite.h
++++ libavutil/intreadwrite.h
+@@ -20,7 +20,12 @@
+ #define AVUTIL_INTREADWRITE_H
+ 
+ #include <stdint.h>
++// MEANX
++#ifndef ADM_NO_CONFIG_H
+ #include "config.h"
++#endif
++// MEANX
++
+ #include "bswap.h"
+ 
+ /*



From mean at mail.berlios.de  Sat May  2 15:54:46 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:54:46 +0200
Subject: [Avidemux-svn-commit] r4795 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches
Message-ID: <200905021354.n42Dsksa011178@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:54:45 +0200 (Sat, 02 May 2009)
New Revision: 4795

Added:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/swscale_c.patch
Log:
[swscale] disable altivec

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/swscale_c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/swscale_c.patch	2009-05-02 13:54:43 UTC (rev 4794)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/swscale_c.patch	2009-05-02 13:54:45 UTC (rev 4795)
@@ -0,0 +1,19 @@
+diff --git a/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/swscale.c b/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/swscale.c
+index 7a54fd7..4690d98 100644
+--- libswscale/swscale.c
++++ libswscale/swscale.c
+@@ -960,11 +960,14 @@ static inline void yuv2rgbXinC_full(SwsContext *c, int16_t *lumFilter, int16_t *
+ #define COMPILE_C
+ #endif
+ 
++#if 0 // MEANX
+ #ifdef ARCH_PPC
+ #if (defined (HAVE_ALTIVEC) || defined (RUNTIME_CPUDETECT)) && defined (CONFIG_GPL)
+ #define COMPILE_ALTIVEC
+ #endif //HAVE_ALTIVEC
+ #endif //ARCH_PPC
++#endif // MEANX
++
+ 
+ #if defined(ARCH_X86)
+ 



From mean at mail.berlios.de  Sat May  2 15:54:53 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:54:53 +0200
Subject: [Avidemux-svn-commit] r4797 - in
	branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg:
	libavcodec libavformat libavutil libswscale patches
Message-ID: <200905021354.n42Dsr24011203@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:54:49 +0200 (Sat, 02 May 2009)
New Revision: 4797

Removed:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libswscale_swscale_internal.h.patch
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ffv1.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h263dec.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h264.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12enc.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo_enc.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/utils.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/file.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/flvenc.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/isom.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/matroskaenc.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/movenc.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/avutil.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/bswap.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/internal.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/intreadwrite.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/mem.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/swscale.c
Log:
[FFmpeg update] Apply patches/*.patch

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h	2009-05-02 13:54:49 UTC (rev 4797)
@@ -511,6 +511,8 @@
 #define CODEC_FLAG2_CHUNKS        0x00008000 ///< Input bitstream might be truncated at a packet boundaries instead of only at frame boundaries.
 #define CODEC_FLAG2_NON_LINEAR_QUANT 0x00010000 ///< Use MPEG-2 nonlinear quantizer.
 #define CODEC_FLAG2_BIT_RESERVOIR 0x00020000 ///< Use a bit reservoir when encoding if possible
+//MEANX: NEVER EVER USE CLOSED GOP ?
+#define CODEC_FLAG2_32_PULLDOWN   0x80000000 
 
 /* Unsupported options :
  *              Syntax Arithmetic coding (SAC)
@@ -1357,6 +1359,7 @@
      * - decoding: unused
      */
     int rc_max_rate;
+    int rc_max_rate_header; /*< That one is set in the header MEANX */
 
     /**
      * minimum bitrate
@@ -1371,6 +1374,8 @@
      * - decoding: unused
      */
     int rc_buffer_size;
+    int rc_buffer_size_header;  /*< That one is set in the header MEANX*/
+
     float rc_buffer_aggressivity;
 
     /**

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ffv1.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ffv1.c	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ffv1.c	2009-05-02 13:54:49 UTC (rev 4797)
@@ -1072,6 +1072,8 @@
         clear_state(f);
     }else{
         p->key_frame= 0;
+         p->pict_type= FF_P_TYPE; // MEANX : looks more like a P to me as user
+
     }
     if(!f->plane[0].state && !f->plane[0].vlc_state)
         return -1;

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h263dec.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h263dec.c	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h263dec.c	2009-05-02 13:54:49 UTC (rev 4797)
@@ -120,7 +120,24 @@
 
     return 0;
 }
+/* MeanX : Ugly patch to detect vo ppacked stuff ... */
+int av_is_voppacked(AVCodecContext *avctx, int *vop_packed, int *gmc, int *qpel)
+{
+    MpegEncContext *s = avctx->priv_data;
+    // set sane default
+    *vop_packed=0;
+    *gmc=0;
+    *qpel=0;
+    if(avctx->codec->id!=CODEC_ID_MPEG4) return 0;
+    	
+  	*vop_packed=(s->divx_packed);
+	*qpel=s->quarter_sample;
+	*gmc=0;	// FIXME
+	return 1;
 
+  }
+  /* MeanX */
+
 av_cold int ff_h263_decode_end(AVCodecContext *avctx)
 {
     MpegEncContext *s = avctx->priv_data;
@@ -420,6 +437,12 @@
     } else {
         ret = h263_decode_picture_header(s);
     }
+	//MEANX we need to do it here also for quicktime file / ctts atom 
+        // we need the correct frame type, and qt file may contain 
+        // vop not coded frame.
+        pict->pict_type=s->current_picture.pict_type= s->pict_type;
+        pict->key_frame=s->current_picture.key_frame= s->pict_type == FF_I_TYPE;
+        //MEANX
 
     if(ret==FRAME_SKIPPED) return get_consumed_bytes(s, buf_size);
 
@@ -710,6 +733,14 @@
 
 assert(s->current_picture.pict_type == s->current_picture_ptr->pict_type);
 assert(s->current_picture.pict_type == s->pict_type);
+/* MEANX */
+  if(s->current_picture_ptr)
+      s->current_picture_ptr->opaque=pict->opaque;
+/* MEANX */
+
+
+
+
     if (s->pict_type == FF_B_TYPE || s->low_delay) {
         *pict= *(AVFrame*)s->current_picture_ptr;
     } else if (s->last_picture_ptr != NULL) {

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h264.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h264.c	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/h264.c	2009-05-02 13:54:49 UTC (rev 4797)
@@ -8130,7 +8130,18 @@
     return 0;
 }
 
+/* MEANX */
+int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc)
+{
+      H264Context *h = avctx->priv_data;
+      assert(h);
+      *nalSize=h->nal_length_size;
+      *isAvc=h->is_avc;
+	return 1;
 
+  }
+/* MeanX */
+
 AVCodec h264_decoder = {
     "h264",
     CODEC_TYPE_VIDEO,

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12.c	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12.c	2009-05-02 13:54:49 UTC (rev 4797)
@@ -1947,7 +1947,12 @@
         ff_er_frame_end(s);
 
         MPV_frame_end(s);
+/* MEANX */
+  if(s->current_picture_ptr)
+      s->current_picture_ptr->opaque=pict->opaque;
+/* MEANX */
 
+
         if (s->pict_type == FF_B_TYPE || s->low_delay) {
             *pict= *(AVFrame*)s->current_picture_ptr;
             ff_print_debug_info(s, pict);

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12enc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12enc.c	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpeg12enc.c	2009-05-02 13:54:49 UTC (rev 4797)
@@ -127,10 +127,19 @@
             s->frame_rate_index= i;
         }
     }
+ /* MEANX 
+
     if(dmin)
         return -1;
     else
         return 0;
+  */
+        if(dmin>4)
+   {
+        av_log(0,AV_LOG_ERROR,"We did a roundup ! Expect async!\n");
+   }
+        return 0; //MEANX
+
 }
 
 static av_cold int encode_init(AVCodecContext *avctx)
@@ -209,6 +218,7 @@
             put_sbits(&s->pb, 12, s->width );
             put_sbits(&s->pb, 12, s->height);
 
+#if 0 //MEANX
             for(i=1; i<15; i++){
                 float error= aspect_ratio;
                 if(s->codec_id == CODEC_ID_MPEG1VIDEO || i <=1)
@@ -223,20 +233,44 @@
                     s->aspect_ratio_info= i;
                 }
             }
+#endif // MEANX
+            //MEANX put_bits(&s->pb, 4, s->aspect_ratio_info);
+            //MEANX put_bits(&s->pb, 4, s->frame_rate_index);
+ // MEANX 4:3
+  if(s->avctx->sample_aspect_ratio.num==16 && s->avctx->sample_aspect_ratio.den==9)
+            {
+                //printf("FFmpeg : Wide\n");
+                put_bits(&s->pb,4,3); //16:9
+            }
+            else        //4:3
+            {
+              if(s->codec_id == CODEC_ID_MPEG2VIDEO)
+                put_bits(&s->pb, 4, 2);
+              else
+                put_bits(&s->pb, 4, 12); // MPEG1
+            }
+// /MEANX
 
-            put_bits(&s->pb, 4, s->aspect_ratio_info);
-            put_bits(&s->pb, 4, s->frame_rate_index);
+// //MEANX PULLDOWN            put_bits(&s->pb, 4, s->frame_rate_index);
+if((s->flags2 & CODEC_FLAG2_32_PULLDOWN) && (s->codec_id == CODEC_ID_MPEG2VIDEO))
+            {           
+                put_bits(&s->pb, 4,4);
+            }
+            else
+            {                                  
+                put_bits(&s->pb, 4, s->frame_rate_index);
+            } //MEANX pulldown
 
-            if(s->avctx->rc_max_rate){
-                v = (s->avctx->rc_max_rate + 399) / 400;
+            if(s->avctx->rc_max_rate_header){ //MEANX we use header
+                v = (s->avctx->rc_max_rate_header + 399) / 400;
                 if (v > 0x3ffff && s->codec_id == CODEC_ID_MPEG1VIDEO)
                     v = 0x3ffff;
             }else{
                 v= 0x3FFFF;
             }
 
-            if(s->avctx->rc_buffer_size)
-                vbv_buffer_size = s->avctx->rc_buffer_size;
+            if(s->avctx->rc_buffer_size_header) // MEANX we use header
+                vbv_buffer_size = s->avctx->rc_buffer_size_header;
             else
                 /* VBV calculation: Scaled so that a VCD has the proper VBV size of 40 kilobytes */
                 vbv_buffer_size = (( 20 * s->bit_rate) / (1151929 / 2)) * 8 * 1024;
@@ -269,8 +303,17 @@
 
                 put_bits(&s->pb, 3, s->avctx->profile); //profile
                 put_bits(&s->pb, 4, s->avctx->level); //level
+   // MEANX pulldown put_bits(&s->pb, 1, s->progressive_sequence);
+  // MEANX Pulldown
+ if(s->flags2 & CODEC_FLAG2_32_PULLDOWN) //MEANX
+                        put_bits(&s->pb, 1, 0);
+                else
+                        put_bits(&s->pb, 1, s->progressive_sequence);
 
-                put_bits(&s->pb, 1, s->progressive_sequence);
+
+// /MEANX
+
+
                 put_bits(&s->pb, 2, s->chroma_format);
                 put_bits(&s->pb, 2, s->width >>12);
                 put_bits(&s->pb, 2, s->height>>12);
@@ -334,6 +377,8 @@
 
 void mpeg1_encode_picture_header(MpegEncContext *s, int picture_number)
 {
+	int tff,rff; //MEANX
+
     mpeg1_encode_sequence_header(s);
 
     /* mpeg1 picture header */
@@ -370,6 +415,49 @@
 
     s->frame_pred_frame_dct = 1;
     if(s->codec_id == CODEC_ID_MPEG2VIDEO){
+ /* MEANX -- Pulldown */
+        if(s->flags2 & CODEC_FLAG2_32_PULLDOWN)
+        {
+        
+                switch((s->picture_number - 
+                          s->gop_picture_number)&3)
+                {
+                        case 0:
+                        default:
+                                rff=1;
+                                tff=1;
+                                break;
+                        case 1:
+                                rff=0;
+                                tff=0;
+                                break;
+                        case 2:
+                                rff=1;
+                                tff=0;
+                                break;
+                        case 3:
+                                rff=0;
+                                tff=1;
+                                break;
+                }               
+           }
+        else
+        {
+                if (s->progressive_sequence) 
+                {
+                        tff=0; /* no repeat */
+                } else 
+                {
+                        tff= s->current_picture_ptr->top_field_first;
+                }
+                rff=s->repeat_first_field;
+        
+        }
+
+//               /MEANX pulldown
+
+
+
         put_header(s, EXT_START_CODE);
         put_bits(&s->pb, 4, 8); //pic ext
         if (s->pict_type == FF_P_TYPE || s->pict_type == FF_B_TYPE) {
@@ -388,11 +476,16 @@
 
         assert(s->picture_structure == PICT_FRAME);
         put_bits(&s->pb, 2, s->picture_structure);
+#if 0 //MEANX
+
         if (s->progressive_sequence) {
             put_bits(&s->pb, 1, 0); /* no repeat */
         } else {
             put_bits(&s->pb, 1, s->current_picture_ptr->top_field_first);
         }
+#endif
+         put_bits(&s->pb, 1, tff);  //MEANX PULLDOWN
+
         /* XXX: optimize the generation of this flag with entropy
            measures */
         s->frame_pred_frame_dct = s->progressive_sequence;
@@ -402,7 +495,10 @@
         put_bits(&s->pb, 1, s->q_scale_type);
         put_bits(&s->pb, 1, s->intra_vlc_format);
         put_bits(&s->pb, 1, s->alternate_scan);
-        put_bits(&s->pb, 1, s->repeat_first_field);
+ // MEANX put_bits(&s->pb, 1, s->repeat_first_field);
+	put_bits(&s->pb, 1, rff);
+      // /MEANX
+
         s->progressive_frame = s->progressive_sequence;
         put_bits(&s->pb, 1, s->chroma_format == CHROMA_420 ? s->progressive_frame : 0); /* chroma_420_type */
         put_bits(&s->pb, 1, s->progressive_frame);

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo.c	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo.c	2009-05-02 13:54:49 UTC (rev 4797)
@@ -610,7 +610,11 @@
     CHECKED_ALLOCZ(s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE);
 
     s->parse_context.state= -1;
-    if((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
+ //MEANX: Allocate them always, as they may be free when we decode 1st image
+
+    // MEANXif((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
+if(1){ // MEANX
+
        s->visualization_buffer[0] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
        s->visualization_buffer[1] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
        s->visualization_buffer[2] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo_enc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo_enc.c	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/mpegvideo_enc.c	2009-05-02 13:54:49 UTC (rev 4797)
@@ -349,12 +349,14 @@
 
         av_log(avctx, AV_LOG_INFO, "Warning vbv_delay will be set to 0xFFFF (=VBR) as the specified vbv buffer is too large for the given bitrate!\n");
     }
+#if 0 //MEANX
 
     if((s->flags & CODEC_FLAG_4MV) && s->codec_id != CODEC_ID_MPEG4
        && s->codec_id != CODEC_ID_H263 && s->codec_id != CODEC_ID_H263P && s->codec_id != CODEC_ID_FLV1){
         av_log(avctx, AV_LOG_ERROR, "4MV not supported by codec\n");
         return -1;
     }
+#endif
 
     if(s->obmc && s->avctx->mb_decision != FF_MB_DECISION_SIMPLE){
         av_log(avctx, AV_LOG_ERROR, "OBMC is only supported with simple mb decision\n");
@@ -387,10 +389,12 @@
         return -1;
     }
 
+#if 0 //MEANX
     if(s->mpeg_quant && s->codec_id != CODEC_ID_MPEG4){ //FIXME mpeg2 uses that too
         av_log(avctx, AV_LOG_ERROR, "mpeg2 style quantization not supported by codec\n");
         return -1;
     }
+#endif
 
     if((s->flags & CODEC_FLAG_CBP_RD) && !avctx->trellis){
         av_log(avctx, AV_LOG_ERROR, "CBP RD needs trellis quant\n");

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/utils.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/utils.c	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/utils.c	2009-05-02 13:54:49 UTC (rev 4797)
@@ -596,10 +596,12 @@
 
     if((avctx->codec->capabilities & CODEC_CAP_DELAY) || avpkt->size){
         //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
+#if 0 // MEANX : Silence
         if(*frame_size_ptr < AVCODEC_MAX_AUDIO_FRAME_SIZE){
             av_log(avctx, AV_LOG_ERROR, "buffer smaller than AVCODEC_MAX_AUDIO_FRAME_SIZE\n");
             return -1;
         }
+#endif
         if(*frame_size_ptr < FF_MIN_BUFFER_SIZE ||
         *frame_size_ptr < avctx->channels * avctx->frame_size * sizeof(int16_t)){
             av_log(avctx, AV_LOG_ERROR, "buffer %d too small\n", *frame_size_ptr);
@@ -1023,7 +1025,7 @@
         return -1;
     }
 #if !HAVE_MKSTEMP
-    fd = open(*filename, O_RDWR | O_BINARY | O_CREAT, 0444);
+    fd = open(*filename, O_RDWR /* MEANX | O_BINARY*/ | O_CREAT, 0444);
 #else
     snprintf(*filename, len, "/tmp/%sXXXXXX", prefix);
     fd = mkstemp(*filename);

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/file.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/file.c	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/file.c	2009-05-02 13:54:49 UTC (rev 4797)
@@ -30,7 +30,73 @@
 #include <stdlib.h>
 #include "os_support.h"
 
+// GRUNTSTER start
+#ifdef __WIN32
+#include <windows.h>
 
+int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString)
+{
+	int wideCharStringLength = MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, NULL, 0);
+
+	if (wideCharString)
+		MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, wideCharString, wideCharStringLength);
+
+	return wideCharStringLength;
+}
+
+int ADM_open(const char *path, int oflag, ...)
+{
+	int fileNameLength = utf8StringToWideChar(path, -1, NULL);
+	wchar_t wcFile[fileNameLength];
+	int creation = 0, access = 0;
+	HANDLE hFile;
+
+	utf8StringToWideChar(path, -1, wcFile);
+
+	if (oflag & O_WRONLY || oflag & O_RDWR)
+	{
+		access = GENERIC_WRITE;
+
+		if (oflag & O_RDWR)
+			access |= GENERIC_READ;
+
+		if (oflag & O_CREAT)
+		{
+			if (oflag & O_EXCL)
+				creation = CREATE_NEW;
+			else if (oflag & O_TRUNC)
+				creation = CREATE_ALWAYS;
+			else
+				creation = OPEN_ALWAYS;
+		}
+		else if (oflag & O_TRUNC)
+			creation = TRUNCATE_EXISTING;
+	}
+	else if (oflag & O_RDONLY)
+		creation = OPEN_EXISTING;
+
+	if (creation & GENERIC_WRITE)
+	{
+		hFile = CreateFileW(wcFile, access, 0, NULL, creation, 0, NULL);
+
+		if (hFile == INVALID_HANDLE_VALUE)
+			return -1;
+		else
+			CloseHandle(hFile);
+	}
+
+	hFile = CreateFileW(wcFile, access, FILE_SHARE_READ, NULL, creation, 0, NULL);
+
+	if (hFile == INVALID_HANDLE_VALUE)
+		return -1;
+	else
+		return _open_osfhandle((intptr_t)hFile, oflag);
+}
+
+#define open ADM_open
+#endif
+// GRUNTSTER end
+
 /* standard file protocol */
 
 static int file_open(URLContext *h, const char *filename, int flags)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/flvenc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/flvenc.c	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/flvenc.c	2009-05-02 13:54:49 UTC (rev 4797)
@@ -389,7 +389,8 @@
     "video/x-flv",
     "flv",
     sizeof(FLVContext),
-#if CONFIG_LIBMP3LAME
+//MEANX #if CONFIG_LIBMP3LAME
+#ifdef HAVE_LIBMP3LAME
     CODEC_ID_MP3,
 #else // CONFIG_LIBMP3LAME
     CODEC_ID_ADPCM_SWF,
@@ -401,3 +402,9 @@
     .codec_tag= (const AVCodecTag* const []){flv_video_codec_ids, flv_audio_codec_ids, 0},
     .flags= AVFMT_GLOBALHEADER,
 };
+// MEANX
+int flvenc_init(void)
+{
+    av_register_output_format(&flv_muxer);
+    return 0;
+}
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/isom.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/isom.c	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/isom.c	2009-05-02 13:54:49 UTC (rev 4797)
@@ -187,7 +187,10 @@
     { CODEC_ID_MACE3, MKTAG('M', 'A', 'C', '3') }, /* Macintosh Audio Compression and Expansion 3:1 */
     { CODEC_ID_MACE6, MKTAG('M', 'A', 'C', '6') }, /* Macintosh Audio Compression and Expansion 6:1 */
 
-    { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at http://www.3ivx.com/showcase.html use this tag */
+    //MEANX { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at http://www.3ivx.com/showcase.html use this tag */
+     { CODEC_ID_MP3, MKTAG( 'm', 'p', '4','a') },
+     { CODEC_ID_MP2, MKTAG( 'm', 'p', '4', 'a') },
+    // /MEANX
     { CODEC_ID_MP3, 0x6D730055 }, /* MPEG layer 3 */
 
 /*  { CODEC_ID_OGG_VORBIS, MKTAG('O', 'g', 'g', 'S') }, *//* sample files at http://heroinewarrior.com/xmovie.php3 use this tag */

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/matroskaenc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/matroskaenc.c	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/matroskaenc.c	2009-05-02 13:54:49 UTC (rev 4797)
@@ -395,6 +395,7 @@
 
 static int put_xiph_codecpriv(AVFormatContext *s, ByteIOContext *pb, AVCodecContext *codec)
 {
+#if 0 // MEANX avidemux does thing differently
     uint8_t *header_start[3];
     int header_len[3];
     int first_header_size;
@@ -419,6 +420,28 @@
         put_buffer(pb, header_start[j], header_len[j]);
 
     return 0;
+#else
+   // Not endian safe....
+      uint32_t packetLen[3],*ptr=(uint32_t *)codec->extradata;
+      uint8_t *data[3],i,j;
+      if( 3*4+ptr[0]+ptr[1]+ptr[2]!=codec->extradata_size)
+      {
+        av_log(s, AV_LOG_ERROR, "Broken avidemux xiph header.\n");
+        return -1;
+      }
+      data[0]=codec->extradata+3*4;
+      data[1]=data[0]+ptr[0];
+      data[2]=data[1]+ptr[1];
+      put_byte(pb, 2);                    // number packets - 1
+      for (j = 0; j < 2; j++) 
+      {
+          put_xiph_size(pb, ptr[j]);
+      }
+      for (j = 0; j < 3; j++)
+        put_buffer(pb, data[j], ptr[j]);
+      
+      return 0; // /MEANX
+#endif
 }
 
 static void get_aac_sample_rates(AVFormatContext *s, AVCodecContext *codec, int *sample_rate, int *output_sample_rate)
@@ -534,6 +557,23 @@
         put_ebml_uint (pb, MATROSKA_ID_TRACKNUMBER     , i + 1);
         put_ebml_uint (pb, MATROSKA_ID_TRACKUID        , i + 1);
         put_ebml_uint (pb, MATROSKA_ID_TRACKFLAGLACING , 0);    // no lacing (yet)
+/**  MEANX : Add a default duration for video **/
+        if(codec->codec_type==CODEC_TYPE_VIDEO)
+        {
+          if(codec->time_base.den && codec->time_base.num)
+          {
+            int num=codec->time_base.num;
+            int den=codec->time_base.den;
+            unsigned int default_duration;
+            float period=num;
+                  period/=den;
+                  period*=1000*1000*1000; // in ns
+                  default_duration=(unsigned int)floor(period);
+                  put_ebml_uint (pb, MATROSKA_ID_TRACKDEFAULTDURATION ,default_duration);
+          }
+        }
+        
+/**  MEANX : Add a default duration for video **/
 
         if ((tag = av_metadata_get(st->metadata, "description", NULL, 0)))
             put_ebml_string(pb, MATROSKA_ID_TRACKNAME, tag->value);
@@ -907,3 +947,13 @@
     .flags = AVFMT_GLOBALHEADER,
     .codec_tag = (const AVCodecTag* const []){codec_wav_tags, 0},
 };
+// MEANX
+//
+int matroskaenc_init(void)
+{
+    av_register_output_format(&matroska_muxer);
+    return 0;
+}
+// /MEANX
+
+

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/movenc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/movenc.c	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/movenc.c	2009-05-02 13:54:49 UTC (rev 4797)
@@ -2017,3 +2017,15 @@
     .codec_tag = (const AVCodecTag* const []){codec_ipod_tags, 0},
 };
 #endif
+/* MEANX */
+int movenc_init(void)
+{
+    av_register_output_format(&mov_muxer);
+    av_register_output_format(&tgp_muxer);
+    av_register_output_format(&mp4_muxer);
+    av_register_output_format(&psp_muxer);
+    av_register_output_format(&tg2_muxer);
+    av_register_output_format(&ipod_muxer);
+    return 0;
+}
+/* MEANX */

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/avutil.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/avutil.h	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/avutil.h	2009-05-02 13:54:49 UTC (rev 4797)
@@ -26,7 +26,14 @@
  * external API header
  */
 
+/* MEANX
+ * - */
+#define ASMALIGN(ZEROBITS) ".p2align " #ZEROBITS "\n\t"
+/* /MEANX
+ */
 
+
+
 #define AV_STRINGIFY(s)         AV_TOSTRING(s)
 #define AV_TOSTRING(s) #s
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/bswap.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/bswap.h	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/bswap.h	2009-05-02 13:54:49 UTC (rev 4797)
@@ -27,7 +27,12 @@
 #define AVUTIL_BSWAP_H
 
 #include <stdint.h>
+// MEANX
+#ifndef ADM_NO_CONFIG_H
 #include "config.h"
+#endif
+// MEANX
+
 #include "common.h"
 
 #if   ARCH_ARM

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/internal.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/internal.h	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/internal.h	2009-05-02 13:54:49 UTC (rev 4797)
@@ -215,12 +215,14 @@
 #endif
 
 /* avoid usage of dangerous/inappropriate system functions */
+#if 0 //MEANX
 #undef  malloc
 #define malloc please_use_av_malloc
 #undef  free
 #define free please_use_av_free
 #undef  realloc
 #define realloc please_use_av_realloc
+#endif
 #undef  time
 #define time time_is_forbidden_due_to_security_issues
 #undef  rand

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/intreadwrite.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/intreadwrite.h	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/intreadwrite.h	2009-05-02 13:54:49 UTC (rev 4797)
@@ -20,7 +20,12 @@
 #define AVUTIL_INTREADWRITE_H
 
 #include <stdint.h>
+// MEANX
+#ifndef ADM_NO_CONFIG_H
 #include "config.h"
+#endif
+// MEANX
+
 #include "bswap.h"
 
 /*

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/mem.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/mem.c	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/mem.c	2009-05-02 13:54:49 UTC (rev 4797)
@@ -46,87 +46,110 @@
 
 void *av_malloc(unsigned int size)
 {
-    void *ptr = NULL;
-#if CONFIG_MEMALIGN_HACK
-    long diff;
-#endif
+#ifdef __APPLE__
+	return malloc(size);
+#else
+	char *c;
 
-    /* let's disallow possible ambiguous cases */
-    if(size > (INT_MAX-16) )
-        return NULL;
+	uint64_t l, lorg;
+	uint32_t *backdoor;
 
-#if CONFIG_MEMALIGN_HACK
-    ptr = malloc(size+16);
-    if(!ptr)
-        return ptr;
-    diff= ((-(long)ptr - 1)&15) + 1;
-    ptr = (char*)ptr + diff;
-    ((char*)ptr)[-1]= diff;
-#elif HAVE_POSIX_MEMALIGN
-    if (posix_memalign(&ptr,16,size))
-        ptr = NULL;
-#elif HAVE_MEMALIGN
-    ptr = memalign(16,size);
-    /* Why 64?
-       Indeed, we should align it:
-         on 4 for 386
-         on 16 for 486
-         on 32 for 586, PPro - K6-III
-         on 64 for K7 (maybe for P3 too).
-       Because L1 and L2 caches are aligned on those values.
-       But I don't want to code such logic here!
-     */
-     /* Why 16?
-        Because some CPUs need alignment, for example SSE2 on P4, & most RISC CPUs
-        it will just trigger an exception and the unaligned load will be done in the
-        exception handler or it will just segfault (SSE2 on P4).
-        Why not larger? Because I did not see a difference in benchmarks ...
-     */
-     /* benchmarks with P3
-        memalign(64)+1          3071,3051,3032
-        memalign(64)+2          3051,3032,3041
-        memalign(64)+4          2911,2896,2915
-        memalign(64)+8          2545,2554,2550
-        memalign(64)+16         2543,2572,2563
-        memalign(64)+32         2546,2545,2571
-        memalign(64)+64         2570,2533,2558
+	l = (uint64_t)malloc(size + 32);
 
-        BTW, malloc seems to do 8-byte alignment by default here.
-     */
-#else
-    ptr = malloc(size);
+	// Get next boundary
+	lorg = l;
+	l = (l + 15) & 0xfffffffffffffff0LL;
+	l += 16;
+	c = (char*)l;
+	backdoor = (uint32_t*)(c - 8);
+	*backdoor = (0xdead << 16) + l - lorg;
+	backdoor[1] = size;
+
+	return c;
 #endif
-    return ptr;
 }
 
-void *av_realloc(void *ptr, unsigned int size)
+void *av_realloc(void *ptr, unsigned int newsize)
 {
-#if CONFIG_MEMALIGN_HACK
-    int diff;
-#endif
+#ifdef __APPLE__
+	if (!ptr)
+		return av_malloc(newsize);
 
-    /* let's disallow possible ambiguous cases */
-    if(size > (INT_MAX-16) )
-        return NULL;
+	if (!newsize)
+	{
+		av_free(ptr);
+		return NULL;
+	}
 
-#if CONFIG_MEMALIGN_HACK
-    //FIXME this isn't aligned correctly, though it probably isn't needed
-    if(!ptr) return av_malloc(size);
-    diff= ((char*)ptr)[-1];
-    return (char*)realloc((char*)ptr - diff, size + diff) + diff;
+	return realloc(ptr, newsize);
 #else
-    return realloc(ptr, size);
+	void *nalloc;
+
+	if (!ptr)
+		return av_malloc(newsize);
+
+	if (!newsize) 
+	{
+		av_free(ptr);
+		return NULL;
+	}
+
+	// now we either shrink them or expand them
+	// in case of shrink, we do nothing
+	// in case of expand we have to copy
+	// Do copy everytime (slower)
+	uint32_t *backdoor;
+	uint32_t size, offset;
+	char *c = (char*)ptr;
+
+	backdoor = (uint32_t*)ptr;
+	backdoor -= 2;
+
+	assert(((*backdoor) >> 16) == 0xdead);
+
+	offset = backdoor[0] & 0xffff;
+	size = backdoor[1];
+
+	if(size >= newsize) // do nothing
+		return ptr;
+
+	// Allocate a new one
+	nalloc = av_malloc(newsize);
+	memcpy(nalloc, ptr, size);
+	av_free(ptr);
+
+	return nalloc;
 #endif
 }
 
 void av_free(void *ptr)
 {
-    /* XXX: this test should not be needed on most libcs */
-    if (ptr)
-#if CONFIG_MEMALIGN_HACK
-        free((char*)ptr - ((char*)ptr)[-1]);
+#ifdef __APPLE__
+	if (!ptr)
+		return;
+
+	free(ptr);
 #else
-        free(ptr);
+	uint32_t *backdoor;
+	uint32_t size, offset;
+	char *c = (char*)ptr;
+
+	if (!ptr)
+		return;
+
+	backdoor = (uint32_t*)ptr;
+	backdoor -= 2;
+
+	if (*backdoor == 0xbeefbeef)
+		assert(0);
+
+	assert(((*backdoor) >> 16) == 0xdead);
+
+	offset = backdoor[0] & 0xffff;
+	size = backdoor[1];
+	*backdoor = 0xbeefbeef; // Scratch sig
+
+	free(c - offset);
 #endif
 }
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/swscale.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/swscale.c	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/swscale.c	2009-05-02 13:54:49 UTC (rev 4797)
@@ -960,12 +960,15 @@
 #define COMPILE_C
 #endif
 
+#if 0 // MEANX
 #ifdef ARCH_PPC
 #if (defined (HAVE_ALTIVEC) || defined (RUNTIME_CPUDETECT)) && defined (CONFIG_GPL)
 #define COMPILE_ALTIVEC
 #endif //HAVE_ALTIVEC
 #endif //ARCH_PPC
+#endif // MEANX
 
+
 #if defined(ARCH_X86)
 
 #if ((defined (HAVE_MMX) && !defined (HAVE_3DNOW) && !defined (HAVE_MMX2)) || defined (RUNTIME_CPUDETECT)) && defined (CONFIG_GPL)

Deleted: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libswscale_swscale_internal.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libswscale_swscale_internal.h.patch	2009-05-02 13:54:47 UTC (rev 4796)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libswscale_swscale_internal.h.patch	2009-05-02 13:54:49 UTC (rev 4797)
@@ -1,19 +0,0 @@
-*** libswscale/swscale_internal.h.old	Wed Mar  4 20:10:31 2009
---- libswscale/swscale_internal.h	Wed Mar  4 20:10:30 2009
-***************
-*** 33,39 ****
-  
-  #define MAX_FILTER_SIZE 256
-  
-! #define VOFW 2048
-  #define VOF  (VOFW*2)
-  
-  #ifdef WORDS_BIGENDIAN
---- 33,39 ----
-  
-  #define MAX_FILTER_SIZE 256
-  
-! #define VOFW 4096
-  #define VOF  (VOFW*2)
-  
-  #ifdef WORDS_BIGENDIAN



From mean at mail.berlios.de  Sat May  2 15:54:56 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:54:56 +0200
Subject: [Avidemux-svn-commit] r4798 - in
	branches/avidemux_2.6_branch_mean/avidemux:
	ADM_audioParser/src ADM_coreImage/include
	ADM_libraries/ADM_ffmpeg/libavutil ADM_libraries/ADM_ffmpeg/patches
Message-ID: <200905021354.n42DsuAo011214@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:54:55 +0200 (Sat, 02 May 2009)
New Revision: 4798

Added:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/internal_h.patch
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/timer_h.patch
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audioParser/src/ADM_dcainfo.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/include/ADM_pp.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/internal.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/timer.h
Log:
[FFmpeg update] Timer & internal needs patching too

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_audioParser/src/ADM_dcainfo.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audioParser/src/ADM_dcainfo.cpp	2009-05-02 13:54:49 UTC (rev 4797)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audioParser/src/ADM_dcainfo.cpp	2009-05-02 13:54:55 UTC (rev 4798)
@@ -11,12 +11,14 @@
 #define ADM_NO_CONFIG_H
 extern "C"
 {
+#include "ADM_libraries/ADM_ffmpeg/ffmpeg_config/config.h"
+#include "ADM_libraries/ADM_ffmpeg/libavutil/internal.h"
 #include "ADM_libraries/ADM_ffmpeg/libavutil/common.h"
 #include "ADM_libraries/ADM_ffmpeg/libavutil/bswap.h"
 #include "ADM_libraries/ADM_ffmpeg/libavcodec/get_bits.h"
 
 }
-
+#undef printf
 /*
         Borrowed from libdca
 */

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/include/ADM_pp.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/include/ADM_pp.h	2009-05-02 13:54:49 UTC (rev 4797)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/include/ADM_pp.h	2009-05-02 13:54:55 UTC (rev 4798)
@@ -12,7 +12,7 @@
 #ifndef ADMPP
 #define ADMPP
 extern "C" {
-#include "../ADM_libpostproc/postprocess.h"
+#include "../libpostproc/postprocess.h"
 }
 typedef struct ADM_PP
 {

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/internal.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/internal.h	2009-05-02 13:54:49 UTC (rev 4797)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/internal.h	2009-05-02 13:54:55 UTC (rev 4798)
@@ -34,7 +34,11 @@
 #include <stdint.h>
 #include <stddef.h>
 #include <assert.h>
+// MEANX
+#ifndef ADM_NO_CONFIG_H
 #include "config.h"
+#endif
+// MEANX
 #include "common.h"
 #include "mem.h"
 #include "timer.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/timer.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/timer.h	2009-05-02 13:54:49 UTC (rev 4797)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/timer.h	2009-05-02 13:54:55 UTC (rev 4798)
@@ -26,8 +26,13 @@
 
 #include <stdlib.h>
 #include <stdint.h>
+// MEANX
+#ifndef ADM_NO_CONFIG_H
 #include "config.h"
+#endif
+// MEANX
 
+
 #if   ARCH_ARM
 #   include "arm/timer.h"
 #elif ARCH_BFIN

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/internal_h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/internal_h.patch	2009-05-02 13:54:49 UTC (rev 4797)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/internal_h.patch	2009-05-02 13:54:55 UTC (rev 4798)
@@ -0,0 +1,16 @@
+diff --git a/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/internal.h b/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/internal.h
+index 7a38fb1..bf845f8 100644
+--- libavutil/internal.h
++++ libavutil/internal.h
+@@ -34,7 +34,11 @@
+ #include <stdint.h>
+ #include <stddef.h>
+ #include <assert.h>
++// MEANX
++#ifndef ADM_NO_CONFIG_H
+ #include "config.h"
++#endif
++// MEANX
+ #include "common.h"
+ #include "mem.h"
+ #include "timer.h"

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/timer_h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/timer_h.patch	2009-05-02 13:54:49 UTC (rev 4797)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/timer_h.patch	2009-05-02 13:54:55 UTC (rev 4798)
@@ -0,0 +1,17 @@
+diff --git a/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/timer.h b/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/timer.h
+index db0abae..6be1e88 100644
+--- libavutil/timer.h
++++ libavutil/timer.h
+@@ -26,7 +26,12 @@
+ 
+ #include <stdlib.h>
+ #include <stdint.h>
++// MEANX
++#ifndef ADM_NO_CONFIG_H
+ #include "config.h"
++#endif
++// MEANX
++
+ 
+ #if   ARCH_ARM
+ #   include "arm/timer.h"



From mean at mail.berlios.de  Sat May  2 15:54:57 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:54:57 +0200
Subject: [Avidemux-svn-commit] r4799 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches
Message-ID: <200905021354.n42DsvwX011225@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:54:57 +0200 (Sat, 02 May 2009)
New Revision: 4799

Added:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/x86_bswap_h.patch
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/x86_mathops_h.patch
Log:
[FFmpeg x86 patches

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/x86_bswap_h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/x86_bswap_h.patch	2009-05-02 13:54:55 UTC (rev 4798)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/x86_bswap_h.patch	2009-05-02 13:54:57 UTC (rev 4799)
@@ -0,0 +1,17 @@
+diff --git a/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/x86/bswap.h b/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/x86/bswap.h
+index 3eeb5a4..82626f2 100644
+--- libavutil/x86/bswap.h
++++ libavutil/x86/bswap.h
+@@ -25,7 +25,12 @@
+ #define AVUTIL_X86_BSWAP_H
+ 
+ #include <stdint.h>
++// MEANX
++#ifndef ADM_NO_CONFIG_H
+ #include "config.h"
++#endif
++// MEANX
++
+ #include "libavutil/common.h"
+ 
+ #define bswap_16 bswap_16

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/x86_mathops_h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/x86_mathops_h.patch	2009-05-02 13:54:55 UTC (rev 4798)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/x86_mathops_h.patch	2009-05-02 13:54:57 UTC (rev 4799)
@@ -0,0 +1,17 @@
+diff --git a/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/x86/mathops.h b/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/x86/mathops.h
+index a66c601..d8257f0 100644
+--- libavcodec/x86/mathops.h
++++ libavcodec/x86/mathops.h
+@@ -22,7 +22,12 @@
+ #ifndef AVCODEC_X86_MATHOPS_H
+ #define AVCODEC_X86_MATHOPS_H
+ 
++// MEANX
++#ifndef ADM_NO_CONFIG_H
+ #include "config.h"
++#endif
++// MEANX
++
+ #include "libavutil/common.h"
+ 
+ #if ARCH_X86_32



From mean at mail.berlios.de  Sat May  2 15:54:59 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:54:59 +0200
Subject: [Avidemux-svn-commit] r4800 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs
Message-ID: <200905021354.n42Dsx6b011236@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:54:58 +0200 (Sat, 02 May 2009)
New Revision: 4800

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp
Log:
[Codec] no mmore PIX_FMT_RGBA32, replace it with PIX_FMT_RGBA

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp	2009-05-02 13:54:57 UTC (rev 4799)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp	2009-05-02 13:54:58 UTC (rev 4800)
@@ -440,7 +440,7 @@
       out->_colorspace = ADM_COLOR_YV12;
       break;
 
-    case PIX_FMT_RGBA32:
+    case PIX_FMT_RGBA: // ???PIX_FMT_RGBA32:
       out->_colorspace = ADM_COLOR_RGB32A;
       break;
     case PIX_FMT_RGB555:



From mean at mail.berlios.de  Sat May  2 15:55:00 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:55:00 +0200
Subject: [Avidemux-svn-commit] r4801 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src
Message-ID: <200905021355.n42Dt0N4011246@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:55:00 +0200 (Sat, 02 May 2009)
New Revision: 4801

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src/ADM_colorspace.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src/ADM_imageResizer.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src/ADM_rgb.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src/rgb2yuv.cpp
Log:
[ColorSpace] update to new ffmpeg

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src/ADM_colorspace.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src/ADM_colorspace.cpp	2009-05-02 13:54:58 UTC (rev 4800)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src/ADM_colorspace.cpp	2009-05-02 13:55:00 UTC (rev 4801)
@@ -20,9 +20,9 @@
 
 
 extern "C" {
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
+#include "ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h"
 #include "ADM_libraries/ADM_ffmpeg/libavutil/avutil.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h"
+#include "ADM_libraries/ADM_ffmpeg/libswscale/swscale.h"
 }
 
 #include "ADM_rgb.h" 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src/ADM_imageResizer.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src/ADM_imageResizer.cpp	2009-05-02 13:54:58 UTC (rev 4800)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src/ADM_imageResizer.cpp	2009-05-02 13:55:00 UTC (rev 4801)
@@ -16,8 +16,8 @@
 #include "ADM_image.h"
 
 extern "C" {
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h"
+#include "ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h"
+#include "ADM_libraries/ADM_ffmpeg/libswscale/swscale.h"
 }
 
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src/ADM_rgb.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src/ADM_rgb.cpp	2009-05-02 13:54:58 UTC (rev 4800)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src/ADM_rgb.cpp	2009-05-02 13:55:00 UTC (rev 4801)
@@ -24,9 +24,9 @@
 #include "ADM_colorspace.h"
 
 extern "C" {
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
+#include "ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h"
 #include "ADM_libraries/ADM_ffmpeg/libavutil/avutil.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h"
+#include "ADM_libraries/ADM_ffmpeg/libswscale/swscale.h"
 }
 
 	

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src/rgb2yuv.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src/rgb2yuv.cpp	2009-05-02 13:54:58 UTC (rev 4800)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src/rgb2yuv.cpp	2009-05-02 13:55:00 UTC (rev 4801)
@@ -26,8 +26,8 @@
 
 
 extern "C" {
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h"
+#include "ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h"
+#include "ADM_libraries/ADM_ffmpeg/libswscale/swscale.h"
 }
 
 #include "ADM_colorspace.h"



From mean at mail.berlios.de  Sat May  2 15:55:02 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:55:02 +0200
Subject: [Avidemux-svn-commit] r4802 - in
	branches/avidemux_2.6_branch_mean/avidemux: .
	ADM_coreImage/src ADM_coreMuxer/include ADM_coreMuxer/src
Message-ID: <200905021355.n42Dt2dd011258@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:55:02 +0200 (Sat, 02 May 2009)
New Revision: 4802

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src/DIA_flyDialog.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreMuxer/include/ADM_muxerUtils.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreMuxer/src/ADM_dynaMuxer.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_lavcodec.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_preview.cpp
Log:
[FFmpeg update] impact on muxer & swscale user

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src/DIA_flyDialog.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src/DIA_flyDialog.cpp	2009-05-02 13:55:00 UTC (rev 4801)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/src/DIA_flyDialog.cpp	2009-05-02 13:55:02 UTC (rev 4802)
@@ -19,7 +19,7 @@
 #include "ADM_assert.h"
 
 extern "C" {
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
+#include "ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h"
 }
 
 ADM_flyDialog::ADM_flyDialog(uint32_t width,uint32_t height,AVDMGenericVideoStream *in,

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreMuxer/include/ADM_muxerUtils.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreMuxer/include/ADM_muxerUtils.h	2009-05-02 13:55:00 UTC (rev 4801)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreMuxer/include/ADM_muxerUtils.h	2009-05-02 13:55:02 UTC (rev 4802)
@@ -17,7 +17,7 @@
 #define ADM_MUXER_UTILS_H
 extern "C" 
 {
-#include "ADM_lavformat/avformat.h"
+#include "libavformat/avformat.h"
 };
 
 #define ADM_NO_PTS 0xFFFFFFFFFFFFFFFFLL // FIXME

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreMuxer/src/ADM_dynaMuxer.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreMuxer/src/ADM_dynaMuxer.cpp	2009-05-02 13:55:00 UTC (rev 4801)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreMuxer/src/ADM_dynaMuxer.cpp	2009-05-02 13:55:02 UTC (rev 4802)
@@ -168,8 +168,8 @@
 //___________________________________________
 extern "C"
 {
-    #include "ADM_libraries/ADM_ffmpeg/ADM_lavformat/avformat.h"
-    #include "ADM_libraries/ADM_ffmpeg/ADM_lavformat/avio.h" // to get regiter protocol
+    #include "ADM_libraries/ADM_ffmpeg/libavformat/avformat.h"
+    #include "ADM_libraries/ADM_ffmpeg/libavformat/avio.h" // to get regiter protocol
 };
 extern "C"
 {

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_lavcodec.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_lavcodec.h	2009-05-02 13:55:00 UTC (rev 4801)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_lavcodec.h	2009-05-02 13:55:02 UTC (rev 4802)
@@ -18,6 +18,6 @@
   #define  __ADM_LAVC
   extern "C"
   {  
-  #include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
+  #include "ADM_libraries/ADM_ffmpeg/libavcodec/avcodec.h"
   };
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_preview.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_preview.cpp	2009-05-02 13:55:00 UTC (rev 4801)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_preview.cpp	2009-05-02 13:55:02 UTC (rev 4802)
@@ -44,7 +44,7 @@
 #include "ADM_osSupport/ADM_debugID.h"
 #define MODULE_NAME MODULE_PREVIEW
 #include "ADM_osSupport/ADM_debug.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_libswscale/ADM_mp.h"
+#include "ADM_libraries/ADM_ffmpeg/libswscale/ADM_mp.h"
 #include "ADM_userInterfaces/ADM_commonUI/GUI_ui.h"
 #include "ADM_preview.h"
 #define MAX(a,b) ( (a)>(b) ? (a) : (b) )



From mean at mail.berlios.de  Sat May  2 15:55:03 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:55:03 +0200
Subject: [Avidemux-svn-commit] r4803 - in
	branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils:
	include src
Message-ID: <200905021355.n42Dt3WF011276@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:55:03 +0200 (Sat, 02 May 2009)
New Revision: 4803

Added:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils/include/ADM_getbits.h
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils/src/ADM_infoExtractor.cpp
Log:
[Core] Add ADM_getbits to wrap ffmpeg get_bits properly

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils/include/ADM_getbits.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils/include/ADM_getbits.h	2009-05-02 13:55:02 UTC (rev 4802)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils/include/ADM_getbits.h	2009-05-02 13:55:03 UTC (rev 4803)
@@ -0,0 +1,35 @@
+/**
+        \file ADM_getbits.h
+        \brief Wrapper around ffmpeg getbits function
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+
+#include "ADM_default.h"
+
+#ifndef ADM_getbits_H
+#define ADM_getbits_H
+extern "C"
+{
+#define ADM_NO_CONFIG_H
+#include "common.h"
+#include "bswap.h"
+#define INT_MAX (0x7FFFFFFF)
+#include "ADM_libraries/ADM_ffmpeg/ffmpeg_config/config.h"
+#include "ADM_libraries/ADM_ffmpeg/libavutil/internal.h"
+#include "ADM_libraries/ADM_ffmpeg/libavcodec/get_bits.h"
+#include "ADM_libraries/ADM_ffmpeg/libavcodec/golomb.h"
+}
+#undef printf
+
+
+#endif
+

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils/src/ADM_infoExtractor.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils/src/ADM_infoExtractor.cpp	2009-05-02 13:55:02 UTC (rev 4802)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils/src/ADM_infoExtractor.cpp	2009-05-02 13:55:03 UTC (rev 4803)
@@ -20,16 +20,7 @@
 //#include "ADM_mp4.h"
 
 #define aprintf(...) {}
-extern "C"
-{
-#define ADM_NO_CONFIG_H
-#include "common.h"
-#include "bswap.h"
-#define INT_MAX (0x7FFFFFFF)
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/bitstream.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/golomb.h"
-}
-
+#include "ADM_getbits.h"
 #include "ADM_h264_tag.h"
 
 static void refineH264FrameType(uint8_t *head,uint8_t *tail,uint32_t *flags);



From mean at mail.berlios.de  Sat May  2 15:55:05 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:55:05 +0200
Subject: [Avidemux-svn-commit] r4804 - in
	branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg:
	libavcodec/x86 libavutil/x86
Message-ID: <200905021355.n42Dt5YA011304@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:55:05 +0200 (Sat, 02 May 2009)
New Revision: 4804

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/x86/mathops.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/x86/bswap.h
Log:
[FFmpeg] x86 patches

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/x86/mathops.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/x86/mathops.h	2009-05-02 13:55:03 UTC (rev 4803)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/x86/mathops.h	2009-05-02 13:55:05 UTC (rev 4804)
@@ -22,7 +22,12 @@
 #ifndef AVCODEC_X86_MATHOPS_H
 #define AVCODEC_X86_MATHOPS_H
 
+// MEANX
+#ifndef ADM_NO_CONFIG_H
 #include "config.h"
+#endif
+// MEANX
+
 #include "libavutil/common.h"
 
 #if ARCH_X86_32

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/x86/bswap.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/x86/bswap.h	2009-05-02 13:55:03 UTC (rev 4803)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/x86/bswap.h	2009-05-02 13:55:05 UTC (rev 4804)
@@ -25,7 +25,12 @@
 #define AVUTIL_X86_BSWAP_H
 
 #include <stdint.h>
+// MEANX
+#ifndef ADM_NO_CONFIG_H
 #include "config.h"
+#endif
+// MEANX
+
 #include "libavutil/common.h"
 
 #define bswap_16 bswap_16



From mean at mail.berlios.de  Sat May  2 15:55:09 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:55:09 +0200
Subject: [Avidemux-svn-commit] r4806 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale
Message-ID: <200905021355.n42Dt97J011325@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:55:08 +0200 (Sat, 02 May 2009)
New Revision: 4806

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/swscale.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/yuv2rgb.c
Log:
[swscale] Butcher out BlackFin, Vis & imlib

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/swscale.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/swscale.c	2009-05-02 13:55:07 UTC (rev 4805)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/swscale.c	2009-05-02 13:55:08 UTC (rev 4806)
@@ -2421,12 +2421,12 @@
         {
             c->swScale= gray16swap;
         }
-
+#if 0 // MEANX
 #ifdef ARCH_BFIN
         if (flags & SWS_CPU_CAPS_BFIN)
             ff_bfin_get_unscaled_swscale (c);
 #endif
-
+#endif
         if (c->swScale){
             if (flags&SWS_PRINT_INFO)
                 av_log(c, AV_LOG_INFO, "using unscaled %s -> %s special converter\n",

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/yuv2rgb.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/yuv2rgb.c	2009-05-02 13:55:07 UTC (rev 4805)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libswscale/yuv2rgb.c	2009-05-02 13:55:08 UTC (rev 4806)
@@ -509,6 +509,7 @@
         }
     }
 #endif
+#if 0 // MEANX
 #ifdef HAVE_VIS
     {
         SwsFunc t= yuv2rgb_init_vis(c);
@@ -521,6 +522,7 @@
         if (t) return t;
     }
 #endif
+#endif
 #ifdef HAVE_ALTIVEC
     if (c->flags & SWS_CPU_CAPS_ALTIVEC)
     {
@@ -528,7 +530,7 @@
         if (t) return t;
     }
 #endif
-
+#if 0
 #ifdef ARCH_BFIN
     if (c->flags & SWS_CPU_CAPS_BFIN)
     {
@@ -536,6 +538,7 @@
         if (t) return t;
     }
 #endif
+#endif
 
     av_log(c, AV_LOG_WARNING, "No accelerated colorspace conversion found.\n");
 



From mean at mail.berlios.de  Sat May  2 15:55:07 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:55:07 +0200
Subject: [Avidemux-svn-commit] r4805 - in
	branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg:
	libavcodec libavformat libavutil
Message-ID: <200905021355.n42Dt7pi011314@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:55:07 +0200 (Sat, 02 May 2009)
New Revision: 4805

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/CMakeLists.txt
Log:
[FFmpeg] compile new files

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/CMakeLists.txt	2009-05-02 13:55:05 UTC (rev 4804)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/CMakeLists.txt	2009-05-02 13:55:07 UTC (rev 4805)
@@ -13,6 +13,11 @@
         #lcl.c  
         snow.c  rangecoder.c  bitstream.c  h264idct.c  h261.c
 	#amr.c  
+        rdft.c
+        avpacket.c
+        flacdec.c
+        flacdata.c
+        vp6dsp.c
         tscc.c  resample2.c    qdm2.c  bitstream_filter.c  eval.c  vc1.c
 	vc1dsp.c  vp56.c  vp6.c  vp5.c  indeo2.c  smacker.c  opt.c  fraps.c  dnxhddec.c
 	mpeg12data.c  mpegaudiodata.c  msmpeg4data.c  vc1data.c  vp56data.c  mjpegbdec.c
@@ -31,6 +36,8 @@
 		x86/fdct_mmx.c  x86/motion_est_mmx.c  x86/simple_idct_mmx.c  
 		x86/vp3dsp_sse2.c  x86/idct_mmx_xvid.c    x86/snowdsp_mmx.c
                 x86/idct_sse2_xvid.c 
+                x86/vp6dsp_mmx.c
+                x86/vp6dsp_sse2.c
                 #x86/fft_sse.c
                 #x86/fft_3dn2.c
 		#x86/fft_3dn.c  

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/CMakeLists.txt	2009-05-02 13:55:05 UTC (rev 4804)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavformat/CMakeLists.txt	2009-05-02 13:55:07 UTC (rev 4805)
@@ -4,6 +4,7 @@
 	mpeg.c  utils.c  avio.c  aviobuf.c  cutils.c  img2.c  file.c  mpegtsenc.c
 	movenc.c  avienc.c  wav.c  mov.c  matroska.c  isom.c  isom.h  
 	flvenc.c  matroskaenc.c metadata.c metadata_compat.c options.c
+        flacenc.c
 	avc.c raw.c  riff.c)
 
 ADD_LIBRARY(${ADM_LIB} SHARED ${${ADM_LIB}_SRCS})

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/CMakeLists.txt	2009-05-02 13:55:05 UTC (rev 4804)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/CMakeLists.txt	2009-05-02 13:55:07 UTC (rev 4805)
@@ -15,11 +15,14 @@
 mathematics.c
 md5.c
 #random.c
+random_seed.c
 rational.c
 rc4.c
 sha1.c
 #string.c
+avstring.c
 tree.c
+lfg.c
 )
 
 ADD_LIBRARY(${ADM_LIB} SHARED ${${ADM_LIB}_SRCS})



From mean at mail.berlios.de  Sat May  2 15:55:11 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:55:11 +0200
Subject: [Avidemux-svn-commit] r4807 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2
Message-ID: <200905021355.n42DtBhn011350@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:55:11 +0200 (Sat, 02 May 2009)
New Revision: 4807

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
Log:
[FFmpeg] update path to .h

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2009-05-02 13:55:08 UTC (rev 4806)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2009-05-02 13:55:11 UTC (rev 4807)
@@ -36,7 +36,7 @@
 #include "../ADM_render/GUI_accelRender.h"
 
 #include "ADM_colorspace.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_libswscale/ADM_mp.h"
+#include "ADM_libraries/ADM_ffmpeg/libswscale/ADM_mp.h"
 
 void GUI_gtk_grow_off(int onff);
 



From mean at mail.berlios.de  Sat May  2 15:55:12 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 15:55:12 +0200
Subject: [Avidemux-svn-commit] r4808 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs
Message-ID: <200905021355.n42DtC0x011361@sheep.berlios.de>

Author: mean
Date: 2009-05-02 15:55:12 +0200 (Sat, 02 May 2009)
New Revision: 4808

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_png.cpp
Log:
[Codec] ugly hack to prevent use of png.h from ffmpeg

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_png.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_png.cpp	2009-05-02 13:55:11 UTC (rev 4807)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_png.cpp	2009-05-02 13:55:12 UTC (rev 4808)
@@ -30,7 +30,7 @@
 #include "ADM_codecs/ADM_png.h"
 extern "C"
 {
-#include "png.h"
+#include "/usr/include/png.h"
 }
 #include "ADM_assert.h"
 



From mean at mail.berlios.de  Sat May  2 21:27:17 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 2 May 2009 21:27:17 +0200
Subject: [Avidemux-svn-commit] r4809 - in branches/avidemux_2.6_branch_mean:
	avidemux/ADM_coreUtils/include
	plugins/ADM_audioEncoders/lavcodec plugins/ADM_demuxers/Flv
	plugins/ADM_demuxers/MpegTS
Message-ID: <200905021927.n42JRHOv018364@sheep.berlios.de>

Author: mean
Date: 2009-05-02 21:27:16 +0200 (Sat, 02 May 2009)
New Revision: 4809

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils/include/ADM_getbits.h
   branches/avidemux_2.6_branch_mean/plugins/ADM_audioEncoders/lavcodec/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Flv/ADM_flv.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp
Log:
[Plugins] follow ffmpeg update

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils/include/ADM_getbits.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils/include/ADM_getbits.h	2009-05-02 13:55:12 UTC (rev 4808)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils/include/ADM_getbits.h	2009-05-02 19:27:16 UTC (rev 4809)
@@ -20,16 +20,17 @@
 extern "C"
 {
 #define ADM_NO_CONFIG_H
-#include "common.h"
-#include "bswap.h"
+#include "ADM_libraries/ADM_ffmpeg/libavutil/common.h"
+#include "ADM_libraries/ADM_ffmpeg/libavutil/bswap.h"
+#ifndef INT_MAX
 #define INT_MAX (0x7FFFFFFF)
+#endif
 #include "ADM_libraries/ADM_ffmpeg/ffmpeg_config/config.h"
 #include "ADM_libraries/ADM_ffmpeg/libavutil/internal.h"
 #include "ADM_libraries/ADM_ffmpeg/libavcodec/get_bits.h"
 #include "ADM_libraries/ADM_ffmpeg/libavcodec/golomb.h"
 }
 #undef printf
-
-
+#undef sprintf
 #endif
 

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_audioEncoders/lavcodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_audioEncoders/lavcodec/CMakeLists.txt	2009-05-02 13:55:12 UTC (rev 4808)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_audioEncoders/lavcodec/CMakeLists.txt	2009-05-02 19:27:16 UTC (rev 4809)
@@ -1,7 +1,6 @@
 	INCLUDE(ae_plugin)
         INCLUDE_DIRECTORIES("${CMAKE_SOURCE_DIR}/../avidemux/")
-        INCLUDE_DIRECTORIES("${CMAKE_SOURCE_DIR}/../avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavcodec/")
-        INCLUDE_DIRECTORIES("${CMAKE_SOURCE_DIR}/../avidemux/ADM_libraries/ADM_ffmpeg/ADM_lavutil/")
+        INCLUDE_DIRECTORIES("${CMAKE_SOURCE_DIR}/../avidemux/ADM_libraries/ADM_ffmpeg/")
 
 	SET(ADM_ae_lav_mp2_SRCS audioencoder_lavcodec.cpp)
 

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp	2009-05-02 13:55:12 UTC (rev 4808)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp	2009-05-02 19:27:16 UTC (rev 4809)
@@ -144,7 +144,7 @@
 #else
     _chunk = 1536*wavheader.channels; // AC3
 #endif
-  printf("[Lavcodec]Incoming : fq : %lu, channel : %lu bitrate: %lu \n",
+  printf("[Lavcodec]Incoming : fq : %"LU", channel : %"LU" bitrate: %"LU" \n",
          wavheader.frequency,wavheader.channels,lavConfig.bitrate);
   
   
@@ -199,7 +199,7 @@
   tmphead+=_chunk;
   if (nbout < 0) 
   {
-    printf("[Lavcodec] Error !!! : %ld\n", nbout);
+    printf("[Lavcodec] Error !!! : %"LD"\n", nbout);
     return 0;
   }
   *len=nbout;

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Flv/ADM_flv.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Flv/ADM_flv.cpp	2009-05-02 13:55:12 UTC (rev 4808)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Flv/ADM_flv.cpp	2009-05-02 19:27:16 UTC (rev 4809)
@@ -26,7 +26,7 @@
 #include <math.h>
 
 // Borrowed from lavformt/flv.h
-#include "ADM_lavformat/flv.h"
+#include "libavformat/flv.h"
 // Borrowed from lavformt/flv.h
 uint32_t ADM_UsecFromFps1000(uint32_t fps1000);
 extern uint8_t extractH263FLVInfo(uint8_t *buffer,uint32_t len,uint32_t *w,uint32_t *h);

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp	2009-05-02 13:55:12 UTC (rev 4808)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp	2009-05-02 19:27:16 UTC (rev 4809)
@@ -29,6 +29,8 @@
 #include "ADM_videoInfoExtractor.h"
 #include "ADM_h264_tag.h"
 
+#include "ADM_getbits.h"
+#if 0
 extern "C"
 {
 #define ADM_NO_CONFIG_H
@@ -38,6 +40,7 @@
 #include "ADM_lavcodec/bitstream.h"
 #include "ADM_lavcodec/golomb.h"
 }
+#endif
 
 
 static const char Type[5]={'X','I','P','B','D'};

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/CMakeLists.txt	2009-05-02 13:55:12 UTC (rev 4808)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/CMakeLists.txt	2009-05-02 19:27:16 UTC (rev 4809)
@@ -15,6 +15,8 @@
 ADD_LIBRARY(ADM_dm_ts SHARED ${ADM_ts_SRCS})
 TARGET_LINK_LIBRARIES(ADM_dm_ts ADM_coreDemuxerMpeg ADM_audioParser)
 # For ffmpeg includes
+INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/") 
+INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries") 
 INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg") 
 INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_coreDemuxerMpeg/include")
 

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp	2009-05-02 13:55:12 UTC (rev 4808)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp	2009-05-02 19:27:16 UTC (rev 4809)
@@ -25,15 +25,7 @@
 
 #define TS_PES_MAX_LIMIT (1024*1024*2)
 
-
-#define ADM_NO_CONFIG_H
-extern "C"
-{
-#include "libavutil/common.h"
-#include "libavutil/bswap.h"
-#include "ADM_lavcodec/bitstream.h"
-
-}
+#include "ADM_getbits.h"
 #include "ADM_tsCrc.cpp"
 
 extern void mixDump(uint8_t *ptr, uint32_t len);



From mean at mail.berlios.de  Fri May  8 10:21:30 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 8 May 2009 10:21:30 +0200
Subject: [Avidemux-svn-commit] r4810 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_render
Message-ID: <200905080821.n488LUrn004501@sheep.berlios.de>

Author: mean
Date: 2009-05-08 10:21:30 +0200 (Fri, 08 May 2009)
New Revision: 4810

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_render/GUI_xvRender.cpp
Log:
[Xv] Fix xvideo (we only support yv12 anyway)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_render/GUI_xvRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_render/GUI_xvRender.cpp	2009-05-02 19:27:16 UTC (rev 4809)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_render/GUI_xvRender.cpp	2009-05-08 08:21:30 UTC (rev 4810)
@@ -23,7 +23,7 @@
 #include <stdlib.h>
 #include <string.h>
 
-//#define VERBOSE_XV
+#define VERBOSE_XV
 
 #ifdef USE_XV
 #include <X11/Xlib.h>
@@ -57,13 +57,13 @@
 }
 uint8_t XvAccelRender::init( GUI_WindowInfo * window, uint32_t w, uint32_t h)
 {
-	printf("Xv start\n");
+	printf("[Xvideo]Xv start\n");
 	return  GUI_XvInit( window,  w,  h);
 }
 uint8_t XvAccelRender::end(void)
 {
 	 GUI_XvEnd( );
-	 printf("Xv end\n");
+	 printf("[Xvideo]Xv end\n");
 	 return 1;
 }
 
@@ -93,10 +93,10 @@
  	ADM_assert(xv_display);
 
 
-  	printf("\n Releasing Xv Port\n");
+  	printf("[Xvideo] Releasing Xv Port\n");
   	XLockDisplay (xv_display);
 	if(XvUngrabPort(xv_display,xv_port,0)!=Success)
- 				printf("\n Trouble releasing port...\n");
+ 				printf("[Xvideo] Trouble releasing port...\n");
 	XUnlockDisplay (xv_display);
 
 
@@ -188,14 +188,14 @@
 
     if (Success != XvQueryExtension(WDN, &ver, &rel, &req, &ev, &err))
       {
-	  printf("\n Query Extension failed\n");
+	  printf("[Xvideo] Query Extension failed\n");
 	  goto failed;
       }
     /* check for Xvideo support */
     if (Success != XvQueryAdaptors(WDN,
 				   DefaultRootWindow(WDN), &adaptors, &ai))
       {
-	  printf("\n Query Adaptor failed\n");
+	  printf("[Xvideo] Query Adaptor failed\n");
 	  goto failed;
       }
     curai = ai;
@@ -214,12 +214,11 @@
 unsigned long num_adaptors;
 */
 #ifdef VERBOSE_XV
-	  printf("\n_______________________________\n");
-	  printf("\n Adaptor 		: %d", i);
-	  printf("\n Base ID		: %ld", curai->base_id);
-	  printf("\n Nb Port	 	: %lu", curai->num_ports);
-	  printf("\n Type			 	: %d,",
-		 curai->type);
+	  printf("[Xvideo]_______________________________\n");
+	  printf("[Xvideo] Adaptor 		: %d\n", i);
+	  printf("[Xvideo] Base ID		: %ld\n", curai->base_id);
+	  printf("[Xvideo] Nb Port	 	: %lu\n", curai->num_ports);
+	  printf("[Xvideo] Type			 	: %d,", curai->type);
 #define CHECK(x) if(curai->type & x) printf("|"#x);
 	  CHECK(XvInputMask);
 	  CHECK(XvOutputMask);
@@ -227,10 +226,10 @@
 	  CHECK(XvStillMask);
 	  CHECK(XvImageMask);
 
-	  printf("\n Name			 	: %s",
+	  printf("\n[Xvideo] Name			 	: %s\n",
 		 curai->name);
-	  printf("\n Num Adap	 	: %lu", curai->num_adaptors);
-	  printf("\n Num fmt	 	: %lu", curai->num_formats);
+	  printf("[Xvideo] Num Adap	 	: %lu\n", curai->num_adaptors);
+	  printf("[Xvideo] Num fmt	 	: %lu\n", curai->num_formats);
 #endif
 	  formats = curai->formats;
 
@@ -249,13 +248,13 @@
     //
     if (!port)
       {
-	  printf("\n no port found");
+	  printf("[Xvideo] no port found\n");
 	  goto failed;
       }
 #ifdef 	COLORSPACE_YV12
-    printf("\n Xv YV12 found at port :%d, format : %"LD, port, xv_format);
+    printf("[Xvideo] Xv YV12 found at port :%d, format : %"LD"\n", port, xv_format);
 #else
-    printf("\n Xv YUY2 found at port :%d, format : %"LD, port, xv_format);
+    printf("[Xvideo] Xv YUY2 found at port :%d, format : %"LD"\n", port, xv_format);
 #endif
 
     if (Success != XvGrabPort(WDN, port, 0))
@@ -322,11 +321,11 @@
 	//ADM_assert(BadWindow!=XSelectInput(xv_display, xv_win, ExposureMask | VisibilityChangeMask));
 
     }
-    printf("\n Xv init succeedeed\n");
+    printf("[Xvideo] Xv init succeedeed\n");
 
     return 1;
   failed:
-    printf("\n Xv init failed..\n");
+    printf("[Xvideo] Xv init failed..\n");
     return 0;
 }
 
@@ -348,14 +347,10 @@
 	for (k = 0; !f && (k < imgfmt); k++)
 	  {
 #ifdef VERBOSE_XV
-	      printf("\n %lx %d --> %s", port, formatValues[k].id,
-		     formatValues[k].guid);
+	      printf("[Xvideo]%d/%d: %lx %d --> %s\n", k,imgfmt,port, formatValues[k].id,  formatValues[k].guid);
 #endif
-#ifdef 	COLORSPACE_YV12
+
 	      if (!strcmp(formatValues[k].guid, "YV12"))
-#else
-	      if (!strcmp(formatValues[k].guid, "YUY2"))
-#endif
 		{
 		    f = 1;
 		    *fmt = formatValues[k].id;



From mean at mail.berlios.de  Fri May  8 10:21:32 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 8 May 2009 10:21:32 +0200
Subject: [Avidemux-svn-commit] r4811 - in
	branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg:
	libavcodec patches
Message-ID: <200905080821.n488LWPU004511@sheep.berlios.de>

Author: mean
Date: 2009-05-08 10:21:32 +0200 (Fri, 08 May 2009)
New Revision: 4811

Added:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ffpng.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavcodec_png.patch
Removed:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/png.h
Log:
[ffmpeg] png.h -> ffpng.h

Copied: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ffpng.h (from rev 4810, branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/png.h)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/png.h	2009-05-08 08:21:30 UTC (rev 4810)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/ffpng.h	2009-05-08 08:21:32 UTC (rev 4811)
@@ -0,0 +1,76 @@
+/*
+ * PNG image format
+ * Copyright (c) 2003 Fabrice Bellard
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
+#ifndef AVCODEC_PNG_H
+#define AVCODEC_PNG_H
+
+#include <stdint.h>
+
+#define PNG_COLOR_MASK_PALETTE    1
+#define PNG_COLOR_MASK_COLOR      2
+#define PNG_COLOR_MASK_ALPHA      4
+
+#define PNG_COLOR_TYPE_GRAY 0
+#define PNG_COLOR_TYPE_PALETTE  (PNG_COLOR_MASK_COLOR | PNG_COLOR_MASK_PALETTE)
+#define PNG_COLOR_TYPE_RGB        (PNG_COLOR_MASK_COLOR)
+#define PNG_COLOR_TYPE_RGB_ALPHA  (PNG_COLOR_MASK_COLOR | PNG_COLOR_MASK_ALPHA)
+#define PNG_COLOR_TYPE_GRAY_ALPHA (PNG_COLOR_MASK_ALPHA)
+
+#define PNG_FILTER_TYPE_LOCO   64
+#define PNG_FILTER_VALUE_NONE  0
+#define PNG_FILTER_VALUE_SUB   1
+#define PNG_FILTER_VALUE_UP    2
+#define PNG_FILTER_VALUE_AVG   3
+#define PNG_FILTER_VALUE_PAETH 4
+#define PNG_FILTER_VALUE_MIXED 5
+
+#define PNG_IHDR      0x0001
+#define PNG_IDAT      0x0002
+#define PNG_ALLIMAGE  0x0004
+#define PNG_PLTE      0x0008
+
+#define NB_PASSES 7
+
+extern const uint8_t ff_pngsig[8];
+extern const uint8_t ff_mngsig[8];
+
+/* Mask to determine which y pixels are valid in a pass */
+extern const uint8_t ff_png_pass_ymask[NB_PASSES];
+
+/* minimum x value */
+extern const uint8_t ff_png_pass_xmin[NB_PASSES];
+
+/* x shift to get row width */
+extern const uint8_t ff_png_pass_xshift[NB_PASSES];
+
+/* Mask to determine which pixels are valid in a pass */
+extern const uint8_t ff_png_pass_mask[NB_PASSES];
+
+void *ff_png_zalloc(void *opaque, unsigned int items, unsigned int size);
+
+void ff_png_zfree(void *opaque, void *ptr);
+
+int ff_png_get_nb_channels(int color_type);
+
+/* compute the row size of an interleaved pass */
+int ff_png_pass_row_size(int pass, int bits_per_pixel, int width);
+
+#endif /* AVCODEC_PNG_H */

Deleted: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/png.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/png.h	2009-05-08 08:21:30 UTC (rev 4810)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/png.h	2009-05-08 08:21:32 UTC (rev 4811)
@@ -1,76 +0,0 @@
-/*
- * PNG image format
- * Copyright (c) 2003 Fabrice Bellard
- *
- * This file is part of FFmpeg.
- *
- * FFmpeg is free software; you can redistribute it and/or
- * modify it under the terms of the GNU Lesser General Public
- * License as published by the Free Software Foundation; either
- * version 2.1 of the License, or (at your option) any later version.
- *
- * FFmpeg is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- * Lesser General Public License for more details.
- *
- * You should have received a copy of the GNU Lesser General Public
- * License along with FFmpeg; if not, write to the Free Software
- * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
- */
-
-#ifndef AVCODEC_PNG_H
-#define AVCODEC_PNG_H
-
-#include <stdint.h>
-
-#define PNG_COLOR_MASK_PALETTE    1
-#define PNG_COLOR_MASK_COLOR      2
-#define PNG_COLOR_MASK_ALPHA      4
-
-#define PNG_COLOR_TYPE_GRAY 0
-#define PNG_COLOR_TYPE_PALETTE  (PNG_COLOR_MASK_COLOR | PNG_COLOR_MASK_PALETTE)
-#define PNG_COLOR_TYPE_RGB        (PNG_COLOR_MASK_COLOR)
-#define PNG_COLOR_TYPE_RGB_ALPHA  (PNG_COLOR_MASK_COLOR | PNG_COLOR_MASK_ALPHA)
-#define PNG_COLOR_TYPE_GRAY_ALPHA (PNG_COLOR_MASK_ALPHA)
-
-#define PNG_FILTER_TYPE_LOCO   64
-#define PNG_FILTER_VALUE_NONE  0
-#define PNG_FILTER_VALUE_SUB   1
-#define PNG_FILTER_VALUE_UP    2
-#define PNG_FILTER_VALUE_AVG   3
-#define PNG_FILTER_VALUE_PAETH 4
-#define PNG_FILTER_VALUE_MIXED 5
-
-#define PNG_IHDR      0x0001
-#define PNG_IDAT      0x0002
-#define PNG_ALLIMAGE  0x0004
-#define PNG_PLTE      0x0008
-
-#define NB_PASSES 7
-
-extern const uint8_t ff_pngsig[8];
-extern const uint8_t ff_mngsig[8];
-
-/* Mask to determine which y pixels are valid in a pass */
-extern const uint8_t ff_png_pass_ymask[NB_PASSES];
-
-/* minimum x value */
-extern const uint8_t ff_png_pass_xmin[NB_PASSES];
-
-/* x shift to get row width */
-extern const uint8_t ff_png_pass_xshift[NB_PASSES];
-
-/* Mask to determine which pixels are valid in a pass */
-extern const uint8_t ff_png_pass_mask[NB_PASSES];
-
-void *ff_png_zalloc(void *opaque, unsigned int items, unsigned int size);
-
-void ff_png_zfree(void *opaque, void *ptr);
-
-int ff_png_get_nb_channels(int color_type);
-
-/* compute the row size of an interleaved pass */
-int ff_png_pass_row_size(int pass, int bits_per_pixel, int width);
-
-#endif /* AVCODEC_PNG_H */

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavcodec_png.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavcodec_png.patch	2009-05-08 08:21:30 UTC (rev 4810)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavcodec_png.patch	2009-05-08 08:21:32 UTC (rev 4811)
@@ -0,0 +1,39 @@
+diff --git a/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/png.c b/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/png.c
+index 534dc68..1a6e137 100644
+--- libavcodec/png.c
++++ libavcodec/png.c
+@@ -20,7 +20,7 @@
+  */
+ #include "avcodec.h"
+ #include "bytestream.h"
+-#include "png.h"
++#include "ffpng.h"
+ 
+ const uint8_t ff_pngsig[8] = {137, 80, 78, 71, 13, 10, 26, 10};
+ const uint8_t ff_mngsig[8] = {138, 77, 78, 71, 13, 10, 26, 10};
+diff --git a/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/pngdec.c b/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/pngdec.c
+index bf719b2..d069d44 100644
+--- libavcodec/pngdec.c
++++ libavcodec/pngdec.c
+@@ -20,7 +20,7 @@
+  */
+ #include "avcodec.h"
+ #include "bytestream.h"
+-#include "png.h"
++#include "ffpng.h"
+ #include "dsputil.h"
+ 
+ /* TODO:
+diff --git a/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/pngenc.c b/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/pngenc.c
+index 40dadc8..0204064 100644
+--- libavcodec/pngenc.c
++++ libavcodec/pngenc.c
+@@ -21,7 +21,7 @@
+ #include "avcodec.h"
+ #include "bytestream.h"
+ #include "dsputil.h"
+-#include "png.h"
++#include "ffpng.h"
+ 
+ /* TODO:
+  * - add 2, 4 and 16 bit depth support



From mean at mail.berlios.de  Fri May  8 10:21:34 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 8 May 2009 10:21:34 +0200
Subject: [Avidemux-svn-commit] r4812 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs
Message-ID: <200905080821.n488LYLF004521@sheep.berlios.de>

Author: mean
Date: 2009-05-08 10:21:34 +0200 (Fri, 08 May 2009)
New Revision: 4812

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_png.cpp
Log:
[PNG] Remove ugly workaround

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_png.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_png.cpp	2009-05-08 08:21:32 UTC (rev 4811)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_png.cpp	2009-05-08 08:21:34 UTC (rev 4812)
@@ -30,7 +30,7 @@
 #include "ADM_codecs/ADM_png.h"
 extern "C"
 {
-#include "/usr/include/png.h"
+#include "png.h"
 }
 #include "ADM_assert.h"
 



From mean at mail.berlios.de  Fri May  8 10:21:41 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 8 May 2009 10:21:41 +0200
Subject: [Avidemux-svn-commit] r4813 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec
Message-ID: <200905080821.n488LfE8004549@sheep.berlios.de>

Author: mean
Date: 2009-05-08 10:21:40 +0200 (Fri, 08 May 2009)
New Revision: 4813

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/png.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/pngdec.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/pngenc.c
Log:
[FFmpeg] PNG

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/png.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/png.c	2009-05-08 08:21:34 UTC (rev 4812)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/png.c	2009-05-08 08:21:40 UTC (rev 4813)
@@ -20,7 +20,7 @@
  */
 #include "avcodec.h"
 #include "bytestream.h"
-#include "png.h"
+#include "ffpng.h"
 
 const uint8_t ff_pngsig[8] = {137, 80, 78, 71, 13, 10, 26, 10};
 const uint8_t ff_mngsig[8] = {138, 77, 78, 71, 13, 10, 26, 10};

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/pngdec.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/pngdec.c	2009-05-08 08:21:34 UTC (rev 4812)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/pngdec.c	2009-05-08 08:21:40 UTC (rev 4813)
@@ -20,7 +20,7 @@
  */
 #include "avcodec.h"
 #include "bytestream.h"
-#include "png.h"
+#include "ffpng.h"
 #include "dsputil.h"
 
 /* TODO:

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/pngenc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/pngenc.c	2009-05-08 08:21:34 UTC (rev 4812)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/pngenc.c	2009-05-08 08:21:40 UTC (rev 4813)
@@ -21,7 +21,7 @@
 #include "avcodec.h"
 #include "bytestream.h"
 #include "dsputil.h"
-#include "png.h"
+#include "ffpng.h"
 
 /* TODO:
  * - add 2, 4 and 16 bit depth support



From mean at mail.berlios.de  Fri May  8 15:35:36 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 8 May 2009 15:35:36 +0200
Subject: [Avidemux-svn-commit] r4814 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil
Message-ID: <200905081335.n48DZaJV018058@sheep.berlios.de>

Author: mean
Date: 2009-05-08 15:35:36 +0200 (Fri, 08 May 2009)
New Revision: 4814

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/lfg.c
Log:
[win32] undef index

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/lfg.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/lfg.c	2009-05-08 08:21:40 UTC (rev 4813)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/lfg.c	2009-05-08 13:35:36 UTC (rev 4814)
@@ -23,7 +23,7 @@
 #include "lfg.h"
 #include "md5.h"
 #include "intreadwrite.h"
-
+#undef index
 void av_cold av_lfg_init(AVLFG *c, unsigned int seed){
     uint8_t tmp[16]={0};
     int i;



From mean at mail.berlios.de  Fri May  8 15:35:38 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 8 May 2009 15:35:38 +0200
Subject: [Avidemux-svn-commit] r4815 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches
Message-ID: <200905081335.n48DZcSX018069@sheep.berlios.de>

Author: mean
Date: 2009-05-08 15:35:37 +0200 (Fri, 08 May 2009)
New Revision: 4815

Added:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavutil_lfg.patch
Log:
[win32] undefindex

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavutil_lfg.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavutil_lfg.patch	2009-05-08 13:35:36 UTC (rev 4814)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/patches/libavutil_lfg.patch	2009-05-08 13:35:37 UTC (rev 4815)
@@ -0,0 +1,13 @@
+diff --git a/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/lfg.c b/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/lfg.c
+index e876d18..ff6a888 100644
+--- a/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/lfg.c
++++ b/avidemux/ADM_libraries/ADM_ffmpeg/libavutil/lfg.c
+@@ -23,7 +23,7 @@
+ #include "lfg.h"
+ #include "md5.h"
+ #include "intreadwrite.h"
+-
++#undef index
+ void av_cold av_lfg_init(AVLFG *c, unsigned int seed){
+     uint8_t tmp[16]={0};
+     int i;



From mean at mail.berlios.de  Fri May  8 15:35:43 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 8 May 2009 15:35:43 +0200
Subject: [Avidemux-svn-commit] r4816 - in branches/avidemux_2.6_branch_mean:
	avidemux/ADM_core/include plugins/ADM_demuxers/MpegTS
	plugins/ADM_muxers plugins/ADM_muxers/muxerMp4
	plugins/ADM_muxers/oplug_flv
Message-ID: <200905081335.n48DZhJ8018085@sheep.berlios.de>

Author: mean
Date: 2009-05-08 15:35:43 +0200 (Fri, 08 May 2009)
New Revision: 4816

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_core/include/ADM_misc.h
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerMp4/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/oplug_flv/CMakeLists.txt
Log:
[Win32] fixes

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_core/include/ADM_misc.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_core/include/ADM_misc.h	2009-05-08 13:35:37 UTC (rev 4815)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_core/include/ADM_misc.h	2009-05-08 13:35:43 UTC (rev 4816)
@@ -45,7 +45,7 @@
 			long int tv_nsec;
 		};
 
-		void gettimeofday(struct timeval *p, void *tz);
+		//void gettimeofday(struct timeval *p, void *tz);
 		};
 		#define timezone int
 		#define TIMZ int

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/CMakeLists.txt	2009-05-08 13:35:37 UTC (rev 4815)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/CMakeLists.txt	2009-05-08 13:35:43 UTC (rev 4816)
@@ -13,7 +13,7 @@
 )
 
 ADD_LIBRARY(ADM_dm_ts SHARED ${ADM_ts_SRCS})
-TARGET_LINK_LIBRARIES(ADM_dm_ts ADM_coreDemuxerMpeg ADM_audioParser)
+TARGET_LINK_LIBRARIES(ADM_dm_ts ADM_coreDemuxerMpeg ADM_audioParser  ADM_libavutil ADM_libavcodec ADM_libavformat)
 # For ffmpeg includes
 INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/") 
 INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries") 

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/CMakeLists.txt	2009-05-08 13:35:37 UTC (rev 4815)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/CMakeLists.txt	2009-05-08 13:35:43 UTC (rev 4816)
@@ -1,7 +1,7 @@
 ADD_SUBDIRECTORY(muxerDummy)
 ADD_SUBDIRECTORY(muxerMp4)
 ADD_SUBDIRECTORY(muxerAvi)
-ADD_SUBDIRECTORY(muxerFlv)
+#ADD_SUBDIRECTORY(muxerFlv)
 #ADD_SUBDIRECTORY(oplug_avi)
 #ADD_SUBDIRECTORY(oplug_mp4)
 #ADD_SUBDIRECTORY(oplug_mpeg)

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerMp4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerMp4/CMakeLists.txt	2009-05-08 13:35:37 UTC (rev 4815)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerMp4/CMakeLists.txt	2009-05-08 13:35:43 UTC (rev 4816)
@@ -8,7 +8,7 @@
 ADD_LIBRARY(ADM_mx_mp4 SHARED ${ADM_mp4_SRCS})
 
 INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg")
-TARGET_LINK_LIBRARIES(ADM_mx_mp4  ADM_libavutil ADM_libavformat)
+TARGET_LINK_LIBRARIES(ADM_mx_mp4  ADM_libavutil ADM_libavcodec ADM_libavformat)
 INIT_MUXER(ADM_mx_mp4)
 INSTALL_MUXER(ADM_mx_mp4)
 

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/oplug_flv/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/oplug_flv/CMakeLists.txt	2009-05-08 13:35:37 UTC (rev 4815)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/oplug_flv/CMakeLists.txt	2009-05-08 13:35:43 UTC (rev 4816)
@@ -1,3 +1,9 @@
-SET(ADM_oplug_flv_SRCS oplug_flv.cpp)
 
-ADD_ADM_LIB_ALL_TARGETS(oplug_flv ${ADM_oplug_flv_SRCS})
\ No newline at end of file
+SET(ADM_flv_SRCS oplug_flv.cpp)
+ 
+ADD_LIBRARY(ADM_mx_flv SHARED ${ADM_flv_SRCS})
+
+INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg")
+TARGET_LINK_LIBRARIES(ADM_mx_flv  ADM_libavutil ADM_libavcodec ADM_libavformat)
+INIT_MUXER(ADM_mx_flv)
+INSTALL_MUXER(ADM_mx_flv)



From mean at mail.berlios.de  Tue May 12 17:41:06 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 12 May 2009 17:41:06 +0200
Subject: [Avidemux-svn-commit] r4817 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905121541.n4CFf6mM001085@sheep.berlios.de>

Author: mean
Date: 2009-05-12 17:40:58 +0200 (Tue, 12 May 2009)
New Revision: 4817

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsPatPmt.cpp
Log:
[TsDemuxer] Also take tracks in ES descriptor (fix with_error2.ts)

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsPatPmt.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsPatPmt.cpp	2009-05-08 13:35:43 UTC (rev 4816)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsPatPmt.cpp	2009-05-12 15:40:58 UTC (rev 4817)
@@ -26,8 +26,8 @@
     \fn scanPmt
 */
 static bool TS_scanPmt(tsPacket *t,uint32_t pid,listOfTsTracks *list);
-
-
+static bool   decodeProgrameDescriptor(uint8_t *r, uint32_t maxlen);
+static ADM_TS_TRACK_TYPE EsType(uint32_t type,const char **str);
 /**
     \class TrackTypeDescriptor
 */
@@ -202,7 +202,75 @@
         int programInfoLength=(r[0]<<8)+r[1];
         programInfoLength&=0xff;
         r+=2;
-        printf("[PMT] PMT :%02x Program Info Len: %d\n",pid,programInfoLength);    
+        packLen-=4;
+        // Program Descriptor
+        if(programInfoLength && programInfoLength<=packLen)
+        {
+            decodeProgrameDescriptor(r, programInfoLength);
+            packLen-=programInfoLength;
+            r+=programInfoLength;
+        }
+        printf("[PMT]            Left : %d bytes\n",packLen);
+        // Es Type Descriptor
+        while(packLen>4)
+        {
+            int type=r[0];
+            int pid=(r[1]<<8)+r[2];
+            int size=(r[3]<<8)+r[4];
+
+            size&=0xfff;
+            pid&=0x1fff;
+            r+=size+5;
+            packLen-=5+size;
+            printf("[PMT]          Type=0x%x pid=%x size=%d\n",type,pid,size);
+            const char *str;
+            ADM_TS_TRACK_TYPE trackType=EsType(type,&str);;
+            if(trackType!=ADM_TS_UNKNOWN) 
+            {
+                    ADM_TS_TRACK trk2;
+                    trk2.trackPid=pid;
+                    trk2.trackType=trackType;
+                    printf("[PMT]  Adding pid 0x%x (%d) , type %s\n",pid,pid,str);
+                    list->push_back(trk2);
+            }
+           
+        }
+        if(trk.trackType!=ADM_TS_UNKNOWN) list->push_back(trk);
+        return true;
+       }
+    return false;
+}
+/**
+    \fn EsType
+    \brief returns type and string attached to a ES type
+*/
+ADM_TS_TRACK_TYPE EsType(uint32_t type,const char **str)
+{
+    *str="????";
+    switch(type)
+    {
+                case 1:case 2: *str= "Mpeg Video";return ADM_TS_MPEG2;break;
+                case 3:case 4: *str= "Mpeg Audio";return ADM_TS_MPEG_AUDIO;break;
+                case 0x11: case 0xF:     *str= "Mpeg AAC";return ADM_TS_AAC;break;
+             //   case 0x10:        *streamType=ADM_STREAM_MPEG4;return "MP4 Video";
+                case 0x1B:  *str= "H264 Video";return ADM_TS_H264;break;
+                case 0x81:  *str= "AC3 (Not sure)";return ADM_TS_AC3;break;
+                default : break;
+    }
+    return ADM_TS_UNKNOWN;
+}
+
+/**
+    \fn decodeProgrameDescriptor
+    \brief decodeProgramDescriptor
+
+    http://www.coolstf.com/tsreader/descriptors.html
+
+*/
+bool   decodeProgrameDescriptor(uint8_t *r, uint32_t maxlen)
+{
+        printf("[PMT] Program Info Len: %d\n",maxlen); 
+        int packLen=maxlen;
         packLen-=(2+4);
         while(packLen>4)
         {
@@ -214,12 +282,16 @@
                 packLen-=5;
                 packLen-=esInfoLength;
                 TrackTypeDescriptor *td=TrackTypeDescriptor::find(streamType);
-                printf("[PMT] PMT :%02x StreamType: 0x%x,<<%s>>\n",pid,streamType,td->desc);    
+                printf("[PMT]           StreamType: 0x%x,<<%s>>\n",streamType,td->desc);    
                 printf("[PMT]           Pid:        0x%x\n",streamPid);
                 printf("[PMT]           Es Info Length: %d (0x%x)\n",esInfoLength,esInfoLength);
-                
-                trk.trackType=td->trackType;
-                trk.trackPid=streamPid;
+                if(packLen<1) 
+                {
+                    printf("[PMT             ES Info length bigger than section\n");
+                    return true;
+                }
+                //trk.trackType=td->trackType;
+                //trk.trackPid=streamPid;
                 uint8_t *p=r,*pend=r+esInfoLength;
                 r+=esInfoLength;
                 while(p<pend)
@@ -248,10 +320,12 @@
                     p+=2+taglen;
                 }
                 // 
-                if(trk.trackType!=ADM_TS_UNKNOWN) list->push_back(trk);
+                
         }
         return true;
-     }
-    return false;
+
 }
+
+
+
 //EOF



From mean at mail.berlios.de  Wed May 13 12:40:10 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 13 May 2009 12:40:10 +0200
Subject: [Avidemux-svn-commit] r4818 -
	branches/avidemux_2.6_branch_mean/avidemux
Message-ID: <200905131040.n4DAeAwv032321@sheep.berlios.de>

Author: mean
Date: 2009-05-13 12:40:08 +0200 (Wed, 13 May 2009)
New Revision: 4818

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/gui_play.cpp
Log:
[Playback] Listen to UI once in a while to be able to stop playback

Modified: branches/avidemux_2.6_branch_mean/avidemux/gui_play.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gui_play.cpp	2009-05-12 15:40:58 UTC (rev 4817)
+++ branches/avidemux_2.6_branch_mean/avidemux/gui_play.cpp	2009-05-13 10:40:08 UTC (rev 4818)
@@ -196,7 +196,7 @@
    
     uint32_t movieTime;
     uint32_t systemTime;
-    
+    int refreshCounter=0;
     ticktock.reset();
     do
     {
@@ -215,8 +215,16 @@
        // printf("[Playback] systemTime: %lu movieTime : %lu  \r",systemTime,movieTime);
         if(systemTime>movieTime) // We are late, the current PTS is after current closk
         {
-            if(movieTime>systemTime+20)
-                printf("[Playback] We are late!\n");
+            if(systemTime >movieTime+20)
+            {
+                refreshCounter++;
+            }
+            if(refreshCounter>15)
+            {
+                UI_purge();
+                UI_purge();
+                refreshCounter=0;
+            }
         }
 	    else
 	    {
@@ -233,6 +241,7 @@
                     }
                     
                     UI_purge();
+                    refreshCounter=0;
                     systemTime = ticktock.getElapsedMS();
                     delta=movieTime-systemTime;                
                 }
@@ -241,6 +250,7 @@
                 {
                   UI_purge();
                   UI_purge(); 
+                  refreshCounter=0;
                 }
         }
       }



From mean at mail.berlios.de  Wed May 13 12:40:13 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 13 May 2009 12:40:13 +0200
Subject: [Avidemux-svn-commit] r4819 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905131040.n4DAeDiA032362@sheep.berlios.de>

Author: mean
Date: 2009-05-13 12:40:13 +0200 (Wed, 13 May 2009)
New Revision: 4819

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsReadIndex.cpp
Log:
[TS Demuxer] Add pts/dts for each frame

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp	2009-05-13 10:40:08 UTC (rev 4818)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp	2009-05-13 10:40:13 UTC (rev 4819)
@@ -89,6 +89,7 @@
     indexerState state;
     tsPacketLinear *pkt;
     int32_t        nextOffset;
+    uint64_t beginPts,beginDts;
 }indexerData;
 
 typedef enum
@@ -548,7 +549,16 @@
         uint32_t consumed=pkt->getConsumed()-overRead;
         if(data->nbPics)
         {
-            qfprintf(index," %c:%06"LX,Type[currentFrameType],consumed-beginConsuming);
+            int64_t deltaPts,deltaDts;
+
+            if(data->beginPts==-1 || info->pts==-1) deltaPts=-1;
+                else deltaPts=info->pts-data->beginPts;
+
+            if(data->beginDts==-1 || info->dts==-1) deltaDts=-1;
+                else deltaDts=info->dts-data->beginDts;
+
+            qfprintf(index," %c:%06"LX":%"LLD":%"LLD,Type[currentFrameType],consumed-beginConsuming,
+                                    deltaPts,deltaDts);
             beginConsuming=consumed;
         }else
         {  // Our first Pic
@@ -559,6 +569,8 @@
         // If audio, also dump audio
         if(data->frameType==1)
         {
+            data->beginPts=info->pts;
+            data->beginDts=info->dts;
             if(audioTracks)
             {
                 qfprintf(index,"\nAudio bf:%08"LLX" ",info->startAt);

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsReadIndex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsReadIndex.cpp	2009-05-13 10:40:08 UTC (rev 4818)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsReadIndex.cpp	2009-05-13 10:40:13 UTC (rev 4819)
@@ -121,7 +121,8 @@
                 }
                 *cur++;
                 next=strstr(start," ");
-                ADM_assert(1==sscanf(cur,"%"LX,&len));
+                int64_t ppts,ddts;
+                ADM_assert(3==sscanf(cur,"%"LX":%"LLD":%"LLD,&len,&ppts,&ddts));
                 
                 
                 dmxFrame *frame=new dmxFrame;
@@ -135,8 +136,15 @@
 
                 }else       
                 {
-                    frame->pts=ADM_NO_PTS;
-                    frame->dts=ADM_NO_PTS;
+                    if(ppts==-1 || pts==-1)
+                        frame->pts=ADM_NO_PTS;
+                    else
+                        frame->pts=pts+ppts;
+                    if(ddts==-1 || dts==-1)
+                        frame->dts=ADM_NO_PTS;
+                    else
+                        frame->dts=dts+ddts;
+
                     frame->startAt=0;
                     frame->index=0;
                 }



From mean at mail.berlios.de  Wed May 13 12:40:18 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 13 May 2009 12:40:18 +0200
Subject: [Avidemux-svn-commit] r4821 - in branches/avidemux_2.6_branch_mean:
	. avidemux/ADM_codecs
	avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config
	avidemux/ADM_libraries/ADM_ffmpeg/libavcodec cmake
Message-ID: <200905131040.n4DAeIxD032418@sheep.berlios.de>

Author: mean
Date: 2009-05-13 12:40:17 +0200 (Wed, 13 May 2009)
New Revision: 4821

Added:
   branches/avidemux_2.6_branch_mean/cmake/admCheckVDPAU.cmake
Modified:
   branches/avidemux_2.6_branch_mean/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/config.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/ffconf.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/cmake/admConfigSummary.cmake
   branches/avidemux_2.6_branch_mean/cmake/config.h.cmake
Log:
[VDPAU] Configure support

Modified: branches/avidemux_2.6_branch_mean/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/CMakeLists.txt	2009-05-13 10:40:15 UTC (rev 4820)
+++ branches/avidemux_2.6_branch_mean/CMakeLists.txt	2009-05-13 10:40:17 UTC (rev 4821)
@@ -144,6 +144,7 @@
 #INCLUDE(admCheckAudioCodecLibs)
 #INCLUDE(admCheckAudioDeviceLibs)
 INCLUDE(admCheckMiscLibs)
+INCLUDE(admCheckVDPAU)
 
 ########################################
 # Check functions and includes
@@ -167,8 +168,11 @@
 
 	MESSAGE("")
 ENDIF (NOT SYSTEM_HEADERS_CHECKED)
-
 ########################################
+# VDPAU
+########################################
+checkVDPAU()
+########################################
 # Debug Summary
 ########################################
 IF (VERBOSE)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp	2009-05-13 10:40:15 UTC (rev 4820)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp	2009-05-13 10:40:17 UTC (rev 4821)
@@ -37,25 +37,38 @@
 #include "ADM_videoInfoExtractor.h"
 
 extern int ADM_cpu_num_processors(void);
+extern "C"
+{
+    static void ADM_releaseBuffer(struct AVCodecContext *avctx, AVFrame *pic);
+    static int  ADM_getBuffer(AVCodecContext *avctx, AVFrame *pic);
+}
 
-#define WRAP_Open(x) \
+#define ADM_VDPAU 0
+
+
+#define WRAP_Open_Template(funcz,argz,display,codecid) \
 {\
-AVCodec *codec=avcodec_find_decoder(x);\
-if(!codec) {GUI_Error_HIG("Codec",QT_TR_NOOP("Internal error finding codec"#x));ADM_assert(0);} \
-  codecId=x; \
-  _context->workaround_bugs=1*FF_BUG_AUTODETECT +0*FF_BUG_NO_PADDING;/**/ \
+AVCodec *codec=funcz(argz);\
+if(!codec) {GUI_Error_HIG("Codec",QT_TR_NOOP("Internal error finding codec"display));ADM_assert(0);} \
+  codecId=codecid; \
+  _context->workaround_bugs=1*FF_BUG_AUTODETECT +0*FF_BUG_NO_PADDING; \
   _context->error_concealment=3; \
   if (avcodec_open(_context, codec) < 0)  \
                       { \
-                                        printf("[lavc] Decoder init: "#x" video decoder failed!\n"); \
-                                        GUI_Error_HIG("Codec","Internal error opening "#x); \
+                                        printf("[lavc] Decoder init: "display" video decoder failed!\n"); \
+                                        GUI_Error_HIG("Codec","Internal error opening "display); \
                                         ADM_assert(0); \
                                 } \
                                 else \
                                 { \
-                                        printf("[lavc] Decoder init: "#x" video decoder initialized!\n"); \
+                                        printf("[lavc] Decoder init: "display" video decoder initialized! (%s)\n",codec->long_name); \
                                 } \
 }
+
+#define WRAP_Open(x)            {WRAP_Open_Template(avcodec_find_decoder,x,#x,x);}
+#define WRAP_OpenByName(x,y)    {WRAP_Open_Template(avcodec_find_decoder_by_name,#x,#x,y);}
+
+
 //****************************
 extern uint8_t DIA_lavDecoder (uint32_t * swapUv, uint32_t * showU);
 extern "C"
@@ -431,7 +444,6 @@
     case PIX_FMT_YUVJ444P:
       out->_colorspace = ADM_COLOR_YUV444;
       break;
-
     case PIX_FMT_YUV420P:
     case PIX_FMT_YUVJ420P:
       // Default is YV12 or I420
@@ -583,8 +595,21 @@
   if(lowdelay)
     LOWDELAY();
   printf ("[lavc] Initializing H264 decoder with %d extradata\n", l);
-  WRAP_Open (CODEC_ID_H264);
 
+    if(ADM_VDPAU)
+    {
+        _context->get_buffer      = ADM_getBuffer;
+        _context->release_buffer  = ADM_releaseBuffer;
+        _context->reget_buffer    = ADM_getBuffer;
+
+        WRAP_OpenByName(h264_vdpau,CODEC_ID_H264);
+    }
+    else  
+    {
+        WRAP_Open(CODEC_ID_H264);
+    }
+
+
 }
 //*********************
 extern "C" {int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc);}
@@ -787,4 +812,36 @@
 {
 	//av_free_static();
 }
+
+int ADM_getBuffer(AVCodecContext *avctx, AVFrame *pic)
+{
+    uint32_t w= avctx->width;
+    uint32_t h= avctx->height;
+
+    uint32_t rounded_w=(w+63)&~63;
+    uint32_t rounded_h=(h+63)&~63;
+    uint32_t page=rounded_w*rounded_h;
+
+    pic->data[0]=new uint8_t [page];
+    pic->data[1]=new uint8_t [page/4];
+    pic->data[2]=new uint8_t [page/4];
+
+    pic->linesize[0]=rounded_w;
+    pic->linesize[1]=rounded_w/2;
+    pic->linesize[2]=rounded_w/2;
+    pic->type= FF_BUFFER_TYPE_USER;
+    pic->age=1;
+    return 0;
+}
+
+ void ADM_releaseBuffer(struct AVCodecContext *avctx, AVFrame *pic)
+{
+    #define F(x) if(pic->x) delete [] pic->x;pic->x=NULL;
+    F(data[0]);
+    F(data[1]);
+    F(data[2]);
+    return;
+}
+
+
 // EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/config.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/config.h	2009-05-13 10:40:15 UTC (rev 4820)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/config.h	2009-05-13 10:40:17 UTC (rev 4821)
@@ -4,12 +4,15 @@
 #define CONFIG_MPEG4_VAAPI_HWACCEL 0
 #define CONFIG_VC1_VAAPI_HWACCEL 0
 #define CONFIG_WMV3_VAAPI_HWACCEL 0
+#ifdef USE_VDPAU
+#define CONFIG_H264_VDPAU_DECODER 1
+#else // USE_VDPAU
+#define CONFIG_H264_VDPAU_DECODER 0
+#endif // 
 #define CONFIG_MPEG_VDPAU_DECODER 0
 #define CONFIG_MPEG1_VDPAU_DECODER 0
-#define CONFIG_VDPAU_VDPAU_DECODER 0
 #define CONFIG_VC1_VDPAU_DECODER 0
 #define CONFIG_WMV3_VDPAU_DECODER 0
-#define CONFIG_H264_VDPAU_DECODER 0
 #define CONFIG_NELLYMOSER_DECODER 1
 #define CONFIG_ADPCM_IMA_AMV_DECODER 1
 #define CONFIG_CINEPAK_DECODER 1

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/ffconf.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/ffconf.c	2009-05-13 10:40:15 UTC (rev 4820)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/ffmpeg_config/ffconf.c	2009-05-13 10:40:17 UTC (rev 4821)
@@ -17,13 +17,20 @@
     DECLARE_HW(VC1_VAAPI,nellymoser);
     DECLARE_HW(WMV3_VAAPI,nellymoser);
 
+#define DECLARE_VDPAU(a,b); printf("#define CONFIG_"#a"_VDPAU_DECODER 1\n");
+        printf("#ifdef USE_VDPAU\n");
+        printf("#define CONFIG_H264_VDPAU_DECODER 1\n");
+        printf("#else // USE_VDPAU\n");
+        printf("#define CONFIG_H264_VDPAU_DECODER 0\n");
+        printf("#endif // \n");
+        
+
+#undef DECLARE_VDPAU
 #define DECLARE_VDPAU(a,b); printf("#define CONFIG_"#a"_VDPAU_DECODER 0\n");
     DECLARE_VDPAU(MPEG,nellymoser);
     DECLARE_VDPAU(MPEG1,nellymoser);
-    DECLARE_VDPAU(VDPAU,nellymoser);
     DECLARE_VDPAU(VC1,nellymoser);
     DECLARE_VDPAU(WMV3,nellymoser);
-    DECLARE_VDPAU(H264, h264_vdpau);
 
 
 #define DECLARE_DECODER(a,b); printf("#define CONFIG_"#a"_DECODER 1\n");

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/CMakeLists.txt	2009-05-13 10:40:15 UTC (rev 4820)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/CMakeLists.txt	2009-05-13 10:40:17 UTC (rev 4821)
@@ -17,6 +17,7 @@
         avpacket.c
         flacdec.c
         flacdata.c
+        vdpau.c
         vp6dsp.c
         tscc.c  resample2.c    qdm2.c  bitstream_filter.c  eval.c  vc1.c
 	vc1dsp.c  vp56.c  vp6.c  vp5.c  indeo2.c  smacker.c  opt.c  fraps.c  dnxhddec.c

Added: branches/avidemux_2.6_branch_mean/cmake/admCheckVDPAU.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckVDPAU.cmake	2009-05-13 10:40:15 UTC (rev 4820)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckVDPAU.cmake	2009-05-13 10:40:17 UTC (rev 4821)
@@ -0,0 +1,33 @@
+########################################
+# VDPAU
+# We only need header for VDPAU
+# as it is including its own dynlinker
+########################################
+MACRO(checkVDPAU)
+	IF (NOT VDPAU_CHECKED)
+		OPTION(VDPAU "" ON)
+
+		MESSAGE(STATUS "Checking for VDPAU")
+		MESSAGE(STATUS "*******************")
+
+		IF (VDPAU)
+		
+			FIND_HEADER_AND_LIB(VDPAU vdpau/vdpau.h )
+		
+			IF (VDPAU_FOUND)
+				SET(VDPAU_FOUND 1)
+				SET(USE_VDPAU 1)
+				SET(VDPAU_INCLUDE_DIR "${VDPAU_INCLUDE_DIR}")
+				SET(VDPAU_LIBRARY_DIR "${VDPAU_LIBRARY_DIR}")
+			ENDIF (VDPAU_FOUND)
+
+			PRINT_LIBRARY_INFO("VDPAU" VDPAU_FOUND "${VDPAU_INCLUDE_DIR}" "${VDPAU_LIBRARY_DIR}")
+		ELSE (VDPAU)
+			MESSAGE("${MSG_DISABLE_OPTION}")
+		ENDIF (VDPAU)
+
+		SET(VDPAU_CHECKED 1)
+
+		MESSAGE("")
+	ENDIF (NOT VDPAU_CHECKED)
+ENDMACRO(checkVDPAU)

Modified: branches/avidemux_2.6_branch_mean/cmake/admConfigSummary.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admConfigSummary.cmake	2009-05-13 10:40:15 UTC (rev 4820)
+++ branches/avidemux_2.6_branch_mean/cmake/admConfigSummary.cmake	2009-05-13 10:40:17 UTC (rev 4821)
@@ -39,6 +39,7 @@
 ADM_DISPLAY("gettext   " "${HAVE_GETTEXT}")
 ADM_DISPLAY("SDL       " "${USE_SDL}")
 ADM_DISPLAY("XVideo    " "${USE_XV}" "${XVIDEO_CAPABLE}")
+ADM_DISPLAY("VDPAU     " "${USE_VDPAU}" )
 
 MESSAGE("*********************")
 

Modified: branches/avidemux_2.6_branch_mean/cmake/config.h.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/config.h.cmake	2009-05-13 10:40:15 UTC (rev 4820)
+++ branches/avidemux_2.6_branch_mean/cmake/config.h.cmake	2009-05-13 10:40:17 UTC (rev 4821)
@@ -92,6 +92,9 @@
 /* use Nvwa memory leak detector */
 #cmakedefine FIND_LEAKS
 
+/* use vdpau h264 hw decoding */
+#cmakedefine USE_VDPAU
+
 #if defined(OSS_SUPPORT) || defined (USE_ARTS) || defined(USE_SDL) || defined(__APPLE__) || defined(__WIN32) || defined(ALSA_SUPPORT)
 #define HAVE_AUDIO
 #endif
@@ -113,4 +116,4 @@
 #define QT_TR_NOOP(String) translate (PACKAGE, String)
 // FIXME - end
 
-#endif
\ No newline at end of file
+#endif



From mean at mail.berlios.de  Wed May 13 12:40:15 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 13 May 2009 12:40:15 +0200
Subject: [Avidemux-svn-commit] r4820 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_editor
Message-ID: <200905131040.n4DAeFWf032374@sheep.berlios.de>

Author: mean
Date: 2009-05-13 12:40:15 +0200 (Wed, 13 May 2009)
New Revision: 4820

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edRender.cpp
Log:
[Editor] Flush cash + avoid out of time frames (solve some problems, create new ones)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edRender.cpp	2009-05-13 10:40:13 UTC (rev 4819)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edRender.cpp	2009-05-13 10:40:15 UTC (rev 4820)
@@ -22,7 +22,12 @@
 #include "ADM_default.h"
 #include "ADM_editor/ADM_edit.hxx"
 
+#if defined(ADM_DEBUG) && 0
+#define aprintf printf
+#else
 #define aprintf(...) {}// printf
+#endif
+
 #include "ADM_pp.h"
 
 // FIXME BADLY !!!
@@ -125,17 +130,17 @@
     bool found=false;
     vid->lastSentFrame=frame;
     uint32_t nbFrames=vid->_nb_video_frames;
-    //cache->flush();
+    cache->flush();
     // The PTS associated with our frame is the one we are looking for
     uint64_t wantedPts=vid->_aviheader->estimatePts(frame);
     uint32_t tries=16; // Max Ref frames for H264=Max delay
-
+    bool syncFound=false;
     while(found==false && tries--)
     {
         // Last frame ? if so repeat
         if(vid->lastSentFrame>=nbFrames-1) vid->lastSentFrame=nbFrames-1;
         // Fetch frame
-         printf("[Editor] Decoding  frame %u\n",vid->lastSentFrame);
+         aprintf("[Editor] Decoding  frame %u\n",vid->lastSentFrame);
          
          if (!demuxer->getFrame (vid->lastSentFrame,&img))
          {
@@ -150,7 +155,8 @@
                 printf("[DecodePictureUpToIntra] Cache full for frame %"LU"\n",vid->lastSentFrame);
                 return false;
           }
-
+           aprintf("[Decoder] Demuxer Frame %"LU" pts=%"LLU" ms, %"LLU" us\n",vid->lastSentFrame,img.demuxerPts/1000,
+                                                                    img.demuxerPts);
           if(!decompressImage(result,&img,ref))
           {
              printf("[DecodePictureUpToIntra] decode error for frame %"LU"\n",vid->lastSentFrame);
@@ -163,14 +169,30 @@
             {
                 cache->updateFrameNum(result,vid->lastSentFrame);
                 uint64_t pts=result->Pts;
-                printf("[Decoder] Frame %"LU" pts=%"LLU" ms, %"LLU" us\n",vid->lastSentFrame,result->Pts,result->Pts);
+                aprintf("[Decoder] Decoder Frame %"LU" pts=%"LLU" ms, %"LLU" us\n",vid->lastSentFrame,
+                                                        result->Pts/1000,result->Pts);
                 if(pts==ADM_COMPRESSED_NO_PTS) // No PTS available ?
                 {
-                    // increment it using average fps
-                    vid->lastDecodedPts+=vid->timeIncrementInUs;
-                    result->Pts=vid->lastDecodedPts;
+                   
+                    if(false==syncFound)
+                    {
+                        aprintf("[DecodePictureUpToIntra] No time stamp yet, dropping picture\n");
+                        cache->invalidate(result);
+                    }else
+                    {
+                        // increment it using average fps
+                        vid->lastDecodedPts+=vid->timeIncrementInUs;
+                        result->Pts=vid->lastDecodedPts;
+                    }
                 }else
+                {
+                    if(false==syncFound)
+                    {
+                        aprintf("[DecodePictureUpToIntra] Sync found\n");
+                        syncFound=true;
+                    }
                     vid->lastDecodedPts=pts;
+                }
             }
 
             // Found our image ?
@@ -181,7 +203,7 @@
     }
     if(found==false)
     {
-        printf("[GoToIntra] Could not find decoded frame :%"LU" PTS=%"LLU" ms, %"LLU" us\n",frame,wantedPts/1000,wantedPts);
+        printf("[GoToIntra] Could not find decoded frame, wanted PTS :%"LU" PTS=%"LLU" ms, %"LLU" us\n",frame,wantedPts/1000,wantedPts);
         cache->dump();
         return false;
     }
@@ -254,7 +276,10 @@
         }else   
         {
             printf("[getNextPic] Loop:%d, looking for pts :%"LLU" ms %"LLU" us\n",loop,vid->lastReadPts/1000,vid->lastReadPts);
+#ifdef VERBOSE
             cache->dump();
+#endif
+
         }
     }
     printf("[ADM_Composer::getPicture] Failed\n");
@@ -306,6 +331,11 @@
             printf("[DecodePictureUpToIntra] Cache full for frame %"LU"\n",vid->lastSentFrame);
             return false;
       }
+        aprintf("Demuxed frame %"LU" with pts=%"LLD" us, %"LLD" ms\n",
+            frame,
+            img.demuxerPts,
+            img.demuxerPts/1000);
+    
       if(!decompressImage(result,&img,ref))
       {
          printf("[DecodePictureUpToIntra] decode error for frame %"LU"\n",vid->lastSentFrame);
@@ -601,8 +631,10 @@
 
 //	Prepare the destination...
 	result=cache->getFreeImage();
+#ifdef VERBOSE
+	cache->dump();
+#endif
 
-	cache->dump();
   // now we got segment and frame
   //*************************
   // Is is a key frame ?



From mean at mail.berlios.de  Wed May 13 12:40:21 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 13 May 2009 12:40:21 +0200
Subject: [Avidemux-svn-commit] r4822 - in branches/avidemux_2.6_branch_mean:
	avidemux avidemux/ADM_codecs avidemux/ADM_core/include
	avidemux/ADM_userInterfaces/ADM_render cmake
Message-ID: <200905131040.n4DAeLdi032579@sheep.berlios.de>

Author: mean
Date: 2009-05-13 12:40:21 +0200 (Wed, 13 May 2009)
New Revision: 4822

Added:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_core/include/ADM_dynamicLoading.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_render/GUI_render.cpp
   branches/avidemux_2.6_branch_mean/avidemux/main.cpp
   branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake
   branches/avidemux_2.6_branch_mean/cmake/config.h.cmake
Log:
[VDPAU] Begin wiring vdpau, need to do some ugly stitches as vdpau depends on x11 indirectly

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp	2009-05-13 10:40:17 UTC (rev 4821)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp	2009-05-13 10:40:21 UTC (rev 4822)
@@ -43,7 +43,6 @@
     static int  ADM_getBuffer(AVCodecContext *avctx, AVFrame *pic);
 }
 
-#define ADM_VDPAU 0
 
 
 #define WRAP_Open_Template(funcz,argz,display,codecid) \
@@ -596,16 +595,7 @@
     LOWDELAY();
   printf ("[lavc] Initializing H264 decoder with %d extradata\n", l);
 
-    if(ADM_VDPAU)
-    {
-        _context->get_buffer      = ADM_getBuffer;
-        _context->release_buffer  = ADM_releaseBuffer;
-        _context->reget_buffer    = ADM_getBuffer;
-
-        WRAP_OpenByName(h264_vdpau,CODEC_ID_H264);
-    }
-    else  
-    {
+       {
         WRAP_Open(CODEC_ID_H264);
     }
 
@@ -813,35 +803,4 @@
 	//av_free_static();
 }
 
-int ADM_getBuffer(AVCodecContext *avctx, AVFrame *pic)
-{
-    uint32_t w= avctx->width;
-    uint32_t h= avctx->height;
-
-    uint32_t rounded_w=(w+63)&~63;
-    uint32_t rounded_h=(h+63)&~63;
-    uint32_t page=rounded_w*rounded_h;
-
-    pic->data[0]=new uint8_t [page];
-    pic->data[1]=new uint8_t [page/4];
-    pic->data[2]=new uint8_t [page/4];
-
-    pic->linesize[0]=rounded_w;
-    pic->linesize[1]=rounded_w/2;
-    pic->linesize[2]=rounded_w/2;
-    pic->type= FF_BUFFER_TYPE_USER;
-    pic->age=1;
-    return 0;
-}
-
- void ADM_releaseBuffer(struct AVCodecContext *avctx, AVFrame *pic)
-{
-    #define F(x) if(pic->x) delete [] pic->x;pic->x=NULL;
-    F(data[0]);
-    F(data[1]);
-    F(data[2]);
-    return;
-}
-
-
 // EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h	2009-05-13 10:40:17 UTC (rev 4821)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h	2009-05-13 10:40:21 UTC (rev 4822)
@@ -347,4 +347,14 @@
   decoderFFMjpegB (uint32_t w, uint32_t h, uint32_t l, uint8_t * d);
 };
 
+#ifdef USE_VDPAU
+class decoderFFVDPAU:public decoderFF
+{
+protected:
+public:
+  decoderFFVDPAU (uint32_t w, uint32_t h, uint32_t l, uint8_t * d);
+};
 
+#endif
+// EOF
+

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp	2009-05-13 10:40:17 UTC (rev 4821)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp	2009-05-13 10:40:21 UTC (rev 4822)
@@ -0,0 +1,142 @@
+/***************************************************************************
+            \file              ADM_ffmpeg_vdpau.cpp  
+            \brief Decoder using half ffmpeg/half VDPAU
+
+    The ffmpeg part is to preformat inputs for VDPAU
+    VDPAU is loaded dynamically to be able to make a binary
+        and have something working even if the target machine
+        does not have vdpau
+
+
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+extern "C" {
+#include "ADM_lavcodec.h"
+}
+
+#include "ADM_default.h"
+#ifdef USE_VDPAU
+#include "vdpau/vdpau_x11.h"
+#include "vdpau/vdpau.h"
+#include "ADM_codecs/ADM_codec.h"
+#include "ADM_codecs/ADM_ffmp43.h"
+#include "DIA_coreToolkit.h"
+#include "ADM_dynamicLoading.h"
+#include "ADM_userInterfaces/ADM_render/GUI_render.h"
+
+
+static bool vdpauWorking=false;
+
+static ADM_LibWrapper vdpauDynaLoader;
+static VdpDeviceCreateX11 *ADM_createVdpX11;
+static VdpDevice             vdpDevice;
+static VdpGetProcAddress     *vdpProcAddress;
+
+#define WRAP_Open_Template(funcz,argz,display,codecid) \
+{\
+AVCodec *codec=funcz(argz);\
+if(!codec) {GUI_Error_HIG("Codec",QT_TR_NOOP("Internal error finding codec"display));ADM_assert(0);} \
+  codecId=codecid; \
+  _context->workaround_bugs=1*FF_BUG_AUTODETECT +0*FF_BUG_NO_PADDING; \
+  _context->error_concealment=3; \
+  if (avcodec_open(_context, codec) < 0)  \
+                      { \
+                                        printf("[lavc] Decoder init: "display" video decoder failed!\n"); \
+                                        GUI_Error_HIG("Codec","Internal error opening "display); \
+                                        ADM_assert(0); \
+                                } \
+                                else \
+                                { \
+                                        printf("[lavc] Decoder init: "display" video decoder initialized! (%s)\n",codec->long_name); \
+                                } \
+}
+
+#define WRAP_Open(x)            {WRAP_Open_Template(avcodec_find_decoder,x,#x,x);}
+#define WRAP_OpenByName(x,y)    {WRAP_Open_Template(avcodec_find_decoder_by_name,#x,#x,y);}
+
+
+/**
+    \fn vdpauProbe
+    \brief Try loading vdpau...
+*/
+bool vdpauProbe(void)
+{
+    if(false==vdpauDynaLoader.loadLibrary("/usr/lib/libvdpau.so"))
+    {
+        return false;
+    }
+    ADM_createVdpX11=(VdpDeviceCreateX11*)vdpauDynaLoader.getSymbol("vdp_device_create_x11");
+    if(!ADM_createVdpX11) return false;
+
+    //
+    GUI_WindowInfo xinfo;
+    void *draw;
+    draw=UI_getDrawWidget();
+    UI_getWindowInfo(draw,&xinfo );
+    
+    // try to create....
+    if( VDP_STATUS_OK!=ADM_createVdpX11((Display*)xinfo.display,0,&vdpDevice,&vdpProcAddress))
+    {
+        return false;
+    }
+    // Now that we have the vdpProcAddress, time to get the functions....
+    
+
+
+    return true;
+}
+/**
+
+*/
+int ADM_getBuffer(AVCodecContext *avctx, AVFrame *pic)
+{
+    uint32_t w= avctx->width;
+    uint32_t h= avctx->height;
+
+    uint32_t rounded_w=(w+63)&~63;
+    uint32_t rounded_h=(h+63)&~63;
+    uint32_t page=rounded_w*rounded_h;
+
+    pic->data[0]=new uint8_t [page];
+    pic->data[1]=new uint8_t [page/4];
+    pic->data[2]=new uint8_t [page/4];
+
+    pic->linesize[0]=rounded_w;
+    pic->linesize[1]=rounded_w/2;
+    pic->linesize[2]=rounded_w/2;
+    pic->type= FF_BUFFER_TYPE_USER;
+    pic->age=1;
+    return 0;
+}
+
+ void ADM_releaseBuffer(struct AVCodecContext *avctx, AVFrame *pic)
+{
+    #define F(x) if(pic->x) delete [] pic->x;pic->x=NULL;
+    F(data[0]);
+    F(data[1]);
+    F(data[2]);
+    return;
+}
+//***************************
+
+decoderFFVDPAU::decoderFFVDPAU(uint32_t w, uint32_t h, uint32_t l, uint8_t * d):decoderFF (w,	   h)
+{
+        _context->get_buffer      = ADM_getBuffer;
+        _context->release_buffer  = ADM_releaseBuffer;
+        _context->reget_buffer    = ADM_getBuffer;
+
+        WRAP_OpenByName(h264_vdpau,CODEC_ID_H264);
+}
+
+
+#endif
+// EOF
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/CMakeLists.txt	2009-05-13 10:40:17 UTC (rev 4821)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/CMakeLists.txt	2009-05-13 10:40:21 UTC (rev 4822)
@@ -1,6 +1,8 @@
 SET(ADM_codecs_SRCS 
 	ADM_codecs.cpp  ADM_ffmpeg.cpp  ADM_mjpegEncode.cpp  ADM_png.cpp    ADM_theora_dec.cpp   ADM_xvid.cpp
-	ADM_ffmp43.cpp  ADM_mjpeg.cpp   ADM_rgb16.cpp  ADM_uyvy.cpp        ADM_xvid4.cpp)
+	ADM_ffmp43.cpp  ADM_mjpeg.cpp   ADM_rgb16.cpp  ADM_uyvy.cpp        ADM_xvid4.cpp
+        ADM_ffmpeg_vdpau.cpp
+)
 
 ADD_ADM_LIB_ALL_TARGETS(ADM_codecs ${ADM_codecs_SRCS})
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_core/include/ADM_dynamicLoading.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_core/include/ADM_dynamicLoading.h	2009-05-13 10:40:17 UTC (rev 4821)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_core/include/ADM_dynamicLoading.h	2009-05-13 10:40:21 UTC (rev 4822)
@@ -34,7 +34,7 @@
 	#ifdef __WIN32
 		virtual char* formatMessage(uint32_t msgCode);
 	#endif
-
+    public:
 		ADM_LibWrapper();
 		virtual ~ADM_LibWrapper();		
 		virtual bool loadLibrary(const char* path);

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_render/GUI_render.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_render/GUI_render.cpp	2009-05-13 10:40:17 UTC (rev 4821)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_render/GUI_render.cpp	2009-05-13 10:40:21 UTC (rev 4822)
@@ -88,7 +88,7 @@
   RENDER_CHECK(UI_purge); 
   HookFunc->UI_purge();
  }
-static void MUI_getWindowInfo(void *draw, GUI_WindowInfo *xinfo)
+void MUI_getWindowInfo(void *draw, GUI_WindowInfo *xinfo)
 {
   RENDER_CHECK(UI_getWindowInfo);
   HookFunc->UI_getWindowInfo(draw, xinfo);

Modified: branches/avidemux_2.6_branch_mean/avidemux/main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/main.cpp	2009-05-13 10:40:17 UTC (rev 4821)
+++ branches/avidemux_2.6_branch_mean/avidemux/main.cpp	2009-05-13 10:40:21 UTC (rev 4822)
@@ -42,6 +42,7 @@
 extern void  ADM_lavInit();
 extern void  ADM_lavDestroy();
 extern void  ADM_lavFormatInit(void);
+extern bool  vdpauProbe(void);
 extern "C" {
      extern uint8_t     ADM_InitMemcpy(void);
 };
@@ -76,6 +77,8 @@
 extern uint8_t ADM_ae_loadPlugins(const char *path);
 extern uint8_t ADM_dm_loadPlugins(const char *path);
 extern uint8_t ADM_mx_loadPlugins(const char *path);
+
+extern bool vdpauProbe(void);
 extern void loadPlugins(void);
 extern void InitFactory(void);
 extern void InitCoreToolkit(void);
@@ -294,6 +297,12 @@
 	__try1(exceptionHandler);
 #endif
 
+#ifdef USE_VDPAU
+    printf("Probing for VDPAU...\n");
+    if(vdpauProbe()==true) printf("VDPAU available\n");
+        else printf("VDPAU not available\n");
+#endif
+
     UI_RunApp();
 
 #ifdef __MINGW32__

Modified: branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake	2009-05-13 10:40:17 UTC (rev 4821)
+++ branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake	2009-05-13 10:40:21 UTC (rev 4822)
@@ -18,6 +18,9 @@
 // GCC - Operating System
 #cmakedefine ADM_BSD_FAMILY
 
+// use vdpau h264 hw decoding 
+#cmakedefine USE_VDPAU
+
 // 'gettimeofday' function is present
 #cmakedefine HAVE_GETTIMEOFDAY
 
@@ -35,4 +38,4 @@
 #define fseeko fseeko64
 #endif
 
-#endif
\ No newline at end of file
+#endif

Modified: branches/avidemux_2.6_branch_mean/cmake/config.h.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/config.h.cmake	2009-05-13 10:40:17 UTC (rev 4821)
+++ branches/avidemux_2.6_branch_mean/cmake/config.h.cmake	2009-05-13 10:40:21 UTC (rev 4822)
@@ -92,8 +92,6 @@
 /* use Nvwa memory leak detector */
 #cmakedefine FIND_LEAKS
 
-/* use vdpau h264 hw decoding */
-#cmakedefine USE_VDPAU
 
 #if defined(OSS_SUPPORT) || defined (USE_ARTS) || defined(USE_SDL) || defined(__APPLE__) || defined(__WIN32) || defined(ALSA_SUPPORT)
 #define HAVE_AUDIO



From mean at mail.berlios.de  Wed May 13 17:21:48 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 13 May 2009 17:21:48 +0200
Subject: [Avidemux-svn-commit] r4823 - in
	branches/avidemux_2.6_branch_mean/avidemux: ADM_codecs
	ADM_coreImage/include
Message-ID: <200905131521.n4DFLmJm027482@sheep.berlios.de>

Author: mean
Date: 2009-05-13 17:21:46 +0200 (Wed, 13 May 2009)
New Revision: 4823

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_codecs.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/include/ADM_rgb.h
Log:
[VDPAU] not working VDPAU h264, only display pink stuff

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_codecs.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_codecs.cpp	2009-05-13 10:40:21 UTC (rev 4822)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_codecs.cpp	2009-05-13 15:21:46 UTC (rev 4823)
@@ -60,8 +60,8 @@
 
 extern uint8_t GUI_Question (char *);
 extern uint8_t use_fast_ffmpeg;
+extern bool vdpauUsable(void);
 
-
 uint8_t
   decoders::uncompress (ADMCompressedImage * in, ADMImage * out)
 {
@@ -199,8 +199,12 @@
     }
   if (isH264Compatible (fcc))
     {
-
-      return (decoders *) (new decoderFFH264 (w, h, extraLen, extraData,1));
+#ifdef USE_VDPAU
+        if(vdpauUsable()==true)
+            return (decoders *) (new decoderFFVDPAU (w, h, extraLen, extraData));
+        else
+#endif
+            return (decoders *) (new decoderFFH264 (w, h, extraLen, extraData,1));
     }
 #endif
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp	2009-05-13 10:40:21 UTC (rev 4822)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp	2009-05-13 15:21:46 UTC (rev 4823)
@@ -457,6 +457,9 @@
     case PIX_FMT_RGB555:
       out->_colorspace = ADM_COLOR_RGB555;
       break;
+    case PIX_FMT_VDPAU_H264:
+        out->_colorspace=ADM_COLOR_VDPAU;
+        break;
     default:
       printf ("[lavc] Unhandled colorspace: %d\n", _context->pix_fmt);
       return 0;

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h	2009-05-13 10:40:21 UTC (rev 4822)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h	2009-05-13 15:21:46 UTC (rev 4823)
@@ -351,8 +351,16 @@
 class decoderFFVDPAU:public decoderFF
 {
 protected:
+        
+       
+                    ADMImage *scratch;
 public:
-  decoderFFVDPAU (uint32_t w, uint32_t h, uint32_t l, uint8_t * d);
+                    decoderFFVDPAU (uint32_t w, uint32_t h, uint32_t l, uint8_t * d);
+    virtual uint8_t uncompress (ADMCompressedImage * in, ADMImage * out);
+    virtual uint8_t dontcopy (void)
+                      {
+                        return 0;
+                      }
 };
 
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp	2009-05-13 10:40:21 UTC (rev 4822)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp	2009-05-13 15:21:46 UTC (rev 4823)
@@ -21,6 +21,7 @@
 
 extern "C" {
 #include "ADM_lavcodec.h"
+ #include "ADM_libraries/ADM_ffmpeg/libavcodec/vdpau.h"
 }
 
 #include "ADM_default.h"
@@ -36,11 +37,32 @@
 
 static bool vdpauWorking=false;
 
-static ADM_LibWrapper vdpauDynaLoader;
-static VdpDeviceCreateX11 *ADM_createVdpX11;
+static ADM_LibWrapper        vdpauDynaLoader;
+static VdpDeviceCreateX11    *ADM_createVdpX11;
 static VdpDevice             vdpDevice;
 static VdpGetProcAddress     *vdpProcAddress;
+static VdpDecoder            vdpDecoder;
 
+// VDPAU internal linker
+
+typedef struct 
+{
+    VdpGetErrorString       *getErrorString;
+    VdpGetApiVersion        *getApiVersion;
+    VdpGetInformationString *getInformationString;
+
+    VdpVideoSurfaceCreate   *createSurface;
+    VdpVideoSurfaceDestroy  *destroySurface;
+    VdpVideoSurfaceGetBitsYCbCr *getDataSurface;
+
+    VdpDecoderCreate        *decoderCreate;
+    VdpDecoderDestroy       *decoderDestroy;
+    VdpDecoderRender        *decoderRender;
+
+}VdpFunctions;
+
+static VdpFunctions funcs;
+
 #define WRAP_Open_Template(funcz,argz,display,codecid) \
 {\
 AVCodec *codec=funcz(argz);\
@@ -65,11 +87,29 @@
 
 
 /**
+    \fn vdpauUsable
+    \brief Return true if  vdpau can be used...
+*/
+bool vdpauUsable(void)
+{
+    return vdpauWorking;
+}
+/**
+
+*/
+static void *getFunc(uint32_t id)
+{
+    void *f;
+    if(VDP_STATUS_OK!=vdpProcAddress(vdpDevice,id,&f)) return NULL;
+    return (void *)f;
+}
+/**
     \fn vdpauProbe
     \brief Try loading vdpau...
 */
 bool vdpauProbe(void)
 {
+    memset(&funcs,0,sizeof(funcs));
     if(false==vdpauDynaLoader.loadLibrary("/usr/lib/libvdpau.so"))
     {
         return false;
@@ -89,9 +129,29 @@
         return false;
     }
     // Now that we have the vdpProcAddress, time to get the functions....
-    
+#define GetMe(fun,id)         funcs.fun= (typeof(funcs.fun))getFunc(id);ADM_assert(funcs.fun); 
+        
+    GetMe(getErrorString,VDP_FUNC_ID_GET_ERROR_STRING);
+    GetMe(getApiVersion,VDP_FUNC_ID_GET_API_VERSION);
+    GetMe(getInformationString,VDP_FUNC_ID_GET_INFORMATION_STRING);
 
+    GetMe(createSurface,VDP_FUNC_ID_VIDEO_SURFACE_CREATE);
+    GetMe(destroySurface,VDP_FUNC_ID_VIDEO_SURFACE_DESTROY);
+    GetMe(getDataSurface,VDP_FUNC_ID_VIDEO_SURFACE_GET_BITS_Y_CB_CR);
 
+    GetMe(decoderCreate,VDP_FUNC_ID_DECODER_CREATE);
+    GetMe(decoderDestroy,VDP_FUNC_ID_DECODER_DESTROY);
+    GetMe(decoderRender,VDP_FUNC_ID_DECODER_RENDER);
+
+
+
+    const char *versionString=NULL;
+    uint32_t version=0xff;
+        funcs.getInformationString(&versionString);
+        funcs.getApiVersion(&version);
+        printf("[VDPAU] API : 0x%x, info : %s\n",version,versionString);
+
+    vdpauWorking=true;
     return true;
 }
 /**
@@ -117,7 +177,9 @@
     pic->age=1;
     return 0;
 }
+/**
 
+*/
  void ADM_releaseBuffer(struct AVCodecContext *avctx, AVFrame *pic)
 {
     #define F(x) if(pic->x) delete [] pic->x;pic->x=NULL;
@@ -126,8 +188,11 @@
     F(data[2]);
     return;
 }
-//***************************
-
+#define NB_SURFACE 12
+static VdpVideoSurface surface[NB_SURFACE];
+/**
+    \fn decoderFFVDPAU
+*/
 decoderFFVDPAU::decoderFFVDPAU(uint32_t w, uint32_t h, uint32_t l, uint8_t * d):decoderFF (w,	   h)
 {
         _context->get_buffer      = ADM_getBuffer;
@@ -135,8 +200,75 @@
         _context->reget_buffer    = ADM_getBuffer;
 
         WRAP_OpenByName(h264_vdpau,CODEC_ID_H264);
+
+        // Now instantiate our VDPAU surface & decoder
+        ADM_assert(VDP_STATUS_OK==funcs.decoderCreate(vdpDevice,VDP_DECODER_PROFILE_H264_HIGH,w,h,16,&vdpDecoder));
+        // Create our surfaces...
+        for(int i=0;i<NB_SURFACE;i++)
+        {
+            ADM_assert(VDP_STATUS_OK==funcs.createSurface(vdpDevice,VDP_CHROMA_TYPE_420,w,h,&(surface[i])));
+        }
+        scratch=new ADMImage(w,h,1);
 }
+/**
+    \fn uncompress
+*/
+uint8_t decoderFFVDPAU::uncompress (ADMCompressedImage * in, ADMImage * out)
+{
+VdpStatus status;
+    static int ping=0;
+    // First let ffmpeg prepare datas...
+    if(!decoderFF::uncompress (in, scratch))
+    {
+        printf("[VDPAU] No data from libavcodec\n");
+        return 0;
+    }
+    printf("[VDPAU] OK*0***\n");
+    
+    // Borrowed from mplayer
+    struct vdpau_render_state *rndr = (struct vdpau_render_state *)scratch->_planes[0];
+    
+    status=funcs.decoderRender(vdpDecoder,surface[ping],
+                            (void * const *)&rndr->info, rndr->bitstream_buffers_used, rndr->bitstream_buffers);
+    if(VDP_STATUS_OK!=status)
+    {
+        
+        printf("[VDPAU] No data after decoderRender <%s>\n",funcs.getErrorString(status));
+        return 0;
+    }
+    printf("[VDPAU] OK*1***\n");
+    
+    out->_colorspace=ADM_COLOR_YV12;
+    // Now get back our image...
+    // Copy back from decompressed stuff to our own
+ 
+    void *planes[3];
+            planes[0]=out->GetWritePtr(PLANAR_Y);
+            planes[1]=out->GetWritePtr(PLANAR_U);
+            planes[2]=out->GetWritePtr(PLANAR_V);
+    uint32_t stride[3];
+            stride[0]=out->GetPitch(PLANAR_Y);
+            stride[1]=out->GetPitch(PLANAR_U);
+            stride[2]=out->GetPitch(PLANAR_V);
 
+    status=funcs.getDataSurface(
+                surface[ping],
+                VDP_YCBCR_FORMAT_YV12, //VdpYCbCrFormat   destination_ycbcr_format,
+                planes, //void * const *   destination_data,
+                stride //destination_pitches
+                );
+    if(VDP_STATUS_OK!=status)
+    {
+        
+        printf("[VDPAU] Cannot get data from surface <%s>\n",funcs.getErrorString(status));
+        return 0;
+    }
+    ping++;
+    ping%=NB_SURFACE;
+    printf("[VDPAU] OK*2***\n");
+    out->Pts=in->demuxerPts;
+    return 1;
+}
 
 #endif
 // EOF
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/include/ADM_rgb.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/include/ADM_rgb.h	2009-05-13 10:40:21 UTC (rev 4822)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreImage/include/ADM_rgb.h	2009-05-13 15:21:46 UTC (rev 4823)
@@ -33,7 +33,8 @@
     ADM_COLOR_YUV422,
     ADM_COLOR_YUV422P,
 	ADM_COLOR_YUV411,
-	ADM_COLOR_YUV444
+	ADM_COLOR_YUV444,
+    ADM_COLOR_VDPAU
  } ADM_colorspace;
 #define ADM_COLOR_BACKWARD 0x8000
 #define ADM_COLOR_MASK     0x7FFF



From mean at mail.berlios.de  Thu May 14 10:50:36 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 14 May 2009 10:50:36 +0200
Subject: [Avidemux-svn-commit] r4824 - in
	branches/avidemux_2.6_branch_mean/avidemux: . ADM_codecs
	ADM_coreUtils/src ADM_userInterfaces/ADM_commonUI
Message-ID: <200905140850.n4E8oah7011785@sheep.berlios.de>

Author: mean
Date: 2009-05-14 10:50:35 +0200 (Thu, 14 May 2009)
New Revision: 4824

Added:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau_internal.h
   branches/avidemux_2.6_branch_mean/avidemux/prefs.in
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils/src/prefs.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
   branches/avidemux_2.6_branch_mean/avidemux/prefs.h
   branches/avidemux_2.6_branch_mean/avidemux/prefs_gen.pl
Log:
[VDPAU] Working VDPAU for H264, slow!

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp	2009-05-13 15:21:46 UTC (rev 4823)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp	2009-05-14 08:50:35 UTC (rev 4824)
@@ -794,7 +794,7 @@
 }
 void adm_lavLogCallback(void  *instance, int level, const char* fmt, va_list list)
 {
-    if(level>1) return;
+   // if(level>1) return;
     char buf[256];
   
     vsnprintf(buf, sizeof(buf), fmt, list);

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h	2009-05-13 15:21:46 UTC (rev 4823)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h	2009-05-14 08:50:35 UTC (rev 4824)
@@ -351,11 +351,22 @@
 class decoderFFVDPAU:public decoderFF
 {
 protected:
-        
-       
+                    int b_age;
+                    int ip_age[2];
+
+                    void     *vdpau;
                     ADMImage *scratch;
+                    ADMImage *vdpau_copy;
+                    uint64_t vdpau_pts;
+                    bool     decode_status;
+public:     // Callbacks
+                    int     getBuffer(AVCodecContext *avctx, AVFrame *pic);
+                    void    releaseBuffer(struct AVCodecContext *avctx, AVFrame *pic);
+                    void    goOn( const AVFrame *d);            
 public:
+            // public API
                     decoderFFVDPAU (uint32_t w, uint32_t h, uint32_t l, uint8_t * d);
+                    ~decoderFFVDPAU();
     virtual uint8_t uncompress (ADMCompressedImage * in, ADMImage * out);
     virtual uint8_t dontcopy (void)
                       {

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp	2009-05-13 15:21:46 UTC (rev 4823)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp	2009-05-14 08:50:35 UTC (rev 4824)
@@ -6,6 +6,8 @@
     VDPAU is loaded dynamically to be able to make a binary
         and have something working even if the target machine
         does not have vdpau
+    Some part, especially get/buffer and ip_age borrowed from xbmc
+        as the api from ffmpeg is far from clean....
 
 
  ***************************************************************************/
@@ -33,7 +35,10 @@
 #include "DIA_coreToolkit.h"
 #include "ADM_dynamicLoading.h"
 #include "ADM_userInterfaces/ADM_render/GUI_render.h"
+#include "ADM_ffmpeg_vdpau_internal.h"
+#include "prefs.h"
 
+static VdpFunctions funcs;
 
 static bool vdpauWorking=false;
 
@@ -41,61 +46,23 @@
 static VdpDeviceCreateX11    *ADM_createVdpX11;
 static VdpDevice             vdpDevice;
 static VdpGetProcAddress     *vdpProcAddress;
-static VdpDecoder            vdpDecoder;
 
-// VDPAU internal linker
+#define aprintf(...) {}
 
-typedef struct 
-{
-    VdpGetErrorString       *getErrorString;
-    VdpGetApiVersion        *getApiVersion;
-    VdpGetInformationString *getInformationString;
-
-    VdpVideoSurfaceCreate   *createSurface;
-    VdpVideoSurfaceDestroy  *destroySurface;
-    VdpVideoSurfaceGetBitsYCbCr *getDataSurface;
-
-    VdpDecoderCreate        *decoderCreate;
-    VdpDecoderDestroy       *decoderDestroy;
-    VdpDecoderRender        *decoderRender;
-
-}VdpFunctions;
-
-static VdpFunctions funcs;
-
-#define WRAP_Open_Template(funcz,argz,display,codecid) \
-{\
-AVCodec *codec=funcz(argz);\
-if(!codec) {GUI_Error_HIG("Codec",QT_TR_NOOP("Internal error finding codec"display));ADM_assert(0);} \
-  codecId=codecid; \
-  _context->workaround_bugs=1*FF_BUG_AUTODETECT +0*FF_BUG_NO_PADDING; \
-  _context->error_concealment=3; \
-  if (avcodec_open(_context, codec) < 0)  \
-                      { \
-                                        printf("[lavc] Decoder init: "display" video decoder failed!\n"); \
-                                        GUI_Error_HIG("Codec","Internal error opening "display); \
-                                        ADM_assert(0); \
-                                } \
-                                else \
-                                { \
-                                        printf("[lavc] Decoder init: "display" video decoder initialized! (%s)\n",codec->long_name); \
-                                } \
-}
-
-#define WRAP_Open(x)            {WRAP_Open_Template(avcodec_find_decoder,x,#x,x);}
-#define WRAP_OpenByName(x,y)    {WRAP_Open_Template(avcodec_find_decoder_by_name,#x,#x,y);}
-
-
 /**
     \fn vdpauUsable
     \brief Return true if  vdpau can be used...
 */
 bool vdpauUsable(void)
 {
-    return vdpauWorking;
+    uint32_t v=false;
+    if(!vdpauWorking) return false;
+    if(!prefs->get(FEATURE_VDPAU,&v)) v=false;
+    return v;
 }
 /**
-
+    \fn getFunc
+    \brief vdpau function pointers from ID
 */
 static void *getFunc(uint32_t id)
 {
@@ -155,104 +122,179 @@
     return true;
 }
 /**
-
+    \fn ADM_VDPAUgetBuffer
+    \brief trampoline to get a VDPAU surface
 */
-int ADM_getBuffer(AVCodecContext *avctx, AVFrame *pic)
+int ADM_VDPAUgetBuffer(AVCodecContext *avctx, AVFrame *pic)
 {
-    uint32_t w= avctx->width;
-    uint32_t h= avctx->height;
+    decoderFFVDPAU *dec=(decoderFFVDPAU *)avctx->opaque;
+    return dec->getBuffer(avctx,pic);
+}
+/**
+    \fn getBuffer
+    \brief returns a VDPAU render masquerading as a AVFrame
+*/
+int decoderFFVDPAU::getBuffer(AVCodecContext *avctx, AVFrame *pic)
+{
+    vdpau_render_state * render;
+    if(VDPAU->freeQueue.size()==0)
+    {
+        printf("[VDPAU] No more available surface\n");
+        return -1;
+    }
+    // Get an image   
+    render=VDPAU->freeQueue.back();
+    VDPAU->freeQueue.pop_back();
+    render->state=0;
+    pic->data[0]=(uint8_t *)render;
+    pic->data[1]=(uint8_t *)render;
+    pic->data[2]=(uint8_t *)render;
+    pic->linesize[0]=0;
+    pic->linesize[1]=0;
+    pic->linesize[2]=0;
+    pic->type=FF_BUFFER_TYPE_USER;
+    render->state |= FF_VDPAU_STATE_USED_FOR_REFERENCE;
+    pic->reordered_opaque= avctx->reordered_opaque;
+    if(pic->reference)
+    {
+        pic->age=ip_age[0];
+        ip_age[0]=ip_age[1]+1;
+        ip_age[1]=1;
+        b_age++;
+    }else
+    {
+        pic->age=b_age;
+        ip_age[0]++;
+        ip_age[1]++;
+        b_age=1;
+    }
+    return 0;
+}
+/**
+    \fn releaseBuffer
+*/
+void decoderFFVDPAU::releaseBuffer(AVCodecContext *avctx, AVFrame *pic)
+{
+  vdpau_render_state * render;
+  int i;
 
-    uint32_t rounded_w=(w+63)&~63;
-    uint32_t rounded_h=(h+63)&~63;
-    uint32_t page=rounded_w*rounded_h;
+  render=(vdpau_render_state*)pic->data[0];
+  ADM_assert(render);
 
-    pic->data[0]=new uint8_t [page];
-    pic->data[1]=new uint8_t [page/4];
-    pic->data[2]=new uint8_t [page/4];
-
-    pic->linesize[0]=rounded_w;
-    pic->linesize[1]=rounded_w/2;
-    pic->linesize[2]=rounded_w/2;
-    pic->type= FF_BUFFER_TYPE_USER;
-    pic->age=1;
-    return 0;
+  render->state &= ~FF_VDPAU_STATE_USED_FOR_REFERENCE;
+  for(i=0; i<4; i++){
+    pic->data[i]= NULL;
+  }
+  VDPAU->freeQueue.push_back(render);
 }
 /**
-
+    \fn ADM_VDPAUreleaseBuffer
 */
- void ADM_releaseBuffer(struct AVCodecContext *avctx, AVFrame *pic)
+ void ADM_VDPAUreleaseBuffer(struct AVCodecContext *avctx, AVFrame *pic)
 {
-    #define F(x) if(pic->x) delete [] pic->x;pic->x=NULL;
-    F(data[0]);
-    F(data[1]);
-    F(data[2]);
-    return;
+    decoderFFVDPAU *dec=(decoderFFVDPAU *)avctx->opaque;
+    dec->releaseBuffer(avctx,pic);
 }
-#define NB_SURFACE 12
-static VdpVideoSurface surface[NB_SURFACE];
 /**
     \fn decoderFFVDPAU
 */
 decoderFFVDPAU::decoderFFVDPAU(uint32_t w, uint32_t h, uint32_t l, uint8_t * d):decoderFF (w,	   h)
 {
-        _context->get_buffer      = ADM_getBuffer;
-        _context->release_buffer  = ADM_releaseBuffer;
-        _context->reget_buffer    = ADM_getBuffer;
+        _context->opaque          = this;
+        _context->get_buffer      = ADM_VDPAUgetBuffer;
+        _context->release_buffer  = ADM_VDPAUreleaseBuffer;
+        _context->draw_horiz_band = draw;
+        _context->slice_flags     = SLICE_FLAG_CODED_ORDER|SLICE_FLAG_ALLOW_FIELD;
 
+        vdpau=(void *)new vdpauContext;
+        VDPAU->vdpDecoder=VDP_INVALID_HANDLE;
         WRAP_OpenByName(h264_vdpau,CODEC_ID_H264);
-
+        
         // Now instantiate our VDPAU surface & decoder
-        ADM_assert(VDP_STATUS_OK==funcs.decoderCreate(vdpDevice,VDP_DECODER_PROFILE_H264_HIGH,w,h,16,&vdpDecoder));
+        ADM_assert(VDP_STATUS_OK==funcs.decoderCreate(vdpDevice,VDP_DECODER_PROFILE_H264_HIGH,w,h,15,&(VDPAU->vdpDecoder)));
         // Create our surfaces...
         for(int i=0;i<NB_SURFACE;i++)
         {
-            ADM_assert(VDP_STATUS_OK==funcs.createSurface(vdpDevice,VDP_CHROMA_TYPE_420,w,h,&(surface[i])));
+            VDPAU->renders[i]=new vdpau_render_state;
+            ADM_assert(VDP_STATUS_OK==funcs.createSurface(vdpDevice,VDP_CHROMA_TYPE_420,w,h,&(VDPAU->renders[i]->surface)));
+            VDPAU->freeQueue.push_back(VDPAU->renders[i]);
         }
         scratch=new ADMImage(w,h,1);
+        b_age = ip_age[0] = ip_age[1] = 256*256*256*64;
+
 }
 /**
+    \fn ~            void    goOn( const AVFrame *d);
+*/
+decoderFFVDPAU::~decoderFFVDPAU()
+{
+        printf("[VDPAU] Cleaning up\n");
+        for(int i=0;i<NB_SURFACE;i++)
+        {
+            ADM_assert(VDP_STATUS_OK==funcs.destroySurface((VDPAU->renders[i]->surface)));
+            delete VDPAU->renders[i];
+        }
+         ADM_assert(VDP_STATUS_OK==funcs.decoderDestroy(VDPAU->vdpDecoder));
+         delete VDPAU;
+         vdpau=NULL;
+}
+/**
     \fn uncompress
 */
 uint8_t decoderFFVDPAU::uncompress (ADMCompressedImage * in, ADMImage * out)
 {
 VdpStatus status;
-    static int ping=0;
+    
     // First let ffmpeg prepare datas...
+    vdpau_copy=out;
+    decode_status=false;
     if(!decoderFF::uncompress (in, scratch))
     {
         printf("[VDPAU] No data from libavcodec\n");
         return 0;
     }
-    printf("[VDPAU] OK*0***\n");
-    
-    // Borrowed from mplayer
-    struct vdpau_render_state *rndr = (struct vdpau_render_state *)scratch->_planes[0];
-    
-    status=funcs.decoderRender(vdpDecoder,surface[ping],
+    // other part will be done in goOn
+    out->Pts=vdpau_pts;
+    return (uint8_t)decode_status;
+}
+/**
+    \fn goOn
+    \brief Callback from ffmpeg when a pic is ready to be decoded
+*/
+void decoderFFVDPAU::goOn( const AVFrame *d)
+{
+   VdpStatus status;
+   struct vdpau_render_state *rndr = (struct vdpau_render_state *)d->data[0];
+   VdpVideoSurface  surface;
+
+    surface=rndr->surface;
+    vdpau_pts=d->reordered_opaque; // Retrieve our PTS
+
+     aprintf("[VDPAU] Decoding Using surface %d\n", surface);
+    status=funcs.decoderRender(VDPAU->vdpDecoder, surface,
                             (void * const *)&rndr->info, rndr->bitstream_buffers_used, rndr->bitstream_buffers);
     if(VDP_STATUS_OK!=status)
     {
-        
         printf("[VDPAU] No data after decoderRender <%s>\n",funcs.getErrorString(status));
-        return 0;
+        return ;
     }
-    printf("[VDPAU] OK*1***\n");
-    
-    out->_colorspace=ADM_COLOR_YV12;
-    // Now get back our image...
-    // Copy back from decompressed stuff to our own
- 
-    void *planes[3];
-            planes[0]=out->GetWritePtr(PLANAR_Y);
-            planes[1]=out->GetWritePtr(PLANAR_U);
-            planes[2]=out->GetWritePtr(PLANAR_V);
+    aprintf("[VDPAU] DecodeRender Ok***\n");
+  
+  
+  void *planes[3];
+            planes[0]=vdpau_copy->GetWritePtr(PLANAR_Y);
+            planes[1]=vdpau_copy->GetWritePtr(PLANAR_U);
+            planes[2]=vdpau_copy->GetWritePtr(PLANAR_V);
     uint32_t stride[3];
-            stride[0]=out->GetPitch(PLANAR_Y);
-            stride[1]=out->GetPitch(PLANAR_U);
-            stride[2]=out->GetPitch(PLANAR_V);
+            stride[0]=vdpau_copy->GetPitch(PLANAR_Y);
+            stride[1]=vdpau_copy->GetPitch(PLANAR_U);
+            stride[2]=vdpau_copy->GetPitch(PLANAR_V);
 
+    
+   // Copy back the decoded image to our output ADM_image
+   aprintf("[VDPAU] Getting datas from surface %d\n",surface);
     status=funcs.getDataSurface(
-                surface[ping],
+                surface,
                 VDP_YCBCR_FORMAT_YV12, //VdpYCbCrFormat   destination_ycbcr_format,
                 planes, //void * const *   destination_data,
                 stride //destination_pitches
@@ -261,14 +303,25 @@
     {
         
         printf("[VDPAU] Cannot get data from surface <%s>\n",funcs.getErrorString(status));
-        return 0;
+        decode_status=false;
+        return ;
     }
-    ping++;
-    ping%=NB_SURFACE;
-    printf("[VDPAU] OK*2***\n");
-    out->Pts=in->demuxerPts;
-    return 1;
+    
+    aprintf("[VDPAU] Success\n");
+    decode_status=true;
+    return;
 }
 
+
+/**
+    \fn draw
+    \brief callback invoked by lavcodec when a pic is ready to be decoded
+*/
+void draw(struct AVCodecContext *s,    const AVFrame *src, int offset[4],    int y, int type, int height)
+{
+    decoderFFVDPAU *dec=(decoderFFVDPAU *)s->opaque;
+    dec->goOn(src);
+}
+
 #endif
 // EOF
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau_internal.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau_internal.h	2009-05-13 15:21:46 UTC (rev 4823)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau_internal.h	2009-05-14 08:50:35 UTC (rev 4824)
@@ -0,0 +1,82 @@
+/***************************************************************************
+            \file              ADM_ffmpeg_vdpau.cpp  
+            \brief Decoder using half ffmpeg/half VDPAU
+
+    The ffmpeg part is to preformat inputs for VDPAU
+    VDPAU is loaded dynamically to be able to make a binary
+        and have something working even if the target machine
+        does not have vdpau
+
+
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#ifndef ADM_ffmpeg_vdpa_internal_H
+#define ADM_ffmpeg_vdpa_internal_H
+#include <vector>
+extern "C" {
+static void draw(struct AVCodecContext *s,    const AVFrame *src, int offset[4],    int y, int type, int height);
+static int ADM_VDPAUgetBuffer(AVCodecContext *avctx, AVFrame *pic);
+static void ADM_VDPAUreleaseBuffer(struct AVCodecContext *avctx, AVFrame *pic);
+}
+
+
+#define NB_SURFACE 50
+typedef struct 
+{
+        VdpDecoder            vdpDecoder;
+        vdpau_render_state *renders[NB_SURFACE];
+        std::vector <vdpau_render_state *>freeQueue;
+
+}vdpauContext;
+
+#define VDPAU ((vdpauContext *)vdpau)
+
+// VDPAU internal linker
+
+typedef struct 
+{
+    VdpGetErrorString       *getErrorString;
+    VdpGetApiVersion        *getApiVersion;
+    VdpGetInformationString *getInformationString;
+
+    VdpVideoSurfaceCreate   *createSurface;
+    VdpVideoSurfaceDestroy  *destroySurface;
+    VdpVideoSurfaceGetBitsYCbCr *getDataSurface;
+
+    VdpDecoderCreate        *decoderCreate;
+    VdpDecoderDestroy       *decoderDestroy;
+    VdpDecoderRender        *decoderRender;
+
+}VdpFunctions;
+
+#define WRAP_Open_Template(funcz,argz,display,codecid) \
+{\
+AVCodec *codec=funcz(argz);\
+if(!codec) {GUI_Error_HIG("Codec",QT_TR_NOOP("Internal error finding codec"display));ADM_assert(0);} \
+  codecId=codecid; \
+  _context->workaround_bugs=1*FF_BUG_AUTODETECT +0*FF_BUG_NO_PADDING; \
+  _context->error_concealment=3; \
+  if (avcodec_open(_context, codec) < 0)  \
+                      { \
+                                        printf("[lavc] Decoder init: "display" video decoder failed!\n"); \
+                                        GUI_Error_HIG("Codec","Internal error opening "display); \
+                                        ADM_assert(0); \
+                                } \
+                                else \
+                                { \
+                                        printf("[lavc] Decoder init: "display" video decoder initialized! (%s)\n",codec->long_name); \
+                                } \
+}
+
+#define WRAP_Open(x)            {WRAP_Open_Template(avcodec_find_decoder,x,#x,x);}
+#define WRAP_OpenByName(x,y)    {WRAP_Open_Template(avcodec_find_decoder_by_name,#x,#x,y);}
+
+#endif
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils/src/prefs.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils/src/prefs.cpp	2009-05-13 15:21:46 UTC (rev 4823)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreUtils/src/prefs.cpp	2009-05-14 08:50:35 UTC (rev 4824)
@@ -76,11 +76,7 @@
 	{"codecs.xvid.bitrate",		UINT,	"1500000",NULL,	"17",	"5900000"},
 	{"codecs.xvid.finalsize",	UINT,	"700",	NULL,	"0",	"3999"	},
 	{"codecs.preferredcodec",		STRING,"FFmpeg4",NULL, NULL, NULL },
-#ifdef __WIN32
-	{"filters.subtitle.fontname",		FILENAME,"C:\\Windows\\Fonts\\arial.ttf",NULL, NULL, NULL },
-#else
 	{"filters.subtitle.fontname",		FILENAME,"/usr/share/fonts/truetype/DejaVuSans.ttf",NULL, NULL, NULL },
-#endif
 	{"filters.subtitle.charset",		STRING,"ISO-8859-1",NULL, NULL, NULL },
 	{"filters.subtitle.fontsize",		UINT,	"24",	NULL,	"1",	"576"	},
 	{"filters.subtitle.ypercent",	INT,	"255",	NULL,	"0",	"255"	},
@@ -89,11 +85,7 @@
 	{"filters.subtitle.selfadjustable",		UINT,	"0",	NULL,	"0",	"1"	},
 	{"filters.subtitle.usebackgroundcolor",		UINT,	"0",	NULL,	"0",	"1"	},
 	{"settings.mpegsplit",	UINT,	"790",	NULL,	"400",	"5000"	},
-#ifdef __WIN32
-	{"device.audiodevice",		STRING,"WIN32",NULL, NULL, NULL },
-#else
 	{"device.audiodevice",		STRING,"ALSA",	NULL, NULL, NULL },
-#endif
 	{"device.audio.alsa_device",		STRING,"dmix",	NULL, NULL, NULL },
 	{"device.videodevice",		UINT,	"0",	NULL,	"0",	"10"	},
 	{"default.postproc_type",		UINT,	"3",	NULL,	"0",	"7"	},
@@ -123,8 +115,6 @@
 	{"feature.reuse_2pass_log",		UINT,	"0",	NULL,	"0",	"1"	},
 	{"feature.audiobar_uses_master",		UINT,	"0",	NULL,	"0",	"1"	},
 	{"feature.threading.lavc",		UINT,	"0",	NULL,	"0",	"32"	},
-	{"feature.threading.x264",		UINT,	"0",	NULL,	"0",	"32"	},
-	{"feature.threading.xvid",		UINT,	"0",	NULL,	"0",	"32"	},
 	{"feature.cpu_caps",		UINT,	"4294967295",NULL,	"0",	"4294967295"},
 	{"feature.mpeg_no_limit",		UINT,	"0",	NULL,	"0",	"1"	},
 	{"feature.auto_buildmap",		UINT,	"0",	NULL,	"0",	"1"	},
@@ -134,6 +124,7 @@
 	{"filters.autoload.path",		STRING,"/tmp/",NULL, NULL, NULL },
 	{"filters.autoload.active",		UINT,	"0",	NULL,	"0",	"1"	},
 	{"feature.alternate_mp3_tag",		UINT,	"1",	NULL,	"0",	"1"	},
+	{"feature.vdpau",		UINT,	"0",	NULL,	"0",	"1"	},
 	{"feature.global_glyph.active",		UINT,	"1",	NULL,	"0",	"1"	},
 	{"feature.global_glyph.name",		STRING,"",	NULL, NULL, NULL },
 	{"priority.encoding",		UINT,	"3",	NULL,	"0",	"4"	},
@@ -141,7 +132,7 @@
 	{"priority.playback",		UINT,	"0",	NULL,	"0",	"4"	}
 };
 
-int num_opts = 80;
+int num_opts = 79;
 // </prefs_gen>
 
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2009-05-13 15:21:46 UTC (rev 4823)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2009-05-14 08:50:35 UTC (rev 4824)
@@ -49,7 +49,7 @@
 uint32_t useAutoIndex=0;
 uint32_t useSwap=0;
 uint32_t useNuv=0;
-uint32_t lavcThreads=0,x264Threads=0,xvidThreads=0;
+uint32_t lavcThreads=0;
 uint32_t encodePriority=2;
 uint32_t indexPriority=2;
 uint32_t playbackPriority=0;
@@ -66,6 +66,7 @@
 uint32_t alternate_mp3_tag=1;
 uint32_t pp_type=3;
 uint32_t pp_value=5;
+uint32_t vdpau=0;
 uint32_t hzd,vzd,dring;
 uint32_t capsMMX,capsMMXEXT,caps3DNOW,caps3DNOWEXT,capsSSE,capsSSE2,capsSSE3,capsSSSE3,capsAll;
 
@@ -103,6 +104,8 @@
 #endif
         // autovbr
         prefs->get(FEATURE_AUTO_BUILDMAP,&autovbr);
+        // vdpau
+        prefs->get(FEATURE_VDPAU,&vdpau);
         // autoindex
         prefs->get(FEATURE_AUTO_REBUILDINDEX,&autoindex);
         // Global glyph
@@ -126,9 +129,8 @@
 
         // Multithreads
         prefs->get(FEATURE_THREADING_LAVC, &lavcThreads);
-        prefs->get(FEATURE_THREADING_X264, &x264Threads);
-        prefs->get(FEATURE_THREADING_XVID, &xvidThreads);
 
+
 		// Encoding priority
 		if(!prefs->get(PRIORITY_ENCODING, &encodePriority))
                 encodePriority=2;
@@ -173,6 +175,7 @@
         olddevice=newdevice=AVDM_getCurrentDevice();
         // Audio device
         /************************ Build diaelems ****************************************/
+        diaElemToggle useVdpau(&vdpau,QT_TR_NOOP("_Use VDPAU for decoding H264"));
         diaElemToggle useSysTray(&useTray,QT_TR_NOOP("_Use systray while encoding"));
         diaElemToggle allowAnyMpeg(&mpeg_no_limit,QT_TR_NOOP("_Accept non-standard audio frequency for DVD"));
         diaElemToggle openDml(&use_odml,QT_TR_NOOP("Create _OpenDML files"));
@@ -216,13 +219,9 @@
 		frameSimd.swallow(&capsToggleSSSE3);
 
 		diaElemThreadCount lavcThreadCount(&lavcThreads, QT_TR_NOOP("_lavc threads:"));
-		diaElemThreadCount x264ThreadCount(&x264Threads, QT_TR_NOOP("_x264 threads:"));
-		diaElemThreadCount xvidThreadCount(&xvidThreads, QT_TR_NOOP("X_vid threads:"));
 
 		diaElemFrame frameThread(QT_TR_NOOP("Multi-threading"));
 		frameThread.swallow(&lavcThreadCount);
-		frameThread.swallow(&x264ThreadCount);
-		frameThread.swallow(&xvidThreadCount);
 
 		diaMenuEntry priorityEntries[] = {
                              {0,       QT_TR_NOOP("High"),NULL}
@@ -360,8 +359,8 @@
 
         
         /* Video */
-        diaElem *diaVideo[]={&menuVideoMode,&framePP};
-        diaElemTabs tabVideo(QT_TR_NOOP("Video"),2,(diaElem **)diaVideo);
+        diaElem *diaVideo[]={&menuVideoMode,&framePP,&useVdpau};
+        diaElemTabs tabVideo(QT_TR_NOOP("Video"),3,(diaElem **)diaVideo);
         
         /* CPU tab */
 		diaElem *diaCpu[]={&frameSimd};
@@ -454,8 +453,6 @@
                 
                 // number of threads
                 prefs->set(FEATURE_THREADING_LAVC, lavcThreads);
-				prefs->set(FEATURE_THREADING_X264, x264Threads);
-				prefs->set(FEATURE_THREADING_XVID, xvidThreads);
 
 				// Encoding priority
 				prefs->set(PRIORITY_ENCODING, encodePriority);
@@ -475,7 +472,8 @@
                 prefs->set(FEATURE_USE_SYSTRAY,useTray);
                 // Filter directory
 				prefs->set(FILTERS_AUTOLOAD_ACTIVE, activeXfilter);
-
+                // VDPAU
+                prefs->set(FEATURE_VDPAU,vdpau);
                 if(filterPath)
                   prefs->set(FILTERS_AUTOLOAD_PATH, filterPath);
                 // Alternate mp3 tag (haali)

Modified: branches/avidemux_2.6_branch_mean/avidemux/prefs.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/prefs.h	2009-05-13 15:21:46 UTC (rev 4823)
+++ branches/avidemux_2.6_branch_mean/avidemux/prefs.h	2009-05-14 08:50:35 UTC (rev 4824)
@@ -72,8 +72,6 @@
 	FEATURE_REUSE_2PASS_LOG,
 	FEATURE_AUDIOBAR_USES_MASTER,
 	FEATURE_THREADING_LAVC,
-	FEATURE_THREADING_X264,
-	FEATURE_THREADING_XVID,
 	FEATURE_CPU_CAPS,
 	FEATURE_MPEG_NO_LIMIT,
 	FEATURE_AUTO_BUILDMAP,
@@ -83,6 +81,7 @@
 	FILTERS_AUTOLOAD_PATH,
 	FILTERS_AUTOLOAD_ACTIVE,
 	FEATURE_ALTERNATE_MP3_TAG,
+	FEATURE_VDPAU,
 	FEATURE_GLOBAL_GLYPH_ACTIVE,
 	FEATURE_GLOBAL_GLYPH_NAME,
 	PRIORITY_ENCODING,

Added: branches/avidemux_2.6_branch_mean/avidemux/prefs.in
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/prefs.in	2009-05-13 15:21:46 UTC (rev 4823)
+++ branches/avidemux_2.6_branch_mean/avidemux/prefs.in	2009-05-14 08:50:35 UTC (rev 4824)
@@ -0,0 +1,102 @@
+#
+# this file will be used as input for pref.h and pref.cpp
+#
+
+# option_name :: name without '-'; the dot is the separator used for the xml tree
+#		 '.' will be changed to '_'
+#		 all letters will be changed to there upper case equivalents
+# type        :: ( UINT | INT | ULONG | LONG | FLOAT | STRING )
+# value       :: default value; used if no xml value available
+# minimum     :: the smallest value this option can have (ignored for STRING)
+# maximum     :: the largest  value this option can have (ignored for STRING)
+
+# option name				type	value	minimum	maximum (incl.)
+codecs.svcd.enctype,			UINT,	0,	0,	99999
+codecs.svcd.bitrate,			UINT,	1500000,16000,	2748000
+codecs.svcd.quantizer,			UINT,	4,	2,	31
+codecs.svcd.finalsize,			UINT,	700,	0,	99999
+codecs.svcd.interlaced,			UINT,	0,	0,	1
+codecs.svcd.bff,			UINT,	0,	0,	1
+codecs.svcd.widescreen,			UINT,	0,	0,	1
+codecs.svcd.matrix,			UINT,	0,	0,	99999
+codecs.svcd.gopsize,			UINT,	12,	0,	99999
+codecs.svcd.maxbitrate,			UINT,	2500,	0,	2748
+codecs.dvd.enctype,			UINT,	0,	0,	99999
+codecs.dvd.bitrate,			UINT,	1500000,16000,	9900000
+codecs.dvd.quantizer,			UINT,	4,	2,	31
+codecs.dvd.finalsize,			UINT,	700,	0,	99999
+codecs.dvd.interlaced,			UINT,	0,	0,	1
+codecs.dvd.bff,				UINT,	0,	0,	1
+codecs.dvd.widescreen,			UINT,	0,	0,	1
+codecs.dvd.matrix,			UINT,	0,	0,	99999
+codecs.dvd.gopsize,			UINT,	12,	0,	99999
+codecs.dvd.maxbitrate,			UINT,	9000,	0,	9900
+codecs.xvid.enctype,			UINT,	0,	0,	99999
+codecs.xvid.quantizer,			UINT,	4,	2,	32
+codecs.xvid.bitrate,			UINT,	1500000,17,	5900000
+codecs.xvid.finalsize,			UINT,	700,	0,	3999
+codecs.preferredcodec,			STRING,	FFmpeg4
+filters.subtitle.fontname,		FILENAME, "/usr/share/fonts/truetype/DejaVuSans.ttf"
+filters.subtitle.charset,		STRING, "ISO-8859-1"
+filters.subtitle.fontsize,		UINT,	24,	1,	576
+filters.subtitle.ypercent,		INT,	255,	0,	255
+filters.subtitle.upercent,		INT,	0,	0,	255
+filters.subtitle.vpercent,		INT,	0,	0,	255
+filters.subtitle.selfadjustable,	UINT,	0,	0,	1
+filters.subtitle.usebackgroundcolor,	UINT,	0,	0,	1
+# codec metasettings for mpeg2enc based
+settings.mpegsplit, 			UINT,	790,	400,	5000
+device.audiodevice,			STRING,	ALSA
+device.audio.alsa_device,               STRING, "dmix"
+device.videodevice,			UINT,	0,	0,	10
+# Posproc
+default.postproc_type,			UINT,	3,	0,	7
+default.postproc_value,			UINT,	3,	0,	5
+# lastfiles
+lastfiles.file1,			FILENAME,	""
+lastfiles.file2,			FILENAME,	""
+lastfiles.file3,			FILENAME,	""
+lastfiles.file4,			FILENAME,	""
+lastdir_read,				FILENAME,	""
+lastdir_write,				FILENAME,	""
+# lame
+lame_cli,				STRING, ""
+pipe_cmd,				STRING, ""
+pipe_param,				STRING, ""
+lame_path,				STRING, ""
+toolame_path,				STRING, ""
+lvemux_path,				STRING, ""
+requant_path,				STRING, ""
+# 0 - no messages, 1 - only error messages, 2 - all messages
+message_level,				UINT,	2,	0,	2
+# feature
+feature.swap_if_A_greater_than_B,	UINT,   1,      0,      1
+feature.svcdres.preferedsourceratio,	STRING, "1:1"
+feature.saveprefsonexit,		UINT,	1,	0,	1
+feature.ignoresavedmarkers,		UINT,	0,	0,	1
+feature.disable_nuv_resync,		UINT,	0,	0,	1
+feature.tryautoidx,			UINT,	0,	0,	1
+feature.use_odml,                       UINT,   0,      0,      1
+feature.use_systray,                    UINT,   0,      0,      1
+feature.reuse_2pass_log,                UINT,   0,      0,      1
+feature.audiobar_uses_master,           UINT,   0,      0,      1
+feature.threading.lavc,                 UINT,   0,      0,      32
+feature.cpu_caps,  		                UINT,   4294967295,      0,      4294967295
+feature.mpeg_no_limit,                  UINT,   0,      0,      1
+feature.auto_buildmap,                  UINT,   0,      0,      1
+feature.auto_rebuildindex,              UINT,   0,      0,      1
+feature.auto_unpack,                    UINT,   0,      0,      1
+# prologic 1/2
+downmixing.prologic,			UINT,	2,	0,	2
+filters.autoload.path,                  STRING, "/tmp/"
+filters.autoload.active,                UINT,   0,      0,      1
+feature.alternate_mp3_tag,              UINT,   1,      0,      1
+#
+feature.vdpau,                          UINT,   0,      0,      1
+# Global glyphset file
+feature.global_glyph.active,            UINT,   1,      0,      1
+feature.global_glyph.name,              STRING, ""
+# priority
+priority.encoding,          UINT,   3,      0,      4
+priority.indexing,          UINT,   3,      0,      4
+priority.playback,          UINT,   0,      0,      4

Modified: branches/avidemux_2.6_branch_mean/avidemux/prefs_gen.pl
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/prefs_gen.pl	2009-05-13 15:21:46 UTC (rev 4823)
+++ branches/avidemux_2.6_branch_mean/avidemux/prefs_gen.pl	2009-05-14 08:50:35 UTC (rev 4824)
@@ -6,7 +6,7 @@
 my $srcdir=".";
 my $in  = "$srcdir/prefs.in";
 my $h   = "$srcdir/prefs.h";
-my $cpp = "$srcdir/ADM_libraries/ADM_utilities/prefs.cpp";
+my $cpp = "$srcdir/ADM_coreUtils/src/prefs.cpp";
 #print "In:$in\n";
 my $h_str = "typedef enum {\n";
 my $cpp_str = "typedef enum {\n".



From mean at mail.berlios.de  Thu May 14 11:34:00 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 14 May 2009 11:34:00 +0200
Subject: [Avidemux-svn-commit] r4825 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs
Message-ID: <200905140934.n4E9Y0oW017315@sheep.berlios.de>

Author: mean
Date: 2009-05-14 11:33:59 +0200 (Thu, 14 May 2009)
New Revision: 4825

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp
Log:
[VDPAU] Much better cpu usage and pic reordering

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h	2009-05-14 08:50:35 UTC (rev 4824)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h	2009-05-14 09:33:59 UTC (rev 4825)
@@ -372,6 +372,11 @@
                       {
                         return 0;
                       }
+     virtual uint8_t bFramePossible (void)
+      {
+        return 1;
+      }
+
 };
 
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp	2009-05-14 08:50:35 UTC (rev 4824)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp	2009-05-14 09:33:59 UTC (rev 4825)
@@ -7,7 +7,7 @@
         and have something working even if the target machine
         does not have vdpau
     Some part, especially get/buffer and ip_age borrowed from xbmc
-        as the api from ffmpeg is far from clean....
+        as the api from ffmpeg is far from clear....
 
 
  ***************************************************************************/
@@ -205,6 +205,8 @@
         _context->release_buffer  = ADM_VDPAUreleaseBuffer;
         _context->draw_horiz_band = draw;
         _context->slice_flags     = SLICE_FLAG_CODED_ORDER|SLICE_FLAG_ALLOW_FIELD;
+        _context->extradata = (uint8_t *) d;
+        _context->extradata_size = (int) l;
 
         vdpau=(void *)new vdpauContext;
         VDPAU->vdpDecoder=VDP_INVALID_HANDLE;
@@ -253,35 +255,17 @@
         printf("[VDPAU] No data from libavcodec\n");
         return 0;
     }
+    if(decode_status!=true)
+    {
+        printf("[VDPAU] error in renderDecode\n");
+        return 0;
+    }
     // other part will be done in goOn
-    out->Pts=vdpau_pts;
-    return (uint8_t)decode_status;
-}
-/**
-    \fn goOn
-    \brief Callback from ffmpeg when a pic is ready to be decoded
-*/
-void decoderFFVDPAU::goOn( const AVFrame *d)
-{
-   VdpStatus status;
-   struct vdpau_render_state *rndr = (struct vdpau_render_state *)d->data[0];
+  struct vdpau_render_state *rndr = (struct vdpau_render_state *)scratch->_planes[0];
    VdpVideoSurface  surface;
 
     surface=rndr->surface;
-    vdpau_pts=d->reordered_opaque; // Retrieve our PTS
-
-     aprintf("[VDPAU] Decoding Using surface %d\n", surface);
-    status=funcs.decoderRender(VDPAU->vdpDecoder, surface,
-                            (void * const *)&rndr->info, rndr->bitstream_buffers_used, rndr->bitstream_buffers);
-    if(VDP_STATUS_OK!=status)
-    {
-        printf("[VDPAU] No data after decoderRender <%s>\n",funcs.getErrorString(status));
-        return ;
-    }
-    aprintf("[VDPAU] DecodeRender Ok***\n");
-  
-  
-  void *planes[3];
+ void *planes[3];
             planes[0]=vdpau_copy->GetWritePtr(PLANAR_Y);
             planes[1]=vdpau_copy->GetWritePtr(PLANAR_U);
             planes[2]=vdpau_copy->GetWritePtr(PLANAR_V);
@@ -304,10 +288,37 @@
         
         printf("[VDPAU] Cannot get data from surface <%s>\n",funcs.getErrorString(status));
         decode_status=false;
+        return 0 ;
+    }
+    
+
+    //
+    out->Pts=scratch->Pts;
+    return (uint8_t)decode_status;
+}
+/**
+    \fn goOn
+    \brief Callback from ffmpeg when a pic is ready to be decoded
+*/
+void decoderFFVDPAU::goOn( const AVFrame *d)
+{
+   VdpStatus status;
+   struct vdpau_render_state *rndr = (struct vdpau_render_state *)d->data[0];
+   VdpVideoSurface  surface;
+
+    surface=rndr->surface;
+    vdpau_pts=d->reordered_opaque; // Retrieve our PTS
+
+     aprintf("[VDPAU] Decoding Using surface %d\n", surface);
+    status=funcs.decoderRender(VDPAU->vdpDecoder, surface,
+                            (void * const *)&rndr->info, rndr->bitstream_buffers_used, rndr->bitstream_buffers);
+    if(VDP_STATUS_OK!=status)
+    {
+        printf("[VDPAU] No data after decoderRender <%s>\n",funcs.getErrorString(status));
+        decode_status=false;
         return ;
     }
-    
-    aprintf("[VDPAU] Success\n");
+    aprintf("[VDPAU] DecodeRender Ok***\n");
     decode_status=true;
     return;
 }



From mean at mail.berlios.de  Thu May 14 20:49:45 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 14 May 2009 20:49:45 +0200
Subject: [Avidemux-svn-commit] r4826 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905141849.n4EInjOu016804@sheep.berlios.de>

Author: mean
Date: 2009-05-14 20:49:45 +0200 (Thu, 14 May 2009)
New Revision: 4826

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_ts.h
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsAudio.cpp
Log:
[TS demuxer] audio pid are 32 bits long not 8

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_ts.h
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_ts.h	2009-05-14 09:33:59 UTC (rev 4825)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_ts.h	2009-05-14 18:49:45 UTC (rev 4826)
@@ -61,14 +61,14 @@
 protected:
                 TS_PESpacket    *packet;
                 tsPacket        demuxer;
-                uint8_t         pid;
+                uint32_t         pid;
                 uint64_t        dtsOffset;
                 uint32_t        videoCodec;
                 
 public:
                 bool            setTimeOffset(uint64_t of) {dtsOffset=of;return true;}
                 vector          <ADM_tsAudioSeekPoint >seekPoints;
-                                  ADM_tsAccess(const char *name,uint8_t pid,bool append); 
+                                  ADM_tsAccess(const char *name,uint32_t pid,bool append); 
                 virtual           ~ADM_tsAccess();
                                     /// Hint, the stream is pure CBR (AC3,MP2,MP3)
                 virtual bool      isCBR(void) { return true;}

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsAudio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsAudio.cpp	2009-05-14 09:33:59 UTC (rev 4825)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsAudio.cpp	2009-05-14 18:49:45 UTC (rev 4826)
@@ -31,7 +31,7 @@
 /**
     \fn ADM_tsAccess
 */
-ADM_tsAccess::ADM_tsAccess(const char *name,uint8_t pid,bool append)
+ADM_tsAccess::ADM_tsAccess(const char *name,uint32_t pid,bool append)
 {
 FP_TYPE fp=FP_DONT_APPEND;
         if(append) fp=FP_APPEND;



From mean at mail.berlios.de  Fri May 15 10:42:38 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 15 May 2009 10:42:38 +0200
Subject: [Avidemux-svn-commit] r4827 - in
	branches/avidemux_2.6_branch_mean/avidemux: ADM_codecs
	ADM_libraries/ADM_ffmpeg/libavcodec
Message-ID: <200905150842.n4F8gcXh009615@sheep.berlios.de>

Author: mean
Date: 2009-05-15 10:42:37 +0200 (Fri, 15 May 2009)
New Revision: 4827

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/CMakeLists.txt
Log:
[VDPAU] Build nicely if vdpau is not there

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp	2009-05-14 18:49:45 UTC (rev 4826)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp	2009-05-15 08:42:37 UTC (rev 4827)
@@ -20,14 +20,15 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-
 extern "C" {
 #include "ADM_lavcodec.h"
+}
+#include "ADM_default.h"
+#ifdef USE_VDPAU
+extern "C" {
  #include "ADM_libraries/ADM_ffmpeg/libavcodec/vdpau.h"
 }
 
-#include "ADM_default.h"
-#ifdef USE_VDPAU
 #include "vdpau/vdpau_x11.h"
 #include "vdpau/vdpau.h"
 #include "ADM_codecs/ADM_codec.h"
@@ -335,4 +336,4 @@
 }
 
 #endif
-// EOF
\ No newline at end of file
+// EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/CMakeLists.txt	2009-05-14 18:49:45 UTC (rev 4826)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_ffmpeg/libavcodec/CMakeLists.txt	2009-05-15 08:42:37 UTC (rev 4827)
@@ -17,7 +17,6 @@
         avpacket.c
         flacdec.c
         flacdata.c
-        vdpau.c
         vp6dsp.c
         tscc.c  resample2.c    qdm2.c  bitstream_filter.c  eval.c  vc1.c
 	vc1dsp.c  vp56.c  vp6.c  vp5.c  indeo2.c  smacker.c  opt.c  fraps.c  dnxhddec.c
@@ -31,6 +30,10 @@
         celp_math.c options.c aandcttab.c audioconvert.c mpeg4audio.c svq1dec.c celp_filters.c
 	aac_parser.c  mpegaudiodecheader.c)
 
+if(USE_VDPAU)
+	SET(${ADM_LIB}_SRCS  ${${ADM_LIB}_SRCS} vdpau.c)
+endif(USE_VDPAU)
+
 IF(ADM_CPU_X86)
 	SET(${ADM_LIB}_SRCS  ${${ADM_LIB}_SRCS}
 		x86/cpuid.c  x86/mpegvideo_mmx.c  x86/vp3dsp_mmx.c  x86/dsputil_mmx.c



From mean at mail.berlios.de  Sat May 16 09:55:33 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 16 May 2009 09:55:33 +0200
Subject: [Avidemux-svn-commit] r4828 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs
Message-ID: <200905160755.n4G7tXm4004997@sheep.berlios.de>

Author: mean
Date: 2009-05-16 09:55:32 +0200 (Sat, 16 May 2009)
New Revision: 4828

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp
Log:
[VDPAU] Also set frame type

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h	2009-05-15 08:42:37 UTC (rev 4827)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h	2009-05-16 07:55:32 UTC (rev 4828)
@@ -362,7 +362,7 @@
 public:     // Callbacks
                     int     getBuffer(AVCodecContext *avctx, AVFrame *pic);
                     void    releaseBuffer(struct AVCodecContext *avctx, AVFrame *pic);
-                    void    goOn( const AVFrame *d);            
+                    void    goOn( const AVFrame *d,int type);            
 public:
             // public API
                     decoderFFVDPAU (uint32_t w, uint32_t h, uint32_t l, uint8_t * d);

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp	2009-05-15 08:42:37 UTC (rev 4827)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp	2009-05-16 07:55:32 UTC (rev 4828)
@@ -295,13 +295,14 @@
 
     //
     out->Pts=scratch->Pts;
+    out->flags=scratch->flags;
     return (uint8_t)decode_status;
 }
 /**
     \fn goOn
     \brief Callback from ffmpeg when a pic is ready to be decoded
 */
-void decoderFFVDPAU::goOn( const AVFrame *d)
+void decoderFFVDPAU::goOn( const AVFrame *d,int type)
 {
    VdpStatus status;
    struct vdpau_render_state *rndr = (struct vdpau_render_state *)d->data[0];
@@ -332,7 +333,7 @@
 void draw(struct AVCodecContext *s,    const AVFrame *src, int offset[4],    int y, int type, int height)
 {
     decoderFFVDPAU *dec=(decoderFFVDPAU *)s->opaque;
-    dec->goOn(src);
+    dec->goOn(src,type);
 }
 
 #endif



From mean at mail.berlios.de  Sat May 16 09:55:37 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 16 May 2009 09:55:37 +0200
Subject: [Avidemux-svn-commit] r4830 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905160755.n4G7tbco005018@sheep.berlios.de>

Author: mean
Date: 2009-05-16 09:55:36 +0200 (Sat, 16 May 2009)
New Revision: 4830

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsComputeTimeStamp.cpp
Log:
[Ts] dont recompute PTS/DTS, it does not work for h264

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsComputeTimeStamp.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsComputeTimeStamp.cpp	2009-05-16 07:55:35 UTC (rev 4829)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsComputeTimeStamp.cpp	2009-05-16 07:55:36 UTC (rev 4830)
@@ -119,6 +119,7 @@
         {
             dmxFrame *frame=ListOfFrames[i];
             aprintf("[psUpdate] frame:%d raw DTS: %"LLD" PTS:%"LLD"\n",i,frame->dts,frame->pts);
+#if 0
             if(frame->pts==ADM_NO_PTS || frame->dts==ADM_NO_PTS)
             {
                 noUpdate++;
@@ -146,11 +147,13 @@
                     frame->pts=ADM_NO_PTS;
                 }
             }else    // We got both, use them  
+#endif
             {
                 
                 frame->dts=lastDts=timeConvert(frame->dts);
                 frame->pts=lastPts=timeConvert(frame->pts);
             }
+
         }
         // convert to us for Audio tracks (seek points)
         for(int i=0;i<listOfAudioTracks.size();i++)



From mean at mail.berlios.de  Sat May 16 09:55:35 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 16 May 2009 09:55:35 +0200
Subject: [Avidemux-svn-commit] r4829 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905160755.n4G7tZIq005008@sheep.berlios.de>

Author: mean
Date: 2009-05-16 09:55:35 +0200 (Sat, 16 May 2009)
New Revision: 4829

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp
Log:
[TsIndexer] Fix shift by one frame DTS/PTS + take SEI as delimiter also

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp	2009-05-16 07:55:32 UTC (rev 4828)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp	2009-05-16 07:55:35 UTC (rev 4829)
@@ -90,6 +90,7 @@
     tsPacketLinear *pkt;
     int32_t        nextOffset;
     uint64_t beginPts,beginDts;
+    uint64_t prevPts,prevDts;
 }indexerData;
 
 typedef enum
@@ -207,6 +208,34 @@
     ui=NULL;
 }
 /**
+
+*/
+static uint32_t unescapeH264(uint32_t len,uint8_t *in, uint8_t *out)
+{
+  uint32_t outlen=0;
+  uint8_t *tail=in+len;
+    if(len<3) return 0;
+    while(in<tail-3)
+    {
+      if(!in[0]  && !in[1] && in[2]==3)
+      {
+        out[0]=0;
+        out[1]=0;
+        out+=2;
+        outlen+=2;
+        in+=3; 
+      }
+      *out++=*in++;
+      outlen++;
+    }
+    // copy last bytes
+    uint32_t left=tail-in;
+    memcpy(out,in,left);
+    outlen+=left;
+    return outlen;
+    
+}
+/**
     \fn runH264
     \brief Index H264 stream
 */  
@@ -311,11 +340,13 @@
                      
           switch(startCode)
                   {
+                  case NAL_SEI:
                   case NAL_AU_DELIMITER:
                           pic_started = false;
                           break;
 
                   case NAL_SPS:
+                            
                           pic_started = false;
                           aprintf("Sps \n");
                           pkt->getInfo(&info);
@@ -328,15 +359,23 @@
                   case NAL_NON_IDR:
                     {
 #define NON_IDR_PRE_READ 8
+                      uint8_t bufr[NON_IDR_PRE_READ+4];
                       uint8_t header[NON_IDR_PRE_READ+4];
                       GetBitContext s;
                    
-                        pkt->read(4,header);
+                        pkt->read(NON_IDR_PRE_READ,bufr);
+                        // unescape...
+                        unescapeH264(NON_IDR_PRE_READ,bufr,header);
+                        //
                         init_get_bits(&s, header, NON_IDR_PRE_READ*8);
                         int first_mb_in_slice,slice_type;
 
                         first_mb_in_slice= get_ue_golomb(&s);
                         slice_type= get_ue_golomb_31(&s);
+                        if(slice_type>9) 
+                        {
+                            printf("[TsIndexer] Bad slice type\n");
+                        }
                         if(slice_type>4) slice_type-=5;
                         switch(slice_type)
                         {
@@ -354,7 +393,7 @@
                       }else
                       {
                             pkt->getInfo(&info);
-                            Mark(&data,&info,5+4);
+                            Mark(&data,&info,5+NON_IDR_PRE_READ);
                        }
                       data.state=idx_startAtImage;
                       data.nbPics++;
@@ -551,11 +590,11 @@
         {
             int64_t deltaPts,deltaDts;
 
-            if(data->beginPts==-1 || info->pts==-1) deltaPts=-1;
-                else deltaPts=info->pts-data->beginPts;
+            if(data->beginPts==-1 || data->prevPts==-1) deltaPts=-1;
+                else deltaPts=data->prevPts-data->beginPts;
 
-            if(data->beginDts==-1 || info->dts==-1) deltaDts=-1;
-                else deltaDts=info->dts-data->beginDts;
+            if(data->beginDts==-1 || data->prevDts==-1) deltaDts=-1;
+                else deltaDts=data->prevDts-data->beginDts;
 
             qfprintf(index," %c:%06"LX":%"LLD":%"LLD,Type[currentFrameType],consumed-beginConsuming,
                                     deltaPts,deltaDts);
@@ -567,7 +606,7 @@
         }
             
         // If audio, also dump audio
-        if(data->frameType==1)
+        if(data->frameType==1 || data->frameType==4) // I or IDR
         {
             data->beginPts=info->pts;
             data->beginDts=info->dts;
@@ -589,7 +628,8 @@
             qfprintf(index,"\nVideo at:%08"LLX":%04"LX" Pts:%08"LLD":%08"LLD" ",info->startAt,info->offset-overRead,info->pts,info->dts);
         }
         currentFrameType=data->frameType;
-        
+        data->prevDts=info->dts;
+        data->prevPts=info->pts;
     return true;
 }
 



From mean at mail.berlios.de  Sat May 16 09:55:38 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 16 May 2009 09:55:38 +0200
Subject: [Avidemux-svn-commit] r4831 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_audioDevices/PulseAudioSimple
Message-ID: <200905160755.n4G7tcEe005029@sheep.berlios.de>

Author: mean
Date: 2009-05-16 09:55:38 +0200 (Sat, 16 May 2009)
New Revision: 4831

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_audioDevices/PulseAudioSimple/ADM_devicePulseSimple.cpp
Log:
[PulseAudio] Dont take lock too long

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_audioDevices/PulseAudioSimple/ADM_devicePulseSimple.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_audioDevices/PulseAudioSimple/ADM_devicePulseSimple.cpp	2009-05-16 07:55:36 UTC (rev 4830)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_audioDevices/PulseAudioSimple/ADM_devicePulseSimple.cpp	2009-05-16 07:55:38 UTC (rev 4831)
@@ -139,8 +139,9 @@
     uint32_t avail=wrIndex-rdIndex;
     if(!avail)
     {
+        mutex.unlock();
         pa_simple_write(INSTANCE,silence, sizeOf10ms,&er);
-        mutex.unlock();
+        
         return ;
     }
     if(avail>sizeOf10ms) avail=sizeOf10ms;



From mean at mail.berlios.de  Sat May 16 09:55:40 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 16 May 2009 09:55:40 +0200
Subject: [Avidemux-svn-commit] r4832 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_editor
Message-ID: <200905160755.n4G7te6f005041@sheep.berlios.de>

Author: mean
Date: 2009-05-16 09:55:39 +0200 (Sat, 16 May 2009)
New Revision: 4832

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edRender.cpp
Log:
[Composer] Silence

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edRender.cpp	2009-05-16 07:55:38 UTC (rev 4831)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edRender.cpp	2009-05-16 07:55:39 UTC (rev 4832)
@@ -259,15 +259,16 @@
         if(DecodeNextPicture(ref)==false)
         {
             printf("[AdmComposer::getPicture] Next picture failed\n");
+            continue;
         }
-        // Search the lowest PTS above our current DTS...
+        // Search the lowest PTS above our current PTS...
         ADMImage *img=cache->findJustAfter(vid->lastReadPts);
         if(img)
         {
             // Duplicate
             if(out)
             {
-                aprintf("[getNextPicture] Looking for after %"LU", got %"LU" delta=%u ms\n",vid->lastReadPts,img->Pts,(img->Pts-vid->lastReadPts)/1000);
+                aprintf("[getNextPicture] Looking for after> %"LLU", got %"LLU" delta=%"LD" ms\n",vid->lastReadPts,img->Pts,(img->Pts-vid->lastReadPts)/1000);
                 out->duplicate(img);
                 vid->lastReadPts=img->Pts;
                 currentFrame++;
@@ -275,7 +276,7 @@
             return true;
         }else   
         {
-            printf("[getNextPic] Loop:%d, looking for pts :%"LLU" ms %"LLU" us\n",loop,vid->lastReadPts/1000,vid->lastReadPts);
+            aprintf("[getNextPic] Loop:%d, looking for pts> :%"LLU" ms %"LLU" us\n",loop,vid->lastReadPts/1000,vid->lastReadPts);
 #ifdef VERBOSE
             cache->dump();
 #endif
@@ -344,17 +345,23 @@
       }
      cache->updateFrameNum(result,vid->lastSentFrame);
      uint64_t pts=result->Pts;
-
-    if(pts==ADM_COMPRESSED_NO_PTS) // No PTS available ?
-    {
-        vid->lastDecodedPts+=vid->timeIncrementInUs;
-        result->Pts=vid->lastDecodedPts;
-    }else
-        vid->lastDecodedPts=pts;
-    aprintf("Decoded frame %"LU" with pts=%"LLD" us, %"LLD" ms\n",
-            frame,
-            vid->lastDecodedPts,
-            vid->lastDecodedPts/1000);
+     uint64_t old=vid->lastDecodedPts;
+        if(pts==ADM_COMPRESSED_NO_PTS) // No PTS available ?
+        {
+                aprintf("[Editor] No PTS, guessing value\n");
+                vid->lastDecodedPts+=vid->timeIncrementInUs;
+                result->Pts=vid->lastDecodedPts;
+        }else
+           {
+                aprintf("[Editor] got PTS\n");
+                vid->lastDecodedPts=pts;
+            }
+    aprintf(">>Decoded frame %"LU" with pts=%"LLD" us, %"LLD" ms, ptsdelta=%"LLD" ms \n",
+    frame,
+    vid->lastDecodedPts,
+    vid->lastDecodedPts/1000,
+    (vid->lastDecodedPts-old)/1000);
+    if(old>vid->lastDecodedPts) printf(">>>>> PTS going backward by %"LLD" ms\n",(old-vid->lastDecodedPts)/1000);
     return true;
 }
 /**



From mean at mail.berlios.de  Sat May 16 10:18:54 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 16 May 2009 10:18:54 +0200
Subject: [Avidemux-svn-commit] r4833 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_audioDevices/Sdl
Message-ID: <200905160818.n4G8IsKr006487@sheep.berlios.de>

Author: mean
Date: 2009-05-16 10:18:54 +0200 (Sat, 16 May 2009)
New Revision: 4833

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_audioDevices/Sdl/CMakeLists.txt
Log:
[SDLaudio] Add coreAudioDevice so that it links on win32

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_audioDevices/Sdl/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_audioDevices/Sdl/CMakeLists.txt	2009-05-16 07:55:39 UTC (rev 4832)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_audioDevices/Sdl/CMakeLists.txt	2009-05-16 08:18:54 UTC (rev 4833)
@@ -4,7 +4,7 @@
 SET(ADM_av_sdl_SRCS ADM_deviceSDL.cpp)
 
 ADD_LIBRARY(ADM_av_sdl SHARED ${ADM_av_sdl_SRCS})
-TARGET_LINK_LIBRARIES(ADM_av_sdl ADM_core ADM_coreAudio ${SDL_LIBRARY})
+TARGET_LINK_LIBRARIES(ADM_av_sdl ADM_core ADM_coreAudio ADM_coreAudioDevice ${SDL_LIBRARY})
 SDLify(ADM_deviceSDL.cpp)
 
 INIT_AUDIO_DEVICE(ADM_av_sdl)



From mean at mail.berlios.de  Sat May 16 14:48:19 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 16 May 2009 14:48:19 +0200
Subject: [Avidemux-svn-commit] r4834 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905161248.n4GCmJE6006041@sheep.berlios.de>

Author: mean
Date: 2009-05-16 14:48:19 +0200 (Sat, 16 May 2009)
New Revision: 4834

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.h
Log:
[TsPacket] Remove un-needed var

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.h
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.h	2009-05-16 08:18:54 UTC (rev 4833)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.h	2009-05-16 12:48:19 UTC (rev 4834)
@@ -173,7 +173,7 @@
 class tsPacketLinearTracker : public tsPacketLinear
 {
 protected:
-        TS_PESpacket *pesPacket;
+        
         TS_PESpacket *otherPes;
         packetTSStats *stats;
         uint32_t      totalTracks;



From mean at mail.berlios.de  Sat May 16 14:48:21 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 16 May 2009 14:48:21 +0200
Subject: [Avidemux-svn-commit] r4835 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905161248.n4GCmLE0006051@sheep.berlios.de>

Author: mean
Date: 2009-05-16 14:48:21 +0200 (Sat, 16 May 2009)
New Revision: 4835

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp
Log:
[TsPacket] Fix shift by one read when DTS+PTA are set

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp	2009-05-16 12:48:19 UTC (rev 4834)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp	2009-05-16 12:48:21 UTC (rev 4835)
@@ -437,9 +437,9 @@
                                                 pes->pts=(pts1>>1)<<15;
                                                 pes->pts+=pts2>>1;
                                                 pes->pts+=(((pts0&6)>>1)<<30);
-                                                pts0=*start++;  
-                                                pts1=(start[0]<<8)+start[1]; 
-                                                pts2=(start[2]<<8)+start[3];       
+                                                pts0=start[0];  
+                                                pts1=(start[1]<<8)+start[2]; 
+                                                pts2=(start[3]<<8)+start[4];       
                                                 start+=5;
                                                 pes->dts=(pts1>>1)<<15;
                                                 pes->dts+=pts2>>1;
@@ -875,9 +875,9 @@
                                                 start+=5;
                                                                         
                                                 // Assume PTS=DTS
-                                                pts0=*start++;  
-                                                pts1=(start[0]<<8)+start[1]; 
-                                                pts2=(start[2]<<8)+start[3];       
+                                                pts0=start[0];  
+                                                pts1=(start[1]<<8)+start[2]; 
+                                                pts2=(start[3]<<8)+start[4];       
                                                 start+=5;
                                                 stats[found].startDts=(pts1>>1)<<15;
                                                 stats[found].startDts+=pts2>>1;



From mean at mail.berlios.de  Sat May 16 14:48:24 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 16 May 2009 14:48:24 +0200
Subject: [Avidemux-svn-commit] r4836 - in
	branches/avidemux_2.6_branch_mean/avidemux: .
	ADM_userInterfaces/ADM_GTK/ADM_gui2
	ADM_userInterfaces/ADM_GTK/glade/main
Message-ID: <200905161248.n4GCmORr006063@sheep.berlios.de>

Author: mean
Date: 2009-05-16 14:48:22 +0200 (Sat, 16 May 2009)
New Revision: 4836

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/glade/main/gtk2_build.glade
   branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/glade/main/gtk2_build.glade2
   branches/avidemux_2.6_branch_mean/avidemux/gtk_gui.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gui_action.names
Log:
[UI/Gtk] Add dump frame size in the tool menu

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h	2009-05-16 12:48:21 UTC (rev 4835)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h	2009-05-16 12:48:22 UTC (rev 4836)
@@ -9,6 +9,7 @@
 
 CALLBACK( connect_to_avsproxy1                  ,ACT_AVS_PROXY);
 CALLBACK( see_hex1                              ,ACT_HEX_DUMP);
+CALLBACK( see_size                              ,ACT_SIZE_DUMP);
 
 CALLBACK( close1                                ,ACT_CLOSE);
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/glade/main/gtk2_build.glade
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/glade/main/gtk2_build.glade	2009-05-16 12:48:21 UTC (rev 4835)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/glade/main/gtk2_build.glade	2009-05-16 12:48:22 UTC (rev 4836)
@@ -1,7 +1,7 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!DOCTYPE glade-interface SYSTEM "glade-2.0.dtd">
-<!--*- mode: xml -*-->
+<?xml version="1.0"?>
 <glade-interface>
+  <!-- interface-requires gtk+ 2.16 -->
+  <!-- interface-naming-policy toplevel-contextual -->
   <widget class="GtkWindow" id="mainWindow">
     <property name="visible">True</property>
     <property name="title" translatable="yes">Avidemux</property>
@@ -22,39 +22,28 @@
                   <widget class="GtkMenu" id="menuitem1_menu">
                     <child>
                       <widget class="GtkImageMenuItem" id="open_video1">
+                        <property name="label">_Open...</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">_Open...</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="O" modifiers="GDK_CONTROL_MASK" signal="activate"/>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8523">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-open</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
+                        <accelerator key="O" signal="activate" modifiers="GDK_CONTROL_MASK"/>
                       </widget>
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="append_video1">
+                        <property name="label">_Append...</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">_Append...</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="A" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK" signal="activate"/>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8524">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-add</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
+                        <accelerator key="A" signal="activate" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK"/>
                       </widget>
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="save_stuff">
+                        <property name="label">_Save</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">_Save</property>
                         <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
                         <child>
                           <widget class="GtkMenu" id="save_stuff_menu">
                             <child>
@@ -62,7 +51,7 @@
                                 <property name="visible">True</property>
                                 <property name="label" translatable="yes">Save _Video...</property>
                                 <property name="use_underline">True</property>
-                                <accelerator key="S" modifiers="GDK_CONTROL_MASK" signal="activate"/>
+                                <accelerator key="S" signal="activate" modifiers="GDK_CONTROL_MASK"/>
                               </widget>
                             </child>
                             <child>
@@ -93,19 +82,12 @@
                             </child>
                           </widget>
                         </child>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8525">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-save</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
                       </widget>
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="close1">
-                        <property name="visible">True</property>
                         <property name="label">gtk-close</property>
+                        <property name="visible">True</property>
                         <property name="use_underline">True</property>
                         <property name="use_stock">True</property>
                       </widget>
@@ -117,44 +99,26 @@
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="save_project1">
+                        <property name="label">Save _Project</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">Save _Project</property>
                         <property name="use_underline">True</property>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8526">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-save</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
                       </widget>
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="save_project_as1">
+                        <property name="label">Save P_roject As...</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">Save P_roject As...</property>
                         <property name="use_underline">True</property>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8527">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-save-as</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
                       </widget>
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="run_script1">
+                        <property name="label">_Load/Run Project...</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">_Load/Run Project...</property>
                         <property name="use_underline">True</property>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8528">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-execute</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
                       </widget>
                     </child>
                     <child>
@@ -169,7 +133,7 @@
                         <property name="visible">True</property>
                         <property name="label" translatable="yes">Show _Joblist</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="J" modifiers="GDK_CONTROL_MASK" signal="activate"/>
+                        <accelerator key="J" signal="activate" modifiers="GDK_CONTROL_MASK"/>
                       </widget>
                     </child>
                     <child>
@@ -191,17 +155,11 @@
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="video_informations1">
+                        <property name="label">Proper_ties</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">Proper_ties</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="Return" modifiers="GDK_MOD1_MASK" signal="activate"/>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8529">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-properties</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
+                        <accelerator key="Return" signal="activate" modifiers="GDK_MOD1_MASK"/>
                       </widget>
                     </child>
                     <child>
@@ -218,17 +176,11 @@
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="quit1">
+                        <property name="label">_Quit</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">_Quit</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="Q" modifiers="GDK_CONTROL_MASK" signal="activate"/>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8530">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-quit</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
+                        <accelerator key="Q" signal="activate" modifiers="GDK_CONTROL_MASK"/>
                       </widget>
                     </child>
                   </widget>
@@ -244,16 +196,10 @@
                   <widget class="GtkMenu" id="menuitem2_menu">
                     <child>
                       <widget class="GtkImageMenuItem" id="reset_edits1">
+                        <property name="label">_Reset Edits</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">_Reset Edits</property>
                         <property name="use_underline">True</property>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8531">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-undo</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
                       </widget>
                     </child>
                     <child>
@@ -263,62 +209,38 @@
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="cut1">
+                        <property name="label">Cu_t</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">Cu_t</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="X" modifiers="GDK_CONTROL_MASK" signal="activate"/>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8532">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-cut</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
+                        <accelerator key="X" signal="activate" modifiers="GDK_CONTROL_MASK"/>
                       </widget>
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="copy1">
+                        <property name="label">_Copy</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">_Copy</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="C" modifiers="GDK_CONTROL_MASK" signal="activate"/>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8533">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-copy</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
+                        <accelerator key="C" signal="activate" modifiers="GDK_CONTROL_MASK"/>
                       </widget>
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="paste1">
+                        <property name="label">_Paste</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">_Paste</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="V" modifiers="GDK_CONTROL_MASK" signal="activate"/>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8534">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-paste</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
+                        <accelerator key="V" signal="activate" modifiers="GDK_CONTROL_MASK"/>
                       </widget>
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="delete1">
+                        <property name="label">_Delete</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">_Delete</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="Delete" modifiers="" signal="activate"/>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8535">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-remove</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
+                        <accelerator key="Delete" signal="activate"/>
                       </widget>
                     </child>
                     <child>
@@ -331,7 +253,7 @@
                         <property name="visible">True</property>
                         <property name="label" translatable="yes">Set Marker _A</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="bracketleft" modifiers="" signal="activate"/>
+                        <accelerator key="bracketleft" signal="activate"/>
                       </widget>
                     </child>
                     <child>
@@ -339,7 +261,7 @@
                         <property name="visible">True</property>
                         <property name="label" translatable="yes">Set Marker _B</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="bracketright" modifiers="" signal="activate"/>
+                        <accelerator key="bracketright" signal="activate"/>
                       </widget>
                     </child>
                     <child>
@@ -349,16 +271,10 @@
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="preferences1">
+                        <property name="label">Pre_ferences</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">Pre_ferences</property>
                         <property name="use_underline">True</property>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8536">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-preferences</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
                       </widget>
                     </child>
                   </widget>
@@ -398,7 +314,7 @@
                         <property name="visible">True</property>
                         <property name="label" translatable="yes">_Zoom 1:4</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="4" modifiers="GDK_SHIFT_MASK | GDK_CONTROL_MASK" signal="activate"/>
+                        <accelerator key="4" signal="activate" modifiers="GDK_SHIFT_MASK | GDK_CONTROL_MASK"/>
                       </widget>
                     </child>
                     <child>
@@ -406,7 +322,7 @@
                         <property name="visible">True</property>
                         <property name="label" translatable="yes">Z_oom 1:2</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="2" modifiers="GDK_SHIFT_MASK | GDK_CONTROL_MASK" signal="activate"/>
+                        <accelerator key="2" signal="activate" modifiers="GDK_SHIFT_MASK | GDK_CONTROL_MASK"/>
                       </widget>
                     </child>
                     <child>
@@ -414,7 +330,7 @@
                         <property name="visible">True</property>
                         <property name="label" translatable="yes">Zoom _1:1</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="1" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK" signal="activate"/>
+                        <accelerator key="1" signal="activate" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK"/>
                       </widget>
                     </child>
                     <child>
@@ -422,7 +338,7 @@
                         <property name="visible">True</property>
                         <property name="label" translatable="yes">Zoom _2:1</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="2" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK" signal="activate"/>
+                        <accelerator key="2" signal="activate" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK"/>
                       </widget>
                     </child>
                   </widget>
@@ -441,7 +357,7 @@
                         <property name="visible">True</property>
                         <property name="label" translatable="yes">_Decoder Options</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="F3" modifiers="" signal="activate"/>
+                        <accelerator key="F3" signal="activate"/>
                       </widget>
                     </child>
                     <child>
@@ -450,7 +366,7 @@
                         <property name="tooltip" translatable="yes">Select postprocessing level</property>
                         <property name="label" translatable="yes">_Postprocessing</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="F4" modifiers="" signal="activate"/>
+                        <accelerator key="F4" signal="activate"/>
                       </widget>
                     </child>
                     <child>
@@ -463,7 +379,7 @@
                         <property name="visible">True</property>
                         <property name="label" translatable="yes">P_review</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="F5" modifiers="" signal="activate"/>
+                        <accelerator key="F5" signal="activate"/>
                       </widget>
                     </child>
                     <child>
@@ -471,7 +387,7 @@
                         <property name="visible">True</property>
                         <property name="label" translatable="yes">Display _Output</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="F6" modifiers="" signal="activate"/>
+                        <accelerator key="F6" signal="activate"/>
                       </widget>
                     </child>
                     <child>
@@ -491,7 +407,7 @@
                         <property name="visible">True</property>
                         <property name="label" translatable="yes">_Encoder</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="V" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK" signal="activate"/>
+                        <accelerator key="V" signal="activate" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK"/>
                       </widget>
                     </child>
                     <child>
@@ -499,7 +415,7 @@
                         <property name="visible">True</property>
                         <property name="label" translatable="yes">Fil_ters</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="F" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK" signal="activate"/>
+                        <accelerator key="F" signal="activate" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK"/>
                       </widget>
                     </child>
                   </widget>
@@ -541,17 +457,11 @@
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="save_audio1">
+                        <property name="label">S_ave...</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">S_ave...</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="S" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK" signal="activate"/>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8537">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-save-as</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
+                        <accelerator key="S" signal="activate" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK"/>
                       </widget>
                     </child>
                     <child>
@@ -559,7 +469,7 @@
                         <property name="visible">True</property>
                         <property name="label" translatable="yes">_Encoder</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="A" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK" signal="activate"/>
+                        <accelerator key="A" signal="activate" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK"/>
                       </widget>
                     </child>
                     <child>
@@ -582,16 +492,11 @@
                   <widget class="GtkMenu" id="tools1_menu">
                     <child>
                       <widget class="GtkImageMenuItem" id="calculator1">
+                        <property name="label">_Calculator</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">_Calculator</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="F7" modifiers="" signal="activate"/>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8538">
-                            <property name="visible">True</property>
-                            <property name="pixbuf">gnome-calculator_small.xpm</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
+                        <accelerator key="F7" signal="activate"/>
                       </widget>
                     </child>
                     <child>
@@ -672,6 +577,13 @@
                         <property name="use_underline">True</property>
                       </widget>
                     </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="see_size">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">Frame Size Dump</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
                   </widget>
                 </child>
               </widget>
@@ -745,77 +657,47 @@
                   <widget class="GtkMenu" id="go1_menu">
                     <child>
                       <widget class="GtkImageMenuItem" id="play_video1">
+                        <property name="label">_Play/Stop</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">_Play/Stop</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="P" modifiers="" signal="activate"/>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8539">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-media-play</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
+                        <accelerator key="P" signal="activate"/>
                       </widget>
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="previous_frame1">
+                        <property name="label">P_revious Frame</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">P_revious Frame</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="KP_4" modifiers="" signal="activate"/>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8540">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-media-previous</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
+                        <accelerator key="KP_4" signal="activate"/>
                       </widget>
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="next_frame1">
+                        <property name="label">_Next Frame</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">_Next Frame</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="KP_6" modifiers="" signal="activate"/>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8541">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-media-next</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
+                        <accelerator key="KP_6" signal="activate"/>
                       </widget>
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="previous_intra_frame1">
+                        <property name="label">Pr_evious Intra Frame</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">Pr_evious Intra Frame</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="KP_2" modifiers="" signal="activate"/>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8542">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-media-rewind</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
+                        <accelerator key="KP_2" signal="activate"/>
                       </widget>
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="next_intra_frame1">
+                        <property name="label">Next _Intra Frame</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">Next _Intra Frame</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="KP_8" modifiers="" signal="activate"/>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8543">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-media-forward</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
+                        <accelerator key="KP_8" signal="activate"/>
                       </widget>
                     </child>
                     <child>
@@ -834,32 +716,20 @@
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="first_frame1">
+                        <property name="label">_First Frame</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">_First Frame</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="Home" modifiers="" signal="activate"/>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8544">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-goto-first</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
+                        <accelerator key="Home" signal="activate"/>
                       </widget>
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="last_frame1">
+                        <property name="label">_Last Frame</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">_Last Frame</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="End" modifiers="" signal="activate"/>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8545">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-goto-last</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
+                        <accelerator key="End" signal="activate"/>
                       </widget>
                     </child>
                     <child>
@@ -872,7 +742,7 @@
                         <property name="visible">True</property>
                         <property name="label" translatable="yes">Go to Marker _A</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="bracketleft" modifiers="GDK_CONTROL_MASK" signal="activate"/>
+                        <accelerator key="bracketleft" signal="activate" modifiers="GDK_CONTROL_MASK"/>
                       </widget>
                     </child>
                     <child>
@@ -880,7 +750,7 @@
                         <property name="visible">True</property>
                         <property name="label" translatable="yes">Go to Marker _B</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="bracketright" modifiers="GDK_CONTROL_MASK" signal="activate"/>
+                        <accelerator key="bracketright" signal="activate" modifiers="GDK_CONTROL_MASK"/>
                       </widget>
                     </child>
                     <child>
@@ -890,32 +760,20 @@
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="jum_to_frame1">
+                        <property name="label">Go to Fra_me...</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">Go to Fra_me...</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="F" modifiers="GDK_CONTROL_MASK" signal="activate"/>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8546">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-jump-to</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
+                        <accelerator key="F" signal="activate" modifiers="GDK_CONTROL_MASK"/>
                       </widget>
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="jump_to_time1">
+                        <property name="label">Go to _Time...</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">Go to _Time...</property>
                         <property name="use_underline">True</property>
-                        <accelerator key="T" modifiers="GDK_CONTROL_MASK" signal="activate"/>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8547">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-jump-to</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
+                        <accelerator key="T" signal="activate" modifiers="GDK_CONTROL_MASK"/>
                       </widget>
                     </child>
                   </widget>
@@ -953,16 +811,10 @@
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="about1">
+                        <property name="label">_About</property>
                         <property name="visible">True</property>
-                        <property name="label" translatable="yes">_About</property>
                         <property name="use_underline">True</property>
-                        <child internal-child="image">
-                          <widget class="GtkImage" id="image8548">
-                            <property name="visible">True</property>
-                            <property name="stock">gtk-about</property>
-                            <property name="icon_size">1</property>
-                          </widget>
-                        </child>
+                        <property name="use_stock">True</property>
                       </widget>
                     </child>
                   </widget>
@@ -973,12 +825,13 @@
           <packing>
             <property name="expand">False</property>
             <property name="fill">False</property>
+            <property name="position">0</property>
           </packing>
         </child>
         <child>
           <widget class="GtkToolbar" id="toolbar2">
             <property name="visible">True</property>
-            <property name="toolbar_style">GTK_TOOLBAR_BOTH_HORIZ</property>
+            <property name="toolbar_style">both-horiz</property>
             <child>
               <widget class="GtkMenuToolButton" id="menutoolbuttonOpen">
                 <property name="visible">True</property>
@@ -988,7 +841,6 @@
               </widget>
               <packing>
                 <property name="expand">False</property>
-                <property name="homogeneous">False</property>
               </packing>
             </child>
             <child>
@@ -997,7 +849,6 @@
               </widget>
               <packing>
                 <property name="expand">False</property>
-                <property name="homogeneous">False</property>
               </packing>
             </child>
             <child>
@@ -1009,6 +860,7 @@
               </widget>
               <packing>
                 <property name="expand">False</property>
+                <property name="homogeneous">True</property>
               </packing>
             </child>
             <child>
@@ -1019,6 +871,7 @@
               </widget>
               <packing>
                 <property name="expand">False</property>
+                <property name="homogeneous">True</property>
               </packing>
             </child>
             <child>
@@ -1027,7 +880,6 @@
               </widget>
               <packing>
                 <property name="expand">False</property>
-                <property name="homogeneous">False</property>
               </packing>
             </child>
             <child>
@@ -1041,6 +893,7 @@
               </widget>
               <packing>
                 <property name="expand">False</property>
+                <property name="homogeneous">True</property>
               </packing>
             </child>
             <child>
@@ -1049,7 +902,6 @@
               </widget>
               <packing>
                 <property name="expand">False</property>
-                <property name="homogeneous">False</property>
               </packing>
             </child>
             <child>
@@ -1064,7 +916,6 @@
               </widget>
               <packing>
                 <property name="expand">False</property>
-                <property name="homogeneous">False</property>
               </packing>
             </child>
             <child>
@@ -1074,8 +925,8 @@
                   <widget class="GtkToggleButton" id="togglebutton1">
                     <property name="visible">True</property>
                     <property name="can_focus">True</property>
-                    <property name="relief">GTK_RELIEF_NONE</property>
-                    <property name="response_id">0</property>
+                    <property name="receives_default">False</property>
+                    <property name="relief">none</property>
                     <child>
                       <widget class="GtkImage" id="image8272">
                         <property name="width_request">17</property>
@@ -1089,7 +940,6 @@
               </widget>
               <packing>
                 <property name="expand">False</property>
-                <property name="homogeneous">False</property>
               </packing>
             </child>
             <child>
@@ -1108,7 +958,6 @@
               </widget>
               <packing>
                 <property name="expand">False</property>
-                <property name="homogeneous">False</property>
               </packing>
             </child>
           </widget>
@@ -1147,6 +996,7 @@
                               <packing>
                                 <property name="expand">False</property>
                                 <property name="fill">False</property>
+                                <property name="position">0</property>
                               </packing>
                             </child>
                             <child>
@@ -1166,17 +1016,18 @@
                                       <packing>
                                         <property name="expand">False</property>
                                         <property name="fill">False</property>
+                                        <property name="position">0</property>
                                       </packing>
                                     </child>
                                     <child>
                                       <widget class="GtkButton" id="buttonConfV">
+                                        <property name="label" translatable="yes">Configure</property>
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
+                                        <property name="receives_default">False</property>
                                         <property name="tooltip" translatable="yes">Configure video encoder</property>
-                                        <property name="label" translatable="yes">Configure</property>
                                         <property name="use_underline">True</property>
-                                        <property name="response_id">0</property>
-                                        <accelerator key="F3" modifiers="" signal="clicked"/>
+                                        <accelerator key="F3" signal="clicked"/>
                                       </widget>
                                       <packing>
                                         <property name="expand">False</property>
@@ -1186,13 +1037,13 @@
                                     </child>
                                     <child>
                                       <widget class="GtkButton" id="buttonFilters">
+                                        <property name="label" translatable="yes">Filters</property>
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
+                                        <property name="receives_default">False</property>
                                         <property name="tooltip" translatable="yes">Video filters</property>
-                                        <property name="label" translatable="yes">Filters</property>
                                         <property name="use_underline">True</property>
-                                        <property name="response_id">0</property>
-                                        <accelerator key="F1" modifiers="" signal="clicked"/>
+                                        <accelerator key="F1" signal="clicked"/>
                                       </widget>
                                       <packing>
                                         <property name="expand">False</property>
@@ -1211,6 +1062,7 @@
                           <packing>
                             <property name="expand">False</property>
                             <property name="fill">False</property>
+                            <property name="position">0</property>
                           </packing>
                         </child>
                         <child>
@@ -1226,6 +1078,7 @@
                               <packing>
                                 <property name="expand">False</property>
                                 <property name="fill">False</property>
+                                <property name="position">0</property>
                               </packing>
                             </child>
                             <child>
@@ -1245,17 +1098,18 @@
                                       <packing>
                                         <property name="expand">False</property>
                                         <property name="fill">False</property>
+                                        <property name="position">0</property>
                                       </packing>
                                     </child>
                                     <child>
                                       <widget class="GtkButton" id="buttonConfA">
+                                        <property name="label" translatable="yes">Configure</property>
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
+                                        <property name="receives_default">False</property>
                                         <property name="tooltip" translatable="yes">Configure audio encoder</property>
-                                        <property name="label" translatable="yes">Configure</property>
                                         <property name="use_underline">True</property>
-                                        <property name="response_id">0</property>
-                                        <accelerator key="F4" modifiers="" signal="clicked"/>
+                                        <accelerator key="F4" signal="clicked"/>
                                       </widget>
                                       <packing>
                                         <property name="expand">False</property>
@@ -1267,9 +1121,9 @@
                                       <widget class="GtkButton" id="buttonAudioFilter">
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
+                                        <property name="receives_default">False</property>
                                         <property name="tooltip" translatable="yes">Audio filters</property>
-                                        <property name="response_id">0</property>
-                                        <accelerator key="F2" modifiers="" signal="clicked"/>
+                                        <accelerator key="F2" signal="clicked"/>
                                         <child>
                                           <widget class="GtkAlignment" id="alignment16">
                                             <property name="visible">True</property>
@@ -1288,6 +1142,7 @@
                                                   <packing>
                                                     <property name="expand">False</property>
                                                     <property name="fill">False</property>
+                                                    <property name="position">0</property>
                                                   </packing>
                                                 </child>
                                               </widget>
@@ -1307,17 +1162,18 @@
                                         <property name="spacing">6</property>
                                         <child>
                                           <widget class="GtkCheckButton" id="CheckButtonTimeshift">
+                                            <property name="label" translatable="yes">Shift:</property>
                                             <property name="visible">True</property>
                                             <property name="can_focus">True</property>
+                                            <property name="receives_default">False</property>
                                             <property name="tooltip" translatable="yes">Enable time shift</property>
-                                            <property name="label" translatable="yes">Shift:</property>
                                             <property name="use_underline">True</property>
-                                            <property name="response_id">0</property>
                                             <property name="draw_indicator">True</property>
                                           </widget>
                                           <packing>
                                             <property name="expand">False</property>
                                             <property name="fill">False</property>
+                                            <property name="position">0</property>
                                           </packing>
                                         </child>
                                         <child>
@@ -1365,6 +1221,7 @@
                               <packing>
                                 <property name="expand">False</property>
                                 <property name="fill">False</property>
+                                <property name="position">0</property>
                               </packing>
                             </child>
                             <child>
@@ -1384,17 +1241,18 @@
                                       <packing>
                                         <property name="expand">False</property>
                                         <property name="fill">False</property>
+                                        <property name="position">0</property>
                                       </packing>
                                     </child>
                                     <child>
                                       <widget class="GtkButton" id="buttonConfF">
+                                        <property name="label" translatable="yes">Configure</property>
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
+                                        <property name="receives_default">False</property>
                                         <property name="tooltip" translatable="yes">Configure video encoder</property>
-                                        <property name="label" translatable="yes">Configure</property>
                                         <property name="use_underline">True</property>
-                                        <property name="response_id">0</property>
-                                        <accelerator key="F3" modifiers="" signal="clicked"/>
+                                        <accelerator key="F3" signal="clicked"/>
                                       </widget>
                                       <packing>
                                         <property name="expand">False</property>
@@ -1422,6 +1280,7 @@
                   <packing>
                     <property name="expand">False</property>
                     <property name="fill">False</property>
+                    <property name="position">0</property>
                   </packing>
                 </child>
                 <child>
@@ -1436,6 +1295,9 @@
                   </packing>
                 </child>
               </widget>
+              <packing>
+                <property name="position">0</property>
+              </packing>
             </child>
             <child>
               <widget class="GtkTable" id="table2">
@@ -1469,6 +1331,7 @@
                       <packing>
                         <property name="expand">False</property>
                         <property name="fill">False</property>
+                        <property name="position">0</property>
                       </packing>
                     </child>
                     <child>
@@ -1515,12 +1378,13 @@
                             </child>
                             <child>
                               <widget class="GtkButton" id="buttonGotoA">
+                                <property name="label" translatable="yes">A:</property>
                                 <property name="height_request">20</property>
                                 <property name="visible">True</property>
+                                <property name="can_focus">False</property>
+                                <property name="receives_default">False</property>
                                 <property name="tooltip" translatable="yes">Go to marker A</property>
-                                <property name="label" translatable="yes">A:</property>
                                 <property name="use_underline">True</property>
-                                <property name="response_id">0</property>
                               </widget>
                               <packing>
                                 <property name="x_options"></property>
@@ -1529,12 +1393,13 @@
                             </child>
                             <child>
                               <widget class="GtkButton" id="buttonGotoB">
+                                <property name="label" translatable="yes">B:</property>
                                 <property name="height_request">20</property>
                                 <property name="visible">True</property>
+                                <property name="can_focus">False</property>
+                                <property name="receives_default">False</property>
                                 <property name="tooltip" translatable="yes">Go to marker B</property>
-                                <property name="label" translatable="yes">B:</property>
                                 <property name="use_underline">True</property>
-                                <property name="response_id">0</property>
                               </widget>
                               <packing>
                                 <property name="top_attach">1</property>
@@ -1566,11 +1431,12 @@
                     <child>
                       <widget class="GtkButton" id="buttonPlay">
                         <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="receives_default">False</property>
                         <property name="tooltip" translatable="yes">Play</property>
-                        <property name="relief">GTK_RELIEF_NONE</property>
+                        <property name="relief">none</property>
                         <property name="focus_on_click">False</property>
-                        <property name="response_id">0</property>
-                        <accelerator key="space" modifiers="" signal="clicked"/>
+                        <accelerator key="space" signal="clicked"/>
                         <child>
                           <widget class="GtkImage" id="image591">
                             <property name="visible">True</property>
@@ -1581,16 +1447,17 @@
                       <packing>
                         <property name="expand">False</property>
                         <property name="fill">False</property>
+                        <property name="position">0</property>
                       </packing>
                     </child>
                     <child>
                       <widget class="GtkButton" id="buttonStop">
                         <property name="visible">True</property>
                         <property name="can_focus">True</property>
+                        <property name="receives_default">False</property>
                         <property name="tooltip" translatable="yes">Stop</property>
-                        <property name="relief">GTK_RELIEF_NONE</property>
+                        <property name="relief">none</property>
                         <property name="focus_on_click">False</property>
-                        <property name="response_id">0</property>
                         <child>
                           <widget class="GtkImage" id="image5056">
                             <property name="visible">True</property>
@@ -1607,11 +1474,12 @@
                     <child>
                       <widget class="GtkButton" id="buttonPrevFrame">
                         <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="receives_default">False</property>
                         <property name="tooltip" translatable="yes">Previous frame</property>
-                        <property name="relief">GTK_RELIEF_NONE</property>
+                        <property name="relief">none</property>
                         <property name="focus_on_click">False</property>
-                        <property name="response_id">0</property>
-                        <accelerator key="KP_4" modifiers="" signal="clicked"/>
+                        <accelerator key="KP_4" signal="clicked"/>
                         <child>
                           <widget class="GtkImage" id="image593">
                             <property name="visible">True</property>
@@ -1628,11 +1496,12 @@
                     <child>
                       <widget class="GtkButton" id="buttonNextFrame">
                         <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="receives_default">False</property>
                         <property name="tooltip" translatable="yes">Next frame</property>
-                        <property name="relief">GTK_RELIEF_NONE</property>
+                        <property name="relief">none</property>
                         <property name="focus_on_click">False</property>
-                        <property name="response_id">0</property>
-                        <accelerator key="KP_6" modifiers="" signal="clicked"/>
+                        <accelerator key="KP_6" signal="clicked"/>
                         <child>
                           <widget class="GtkImage" id="image594">
                             <property name="visible">True</property>
@@ -1649,11 +1518,12 @@
                     <child>
                       <widget class="GtkButton" id="buttonPrevKFrame">
                         <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="receives_default">False</property>
                         <property name="tooltip" translatable="yes">Previous keyframe</property>
-                        <property name="relief">GTK_RELIEF_NONE</property>
+                        <property name="relief">none</property>
                         <property name="focus_on_click">False</property>
-                        <property name="response_id">0</property>
-                        <accelerator key="KP_2" modifiers="" signal="clicked"/>
+                        <accelerator key="KP_2" signal="clicked"/>
                         <child>
                           <widget class="GtkImage" id="image595">
                             <property name="visible">True</property>
@@ -1670,11 +1540,12 @@
                     <child>
                       <widget class="GtkButton" id="buttonNextKFrame">
                         <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="receives_default">False</property>
                         <property name="tooltip" translatable="yes">Next keyframe</property>
-                        <property name="relief">GTK_RELIEF_NONE</property>
+                        <property name="relief">none</property>
                         <property name="focus_on_click">False</property>
-                        <property name="response_id">0</property>
-                        <accelerator key="KP_8" modifiers="" signal="clicked"/>
+                        <accelerator key="KP_8" signal="clicked"/>
                         <child>
                           <widget class="GtkImage" id="image596">
                             <property name="visible">True</property>
@@ -1692,10 +1563,10 @@
                       <widget class="GtkButton" id="buttonMarkA">
                         <property name="visible">True</property>
                         <property name="can_focus">True</property>
+                        <property name="receives_default">False</property>
                         <property name="tooltip" translatable="yes">Selection: start</property>
-                        <property name="relief">GTK_RELIEF_NONE</property>
+                        <property name="relief">none</property>
                         <property name="focus_on_click">False</property>
-                        <property name="response_id">0</property>
                         <child>
                           <widget class="GtkImage" id="image2306">
                             <property name="visible">True</property>
@@ -1713,10 +1584,10 @@
                       <widget class="GtkButton" id="buttonMarkB">
                         <property name="visible">True</property>
                         <property name="can_focus">True</property>
+                        <property name="receives_default">False</property>
                         <property name="tooltip" translatable="yes">Selection: end</property>
-                        <property name="relief">GTK_RELIEF_NONE</property>
+                        <property name="relief">none</property>
                         <property name="focus_on_click">False</property>
-                        <property name="response_id">0</property>
                         <child>
                           <widget class="GtkImage" id="image2307">
                             <property name="visible">True</property>
@@ -1734,10 +1605,10 @@
                       <widget class="GtkButton" id="buttonPrevBlack">
                         <property name="visible">True</property>
                         <property name="can_focus">True</property>
+                        <property name="receives_default">False</property>
                         <property name="tooltip" translatable="yes">Previous black frame</property>
-                        <property name="relief">GTK_RELIEF_NONE</property>
+                        <property name="relief">none</property>
                         <property name="focus_on_click">False</property>
-                        <property name="response_id">0</property>
                         <child>
                           <widget class="GtkImage" id="image2308">
                             <property name="visible">True</property>
@@ -1755,10 +1626,10 @@
                       <widget class="GtkButton" id="buttonNextBlack">
                         <property name="visible">True</property>
                         <property name="can_focus">True</property>
+                        <property name="receives_default">False</property>
                         <property name="tooltip" translatable="yes">Next black frame</property>
-                        <property name="relief">GTK_RELIEF_NONE</property>
+                        <property name="relief">none</property>
                         <property name="focus_on_click">False</property>
-                        <property name="response_id">0</property>
                         <child>
                           <widget class="GtkImage" id="image2309">
                             <property name="visible">True</property>
@@ -1776,10 +1647,10 @@
                       <widget class="GtkButton" id="buttonBegin">
                         <property name="visible">True</property>
                         <property name="can_focus">True</property>
+                        <property name="receives_default">False</property>
                         <property name="tooltip" translatable="yes">First frame</property>
-                        <property name="relief">GTK_RELIEF_NONE</property>
+                        <property name="relief">none</property>
                         <property name="focus_on_click">False</property>
-                        <property name="response_id">0</property>
                         <child>
                           <widget class="GtkImage" id="image5057">
                             <property name="visible">True</property>
@@ -1797,10 +1668,10 @@
                       <widget class="GtkButton" id="buttonEnd">
                         <property name="visible">True</property>
                         <property name="can_focus">True</property>
+                        <property name="receives_default">False</property>
                         <property name="tooltip" translatable="yes">Last frame</property>
-                        <property name="relief">GTK_RELIEF_NONE</property>
+                        <property name="relief">none</property>
                         <property name="focus_on_click">False</property>
-                        <property name="response_id">0</property>
                         <child>
                           <widget class="GtkImage" id="image2245">
                             <property name="visible">True</property>
@@ -1824,7 +1695,7 @@
                   <widget class="GtkHScale" id="sliderNavigate">
                     <property name="visible">True</property>
                     <property name="adjustment">0 0 99.989997863799999 0.0099999997764800008 1 0</property>
-                    <property name="value_pos">GTK_POS_LEFT</property>
+                    <property name="value_pos">left</property>
                   </widget>
                 </child>
                 <child>
@@ -1839,6 +1710,7 @@
                       <packing>
                         <property name="expand">False</property>
                         <property name="fill">False</property>
+                        <property name="position">0</property>
                       </packing>
                     </child>
                     <child>
@@ -1847,7 +1719,6 @@
                         <property name="can_focus">True</property>
                         <property name="tooltip" translatable="yes">Current frame</property>
                         <property name="max_length">8</property>
-                        <property name="invisible_char">*</property>
                         <property name="width_chars">8</property>
                         <property name="text" translatable="yes">0</property>
                       </widget>
@@ -1887,7 +1758,6 @@
                         <property name="visible">True</property>
                         <property name="can_focus">True</property>
                         <property name="tooltip" translatable="yes">Current time</property>
-                        <property name="invisible_char">*</property>
                         <property name="width_chars">13</property>
                         <property name="text" translatable="yes">00:00:00.000</property>
                       </widget>

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/glade/main/gtk2_build.glade2
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/glade/main/gtk2_build.glade2	2009-05-16 12:48:21 UTC (rev 4835)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/glade/main/gtk2_build.glade2	2009-05-16 12:48:22 UTC (rev 4836)
@@ -1,2625 +1,1776 @@
-<?xml version="1.0" standalone="no"?> <!--*- mode: xml -*-->
-<!DOCTYPE glade-interface SYSTEM "http://glade.gnome.org/glade-2.0.dtd">
-
+<?xml version="1.0"?>
 <glade-interface>
-
-<widget class="GtkWindow" id="mainWindow">
-  <property name="visible">True</property>
-  <property name="title" translatable="yes">Avidemux</property>
-  <property name="type">GTK_WINDOW_TOPLEVEL</property>
-  <property name="window_position">GTK_WIN_POS_NONE</property>
-  <property name="modal">False</property>
-  <property name="resizable">True</property>
-  <property name="destroy_with_parent">False</property>
-  <property name="icon">avidemux_icon_small.png</property>
-  <property name="decorated">True</property>
-  <property name="skip_taskbar_hint">False</property>
-  <property name="skip_pager_hint">False</property>
-  <property name="type_hint">GDK_WINDOW_TYPE_HINT_NORMAL</property>
-  <property name="gravity">GDK_GRAVITY_NORTH_WEST</property>
-  <property name="focus_on_map">True</property>
-  <property name="urgency_hint">False</property>
-
-  <child>
-    <widget class="GtkVBox" id="vbox1">
-      <property name="visible">True</property>
-      <property name="homogeneous">False</property>
-      <property name="spacing">0</property>
-
-      <child>
-	<widget class="GtkMenuBar" id="menuBar">
-	  <property name="visible">True</property>
-	  <property name="can_focus">True</property>
-	  <property name="pack_direction">GTK_PACK_DIRECTION_LTR</property>
-	  <property name="child_pack_direction">GTK_PACK_DIRECTION_LTR</property>
-
-	  <child>
-	    <widget class="GtkMenuItem" id="menuitem1">
-	      <property name="visible">True</property>
-	      <property name="label" translatable="yes">_File</property>
-	      <property name="use_underline">True</property>
-
-	      <child>
-		<widget class="GtkMenu" id="menuitem1_menu">
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="open_video1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Open...</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="O" modifiers="GDK_CONTROL_MASK" signal="activate"/>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8448">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-open</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="append_video1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Append...</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="A" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK" signal="activate"/>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8449">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-add</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="save_stuff">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Save</property>
-		      <property name="use_underline">True</property>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8450">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-save</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-
-		      <child>
-			<widget class="GtkMenu" id="save_stuff_menu">
-
-			  <child>
-			    <widget class="GtkMenuItem" id="save_as_avi1">
-			      <property name="visible">True</property>
-			      <property name="label" translatable="yes">Save _Video...</property>
-			      <property name="use_underline">True</property>
-			      <accelerator key="S" modifiers="GDK_CONTROL_MASK" signal="activate"/>
-			    </widget>
-			  </child>
-
-			  <child>
-			    <widget class="GtkSeparatorMenuItem" id="separator1">
-			      <property name="visible">True</property>
-			    </widget>
-			  </child>
-
-			  <child>
-			    <widget class="GtkMenuItem" id="save_image1">
-			      <property name="visible">True</property>
-			      <property name="label" translatable="yes">Save _BMP Image...</property>
-			      <property name="use_underline">True</property>
-			    </widget>
-			  </child>
-
-			  <child>
-			    <widget class="GtkMenuItem" id="save_jpg_image1">
-			      <property name="visible">True</property>
-			      <property name="label" translatable="yes">Save _JPEG Image...</property>
-			      <property name="use_underline">True</property>
-			    </widget>
-			  </child>
-
-			  <child>
-			    <widget class="GtkMenuItem" id="save_selection_as_jpegs1">
-			      <property name="visible">True</property>
-			      <property name="label" translatable="yes">Save _Selection as JPEG Images...</property>
-			      <property name="use_underline">True</property>
-			    </widget>
-			  </child>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="close1">
-		      <property name="visible">True</property>
-		      <property name="label">gtk-close</property>
-		      <property name="use_stock">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkSeparatorMenuItem" id="separator3">
-		      <property name="visible">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="save_project1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Save _Project</property>
-		      <property name="use_underline">True</property>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8451">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-save</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="save_project_as1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Save P_roject As...</property>
-		      <property name="use_underline">True</property>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8452">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-save-as</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="run_script1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Load/Run Project...</property>
-		      <property name="use_underline">True</property>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8453">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-execute</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="add_to_joblist1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">A_dd to Joblist...</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="joblist1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Show _Joblist</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="J" modifiers="GDK_CONTROL_MASK" signal="activate"/>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkSeparatorMenuItem" id="separator16">
-		      <property name="visible">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="connect_to_avsproxy1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Co_nnect to avsproxy</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkSeparatorMenuItem" id="separator18">
-		      <property name="visible">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="video_informations1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Proper_ties</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="Return" modifiers="GDK_MOD1_MASK" signal="activate"/>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8454">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-properties</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="avi_muxer_options1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">AVI _Muxer Options</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkSeparatorMenuItem" id="separator4">
-		      <property name="visible">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="quit1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Quit</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="Q" modifiers="GDK_CONTROL_MASK" signal="activate"/>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8455">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-quit</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-		</widget>
-	      </child>
-	    </widget>
-	  </child>
-
-	  <child>
-	    <widget class="GtkMenuItem" id="menuitem2">
-	      <property name="visible">True</property>
-	      <property name="label" translatable="yes">_Edit</property>
-	      <property name="use_underline">True</property>
-
-	      <child>
-		<widget class="GtkMenu" id="menuitem2_menu">
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="reset_edits1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Reset Edits</property>
-		      <property name="use_underline">True</property>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8456">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-undo</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkSeparatorMenuItem" id="separator5">
-		      <property name="visible">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="cut1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Cu_t</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="X" modifiers="GDK_CONTROL_MASK" signal="activate"/>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8457">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-cut</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="copy1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Copy</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="C" modifiers="GDK_CONTROL_MASK" signal="activate"/>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8458">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-copy</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="paste1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Paste</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="V" modifiers="GDK_CONTROL_MASK" signal="activate"/>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8459">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-paste</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="delete1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Delete</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="Delete" modifiers="0" signal="activate"/>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8460">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-remove</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkSeparatorMenuItem" id="separator6">
-		      <property name="visible">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="set_marker_a1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Set Marker _A</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="bracketleft" modifiers="0" signal="activate"/>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="set_marker_b1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Set Marker _B</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="bracketright" modifiers="0" signal="activate"/>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkSeparatorMenuItem" id="separator7">
-		      <property name="visible">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="preferences1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Pre_ferences</property>
-		      <property name="use_underline">True</property>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8461">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-preferences</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-		</widget>
-	      </child>
-	    </widget>
-	  </child>
-
-	  <child>
-	    <widget class="GtkMenuItem" id="view1">
-	      <property name="visible">True</property>
-	      <property name="label" translatable="yes">_View</property>
-	      <property name="use_underline">True</property>
-
-	      <child>
-		<widget class="GtkMenu" id="view1_menu">
-
-		  <child>
-		    <widget class="GtkCheckMenuItem" id="toolbar1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Main Toolbar</property>
-		      <property name="use_underline">True</property>
-		      <property name="active">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkCheckMenuItem" id="sidebar1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_A/V Sidebar</property>
-		      <property name="use_underline">True</property>
-		      <property name="active">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkSeparatorMenuItem" id="separator8">
-		      <property name="visible">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="zoom_1_4">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Zoom 1:4</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="4" modifiers="GDK_CONTROL_MASK | GDK_SHIFT_MASK" signal="activate"/>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="zoom_1_2">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Z_oom 1:2</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="2" modifiers="GDK_CONTROL_MASK | GDK_SHIFT_MASK" signal="activate"/>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="zoom_1_1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Zoom _1:1</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="1" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK" signal="activate"/>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="zoom_2_1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Zoom _2:1</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="2" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK" signal="activate"/>
-		    </widget>
-		  </child>
-		</widget>
-	      </child>
-	    </widget>
-	  </child>
-
-	  <child>
-	    <widget class="GtkMenuItem" id="video_1">
-	      <property name="visible">True</property>
-	      <property name="label" translatable="yes">Vi_deo</property>
-	      <property name="use_underline">True</property>
-
-	      <child>
-		<widget class="GtkMenu" id="video_1_menu">
-
-		  <child>
-		    <widget class="GtkMenuItem" id="decoder_options1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Decoder Options</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="F3" modifiers="0" signal="activate"/>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="set_postprocessing1">
-		      <property name="visible">True</property>
-		      <property name="tooltip" translatable="yes">Select postprocessing level</property>
-		      <property name="label" translatable="yes">_Postprocessing</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="F4" modifiers="0" signal="activate"/>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkSeparatorMenuItem" id="separator9">
-		      <property name="visible">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkCheckMenuItem" id="preview1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">P_review</property>
-		      <property name="use_underline">True</property>
-		      <property name="active">False</property>
-		      <accelerator key="F5" modifiers="0" signal="activate"/>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkCheckMenuItem" id="display_output1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Display _Output</property>
-		      <property name="use_underline">True</property>
-		      <property name="active">False</property>
-		      <accelerator key="F6" modifiers="0" signal="activate"/>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkSeparatorMenuItem" id="separator10">
-		      <property name="visible">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="change_fps">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Frame Rate</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="videoencoder">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Encoder</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="V" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK" signal="activate"/>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="filters1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Fil_ters</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="F" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK" signal="activate"/>
-		    </widget>
-		  </child>
-		</widget>
-	      </child>
-	    </widget>
-	  </child>
-
-	  <child>
-	    <widget class="GtkMenuItem" id="audio1">
-	      <property name="visible">True</property>
-	      <property name="label" translatable="yes">_Audio</property>
-	      <property name="use_underline">True</property>
-
-	      <child>
-		<widget class="GtkMenu" id="audio1_menu">
-
-		  <child>
-		    <widget class="GtkMenuItem" id="main_audio">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Main Track</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="second_audio_track1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Second Track</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="build_vbr_time_map1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Build VBR Time Map</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkSeparatorMenuItem" id="separator11">
-		      <property name="visible">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="save_audio1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">S_ave...</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="S" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK" signal="activate"/>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8462">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-save-as</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="audio_encoder1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Encoder</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="A" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK" signal="activate"/>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="filters2">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Filters</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-		</widget>
-	      </child>
-	    </widget>
-	  </child>
-
-	  <child>
-	    <widget class="GtkMenuItem" id="tools1">
-	      <property name="visible">True</property>
-	      <property name="label" translatable="yes">_Tools</property>
-	      <property name="use_underline">True</property>
-
-	      <child>
-		<widget class="GtkMenu" id="tools1_menu">
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="calculator1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Calculator</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="F7" modifiers="0" signal="activate"/>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8463">
-			  <property name="visible">True</property>
-			  <property name="pixbuf">gnome-calculator_small.xpm</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkSeparatorMenuItem" id="separator12">
-		      <property name="visible">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="rebuild_frames">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Rebuild Frames (I &amp; B)</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="check_frames">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">C_heck Frames (slow)</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="bitrate_histogram1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Bitrate Histogram</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="item1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Scan for Black Frames...</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkSeparatorMenuItem" id="separator13">
-		      <property name="visible">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="v2v">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_VOB -&gt; VobSub</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="ocr_vobsub_2_srt">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_OCR (VobSub -&gt; srt)</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="ocr_dvb">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">OCR (TS-&gt;srt)</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="edit_glyph1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Edit Glyph</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkSeparatorMenuItem" id="separator17">
-		      <property name="visible">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="see_hex1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Frame Hex Dump</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-		</widget>
-	      </child>
-	    </widget>
-	  </child>
-
-	  <child>
-	    <widget class="GtkMenuItem" id="help1">
-	      <property name="visible">True</property>
-	      <property name="label" translatable="yes">A_uto</property>
-	      <property name="use_underline">True</property>
-
-	      <child>
-		<widget class="GtkMenu" id="help1_menu">
-
-		  <child>
-		    <widget class="GtkMenuItem" id="vcd1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_VCD</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="svcd1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_SVCD</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="dvd1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_DVD</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="psp1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_PSP</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="psp_(h264)1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">PSP (_H.264)</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="flv1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">F_LV</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-		</widget>
-	      </child>
-	    </widget>
-	  </child>
-
-	  <child>
-	    <widget class="GtkMenuItem" id="go1">
-	      <property name="visible">True</property>
-	      <property name="label" translatable="yes">_Go</property>
-	      <property name="use_underline">True</property>
-
-	      <child>
-		<widget class="GtkMenu" id="go1_menu">
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="play_video1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Play/Stop</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="P" modifiers="0" signal="activate"/>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8464">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-media-play</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="previous_frame1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">P_revious Frame</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="KP_4" modifiers="0" signal="activate"/>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8465">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-media-previous</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="next_frame1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Next Frame</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="KP_6" modifiers="0" signal="activate"/>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8466">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-media-next</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="previous_intra_frame1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Pr_evious Intra Frame</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="KP_2" modifiers="0" signal="activate"/>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8467">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-media-rewind</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="next_intra_frame1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Next _Intra Frame</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="KP_8" modifiers="0" signal="activate"/>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8468">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-media-forward</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="search_previous_black_frame1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Previou_s Black Frame</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="search_next_black_frame1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Ne_xt Black Frame</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="first_frame1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_First Frame</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="Home" modifiers="0" signal="activate"/>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8469">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-goto-first</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="last_frame1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Last Frame</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="End" modifiers="0" signal="activate"/>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8470">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-goto-last</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkSeparatorMenuItem" id="separator14">
-		      <property name="visible">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="go_to_marker_a1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Go to Marker _A</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="bracketleft" modifiers="GDK_CONTROL_MASK" signal="activate"/>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="go_to_marker_b1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Go to Marker _B</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="bracketright" modifiers="GDK_CONTROL_MASK" signal="activate"/>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkSeparatorMenuItem" id="separator15">
-		      <property name="visible">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="jum_to_frame1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Go to Fra_me...</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="F" modifiers="GDK_CONTROL_MASK" signal="activate"/>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8471">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-jump-to</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="jump_to_time1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Go to _Time...</property>
-		      <property name="use_underline">True</property>
-		      <accelerator key="T" modifiers="GDK_CONTROL_MASK" signal="activate"/>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8472">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-jump-to</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-		</widget>
-	      </child>
-	    </widget>
-	  </child>
-
-	  <child>
-	    <widget class="GtkMenuItem" id="custom1">
-	      <property name="visible">True</property>
-	      <property name="label" translatable="yes">_Custom</property>
-	      <property name="use_underline">True</property>
-	    </widget>
-	  </child>
-
-	  <child>
-	    <widget class="GtkMenuItem" id="help2">
-	      <property name="visible">True</property>
-	      <property name="label" translatable="yes">_Help</property>
-	      <property name="use_underline">True</property>
-
-	      <child>
-		<widget class="GtkMenu" id="help2_menu">
-
-		  <child>
-		    <widget class="GtkMenuItem" id="show_builtin_support1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_Built-in Support</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="about1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_About</property>
-		      <property name="use_underline">True</property>
-
-		      <child internal-child="image">
-			<widget class="GtkImage" id="image8473">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-about</property>
-			  <property name="icon_size">1</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-		</widget>
-	      </child>
-	    </widget>
-	  </child>
-	</widget>
-	<packing>
-	  <property name="padding">0</property>
-	  <property name="expand">False</property>
-	  <property name="fill">False</property>
-	</packing>
-      </child>
-
-      <child>
-	<widget class="GtkToolbar" id="toolbar2">
-	  <property name="visible">True</property>
-	  <property name="orientation">GTK_ORIENTATION_HORIZONTAL</property>
-	  <property name="toolbar_style">GTK_TOOLBAR_BOTH_HORIZ</property>
-	  <property name="tooltips">True</property>
-	  <property name="show_arrow">True</property>
-
-	  <child>
-	    <widget class="GtkMenuToolButton" id="menutoolbuttonOpen">
-	      <property name="visible">True</property>
-	      <property name="tooltip" translatable="yes">Open a file</property>
-	      <property name="stock_id">gtk-open</property>
-	      <property name="visible_horizontal">True</property>
-	      <property name="visible_vertical">True</property>
-	      <property name="is_important">True</property>
-	    </widget>
-	    <packing>
-	      <property name="expand">False</property>
-	      <property name="homogeneous">False</property>
-	    </packing>
-	  </child>
-
-	  <child>
-	    <widget class="GtkToolItem" id="toolitem11">
-	      <property name="visible">True</property>
-	      <property name="visible_horizontal">True</property>
-	      <property name="visible_vertical">True</property>
-	      <property name="is_important">False</property>
-	    </widget>
-	    <packing>
-	      <property name="expand">False</property>
-	      <property name="homogeneous">False</property>
-	    </packing>
-	  </child>
-
-	  <child>
-	    <widget class="GtkToolButton" id="toolbuttonSave">
-	      <property name="visible">True</property>
-	      <property name="tooltip" translatable="yes">Save the file</property>
-	      <property name="stock_id">gtk-save</property>
-	      <property name="visible_horizontal">True</property>
-	      <property name="visible_vertical">True</property>
-	      <property name="is_important">True</property>
-	    </widget>
-	    <packing>
-	      <property name="expand">False</property>
-	      <property name="homogeneous">True</property>
-	    </packing>
-	  </child>
-
-	  <child>
-	    <widget class="GtkToolButton" id="toolbuttonInfo">
-	      <property name="visible">True</property>
-	      <property name="tooltip" translatable="yes">Audio/video file information</property>
-	      <property name="stock_id">gtk-properties</property>
-	      <property name="visible_horizontal">True</property>
-	      <property name="visible_vertical">True</property>
-	      <property name="is_important">False</property>
-	    </widget>
-	    <packing>
-	      <property name="expand">False</property>
-	      <property name="homogeneous">True</property>
-	    </packing>
-	  </child>
-
-	  <child>
-	    <widget class="GtkSeparatorToolItem" id="separatortoolitem1">
-	      <property name="visible">True</property>
-	      <property name="draw">True</property>
-	      <property name="visible_horizontal">True</property>
-	      <property name="visible_vertical">True</property>
-	    </widget>
-	    <packing>
-	      <property name="expand">False</property>
-	      <property name="homogeneous">False</property>
-	    </packing>
-	  </child>
-
-	  <child>
-	    <widget class="GtkToolButton" id="toolbuttonCalc">
-	      <property name="visible">True</property>
-	      <property name="tooltip" translatable="yes">Bitrate/size calculator</property>
-	      <property name="label" translatable="yes">Calculator</property>
-	      <property name="use_underline">True</property>
-	      <property name="icon">gnome-calculator.xpm</property>
-	      <property name="visible_horizontal">True</property>
-	      <property name="visible_vertical">True</property>
-	      <property name="is_important">True</property>
-	    </widget>
-	    <packing>
-	      <property name="expand">False</property>
-	      <property name="homogeneous">True</property>
-	    </packing>
-	  </child>
-
-	  <child>
-	    <widget class="GtkSeparatorToolItem" id="separatortoolitem2">
-	      <property name="visible">True</property>
-	      <property name="draw">True</property>
-	      <property name="visible_horizontal">True</property>
-	      <property name="visible_vertical">True</property>
-	    </widget>
-	    <packing>
-	      <property name="expand">False</property>
-	      <property name="homogeneous">False</property>
-	    </packing>
-	  </child>
-
-	  <child>
-	    <widget class="GtkToolItem" id="toolitem12">
-	      <property name="visible">True</property>
-	      <property name="visible_horizontal">True</property>
-	      <property name="visible_vertical">True</property>
-	      <property name="is_important">False</property>
-
-	      <child>
-		<widget class="GtkComboBox" id="comboboxPreview">
-		  <property name="visible">True</property>
-		  <property name="items" translatable="yes"></property>
-		  <property name="add_tearoffs">False</property>
-		  <property name="focus_on_click">True</property>
-		</widget>
-	      </child>
-	    </widget>
-	    <packing>
-	      <property name="expand">False</property>
-	      <property name="homogeneous">False</property>
-	    </packing>
-	  </child>
-
-	  <child>
-	    <widget class="GtkToolItem" id="toolitem13">
-	      <property name="visible">True</property>
-	      <property name="visible_horizontal">True</property>
-	      <property name="visible_vertical">True</property>
-	      <property name="is_important">False</property>
-
-	      <child>
-		<widget class="GtkToggleButton" id="togglebutton1">
-		  <property name="visible">True</property>
-		  <property name="can_focus">True</property>
-		  <property name="relief">GTK_RELIEF_NONE</property>
-		  <property name="focus_on_click">True</property>
-		  <property name="active">False</property>
-		  <property name="inconsistent">False</property>
-
-		  <child>
-		    <widget class="GtkImage" id="image8272">
-		      <property name="width_request">17</property>
-		      <property name="height_request">16</property>
-		      <property name="visible">True</property>
-		      <property name="pixbuf">audio-volume-medium.png</property>
-		      <property name="xalign">0.5</property>
-		      <property name="yalign">0.5</property>
-		      <property name="xpad">0</property>
-		      <property name="ypad">0</property>
-		    </widget>
-		  </child>
-		</widget>
-	      </child>
-	    </widget>
-	    <packing>
-	      <property name="expand">False</property>
-	      <property name="homogeneous">False</property>
-	    </packing>
-	  </child>
-
-	  <child>
-	    <widget class="GtkToolItem" id="toolitem14">
-	      <property name="visible">True</property>
-	      <property name="visible_horizontal">True</property>
-	      <property name="visible_vertical">True</property>
-	      <property name="is_important">False</property>
-
-	      <child>
-		<widget class="GtkHScale" id="hscalVolume">
-		  <property name="width_request">100</property>
-		  <property name="visible">True</property>
-		  <property name="can_focus">True</property>
-		  <property name="draw_value">False</property>
-		  <property name="value_pos">GTK_POS_TOP</property>
-		  <property name="digits">0</property>
-		  <property name="update_policy">GTK_UPDATE_CONTINUOUS</property>
-		  <property name="inverted">False</property>
-		  <property name="adjustment">99 0 100 1 1 1</property>
-		</widget>
-	      </child>
-	    </widget>
-	    <packing>
-	      <property name="expand">False</property>
-	      <property name="homogeneous">False</property>
-	    </packing>
-	  </child>
-	</widget>
-	<packing>
-	  <property name="padding">0</property>
-	  <property name="expand">False</property>
-	  <property name="fill">False</property>
-	</packing>
-      </child>
-
-      <child>
-	<widget class="GtkVBox" id="vbox10">
-	  <property name="visible">True</property>
-	  <property name="homogeneous">False</property>
-	  <property name="spacing">3</property>
-
-	  <child>
-	    <widget class="GtkHBox" id="hbox14">
-	      <property name="visible">True</property>
-	      <property name="homogeneous">False</property>
-	      <property name="spacing">0</property>
-
-	      <child>
-		<widget class="GtkAlignment" id="alignment19">
-		  <property name="visible">True</property>
-		  <property name="xalign">0.5</property>
-		  <property name="yalign">0.5</property>
-		  <property name="xscale">1</property>
-		  <property name="yscale">1</property>
-		  <property name="top_padding">3</property>
-		  <property name="bottom_padding">0</property>
-		  <property name="left_padding">3</property>
-		  <property name="right_padding">0</property>
-
-		  <child>
-		    <widget class="GtkVBox" id="vbox9">
-		      <property name="visible">True</property>
-		      <property name="homogeneous">False</property>
-		      <property name="spacing">9</property>
-
-		      <child>
-			<widget class="GtkVBox" id="vbox11">
-			  <property name="visible">True</property>
-			  <property name="homogeneous">False</property>
-			  <property name="spacing">0</property>
-
-			  <child>
-			    <widget class="GtkLabel" id="label18">
-			      <property name="visible">True</property>
-			      <property name="label" translatable="yes">&lt;b&gt;Video&lt;/b&gt;</property>
-			      <property name="use_underline">False</property>
-			      <property name="use_markup">True</property>
-			      <property name="justify">GTK_JUSTIFY_LEFT</property>
-			      <property name="wrap">False</property>
-			      <property name="selectable">False</property>
-			      <property name="xalign">0</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xpad">0</property>
-			      <property name="ypad">0</property>
-			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			      <property name="width_chars">-1</property>
-			      <property name="single_line_mode">False</property>
-			      <property name="angle">0</property>
-			    </widget>
-			    <packing>
-			      <property name="padding">0</property>
-			      <property name="expand">False</property>
-			      <property name="fill">False</property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkAlignment" id="alignment12">
-			      <property name="visible">True</property>
-			      <property name="xalign">0.5</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xscale">1</property>
-			      <property name="yscale">1</property>
-			      <property name="top_padding">3</property>
-			      <property name="bottom_padding">0</property>
-			      <property name="left_padding">12</property>
-			      <property name="right_padding">0</property>
-
-			      <child>
-				<widget class="GtkVBox" id="vbox7">
-				  <property name="visible">True</property>
-				  <property name="homogeneous">False</property>
-				  <property name="spacing">3</property>
-
-				  <child>
-				    <widget class="GtkComboBox" id="comboboxVideo">
-				      <property name="visible">True</property>
-				      <property name="items" translatable="yes">Copy</property>
-				      <property name="add_tearoffs">False</property>
-				      <property name="focus_on_click">True</property>
-				    </widget>
-				    <packing>
-				      <property name="padding">0</property>
-				      <property name="expand">False</property>
-				      <property name="fill">False</property>
-				    </packing>
-				  </child>
-
-				  <child>
-				    <widget class="GtkButton" id="buttonConfV">
-				      <property name="visible">True</property>
-				      <property name="tooltip" translatable="yes">Configure video encoder</property>
-				      <property name="can_focus">True</property>
-				      <property name="label" translatable="yes">Configure</property>
-				      <property name="use_underline">True</property>
-				      <property name="relief">GTK_RELIEF_NORMAL</property>
-				      <property name="focus_on_click">True</property>
-				      <accelerator key="F3" modifiers="0" signal="clicked"/>
-				    </widget>
-				    <packing>
-				      <property name="padding">0</property>
-				      <property name="expand">False</property>
-				      <property name="fill">False</property>
-				    </packing>
-				  </child>
-
-				  <child>
-				    <widget class="GtkButton" id="buttonFilters">
-				      <property name="visible">True</property>
-				      <property name="tooltip" translatable="yes">Video filters</property>
-				      <property name="can_focus">True</property>
-				      <property name="label" translatable="yes">Filters</property>
-				      <property name="use_underline">True</property>
-				      <property name="relief">GTK_RELIEF_NORMAL</property>
-				      <property name="focus_on_click">True</property>
-				      <accelerator key="F1" modifiers="0" signal="clicked"/>
-				    </widget>
-				    <packing>
-				      <property name="padding">0</property>
-				      <property name="expand">False</property>
-				      <property name="fill">False</property>
-				    </packing>
-				  </child>
-				</widget>
-			      </child>
-			    </widget>
-			    <packing>
-			      <property name="padding">0</property>
-			      <property name="expand">True</property>
-			      <property name="fill">True</property>
-			    </packing>
-			  </child>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">False</property>
-			  <property name="fill">False</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkVBox" id="vbox12">
-			  <property name="visible">True</property>
-			  <property name="homogeneous">False</property>
-			  <property name="spacing">0</property>
-
-			  <child>
-			    <widget class="GtkLabel" id="label19">
-			      <property name="visible">True</property>
-			      <property name="label" translatable="yes">&lt;b&gt;Audio&lt;/b&gt;</property>
-			      <property name="use_underline">False</property>
-			      <property name="use_markup">True</property>
-			      <property name="justify">GTK_JUSTIFY_LEFT</property>
-			      <property name="wrap">False</property>
-			      <property name="selectable">False</property>
-			      <property name="xalign">0</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xpad">0</property>
-			      <property name="ypad">0</property>
-			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			      <property name="width_chars">-1</property>
-			      <property name="single_line_mode">False</property>
-			      <property name="angle">0</property>
-			    </widget>
-			    <packing>
-			      <property name="padding">0</property>
-			      <property name="expand">False</property>
-			      <property name="fill">False</property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkAlignment" id="alignment13">
-			      <property name="visible">True</property>
-			      <property name="xalign">0.5</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xscale">1</property>
-			      <property name="yscale">1</property>
-			      <property name="top_padding">3</property>
-			      <property name="bottom_padding">0</property>
-			      <property name="left_padding">12</property>
-			      <property name="right_padding">0</property>
-
-			      <child>
-				<widget class="GtkVBox" id="vbox8">
-				  <property name="visible">True</property>
-				  <property name="homogeneous">False</property>
-				  <property name="spacing">3</property>
-
-				  <child>
-				    <widget class="GtkComboBox" id="comboboxAudio">
-				      <property name="visible">True</property>
-				      <property name="items" translatable="yes">Copy</property>
-				      <property name="add_tearoffs">False</property>
-				      <property name="focus_on_click">True</property>
-				    </widget>
-				    <packing>
-				      <property name="padding">0</property>
-				      <property name="expand">False</property>
-				      <property name="fill">False</property>
-				    </packing>
-				  </child>
-
-				  <child>
-				    <widget class="GtkButton" id="buttonConfA">
-				      <property name="visible">True</property>
-				      <property name="tooltip" translatable="yes">Configure audio encoder</property>
-				      <property name="can_focus">True</property>
-				      <property name="label" translatable="yes">Configure</property>
-				      <property name="use_underline">True</property>
-				      <property name="relief">GTK_RELIEF_NORMAL</property>
-				      <property name="focus_on_click">True</property>
-				      <accelerator key="F4" modifiers="0" signal="clicked"/>
-				    </widget>
-				    <packing>
-				      <property name="padding">0</property>
-				      <property name="expand">False</property>
-				      <property name="fill">False</property>
-				    </packing>
-				  </child>
-
-				  <child>
-				    <widget class="GtkButton" id="buttonAudioFilter">
-				      <property name="visible">True</property>
-				      <property name="tooltip" translatable="yes">Audio filters</property>
-				      <property name="can_focus">True</property>
-				      <property name="relief">GTK_RELIEF_NORMAL</property>
-				      <property name="focus_on_click">True</property>
-				      <accelerator key="F2" modifiers="0" signal="clicked"/>
-
-				      <child>
-					<widget class="GtkAlignment" id="alignment16">
-					  <property name="visible">True</property>
-					  <property name="xalign">0.5</property>
-					  <property name="yalign">0.5</property>
-					  <property name="xscale">0</property>
-					  <property name="yscale">0</property>
-					  <property name="top_padding">0</property>
-					  <property name="bottom_padding">0</property>
-					  <property name="left_padding">0</property>
-					  <property name="right_padding">0</property>
-
-					  <child>
-					    <widget class="GtkHBox" id="hbox18">
-					      <property name="visible">True</property>
-					      <property name="homogeneous">False</property>
-					      <property name="spacing">2</property>
-
-					      <child>
-						<widget class="GtkLabel" id="label22">
-						  <property name="visible">True</property>
-						  <property name="label" translatable="yes">Filters</property>
-						  <property name="use_underline">True</property>
-						  <property name="use_markup">False</property>
-						  <property name="justify">GTK_JUSTIFY_LEFT</property>
-						  <property name="wrap">False</property>
-						  <property name="selectable">False</property>
-						  <property name="xalign">0.5</property>
-						  <property name="yalign">0.5</property>
-						  <property name="xpad">0</property>
-						  <property name="ypad">0</property>
-						  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-						  <property name="width_chars">-1</property>
-						  <property name="single_line_mode">False</property>
-						  <property name="angle">0</property>
-						</widget>
-						<packing>
-						  <property name="padding">0</property>
-						  <property name="expand">False</property>
-						  <property name="fill">False</property>
-						</packing>
-					      </child>
-					    </widget>
-					  </child>
-					</widget>
-				      </child>
-				    </widget>
-				    <packing>
-				      <property name="padding">0</property>
-				      <property name="expand">False</property>
-				      <property name="fill">False</property>
-				    </packing>
-				  </child>
-
-				  <child>
-				    <widget class="GtkHBox" id="hbox19">
-				      <property name="visible">True</property>
-				      <property name="homogeneous">False</property>
-				      <property name="spacing">6</property>
-
-				      <child>
-					<widget class="GtkCheckButton" id="CheckButtonTimeshift">
-					  <property name="visible">True</property>
-					  <property name="tooltip" translatable="yes">Enable time shift</property>
-					  <property name="can_focus">True</property>
-					  <property name="label" translatable="yes">Shift:</property>
-					  <property name="use_underline">True</property>
-					  <property name="relief">GTK_RELIEF_NORMAL</property>
-					  <property name="focus_on_click">True</property>
-					  <property name="active">False</property>
-					  <property name="inconsistent">False</property>
-					  <property name="draw_indicator">True</property>
-					</widget>
-					<packing>
-					  <property name="padding">0</property>
-					  <property name="expand">False</property>
-					  <property name="fill">False</property>
-					</packing>
-				      </child>
-
-				      <child>
-					<widget class="GtkSpinButton" id="spinbuttonTimeShift">
-					  <property name="visible">True</property>
-					  <property name="tooltip" translatable="yes">Audio/video time shift (ms)</property>
-					  <property name="can_focus">True</property>
-					  <property name="climb_rate">1</property>
-					  <property name="digits">0</property>
-					  <property name="numeric">True</property>
-					  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
-					  <property name="snap_to_ticks">False</property>
-					  <property name="wrap">False</property>
-					  <property name="adjustment">0 -99999 99999 1 10 10</property>
-					</widget>
-					<packing>
-					  <property name="padding">0</property>
-					  <property name="expand">True</property>
-					  <property name="fill">True</property>
-					</packing>
-				      </child>
-				    </widget>
-				    <packing>
-				      <property name="padding">0</property>
-				      <property name="expand">True</property>
-				      <property name="fill">True</property>
-				    </packing>
-				  </child>
-				</widget>
-			      </child>
-			    </widget>
-			    <packing>
-			      <property name="padding">0</property>
-			      <property name="expand">True</property>
-			      <property name="fill">True</property>
-			    </packing>
-			  </child>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">False</property>
-			  <property name="fill">False</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkVBox" id="vbox13">
-			  <property name="visible">True</property>
-			  <property name="homogeneous">False</property>
-			  <property name="spacing">0</property>
-
-			  <child>
-			    <widget class="GtkLabel" id="label20">
-			      <property name="visible">True</property>
-			      <property name="label" translatable="yes">&lt;b&gt;Format&lt;/b&gt;</property>
-			      <property name="use_underline">False</property>
-			      <property name="use_markup">True</property>
-			      <property name="justify">GTK_JUSTIFY_LEFT</property>
-			      <property name="wrap">False</property>
-			      <property name="selectable">False</property>
-			      <property name="xalign">0</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xpad">0</property>
-			      <property name="ypad">0</property>
-			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			      <property name="width_chars">-1</property>
-			      <property name="single_line_mode">False</property>
-			      <property name="angle">0</property>
-			    </widget>
-			    <packing>
-			      <property name="padding">0</property>
-			      <property name="expand">False</property>
-			      <property name="fill">False</property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkAlignment" id="alignment14">
-			      <property name="visible">True</property>
-			      <property name="xalign">0.5</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xscale">1</property>
-			      <property name="yscale">1</property>
-			      <property name="top_padding">3</property>
-			      <property name="bottom_padding">0</property>
-			      <property name="left_padding">12</property>
-			      <property name="right_padding">0</property>
-
-			      <child>
-				<widget class="GtkComboBox" id="comboboxFormat">
-				  <property name="visible">True</property>
-				  <property name="add_tearoffs">False</property>
-				  <property name="focus_on_click">True</property>
-				</widget>
-			      </child>
-			    </widget>
-			    <packing>
-			      <property name="padding">0</property>
-			      <property name="expand">True</property>
-			      <property name="fill">True</property>
-			    </packing>
-			  </child>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">False</property>
-			  <property name="fill">False</property>
-			</packing>
-		      </child>
-		    </widget>
-		  </child>
-		</widget>
-		<packing>
-		  <property name="padding">0</property>
-		  <property name="expand">False</property>
-		  <property name="fill">False</property>
-		</packing>
-	      </child>
-
-	      <child>
-		<widget class="GtkDrawingArea" id="guiDrawing">
-		  <property name="width_request">496</property>
-		  <property name="height_request">288</property>
-		  <property name="visible">True</property>
-		  <property name="sensitive">False</property>
-		</widget>
-		<packing>
-		  <property name="padding">0</property>
-		  <property name="expand">True</property>
-		  <property name="fill">True</property>
-		</packing>
-	      </child>
-	    </widget>
-	    <packing>
-	      <property name="padding">0</property>
-	      <property name="expand">True</property>
-	      <property name="fill">True</property>
-	    </packing>
-	  </child>
-
-	  <child>
-	    <widget class="GtkTable" id="table2">
-	      <property name="border_width">3</property>
-	      <property name="visible">True</property>
-	      <property name="n_rows">3</property>
-	      <property name="n_columns">2</property>
-	      <property name="homogeneous">False</property>
-	      <property name="row_spacing">0</property>
-	      <property name="column_spacing">6</property>
-
-	      <child>
-		<widget class="GtkVBox" id="vbox14">
-		  <property name="visible">True</property>
-		  <property name="homogeneous">False</property>
-		  <property name="spacing">0</property>
-
-		  <child>
-		    <widget class="GtkLabel" id="label21">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">&lt;b&gt;Selection&lt;/b&gt;</property>
-		      <property name="use_underline">False</property>
-		      <property name="use_markup">True</property>
-		      <property name="justify">GTK_JUSTIFY_LEFT</property>
-		      <property name="wrap">False</property>
-		      <property name="selectable">False</property>
-		      <property name="xalign">0</property>
-		      <property name="yalign">0.5</property>
-		      <property name="xpad">0</property>
-		      <property name="ypad">0</property>
-		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-		      <property name="width_chars">-1</property>
-		      <property name="single_line_mode">False</property>
-		      <property name="angle">0</property>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkAlignment" id="alignment15">
-		      <property name="visible">True</property>
-		      <property name="xalign">0.5</property>
-		      <property name="yalign">0.5</property>
-		      <property name="xscale">1</property>
-		      <property name="yscale">1</property>
-		      <property name="top_padding">3</property>
-		      <property name="bottom_padding">0</property>
-		      <property name="left_padding">12</property>
-		      <property name="right_padding">0</property>
-
-		      <child>
-			<widget class="GtkTable" id="table1">
-			  <property name="visible">True</property>
-			  <property name="n_rows">2</property>
-			  <property name="n_columns">2</property>
-			  <property name="homogeneous">False</property>
-			  <property name="row_spacing">3</property>
-			  <property name="column_spacing">3</property>
-
-			  <child>
-			    <widget class="GtkLabel" id="labelMarkA">
-			      <property name="visible">True</property>
-			      <property name="can_focus">True</property>
-			      <property name="label" translatable="yes"> 0000000</property>
-			      <property name="use_underline">False</property>
-			      <property name="use_markup">False</property>
-			      <property name="justify">GTK_JUSTIFY_LEFT</property>
-			      <property name="wrap">False</property>
-			      <property name="selectable">True</property>
-			      <property name="xalign">0.5</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xpad">0</property>
-			      <property name="ypad">0</property>
-			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			      <property name="width_chars">-1</property>
-			      <property name="single_line_mode">False</property>
-			      <property name="angle">0</property>
-			    </widget>
-			    <packing>
-			      <property name="left_attach">1</property>
-			      <property name="right_attach">2</property>
-			      <property name="top_attach">0</property>
-			      <property name="bottom_attach">1</property>
-			      <property name="x_options">fill</property>
-			      <property name="y_options"></property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkLabel" id="labelMarkB">
-			      <property name="visible">True</property>
-			      <property name="can_focus">True</property>
-			      <property name="label" translatable="yes"> 0000000</property>
-			      <property name="use_underline">False</property>
-			      <property name="use_markup">False</property>
-			      <property name="justify">GTK_JUSTIFY_LEFT</property>
-			      <property name="wrap">False</property>
-			      <property name="selectable">True</property>
-			      <property name="xalign">0.5</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xpad">0</property>
-			      <property name="ypad">0</property>
-			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			      <property name="width_chars">-1</property>
-			      <property name="single_line_mode">False</property>
-			      <property name="angle">0</property>
-			    </widget>
-			    <packing>
-			      <property name="left_attach">1</property>
-			      <property name="right_attach">2</property>
-			      <property name="top_attach">1</property>
-			      <property name="bottom_attach">2</property>
-			      <property name="x_options">fill</property>
-			      <property name="y_options"></property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkButton" id="buttonGotoA">
-			      <property name="height_request">20</property>
-			      <property name="visible">True</property>
-			      <property name="tooltip" translatable="yes">Go to marker A</property>
-			      <property name="label" translatable="yes">A:</property>
-			      <property name="use_underline">True</property>
-			      <property name="relief">GTK_RELIEF_NORMAL</property>
-			      <property name="focus_on_click">True</property>
-			    </widget>
-			    <packing>
-			      <property name="left_attach">0</property>
-			      <property name="right_attach">1</property>
-			      <property name="top_attach">0</property>
-			      <property name="bottom_attach">1</property>
-			      <property name="x_options">fill</property>
-			      <property name="y_options">fill</property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkButton" id="buttonGotoB">
-			      <property name="height_request">20</property>
-			      <property name="visible">True</property>
-			      <property name="tooltip" translatable="yes">Go to marker B</property>
-			      <property name="label" translatable="yes">B:</property>
-			      <property name="use_underline">True</property>
-			      <property name="relief">GTK_RELIEF_NORMAL</property>
-			      <property name="focus_on_click">True</property>
-			    </widget>
-			    <packing>
-			      <property name="left_attach">0</property>
-			      <property name="right_attach">1</property>
-			      <property name="top_attach">1</property>
-			      <property name="bottom_attach">2</property>
-			      <property name="x_options">fill</property>
-			      <property name="y_options">fill</property>
-			    </packing>
-			  </child>
-			</widget>
-		      </child>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">True</property>
-		      <property name="fill">True</property>
-		    </packing>
-		  </child>
-		</widget>
-		<packing>
-		  <property name="left_attach">1</property>
-		  <property name="right_attach">2</property>
-		  <property name="top_attach">1</property>
-		  <property name="bottom_attach">3</property>
-		  <property name="x_options">fill</property>
-		  <property name="y_options">fill</property>
-		</packing>
-	      </child>
-
-	      <child>
-		<widget class="GtkHBox" id="hbox10">
-		  <property name="visible">True</property>
-		  <property name="homogeneous">False</property>
-		  <property name="spacing">0</property>
-
-		  <child>
-		    <widget class="GtkButton" id="buttonPlay">
-		      <property name="visible">True</property>
-		      <property name="tooltip" translatable="yes">Play</property>
-		      <property name="relief">GTK_RELIEF_NONE</property>
-		      <property name="focus_on_click">False</property>
-		      <accelerator key="space" modifiers="0" signal="clicked"/>
-
-		      <child>
-			<widget class="GtkImage" id="image591">
-			  <property name="visible">True</property>
-			  <property name="pixbuf">play.xpm</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkButton" id="buttonStop">
-		      <property name="visible">True</property>
-		      <property name="tooltip" translatable="yes">Stop</property>
-		      <property name="can_focus">True</property>
-		      <property name="relief">GTK_RELIEF_NONE</property>
-		      <property name="focus_on_click">False</property>
-
-		      <child>
-			<widget class="GtkImage" id="image5056">
-			  <property name="visible">True</property>
-			  <property name="pixbuf">stop.xpm</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkButton" id="buttonPrevFrame">
-		      <property name="visible">True</property>
-		      <property name="tooltip" translatable="yes">Previous frame</property>
-		      <property name="relief">GTK_RELIEF_NONE</property>
-		      <property name="focus_on_click">False</property>
-		      <accelerator key="KP_4" modifiers="0" signal="clicked"/>
-
-		      <child>
-			<widget class="GtkImage" id="image593">
-			  <property name="visible">True</property>
-			  <property name="pixbuf">backward.xpm</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkButton" id="buttonNextFrame">
-		      <property name="visible">True</property>
-		      <property name="tooltip" translatable="yes">Next frame</property>
-		      <property name="relief">GTK_RELIEF_NONE</property>
-		      <property name="focus_on_click">False</property>
-		      <accelerator key="KP_6" modifiers="0" signal="clicked"/>
-
-		      <child>
-			<widget class="GtkImage" id="image594">
-			  <property name="visible">True</property>
-			  <property name="pixbuf">forward.xpm</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkButton" id="buttonPrevKFrame">
-		      <property name="visible">True</property>
-		      <property name="tooltip" translatable="yes">Previous keyframe</property>
-		      <property name="relief">GTK_RELIEF_NONE</property>
-		      <property name="focus_on_click">False</property>
-		      <accelerator key="KP_2" modifiers="0" signal="clicked"/>
-
-		      <child>
-			<widget class="GtkImage" id="image595">
-			  <property name="visible">True</property>
-			  <property name="pixbuf">Kbackward.xpm</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkButton" id="buttonNextKFrame">
-		      <property name="visible">True</property>
-		      <property name="tooltip" translatable="yes">Next keyframe</property>
-		      <property name="relief">GTK_RELIEF_NONE</property>
-		      <property name="focus_on_click">False</property>
-		      <accelerator key="KP_8" modifiers="0" signal="clicked"/>
-
-		      <child>
-			<widget class="GtkImage" id="image596">
-			  <property name="visible">True</property>
-			  <property name="pixbuf">Kforward.xpm</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkButton" id="buttonMarkA">
-		      <property name="visible">True</property>
-		      <property name="tooltip" translatable="yes">Selection: start</property>
-		      <property name="can_focus">True</property>
-		      <property name="relief">GTK_RELIEF_NONE</property>
-		      <property name="focus_on_click">False</property>
-
-		      <child>
-			<widget class="GtkImage" id="image2306">
-			  <property name="visible">True</property>
-			  <property name="pixbuf">markA.xpm</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkButton" id="buttonMarkB">
-		      <property name="visible">True</property>
-		      <property name="tooltip" translatable="yes">Selection: end</property>
-		      <property name="can_focus">True</property>
-		      <property name="relief">GTK_RELIEF_NONE</property>
-		      <property name="focus_on_click">False</property>
-
-		      <child>
-			<widget class="GtkImage" id="image2307">
-			  <property name="visible">True</property>
-			  <property name="pixbuf">markB.xpm</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkButton" id="buttonPrevBlack">
-		      <property name="visible">True</property>
-		      <property name="tooltip" translatable="yes">Previous black frame</property>
-		      <property name="can_focus">True</property>
-		      <property name="relief">GTK_RELIEF_NONE</property>
-		      <property name="focus_on_click">False</property>
-
-		      <child>
-			<widget class="GtkImage" id="image2308">
-			  <property name="visible">True</property>
-			  <property name="pixbuf">xpm_prevblack.xpm</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkButton" id="buttonNextBlack">
-		      <property name="visible">True</property>
-		      <property name="tooltip" translatable="yes">Next black frame</property>
-		      <property name="can_focus">True</property>
-		      <property name="relief">GTK_RELIEF_NONE</property>
-		      <property name="focus_on_click">False</property>
-
-		      <child>
-			<widget class="GtkImage" id="image2309">
-			  <property name="visible">True</property>
-			  <property name="pixbuf">xpm_nextblack.xpm</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkButton" id="buttonBegin">
-		      <property name="visible">True</property>
-		      <property name="tooltip" translatable="yes">First frame</property>
-		      <property name="can_focus">True</property>
-		      <property name="relief">GTK_RELIEF_NONE</property>
-		      <property name="focus_on_click">False</property>
-
-		      <child>
-			<widget class="GtkImage" id="image5057">
-			  <property name="visible">True</property>
-			  <property name="pixbuf">begin.xpm</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkButton" id="buttonEnd">
-		      <property name="visible">True</property>
-		      <property name="tooltip" translatable="yes">Last frame</property>
-		      <property name="can_focus">True</property>
-		      <property name="relief">GTK_RELIEF_NONE</property>
-		      <property name="focus_on_click">False</property>
-
-		      <child>
-			<widget class="GtkImage" id="image2245">
-			  <property name="visible">True</property>
-			  <property name="pixbuf">end.xpm</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-		</widget>
-		<packing>
-		  <property name="left_attach">0</property>
-		  <property name="right_attach">1</property>
-		  <property name="top_attach">1</property>
-		  <property name="bottom_attach">2</property>
-		</packing>
-	      </child>
-
-	      <child>
-		<widget class="GtkHScale" id="sliderNavigate">
-		  <property name="visible">True</property>
-		  <property name="draw_value">True</property>
-		  <property name="value_pos">GTK_POS_LEFT</property>
-		  <property name="digits">1</property>
-		  <property name="update_policy">GTK_UPDATE_CONTINUOUS</property>
-		  <property name="inverted">False</property>
-		  <property name="adjustment">0 0 99.9899978638 0.00999999977648 1 0</property>
-		</widget>
-		<packing>
-		  <property name="left_attach">0</property>
-		  <property name="right_attach">1</property>
-		  <property name="top_attach">0</property>
-		  <property name="bottom_attach">1</property>
-		</packing>
-	      </child>
-
-	      <child>
-		<widget class="GtkHBox" id="hbox16">
-		  <property name="visible">True</property>
-		  <property name="homogeneous">False</property>
-		  <property name="spacing">6</property>
-
-		  <child>
-		    <widget class="GtkLabel" id="label1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Frame: </property>
-		      <property name="use_underline">False</property>
-		      <property name="use_markup">False</property>
-		      <property name="justify">GTK_JUSTIFY_LEFT</property>
-		      <property name="wrap">False</property>
-		      <property name="selectable">False</property>
-		      <property name="xalign">0.5</property>
-		      <property name="yalign">0.5</property>
-		      <property name="xpad">0</property>
-		      <property name="ypad">0</property>
-		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-		      <property name="width_chars">-1</property>
-		      <property name="single_line_mode">False</property>
-		      <property name="angle">0</property>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkEntry" id="boxCurFrame">
-		      <property name="visible">True</property>
-		      <property name="tooltip" translatable="yes">Current frame</property>
-		      <property name="can_focus">True</property>
-		      <property name="editable">True</property>
-		      <property name="visibility">True</property>
-		      <property name="max_length">8</property>
-		      <property name="text" translatable="yes">0</property>
-		      <property name="has_frame">True</property>
-		      <property name="invisible_char">*</property>
-		      <property name="activates_default">False</property>
-		      <property name="width_chars">8</property>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkLabel" id="labelTotalFrame">
-		      <property name="visible">True</property>
-		      <property name="can_focus">True</property>
-		      <property name="label" translatable="yes">/ 0000000</property>
-		      <property name="use_underline">False</property>
-		      <property name="use_markup">False</property>
-		      <property name="justify">GTK_JUSTIFY_LEFT</property>
-		      <property name="wrap">False</property>
-		      <property name="selectable">True</property>
-		      <property name="xalign">0.5</property>
-		      <property name="yalign">0.5</property>
-		      <property name="xpad">5</property>
-		      <property name="ypad">0</property>
-		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-		      <property name="width_chars">-1</property>
-		      <property name="single_line_mode">False</property>
-		      <property name="angle">0</property>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkLabel" id="label4">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Time: </property>
-		      <property name="use_underline">False</property>
-		      <property name="use_markup">False</property>
-		      <property name="justify">GTK_JUSTIFY_LEFT</property>
-		      <property name="wrap">False</property>
-		      <property name="selectable">False</property>
-		      <property name="xalign">0.5</property>
-		      <property name="yalign">0.5</property>
-		      <property name="xpad">0</property>
-		      <property name="ypad">0</property>
-		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-		      <property name="width_chars">-1</property>
-		      <property name="single_line_mode">False</property>
-		      <property name="angle">0</property>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkEntry" id="boxCurTime">
-		      <property name="visible">True</property>
-		      <property name="tooltip" translatable="yes">Current time</property>
-		      <property name="can_focus">True</property>
-		      <property name="editable">True</property>
-		      <property name="visibility">True</property>
-		      <property name="max_length">0</property>
-		      <property name="text" translatable="yes">00:00:00.000</property>
-		      <property name="has_frame">True</property>
-		      <property name="invisible_char">*</property>
-		      <property name="activates_default">False</property>
-		      <property name="width_chars">13</property>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkLabel" id="labelTotalTime">
-		      <property name="visible">True</property>
-		      <property name="can_focus">True</property>
-		      <property name="label" translatable="yes">/ 00:00:00,000</property>
-		      <property name="use_underline">False</property>
-		      <property name="use_markup">False</property>
-		      <property name="justify">GTK_JUSTIFY_LEFT</property>
-		      <property name="wrap">False</property>
-		      <property name="selectable">True</property>
-		      <property name="xalign">0.5</property>
-		      <property name="yalign">0.5</property>
-		      <property name="xpad">5</property>
-		      <property name="ypad">0</property>
-		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-		      <property name="width_chars">-1</property>
-		      <property name="single_line_mode">False</property>
-		      <property name="angle">0</property>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkLabel" id="labelFrameType">
-		      <property name="visible">True</property>
-		      <property name="can_focus">True</property>
-		      <property name="label" translatable="yes">Frame: ?</property>
-		      <property name="use_underline">False</property>
-		      <property name="use_markup">False</property>
-		      <property name="justify">GTK_JUSTIFY_LEFT</property>
-		      <property name="wrap">False</property>
-		      <property name="selectable">True</property>
-		      <property name="xalign">0.5</property>
-		      <property name="yalign">0.5</property>
-		      <property name="xpad">0</property>
-		      <property name="ypad">0</property>
-		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-		      <property name="width_chars">-1</property>
-		      <property name="single_line_mode">False</property>
-		      <property name="angle">0</property>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-		</widget>
-		<packing>
-		  <property name="left_attach">0</property>
-		  <property name="right_attach">1</property>
-		  <property name="top_attach">2</property>
-		  <property name="bottom_attach">3</property>
-		  <property name="y_options"></property>
-		</packing>
-	      </child>
-
-	      <child>
-		<widget class="Custom" id="jogg">
-		  <property name="visible">True</property>
-		  <property name="creation_function">jog_shuttle_new</property>
-		  <property name="int1">0</property>
-		  <property name="int2">0</property>
-		  <property name="last_modification_time">Wed, 04 Jul 2007 18:33:02 GMT</property>
-		</widget>
-		<packing>
-		  <property name="left_attach">1</property>
-		  <property name="right_attach">2</property>
-		  <property name="top_attach">0</property>
-		  <property name="bottom_attach">1</property>
-		  <property name="x_options">fill</property>
-		  <property name="y_options">expand</property>
-		</packing>
-	      </child>
-	    </widget>
-	    <packing>
-	      <property name="padding">0</property>
-	      <property name="expand">False</property>
-	      <property name="fill">False</property>
-	    </packing>
-	  </child>
-	</widget>
-	<packing>
-	  <property name="padding">0</property>
-	  <property name="expand">True</property>
-	  <property name="fill">True</property>
-	</packing>
-      </child>
-    </widget>
-  </child>
-</widget>
-
+  <!-- interface-requires gtk+ 2.16 -->
+  <!-- interface-naming-policy toplevel-contextual -->
+  <widget class="GtkWindow" id="mainWindow">
+    <property name="visible">True</property>
+    <property name="title" translatable="yes">Avidemux</property>
+    <property name="icon">avidemux_icon_small.png</property>
+    <child>
+      <widget class="GtkVBox" id="vbox1">
+        <property name="visible">True</property>
+        <child>
+          <widget class="GtkMenuBar" id="menuBar">
+            <property name="visible">True</property>
+            <property name="can_focus">True</property>
+            <child>
+              <widget class="GtkMenuItem" id="menuitem1">
+                <property name="visible">True</property>
+                <property name="label" translatable="yes">_File</property>
+                <property name="use_underline">True</property>
+                <child>
+                  <widget class="GtkMenu" id="menuitem1_menu">
+                    <child>
+                      <widget class="GtkImageMenuItem" id="open_video1">
+                        <property name="label">_Open...</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                        <accelerator key="O" signal="activate" modifiers="GDK_CONTROL_MASK"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="append_video1">
+                        <property name="label">_Append...</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                        <accelerator key="A" signal="activate" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="save_stuff">
+                        <property name="label">_Save</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                        <child>
+                          <widget class="GtkMenu" id="save_stuff_menu">
+                            <child>
+                              <widget class="GtkMenuItem" id="save_as_avi1">
+                                <property name="visible">True</property>
+                                <property name="label" translatable="yes">Save _Video...</property>
+                                <property name="use_underline">True</property>
+                                <accelerator key="S" signal="activate" modifiers="GDK_CONTROL_MASK"/>
+                              </widget>
+                            </child>
+                            <child>
+                              <widget class="GtkSeparatorMenuItem" id="separator1">
+                                <property name="visible">True</property>
+                              </widget>
+                            </child>
+                            <child>
+                              <widget class="GtkMenuItem" id="save_image1">
+                                <property name="visible">True</property>
+                                <property name="label" translatable="yes">Save _BMP Image...</property>
+                                <property name="use_underline">True</property>
+                              </widget>
+                            </child>
+                            <child>
+                              <widget class="GtkMenuItem" id="save_jpg_image1">
+                                <property name="visible">True</property>
+                                <property name="label" translatable="yes">Save _JPEG Image...</property>
+                                <property name="use_underline">True</property>
+                              </widget>
+                            </child>
+                            <child>
+                              <widget class="GtkMenuItem" id="save_selection_as_jpegs1">
+                                <property name="visible">True</property>
+                                <property name="label" translatable="yes">Save _Selection as JPEG Images...</property>
+                                <property name="use_underline">True</property>
+                              </widget>
+                            </child>
+                          </widget>
+                        </child>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="close1">
+                        <property name="label">gtk-close</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkSeparatorMenuItem" id="separator3">
+                        <property name="visible">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="save_project1">
+                        <property name="label">Save _Project</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="save_project_as1">
+                        <property name="label">Save P_roject As...</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="run_script1">
+                        <property name="label">_Load/Run Project...</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="add_to_joblist1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">A_dd to Joblist...</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="joblist1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">Show _Joblist</property>
+                        <property name="use_underline">True</property>
+                        <accelerator key="J" signal="activate" modifiers="GDK_CONTROL_MASK"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkSeparatorMenuItem" id="separator16">
+                        <property name="visible">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="connect_to_avsproxy1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">Co_nnect to avsproxy</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkSeparatorMenuItem" id="separator18">
+                        <property name="visible">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="video_informations1">
+                        <property name="label">Proper_ties</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                        <accelerator key="Return" signal="activate" modifiers="GDK_MOD1_MASK"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="avi_muxer_options1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">AVI _Muxer Options</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkSeparatorMenuItem" id="separator4">
+                        <property name="visible">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="quit1">
+                        <property name="label">_Quit</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                        <accelerator key="Q" signal="activate" modifiers="GDK_CONTROL_MASK"/>
+                      </widget>
+                    </child>
+                  </widget>
+                </child>
+              </widget>
+            </child>
+            <child>
+              <widget class="GtkMenuItem" id="menuitem2">
+                <property name="visible">True</property>
+                <property name="label" translatable="yes">_Edit</property>
+                <property name="use_underline">True</property>
+                <child>
+                  <widget class="GtkMenu" id="menuitem2_menu">
+                    <child>
+                      <widget class="GtkImageMenuItem" id="reset_edits1">
+                        <property name="label">_Reset Edits</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkSeparatorMenuItem" id="separator5">
+                        <property name="visible">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="cut1">
+                        <property name="label">Cu_t</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                        <accelerator key="X" signal="activate" modifiers="GDK_CONTROL_MASK"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="copy1">
+                        <property name="label">_Copy</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                        <accelerator key="C" signal="activate" modifiers="GDK_CONTROL_MASK"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="paste1">
+                        <property name="label">_Paste</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                        <accelerator key="V" signal="activate" modifiers="GDK_CONTROL_MASK"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="delete1">
+                        <property name="label">_Delete</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                        <accelerator key="Delete" signal="activate"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkSeparatorMenuItem" id="separator6">
+                        <property name="visible">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="set_marker_a1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">Set Marker _A</property>
+                        <property name="use_underline">True</property>
+                        <accelerator key="bracketleft" signal="activate"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="set_marker_b1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">Set Marker _B</property>
+                        <property name="use_underline">True</property>
+                        <accelerator key="bracketright" signal="activate"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkSeparatorMenuItem" id="separator7">
+                        <property name="visible">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="preferences1">
+                        <property name="label">Pre_ferences</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                      </widget>
+                    </child>
+                  </widget>
+                </child>
+              </widget>
+            </child>
+            <child>
+              <widget class="GtkMenuItem" id="view1">
+                <property name="visible">True</property>
+                <property name="label" translatable="yes">_View</property>
+                <property name="use_underline">True</property>
+                <child>
+                  <widget class="GtkMenu" id="view1_menu">
+                    <child>
+                      <widget class="GtkCheckMenuItem" id="toolbar1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_Main Toolbar</property>
+                        <property name="use_underline">True</property>
+                        <property name="active">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkCheckMenuItem" id="sidebar1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_A/V Sidebar</property>
+                        <property name="use_underline">True</property>
+                        <property name="active">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkSeparatorMenuItem" id="separator8">
+                        <property name="visible">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="zoom_1_4">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_Zoom 1:4</property>
+                        <property name="use_underline">True</property>
+                        <accelerator key="4" signal="activate" modifiers="GDK_SHIFT_MASK | GDK_CONTROL_MASK"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="zoom_1_2">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">Z_oom 1:2</property>
+                        <property name="use_underline">True</property>
+                        <accelerator key="2" signal="activate" modifiers="GDK_SHIFT_MASK | GDK_CONTROL_MASK"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="zoom_1_1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">Zoom _1:1</property>
+                        <property name="use_underline">True</property>
+                        <accelerator key="1" signal="activate" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="zoom_2_1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">Zoom _2:1</property>
+                        <property name="use_underline">True</property>
+                        <accelerator key="2" signal="activate" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK"/>
+                      </widget>
+                    </child>
+                  </widget>
+                </child>
+              </widget>
+            </child>
+            <child>
+              <widget class="GtkMenuItem" id="video_1">
+                <property name="visible">True</property>
+                <property name="label" translatable="yes">Vi_deo</property>
+                <property name="use_underline">True</property>
+                <child>
+                  <widget class="GtkMenu" id="video_1_menu">
+                    <child>
+                      <widget class="GtkMenuItem" id="decoder_options1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_Decoder Options</property>
+                        <property name="use_underline">True</property>
+                        <accelerator key="F3" signal="activate"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="set_postprocessing1">
+                        <property name="visible">True</property>
+                        <property name="tooltip" translatable="yes">Select postprocessing level</property>
+                        <property name="label" translatable="yes">_Postprocessing</property>
+                        <property name="use_underline">True</property>
+                        <accelerator key="F4" signal="activate"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkSeparatorMenuItem" id="separator9">
+                        <property name="visible">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkCheckMenuItem" id="preview1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">P_review</property>
+                        <property name="use_underline">True</property>
+                        <accelerator key="F5" signal="activate"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkCheckMenuItem" id="display_output1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">Display _Output</property>
+                        <property name="use_underline">True</property>
+                        <accelerator key="F6" signal="activate"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkSeparatorMenuItem" id="separator10">
+                        <property name="visible">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="change_fps">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_Frame Rate</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="videoencoder">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_Encoder</property>
+                        <property name="use_underline">True</property>
+                        <accelerator key="V" signal="activate" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="filters1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">Fil_ters</property>
+                        <property name="use_underline">True</property>
+                        <accelerator key="F" signal="activate" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK"/>
+                      </widget>
+                    </child>
+                  </widget>
+                </child>
+              </widget>
+            </child>
+            <child>
+              <widget class="GtkMenuItem" id="audio1">
+                <property name="visible">True</property>
+                <property name="label" translatable="yes">_Audio</property>
+                <property name="use_underline">True</property>
+                <child>
+                  <widget class="GtkMenu" id="audio1_menu">
+                    <child>
+                      <widget class="GtkMenuItem" id="main_audio">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_Main Track</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="second_audio_track1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_Second Track</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="build_vbr_time_map1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_Build VBR Time Map</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkSeparatorMenuItem" id="separator11">
+                        <property name="visible">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="save_audio1">
+                        <property name="label">S_ave...</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                        <accelerator key="S" signal="activate" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="audio_encoder1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_Encoder</property>
+                        <property name="use_underline">True</property>
+                        <accelerator key="A" signal="activate" modifiers="GDK_CONTROL_MASK | GDK_MOD1_MASK"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="filters2">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_Filters</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                  </widget>
+                </child>
+              </widget>
+            </child>
+            <child>
+              <widget class="GtkMenuItem" id="tools1">
+                <property name="visible">True</property>
+                <property name="label" translatable="yes">_Tools</property>
+                <property name="use_underline">True</property>
+                <child>
+                  <widget class="GtkMenu" id="tools1_menu">
+                    <child>
+                      <widget class="GtkImageMenuItem" id="calculator1">
+                        <property name="label">_Calculator</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                        <accelerator key="F7" signal="activate"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkSeparatorMenuItem" id="separator12">
+                        <property name="visible">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="rebuild_frames">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_Rebuild Frames (I &amp; B)</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="check_frames">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">C_heck Frames (slow)</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="bitrate_histogram1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_Bitrate Histogram</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="item1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_Scan for Black Frames...</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkSeparatorMenuItem" id="separator13">
+                        <property name="visible">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="v2v">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_VOB -&gt; VobSub</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="ocr_vobsub_2_srt">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_OCR (VobSub -&gt; srt)</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="ocr_dvb">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">OCR (TS-&gt;srt)</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="edit_glyph1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_Edit Glyph</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkSeparatorMenuItem" id="separator17">
+                        <property name="visible">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="see_hex1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_Frame Hex Dump</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="see_Size">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">Size Dump</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                  </widget>
+                </child>
+              </widget>
+            </child>
+            <child>
+              <widget class="GtkMenuItem" id="help1">
+                <property name="visible">True</property>
+                <property name="label" translatable="yes">A_uto</property>
+                <property name="use_underline">True</property>
+                <child>
+                  <widget class="GtkMenu" id="help1_menu">
+                    <child>
+                      <widget class="GtkMenuItem" id="vcd1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_VCD</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="svcd1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_SVCD</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="dvd1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_DVD</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="psp1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_PSP</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="psp_(h264)1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">PSP (_H.264)</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="flv1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">F_LV</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                  </widget>
+                </child>
+              </widget>
+            </child>
+            <child>
+              <widget class="GtkMenuItem" id="go1">
+                <property name="visible">True</property>
+                <property name="label" translatable="yes">_Go</property>
+                <property name="use_underline">True</property>
+                <child>
+                  <widget class="GtkMenu" id="go1_menu">
+                    <child>
+                      <widget class="GtkImageMenuItem" id="play_video1">
+                        <property name="label">_Play/Stop</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                        <accelerator key="P" signal="activate"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="previous_frame1">
+                        <property name="label">P_revious Frame</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                        <accelerator key="KP_4" signal="activate"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="next_frame1">
+                        <property name="label">_Next Frame</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                        <accelerator key="KP_6" signal="activate"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="previous_intra_frame1">
+                        <property name="label">Pr_evious Intra Frame</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                        <accelerator key="KP_2" signal="activate"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="next_intra_frame1">
+                        <property name="label">Next _Intra Frame</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                        <accelerator key="KP_8" signal="activate"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="search_previous_black_frame1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">Previou_s Black Frame</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="search_next_black_frame1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">Ne_xt Black Frame</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="first_frame1">
+                        <property name="label">_First Frame</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                        <accelerator key="Home" signal="activate"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="last_frame1">
+                        <property name="label">_Last Frame</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                        <accelerator key="End" signal="activate"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkSeparatorMenuItem" id="separator14">
+                        <property name="visible">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="go_to_marker_a1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">Go to Marker _A</property>
+                        <property name="use_underline">True</property>
+                        <accelerator key="bracketleft" signal="activate" modifiers="GDK_CONTROL_MASK"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkMenuItem" id="go_to_marker_b1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">Go to Marker _B</property>
+                        <property name="use_underline">True</property>
+                        <accelerator key="bracketright" signal="activate" modifiers="GDK_CONTROL_MASK"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkSeparatorMenuItem" id="separator15">
+                        <property name="visible">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="jum_to_frame1">
+                        <property name="label">Go to Fra_me...</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                        <accelerator key="F" signal="activate" modifiers="GDK_CONTROL_MASK"/>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="jump_to_time1">
+                        <property name="label">Go to _Time...</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                        <accelerator key="T" signal="activate" modifiers="GDK_CONTROL_MASK"/>
+                      </widget>
+                    </child>
+                  </widget>
+                </child>
+              </widget>
+            </child>
+            <child>
+              <widget class="GtkMenuItem" id="custom1">
+                <property name="visible">True</property>
+                <property name="label" translatable="yes">_Custom</property>
+                <property name="use_underline">True</property>
+              </widget>
+            </child>
+            <child>
+              <widget class="GtkMenuItem" id="help2">
+                <property name="visible">True</property>
+                <property name="label" translatable="yes">_Help</property>
+                <property name="use_underline">True</property>
+                <child>
+                  <widget class="GtkMenu" id="help2_menu">
+                    <child>
+                      <widget class="GtkMenuItem" id="show_builtin_support1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">_Built-in Support</property>
+                        <property name="use_underline">True</property>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkImageMenuItem" id="about1">
+                        <property name="label">_About</property>
+                        <property name="visible">True</property>
+                        <property name="use_underline">True</property>
+                        <property name="use_stock">True</property>
+                      </widget>
+                    </child>
+                  </widget>
+                </child>
+              </widget>
+            </child>
+          </widget>
+          <packing>
+            <property name="expand">False</property>
+            <property name="fill">False</property>
+            <property name="position">0</property>
+          </packing>
+        </child>
+        <child>
+          <widget class="GtkToolbar" id="toolbar2">
+            <property name="visible">True</property>
+            <property name="toolbar_style">both-horiz</property>
+            <child>
+              <widget class="GtkMenuToolButton" id="menutoolbuttonOpen">
+                <property name="visible">True</property>
+                <property name="tooltip" translatable="yes">Open a file</property>
+                <property name="is_important">True</property>
+                <property name="stock_id">gtk-open</property>
+              </widget>
+              <packing>
+                <property name="expand">False</property>
+              </packing>
+            </child>
+            <child>
+              <widget class="GtkToolItem" id="toolitem11">
+                <property name="visible">True</property>
+              </widget>
+              <packing>
+                <property name="expand">False</property>
+              </packing>
+            </child>
+            <child>
+              <widget class="GtkToolButton" id="toolbuttonSave">
+                <property name="visible">True</property>
+                <property name="tooltip" translatable="yes">Save the file</property>
+                <property name="is_important">True</property>
+                <property name="stock_id">gtk-save</property>
+              </widget>
+              <packing>
+                <property name="expand">False</property>
+                <property name="homogeneous">True</property>
+              </packing>
+            </child>
+            <child>
+              <widget class="GtkToolButton" id="toolbuttonInfo">
+                <property name="visible">True</property>
+                <property name="tooltip" translatable="yes">Audio/video file information</property>
+                <property name="stock_id">gtk-properties</property>
+              </widget>
+              <packing>
+                <property name="expand">False</property>
+                <property name="homogeneous">True</property>
+              </packing>
+            </child>
+            <child>
+              <widget class="GtkSeparatorToolItem" id="separatortoolitem1">
+                <property name="visible">True</property>
+              </widget>
+              <packing>
+                <property name="expand">False</property>
+              </packing>
+            </child>
+            <child>
+              <widget class="GtkToolButton" id="toolbuttonCalc">
+                <property name="visible">True</property>
+                <property name="tooltip" translatable="yes">Bitrate/size calculator</property>
+                <property name="is_important">True</property>
+                <property name="label" translatable="yes">Calculator</property>
+                <property name="use_underline">True</property>
+                <property name="icon">gnome-calculator.xpm</property>
+              </widget>
+              <packing>
+                <property name="expand">False</property>
+                <property name="homogeneous">True</property>
+              </packing>
+            </child>
+            <child>
+              <widget class="GtkSeparatorToolItem" id="separatortoolitem2">
+                <property name="visible">True</property>
+              </widget>
+              <packing>
+                <property name="expand">False</property>
+              </packing>
+            </child>
+            <child>
+              <widget class="GtkToolItem" id="toolitem12">
+                <property name="visible">True</property>
+                <child>
+                  <widget class="GtkComboBox" id="comboboxPreview">
+                    <property name="visible">True</property>
+                    <property name="items" translatable="yes"></property>
+                  </widget>
+                </child>
+              </widget>
+              <packing>
+                <property name="expand">False</property>
+              </packing>
+            </child>
+            <child>
+              <widget class="GtkToolItem" id="toolitem13">
+                <property name="visible">True</property>
+                <child>
+                  <widget class="GtkToggleButton" id="togglebutton1">
+                    <property name="visible">True</property>
+                    <property name="can_focus">True</property>
+                    <property name="receives_default">False</property>
+                    <property name="relief">none</property>
+                    <child>
+                      <widget class="GtkImage" id="image8272">
+                        <property name="width_request">17</property>
+                        <property name="height_request">16</property>
+                        <property name="visible">True</property>
+                        <property name="pixbuf">audio-volume-medium.png</property>
+                      </widget>
+                    </child>
+                  </widget>
+                </child>
+              </widget>
+              <packing>
+                <property name="expand">False</property>
+              </packing>
+            </child>
+            <child>
+              <widget class="GtkToolItem" id="toolitem14">
+                <property name="visible">True</property>
+                <child>
+                  <widget class="GtkHScale" id="hscalVolume">
+                    <property name="width_request">100</property>
+                    <property name="visible">True</property>
+                    <property name="can_focus">True</property>
+                    <property name="adjustment">99 0 100 1 1 1</property>
+                    <property name="digits">0</property>
+                    <property name="draw_value">False</property>
+                  </widget>
+                </child>
+              </widget>
+              <packing>
+                <property name="expand">False</property>
+              </packing>
+            </child>
+          </widget>
+          <packing>
+            <property name="expand">False</property>
+            <property name="fill">False</property>
+            <property name="position">1</property>
+          </packing>
+        </child>
+        <child>
+          <widget class="GtkVBox" id="vbox10">
+            <property name="visible">True</property>
+            <property name="spacing">3</property>
+            <child>
+              <widget class="GtkHBox" id="hbox14">
+                <property name="visible">True</property>
+                <child>
+                  <widget class="GtkAlignment" id="alignment19">
+                    <property name="visible">True</property>
+                    <property name="top_padding">3</property>
+                    <property name="left_padding">3</property>
+                    <child>
+                      <widget class="GtkVBox" id="vbox9">
+                        <property name="visible">True</property>
+                        <property name="spacing">9</property>
+                        <child>
+                          <widget class="GtkVBox" id="vbox11">
+                            <property name="visible">True</property>
+                            <child>
+                              <widget class="GtkLabel" id="label18">
+                                <property name="visible">True</property>
+                                <property name="xalign">0</property>
+                                <property name="label" translatable="yes">&lt;b&gt;Video&lt;/b&gt;</property>
+                                <property name="use_markup">True</property>
+                              </widget>
+                              <packing>
+                                <property name="expand">False</property>
+                                <property name="fill">False</property>
+                                <property name="position">0</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <widget class="GtkAlignment" id="alignment12">
+                                <property name="visible">True</property>
+                                <property name="top_padding">3</property>
+                                <property name="left_padding">12</property>
+                                <child>
+                                  <widget class="GtkVBox" id="vbox7">
+                                    <property name="visible">True</property>
+                                    <property name="spacing">3</property>
+                                    <child>
+                                      <widget class="GtkComboBox" id="comboboxVideo">
+                                        <property name="visible">True</property>
+                                        <property name="items" translatable="yes">Copy</property>
+                                      </widget>
+                                      <packing>
+                                        <property name="expand">False</property>
+                                        <property name="fill">False</property>
+                                        <property name="position">0</property>
+                                      </packing>
+                                    </child>
+                                    <child>
+                                      <widget class="GtkButton" id="buttonConfV">
+                                        <property name="label" translatable="yes">Configure</property>
+                                        <property name="visible">True</property>
+                                        <property name="can_focus">True</property>
+                                        <property name="receives_default">False</property>
+                                        <property name="tooltip" translatable="yes">Configure video encoder</property>
+                                        <property name="use_underline">True</property>
+                                        <accelerator key="F3" signal="clicked"/>
+                                      </widget>
+                                      <packing>
+                                        <property name="expand">False</property>
+                                        <property name="fill">False</property>
+                                        <property name="position">1</property>
+                                      </packing>
+                                    </child>
+                                    <child>
+                                      <widget class="GtkButton" id="buttonFilters">
+                                        <property name="label" translatable="yes">Filters</property>
+                                        <property name="visible">True</property>
+                                        <property name="can_focus">True</property>
+                                        <property name="receives_default">False</property>
+                                        <property name="tooltip" translatable="yes">Video filters</property>
+                                        <property name="use_underline">True</property>
+                                        <accelerator key="F1" signal="clicked"/>
+                                      </widget>
+                                      <packing>
+                                        <property name="expand">False</property>
+                                        <property name="fill">False</property>
+                                        <property name="position">2</property>
+                                      </packing>
+                                    </child>
+                                  </widget>
+                                </child>
+                              </widget>
+                              <packing>
+                                <property name="position">1</property>
+                              </packing>
+                            </child>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">False</property>
+                            <property name="position">0</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <widget class="GtkVBox" id="vbox12">
+                            <property name="visible">True</property>
+                            <child>
+                              <widget class="GtkLabel" id="label19">
+                                <property name="visible">True</property>
+                                <property name="xalign">0</property>
+                                <property name="label" translatable="yes">&lt;b&gt;Audio&lt;/b&gt;</property>
+                                <property name="use_markup">True</property>
+                              </widget>
+                              <packing>
+                                <property name="expand">False</property>
+                                <property name="fill">False</property>
+                                <property name="position">0</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <widget class="GtkAlignment" id="alignment13">
+                                <property name="visible">True</property>
+                                <property name="top_padding">3</property>
+                                <property name="left_padding">12</property>
+                                <child>
+                                  <widget class="GtkVBox" id="vbox8">
+                                    <property name="visible">True</property>
+                                    <property name="spacing">3</property>
+                                    <child>
+                                      <widget class="GtkComboBox" id="comboboxAudio">
+                                        <property name="visible">True</property>
+                                        <property name="items" translatable="yes">Copy</property>
+                                      </widget>
+                                      <packing>
+                                        <property name="expand">False</property>
+                                        <property name="fill">False</property>
+                                        <property name="position">0</property>
+                                      </packing>
+                                    </child>
+                                    <child>
+                                      <widget class="GtkButton" id="buttonConfA">
+                                        <property name="label" translatable="yes">Configure</property>
+                                        <property name="visible">True</property>
+                                        <property name="can_focus">True</property>
+                                        <property name="receives_default">False</property>
+                                        <property name="tooltip" translatable="yes">Configure audio encoder</property>
+                                        <property name="use_underline">True</property>
+                                        <accelerator key="F4" signal="clicked"/>
+                                      </widget>
+                                      <packing>
+                                        <property name="expand">False</property>
+                                        <property name="fill">False</property>
+                                        <property name="position">1</property>
+                                      </packing>
+                                    </child>
+                                    <child>
+                                      <widget class="GtkButton" id="buttonAudioFilter">
+                                        <property name="visible">True</property>
+                                        <property name="can_focus">True</property>
+                                        <property name="receives_default">False</property>
+                                        <property name="tooltip" translatable="yes">Audio filters</property>
+                                        <accelerator key="F2" signal="clicked"/>
+                                        <child>
+                                          <widget class="GtkAlignment" id="alignment16">
+                                            <property name="visible">True</property>
+                                            <property name="xscale">0</property>
+                                            <property name="yscale">0</property>
+                                            <child>
+                                              <widget class="GtkHBox" id="hbox18">
+                                                <property name="visible">True</property>
+                                                <property name="spacing">2</property>
+                                                <child>
+                                                  <widget class="GtkLabel" id="label22">
+                                                    <property name="visible">True</property>
+                                                    <property name="label" translatable="yes">Filters</property>
+                                                    <property name="use_underline">True</property>
+                                                  </widget>
+                                                  <packing>
+                                                    <property name="expand">False</property>
+                                                    <property name="fill">False</property>
+                                                    <property name="position">0</property>
+                                                  </packing>
+                                                </child>
+                                              </widget>
+                                            </child>
+                                          </widget>
+                                        </child>
+                                      </widget>
+                                      <packing>
+                                        <property name="expand">False</property>
+                                        <property name="fill">False</property>
+                                        <property name="position">2</property>
+                                      </packing>
+                                    </child>
+                                    <child>
+                                      <widget class="GtkHBox" id="hbox19">
+                                        <property name="visible">True</property>
+                                        <property name="spacing">6</property>
+                                        <child>
+                                          <widget class="GtkCheckButton" id="CheckButtonTimeshift">
+                                            <property name="label" translatable="yes">Shift:</property>
+                                            <property name="visible">True</property>
+                                            <property name="can_focus">True</property>
+                                            <property name="receives_default">False</property>
+                                            <property name="tooltip" translatable="yes">Enable time shift</property>
+                                            <property name="use_underline">True</property>
+                                            <property name="draw_indicator">True</property>
+                                          </widget>
+                                          <packing>
+                                            <property name="expand">False</property>
+                                            <property name="fill">False</property>
+                                            <property name="position">0</property>
+                                          </packing>
+                                        </child>
+                                        <child>
+                                          <widget class="GtkSpinButton" id="spinbuttonTimeShift">
+                                            <property name="visible">True</property>
+                                            <property name="can_focus">True</property>
+                                            <property name="tooltip" translatable="yes">Audio/video time shift (ms)</property>
+                                            <property name="adjustment">0 -99999 99999 1 10 10</property>
+                                            <property name="climb_rate">1</property>
+                                            <property name="numeric">True</property>
+                                          </widget>
+                                          <packing>
+                                            <property name="position">1</property>
+                                          </packing>
+                                        </child>
+                                      </widget>
+                                      <packing>
+                                        <property name="position">3</property>
+                                      </packing>
+                                    </child>
+                                  </widget>
+                                </child>
+                              </widget>
+                              <packing>
+                                <property name="position">1</property>
+                              </packing>
+                            </child>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">False</property>
+                            <property name="position">1</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <widget class="GtkVBox" id="vbox13">
+                            <property name="visible">True</property>
+                            <child>
+                              <widget class="GtkLabel" id="label20">
+                                <property name="visible">True</property>
+                                <property name="xalign">0</property>
+                                <property name="label" translatable="yes">&lt;b&gt;Format&lt;/b&gt;</property>
+                                <property name="use_markup">True</property>
+                              </widget>
+                              <packing>
+                                <property name="expand">False</property>
+                                <property name="fill">False</property>
+                                <property name="position">0</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <widget class="GtkAlignment" id="alignment14">
+                                <property name="visible">True</property>
+                                <property name="top_padding">3</property>
+                                <property name="left_padding">12</property>
+                                <child>
+                                  <widget class="GtkComboBox" id="comboboxFormat">
+                                    <property name="visible">True</property>
+                                  </widget>
+                                </child>
+                              </widget>
+                              <packing>
+                                <property name="position">1</property>
+                              </packing>
+                            </child>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">False</property>
+                            <property name="position">2</property>
+                          </packing>
+                        </child>
+                      </widget>
+                    </child>
+                  </widget>
+                  <packing>
+                    <property name="expand">False</property>
+                    <property name="fill">False</property>
+                    <property name="position">0</property>
+                  </packing>
+                </child>
+                <child>
+                  <widget class="GtkDrawingArea" id="guiDrawing">
+                    <property name="width_request">496</property>
+                    <property name="height_request">288</property>
+                    <property name="visible">True</property>
+                    <property name="sensitive">False</property>
+                  </widget>
+                  <packing>
+                    <property name="position">1</property>
+                  </packing>
+                </child>
+              </widget>
+              <packing>
+                <property name="position">0</property>
+              </packing>
+            </child>
+            <child>
+              <widget class="GtkTable" id="table2">
+                <property name="visible">True</property>
+                <property name="border_width">3</property>
+                <property name="n_rows">3</property>
+                <property name="n_columns">2</property>
+                <property name="column_spacing">6</property>
+                <child>
+                  <widget class="GtkVBox" id="vbox14">
+                    <property name="visible">True</property>
+                    <child>
+                      <widget class="GtkLabel" id="label21">
+                        <property name="visible">True</property>
+                        <property name="xalign">0</property>
+                        <property name="label" translatable="yes">&lt;b&gt;Selection&lt;/b&gt;</property>
+                        <property name="use_markup">True</property>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                        <property name="position">0</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkAlignment" id="alignment15">
+                        <property name="visible">True</property>
+                        <property name="top_padding">3</property>
+                        <property name="left_padding">12</property>
+                        <child>
+                          <widget class="GtkTable" id="table1">
+                            <property name="visible">True</property>
+                            <property name="n_rows">2</property>
+                            <property name="n_columns">2</property>
+                            <property name="column_spacing">3</property>
+                            <property name="row_spacing">3</property>
+                            <child>
+                              <widget class="GtkLabel" id="labelMarkA">
+                                <property name="visible">True</property>
+                                <property name="can_focus">True</property>
+                                <property name="label" translatable="yes"> 0000000</property>
+                                <property name="selectable">True</property>
+                              </widget>
+                              <packing>
+                                <property name="left_attach">1</property>
+                                <property name="right_attach">2</property>
+                                <property name="x_options">GTK_FILL</property>
+                                <property name="y_options"></property>
+                              </packing>
+                            </child>
+                            <child>
+                              <widget class="GtkLabel" id="labelMarkB">
+                                <property name="visible">True</property>
+                                <property name="can_focus">True</property>
+                                <property name="label" translatable="yes"> 0000000</property>
+                                <property name="selectable">True</property>
+                              </widget>
+                              <packing>
+                                <property name="left_attach">1</property>
+                                <property name="right_attach">2</property>
+                                <property name="top_attach">1</property>
+                                <property name="bottom_attach">2</property>
+                                <property name="x_options">GTK_FILL</property>
+                                <property name="y_options"></property>
+                              </packing>
+                            </child>
+                            <child>
+                              <widget class="GtkButton" id="buttonGotoA">
+                                <property name="label" translatable="yes">A:</property>
+                                <property name="height_request">20</property>
+                                <property name="visible">True</property>
+                                <property name="can_focus">False</property>
+                                <property name="receives_default">False</property>
+                                <property name="tooltip" translatable="yes">Go to marker A</property>
+                                <property name="use_underline">True</property>
+                              </widget>
+                              <packing>
+                                <property name="x_options">GTK_FILL</property>
+                                <property name="y_options">GTK_FILL</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <widget class="GtkButton" id="buttonGotoB">
+                                <property name="label" translatable="yes">B:</property>
+                                <property name="height_request">20</property>
+                                <property name="visible">True</property>
+                                <property name="can_focus">False</property>
+                                <property name="receives_default">False</property>
+                                <property name="tooltip" translatable="yes">Go to marker B</property>
+                                <property name="use_underline">True</property>
+                              </widget>
+                              <packing>
+                                <property name="top_attach">1</property>
+                                <property name="bottom_attach">2</property>
+                                <property name="x_options">GTK_FILL</property>
+                                <property name="y_options">GTK_FILL</property>
+                              </packing>
+                            </child>
+                          </widget>
+                        </child>
+                      </widget>
+                      <packing>
+                        <property name="position">1</property>
+                      </packing>
+                    </child>
+                  </widget>
+                  <packing>
+                    <property name="left_attach">1</property>
+                    <property name="right_attach">2</property>
+                    <property name="top_attach">1</property>
+                    <property name="bottom_attach">3</property>
+                    <property name="x_options">GTK_FILL</property>
+                    <property name="y_options">GTK_FILL</property>
+                  </packing>
+                </child>
+                <child>
+                  <widget class="GtkHBox" id="hbox10">
+                    <property name="visible">True</property>
+                    <child>
+                      <widget class="GtkButton" id="buttonPlay">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="receives_default">False</property>
+                        <property name="tooltip" translatable="yes">Play</property>
+                        <property name="relief">none</property>
+                        <property name="focus_on_click">False</property>
+                        <accelerator key="space" signal="clicked"/>
+                        <child>
+                          <widget class="GtkImage" id="image591">
+                            <property name="visible">True</property>
+                            <property name="pixbuf">play.xpm</property>
+                          </widget>
+                        </child>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                        <property name="position">0</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkButton" id="buttonStop">
+                        <property name="visible">True</property>
+                        <property name="can_focus">True</property>
+                        <property name="receives_default">False</property>
+                        <property name="tooltip" translatable="yes">Stop</property>
+                        <property name="relief">none</property>
+                        <property name="focus_on_click">False</property>
+                        <child>
+                          <widget class="GtkImage" id="image5056">
+                            <property name="visible">True</property>
+                            <property name="pixbuf">stop.xpm</property>
+                          </widget>
+                        </child>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                        <property name="position">1</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkButton" id="buttonPrevFrame">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="receives_default">False</property>
+                        <property name="tooltip" translatable="yes">Previous frame</property>
+                        <property name="relief">none</property>
+                        <property name="focus_on_click">False</property>
+                        <accelerator key="KP_4" signal="clicked"/>
+                        <child>
+                          <widget class="GtkImage" id="image593">
+                            <property name="visible">True</property>
+                            <property name="pixbuf">backward.xpm</property>
+                          </widget>
+                        </child>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                        <property name="position">2</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkButton" id="buttonNextFrame">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="receives_default">False</property>
+                        <property name="tooltip" translatable="yes">Next frame</property>
+                        <property name="relief">none</property>
+                        <property name="focus_on_click">False</property>
+                        <accelerator key="KP_6" signal="clicked"/>
+                        <child>
+                          <widget class="GtkImage" id="image594">
+                            <property name="visible">True</property>
+                            <property name="pixbuf">forward.xpm</property>
+                          </widget>
+                        </child>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                        <property name="position">3</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkButton" id="buttonPrevKFrame">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="receives_default">False</property>
+                        <property name="tooltip" translatable="yes">Previous keyframe</property>
+                        <property name="relief">none</property>
+                        <property name="focus_on_click">False</property>
+                        <accelerator key="KP_2" signal="clicked"/>
+                        <child>
+                          <widget class="GtkImage" id="image595">
+                            <property name="visible">True</property>
+                            <property name="pixbuf">Kbackward.xpm</property>
+                          </widget>
+                        </child>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                        <property name="position">4</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkButton" id="buttonNextKFrame">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="receives_default">False</property>
+                        <property name="tooltip" translatable="yes">Next keyframe</property>
+                        <property name="relief">none</property>
+                        <property name="focus_on_click">False</property>
+                        <accelerator key="KP_8" signal="clicked"/>
+                        <child>
+                          <widget class="GtkImage" id="image596">
+                            <property name="visible">True</property>
+                            <property name="pixbuf">Kforward.xpm</property>
+                          </widget>
+                        </child>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                        <property name="position">5</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkButton" id="buttonMarkA">
+                        <property name="visible">True</property>
+                        <property name="can_focus">True</property>
+                        <property name="receives_default">False</property>
+                        <property name="tooltip" translatable="yes">Selection: start</property>
+                        <property name="relief">none</property>
+                        <property name="focus_on_click">False</property>
+                        <child>
+                          <widget class="GtkImage" id="image2306">
+                            <property name="visible">True</property>
+                            <property name="pixbuf">markA.xpm</property>
+                          </widget>
+                        </child>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                        <property name="position">6</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkButton" id="buttonMarkB">
+                        <property name="visible">True</property>
+                        <property name="can_focus">True</property>
+                        <property name="receives_default">False</property>
+                        <property name="tooltip" translatable="yes">Selection: end</property>
+                        <property name="relief">none</property>
+                        <property name="focus_on_click">False</property>
+                        <child>
+                          <widget class="GtkImage" id="image2307">
+                            <property name="visible">True</property>
+                            <property name="pixbuf">markB.xpm</property>
+                          </widget>
+                        </child>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                        <property name="position">7</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkButton" id="buttonPrevBlack">
+                        <property name="visible">True</property>
+                        <property name="can_focus">True</property>
+                        <property name="receives_default">False</property>
+                        <property name="tooltip" translatable="yes">Previous black frame</property>
+                        <property name="relief">none</property>
+                        <property name="focus_on_click">False</property>
+                        <child>
+                          <widget class="GtkImage" id="image2308">
+                            <property name="visible">True</property>
+                            <property name="pixbuf">xpm_prevblack.xpm</property>
+                          </widget>
+                        </child>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                        <property name="position">8</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkButton" id="buttonNextBlack">
+                        <property name="visible">True</property>
+                        <property name="can_focus">True</property>
+                        <property name="receives_default">False</property>
+                        <property name="tooltip" translatable="yes">Next black frame</property>
+                        <property name="relief">none</property>
+                        <property name="focus_on_click">False</property>
+                        <child>
+                          <widget class="GtkImage" id="image2309">
+                            <property name="visible">True</property>
+                            <property name="pixbuf">xpm_nextblack.xpm</property>
+                          </widget>
+                        </child>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                        <property name="position">9</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkButton" id="buttonBegin">
+                        <property name="visible">True</property>
+                        <property name="can_focus">True</property>
+                        <property name="receives_default">False</property>
+                        <property name="tooltip" translatable="yes">First frame</property>
+                        <property name="relief">none</property>
+                        <property name="focus_on_click">False</property>
+                        <child>
+                          <widget class="GtkImage" id="image5057">
+                            <property name="visible">True</property>
+                            <property name="pixbuf">begin.xpm</property>
+                          </widget>
+                        </child>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                        <property name="position">10</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkButton" id="buttonEnd">
+                        <property name="visible">True</property>
+                        <property name="can_focus">True</property>
+                        <property name="receives_default">False</property>
+                        <property name="tooltip" translatable="yes">Last frame</property>
+                        <property name="relief">none</property>
+                        <property name="focus_on_click">False</property>
+                        <child>
+                          <widget class="GtkImage" id="image2245">
+                            <property name="visible">True</property>
+                            <property name="pixbuf">end.xpm</property>
+                          </widget>
+                        </child>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                        <property name="position">11</property>
+                      </packing>
+                    </child>
+                  </widget>
+                  <packing>
+                    <property name="top_attach">1</property>
+                    <property name="bottom_attach">2</property>
+                  </packing>
+                </child>
+                <child>
+                  <widget class="GtkHScale" id="sliderNavigate">
+                    <property name="visible">True</property>
+                    <property name="adjustment">0 0 99.989997863799999 0.0099999997764800008 1 0</property>
+                    <property name="value_pos">left</property>
+                  </widget>
+                </child>
+                <child>
+                  <widget class="GtkHBox" id="hbox16">
+                    <property name="visible">True</property>
+                    <property name="spacing">6</property>
+                    <child>
+                      <widget class="GtkLabel" id="label1">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">Frame: </property>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                        <property name="position">0</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkEntry" id="boxCurFrame">
+                        <property name="visible">True</property>
+                        <property name="can_focus">True</property>
+                        <property name="tooltip" translatable="yes">Current frame</property>
+                        <property name="max_length">8</property>
+                        <property name="width_chars">8</property>
+                        <property name="text" translatable="yes">0</property>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                        <property name="position">1</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkLabel" id="labelTotalFrame">
+                        <property name="visible">True</property>
+                        <property name="can_focus">True</property>
+                        <property name="xpad">5</property>
+                        <property name="label" translatable="yes">/ 0000000</property>
+                        <property name="selectable">True</property>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                        <property name="position">2</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkLabel" id="label4">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">Time: </property>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                        <property name="position">3</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkEntry" id="boxCurTime">
+                        <property name="visible">True</property>
+                        <property name="can_focus">True</property>
+                        <property name="tooltip" translatable="yes">Current time</property>
+                        <property name="width_chars">13</property>
+                        <property name="text" translatable="yes">00:00:00.000</property>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                        <property name="position">4</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkLabel" id="labelTotalTime">
+                        <property name="visible">True</property>
+                        <property name="can_focus">True</property>
+                        <property name="xpad">5</property>
+                        <property name="label" translatable="yes">/ 00:00:00,000</property>
+                        <property name="selectable">True</property>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                        <property name="position">5</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkLabel" id="labelFrameType">
+                        <property name="visible">True</property>
+                        <property name="can_focus">True</property>
+                        <property name="label" translatable="yes">Frame: ?</property>
+                        <property name="selectable">True</property>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                        <property name="position">6</property>
+                      </packing>
+                    </child>
+                  </widget>
+                  <packing>
+                    <property name="top_attach">2</property>
+                    <property name="bottom_attach">3</property>
+                    <property name="y_options"></property>
+                  </packing>
+                </child>
+                <child>
+                  <widget class="Custom" id="jogg">
+                    <property name="visible">True</property>
+                    <property name="creation_function">jog_shuttle_new</property>
+                  </widget>
+                  <packing>
+                    <property name="left_attach">1</property>
+                    <property name="right_attach">2</property>
+                    <property name="x_options">GTK_FILL</property>
+                    <property name="y_options">GTK_EXPAND</property>
+                  </packing>
+                </child>
+              </widget>
+              <packing>
+                <property name="expand">False</property>
+                <property name="fill">False</property>
+                <property name="position">1</property>
+              </packing>
+            </child>
+          </widget>
+          <packing>
+            <property name="position">2</property>
+          </packing>
+        </child>
+      </widget>
+    </child>
+  </widget>
 </glade-interface>

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk_gui.cpp	2009-05-16 12:48:21 UTC (rev 4835)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk_gui.cpp	2009-05-16 12:48:22 UTC (rev 4836)
@@ -107,6 +107,7 @@
 extern void GUI_setMarks (uint32_t a, uint32_t b);
 extern void  GUI_displayBitrate( void );
 void GUI_showCurrentFrameHex(void);
+void GUI_showSize(void);
 void GUI_avsProxy(void);
 uint8_t GUI_close(void);
 
@@ -688,7 +689,9 @@
    case ACT_HEX_DUMP:
       GUI_showCurrentFrameHex();
       break;
-
+   case ACT_SIZE_DUMP:
+      GUI_showSize();
+      break;
     default:
       printf ("\n unhandled action %d\n", action);
       ADM_assert (0);
@@ -1707,6 +1710,45 @@
 
  delete [] buffer;
 }
+/**
+    \fn GUI_showSize
+    \brief Show frame size
+
+*/
+#define DUMP_SIZE 30
+void GUI_showSize(void)
+{
+uint8_t *buffer;
+ uint32_t fullLen,flags;
+ ADMCompressedImage image;
+ uint8_t seq;
+ char                text[DUMP_SIZE][100];
+ 
+ if (!avifileinfo) return;
+
+ buffer=new uint8_t [avifileinfo->width*avifileinfo->height*3];
+ image.data=buffer;
+
+
+
+
+    for(int i=0;i<DUMP_SIZE;i++)
+    {
+        int target=video_body->getCurrentFrame()+i;
+        video_body->getFlags ( target,&flags);
+        video_body->getFrame ( target,&image,&seq);
+        fullLen=image.dataLength;
+        sprintf(text[i],"Frame %d:%d",target,fullLen);
+        printf("%s\n",text[i]);
+    }
+ 
+
+
+ 
+ delete [] buffer;
+ 
+}
+
 // Temporary place...
 
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux/gui_action.names
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gui_action.names	2009-05-16 12:48:21 UTC (rev 4835)
+++ branches/avidemux_2.6_branch_mean/avidemux/gui_action.names	2009-05-16 12:48:22 UTC (rev 4836)
@@ -146,6 +146,7 @@
 ACT(ZOOM_4_1)
 ACT(BUILT_IN)
 ACT(HEX_DUMP)
+ACT(SIZE_DUMP)
 ACT(AVS_PROXY)
 ACT(JOG)
 ACT(GLYPHEDIT)



From mean at mail.berlios.de  Sat May 16 14:48:26 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 16 May 2009 14:48:26 +0200
Subject: [Avidemux-svn-commit] r4837 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905161248.n4GCmQpK006073@sheep.berlios.de>

Author: mean
Date: 2009-05-16 14:48:26 +0200 (Sat, 16 May 2009)
New Revision: 4837

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp
Log:
[TsIndexer] Add some debug statements

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp	2009-05-16 12:48:22 UTC (rev 4836)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp	2009-05-16 12:48:26 UTC (rev 4837)
@@ -42,6 +42,7 @@
 }
 #endif
 
+#define zprintf(...) {}
 
 static const char Type[5]={'X','I','P','B','D'};
 
@@ -277,7 +278,7 @@
     pkt->open(file,append);
     data.pkt=pkt;
     fullSize=pkt->getSize();
-
+    int lastRefIdc=0;
     //******************
     // 1 search SPS
     //******************
@@ -329,10 +330,20 @@
         if(!pkt->stillOk()) break;
         uint8_t startCode=pkt->readi8(); // Read 5 bytes so far
 //  1:0 2:Nal ref idc 5:Nal Type
-        if(startCode&0x80) continue; // Marker missing
-        startCode&=0x1f;
+        if(startCode&0x80) 
+        {
+            printf("[Ts] Nal Marker missing:%x\n",startCode);
+            continue; // Marker missing
+        }
+        int fullStartCode=startCode;
+        int ref=(startCode>>5)&3;
+
+        startCode&=0x1f; // Ignore nal ref IDR
+        
+        zprintf("[%02x] Nal :0x%x,ref=%d,lastRef=%d at : %d \n",fullStartCode,startCode,ref,lastRefIdc,pkt->getConsumed()-beginConsuming);
+        
           // Ignore multiple chunk of the same pic
-          if((startCode==NAL_NON_IDR || startCode==NAL_IDR)&&pic_started) 
+          if((startCode==NAL_NON_IDR || startCode==NAL_IDR)&&pic_started )  //&& ref==lastRefIdc) 
           {
            // aprintf("Still capturing, ignore\n");
             continue;
@@ -341,6 +352,7 @@
           switch(startCode)
                   {
                   case NAL_SEI:
+                            break;
                   case NAL_AU_DELIMITER:
                           pic_started = false;
                           break;
@@ -359,6 +371,9 @@
                   case NAL_NON_IDR:
                     {
 #define NON_IDR_PRE_READ 8
+                      zprintf("Pic start last ref:%d cur ref:%d nb=%d\n",lastRefIdc,ref,data.nbPics);
+                      lastRefIdc=ref;
+                        
                       uint8_t bufr[NON_IDR_PRE_READ+4];
                       uint8_t header[NON_IDR_PRE_READ+4];
                       GetBitContext s;



From mean at mail.berlios.de  Tue May 19 19:41:30 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 19 May 2009 19:41:30 +0200
Subject: [Avidemux-svn-commit] r4838 - in
	branches/avidemux_2.6_branch_mean/plugins/ADM_muxers: . muxerRaw
Message-ID: <200905191741.n4JHfUha030008@sheep.berlios.de>

Author: mean
Date: 2009-05-19 19:41:29 +0200 (Tue, 19 May 2009)
New Revision: 4838

Added:
   branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerRaw/
   branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerRaw/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerRaw/muxerRaw.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerRaw/muxerRaw.h
Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/CMakeLists.txt
Log:
[Muxer] Added video only muxer

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/CMakeLists.txt	2009-05-16 12:48:26 UTC (rev 4837)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/CMakeLists.txt	2009-05-19 17:41:29 UTC (rev 4838)
@@ -1,6 +1,7 @@
 ADD_SUBDIRECTORY(muxerDummy)
 ADD_SUBDIRECTORY(muxerMp4)
 ADD_SUBDIRECTORY(muxerAvi)
+ADD_SUBDIRECTORY(muxerRaw)
 #ADD_SUBDIRECTORY(muxerFlv)
 #ADD_SUBDIRECTORY(oplug_avi)
 #ADD_SUBDIRECTORY(oplug_mp4)

Added: branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerRaw/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerRaw/CMakeLists.txt	2009-05-16 12:48:26 UTC (rev 4837)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerRaw/CMakeLists.txt	2009-05-19 17:41:29 UTC (rev 4838)
@@ -0,0 +1,11 @@
+include(mx_plugin)
+SET(ADM_raw_SRCS 
+	muxerRaw.cpp
+	muxerRawPlugin.cpp
+)
+
+ADD_LIBRARY(ADM_mx_raw SHARED ${ADM_raw_SRCS})
+
+INIT_MUXER(ADM_mx_raw)
+INSTALL_MUXER(ADM_mx_raw)
+

Added: branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerRaw/muxerRaw.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerRaw/muxerRaw.cpp	2009-05-16 12:48:26 UTC (rev 4837)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerRaw/muxerRaw.cpp	2009-05-19 17:41:29 UTC (rev 4838)
@@ -0,0 +1,112 @@
+/***************************************************************************
+            \file            muxerRaw
+            \brief           i/f to lavformat mpeg4 muxer
+                             -------------------
+    
+    copyright            : (C) 2008 by mean
+    email                : fixounet at free.fr
+        
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "ADM_default.h"
+#include "fourcc.h"
+#include "muxerRaw.h"
+#include "DIA_coreToolkit.h"
+
+
+
+#if 1
+#define aprintf(...) {}
+#else
+#define aprintf printf
+#endif
+
+
+/**
+    \fn     muxerRaw
+    \brief  Constructor
+*/
+muxerRaw::muxerRaw() 
+{
+    file=NULL;
+};
+/**
+    \fn     muxerRaw
+    \brief  Destructor
+*/
+
+muxerRaw::~muxerRaw() 
+{
+    printf("[RAW] Destructing\n");
+    close();
+}
+/**
+    \fn open
+    \brief Check that the streams are ok, initialize context...
+*/
+
+bool muxerRaw::open(const char *fil, ADM_videoStream *s,uint32_t nbAudioTrack,ADM_audioStream **a)
+{
+
+    vStream=s;
+    file=fopen(fil,"w");
+    if(!file) 
+    {
+        printf("[RawMuxer] Cannot open %s\n",fil);
+        return false;
+    }
+    return true;
+}
+
+/**
+    \fn save
+*/
+bool muxerRaw::save(void) 
+{
+    printf("[RAW] Saving\n");
+    uint32_t bufSize=vStream->getWidth()*vStream->getHeight()*3;
+    uint8_t *buffer=new uint8_t[bufSize];
+    uint32_t len,flags;
+    uint64_t pts,dts,rawDts;
+    uint64_t lastVideoDts=0;
+    int written=0;
+    
+
+    while(true==vStream->getPacket(&len, buffer, bufSize,&pts,&dts,&flags))
+    {
+        fwrite(buffer,len,1,file);
+        written++;
+
+    }
+    delete [] buffer;
+    fclose(file);
+    file=NULL;
+    printf("[RAW] Wrote %d frames \n",written);
+    return true;
+}
+/**
+    \fn close
+    \brief Cleanup is done in the dtor
+*/
+bool muxerRaw::close(void) 
+{
+    if(file)
+    {
+        fclose(file);
+        file=NULL;
+    }
+    return true;
+}
+
+//EOF
+
+
+

Added: branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerRaw/muxerRaw.h
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerRaw/muxerRaw.h	2009-05-16 12:48:26 UTC (rev 4837)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerRaw/muxerRaw.h	2009-05-19 17:41:29 UTC (rev 4838)
@@ -0,0 +1,35 @@
+/***************************************************************************
+                          \file MuxerRaw
+                             -------------------
+    
+    copyright            : (C) 2009 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#ifndef ADM_MUXER_RAW
+#define ADM_MUXER_RAW
+
+#include "ADM_muxer.h"
+
+class muxerRaw : public ADM_muxer
+{
+protected:
+                FILE *file;
+public:
+                muxerRaw();
+        virtual ~muxerRaw();
+        virtual bool open(const char *file, ADM_videoStream *s,uint32_t nbAudioTrack,ADM_audioStream **a);
+        virtual bool save(void) ;
+        virtual bool close(void) ;
+
+};
+
+#endif
\ No newline at end of file



From mean at mail.berlios.de  Tue May 19 19:41:31 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 19 May 2009 19:41:31 +0200
Subject: [Avidemux-svn-commit] r4839 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905191741.n4JHfVab030024@sheep.berlios.de>

Author: mean
Date: 2009-05-19 19:41:31 +0200 (Tue, 19 May 2009)
New Revision: 4839

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.h
Log:
[TsPacket] Be more verbose

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp	2009-05-19 17:41:29 UTC (rev 4838)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp	2009-05-19 17:41:31 UTC (rev 4839)
@@ -131,8 +131,9 @@
     uint8_t r=_file->peek8i();
     if(r!=TS_MARKER)
     {
+
+        printf("[tsPacket] Sync lost (0x%x)\n",r);
 #ifdef TS_DEBUG1
-        printf("[tsPacket] Sync lost (0x%x)\n",r);
 #endif
         goto again;
     }
@@ -314,7 +315,7 @@
 nextPack3:
     // Sync at source
     if(false==getNextPacket_NoHeader(pes->pid,&pkt,false)) return false;    
-    // If it does not contain a payload strat continue
+    // If it does not contain a payload start continue
     if(!pkt.payloadStart)
     {
         printf("[Ts Demuxer] Pes for Pid =0x%d does not contain payload start\n",pes->pid);
@@ -329,8 +330,8 @@
     zprintf("[TS Demuxer] Code=0x%x pid=0x%x\n",code,pes->pid);
     if((code&0xffffff00)!=0x100)
     {
-        zprintf("[Ts Demuxer] No PES startcode at 0x%"LLX"\n",pkt.startAt);
-        zprintf("0x:%02x %02x %02x %02x\n",pkt.payload[4],pkt.payload[5],pkt.payload[6],pkt.payload[7]);
+        printf("[Ts Demuxer] No PES startcode at 0x%"LLX"\n",pkt.startAt);
+        printf("0x:%02x %02x %02x %02x\n",pkt.payload[4],pkt.payload[5],pkt.payload[6],pkt.payload[7]);
         goto nextPack3;
     }
     //mixDump(pkt.payload,pkt.payloadSize);
@@ -388,8 +389,11 @@
     pes->dts=ADM_NO_PTS;
     pes->pts=ADM_NO_PTS;
 
-    if(pes->payloadSize<(4+2+1+2)) return false;
-    
+    if(pes->payloadSize<(4+2+1+2)) 
+    {
+            printf("[Ts] Pes size too small\n");
+            return false;
+    }
     while(*start==0xff && start<end) start++; // Padding
     if(start>=end) fail("too much padding");
 
@@ -409,7 +413,7 @@
                 case 2: // PTS=1 DTS=0
                        
                         {
-                                if(available<5) return false;
+                                if(available<5) fail("Not enough bytes for PTS");
                                 uint64_t pts1,pts2,pts0;
                                 //      printf("\n PTS10\n");
                                         pts0=start[0];  
@@ -422,7 +426,7 @@
                         }
                         break;
                 case 3: // PTS=1 DTS=1
-                                if(available<10) return false;
+                                if(available<10) fail("Not enough bytes for PTS/DTS");
                                 #define PTS11_ADV 10 // nut monkey
                                 if(len>=PTS11_ADV)
                                 {
@@ -464,7 +468,8 @@
             if(packLen<sizeCheck) 
             {
                 tail=sizeCheck-packLen;
-                pes->payloadSize-=tail;
+                pes->payloadSize-=tail; 
+                printf("[TS Packet]extra crap at the end %d\n",tail);
             }
             else
                 if(packLen>sizeCheck)

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.h
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.h	2009-05-19 17:41:29 UTC (rev 4838)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.h	2009-05-19 17:41:31 UTC (rev 4839)
@@ -66,8 +66,9 @@
     bool        fresh; // True if we just filled it with a new packet
                 TS_PESpacket(uint32_t pid)
                 {
-                    payload=(uint8_t *)ADM_alloc(2048);
-                    payloadLimit=2048;
+#define PES_DEF_SIZE (5*1024)
+                    payload=(uint8_t *)ADM_alloc(PES_DEF_SIZE);
+                    payloadLimit=PES_DEF_SIZE;
                     offset=0;
                     payloadSize=0;
                     this->pid=pid;
@@ -81,11 +82,13 @@
                 {
                     if(len+payloadSize>payloadLimit)
                     {
+                       // printf("[Ts] Realloc %d -> %d\n",payloadLimit,payloadLimit*2);
                         payloadLimit*=2;
                         payload=(uint8_t *)ADM_realloc(payload,payloadLimit);
                     }
                     memcpy(payload+payloadSize,data,len);
                     payloadSize+=len;
+                    return true;
                 }
 };
 



From mean at mail.berlios.de  Tue May 19 19:41:33 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 19 May 2009 19:41:33 +0200
Subject: [Avidemux-svn-commit] r4840 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905191741.n4JHfXEI030035@sheep.berlios.de>

Author: mean
Date: 2009-05-19 19:41:32 +0200 (Tue, 19 May 2009)
New Revision: 4840

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsReadIndex.cpp
Log:
[TsDemuxer] Fix IDR frame handling (do not drop the whole pack)

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsReadIndex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsReadIndex.cpp	2009-05-19 17:41:31 UTC (rev 4839)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsReadIndex.cpp	2009-05-19 17:41:32 UTC (rev 4840)
@@ -103,6 +103,7 @@
             }
             
             char *start=strstr(buffer," I:");
+            if(!start) start=strstr(buffer," D:");
             if(!start) return true;
             start+=1;
             int count=0;



From mean at mail.berlios.de  Tue May 19 19:41:36 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 19 May 2009 19:41:36 +0200
Subject: [Avidemux-svn-commit] r4842 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905191741.n4JHfa6U030057@sheep.berlios.de>

Author: mean
Date: 2009-05-19 19:41:35 +0200 (Tue, 19 May 2009)
New Revision: 4842

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_ts.cpp
Log:
[TsDemuxer] Remap IDR to I if there are any

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_ts.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_ts.cpp	2009-05-19 17:41:34 UTC (rev 4841)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_ts.cpp	2009-05-19 17:41:35 UTC (rev 4842)
@@ -133,11 +133,23 @@
 bool tsHeader::updateIdr()
 {
     int nbIdr=0;
+    int nbI=0,nbP=0,nbB=0;
     if(!ListOfFrames.size()) return false;
     for(int i=0;i<ListOfFrames.size();i++)
     {
-        if(ListOfFrames[i]->type==4) nbIdr++;
+        int type=ListOfFrames[i]->type;
+        switch(type)
+        {
+            case 1: nbI++;break;
+            case 2: nbP++;break;
+            case 3: nbB++;break;
+            case 4: nbIdr++;break;
+            default:
+                    ADM_assert(0);
+                    break;
+        }
     }
+    printf("[TsDemuxer] Found %d I, %d B, %d P\n",nbI,nbB,nbP);
     printf("[TsH264] Found %d IDR\n",nbIdr);
     if(nbIdr) // Change IDR to I and I to P...
     { 
@@ -147,7 +159,9 @@
             switch(ListOfFrames[i]->type)
             {
                 case 4: ListOfFrames[i]->type=1;break;
-                case 1: ListOfFrames[i]->type=2;break;
+                case 1: 
+                        if(i)
+                            ListOfFrames[i]->type=2;break;
                 default: break;
             }
         }



From mean at mail.berlios.de  Tue May 19 19:41:37 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 19 May 2009 19:41:37 +0200
Subject: [Avidemux-svn-commit] r4843 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs
Message-ID: <200905191741.n4JHfbRH030067@sheep.berlios.de>

Author: mean
Date: 2009-05-19 19:41:37 +0200 (Tue, 19 May 2009)
New Revision: 4843

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_codec.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h
Log:
[Codec] add flush method to reset the decoders (used for seeking)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_codec.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_codec.h	2009-05-19 17:41:35 UTC (rev 4842)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_codec.h	2009-05-19 17:41:37 UTC (rev 4843)
@@ -91,6 +91,10 @@
   {
     return 1;
   };
+  virtual bool flush(void)
+    {
+        return true;
+    }
 };
 /* Dummy decoder in case we don't have the desired one */
 class decoderEmpty : public decoders

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp	2009-05-19 17:41:35 UTC (rev 4842)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.cpp	2009-05-19 17:41:37 UTC (rev 4843)
@@ -323,7 +323,18 @@
   printf ("\n[lavc] full decoding\n");
   return 1;
 }
+
 /**
+    \fn flush
+    \brief empty internal buffer
+*/
+bool    decoderFF::flush(void)
+{
+    if(_context)
+        avcodec_flush_buffers(_context);
+    return true;
+}
+/**
     \fn uncompress
     \brief Actually decode an image
 */

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h	2009-05-19 17:41:35 UTC (rev 4842)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h	2009-05-19 17:41:37 UTC (rev 4843)
@@ -70,7 +70,7 @@
   virtual uint32_t getSpecificMpeg4Info (void);
   virtual uint8_t getPARWidth (void);
   virtual uint8_t getPARHeight (void);
-  
+  virtual bool    flush(void);
 };
 
 class decoderFFDiv3:public decoderFF



From mean at mail.berlios.de  Tue May 19 19:41:38 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 19 May 2009 19:41:38 +0200
Subject: [Avidemux-svn-commit] r4844 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905191741.n4JHfc8s030079@sheep.berlios.de>

Author: mean
Date: 2009-05-19 19:41:38 +0200 (Tue, 19 May 2009)
New Revision: 4844

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsAudio.cpp
Log:
[TsAudio] Cosmetic

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsAudio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsAudio.cpp	2009-05-19 17:41:37 UTC (rev 4843)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsAudio.cpp	2009-05-19 17:41:38 UTC (rev 4844)
@@ -128,7 +128,6 @@
     if(false==demuxer.getNextPES(packet)) return false;
     int avail=packet->payloadSize-packet->offset;
     if(avail>maxSize) ADM_assert(0);
-    *dts=packet->pts;
     *size=avail;
     memcpy(buffer,packet->payload+packet->offset,avail);
     *dts=timeConvert(packet->pts);



From mean at mail.berlios.de  Tue May 19 19:41:34 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 19 May 2009 19:41:34 +0200
Subject: [Avidemux-svn-commit] r4841 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905191741.n4JHfYOd030047@sheep.berlios.de>

Author: mean
Date: 2009-05-19 19:41:34 +0200 (Tue, 19 May 2009)
New Revision: 4841

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp
Log:
[TsDemuxer] Add sei (informative)

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp	2009-05-19 17:41:32 UTC (rev 4840)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp	2009-05-19 17:41:34 UTC (rev 4841)
@@ -352,6 +352,21 @@
           switch(startCode)
                   {
                   case NAL_SEI:
+                    {
+                        uint32_t sei_type=pkt->readi8();
+                                if(sei_type!=6) break;
+                        uint32_t sei_size=pkt->readi8();
+                                if(sei_size==0xff) sei_size=0xff00+pkt->readi8(); // should be enough
+                        uint8_t buffer1[sei_size];
+                        uint8_t buffer2[sei_size];
+                        GetBitContext s;
+                                unescapeH264(sei_size,buffer1,buffer2);
+                                init_get_bits(&s, buffer2, sei_size*8);
+                                zprintf(" [SEI]   recovery_frame_cnt: %u\n", get_ue_golomb(&s));
+                                
+
+
+                    }
                             break;
                   case NAL_AU_DELIMITER:
                           pic_started = false;
@@ -368,6 +383,7 @@
                           break;
 
                   case NAL_IDR:
+                    zprintf("KOWABOUNGA\n");
                   case NAL_NON_IDR:
                     {
 #define NON_IDR_PRE_READ 8



From mean at mail.berlios.de  Wed May 20 21:31:05 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 20 May 2009 21:31:05 +0200
Subject: [Avidemux-svn-commit] r4845 - in branches/avidemux_2.6_branch_mean:
	cmake plugins/ADM_audioDecoders/ADM_ad_dca
	plugins/ADM_audioDecoders/ADM_ad_vorbis
Message-ID: <200905201931.n4KJV5aj013828@sheep.berlios.de>

Author: mean
Date: 2009-05-20 21:31:04 +0200 (Wed, 20 May 2009)
New Revision: 4845

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admCheckDca.cmake
   branches/avidemux_2.6_branch_mean/plugins/ADM_audioDecoders/ADM_ad_dca/ADM_dca.cpp
   branches/avidemux_2.6_branch_mean/plugins/ADM_audioDecoders/ADM_ad_vorbis/CMakeLists.txt
Log:
[Plugin/dca/vorbis] Fix build

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckDca.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckDca.cmake	2009-05-19 17:41:38 UTC (rev 4844)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckDca.cmake	2009-05-20 19:31:04 UTC (rev 4845)
@@ -14,10 +14,12 @@
 			ENDIF (UNIX)
 
 			SET(LIBDCA_VERSION 005)
+		        MESSAGE(STATUS "Trying libdca 0.5")
 
 			FIND_HEADER_AND_LIB(LIBDCA_005 dca.h dca dca_init ${LIBDCA_REQUIRED_FLAGS})
 
 			IF (NOT LIBDCA_005_FOUND)
+		                MESSAGE(STATUS "Trying libdca 0.2")
 				SET(LIBDCA_VERSION 002)
 				FIND_HEADER_AND_LIB(LIBDCA_002 dts.h dts dts_init ${LIBDCA_REQUIRED_FLAGS})
 			ENDIF (NOT LIBDCA_005_FOUND)
@@ -39,4 +41,4 @@
 
 		MESSAGE("")
 	ENDIF (NOT LIBDCA_CHECKED)
-ENDMACRO(checkDca)
\ No newline at end of file
+ENDMACRO(checkDca)

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_audioDecoders/ADM_ad_dca/ADM_dca.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_audioDecoders/ADM_ad_dca/ADM_dca.cpp	2009-05-19 17:41:38 UTC (rev 4844)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_audioDecoders/ADM_ad_dca/ADM_dca.cpp	2009-05-20 19:31:04 UTC (rev 4845)
@@ -174,48 +174,48 @@
 		switch (flags & DTS(CHANNEL_MASK)) 
 		{
 			case DTS(MONO):
-				*(p_ch_type++) = CH_MONO;
+				*(p_ch_type++) =ADM_CH_MONO;
 			break;
 			case DTS(STEREO):
 			case DTS(DOLBY):
-				*(p_ch_type++) = CH_FRONT_LEFT;
-				*(p_ch_type++) = CH_FRONT_RIGHT;
+				*(p_ch_type++) =ADM_CH_FRONT_LEFT;
+				*(p_ch_type++) =ADM_CH_FRONT_RIGHT;
 			break;
 			case DTS(3F):
-				*(p_ch_type++) = CH_FRONT_CENTER;
-				*(p_ch_type++) = CH_FRONT_LEFT;
-				*(p_ch_type++) = CH_FRONT_RIGHT;
+				*(p_ch_type++) =ADM_CH_FRONT_CENTER;
+				*(p_ch_type++) =ADM_CH_FRONT_LEFT;
+				*(p_ch_type++) =ADM_CH_FRONT_RIGHT;
 			break;
 			case DTS(2F1R):
-				*(p_ch_type++) = CH_FRONT_LEFT;
-				*(p_ch_type++) = CH_FRONT_RIGHT;
-				*(p_ch_type++) = CH_REAR_CENTER;
+				*(p_ch_type++) =ADM_CH_FRONT_LEFT;
+				*(p_ch_type++) =ADM_CH_FRONT_RIGHT;
+				*(p_ch_type++) =ADM_CH_REAR_CENTER;
 			break;
 			case DTS(3F1R):
-				*(p_ch_type++) = CH_FRONT_CENTER;
-				*(p_ch_type++) = CH_FRONT_LEFT;
-				*(p_ch_type++) = CH_FRONT_RIGHT;
-				*(p_ch_type++) = CH_REAR_CENTER;
+				*(p_ch_type++) =ADM_CH_FRONT_CENTER;
+				*(p_ch_type++) =ADM_CH_FRONT_LEFT;
+				*(p_ch_type++) =ADM_CH_FRONT_RIGHT;
+				*(p_ch_type++) =ADM_CH_REAR_CENTER;
 			break;
 			case DTS(2F2R):
-				*(p_ch_type++) = CH_FRONT_LEFT;
-				*(p_ch_type++) = CH_FRONT_RIGHT;
-				*(p_ch_type++) = CH_REAR_LEFT;
-				*(p_ch_type++) = CH_REAR_RIGHT;
+				*(p_ch_type++) =ADM_CH_FRONT_LEFT;
+				*(p_ch_type++) =ADM_CH_FRONT_RIGHT;
+				*(p_ch_type++) =ADM_CH_REAR_LEFT;
+				*(p_ch_type++) =ADM_CH_REAR_RIGHT;
 			break;
 			case DTS(3F2R):
-				*(p_ch_type++) = CH_FRONT_CENTER;
-				*(p_ch_type++) = CH_FRONT_LEFT;
-				*(p_ch_type++) = CH_FRONT_RIGHT;
-				*(p_ch_type++) = CH_REAR_LEFT;
-				*(p_ch_type++) = CH_REAR_RIGHT;
+				*(p_ch_type++) =ADM_CH_FRONT_CENTER;
+				*(p_ch_type++) =ADM_CH_FRONT_LEFT;
+				*(p_ch_type++) =ADM_CH_FRONT_RIGHT;
+				*(p_ch_type++) =ADM_CH_REAR_LEFT;
+				*(p_ch_type++) =ADM_CH_REAR_RIGHT;
 			break;
 			default:
 				ADM_assert(0);
 		} // End switch
 		if (flags & DTS(LFE)) 
 		{
-			*(p_ch_type++) = CH_LFE;
+			*(p_ch_type++) =ADM_CH_LFE;
 		}
 	
 

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_audioDecoders/ADM_ad_vorbis/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_audioDecoders/ADM_ad_vorbis/CMakeLists.txt	2009-05-19 17:41:38 UTC (rev 4844)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_audioDecoders/ADM_ad_vorbis/CMakeLists.txt	2009-05-20 19:31:04 UTC (rev 4845)
@@ -12,7 +12,7 @@
         TARGET_LINK_LIBRARIES(ADM_ad_vorbis ${VORBIS_LIBRARY_DIR})
         TARGET_LINK_LIBRARIES(ADM_ad_vorbis ${VORBISENC_LIBRARY_DIR})
 
-        ADD_TARGET_CFLAGS(ADM_ad_vorbis "-I${VORBIS_INCLUDE_DIR}")
+        include_directories(${VORBIS_INCLUDE_DIR})
 
         INIT_AUDIO_PLUGIN(ADM_ad_vorbis)
         INSTALL_AUDIODECODER(ADM_ad_vorbis)



From mean at mail.berlios.de  Wed May 20 21:31:06 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 20 May 2009 21:31:06 +0200
Subject: [Avidemux-svn-commit] r4846 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Matroska
Message-ID: <200905201931.n4KJV6sJ013839@sheep.berlios.de>

Author: mean
Date: 2009-05-20 21:31:06 +0200 (Wed, 20 May 2009)
New Revision: 4846

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Matroska/mkv_tagenum.h
Log:
[Demuxer/mkv] Add the MKV_NAME tag

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Matroska/mkv_tagenum.h
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Matroska/mkv_tagenum.h	2009-05-20 19:31:04 UTC (rev 4845)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Matroska/mkv_tagenum.h	2009-05-20 19:31:06 UTC (rev 4846)
@@ -125,6 +125,7 @@
    MKTAG(MKV_DISPLAY_WIDTH,0x54B0,ADM_MKV_TYPE_UINTEGER),
    MKTAG(MKV_DISPLAY_HEIGHT,0x54BA,ADM_MKV_TYPE_UINTEGER),
    MKTAG(MKV_FLAG_INTERLACED,0x9A,ADM_MKV_TYPE_UINTEGER),
+   MKTAG(MKV_NAME,0x536e,ADM_MKV_TYPE_UTF8),
 
 
          //*************************



From mean at mail.berlios.de  Wed May 20 21:31:08 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 20 May 2009 21:31:08 +0200
Subject: [Avidemux-svn-commit] r4847 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerRaw
Message-ID: <200905201931.n4KJV8kH013851@sheep.berlios.de>

Author: mean
Date: 2009-05-20 21:31:08 +0200 (Wed, 20 May 2009)
New Revision: 4847

Added:
   branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerRaw/muxerRawPlugin.cpp
Log:
[Muxer] Raw video only muxer

Added: branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerRaw/muxerRawPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerRaw/muxerRawPlugin.cpp	2009-05-20 19:31:06 UTC (rev 4846)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_muxers/muxerRaw/muxerRawPlugin.cpp	2009-05-20 19:31:08 UTC (rev 4847)
@@ -0,0 +1,32 @@
+/***************************************************************************
+    copyright            : (C) 2007 by mean
+    email                : fixounet at free.fr
+    
+      See lavformat/flv[dec/env].c for detail
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "ADM_default.h"
+#include "ADM_muxerInternal.h"
+#include "muxerRaw.h"
+
+#include "fourcc.h"
+static bool rawConfigure(void) {return true;};
+
+ADM_MUXER_BEGIN( muxerRaw,
+                    1,0,0,
+                    "RAW",    // Internal name
+                    "RAW muxer plugin (c) Mean 2008",
+                    "Video Only", // DIsplay name
+                    rawConfigure,
+                    NULL,0
+                    
+                );
+



From mean at mail.berlios.de  Thu May 21 09:55:29 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 21 May 2009 09:55:29 +0200
Subject: [Avidemux-svn-commit] r4848 - in
	branches/avidemux_2.5_branch_gruntster/cmake: . patches
Message-ID: <200905210755.n4L7tTQR017279@sheep.berlios.de>

Author: mean
Date: 2009-05-21 09:55:29 +0200 (Thu, 21 May 2009)
New Revision: 4848

Added:
   branches/avidemux_2.5_branch_gruntster/cmake/patches/common.mak.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/patch_config.mak
Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegUtil.cmake
Log:
[ffmpeg] change libxxx to libADM5xxx to avoid clash with system libs

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2009-05-20 19:31:08 UTC (rev 4847)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2009-05-21 07:55:29 UTC (rev 4848)
@@ -98,6 +98,9 @@
 	execute_process(COMMAND sh ${FFMPEG_SOURCE_DIR}/configure ${FFMPEG_FLAGS}
 					WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}"
 					${ffmpegBuildOutput})
+        execute_process(COMMAND ${PATCH_EXECUTABLE} -p0 -i "${CMAKE_SOURCE_DIR}/cmake/patches/patch_config.mak"
+					WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}")
+
 	message("")
 endif (FFMPEG_PERFORM_BUILD)
 
@@ -146,4 +149,4 @@
 add_custom_target(cleanffmpeg
 				  COMMAND ${CMAKE_COMMAND} -P "${CMAKE_SOURCE_DIR}/cmake/admFFmpegClean.cmake"
 				  WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}"
-				  COMMENT "Cleaning FFmpeg")
\ No newline at end of file
+				  COMMENT "Cleaning FFmpeg")

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegUtil.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegUtil.cmake	2009-05-20 19:31:08 UTC (rev 4847)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegUtil.cmake	2009-05-21 07:55:29 UTC (rev 4848)
@@ -10,24 +10,26 @@
 	getFfmpegVersionFromHeader("libavutil" "${sourceDir}/libavutil/avutil.h" LIBAVUTIL_VERSION_MAJOR LIBAVUTIL_VERSION)
 	getFfmpegVersionFromHeader("libpostproc" "${sourceDir}/libpostproc/postprocess.h" LIBPOSTPROC_VERSION_MAJOR LIBPOSTPROC_VERSION)
 	getFfmpegVersionFromHeader("libswscale" "${sourceDir}/libswscale/swscale.h" LIBSWSCALE_VERSION_MAJOR LIBSWSCALE_VERSION)
+        
+        set(LIBAVCODEC_ADM ADM5)
 
 	if (APPLE)
-		set(LIBAVCODEC_LIB libavcodec.${LIBAVCODEC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
-		set(LIBAVFORMAT_LIB libavformat.${LIBAVFORMAT_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
-		set(LIBAVUTIL_LIB libavutil.${LIBAVUTIL_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
-		set(LIBPOSTPROC_LIB libpostproc.${LIBPOSTPROC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
-		set(LIBSWSCALE_LIB libswscale.${LIBSWSCALE_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})	
+		set(LIBAVCODEC_LIB lib${LIBAVCODEC_ADM}avcodec.${LIBAVCODEC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBAVFORMAT_LIB lib${LIBAVCODEC_ADM}avformat.${LIBAVFORMAT_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBAVUTIL_LIB lib${LIBAVCODEC_ADM}avutil.${LIBAVUTIL_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBPOSTPROC_LIB lib${LIBAVCODEC_ADM}postproc.${LIBPOSTPROC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBSWSCALE_LIB lib${LIBAVCODEC_ADM}swscale.${LIBSWSCALE_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})	
 	elseif (UNIX)
-		set(LIBAVCODEC_LIB libavcodec${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBAVCODEC_VERSION})
-		set(LIBAVFORMAT_LIB libavformat${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBAVFORMAT_VERSION})
-		set(LIBAVUTIL_LIB libavutil${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBAVUTIL_VERSION})
-		set(LIBPOSTPROC_LIB libpostproc${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBPOSTPROC_VERSION})
-		set(LIBSWSCALE_LIB libswscale${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBSWSCALE_VERSION})
+		set(LIBAVCODEC_LIB lib${LIBAVCODEC_ADM}avcodec${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBAVCODEC_VERSION})
+		set(LIBAVFORMAT_LIB lib${LIBAVCODEC_ADM}avformat${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBAVFORMAT_VERSION})
+		set(LIBAVUTIL_LIB lib${LIBAVCODEC_ADM}avutil${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBAVUTIL_VERSION})
+		set(LIBPOSTPROC_LIB lib${LIBAVCODEC_ADM}postproc${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBPOSTPROC_VERSION})
+		set(LIBSWSCALE_LIB lib${LIBAVCODEC_ADM}swscale${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBSWSCALE_VERSION})
 	else (APPLE)
-		set(LIBAVCODEC_LIB avcodec-${LIBAVCODEC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
-		set(LIBAVFORMAT_LIB avformat-${LIBAVFORMAT_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
-		set(LIBAVUTIL_LIB avutil-${LIBAVUTIL_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
-		set(LIBPOSTPROC_LIB postproc-${LIBPOSTPROC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
-		set(LIBSWSCALE_LIB swscale-${LIBSWSCALE_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBAVCODEC_LIB ${LIBAVCODEC_ADM}avcodec-${LIBAVCODEC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBAVFORMAT_LIB ${LIBAVCODEC_ADM}avformat-${LIBAVFORMAT_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBAVUTIL_LIB ${LIBAVCODEC_ADM}avutil-${LIBAVUTIL_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBPOSTPROC_LIB ${LIBAVCODEC_ADM}postproc-${LIBPOSTPROC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBSWSCALE_LIB ${LIBAVCODEC_ADM}swscale-${LIBSWSCALE_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
 	endif (APPLE)
-ENDMACRO (getFfmpegLibNames)
\ No newline at end of file
+ENDMACRO (getFfmpegLibNames)

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/common.mak.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/common.mak.patch	2009-05-20 19:31:08 UTC (rev 4847)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/common.mak.patch	2009-05-21 07:55:29 UTC (rev 4848)
@@ -0,0 +1,13 @@
+Index: common.mak
+===================================================================
+--- common.mak	(revision 18300)
++++ common.mak	(working copy)
+@@ -62,7 +62,7 @@
+ FFLIBS    := $(FFLIBS-yes) $(FFLIBS)
+ TESTPROGS += $(TESTPROGS-yes)
+ 
+-FFEXTRALIBS := $(addprefix -l,$(addsuffix $(BUILDSUF),$(FFLIBS))) $(EXTRALIBS)
++FFEXTRALIBS := $(addprefix -lADM5,$(addsuffix $(BUILDSUF),$(FFLIBS))) $(EXTRALIBS)
+ FFLDFLAGS   := $(addprefix -L$(BUILD_ROOT)/lib,$(ALLFFLIBS)) $(LDFLAGS)
+ 
+ EXAMPLES  := $(addprefix $(SUBDIR),$(addsuffix -example$(EXESUF),$(EXAMPLES)))

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/patch_config.mak
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/patch_config.mak	2009-05-20 19:31:08 UTC (rev 4847)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/patch_config.mak	2009-05-21 07:55:29 UTC (rev 4848)
@@ -0,0 +1,11 @@
+--- config.mak.old	2009-05-01 19:26:13.808782802 +0200
++++ config.mak	2009-05-01 18:10:25.000085291 +0200
+@@ -60,7 +60,7 @@
+ BUILD_SHARED=yes
+ PIC=-fPIC -DPIC
+ LIBTARGET=
+-SLIBNAME=$(SLIBPREF)$(FULLNAME)$(SLIBSUF)
++SLIBNAME=$(SLIBPREF)ADM5$(FULLNAME)$(SLIBSUF)
+ SLIBNAME_WITH_VERSION=$(SLIBNAME).$(LIBVERSION)
+ SLIBNAME_WITH_MAJOR=$(SLIBNAME).$(LIBMAJOR)
+ SLIB_CREATE_DEF_CMD=



From mean at mail.berlios.de  Thu May 21 10:26:37 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 21 May 2009 10:26:37 +0200
Subject: [Avidemux-svn-commit] r4849 -
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_matroska
Message-ID: <200905210826.n4L8QbZt020964@sheep.berlios.de>

Author: mean
Date: 2009-05-21 10:26:37 +0200 (Thu, 21 May 2009)
New Revision: 4849

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp
Log:
[audio] Decoded DTS Header to update #of channels

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp	2009-05-21 07:55:29 UTC (rev 4848)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp	2009-05-21 08:26:37 UTC (rev 4849)
@@ -29,6 +29,7 @@
 
 #include "ADM_mkv.h"
 #include "ADM_audio/ADM_a52info.h"
+#include "ADM_audio/ADM_dcainfo.h"
 #define vprintf(...) {}
 
 /**
@@ -324,6 +325,22 @@
      }
      goToCluster(0);
   }
+if(_wavheader->encoding==WAV_DTS)
+  {
+    uint8_t ac3Buffer[20000];
+    uint32_t len,sample,timecode;
+     if( getPacket(ac3Buffer, &len, &sample,&timecode))
+     {
+       uint32_t fq,br,chan,syncoff,flags,nbsample;
+        if( ADM_DCAGetInfo(ac3Buffer, len, &fq, &br, &chan,&syncoff,&flags,&nbsample) )
+        {
+            _wavheader->channels=chan;
+            _wavheader->frequency=fq;
+            _wavheader->byterate=br;
+        }
+     }
+     goToCluster(0);
+  }
 }
 /**
     \fn goToCluster



From mean at mail.berlios.de  Thu May 21 10:35:54 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 21 May 2009 10:35:54 +0200
Subject: [Avidemux-svn-commit] r4850 -
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render
Message-ID: <200905210835.n4L8Zsob021972@sheep.berlios.de>

Author: mean
Date: 2009-05-21 10:35:54 +0200 (Thu, 21 May 2009)
New Revision: 4850

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_xvRender.cpp
Log:
[Renderer] Fix xv output

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_xvRender.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_xvRender.cpp	2009-05-21 08:26:37 UTC (rev 4849)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_render/GUI_xvRender.cpp	2009-05-21 08:35:54 UTC (rev 4850)
@@ -252,11 +252,8 @@
 	  printf("\n no port found");
 	  goto failed;
       }
-#ifdef 	COLORSPACE_YV12
+
     printf("\n Xv YV12 found at port :%d, format : %ld", port, xv_format);
-#else
-    printf("\n Xv YUY2 found at port :%d, format : %ld", port, xv_format);
-#endif
 
     if (Success != XvGrabPort(WDN, port, 0))
 	goto failed;
@@ -351,11 +348,8 @@
 	      printf("\n %lx %d --> %s", port, formatValues[k].id,
 		     formatValues[k].guid);
 #endif
-#ifdef 	COLORSPACE_YV12
+
 	      if (!strcmp(formatValues[k].guid, "YV12"))
-#else
-	      if (!strcmp(formatValues[k].guid, "YUY2"))
-#endif
 		{
 		    f = 1;
 		    *fmt = formatValues[k].id;



From mean at mail.berlios.de  Thu May 21 12:01:18 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 21 May 2009 12:01:18 +0200
Subject: [Avidemux-svn-commit] r4851 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Matroska
Message-ID: <200905211001.n4LA1IKu031470@sheep.berlios.de>

Author: mean
Date: 2009-05-21 12:01:17 +0200 (Thu, 21 May 2009)
New Revision: 4851

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Matroska/ADM_mkv_audio.cpp
Log:
[Matroska] Detect DTS # of channels

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Matroska/ADM_mkv_audio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Matroska/ADM_mkv_audio.cpp	2009-05-21 08:35:54 UTC (rev 4850)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Matroska/ADM_mkv_audio.cpp	2009-05-21 10:01:17 UTC (rev 4851)
@@ -17,6 +17,7 @@
 
 #include "ADM_mkv.h"
 #include "ADM_a52info.h"
+#include "ADM_dcainfo.h"
 
 #define vprintf(...) {}
 
@@ -27,6 +28,9 @@
 */
 mkvAccess::mkvAccess(const char *name,mkvTrak *track)
 {
+    uint8_t ac3Buffer[20000];
+    uint32_t len,sample;
+    uint64_t timecode;
 
    _parser=new ADM_ebml_file();
    ADM_assert(_parser->open(name));
@@ -39,9 +43,6 @@
   /* In case of AC3, do not trust the header...*/
   if(_track->wavHeader.encoding==WAV_AC3)
   {
-    uint8_t ac3Buffer[20000];
-    uint32_t len,sample;
-    uint64_t timecode;
      if( getPacket(ac3Buffer, &len, 20000,&timecode))
      {
        uint32_t fq,br,chan,syncoff;
@@ -54,6 +55,23 @@
      }
      goToBlock(0);
   }
+
+  if(_track->wavHeader.encoding==WAV_DTS)
+  {
+     if( getPacket(ac3Buffer, &len, 20000,&timecode))
+     {
+       uint32_t fq,br,chan,syncoff,flags,nbsample;
+        if( ADM_DCAGetInfo(ac3Buffer, len, &fq, &br, &chan,&syncoff,&flags,&nbsample) )
+        {
+            track->wavHeader.channels=chan;
+            track->wavHeader.frequency=fq;
+            track->wavHeader.byterate=br;
+        }
+     }
+     goToBlock(0);
+  }
+
+
 }
 /**
     \fn getExtraData



From mean at mail.berlios.de  Thu May 21 12:01:19 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 21 May 2009 12:01:19 +0200
Subject: [Avidemux-svn-commit] r4852 -
	branches/avidemux_2.6_branch_mean/addons/mkvscan
Message-ID: <200905211001.n4LA1J1v031480@sheep.berlios.de>

Author: mean
Date: 2009-05-21 12:01:19 +0200 (Thu, 21 May 2009)
New Revision: 4852

Added:
   branches/avidemux_2.6_branch_mean/addons/mkvscan/ADM_default.h
Modified:
   branches/avidemux_2.6_branch_mean/addons/mkvscan/CMakeLists.txt
Log:
[mkvScan] Fix build

Added: branches/avidemux_2.6_branch_mean/addons/mkvscan/ADM_default.h
===================================================================
--- branches/avidemux_2.6_branch_mean/addons/mkvscan/ADM_default.h	2009-05-21 10:01:17 UTC (rev 4851)
+++ branches/avidemux_2.6_branch_mean/addons/mkvscan/ADM_default.h	2009-05-21 10:01:19 UTC (rev 4852)
@@ -0,0 +1,12 @@
+#include <stdint.h>
+#include <stdio.h>
+#include <string.h>
+#include <math.h>
+#include <stdlib.h>
+#define ADM_assert(x) if(!(x)){printf("OOPs");}
+#define LU "lu"
+#define LLU "llu"
+#define LD "ld"
+#define LLD "lld"
+#define LX "lx"
+#define LLX "llx"

Modified: branches/avidemux_2.6_branch_mean/addons/mkvscan/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/addons/mkvscan/CMakeLists.txt	2009-05-21 10:01:17 UTC (rev 4851)
+++ branches/avidemux_2.6_branch_mean/addons/mkvscan/CMakeLists.txt	2009-05-21 10:01:19 UTC (rev 4852)
@@ -1,14 +1,15 @@
 PROJECT(mkv)
 INCLUDE_DIRECTORIES( .) 
-INCLUDE_DIRECTORIES( ../../avidemux/ADM_inputs/ADM_matroska)
+set(MKV ../../plugins/ADM_demuxers/Matroska/)
+INCLUDE_DIRECTORIES( ${MKV})
 #LINK_DIRECTORIES(${ITK_LIBRARY_DIRS})
 ADD_DEFINITIONS("-g")
 
 
 SET(sources
-../../avidemux/ADM_inputs/ADM_matroska/ebml.cpp 
+${MKV}ebml.cpp 
 mkv_c.cpp 
-../../avidemux/ADM_inputs/ADM_matroska/mkv_tags.cpp
+${MKV}mkv_tags.cpp
 )
 
 



From mean at mail.berlios.de  Thu May 21 12:01:21 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 21 May 2009 12:01:21 +0200
Subject: [Avidemux-svn-commit] r4853 - in branches/avidemux_2.6_branch_mean:
	avidemux cmake
Message-ID: <200905211001.n4LA1LdL031490@sheep.berlios.de>

Author: mean
Date: 2009-05-21 12:01:21 +0200 (Thu, 21 May 2009)
New Revision: 4853

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/main.cpp
   branches/avidemux_2.6_branch_mean/cmake/ad_plugin.cmake
   branches/avidemux_2.6_branch_mean/cmake/ae_plugin.cmake
   branches/avidemux_2.6_branch_mean/cmake/av_plugin.cmake
   branches/avidemux_2.6_branch_mean/cmake/dm_plugin.cmake
   branches/avidemux_2.6_branch_mean/cmake/mx_plugin.cmake
   branches/avidemux_2.6_branch_mean/cmake/vf_plugin.cmake
Log:
[Plugin] Rename ADM_plugin to ADM_plugin6 to avoid clash with avidemux2.5

Modified: branches/avidemux_2.6_branch_mean/avidemux/main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/main.cpp	2009-05-21 10:01:19 UTC (rev 4852)
+++ branches/avidemux_2.6_branch_mean/avidemux/main.cpp	2009-05-21 10:01:21 UTC (rev 4853)
@@ -235,12 +235,12 @@
 #else
     const char *startDir="lib";
 #endif
-	char *adPlugins = ADM_getInstallRelativePath(startDir,"ADM_plugins","audioDecoder");
-	char *vfPlugins = ADM_getInstallRelativePath(startDir,"ADM_plugins","videoFilter");
-    char *avPlugins = ADM_getInstallRelativePath(startDir,"ADM_plugins","audioDevices");    
-    char *aePlugins = ADM_getInstallRelativePath(startDir,"ADM_plugins","audioEncoders");    
-    char *dmPlugins = ADM_getInstallRelativePath(startDir,"ADM_plugins","demuxers");    
-    char *mxPlugins = ADM_getInstallRelativePath(startDir,"ADM_plugins","muxers");    
+	char *adPlugins = ADM_getInstallRelativePath(startDir,"ADM_plugins6","audioDecoder");
+	char *vfPlugins = ADM_getInstallRelativePath(startDir,"ADM_plugins6","videoFilter");
+    char *avPlugins = ADM_getInstallRelativePath(startDir,"ADM_plugins6","audioDevices");    
+    char *aePlugins = ADM_getInstallRelativePath(startDir,"ADM_plugins6","audioEncoders");    
+    char *dmPlugins = ADM_getInstallRelativePath(startDir,"ADM_plugins6","demuxers");    
+    char *mxPlugins = ADM_getInstallRelativePath(startDir,"ADM_plugins6","muxers");    
 
     ADM_mx_loadPlugins(mxPlugins);
     delete [] mxPlugins;
@@ -261,12 +261,12 @@
     delete [] dmPlugins;
 
     // load local audio decoder plugins
-	adPlugins=ADM_getHomeRelativePath("plugins","audioDecoder");
+	adPlugins=ADM_getHomeRelativePath("plugins6","audioDecoder");
 	ADM_ad_loadPlugins(adPlugins);
 	delete [] adPlugins;
 
 	// load local video filter plugins
-	vfPlugins=ADM_getHomeRelativePath("plugins","videoFilter");
+	vfPlugins=ADM_getHomeRelativePath("plugins6","videoFilter");
 	ADM_vf_loadPlugins(vfPlugins);
 	delete [] vfPlugins;
 	// load encoder plugins...
@@ -352,4 +352,4 @@
 {
     checkCrashFile();
 }
-//EOF
\ No newline at end of file
+//EOF

Modified: branches/avidemux_2.6_branch_mean/cmake/ad_plugin.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/ad_plugin.cmake	2009-05-21 10:01:19 UTC (rev 4852)
+++ branches/avidemux_2.6_branch_mean/cmake/ad_plugin.cmake	2009-05-21 10:01:21 UTC (rev 4853)
@@ -7,5 +7,5 @@
 ENDMACRO(INIT_AUDIO_PLUGIN)
 
 MACRO(INSTALL_AUDIODECODER _lib)
-	INSTALL(TARGETS ${_lib} DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins/audioDecoder/")
+	INSTALL(TARGETS ${_lib} DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins6/audioDecoder/")
 ENDMACRO(INSTALL_AUDIODECODER)

Modified: branches/avidemux_2.6_branch_mean/cmake/ae_plugin.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/ae_plugin.cmake	2009-05-21 10:01:19 UTC (rev 4852)
+++ branches/avidemux_2.6_branch_mean/cmake/ae_plugin.cmake	2009-05-21 10:01:21 UTC (rev 4853)
@@ -13,6 +13,6 @@
 ENDMACRO(INIT_AUDIO_ENCODER)
 
 MACRO(INSTALL_AUDIOENCODER _lib)
-	INSTALL(TARGETS ${_lib} DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins/audioEncoders/")
+	INSTALL(TARGETS ${_lib} DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins6/audioEncoders/")
 	TARGET_LINK_LIBRARIES(${_lib} ADM_core ADM_coreUI ADM_coreAudio ADM_coreAudioEncoder)
 ENDMACRO(INSTALL_AUDIOENCODER)

Modified: branches/avidemux_2.6_branch_mean/cmake/av_plugin.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/av_plugin.cmake	2009-05-21 10:01:19 UTC (rev 4852)
+++ branches/avidemux_2.6_branch_mean/cmake/av_plugin.cmake	2009-05-21 10:01:21 UTC (rev 4853)
@@ -6,5 +6,5 @@
 ENDMACRO(INIT_AUDIO_DEVICE)
 
 MACRO(INSTALL_AUDIODEVICE _lib)
-	INSTALL(TARGETS ${_lib} DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins/audioDevices/")
+	INSTALL(TARGETS ${_lib} DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins6/audioDevices/")
 ENDMACRO(INSTALL_AUDIODEVICE)

Modified: branches/avidemux_2.6_branch_mean/cmake/dm_plugin.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/dm_plugin.cmake	2009-05-21 10:01:19 UTC (rev 4852)
+++ branches/avidemux_2.6_branch_mean/cmake/dm_plugin.cmake	2009-05-21 10:01:21 UTC (rev 4853)
@@ -10,5 +10,5 @@
 
 MACRO(INSTALL_DEMUXER _lib)
         TARGET_LINK_LIBRARIES(${_lib} ADM_core ADM_coreUtils ADM_coreAudio ADM_coreImage ADM_coreUI ADM_core ADM_coreDemuxer)
-	INSTALL(TARGETS ${_lib} DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins/demuxers/")
+	INSTALL(TARGETS ${_lib} DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins6/demuxers/")
 ENDMACRO(INSTALL_DEMUXER)

Modified: branches/avidemux_2.6_branch_mean/cmake/mx_plugin.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/mx_plugin.cmake	2009-05-21 10:01:19 UTC (rev 4852)
+++ branches/avidemux_2.6_branch_mean/cmake/mx_plugin.cmake	2009-05-21 10:01:21 UTC (rev 4853)
@@ -9,5 +9,5 @@
 
 MACRO(INSTALL_MUXER _lib)
         TARGET_LINK_LIBRARIES(${_lib} ADM_core ADM_coreUtils ADM_coreAudio ADM_coreImage ADM_coreUI ADM_core ADM_coreMuxer)
-	INSTALL(TARGETS ${_lib} DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins/muxers/")
+	INSTALL(TARGETS ${_lib} DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins6/muxers/")
 ENDMACRO(INSTALL_MUXER)

Modified: branches/avidemux_2.6_branch_mean/cmake/vf_plugin.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/vf_plugin.cmake	2009-05-21 10:01:19 UTC (rev 4852)
+++ branches/avidemux_2.6_branch_mean/cmake/vf_plugin.cmake	2009-05-21 10:01:21 UTC (rev 4853)
@@ -8,5 +8,5 @@
 
 MACRO(INSTALL_VIDEOFILTER _lib)
 	TARGET_LINK_LIBRARIES(${_lib} ADM_core ADM_coreUI ADM_coreImage )
-	INSTALL(TARGETS ${_lib} DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins/videoFilter/")
+	INSTALL(TARGETS ${_lib} DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/ADM_plugins6/videoFilter/")
 ENDMACRO(INSTALL_VIDEOFILTER)



From mean at mail.berlios.de  Thu May 21 12:01:22 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 21 May 2009 12:01:22 +0200
Subject: [Avidemux-svn-commit] r4854 -
	branches/avidemux_2.6_branch_mean/addons/mkvscan
Message-ID: <200905211001.n4LA1Ma5031500@sheep.berlios.de>

Author: mean
Date: 2009-05-21 12:01:22 +0200 (Thu, 21 May 2009)
New Revision: 4854

Removed:
   branches/avidemux_2.6_branch_mean/addons/mkvscan/default.h
Modified:
   branches/avidemux_2.6_branch_mean/addons/mkvscan/Makefile
Log:
[mkvScan] Fix build

Modified: branches/avidemux_2.6_branch_mean/addons/mkvscan/Makefile
===================================================================
--- branches/avidemux_2.6_branch_mean/addons/mkvscan/Makefile	2009-05-21 10:01:21 UTC (rev 4853)
+++ branches/avidemux_2.6_branch_mean/addons/mkvscan/Makefile	2009-05-21 10:01:22 UTC (rev 4854)
@@ -1,8 +1,9 @@
 # CMAKE generated file: DO NOT EDIT!
-# Generated by "Unix Makefiles" Generator, CMake Version 2.4
+# Generated by "Unix Makefiles" Generator, CMake Version 2.6
 
 # Default target executed when no arguments are given to make.
 default_target: all
+.PHONY : default_target
 
 #=============================================================================
 # Special targets provided by cmake.
@@ -10,6 +11,9 @@
 # Disable implicit rules so canoncical targets will work.
 .SUFFIXES:
 
+# Remove some rules from gmake that .SUFFIXES does not remove.
+SUFFIXES =
+
 .SUFFIXES: .hpux_make_needs_suffix_list
 
 # Suppress display of executed commands.
@@ -17,6 +21,7 @@
 
 # A target that is always out of date.
 cmake_force:
+.PHONY : cmake_force
 
 #=============================================================================
 # Set environment variables for the build.
@@ -34,14 +39,11 @@
 CMAKE_EDIT_COMMAND = /usr/bin/ccmake
 
 # The top-level source directory on which CMake was run.
-CMAKE_SOURCE_DIR = /home/fx/workspace/avidemux-2.4.0/addons/mkvscan
+CMAKE_SOURCE_DIR = /home/fx/workspace/gitted/addons/mkvscan
 
 # The top-level build directory on which CMake was run.
-CMAKE_BINARY_DIR = /home/fx/workspace/avidemux-2.4.0/addons/mkvscan
+CMAKE_BINARY_DIR = /home/fx/workspace/gitted/addons/mkvscan
 
-# Include the progress variables for this target.
-include CMakeFiles/progress.make
-
 #=============================================================================
 # Targets provided globally by CMake.
 
@@ -49,42 +51,52 @@
 edit_cache:
 	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Running CMake cache editor..."
 	/usr/bin/ccmake -H$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR)
+.PHONY : edit_cache
 
 # Special rule for the target edit_cache
 edit_cache/fast: edit_cache
+.PHONY : edit_cache/fast
 
 # Special rule for the target rebuild_cache
 rebuild_cache:
 	@$(CMAKE_COMMAND) -E cmake_echo_color --switch=$(COLOR) --cyan "Running CMake to regenerate build system..."
 	/usr/bin/cmake -H$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR)
+.PHONY : rebuild_cache
 
 # Special rule for the target rebuild_cache
 rebuild_cache/fast: rebuild_cache
+.PHONY : rebuild_cache/fast
 
 # The main all target
 all: cmake_check_build_system
-	$(CMAKE_COMMAND) -E cmake_progress_start /home/fx/workspace/avidemux-2.4.0/addons/mkvscan/CMakeFiles $(CMAKE_ALL_PROGRESS)
+	$(CMAKE_COMMAND) -E cmake_progress_start /home/fx/workspace/gitted/addons/mkvscan/CMakeFiles /home/fx/workspace/gitted/addons/mkvscan/CMakeFiles/progress.make
 	$(MAKE) -f CMakeFiles/Makefile2 all
-	$(CMAKE_COMMAND) -E cmake_progress_start /home/fx/workspace/avidemux-2.4.0/addons/mkvscan/CMakeFiles 0
+	$(CMAKE_COMMAND) -E cmake_progress_start /home/fx/workspace/gitted/addons/mkvscan/CMakeFiles 0
+.PHONY : all
 
 # The main clean target
 clean:
 	$(MAKE) -f CMakeFiles/Makefile2 clean
+.PHONY : clean
 
 # The main clean target
 clean/fast: clean
+.PHONY : clean/fast
 
 # Prepare targets for installation.
 preinstall: all
 	$(MAKE) -f CMakeFiles/Makefile2 preinstall
+.PHONY : preinstall
 
 # Prepare targets for installation.
 preinstall/fast:
 	$(MAKE) -f CMakeFiles/Makefile2 preinstall
+.PHONY : preinstall/fast
 
 # clear depends
 depend:
 	$(CMAKE_COMMAND) -H$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR) --check-build-system CMakeFiles/Makefile.cmake 1
+.PHONY : depend
 
 #=============================================================================
 # Target rules for targets named mkv
@@ -92,49 +104,60 @@
 # Build rule for target.
 mkv: cmake_check_build_system
 	$(MAKE) -f CMakeFiles/Makefile2 mkv
+.PHONY : mkv
 
 # fast build rule for target.
 mkv/fast:
 	$(MAKE) -f CMakeFiles/mkv.dir/build.make CMakeFiles/mkv.dir/build
+.PHONY : mkv/fast
 
 # target to build an object file
-home/fx/workspace/avidemux-2.4.0/avidemux/ADM_inputs/ADM_matroska/ebml.o:
-	$(MAKE) -f CMakeFiles/mkv.dir/build.make CMakeFiles/mkv.dir/home/fx/workspace/avidemux-2.4.0/avidemux/ADM_inputs/ADM_matroska/ebml.o
+home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/ebml.o:
+	$(MAKE) -f CMakeFiles/mkv.dir/build.make CMakeFiles/mkv.dir/home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/ebml.o
+.PHONY : home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/ebml.o
 
 # target to preprocess a source file
-home/fx/workspace/avidemux-2.4.0/avidemux/ADM_inputs/ADM_matroska/ebml.i:
-	$(MAKE) -f CMakeFiles/mkv.dir/build.make CMakeFiles/mkv.dir/home/fx/workspace/avidemux-2.4.0/avidemux/ADM_inputs/ADM_matroska/ebml.i
+home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/ebml.i:
+	$(MAKE) -f CMakeFiles/mkv.dir/build.make CMakeFiles/mkv.dir/home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/ebml.i
+.PHONY : home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/ebml.i
 
 # target to generate assembly for a file
-home/fx/workspace/avidemux-2.4.0/avidemux/ADM_inputs/ADM_matroska/ebml.s:
-	$(MAKE) -f CMakeFiles/mkv.dir/build.make CMakeFiles/mkv.dir/home/fx/workspace/avidemux-2.4.0/avidemux/ADM_inputs/ADM_matroska/ebml.s
+home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/ebml.s:
+	$(MAKE) -f CMakeFiles/mkv.dir/build.make CMakeFiles/mkv.dir/home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/ebml.s
+.PHONY : home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/ebml.s
 
 # target to build an object file
-home/fx/workspace/avidemux-2.4.0/avidemux/ADM_inputs/ADM_matroska/mkv_tags.o:
-	$(MAKE) -f CMakeFiles/mkv.dir/build.make CMakeFiles/mkv.dir/home/fx/workspace/avidemux-2.4.0/avidemux/ADM_inputs/ADM_matroska/mkv_tags.o
+home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/mkv_tags.o:
+	$(MAKE) -f CMakeFiles/mkv.dir/build.make CMakeFiles/mkv.dir/home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/mkv_tags.o
+.PHONY : home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/mkv_tags.o
 
 # target to preprocess a source file
-home/fx/workspace/avidemux-2.4.0/avidemux/ADM_inputs/ADM_matroska/mkv_tags.i:
-	$(MAKE) -f CMakeFiles/mkv.dir/build.make CMakeFiles/mkv.dir/home/fx/workspace/avidemux-2.4.0/avidemux/ADM_inputs/ADM_matroska/mkv_tags.i
+home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/mkv_tags.i:
+	$(MAKE) -f CMakeFiles/mkv.dir/build.make CMakeFiles/mkv.dir/home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/mkv_tags.i
+.PHONY : home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/mkv_tags.i
 
 # target to generate assembly for a file
-home/fx/workspace/avidemux-2.4.0/avidemux/ADM_inputs/ADM_matroska/mkv_tags.s:
-	$(MAKE) -f CMakeFiles/mkv.dir/build.make CMakeFiles/mkv.dir/home/fx/workspace/avidemux-2.4.0/avidemux/ADM_inputs/ADM_matroska/mkv_tags.s
+home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/mkv_tags.s:
+	$(MAKE) -f CMakeFiles/mkv.dir/build.make CMakeFiles/mkv.dir/home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/mkv_tags.s
+.PHONY : home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/mkv_tags.s
 
 # target to build an object file
 mkv_c.o:
 	$(MAKE) -f CMakeFiles/mkv.dir/build.make CMakeFiles/mkv.dir/mkv_c.o
+.PHONY : mkv_c.o
 
 # target to preprocess a source file
 mkv_c.i:
 	$(MAKE) -f CMakeFiles/mkv.dir/build.make CMakeFiles/mkv.dir/mkv_c.i
+.PHONY : mkv_c.i
 
 # target to generate assembly for a file
 mkv_c.s:
 	$(MAKE) -f CMakeFiles/mkv.dir/build.make CMakeFiles/mkv.dir/mkv_c.s
+.PHONY : mkv_c.s
 
 # Help Target
-help::
+help:
 	@echo "The following are some of the valid targets for this Makefile:"
 	@echo "... all (the default if no target is provided)"
 	@echo "... clean"
@@ -142,15 +165,16 @@
 	@echo "... edit_cache"
 	@echo "... mkv"
 	@echo "... rebuild_cache"
-	@echo "... home/fx/workspace/avidemux-2.4.0/avidemux/ADM_inputs/ADM_matroska/ebml.o"
-	@echo "... home/fx/workspace/avidemux-2.4.0/avidemux/ADM_inputs/ADM_matroska/ebml.i"
-	@echo "... home/fx/workspace/avidemux-2.4.0/avidemux/ADM_inputs/ADM_matroska/ebml.s"
-	@echo "... home/fx/workspace/avidemux-2.4.0/avidemux/ADM_inputs/ADM_matroska/mkv_tags.o"
-	@echo "... home/fx/workspace/avidemux-2.4.0/avidemux/ADM_inputs/ADM_matroska/mkv_tags.i"
-	@echo "... home/fx/workspace/avidemux-2.4.0/avidemux/ADM_inputs/ADM_matroska/mkv_tags.s"
+	@echo "... home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/ebml.o"
+	@echo "... home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/ebml.i"
+	@echo "... home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/ebml.s"
+	@echo "... home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/mkv_tags.o"
+	@echo "... home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/mkv_tags.i"
+	@echo "... home/fx/workspace/gitted/plugins/ADM_demuxers/Matroska/mkv_tags.s"
 	@echo "... mkv_c.o"
 	@echo "... mkv_c.i"
 	@echo "... mkv_c.s"
+.PHONY : help
 
 
 
@@ -162,4 +186,5 @@
 # because they might be regenerated.
 cmake_check_build_system:
 	$(CMAKE_COMMAND) -H$(CMAKE_SOURCE_DIR) -B$(CMAKE_BINARY_DIR) --check-build-system CMakeFiles/Makefile.cmake 0
+.PHONY : cmake_check_build_system
 

Deleted: branches/avidemux_2.6_branch_mean/addons/mkvscan/default.h
===================================================================
--- branches/avidemux_2.6_branch_mean/addons/mkvscan/default.h	2009-05-21 10:01:21 UTC (rev 4853)
+++ branches/avidemux_2.6_branch_mean/addons/mkvscan/default.h	2009-05-21 10:01:22 UTC (rev 4854)
@@ -1 +0,0 @@
-#include <stdint.h>



From mean at mail.berlios.de  Thu May 21 12:01:26 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 21 May 2009 12:01:26 +0200
Subject: [Avidemux-svn-commit] r4856 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_editor
Message-ID: <200905211001.n4LA1QSp031527@sheep.berlios.de>

Author: mean
Date: 2009-05-21 12:01:25 +0200 (Thu, 21 May 2009)
New Revision: 4856

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edFrameType.cpp
Log:
[editor] dont use buffer after freeing

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edFrameType.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edFrameType.cpp	2009-05-21 10:01:24 UTC (rev 4855)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edFrameType.cpp	2009-05-21 10:01:25 UTC (rev 4856)
@@ -61,7 +61,6 @@
         if(flagsDecoded==flags) nbOk++;
             else nbKo++;
     }
-    delete [] buffer;
     printf("[Editor] Muxer has %d frames right, %d frames wrong\n",nbOk,nbKo);
     if(!nbKo)     return true;
     // Demuxer is wrong, rederive all frames...
@@ -73,6 +72,8 @@
         flagsDecoded=id(img.dataLength,img.data);
         demuxer->setFlag(i,flagsDecoded);
     }
+    delete [] buffer;
+    buffer=NULL;
     delete work;
     return false;
 }



From mean at mail.berlios.de  Thu May 21 12:01:24 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 21 May 2009 12:01:24 +0200
Subject: [Avidemux-svn-commit] r4855 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Matroska
Message-ID: <200905211001.n4LA1O78031510@sheep.berlios.de>

Author: mean
Date: 2009-05-21 12:01:24 +0200 (Thu, 21 May 2009)
New Revision: 4855

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Matroska/ADM_mkv.cpp
Log:
[mkv demuxer] dont free several times buffer

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Matroska/ADM_mkv.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Matroska/ADM_mkv.cpp	2009-05-21 10:01:22 UTC (rev 4854)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Matroska/ADM_mkv.cpp	2009-05-21 10:01:24 UTC (rev 4855)
@@ -278,11 +278,13 @@
     {
         for(int i=0;i<_nbAudioTrack;i++) if(_audioStreams[i]) delete _audioStreams[i];
         delete [] _audioStreams;
+        _audioStreams=NULL;
     }
     if(_access)
     {
         for(int i=0;i<_nbAudioTrack;i++) if(_access[i]) delete _access[i];
         delete [] _access;
+        _access=NULL;
     }
 
 }



From mean at mail.berlios.de  Thu May 21 12:01:27 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 21 May 2009 12:01:27 +0200
Subject: [Avidemux-svn-commit] r4857 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs
Message-ID: <200905211001.n4LA1RgK031537@sheep.berlios.de>

Author: mean
Date: 2009-05-21 12:01:27 +0200 (Thu, 21 May 2009)
New Revision: 4857

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp
Log:
[vdpau] proper cleanup + proper initialization of vdpau buffers (avoid weird segfaul)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h	2009-05-21 10:01:25 UTC (rev 4856)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmp43.h	2009-05-21 10:01:27 UTC (rev 4857)
@@ -359,6 +359,7 @@
                     ADMImage *vdpau_copy;
                     uint64_t vdpau_pts;
                     bool     decode_status;
+                    bool     destroying;
 public:     // Callbacks
                     int     getBuffer(AVCodecContext *avctx, AVFrame *pic);
                     void    releaseBuffer(struct AVCodecContext *avctx, AVFrame *pic);

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp	2009-05-21 10:01:25 UTC (rev 4856)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_codecs/ADM_ffmpeg_vdpau.cpp	2009-05-21 10:01:27 UTC (rev 4857)
@@ -178,7 +178,7 @@
 {
   vdpau_render_state * render;
   int i;
-
+  if(destroying==true) return; // They are already freed...
   render=(vdpau_render_state*)pic->data[0];
   ADM_assert(render);
 
@@ -201,6 +201,7 @@
 */
 decoderFFVDPAU::decoderFFVDPAU(uint32_t w, uint32_t h, uint32_t l, uint8_t * d):decoderFF (w,	   h)
 {
+        destroying=false;
         _context->opaque          = this;
         _context->get_buffer      = ADM_VDPAUgetBuffer;
         _context->release_buffer  = ADM_VDPAUreleaseBuffer;
@@ -219,6 +220,7 @@
         for(int i=0;i<NB_SURFACE;i++)
         {
             VDPAU->renders[i]=new vdpau_render_state;
+            memset(VDPAU->renders[i],0,sizeof( vdpau_render_state));
             ADM_assert(VDP_STATUS_OK==funcs.createSurface(vdpDevice,VDP_CHROMA_TYPE_420,w,h,&(VDPAU->renders[i]->surface)));
             VDPAU->freeQueue.push_back(VDPAU->renders[i]);
         }
@@ -232,6 +234,7 @@
 decoderFFVDPAU::~decoderFFVDPAU()
 {
         printf("[VDPAU] Cleaning up\n");
+        destroying=true;
         for(int i=0;i<NB_SURFACE;i++)
         {
             ADM_assert(VDP_STATUS_OK==funcs.destroySurface((VDPAU->renders[i]->surface)));



From mean at mail.berlios.de  Thu May 21 12:01:28 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 21 May 2009 12:01:28 +0200
Subject: [Avidemux-svn-commit] r4858 -
	branches/avidemux_2.6_branch_mean/avidemux
Message-ID: <200905211001.n4LA1S3g031547@sheep.berlios.de>

Author: mean
Date: 2009-05-21 12:01:28 +0200 (Thu, 21 May 2009)
New Revision: 4858

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/gtk_gui.cpp
Log:
[main] dont free several time main audio track

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk_gui.cpp	2009-05-21 10:01:27 UTC (rev 4857)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk_gui.cpp	2009-05-21 10:01:28 UTC (rev 4858)
@@ -1088,13 +1088,13 @@
 		delete avifileinfo;
 		avifileinfo=NULL;
 	}
-
+#if 0
 	if (aviaudiostream)
 	{
 		delete aviaudiostream;
 		aviaudiostream=NULL;
 	}
-
+#endif
 	if (secondaudiostream)
 	{
 		delete secondaudiostream;



From mean at mail.berlios.de  Thu May 21 12:11:56 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 21 May 2009 12:11:56 +0200
Subject: [Avidemux-svn-commit] r4859 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Matroska
Message-ID: <200905211011.n4LABuOP000913@sheep.berlios.de>

Author: mean
Date: 2009-05-21 12:11:56 +0200 (Thu, 21 May 2009)
New Revision: 4859

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Matroska/ADM_mkv_audio.cpp
Log:
[mkvDemuxer] Fix xiph lacing decoding

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Matroska/ADM_mkv_audio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Matroska/ADM_mkv_audio.cpp	2009-05-21 10:01:28 UTC (rev 4858)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/Matroska/ADM_mkv_audio.cpp	2009-05-21 10:11:56 UTC (rev 4859)
@@ -242,6 +242,7 @@
                          _parser->readBin(dest,_Laces[0]);
                         *packlen=_Laces[0];
                         *timecode=time;
+                        _Laces[nbLaces-1]=size; // Last lace is remaining size
                         _currentBlock++;
                         _maxLace=nbLaces;
                         return 1;



From mean at mail.berlios.de  Fri May 22 19:24:55 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 22 May 2009 19:24:55 +0200
Subject: [Avidemux-svn-commit] r4860 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905221724.n4MHOtnK030408@sheep.berlios.de>

Author: mean
Date: 2009-05-22 19:24:53 +0200 (Fri, 22 May 2009)
New Revision: 4860

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp
Log:
[Ts] Fix padding

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp	2009-05-21 10:11:56 UTC (rev 4859)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.cpp	2009-05-22 17:24:53 UTC (rev 4860)
@@ -419,7 +419,6 @@
                                         pts0=start[0];  
                                         pts1=(start[1]<<8)+start[2]; 
                                         pts2=(start[3]<<8)+start[4]; 
-                                        start+=5;
                                         pes->pts=(pts1>>1)<<15;
                                         pes->pts+=pts2>>1;
                                         pes->pts+=(((pts0&6)>>1)<<30);
@@ -436,15 +435,13 @@
                                                 pts0=start[0];  
                                                 pts1=(start[1]<<8)+start[2]; 
                                                 pts2=(start[3]<<8)+start[4]; 
-                                                start+=5;
                                                                         
                                                 pes->pts=(pts1>>1)<<15;
                                                 pes->pts+=pts2>>1;
                                                 pes->pts+=(((pts0&6)>>1)<<30);
-                                                pts0=start[0];  
-                                                pts1=(start[1]<<8)+start[2]; 
-                                                pts2=(start[3]<<8)+start[4];       
-                                                start+=5;
+                                                pts0=start[5];  
+                                                pts1=(start[6]<<8)+start[7]; 
+                                                pts2=(start[8]<<8)+start[9];       
                                                 pes->dts=(pts1>>1)<<15;
                                                 pes->dts+=pts2>>1;
                                                 pes->dts+=(((pts0&6)>>1)<<30);
@@ -458,7 +455,7 @@
                                 break; // no pts nor dts
                                                                 
         }  
-       
+        start+=len; 
         int sizeCheck=pes->payloadSize-6;
         int tail=0;
         pes->offset=start-pes->payload;
@@ -901,4 +898,4 @@
 
     return true;
 }
-// EOF
\ No newline at end of file
+// EOF



From mean at mail.berlios.de  Fri May 22 21:16:42 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 22 May 2009 21:16:42 +0200
Subject: [Avidemux-svn-commit] r4861 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905221916.n4MJGg4I011670@sheep.berlios.de>

Author: mean
Date: 2009-05-22 21:16:42 +0200 (Fri, 22 May 2009)
New Revision: 4861

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp
Log:
[Ts] Use SEI to detect ITDR

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp	2009-05-22 17:24:53 UTC (rev 4860)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsIndex.cpp	2009-05-22 19:16:42 UTC (rev 4861)
@@ -121,6 +121,9 @@
         tsPacketLinearTracker   *pkt;
         listOfTsAudioTracks     *audioTracks;
         DIA_workingBase         *ui;
+
+        bool    decodeSEI(uint32_t nalSize, uint8_t *org,uint32_t *recoveryLength);
+
 public:
                 TsIndexer(listOfTsAudioTracks *tr);
                 ~TsIndexer();
@@ -237,6 +240,35 @@
     
 }
 /**
+        \fn decodeSEI
+        \brief decode SEI to get short ref I
+        @param recoveryLength # of recovery frame
+        \return true if recovery found
+*/
+bool TsIndexer::decodeSEI(uint32_t nalSize, uint8_t *org,uint32_t *recoveryLength)
+{
+    GetBitContext s;
+    uint8_t payload[nalSize+16];
+    nalSize=unescapeH264(nalSize,org,payload);
+    init_get_bits(&s, payload, nalSize*8);
+    while( get_bits_count(&s)<(nalSize-4)*8)
+    {
+        uint32_t sei_type=get_bits(&s,8);
+        uint32_t sei_size=get_bits(&s,8);
+                if(sei_size==0xff) sei_size=0xff00+get_bits(&s,8);; // should be enough
+                zprintf("  [SEI] Type : 0x%x size:%d\n",sei_type,sei_size);
+                if(sei_type==6) // Recovery point
+                {
+                        *recoveryLength=get_ue_golomb(&s);
+                        zprintf("[SEI] Recovery :%"LU"\n",*recoveryLength);
+                        return true;
+                }
+                skip_bits(&s,sei_size*8);
+    }
+    return false;
+}
+
+/**
     \fn runH264
     \brief Index H264 stream
 */  
@@ -249,8 +281,9 @@
 indexerData  data;    
 uint64_t fullSize;
 dmxPacketInfo info;
-
+TS_PESpacket SEI_nal(0);
 bool result=false;
+uint32_t recoveryCount=0xff;
 
     printf("Starting H264 indexer\n");
     if(!videoTrac) return false;
@@ -286,11 +319,12 @@
       while(1)
       {
         uint32_t code=0xffff+0xffff0000;
-        while((code!=1) && pkt->stillOk())
+        while(((code&0x00ffffff)!=1) && pkt->stillOk())
         {
             code=(code<<8)+pkt->readi8();
         }
         if(!pkt->stillOk()) break;
+        
         uint8_t startCode=pkt->readi8(); // Read 5 bytes so far
         if(startCode&0x80) continue; // Marker missing
         startCode&=0x1f;
@@ -323,10 +357,11 @@
       {
 
         uint32_t code=0xffff+0xffff0000;
-        while((code!=1) && pkt->stillOk())
+        while(((code&0x00ffffff)!=1) && pkt->stillOk())
         {
             code=(code<<8)+pkt->readi8();
         }
+resume:
         if(!pkt->stillOk()) break;
         uint8_t startCode=pkt->readi8(); // Read 5 bytes so far
 //  1:0 2:Nal ref idc 5:Nal Type
@@ -353,19 +388,23 @@
                   {
                   case NAL_SEI:
                     {
-                        uint32_t sei_type=pkt->readi8();
-                                if(sei_type!=6) break;
-                        uint32_t sei_size=pkt->readi8();
-                                if(sei_size==0xff) sei_size=0xff00+pkt->readi8(); // should be enough
-                        uint8_t buffer1[sei_size];
-                        uint8_t buffer2[sei_size];
-                        GetBitContext s;
-                                unescapeH264(sei_size,buffer1,buffer2);
-                                init_get_bits(&s, buffer2, sei_size*8);
-                                zprintf(" [SEI]   recovery_frame_cnt: %u\n", get_ue_golomb(&s));
-                                
+                        // Load the whole NAL
+                            SEI_nal.empty();
+                            code=0xffff+0xffff0000;
+                            while((code!=1) && pkt->stillOk())
+                            {
+                                uint8_t r=pkt->readi8();
+                                code=(code<<8)+r;
+                                SEI_nal.pushByte(r);
+                            }
+                            if(!pkt->stillOk()) goto resume;
+                            zprintf("[SEI] Nal size :%d\n",SEI_nal.payloadSize);
+                            if(SEI_nal.payloadSize>=7)
+                                decodeSEI(SEI_nal.payloadSize-4,SEI_nal.payload,&recoveryCount);
+                            else printf("[SEI] Too short size+4=%d\n",SEI_nal.payload);
+                        
 
-
+                            goto resume;
                     }
                             break;
                   case NAL_AU_DELIMITER:
@@ -380,6 +419,7 @@
                           data.frameType=1;
                           Mark(&data,&info,5);
                           data.state=idx_startAtGopOrSeq;
+                          recoveryCount=0xff;
                           break;
 
                   case NAL_IDR:
@@ -417,6 +457,8 @@
                             default : data.frameType=2;break; // SP/SI
                         }
                       if(startCode==NAL_IDR) data.frameType=4; // IDR
+                      zprintf("[>>>>>>>>] Pic Type %"LU" Recovery %"LU"\n",data.frameType,recoveryCount);
+                      if(data.frameType==1 && !recoveryCount) data.frameType=4; //I  + Recovery=0 = IDR!
                       if(data.state==idx_startAtGopOrSeq) 
                       {
                               currentFrameType=data.frameType;;
@@ -429,6 +471,7 @@
                       data.state=idx_startAtImage;
                       data.nbPics++;
                       pic_started = true;
+                      recoveryCount=0xff;
                     }
                   
                     break;



From mean at mail.berlios.de  Fri May 22 21:16:44 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 22 May 2009 21:16:44 +0200
Subject: [Avidemux-svn-commit] r4862 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905221916.n4MJGirY011686@sheep.berlios.de>

Author: mean
Date: 2009-05-22 21:16:44 +0200 (Fri, 22 May 2009)
New Revision: 4862

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.h
Log:
[TS] use pes packet as place holder for SEI data

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.h
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.h	2009-05-22 19:16:42 UTC (rev 4861)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/dmxTSPacket.h	2009-05-22 19:16:44 UTC (rev 4862)
@@ -90,6 +90,21 @@
                     payloadSize+=len;
                     return true;
                 }
+     bool empty(void)
+     {
+            payloadSize=0;
+            return true;
+     }
+     bool pushByte(uint8_t byte)
+     {
+            if(payloadSize>=payloadLimit)
+            {
+                        payloadLimit*=2;
+                        payload=(uint8_t *)ADM_realloc(payload,payloadLimit);
+            }
+            payload[payloadSize++]=byte;
+            return true;
+     }
 };
 
 /**



From mean at mail.berlios.de  Fri May 22 21:16:45 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 22 May 2009 21:16:45 +0200
Subject: [Avidemux-svn-commit] r4863 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS
Message-ID: <200905221916.n4MJGjOl011696@sheep.berlios.de>

Author: mean
Date: 2009-05-22 21:16:45 +0200 (Fri, 22 May 2009)
New Revision: 4863

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsComputeTimeStamp.cpp
Log:
[TS] Also supports 50 hz video

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsComputeTimeStamp.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsComputeTimeStamp.cpp	2009-05-22 19:16:44 UTC (rev 4862)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/MpegTS/ADM_tsComputeTimeStamp.cpp	2009-05-22 19:16:45 UTC (rev 4863)
@@ -68,6 +68,7 @@
 
         switch( _videostream.dwRate)
         {
+            case 50000:   dtsIncrement=20000;break;
             case 25000:   dtsIncrement=40000;break;
             case 23976:   dtsIncrement=41708;break;
             case 29970:   dtsIncrement=33367;break;



From mean at mail.berlios.de  Sat May 23 19:14:54 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 23 May 2009 19:14:54 +0200
Subject: [Avidemux-svn-commit] r4864 - in
	branches/avidemux_2.6_branch_mean/avidemux: . ADM_audioFilter/src
Message-ID: <200905231714.n4NHEsgL007734@sheep.berlios.de>

Author: mean
Date: 2009-05-23 19:14:52 +0200 (Sat, 23 May 2009)
New Revision: 4864

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gui_play.cpp
Log:
[Playback] Dont use audio if there is none

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter.cpp	2009-05-22 19:16:45 UTC (rev 4863)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter/src/audiofilter.cpp	2009-05-23 17:14:52 UTC (rev 4864)
@@ -42,6 +42,8 @@
     playback.shiftInMs=shift;
     playback.mixerEnabled=true;
     playback.mixerConf=CHANNEL_STEREO;
+    // If we have no audio, dont even try...
+    if(!video_body->getInfo()) return NULL;
     //
     ADM_buildFilterChain(&PlaybackVector,&playback);
     //

Modified: branches/avidemux_2.6_branch_mean/avidemux/gui_play.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gui_play.cpp	2009-05-22 19:16:45 UTC (rev 4863)
+++ branches/avidemux_2.6_branch_mean/avidemux/gui_play.cpp	2009-05-23 17:14:52 UTC (rev 4864)
@@ -317,7 +317,8 @@
     uint64_t startPts=firstPts;
 
     playbackAudio = createPlaybackFilter(startPts,0);
-    
+    if(!playbackAudio) return false;
+
     channels= playbackAudio->getInfo()->channels;
     preload=  (wavinfo->frequency * channels)/5;	// 200 ms preload
     // 4 sec buffer..               



From mean at mail.berlios.de  Sat May 23 19:15:00 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 23 May 2009 19:15:00 +0200
Subject: [Avidemux-svn-commit] r4865 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_coreAudioDevice/src
Message-ID: <200905231715.n4NHF0b9007863@sheep.berlios.de>

Author: mean
Date: 2009-05-23 19:14:59 +0200 (Sat, 23 May 2009)
New Revision: 4865

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreAudioDevice/src/ADM_audioDeviceThreaded.cpp
Log:
[audio] initializ buffers with null to avoid random value

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreAudioDevice/src/ADM_audioDeviceThreaded.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreAudioDevice/src/ADM_audioDeviceThreaded.cpp	2009-05-23 17:14:52 UTC (rev 4864)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreAudioDevice/src/ADM_audioDeviceThreaded.cpp	2009-05-23 17:14:59 UTC (rev 4865)
@@ -25,7 +25,8 @@
 */
 audioDeviceThreaded::audioDeviceThreaded(void)
 {
-
+    audioBuffer=NULL;
+    silence=NULL;
 }
 /**
     \fn audioDeviceThreaded
@@ -33,7 +34,7 @@
 */
 audioDeviceThreaded::~audioDeviceThreaded()
 {
-
+   // PURE! stop();
 }
 /**
     \fn bouncer



From gruntster at mail.berlios.de  Sat May 23 22:20:08 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 23 May 2009 22:20:08 +0200
Subject: [Avidemux-svn-commit] r4866 - in
	branches/avidemux_2.5_branch_gruntster/cmake: . patches
Message-ID: <200905232020.n4NKK8ZC028521@sheep.berlios.de>

Author: gruntster
Date: 2009-05-23 22:19:56 +0200 (Sat, 23 May 2009)
New Revision: 4866

Added:
   branches/avidemux_2.5_branch_gruntster/cmake/patches/common.mak.diff
   branches/avidemux_2.5_branch_gruntster/cmake/patches/config.mak.diff
Removed:
   branches/avidemux_2.5_branch_gruntster/cmake/patches/common.mak.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/patch_config.mak
Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegPatch.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegUtil.cmake
Log:
[ffmpeg] keep original ffmpeg library names on Windows

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2009-05-23 17:14:59 UTC (rev 4865)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2009-05-23 20:19:56 UTC (rev 4866)
@@ -18,6 +18,7 @@
 				  --disable-parsers --disable-decoders --disable-encoders --disable-demuxers --disable-muxers --enable-postproc --enable-gpl 
 				  --prefix=${CMAKE_INSTALL_PREFIX})
 
+include(admFFmpegPatch)
 include(admFFmpegPrepareTar)
 
 if (NOT FFMPEG_PREPARED)
@@ -31,7 +32,17 @@
 message("")
 
 if (FFMPEG_PERFORM_PATCH)
-	include(admFFmpegPatch)
+	find_patch()
+	file(GLOB patchFiles "${CMAKE_SOURCE_DIR}/cmake/patches/*.patch")
+
+	foreach(patchFile ${patchFiles})
+		patch_file("${FFMPEG_SOURCE_DIR}" "${patchFile}")
+	endforeach(patchFile)
+
+	if (NOT WIN32)
+		patch_file("${FFMPEG_SOURCE_DIR}" "${CMAKE_SOURCE_DIR}/cmake/patches/common.mak.diff")
+	endif (NOT WIN32)
+
 	message("")
 endif (FFMPEG_PERFORM_PATCH)
 
@@ -98,9 +109,12 @@
 	execute_process(COMMAND sh ${FFMPEG_SOURCE_DIR}/configure ${FFMPEG_FLAGS}
 					WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}"
 					${ffmpegBuildOutput})
-        execute_process(COMMAND ${PATCH_EXECUTABLE} -p0 -i "${CMAKE_SOURCE_DIR}/cmake/patches/patch_config.mak"
-					WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}")
 
+	if (NOT WIN32)
+		find_patch()
+		patch_file("${FFMPEG_BINARY_DIR}" "${CMAKE_SOURCE_DIR}/cmake/patches/config.mak.diff")
+	endif (NOT WIN32)
+
 	message("")
 endif (FFMPEG_PERFORM_BUILD)
 

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegPatch.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegPatch.cmake	2009-05-23 17:14:59 UTC (rev 4865)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegPatch.cmake	2009-05-23 20:19:56 UTC (rev 4866)
@@ -1,25 +1,29 @@
-find_package(Patch)
+macro(find_patch)
+	find_package(Patch)
 
-if (WIN32)
-	find_package(Unix2Dos)
-	
-	if (NOT VERBOSE)
-		set(unix2dosOutput OUTPUT_VARIABLE UNIX2DOS_OUTPUT)
-	endif (NOT VERBOSE)
-endif (WIN32)
+	if (WIN32)
+		find_package(Unix2Dos)
 
-file(GLOB patchFiles "${CMAKE_SOURCE_DIR}/cmake/patches/*.patch")
+		if (NOT VERBOSE)
+			set(unix2dosOutput OUTPUT_VARIABLE UNIX2DOS_OUTPUT)
+		endif (NOT VERBOSE)
+	endif (WIN32)
+endmacro(find_patch)
 
-foreach(patchFile ${patchFiles})
+macro(patch_file baseDir patchFile)
 	if (WIN32)
-		file(MAKE_DIRECTORY "${FFMPEG_BINARY_DIR}/patches")
+		set(tempPatchDir ${CMAKE_BINARY_DIR}/temp)
+		file(MAKE_DIRECTORY "${tempPatchDir}")
 		get_filename_component(fileName "${patchFile}" NAME)
-		execute_process(COMMAND ${UNIX2DOS_EXECUTABLE} -n ${patchFile} ${FFMPEG_BINARY_DIR}/patches/${fileName}
+
+		execute_process(COMMAND ${UNIX2DOS_EXECUTABLE} -n ${patchFile} ${tempPatchDir}/${fileName}
 						${unix2dosOutput})
 
-		set(patchFile "${FFMPEG_BINARY_DIR}/patches/${fileName}")
+		set(_patchFile "${tempPatchDir}/${fileName}")
+	else (WIN32)
+		set(_patchFile "${tempPatchDir}/${fileName}")
 	endif (WIN32)
 
-	execute_process(COMMAND ${PATCH_EXECUTABLE} -p0 -i "${patchFile}"
-					WORKING_DIRECTORY "${FFMPEG_SOURCE_DIR}")
-endforeach(patchFile)
\ No newline at end of file
+	execute_process(COMMAND ${PATCH_EXECUTABLE} -p0 -i "${_patchFile}"
+					WORKING_DIRECTORY "${baseDir}")
+endmacro(patch_file)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegUtil.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegUtil.cmake	2009-05-23 17:14:59 UTC (rev 4865)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegUtil.cmake	2009-05-23 20:19:56 UTC (rev 4866)
@@ -10,15 +10,17 @@
 	getFfmpegVersionFromHeader("libavutil" "${sourceDir}/libavutil/avutil.h" LIBAVUTIL_VERSION_MAJOR LIBAVUTIL_VERSION)
 	getFfmpegVersionFromHeader("libpostproc" "${sourceDir}/libpostproc/postprocess.h" LIBPOSTPROC_VERSION_MAJOR LIBPOSTPROC_VERSION)
 	getFfmpegVersionFromHeader("libswscale" "${sourceDir}/libswscale/swscale.h" LIBSWSCALE_VERSION_MAJOR LIBSWSCALE_VERSION)
-        
-        set(LIBAVCODEC_ADM ADM5)
 
+	if (NOT WIN32)
+		set(LIBAVCODEC_ADM ADM5)
+	endif (NOT WIN32)
+
 	if (APPLE)
 		set(LIBAVCODEC_LIB lib${LIBAVCODEC_ADM}avcodec.${LIBAVCODEC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
 		set(LIBAVFORMAT_LIB lib${LIBAVCODEC_ADM}avformat.${LIBAVFORMAT_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
 		set(LIBAVUTIL_LIB lib${LIBAVCODEC_ADM}avutil.${LIBAVUTIL_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
 		set(LIBPOSTPROC_LIB lib${LIBAVCODEC_ADM}postproc.${LIBPOSTPROC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
-		set(LIBSWSCALE_LIB lib${LIBAVCODEC_ADM}swscale.${LIBSWSCALE_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})	
+		set(LIBSWSCALE_LIB lib${LIBAVCODEC_ADM}swscale.${LIBSWSCALE_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
 	elseif (UNIX)
 		set(LIBAVCODEC_LIB lib${LIBAVCODEC_ADM}avcodec${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBAVCODEC_VERSION})
 		set(LIBAVFORMAT_LIB lib${LIBAVCODEC_ADM}avformat${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBAVFORMAT_VERSION})

Copied: branches/avidemux_2.5_branch_gruntster/cmake/patches/common.mak.diff (from rev 4863, branches/avidemux_2.5_branch_gruntster/cmake/patches/common.mak.patch)

Deleted: branches/avidemux_2.5_branch_gruntster/cmake/patches/common.mak.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/common.mak.patch	2009-05-23 17:14:59 UTC (rev 4865)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/common.mak.patch	2009-05-23 20:19:56 UTC (rev 4866)
@@ -1,13 +0,0 @@
-Index: common.mak
-===================================================================
---- common.mak	(revision 18300)
-+++ common.mak	(working copy)
-@@ -62,7 +62,7 @@
- FFLIBS    := $(FFLIBS-yes) $(FFLIBS)
- TESTPROGS += $(TESTPROGS-yes)
- 
--FFEXTRALIBS := $(addprefix -l,$(addsuffix $(BUILDSUF),$(FFLIBS))) $(EXTRALIBS)
-+FFEXTRALIBS := $(addprefix -lADM5,$(addsuffix $(BUILDSUF),$(FFLIBS))) $(EXTRALIBS)
- FFLDFLAGS   := $(addprefix -L$(BUILD_ROOT)/lib,$(ALLFFLIBS)) $(LDFLAGS)
- 
- EXAMPLES  := $(addprefix $(SUBDIR),$(addsuffix -example$(EXESUF),$(EXAMPLES)))

Copied: branches/avidemux_2.5_branch_gruntster/cmake/patches/config.mak.diff (from rev 4863, branches/avidemux_2.5_branch_gruntster/cmake/patches/patch_config.mak)

Deleted: branches/avidemux_2.5_branch_gruntster/cmake/patches/patch_config.mak
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/patch_config.mak	2009-05-23 17:14:59 UTC (rev 4865)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/patch_config.mak	2009-05-23 20:19:56 UTC (rev 4866)
@@ -1,11 +0,0 @@
---- config.mak.old	2009-05-01 19:26:13.808782802 +0200
-+++ config.mak	2009-05-01 18:10:25.000085291 +0200
-@@ -60,7 +60,7 @@
- BUILD_SHARED=yes
- PIC=-fPIC -DPIC
- LIBTARGET=
--SLIBNAME=$(SLIBPREF)$(FULLNAME)$(SLIBSUF)
-+SLIBNAME=$(SLIBPREF)ADM5$(FULLNAME)$(SLIBSUF)
- SLIBNAME_WITH_VERSION=$(SLIBNAME).$(LIBVERSION)
- SLIBNAME_WITH_MAJOR=$(SLIBNAME).$(LIBMAJOR)
- SLIB_CREATE_DEF_CMD=



From mean at mail.berlios.de  Sun May 24 09:24:18 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 24 May 2009 09:24:18 +0200
Subject: [Avidemux-svn-commit] r4867 -
	branches/avidemux_2.5_branch_gruntster/cmake
Message-ID: <200905240724.n4O7OIBc021087@sheep.berlios.de>

Author: mean
Date: 2009-05-24 09:24:18 +0200 (Sun, 24 May 2009)
New Revision: 4867

Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegPatch.cmake
Log:
[Build] fix patch name

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegPatch.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegPatch.cmake	2009-05-23 20:19:56 UTC (rev 4866)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegPatch.cmake	2009-05-24 07:24:18 UTC (rev 4867)
@@ -21,9 +21,9 @@
 
 		set(_patchFile "${tempPatchDir}/${fileName}")
 	else (WIN32)
-		set(_patchFile "${tempPatchDir}/${fileName}")
+		set(_patchFile "${patchFile}")
 	endif (WIN32)
-
+        MESSAGE(STATUS BaseDir: ${baseDir} patchFile: ${patchFile} => out : ${_patchFile} PWD: ${baseDir})
 	execute_process(COMMAND ${PATCH_EXECUTABLE} -p0 -i "${_patchFile}"
 					WORKING_DIRECTORY "${baseDir}")
-endmacro(patch_file)
\ No newline at end of file
+endmacro(patch_file)



From mean at mail.berlios.de  Sun May 24 09:24:54 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 24 May 2009 09:24:54 +0200
Subject: [Avidemux-svn-commit] r4868 -
	branches/avidemux_2.5_branch_gruntster/cmake
Message-ID: <200905240724.n4O7OsOk021150@sheep.berlios.de>

Author: mean
Date: 2009-05-24 09:24:54 +0200 (Sun, 24 May 2009)
New Revision: 4868

Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegPatch.cmake
Log:
[Build] fix fix patch name

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegPatch.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegPatch.cmake	2009-05-24 07:24:18 UTC (rev 4867)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegPatch.cmake	2009-05-24 07:24:54 UTC (rev 4868)
@@ -23,7 +23,6 @@
 	else (WIN32)
 		set(_patchFile "${patchFile}")
 	endif (WIN32)
-        MESSAGE(STATUS BaseDir: ${baseDir} patchFile: ${patchFile} => out : ${_patchFile} PWD: ${baseDir})
 	execute_process(COMMAND ${PATCH_EXECUTABLE} -p0 -i "${_patchFile}"
 					WORKING_DIRECTORY "${baseDir}")
 endmacro(patch_file)



From mean at mail.berlios.de  Sun May 24 18:30:53 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 24 May 2009 18:30:53 +0200
Subject: [Avidemux-svn-commit] r4869 -
	branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/OpenDml
Message-ID: <200905241630.n4OGUrkB032725@sheep.berlios.de>

Author: mean
Date: 2009-05-24 18:30:52 +0200 (Sun, 24 May 2009)
New Revision: 4869

Modified:
   branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/OpenDml/ADM_openDML.cpp
Log:
[openDML] initialize audioStream too

Modified: branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/OpenDml/ADM_openDML.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/OpenDml/ADM_openDML.cpp	2009-05-24 07:24:54 UTC (rev 4868)
+++ branches/avidemux_2.6_branch_mean/plugins/ADM_demuxers/OpenDml/ADM_openDML.cpp	2009-05-24 16:30:52 UTC (rev 4869)
@@ -33,7 +33,7 @@
 {
     UNUSED_ARG(frame);
     UNUSED_ARG(flags);
-    
+    if(frame>= (uint32_t)_videostream.dwLength) return 0;
 	_idx[frame].intra=flags;    
 	return 1;
 }
@@ -102,10 +102,9 @@
 */
 uint8_t  OpenDMLHeader::getFrame(uint32_t framenum,ADMCompressedImage *img)
 {
+    if(framenum>= (uint32_t)_videostream.dwLength) return 0;
 uint64_t offset=_idx[framenum].offset; //+_mdatOffset;
 	
-	if(framenum>= (uint32_t)_videostream.dwLength) return 0;
-	
  	fseeko(_fd,offset,SEEK_SET);
  	fread(img->data, _idx[framenum].size, 1, _fd);
   	img->dataLength=_idx[framenum].size;
@@ -124,6 +123,7 @@
 */
 uint64_t OpenDMLHeader::getTime(uint32_t frameNum)
 {
+    if(frameNum>= (uint32_t)_videostream.dwLength) return ADM_NO_PTS;
     return _idx[frameNum].pts; 
 
 }
@@ -145,8 +145,8 @@
 	if(_fd)
  		{
                	fclose(_fd);
-             	}
-              _fd=NULL;
+        }
+    _fd=NULL;
 	if(_idx)
 	{
 		delete [] _idx;
@@ -162,11 +162,11 @@
 		delete [] _audioTracks;
 		_audioTracks=NULL;
 	}
-        if(myName)
-        {
-          ADM_dealloc(myName);
-          myName=NULL; 
-        }
+    if(myName)
+    {
+      ADM_dealloc(myName);
+      myName=NULL; 
+    }
     // Destroy audioStreams
     if(_audioStreams)
     {
@@ -196,6 +196,7 @@
 	_recHack=0;
     // Audio
     _audioTracks=NULL;
+    _audioStreams=NULL;
     _nbAudioTracks=0;
     _currentAudioTrack=0;
     myName=NULL;
@@ -208,7 +209,7 @@
 */
 WAVHeader              *OpenDMLHeader::getAudioInfo(uint32_t i ) 
 {
-if(_nbAudioTracks)
+    if(_nbAudioTracks)
 		return _audioStreams[_currentAudioTrack]->getInfo();
 	else
 		return NULL;
@@ -259,8 +260,8 @@
         myName=ADM_strdup(name);
 #define CLR(x)              memset(& x,0,sizeof(  x));
 
-              CLR( _videostream);
-              CLR( _mainaviheader);
+          CLR( _videostream);
+          CLR( _mainaviheader);
 	      _isvideopresent=1;
 	      _isaudiopresent=0;    	     	      	 	      
 	      



From mean at mail.berlios.de  Sun May 24 18:30:56 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 24 May 2009 18:30:56 +0200
Subject: [Avidemux-svn-commit] r4870 -
	branches/avidemux_2.6_branch_mean/avidemux/ADM_editor
Message-ID: <200905241630.n4OGUuaM000033@sheep.berlios.de>

Author: mean
Date: 2009-05-24 18:30:55 +0200 (Sun, 24 May 2009)
New Revision: 4870

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edRender.cpp
Log:
[Editor] Increase time before considering decoding has failed

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edRender.cpp	2009-05-24 16:30:52 UTC (rev 4869)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edRender.cpp	2009-05-24 16:30:55 UTC (rev 4870)
@@ -118,7 +118,7 @@
     img.data=compBuffer;
     img.cleanup(frame);
 
-    aprintf("[EditorRender] DecodeUpToInta %u ref:%u\n",frame,ref);
+    printf("[EditorRender] DecodeUpToInta %u ref:%u\n",frame,ref);
 	_VIDEOS *vid=&_videos[ref];
     vidHeader *demuxer=vid->_aviheader;
 	cache=_videos[ref]._videoCache;
@@ -130,10 +130,12 @@
     bool found=false;
     vid->lastSentFrame=frame;
     uint32_t nbFrames=vid->_nb_video_frames;
+    aprintf("[EditorRender] DecodeUpToIntra flushing cache & codec\n");
     cache->flush();
+    _videos[ref].decoder->flush();
     // The PTS associated with our frame is the one we are looking for
     uint64_t wantedPts=vid->_aviheader->estimatePts(frame);
-    uint32_t tries=16; // Max Ref frames for H264=Max delay
+    uint32_t tries=15+7; // Max Ref frames for H264 + MaxRecovery , let's say 7 is ok for recovery
     bool syncFound=false;
     while(found==false && tries--)
     {
@@ -1256,6 +1258,7 @@
 bool        ADM_Composer::setCurrentFrame(uint32_t frame)
 {
     // Seatch previous keyFrame
+    printf("[setCurrentFrame] >>> REQ for frame %"LU"\n",frame);
     uint32_t keyFrame=frame,f;
     while(keyFrame)
     {
@@ -1265,6 +1268,7 @@
         }
         keyFrame--;
     }
+    printf("[setCurrentFrame] >>> Prev KeyFrame %"LU"\n",keyFrame);
     if(false==GoToIntra(keyFrame))
     {
         printf("[setCurrentFrame] GoToIntra failed for frame %u\n",keyFrame);



From gruntster at mail.berlios.de  Mon May 25 18:59:46 2009
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 25 May 2009 18:59:46 +0200
Subject: [Avidemux-svn-commit] r4871 - in
	branches/avidemux_2.5_branch_gruntster: avidemux/ADM_audio
	avidemux/ADM_infoExtractor avidemux/ADM_outputs/oplug_avi
	cmake cmake/patches
Message-ID: <200905251659.n4PGxkx2001148@sheep.berlios.de>

Author: gruntster
Date: 2009-05-25 18:59:24 +0200 (Mon, 25 May 2009)
New Revision: 4871

Removed:
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libswscale_swscale_internal.h.patch
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audio/ADM_dcainfo.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch
Log:
[ffmpeg] update FFmpeg to r18940 & libswscale r29319

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audio/ADM_dcainfo.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audio/ADM_dcainfo.cpp	2009-05-24 16:30:55 UTC (rev 4870)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audio/ADM_dcainfo.cpp	2009-05-25 16:59:24 UTC (rev 4871)
@@ -18,7 +18,7 @@
 extern "C"
 {
 #define INT_BIT (CHAR_BIT * sizeof(int))
-#include "libavcodec/bitstream.h"
+#include "libavcodec/get_bits.h"
 }
 
 #include "ADM_assert.h"

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp	2009-05-24 16:30:55 UTC (rev 4870)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp	2009-05-25 16:59:24 UTC (rev 4871)
@@ -27,7 +27,7 @@
 extern "C"
 {
 #define INT_BIT (CHAR_BIT * sizeof(int))
-#include "libavcodec/bitstream.h"
+#include "libavcodec/get_bits.h"
 #include "libavcodec/golomb.h"
 }
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp	2009-05-24 16:30:55 UTC (rev 4870)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp	2009-05-25 16:59:24 UTC (rev 4871)
@@ -335,7 +335,7 @@
 #undef av_always_inline
 #define av_always_inline inline
 #define INT_BIT (CHAR_BIT * sizeof(int))
-#include "libavcodec/bitstream.h"
+#include "libavcodec/put_bits.h"
 }
 void putNvop(ADMBitstream *data,uint32_t timebits, uint32_t timeincval)
 {

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2009-05-24 16:30:55 UTC (rev 4870)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2009-05-25 16:59:24 UTC (rev 4871)
@@ -1,7 +1,7 @@
 include(admFFmpegUtil)
 
-set(FFMPEG_VERSION 18300)	# http://git.ffmpeg.org/?p=ffmpeg;a=snapshot;h=004034d83aa068cd26b52c17e1b0af6e11410940;sf=tgz
-set(SWSCALE_VERSION 29120)	# http://git.ffmpeg.org/?p=libswscale;a=snapshot;h=e58c77c7cf34896dcbc109730551902a4d5a321b;sf=tgz
+set(FFMPEG_VERSION 18940)	# http://git.ffmpeg.org/?p=ffmpeg;a=snapshot;h=1e3b68a502b568cc3b486914f0d69be9af919ba6;sf=tgz
+set(SWSCALE_VERSION 29319)	# http://git.ffmpeg.org/?p=libswscale;a=snapshot;h=99683bba2e7148bb028776c2b5fefcb3064d48e9;sf=tgz
 
 set(LIBRARY_SOURCE_DIR "${CMAKE_SOURCE_DIR}/avidemux/ADM_libraries")
 set(FFMPEG_SOURCE_DIR "${LIBRARY_SOURCE_DIR}/ffmpeg")

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2009-05-24 16:30:55 UTC (rev 4870)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2009-05-25 16:59:24 UTC (rev 4871)
@@ -1,8 +1,8 @@
-*** libavcodec/avcodec.h.old	Wed Apr  1 18:35:35 2009
---- libavcodec/avcodec.h	Wed Apr  1 18:35:35 2009
+*** libavcodec/avcodec.h.old	Mon May 25 14:32:16 2009
+--- libavcodec/avcodec.h	Mon May 25 14:32:16 2009
 ***************
-*** 505,510 ****
---- 505,512 ----
+*** 566,571 ****
+--- 566,573 ----
   #define CODEC_FLAG2_CHUNKS        0x00008000 ///< Input bitstream might be truncated at a packet boundaries instead of only at frame boundaries.
   #define CODEC_FLAG2_NON_LINEAR_QUANT 0x00010000 ///< Use MPEG-2 nonlinear quantizer.
   #define CODEC_FLAG2_BIT_RESERVOIR 0x00020000 ///< Use a bit reservoir when encoding if possible
@@ -12,8 +12,8 @@
   /* Unsupported options :
    *              Syntax Arithmetic coding (SAC)
 ***************
-*** 1302,1307 ****
---- 1304,1310 ----
+*** 1412,1417 ****
+--- 1414,1420 ----
        * - decoding: unused
        */
       int rc_max_rate;
@@ -22,8 +22,8 @@
       /**
        * minimum bitrate
 ***************
-*** 1316,1321 ****
---- 1319,1326 ----
+*** 1426,1431 ****
+--- 1429,1436 ----
        * - decoding: unused
        */
       int rc_buffer_size;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch	2009-05-24 16:30:55 UTC (rev 4870)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch	2009-05-25 16:59:24 UTC (rev 4871)
@@ -1,8 +1,8 @@
-*** libavcodec/ffv1.c.old	Mon Feb  2 19:49:49 2009
---- libavcodec/ffv1.c	Mon Feb  2 19:49:48 2009
+*** libavcodec/ffv1.c.old	Mon May 25 14:32:17 2009
+--- libavcodec/ffv1.c	Mon May 25 14:32:17 2009
 ***************
-*** 959,964 ****
---- 959,966 ----
+*** 1072,1077 ****
+--- 1072,1079 ----
           clear_state(f);
       }else{
           p->key_frame= 0;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch	2009-05-24 16:30:55 UTC (rev 4870)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch	2009-05-25 16:59:24 UTC (rev 4871)
@@ -1,8 +1,8 @@
-*** libavcodec/h263dec.c.old	Wed Apr  1 18:35:37 2009
---- libavcodec/h263dec.c	Wed Apr  1 18:35:37 2009
+*** libavcodec/h263dec.c.old	Mon May 25 14:32:17 2009
+--- libavcodec/h263dec.c	Mon May 25 14:32:17 2009
 ***************
-*** 120,125 ****
---- 120,142 ----
+*** 123,128 ****
+--- 123,145 ----
   
       return 0;
   }
@@ -27,8 +27,8 @@
   av_cold int ff_h263_decode_end(AVCodecContext *avctx)
   {
 ***************
-*** 418,423 ****
---- 435,446 ----
+*** 423,428 ****
+--- 440,451 ----
       } else {
           ret = h263_decode_picture_header(s);
       }
@@ -42,8 +42,8 @@
       if(ret==FRAME_SKIPPED) return get_consumed_bytes(s, buf_size);
   
 ***************
-*** 706,711 ****
---- 729,742 ----
+*** 713,718 ****
+--- 736,749 ----
   
   assert(s->current_picture.pict_type == s->current_picture_ptr->pict_type);
   assert(s->current_picture.pict_type == s->pict_type);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2009-05-24 16:30:55 UTC (rev 4870)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2009-05-25 16:59:24 UTC (rev 4871)
@@ -1,8 +1,8 @@
-*** libavcodec/h264.c.old	Wed Apr  1 18:35:37 2009
---- libavcodec/h264.c	Wed Apr  1 18:35:37 2009
+*** libavcodec/h264.c.old	Mon May 25 14:32:18 2009
+--- libavcodec/h264.c	Mon May 25 14:32:18 2009
 ***************
-*** 8104,8109 ****
---- 8104,8120 ----
+*** 8135,8140 ****
+--- 8135,8151 ----
       return 0;
   }
   

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2009-05-24 16:30:55 UTC (rev 4870)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2009-05-25 16:59:24 UTC (rev 4871)
@@ -1,8 +1,8 @@
-*** libavcodec/mpeg12.c.old	Wed Apr  1 18:35:38 2009
---- libavcodec/mpeg12.c	Wed Apr  1 18:35:38 2009
+*** libavcodec/mpeg12.c.old	Mon May 25 14:32:18 2009
+--- libavcodec/mpeg12.c	Mon May 25 14:32:18 2009
 ***************
-*** 1952,1957 ****
---- 1952,1962 ----
+*** 1963,1968 ****
+--- 1963,1973 ----
           ff_er_frame_end(s);
   
           MPV_frame_end(s);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2009-05-24 16:30:55 UTC (rev 4870)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2009-05-25 16:59:24 UTC (rev 4871)
@@ -1,7 +1,7 @@
-*** libavcodec/mpegvideo.c.old	Wed Apr  1 18:35:39 2009
---- libavcodec/mpegvideo.c	Wed Apr  1 18:35:39 2009
+*** libavcodec/mpegvideo.c.old	Mon May 25 14:32:19 2009
+--- libavcodec/mpegvideo.c	Mon May 25 14:32:19 2009
 ***************
-*** 606,612 ****
+*** 610,616 ****
       CHECKED_ALLOCZ(s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE);
   
       s->parse_context.state= -1;
@@ -9,7 +9,7 @@
          s->visualization_buffer[0] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
          s->visualization_buffer[1] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
          s->visualization_buffer[2] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
---- 606,616 ----
+--- 610,620 ----
       CHECKED_ALLOCZ(s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE);
   
       s->parse_context.state= -1;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2009-05-24 16:30:55 UTC (rev 4870)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2009-05-25 16:59:24 UTC (rev 4871)
@@ -1,10 +1,10 @@
-*** libavcodec/utils.c.old	Wed Apr  1 18:35:40 2009
---- libavcodec/utils.c	Wed Apr  1 18:35:40 2009
+*** libavcodec/utils.c.old	Mon May 25 14:32:20 2009
+--- libavcodec/utils.c	Mon May 25 14:32:20 2009
 ***************
-*** 555,564 ****
---- 555,566 ----
+*** 594,603 ****
+--- 594,605 ----
   
-      if((avctx->codec->capabilities & CODEC_CAP_DELAY) || buf_size){
+      if((avctx->codec->capabilities & CODEC_CAP_DELAY) || avpkt->size){
           //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
 + #if 0 // MEANX : Silence
           if(*frame_size_ptr < AVCODEC_MAX_AUDIO_FRAME_SIZE){
@@ -16,7 +16,7 @@
           *frame_size_ptr < avctx->channels * avctx->frame_size * sizeof(int16_t)){
               av_log(avctx, AV_LOG_ERROR, "buffer %d too small\n", *frame_size_ptr);
 ***************
-*** 969,975 ****
+*** 1021,1027 ****
           return -1;
       }
   #if !HAVE_MKSTEMP
@@ -24,7 +24,7 @@
   #else
       snprintf(*filename, len, "/tmp/%sXXXXXX", prefix);
       fd = mkstemp(*filename);
---- 971,977 ----
+--- 1023,1029 ----
           return -1;
       }
   #if !HAVE_MKSTEMP

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2009-05-24 16:30:55 UTC (rev 4870)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2009-05-25 16:59:24 UTC (rev 4871)
@@ -1,7 +1,7 @@
-*** libavformat/isom.c.old	Mon Feb  2 19:49:59 2009
---- libavformat/isom.c	Mon Feb  2 19:49:59 2009
+*** libavformat/isom.c.old	Mon May 25 14:32:21 2009
+--- libavformat/isom.c	Mon May 25 14:32:21 2009
 ***************
-*** 187,193 ****
+*** 192,198 ****
       { CODEC_ID_MACE3, MKTAG('M', 'A', 'C', '3') }, /* Macintosh Audio Compression and Expansion 3:1 */
       { CODEC_ID_MACE6, MKTAG('M', 'A', 'C', '6') }, /* Macintosh Audio Compression and Expansion 6:1 */
   
@@ -9,7 +9,7 @@
       { CODEC_ID_MP3, 0x6D730055 }, /* MPEG layer 3 */
   
   /*  { CODEC_ID_OGG_VORBIS, MKTAG('O', 'g', 'g', 'S') }, *//* sample files at http://heroinewarrior.com/xmovie.php3 use this tag */
---- 187,196 ----
+--- 192,201 ----
       { CODEC_ID_MACE3, MKTAG('M', 'A', 'C', '3') }, /* Macintosh Audio Compression and Expansion 3:1 */
       { CODEC_ID_MACE6, MKTAG('M', 'A', 'C', '6') }, /* Macintosh Audio Compression and Expansion 6:1 */
   

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch	2009-05-24 16:30:55 UTC (rev 4870)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch	2009-05-25 16:59:24 UTC (rev 4871)
@@ -1,8 +1,8 @@
-*** libavformat/movenc.c.old	Wed Apr  1 18:35:42 2009
---- libavformat/movenc.c	Wed Apr  1 18:35:42 2009
+*** libavformat/movenc.c.old	Mon May 25 14:32:22 2009
+--- libavformat/movenc.c	Mon May 25 14:32:22 2009
 ***************
-*** 1960,1962 ****
---- 1960,1974 ----
+*** 2061,2063 ****
+--- 2061,2075 ----
       .codec_tag = (const AVCodecTag* const []){codec_ipod_tags, 0},
   };
   #endif

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch	2009-05-24 16:30:55 UTC (rev 4870)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_internal.h.patch	2009-05-25 16:59:24 UTC (rev 4871)
@@ -1,8 +1,8 @@
-*** libavutil/internal.h.old	Sat Feb 21 16:11:15 2009
---- libavutil/internal.h	Sat Feb 21 16:11:15 2009
+*** libavutil/internal.h.old	Mon May 25 14:32:23 2009
+--- libavutil/internal.h	Mon May 25 14:32:23 2009
 ***************
-*** 215,226 ****
---- 215,228 ----
+*** 218,229 ****
+--- 218,231 ----
   #endif
   
   /* avoid usage of dangerous/inappropriate system functions */

Deleted: branches/avidemux_2.5_branch_gruntster/cmake/patches/libswscale_swscale_internal.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libswscale_swscale_internal.h.patch	2009-05-24 16:30:55 UTC (rev 4870)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libswscale_swscale_internal.h.patch	2009-05-25 16:59:24 UTC (rev 4871)
@@ -1,19 +0,0 @@
-*** libswscale/swscale_internal.h.old	Wed Mar  4 20:10:31 2009
---- libswscale/swscale_internal.h	Wed Mar  4 20:10:30 2009
-***************
-*** 33,39 ****
-  
-  #define MAX_FILTER_SIZE 256
-  
-! #define VOFW 2048
-  #define VOF  (VOFW*2)
-  
-  #ifdef WORDS_BIGENDIAN
---- 33,39 ----
-  
-  #define MAX_FILTER_SIZE 256
-  
-! #define VOFW 4096
-  #define VOF  (VOFW*2)
-  
-  #ifdef WORDS_BIGENDIAN



From mean at mail.berlios.de  Sat May 30 17:01:12 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 30 May 2009 17:01:12 +0200
Subject: [Avidemux-svn-commit] r4872 - in
	branches/avidemux_2.6_branch_mean/avidemux: .
	ADM_coreVideoFilter ADM_coreVideoFilter/include
	ADM_coreVideoFilter/src
Message-ID: <200905301501.n4UF1Cb6025416@sheep.berlios.de>

Author: mean
Date: 2009-05-30 17:01:11 +0200 (Sat, 30 May 2009)
New Revision: 4872

Added:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/include/
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/include/ADM_coreVideoFilter.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/src/
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/src/ADM_coreVideoFilter.cpp
Log:
[VideoFilter] skeleton

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/CMakeLists.txt	2009-05-25 16:59:24 UTC (rev 4871)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/CMakeLists.txt	2009-05-30 15:01:11 UTC (rev 4872)
@@ -0,0 +1 @@
+ADD_SUBDIRECTORY(src)

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/include/ADM_coreVideoFilter.h
===================================================================

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/src/ADM_coreVideoFilter.cpp
===================================================================



From mean at mail.berlios.de  Sat May 30 17:01:17 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 30 May 2009 17:01:17 +0200
Subject: [Avidemux-svn-commit] r4873 - in branches/avidemux_2.6_branch_mean:
	. avidemux avidemux/ADM_audioFilter_old
	avidemux/ADM_audiocodec avidemux/ADM_coreVideoFilter/include
	avidemux/ADM_coreVideoFilter/src avidemux/ADM_editor
	avidemux/ADM_encoder avidemux/ADM_filter
	avidemux/ADM_muxerGate/src avidemux/ADM_osSupport
	avidemux/ADM_requant avidemux/ADM_script avidemux/ADM_toolkit
	avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters
	avidemux/ADM_video avidemux/ADM_videoFilter
Message-ID: <200905301501.n4UF1HXB025430@sheep.berlios.de>

Author: mean
Date: 2009-05-30 17:01:14 +0200 (Sat, 30 May 2009)
New Revision: 4873

Added:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/src/CMakeLists.txt
Modified:
   branches/avidemux_2.6_branch_mean/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter_old/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter_old/audiodeng_buildfilters.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/ADM_audiocodec.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/ADM_codecimaadpcm.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/ADM_codecmsadpcm.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/ADM_codeculaw.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/ADM_codecwav.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/include/ADM_coreVideoFilter.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/src/ADM_coreVideoFilter.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edIdentify.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edLoadSave.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edSearch.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edStub.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_outputfmt.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADMedAVIAUD.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/ADM_encCodecDesc.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/ADM_pluginLoad.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encConfig.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encCopy.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encRequant.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encXvid4.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encdivx.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encffmpeg.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encffmpeg1.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encmjpeg.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encmpeg2enc.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encoder.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encxvid.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encyv12.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/ADM_vidDummyFilter.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/filter.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/filter_autoFilter.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/filter_declaration.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/filter_saveload.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/vidVCD.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_muxerGate/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_osSupport/ADM_crashHook.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_osSupport/ADM_debug.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_osSupport/ADM_misc.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_osSupport/ADM_queue.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_osSupport/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_requant/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_requant/tcrequant.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSAvidemux.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSAvidemux.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSAvidemuxAudio.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSAvidemuxAudio.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSDirectorySearch.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSDirectorySearch.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSFunctions.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_script/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_script/DirectorySearch.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_script/StdFile.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_toolkit/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_toolkit/automation.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_video/ADM_vidNull.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_video/ADM_vidRaw.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_video/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_videoFilter/ADM_vidNumber.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_videoFilter/ADM_vidThreshold.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_videoFilter/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/avi_vars.h
Log:
[All] Use same libraries for all ui, most dependancies are in the plugins now + coreVideoFilter skeleton

Modified: branches/avidemux_2.6_branch_mean/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/CMakeLists.txt	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/CMakeLists.txt	2009-05-30 15:01:14 UTC (rev 4873)
@@ -80,7 +80,7 @@
 ########################################
 # Standard Avidemux defines
 ########################################
-SET(VERSION 2.5.0)
+SET(VERSION 2.6.0)
 
 # Define internal flags for GTK+ and Qt4 builds.  These are turned off
 # if a showstopper is found.  CLI is automatically assumed as possible

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter_old/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter_old/CMakeLists.txt	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter_old/CMakeLists.txt	2009-05-30 15:01:14 UTC (rev 4873)
@@ -2,6 +2,6 @@
 	audiodeng_buildfilters.cpp    
 )
 	
-ADD_ADM_LIB_ALL_TARGETS(ADM_audioFilter_old ${ADMaudiofilter_SRCS})
+ADD_LIBRARY(ADM_audioFilter_old STATIC ${ADMaudiofilter_SRCS})
 INCLUDE_DIRECTORIES(${CMAKE_SOURCE_DIR}/avidemux/ADM_audioEncoder/include)
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter_old/audiodeng_buildfilters.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter_old/audiodeng_buildfilters.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audioFilter_old/audiodeng_buildfilters.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -14,7 +14,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
+
 #include <math.h>
 
 #include "ADM_default.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/ADM_audiocodec.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/ADM_audiocodec.h	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/ADM_audiocodec.h	2009-05-30 15:01:14 UTC (rev 4873)
@@ -16,7 +16,7 @@
  ***************************************************************************/
 #ifndef ADMAUDIOCODEC
 #define ADMAUDIOCODEC
-
+#include "ADM_audiodef.h"
 #define SCRATCH_PAD_SIZE (100*1000*2)
 extern uint8_t scratchPad[];
 #define  ADMAC_BUFFER (48000*4)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/ADM_codecimaadpcm.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/ADM_codecimaadpcm.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/ADM_codecimaadpcm.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -18,6 +18,7 @@
 
 #include "ADM_default.h"
 #include "common.h"
+#define ADM_NO_CONFIG_H
 #include "bswap.h"
 #include "ADM_assert.h"
 #include "ADM_coreAudio.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/ADM_codecmsadpcm.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/ADM_codecmsadpcm.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/ADM_codecmsadpcm.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -13,6 +13,7 @@
 */
 
 #include "ADM_default.h"
+#define ADM_NO_CONFIG_H
 #include "common.h"
 #include "bswap.h"
 #include "ADM_coreAudio.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/ADM_codeculaw.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/ADM_codeculaw.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/ADM_codeculaw.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -19,18 +19,14 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-//#include <sstream>
-#include "ADM_assert.h"
+
+#include "ADM_default.h"
 #include <math.h>
 
-#include "config.h"
-#include "avifmt.h"
-#include "avifmt2.h"
-#include "fourcc.h"
-//#include "ADM_audio/aviaudio.hxx"
+//#include "avifmt.h"
+//#include "avifmt2.h"
+//#include "fourcc.h"
+
 #include "ADM_audiocodec/ADM_audiocodec.h"
 
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/ADM_codecwav.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/ADM_codecwav.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/ADM_codecwav.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -14,18 +14,8 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-//#include <sstream>
-#include "ADM_assert.h"
+#include "ADM_default.h"
 #include <math.h>
-
-#include "config.h"
-#include "avifmt.h"
-#include "avifmt2.h"
-#include "fourcc.h"
-//#include "ADM_audio/aviaudio.hxx"
 #include "ADM_audiocodec/ADM_audiocodec.h"
 
 ADM_AudiocodecWav::ADM_AudiocodecWav( uint32_t fourcc ) : ADM_Audiocodec(fourcc)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/CMakeLists.txt	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_audiocodec/CMakeLists.txt	2009-05-30 15:01:14 UTC (rev 4873)
@@ -2,4 +2,4 @@
 	ADM_8bits.cpp  ADM_codecimaadpcm.cpp  ADM_codecmsadpcm.cpp  ADM_codeculaw.cpp  ADM_codecwma.cpp  ADM_lpcm.cpp
 	ADM_audiocodec.cpp  ADM_codecwav.cpp  ADM_pluginLoad.cpp)
 
-ADD_ADM_LIB_ALL_TARGETS(ADM_audiocodec ${ADM_audiocodec_SRCS})
\ No newline at end of file
+ADD_LIBRARY(ADM_audiocodec STATIC ${ADM_audiocodec_SRCS})

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/include/ADM_coreVideoFilter.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/include/ADM_coreVideoFilter.h	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/include/ADM_coreVideoFilter.h	2009-05-30 15:01:14 UTC (rev 4873)
@@ -0,0 +1,53 @@
+/***************************************************************************
+                          \fn ADM_coreVideoFilter.h
+                          \brief Base class for Video Filters
+                           (c) Mean 2009
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef ADM_CORE_VIDEO_FILTER
+#define  ADM_CORE_VIDEO_FILTER
+
+#include "ADM_confCouple.h"
+#include "ADM_image.h"
+/**
+    \struct FilterInfo
+    \brief Describes the video stream at this point in the filter chain
+*/
+typedef struct
+{
+    uint32_t width;
+    uint32_t height;
+    uint32_t frameIncrement; /// Minimum Delta time between 2 frames in useconds ~ 1/fps
+    uint64_t totalDuration;     /// Duration of the whole stream in us
+}FilterInfo;
+
+/**
+ *  \class ADM_coreVideoFilter
+ *  \brief base class for all video filters
+ */
+class ADM_coreVideoFilter
+{
+public:
+            ADM_coreVideoFilter(ADM_coreVideoFilter *previous,CONFcouple *conf=NULL);
+            ~ADM_coreVideoFilter();
+
+       virtual const char   *getConfiguration(void);                    /// Return  current configuration as a human readable string
+       virtual bool         getNextFrame(ADMImage *image)=0;    /// Return the next image
+	   virtual FilterInfo  *getInfo(void);                                      /// Return picture parameters after this filter
+	   virtual bool         getCoupledConf(CONFcouple **couples)=0 ; /// Return the current filter configuration
+
+protected:
+            ADM_coreVideoFilter *previousFilter;
+};
+
+#endif
+// EOF
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/src/ADM_coreVideoFilter.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/src/ADM_coreVideoFilter.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/src/ADM_coreVideoFilter.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -0,0 +1,64 @@
+/***************************************************************************
+                          \fn ADM_coreVideoFilter.h
+                          \brief Base class for Video Filters
+                           (c) Mean 2009
+
+    This is used to build the video filter chain
+    It is a simple "one in, one out" system based on pull.
+    I.e. the final client asks for a frame and each stage asks its predecessor for a frame
+if needed.
+
+    The fist stage is the VideoFilterBridge. Its translates ADM_composer API to
+    ADM_coreVideoFilter API.
+    Then a bunch of ADM_coreVideoFilter using the ADM_coreVideoFilter API
+    And at last the ADM_coreVideoEncoder that translate ADM_coreVideoFilter api
+        to ADM_videoStream API ready to be sent to the muxer
+
+    ADM_videoBody -> ADM_VideoFilterBridge > coreFilter->coreFilter.....->coreFilter->coreVideoEncoder
+
+
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include "ADM_default.h"
+#include "ADM_coreVideoFilter.h"
+/**
+    \fn ADM_coreVideoFilter
+
+*/
+ ADM_coreVideoFilter::ADM_coreVideoFilter(ADM_coreVideoFilter *previous,CONFcouple *conf)
+{
+    previousFilter=previous;
+}
+/**
+    \fn  ~ADM_coreVideoFilter
+*/
+ ADM_coreVideoFilter:: ~ADM_coreVideoFilter()
+{
+
+}
+/**
+    \fn getConfiguration
+*/
+const char        *ADM_coreVideoFilter::getConfiguration(void)
+{
+    return "base";
+}  
+/**
+    \fn getInfo
+    \brief default behaviour, we return the Info as is from the previous filter in the chain
+*/
+FilterInfo  *ADM_coreVideoFilter::getInfo(void)
+{
+    ADM_assert(previousFilter);
+    return previousFilter->getInfo();
+}
+// EOF

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/src/CMakeLists.txt	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/src/CMakeLists.txt	2009-05-30 15:01:14 UTC (rev 4873)
@@ -0,0 +1,8 @@
+SET(ADM_CoreVideoFilter_SRCS 
+	ADM_coreVideoFilter.cpp
+)
+
+ADD_LIBRARY(ADM_coreVideoFilter SHARED ${ADM_CoreVideoFilter_SRCS})
+TARGET_LINK_LIBRARIES(ADM_coreVideoFilter ADM_core)
+
+INSTALL(TARGETS ADM_coreVideoFilter RUNTIME DESTINATION ${BIN_DIR}  LIBRARY DESTINATION lib  ARCHIVE DESTINATION lib)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edIdentify.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edIdentify.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edIdentify.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -17,30 +17,14 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-
-#include "ADM_assert.h"
-#include "config.h"
+#include "ADM_default.h"
 #include "fourcc.h"
 #include "ADM_editor/ADM_edit.hxx"
-#if 0
-#include "ADM_inputs/ADM_inpics/ADM_pics.h"
-#include "ADM_inputs/ADM_nuv/ADM_nuv.h"
-#include "ADM_inputs/ADM_h263/ADM_h263.h"
-//#include "ADM_3gp/ADM_3gp.h"
-#include "ADM_inputs/ADM_mp4/ADM_mp4.h"
-#include "ADM_inputs/ADM_avsproxy/ADM_avsproxy.h"
-#endif
-
-
-#include "ADM_editor/ADM_edit.hxx"
 #include "ADM_videoFilter.h"
 
 #include "ADM_coreDemuxerMpeg/include/dmx_identify.h"
-#include "ADM_assert.h"
 
+
 DMX_TYPE dmxIdentify(const char *name);
 
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edLoadSave.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edLoadSave.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edLoadSave.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -17,24 +17,12 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <errno.h>
-
+#include "ADM_default.h"
 #include "fourcc.h"
 #include "ADM_quota.h"
-#include "ADM_assert.h"
 #include "ADM_editor/ADM_edit.hxx"
 
-#if 0
-#include "ADM_inputs/ADM_inpics/ADM_pics.h"
-#include "ADM_inputs/ADM_nuv/ADM_nuv.h"
-#include "ADM_inputs/ADM_h263/ADM_h263.h"
-#endif
 
-
 #include "DIA_coreToolkit.h"
 #include "ADM_editor/ADM_edit.hxx"
 #include "ADM_videoFilter.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edSearch.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edSearch.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edSearch.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -14,12 +14,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include "ADM_assert.h"
-
-#include "config.h"
+#include "ADM_default.h"
 #include "fourcc.h"
 #include "ADM_editor/ADM_edit.hxx"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edStub.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edStub.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_edStub.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -14,13 +14,10 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include "ADM_assert.h"
+#include "ADM_default.h"
 #include <math.h>
 
-#include "config.h"
+
 #include "fourcc.h"
 #include "ADM_editor/ADM_edit.hxx"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_outputfmt.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_outputfmt.h	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADM_outputfmt.h	2009-05-30 15:01:14 UTC (rev 4873)
@@ -11,7 +11,7 @@
 //
 #ifndef ADM_OUT_FMT
 #define ADM_OUT_FMT
-#include "config.h"
+
 typedef enum 
 {
 	ADM_AVI=0,

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADMedAVIAUD.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADMedAVIAUD.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/ADMedAVIAUD.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -28,7 +28,7 @@
 #include "ADM_default.h"
 #include <math.h>
 
-#include "config.h"
+
 #include "fourcc.h"
 #include "ADM_editor/ADM_edit.hxx"
 #include "ADM_editor/ADM_edAudio.hxx"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/CMakeLists.txt	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_editor/CMakeLists.txt	2009-05-30 15:01:14 UTC (rev 4873)
@@ -13,4 +13,4 @@
 ADM_edPtsDts.cpp
 )
 
-ADD_ADM_LIB_ALL_TARGETS(ADM_editor ${ADM_editor_SRCS})
+ADD_LIBRARY(ADM_editor STATIC ${ADM_editor_SRCS})

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/ADM_encCodecDesc.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/ADM_encCodecDesc.h	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/ADM_encCodecDesc.h	2009-05-30 15:01:14 UTC (rev 4873)
@@ -251,6 +251,7 @@
   sizeof (ffmpeg4Extra),
   NULL
 };
+#if 0
 static MJPEGConfig MjpegExtra = { 90, 0 };
 extern uint8_t DIA_mjpegCodecSetting (COMPRES_PARAMS * param);
 COMPRES_PARAMS MjpegCodec = {
@@ -266,7 +267,7 @@
   sizeof (MjpegExtra),
   &DIA_mjpegCodecSetting
 };
-
+#endif
 //************************* FFMpeg mpeg1 **********************
 FFcodecSetting ffmpeg1Extra = {
   ME_EPZS,			//     ME
@@ -711,7 +712,7 @@
   &ffmpegFFV1,
   &yv12codec,
   &ffmpegH263Codec,
-  &MjpegCodec,
+  //&MjpegCodec,
   &ffmpegFLV1,
   &DUMMYONE
 };

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/ADM_pluginLoad.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/ADM_pluginLoad.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/ADM_pluginLoad.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -14,7 +14,7 @@
  *                                                                         *
  ***************************************************************************/
 
-#include "config.h"
+
 #include "ADM_default.h"
 #include <vector>
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/CMakeLists.txt	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/CMakeLists.txt	2009-05-30 15:01:14 UTC (rev 4873)
@@ -3,9 +3,9 @@
 	adm_encCopy.cpp    adm_encdivx.cpp    adm_encffmpeg.cpp   adm_encmpeg2enc.cpp  adm_encRequant.cpp  adm_encXvid4.cpp  adm_encyv12.cpp
 	ADM_pluginLoad.cpp ADM_externalEncoder.cpp)
 
-ADD_ADM_LIB_ALL_TARGETS(ADM_encoder ${ADM_encoder_SRCS})
+ADD_LIBRARY(ADM_encoder STATIC ${ADM_encoder_SRCS})
 
 IF (USE_XVID_4)
 	ADD_SOURCE_CFLAGS(adm_encxvid.cpp -I${XVID_INCLUDE_DIR})
 	ADD_SOURCE_CFLAGS(adm_encXvid4.cpp -I${XVID_INCLUDE_DIR})
-ENDIF (USE_XVID_4)
\ No newline at end of file
+ENDIF (USE_XVID_4)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encConfig.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encConfig.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encConfig.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -14,8 +14,8 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
 
+
 #include "ADM_lavcodec.h"
 
 #include "ADM_assert.h"
@@ -44,7 +44,7 @@
 void setVideoEncoderSettings(COMPRESSION_MODE mode, uint32_t param, uint32_t extraConf, uint8_t *extraData);
 static void encoderPrint(void);
 
-#include "adm_encConfig.h"
+
 #include "adm_encoder.h"
 
 #ifdef USE_XVID_4
@@ -66,9 +66,11 @@
 #include "adm_encmjpeg.h"
 #include "adm_encCopy.h"
 #include "adm_encyv12.h"
+#include "adm_encConfig.h"
 #include "ADM_pluginLoad.h"
 #include "ADM_externalEncoder.h"
 
+
 /*
   	Codec settings here
 */
@@ -591,9 +593,11 @@
 	case CodecFF:
 		e = new EncoderFFMPEG (FF_MPEG4, desc);
 		break;
+#if 0
 	case CodecMjpeg:
 		e = new EncoderMjpeg (&MjpegCodec);
 		break;
+#endif
 	case CodecFFhuff:
 		e = new EncoderFFMPEGFFHuff (desc);
 		break;

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encCopy.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encCopy.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encCopy.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -21,7 +21,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
+
 #include "ADM_default.h"
 
 #include "fourcc.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encRequant.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encRequant.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encRequant.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -12,14 +12,14 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
 
 
+#include "ADM_default.h"
 #include "fourcc.h"
 #include "avi_vars.h"
 
-#include "ADM_assert.h"
 
+
 #include "ADM_encoder/ADM_vidEncode.hxx"
 
 #include "ADM_videoFilter.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encXvid4.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encXvid4.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encXvid4.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -15,9 +15,9 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
 
 
+
 #ifdef USE_XVID_4
 #include "xvid.h"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encdivx.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encdivx.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encdivx.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -22,7 +22,7 @@
 
 #include <time.h>
 #include <sys/time.h>
-#include "config.h"
+
 #ifdef USE_DIVX
 
 #include "fourcc.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encffmpeg.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encffmpeg.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encffmpeg.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -14,8 +14,8 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
 
+
 #include "ADM_lavcodec.h"
 
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encffmpeg1.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encffmpeg1.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encffmpeg1.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -14,7 +14,6 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
 
 #include <unistd.h>
 
@@ -24,12 +23,12 @@
 
 #ifdef USE_FFMPEG
 #include "ADM_lavcodec.h"
-
+#include "ADM_default.h"
 #include "fourcc.h"
 #include "avi_vars.h"
 #include "DIA_coreToolkit.h"
-#include "ADM_assert.h"
 
+
 #include "ADM_encoder/ADM_vidEncode.hxx"
 
 #include "ADM_videoFilter.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encmjpeg.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encmjpeg.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encmjpeg.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -14,8 +14,8 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
 
+
 #include <stdio.h>
 #include <stdlib.h>
 #include <math.h>
@@ -27,6 +27,7 @@
 
 #ifdef USE_FFMPEG
 #include "ADM_lavcodec.h"
+#include "ADM_default.h"
 #include "fourcc.h"
 #include "avi_vars.h"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encmpeg2enc.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encmpeg2enc.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encmpeg2enc.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -12,11 +12,8 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
 
-#include <stdio.h>
-#include <stdlib.h>
-#include <math.h>
+#include "ADM_default.h"
 #include <unistd.h>
 #include <time.h>
 #include <sys/time.h>

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encoder.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encoder.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encoder.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -14,8 +14,8 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
 
+
 #include <time.h>
 #include <sys/time.h>
 
@@ -24,12 +24,12 @@
 #ifdef USE_FFMPEG
 #include "ADM_lavcodec.h"
 #endif
-
+#include "ADM_default.h"
 #include "fourcc.h"
 #include "avi_vars.h"
 
-#include "ADM_assert.h"
 
+
 #include "ADM_encoder/ADM_vidEncode.hxx"
 
 #include "ADM_videoFilter.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encxvid.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encxvid.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encxvid.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -22,7 +22,7 @@
 
 #include <time.h>
 #include <sys/time.h>
-#include "config.h"
+
 #ifdef USE_XX_XVID
 #include "xvid.h"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encyv12.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encyv12.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_encoder/adm_encyv12.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -15,14 +15,14 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
 
 
+#include "ADM_default.h"
 #include "fourcc.h"
 #include "avi_vars.h"
 
-#include "ADM_assert.h"
 
+
 #include "ADM_encoder/ADM_vidEncode.hxx"
 
 #include "ADM_videoFilter.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/ADM_vidDummyFilter.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/ADM_vidDummyFilter.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/ADM_vidDummyFilter.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -15,7 +15,7 @@
  *                                                                         *
  ***************************************************************************/
 
-#include "config.h"
+
 #if 0 // OBSOLETE
 
 #include "ADM_default.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/CMakeLists.txt	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/CMakeLists.txt	2009-05-30 15:01:14 UTC (rev 4873)
@@ -6,5 +6,5 @@
 filter_autoFilter.cpp
 vidVCD.cpp)
 
-ADD_ADM_LIB_ALL_TARGETS(ADM_filter ${ADM_filter_SRCS})
-ADD_CFLAGS_ALL_TARGETS(ADM_filter -I${LIBXML2_INCLUDE_DIR} ${LIBXML2_DEFINITIONS})
+ADD_LIBRARY(ADM_filter STATIC ${ADM_filter_SRCS})
+ADD_TARGET_CFLAGS(ADM_filter -I${LIBXML2_INCLUDE_DIR} ${LIBXML2_DEFINITIONS})

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/filter.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/filter.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/filter.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -14,14 +14,8 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
+#include "ADM_default.h"
 #include <vector>
-
-#include "ADM_assert.h"
-#include "config.h"
 #include "fourcc.h"
 #include "DIA_fileSel.h"
 #include "ADM_dynamicLoading.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/filter_autoFilter.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/filter_autoFilter.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/filter_autoFilter.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -15,7 +15,6 @@
  *                                                                         *
  ***************************************************************************/
 
-#include "config.h"
 #include "ADM_default.h"
 
 #include "ADM_videoFilter.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/filter_declaration.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/filter_declaration.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/filter_declaration.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -19,7 +19,6 @@
  *                                                                         *
  ***************************************************************************/
 
-#include "config.h"
 #include "ADM_default.h"
 
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/filter_saveload.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/filter_saveload.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/filter_saveload.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -17,18 +17,15 @@
  *                                                                         *
  ***************************************************************************/
 #define ADM_LEGACY_PROGGY
-#include "config.h"
 
-#ifdef USE_LIBXML2
-	#include <libxml/tree.h>
-	#include <libxml/parser.h>
-#endif
-
+#include "ADM_default.h"
+#include <libxml/tree.h>
+#include <libxml/parser.h>
 #include "fourcc.h"
 #include "DIA_coreToolkit.h"
 #include "ADM_quota.h"
-#include "ADM_assert.h"
 
+
 #include "ADM_editor/ADM_edit.hxx"
 #include "ADM_videoFilter.h"
 #include "ADM_video/ADM_videoNull.h"
@@ -49,7 +46,7 @@
 
 
 */
-#ifdef USE_LIBXML2
+
 static int32_t getIntegerAttribute(xmlNodePtr node, char *name, char *atrname);
 static xmlNodePtr nextByName(xmlNodePtr node,char *name);
 static CONFcouple *buildCouple(uint32_t nb, xmlNodePtr node);
@@ -302,4 +299,4 @@
 	return -1;
 }
 
-#endif
+//EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/vidVCD.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/vidVCD.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_filter/vidVCD.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -20,19 +20,14 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include "ADM_assert.h"
 
-#include "ADM_assert.h"
+#include "ADM_default.h"
 
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <unistd.h>
 #include <string.h>
 #include <math.h>
-#include "config.h"
 #include "fourcc.h"
 #include "avi_vars.h"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_muxerGate/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_muxerGate/src/CMakeLists.txt	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_muxerGate/src/CMakeLists.txt	2009-05-30 15:01:14 UTC (rev 4873)
@@ -2,4 +2,4 @@
 ADM_videoCopy.cpp
 )
 include_directories(../include)
-ADD_ADM_LIB_ALL_TARGETS(ADM_muxerGate ${ADM_muxerGate_SRCS})
+ADD_LIBRARY(ADM_muxerGate STATIC ${ADM_muxerGate_SRCS})

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_osSupport/ADM_crashHook.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_osSupport/ADM_crashHook.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_osSupport/ADM_crashHook.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -14,7 +14,7 @@
  *                                                                         *
  ***************************************************************************/
 
-#include "config.h"
+
 #include "ADM_default.h"
 #include "DIA_coreToolkit.h"
 #include "ADM_editor/ADM_edit.hxx"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_osSupport/ADM_debug.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_osSupport/ADM_debug.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_osSupport/ADM_debug.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -16,14 +16,8 @@
  *                                                                         *
  ***************************************************************************/
 
-#include "config.h"
-
-#include <stdio.h>
-#include <stdlib.h>
-#include <stdarg.h>
-#include <string.h>
 #include "ADM_default.h"
-#include "ADM_assert.h"
+#include <stdarg.h>
 #include <math.h>
 
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_osSupport/ADM_misc.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_osSupport/ADM_misc.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_osSupport/ADM_misc.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -1,6 +1,5 @@
 #include <math.h>
 
-#include "config.h"
 #include "ADM_default.h"
 
 char* ms2timedisplay(uint32_t ms)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_osSupport/ADM_queue.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_osSupport/ADM_queue.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_osSupport/ADM_queue.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -12,14 +12,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
- 
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include "ADM_assert.h"
 #include "ADM_default.h"
-
 #include "ADM_queue.h"
 
 ADM_queue::ADM_queue()

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_osSupport/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_osSupport/CMakeLists.txt	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_osSupport/CMakeLists.txt	2009-05-30 15:01:14 UTC (rev 4873)
@@ -5,5 +5,5 @@
 ADM_queue.cpp 
 )
 
-ADD_ADM_LIB_ALL_TARGETS(ADM_osSupport ${ADM_osSupport_SRCS})
+ADD_LIBRARY(ADM_osSupport STATIC ${ADM_osSupport_SRCS})
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_requant/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_requant/CMakeLists.txt	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_requant/CMakeLists.txt	2009-05-30 15:01:14 UTC (rev 4873)
@@ -1,3 +1,3 @@
 SET(ADM_requant_SRCS tcrequant.c)
 
-ADD_ADM_LIB_ALL_TARGETS(ADM_requant ${ADM_requant_SRCS})
+ADD_LIBRARY(ADM_requant STATIC ${ADM_requant_SRCS})

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_requant/tcrequant.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_requant/tcrequant.c	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_requant/tcrequant.c	2009-05-30 15:01:14 UTC (rev 4873)
@@ -41,9 +41,7 @@
 // - intra blocks quantiser is incremented two step
 // - drop a few coefficients but always keep the first one
 
-#ifdef HAVE_CONFIG_H
-#include "config.h"
-#endif
+#include "ADM_default.h"
 
 // includes
 #include <stdio.h>
@@ -55,7 +53,6 @@
 
 
 // MEANX
-#include "ADM_default.h"
 #include "tcrequant.h"
 
 #include "ADM_osSupport/ADM_debugID.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSAvidemux.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSAvidemux.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSAvidemux.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -9,7 +9,6 @@
 // Copyright: See COPYING file that comes with this distribution
 //
 //
-#include "config.h"
 
 #include <math.h>
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSAvidemux.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSAvidemux.h	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSAvidemux.h	2009-05-30 15:01:14 UTC (rev 4873)
@@ -2,8 +2,8 @@
 #define _ADM_JSAVIDEMUX_H
 
 #pragma once
-#include "config.h"
 
+
 // Spidermonkey
 #include "ADM_libraries/ADM_smjs/jsapi.h"
 #include "ADM_Avidemux.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSAvidemuxAudio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSAvidemuxAudio.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSAvidemuxAudio.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -11,7 +11,7 @@
 //
 
 #include "ADM_default.h"
-#include "config.h"
+
 #include "ADM_JSGlobal.h"
 #include "ADM_JSAvidemuxAudio.h"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSAvidemuxAudio.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSAvidemuxAudio.h	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSAvidemuxAudio.h	2009-05-30 15:01:14 UTC (rev 4873)
@@ -3,8 +3,8 @@
 
 #pragma once
 
-#include "config.h"
 
+
 // Spidermonkey
 #include "ADM_libraries/ADM_smjs/jsapi.h"
 #include "ADM_AvidemuxAudio.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSDirectorySearch.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSDirectorySearch.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSDirectorySearch.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -8,7 +8,7 @@
 // Copyright: See COPYING file that comes with this distribution
 //
 //
-#include "config.h"
+
 #include "ADM_JSDirectorySearch.h"
 #include "DirectorySearch.h"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSDirectorySearch.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSDirectorySearch.h	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSDirectorySearch.h	2009-05-30 15:01:14 UTC (rev 4873)
@@ -3,8 +3,8 @@
 
 #pragma once
 
-#include "config.h"
 
+
 // Spidermonkey
 #include "ADM_libraries/ADM_smjs/jsapi.h"
 #include <string.h>

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSFunctions.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSFunctions.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_script/ADM_JSFunctions.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -9,9 +9,7 @@
 // Copyright: See COPYING file that comes with this distribution
 //
 //
-#include "config.h"
-#include <stdlib.h>
-#include <unistd.h>
+#include "ADM_default.h"
 #include <sys/types.h>
 #include <sys/stat.h>
 #if defined( ADM_WIN32 ) || defined(__MINGW32__)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_script/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_script/CMakeLists.txt	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_script/CMakeLists.txt	2009-05-30 15:01:14 UTC (rev 4873)
@@ -2,5 +2,5 @@
 	ADM_AvidemuxAudio.cpp  ADM_AvidemuxVideo.cpp    ADM_JSAvidemux.cpp       ADM_JSDirectorySearch.cpp  ADM_JSGlobal.cpp
 	ADM_Avidemux.cpp       ADM_JSAvidemuxAudio.cpp  ADM_JSAvidemuxVideo.cpp  ADM_JSFunctions.cpp        DirectorySearch.cpp)
 
-ADD_ADM_LIB_ALL_TARGETS(ADM_script ${ADM_script_SRCS})
-ADD_CFLAGS_ALL_TARGETS(ADM_script "-DJS_THREADSAFE -DXP_UNIX")
\ No newline at end of file
+ADD_LIBRARY(ADM_script STATIC ${ADM_script_SRCS})
+ADD_TARGET_CFLAGS(ADM_script "-DJS_THREADSAFE -DXP_UNIX")

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_script/DirectorySearch.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_script/DirectorySearch.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_script/DirectorySearch.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -8,7 +8,7 @@
 at amistry at am-productions.biz
 */
 #include <string.h>
-#include "config.h"
+#include "ADM_default.h"
 #include "DirectorySearch.h"
 
 //////////////////////////////////////////////////////////////////////

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_script/StdFile.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_script/StdFile.h	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_script/StdFile.h	2009-05-30 15:01:14 UTC (rev 4873)
@@ -14,7 +14,7 @@
 #if _MSC_VER > 1000
 #pragma once
 #endif // _MSC_VER > 1000
-#include "config.h"
+
 #include <iostream>
 #include <iomanip>
 #include <fstream>

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_toolkit/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_toolkit/CMakeLists.txt	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_toolkit/CMakeLists.txt	2009-05-30 15:01:14 UTC (rev 4873)
@@ -1,4 +1,4 @@
 SET(ADM_toolkit_SRCS 
 	ADM_audioQueue.cpp  ADM_packetQueue.cpp  automation.cpp  filesel.cpp)
 	
-ADD_ADM_LIB_ALL_TARGETS(ADM_toolkit ${ADM_toolkit_SRCS})
+ADD_LIBRARY(ADM_toolkit STATIC ${ADM_toolkit_SRCS})

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_toolkit/automation.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_toolkit/automation.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_toolkit/automation.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -17,8 +17,8 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
 
+
 #include <stdlib.h>
 #include <signal.h>
 #ifndef __WIN32
@@ -26,10 +26,10 @@
 #endif
 #include <math.h>
 #include <ctype.h>
-
+#include "ADM_default.h"
 #include "avi_vars.h"
-#include "ADM_assert.h"
 
+
 #include "gui_action.hxx"
 #include "ADM_encoder/ADM_vidEncode.hxx"
 #include "audioeng_buildfilters.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -6,10 +6,12 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
+#include <vector>
+#include "ADM_toolkitGtk.h"
+#include "ADM_default.h"
 
-#include "ADM_toolkitGtk.h"
-#include <vector>
 
+
 #include "DIA_coreToolkit.h"
 #include "DIA_fileSel.h"
 #include "ADM_videoFilter.h"
@@ -333,11 +335,8 @@
         break;
 
     case A_LOAD:
-#ifdef USE_LIBXML2
+
         GUI_FileSelRead (QT_TR_NOOP("Load set of filters"), filterLoadXml);
-#else
-        GUI_FileSelRead (QT_TR_NOOP("Load set of filters"), filterLoad);
-#endif
         updateFilterList ();
         setSelectionNumber(nb_active_filter-1, WID(treeview0), stores[0], 0);
         break;
@@ -352,11 +351,8 @@
             GUI_Error_HIG (QT_TR_NOOP("Nothing to save"), NULL);
         }
         else
-#ifdef USE_LIBXML2
+
             GUI_FileSelWrite (QT_TR_NOOP("Save set of filters"), filterSaveXml);
-#else
-            GUI_FileSelWrite (QT_TR_NOOP("Save set of filters"), filterSave);
-#endif
         break;
 #if 0
     default:

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -6,10 +6,11 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
 #include "ADM_toolkitGtk.h"
 #include "ADM_default.h"
 
+
+
 #define GLADE_HOOKUP_OBJECT(component,widget,name) \
   g_object_set_data_full (G_OBJECT (component), name, \
     gtk_widget_ref (widget), (GDestroyNotify) gtk_widget_unref)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_video/ADM_vidNull.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_video/ADM_vidNull.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_video/ADM_vidNull.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -21,7 +21,6 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
 #include "ADM_default.h"
 #include "ADM_editor/ADM_edit.hxx"
 #include "ADM_videoFilter.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_video/ADM_vidRaw.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_video/ADM_vidRaw.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_video/ADM_vidRaw.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -17,7 +17,6 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
 #include "ADM_default.h"
 #include "ADM_editor/ADM_edit.hxx"
 #include "ADM_videoFilter.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_video/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_video/CMakeLists.txt	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_video/CMakeLists.txt	2009-05-30 15:01:14 UTC (rev 4873)
@@ -3,11 +3,11 @@
 ADM_vidRaw.cpp        
 ADM_vidNull.cpp)
 
-ADD_ADM_LIB_ALL_TARGETS(ADM_video ${ADM_video_SRCS})
+ADD_LIBRARY(ADM_video ${ADM_video_SRCS})
 
 IF (USE_FREETYPE)
-	ADD_CFLAGS_ALL_TARGETS(ADM_video ${FREETYPE2_CFLAGS})
+	ADD_TARGET_CFLAGS(ADM_video ${FREETYPE2_CFLAGS})
 ENDIF (USE_FREETYPE)
 
-ADD_CFLAGS_ALL_TARGETS(ADM_video "-I../ADM_inputs")
+ADD_TARGET_CFLAGS(ADM_video "-I../ADM_inputs")
 #ADM_vidFieldUnblend.cpp  

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -18,7 +18,6 @@
  *                                                                         *
  ***************************************************************************/
  
-#include "config.h"
 #include "ADM_default.h"
 #include "ADM_videoFilter.h"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_videoFilter/ADM_vidNumber.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_videoFilter/ADM_vidNumber.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_videoFilter/ADM_vidNumber.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -15,7 +15,6 @@
  *                                                                         *
  ***************************************************************************/
 
-#include "config.h"
 #include "ADM_default.h"
 #include "ADM_videoFilter.h"
 #include "ADM_videoFilterDynamic.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_videoFilter/ADM_vidThreshold.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_videoFilter/ADM_vidThreshold.cpp	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_videoFilter/ADM_vidThreshold.cpp	2009-05-30 15:01:14 UTC (rev 4873)
@@ -14,7 +14,6 @@
  *                                                                         *
  ***************************************************************************/
  
-#include "config.h"
 #include "ADM_default.h"
 #include "ADM_videoFilter.h"
 #include "DIA_factory.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_videoFilter/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_videoFilter/CMakeLists.txt	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_videoFilter/CMakeLists.txt	2009-05-30 15:01:14 UTC (rev 4873)
@@ -8,5 +8,5 @@
 	ADM_vidThreshold.cpp
 	ADM_vidNumber.cpp)
 
-ADD_ADM_LIB_ALL_TARGETS(ADM_videoFilter ${ADM_videoFilter_SRCS})
+ADD_LIBRARY(ADM_videoFilter STATIC ${ADM_videoFilter_SRCS})
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/CMakeLists.txt	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/CMakeLists.txt	2009-05-30 15:01:14 UTC (rev 4873)
@@ -81,6 +81,7 @@
         ADM_coreAudioDevice
         ADM_coreUtils
         ADM_coreMuxer
+        ADM_coreVideoFilter
 )
 FOREACH(_current ${ADM_CORES})
         INCLUDE_DIRECTORIES(${_current}/include)
@@ -199,7 +200,7 @@
 )
 FOREACH(_current ${ADM_SUBDIR})
 	ADD_SUBDIRECTORY(${_current})
-	ADD_ADMLIB_ALL_TARGETS(${_current})
+	ADD_LIB_ALL_TARGETS(${_current})
 ENDFOREACH(_current ${ADM_SUBDIR})
 
 ###########################################
@@ -215,14 +216,16 @@
 	ADM_osSupport
 	ADM_encoder
 	ADM_toolkit
-	ADM_codecs
 	ADM_requant
 	)
 
 FOREACH(_current ${ADM_TAILS})
 	ADD_SUBDIRECTORY(${_current})
-	ADD_ADMLIB_ALL_TARGETS(${_current})
+	ADD_LIB_ALL_TARGETS(${_current})
 ENDFOREACH(_current ${ADM_TAILS})
+#
+	ADD_SUBDIRECTORY(ADM_codecs)
+	ADD_ADMLIB_ALL_TARGETS(ADM_codecs)
 ###########################################
 # Construct ADM_libraries
 ###########################################

Modified: branches/avidemux_2.6_branch_mean/avidemux/avi_vars.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/avi_vars.h	2009-05-30 15:01:11 UTC (rev 4872)
+++ branches/avidemux_2.6_branch_mean/avidemux/avi_vars.h	2009-05-30 15:01:14 UTC (rev 4873)
@@ -1,6 +1,6 @@
 #ifndef __AVI_VARS
 #define __AVI_VARS
-#include "config.h"
+
 #include "fourcc.h"
 #include "ADM_editor/ADM_edit.hxx"
 //----------------------



From mean at mail.berlios.de  Sat May 30 17:46:27 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 30 May 2009 17:46:27 +0200
Subject: [Avidemux-svn-commit] r4874 - in
	branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter:
	include src
Message-ID: <200905301546.n4UFkR2S028995@sheep.berlios.de>

Author: mean
Date: 2009-05-30 17:46:27 +0200 (Sat, 30 May 2009)
New Revision: 4874

Added:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/include/ADM_videoFilterBridge.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/src/ADM_videoFilterBridge.cpp
Log:
[VideoFilter] Bridge

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/include/ADM_videoFilterBridge.h
===================================================================

Added: branches/avidemux_2.6_branch_mean/avidemux/ADM_coreVideoFilter/src/ADM_videoFilterBridge.cpp
===================================================================



From mean at mail.berlios.de  Sat May 30 17:46:35 2009
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 30 May 2009 17:46:35 +0200
Subject: [Avidemux-svn-commit] r4875 - in
	branches/avidemux_2.6_branch_mean/avidemux: .
	ADM_libraries/ADM_libmpeg2enc ADM_libraries/ADM_xvidratectl
Message-ID: <200905301546.n4UFkZUF029005@sheep.berlios.de>

Author: mean
Date: 2009-05-30 17:46:29 +0200 (Sat, 30 May 2009)
New Revision: 4875

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/ADM_mpe2enc.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/build_sub22_mests.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/build_sub44_mests.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/conform.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/cpu_accel.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/fdct_mmx.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/fdct_x86.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/fdctdata.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/fdctref.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/feedframe.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/find_best_one_pel.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/idct.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/idct_mmx.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/idctdata.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/ioio.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/macroblock.hh
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_bsad_mmx.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_bsumsq_mmx.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sad_mmx.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sad_mmxe.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sub44_sads_x86.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sub44_sads_x86.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sumsq_mmx.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/motion.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/motionest.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/motionsearch.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/motionsearch.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2enc.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2enc_if.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2param.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2setup.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mpegconsts.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predcomp_mmx.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predcomp_mmxe.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predict.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_mmx.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_ref.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_x86.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/putbits.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/puthdr.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/putmpg.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/putpic.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/putseq.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/putvlc.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/quant_mmx2.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_ref.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_ref.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_x86.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/ratectl.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/ratectl.hh
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/readpic.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/simd.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/stats.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/syntaxparams.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_ref.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_ref.h
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_x86.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/writepic.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/xx.c
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/yuv4mpeg.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/yuv4mpeg_ratio.cc
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_xvidratectl/ADM_oldxvid.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_xvidratectl/ADM_xvidratectl.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_xvidratectl/ADM_xvidratectlVBV.cpp
   branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_xvidratectl/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/CMakeLists.txt
Log:
[ALL] More libraries factorization

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/ADM_mpe2enc.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/ADM_mpe2enc.cpp	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/ADM_mpe2enc.cpp	2009-05-30 15:46:29 UTC (rev 4875)
@@ -20,7 +20,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
+#include "ADM_default.h""
 
 #include <stdio.h>
 #include <stdlib.h>

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/CMakeLists.txt	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/CMakeLists.txt	2009-05-30 15:46:29 UTC (rev 4875)
@@ -21,19 +21,19 @@
 		altivec/sumsq_sub22.c  altivec/variance.c)
 ENDIF (ADM_CPU_ALTIVEC)
 
-ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
-ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} "-I${CMAKE_CURRENT_SOURCE_DIR}")
+ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
+ADD_TARGET_CFLAGS(${ADM_LIB} "-I${CMAKE_CURRENT_SOURCE_DIR}")
 
 IF (ADM_CPU_X86)
-	ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} "-DHAVE_X86CPU")
+	ADD_TARGET_CFLAGS(${ADM_LIB} "-DHAVE_X86CPU")
 
 	IF (ADM_CPU_X86_64)
-		ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} "-DHAVE_X86_64_CPU")
+		ADD_TARGET_CFLAGS(${ADM_LIB} "-DHAVE_X86_64_CPU")
 	ENDIF (ADM_CPU_X86_64)
 ELSEIF (ADM_CPU_ALTIVEC)
-	ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} "-DHAVE_ALTIVEC")
+	ADD_TARGET_CFLAGS(${ADM_LIB} "-DHAVE_ALTIVEC")
 
 	IF (NOT APPLE)
-		ADD_CFLAGS_ALL_TARGETS(${ADM_LIB} "-DHAVE_ALTIVEC_H")
+		ADD_TARGET_CFLAGS(${ADM_LIB} "-DHAVE_ALTIVEC_H")
 	ENDIF (NOT APPLE)
 ENDIF (ADM_CPU_X86)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/build_sub22_mests.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/build_sub22_mests.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/build_sub22_mests.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -1,4 +1,4 @@
-#include "config.h"
+#include "ADM_default.h"
 #include "mmxsse_motion.h"
 #include "fastintfns.h"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/build_sub44_mests.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/build_sub44_mests.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/build_sub44_mests.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -1,4 +1,4 @@
-#include "config.h"
+#include "ADM_default.h"
 #include "mmxsse_motion.h"
 
 int (*pmblocks_sub44_mests)( uint8_t *blk,  uint8_t *ref,

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/conform.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/conform.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/conform.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -27,7 +27,7 @@
  *
  */
 
-#include "config.h"
+#include "ADM_default.h"
 #include <stdlib.h>
 #include "mjpeg_logging.h"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/cpu_accel.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/cpu_accel.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/cpu_accel.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -19,7 +19,7 @@
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  */
 
-#include <config.h>
+#include <ADM_default.h>
 #include <stdio.h>
 #include <signal.h>
 #include <setjmp.h>

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/fdct_mmx.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/fdct_mmx.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/fdct_mmx.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -30,7 +30,7 @@
  *  G.Vervoort Jan 2005: ported to inline asm.
  */
 
-#include <config.h>
+#include <ADM_default.h>
 #ifdef HAVE_X86CPU
 #include "mjpeg_types.h"
 #include "attributes.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/fdct_x86.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/fdct_x86.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/fdct_x86.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -1,4 +1,4 @@
-#include <config.h>
+#include <ADM_default.h>
 #ifdef HAVE_X86CPU
 #include <math.h>
 #include <unistd.h>

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/fdctdata.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/fdctdata.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/fdctdata.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -27,9 +27,7 @@
 //  liaor at iname.com  http://members.tripod.com/~liaor  
 //////////////////////////////////////////////////////////////////////////////
 
-#ifdef HAVE_CONFIG_H
-#include "config.h"
-#endif
+#include "ADM_default.h"
 
 #include "mjpeg_types.h"
 #include "attributes.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/fdctref.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/fdctref.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/fdctref.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -47,7 +47,7 @@
  */
 
 
-#include <config.h>
+#include <ADM_default.h>
 #include <math.h>
 #include <stdio.h>
 #include "mjpeg_types.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/feedframe.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/feedframe.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/feedframe.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -21,7 +21,7 @@
 	We prebuff PREFILL frame to not have problems
 		then do 1 in/ 1 out.
 */
-#include <config.h>
+#include <ADM_default.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/find_best_one_pel.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/find_best_one_pel.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/find_best_one_pel.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -1,4 +1,4 @@
-#include "config.h"
+#include "ADM_default.h"
 #include <stdlib.h>
 #include <limits.h>
 #include <math.h>

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/idct.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/idct.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/idct.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -1,6 +1,6 @@
 /* idct.c, inverse fast discrete cosine transform                           */
 
-#include <config.h>
+#include <ADM_default.h>
 #include <stdio.h>
 #include <string.h>
 #include <stdlib.h>

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/idct_mmx.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/idct_mmx.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/idct_mmx.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -1,4 +1,4 @@
-#include <config.h>
+#include <ADM_default.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <unistd.h>

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/idctdata.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/idctdata.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/idctdata.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -10,7 +10,7 @@
 // assumes the programmer is familiar with IDCT mathematics, leaving the
 // form of the complete function up to the programmer's imagination.
 
-#include <config.h>
+#include <ADM_default.h>
 #include <mjpeg_types.h>
 
 //  ALGORITHM OVERVIEW

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/ioio.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/ioio.c	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/ioio.c	2009-05-30 15:46:29 UTC (rev 4875)
@@ -7,7 +7,7 @@
 #include <assert.h>
 #include <math.h>
 
-#include "config.h"
+#include "ADM_default.h""
 #include "mjpeg_logging.h"
 
 #define SILENT

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/macroblock.hh
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/macroblock.hh	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/macroblock.hh	2009-05-30 15:46:29 UTC (rev 4875)
@@ -48,7 +48,7 @@
  *
  */
 
-#include "config.h"
+#include "ADM_default.h"
 #include <vector>
 #include "mjpeg_types.h"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_bsad_mmx.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_bsad_mmx.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_bsad_mmx.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -18,7 +18,7 @@
  *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
  */
 
-#include <config.h>
+#include <ADM_default.h>
 #include <stdio.h>
 #include "mjpeg_types.h"
 #ifdef HAVE_X86CPU

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_bsumsq_mmx.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_bsumsq_mmx.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_bsumsq_mmx.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -18,7 +18,7 @@
  *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
  */
 
-#include <config.h>
+#include <ADM_default.h>
 #include "mjpeg_types.h"
 #ifdef HAVE_X86CPU
 #include "mmx.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sad_mmx.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sad_mmx.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sad_mmx.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -24,7 +24,7 @@
  *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
  */
 
-#include <config.h>
+#include <ADM_default.h>
 #include "mjpeg_types.h"
 #ifdef HAVE_X86CPU
 #include "mmx.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sad_mmxe.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sad_mmxe.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sad_mmxe.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -30,7 +30,7 @@
 ;
 */
 
-#include <config.h>
+#include <ADM_default.h>
 #ifdef HAVE_X86CPU
 #include "mjpeg_types.h"
 #include "mmx.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sub44_sads_x86.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sub44_sads_x86.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sub44_sads_x86.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -34,7 +34,7 @@
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  */
 
-#include <config.h>
+#include <ADM_default.h>
 #ifdef HAVE_X86CPU
 #include "mjpeg_types.h"
 #include "attributes.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sub44_sads_x86.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sub44_sads_x86.h	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sub44_sads_x86.h	2009-05-30 15:46:29 UTC (rev 4875)
@@ -20,7 +20,7 @@
 #ifndef __MBLOCK_SUB44_SADS_X86_H__
 #define __MBLOCK_SUB44_SADS_X86__
 
-#include <config.h>
+#include <ADM_default.h>
 #include "mjpeg_types.h"
 int mblocks_sub44_mests_mmxe( uint8_t *blk,  uint8_t *ref,
 							 int ilow, int jlow,

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sumsq_mmx.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sumsq_mmx.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sumsq_mmx.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -18,7 +18,7 @@
  *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
  */
 
-#include "config.h"
+#include "ADM_default.h"
 #include "mjpeg_types.h"
 #ifdef HAVE_X86CPU
 #include "mmx.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/motion.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/motion.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/motion.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -1,4 +1,4 @@
-#include "config.h"
+#include "ADM_default.h"
 #include <stdio.h>
 
 #include "mmxsse_motion.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/motionest.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/motionest.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/motionest.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -46,7 +46,7 @@
  *
  */
 
-#include <config.h>
+#include <ADM_default.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <limits.h>

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/motionsearch.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/motionsearch.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/motionsearch.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -20,7 +20,7 @@
  *
  */
 #include <stdio.h>
-#include "config.h"
+#include "ADM_default.h"
 #include <limits.h>
 #include <stdlib.h>
 #if defined(ADM_BSD_FAMILY) || defined(ADM_SPARC)

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/motionsearch.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/motionsearch.h	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/motionsearch.h	2009-05-30 15:46:29 UTC (rev 4875)
@@ -20,7 +20,7 @@
 #ifndef __MOTIONSEARCH_H__
 #define __MOTIONSEARCH_H__
 
-#include "config.h"
+#include "ADM_default.h"
 #include "mjpeg_types.h"
 
 struct me_result

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2enc.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2enc.h	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2enc.h	2009-05-30 15:46:29 UTC (rev 4875)
@@ -27,7 +27,7 @@
  *
  */
 
-#include <config.h>
+#include <ADM_default.h>
 #include "mjpeg_types.h"
 #include "synchrolib.h"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2enc_if.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2enc_if.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2enc_if.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -20,7 +20,7 @@
  *
  */
 
-#include <config.h>
+#include <ADM_default.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <errno.h>

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2param.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2param.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2param.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -1,4 +1,4 @@
-#include <config.h>
+#include <ADM_default.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <errno.h>

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2setup.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2setup.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2setup.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -19,7 +19,7 @@
 	Here we only use param and opt structure
 */
 #define NO_GLOBAL
-#include <config.h>
+#include <ADM_default.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <errno.h>

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mpegconsts.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mpegconsts.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/mpegconsts.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -21,7 +21,7 @@
  *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
  */
 
-#include <config.h>
+#include <ADM_default.h>
 #include "mpegconsts.h"
 #include "yuv4mpeg.h"
 #include "yuv4mpeg_intern.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predcomp_mmx.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predcomp_mmx.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predcomp_mmx.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -23,7 +23,7 @@
  *   02111-1307, USA.
  */
 
-#include <config.h>
+#include <ADM_default.h>
 #include "mjpeg_types.h"
 #ifdef HAVE_X86CPU
 #include "mmx.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predcomp_mmxe.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predcomp_mmxe.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predcomp_mmxe.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -23,7 +23,7 @@
  *   02111-1307, USA.
  */
  
-#include <config.h>
+#include <ADM_default.h>
 #ifdef HAVE_X86CPU
 #include "mjpeg_types.h"
 #include "mmx.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predict.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predict.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predict.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -46,7 +46,7 @@
  */
 
 
-#include "config.h"
+#include "ADM_default.h"
 #include "mjpeg_logging.h"
 #include "global.h"
 #include "predict_ref.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_mmx.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_mmx.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_mmx.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -18,7 +18,7 @@
  *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.   
  */
 
-#include <config.h>
+#include <ADM_default.h>
 #include "mjpeg_types.h"
 #ifdef HAVE_X86CPU
 #include "mmx.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_ref.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_ref.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_ref.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -47,7 +47,7 @@
  */
 
 #include <stdio.h>
-#include "config.h"
+#include "ADM_default.h"
 #include "mjpeg_types.h"
 #include "mjpeg_logging.h"
 #include "syntaxparams.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_x86.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_x86.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/predict_x86.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -21,7 +21,7 @@
  */
 
 
-#include "config.h"
+#include "ADM_default.h"
 #include "mjpeg_types.h"
 #include "simd.h"
 #include "predict_ref.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/putbits.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/putbits.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/putbits.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -46,7 +46,7 @@
  */
 
 
-#include <config.h>
+#include <ADM_default.h>
 #include <stdio.h>
 #include "global.h"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/puthdr.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/puthdr.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/puthdr.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -46,7 +46,7 @@
  */
 
 
-#include <config.h>
+#include <ADM_default.h>
 #include <stdio.h>
 #include <math.h>
 #include "global.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/putmpg.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/putmpg.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/putmpg.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -27,7 +27,7 @@
  *
  */
 
-#include <config.h>
+#include <ADM_default.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include "global.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/putpic.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/putpic.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/putpic.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -46,7 +46,7 @@
  */
 
 
-#include <config.h>
+#include <ADM_default.h>
 #include <stdio.h>
 #include <math.h>
 #include "global.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/putseq.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/putseq.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/putseq.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -42,7 +42,7 @@
  *
  */
 
-#include "config.h"
+#include "ADM_default.h"
 #include <stdio.h>
 #include <stdlib.h>
 #include <math.h>

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/putvlc.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/putvlc.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/putvlc.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -27,7 +27,7 @@
  *
  */
 
-#include "config.h"
+#include "ADM_default.h"
 #include <stdio.h>
 #include <stdlib.h>
 #include <assert.h>

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/quant_mmx2.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/quant_mmx2.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/quant_mmx2.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -21,7 +21,7 @@
  *   quantize_ni_mmx.s:  MMX optimized coefficient quantization sub-routine
  */
 
-#include <config.h>
+#include <ADM_default.h>
 #ifdef HAVE_X86CPU
 #include "mjpeg_types.h"
 #include "mmx.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -46,7 +46,7 @@
  */
 
 
-#include "config.h"
+#include "ADM_default.h"
 #include "global.h"
 #include "quantize_ref.h"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_ref.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_ref.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_ref.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -49,7 +49,7 @@
 
 
 #include <stdio.h>
-#include "config.h"
+#include "ADM_default.h"
 #include <math.h>
 #include <stdlib.h>
 #ifdef HAVE_FENV_H

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_ref.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_ref.h	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_ref.h	2009-05-30 15:46:29 UTC (rev 4875)
@@ -23,7 +23,7 @@
 #ifndef _QUANTIZE_H
 #define _QUANTIZE_H
 
-#include "config.h"
+#include "ADM_default.h"
 #include "mjpeg_types.h"
 
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_x86.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_x86.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_x86.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -24,7 +24,7 @@
 
 
 
-#include <config.h>
+#include <ADM_default.h>
 #include <stdio.h>
 #include <math.h>
 #include <string.h>

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/ratectl.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/ratectl.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/ratectl.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -45,7 +45,7 @@
  *
  */
 
-#include "config.h"
+#include "ADM_default.h"
 #include <math.h>
 #include <limits.h>
 #include "mjpeg_types.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/ratectl.hh
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/ratectl.hh	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/ratectl.hh	2009-05-30 15:46:29 UTC (rev 4875)
@@ -23,7 +23,7 @@
 #define K_AVG_WINDOW_P   10.0
 #define	K_AVG_WINDOW_B   20.0
 
-#include <config.h>
+#include <ADM_default.h>
 class MacroBlock;
 // MEANX : UGLY
 extern int rateCtlDisablePadding;

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/readpic.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/readpic.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/readpic.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -68,7 +68,7 @@
  */
 
 
-#include <config.h>
+#include "ADM_default.h" 
 #include <stdio.h>
 #include <stdlib.h>
 //#include <unistd.h>
@@ -79,7 +79,6 @@
 
 #include "mpegconsts.h"
 #include "yuv4mpeg.h"
-#include "ADM_default.h" 
 
 
    /* NOTE: access toframes_read *must* be read-only in other threads

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/simd.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/simd.h	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/simd.h	2009-05-30 15:46:29 UTC (rev 4875)
@@ -27,7 +27,7 @@
  */
 #ifndef __SIMD_H__
 #define __SIMD_H__
-#include <config.h>
+#include <ADM_default.h>
 #include "stdlib.h"
 #include "mjpeg_types.h"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/stats.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/stats.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/stats.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -46,7 +46,7 @@
  */
 
 
-#include <config.h>
+#include <ADM_default.h>
 #include <stdio.h>
 #include <math.h>
 #include "global.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/syntaxparams.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/syntaxparams.h	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/syntaxparams.h	2009-05-30 15:46:29 UTC (rev 4875)
@@ -7,7 +7,7 @@
 #define _SYNTAXPARAMS_H
 
 
-#include "config.h"
+#include "ADM_default.h"
 #include "mjpeg_types.h"
 
 /* choose between declaration (GLOBAL undefined) and definition

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -23,7 +23,7 @@
  */
 
 
-#include <config.h>
+#include <ADM_default.h>
 #include <stdio.h>
 #include <math.h>
 #include "global.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_ref.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_ref.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_ref.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -49,7 +49,6 @@
  */
 #include "ADM_default.h"
 #include <stdio.h>
-#include "config.h"
 #include <math.h>
 #include "mjpeg_types.h"
 #include "mjpeg_logging.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_ref.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_ref.h	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_ref.h	2009-05-30 15:46:29 UTC (rev 4875)
@@ -47,7 +47,7 @@
 #ifndef _TRANSFRM_H
 #define _TRANSFRM_H
 
-#include "config.h"
+#include "ADM_default.h"
 #include "mjpeg_types.h"
 
 // MEANX

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_x86.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_x86.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_x86.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -21,7 +21,7 @@
  */
 
 
-#include <config.h>
+#include <ADM_default.h>
 #ifdef HAVE_X86CPU
 #include <math.h>
 #include "mjpeg_types.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/writepic.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/writepic.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/writepic.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -27,7 +27,7 @@
  *
  */
 
-#include <config.h>
+#include <ADM_default.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include "global.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/xx.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/xx.c	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/xx.c	2009-05-30 15:46:29 UTC (rev 4875)
@@ -21,7 +21,7 @@
  */
 
 
-#include <config.h>
+#include <ADM_default.h">
 #include <math.h>
 #include "mjpeg_types.h"
 #include "syntaxparams.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/yuv4mpeg.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/yuv4mpeg.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/yuv4mpeg.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -20,7 +20,7 @@
  *
  */
 #if 0
-#include <config.h>
+#include <ADM_default.h">
 
 #include <unistd.h>
 #include <stdio.h>

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/yuv4mpeg_ratio.cc
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/yuv4mpeg_ratio.cc	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_libmpeg2enc/yuv4mpeg_ratio.cc	2009-05-30 15:46:29 UTC (rev 4875)
@@ -20,7 +20,7 @@
  *
  */
 
-#include <config.h>
+#include <ADM_default.h>
 
 #include <string.h>
 #include "yuv4mpeg.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_xvidratectl/ADM_oldxvid.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_xvidratectl/ADM_oldxvid.cpp	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_xvidratectl/ADM_oldxvid.cpp	2009-05-30 15:46:29 UTC (rev 4875)
@@ -9,10 +9,8 @@
 // Copyright: See COPYING file that comes with this distribution
 //
 //
-#include "config.h"
+#include "ADM_default.h"
 
-#include <stdio.h>
-#include <stdlib.h>
 #include <string.h>
 #include <math.h>
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_xvidratectl/ADM_xvidratectl.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_xvidratectl/ADM_xvidratectl.cpp	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_xvidratectl/ADM_xvidratectl.cpp	2009-05-30 15:46:29 UTC (rev 4875)
@@ -43,7 +43,7 @@
 	to fight most common problems without user's knowladge */
 #define SMART_OVERFLOW_SETTING
 #define VBV
-#include "config.h"
+#include "ADM_default.h"
 #include <stdio.h>
 #include <string.h>
 #include <errno.h>

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_xvidratectl/ADM_xvidratectlVBV.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_xvidratectl/ADM_xvidratectlVBV.cpp	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_xvidratectl/ADM_xvidratectlVBV.cpp	2009-05-30 15:46:29 UTC (rev 4875)
@@ -12,13 +12,10 @@
 //
 //	Reuse some of Peter Cheat predictor model
 //
-#include "config.h"
-#include <stdio.h>
-#include <string.h>
+#include "ADM_default.h"
 #include <errno.h>
 #include <math.h>
 #include <limits.h>
-#include "ADM_default.h"
 #include "ADM_assert.h"
 
 #include "ADM_osSupport/ADM_debugID.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_xvidratectl/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_xvidratectl/CMakeLists.txt	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/ADM_libraries/ADM_xvidratectl/CMakeLists.txt	2009-05-30 15:46:29 UTC (rev 4875)
@@ -3,4 +3,4 @@
 SET(${ADM_LIB}_SRCS 
 	ADM_oldxvid.cpp  ADM_xvidratectl.cpp  ADM_xvidratectlVBV.cpp)
 
-ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
\ No newline at end of file
+ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})

Modified: branches/avidemux_2.6_branch_mean/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/CMakeLists.txt	2009-05-30 15:46:27 UTC (rev 4874)
+++ branches/avidemux_2.6_branch_mean/avidemux/CMakeLists.txt	2009-05-30 15:46:29 UTC (rev 4875)
@@ -224,6 +224,9 @@
 	ADD_LIB_ALL_TARGETS(${_current})
 ENDFOREACH(_current ${ADM_TAILS})
 #
+# These libs depend (for now) on config.h
+# so we have to build them for each UI
+#
 	ADD_SUBDIRECTORY(ADM_codecs)
 	ADD_ADMLIB_ALL_TARGETS(ADM_codecs)
 ###########################################
@@ -231,7 +234,7 @@
 ###########################################
 ADD_SUBDIRECTORY(ADM_libraries)
 
-ADD_ADMLIB_ALL_TARGETS(
+ADD_LIB_ALL_TARGETS(
 	ADM_libmpeg2enc
 	ADM_xvidratectl
 )



