From mean at mail.berlios.de  Thu Apr  1 19:59:53 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 1 Apr 2010 19:59:53 +0200
Subject: [Avidemux-svn-commit] r6033 - in branches/avidemux_2.6_branch_mean:
	avidemux/qt4/ADM_userInterfaces/ADM_dialog
	avidemux_core/ADM_coreUI/include avidemux_core/ADM_coreUI/src
Message-ID: <201004011759.o31HxrGa023092@sheep.berlios.de>

Author: mean
Date: 2010-04-01 19:59:52 +0200 (Thu, 01 Apr 2010)
New Revision: 6033

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/include/DIA_encoding.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/src/DIA_encoding.cpp
Log:
[ui] Display video size, audio size and total size

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.cpp	2010-03-31 17:59:49 UTC (rev 6032)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.cpp	2010-04-01 17:59:52 UTC (rev 6033)
@@ -266,6 +266,19 @@
 }
 
 /**
+    \fn setVideoSize(int size)
+    \brief display parameter as total size
+*/
+
+void DIA_encodingQt4::setVideoSize(uint64_t size)
+{
+          ADM_assert(window);
+          uint64_t mb=size>>20;
+          sprintf(string,"%"LU" MB",(int)mb);
+          WRITE(labelVideoSize);
+
+}
+/**
     \fn setAudioSizeIn(int size)
     \brief display parameter as audio size
 */

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.h	2010-03-31 17:59:49 UTC (rev 6032)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.h	2010-04-01 17:59:52 UTC (rev 6033)
@@ -51,6 +51,7 @@
 protected:
     void setTotalSize(uint64_t size);
     void setAudioSize(uint64_t size);
+    void setVideoSize(uint64_t size);
     void setPercent(uint32_t percent);
     void setFps(uint32_t fps);
     void setFrameCount(uint32_t nb);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/include/DIA_encoding.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/include/DIA_encoding.h	2010-03-31 17:59:49 UTC (rev 6032)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/include/DIA_encoding.h	2010-04-01 17:59:52 UTC (rev 6033)
@@ -60,6 +60,7 @@
                 virtual void setFps(uint32_t fps1000)=0;
                 virtual void setPercent(uint32_t percent)=0;
                 virtual void setAudioSize(uint64_t size)=0;
+                virtual void setVideoSize(uint64_t size)=0;
                 virtual void setTotalSize(uint64_t size)=0;
                 virtual void setFrameCount(uint32_t nb)=0;
                 virtual void setElapsedTimeMs(uint32_t nb)=0;

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/src/DIA_encoding.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/src/DIA_encoding.cpp	2010-03-31 17:59:49 UTC (rev 6032)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUI/src/DIA_encoding.cpp	2010-04-01 17:59:52 UTC (rev 6033)
@@ -168,6 +168,7 @@
                 }
                 _nextUpdate=time+GUI_UPDATE_RATE;
                 setAudioSize(_audioSize);
+                setVideoSize(_videoSize);
                 setTotalSize(_audioSize+_videoSize);
                 _lastFrameCount=_currentFrameCount;
                 _lastDts=_currentDts;



From mean at mail.berlios.de  Thu Apr  1 19:59:55 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 1 Apr 2010 19:59:55 +0200
Subject: [Avidemux-svn-commit] r6034 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/yadif
Message-ID: <201004011759.o31HxtQc023102@sheep.berlios.de>

Author: mean
Date: 2010-04-01 19:59:55 +0200 (Thu, 01 Apr 2010)
New Revision: 6034

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/yadif/ADM_vidYadif.cpp
Log:
[yadif] update framenum

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/yadif/ADM_vidYadif.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/yadif/ADM_vidYadif.cpp	2010-04-01 17:59:52 UTC (rev 6033)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/yadif/ADM_vidYadif.cpp	2010-04-01 17:59:55 UTC (rev 6034)
@@ -197,6 +197,7 @@
                 n = nextFrame;
 
         src = vidCache->getImage(n);
+        *fn=n;
         if(!src) return false;
         
   



From mean at mail.berlios.de  Thu Apr  1 19:59:56 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 1 Apr 2010 19:59:56 +0200
Subject: [Avidemux-svn-commit] r6035 - in
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6:
	. mplayerDenoise3D
Message-ID: <201004011759.o31HxuS4023112@sheep.berlios.de>

Author: mean
Date: 2010-04-01 19:59:56 +0200 (Thu, 01 Apr 2010)
New Revision: 6035

Added:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3D.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3D.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3d.conf
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3d.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3d_desc.cpp
Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/CMakeLists.txt
Log:
[mplayer3d] Port of mplayer denoise 3D, non hq filter

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/CMakeLists.txt	2010-04-01 17:59:55 UTC (rev 6034)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/CMakeLists.txt	2010-04-01 17:59:56 UTC (rev 6035)
@@ -3,3 +3,4 @@
 ADD_SUBDIRECTORY(resize)
 ADD_SUBDIRECTORY(crop)
 ADD_SUBDIRECTORY(yadif)
+ADD_SUBDIRECTORY(mplayerDenoise3D)

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3D.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3D.cpp	2010-04-01 17:59:55 UTC (rev 6034)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3D.cpp	2010-04-01 17:59:56 UTC (rev 6035)
@@ -0,0 +1,308 @@
+/***************************************************************************
+                          ADM_vidMPLD3D.cpp  -  description
+                             -------------------
+Mplayer HQDenoise3d port to avidemux2
+Original Authors
+Copyright (C) 2003
+Daniel Moreno <comac at comac.darktech.org>
+	& A'rpi
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#if 0
+#include <math.h>
+#include "ADM_default.h"
+#include "ADM_coreVideoFilterInternal.h"
+#include "ADM_videoFilterCache.h"
+#include "DIA_factory.h"
+
+#include "ADM_vidMPLD3D.h"
+#include "denoise3d_desc.cpp"
+
+#include "DIA_factory.h"
+#define aprintf(...) {}
+
+static inline unsigned int LowPassMul(unsigned int PrevMul, unsigned int CurrMul, int* Coef){
+//    int dMul= (PrevMul&0xFFFFFF)-(CurrMul&0xFFFFFF);
+    int dMul= PrevMul-CurrMul;
+    int d=((dMul+0x10007FF)/(65536/16));
+    return CurrMul + Coef[d];
+}
+
+DECLARE_VIDEO_FILTER(   ADMVideoMPD3D,   // Class
+                        1,0,0,              // Version
+                        ADM_UI_ALL,         // UI
+                        VF_NOISE,            // Category
+                        "MplayerDenoise3DHQ",            // internal name (must be uniq!)
+                        "Mplayer Denoise 3D HQ",            // Display name
+                        "Reduce noise, smooth image, increase compressibility. HQ Version." // Description
+                    );
+
+#define PARAM1_DEFAULT 4.0
+#define PARAM2_DEFAULT 3.0
+#define PARAM3_DEFAULT 6.0
+/**
+    \fn getConfiguration
+*/
+const char 	*ADMVideoMPD3D::getConfiguration(void)
+ {
+      static char str[1024];
+	  snprintf(str,1023," MPlayer Denoise 3D (%2.1f - %2.1f - %2.1f)'",
+						param.luma,param.chroma,param.temporal);
+      return str;
+        
+}
+/**
+    \fn configure
+*/
+bool ADMVideoMPD3D::configure(void)
+{
+
+        
+        ELEM_TYPE_FLOAT fluma,fchroma,ftemporal;
+#define PX(x) &x
+#define OOP(x,y) f##x=(ELEM_TYPE_FLOAT )param.x;
+        
+        OOP(luma,Luma);
+        OOP(chroma,Chroma);
+        OOP(temporal,Temporal);
+        
+        diaElemFloat   luma(PX(fluma),QT_TR_NOOP("_Spatial luma strength:"),0.,100.);
+        diaElemFloat   chroma(PX(fchroma),QT_TR_NOOP("S_patial chroma strength:"),0.,100.);
+        diaElemFloat   temporal(PX(ftemporal),QT_TR_NOOP("_Temporal strength:"),0.,100.);
+    
+        diaElem *elems[3]={&luma,&chroma,&temporal};
+  
+        if(  diaFactoryRun(QT_TR_NOOP("MPlayer denoise3d"),3,elems))
+        {
+#undef OOP
+#define OOP(x,y) param.x=(float) f##x
+                OOP(luma,Luma);
+                OOP(chroma,Chroma);
+                OOP(temporal,Temporal);
+          
+                setup();
+                return 1;
+        }
+        return 0;
+}
+/**
+    \fn dtor
+*/
+ADMVideoMPD3D::~ADMVideoMPD3D()
+{
+	delete [] Line;
+	Line=NULL;
+}
+
+
+/**
+        \fn deNoise
+*/
+void ADMVideoMPD3D::deNoise(unsigned char *Frame,        // mpi->planes[x]
+                    unsigned char *FrameDest,    // dmpi->planes[x]
+                   uint32_t 		 *LineAnt,      // vf->priv->Line (width bytes)
+		    unsigned short 	*FrameAntPtr,
+                    int W, int H, int sStride, int dStride,
+                    int *Horizontal, int *Vertical, int *Temporal)
+{
+    int X, Y;
+    int sLineOffs = 0, dLineOffs = 0;
+    unsigned int PixelAnt;
+    int PixelDst;
+    unsigned short* FrameAnt=(FrameAntPtr);
+    
+
+    /* First pixel has no left nor top neightbour. Only previous frame */
+    LineAnt[0] = PixelAnt = Frame[0]<<16;
+    PixelDst = LowPassMul(FrameAnt[0]<<8, PixelAnt, Temporal);
+    FrameAnt[0] = ((PixelDst+0x1000007F)/256);
+    FrameDest[0]= ((PixelDst+0x10007FFF)/65536);
+
+    /* Fist line has no top neightbour. Only left one for each pixel and
+     * last frame */
+    for (X = 1; X < W; X++){
+        LineAnt[X] = PixelAnt = LowPassMul(PixelAnt, Frame[X]<<16, Horizontal);
+        PixelDst = LowPassMul(FrameAnt[X]<<8, PixelAnt, Temporal);
+	FrameAnt[X] = ((PixelDst+0x1000007F)/256);
+	FrameDest[X]= ((PixelDst+0x10007FFF)/65536);
+    }
+
+    for (Y = 1; Y < H; Y++){
+	unsigned int PixelAnt;
+	unsigned short* LinePrev=&FrameAnt[Y*W];
+	sLineOffs += sStride, dLineOffs += dStride;
+        /* First pixel on each line doesn't have previous pixel */
+        PixelAnt = Frame[sLineOffs]<<16;
+        LineAnt[0] = LowPassMul(LineAnt[0], PixelAnt, Vertical);
+	PixelDst = LowPassMul(LinePrev[0]<<8, LineAnt[0], Temporal);
+	LinePrev[0] = ((PixelDst+0x1000007F)/256);
+	FrameDest[dLineOffs]= ((PixelDst+0x10007FFF)/65536);
+
+        for (X = 1; X < W; X++){
+	    int PixelDst;
+            /* The rest are normal */
+            PixelAnt = LowPassMul(PixelAnt, Frame[sLineOffs+X]<<16, Horizontal);
+            LineAnt[X] = LowPassMul(LineAnt[X], PixelAnt, Vertical);
+	    PixelDst = LowPassMul(LinePrev[X]<<8, LineAnt[X], Temporal);
+	    LinePrev[X] = ((PixelDst+0x1000007F)/256);
+	    FrameDest[dLineOffs+X]= ((PixelDst+0x10007FFF)/65536);
+        }
+    }
+}
+
+
+
+/**
+    \fn setup
+*/
+uint8_t  ADMVideoMPD3D::setup(void)
+{
+ double LumSpac, LumTmp, ChromSpac, ChromTmp;
+
+        LumSpac = param.luma;
+        LumTmp = param.temporal;
+
+        ChromSpac = param.chroma;
+        ChromTmp = LumTmp * ChromSpac / LumSpac;
+
+        PrecalcCoefs((int *)Coefs[0], LumSpac);
+        PrecalcCoefs((int *)Coefs[1], LumTmp);
+        PrecalcCoefs((int *)Coefs[2], ChromSpac);
+        PrecalcCoefs((int *)Coefs[3], ChromTmp);
+
+        aprintf("\n Param : %lf %lf %lf \n",
+            param.luma,
+            param.chroma,
+            param.temporal);
+
+       return 1;
+}
+/**
+    \fn ctor
+*/
+ADMVideoMPD3D::ADMVideoMPD3D(	ADM_coreVideoFilter *in,CONFcouple *couples) 
+        : ADM_coreVideoFilter(in,couples)
+{
+uint32_t page;
+  vidCache=new VideoCache(3,in);
+  Line=new uint8_t [in->getInfo()->width];
+  page=info.width*info.height;
+  
+  if(!couples || !ADM_paramLoad(couples,denoise3d_param,&param))
+  {  			
+			param.luma=PARAM1_DEFAULT;
+			param.chroma=PARAM2_DEFAULT;
+			param.temporal=PARAM3_DEFAULT;
+  }
+  setup();
+
+}
+
+/**
+    \fn getCoupledConf
+*/
+bool	ADMVideoMPD3D::getCoupledConf( CONFcouple **couples)
+{
+    return ADM_paramSave(couples, denoise3d_param,&param);
+	
+}
+/**
+    \fn getNextFrame
+*/
+bool ADMVideoMPD3D::getNextFrame(uint32_t *fn,ADMImage *image)
+{
+	int cw= info.width>>1;
+	int ch= info.height>>1;
+    int W = info.width;
+	int H  = info.height;
+	uint32_t dlen,dflags;
+
+    ADMImage *src, *dst, * prev, *next;
+    
+        *fn=nextFrame;
+        uint32_t n = nextFrame;
+printf("MP3d: next frame= %d\n",(int)n);
+        src = vidCache->getImage(n);
+        if(!src) return false;
+        // If possible get previous image...
+        if (n>0)
+                prev =  vidCache->getImage( n-1); // get previous frame
+        else
+                prev=src;
+        
+		uint8_t *c,*d,*p;
+
+		d=YPLANE(image);
+		c=YPLANE(src);
+		p=YPLANE(prev);
+//
+
+        deNoise(c,p, d,
+                Line,ant, W, H,
+                W,W,
+               	Coefs[0] ,
+                Coefs[0] ,
+                Coefs[1] );
+	
+		d=UPLANE(image);
+		c=UPLANE(src);
+		p=UPLANE(prev);
+
+        deNoise(c,p, d,
+                Line,ant, cw, ch,
+                cw,cw,
+               	Coefs[2] ,
+                Coefs[2] ,
+                Coefs[3] );
+
+        d=VPLANE(image);
+        c=VPLANE(src);
+        p=VPLANE(prev);
+
+        deNoise(c,p, d,
+                    Line,ant, cw, ch,
+                    cw,cw,
+                    Coefs[2] ,
+                    Coefs[2] ,
+                    Coefs[3] );
+
+
+	nextFrame++;
+	image->copyInfo(src);
+        vidCache->unlockAll();
+	return 1;
+}
+
+#define ABS(A) ( (A) > 0 ? (A) : -(A) )
+/**
+    \fn PrecalcCoefs
+*/
+
+void ADMVideoMPD3D::PrecalcCoefs(int *Ct, double Dist25)
+{
+    int i;
+    double Gamma, Simil, C;
+
+    Gamma = log(0.25) / log(1.0 - Dist25/255.0 - 0.00001);
+
+    for (i = -256*16; i < 256*16; i++)
+    {
+        Simil = 1.0 - ABS(i) / (16*255.0);
+	C=4096.*(double)i;
+        C *= pow(Simil, Gamma) ;
+       Ct[16*256+i] = (int)((C<0) ? (C-0.5) : (C+0.5));
+    }
+
+}
+#endif
+// EOF
+
+

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3D.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3D.h	2010-04-01 17:59:55 UTC (rev 6034)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3D.h	2010-04-01 17:59:56 UTC (rev 6035)
@@ -0,0 +1,59 @@
+/***************************************************************************
+                          ADM_vidMPLD3D.h  -  description
+                             -------------------
+Mplayer Denoise3d port to avidemux2
+Original Authors
+Copyright (C) 2003
+Daniel Moreno <comac at comac.darktech.org>
+
+
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef __D3DLOW__
+#define __D3DLOW__
+
+#include "denoise3d.h"
+
+/**
+    \class ADMVideoMPD3Dlow
+*/
+class ADMVideoMPD3D : public  ADM_coreVideoFilter
+{
+protected:
+                ADMImage        *original;
+                denoise3d       param;
+                uint32_t        last;
+                uint32_t         *Line;
+                int				Coefs[4][512*16];
+                void 	    PrecalcCoefs(int *Ct, double Dist25);
+				uint8_t  	setup(void);
+				void 	    deNoise(unsigned char *Frame,        // mpi->planes[x]
+                    						unsigned char *FramePrev,    // pmpi->planes[x]
+                    						unsigned char *FrameDest,    // dmpi->planes[x]
+                    						uint32_t char *LineAnt,      // vf->priv->Line (width bytes)
+                    						int W, int H, int sStride, int pStride, int dStride,
+                    						int *Horizontal, int *Vertical, int *Temporal);
+
+                    
+public:
+                    ADMVideoMPD3D(ADM_coreVideoFilter *previous,CONFcouple *conf);
+                    ~ADMVideoMPD3D();
+
+        virtual const char   *getConfiguration(void);                 /// Return  current configuration as a human readable string
+        virtual bool         getNextFrame(uint32_t *fn,ADMImage *image);           /// Return the next image
+        virtual bool         getCoupledConf(CONFcouple **couples) ;   /// Return the current filter configuration
+        virtual bool         configure(void) ;                        /// Start graphical user interface
+};
+
+			
+
+#endif

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/CMakeLists.txt	2010-04-01 17:59:55 UTC (rev 6034)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/CMakeLists.txt	2010-04-01 17:59:56 UTC (rev 6035)
@@ -0,0 +1,12 @@
+INCLUDE(vf_plugin)
+
+
+SET(ADM_vf_denoise3dhq_SRCS ADM_vidMPLD3D.cpp)
+ADD_VIDEO_FILTER(ADM_vf_denoise3dhq SHARED ${ADM_vf_denoise3dhq_SRCS})
+INIT_VIDEO_FILTER(ADM_vf_denoise3dhq)
+INSTALL_VIDEO_FILTER(ADM_vf_denoise3dhq)
+
+SET(ADM_vf_denoise3d_SRCS ADM_vidMPLD3Dlow.cpp)
+ADD_VIDEO_FILTER(ADM_vf_denoise3d SHARED ${ADM_vf_denoise3d_SRCS})
+INIT_VIDEO_FILTER(ADM_vf_denoise3d)
+INSTALL_VIDEO_FILTER(ADM_vf_denoise3d)

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3d.conf
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3d.conf	2010-04-01 17:59:55 UTC (rev 6034)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3d.conf	2010-04-01 17:59:56 UTC (rev 6035)
@@ -0,0 +1,3 @@
+float:luma; // Luma param1
+float:chroma; // Chroma param2
+float:temporal; // Temporal param3

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3d.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3d.h	2010-04-01 17:59:55 UTC (rev 6034)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3d.h	2010-04-01 17:59:56 UTC (rev 6035)
@@ -0,0 +1,10 @@
+// Automatically generated, do not edit!
+#ifndef ADM_denoise3d_CONF_H
+#define ADM_denoise3d_CONF_H
+typedef struct {
+   float luma;
+   float chroma;
+   float temporal;
+}denoise3d;
+#endif //denoise3d
+//EOF

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3d_desc.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3d_desc.cpp	2010-04-01 17:59:55 UTC (rev 6034)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/denoise3d_desc.cpp	2010-04-01 17:59:56 UTC (rev 6035)
@@ -0,0 +1,7 @@
+// Automatically generated, do not edit!
+const ADM_paramList denoise3d_param[]={
+ {"luma",offsetof( denoise3d,luma),"float",ADM_param_float},
+ {"chroma",offsetof( denoise3d,chroma),"float",ADM_param_float},
+ {"temporal",offsetof( denoise3d,temporal),"float",ADM_param_float},
+{NULL,0,NULL}
+};



From mean at mail.berlios.de  Thu Apr  1 19:59:58 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 1 Apr 2010 19:59:58 +0200
Subject: [Avidemux-svn-commit] r6036 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <201004011759.o31Hxw1w023122@sheep.berlios.de>

Author: mean
Date: 2010-04-01 19:59:57 +0200 (Thu, 01 Apr 2010)
New Revision: 6036

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admConfigSummary.cmake
   branches/avidemux_2.6_branch_mean/cmake/config.h.cmake
Log:
[build] Simplify config.h/configSummary

Modified: branches/avidemux_2.6_branch_mean/cmake/admConfigSummary.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admConfigSummary.cmake	2010-04-01 17:59:56 UTC (rev 6035)
+++ branches/avidemux_2.6_branch_mean/cmake/admConfigSummary.cmake	2010-04-01 17:59:57 UTC (rev 6036)
@@ -20,21 +20,7 @@
 MESSAGE("*********************")
 MESSAGE("***    SUMMARY    ***")
 MESSAGE("*********************")
-#ADM_DISPLAY("GTK+      " "${ADM_UI_GTK}")
-#ADM_DISPLAY("Qt 4      " "${ADM_UI_QT4}")
 
-#MESSAGE("*** Audio Device  ***")
-#ADM_DISPLAY("ALSA      " "${ALSA_SUPPORT}" "${ALSA_CAPABLE}")
-#ADM_DISPLAY("aRts      " "${USE_ARTS}" "${ARTS_CAPABLE}")
-#ADM_DISPLAY("ESD       " "${USE_ESD}" "${ESD_CAPABLE}")
-#ADM_DISPLAY("JACK      " "${USE_JACK}" "${JACK_CAPABLE}")
-#ADM_DISPLAY("OSS       " "${OSS_SUPPORT}" "${OSS_CAPABLE}")
-#ADM_DISPLAY("SRC       " "${USE_SRC}" "${JACK_CAPABLE}")
-
-#IF (WIN32)
-#	ADM_DISPLAY("Win32     " 1)
-#ENDIF (WIN32)
-
 MESSAGE("*** Miscellaneous ***")
 ADM_DISPLAY("gettext   " "${HAVE_GETTEXT}")
 ADM_DISPLAY("SDL       " "${USE_SDL}")

Modified: branches/avidemux_2.6_branch_mean/cmake/config.h.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/config.h.cmake	2010-04-01 17:59:56 UTC (rev 6035)
+++ branches/avidemux_2.6_branch_mean/cmake/config.h.cmake	2010-04-01 17:59:57 UTC (rev 6036)
@@ -13,10 +13,6 @@
 #define PACKAGE   "avidemux"
 #define ADMLOCALE "${ADM_LOCALE}"
 
-#if ${CONFIG_HEADER_TYPE} == ADM_BUILD_GTK || ${CONFIG_HEADER_TYPE} == ADM_BUILD_QT4
-/* use ALSA as possible audio device */
-#cmakedefine ALSA_SUPPORT
-#endif
 
 #if ${CONFIG_HEADER_TYPE} == ADM_BUILD_CLI || ${CONFIG_HEADER_TYPE} == ADM_BUILD_GTK
 /* Define if the GNU gettext() function is already present or preinstalled. */
@@ -26,36 +22,9 @@
 // GTK+ uses X11 framework
 #cmakedefine HAVE_GTK_X11
 
-/* Define to 1 if you have the `mp3lame' library (-lmp3lame). */
-#cmakedefine HAVE_LIBMP3LAME
-
 /* stricter prototyping */
 #cmakedefine ICONV_NEED_CONST
 
-/* OSS detected */
-#cmakedefine OSS_SUPPORT
-
-/* use Aften AC3 encoder */
-#cmakedefine USE_AFTEN
-#cmakedefine USE_AFTEN_07	// 0.07
-#cmakedefine USE_AFTEN_08	// 0.0.8
-
-#if ${CONFIG_HEADER_TYPE} == ADM_BUILD_GTK || ${CONFIG_HEADER_TYPE} == ADM_BUILD_QT4
-/* aRts detected */
-#cmakedefine USE_ARTS
-#endif
-
-#if ${CONFIG_HEADER_TYPE} == ADM_BUILD_GTK || ${CONFIG_HEADER_TYPE} == ADM_BUILD_QT4
-/* ESD detected */
-#cmakedefine USE_ESD
-#endif
-
-/* Jack detected */
-#cmakedefine USE_JACK
-
-/* Use faac audio enccoder */
-#cmakedefine USE_FAAC
-
 /* FFmpeg */
 #define USE_FFMPEG
 
@@ -65,8 +34,6 @@
 /* Libxml2 is available */
 #cmakedefine USE_LIBXML2
 
-#define USE_MJPEG
-
 /* libpng is available */
 #cmakedefine USE_PNG
 
@@ -78,9 +45,6 @@
 #cmakedefine USE_SDL
 #endif
 
-/* Vorbis detected */
-#cmakedefine USE_VORBIS
-
 #if ${CONFIG_HEADER_TYPE} == ADM_BUILD_GTK || ${CONFIG_HEADER_TYPE} == ADM_BUILD_QT4
 /* XVideo detected */
 #cmakedefine USE_XV
@@ -93,12 +57,6 @@
 #cmakedefine FIND_LEAKS
 
 
-#if defined(OSS_SUPPORT) || defined (USE_ARTS) || defined(USE_SDL) || defined(__APPLE__) || defined(__WIN32) || defined(ALSA_SUPPORT)
-#define HAVE_AUDIO
-#endif
-
-#define HAVE_ENCODER
-
 // FIXME - start
 #ifdef HAVE_GETTEXT
 #  include <libintl.h>



From mean at mail.berlios.de  Thu Apr  1 19:59:59 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 1 Apr 2010 19:59:59 +0200
Subject: [Avidemux-svn-commit] r6037 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI
Message-ID: <201004011759.o31HxxZI023132@sheep.berlios.de>

Author: mean
Date: 2010-04-01 19:59:59 +0200 (Thu, 01 Apr 2010)
New Revision: 6037

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/DIA_prefs.cpp
Log:
[UI] Simplify prefs

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/DIA_prefs.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/DIA_prefs.cpp	2010-04-01 17:59:57 UTC (rev 6036)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/DIA_prefs.cpp	2010-04-01 17:59:59 UTC (rev 6037)
@@ -46,9 +46,9 @@
 uint32_t render;
 uint32_t useTray=0;
 uint32_t useMaster=0;
-uint32_t useAutoIndex=0;
+
 uint32_t useSwap=0;
-uint32_t useNuv=0;
+
 uint32_t lavcThreads=0;
 uint32_t encodePriority=2;
 uint32_t indexPriority=2;
@@ -56,13 +56,13 @@
 uint32_t downmix;
 uint32_t mpeg_no_limit=0;
 uint32_t msglevel=2;
-uint32_t activeXfilter=0;
+
 uint32_t mixer=0;
 char     *filterPath=NULL;
 char     *alsaDevice=NULL;
-uint32_t autovbr=0;
-uint32_t autoindex=0;
-uint32_t autounpack=0;
+
+
+
 uint32_t alternate_mp3_tag=1;
 uint32_t pp_type=3;
 uint32_t pp_value=5;
@@ -102,17 +102,13 @@
         if( prefs->get(DEVICE_AUDIO_ALSA_DEVICE, &alsaDevice) != RC_OK )
                 alsaDevice = ADM_strdup("plughw:0,0");
 #endif
-        // autovbr
-        prefs->get(FEATURE_AUTO_BUILDMAP,&autovbr);
         // vdpau
         prefs->get(FEATURE_VDPAU,&vdpau);
-        // autoindex
-        prefs->get(FEATURE_AUTO_REBUILDINDEX,&autoindex);
         // Global glyph
         prefs->get(FEATURE_GLOBAL_GLYPH_ACTIVE,&useGlobalGlyph);
         prefs->get(FEATURE_GLOBAL_GLYPH_NAME,&globalGlyphName);
-         // autoindex
-        prefs->get(FEATURE_AUTO_UNPACK,&autounpack);
+
+        
         // Alternate mp3 tag (haali)
         prefs->get(FEATURE_ALTERNATE_MP3_TAG,&alternate_mp3_tag);
         
@@ -153,20 +149,12 @@
         if(!prefs->get(FEATURE_AUDIOBAR_USES_MASTER, &useMaster))
                 useMaster=0;
 #endif
-        // Autoindex files
-        if(!prefs->get(FEATURE_TRYAUTOIDX, &useAutoIndex))
-                useAutoIndex=0;
 
         // SWAP A&B if A>B
         if(!prefs->get(FEATURE_SWAP_IF_A_GREATER_THAN_B, &useSwap))
                 useSwap=0;
-        // No nuv sync
-        if(!prefs->get(FEATURE_DISABLE_NUV_RESYNC, &useNuv))
-                useNuv=0;
         // Get level of message verbosity
         prefs->get(MESSAGE_LEVEL,&msglevel);
-        // External filter
-         prefs->get(FILTERS_AUTOLOAD_ACTIVE,&activeXfilter);
         // Downmix default
         if(prefs->get(DOWNMIXING_PROLOGIC,&downmix)!=RC_OK)
         {       
@@ -179,13 +167,8 @@
         diaElemToggle useSysTray(&useTray,QT_TR_NOOP("_Use systray while encoding"));
         diaElemToggle allowAnyMpeg(&mpeg_no_limit,QT_TR_NOOP("_Accept non-standard audio frequency for DVD"));
         diaElemToggle openDml(&use_odml,QT_TR_NOOP("Create _OpenDML files"));
-        diaElemToggle autoIndex(&useAutoIndex,QT_TR_NOOP("Automatically _index MPEG files"));
-        diaElemToggle autoSwap(&useSwap,QT_TR_NOOP("Automatically _swap A and B if A>B"));
-        diaElemToggle nuvAudio(&useNuv,QT_TR_NOOP("_Disable NUV audio sync"));        
+
         
-        diaElemToggle togAutoVbr(&autovbr,QT_TR_NOOP("Automatically _build VBR map"));
-        diaElemToggle togAutoIndex(&autoindex,QT_TR_NOOP("Automatically _rebuild index"));
-        diaElemToggle togAutoUnpack(&autounpack,QT_TR_NOOP("Automatically remove _packed bitstream"));
 
         diaElemFrame frameSimd(QT_TR_NOOP("SIMD"));
 
@@ -318,9 +301,6 @@
 #else
                filterPath = ADM_strdup("c:\\");
 #endif
-        diaElemDirSelect  entryFilterPath(&filterPath,QT_TR_NOOP("_Filter directory:"),QT_TR_NOOP("Select filter directory"));
-		diaElemToggle loadEx(&activeXfilter,QT_TR_NOOP("_Load external filters"));
-		loadEx.link(1, &entryFilterPath);
 
 		diaElemToggle togGlobalGlyph(&useGlobalGlyph, QT_TR_NOOP("Use _Global GlyphSet"));
 		diaElemFile  entryGLyphPath(0,&globalGlyphName,QT_TR_NOOP("Gl_yphSet:"), NULL, QT_TR_NOOP("Select GlyphSet file"));
@@ -331,12 +311,7 @@
         diaElemTabs tabUser(QT_TR_NOOP("User Interface"),2,diaUser);
         
          /* Automation */
-        diaElem *diaAuto[]={&autoSwap,&togAutoVbr,&togAutoIndex,&togAutoUnpack,&autoIndex,};
-        diaElemTabs tabAuto(QT_TR_NOOP("Automation"),5,diaAuto);
         
-        /* Input */
-        diaElem *diaInput[]={&nuvAudio};
-        diaElemTabs tabInput(QT_TR_NOOP("Input"),1,(diaElem **)diaInput);
         
         /* Output */
         diaElem *diaOutput[]={&autoSplit,&openDml,&allowAnyMpeg,&togTagMp3};
@@ -374,13 +349,10 @@
         diaElem *diaGlyph[]={&togGlobalGlyph,&entryGLyphPath};
         diaElemTabs tabGlyph(QT_TR_NOOP("Global GlyphSet"),2,(diaElem **)diaGlyph);
 
-        /* Xfilter tab */
-        diaElem *diaXFilter[]={&loadEx,&entryFilterPath};
-        diaElemTabs tabXfilter(QT_TR_NOOP("External Filters"),2,(diaElem **)diaXFilter);
                                     
 // SET
-        diaElemTabs *tabs[]={&tabUser,&tabAuto,&tabInput,&tabOutput,&tabAudio,&tabVideo,&tabCpu,&tabThreading,&tabGlyph,&tabXfilter};
-        if( diaFactoryRunTabs(QT_TR_NOOP("Preferences"),10,tabs))
+        diaElemTabs *tabs[]={&tabUser,&tabOutput,&tabAudio,&tabVideo,&tabCpu,&tabThreading,&tabGlyph};
+        if( diaFactoryRunTabs(QT_TR_NOOP("Preferences"),7,tabs))
 	{
         	
         	// cpu caps
@@ -416,12 +388,7 @@
                 DOME(4,dring);
                 prefs->set(DEFAULT_POSTPROC_TYPE,pp_type);
                 prefs->set(DEFAULT_POSTPROC_VALUE,pp_value);
-                //
-                 prefs->set(FEATURE_AUTO_UNPACK,autounpack);
-                 // autovbr
-                prefs->set(FEATURE_AUTO_BUILDMAP,autovbr);
-                // autoindex
-                prefs->set(FEATURE_AUTO_REBUILDINDEX,autoindex);
+
                 // Alsa
 #ifdef ALSA_SUPPORT
                 if(alsaDevice)
@@ -464,17 +431,13 @@
 				// Playback priority
 				prefs->set(PRIORITY_PLAYBACK, playbackPriority);
 
-                // Auto index mpeg
-                prefs->set(FEATURE_TRYAUTOIDX, useAutoIndex);
                 // Auto swap A/B
                 prefs->set(FEATURE_SWAP_IF_A_GREATER_THAN_B, useSwap);
-
-                // Disable nuv sync
-                prefs->set(FEATURE_DISABLE_NUV_RESYNC, useNuv);
+                //
+                prefs->set(MESSAGE_LEVEL,msglevel);
                 // Use tray while encoding
                 prefs->set(FEATURE_USE_SYSTRAY,useTray);
-                // Filter directory
-				prefs->set(FILTERS_AUTOLOAD_ACTIVE, activeXfilter);
+
                 // VDPAU
                 prefs->set(FEATURE_VDPAU,vdpau);
                 if(filterPath)



From mean at mail.berlios.de  Thu Apr  1 20:00:00 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 1 Apr 2010 20:00:00 +0200
Subject: [Avidemux-svn-commit] r6038 -
	branches/avidemux_2.6_branch_mean/avidemux/common
Message-ID: <201004011800.o31I00Ze023144@sheep.berlios.de>

Author: mean
Date: 2010-04-01 20:00:00 +0200 (Thu, 01 Apr 2010)
New Revision: 6038

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
Log:
[main] more cleanup

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2010-04-01 17:59:59 UTC (rev 6037)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2010-04-01 18:00:00 UTC (rev 6038)
@@ -30,16 +30,9 @@
 #define __DECLARE__
 #include "avi_vars.h"
 
-//#include "ADM_encoder/adm_encConfig.h"
 #include "prefs.h"
 #include "audio_out.h"
 
-#ifdef USE_XVID_4
-extern void xvid4_init(void);
-#endif
-
-
-
 extern void  ADM_lavInit();
 extern void  ADM_lavDestroy();
 extern void  ADM_lavFormatInit(void);
@@ -132,12 +125,10 @@
 
     printf("*************************\n");
     printf("  Avidemux v" VERSION);
-#if 0
   	if(ADM_SUBVERSION)
 	{
 		printf(" (r%04u)", ADM_SUBVERSION);
 	}
-#endif
     printf("\n*************************\n");
     printf(" http://www.avidemux.org\n");
     printf(" Code      : Mean, JSC, Gruntster \n");



From mean at mail.berlios.de  Thu Apr  1 20:00:01 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 1 Apr 2010 20:00:01 +0200
Subject: [Avidemux-svn-commit] r6039 -
	branches/avidemux_2.6_branch_mean/avidemux/common
Message-ID: <201004011800.o31I01lA023173@sheep.berlios.de>

Author: mean
Date: 2010-04-01 20:00:01 +0200 (Thu, 01 Apr 2010)
New Revision: 6039

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
Log:
[win32] disable redirectStdoutToFile to see...

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2010-04-01 18:00:00 UTC (rev 6038)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2010-04-01 18:00:01 UTC (rev 6039)
@@ -111,7 +111,7 @@
 int main(int argc, char *argv[])
 {
 #if defined(__WIN32) && defined(USE_SDL)
-	redirectStdoutToFile();
+//	redirectStdoutToFile();
 #endif
 
 #if defined(ADM_DEBUG) && defined(FIND_LEAKS)



From mean at mail.berlios.de  Thu Apr  1 20:10:06 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 1 Apr 2010 20:10:06 +0200
Subject: [Avidemux-svn-commit] r6040 - in
	branches/avidemux_2.6_branch_mean/avidemux:
	gtk/ADM_userInterfaces/ADM_gui2 qt4/ADM_userInterfaces/ADM_gui
Message-ID: <201004011810.o31IA6rR023817@sheep.berlios.de>

Author: mean
Date: 2010-04-01 20:10:06 +0200 (Thu, 01 Apr 2010)
New Revision: 6040

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_gui2/GUI_bindings.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
Log:
[All] Remove HAVE_AUDIO

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_gui2/GUI_bindings.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_gui2/GUI_bindings.cpp	2010-04-01 18:00:01 UTC (rev 6039)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_gui2/GUI_bindings.cpp	2010-04-01 18:10:06 UTC (rev 6040)
@@ -98,9 +98,7 @@
 extern const char *ADM_ve6_getMenuName(uint32_t index);
 extern uint32_t    ADM_ve6_getNbEncoders(void);
 
-#ifdef HAVE_AUDIO
 extern uint8_t AVDM_setVolume(int volume);
-#endif
 extern void checkCrashFile(void);
 #define AUDIO_WIDGET   "comboboxAudio"
 #define VIDEO_WIDGET   "comboboxVideo"
@@ -1577,7 +1575,6 @@
 */
 void volumeChange( void )
 {
-#ifdef HAVE_AUDIO
 GtkWidget *wid;
 GtkAdjustment *adj;
 int vol;
@@ -1591,7 +1588,6 @@
         vol=(int)floor(adj->value+0.5);
         AVDM_setVolume( vol);
  _upd_in_progres--;
-#endif
 }
 /**
     \fn UI_setVUMeter

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2010-04-01 18:00:01 UTC (rev 6039)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2010-04-01 18:10:06 UTC (rev 6040)
@@ -73,9 +73,7 @@
 QGraphicsView *drawWindow=NULL;
 uint8_t UI_updateRecentMenu( void );
 
-#ifdef HAVE_AUDIO
 extern uint8_t AVDM_setVolume(int volume);
-#endif
 
 #define WIDGET(x)  (((MainWindow *)QuiMainWindows)->ui.x)
 
@@ -160,7 +158,6 @@
 
 void MainWindow::volumeChange( int u )
 {
-#ifdef HAVE_AUDIO
 	if (_upd_in_progres || !ui.toolButtonAudioToggle->isChecked())
 		return;
 
@@ -170,17 +167,14 @@
 
 	AVDM_setVolume(vol);
 	_upd_in_progres--;
-#endif
 }
 
 void MainWindow::audioToggled(bool checked)
 {
-#ifdef HAVE_AUDIO
 	if (checked)
 		AVDM_setVolume(ui.horizontalSlider_2->value());
 	else
 		AVDM_setVolume(0);
-#endif
 }
 
 void MainWindow::previewModeChanged(QAction *action)



From mean at mail.berlios.de  Thu Apr  1 20:10:08 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 1 Apr 2010 20:10:08 +0200
Subject: [Avidemux-svn-commit] r6041 -
	branches/avidemux_2.6_branch_mean/avidemux/common
Message-ID: <201004011810.o31IA83h023827@sheep.berlios.de>

Author: mean
Date: 2010-04-01 20:10:08 +0200 (Thu, 01 Apr 2010)
New Revision: 6041

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
Log:
[Main] Remove HAVE_ENCODER + xvid4_init

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2010-04-01 18:10:06 UTC (rev 6040)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2010-04-01 18:10:08 UTC (rev 6041)
@@ -203,10 +203,6 @@
     UI_Init(argc,argv);
     AUDMEncoder_initDither();
 
-#ifdef USE_XVID_4
-    xvid4_init();
-#endif
-
     // Hook our UI...
     InitFactory();
     InitCoreToolkit();
@@ -218,9 +214,6 @@
 
     video_body = new ADM_Composer;
 
-#ifdef HAVE_ENCODER
-//     registerVideoFilters();
-#endif
     ADM_lavFormatInit();
 	//***************Plugins *********************
 	// Load system wide audio decoder plugin



From mean at mail.berlios.de  Thu Apr  1 20:10:09 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 1 Apr 2010 20:10:09 +0200
Subject: [Avidemux-svn-commit] r6042 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D
Message-ID: <201004011810.o31IA9i6023837@sheep.berlios.de>

Author: mean
Date: 2010-04-01 20:10:09 +0200 (Thu, 01 Apr 2010)
New Revision: 6042

Added:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3Dlow.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3Dlow.h
Log:
[Mpl3Dlow] Add empty Mplayer3D non hq filter

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3Dlow.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3Dlow.cpp	2010-04-01 18:10:08 UTC (rev 6041)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3Dlow.cpp	2010-04-01 18:10:09 UTC (rev 6042)
@@ -0,0 +1,294 @@
+/***************************************************************************
+                          ADM_vidMPLD3D.cpp  -  description
+                             -------------------
+Mplayer HQDenoise3d port to avidemux2
+Original Authors
+Copyright (C) 2003
+Daniel Moreno <comac at comac.darktech.org>
+	& A'rpi
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include <math.h>
+#include "ADM_default.h"
+#include "ADM_coreVideoFilterInternal.h"
+#include "ADM_videoFilterCache.h"
+#include "DIA_factory.h"
+
+#include "ADM_vidMPLD3Dlow.h"
+#include "denoise3d_desc.cpp"
+
+#include "DIA_factory.h"
+#define aprintf(...) {}
+
+DECLARE_VIDEO_FILTER(   ADMVideoMPD3Dlow,   // Class
+                        1,0,0,              // Version
+                        ADM_UI_ALL,         // UI
+                        VF_NOISE,            // Category
+                        "MplayerDenoise3D",            // internal name (must be uniq!)
+                        "Mplayer Denoise 3D",            // Display name
+                        "Reduce noise, smooth image, increase compressibility." // Description
+                    );
+
+#define PARAM1_DEFAULT 4.0
+#define PARAM2_DEFAULT 3.0
+#define PARAM3_DEFAULT 6.0
+/**
+    \fn getConfiguration
+*/
+const char 	*ADMVideoMPD3Dlow::getConfiguration(void)
+ {
+      static char str[1024];
+	  snprintf(str,1023," MPlayer Denoise 3D (%2.1f - %2.1f - %2.1f)'",
+						param.luma,param.chroma,param.temporal);
+      return str;
+        
+}
+/**
+    \fn configure
+*/
+bool ADMVideoMPD3Dlow::configure(void)
+{
+
+        
+        ELEM_TYPE_FLOAT fluma,fchroma,ftemporal;
+#define PX(x) &x
+#define OOP(x,y) f##x=(ELEM_TYPE_FLOAT )param.x;
+        
+        OOP(luma,Luma);
+        OOP(chroma,Chroma);
+        OOP(temporal,Temporal);
+        
+        diaElemFloat   luma(PX(fluma),QT_TR_NOOP("_Spatial luma strength:"),0.,100.);
+        diaElemFloat   chroma(PX(fchroma),QT_TR_NOOP("S_patial chroma strength:"),0.,100.);
+        diaElemFloat   temporal(PX(ftemporal),QT_TR_NOOP("_Temporal strength:"),0.,100.);
+    
+        diaElem *elems[3]={&luma,&chroma,&temporal};
+  
+        if(  diaFactoryRun(QT_TR_NOOP("MPlayer denoise3d"),3,elems))
+        {
+#undef OOP
+#define OOP(x,y) param.x=(float) f##x
+                OOP(luma,Luma);
+                OOP(chroma,Chroma);
+                OOP(temporal,Temporal);
+          
+                setup();
+                return 1;
+        }
+        return 0;
+}
+/**
+    \fn dtor
+*/
+ADMVideoMPD3Dlow::~ADMVideoMPD3Dlow()
+{
+	delete [] Line;
+	Line=NULL;
+}
+
+
+#define LowPass(Prev, Curr, Coef) (Curr + Coef[Prev - Curr])
+
+/**
+    \fn deNoise
+*/
+void ADMVideoMPD3Dlow::deNoise(unsigned char *Frame,        // mpi->planes[x]
+                    unsigned char *FramePrev,    // pmpi->planes[x]
+                    unsigned char *FrameDest,    // dmpi->planes[x]
+                    unsigned char *LineAnt,      // vf->priv->Line (width bytes)
+                    int W, int H, int sStride, int pStride, int dStride,
+                    int *Horizontal, int *Vertical, int *Temporal)
+{
+    int X, Y;
+    int sLineOffs = 0, pLineOffs = 0, dLineOffs = 0;
+    unsigned char PixelAnt;
+
+    /* First pixel has no left nor top neightbour. Only previous frame */
+    LineAnt[0] = PixelAnt = Frame[0];
+    FrameDest[0] = LowPass(FramePrev[0], LineAnt[0], Temporal);
+
+    /* Fist line has no top neightbour. Only left one for each pixel and
+     * last frame */
+    for (X = 1; X < W; X++)
+    {
+        PixelAnt = LowPass(PixelAnt, Frame[X], Horizontal);
+        LineAnt[X] = PixelAnt;
+        FrameDest[X] = LowPass(FramePrev[X], LineAnt[X], Temporal);
+    }
+
+    for (Y = 1; Y < H; Y++)
+    {
+	sLineOffs += sStride, pLineOffs += pStride, dLineOffs += dStride;
+        /* First pixel on each line doesn't have previous pixel */
+        PixelAnt = Frame[sLineOffs];
+        LineAnt[0] = LowPass(LineAnt[0], PixelAnt, Vertical);
+        FrameDest[dLineOffs] = LowPass(FramePrev[pLineOffs], LineAnt[0], Temporal);
+
+        for (X = 1; X < W; X++)
+        {
+            /* The rest are normal */
+            PixelAnt = LowPass(PixelAnt, Frame[sLineOffs+X], Horizontal);
+            LineAnt[X] = LowPass(LineAnt[X], PixelAnt, Vertical);
+            FrameDest[dLineOffs+X] = LowPass(FramePrev[pLineOffs+X], LineAnt[X], Temporal);
+        }
+    }
+}
+
+
+/**
+    \fn setup
+*/
+uint8_t  ADMVideoMPD3Dlow::setup(void)
+{
+ double LumSpac, LumTmp, ChromSpac, ChromTmp;
+
+        LumSpac = param.luma;
+        LumTmp = param.temporal;
+
+        ChromSpac = param.chroma;
+        ChromTmp = LumTmp * ChromSpac / LumSpac;
+
+        PrecalcCoefs((int *)Coefs[0], LumSpac);
+        PrecalcCoefs((int *)Coefs[1], LumTmp);
+        PrecalcCoefs((int *)Coefs[2], ChromSpac);
+        PrecalcCoefs((int *)Coefs[3], ChromTmp);
+
+        aprintf("\n Param : %lf %lf %lf \n",
+            param.luma,
+            param.chroma,
+            param.temporal);
+
+       return 1;
+}
+/**
+    \fn ctor
+*/
+ADMVideoMPD3Dlow::ADMVideoMPD3Dlow(	ADM_coreVideoFilter *in,CONFcouple *couples) 
+        : ADM_coreVideoFilter(in,couples)
+{
+uint32_t page;
+  vidCache=new VideoCache(3,in);
+  Line=new uint8_t [in->getInfo()->width];
+  page=info.width*info.height;
+  
+  if(!couples || !ADM_paramLoad(couples,denoise3d_param,&param))
+  {  			
+			param.luma=PARAM1_DEFAULT;
+			param.chroma=PARAM2_DEFAULT;
+			param.temporal=PARAM3_DEFAULT;
+  }
+  setup();
+
+}
+
+/**
+    \fn getCoupledConf
+*/
+bool	ADMVideoMPD3Dlow::getCoupledConf( CONFcouple **couples)
+{
+    return ADM_paramSave(couples, denoise3d_param,&param);
+	
+}
+/**
+    \fn getNextFrame
+*/
+bool ADMVideoMPD3Dlow::getNextFrame(uint32_t *fn,ADMImage *image)
+{
+	int cw= info.width>>1;
+	int ch= info.height>>1;
+    int W = info.width;
+	int H  = info.height;
+	uint32_t dlen,dflags;
+
+    ADMImage *src, *dst, * prev, *next;
+    
+        *fn=nextFrame;
+        uint32_t n = nextFrame;
+printf("MP3d: next frame= %d\n",(int)n);
+        src = vidCache->getImage(n);
+        if(!src) return false;
+        // If possible get previous image...
+        if (n>0)
+                prev =  vidCache->getImage( n-1); // get previous frame
+        else
+                prev=src;
+        
+		uint8_t *c,*d,*p;
+
+		d=YPLANE(image);
+		c=YPLANE(src);
+		p=YPLANE(prev);
+//
+
+        deNoise(c,p, d,
+                Line, W, H,
+                W,W,W,
+               	Coefs[0] + 256,
+                Coefs[0] + 256,
+                Coefs[1] + 256);
+	
+		d=UPLANE(image);
+		c=UPLANE(src);
+		p=UPLANE(prev);
+
+        deNoise(c,p, d,
+                Line, cw, ch,
+                cw,cw,cw,
+               	Coefs[2] + 256,
+                Coefs[2] + 256,
+                Coefs[3] + 256);
+
+        d=VPLANE(image);
+        c=VPLANE(src);
+        p=VPLANE(prev);
+
+        deNoise(c,p, d,
+                    Line, cw, ch,
+                    cw,cw,cw,
+                    Coefs[2] + 256,
+                    Coefs[2] + 256,
+                    Coefs[3] + 256);
+
+
+	nextFrame++;
+	image->copyInfo(src);
+    vidCache->unlockAll();
+	return 1;
+}
+
+#define ABS(A) ( (A) > 0 ? (A) : -(A) )
+/**
+    \fn PrecalcCoefs
+*/
+void ADMVideoMPD3Dlow::PrecalcCoefs(int *Ct, double Dist25)
+{
+ int i;
+    double Gamma, Simil, C;
+    double d;
+    Gamma = log(0.25) / log(1.0 - Dist25/255.0);
+
+    for (i = -256; i <= 255; i++)
+    {
+    	if(i>0) d=(double)i/255.;
+		else d=(double)-i/255.;
+        Simil = 1.0 - d;
+//        Ct[256+i] = lround(pow(Simil, Gamma) * (double)i);
+ 	C= (double)i;
+        C *= pow(Simil, Gamma);
+
+  	Ct[256+i] = (int)((C<0) ? (C-0.5) : (C+0.5));
+
+    }
+}
+
+// EOF
+
+

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3Dlow.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3Dlow.h	2010-04-01 18:10:08 UTC (rev 6041)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/ADM_vidMPLD3Dlow.h	2010-04-01 18:10:09 UTC (rev 6042)
@@ -0,0 +1,59 @@
+/***************************************************************************
+                          ADM_vidMPLD3D.h  -  description
+                             -------------------
+Mplayer Denoise3d port to avidemux2
+Original Authors
+Copyright (C) 2003
+Daniel Moreno <comac at comac.darktech.org>
+
+
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef __D3DLOW__
+#define __D3DLOW__
+
+#include "denoise3d.h"
+
+/**
+    \class ADMVideoMPD3Dlow
+*/
+class ADMVideoMPD3Dlow : public  ADM_coreVideoFilter
+{
+protected:
+                ADMImage        *original;
+                denoise3d       param;
+                uint32_t        last;
+                uint8_t         *Line;
+                int				Coefs[4][512];
+                void 	    PrecalcCoefs(int *Ct, double Dist25);
+				uint8_t  	setup(void);
+				void 	    deNoise(unsigned char *Frame,        // mpi->planes[x]
+                    						unsigned char *FramePrev,    // pmpi->planes[x]
+                    						unsigned char *FrameDest,    // dmpi->planes[x]
+                    						unsigned char *LineAnt,      // vf->priv->Line (width bytes)
+                    						int W, int H, int sStride, int pStride, int dStride,
+                    						int *Horizontal, int *Vertical, int *Temporal);
+
+                    
+public:
+                    ADMVideoMPD3Dlow(ADM_coreVideoFilter *previous,CONFcouple *conf);
+                    ~ADMVideoMPD3Dlow();
+
+        virtual const char   *getConfiguration(void);                 /// Return  current configuration as a human readable string
+        virtual bool         getNextFrame(uint32_t *fn,ADMImage *image);           /// Return the next image
+        virtual bool         getCoupledConf(CONFcouple **couples) ;   /// Return the current filter configuration
+        virtual bool         configure(void) ;                        /// Start graphical user interface
+};
+
+			
+
+#endif



From mean at mail.berlios.de  Sat Apr  3 10:42:47 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 3 Apr 2010 10:42:47 +0200
Subject: [Avidemux-svn-commit] r6043 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src
Message-ID: <201004030842.o338glgh023476@sheep.berlios.de>

Author: mean
Date: 2010-04-03 10:42:46 +0200 (Sat, 03 Apr 2010)
New Revision: 6043

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsVideo.cpp
Log:
[Js] Better save/load of markers

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsVideo.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsVideo.cpp	2010-04-01 18:10:09 UTC (rev 6042)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsVideo.cpp	2010-04-03 08:42:46 UTC (rev 6043)
@@ -121,6 +121,7 @@
 */
 double jsGetMarkerA(void)
 {
+    return (double)video_body->getMarkerAPts();
 
 }
 /**
@@ -128,21 +129,21 @@
 */
 double jsGetMarkerB(void)
 {
-
+    return (double)video_body->getMarkerBPts();
 }
 /**
     \fn jsSetMarkerA
 */
 void   jsSetMarkerA(double a)
 {
-
+    video_body->setMarkerAPts( (uint64_t)a);
 }
 /**
     \fn jsGetMarkerB
 */
 void   jsSetMarkerB(double b)
 {
-
+    video_body->setMarkerBPts( (uint64_t)b);
 }
 
 //EOF
\ No newline at end of file



From mean at mail.berlios.de  Sat Apr  3 10:42:48 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 3 Apr 2010 10:42:48 +0200
Subject: [Avidemux-svn-commit] r6044 -
	branches/avidemux_2.6_branch_mean/avidemux/common
Message-ID: <201004030842.o338gmkF023505@sheep.berlios.de>

Author: mean
Date: 2010-04-03 10:42:48 +0200 (Sat, 03 Apr 2010)
New Revision: 6044

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp
Log:
[save] Put the right starting time, do not mix with globalHeader param

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp	2010-04-03 08:42:46 UTC (rev 6043)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp	2010-04-03 08:42:48 UTC (rev 6044)
@@ -37,6 +37,7 @@
 #include "ADM_bitstream.h"
 #include "ADM_filterChain.h"
 #include "ADM_videoEncoderApi.h"
+#include "ADM_vidMisc.h"
 /*
 
 */
@@ -235,7 +236,8 @@
 {
     int ret=1;
     uint64_t startAudioTime=markerA; // Actual start time (for both audio & video actually)
-    printf("[A_Save] Saving..\n");
+    ADM_info("Audio starting time %s\n",ADM_us2plain(startAudioTime));
+    ADM_info("[A_Save] Saving..\n");
 
     if(!(muxer=ADM_MuxerSpawnFromIndex(muxerIndex)))
     {
@@ -324,7 +326,9 @@
         if(audio)   // Process
         {
             // Access..
-            ADM_audioStream *access=audioCreateEncodingStream(startAudioTime,0,muxer->useGlobalHeader()); // FIXME LEAK FIXME 
+            ADM_info("Crearting audio encoding stream, starttime %s\n",ADM_us2plain(startAudioTime));
+            //audioCreateEncodingStream(bool globalHeader,uint64_t startTime,int32_t shift);
+            ADM_audioStream *access=audioCreateEncodingStream(muxer->useGlobalHeader(),startAudioTime,0); // FIXME LEAK FIXME 
             astreams[0]=access;
             if(!access)
             {



From mean at mail.berlios.de  Sat Apr  3 10:42:51 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 3 Apr 2010 10:42:51 +0200
Subject: [Avidemux-svn-commit] r6045 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor
Message-ID: <201004030842.o338gp0k023515@sheep.berlios.de>

Author: mean
Date: 2010-04-03 10:42:50 +0200 (Sat, 03 Apr 2010)
New Revision: 6045

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRenderInternal.cpp
Log:
[Render] Drop frames that go backward

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRenderInternal.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRenderInternal.cpp	2010-04-03 08:42:48 UTC (rev 6044)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRenderInternal.cpp	2010-04-03 08:42:50 UTC (rev 6045)
@@ -244,14 +244,22 @@
                 aprintf("[Editor] got PTS\n");
                 vid->lastDecodedPts=pts;
             }
+    aprintf(">>Decoded frame %"LU" with pts=%"LLD" us, %"LLD" ms, ptsdelta=%"LLD" ms \n",
+        frame,
+        vid->lastDecodedPts,
+        vid->lastDecodedPts/1000,
+        (vid->lastDecodedPts-old)/1000);
 
-    cache->validate(result);
-    aprintf(">>Decoded frame %"LU" with pts=%"LLD" us, %"LLD" ms, ptsdelta=%"LLD" ms \n",
-    frame,
-    vid->lastDecodedPts,
-    vid->lastDecodedPts/1000,
-    (vid->lastDecodedPts-old)/1000);
-    if(old>vid->lastDecodedPts) ADM_warning(">>>>> PTS going backward by %"LLD" ms\n",(old-vid->lastDecodedPts)/1000);
+    if(old>vid->lastDecodedPts) 
+    {
+        ADM_warning(">>>>> PTS going backward by %"LLD" ms\n",(old-vid->lastDecodedPts)/1000);
+        ADM_warning("Dropping frame!\n");
+        cache->invalidate(result);
+        return false;
+    }else
+    {
+        cache->validate(result);
+    }
     return true;
 }
 



From mean at mail.berlios.de  Sat Apr  3 10:42:52 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 3 Apr 2010 10:42:52 +0200
Subject: [Avidemux-svn-commit] r6046 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src
Message-ID: <201004030842.o338gqIP023525@sheep.berlios.de>

Author: mean
Date: 2010-04-03 10:42:52 +0200 (Sat, 03 Apr 2010)
New Revision: 6046

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audiofilter_bridge.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audiofilter_encoder.cpp
Log:
[Audio] Print out some more debug info when creating audio stream(s)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audiofilter_bridge.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audiofilter_bridge.cpp	2010-04-03 08:42:50 UTC (rev 6045)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audiofilter_bridge.cpp	2010-04-03 08:42:52 UTC (rev 6046)
@@ -37,7 +37,7 @@
   _hold=0;
   rewind();
   
-  printf("[Bridge] Starting with time %u, shift %d\n",startInMs,-shiftMs);
+  ADM_info("[Bridge] Starting with time %"LU" ms, shift %"LD" ms\n",startInMs,-shiftMs);
   // If shiftMS is > 0, it means we have to go in the future, just increse _startTime
   if(shiftMs>0)
   {
@@ -81,9 +81,9 @@
 {
 uint64_t ttime=_startTime;
   ttime*=1000; // ms->us
-  printf("[Bridge] Going to time %d\n",_startTime);
+  ADM_info("[AudioBridge] Going to time %d\n",_startTime);
   uint8_t r= _incoming->goToTime(ttime);
-  if(!r) printf("[Bridge] Failed!\n");
+  if(!r) ADM_warning("[AudioBridge] Failed!\n");
   return r;
 }
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audiofilter_encoder.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audiofilter_encoder.cpp	2010-04-03 08:42:50 UTC (rev 6045)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src/audiofilter_encoder.cpp	2010-04-03 08:42:52 UTC (rev 6046)
@@ -23,6 +23,7 @@
 #include "audiofilter_conf.h"
 #include "audioencoder.h"
 #include "audioEncoderApi.h"
+#include "ADM_vidMisc.h"
 
 VectorOfAudioFilter EncodingVector;
 extern ADM_Composer *video_body;
@@ -75,6 +76,7 @@
 AUDMAudioFilter *createEncodingFilter(uint64_t startTime,int32_t shift)
 {
     //
+    ADM_info("Creating audio encoding filter with start time %s\n",ADM_us2plain(startTime));
     audioEncodingConfig.startTimeInUs=startTime;
     audioEncodingConfig.shiftInMs=shift;
     //
@@ -101,7 +103,7 @@
 */
 ADM_audioStream *audioCreateEncodingStream(bool globalHeader,uint64_t startTime,int32_t shift)
 {
-    printf("[AccessFilter] Creating access filter\n");
+    printf("[AccessFilter] Creating access filter, startime %s, globalHeader %d\n",ADM_us2plain(startTime),globalHeader);
     // 1-Create access filter
     AUDMAudioFilter *filter=createEncodingFilter(startTime,shift);
     if(!filter)



From mean at mail.berlios.de  Sat Apr  3 17:58:54 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 3 Apr 2010 17:58:54 +0200
Subject: [Avidemux-svn-commit] r6047 - branches/avidemux_2.6_branch_mean
Message-ID: <201004031558.o33Fwslb016646@sheep.berlios.de>

Author: mean
Date: 2010-04-03 17:58:54 +0200 (Sat, 03 Apr 2010)
New Revision: 6047

Modified:
   branches/avidemux_2.6_branch_mean/README
Log:
[Dummy commit]

Modified: branches/avidemux_2.6_branch_mean/README
===================================================================
--- branches/avidemux_2.6_branch_mean/README	2010-04-03 08:42:52 UTC (rev 6046)
+++ branches/avidemux_2.6_branch_mean/README	2010-04-03 15:58:54 UTC (rev 6047)
@@ -1,2 +1,3 @@
 #:x
+Nothing interesting here
 



From mean at mail.berlios.de  Mon Apr  5 09:11:50 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 5 Apr 2010 09:11:50 +0200
Subject: [Avidemux-svn-commit] r6048 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config
Message-ID: <201004050711.o357BoNe022303@sheep.berlios.de>

Author: mean
Date: 2010-04-05 09:11:49 +0200 (Mon, 05 Apr 2010)
New Revision: 6048

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/config.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/ffconf.c
Log:
[FFmpeg] Fix build for macOsx

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/config.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/config.h	2010-04-03 15:58:54 UTC (rev 6047)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/config.h	2010-04-05 07:11:49 UTC (rev 6048)
@@ -523,7 +523,7 @@
 #define HAVE_THREADS 1
 #define RUNTIME_CPUDETECT 1
 #define CONFIG_RUNTIME_CPUDETECT 1
-#ifdef __MINGW32__
+#if defined( __MINGW32__) || defined(__APPLE__)
 #define EXTERN_PREFIX "_"
 #else // __MINGW32__
 #define EXTERN_PREFIX

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/ffconf.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/ffconf.c	2010-04-03 15:58:54 UTC (rev 6047)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/ffconf.c	2010-04-05 07:11:49 UTC (rev 6048)
@@ -599,7 +599,7 @@
 	printf("#define HAVE_THREADS 1\n");
 	printf("#define RUNTIME_CPUDETECT 1\n");
 	printf("#define CONFIG_RUNTIME_CPUDETECT 1\n");
-    printf("#ifdef __MINGW32__\n");
+    printf("#if defined( __MINGW32__) || defined(__APPLE__)\n");
         printf("#define EXTERN_PREFIX \"_\"\n");
     printf("#else // __MINGW32__\n");
         printf("#define EXTERN_PREFIX\n");



From mean at mail.berlios.de  Mon Apr  5 09:11:51 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 5 Apr 2010 09:11:51 +0200
Subject: [Avidemux-svn-commit] r6049 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <201004050711.o357BprY022313@sheep.berlios.de>

Author: mean
Date: 2010-04-05 09:11:51 +0200 (Mon, 05 Apr 2010)
New Revision: 6049

Modified:
   branches/avidemux_2.6_branch_mean/cmake/FindYasm.cmake
Log:
[yasm] Fix for macOsX

Modified: branches/avidemux_2.6_branch_mean/cmake/FindYasm.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/FindYasm.cmake	2010-04-05 07:11:49 UTC (rev 6048)
+++ branches/avidemux_2.6_branch_mean/cmake/FindYasm.cmake	2010-04-05 07:11:51 UTC (rev 6049)
@@ -13,7 +13,11 @@
         IF(WIN32)
                 SET(YASM_FLAGS -f coff -DPREFIX)
         ELSE(WIN32)
-                SET(YASM_FLAGS -f elf -DPIC -g dwarf2)
+                IF(APPLE)
+                        SET(YASM_FLAGS -f macho -DPREFIX -DPIC)
+                ELSE(APPLE)
+                        SET(YASM_FLAGS -f elf -DPIC -g dwarf2)
+                ENDIF(APPLE)
         ENDIF(WIN32)
         IF(ADM_CPU_X86_64)
                 SET(YASM_FLAGS ${YASM_FLAGS} -DARCH_X86_64 -m amd64)



From mean at mail.berlios.de  Mon Apr  5 20:05:38 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 5 Apr 2010 20:05:38 +0200
Subject: [Avidemux-svn-commit] r6050 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include
Message-ID: <201004051805.o35I5ch1031933@sheep.berlios.de>

Author: mean
Date: 2010-04-05 20:05:38 +0200 (Mon, 05 Apr 2010)
New Revision: 6050

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_mangle.h
Log:
[OsX] Fix FUNNY_MANGLE

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_mangle.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_mangle.h	2010-04-05 07:11:51 UTC (rev 6049)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_mangle.h	2010-04-05 18:05:38 UTC (rev 6050)
@@ -34,6 +34,8 @@
 #        define FUNNY_MANGLE_ARRAY(x, y)  x[y] asm(#x)
 #    elif defined(__APPLE__)
 #        define MANGLE(a) "_" #a
+#        define FUNNY_MANGLE(x) x asm(MANGLE(x))
+#        define FUNNY_MANGLE_ARRAY(x, y) x[y] asm(MANGLE(x))
 #    else
 #        define MANGLE(a) #a
 #        define FUNNY_MANGLE(x) x asm(MANGLE(x))



From mean at mail.berlios.de  Mon Apr  5 20:05:40 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 5 Apr 2010 20:05:40 +0200
Subject: [Avidemux-svn-commit] r6051 -
	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui
Message-ID: <201004051805.o35I5eVb031943@sheep.berlios.de>

Author: mean
Date: 2010-04-05 20:05:40 +0200 (Mon, 05 Apr 2010)
New Revision: 6051

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui
Log:
[Qt4] Add playback a/r menu (inactive)

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui	2010-04-05 18:05:38 UTC (rev 6050)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui	2010-04-05 18:05:40 UTC (rev 6051)
@@ -7,8 +7,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>756</width>
-    <height>588</height>
+    <width>800</width>
+    <height>664</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -396,22 +396,6 @@
             </property>
            </spacer>
           </item>
-          <item>
-           <spacer>
-            <property name="orientation">
-             <enum>Qt::Vertical</enum>
-            </property>
-            <property name="sizeType">
-             <enum>QSizePolicy::Expanding</enum>
-            </property>
-            <property name="sizeHint" stdset="0">
-             <size>
-              <width>20</width>
-              <height>10</height>
-             </size>
-            </property>
-           </spacer>
-          </item>
          </layout>
         </item>
         <item>
@@ -1291,7 +1275,7 @@
     <rect>
      <x>0</x>
      <y>0</y>
-     <width>756</width>
+     <width>800</width>
      <height>21</height>
     </rect>
    </property>
@@ -1411,12 +1395,23 @@
      <addaction name="actionPreviewTop"/>
      <addaction name="actionPreviewSeparate"/>
     </widget>
+    <widget class="QMenu" name="menuPlayback_Aspect_Ratio">
+     <property name="title">
+      <string>Playback Aspect Ratio</string>
+     </property>
+     <addaction name="actionAR_Auto"/>
+     <addaction name="actionAR_1_1"/>
+     <addaction name="actionAR_4_3"/>
+     <addaction name="actionAR_16_9"/>
+    </widget>
     <addaction name="actionZoom_1_4"/>
     <addaction name="actionZoom_1_2"/>
     <addaction name="actionZoom_1_1"/>
     <addaction name="actionZoom_2_1"/>
     <addaction name="separator"/>
     <addaction name="menu_Preview"/>
+    <addaction name="separator"/>
+    <addaction name="menuPlayback_Aspect_Ratio"/>
    </widget>
    <widget class="QMenu" name="menuCustom">
     <property name="title">
@@ -2367,6 +2362,46 @@
     <string>JavaScript shell</string>
    </property>
   </action>
+  <action name="action1_1">
+   <property name="text">
+    <string>1:1</string>
+   </property>
+  </action>
+  <action name="actionAR_Auto">
+   <property name="checkable">
+    <bool>true</bool>
+   </property>
+   <property name="text">
+    <string>Auto</string>
+   </property>
+  </action>
+  <action name="actionAR_1_1">
+   <property name="checkable">
+    <bool>true</bool>
+   </property>
+   <property name="checked">
+    <bool>true</bool>
+   </property>
+   <property name="text">
+    <string>1:1</string>
+   </property>
+  </action>
+  <action name="actionAR_4_3">
+   <property name="checkable">
+    <bool>true</bool>
+   </property>
+   <property name="text">
+    <string>4:3</string>
+   </property>
+  </action>
+  <action name="actionAR_16_9">
+   <property name="checkable">
+    <bool>true</bool>
+   </property>
+   <property name="text">
+    <string>16:9</string>
+   </property>
+  </action>
  </widget>
  <customwidgets>
   <customwidget>



From mean at mail.berlios.de  Mon Apr  5 20:05:43 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 5 Apr 2010 20:05:43 +0200
Subject: [Avidemux-svn-commit] r6052 - in
	branches/avidemux_2.6_branch_mean/avidemux: common
	common/ADM_editor common/ADM_script2/src
	gtk/ADM_userInterfaces/ADM_dialog qt4/ADM_userInterfaces/ADM_gui
Message-ID: <201004051805.o35I5hYQ031957@sheep.berlios.de>

Author: mean
Date: 2010-04-05 20:05:42 +0200 (Mon, 05 Apr 2010)
New Revision: 6052

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.hxx
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsIf.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_save.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_dialog/TLK_filesel.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
Log:
[editor] Move current project name to editor, remove actual_workbench

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp	2010-04-05 18:05:40 UTC (rev 6051)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp	2010-04-05 18:05:42 UTC (rev 6052)
@@ -70,6 +70,7 @@
   _internalFlags=0;
   _currentSegment=0;
   _scratch=NULL;
+  projectName=NULL;
 }
 /**
 	Remap 1:1 video to segments
@@ -111,10 +112,31 @@
 	deletePostProc(&_pp);
     if(_imageBuffer) delete  _imageBuffer;
     _imageBuffer=NULL;
+    if(projectName) ADM_dealloc(projectName);
+    projectName=NULL;
 }
+/**
+    \fn getProjectName
+*/
+const char *ADM_Composer::getProjectName(void)
+{
+    if(!projectName) return NULL;
+    if(!strlen(projectName)) return NULL;
+    return projectName;
+}
 
-
 /**
+    \fn setProjectName
+*/
+bool ADM_Composer::setProjectName(const char *pj)
+{
+    if(projectName) ADM_dealloc(projectName);
+    projectName=NULL;
+    if(pj)
+        projectName=ADM_strdup(pj);
+    return true;
+}
+/**
     \fn addFile
     \brief	Load or append a file.	The file type is determined automatically and the ad-hoc video decoder is spawned
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.hxx
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.hxx	2010-04-05 18:05:40 UTC (rev 6051)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.hxx	2010-04-05 18:05:42 UTC (rev 6052)
@@ -63,6 +63,8 @@
 class ADM_Composer : public ADM_audioStream
 {
   private:
+                    const  char *projectName;
+  private:
 //*********************************PRIVATE API *******************************************
                     //bool		decodeCache(uint32_t ref, uint32_t frame,ADMImage *image);
                     bool        switchToNextSegment(bool dontdecode=false);
@@ -133,8 +135,6 @@
 virtual                         ~ADM_Composer();
                     void        clean( void );
                     uint8_t     saveAsScript (const char *name, const char *out);
-                    uint8_t 	saveWorbench(const char *name);
-                    uint8_t 	loadWorbench(const char *name);
                     uint8_t     resetSeg( void );
                     bool     	addFile (const char *name);
                     uint8_t 	cleanup( void);
@@ -198,8 +198,11 @@
                     uint64_t        getFrameIncrement(void); /// Returns the # of us between 2 frames or the smaller value of them
 
 /**************************************** /Video Info **************************/					
+/***************************************** Project Handling ********************/
+public:
+                    const char          *getProjectName(void);
+                    bool                 setProjectName(const char *name);
 					
-					
 /***************************************** Seeking *****************************/            
 public:
                     bool                getNKFramePTS(uint64_t *frameTime);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsIf.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsIf.cpp	2010-04-05 18:05:40 UTC (rev 6051)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsIf.cpp	2010-04-05 18:05:42 UTC (rev 6052)
@@ -15,16 +15,15 @@
 #include "ADM_js.h"
 #include <stdarg.h>
 #include <vector>
-
+#include "ADM_editor/ADM_edit.hxx"
 void    A_Resync(void);
 
 /* our variables */
 static jsLoggerFunc *jsLogger=NULL;
 static void *jsLoggerCookie=NULL;
-extern char * actual_workbench_file;
 vector <ADM_JS_HOOK >jsHooks;
+extern ADM_Composer *video_body;
 
-
 #define JSVAR(a,b,c) a b=c
 
 #if defined( __MINGW32__) 
@@ -306,11 +305,9 @@
         bool ret = false;
         const char *pScriptFile = static_cast<const char *>(pData);
         ret = parseECMAScript(pScriptFile);
-        if(ret == false)
+        if(ret == true)
         {
-                if( actual_workbench_file )
-                        ADM_dealloc(actual_workbench_file);
-                actual_workbench_file = ADM_strdup(pScriptFile);
+                video_body->setProjectName(pScriptFile);
         }
         // Notify Spidermonkey that our thread processing has finished
 #ifdef ADM_JS_THREADSAFE

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp	2010-04-05 18:05:40 UTC (rev 6051)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp	2010-04-05 18:05:42 UTC (rev 6052)
@@ -41,7 +41,6 @@
 #include "avi_vars.h"
 #include "prototype.h" // FIXME
 #include "ADM_script2/include/ADM_JSif.h"
-char * actual_workbench_file;
 renderZoom currentZoom=ZOOM_1_1;
 //***********************************
 //******** A Function ***************
@@ -403,11 +402,7 @@
       		ReSync ();
 
             // forget last project file
-            if( actual_workbench_file )
-            {
-                ADM_dealloc(actual_workbench_file);
-                actual_workbench_file = NULL;
-            }
+            video_body->setProjectName(NULL);
         }
 	break;
 
@@ -583,10 +578,7 @@
 //  DIA_StopBusy ();
 
   // forget last project file
-  if( actual_workbench_file ){
-     ADM_dealloc(actual_workbench_file);
-     actual_workbench_file = NULL;
-  }
+    video_body->setProjectName(NULL);
 
   if (res!=ADM_OK)			// an error occured
     {
@@ -612,6 +604,8 @@
 	/* check myself it is a project file (transparent detected and read
         ** by video_body->addFile (name);
 	*/
+#warning FIXME
+#if 0
 	if( (fd = ADM_fopen(longname,"rb"))  ){
 		if( fread(magic,4,1,fd) == 4 ){
 			/* remember a workbench file */
@@ -621,7 +615,7 @@
 		}
 		fclose(fd);
 	}
-
+#endif
 	/* remember any video or workbench file to "recent" */
         prefs->set_lastfile(longname);
         UI_updateRecentMenu();
@@ -842,11 +836,6 @@
 		secondAudioName = NULL;
 	}
 #endif
-	if (actual_workbench_file)
-	{
-		ADM_dealloc(actual_workbench_file);
-		actual_workbench_file = NULL;
-	}
 
 	if (video_body)
 	{
@@ -870,11 +859,9 @@
       GUI_PlayAvi();
    }
    ret = parseECMAScript(longname);
-   if( ret == 0 ){
-      if( actual_workbench_file )
-         ADM_dealloc(actual_workbench_file);
-      actual_workbench_file = ADM_strdup(longname);
-      
+   if( ret == true )
+   {
+      video_body->setProjectName(longname);
    }
    ADM_dealloc(longname);
    return ret;
@@ -1281,11 +1268,7 @@
   GUI_close();
   res = video_body->addFile (AVS_PROXY_DUMMY_FILE);
   // forget last project file
-  if( actual_workbench_file ){
-     ADM_dealloc(actual_workbench_file);
-     actual_workbench_file = NULL;
-  }
-
+  video_body->setProjectName(NULL);
   if (res!=ADM_OK)			// an error occured
     {
         currentaudiostream = NULL;

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_save.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_save.cpp	2010-04-05 18:05:40 UTC (rev 6051)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_save.cpp	2010-04-05 18:05:42 UTC (rev 6052)
@@ -45,7 +45,6 @@
 int      A_Save(const char *name);
 uint8_t  GUI_getFrameContent(ADMImage *image, uint32_t frame);
 
-extern char * actual_workbench_file; // UGLY FIXME
 /**
     \fn HandleAction_Navigate
 
@@ -60,14 +59,17 @@
 	  UI_refreshCustomMenu();
       break;
    case ACT_SaveCurrentWork:
-      if( actual_workbench_file ){
-        char *tmp = ADM_strdup(actual_workbench_file);
-         A_saveWorkbench( tmp ); // will write "actual_workbench_file" itself
-         ADM_dealloc(tmp);
-      }else{
-        GUI_FileSelWrite (QT_TR_NOOP("Select Workbench to Save"), A_saveWorkbench);
-		UI_refreshCustomMenu();
-      }
+        {
+          const char *pj=video_body->getProjectName();
+          if( pj ){
+            char *tmp = ADM_strdup(pj);
+             A_saveWorkbench( tmp ); // will write "actual_workbench_file" itself
+             ADM_dealloc(tmp);
+          }else{
+            GUI_FileSelWrite (QT_TR_NOOP("Select Workbench to Save"), A_saveWorkbench);
+            UI_refreshCustomMenu();
+          }
+        }
       break;
       
     case ACT_SaveRaw:
@@ -439,14 +441,8 @@
 */
 void A_saveWorkbench (const char *name)
 {
-#if 0
-  video_body->saveWorbench (name);
-#else
   video_body->saveAsScript(name,NULL);
-#endif
-  if( actual_workbench_file )
-     ADM_dealloc(actual_workbench_file);
-  actual_workbench_file = ADM_strdup(name);
+  video_body->setProjectName(name);
 }
 /**
     \fn A_SaveWrapper

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_dialog/TLK_filesel.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_dialog/TLK_filesel.cpp	2010-04-05 18:05:40 UTC (rev 6051)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_dialog/TLK_filesel.cpp	2010-04-05 18:05:42 UTC (rev 6052)
@@ -35,7 +35,6 @@
 #define TH_READ 1
 #define TH_WRITE 2
 
-extern char *actual_workbench_file;
 extern void FileSel_ReadWrite(SELFILE_CB *cb, int rw, const char *name, const char *actual_workbench_file);
 
 namespace ADM_GTK_fileSel 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2010-04-05 18:05:40 UTC (rev 6051)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2010-04-05 18:05:42 UTC (rev 6052)
@@ -51,7 +51,6 @@
 extern ADM_RENDER_TYPE UI_getPreferredRender(void);
 extern int A_openAvi(const char *name);
 extern int A_appendAvi(const char *name);
-extern char *actual_workbench_file;
 extern void FileSel_ReadWrite(SELFILE_CB *cb, int rw, const char *name, const char *actual_workbench_file);
 
 
@@ -450,7 +449,8 @@
 		{
 			fileName = urlList[fileIndex].toLocalFile();
 			info.setFile(fileName);
-
+#warning FIXME
+#if 0
 			if (info.isFile())
 			{
 				if (avifileinfo)
@@ -458,6 +458,7 @@
 				else
 					FileSel_ReadWrite(reinterpret_cast <void (*)(const char *)> (A_openAvi), 0, fileName.toUtf8().data(), actual_workbench_file);
 			}
+#endif
 		}
 	}
 



From mean at mail.berlios.de  Mon Apr  5 20:05:46 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 5 Apr 2010 20:05:46 +0200
Subject: [Avidemux-svn-commit] r6053 -
	branches/avidemux_2.6_branch_mean/avidemux/qt4
Message-ID: <201004051805.o35I5kgY031971@sheep.berlios.de>

Author: mean
Date: 2010-04-05 20:05:44 +0200 (Mon, 05 Apr 2010)
New Revision: 6053

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
Log:
[OsX] More fixes for QT4

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2010-04-05 18:05:42 UTC (rev 6052)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2010-04-05 18:05:44 UTC (rev 6053)
@@ -141,6 +141,18 @@
         ADD_TARGET_LDFLAGS(avidemux3_qt4 "-mwindows")
 
 ENDIF (WIN32)
+
+IF (APPLE)
+        IF(USE_SDL)
+               TARGET_LINK_LIBRARIES(avidemux3_qt4 ADM_libsdl)
+        ENDIF(USE_SDL)
+        ADD_TARGET_LDFLAGS(avidemux3_qt4 "-framework CoreServices -framework CoreAudio -framework AudioUnit -framework Carbon")
+
+        # for Leopard but it doesn't hurt Tiger
+        ADD_TARGET_LDFLAGS(avidemux3_qt4 "-Wl,-dylib_file,/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib:/System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib")
+ENDIF (APPLE)
+
+
 #
 # xml
 #



From mean at mail.berlios.de  Mon Apr  5 20:05:50 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 5 Apr 2010 20:05:50 +0200
Subject: [Avidemux-svn-commit] r6054 - in
	branches/avidemux_2.6_branch_mean/avidemux_core:
	ADM_coreImage/include ADM_coreImage/src
	ADM_coreVideoFilter/include ADM_coreVideoFilter/src
Message-ID: <201004051805.o35I5oNp032009@sheep.berlios.de>

Author: mean
Date: 2010-04-05 20:05:50 +0200 (Mon, 05 Apr 2010)
New Revision: 6054

Removed:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_rgb.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/rgb2yuv.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/yuv.cpp
Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_colorspace.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageSave.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/DIA_flyDialog.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp
Log:
[colorspace] Merge resizer + color converted inside ADM_ColorSpace

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_colorspace.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_colorspace.h	2010-04-05 18:05:44 UTC (rev 6053)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_colorspace.h	2010-04-05 18:05:50 UTC (rev 6054)
@@ -16,116 +16,53 @@
  #define ADM_COLORSPACE_H
 #include "ADM_rgb.h" // To have colors
 
-// Some handy simple colorspace code
-
-uint8_t  COL_yv12rgbBMP(uint32_t ww, uint32_t hh, uint8_t* in, uint8_t *out);
-uint8_t  COL_yv12rgb(uint32_t w, uint32_t h,uint8_t * ptr, uint8_t * out );
-
-uint8_t COL_422_YV12( uint8_t *in[3], uint32_t stride[3],  uint8_t *out,uint32_t w, uint32_t h);
-uint8_t COL_411_YV12( uint8_t *in[3], uint32_t stride[3],  uint8_t *out,uint32_t w, uint32_t h);
-
-uint8_t COL_RgbToYuv(uint8_t R,uint8_t G,uint8_t B, uint8_t *y,int8_t *u,int8_t  *v);
-uint8_t COL_YuvToRgb( uint8_t y,int8_t u,int8_t v,uint8_t *r,uint8_t *g,uint8_t *b);
-
-uint8_t COL_RawRGB32toYV12(uint8_t *data1,uint8_t *data2, uint8_t *oy,uint8_t *oy2, 
-				uint8_t *u, uint8_t *v,uint32_t lineSize,uint32_t height,uint32_t stride);
-
-uint8_t COL_RGB24_to_YV12(uint32_t w,uint32_t h,uint8_t *rgb, uint8_t *yuv);
-uint8_t COL_RGB24_to_YV12_revert(uint32_t w,uint32_t h,uint8_t *rgb, uint8_t *yuv);
-
-// Generic colorspace conversion class
-
-class ADMColorspace
+typedef enum 
 {
+    ADM_CS_BILINEAR,
+    ADM_CS_BICUBIC,
+    ADM_CS_LANZCOS
+}ADMColorSpace_algo;
+/**
+    \class ADMColorSpace
+*/
+class ADMColorSpaceFull
+{
   protected:
-    void  *context;
-    uint32_t width,height;
-    ADM_colorspace fromColor,toColor;
-    uint8_t getStrideAndPointers(uint8_t  *from,ADM_colorspace fromColor,uint8_t **srcData,int *srcStride);
+    void            *context;
+    uint32_t        srcWidth,srcHeight;
+    uint32_t        dstWidth,dstHeight;
+    ADM_colorspace  fromColor,toColor;
+    ADMColorSpace_algo algo;
+    uint8_t         getStrideAndPointers(bool dst,uint8_t  *from,ADM_colorspace fromColor,
+                                            uint8_t **srcData,int *srcStride);
   public :
     
-    ADMColorspace(uint32_t w, uint32_t h, ADM_colorspace from,ADM_colorspace to);
-    uint8_t convert(uint8_t  *from, uint8_t *to);
-    ~ADMColorspace();
-};
-/* Convert YV12 to RGB32, the reset must be called at least once before using scale */
- class ColBase
- {
-  protected:
-    void        *_context;
-    uint32_t    w,h;  
-    uint8_t     clean(void);
-     
-  public:
-                ColBase(uint32_t w, uint32_t h);
-                ~ColBase();
-     virtual   uint8_t reset(uint32_t neww, uint32_t newh) {return 0;};
-     virtual   uint8_t scale(uint8_t *src, uint8_t *target){return 0;};  
- };
- //************ YV12 to RB32********************************
- class ColYuvRgb : public ColBase
- {
-  protected:
-              uint32_t _inverted;
-  public:
-                ColYuvRgb(uint32_t w, uint32_t h,uint32_t inv=0): ColBase(w,h) {_inverted=inv;};
-                ~ColYuvRgb(){clean();};
-      virtual  uint8_t reset(uint32_t neww, uint32_t newh);
-      virtual  uint8_t scale(uint8_t *src, uint8_t *target);
-      virtual  uint8_t scale(uint8_t *src, uint8_t *target,uint32_t startx,uint32_t starty, uint32_t w,uint32_t h,uint32_t totalW,uint32_t totalH);    
- };
- //********************************************
-
-  /* Convert RGB24/32 to YV12, the reset must be called at least once before using scale */
-  class ColRgbToYV12  : public ColBase
-  {
-  protected:
-                int             _bmpMode;
-                ADM_colorspace  _colorspace;
-                uint32_t        _backward;
-  public:
-                ColRgbToYV12(uint32_t w, uint32_t h,ADM_colorspace col) : ColBase(w,h) 
-                    {
-                            _colorspace=col;
-                            _bmpMode=0;
-                    };
-                ~ColRgbToYV12(){clean();};
-      virtual  uint8_t reset(uint32_t neww, uint32_t newh);
-      virtual  uint8_t scale(uint8_t *src, uint8_t *target);  
-               uint8_t changeColorSpace(ADM_colorspace col);   
-               uint8_t setBmpMode(void);
-      
-  };
-//********************************************
-/* Convert RGB24 to YV12, the reset must be called at least once before using scale */
-  class ColYv12Rgb24  : public ColBase
-  {
-  protected:
+                    ADMColorSpaceFull(ADMColorSpace_algo algo, uint32_t sw, uint32_t sh, uint32_t dw,uint32_t dh,ADM_colorspace from,ADM_colorspace to);
+    bool            reset(ADMColorSpace_algo, uint32_t sw, uint32_t sh, uint32_t dw,uint32_t dh,ADM_colorspace from,ADM_colorspace to);
     
-  public:
-                ColYv12Rgb24(uint32_t w, uint32_t h) : ColBase(w,h) {};
-                ~ColYv12Rgb24(){clean();};
-      virtual  uint8_t reset(uint32_t neww, uint32_t newh);
-      virtual  uint8_t scale(uint8_t *src, uint8_t *target);     
-      
-  };
-//*************************************
-class COL_Generic2YV12 
+
+    bool            convert(uint8_t  *from, uint8_t *to);
+    bool            convertPlanes(uint32_t  sourceStride[3],uint32_t destStride[3],     
+                                  uint8_t   *sourceData[3], uint8_t *destData[3]);
+                    ~ADMColorSpaceFull();
+};
+/**
+    \class ADMColorSpaceSimple
+    \brief Same as Full but target & source width/height are the same
+*/
+class ADMColorSpaceSimple :public ADMColorSpaceFull
 {
-protected:
-                void        *_context;
-                uint32_t    w,h;  
-                uint8_t     clean(void);
-                ADM_colorspace _colorspace;
-                uint32_t       _backward;
-    
 public:
-        
-                COL_Generic2YV12(uint32_t w, uint32_t h,ADM_colorspace) ;
-                ~COL_Generic2YV12(){clean();};
-                uint8_t transform(uint8_t **planes, uint32_t *strides,uint8_t *target);
-                
-}; 
+    bool            changeWidthHeight(uint32_t newWidth, uint32_t newHeight);
+                    ADMColorSpaceSimple( uint32_t width, uint32_t height, ADM_colorspace from,ADM_colorspace to,ADMColorSpace_algo algo=ADM_CS_BICUBIC):
+                        ADMColorSpaceFull(algo, width, height, width,height, from, to)
+                     {
+
+                     }
+};
+
+// Some misc functions
+bool ADM_ConvertRgb24ToYV12(bool inverted,uint32_t w, uint32_t h, uint8_t *source, uint8_t *destination);
 #endif
 //EOF
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp	2010-04-05 18:05:44 UTC (rev 6053)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp	2010-04-05 18:05:50 UTC (rev 6054)
@@ -53,18 +53,41 @@
     case ADM_COLOR_YV12: return PIX_FMT_YUV420P;
     case ADM_COLOR_YUV422P: return PIX_FMT_YUV422P;
     case ADM_COLOR_RGB32A: return PIX_FMT_RGB32;
+    case ADM_COLOR_BGR32A: return PIX_FMT_BGR32;
+    case ADM_COLOR_RGB24: return PIX_FMT_RGB24;
     default : ADM_assert(0); 
   }
   return PIX_FMT_YUV420P;
 }
 /**
       \fn getStrideAndPointers
+      \param dst=1 -> destination, =0 source
       \brief Fill in strides etc.. needed by libswscale
 */
-uint8_t ADMColorspace::getStrideAndPointers(uint8_t  *from,ADM_colorspace fromColor,uint8_t **srcData,int *srcStride)
+uint8_t ADMColorSpaceFull::getStrideAndPointers(bool dst,
+        uint8_t  *from,ADM_colorspace fromColor,
+        uint8_t **srcData,int *srcStride)
 {
+    uint32_t width,height;
+    if(!dst)
+    {
+        width=srcWidth;
+        height=srcHeight;
+    }else
+    {
+        width=dstWidth;
+        height=dstHeight;
+    }
   switch(fromColor)
   {
+    case ADM_COLOR_RGB24:
+            srcData[0]=from;
+            srcData[1]=NULL;
+            srcData[2]=NULL;
+            srcStride[0]=width*3;
+            srcStride[1]=0;
+            srcStride[2]=0;
+            break;
     case  ADM_COLOR_YV12:
             srcData[0]=from;
             srcData[1]=from+width*height;
@@ -89,6 +112,14 @@
             srcStride[1]=0;
             srcStride[2]=0;
             break;
+    case ADM_COLOR_BGR32A:
+            srcData[0]=from;
+            srcData[1]=NULL;
+            srcData[2]=NULL;
+            srcStride[0]=width*4;
+            srcStride[1]=0;
+            srcStride[2]=0;
+            break;
     default:
         ADM_assert(0);
   }
@@ -101,21 +132,32 @@
   @param to Target image
 */
 
-uint8_t ADMColorspace::convert(uint8_t  *from, uint8_t *to)
+bool ADMColorSpaceFull::convert(uint8_t  *from, uint8_t *to)
 {
   uint8_t *srcData[3];
   uint8_t *dstData[3];
   int srcStride[3];
   int dstStride[3];
   
-  getStrideAndPointers(from,fromColor,srcData,srcStride);
-  getStrideAndPointers(to,toColor,dstData,dstStride);
-  sws_scale(CONTEXT,srcData,srcStride,0,height,dstData,dstStride);
-  return 1;
+  getStrideAndPointers(false,from,fromColor,srcData,srcStride);
+  getStrideAndPointers(true,to,toColor,dstData,dstStride);
+  sws_scale(CONTEXT,srcData,srcStride,0,srcHeight,dstData,dstStride);
+  return true;
   
 }
-
 /**
+    \fn convertPlanes
+    \brief Same as convert but the 3 planes are given separately
+*/
+bool            ADMColorSpaceFull::convertPlanes(uint32_t  sourceStride[3],uint32_t destStride[3],     
+                                  uint8_t   *sourceData[3], uint8_t *destData[3])
+{
+    int xs[3]={sourceStride[0],sourceStride[1],sourceStride[2]};
+    int xd[3]={destStride[0],destStride[1],destStride[2]};
+     sws_scale(CONTEXT,sourceData,xs,0,srcHeight,destData,xd);
+     return true;
+}
+/**
     \fn  ADMColorspace
     \brief Constructor
   @param w width
@@ -124,37 +166,76 @@
   @param to colorspace to concert to
 */
 
-ADMColorspace::ADMColorspace(uint32_t w, uint32_t h, ADM_colorspace from,ADM_colorspace to)
+ADMColorSpaceFull::ADMColorSpaceFull(ADMColorSpace_algo algo,
+            uint32_t sw, uint32_t sh,
+            uint32_t dw, uint32_t dh,
+            ADM_colorspace from,ADM_colorspace to)
 {
-  int flags=SWS_BICUBLIN;
-  FLAGS();
+   context=NULL;
+   reset(algo,sw,sh,dw,dh,from,to);
+
+}
+/**
+    \fn  ~ADMColorspace
+    \brief Destructor
+*/
+ADMColorSpaceFull::~ADMColorSpaceFull()
+{
+  if(context)
+  {
+     sws_freeContext(CONTEXT);
+     context=NULL;
+  }
+}
+/**
+    \fn reset
+*/
+bool  ADMColorSpaceFull::reset(ADMColorSpace_algo, uint32_t sw, uint32_t sh, uint32_t dw,uint32_t dh,ADM_colorspace from,ADM_colorspace to)
+{
+    if(context) sws_freeContext(CONTEXT);
+    context=NULL;
+    this->algo=algo;
+    int flags=SWS_BICUBLIN;
+#warning SET algo!
+    FLAGS();
   
-    width=w;
-    height=h;
+    srcWidth=sw;
+    srcHeight=sh;
+
+    dstWidth=dw;
+    dstHeight=dh;
+
     fromColor=from;
     toColor=to;
     PixelFormat lavFrom=ADMColor2LAVColor(fromColor);
     PixelFormat lavTo=ADMColor2LAVColor(toColor);
     
     context=(void *)sws_getContext(
-                      width,height,
+                      srcWidth,srcHeight,
                       lavFrom ,
-                      width,height,
+                      dstWidth,dstHeight,
                       lavTo,
                       flags, NULL, NULL,NULL);
+}
+//------------------------------
+bool            ADMColorSpaceSimple::changeWidthHeight(uint32_t newWidth, uint32_t newHeight)
+{
+    if(newWidth==srcWidth && newHeight==srcHeight) return true; // no change
+    
+     return reset(algo, newWidth,newHeight, newWidth,newHeight,fromColor,toColor);
 
 }
+
+
 /**
-    \fn  ~ADMColorspace
-    \brief Destructor
+    \fn ADM_ConvertRgb24ToYV12
 */
-ADMColorspace::~ADMColorspace()
+bool ADM_ConvertRgb24ToYV12(bool inverted,uint32_t w, uint32_t h, uint8_t *source, uint8_t *destination) 
 {
-  if(context)
-  {
-     sws_freeContext(CONTEXT);
-     context=NULL;
-  }
+    ADMColorSpaceSimple  converter( w,h,ADM_COLOR_RGB24,ADM_COLOR_YV12);
+    return converter.convert(source,destination);
+    
+
+
 }
- 
 //EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageSave.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageSave.cpp	2010-04-05 18:05:44 UTC (rev 6053)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageSave.cpp	2010-04-05 18:05:50 UTC (rev 6054)
@@ -11,6 +11,27 @@
 {
 #include "ADM_lavcodec.h"
 }
+/**
+    \fn SwapMe
+*/
+static inline void SwapMe(uint8_t *tgt,uint8_t *src,int nb);
+void SwapMe(uint8_t *tgt,uint8_t *src,int nb)
+{
+    uint8_t r,g,b;
+   nb=nb;
+   while(nb--)
+   {
+       r=*src++;
+       g=*src++;
+       b=*src++;
+       *tgt++=r;
+       *tgt++=g;
+       *tgt++=b;
+       
+   }
+   return;
+    
+}
 
 /**
     \fn saveAsBmp
@@ -61,13 +82,24 @@
 //            ADM_dealloc(out);
             return 0;
         }
+        ADMColorSpaceSimple converter(bmph.biWidth, bmph.biHeight, ADM_COLOR_YV12,ADM_COLOR_BGR24);
 
-        if(!COL_yv12rgbBMP(bmph.biWidth, bmph.biHeight,data, out))
-        {
-              GUI_Error_HIG(QT_TR_NOOP("Error converting to BMP"), NULL);
-              ADM_dealloc(out);
-              return 0;
+        uint32_t ww=bmph.biWidth;
+        uint32_t hh=bmph.biHeight;
+        uint8_t swap[ww*3];
+        
+        uint8_t *up=out;
+        uint8_t *down=out+(hh-1)*ww*3;
+        
+        for(int y=0;y<hh>>1;y++)
+        {
+            SwapMe(swap,up,ww); 
+            SwapMe(up,down,ww);
+            memcpy( down,swap,ww*3);
+            down-=3*ww;
+            up+=3*ww;
         }
+
         fd = ADM_fopen (filename, "wb");
         if (!fd)
         {

Deleted: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_rgb.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_rgb.cpp	2010-04-05 18:05:44 UTC (rev 6053)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_rgb.cpp	2010-04-05 18:05:50 UTC (rev 6054)
@@ -1,598 +0,0 @@
-/***************************************************************************
-                         ADM_Rgb : wrapper for yv12->RGB display
-                            using mplayer postproc
-
-
-    begin                : Thu Apr 16 2003
-    copyright            : (C) 2002 by mean
-    email                : fixounet at free.fr
-    
- 16 08 2007 : Removed the manual RGB<->BGR, newer swscale can output directly in the correct mode   
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-
-#include "ADM_default.h"
-#include "ADM_colorspace.h"
-
-extern "C" {
-#include "ADM_ffmpeg/libavcodec/avcodec.h"
-#include "ADM_ffmpeg/libavutil/avutil.h"
-#include "ADM_ffmpeg/libswscale/swscale.h"
-}
-
-	
-#include "ADM_rgb.h" 
-
-#define CLEANUP() \
-    if(_context) \
-    {\
-        if(ww==w && hh==h)\
-           return 1; \
-        clean();  \
-    }
-
-#ifdef ADM_CPU_X86
-		#define ADD(x,y) if( CpuCaps::has##x()) flags|=SWS_CPU_CAPS_##y;
-#define FLAGS()		ADD(MMX,MMX);				ADD(3DNOW,3DNOW);		ADD(MMXEXT,MMX2);
-#else
-#ifdef ADM_CPU_ALTIVEC
-#define FLAGS() flags|=SWS_CPU_CAPS_ALTIVEC;
-#else
-#define FLAGS()
-#endif
-#endif
-
-#define TARGET_COLORSPACE       PIX_FMT_RGB32 
-#define ALTERNATE_COLORSPACE    PIX_FMT_BGR32
-
- //***********************************************
- ColBase::ColBase(uint32_t ww, uint32_t hh)
- {
-      _context=NULL;
-      w=0xfffff;
-      h=0xfffff;
-      //reset(ww,hh);   
- }
- ColBase::~ColBase()
- {
-    clean();   
- }
- //***********************************************
- uint8_t ColBase::clean(void)
- {
-        if(_context)
-		{
-			sws_freeContext((SwsContext *)_context);
-		}
-		_context=NULL; 
-		return 1;  
- }
- //***********************************************
- uint8_t ColYuvRgb::reset(uint32_t ww, uint32_t hh)
- {
- int flags=0;
-	
-    CLEANUP();
-    FLAGS();
-    flags|=SWS_BILINEAR;
-    PixelFormat fmt=TARGET_COLORSPACE;
-    if(_inverted) fmt=ALTERNATE_COLORSPACE;
-    if(!ww || !hh) return 0;
-
-	if (_context)
-		sws_freeContext((SwsContext *)_context);
-
-	 _context=(void *)sws_getContext(
-                      ww,hh,
-                      PIX_FMT_YUV420P ,
-                      ww,hh,
-                      fmt,
-                      flags, NULL, NULL,NULL);
-
-    if(!_context) ADM_assert(0);
-    w=ww;
-    h=hh;
-    return 1;
-}
-/**
-      \fn invertRGB
-      \brief Do RGBA->BGRA swap
-      howmuch is in pixel, i.e. you have to multiply it by 4 to get the nb of bytes!
-*/
-static void ADM_RGBA2BGRA(uint8_t *ptr, uint32_t howmuch)
-{
-#ifdef ADM_CPU_X86
-    __asm__(
-                        "1: mov            (%0),%%eax \n"
-                        "bswap          %%eax \n"
-                        "rorl           $8,%%eax \n"
-                        "mov            %%eax,(%0) \n"
-                        "add            $4,%0 \n"
-                        "dec            %1 \n"
-                        "jne            1b\n"
-                :  :"r" (ptr),"r" (howmuch)
-                : "%eax"
-                
-      
-                );
-#else
-uint8_t r,g,b,a;
-                  for(int xx=0;xx<howmuch;xx++)
-                  {
-                      r=ptr[0];
-                      g=ptr[1];
-                      b=ptr[2];
-                      a=ptr[3];
-                      ptr[0]=b;
-                      ptr[1]=g;
-                      ptr[2]=r;
-                      ptr[3]=a;
-                      ptr+=4;
-                  }
-#endif
-}
-/**
-      \fn scale
-      \brief Do the actual colorconversion
-
-*/
- uint8_t ColYuvRgb::scale(uint8_t *src, uint8_t *target)
- {
-    uint8_t *srd[3];
-	uint8_t *dst[3];
-	int ssrc[3];
-	int ddst[3];
-
-	ADM_assert(_context);
-	
-			uint32_t page;
-
-			page=w*h;
-			srd[0]=src;
-			srd[1]=src+page;
-			srd[2]=src+((page*5)>>2);
-
-			ssrc[0]=w;
-			ssrc[1]=ssrc[2]=w>>1;
-
-			
-			dst[0]=target;
-			dst[1]=NULL;
-			dst[2]=NULL;
-			ddst[0]=w*4;
-			ddst[1]=ddst[2]=0;
-
-			sws_scale((SwsContext *)_context,srd,ssrc,0,h,dst,ddst);
-#if 0
-        if(_inverted)
-        {
-                uint8_t r,g,b,a;
-                uint8_t *ptr=target;
-                int pel=h*w;
-                ADM_RGBA2BGRA(ptr,pel);
-        }
-#endif
-#if  defined( ADM_BIG_ENDIAN)
-	if (!_inverted)
-	{
-        uint8_t r,g,b,a;
-        uint8_t *ptr=target;
-        int pel=h*w;
-        for(int yy=0;yy<pel;yy++)
-        {
-              r=ptr[0];
-              g=ptr[1];
-              b=ptr[2];
-              a=ptr[3];
-              ptr[0]=a;
-              ptr[1]=b;
-              ptr[2]=g;
-              ptr[3]=r;
-              ptr+=4;
-        }
-	}
-#endif
-     
-        return 1;
- }
-
-/**
-      \fn scale
-      \brief Change colorspace but and put result in the target image , which is bigger
-        Normally not used !
-*/
- uint8_t ColYuvRgb::scale(uint8_t *src, uint8_t *target,uint32_t startx,uint32_t starty, uint32_t tw,uint32_t th,uint32_t totalW,uint32_t totalH)
- {
-    uint8_t *srd[3];
-    uint8_t *dst[3];
-    int ssrc[3];
-    int ddst[3];
-
-    ADM_assert(_context);
-    
-    uint32_t page;
-
-    page=tw*th;
-    srd[0]=src;
-    srd[1]=src+page;
-    srd[2]=src+((page*5)>>2);
-
-    ssrc[0]=tw;
-    ssrc[1]=ssrc[2]=tw>>1;
-
-    
-    dst[0]=target+(startx*4)+starty*totalW*4;
-    dst[1]=NULL;
-    dst[2]=NULL;
-    ddst[0]=totalW*4;
-    ddst[1]=ddst[2]=0;
-
-    sws_scale((SwsContext *)_context,srd,ssrc,0,th,dst,ddst);
-#if 0
-    if(_inverted)
-    {
-            uint8_t r,g,b,a;
-            uint8_t *ptr=NULL;
-            int pel=th;
-            for(int yy=0;yy<th;yy++)
-            {
-              ptr=target+(startx*4)+(starty+yy)*totalW*4;;
-              ADM_RGBA2BGRA(ptr,tw);
-            }
-     }
-#endif
-
-#if defined(ADM_BIG_ENDIAN)
-     uint8_t r, g, b, a;
-     uint8_t *ptr = target;
-     int pel = h * w;
-
-     for (int yy = 0; yy < th; yy++)
-     {
-          ptr = target + (startx * 4) + (starty + yy) * totalW * 4;
-          ADM_RGBA2BGRA(ptr, tw);
-     }
-#endif
-
-     return 1;
- }
-
- 
- 
-//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-uint8_t ColYv12Rgb24::reset(uint32_t ww, uint32_t hh)
- {
- int flags=0;
-	CLEANUP();
-    FLAGS();
-    flags|=SWS_BILINEAR;
-   if(!ww || !hh) return 0;
-
-	if (_context)
-		sws_freeContext((SwsContext *)_context);
-
-	 _context=(void *)sws_getContext(
-				    		ww,hh,
-						PIX_FMT_YUV420P ,
-		 				ww,hh,
-	   					PIX_FMT_RGB24,
-	    					flags, NULL, NULL,NULL);
-
-    if(!_context) ADM_assert(0);
-    w=ww;
-    h=hh;
-    return 1;
-}
-  uint8_t ColYv12Rgb24::scale(uint8_t *src, uint8_t *target)
- {
-    uint8_t *srd[3];
-	uint8_t *dst[3];
-	int ssrc[3];
-	int ddst[3];
-
-	ADM_assert(_context);
-	
-			uint32_t page;
-
-			page=w*h;
-			srd[0]=src;
-			srd[1]=src+page;
-			srd[2]=src+((page*5)>>2);
-
-			ssrc[0]=w;
-			ssrc[1]=ssrc[2]=w>>1;
-
-			
-			dst[0]=target;
-			dst[1]=NULL;
-			dst[2]=NULL;
-			ddst[0]=w*3;
-			ddst[1]=ddst[2]=0;
-			
-			sws_scale((SwsContext *)_context,srd,ssrc,0,h,dst,ddst);
-     
-        return 1;
- }
-//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
- uint8_t ColRgbToYV12::reset(uint32_t ww, uint32_t hh)
- {
- int flags=0;
- int c;	
-    clean();
-    FLAGS();
-    flags|=SWS_BILINEAR;
-    switch(_colorspace)
-    {
-                case ADM_COLOR_RGB24:c=PIX_FMT_RGB24;break;
-                case ADM_COLOR_RGB32A:c=TARGET_COLORSPACE;break;
-                case ADM_COLOR_RGB16:c=PIX_FMT_RGB565;break;
-                default: ADM_assert(0);
-    }
-
-	if (_context)
-		sws_freeContext((SwsContext *)_context);
-
-         _context=(void *)sws_getContext(
-				    		ww,hh,
-						(PixelFormat)c ,
-		 				ww,hh,
-	   					PIX_FMT_YUV420P,
-	    					flags, NULL, NULL,NULL);
-
-    if(!_context) ADM_assert(0);
-    w=ww;
-    h=hh;
-    return 1;
-}
-uint8_t ColRgbToYV12::setBmpMode(void)
-{
-        _bmpMode=1;
-        return 1;
-}
-
-//***********************************************
- uint8_t ColRgbToYV12::scale(uint8_t *src, uint8_t *target)
- {
-    uint8_t *srd[3];
-        uint8_t *dst[3];
-        int ssrc[3];
-        int ddst[3];
-        int mul=0;
-
-        ADM_assert(_context);
-
-        uint32_t page;
-
-        page=w*h;
-        srd[0]=src;
-        srd[1]=0;
-        srd[2]=0;
-
-        switch(_colorspace)
-        {
-                case ADM_COLOR_RGB16:  mul=2;
-                        break;
-                case ADM_COLOR_RGB24:  mul=3;
-                        break;
-                case ADM_COLOR_RGB32A:  mul=4;
-                        break;
-        }
-        ssrc[0]=mul*w;
-        ssrc[1]=0;
-        ssrc[2]=0;
-
-        dst[0]=target;
-        dst[1]=target+page;
-        dst[2]=target+((page*5)>>2);
-        ddst[0]=w;
-        ddst[1]=ddst[2]=w>>1;
-        if(_bmpMode)
-        {
-                ssrc[0]=-mul*w;
-                srd[0]=src+mul*w*(h-1);
-                dst[2]=target+page;
-                dst[1]=target+((page*5)>>2);
-        }
-
-
-        sws_scale((SwsContext *)_context,srd,ssrc,0,h,dst,ddst);
-     
-        return 1;
- }
- uint8_t ColRgbToYV12::changeColorSpace(ADM_colorspace col)
- {
-int z;
-    
-    z=(int)col;
-    _backward=!!(z & ADM_COLOR_BACKWARD);
-    z&=~ADM_COLOR_BACKWARD;
-    _colorspace= (ADM_colorspace) z;
-       
- }
- //*************************
-static inline void SwapMe(uint8_t *tgt,uint8_t *src,int nb);
-void SwapMe(uint8_t *tgt,uint8_t *src,int nb)
-{
-    uint8_t r,g,b;
-   nb=nb;
-   while(nb--)
-   {
-       r=*src++;
-       g=*src++;
-       b=*src++;
-       *tgt++=r;
-       *tgt++=g;
-       *tgt++=b;
-       
-   }
-   return;
-    
-}
-//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
- uint8_t  COL_yv12rgbBMP(uint32_t ww, uint32_t hh, uint8_t* in, uint8_t *out)
-{
-     ColYv12Rgb24 rgb(ww,hh);
-     
-        rgb.reset(ww,hh);
-        rgb.scale(in,out);
-        // Now time to swap it
-        uint8_t swap[ww*3];
-        
-        uint8_t *up=out;
-        uint8_t *down=out+(hh-1)*ww*3;
-        
-        for(int y=0;y<hh>>1;y++)
-        {
-            SwapMe(swap,up,ww); 
-            SwapMe(up,down,ww);
-            memcpy( down,swap,ww*3);
-            down-=3*ww;
-            up+=3*ww;
-        }
-        
-        return 1;
-     
-}
-//***************************************************
-//***************************************************
-//***************************************************
-//***************************************************
-//***************************************************
-//***************************************************
-
-COL_Generic2YV12::COL_Generic2YV12(uint32_t ww, uint32_t hh,ADM_colorspace col)
-{
-int flags=0;
-int c=0; 
-
-        FLAGS();
-        flags|=SWS_BILINEAR;
-        _context=NULL;
-        w=ww;
-        h=hh;
-        _colorspace=(ADM_colorspace)(col & ADM_COLOR_MASK);
-        _backward= !!(col & ADM_COLOR_BACKWARD);
-      
- 
-    switch(_colorspace)
-    {
-     
-                case ADM_COLOR_BGR24:c=PIX_FMT_BGR24;break;
-                case ADM_COLOR_RGB24:c=PIX_FMT_RGB24;break;
-                case ADM_COLOR_RGB555:c=PIX_FMT_RGB555;break;
-                case ADM_COLOR_BGR555:c=PIX_FMT_BGR555;break;
-                case ADM_COLOR_BGR32A:c=PIX_FMT_BGR32;break;
-                case ADM_COLOR_RGB32A:c=TARGET_COLORSPACE;break;
-                case ADM_COLOR_RGB16:c=PIX_FMT_RGB565;break;
-                case ADM_COLOR_YUV411:c=PIX_FMT_YUV411P;break;
-				case ADM_COLOR_YUV422:c=PIX_FMT_YUV422P;break;
-				case ADM_COLOR_YUV444:c=PIX_FMT_YUV444P;break;
-                default: ADM_assert(0);
-    }
-         _context=(void *)sws_getContext(
-                                                ww,hh,
-                                                (PixelFormat)c ,
-                                                ww,hh,
-                                                PIX_FMT_YUV420P,
-                                                flags, NULL, NULL,NULL);
-
-    if(!_context) ADM_assert(0);
-}
-
-uint8_t COL_Generic2YV12::clean(void)
-{
-        if(_context)
-                {
-                        sws_freeContext((SwsContext *)_context);
-                }
-                _context=NULL; 
-                return 1;  
-}
-
-uint8_t COL_Generic2YV12::transform(uint8_t **planes, uint32_t *strides,uint8_t *target)
-{
-	uint8_t *srd[3];
-	uint8_t *dst[3];
-	int ssrc[3];
-	int ddst[3];
-	int mul = 0;
-	uint32_t page = w * h;
-
-	ADM_assert(_context);
-
-	if(_colorspace & ADM_COLOR_IS_YUV)
-	{
-		srd[0] = planes[0];
-		srd[1] = planes[2];
-		srd[2] = planes[1];
-		ssrc[0] = strides[0];
-		ssrc[1] = strides[2];
-		ssrc[2] = strides[1];
-
-		dst[0] = target;
-		dst[2] = target + page;
-		dst[1] = target + ((page * 5) >> 2);
-		ddst[0] = w;
-		ddst[1] = ddst[2] = w >> 1;
-
-		sws_scale((SwsContext *)_context, srd, ssrc, 0, h, dst, ddst);
-
-		return 1;
-	}
-
-	// Else RGB colorspace
-	switch (_colorspace & 0x7FFF)
-	{
-		case ADM_COLOR_RGB16:
-		case ADM_COLOR_RGB555:
-		case ADM_COLOR_BGR555:
-			mul = 2;
-			break;
-		case ADM_COLOR_BGR24:
-		case ADM_COLOR_RGB24:
-			mul = 3;
-			break;
-		case ADM_COLOR_BGR32A:
-		case ADM_COLOR_RGB32A:
-			mul = 4;
-			break;
-		default:
-			ADM_assert(0);
-	}
-
-	srd[0] = planes[0];
-	srd[1] = srd[2] = 0;
-	ssrc[0] = mul * w;
-	ssrc[1] = ssrc[2] = 0;
-
-	if(strides && strides[0] > ssrc[0])
-		ssrc[0] = strides[0];
-
-	dst[0] = target;
-	dst[2] = target + page;
-	dst[1] = target + ((page * 5) >> 2);
-	ddst[0] = w;
-	ddst[1] = ddst[2] = w >> 1;
-
-	if(_backward)
-	{
-		ssrc[0] = -mul * w;
-		srd[0] = planes[0] + mul * w * (h - 1);
-	}
-
-	sws_scale((SwsContext *)_context, srd, ssrc, 0, h, dst, ddst);
-
-	return 1;
-}
-//EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/CMakeLists.txt	2010-04-05 18:05:44 UTC (rev 6053)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/CMakeLists.txt	2010-04-05 18:05:50 UTC (rev 6054)
@@ -3,10 +3,10 @@
         ADM_image.cpp  
         ADM_imageUtils.cpp
         ADM_imageResizer.cpp
-        yuv.cpp
-        rgb2yuv.cpp
+#        yuv.cpp
+#        rgb2yuv.cpp
         ADM_colorspace.cpp
-        ADM_rgb.cpp
+#        ADM_rgb.cpp
         ADM_pp.cpp
         ADM_print.cpp
         #ADM_vidFieldUtil.cpp

Deleted: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/rgb2yuv.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/rgb2yuv.cpp	2010-04-05 18:05:44 UTC (rev 6053)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/rgb2yuv.cpp	2010-04-05 18:05:50 UTC (rev 6054)
@@ -1,278 +0,0 @@
-
-/***************************************************************************
-                          yv.cpp  -  description
-                             -------------------
-
-	Convert a RGB triplet to its YUV conterpart
-
-    begin                : Wed Aug 12 2003
-    copyright            : (C) 2003 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include <math.h>
-
-
-#include "ADM_default.h"
-
-
-extern "C" {
-#include "ADM_ffmpeg/libavcodec/avcodec.h"
-#include "ADM_ffmpeg/libswscale/swscale.h"
-}
-
-#include "ADM_colorspace.h"
-
-/**
-	This is unoptimized because seldom called
-*/
-uint8_t COL_RgbToYuv(uint8_t R,uint8_t G,uint8_t B, uint8_t *y,int8_t *u,int8_t *v)
-{
-
-	float rr=R,bb=B,gg=G;
-	float yy,uu,vv;
-
-	yy=0.299*rr+ 		0.587*gg+ 	0.114*bb;
-	uu=-0.169*rr+ 	-0.331*gg+  	0.5*bb;
-	vv=0.5*rr+ 		-0.419*gg+ 	-0.081*bb;
-
-
-	if(uu>127) uu=127;
-	if(uu<-127) uu=-127;
-	*u=(int8_t)floor(uu);
-
-	if(vv>127) vv=127;
-	if(vv<-127) vv=-127;
-	*v=(int8_t)floor(vv);
-
-	if(yy>255) yy=255;
-	if(yy<0) yy=0;
-	*y=(uint8_t)floor(yy);
-
-	return 1;
-
-}
-static inline uint8_t PixelClip(int16_t in)
-{
-    if (in > 255)
-	in = 255;
-   if(in<0)
-   	in=0;
-    return (uint8_t) in;
-};
-
-			   	   
-static inline unsigned char ScaledPixelClip(long  i)
-{
-    return PixelClip(((i +32768) >> 16)); //  + 32768
-};
-
-//0.299	0.587	0.114
-const long int cyb = 6416; //int(0.114*219*65536/255+0.5);
-const long int cyg = 33038; //int(0.587*219*65536/255+0.5);
-const long int cyr = 16828; //int(0.299*219*65536/255+0.5);
-
-uint8_t COL_RawRGB32toYV12(uint8_t *data1,uint8_t *data2, uint8_t *oy,uint8_t *oy2, 
-				uint8_t *u, uint8_t *v,uint32_t lineSize,uint32_t height,uint32_t stride)
-{
-
-
-long int y1,y2;
-long int y3,y4;
-long int scaled_y,b_y;
-long int scaled_y2,b_y2;
-long int r_y,r_y2;  
-
-uint8_t *org1,*org2;
-/*
-0 2 1
-2 6 0
-1 5 3
-3 7 1
-*/
-#define B0 2
-#define R0 0
-#define M0 1
-
-#define M1 (M0+4)
-#define B1 (B0+4)
-#define R1 (R0+4)
-#define LEFT 0x108000
-
-//	printf("w %d h %d stride %d\n",lineSize,height,stride);
-	org1=data1;
-	org2=data2;
-	
-	long int alpha,beta,gamma;
-	
-    for(uint32_t yy=0;yy<(height>>1);yy++)
-    {
-    	data1=org1;
-	data2=org2;
-      for (uint32_t x=0;x<(lineSize>>1);x++)
-      {
-      
-#define MK1(source,out,row ) \
-       alpha=source[B##row]; \
-       alpha*=cyb; \
-       beta=source[M##row]; \
-       beta*=cyg; \
-       gamma=source[R##row]; \
-       gamma*=cyr;        \
-       out=(gamma+alpha+beta+LEFT)>>16; 
-      
-        
-       //y1 = (cyb*(long int)data1[B0] + cyg*(long int)data1[M0] + cyr*(long int)data1[R0] +LEFT) >> 16;
-        MK1(data1,y1,0);
-        oy[0] = y1;
-        //y2 = (cyb*(long int)data1[B1] + cyg*(long int)data1[M1] + cyr*(long int)data1[R1] +LEFT) >> 16;
-	MK1(data1,y2,1);
-        oy[1] = y2;
-	
-	//y3 = (cyb*(long int)data2[B0] + cyg*(long int)data2[M0] + cyr*(long int)data2[R0] +LEFT) >> 16;
-	MK1(data2,y3,0);
-        oy2[0] = y3;
-	
-        //y4 = (cyb*(long int)data2[B1] + cyg*(long int)data2[M1] + cyr*(long int)data2[R1] +LEFT) >> 16;
-	MK1(data2,y4,1);
-        oy2[1] = y4;
-
-
-        scaled_y = (y1+y2 - 32) * 38155;
-	scaled_y2 = (y3+y4 - 32) * 38155;
-	
-        b_y = ((data1[B0]+data1[B1]) << 15) - scaled_y;
-	b_y2 = ((data2[B0]+data2[B1]) << 15) - scaled_y2;
-	
-	b_y=(b_y+b_y2)/2;
-	
-        u[0] = ScaledPixelClip((b_y >> 10)*int(1/2.018*1024+0.5) + 0x800000);  // u * int(1/2.018*1024+0.5)
-        
-	r_y = ((data1[R0]+data1[R1]) << 15) - scaled_y;
-	r_y2 = ((data2[R0]+data2[R1]) << 15) - scaled_y2;
-	r_y=(r_y+r_y2)/2;
-	
-        v[0] = ScaledPixelClip((r_y >> 10)* int(1/1.596*1024+0.5) + 0x800000);  // v* int(1/1.596*1024+0.5)
-	
-	//u[0]=128;
-	//v[0]=128;
-        
-	oy+=2;
-	oy2+=2;
-	u++;
-	v++;
-	data1+=8;
-	data2+=8;
-      }
-     	org2+=2*stride;
-      	org1+=2*stride;
-	oy+=lineSize;
-	oy2+=lineSize;	
-     }
-      
-  return 1;
-}
-uint8_t COL_YuvToRgb( uint8_t y,int8_t u,int8_t v,uint8_t *r,uint8_t *g,uint8_t *b)
-{
-
-	float rr,bb,gg;
-	float yy=y,uu=u,vv=v;
-
-	rr=	yy+			 	1.402*vv;
-	gg= yy+ 	-0.344*uu+  	-0.714*vv;
-	bb=	yy+ 	1.772*uu 	 		;
-
-	#define CLIP(x) if(x>255) x=255; else if (x<0) x=0;x=x+0.49;
-	#define CVT(x,y) CLIP(x);*y=(uint8_t)floor(x);
-
-	CVT(rr,r);
-	CVT(gg,g);
-	CVT(bb,b);
-
-	return 1;
-
-}
-/**
- * 		\fn COL_RGB24_to_YV12
- *		\brief Convert RGB to YV12 using swscale
- */
-uint8_t COL_RGB24_to_YV12_revert(uint32_t w,uint32_t h,uint8_t *rgb, uint8_t *yuv)
-{
-	int flags = SWS_SPLINE;
-	struct SwsContext *context=NULL;
-	
-	#ifdef ADM_CPU_X86
-		#define ADD(x, y) if (CpuCaps::has##x()) flags |= SWS_CPU_CAPS_##y;
-
-		ADD(MMX,MMX);
-		ADD(3DNOW,3DNOW);
-		ADD(MMXEXT,MMX2);
-	#endif
-
-	#ifdef ADM_CPU_ALTIVEC
-	    flags |= SWS_CPU_CAPS_ALTIVEC;
-	#endif
-	    context = sws_getContext(w, h,
-	    									  PIX_FMT_RGB24,
-	    									  w, h,
-	    									  PIX_FMT_YUV420P,
-	    									  flags, NULL, NULL,NULL);
-	    ADM_assert(context);
-	
-	    uint8_t *src[3]={rgb+w*h*3-w*3,NULL,NULL};
-	    int srcStride[3]={-w*3,0,0};
-	    int dstStride[3]={w,w>>1,w>>1};
-	    uint8_t *dst[3]={yuv,yuv+w*h,yuv+((w*h*5)>>2)};
-//	    int sws_scale(struct SwsContext *context, uint8_t* src[], int srcStride[], int srcSliceY,
-//	                  int srcSliceH, uint8_t* dst[], int dstStride[]);	    
-	    sws_scale(context, src, srcStride, 0, h, dst, dstStride);
-	    
-		sws_freeContext(context);
-}
-/**
- * 		\fn COL_RGB24_to_YV12
- *		\brief Convert RGB to YV12 using swscale
- */
-uint8_t COL_RGB24_to_YV12(uint32_t w,uint32_t h,uint8_t *rgb, uint8_t *yuv)
-{
-	int flags = SWS_SPLINE;
-	struct SwsContext *context=NULL;
-	
-	#ifdef ADM_CPU_X86
-		#define ADD(x, y) if (CpuCaps::has##x()) flags |= SWS_CPU_CAPS_##y;
-
-		ADD(MMX,MMX);
-		ADD(3DNOW,3DNOW);
-		ADD(MMXEXT,MMX2);
-	#endif
-
-	#ifdef ADM_CPU_ALTIVEC
-	    flags |= SWS_CPU_CAPS_ALTIVEC;
-	#endif
-	    context = sws_getContext(w, h,
-	    									  PIX_FMT_RGB24,
-	    									  w, h,
-	    									  PIX_FMT_YUV420P,
-	    									  flags, NULL, NULL,NULL);
-	    ADM_assert(context);
-	
-	    uint8_t *src[3]={rgb,NULL,NULL};
-	    int srcStride[3]={w*3,0,0};
-	    int dstStride[3]={w,w>>1,w>>1};
-	    uint8_t *dst[3]={yuv,yuv+((w*h*5)>>2),yuv+w*h};
-//	    int sws_scale(struct SwsContext *context, uint8_t* src[], int srcStride[], int srcSliceY,
-//	                  int srcSliceH, uint8_t* dst[], int dstStride[]);	    
-	    sws_scale(context, src, srcStride, 0, h, dst, dstStride);
-	    
-		sws_freeContext(context);
-}
-//EOF

Deleted: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/yuv.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/yuv.cpp	2010-04-05 18:05:44 UTC (rev 6053)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/yuv.cpp	2010-04-05 18:05:50 UTC (rev 6054)
@@ -1,113 +0,0 @@
-
-/***************************************************************************
-                          yv.cpp  -  description
-                             -------------------
-
-Convert yv422/yuv411 to YV12
-
-Not optimised for speed at all, should take the one from ffmpeg
-
-    begin                : Wed Apr 19 2003
-    copyright            : (C) 2003 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-
-#include "ADM_default.h"
-#include "ADM_ffmpeg/libavcodec/colorspace.h"
-
-uint8_t COL_422_YV12( uint8_t *in[3], uint32_t stride[3],  uint8_t *out,uint32_t w, uint32_t h)
-{
-
-
-			uint8_t *xsrc;
-			uint8_t *dst_y,*dst_u,*dst_v;
-
-
-			xsrc= in[0];
-			dst_y=out;
-			// copy y as is
-            		for(uint32_t y=h;y>0;y--)
-			{
-				memcpy(dst_y,xsrc,w);
-				dst_y+=w;
-				xsrc+=stride[0];
-			}
-			// u
-			xsrc= in[1];
-			dst_u=out+(w*h);
-			for(uint32_t y=h>>1;y>0;y--)
-			{
-				memcpy(dst_u,xsrc,w>>1);
-				dst_u+=w>>1;
-				xsrc+=stride[1]*2;
-			}
-			// v
-			xsrc= in[2];
-			dst_v=out+(w*h)+((w*h)>>2);;
-			for(uint32_t y=h>>1;y>0;y--)
-			{
-				memcpy(dst_v,xsrc,w>>1);
-				dst_v+=w>>1;
-				xsrc+=stride[2]*2;
-			}
-			return 1;
-}
-uint8_t COL_411_YV12( uint8_t *in[3], uint32_t stride[3],  uint8_t *out,uint32_t w, uint32_t h)
-{
-
-
-			uint8_t *xsrc;
-			uint8_t *dst_y,*dst_u,*dst_v;
-
-
-			xsrc= in[0];
-			dst_y=out;
-			// copy y as is
-            		for(uint32_t y=h;y>0;y--)
-			{
-				memcpy(dst_y,xsrc,w);
-				dst_y+=w;
-				xsrc+=stride[0];
-			}
-			// u
-			xsrc= in[1];
-			dst_u=out+(w*h);
-			for(uint32_t y=h>>1;y>0;y--)
-			{
-				//memcpy(dst_u,xsrc,w>>1);
-				for(uint32_t x=0;x<w>>2;x++)
-					{
-						*(dst_u+x+x+1)=*(dst_u+x+x)=*(xsrc+x);
-					}
-				dst_u+=w>>1;
-				xsrc+=stride[1]*2;
-			}
-			// v
-			xsrc= in[2];
-			dst_v=out+(w*h)+((w*h)>>2);;
-			for(uint32_t y=h>>1;y>0;y--)
-			{
-				for(uint32_t x=0;x<w>>2;x++)
-					{
-						*(dst_v+x+x+1)=*(dst_v+x+x)=*(xsrc+x);
-					}
-				dst_v+=w>>1;
-				xsrc+=stride[2]*2;
-			}
-			return 1;
-}
-
-

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/DIA_flyDialog.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/DIA_flyDialog.h	2010-04-05 18:05:44 UTC (rev 6053)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/DIA_flyDialog.h	2010-04-05 18:05:50 UTC (rev 6054)
@@ -95,7 +95,7 @@
           void    *_cookie; // whatever
           void    *_slider; // widget
           void    *_canvas; // Drawing zone
-          ColYuvRgb *_rgb;
+          ADMColorSpaceSimple *_rgb;
 
           /* Filter dependant */
   virtual uint8_t    process(void)=0;

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp	2010-04-05 18:05:44 UTC (rev 6053)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp	2010-04-05 18:05:50 UTC (rev 6054)
@@ -73,12 +73,10 @@
  */
 void ADM_flyDialog::EndConstructor(void)
   {
-    if (isRgbInverted())
-                _rgb=new ColYuvRgb(_w,_h,1);
-        else
-                _rgb=new ColYuvRgb(_w,_h);
+#warning FIXME
 
-        _rgb->reset(_w,_h);
+//    if (isRgbInverted())
+            _rgb =new ADMColorSpaceSimple(_w,_h,ADM_COLOR_YV12,ADM_COLOR_YV12);
         if (_resizeMethod == RESIZE_AUTO || _resizeMethod == RESIZE_LAST)
                 {
                         _zoom = calcZoomFactor();
@@ -274,7 +272,7 @@
 	if (_resizeMethod == RESIZE_AUTO || _resizeMethod == RESIZE_LAST)
 		_resizer->resize(_yuvBufferOut->data, _rgbBufferOut);
 	else
-		_rgb->scale(_yuvBufferOut->data, _rgbBufferOut);
+		_rgb->convert(_yuvBufferOut->data, _rgbBufferOut);
 }
 /**
     \fn    copyYuvScratchToRgb
@@ -286,7 +284,7 @@
 	if (_resizeMethod == RESIZE_AUTO)
 		_resizer->resize(_yuvBuffer->data,_rgbBuffer);
 	else
-		_rgb->scale(_yuvBuffer->data,_rgbBuffer);
+		_rgb->convert(_yuvBuffer->data,_rgbBuffer);
 }
 /**
     \fn    copyRgbFinalToDisplay



From mean at mail.berlios.de  Mon Apr  5 20:05:52 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 5 Apr 2010 20:05:52 +0200
Subject: [Avidemux-svn-commit] r6055 - in
	branches/avidemux_2.6_branch_mean/avidemux_core:
	ADM_coreDemuxer/include ADM_coreImageLoader/src
	ADM_coreVideoCodec/include ADM_coreVideoEncoder/include
	ADM_coreVideoEncoder/src
Message-ID: <201004051805.o35I5qU8032019@sheep.berlios.de>

Author: mean
Date: 2010-04-05 20:05:52 +0200 (Mon, 05 Apr 2010)
New Revision: 6055

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxer/include/ADM_Video.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImageLoader/src/ADM_imageLoader.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_rgb16.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/include/ADM_coreVideoEncoderFFmpeg.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/ADM_coreVideoEncoderFFmpeg.cpp
Log:
[colors] Use new ADMColorSpace

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxer/include/ADM_Video.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxer/include/ADM_Video.h	2010-04-05 18:05:50 UTC (rev 6054)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxer/include/ADM_Video.h	2010-04-05 18:05:52 UTC (rev 6055)
@@ -26,6 +26,8 @@
 #include "ADM_compressedImage.h"
 #include "ADM_audioStream.h"
 
+#include "ADM_colorspace.h"
+
 #ifndef ADM_NO_PTS
 #define ADM_NO_PTS 0xFFFFFFFFFFFFFFFFLL // FIXME
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImageLoader/src/ADM_imageLoader.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImageLoader/src/ADM_imageLoader.cpp	2010-04-05 18:05:50 UTC (rev 6054)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImageLoader/src/ADM_imageLoader.cpp	2010-04-05 18:05:52 UTC (rev 6055)
@@ -176,7 +176,10 @@
 		    {
 		    	ADM_info("[imageLoader] YUY2\n");
 		    	image=new ADMImage(w,h);
-		    	COL_422_YV12(tmpImage._planes, tmpImage._planeStride,  image->data,w,h);
+                ADMColorSpaceSimple convert(w,h,ADM_COLOR_YUV422,ADM_COLOR_YV12);
+                uint32_t dstStride[3]={w,w/2,w/2};
+                uint8_t  *dstData[3]={YPLANE(image),UPLANE(image),VPLANE(image)};
+		    	convert.convertPlanes( tmpImage._planeStride,dstStride, tmpImage._planes,dstData);
 		    	break;
 		    }
 		    default:
@@ -241,8 +244,9 @@
 		    
 		  // Colorconversion
 		    
-		    	ADMImage *image=new ADMImage(w,h);
-		    	COL_RGB24_to_YV12( w, h,data,image->data);
+            ADMImage *image=new ADMImage(w,h);
+            ADM_ConvertRgb24ToYV12(false,w,h,data,image->data);
+            
 		    
 		    delete [] data;
 		    return image;		
@@ -291,7 +295,8 @@
   // Colorconversion
     
     	ADMImage *image=new ADMImage(w,h);
-    	COL_RGB24_to_YV12_revert( w, h,data,image->data);
+        ADM_ConvertRgb24ToYV12(true,w,h,data,image->data);
+    	
     
     	delete [] data;
     	return image;		
@@ -338,7 +343,7 @@
     	dec->uncompress (&bin, &tmpImage);
     	
     	ADMImage *image=new ADMImage(w,h);
-    	COL_RGB24_to_YV12( w, h,tmpImage._planes[0],image->data);
+        ADM_ConvertRgb24ToYV12(false,w,h,tmpImage._planes[0],image->data);
     
     	delete [] data;
         delete dec;

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_rgb16.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_rgb16.h	2010-04-05 18:05:50 UTC (rev 6054)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_rgb16.h	2010-04-05 18:05:52 UTC (rev 6055)
@@ -22,11 +22,11 @@
 class decoderRGB16 : decoders
 {
 	protected:
-		uint8_t* planar;
-		ColRgbToYV12* color;
-		bool     isRgb; // Else BGR
-		uint32_t _bpp;
-		uint8_t* decoded;
+		uint8_t       *planar;
+		ADMColorSpaceSimple *converter;
+		bool          isRgb; // Else BGR
+		uint32_t      _bpp;
+		uint8_t       *decoded;
 
 	public:
 		bool dontcopy (void) { return 1; }

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/include/ADM_coreVideoEncoderFFmpeg.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/include/ADM_coreVideoEncoderFFmpeg.h	2010-04-05 18:05:50 UTC (rev 6054)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/include/ADM_coreVideoEncoderFFmpeg.h	2010-04-05 18:05:52 UTC (rev 6055)
@@ -35,7 +35,7 @@
                FFcodecSettings  Settings;
                AVCodecContext   *_context;      // Context 
                AVFrame          _frame;     
-               ADMColorspace    *colorSpace;    // Colorspace converter if needed
+               ADMColorSpaceSimple    *colorSpace;    // Colorspace converter if needed
                uint8_t          *rgbBuffer;     // Buffer for colorspace converter if needed
                ADM_colorspace   targetColorSpace; // Wanted colorspace
                bool             loadStatFile(const char *file);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/ADM_coreVideoEncoderFFmpeg.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/ADM_coreVideoEncoderFFmpeg.cpp	2010-04-05 18:05:50 UTC (rev 6054)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/ADM_coreVideoEncoderFFmpeg.cpp	2010-04-05 18:05:52 UTC (rev 6055)
@@ -277,7 +277,7 @@
     h=info->height;
     if(targetColorSpace!=ADM_COLOR_YV12)
     {
-        colorSpace=new ADMColorspace(w,h,ADM_COLOR_YV12,targetColorSpace);
+        colorSpace=new ADMColorSpaceSimple(w,h,ADM_COLOR_YV12,targetColorSpace);
         if(!colorSpace)
         {
             printf("[ADM_jpegEncoder] Cannot allocate colorspace\n");



From mean at mail.berlios.de  Mon Apr  5 20:05:54 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 5 Apr 2010 20:05:54 +0200
Subject: [Avidemux-svn-commit] r6056 - in
	branches/avidemux_2.6_branch_mean/avidemux: common/ADM_editor
	common/ADM_libraries/ADM_libsdl common/ADM_render
	qt4/ADM_userInterfaces/ADM_dialog
Message-ID: <201004051805.o35I5sA2032030@sheep.berlios.de>

Author: mean
Date: 2010-04-05 20:05:54 +0200 (Mon, 05 Apr 2010)
New Revision: 6056

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRender.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_libraries/ADM_libsdl/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/DIA_flyPreview.h
Log:
[Color] Use new colorSpace class

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRender.cpp	2010-04-05 18:05:52 UTC (rev 6055)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRender.cpp	2010-04-05 18:05:54 UTC (rev 6056)
@@ -481,11 +481,15 @@
                         // Is there already one ?
                         if(!vid->color)
                         {
-                                vid->color=new COL_Generic2YV12(src->_width,src->_height,src->_colorspace);
+                              //  vid->color=new COL_Generic2YV12(src->_width,src->_height,src->_colorspace);
+                              vid->color=new ADMColorSpaceSimple(src->_width,src->_height,
+                                                                 src->_colorspace,ADM_COLOR_YV12);
                         }
                         // Since it is not YV12 it MUST be a ref
                         ADM_assert(src->_isRef);
-                        vid->color->transform(src->_planes,src->_planeStride,dst->data);
+                        uint32_t strides[3]={src->_width,src->_width/2,src->_width/2};
+                        uint8_t  *Planes[3]={YPLANE(dst),UPLANE(dst),VPLANE(dst)};
+                        vid->color->convertPlanes(src->_planeStride,strides,src->_planes,Planes);
                         return 1;
                 }
                 // nothing to do

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.h	2010-04-05 18:05:52 UTC (rev 6055)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.h	2010-04-05 18:05:54 UTC (rev 6056)
@@ -50,7 +50,7 @@
 {
       vidHeader *_aviheader; /// Demuxer
       decoders *decoder; /// Video codec
-      COL_Generic2YV12 *color; /// Color conversion if needed
+      ADMColorSpaceSimple *color; /// Color conversion if needed
 
       /* Audio part */
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_libraries/ADM_libsdl/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_libraries/ADM_libsdl/CMakeLists.txt	2010-04-05 18:05:52 UTC (rev 6055)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_libraries/ADM_libsdl/CMakeLists.txt	2010-04-05 18:05:54 UTC (rev 6056)
@@ -3,4 +3,4 @@
 
 SDLify(SDLmain.m)
 
-ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
\ No newline at end of file
+ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2010-04-05 18:05:52 UTC (rev 6055)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2010-04-05 18:05:54 UTC (rev 6056)
@@ -37,13 +37,13 @@
 #include "ADM_colorspace.h"
 
 #include "DIA_uiTypes.h"
-
-
-static ColYuvRgb rgbConverter(640,480
 #if ADM_UI_TYPE_BUILD == ADM_UI_QT4 
-    ,1
+    #define IVERT ADM_COLOR_BGR32A
+#else
+    #define IVERT ADM_COLOR_RGB32A
 #endif    
-);
+#warning FIXME
+static ADMColorSpaceSimple rgbConverter(640,480,ADM_COLOR_YV12,IVERT);
 
 
 static uint8_t	updateWindowSize(void * win, uint32_t w, uint32_t h);
@@ -292,7 +292,7 @@
 
         if(!accel_mode)
         {
-                rgbConverter.reset(renderW,renderH);
+                rgbConverter.changeWidthHeight(renderW,renderH);
                 printf("No accel used for rendering\n");
         }
         else
@@ -341,14 +341,14 @@
     renderH = h;
 
     MUI_updateDrawWindowSize(win,w,h);
-    rgbConverter.reset(w,h);
+    rgbConverter.changeWidthHeight(w,h);
     return 1;
 }
 
 uint8_t GUI_ConvertRGB(uint8_t * in, uint8_t * out, uint32_t w, uint32_t h)
 {
-    rgbConverter.reset(w,h);
-    rgbConverter.scale(in,out);
+    rgbConverter.changeWidthHeight(w,h);
+    rgbConverter.convert(in,out);
     return 1;
 }
 void GUI_RGBDisplay(uint8_t * dis, uint32_t w, uint32_t h, void *widg)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.cpp	2010-04-05 18:05:52 UTC (rev 6055)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.cpp	2010-04-05 18:05:54 UTC (rev 6056)
@@ -55,7 +55,7 @@
 #ifdef __WIN32
 HWND sdlWin32;
 #endif
-static ColBase *color=NULL;
+static ADMColorSpaceSimple *color=NULL;
 
 sdlAccelRender::sdlAccelRender( void)
 {
@@ -114,7 +114,7 @@
 
     if(!useYV12)
     {
-		color=new ColBase(720,480);
+		color=new ADMColorSpaceSimple(720,480,ADM_COLOR_YV12,ADM_COLOR_YUV422);
 		decoded=new uint8_t[w*h*2];
     }
 
@@ -247,7 +247,7 @@
         if(!sdl_overlay->hw_overlay)
             printf("[SDL] Hardware acceleration disabled\n");
 
-        if(!useYV12) color->reset(w,h);
+        if(!useYV12) color->changeWidthHeight(w,h);
 
 		printf("[SDL] Video subsystem initalised successfully\n");
 
@@ -311,14 +311,14 @@
 	            interleave(sdl_overlay->pixels[2],ptr+(page*5)/4,w>>1,pitch,h>>1);
         }else
         {
-	        color->reset(w,h);
+	        color->changeWidthHeight(w,h);
 	        if(pitch==2*w)
 	        {
-	            color->scale(ptr,sdl_overlay->pixels[0]);
+	            color->convert(ptr,sdl_overlay->pixels[0]);
 	        }
 	        else
 	        {
-	            color->scale(ptr,decoded);
+	            color->convert(ptr,decoded);
 	            interleave(sdl_overlay->pixels[0],decoded,2*w,pitch,h);
 	        }
         }

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/DIA_flyPreview.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/DIA_flyPreview.h	2010-04-05 18:05:52 UTC (rev 6055)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/DIA_flyPreview.h	2010-04-05 18:05:54 UTC (rev 6056)
@@ -7,7 +7,7 @@
 	uint8_t download(void) {return 1;}
 	uint8_t upload(void) {return 1;}
 	uint8_t cleanup(void) {return 1;}
-	uint8_t setData(uint8_t *buffer) {_rgb->scale(buffer, _rgbBufferOut); return 1;}
+	uint8_t setData(uint8_t *buffer) {_rgb->convert(buffer, _rgbBufferOut); return 1;}
 
 	flyPreview(uint32_t width, uint32_t height, void *canvas) : 
 	  ADM_flyDialogQt4(width, height, NULL, canvas, NULL, 0, RESIZE_NONE) {delete[] _rgbBuffer; _rgbBuffer = NULL;};



From mean at mail.berlios.de  Mon Apr  5 20:05:57 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 5 Apr 2010 20:05:57 +0200
Subject: [Avidemux-svn-commit] r6057 - in
	branches/avidemux_2.6_branch_mean/avidemux_core:
	ADM_coreImage/include ADM_coreImage/src
	ADM_coreImageLoader/src ADM_coreVideoFilter/include
	ADM_coreVideoFilter/src
Message-ID: <201004051805.o35I5v2L032040@sheep.berlios.de>

Author: mean
Date: 2010-04-05 20:05:56 +0200 (Mon, 05 Apr 2010)
New Revision: 6057

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_image.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageResizer.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImageLoader/src/ADM_imageLoader.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/DIA_flyDialog.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp
Log:
[image] make imageResizer use ADMColorSpaceFull

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_image.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_image.h	2010-04-05 18:05:54 UTC (rev 6056)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_image.h	2010-04-05 18:05:56 UTC (rev 6057)
@@ -25,6 +25,7 @@
 #define ADM_IMAGE
 #include "ADM_assert.h"
 #include "ADM_rgb.h"
+#include "ADM_colorspace.h"
 
 typedef enum 
 {
@@ -154,22 +155,21 @@
 #define UPLANE(x) ((x)->data+((x)->_width*(x)->_height))
 #define VPLANE(x) ((x)->data+(5*((x)->_width*(x)->_height)>>2))
 
-//
-//  Simple image resizer
-//
+/**
+        \class ADMImageResizer
+        \brief Simple image resizer
+*/
 class ADMImageResizer
 {
 	private:
-		void    *_context;
-		uint32_t orgFormat, destFormat;
+		ADMColorSpaceFull   *resizer;
+        ADM_colorspace orgFormat, destFormat;
 		uint32_t orgWidth, orgHeight;
 		uint32_t destWidth, destHeight;
-
-		void init(uint32_t ow, uint32_t oh, uint32_t dw, uint32_t dh, int srcFormat, int dstFormat);
-		void getYuvPlanes(uint8_t *source, uint32_t width, uint32_t height, uint8_t*& yPlane, uint8_t*& uPlane, uint8_t*& vPlane);
+        void        init(uint32_t ow, uint32_t oh, uint32_t dw, uint32_t dh, ADM_colorspace srcFormat, ADM_colorspace dstFormat);
 	public:
 		ADMImageResizer(uint32_t ow,uint32_t oh, uint32_t dw, uint32_t dh);
-		ADMImageResizer(uint32_t ow, uint32_t oh, uint32_t dw, uint32_t dh, int srcFormat, int dstFormat);
+		ADMImageResizer(uint32_t ow, uint32_t oh, uint32_t dw, uint32_t dh, ADM_colorspace srcFormat, ADM_colorspace dstFormat);
 		~ADMImageResizer();
 		
 		uint8_t resize(ADMImage *src, ADMImage *dest);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp	2010-04-05 18:05:54 UTC (rev 6056)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp	2010-04-05 18:05:56 UTC (rev 6057)
@@ -233,9 +233,21 @@
 bool ADM_ConvertRgb24ToYV12(bool inverted,uint32_t w, uint32_t h, uint8_t *source, uint8_t *destination) 
 {
     ADMColorSpaceSimple  converter( w,h,ADM_COLOR_RGB24,ADM_COLOR_YV12);
-    return converter.convert(source,destination);
     
+    if(true==inverted)
+    {
+        uint8_t a,b,c;
+        uint8_t *src=source;
+        uint32_t len=w*h;
+        while(len--)
+        {
+            a=src[0];b=src[1];c=src[2];
+            src[0]=c;src[2]=a;//src[1]=b;
+            src+=3;
+        }
+    }
+    if(false==converter.convert(source,destination)) return false;
+    return true;
+}
 
-
-}
 //EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageResizer.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageResizer.cpp	2010-04-05 18:05:54 UTC (rev 6056)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageResizer.cpp	2010-04-05 18:05:56 UTC (rev 6057)
@@ -23,24 +23,24 @@
 
 ADMImageResizer::ADMImageResizer(uint32_t ow, uint32_t oh, uint32_t dw, uint32_t dh)
 {
-	init(ow, oh, dw, dh, PIX_FMT_YUV420P, PIX_FMT_YUV420P);
+	init(ow, oh, dw, dh, ADM_COLOR_YV12, ADM_COLOR_YV12);
 }
 
-ADMImageResizer::ADMImageResizer(uint32_t ow, uint32_t oh, uint32_t dw, uint32_t dh, int srcFormat, int destFormat)
+ADMImageResizer::ADMImageResizer(uint32_t ow, uint32_t oh, uint32_t dw, uint32_t dh,ADM_colorspace srcFormat, ADM_colorspace destFormat)
 {
 	init(ow, oh, dw, dh, srcFormat, destFormat);
 }
 
 ADMImageResizer::~ADMImageResizer()
 {
-   if (_context)
+   if (resizer)
    {
-		sws_freeContext((SwsContext*)_context);
-		_context = NULL;
+		delete resizer;
+		resizer = NULL;
    }
 }
 
-void ADMImageResizer::init(uint32_t ow, uint32_t oh, uint32_t dw, uint32_t dh, int srcFormat, int dstFormat)
+void ADMImageResizer::init(uint32_t ow, uint32_t oh, uint32_t dw, uint32_t dh, ADM_colorspace srcFormat, ADM_colorspace dstFormat)
 {
     orgWidth = ow;
     orgHeight = oh;
@@ -49,26 +49,8 @@
 
 	orgFormat = srcFormat;
 	destFormat = dstFormat;
-
-	int flags = SWS_SPLINE;
-
-#ifdef ADM_CPU_X86
-	#define ADD(x, y) if (CpuCaps::has##x()) flags |= SWS_CPU_CAPS_##y;
-
-	ADD(MMX,MMX);
-	ADD(3DNOW,3DNOW);
-	ADD(MMXEXT,MMX2);
-#endif
-
-#ifdef ADM_CPU_ALTIVEC
-    flags |= SWS_CPU_CAPS_ALTIVEC;
-#endif
-
-	_context = (void *)sws_getContext(orgWidth, orgHeight,
-									  (PixelFormat)srcFormat,
-									  destWidth, destHeight,
-									  (PixelFormat)destFormat,
-									  flags, NULL, NULL,NULL);
+    resizer=new ADMColorSpaceFull(ADM_CS_BICUBIC,orgWidth,orgHeight,destWidth,destHeight,srcFormat,destFormat);
+                        
 }
 
 uint8_t ADMImageResizer::resize(ADMImage *source, ADMImage *dest)
@@ -78,7 +60,7 @@
     ADM_assert(dest->_width == destWidth);
     ADM_assert(dest->_height == destHeight);
 
-	return resize(source->data, dest->data);
+	return resizer->convert(source->data, dest->data);
 }
 
 uint8_t ADMImageResizer::resize(ADMImage *source, uint8_t *dest)
@@ -86,7 +68,7 @@
     ADM_assert(source->_width == orgWidth);
     ADM_assert(source->_height == orgHeight);
 
-	return resize(source->data, dest);
+	return resizer->convert(source->data, dest);
 }
 
 uint8_t ADMImageResizer::resize(uint8_t *source, ADMImage *dest)
@@ -94,61 +76,12 @@
     ADM_assert(dest->_width == destWidth);
     ADM_assert(dest->_height == destHeight);
 
-	return resize(source, dest->data);
+	return resizer->convert(source, dest->data);
 }
 
+
 uint8_t ADMImageResizer::resize(uint8_t *source, uint8_t *dest)
 {
-	uint8_t *src[3];
-	uint8_t *dst[3];
-	int ssrc[3];
-	int ddst[3];
 
-	if (orgFormat == PIX_FMT_YUV420P)
-	{
-		getYuvPlanes(source, orgWidth, orgHeight, *&src[0], *&src[1], *&src[2]);
-
-		ssrc[0] = orgWidth;
-		ssrc[1] = ssrc[2] = orgWidth >> 1;
-	}
-	else	// RGB
-	{
-		src[0] = source;
-		src[1] = NULL;
-		src[2] = NULL;
-
-		ssrc[0]=orgWidth * 4;
-		ssrc[1] = 0;
-		ssrc[2] = 0;
-	}
-
-	if (destFormat == PIX_FMT_YUV420P)
-	{
-		getYuvPlanes(dest, destWidth, destHeight, *&dst[0], *&dst[1], *&dst[2]);
-
-		ddst[0] = destWidth;
-		ddst[1] = ddst[2] = destWidth >> 1;
-	}
-	else	// RGB
-	{
-		dst[0] = dest;
-		dst[1] = NULL;
-		dst[2] = NULL;
-
-		ddst[0] = destWidth * 4;
-		ddst[1] = 0;
-		ddst[2] = 0;
-	}
-
-    sws_scale((SwsContext*)_context, src, ssrc, 0, orgHeight, dst, ddst);
-
-    return 1;
+	return resizer->convert(source, dest);
 }
-
-void ADMImageResizer::getYuvPlanes(uint8_t *source, uint32_t width, uint32_t height, uint8_t*& yPlane, uint8_t*& uPlane, uint8_t*& vPlane)
-{
-	// Unfortunately xPLANE macros expect an ADMImage object so doubling up on logic.
-	yPlane = source;
-	uPlane = source + (width * height);
-	vPlane = source + (5 * (width * height) >> 2);
-}

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImageLoader/src/ADM_imageLoader.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImageLoader/src/ADM_imageLoader.cpp	2010-04-05 18:05:54 UTC (rev 6056)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImageLoader/src/ADM_imageLoader.cpp	2010-04-05 18:05:56 UTC (rev 6057)
@@ -343,7 +343,7 @@
     	dec->uncompress (&bin, &tmpImage);
     	
     	ADMImage *image=new ADMImage(w,h);
-        ADM_ConvertRgb24ToYV12(false,w,h,tmpImage._planes[0],image->data);
+        ADM_ConvertRgb24ToYV12(true,w,h,tmpImage._planes[0],image->data);
     
     	delete [] data;
         delete dec;

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/DIA_flyDialog.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/DIA_flyDialog.h	2010-04-05 18:05:54 UTC (rev 6056)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/DIA_flyDialog.h	2010-04-05 18:05:56 UTC (rev 6057)
@@ -38,6 +38,7 @@
 #endif //ADM_FLY_INTERNAL 
 
 #include "ADM_default.h"
+#include "ADM_rgb.h"
 #include "ADM_colorspace.h"
 #include "ADM_coreVideoFilter.h"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp	2010-04-05 18:05:54 UTC (rev 6056)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp	2010-04-05 18:05:56 UTC (rev 6057)
@@ -94,14 +94,14 @@
 
                 if (_resizeMethod == RESIZE_AUTO || _resizeMethod == RESIZE_LAST)
                 {
-                        PixelFormat sourceColour;
+                        ADM_colorspace sourceColour;
 
                         if (_resizeMethod == RESIZE_AUTO || _isYuvProcessing)
-                                sourceColour = PIX_FMT_YUV420P;
+                                sourceColour = ADM_COLOR_YV12;
                         else
-                                sourceColour = PIX_FMT_RGB32;
+                                sourceColour = ADM_COLOR_RGB32A;
 
-                        _resizer = new ADMImageResizer(_w, _h, _zoomW, _zoomH, sourceColour, PIX_FMT_RGB32);
+                        _resizer = new ADMImageResizer(_w, _h, _zoomW, _zoomH, sourceColour, ADM_COLOR_RGB32A);
                         _rgbBufferDisplay = new uint8_t[_w * _h * 4];
                 }
                 else
@@ -162,14 +162,14 @@
     delete _resizer;
     if (_resizeMethod == RESIZE_AUTO || _resizeMethod == RESIZE_LAST)
     {
-        PixelFormat sourceColour;
+        ADM_colorspace sourceColour;
 
         if (_resizeMethod == RESIZE_AUTO || _isYuvProcessing)
-            sourceColour = PIX_FMT_YUV420P;
+            sourceColour = ADM_COLOR_YV12;
         else
-            sourceColour = PIX_FMT_RGB32;
+            sourceColour = ADM_COLOR_RGB32A;
 
-        _resizer = new ADMImageResizer(_w, _h, _zoomW, _zoomH, sourceColour, PIX_FMT_RGB32);
+        _resizer = new ADMImageResizer(_w, _h, _zoomW, _zoomH, sourceColour, ADM_COLOR_RGB32A);
         if (!_rgbBufferDisplay)
             _rgbBufferDisplay = new uint8_t[_w * _h * 4];
     }



From gruntster at mail.berlios.de  Mon Apr  5 20:32:29 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 5 Apr 2010 20:32:29 +0200
Subject: [Avidemux-svn-commit] r6058 - in
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder:
	. ADM_vidEnc_mpeg2enc ADM_vidEnc_mpeg2enc/mpeg2enc
Message-ID: <201004051832.o35IWTgU002835@sheep.berlios.de>

Author: gruntster
Date: 2010-04-05 20:32:22 +0200 (Mon, 05 Apr 2010)
New Revision: 6058

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/encoder.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Options.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/CMakeLists.txt
Log:
[mpeg2enc] finish porting of mpeg2enc logic for MPEG-2 to plugin

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/encoder.cpp	2010-04-05 18:05:56 UTC (rev 6057)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/encoder.cpp	2010-04-05 18:32:22 UTC (rev 6058)
@@ -13,6 +13,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
+#include <math.h>
 #include <libxml/tree.h>
 
 #include "encoder.h"
@@ -28,10 +29,15 @@
 static Mpeg2encEncoder* encoders[] = {&mpeg2};
 static int supportedCsps[] = { ADM_CSP_YV12 };
 
+extern int mpegenc_encode(char *in, char *out, int *size, int *flags, int *quant);
+extern int mpegenc_end(void);
 extern int mpegenc_init(mpeg2parm *incoming,int width, int height, int fps1000);
-extern int mpegenc_encode(char *in, char *out, int *size, int *flags, int *quant);
 extern int mpegenc_setQuantizer(int q);
 
+#ifdef __WIN32
+extern void convertPathToAnsi(const char *path, char **ansiPath);
+#endif
+
 extern "C"
 {
 	void *mpeg2encEncoder_getPointers(int _uiType, int *count)
@@ -157,7 +163,7 @@
 
 int Mpeg2encEncoder::getEncoderRequirements(void)
 {
-	return ADM_VIDENC_REQ_NONE;
+	return ADM_VIDENC_REQ_NULL_FLUSH;
 }
 
 int Mpeg2encEncoder::isConfigurable(void)
@@ -197,11 +203,8 @@
 	_frameCount = properties->frameCount;
 	_bufferSize = (properties->width * properties->height) + 2 * ((properties->width + 1 >> 1) * (properties->height + 1 >> 1));
 	_buffer = new uint8_t[_bufferSize];
+	_xvidRc = NULL;
 
-	memset(&_param, 0, sizeof(mpeg2parm));
-	_param.setDefault();
-	_param.searchrad = 16; // speed up
-
 	properties->supportedCspsCount = 1;
 	properties->supportedCsps = supportedCsps;
 
@@ -225,9 +228,80 @@
 		return ADM_VIDENC_ERR_PASS_SKIP;
 	}
 
+	int encodeModeParameter, maxBitrate, vbv;
+
 	_openPass = true;
 	_currentPass++;
 
+	memset(&_param, 0, sizeof(mpeg2parm));
+	_param.setDefault();
+	_param.searchrad = 16; // speed up
+
+	initParameters(&encodeModeParameter, &maxBitrate, &vbv);
+
+	if (_encodeOptions.encodeMode == ADM_VIDENC_MODE_2PASS_SIZE || _encodeOptions.encodeMode == ADM_VIDENC_MODE_2PASS_ABR)
+	{
+		char *log = NULL;
+
+#ifdef __WIN32
+		convertPathToAnsi(passParameters->logFileName, &log);
+#else
+		log = new char[strlen(passParameters->logFileName) + 1];
+		strcpy(log, passParameters->logFileName);
+#endif
+		_xvidRc = new ADM_newXvidRcVBV((_fpsNum * 1000) / _fpsDen, log);
+		delete [] log;
+
+		_param.quant = 2;
+
+		if (_currentPass == 1)
+		{
+			_xvidRc->startPass1();
+			_param.ignore_constraints = 1;
+			_param.bitrate = 50000000;
+		}
+		else
+		{
+			uint32_t bitrate, size;
+
+			if (_encodeOptions.encodeMode == ADM_VIDENC_MODE_2PASS_SIZE)
+			{
+				size = encodeModeParameter;
+				bitrate = calculateBitrate(_fpsNum, _fpsDen, _frameCount, encodeModeParameter);
+			}
+			else
+			{
+				double d = _frameCount;
+
+				d *= 1000.;
+				d /= (_fpsNum * 1000) / _fpsDen;   // D is a duration in second
+				d *= bitrate;   // * bitrate = total bits
+				d /= 8;   // Byte
+				d /= 1024 * 1024;   // MB
+
+				size = (uint32_t)d;
+				bitrate = encodeModeParameter * 1000;
+			}
+
+			if (bitrate > maxBitrate * 1000)
+				bitrate = maxBitrate * 1000;
+
+			_xvidRc->setVBVInfo(maxBitrate, 0, vbv);
+			_xvidRc->startPass2(size, _frameCount);
+			_param.bitrate = bitrate;
+		}
+	}
+	else if (_encodeOptions.encodeMode == ADM_VIDENC_MODE_CQP)
+	{
+		_param.quant = encodeModeParameter;
+		_param.bitrate = maxBitrate * 1000;
+	}
+	else if (_encodeOptions.encodeMode == ADM_VIDENC_MODE_CBR)
+	{
+		_param.quant = 0;
+		_param.bitrate = encodeModeParameter * 1000;
+	}
+
 	if (!mpegenc_init(&_param, _width, _height, (_fpsNum * 1000) / _fpsDen))
 		return ADM_VIDENC_ERR_FAILED;
 
@@ -239,19 +313,68 @@
 	if (!_opened)
 		return ADM_VIDENC_ERR_CLOSED;
 
+	ADM_rframe rf;
 	int flags, size, qz;
 
 	if (_encodeOptions.encodeMode == ADM_VIDENC_MODE_CQP)
+	{
 		mpegenc_setQuantizer(_encodeOptions.encodeModeParameter);
+	}
+	else if (_currentPass == 2)
+	{
+		uint32_t qz_in;
 
-	if (!mpegenc_encode((char*)encodeParams->frameData, (char*)_buffer, &size, &flags, &qz))
+		_xvidRc->getQz(&qz_in, &rf);
+
+		if (qz_in < 2)
+			qz_in = 2;
+		else if (qz_in > 28)
+			qz_in = 28;
+
+		mpegenc_setQuantizer(qz_in);
+	}
+
+	char *input;
+
+	if (encodeParams->frameData[0] == NULL)
+		input = new char[1];
+	else
+		input = (char*)encodeParams->frameData[0];
+
+	if (!mpegenc_encode(input, (char*)_buffer, &size, &flags, &qz))
 		return ADM_VIDENC_ERR_FAILED;
 
+	if (encodeParams->frameData[0] == NULL)
+		delete [] input;
+
 	encodeParams->frameType = getFrameType(flags);
 	encodeParams->encodedDataSize = size;
 	encodeParams->encodedData = _buffer;
+	encodeParams->ptsFrame = 0;
 	encodeParams->quantiser = qz;
 
+	switch (encodeParams->frameType)
+	{
+		case ADM_VIDENC_FRAMETYPE_IDR:
+			rf = RF_I;
+			break;
+		case ADM_VIDENC_FRAMETYPE_B:
+			rf = RF_B;
+			break;
+		case ADM_VIDENC_FRAMETYPE_P:
+			rf = RF_P;
+			break;
+	}
+
+	if (encodeParams->encodedDataSize > 0 && 
+		(_encodeOptions.encodeMode == ADM_VIDENC_MODE_2PASS_SIZE || _encodeOptions.encodeMode == ADM_VIDENC_MODE_2PASS_ABR))
+	{
+		if (_currentPass == 1)
+			_xvidRc->logPass1(encodeParams->quantiser, rf, encodeParams->encodedDataSize);
+		else
+			_xvidRc->logPass2(encodeParams->quantiser, rf, encodeParams->encodedDataSize);
+	}
+
 	return ADM_VIDENC_ERR_SUCCESS;
 }
 
@@ -260,13 +383,15 @@
 	if (!_opened)
 		return ADM_VIDENC_ERR_CLOSED;
 
+	mpegenc_end();
+
 	if (_openPass)
 		_openPass = false;
 
-	if (_buffer)
+	if (_xvidRc)
 	{
-		delete [] _buffer;
-		_buffer = NULL;
+		delete _xvidRc;
+		_xvidRc = NULL;
 	}
 
 	return ADM_VIDENC_ERR_SUCCESS;
@@ -277,6 +402,12 @@
 	if (_openPass)
 		finishPass();
 
+	if (_buffer)
+	{
+		delete [] _buffer;
+		_buffer = NULL;
+	}
+
 	_opened = false;
 	_currentPass = 0;
 
@@ -295,3 +426,20 @@
 			return ADM_VIDENC_FRAMETYPE_P;
 	}
 }
+
+unsigned int Mpeg2encEncoder::calculateBitrate(unsigned int fpsNum, unsigned int fpsDen, unsigned int frameCount, unsigned int sizeInMb)
+{
+	double db, ti;
+
+	db = sizeInMb;
+	db = db * 1024. * 1024. * 8.;
+	// now db is in bits
+
+	// compute duration
+	ti = frameCount;
+	ti *= fpsDen;
+	ti /= fpsNum;	// nb sec
+	db = db / ti;
+
+	return (unsigned int)floor(db);
+}

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/encoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/encoder.h	2010-04-05 18:05:56 UTC (rev 6057)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/encoder.h	2010-04-05 18:32:22 UTC (rev 6058)
@@ -26,6 +26,7 @@
 }
 
 #include "mpeg2parm.h"
+#include "xvidRateCtlVbv.h"
 
 class Mpeg2encEncoder
 {
@@ -42,8 +43,11 @@
 
 		vidEncOptions _encodeOptions;
 		mpeg2parm _param;
+		ADM_newXvidRcVBV *_xvidRc;
 
 		int getFrameType(int flags);
+		unsigned int calculateBitrate(unsigned int fpsNum, unsigned int fpsDen, unsigned int frameCount, unsigned int sizeInMb);
+		virtual int initParameters(int *encodeModeParameter, int *maxBitrate, int *vbv) = 0;
 
 	public:
 		virtual ~Mpeg2encEncoder(void);

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.cpp	2010-04-05 18:05:56 UTC (rev 6057)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.cpp	2010-04-05 18:32:22 UTC (rev 6058)
@@ -277,10 +277,8 @@
 		return ADM_VIDENC_ERR_FAILED;
 }
 
-int Mpeg2Encoder::open(vidEncVideoProperties *properties)
+int Mpeg2Encoder::initParameters(int *encodeModeParameter, int *maxBitrate, int *vbv)
 {
-	int ret = Mpeg2encEncoder::open(properties);
-
 	switch (_options.getMatrix())
 	{
 		case MPEG2_MATRIX_TMPGENC:
@@ -293,7 +291,7 @@
 			_param.hf_quant = 0;
 	}
 
-	if(_options.getWidescreen())
+	if (_options.getWidescreen())
 		_param.aspect_ratio = 3;
 	else
 		_param.aspect_ratio = 2;
@@ -312,14 +310,6 @@
 			_param.input_interlacing = 1;
 	}
 
-	if (_options.getMaxBitrate() == 0)
-	{
-		_param.bitrate = 50000000;
-		_param.ignore_constraints = 1;
-	}
-	else
-		_param.bitrate = _options.getMaxBitrate() * 1000;
-
 	if (_options.getStreamType() == MPEG2_STREAMTYPE_SVCD)
 		_param.format = MPEG_FORMAT_SVCD;
 	else
@@ -330,29 +320,15 @@
 	else
 		_param.min_GOP_size = _param.max_GOP_size = 18;
 
-	if (_encodeOptions.encodeMode == ADM_VIDENC_MODE_CQP)
-		_param.quant = _encodeOptions.encodeModeParameter;
-	else
-		_param.quant = 0;
+	*encodeModeParameter = _encodeOptions.encodeModeParameter;
+	*maxBitrate = _options.getMaxBitrate();
 
-	return ret;
+	if (_options.getStreamType() == MPEG2_STREAMTYPE_SVCD)
+		*vbv = 122 * 1024;
+	else
+		*vbv = 224 * 1024;
 }
 
-int Mpeg2Encoder::beginPass(vidEncPassParameters *passParameters)
-{
-	return Mpeg2encEncoder::beginPass(passParameters);
-}
-
-int Mpeg2Encoder::encodeFrame(vidEncEncodeParameters *encodeParams)
-{
-	return Mpeg2encEncoder::encodeFrame(encodeParams);
-}
-
-int Mpeg2Encoder::finishPass(void)
-{
-	return Mpeg2encEncoder::finishPass();
-}
-
 void Mpeg2Encoder::updateEncodeProperties(vidEncOptions *encodeOptions)
 {
 	switch (encodeOptions->encodeMode)
@@ -387,20 +363,3 @@
 			break;
 	}
 }
-
-unsigned int Mpeg2Encoder::calculateBitrate(unsigned int fpsNum, unsigned int fpsDen, unsigned int frameCount, unsigned int sizeInMb)
-{
-	double db, ti;
-
-	db = sizeInMb;
-	db = db * 1024. * 1024. * 8.;
-	// now db is in bits
-
-	// compute duration
-	ti = frameCount;
-	ti *= fpsDen;
-	ti /= fpsNum;	// nb sec
-	db = db / ti;
-
-	return (unsigned int)floor(db);
-}

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.h	2010-04-05 18:05:56 UTC (rev 6057)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.h	2010-04-05 18:32:22 UTC (rev 6058)
@@ -22,6 +22,8 @@
 	#include "ADM_vidEnc_plugin.h"
 }
 
+#include <limits.h>
+
 #include "encoder.h"
 #include "mpeg2Options.h"
 #include "DIA_factory.h"
@@ -43,7 +45,7 @@
 		uint8_t *_buffer;
 
 		void updateEncodeProperties(vidEncOptions *encodeOptions);
-		unsigned int calculateBitrate(unsigned int fpsNum, unsigned int fpsDen, unsigned int frameCount, unsigned int sizeInMb);
+		int initParameters(int *encodeModeParameter, int *maxBitrate, int *vbv);
 
 	public:
 		Mpeg2Encoder(void);
@@ -57,9 +59,5 @@
 		void saveSettings(vidEncOptions *encodeOptions, Mpeg2Options *options);
 		int getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize);
 		int setOptions(vidEncOptions *encodeOptions, const char *pluginOptions);
-		int open(vidEncVideoProperties *properties);
-		int beginPass(vidEncPassParameters *passParameters);
-		int encodeFrame(vidEncEncodeParameters *encodeParams);
-		int finishPass(void);
 };
 #endif	// mpeg2Encoder_h

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Options.cpp	2010-04-05 18:05:56 UTC (rev 6057)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Options.cpp	2010-04-05 18:32:22 UTC (rev 6058)
@@ -40,7 +40,7 @@
 {
 	PluginOptions::reset();
 
-	setMaxBitrate(2500);
+	setMaxBitrate(9000);
 	setStreamType(MPEG2_STREAMTYPE_DVD);
 	setWidescreen(false);
 	setInterlaced(MPEG2_INTERLACED_NONE);

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/CMakeLists.txt	2010-04-05 18:05:56 UTC (rev 6057)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/CMakeLists.txt	2010-04-05 18:32:22 UTC (rev 6058)
@@ -41,4 +41,8 @@
 	ENDIF (NOT APPLE)
 ENDIF (ADM_CPU_X86)
 
-add_library(${ADM_LIB} ${${ADM_LIB}_SRCS})
\ No newline at end of file
+add_library(${ADM_LIB} ${${ADM_LIB}_SRCS})
+
+if (UNIX)
+	add_target_cflags(mpeg2enc -fPIC)
+endif (UNIX)
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/CMakeLists.txt	2010-04-05 18:05:56 UTC (rev 6057)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/CMakeLists.txt	2010-04-05 18:32:22 UTC (rev 6058)
@@ -1,4 +1,5 @@
 add_subdirectory(common)
 ADD_SUBDIRECTORY(ADM_vidEnc_avcodec)
 ADD_SUBDIRECTORY(ADM_vidEnc_x264)
-ADD_SUBDIRECTORY(ADM_vidEnc_xvid)
\ No newline at end of file
+ADD_SUBDIRECTORY(ADM_vidEnc_xvid)
+add_subdirectory(ADM_vidEnc_mpeg2enc)
\ No newline at end of file



From gruntster at mail.berlios.de  Mon Apr  5 20:37:23 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 5 Apr 2010 20:37:23 +0200
Subject: [Avidemux-svn-commit] r6059 -
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF
Message-ID: <201004051837.o35IbNag003393@sheep.berlios.de>

Author: gruntster
Date: 2010-04-05 20:37:18 +0200 (Mon, 05 Apr 2010)
New Revision: 6059

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp
Log:
[mpeg] add support for delayed frames to mpeg muxer

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp	2010-04-05 18:32:22 UTC (rev 6058)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp	2010-04-05 18:37:18 UTC (rev 6059)
@@ -18,7 +18,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-
+#define __STDC_LIMIT_MACROS
 #include "config.h"
 
 #ifdef USE_FFMPEG
@@ -78,6 +78,8 @@
 uint32_t audioSum=0;
 DIA_encoding  *encoding = NULL;
 int reuse = 0;
+int r = 0;
+int frameDelay = 0;
 
         twoPass=new char[strlen(name)+6];
         twoFake=new char[strlen(name)+6];
@@ -234,32 +236,66 @@
                 ADM_assert(0);
           }
 
+		// pass 1
+		if(encoder->isDualPass()) //Cannot be requant
+		{
+			if (!reuse)
+			{
+				encoding->setPhasis(QT_TR_NOOP("Pass 1/2"));
+				encoder->startPass1();
 
+				bitstream.data = _buffer;
+				bitstream.bufferSize = _page;
 
-        // pass 1
-        if(encoder->isDualPass()) //Cannot be requant
-        {
-                        if(!reuse)
-                        {
-                                encoding->setPhasis (QT_TR_NOOP("Pass 1/2"));
-                                encoder->startPass1();
-                                bitstream.data=_buffer;
-                                bitstream.bufferSize=_page;
-                                for(uint32_t i=0;i<total;i++)
-                                {
-                                        bitstream.cleanup(i);
-                                        if(!encoder->encode( i, &bitstream))//&len,(uint8_t *) _buffer,&flags))
-                                        {
-                                          GUI_Error_HIG(QT_TR_NOOP("Error in pass 1"), NULL);
-                                        }
-                                        encoding->setFrame(i,bitstream.len,bitstream.out_quantizer,total);
-                                        if(!encoding->isAlive())
-                                              goto finishvcdff;
-                                }
-                        }
-                        encoder->startPass2();
-                        encoding->reset();
-                }
+				for(uint32_t frame = 0; frame < total; frame++)
+				{
+					if (!encoding->isAlive())
+					{
+						r = 0;
+						break;
+					}
+
+					for (;;)
+					{
+						bitstream.cleanup(frame);
+
+						if (frame + frameDelay >= total)
+						{
+							if (encoder->getRequirements() & ADM_ENC_REQ_NULL_FLUSH)
+								r = encoder->encode(UINT32_MAX, &bitstream);
+							else
+								r = 0;
+						}
+						else
+							r = encoder->encode(frame + frameDelay, &bitstream);
+
+						if (!r)
+						{
+							printf("Encoding of frame %lu failed!\n", frame);
+							GUI_Error_HIG(QT_TR_NOOP("Error while encoding"), NULL);
+
+							break;
+						}
+
+						if (bitstream.len == 0 && (encoder->getRequirements() & ADM_ENC_REQ_NULL_FLUSH))
+						{
+							printf("skipping frame: %u size: %i\n", frame + frameDelay, bitstream.len);
+							frameDelay++;
+						}
+						else
+							break;
+					}
+
+					if (!r)
+						goto finishvcdff;
+
+					encoding->setFrame(frame, bitstream.len, bitstream. out_quantizer, total);
+				}
+			}
+
+			encoder->startPass2();
+			encoding->reset();
+		}
                 
               switch(type)
               {
@@ -387,54 +423,82 @@
 
       bitstream.data=_outbuffer;
       bitstream.bufferSize=_page;
-      for(uint32_t i=0;i<total;i++)
-      {
-       	// get frame
-                bitstream.cleanup(i);
-                if(!encoder->encode( i,&bitstream))// &len,(uint8_t *) _outbuffer,&flags))
-                {
-                  GUI_Error_HIG(QT_TR_NOOP("Error in pass 2"), NULL);
-                        goto finishvcdff;
-                }
-                if(!bitstream.len) continue;
-                
-                if(file)
-                {
-                    fwrite(_outbuffer,bitstream.len,1,file);
-                }
-                else
-                {
-                        uint32_t samples; 
-                        
-                        //printf("%lu %lu\n",i,dts);
-                        
-                        muxer->writeVideoPacket(&bitstream);
-                        real_framenum++;
-                        // _muxer->writeVideoPacket(len,_buffer_out,
-                        //i-MPEG_PREFILL,_codec->getCodedPictureNumber());
-                        if(total_sample<sample_target)
-                        {
-                            while(muxer->needAudio() && total_sample<sample_target) 
-                            {				
-                                if(!audio->getPacket(audioBuffer, &audioLen, &samples))	
-                                { 
-                                        break; 
-                                }
-                                if(audioLen) 
-                                {
-                                        muxer->writeAudioPacket(audioLen,audioBuffer); 
-                                        total_sample+=samples;
-                                        audioSum+=audioLen;
-                                }
-                            }
-                        }
-                
-                }
-                encoding->setFrame(i,bitstream.len,bitstream.out_quantizer,total);
-                encoding->setAudioSize(audioSum);
-                if(!encoding->isAlive ())
-                                  goto finishvcdff;
-        }
+	  r = frameDelay = 0;
+
+	  for(uint32_t frame = 0; frame < total; frame++)
+	  {
+		  if (!encoding->isAlive())
+		  {
+			  r = 0;
+			  break;
+		  }
+
+		  for (;;)
+		  {
+			  bitstream.cleanup(frame);
+
+			  if (frame + frameDelay >= total)
+			  {
+				  if (encoder->getRequirements() & ADM_ENC_REQ_NULL_FLUSH)
+					  r = encoder->encode(UINT32_MAX, &bitstream);
+				  else
+					  r = 0;
+			  }
+			  else
+				  r = encoder->encode(frame + frameDelay, &bitstream);
+
+			  if (!r)
+			  {
+				  printf("Encoding of frame %lu failed!\n", frame);
+				  GUI_Error_HIG(QT_TR_NOOP("Error while encoding"), NULL);
+				  break;
+			  }
+
+			  if (bitstream.len == 0 && (encoder->getRequirements() & ADM_ENC_REQ_NULL_FLUSH))
+			  {
+				  printf("skipping frame: %u size: %i\n", frame + frameDelay, bitstream.len);
+				  frameDelay++;
+			  }
+			  else
+				  break;
+		  }
+
+		  if (!r)
+			  goto finishvcdff;
+
+		  if(file)
+		  {
+			  fwrite(_outbuffer,bitstream.len,1,file);
+		  }
+		  else
+		  {
+			  muxer->writeVideoPacket(&bitstream);
+			  real_framenum++;
+
+			  if(total_sample < sample_target)
+			  {
+				  uint32_t samples;
+
+				  while(muxer->needAudio() && total_sample < sample_target) 
+				  {				
+					  if (!audio->getPacket(audioBuffer, &audioLen, &samples))	
+						  break; 
+
+					  if(audioLen) 
+					  {
+						  muxer->writeAudioPacket(audioLen, audioBuffer); 
+						  total_sample += samples;
+						  audioSum += audioLen;
+					  }
+				  }
+			  }
+
+		  }
+
+		  encoding->setFrame(frame, bitstream.len, bitstream.out_quantizer, total);
+		  encoding->setAudioSize(audioSum);
+	  }
+
         ret=1;
 finishvcdff:
         printf("[MPEGFF] Finishing..\n");



From gruntster at mail.berlios.de  Mon Apr  5 20:44:36 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 5 Apr 2010 20:44:36 +0200
Subject: [Avidemux-svn-commit] r6060 -
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec
Message-ID: <201004051844.o35Iia7X003643@sheep.berlios.de>

Author: gruntster
Date: 2010-04-05 20:44:30 +0200 (Mon, 05 Apr 2010)
New Revision: 6060

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mjpegEncoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mjpegEncoder.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg2Encoder.cpp
Log:
[avcodec] video encoder tidy-ups for avcodec plugin

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/encoder.cpp	2010-04-05 18:37:18 UTC (rev 6059)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/encoder.cpp	2010-04-05 18:44:30 UTC (rev 6060)
@@ -159,6 +159,9 @@
 
 void AvcodecEncoder::init(enum CodecID id, int targetColourSpace)
 {
+	avcodec_init();
+    avcodec_register_all();
+
 	_codecId = id;
 	_opened = false;
 
@@ -182,7 +185,12 @@
 
 AVCodec *AvcodecEncoder::getAvCodec(void)
 {
-	return avcodec_find_encoder(_codecId);
+	AVCodec *codec = avcodec_find_encoder(_codecId);
+
+	if (codec == NULL)
+		printf("Unable to initialise encoder: %d\n", _codecId);
+
+	return codec;
 }
 
 enum PixelFormat AvcodecEncoder::getAvCodecColourSpace(int colourSpace)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mjpegEncoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mjpegEncoder.cpp	2010-04-05 18:37:18 UTC (rev 6059)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mjpegEncoder.cpp	2010-04-05 18:44:30 UTC (rev 6060)
@@ -233,15 +233,6 @@
 	return ret;
 }
 
-int MjpegEncoder::encodeFrame(vidEncEncodeParameters *encodeParams)
-{
-	int ret = AvcodecEncoder::encodeFrame(encodeParams);
-
-	printf("_frame.quality: %d\n", _frame.quality);
-
-	return ret;
-}
-
 void MjpegEncoder::updateEncodeProperties(vidEncOptions *encodeOptions)
 {
 	_passCount = 1;

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mjpegEncoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mjpegEncoder.h	2010-04-05 18:37:18 UTC (rev 6059)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mjpegEncoder.h	2010-04-05 18:44:30 UTC (rev 6060)
@@ -54,7 +54,6 @@
 		int getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize);
 		int setOptions(vidEncOptions *encodeOptions, const char *pluginOptions);
 		int beginPass(vidEncPassParameters *passParameters);
-		int encodeFrame(vidEncEncodeParameters *encodeParams);
 };
 #endif	// __cplusplus
 #endif	// MjpegEncoder_h

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg2Encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg2Encoder.cpp	2010-04-05 18:37:18 UTC (rev 6059)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg2Encoder.cpp	2010-04-05 18:44:30 UTC (rev 6060)
@@ -198,6 +198,8 @@
 			else
 				ret = ADM_VIDENC_ERR_FAILED;
 		}
+
+		delete [] log;
 	}
 
 	if (_encodeOptions.encodeMode == ADM_VIDENC_MODE_CQP || _encodeOptions.encodeMode == ADM_VIDENC_MODE_CBR || 



From gruntster at mail.berlios.de  Mon Apr  5 23:07:14 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 5 Apr 2010 23:07:14 +0200
Subject: [Avidemux-svn-commit] r6061 -
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc
Message-ID: <201004052107.o35L7EnU016304@sheep.berlios.de>

Author: gruntster
Date: 2010-04-05 23:07:07 +0200 (Mon, 05 Apr 2010)
New Revision: 6061

Added:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.h
Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/interface.c
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.h
Log:
[mpeg2enc] port mpeg2enc logic for MPEG-1 to plugin

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/CMakeLists.txt	2010-04-05 18:44:30 UTC (rev 6060)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/CMakeLists.txt	2010-04-05 21:07:07 UTC (rev 6061)
@@ -2,7 +2,7 @@
 INCLUDE(admPluginVideoEncoder)
 
 add_subdirectory(mpeg2enc)
-SET(ADM_vidEnc_mpeg2enc_SRCS  interface.c  encoder.cpp  mpeg2Encoder.cpp  mpeg2Options.cpp)
+SET(ADM_vidEnc_mpeg2enc_SRCS  interface.c  encoder.cpp  mpeg1Encoder.cpp  mpeg2Encoder.cpp  mpeg2Options.cpp)
 
 INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR} ${LIBXML2_INCLUDE_DIR} ../common/pluginOptions ../common/xvidRateCtl mpeg2enc)
 ADD_DEFINITIONS(${LIBXML2_DEFINITIONS} -DMPEG2_PLUGIN_CONFIG_DIR="mpegenc")

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/encoder.cpp	2010-04-05 18:44:30 UTC (rev 6060)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/encoder.cpp	2010-04-05 21:07:07 UTC (rev 6061)
@@ -17,16 +17,18 @@
 #include <libxml/tree.h>
 
 #include "encoder.h"
+#include "mpeg1Encoder.h"
 #include "mpeg2Encoder.h"
 #include "ADM_inttype.h"
 #include "mpeg2enc.h"
 
 int uiType;
 
+static Mpeg1Encoder mpeg1;
 static Mpeg2Encoder mpeg2;
 
-static int encoderIds[] = { 0 };
-static Mpeg2encEncoder* encoders[] = {&mpeg2};
+static int encoderIds[] = { 0, 1 };
+static Mpeg2encEncoder* encoders[] = {&mpeg1, &mpeg2};
 static int supportedCsps[] = { ADM_CSP_YV12 };
 
 extern int mpegenc_encode(char *in, char *out, int *size, int *flags, int *quant);

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/interface.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/interface.c	2010-04-05 18:44:30 UTC (rev 6060)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/interface.c	2010-04-05 21:07:07 UTC (rev 6061)
@@ -71,7 +71,7 @@
 void vidEncGetEncoderVersion(int encoderId, int* major, int* minor, int* patch)
 {
 	*major = 1;
-	*minor = 5;
+	*minor = 0;
 	*patch = 0;
 }
 

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.cpp	2010-04-05 18:44:30 UTC (rev 6060)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.cpp	2010-04-05 21:07:07 UTC (rev 6061)
@@ -0,0 +1,81 @@
+ /***************************************************************************
+                               mpeg1Encoder.cpp
+
+    begin                : Mon Apr 5 2010
+    copyright            : (C) 2010 by gruntster
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include <math.h>
+#include <libxml/tree.h>
+
+#include "ADM_inttype.h"
+#include "mpeg1Encoder.h"
+#include "format_codes.h"
+
+extern int _uiType;
+static bool changedConfig(const char* fileName, ConfigMenuType configType);
+
+#ifdef __WIN32
+extern void convertPathToAnsi(const char *path, char **ansiPath);
+#endif
+
+Mpeg1Encoder::Mpeg1Encoder(void)
+{
+	_passCount = 1;
+	_encodeOptions.encodeMode == ADM_VIDENC_MODE_CBR;
+}
+
+const char* Mpeg1Encoder::getEncoderType(void)
+{
+	return "MPEG-1";
+}
+
+const char* Mpeg1Encoder::getEncoderDescription(void)
+{
+	return "MPEG-1 video encoder plugin for Avidemux (c) Mean/Gruntster";
+}
+
+const char* Mpeg1Encoder::getFourCC(void)
+{
+	return "mpg1";
+}
+
+const char* Mpeg1Encoder::getEncoderGuid(void)
+{
+	return "056FE919-C1D3-4450-A812-A767EAB07786";
+}
+
+int Mpeg1Encoder::getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize)
+{
+	if (encodeOptions)
+	{
+		encodeOptions->encodeMode = ADM_VIDENC_MODE_CBR;
+		encodeOptions->encodeModeParameter = 1000;
+	}
+
+	return 0;
+}
+
+int Mpeg1Encoder::setOptions(vidEncOptions *encodeOptions, const char *pluginOptions)
+{
+	return ADM_VIDENC_ERR_SUCCESS;
+}
+
+int Mpeg1Encoder::initParameters(int *encodeModeParameter, int *maxBitrate, int *vbv)
+{
+	_param.fieldenc = 0;
+	_param.format = MPEG_FORMAT_VCD;
+	_param.aspect_ratio = 2;
+	_param.min_GOP_size = _param.max_GOP_size = 18;
+	*encodeModeParameter = 1000;
+	*maxBitrate = 9216000;
+	*vbv = 0;
+}

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.h	2010-04-05 18:44:30 UTC (rev 6060)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.h	2010-04-05 21:07:07 UTC (rev 6061)
@@ -0,0 +1,49 @@
+ /***************************************************************************
+                                mpeg1Encoder.h
+
+    begin                : Mon Apr 5 2010
+    copyright            : (C) 2010 by gruntster
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef mpeg1Encoder_h
+#define mpeg1Encoder_h
+
+extern "C"
+{
+	#include "ADM_vidEnc_plugin.h"
+}
+
+#include <limits.h>
+
+#include "encoder.h"
+#include "DIA_factory.h"
+
+class Mpeg1Encoder : public Mpeg2encEncoder
+{
+	private:
+		vidEncVideoProperties _properties;
+
+		int _bufferSize;
+		uint8_t *_buffer;
+
+		int initParameters(int *encodeModeParameter, int *maxBitrate, int *vbv);
+
+	public:
+		Mpeg1Encoder(void);
+		const char* getEncoderType(void);
+		const char* getEncoderDescription(void);
+		const char* getFourCC(void);
+		const char* getEncoderGuid(void);
+		int getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize);
+		int setOptions(vidEncOptions *encodeOptions, const char *pluginOptions);
+};
+#endif	// mpeg1Encoder_h

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.cpp	2010-04-05 18:44:30 UTC (rev 6060)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.cpp	2010-04-05 21:07:07 UTC (rev 6061)
@@ -51,7 +51,7 @@
 
 const char* Mpeg2Encoder::getEncoderDescription(void)
 {
-	return "mpeg2enc video encoder plugin for Avidemux (c) Mean/Gruntster";
+	return "MPEG-2 video encoder plugin for Avidemux (c) Mean/Gruntster";
 }
 
 const char* Mpeg2Encoder::getFourCC(void)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.h	2010-04-05 18:44:30 UTC (rev 6060)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.h	2010-04-05 21:07:07 UTC (rev 6061)
@@ -27,7 +27,6 @@
 #include "encoder.h"
 #include "mpeg2Options.h"
 #include "DIA_factory.h"
-#include "xvidRateCtlVbv.h"
 
 class Mpeg2Encoder : public Mpeg2encEncoder
 {



From gruntster at mail.berlios.de  Mon Apr  5 23:11:25 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 5 Apr 2010 23:11:25 +0200
Subject: [Avidemux-svn-commit] r6062 -
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder
Message-ID: <201004052111.o35LBPAc016492@sheep.berlios.de>

Author: gruntster
Date: 2010-04-05 23:11:21 +0200 (Mon, 05 Apr 2010)
New Revision: 6062

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp
Log:
[mpeg] update mpeg muxer to support mpeg2enc plugin

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp	2010-04-05 21:07:07 UTC (rev 6061)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp	2010-04-05 21:11:21 UTC (rev 6062)
@@ -81,11 +81,19 @@
 }
 CodecFamilty videoCodecGetFamily(void)
 {
-	if ((currentCodecType == CodecExternal && strcmp(videoCodecPluginGetGuid(), "85FC9CAC-CE6C-4aa6-9D5F-352D6349BA3E") == 0) ||
-		(currentCodecType == CodecExternal && strcmp(videoCodecPluginGetGuid(), "DBAECD8B-CF29-4846-AF57-B596427FE7D3") == 0))
+	if (currentCodecType == CodecExternal && (
+		strcmp(videoCodecPluginGetGuid(), "85FC9CAC-CE6C-4aa6-9D5F-352D6349BA3E") == 0 || // avcodec MPEG-1 plugin
+		strcmp(videoCodecPluginGetGuid(), "DBAECD8B-CF29-4846-AF57-B596427FE7D3") == 0))  // avcodec MPEG-2 plugin
+	{
 		return CodecFamilyXVCD;
-	if (currentCodecType == CodecVCD || currentCodecType == CodecSVCD || currentCodecType == CodecDVD || currentCodecType == CodecRequant)
+	}
+	else if ((currentCodecType == CodecExternal && (
+		strcmp(videoCodecPluginGetGuid(), "056FE919-C1D3-4450-A812-A767EAB07786") == 0 || // mpeg2enc MPEG-1 plugin
+		strcmp(videoCodecPluginGetGuid(), "C16E9CCE-D9B3-4fbe-B0C5-8B1BEBF2178E") == 0)) || // mpeg2enc MPEG-2 plugin
+		currentCodecType == CodecVCD || currentCodecType == CodecSVCD || currentCodecType == CodecDVD || currentCodecType == CodecRequant)
+	{
 		return CodecFamilyMpeg;
+	}
 
 	return CodecFamilyAVI;
 }



From gruntster at mail.berlios.de  Mon Apr  5 23:14:34 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 5 Apr 2010 23:14:34 +0200
Subject: [Avidemux-svn-commit] r6063 - in
	branches/avidemux_2.5_branch_gruntster: avidemux/ADM_encoder
	avidemux/ADM_libraries
	avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog
	plugins/ADM_videoEncoder/ADM_vidEnc_avcodec
	plugins/ADM_videoFilters/Decimate
Message-ID: <201004052114.o35LEYZ9016897@sheep.berlios.de>

Author: gruntster
Date: 2010-04-05 23:14:29 +0200 (Mon, 05 Apr 2010)
New Revision: 6063

Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libsamplerate/
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libtwolame/
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/dvEncoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Decimate/ADM_vidDecDec_param.h
Log:
[misc] cosmetic tidy-ups

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.cpp	2010-04-05 21:11:21 UTC (rev 6062)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_externalEncoder.cpp	2010-04-05 21:14:29 UTC (rev 6063)
@@ -150,8 +150,6 @@
 uint8_t externalEncoder::encode(uint32_t frame, ADMBitstream *out)
 {
 	uint32_t l, f;
-	int outLength, videoFrameType;
-	int64_t ptsFrame;
 	vidEncEncodeParameters params;
 
 	if (frame != UINT32_MAX && !_in->getFrameNumberNoAlloc(frame, &l, _vbuffer, &f))

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp	2010-04-05 21:11:21 UTC (rev 6062)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp	2010-04-05 21:14:29 UTC (rev 6063)
@@ -1,328 +1,328 @@
-#include "ADM_toolkitGtk.h"
-#include "DIA_coreToolkit.h"
-
-static GtkWidget       *create_dialog1 (void);
-static void             updateStatus(void);
-static int              getSelection(GtkWidget *dialog);
-extern bool parseECMAScript(const char *name);
-static const char *StringStatus[]={QT_TR_NOOP("Ready"),QT_TR_NOOP("Succeeded"),QT_TR_NOOP("Failed"),QT_TR_NOOP("Deleted"),QT_TR_NOOP("Running")};
-
-
-typedef enum 
-{
-        STATUS_READY=0,
-        STATUS_SUCCEED,
-        STATUS_FAILED,
-        STATUS_DELETED,
-        STATUS_RUNNING
-}JOB_STATUS;
-
-
-typedef struct ADM_Job_Descriptor
-{
-  JOB_STATUS  status;
-  ADM_date    startDate;
-  ADM_date    endDate;
-};
-
-typedef enum 
-{
-        COMMAND_DELETE_ALL=1,
-        COMMAND_DELETE=2,
-        COMMAND_RUN_ALL=3,
-        COMMAND_RUN=4
-};
-
-
-typedef struct JobsDescriptor
-{
-        GtkWidget *dialog;
-        GtkListStore *store;
-        uint32_t  nb;
-        char      **name;
-        ADM_Job_Descriptor *status;
-}JobsDescriptor;
-
-static JobsDescriptor jobs;
-
-uint8_t  DIA_job(uint32_t nb, char **name)
-{
-GtkListStore *store;
-
-GtkTreeViewColumn *column,*column2,*column3;
-GtkCellRenderer *renderer;
-
-        int ret=0;
-        
-
-
-        GtkWidget *dialog;
-
-        dialog=create_dialog1();
-
+#include "ADM_toolkitGtk.h"
+#include "DIA_coreToolkit.h"
+
+static GtkWidget       *create_dialog1 (void);
+static void             updateStatus(void);
+static int              getSelection(GtkWidget *dialog);
+extern bool parseECMAScript(const char *name);
+static const char *StringStatus[]={QT_TR_NOOP("Ready"),QT_TR_NOOP("Succeeded"),QT_TR_NOOP("Failed"),QT_TR_NOOP("Deleted"),QT_TR_NOOP("Running")};
+
+
+typedef enum 
+{
+        STATUS_READY=0,
+        STATUS_SUCCEED,
+        STATUS_FAILED,
+        STATUS_DELETED,
+        STATUS_RUNNING
+}JOB_STATUS;
+
+
+struct ADM_Job_Descriptor
+{
+  JOB_STATUS  status;
+  ADM_date    startDate;
+  ADM_date    endDate;
+};
+
+enum 
+{
+        COMMAND_DELETE_ALL=1,
+        COMMAND_DELETE=2,
+        COMMAND_RUN_ALL=3,
+        COMMAND_RUN=4
+};
+
+
+typedef struct JobsDescriptor
+{
+        GtkWidget *dialog;
+        GtkListStore *store;
+        uint32_t  nb;
+        char      **name;
+        ADM_Job_Descriptor *status;
+}JobsDescriptor;
+
+static JobsDescriptor jobs;
+
+uint8_t  DIA_job(uint32_t nb, char **name)
+{
+GtkListStore *store;
+
+GtkTreeViewColumn *column,*column2,*column3;
+GtkCellRenderer *renderer;
+
+        int ret=0;
+        
+
+
+        GtkWidget *dialog;
+
+        dialog=create_dialog1();
+
 		gtk_dialog_set_alternative_button_order(GTK_DIALOG(dialog),
 									GTK_RESPONSE_OK,
 									GTK_RESPONSE_CANCEL,
-									-1);
-
-        gtk_register_dialog(dialog);
-        
-        
-        store=gtk_list_store_new (3, G_TYPE_STRING, G_TYPE_STRING,G_TYPE_STRING);
-        
-        // initialize our job structure
-        jobs.dialog=dialog;
-        jobs.nb=nb;
-        jobs.name=name;
-        jobs.status=new ADM_Job_Descriptor[nb];
-        jobs.store=store;
-        memset(jobs.status,0,jobs.nb*sizeof(ADM_Job_Descriptor));
-
-        gtk_tree_view_set_model(GTK_TREE_VIEW(WID(treeview1)),GTK_TREE_MODEL (store));
-        gtk_tree_view_columns_autosize(GTK_TREE_VIEW(WID(treeview1)));
-
-        // Add columns
-
-        renderer = gtk_cell_renderer_text_new ();
-        column = gtk_tree_view_column_new_with_attributes (QT_TR_NOOP("  Job Name  "), renderer,
-                                                      "markup", (GdkModifierType) 0,
-                                                      NULL);
-        gtk_tree_view_append_column (GTK_TREE_VIEW (WID(treeview1)), column);
-
-        column2 = gtk_tree_view_column_new_with_attributes (QT_TR_NOOP("Started at"), renderer,
-                                                      "markup", (GdkModifierType) 1,
-                                                      NULL);
-        gtk_tree_view_append_column (GTK_TREE_VIEW (WID(treeview1)), column2);
-        column3 = gtk_tree_view_column_new_with_attributes (QT_TR_NOOP("Finished at"), renderer,
-            "markup", (GdkModifierType) 2,
-            NULL);
-        gtk_tree_view_append_column (GTK_TREE_VIEW (WID(treeview1)), column3);
-
-        //
-        #define ASSOCIATE(x,y)   gtk_dialog_add_action_widget (GTK_DIALOG (dialog), WID(x),y)
-            ASSOCIATE(buttonDelete,COMMAND_DELETE);
-            ASSOCIATE(buttonDeleteAll,COMMAND_DELETE_ALL);
-            ASSOCIATE(buttonRunAll,COMMAND_RUN_ALL);
-            ASSOCIATE(buttonRun,COMMAND_RUN);
-        //
-         
-        int running=1;
-        gtk_widget_set_usize(WID(treeview1), 180, 300);
-        while(running)
-        {
-                int sel=0,event;
-                updateStatus();
-                switch(event=gtk_dialog_run(GTK_DIALOG(dialog)))
-                {
-                        case GTK_RESPONSE_OK : running=0;break;
-                        case GTK_RESPONSE_APPLY : running=0;break;
-                        case GTK_RESPONSE_CANCEL :
-                        case GTK_RESPONSE_DELETE_EVENT:
-                                         running=0;break;
-                        case COMMAND_DELETE_ALL:
-                                        if(GUI_Confirmation_HIG(QT_TR_NOOP("Sure!"),QT_TR_NOOP("Delete ALL jobs"),QT_TR_NOOP("Are you sure you want to delete all jobs ?")))
-                                        {
-                                                for(int i=0;i<jobs.nb;i++) jobs.status[i].status=STATUS_DELETED;
-                                        }
-                                        break;
-                        case COMMAND_RUN: 
-                                        sel=getSelection(jobs.dialog);
-                                        if(sel>=jobs.nb) break;
-                                        jobs.status[sel].status=STATUS_RUNNING;
-                                        updateStatus();
-                                        GUI_Quiet();
-                                        TLK_getDate(&(jobs.status[sel].startDate));
-                                        if(parseECMAScript(jobs.name[sel])) jobs.status[sel].status=STATUS_SUCCEED;
-                                        else jobs.status[sel].status=STATUS_FAILED;
-                                        TLK_getDate(&(jobs.status[sel].endDate));
-                                        updateStatus();
-                                        GUI_Verbose();
-                                        break;
-                        case COMMAND_RUN_ALL: 
-                                        GUI_Quiet();
-                                        for(int i=0;i<jobs.nb;i++)
-                                        {
-                                          if(jobs.status[i].status==STATUS_DELETED) continue;
-                                          if(jobs.status[i].status==STATUS_SUCCEED) continue;
-                                          jobs.status[i].status=STATUS_RUNNING;
-                                          TLK_getDate(&(jobs.status[i].startDate));
-                                          updateStatus();
-                                          if(parseECMAScript(jobs.name[i])) jobs.status[i].status=STATUS_SUCCEED;
-                                                        else jobs.status[i].status=STATUS_FAILED;
-                                        TLK_getDate(&(jobs.status[i].endDate));
-
-                                        }
-                                        updateStatus();
-                                        GUI_Verbose();
-                                        break;
-                        case COMMAND_DELETE: 
-                                        sel=getSelection(jobs.dialog);
-                                        if(sel>=jobs.nb) break;
-                                        if(GUI_Confirmation_HIG(QT_TR_NOOP("Sure!"),QT_TR_NOOP("Delete job"),QT_TR_NOOP("Are you sure you want to delete %s job ?"),ADM_GetFileName(jobs.name[sel])))
-                                        {
-                                                jobs.status[sel].status=STATUS_DELETED;
-                                        }
-                                        break;
-
-                        
-                        default:
-                                printf("Event:%d\n",event); 
-                                GUI_Error_HIG("Jobs",QT_TR_NOOP("Unknown event"));break;
-                }
-                
-        }
-        gtk_unregister_dialog(dialog);
-        gtk_widget_destroy(dialog);
-
-        // Now delete the "deleted" jobs
-        for(int i=0;i<jobs.nb;i++)
-        {
-                if(jobs.status[i].status==STATUS_DELETED)
-                {
-                        unlink(jobs.name[i]);
-                }
-
-        }
-
-        delete [] jobs.status;
-
-        return ret;
-}
-//**************************************************
-int              getSelection(GtkWidget *dialog)
-{
-uint32_t n=0xffff;
-        if(! getSelectionNumber(jobs.nb,WID(treeview1) , jobs.store,&n)) return 0xffff;
-        return n;
-}
-//*************************************
-void updateStatus(void)
-{
-GtkTreeIter iter;
-char *str;
-ADM_date  *date;
-char *str1,str2[200],str3[200];
-
-        gtk_list_store_clear (jobs.store);
-        for (uint32_t i = 0; i < jobs.nb; i++)
-        {
-               str1 = g_markup_printf_escaped("<span weight=\"heavy\">%s</span>\n" 
-               "<span size=\"smaller\" style=\"oblique\">%s</span>"
-                , ADM_GetFileName(jobs.name[i]), StringStatus[jobs.status[i].status]);
-
-                date=&(jobs.status[i].startDate);
-                sprintf(str2,"%02d:%02d:%02d",date->hours,
-                                          date->minutes,
-                                          date->seconds);
-
-                date=&(jobs.status[i].endDate);
-                sprintf(str3,"%02d:%02d:%02d",date->hours,
-                        date->minutes,
-                        date->seconds);
-
-                gtk_list_store_append (jobs.store, &iter);
-                gtk_list_store_set (jobs.store, &iter, 0,str1,1,str2,2,str3,-1);
-                printf("Start : %s\n",str2);
-                printf("End : %s\n",str3);
-
-				g_free(str1);
-        }
-}
-//*************************************
-
-GtkWidget*
-create_dialog1 (void)
-{
-  GtkWidget *dialog1;
-  GtkWidget *dialog_vbox1;
-  GtkWidget *hbox1;
-  GtkWidget *scrolledwindow1;
-  GtkWidget *treeview1;
-  GtkWidget *vbuttonbox1;
-  GtkWidget *buttonDeleteAll;
-  GtkWidget *buttonDelete;
-  GtkWidget *buttonRunAll;
-  GtkWidget *buttonRun;
-  GtkWidget *dialog_action_area1;
-  GtkWidget *cancelbutton1;
-  GtkWidget *okbutton1;
-
-  dialog1 = gtk_dialog_new ();
-  gtk_window_set_title (GTK_WINDOW (dialog1), QT_TR_NOOP("Jobs"));
-  gtk_window_set_type_hint (GTK_WINDOW (dialog1), GDK_WINDOW_TYPE_HINT_DIALOG);
-
-  dialog_vbox1 = GTK_DIALOG (dialog1)->vbox;
-  gtk_widget_show (dialog_vbox1);
-
-  hbox1 = gtk_hbox_new (FALSE, 0);
-  gtk_widget_show (hbox1);
-  gtk_box_pack_start (GTK_BOX (dialog_vbox1), hbox1, TRUE, TRUE, 0);
-
-  scrolledwindow1 = gtk_scrolled_window_new (NULL, NULL);
-  gtk_widget_show (scrolledwindow1);
-  gtk_box_pack_start (GTK_BOX (hbox1), scrolledwindow1, TRUE, TRUE, 0);
-  gtk_scrolled_window_set_policy (GTK_SCROLLED_WINDOW (scrolledwindow1), GTK_POLICY_AUTOMATIC, GTK_POLICY_AUTOMATIC);
-  gtk_scrolled_window_set_shadow_type (GTK_SCROLLED_WINDOW (scrolledwindow1), GTK_SHADOW_IN);
-
-  treeview1 = gtk_tree_view_new ();
-  gtk_widget_show (treeview1);
-  gtk_container_add (GTK_CONTAINER (scrolledwindow1), treeview1);
-  //gtk_widget_set_size_request (treeview1, 300, -1);
-
-  vbuttonbox1 = gtk_vbutton_box_new ();
-  gtk_widget_show (vbuttonbox1);
-  gtk_box_pack_start (GTK_BOX (hbox1), vbuttonbox1, FALSE, FALSE, 0);
-  gtk_button_box_set_layout (GTK_BUTTON_BOX (vbuttonbox1), GTK_BUTTONBOX_START);
-
-  buttonDeleteAll = gtk_button_new_with_mnemonic (QT_TR_NOOP("Delete All Jobs"));
-  gtk_widget_show (buttonDeleteAll);
-  gtk_container_add (GTK_CONTAINER (vbuttonbox1), buttonDeleteAll);
-  GTK_WIDGET_SET_FLAGS (buttonDeleteAll, GTK_CAN_DEFAULT);
-
-  buttonDelete = gtk_button_new_with_mnemonic (QT_TR_NOOP("Delete Job"));
-  gtk_widget_show (buttonDelete);
-  gtk_container_add (GTK_CONTAINER (vbuttonbox1), buttonDelete);
-  GTK_WIDGET_SET_FLAGS (buttonDelete, GTK_CAN_DEFAULT);
-
-  buttonRunAll = gtk_button_new_with_mnemonic (QT_TR_NOOP("Run all jobs"));
-  gtk_widget_show (buttonRunAll);
-  gtk_container_add (GTK_CONTAINER (vbuttonbox1), buttonRunAll);
-  GTK_WIDGET_SET_FLAGS (buttonRunAll, GTK_CAN_DEFAULT);
-
-  buttonRun = gtk_button_new_with_mnemonic (QT_TR_NOOP("Run Job"));
-  gtk_widget_show (buttonRun);
-  gtk_container_add (GTK_CONTAINER (vbuttonbox1), buttonRun);
-  GTK_WIDGET_SET_FLAGS (buttonRun, GTK_CAN_DEFAULT);
-
-  dialog_action_area1 = GTK_DIALOG (dialog1)->action_area;
-  gtk_widget_show (dialog_action_area1);
-  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialog_action_area1), GTK_BUTTONBOX_END);
-
-  cancelbutton1 = gtk_button_new_from_stock ("gtk-cancel");
-  gtk_widget_show (cancelbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), cancelbutton1, GTK_RESPONSE_CANCEL);
-  GTK_WIDGET_SET_FLAGS (cancelbutton1, GTK_CAN_DEFAULT);
-
-  okbutton1 = gtk_button_new_from_stock ("gtk-ok");
-  gtk_widget_show (okbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), okbutton1, GTK_RESPONSE_OK);
-  GTK_WIDGET_SET_FLAGS (okbutton1, GTK_CAN_DEFAULT);
-
-  /* Store pointers to all widgets, for use by lookup_widget(). */
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog1, "dialog1");
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_vbox1, "dialog_vbox1");
-  GLADE_HOOKUP_OBJECT (dialog1, hbox1, "hbox1");
-  GLADE_HOOKUP_OBJECT (dialog1, scrolledwindow1, "scrolledwindow1");
-  GLADE_HOOKUP_OBJECT (dialog1, treeview1, "treeview1");
-  GLADE_HOOKUP_OBJECT (dialog1, vbuttonbox1, "vbuttonbox1");
-  GLADE_HOOKUP_OBJECT (dialog1, buttonDeleteAll, "buttonDeleteAll");
-  GLADE_HOOKUP_OBJECT (dialog1, buttonDelete, "buttonDelete");
-  GLADE_HOOKUP_OBJECT (dialog1, buttonRunAll, "buttonRunAll");
-  GLADE_HOOKUP_OBJECT (dialog1, buttonRun, "buttonRun");
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_action_area1, "dialog_action_area1");
-  GLADE_HOOKUP_OBJECT (dialog1, cancelbutton1, "cancelbutton1");
-  GLADE_HOOKUP_OBJECT (dialog1, okbutton1, "okbutton1");
-
-  return dialog1;
-}
-
+									-1);
+
+        gtk_register_dialog(dialog);
+        
+        
+        store=gtk_list_store_new (3, G_TYPE_STRING, G_TYPE_STRING,G_TYPE_STRING);
+        
+        // initialize our job structure
+        jobs.dialog=dialog;
+        jobs.nb=nb;
+        jobs.name=name;
+        jobs.status=new ADM_Job_Descriptor[nb];
+        jobs.store=store;
+        memset(jobs.status,0,jobs.nb*sizeof(ADM_Job_Descriptor));
+
+        gtk_tree_view_set_model(GTK_TREE_VIEW(WID(treeview1)),GTK_TREE_MODEL (store));
+        gtk_tree_view_columns_autosize(GTK_TREE_VIEW(WID(treeview1)));
+
+        // Add columns
+
+        renderer = gtk_cell_renderer_text_new ();
+        column = gtk_tree_view_column_new_with_attributes (QT_TR_NOOP("  Job Name  "), renderer,
+                                                      "markup", (GdkModifierType) 0,
+                                                      NULL);
+        gtk_tree_view_append_column (GTK_TREE_VIEW (WID(treeview1)), column);
+
+        column2 = gtk_tree_view_column_new_with_attributes (QT_TR_NOOP("Started at"), renderer,
+                                                      "markup", (GdkModifierType) 1,
+                                                      NULL);
+        gtk_tree_view_append_column (GTK_TREE_VIEW (WID(treeview1)), column2);
+        column3 = gtk_tree_view_column_new_with_attributes (QT_TR_NOOP("Finished at"), renderer,
+            "markup", (GdkModifierType) 2,
+            NULL);
+        gtk_tree_view_append_column (GTK_TREE_VIEW (WID(treeview1)), column3);
+
+        //
+        #define ASSOCIATE(x,y)   gtk_dialog_add_action_widget (GTK_DIALOG (dialog), WID(x),y)
+            ASSOCIATE(buttonDelete,COMMAND_DELETE);
+            ASSOCIATE(buttonDeleteAll,COMMAND_DELETE_ALL);
+            ASSOCIATE(buttonRunAll,COMMAND_RUN_ALL);
+            ASSOCIATE(buttonRun,COMMAND_RUN);
+        //
+         
+        int running=1;
+        gtk_widget_set_usize(WID(treeview1), 180, 300);
+        while(running)
+        {
+                int sel=0,event;
+                updateStatus();
+                switch(event=gtk_dialog_run(GTK_DIALOG(dialog)))
+                {
+                        case GTK_RESPONSE_OK : running=0;break;
+                        case GTK_RESPONSE_APPLY : running=0;break;
+                        case GTK_RESPONSE_CANCEL :
+                        case GTK_RESPONSE_DELETE_EVENT:
+                                         running=0;break;
+                        case COMMAND_DELETE_ALL:
+                                        if(GUI_Confirmation_HIG(QT_TR_NOOP("Sure!"),QT_TR_NOOP("Delete ALL jobs"),QT_TR_NOOP("Are you sure you want to delete all jobs ?")))
+                                        {
+                                                for(int i=0;i<jobs.nb;i++) jobs.status[i].status=STATUS_DELETED;
+                                        }
+                                        break;
+                        case COMMAND_RUN: 
+                                        sel=getSelection(jobs.dialog);
+                                        if(sel>=jobs.nb) break;
+                                        jobs.status[sel].status=STATUS_RUNNING;
+                                        updateStatus();
+                                        GUI_Quiet();
+                                        TLK_getDate(&(jobs.status[sel].startDate));
+                                        if(parseECMAScript(jobs.name[sel])) jobs.status[sel].status=STATUS_SUCCEED;
+                                        else jobs.status[sel].status=STATUS_FAILED;
+                                        TLK_getDate(&(jobs.status[sel].endDate));
+                                        updateStatus();
+                                        GUI_Verbose();
+                                        break;
+                        case COMMAND_RUN_ALL: 
+                                        GUI_Quiet();
+                                        for(int i=0;i<jobs.nb;i++)
+                                        {
+                                          if(jobs.status[i].status==STATUS_DELETED) continue;
+                                          if(jobs.status[i].status==STATUS_SUCCEED) continue;
+                                          jobs.status[i].status=STATUS_RUNNING;
+                                          TLK_getDate(&(jobs.status[i].startDate));
+                                          updateStatus();
+                                          if(parseECMAScript(jobs.name[i])) jobs.status[i].status=STATUS_SUCCEED;
+                                                        else jobs.status[i].status=STATUS_FAILED;
+                                        TLK_getDate(&(jobs.status[i].endDate));
+
+                                        }
+                                        updateStatus();
+                                        GUI_Verbose();
+                                        break;
+                        case COMMAND_DELETE: 
+                                        sel=getSelection(jobs.dialog);
+                                        if(sel>=jobs.nb) break;
+                                        if(GUI_Confirmation_HIG(QT_TR_NOOP("Sure!"),QT_TR_NOOP("Delete job"),QT_TR_NOOP("Are you sure you want to delete %s job ?"),ADM_GetFileName(jobs.name[sel])))
+                                        {
+                                                jobs.status[sel].status=STATUS_DELETED;
+                                        }
+                                        break;
+
+                        
+                        default:
+                                printf("Event:%d\n",event); 
+                                GUI_Error_HIG("Jobs",QT_TR_NOOP("Unknown event"));break;
+                }
+                
+        }
+        gtk_unregister_dialog(dialog);
+        gtk_widget_destroy(dialog);
+
+        // Now delete the "deleted" jobs
+        for(int i=0;i<jobs.nb;i++)
+        {
+                if(jobs.status[i].status==STATUS_DELETED)
+                {
+                        unlink(jobs.name[i]);
+                }
+
+        }
+
+        delete [] jobs.status;
+
+        return ret;
+}
+//**************************************************
+int              getSelection(GtkWidget *dialog)
+{
+uint32_t n=0xffff;
+        if(! getSelectionNumber(jobs.nb,WID(treeview1) , jobs.store,&n)) return 0xffff;
+        return n;
+}
+//*************************************
+void updateStatus(void)
+{
+GtkTreeIter iter;
+char *str;
+ADM_date  *date;
+char *str1,str2[200],str3[200];
+
+        gtk_list_store_clear (jobs.store);
+        for (uint32_t i = 0; i < jobs.nb; i++)
+        {
+               str1 = g_markup_printf_escaped("<span weight=\"heavy\">%s</span>\n" 
+               "<span size=\"smaller\" style=\"oblique\">%s</span>"
+                , ADM_GetFileName(jobs.name[i]), StringStatus[jobs.status[i].status]);
+
+                date=&(jobs.status[i].startDate);
+                sprintf(str2,"%02d:%02d:%02d",date->hours,
+                                          date->minutes,
+                                          date->seconds);
+
+                date=&(jobs.status[i].endDate);
+                sprintf(str3,"%02d:%02d:%02d",date->hours,
+                        date->minutes,
+                        date->seconds);
+
+                gtk_list_store_append (jobs.store, &iter);
+                gtk_list_store_set (jobs.store, &iter, 0,str1,1,str2,2,str3,-1);
+                printf("Start : %s\n",str2);
+                printf("End : %s\n",str3);
+
+				g_free(str1);
+        }
+}
+//*************************************
+
+GtkWidget*
+create_dialog1 (void)
+{
+  GtkWidget *dialog1;
+  GtkWidget *dialog_vbox1;
+  GtkWidget *hbox1;
+  GtkWidget *scrolledwindow1;
+  GtkWidget *treeview1;
+  GtkWidget *vbuttonbox1;
+  GtkWidget *buttonDeleteAll;
+  GtkWidget *buttonDelete;
+  GtkWidget *buttonRunAll;
+  GtkWidget *buttonRun;
+  GtkWidget *dialog_action_area1;
+  GtkWidget *cancelbutton1;
+  GtkWidget *okbutton1;
+
+  dialog1 = gtk_dialog_new ();
+  gtk_window_set_title (GTK_WINDOW (dialog1), QT_TR_NOOP("Jobs"));
+  gtk_window_set_type_hint (GTK_WINDOW (dialog1), GDK_WINDOW_TYPE_HINT_DIALOG);
+
+  dialog_vbox1 = GTK_DIALOG (dialog1)->vbox;
+  gtk_widget_show (dialog_vbox1);
+
+  hbox1 = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (hbox1);
+  gtk_box_pack_start (GTK_BOX (dialog_vbox1), hbox1, TRUE, TRUE, 0);
+
+  scrolledwindow1 = gtk_scrolled_window_new (NULL, NULL);
+  gtk_widget_show (scrolledwindow1);
+  gtk_box_pack_start (GTK_BOX (hbox1), scrolledwindow1, TRUE, TRUE, 0);
+  gtk_scrolled_window_set_policy (GTK_SCROLLED_WINDOW (scrolledwindow1), GTK_POLICY_AUTOMATIC, GTK_POLICY_AUTOMATIC);
+  gtk_scrolled_window_set_shadow_type (GTK_SCROLLED_WINDOW (scrolledwindow1), GTK_SHADOW_IN);
+
+  treeview1 = gtk_tree_view_new ();
+  gtk_widget_show (treeview1);
+  gtk_container_add (GTK_CONTAINER (scrolledwindow1), treeview1);
+  //gtk_widget_set_size_request (treeview1, 300, -1);
+
+  vbuttonbox1 = gtk_vbutton_box_new ();
+  gtk_widget_show (vbuttonbox1);
+  gtk_box_pack_start (GTK_BOX (hbox1), vbuttonbox1, FALSE, FALSE, 0);
+  gtk_button_box_set_layout (GTK_BUTTON_BOX (vbuttonbox1), GTK_BUTTONBOX_START);
+
+  buttonDeleteAll = gtk_button_new_with_mnemonic (QT_TR_NOOP("Delete All Jobs"));
+  gtk_widget_show (buttonDeleteAll);
+  gtk_container_add (GTK_CONTAINER (vbuttonbox1), buttonDeleteAll);
+  GTK_WIDGET_SET_FLAGS (buttonDeleteAll, GTK_CAN_DEFAULT);
+
+  buttonDelete = gtk_button_new_with_mnemonic (QT_TR_NOOP("Delete Job"));
+  gtk_widget_show (buttonDelete);
+  gtk_container_add (GTK_CONTAINER (vbuttonbox1), buttonDelete);
+  GTK_WIDGET_SET_FLAGS (buttonDelete, GTK_CAN_DEFAULT);
+
+  buttonRunAll = gtk_button_new_with_mnemonic (QT_TR_NOOP("Run all jobs"));
+  gtk_widget_show (buttonRunAll);
+  gtk_container_add (GTK_CONTAINER (vbuttonbox1), buttonRunAll);
+  GTK_WIDGET_SET_FLAGS (buttonRunAll, GTK_CAN_DEFAULT);
+
+  buttonRun = gtk_button_new_with_mnemonic (QT_TR_NOOP("Run Job"));
+  gtk_widget_show (buttonRun);
+  gtk_container_add (GTK_CONTAINER (vbuttonbox1), buttonRun);
+  GTK_WIDGET_SET_FLAGS (buttonRun, GTK_CAN_DEFAULT);
+
+  dialog_action_area1 = GTK_DIALOG (dialog1)->action_area;
+  gtk_widget_show (dialog_action_area1);
+  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialog_action_area1), GTK_BUTTONBOX_END);
+
+  cancelbutton1 = gtk_button_new_from_stock ("gtk-cancel");
+  gtk_widget_show (cancelbutton1);
+  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), cancelbutton1, GTK_RESPONSE_CANCEL);
+  GTK_WIDGET_SET_FLAGS (cancelbutton1, GTK_CAN_DEFAULT);
+
+  okbutton1 = gtk_button_new_from_stock ("gtk-ok");
+  gtk_widget_show (okbutton1);
+  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), okbutton1, GTK_RESPONSE_OK);
+  GTK_WIDGET_SET_FLAGS (okbutton1, GTK_CAN_DEFAULT);
+
+  /* Store pointers to all widgets, for use by lookup_widget(). */
+  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog1, "dialog1");
+  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_vbox1, "dialog_vbox1");
+  GLADE_HOOKUP_OBJECT (dialog1, hbox1, "hbox1");
+  GLADE_HOOKUP_OBJECT (dialog1, scrolledwindow1, "scrolledwindow1");
+  GLADE_HOOKUP_OBJECT (dialog1, treeview1, "treeview1");
+  GLADE_HOOKUP_OBJECT (dialog1, vbuttonbox1, "vbuttonbox1");
+  GLADE_HOOKUP_OBJECT (dialog1, buttonDeleteAll, "buttonDeleteAll");
+  GLADE_HOOKUP_OBJECT (dialog1, buttonDelete, "buttonDelete");
+  GLADE_HOOKUP_OBJECT (dialog1, buttonRunAll, "buttonRunAll");
+  GLADE_HOOKUP_OBJECT (dialog1, buttonRun, "buttonRun");
+  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_action_area1, "dialog_action_area1");
+  GLADE_HOOKUP_OBJECT (dialog1, cancelbutton1, "cancelbutton1");
+  GLADE_HOOKUP_OBJECT (dialog1, okbutton1, "okbutton1");
+
+  return dialog1;
+}
+

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/dvEncoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/dvEncoder.cpp	2010-04-05 21:11:21 UTC (rev 6062)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/dvEncoder.cpp	2010-04-05 21:14:29 UTC (rev 6063)
@@ -58,9 +58,7 @@
 		{
 			if (properties->height == dvProfiles[i].height && properties->width == dvProfiles[i].width && 
 				((int)(properties->fpsNum * 1000.0 / properties->fpsDen) == (int)(dvProfiles[i].timeBase.num * 1000.0 / dvProfiles[i].timeBase.den)))
-			{
-#warning not sure it fixes all
-				//_context->pix_fmt = getAvCodecColourSpace(dvProfiles[i].pixFmt);
+			{
 				_supportedCsps[0] = dvProfiles[i].pixFmt;
 				validProfile = true;
 				break;

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Decimate/ADM_vidDecDec_param.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Decimate/ADM_vidDecDec_param.h	2010-04-05 21:11:21 UTC (rev 6062)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Decimate/ADM_vidDecDec_param.h	2010-04-05 21:14:29 UTC (rev 6063)
@@ -9,7 +9,7 @@
 // Copyright: See COPYING file that comes with this distribution
 //
 //
-typedef struct DECIMATE_PARAM
+struct DECIMATE_PARAM
 {
 	uint32_t    cycle; // Integer 2..40
         uint32_t    mode;  // 0..3



From gruntster at mail.berlios.de  Mon Apr  5 23:46:28 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 5 Apr 2010 23:46:28 +0200
Subject: [Avidemux-svn-commit] r6064 - in
	branches/avidemux_2.5_branch_gruntster/platforms/windows:
	build_scripts/avidemux installer
Message-ID: <201004052146.o35LkSfM020584@sheep.berlios.de>

Author: gruntster
Date: 2010-04-05 23:46:23 +0200 (Mon, 05 Apr 2010)
New Revision: 6064

Modified:
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Package Notes.xml
   branches/avidemux_2.5_branch_gruntster/platforms/windows/installer/avidemux.nsi
Log:
[win32] update installer to include mpeg2enc plugin

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Package Notes.xml
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Package Notes.xml	2010-04-05 21:14:29 UTC (rev 6063)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Package Notes.xml	2010-04-05 21:46:23 UTC (rev 6064)
@@ -1,5 +1,26 @@
 <?xml version="1.0"?>
 <log>
+  <buildentry revision="6028" date="2010-03-27">
+    <comment>Updated Avisynth Proxy GUI to version 2.11.</comment>
+    <comment>Updated GLib to version 2.22.5-1.</comment>
+    <comment>Updated GTK+ to version 2.18.9-1.</comment>
+    <comment>Updated LAME to version 3.98.4.</comment>
+    <comment>Updated Ogg to version 1.2.0.</comment>
+    <comment>Updated NSPR to version 4.8.4.</comment>
+    <comment>Updated Vorbis to version 1.3.1.</comment>
+  </buildentry>
+  <buildentry revision="5955" date="2010-02-28">
+    <comment>Compiled with GCC 4.4.3.</comment>
+    <comment>Updated Cairo to version 1.8.10-1.</comment>
+    <comment>Updated Freetype to version 2.3.11-2.</comment>
+    <comment>Updated GTK+ to version 2.18.7-1.</comment>
+    <comment>Updated LAME to version 3.98.3.</comment>
+    <comment>Updated libpng to version 1.4.0-1.</comment>
+    <comment>Updated NSPR to version 4.8.3.</comment>
+    <comment>Updated Pango to version 1.26.2-1.</comment>
+    <comment>Updated Qt to version 4.6.2.</comment>
+    <comment>Updated x264 to r1471.</comment>
+  </buildentry>
   <buildentry revision="5869" date="2010-01-23">
     <comment>Updated GLib to version 2.22.4-1.</comment>
     <comment>Updated Qt to version 4.6.1.</comment>

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/installer/avidemux.nsi
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/installer/avidemux.nsi	2010-04-05 21:14:29 UTC (rev 6063)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/installer/avidemux.nsi	2010-04-05 21:46:23 UTC (rev 6064)
@@ -17,7 +17,7 @@
 ##########################
 !define DISPLAYNAME "Avidemux 2.5"
 
-!if BUILD_BITS == 64
+!if ${BUILD_BITS} == 64
 !define INTERNALNAME "Avidemux 2.5 (64-bit)"
 !else
 !define INTERNALNAME "Avidemux 2.5"
@@ -271,13 +271,13 @@
     ${File} "Change Log.html"
     ${File} zlib1.dll
     
-!if BUILD_BITS == 32
+!if ${BUILD_BITS} == 32
     ${File} freetype6.dll
     ${File} libnspr4.dll
     ${File} libstdc++.dll
 !endif
 
-!if BUILD_BITS == 64
+!if ${BUILD_BITS} == 64
 	${File} libfreetype-6.dll
 	${File} libstdc++-6.dll
 !endif
@@ -504,6 +504,14 @@
 			SetOutPath $INSTDIR\plugins\videoEncoder\avcodec\mpeg-2
 			${File} plugins\videoEncoder\avcodec\mpeg-2\*.xml
 		${MementoSectionEnd}
+		${MementoSection} "mpeg2enc (MPEG-1/MPEG-2)" SecVidEncMpeg2Enc
+			SectionIn 1 2
+			SetOverwrite on
+			SetOutPath $INSTDIR\plugins\videoEncoder
+			${File} plugins\videoEncoder\libADM_vidEnc_mpeg2enc.dll
+			SetOutPath $INSTDIR\plugins\videoEncoder\mpeg2enc
+			${File} plugins\videoEncoder\avcodec\*.xsd
+		${MementoSectionEnd}
 		${MementoSection} "x264 (MPEG-4 AVC)" SecVidEncX264
 			SectionIn 1 2
 			SetOverwrite on



From mean at mail.berlios.de  Tue Apr  6 08:41:39 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 6 Apr 2010 08:41:39 +0200
Subject: [Avidemux-svn-commit] r6065 - in
	branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces:
	ADM_dialog ADM_gui2
Message-ID: <201004060641.o366fdU5010421@sheep.berlios.de>

Author: mean
Date: 2010-04-06 08:41:38 +0200 (Tue, 06 Apr 2010)
New Revision: 6065

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_dialog/DIA_flyPreview.h
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_dialog/TLK_filesel.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_gui2/GUI_bindings.cpp
Log:
[Gtk] Fix

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_dialog/DIA_flyPreview.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_dialog/DIA_flyPreview.h	2010-04-05 21:46:23 UTC (rev 6064)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_dialog/DIA_flyPreview.h	2010-04-06 06:41:38 UTC (rev 6065)
@@ -7,7 +7,7 @@
 	uint8_t download(void) {return 1;}
 	uint8_t upload(void) {return 1;}
 	uint8_t cleanup(void) {return 1;}
-	uint8_t setData(uint8_t *buffer) {_rgb->scale(buffer, _rgbBufferOut); return 1;}
+	uint8_t setData(uint8_t *buffer) {_rgb->convert(buffer, _rgbBufferOut); return 1;}
 
 	flyPreview(uint32_t width, uint32_t height, void *canvas) : 
 	  ADM_flyDialogGtk(width, height, NULL, canvas, NULL, 0, RESIZE_NONE) {delete[] _rgbBuffer; _rgbBuffer = NULL;};

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_dialog/TLK_filesel.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_dialog/TLK_filesel.cpp	2010-04-05 21:46:23 UTC (rev 6064)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_dialog/TLK_filesel.cpp	2010-04-06 06:41:38 UTC (rev 6065)
@@ -404,7 +404,9 @@
 	// CYB 2005.02.23
 	if (cb)
 	{
-		FileSel_ReadWrite(cb, rw, name, actual_workbench_file);
+#warning fixme
+        const char *leak=NULL;
+		FileSel_ReadWrite(cb, rw, name, leak);
 		ADM_dealloc(name);
 	}
 	else

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_gui2/GUI_bindings.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_gui2/GUI_bindings.cpp	2010-04-05 21:46:23 UTC (rev 6064)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_gui2/GUI_bindings.cpp	2010-04-06 06:41:38 UTC (rev 6065)
@@ -1295,11 +1295,12 @@
       printf("DND : %d %s\n",i,names[i]);
 
       const char *filename = names[i];
-
+      const char *leak=NULL;
+#warning FIXME
 	  if (avifileinfo)
-		  FileSel_ReadWrite(reinterpret_cast <void (*)(const char *)> (A_appendAvi), 0, filename, actual_workbench_file);
+		  FileSel_ReadWrite(reinterpret_cast <void (*)(const char *)> (A_appendAvi), 0, filename, leak);
 	  else
-		  FileSel_ReadWrite(reinterpret_cast <void (*)(const char *)> (A_openAvi), 0, filename, actual_workbench_file);
+		  FileSel_ReadWrite(reinterpret_cast <void (*)(const char *)> (A_openAvi), 0, filename, leak);
 
       ADM_dealloc(names[i]);
     }



From mean at mail.berlios.de  Tue Apr  6 08:41:44 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 6 Apr 2010 08:41:44 +0200
Subject: [Avidemux-svn-commit] r6066 - in branches/avidemux_2.6_branch_mean:
	avidemux/common/ADM_editor avidemux/common/ADM_render
	avidemux_core/ADM_coreImage/include avidemux_core/ADM_coreImage/src
	avidemux_core/ADM_coreImageLoader/src
	avidemux_core/ADM_coreVideoCodec/include
	avidemux_core/ADM_coreVideoEncoder/include
	avidemux_core/ADM_coreVideoEncoder/src
	avidemux_core/ADM_coreVideoFilter/include
	avidemux_core/ADM_coreVideoFilter/src
Message-ID: <201004060641.o366fiFo010433@sheep.berlios.de>

Author: mean
Date: 2010-04-06 08:41:42 +0200 (Tue, 06 Apr 2010)
New Revision: 6066

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRender.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_colorspace.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_image.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageResizer.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageSave.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImageLoader/src/ADM_imageLoader.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_rgb16.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/include/ADM_coreVideoEncoderFFmpeg.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/ADM_coreVideoEncoderFFmpeg.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/DIA_flyDialog.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp
Log:
[Scaler] Rename to ColorScaler as ColorSpace was misleading

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRender.cpp	2010-04-06 06:41:38 UTC (rev 6065)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRender.cpp	2010-04-06 06:41:42 UTC (rev 6066)
@@ -482,7 +482,7 @@
                         if(!vid->color)
                         {
                               //  vid->color=new COL_Generic2YV12(src->_width,src->_height,src->_colorspace);
-                              vid->color=new ADMColorSpaceSimple(src->_width,src->_height,
+                              vid->color=new ADMColorScalerSimple(src->_width,src->_height,
                                                                  src->_colorspace,ADM_COLOR_YV12);
                         }
                         // Since it is not YV12 it MUST be a ref

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.h	2010-04-06 06:41:38 UTC (rev 6065)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.h	2010-04-06 06:41:42 UTC (rev 6066)
@@ -50,7 +50,7 @@
 {
       vidHeader *_aviheader; /// Demuxer
       decoders *decoder; /// Video codec
-      ADMColorSpaceSimple *color; /// Color conversion if needed
+      ADMColorScalerSimple *color; /// Color conversion if needed
 
       /* Audio part */
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2010-04-06 06:41:38 UTC (rev 6065)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2010-04-06 06:41:42 UTC (rev 6066)
@@ -43,7 +43,7 @@
     #define IVERT ADM_COLOR_RGB32A
 #endif    
 #warning FIXME
-static ADMColorSpaceSimple rgbConverter(640,480,ADM_COLOR_YV12,IVERT);
+static ADMColorScalerSimple rgbConverter(640,480,ADM_COLOR_YV12,IVERT);
 
 
 static uint8_t	updateWindowSize(void * win, uint32_t w, uint32_t h);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.cpp	2010-04-06 06:41:38 UTC (rev 6065)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.cpp	2010-04-06 06:41:42 UTC (rev 6066)
@@ -55,7 +55,7 @@
 #ifdef __WIN32
 HWND sdlWin32;
 #endif
-static ADMColorSpaceSimple *color=NULL;
+static ADMColorScalerSimple *color=NULL;
 
 sdlAccelRender::sdlAccelRender( void)
 {
@@ -114,7 +114,7 @@
 
     if(!useYV12)
     {
-		color=new ADMColorSpaceSimple(720,480,ADM_COLOR_YV12,ADM_COLOR_YUV422);
+		color=new ADMColorScalerSimple(720,480,ADM_COLOR_YV12,ADM_COLOR_YUV422);
 		decoded=new uint8_t[w*h*2];
     }
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_colorspace.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_colorspace.h	2010-04-06 06:41:38 UTC (rev 6065)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_colorspace.h	2010-04-06 06:41:42 UTC (rev 6066)
@@ -21,41 +21,41 @@
     ADM_CS_BILINEAR,
     ADM_CS_BICUBIC,
     ADM_CS_LANZCOS
-}ADMColorSpace_algo;
+}ADMColorScaler_algo;
 /**
-    \class ADMColorSpace
+    \class ADMColorScaler
 */
-class ADMColorSpaceFull
+class ADMColorScalerFull
 {
   protected:
     void            *context;
     uint32_t        srcWidth,srcHeight;
     uint32_t        dstWidth,dstHeight;
     ADM_colorspace  fromColor,toColor;
-    ADMColorSpace_algo algo;
+    ADMColorScaler_algo algo;
     uint8_t         getStrideAndPointers(bool dst,uint8_t  *from,ADM_colorspace fromColor,
                                             uint8_t **srcData,int *srcStride);
   public :
     
-                    ADMColorSpaceFull(ADMColorSpace_algo algo, uint32_t sw, uint32_t sh, uint32_t dw,uint32_t dh,ADM_colorspace from,ADM_colorspace to);
-    bool            reset(ADMColorSpace_algo, uint32_t sw, uint32_t sh, uint32_t dw,uint32_t dh,ADM_colorspace from,ADM_colorspace to);
+                    ADMColorScalerFull(ADMColorScaler_algo algo, uint32_t sw, uint32_t sh, uint32_t dw,uint32_t dh,ADM_colorspace from,ADM_colorspace to);
+    bool            reset(ADMColorScaler_algo, uint32_t sw, uint32_t sh, uint32_t dw,uint32_t dh,ADM_colorspace from,ADM_colorspace to);
     
 
     bool            convert(uint8_t  *from, uint8_t *to);
     bool            convertPlanes(uint32_t  sourceStride[3],uint32_t destStride[3],     
                                   uint8_t   *sourceData[3], uint8_t *destData[3]);
-                    ~ADMColorSpaceFull();
+                    ~ADMColorScalerFull();
 };
 /**
-    \class ADMColorSpaceSimple
+    \class ADMColorScalerSimple
     \brief Same as Full but target & source width/height are the same
 */
-class ADMColorSpaceSimple :public ADMColorSpaceFull
+class ADMColorScalerSimple :public ADMColorScalerFull
 {
 public:
     bool            changeWidthHeight(uint32_t newWidth, uint32_t newHeight);
-                    ADMColorSpaceSimple( uint32_t width, uint32_t height, ADM_colorspace from,ADM_colorspace to,ADMColorSpace_algo algo=ADM_CS_BICUBIC):
-                        ADMColorSpaceFull(algo, width, height, width,height, from, to)
+                    ADMColorScalerSimple( uint32_t width, uint32_t height, ADM_colorspace from,ADM_colorspace to,ADMColorScaler_algo algo=ADM_CS_BICUBIC):
+                        ADMColorScalerFull(algo, width, height, width,height, from, to)
                      {
 
                      }

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_image.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_image.h	2010-04-06 06:41:38 UTC (rev 6065)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_image.h	2010-04-06 06:41:42 UTC (rev 6066)
@@ -162,7 +162,7 @@
 class ADMImageResizer
 {
 	private:
-		ADMColorSpaceFull   *resizer;
+		ADMColorScalerFull   *resizer;
         ADM_colorspace orgFormat, destFormat;
 		uint32_t orgWidth, orgHeight;
 		uint32_t destWidth, destHeight;

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp	2010-04-06 06:41:38 UTC (rev 6065)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp	2010-04-06 06:41:42 UTC (rev 6066)
@@ -64,7 +64,7 @@
       \param dst=1 -> destination, =0 source
       \brief Fill in strides etc.. needed by libswscale
 */
-uint8_t ADMColorSpaceFull::getStrideAndPointers(bool dst,
+uint8_t ADMColorScalerFull::getStrideAndPointers(bool dst,
         uint8_t  *from,ADM_colorspace fromColor,
         uint8_t **srcData,int *srcStride)
 {
@@ -132,7 +132,7 @@
   @param to Target image
 */
 
-bool ADMColorSpaceFull::convert(uint8_t  *from, uint8_t *to)
+bool ADMColorScalerFull::convert(uint8_t  *from, uint8_t *to)
 {
   uint8_t *srcData[3];
   uint8_t *dstData[3];
@@ -149,7 +149,7 @@
     \fn convertPlanes
     \brief Same as convert but the 3 planes are given separately
 */
-bool            ADMColorSpaceFull::convertPlanes(uint32_t  sourceStride[3],uint32_t destStride[3],     
+bool            ADMColorScalerFull::convertPlanes(uint32_t  sourceStride[3],uint32_t destStride[3],     
                                   uint8_t   *sourceData[3], uint8_t *destData[3])
 {
     int xs[3]={sourceStride[0],sourceStride[1],sourceStride[2]};
@@ -158,7 +158,7 @@
      return true;
 }
 /**
-    \fn  ADMColorspace
+    \fn  ADMColorScaler
     \brief Constructor
   @param w width
   @param h height
@@ -166,7 +166,7 @@
   @param to colorspace to concert to
 */
 
-ADMColorSpaceFull::ADMColorSpaceFull(ADMColorSpace_algo algo,
+ADMColorScalerFull::ADMColorScalerFull(ADMColorScaler_algo algo,
             uint32_t sw, uint32_t sh,
             uint32_t dw, uint32_t dh,
             ADM_colorspace from,ADM_colorspace to)
@@ -176,10 +176,10 @@
 
 }
 /**
-    \fn  ~ADMColorspace
+    \fn  ~ADMColorScaler
     \brief Destructor
 */
-ADMColorSpaceFull::~ADMColorSpaceFull()
+ADMColorScalerFull::~ADMColorScalerFull()
 {
   if(context)
   {
@@ -190,7 +190,7 @@
 /**
     \fn reset
 */
-bool  ADMColorSpaceFull::reset(ADMColorSpace_algo, uint32_t sw, uint32_t sh, uint32_t dw,uint32_t dh,ADM_colorspace from,ADM_colorspace to)
+bool  ADMColorScalerFull::reset(ADMColorScaler_algo, uint32_t sw, uint32_t sh, uint32_t dw,uint32_t dh,ADM_colorspace from,ADM_colorspace to)
 {
     if(context) sws_freeContext(CONTEXT);
     context=NULL;
@@ -218,7 +218,7 @@
                       flags, NULL, NULL,NULL);
 }
 //------------------------------
-bool            ADMColorSpaceSimple::changeWidthHeight(uint32_t newWidth, uint32_t newHeight)
+bool            ADMColorScalerSimple::changeWidthHeight(uint32_t newWidth, uint32_t newHeight)
 {
     if(newWidth==srcWidth && newHeight==srcHeight) return true; // no change
     
@@ -232,7 +232,7 @@
 */
 bool ADM_ConvertRgb24ToYV12(bool inverted,uint32_t w, uint32_t h, uint8_t *source, uint8_t *destination) 
 {
-    ADMColorSpaceSimple  converter( w,h,ADM_COLOR_RGB24,ADM_COLOR_YV12);
+    ADMColorScalerSimple  converter( w,h,ADM_COLOR_RGB24,ADM_COLOR_YV12);
     
     if(true==inverted)
     {

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageResizer.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageResizer.cpp	2010-04-06 06:41:38 UTC (rev 6065)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageResizer.cpp	2010-04-06 06:41:42 UTC (rev 6066)
@@ -49,7 +49,7 @@
 
 	orgFormat = srcFormat;
 	destFormat = dstFormat;
-    resizer=new ADMColorSpaceFull(ADM_CS_BICUBIC,orgWidth,orgHeight,destWidth,destHeight,srcFormat,destFormat);
+    resizer=new ADMColorScalerFull(ADM_CS_BICUBIC,orgWidth,orgHeight,destWidth,destHeight,srcFormat,destFormat);
                         
 }
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageSave.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageSave.cpp	2010-04-06 06:41:38 UTC (rev 6065)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageSave.cpp	2010-04-06 06:41:42 UTC (rev 6066)
@@ -82,7 +82,7 @@
 //            ADM_dealloc(out);
             return 0;
         }
-        ADMColorSpaceSimple converter(bmph.biWidth, bmph.biHeight, ADM_COLOR_YV12,ADM_COLOR_BGR24);
+        ADMColorScalerSimple converter(bmph.biWidth, bmph.biHeight, ADM_COLOR_YV12,ADM_COLOR_BGR24);
 
         uint32_t ww=bmph.biWidth;
         uint32_t hh=bmph.biHeight;

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImageLoader/src/ADM_imageLoader.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImageLoader/src/ADM_imageLoader.cpp	2010-04-06 06:41:38 UTC (rev 6065)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImageLoader/src/ADM_imageLoader.cpp	2010-04-06 06:41:42 UTC (rev 6066)
@@ -176,7 +176,7 @@
 		    {
 		    	ADM_info("[imageLoader] YUY2\n");
 		    	image=new ADMImage(w,h);
-                ADMColorSpaceSimple convert(w,h,ADM_COLOR_YUV422,ADM_COLOR_YV12);
+                ADMColorScalerSimple convert(w,h,ADM_COLOR_YUV422,ADM_COLOR_YV12);
                 uint32_t dstStride[3]={w,w/2,w/2};
                 uint8_t  *dstData[3]={YPLANE(image),UPLANE(image),VPLANE(image)};
 		    	convert.convertPlanes( tmpImage._planeStride,dstStride, tmpImage._planes,dstData);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_rgb16.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_rgb16.h	2010-04-06 06:41:38 UTC (rev 6065)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_rgb16.h	2010-04-06 06:41:42 UTC (rev 6066)
@@ -23,7 +23,7 @@
 {
 	protected:
 		uint8_t       *planar;
-		ADMColorSpaceSimple *converter;
+		ADMColorScalerSimple *converter;
 		bool          isRgb; // Else BGR
 		uint32_t      _bpp;
 		uint8_t       *decoded;

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/include/ADM_coreVideoEncoderFFmpeg.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/include/ADM_coreVideoEncoderFFmpeg.h	2010-04-06 06:41:38 UTC (rev 6065)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/include/ADM_coreVideoEncoderFFmpeg.h	2010-04-06 06:41:42 UTC (rev 6066)
@@ -35,7 +35,7 @@
                FFcodecSettings  Settings;
                AVCodecContext   *_context;      // Context 
                AVFrame          _frame;     
-               ADMColorSpaceSimple    *colorSpace;    // Colorspace converter if needed
+               ADMColorScalerSimple    *colorSpace;    // Colorspace converter if needed
                uint8_t          *rgbBuffer;     // Buffer for colorspace converter if needed
                ADM_colorspace   targetColorSpace; // Wanted colorspace
                bool             loadStatFile(const char *file);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/ADM_coreVideoEncoderFFmpeg.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/ADM_coreVideoEncoderFFmpeg.cpp	2010-04-06 06:41:38 UTC (rev 6065)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/ADM_coreVideoEncoderFFmpeg.cpp	2010-04-06 06:41:42 UTC (rev 6066)
@@ -277,7 +277,7 @@
     h=info->height;
     if(targetColorSpace!=ADM_COLOR_YV12)
     {
-        colorSpace=new ADMColorSpaceSimple(w,h,ADM_COLOR_YV12,targetColorSpace);
+        colorSpace=new ADMColorScalerSimple(w,h,ADM_COLOR_YV12,targetColorSpace);
         if(!colorSpace)
         {
             printf("[ADM_jpegEncoder] Cannot allocate colorspace\n");

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/DIA_flyDialog.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/DIA_flyDialog.h	2010-04-06 06:41:38 UTC (rev 6065)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/include/DIA_flyDialog.h	2010-04-06 06:41:42 UTC (rev 6066)
@@ -96,7 +96,7 @@
           void    *_cookie; // whatever
           void    *_slider; // widget
           void    *_canvas; // Drawing zone
-          ADMColorSpaceSimple *_rgb;
+          ADMColorScalerSimple *_rgb;
 
           /* Filter dependant */
   virtual uint8_t    process(void)=0;

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp	2010-04-06 06:41:38 UTC (rev 6065)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp	2010-04-06 06:41:42 UTC (rev 6066)
@@ -76,7 +76,7 @@
 #warning FIXME
 
 //    if (isRgbInverted())
-            _rgb =new ADMColorSpaceSimple(_w,_h,ADM_COLOR_YV12,ADM_COLOR_YV12);
+            _rgb =new ADMColorScalerSimple(_w,_h,ADM_COLOR_YV12,ADM_COLOR_YV12);
         if (_resizeMethod == RESIZE_AUTO || _resizeMethod == RESIZE_LAST)
                 {
                         _zoom = calcZoomFactor();



From mean at mail.berlios.de  Tue Apr  6 10:06:01 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 6 Apr 2010 10:06:01 +0200
Subject: [Avidemux-svn-commit] r6067 - in branches/avidemux_2.6_branch_mean:
	avidemux_core/ADM_coreImage/include avidemux_core/ADM_coreImage/src
	avidemux_core/ADM_coreVideoFilter/src
	avidemux_plugins/ADM_videoFilters6/resize
Message-ID: <201004060806.o36861uD015407@sheep.berlios.de>

Author: mean
Date: 2010-04-06 10:06:00 +0200 (Tue, 06 Apr 2010)
New Revision: 6067

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_colorspace.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/resize/swScaleResize.cpp
Log:
[swScaler + FlyDialog] Use ADMColorScaler + fix flyDialog

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_colorspace.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_colorspace.h	2010-04-06 06:41:42 UTC (rev 6066)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_colorspace.h	2010-04-06 08:06:00 UTC (rev 6067)
@@ -20,7 +20,11 @@
 {
     ADM_CS_BILINEAR,
     ADM_CS_BICUBIC,
-    ADM_CS_LANZCOS
+    ADM_CS_LANCZOS,
+    ADM_CS_BICUBLIN,
+    ADM_CS_GAUSS,
+    ADM_CS_SINC,
+    ADM_CS_SPLINE
 }ADMColorScaler_algo;
 /**
     \class ADMColorScaler

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp	2010-04-06 06:41:42 UTC (rev 6066)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp	2010-04-06 08:06:00 UTC (rev 6067)
@@ -190,13 +190,26 @@
 /**
     \fn reset
 */
-bool  ADMColorScalerFull::reset(ADMColorScaler_algo, uint32_t sw, uint32_t sh, uint32_t dw,uint32_t dh,ADM_colorspace from,ADM_colorspace to)
+bool  ADMColorScalerFull::reset(ADMColorScaler_algo algo, uint32_t sw, uint32_t sh, uint32_t dw,uint32_t dh,ADM_colorspace from,ADM_colorspace to)
 {
     if(context) sws_freeContext(CONTEXT);
     context=NULL;
     this->algo=algo;
-    int flags=SWS_BICUBLIN;
-#warning SET algo!
+    int flags;
+    switch(algo)
+    {
+#define SETAL(x) case ADM_CS_##x: flags=SWS_##x;break;
+
+    SETAL(BILINEAR);
+    SETAL(BICUBIC);
+    SETAL(LANCZOS);
+    SETAL(BICUBLIN);
+    SETAL(GAUSS);
+    SETAL(SINC);
+    SETAL(SPLINE);
+    default: ADM_assert(0);
+    }
+
     FLAGS();
   
     srcWidth=sw;

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp	2010-04-06 06:41:42 UTC (rev 6066)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp	2010-04-06 08:06:00 UTC (rev 6067)
@@ -73,10 +73,10 @@
  */
 void ADM_flyDialog::EndConstructor(void)
   {
-#warning FIXME
-
-//    if (isRgbInverted())
-            _rgb =new ADMColorScalerSimple(_w,_h,ADM_COLOR_YV12,ADM_COLOR_YV12);
+        if (isRgbInverted())
+            _rgb =new ADMColorScalerSimple(_w,_h,ADM_COLOR_YV12,ADM_COLOR_BGR32A);
+        else
+            _rgb =new ADMColorScalerSimple(_w,_h,ADM_COLOR_YV12,ADM_COLOR_RGB32A);
         if (_resizeMethod == RESIZE_AUTO || _resizeMethod == RESIZE_LAST)
                 {
                         _zoom = calcZoomFactor();

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/resize/swScaleResize.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/resize/swScaleResize.cpp	2010-04-06 06:41:42 UTC (rev 6066)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/resize/swScaleResize.cpp	2010-04-06 08:06:00 UTC (rev 6067)
@@ -51,7 +51,7 @@
 {
 protected:
             
-				SwsContext	*_context;
+				ADMColorScalerFull	*resizer;
 				bool        reset(uint32_t nw, uint32_t old,uint32_t algo);
 				bool        clean( void );
                 ADMImage    *original;
@@ -70,7 +70,7 @@
 
 // Add the hook to make it valid plugin
 DECLARE_VIDEO_FILTER(   swScaleResizeFilter,   // Class
-                        1,0,0,              // Version
+                        1,0,1,              // Version
                         ADM_UI_TYPE_BUILD,         // UI
                         VF_TRANSFORM,            // Category
                         "swscale",            // internal name (must be uniq!)
@@ -78,7 +78,6 @@
                         "swScale Resizer." // Description
                     );
 
-// Now implements the interesting parts
 /**
     \fn swScaleResizeFilter
     \brief constructor
@@ -97,9 +96,7 @@
         configuration.sourceAR=1;
         configuration.targetAR=1;
     }
-    info.width=configuration.width;
-    info.height=configuration.height;
-    _context=NULL;
+    resizer=NULL;
 	reset(configuration.width,configuration.height,configuration.algo);
 }
 /**
@@ -127,12 +124,9 @@
     }
     uint8_t *src[3];
     uint8_t *dst[3];
-    int ssrc[3];
-    int ddst[3];
+    uint32_t ssrc[3];
+    uint32_t ddst[3];
 
-    uint32_t page;
-
-    page=original->_width*original->_height;
     src[0]=YPLANE(original);
     src[1]=UPLANE(original);
     src[2]=VPLANE(original);
@@ -140,14 +134,13 @@
     ssrc[0]=original->_width;
     ssrc[1]=ssrc[2]=original->_width>>1;
 
-    page=info.width*info.height;
     dst[0]=YPLANE(image);
     dst[1]=UPLANE(image);
     dst[2]=VPLANE(image);
     ddst[0]=info.width;
     ddst[1]=ddst[2]=info.width>>1;
 
-    sws_scale(_context,src,ssrc,0,original->_height,dst,ddst);
+    resizer->convertPlanes(ssrc,ddst,src,dst);
     image->copyInfo(original);
 // Fixme change A/R ?
 return true;
@@ -187,11 +180,11 @@
 */
 bool swScaleResizeFilter::clean(void)
 {
-		if(_context)
+		if(resizer)
 		{
-			sws_freeContext(_context);
+			delete resizer;
 		}
-		_context=NULL;
+		resizer=NULL;
 		return true;
 }
 /**
@@ -199,46 +192,28 @@
     \brief reset resizer
 */
 
-bool swScaleResizeFilter::reset(uint32_t nw, uint32_t old,uint32_t algo)
+bool swScaleResizeFilter::reset(uint32_t nw, uint32_t nh,uint32_t algo)
 {
- 				 SwsFilter 		    *srcFilter=NULL;
-				 SwsFilter		    *dstFilter=NULL;
-				 int 			   flags=0;
+    clean();
+    ADMColorScaler_algo scalerAlgo;
+    info.width=nw;
+    info.height=nh;
+    switch(algo)
+    {
+        case 0: //bilinear
+                scalerAlgo=ADM_CS_BILINEAR;break;
+        case 1: //bicubic
+                scalerAlgo=ADM_CS_BICUBIC;break;
+        case 2: //Lanczos
+                scalerAlgo=ADM_CS_LANCZOS;break;
+        default:ADM_assert(0);
 
-
-				clean();
-                flags=algo;
-                switch(flags)
-                {
-                    case 0: //bilinear
-                            flags=SWS_BILINEAR;break;
-                    case 1: //bicubic
-                            flags=SWS_BICUBIC;break;
-                    case 2: //Lanczos
-                            flags=SWS_LANCZOS;break;
-                    default:ADM_assert(0);
-
-                }
-#ifdef ADM_CPU_X86		
-		#define ADD(x,y) if( CpuCaps::has##x()) flags|=SWS_CPU_CAPS_##y;
-		ADD(MMX,MMX);		
-		ADD(3DNOW,3DNOW);
-		ADD(MMXEXT,MMX2);
-#endif	
-#ifdef ADM_CPU_ALTIVEC
-		flags|=SWS_CPU_CAPS_ALTIVEC;
-#endif
-                _context=sws_getContext(
-                        previousFilter->getInfo()->width,previousFilter->getInfo()->height,
-                    PIX_FMT_YUV420P,
-                    nw,old,
-                    PIX_FMT_YUV420P,
-                        flags, srcFilter, dstFilter,NULL);
-
-				if(!_context) return 0;
-				return 1;
-
-
+    }
+    resizer=new ADMColorScalerFull(scalerAlgo, 
+                        previousFilter->getInfo()->width, previousFilter->getInfo()->height, 
+                        nw,nh,
+                        ADM_COLOR_YV12,ADM_COLOR_YV12);
+    return 1;
 }
 
 extern bool         DIA_resize(uint32_t originalWidth,uint32_t originalHeight,uint32_t fps1000,swresize *resize);
@@ -249,8 +224,13 @@
 bool         swScaleResizeFilter::configure(void) 
 {
     uint32_t fps1000=ADM_Fps1000FromUs(info.frameIncrement);
-    return DIA_resize(previousFilter->getInfo()->width,previousFilter->getInfo()->height,
-                        fps1000,&configuration);
-
+    if(true==DIA_resize(previousFilter->getInfo()->width,previousFilter->getInfo()->height,
+                        fps1000,&configuration))
+    {
+       
+        reset(configuration.width,configuration.height,configuration.algo);
+        return true;
+    }   
+    return false;
 }
 //EOF



From gruntster at mail.berlios.de  Tue Apr  6 13:49:45 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 6 Apr 2010 13:49:45 +0200
Subject: [Avidemux-svn-commit] r6068 -
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc
Message-ID: <201004061149.o36BnjOP002290@sheep.berlios.de>

Author: gruntster
Date: 2010-04-06 13:49:37 +0200 (Tue, 06 Apr 2010)
New Revision: 6068

Added:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/Mpeg1Param.xsd
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Options.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Options.h
Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/Mpeg2Param.xsd
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Options.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Options.h
Log:
[mpeg2enc] add option for sequence length limit to mpeg2enc plugin

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/CMakeLists.txt	2010-04-06 08:06:00 UTC (rev 6067)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/CMakeLists.txt	2010-04-06 11:49:37 UTC (rev 6068)
@@ -2,14 +2,14 @@
 INCLUDE(admPluginVideoEncoder)
 
 add_subdirectory(mpeg2enc)
-SET(ADM_vidEnc_mpeg2enc_SRCS  interface.c  encoder.cpp  mpeg1Encoder.cpp  mpeg2Encoder.cpp  mpeg2Options.cpp)
+SET(ADM_vidEnc_mpeg2enc_SRCS  interface.c  encoder.cpp  mpeg1Options.cpp  mpeg1Encoder.cpp  mpeg2Encoder.cpp  mpeg2Options.cpp)
 
 INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR} ${LIBXML2_INCLUDE_DIR} ../common/pluginOptions ../common/xvidRateCtl mpeg2enc)
-ADD_DEFINITIONS(${LIBXML2_DEFINITIONS} -DMPEG2_PLUGIN_CONFIG_DIR="mpegenc")
+ADD_DEFINITIONS(${LIBXML2_DEFINITIONS} -DMPEG2ENC_PLUGIN_CONFIG_DIR="mpegenc")
 
 ADD_LIBRARY(ADM_vidEnc_mpeg2enc SHARED ${ADM_vidEnc_mpeg2enc_SRCS})
 TARGET_LINK_LIBRARIES(ADM_vidEnc_mpeg2enc ${LIBXML2_LIBRARIES} mpeg2enc ADM_xvidRateCtl ADM_core ADM_coreUI ADM_vidEnc_pluginOptions)
 
 INIT_VIDEO_ENCODER_PLUGIN(ADM_vidEnc_mpeg2enc)
 INSTALL_VIDEO_ENCODER(ADM_vidEnc_mpeg2enc)
-INSTALL(FILES Mpeg2Param.xsd DESTINATION "${VIDENC_INSTALL_DIR}mpeg2enc")
\ No newline at end of file
+INSTALL(FILES Mpeg1Param.xsd Mpeg2Param.xsd DESTINATION "${VIDENC_INSTALL_DIR}mpeg2enc")
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/Mpeg1Param.xsd
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/Mpeg1Param.xsd	2010-04-06 08:06:00 UTC (rev 6067)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/Mpeg1Param.xsd	2010-04-06 11:49:37 UTC (rev 6068)
@@ -0,0 +1,61 @@
+<?xml version="1.0" encoding="utf-8"?>
+<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema" elementFormDefault="qualified">
+  <xs:element name="Mpeg1Config">
+    <xs:complexType>
+      <xs:sequence>
+        <xs:element name="presetConfiguration" minOccurs="0">
+          <xs:complexType>
+            <xs:sequence>
+              <xs:element name="name" type="xs:string"/>
+              <xs:element name="type">
+                <xs:simpleType>
+                  <xs:restriction base="xs:string">
+                    <xs:enumeration value="default"/>
+                    <xs:enumeration value="user"/>
+                    <xs:enumeration value="system"/>
+                  </xs:restriction>
+                </xs:simpleType>
+              </xs:element>
+            </xs:sequence>
+          </xs:complexType>
+        </xs:element>
+        <xs:element name="encodeOptions" minOccurs="0">
+          <xs:complexType>
+            <xs:sequence>
+              <xs:element name="mode">
+                <xs:simpleType>
+                  <xs:restriction base="xs:string">
+                    <xs:enumeration value="CBR"/>
+                    <xs:enumeration value="CQP"/>
+                    <xs:enumeration value="2PASS SIZE"/>
+                    <xs:enumeration value="2PASS ABR"/>
+                  </xs:restriction>
+                </xs:simpleType>
+              </xs:element>
+              <xs:element name="parameter" type="uint"/>
+            </xs:sequence>
+          </xs:complexType>
+        </xs:element>
+        <xs:element name="Mpeg1Options">
+          <xs:complexType>
+            <xs:sequence>
+              <xs:element name="fileSplit" minOccurs="0">
+                <xs:simpleType>
+                  <xs:restriction base="xs:integer">
+                    <xs:minInclusive value="400"/>
+                    <xs:maxInclusive value="4096"/>
+                  </xs:restriction>
+                </xs:simpleType>
+              </xs:element>
+            </xs:sequence>
+          </xs:complexType>
+        </xs:element>
+      </xs:sequence>
+    </xs:complexType>
+  </xs:element>
+  <xs:simpleType name="uint">
+    <xs:restriction base="xs:integer">
+      <xs:minInclusive value="0"/>
+    </xs:restriction>
+  </xs:simpleType>
+</xs:schema>

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/Mpeg2Param.xsd
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/Mpeg2Param.xsd	2010-04-06 08:06:00 UTC (rev 6067)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/Mpeg2Param.xsd	2010-04-06 11:49:37 UTC (rev 6068)
@@ -47,6 +47,14 @@
                   </xs:restriction>
                 </xs:simpleType>
               </xs:element>
+              <xs:element name="fileSplit" minOccurs="0">
+                <xs:simpleType>
+                  <xs:restriction base="xs:integer">
+                    <xs:minInclusive value="400"/>
+                    <xs:maxInclusive value="4096"/>
+                  </xs:restriction>
+                </xs:simpleType>
+              </xs:element>
               <xs:element name="widescreen" type="xs:boolean" minOccurs="0"/>
               <xs:element name="streamType" minOccurs="0">
                 <xs:simpleType>

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.cpp	2010-04-06 08:06:00 UTC (rev 6067)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.cpp	2010-04-06 11:49:37 UTC (rev 6068)
@@ -22,6 +22,8 @@
 
 extern int _uiType;
 static bool changedConfig(const char* fileName, ConfigMenuType configType);
+static char *serializeConfig(void);
+static Mpeg1Encoder *encoder = NULL;
 
 #ifdef __WIN32
 extern void convertPathToAnsi(const char *path, char **ansiPath);
@@ -29,8 +31,11 @@
 
 Mpeg1Encoder::Mpeg1Encoder(void)
 {
+	encoder = this;
+
 	_passCount = 1;
-	_encodeOptions.encodeMode == ADM_VIDENC_MODE_CBR;
+	_encodeOptions.encodeMode = MPEG1_DEFAULT_ENCODE_MODE;
+	_encodeOptions.encodeModeParameter = MPEG1_DEFAULT_ENCODE_MODE_PARAMETER;
 }
 
 const char* Mpeg1Encoder::getEncoderType(void)
@@ -53,20 +58,125 @@
 	return "056FE919-C1D3-4450-A812-A767EAB07786";
 }
 
-int Mpeg1Encoder::getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize)
+int Mpeg1Encoder::isConfigurable(void)
 {
-	if (encodeOptions)
+	return (_uiType == ADM_UI_GTK || _uiType == ADM_UI_QT4);
+}
+
+int Mpeg1Encoder::configure(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties)
+{
+	loadSettings(NULL, &_options);
+
+	diaElemUInteger ctlSplitFile(&_splitFile, "New sequence every (MB):", 400, 4096);
+	diaElem *elmGeneral[1] = {&ctlSplitFile};
+
+	diaElemConfigMenu ctlConfigMenu(configName, &configType, _options.getUserConfigDirectory(), _options.getSystemConfigDirectory(),
+		changedConfig, serializeConfig, elmGeneral, 1);
+	diaElem *elmHeader[1] = {&ctlConfigMenu};
+
+	diaElemTabs tabGeneral("Settings", 1, elmGeneral);
+	diaElemTabs *tabs[] = {&tabGeneral};
+
+	if (diaFactoryRunTabs("mpeg2enc Configuration", 1, elmHeader, 1, tabs))
 	{
-		encodeOptions->encodeMode = ADM_VIDENC_MODE_CBR;
-		encodeOptions->encodeModeParameter = 1000;
+		saveSettings(NULL, &_options);
+
+		return 1;
 	}
 
 	return 0;
 }
 
+void Mpeg1Encoder::loadSettings(vidEncOptions *encodeOptions, Mpeg1Options *options)
+{
+	char *configurationName;
+
+	options->getPresetConfiguration(&configurationName, (PluginConfigType*)&configType);
+
+	if (configurationName)
+	{
+		strcpy(this->configName, configurationName);
+		delete [] configurationName;
+	}
+
+	if ((int)encodeOptions != -1)
+		_splitFile = options->getFileSplit();
+}
+
+void Mpeg1Encoder::saveSettings(vidEncOptions *encodeOptions, Mpeg1Options *options)
+{
+	options->setPresetConfiguration(&configName[0], (PluginConfigType)configType);
+	options->setFileSplit(_splitFile);
+}
+
+bool changedConfig(const char* configName, ConfigMenuType configType)
+{
+	if (configType == CONFIG_MENU_DEFAULT)
+	{
+		Mpeg1Options defaultOptions;
+
+		encoder->loadSettings(NULL, &defaultOptions);
+	}
+	else
+	{
+		Mpeg1Options options;
+
+		options.setPresetConfiguration(configName, (PluginConfigType)configType);
+
+		if (configType == CONFIG_MENU_CUSTOM)
+			encoder->loadSettings((vidEncOptions*)-1, &options);
+		else
+			encoder->loadSettings(NULL, &options);
+	}
+
+	return true;
+}
+
+char *serializeConfig(void)
+{
+	Mpeg1Options options;
+
+	encoder->saveSettings(NULL, &options);
+
+	return options.toXml(PLUGIN_XML_EXTERNAL);
+}
+
+int Mpeg1Encoder::getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize)
+{
+	char* xml = _options.toXml(PLUGIN_XML_INTERNAL);
+	int xmlLength = strlen(xml);
+
+	if (bufferSize >= xmlLength)
+	{
+		memcpy(pluginOptions, xml, xmlLength);
+		memcpy(encodeOptions, &_encodeOptions, sizeof(vidEncOptions));
+	}
+	else if (bufferSize != 0)
+		xmlLength = 0;
+
+	delete [] xml;
+
+	return xmlLength;
+}
+
 int Mpeg1Encoder::setOptions(vidEncOptions *encodeOptions, const char *pluginOptions)
 {
-	return ADM_VIDENC_ERR_SUCCESS;
+	if (_opened)
+		return ADM_VIDENC_ERR_ALREADY_OPEN;
+
+	bool success = true;
+
+	if (pluginOptions)
+	{
+		success = _options.fromXml(pluginOptions, PLUGIN_XML_INTERNAL);
+
+		_options.loadPresetConfiguration();
+	}
+
+	if (success)
+		return ADM_VIDENC_ERR_SUCCESS;
+	else
+		return ADM_VIDENC_ERR_FAILED;
 }
 
 int Mpeg1Encoder::initParameters(int *encodeModeParameter, int *maxBitrate, int *vbv)
@@ -75,6 +185,8 @@
 	_param.format = MPEG_FORMAT_VCD;
 	_param.aspect_ratio = 2;
 	_param.min_GOP_size = _param.max_GOP_size = 18;
+	_param.seq_length_limit = _options.getFileSplit();
+
 	*encodeModeParameter = 1000;
 	*maxBitrate = 9216000;
 	*vbv = 0;

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.h	2010-04-06 08:06:00 UTC (rev 6067)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.h	2010-04-06 11:49:37 UTC (rev 6068)
@@ -25,11 +25,18 @@
 #include <limits.h>
 
 #include "encoder.h"
+#include "mpeg1Options.h"
 #include "DIA_factory.h"
 
 class Mpeg1Encoder : public Mpeg2encEncoder
 {
 	private:
+		unsigned int _splitFile;
+		
+		char configName[PATH_MAX];
+		ConfigMenuType configType;
+
+		Mpeg1Options _options;
 		vidEncVideoProperties _properties;
 
 		int _bufferSize;
@@ -43,6 +50,10 @@
 		const char* getEncoderDescription(void);
 		const char* getFourCC(void);
 		const char* getEncoderGuid(void);
+		int isConfigurable(void);
+		int configure(vidEncConfigParameters *configParameters, vidEncVideoProperties *properties);
+		void loadSettings(vidEncOptions *encodeOptions, Mpeg1Options *options);
+		void saveSettings(vidEncOptions *encodeOptions, Mpeg1Options *options);
 		int getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize);
 		int setOptions(vidEncOptions *encodeOptions, const char *pluginOptions);
 };

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Options.cpp	2010-04-06 08:06:00 UTC (rev 6067)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Options.cpp	2010-04-06 11:49:37 UTC (rev 6068)
@@ -0,0 +1,81 @@
+ /***************************************************************************
+                               Mpeg1Options.cpp
+
+	These settings are intended for scripting and can contain a Preset 
+	Configuration block.  If this block exists then "internal" settings are
+	ignored and an external configuration file should be read instead, 
+	e.g. PlayStation Portable profile.  However, if the external file is 
+	missing, internal settings have to be used and will reflect a snapshot
+	of the external configuration file at the time the script was generated.
+
+    begin                : Tue Apr 6 2010
+    copyright            : (C) 2010 by gruntster
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include <math.h>
+#include <libxml/parser.h>
+#include <libxml/xmlschemas.h>
+#include <sstream>
+#include <string>
+#include "ADM_default.h"
+#include "ADM_files.h"
+
+#include "mpeg1Options.h"
+
+Mpeg1Options::Mpeg1Options(void) : PluginOptions(MPEG2ENC_PLUGIN_CONFIG_DIR, "Mpeg1", "mpeg2enc/Mpeg1Param.xsd", MPEG1_DEFAULT_ENCODE_MODE, MPEG1_DEFAULT_ENCODE_MODE_PARAMETER)
+{
+	reset();
+}
+
+void Mpeg1Options::reset(void)
+{
+	PluginOptions::reset();
+
+	setFileSplit(790);
+}
+
+unsigned int Mpeg1Options::getFileSplit(void)
+{
+	return _fileSplit;
+}
+
+void Mpeg1Options::setFileSplit(unsigned int mb)
+{
+	if (mb >= 400 && mb <= 4096)
+		_fileSplit = mb;
+}
+
+void Mpeg1Options::addOptionsToXml(xmlNodePtr xmlNodeRoot)
+{
+	const int bufferSize = 100;
+	xmlChar xmlBuffer[bufferSize + 1];
+	xmlNodePtr xmlNodeChild, xmlNodeChild2;
+
+	xmlNodeRoot = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)getOptionsTagRoot(), NULL);
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"fileSplit", number2String(xmlBuffer, bufferSize, getFileSplit()));
+}
+
+void Mpeg1Options::parseOptions(xmlNode *node)
+{
+	for (xmlNode *xmlChild = node->children; xmlChild; xmlChild = xmlChild->next)
+	{
+		if (xmlChild->type == XML_ELEMENT_NODE)
+		{
+			char *content = (char*)xmlNodeGetContent(xmlChild);
+
+			if (strcmp((char*)xmlChild->name, "fileSplit") == 0)
+				setFileSplit(atoi(content));
+
+			xmlFree(content);
+		}
+	}
+}

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Options.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Options.h	2010-04-06 08:06:00 UTC (rev 6067)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Options.h	2010-04-06 11:49:37 UTC (rev 6068)
@@ -0,0 +1,47 @@
+ /***************************************************************************
+                               mpeg1Options.h
+
+    begin                : Tue Apr 6 2010
+    copyright            : (C) 2010 by gruntster
+ ***************************************************************************/
+
+ /***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef mpeg1Options_h
+#define mpeg1Options_h
+
+#include <vector>
+#include "PluginOptions.h"
+
+extern "C"
+{
+#include "ADM_vidEnc_plugin.h"
+}
+
+#define MPEG1_DEFAULT_ENCODE_MODE ADM_VIDENC_MODE_CBR
+#define MPEG1_DEFAULT_ENCODE_MODE_PARAMETER 1000
+
+class Mpeg1Options : public PluginOptions
+{
+protected:
+	unsigned int _fileSplit;
+
+	void addOptionsToXml(xmlNodePtr xmlNodeRoot);
+	void parseOptions(xmlNode *node);
+
+public:
+	Mpeg1Options(void);
+	void reset(void);
+
+	unsigned int getFileSplit(void);
+	void setFileSplit(unsigned int mb);
+};
+
+#endif	// mpeg1Options_h

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.cpp	2010-04-06 08:06:00 UTC (rev 6067)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.cpp	2010-04-06 11:49:37 UTC (rev 6068)
@@ -96,17 +96,18 @@
 
 	diaElemBitrate ctlBitrate(&_bitrateParam, NULL);
 	diaElemUInteger ctlMaxb(&_maxBitrate, "Ma_x. bitrate:", 100, 9000);
+	diaElemUInteger ctlSplitFile(&_splitFile, "New sequence every (MB):", 400, 4096);
 	diaElemMenu ctlStreamType(&_streamType, "Stream _type:", 2, streamM);
 	diaElemMenu ctlWidescreen(&_widescreen, "Aspect _ratio:", 2, wideM);
 	diaElemMenu ctlMatrix(&_userMatrix, "_Matrices:", 4, matrixM);
 	diaElemMenu ctlInterW(&_interlaced, "_Interlacing:", 3, interM);
-	diaElem *elmGeneral[6] = {&ctlBitrate, &ctlMaxb, &ctlStreamType, &ctlWidescreen, &ctlInterW, &ctlMatrix};
+	diaElem *elmGeneral[7] = {&ctlBitrate, &ctlMaxb, &ctlSplitFile, &ctlStreamType, &ctlWidescreen, &ctlInterW, &ctlMatrix};
 
 	diaElemConfigMenu ctlConfigMenu(configName, &configType, _options.getUserConfigDirectory(), _options.getSystemConfigDirectory(),
-		changedConfig, serializeConfig, elmGeneral, 6);
+		changedConfig, serializeConfig, elmGeneral, 7);
 	diaElem *elmHeader[1] = {&ctlConfigMenu};
 
-	diaElemTabs tabGeneral("Settings", 6, elmGeneral);
+	diaElemTabs tabGeneral("Settings", 7, elmGeneral);
 	diaElemTabs *tabs[] = {&tabGeneral};
 
 	if (diaFactoryRunTabs("mpeg2enc Configuration", 1, elmHeader, 1, tabs))
@@ -135,6 +136,7 @@
 	if (encodeOptions)
 	{
 		_maxBitrate = options->getMaxBitrate();
+		_splitFile = options->getFileSplit();
 		_widescreen = options->getWidescreen();
 		_interlaced = options->getInterlaced();
 		_userMatrix = options->getMatrix();
@@ -173,6 +175,7 @@
 	}
 
 	options->setMaxBitrate(_maxBitrate);
+	options->setFileSplit(_splitFile);
 	options->setWidescreen(_widescreen);
 	options->setInterlaced((Mpeg2InterlacedMode)_interlaced);
 	options->setMatrix((Mpeg2MatrixMode)_userMatrix);
@@ -320,6 +323,8 @@
 	else
 		_param.min_GOP_size = _param.max_GOP_size = 18;
 
+	_param.seq_length_limit = _options.getFileSplit();
+
 	*encodeModeParameter = _encodeOptions.encodeModeParameter;
 	*maxBitrate = _options.getMaxBitrate();
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.h	2010-04-06 08:06:00 UTC (rev 6067)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.h	2010-04-06 11:49:37 UTC (rev 6068)
@@ -32,7 +32,7 @@
 {
 	private:
 		COMPRES_PARAMS _bitrateParam;
-		unsigned int _maxBitrate, _streamType, _widescreen, _interlaced, _userMatrix;
+		unsigned int _maxBitrate, _splitFile, _streamType, _widescreen, _interlaced, _userMatrix;
 
 		char configName[PATH_MAX];
 		ConfigMenuType configType;

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Options.cpp	2010-04-06 08:06:00 UTC (rev 6067)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Options.cpp	2010-04-06 11:49:37 UTC (rev 6068)
@@ -31,7 +31,7 @@
 
 #include "mpeg2Options.h"
 
-Mpeg2Options::Mpeg2Options(void) : PluginOptions(MPEG2_PLUGIN_CONFIG_DIR, "Mpeg2", "mpeg2enc/Mpeg2Param.xsd", MPEG2_DEFAULT_ENCODE_MODE, MPEG2_DEFAULT_ENCODE_MODE_PARAMETER)
+Mpeg2Options::Mpeg2Options(void) : PluginOptions(MPEG2ENC_PLUGIN_CONFIG_DIR, "Mpeg2", "mpeg2enc/Mpeg2Param.xsd", MPEG2_DEFAULT_ENCODE_MODE, MPEG2_DEFAULT_ENCODE_MODE_PARAMETER)
 {
 	reset();
 }
@@ -41,6 +41,7 @@
 	PluginOptions::reset();
 
 	setMaxBitrate(9000);
+	setFileSplit(4096);
 	setStreamType(MPEG2_STREAMTYPE_DVD);
 	setWidescreen(false);
 	setInterlaced(MPEG2_INTERLACED_NONE);
@@ -58,6 +59,17 @@
 		_maxBitrate = maxBitrate;
 }
 
+unsigned int Mpeg2Options::getFileSplit(void)
+{
+	return _fileSplit;
+}
+
+void Mpeg2Options::setFileSplit(unsigned int mb)
+{
+	if (mb >= 400 && mb <= 4096)
+		_fileSplit = mb;
+}
+
 bool Mpeg2Options::getWidescreen(void)
 {
 	return _widescreen;
@@ -109,6 +121,7 @@
 
 	xmlNodeRoot = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)getOptionsTagRoot(), NULL);
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"maxBitrate", number2String(xmlBuffer, bufferSize, getMaxBitrate()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"fileSplit", number2String(xmlBuffer, bufferSize, getFileSplit()));
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"widescreen", boolean2String(xmlBuffer, bufferSize, getWidescreen()));
 
 	switch (getStreamType())
@@ -162,6 +175,8 @@
 
 			if (strcmp((char*)xmlChild->name, "maxBitrate") == 0)
 				setMaxBitrate(atoi(content));
+			else if (strcmp((char*)xmlChild->name, "fileSplit") == 0)
+				setFileSplit(atoi(content));
 			else if (strcmp((char*)xmlChild->name, "widescreen") == 0)
 				setWidescreen(string2Boolean(content));
 			else if (strcmp((char*)xmlChild->name, "streamType") == 0)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Options.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Options.h	2010-04-06 08:06:00 UTC (rev 6067)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Options.h	2010-04-06 11:49:37 UTC (rev 6068)
@@ -51,7 +51,7 @@
 class Mpeg2Options : public PluginOptions
 {
 protected:
-	unsigned int _maxBitrate;
+	unsigned int _maxBitrate, _fileSplit;
 	bool _widescreen;
 	Mpeg2InterlacedMode _interlaced;
 	Mpeg2MatrixMode _matrix;
@@ -67,6 +67,9 @@
 	unsigned int getMaxBitrate(void);
 	void setMaxBitrate(unsigned int maxBitrate);
 
+	unsigned int getFileSplit(void);
+	void setFileSplit(unsigned int mb);
+
 	bool getWidescreen(void);
 	void setWidescreen(bool widescreen);
 



From gruntster at mail.berlios.de  Tue Apr  6 14:44:09 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 6 Apr 2010 14:44:09 +0200
Subject: [Avidemux-svn-commit] r6069 - in
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc:
	. xml xml/mpeg-1 xml/mpeg-2
Message-ID: <201004061244.o36Ci9dd006029@sheep.berlios.de>

Author: gruntster
Date: 2010-04-06 14:44:01 +0200 (Tue, 06 Apr 2010)
New Revision: 6069

Added:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-1/
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-1/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-1/Video CD.xml
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-2/
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-2/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-2/DVD.xml
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-2/Super Video CD.xml
Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Options.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Options.cpp
Log:
[mpeg2enc] add some presets

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/CMakeLists.txt	2010-04-06 11:49:37 UTC (rev 6068)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/CMakeLists.txt	2010-04-06 12:44:01 UTC (rev 6069)
@@ -1,12 +1,19 @@
 INCLUDE(admCheckLibxml2)
 INCLUDE(admPluginVideoEncoder)
 
-add_subdirectory(mpeg2enc)
 SET(ADM_vidEnc_mpeg2enc_SRCS  interface.c  encoder.cpp  mpeg1Options.cpp  mpeg1Encoder.cpp  mpeg2Encoder.cpp  mpeg2Options.cpp)
 
+set(PLUGIN_SCHEMA_DIR "mpeg2enc")
+set(MPEG1_PLUGIN_CONFIG_DIR "mpeg2enc/mpeg-1")
+set(MPEG2_PLUGIN_CONFIG_DIR "mpeg2enc/mpeg-2")
+
 INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR} ${LIBXML2_INCLUDE_DIR} ../common/pluginOptions ../common/xvidRateCtl mpeg2enc)
-ADD_DEFINITIONS(${LIBXML2_DEFINITIONS} -DMPEG2ENC_PLUGIN_CONFIG_DIR="mpegenc")
+ADD_DEFINITIONS(${LIBXML2_DEFINITIONS})
+set_property(SOURCE mpeg1Options.cpp PROPERTY COMPILE_FLAGS -DMPEG1_PLUGIN_CONFIG_DIR=\\\"${MPEG1_PLUGIN_CONFIG_DIR}\\\")
+set_property(SOURCE mpeg2Options.cpp PROPERTY COMPILE_FLAGS -DMPEG2_PLUGIN_CONFIG_DIR=\\\"${MPEG2_PLUGIN_CONFIG_DIR}\\\")
 
+add_subdirectory(mpeg2enc)
+add_subdirectory(xml)
 ADD_LIBRARY(ADM_vidEnc_mpeg2enc SHARED ${ADM_vidEnc_mpeg2enc_SRCS})
 TARGET_LINK_LIBRARIES(ADM_vidEnc_mpeg2enc ${LIBXML2_LIBRARIES} mpeg2enc ADM_xvidRateCtl ADM_core ADM_coreUI ADM_vidEnc_pluginOptions)
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.cpp	2010-04-06 11:49:37 UTC (rev 6068)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.cpp	2010-04-06 12:44:01 UTC (rev 6069)
@@ -99,7 +99,7 @@
 		delete [] configurationName;
 	}
 
-	if ((int)encodeOptions != -1)
+	if ((intptr_t)encodeOptions != -1)
 		_splitFile = options->getFileSplit();
 }
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Options.cpp	2010-04-06 11:49:37 UTC (rev 6068)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Options.cpp	2010-04-06 12:44:01 UTC (rev 6069)
@@ -31,7 +31,7 @@
 
 #include "mpeg1Options.h"
 
-Mpeg1Options::Mpeg1Options(void) : PluginOptions(MPEG2ENC_PLUGIN_CONFIG_DIR, "Mpeg1", "mpeg2enc/Mpeg1Param.xsd", MPEG1_DEFAULT_ENCODE_MODE, MPEG1_DEFAULT_ENCODE_MODE_PARAMETER)
+Mpeg1Options::Mpeg1Options(void) : PluginOptions(MPEG1_PLUGIN_CONFIG_DIR, "Mpeg1", "mpeg2enc/Mpeg1Param.xsd", MPEG1_DEFAULT_ENCODE_MODE, MPEG1_DEFAULT_ENCODE_MODE_PARAMETER)
 {
 	reset();
 }

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Options.cpp	2010-04-06 11:49:37 UTC (rev 6068)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Options.cpp	2010-04-06 12:44:01 UTC (rev 6069)
@@ -31,7 +31,7 @@
 
 #include "mpeg2Options.h"
 
-Mpeg2Options::Mpeg2Options(void) : PluginOptions(MPEG2ENC_PLUGIN_CONFIG_DIR, "Mpeg2", "mpeg2enc/Mpeg2Param.xsd", MPEG2_DEFAULT_ENCODE_MODE, MPEG2_DEFAULT_ENCODE_MODE_PARAMETER)
+Mpeg2Options::Mpeg2Options(void) : PluginOptions(MPEG2_PLUGIN_CONFIG_DIR, "Mpeg2", "mpeg2enc/Mpeg2Param.xsd", MPEG2_DEFAULT_ENCODE_MODE, MPEG2_DEFAULT_ENCODE_MODE_PARAMETER)
 {
 	reset();
 }

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/CMakeLists.txt	2010-04-06 11:49:37 UTC (rev 6068)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/CMakeLists.txt	2010-04-06 12:44:01 UTC (rev 6069)
@@ -0,0 +1,2 @@
+add_subdirectory(mpeg-1)
+add_subdirectory(mpeg-2)
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-1/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-1/CMakeLists.txt	2010-04-06 11:49:37 UTC (rev 6068)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-1/CMakeLists.txt	2010-04-06 12:44:01 UTC (rev 6069)
@@ -0,0 +1 @@
+INSTALL(DIRECTORY . DESTINATION "${VIDENC_INSTALL_DIR}${MPEG1_PLUGIN_CONFIG_DIR}" FILES_MATCHING PATTERN "*.xml" PATTERN ".svn" EXCLUDE)
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-1/Video CD.xml
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-1/Video CD.xml	2010-04-06 11:49:37 UTC (rev 6068)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-1/Video CD.xml	2010-04-06 12:44:01 UTC (rev 6069)
@@ -0,0 +1 @@
+<?xml version='1.0'?><Mpeg1Config><encodeOptions><mode>CBR</mode><parameter>1000</parameter></encodeOptions><Mpeg1Options><fileSplit>790</fileSplit></Mpeg1Options></Mpeg1Config>
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-2/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-2/CMakeLists.txt	2010-04-06 11:49:37 UTC (rev 6068)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-2/CMakeLists.txt	2010-04-06 12:44:01 UTC (rev 6069)
@@ -0,0 +1 @@
+INSTALL(DIRECTORY . DESTINATION "${VIDENC_INSTALL_DIR}${MPEG2_PLUGIN_CONFIG_DIR}" FILES_MATCHING PATTERN "*.xml" PATTERN ".svn" EXCLUDE)
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-2/DVD.xml
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-2/DVD.xml	2010-04-06 11:49:37 UTC (rev 6068)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-2/DVD.xml	2010-04-06 12:44:01 UTC (rev 6069)
@@ -0,0 +1 @@
+<?xml version='1.0'?><Mpeg2Config><encodeOptions><mode>CQP</mode><parameter>4</parameter></encodeOptions><Mpeg2Options><maxBitrate>9000</maxBitrate><fileSplit>4096</fileSplit><widescreen>false</widescreen><streamType>dvd</streamType><interlaced>none</interlaced></Mpeg2Options></Mpeg2Config>
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-2/Super Video CD.xml
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-2/Super Video CD.xml	2010-04-06 11:49:37 UTC (rev 6068)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/xml/mpeg-2/Super Video CD.xml	2010-04-06 12:44:01 UTC (rev 6069)
@@ -0,0 +1 @@
+<?xml version='1.0'?><Mpeg2Config><encodeOptions><mode>CQP</mode><parameter>4</parameter></encodeOptions><Mpeg2Options><maxBitrate>2500</maxBitrate><fileSplit>790</fileSplit><widescreen>false</widescreen><streamType>svcd</streamType><interlaced>none</interlaced></Mpeg2Options></Mpeg2Config>
\ No newline at end of file



From gruntster at mail.berlios.de  Tue Apr  6 14:49:14 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 6 Apr 2010 14:49:14 +0200
Subject: [Avidemux-svn-commit] r6070 -
	branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy
Message-ID: <201004061249.o36CnEUu006380@sheep.berlios.de>

Author: gruntster
Date: 2010-04-06 14:49:08 +0200 (Tue, 06 Apr 2010)
New Revision: 6070

Modified:
   branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/avsHeader.h
   branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/avsproxy.cpp
   branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/avsproxy.sln
   branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/avsproxy.vcproj
   branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/sket.cpp
   branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/sket.h
Log:
[avsproxy] backport avisynth proxy from 2.6 branch

Modified: branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/avsHeader.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/avsHeader.h	2010-04-06 12:44:01 UTC (rev 6069)
+++ branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/avsHeader.h	2010-04-06 12:49:08 UTC (rev 6070)
@@ -1,25 +1,38 @@
-/*
+/** 
+	\file avsHeader.h
+	\brief Content of exchanges between avidemux and avsproxy
 
 
-
 */
 #ifndef AVS_HEADER_H
 #define AVS_HEADER_H
+#define AVSHEADER_API_VERSION 2
 typedef enum AvsEnum
 {
 	AvsCmd_GetInfo=1,
-	AvsCmd_SendInfo,
-	AvsCmd_GetFrame,
-	AvsCmd_SendFrame,
-	AvsCmd_Quit
+	AvsCmd_SendInfo=2,
+	AvsCmd_GetFrame=3,
+	AvsCmd_SendFrame=4,
+	AvsCmd_GetAudio=5,
+	AvsCmd_SendAudio=6,
+	AvsCmd_Quit=99
 };
 
 typedef struct avsInfo
 {
+	uint32_t version;
 	uint32_t width;
 	uint32_t height;
 	uint32_t fps1000;
 	uint32_t nbFrames;
+	uint32_t frequency;
+	uint32_t channels;
 }avsyInfo;
+
+typedef struct 
+{
+	uint32_t sizeInFloatSample;
+	uint64_t startSample;       // -1 means continue
+}avsAudioFrame;
 #endif
 

Modified: branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/avsproxy.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/avsproxy.cpp	2010-04-06 12:44:01 UTC (rev 6069)
+++ branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/avsproxy.cpp	2010-04-06 12:49:08 UTC (rev 6070)
@@ -5,14 +5,9 @@
 // the Free Software Foundation; either version 2 of the License, or
 // (at your option) any later version.
 
-/* #include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <io.h>
-#include <fcntl.h>
-#include <windef.h>*/
 
 #define __int64_t long long int
+#define uint64_t long long unsigned int
 
 #include "internal.h"
 #include "sket.h"
@@ -22,35 +17,39 @@
 #define INT_MAX 0x7fffffff
 #endif
 
-#define MY_VERSION "Avs2YUV 0.24 ADM_0.1"
+#define MY_VERSION "Avs2YUV 0.24 ADM_1.2"
 #define MAX_FH 10
-
 #include "winsock2.h"
-	int vid_width=-1;
-	int vid_height=-1;
-	int vid_fps1000=-1;
-	int vid_nbFrame=-1;
-	uint32_t currentFrame=0xFFFF0000;
-	char *Buffer;
+#define Log printf
+/******************************************/
+int vid_width=-1;
+int vid_height=-1;
+int vid_fps1000=-1;
+int vid_nbFrame=-1;
+uint32_t currentFrame=0xFFFF0000;
+char *Buffer;
 
-static int framePack(PVideoFrame p);
-static void handleError(void);
-static uint8_t initAvisynth(const char *infile);
-
-
-
 PVideoFrame Aframe=NULL;
 IScriptEnvironment* env =NULL;
 PClip clip =NULL;
 avsyInfo    info;
 
+/*****************************************/
+static int framePack(PVideoFrame p);
+static void handleError(void);
+static bool initAvisynth(const char *infile);
 
+
+/**
+	\fn main
+*/
 int __cdecl main(int argc, const char* argv[])
 {
 	const char* infile = NULL;
-	
+	char *audioBuffer=new char[48000*6*2];
+	char *audioBufferData=audioBuffer+sizeof(avsAudioFrame);
 
-	printf("AvsSocket Proxy, derivated from avs2yuv by  Loren Merritt \n");
+	printf("AvsSocket Proxy, derivated from avs2yuv by  Loren Merritt "MY_VERSION" \n");
 	fflush(stdout);
 	
 	
@@ -134,14 +133,53 @@
 					case AvsCmd_GetInfo:
 							printf("Received get info...\n");
 							fflush(stdout);
+							if(len!=8)
+							{
+									// Version
+									printf("This version of avsproxy is not compatible with the avidemux version you are using\n");
+									fflush(stdout);
+									exit( -1);
+							}
+							uint32_t api,ver;
+							api=*(uint32_t *)payload;
+							ver=*(uint32_t *)(payload+4);
+							printf("Connection from avidemux, api=%d version=%d\n",api,ver);
+							if(api!=AVSHEADER_API_VERSION)
+							{
+									printf("This version of avsproxy has api version %d, avidemux has version %d, exiting\n",AVSHEADER_API_VERSION,api);
+									fflush(stdout);
+									exit(-1);
+							}
 							sket->sendData(AvsCmd_SendInfo,0,sizeof(info),(uint8_t *)&info);
 							break;
+					case AvsCmd_GetAudio:
+							// Read payload
+							if(len!=sizeof(avsAudioFrame))
+							{
+									printf("get audio command, expected %d bytes , got %d \n",sizeof(avsAudioFrame),len);
+									fflush(stdout);
+									exit(-1);	
+							}
+							avsAudioFrame aFrame;
+							memcpy(&aFrame,payload,len);
+							// Read...
+							try {
+								clip->GetAudio(audioBufferData, aFrame.startSample, aFrame.sizeInFloatSample, env);
+							}catch(AvisynthError err) 
+							{
+								fprintf(stderr, "Get Audio :Avisynth error:\n%s\n", err.msg);	
+							    aFrame.sizeInFloatSample=0;
+							}
+							// Send reply...
+							memcpy(audioBuffer,&aFrame,sizeof(aFrame));
+							sket->sendData(AvsCmd_SendAudio,0,aFrame.sizeInFloatSample*2*info.channels+sizeof(aFrame),(uint8_t *)audioBuffer);
+							break;
 					case AvsCmd_GetFrame:
 							if(currentFrame!=frame)
 							{
 								
 							try{
-								printf("Get frame %u (old:%u)\n",frame,currentFrame);
+								Log("Get frame %u (old:%u)\n",frame,currentFrame);
 								fflush(stdout);
 								Aframe= clip->GetFrame(frame, env);
 								framePack(Aframe);	
@@ -175,12 +213,12 @@
 			}
 
 
-		}
-
-		//get(currentFrame);
-	
+		}	
 }
-
+/**
+	\fn framePack
+	\brief Pack a video frame inside our buffer
+*/
 int framePack(PVideoFrame p)
 {
 			int w,stride;
@@ -222,7 +260,9 @@
 			}
 			return 1;
 }
-
+/**
+	\fn handleError
+*/
 void handleError(void)
 {
 	DWORD er=GetLastError();
@@ -231,10 +271,12 @@
 	exit(-1);
 
 }
-#if 1
+/**
+	\fn initAvisynth
+*/
 typedef IScriptEnvironment * __stdcall DLLFUNC(int);
 
-uint8_t initAvisynth(const char *infile)
+bool initAvisynth(const char *infile)
 {
 		HMODULE instance;
 		DLLFUNC *CreateScriptEnvironment=NULL;
@@ -247,7 +289,7 @@
 			handleError();
 			fprintf(stderr, "failed to load avisynth.dll\n"); 
 			fflush(stderr);
-			return 2;
+			return false;
 		}
 		printf("Avisynth.dll loaded\n");
 		fflush(stdout);
@@ -255,12 +297,18 @@
 		printf("Env created\n");
 		fflush(stdout);
 		if(!CreateScriptEnvironment)
-			{fprintf(stderr, "failed to load CreateScriptEnvironment()\n"); fflush(stderr); return 1;}
+		{
+			fprintf(stderr, "failed to load CreateScriptEnvironment()\n"); 
+			fflush(stderr); 
+			return false;
+		}
 try{
 		env = CreateScriptEnvironment(AVISYNTH_INTERFACE_VERSION);
 		if(!env)
 		{
-			{fprintf(stderr, "Env failed\n"); fflush(stderr); return 1;}
+			fprintf(stderr, "Env failed\n"); 
+			fflush(stderr); 
+			return false;
 		}
 		AVSValue args[]={infile};
 		printf("Importing..\n");
@@ -269,7 +317,9 @@
 		clip=dummy;
 
 		VideoInfo inf = clip->GetVideoInfo();
-	
+	    memset(&info,0,sizeof(info));
+		info.version=AVSHEADER_API_VERSION;
+		// Video part
 		info.width=vid_width=inf.width;
 		info.height=vid_height=inf.height;
 		info.fps1000=vid_fps1000=(inf.fps_numerator*1000)/inf.fps_denominator;
@@ -280,59 +330,55 @@
 		f/=inf.fps_denominator;
 		vid_fps1000=info.fps1000=(uint32_t)ceil(f);
 		info.nbFrames=vid_nbFrame=inf.num_frames;
-		
+		// audio part
+		info.frequency=inf.SamplesPerSecond(); // 0 means no audio
+		info.channels=inf.AudioChannels();
+		if(info.frequency)
+		{
+			if(inf.SampleType()!=SAMPLE_INT16)
+			{
+				printf("Only int16 for audio and not %d!\n",(int)inf.SampleType());
+				fflush(stdout);
+				handleError();
+				return false;	
+			}
+		}
 		if(!inf.IsYV12()) 
 		{
 			printf("Only yv12!\n");
 			fflush(stdout);
 			handleError();
+			return false;
 		}
 		if(!inf.IsYV12())
-			{fprintf(stderr, "Couldn't convert input to YV12\n"); fflush(stderr); return 1;}
+			{fprintf(stderr, "Couldn't convert input to YV12\n"); fflush(stderr); return false;}
 		if(inf.IsFieldBased())
-			{fprintf(stderr, "Needs progressive input\n"); fflush(stderr); return 1;}
+			{fprintf(stderr, "Needs progressive input\n"); fflush(stderr); return false;}
 
 	
 		// Incoming ready
-		printf("Info\n");
-		printf("Width   :%d \n",vid_width);
-		printf("Height  :%d \n",vid_height);
-		printf("Fps1K   :%d \n",vid_fps1000);
-		printf("NbFrame :%d \n",vid_nbFrame);
+		printf("Clip Info\n");
+		printf("_________\n");
+		printf("Width     :%d \n",vid_width);
+		printf("Height    :%d \n",vid_height);
+		printf("Fps1K     :%d \n",vid_fps1000);
+		printf("NbFrame   :%d \n",vid_nbFrame);
+		printf("Frequency :%d \n",info.frequency);
+		printf("#channels :%d \n",info.channels);
 		fflush(stdout);
+		return true;
 }
 catch(AvisynthError err) {
 		
 			fprintf(stderr, "\nAvisynth error:\n%s\n", err.msg);
 			fflush(stderr);
-		return 1;
+		return false;
 	}
 
 
 
-		return 1;
+		return true;
 }
 
-#else
-typedef IScriptEnvironment * __stdcall FUNC(int);
-uint8_t initAvisynth(const char *infile)
-{
-HINSTANCE lib = LoadLibrary("avisynth.dll");
-FUNC *func = (FUNC *)GetProcAddress(lib, "CreateScriptEnvironment");
-IScriptEnvironment *env = func(AVISYNTH_INTERFACE_VERSION);
-
-{
-	AVSValue args[] = { infile };
-	PClip clip(env->Invoke("Import", AVSValue(args, 1)).AsClip());
-	const VideoInfo& vi = clip->GetVideoInfo();
-
-	printf("%d %d %d", vi.width, vi.height, vi.BitsPerPixel());
-}
-
-delete env;
-FreeLibrary(lib);
-return 1;
-}
-#endif
 //EOF
 

Modified: branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/avsproxy.sln
===================================================================
--- branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/avsproxy.sln	2010-04-06 12:44:01 UTC (rev 6069)
+++ branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/avsproxy.sln	2010-04-06 12:49:08 UTC (rev 6070)
@@ -1,6 +1,6 @@
 ?
-Microsoft Visual Studio Solution File, Format Version 9.00
-# Visual Studio 2005
+Microsoft Visual Studio Solution File, Format Version 10.00
+# Visual C++ Express 2008
 Project("{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}") = "avsproxy", "avsproxy.vcproj", "{FDA95A7F-919C-4343-96C6-FB0F59FFE5B0}"
 EndProject
 Global

Modified: branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/avsproxy.vcproj
===================================================================
--- branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/avsproxy.vcproj	2010-04-06 12:44:01 UTC (rev 6069)
+++ branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/avsproxy.vcproj	2010-04-06 12:49:08 UTC (rev 6070)
@@ -1,10 +1,11 @@
 <?xml version="1.0" encoding="Windows-1252"?>
 <VisualStudioProject
 	ProjectType="Visual C++"
-	Version="8.00"
+	Version="9,00"
 	Name="avsproxy"
 	ProjectGUID="{FDA95A7F-919C-4343-96C6-FB0F59FFE5B0}"
 	RootNamespace="avsproxy"
+	TargetFrameworkVersion="131072"
 	>
 	<Platforms>
 		<Platform
@@ -77,6 +78,8 @@
 				SuppressStartupBanner="true"
 				ProgramDatabaseFile="./avsproxy.pdb"
 				SubSystem="1"
+				RandomizedBaseAddress="1"
+				DataExecutionPrevention="0"
 				TargetMachine="1"
 			/>
 			<Tool
@@ -98,9 +101,6 @@
 				Name="VCAppVerifierTool"
 			/>
 			<Tool
-				Name="VCWebDeploymentTool"
-			/>
-			<Tool
 				Name="VCPostBuildEventTool"
 			/>
 		</Configuration>
@@ -170,6 +170,8 @@
 				GenerateDebugInformation="true"
 				ProgramDatabaseFile="./avsproxy.pdb"
 				SubSystem="1"
+				RandomizedBaseAddress="1"
+				DataExecutionPrevention="0"
 				TargetMachine="1"
 			/>
 			<Tool
@@ -191,9 +193,6 @@
 				Name="VCAppVerifierTool"
 			/>
 			<Tool
-				Name="VCWebDeploymentTool"
-			/>
-			<Tool
 				Name="VCPostBuildEventTool"
 			/>
 		</Configuration>

Modified: branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/sket.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/sket.cpp	2010-04-06 12:44:01 UTC (rev 6069)
+++ branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/sket.cpp	2010-04-06 12:49:08 UTC (rev 6070)
@@ -1,17 +1,21 @@
-/*
+/**
+	\file sket.cpp
+	\brief Socket handling
+	\author mean fixounet at free.fr
 
+*/
+// This program is free software; you can redistribute it and/or modify
+// it under the terms of the GNU General Public License as published by
+// the Free Software Foundation; either version 2 of the License, or
+// (at your option) any later version.
 
 
-*/
-
+//#define DEBUG
 #include <stdio.h>
 #include "sket.h"
 
 Sket::Sket(void)
 {
-
-
-
 	mySocket=0;
 	port=9999;
 
@@ -20,19 +24,49 @@
   sockaddr_in service;
   service.sin_family = AF_INET;
 #ifdef DEBUG
-  service.sin_addr.s_addr = inet_addr("192.168.0.10");
+	// Get the local host information
+  hostent* localHost;
+  char* localIP;
+	localHost = gethostbyname("");
+	localIP = inet_ntoa (*(struct in_addr *)*localHost->h_addr_list);
+	service.sin_addr.s_addr = inet_addr(localIP);
+	printf("Binding ...\n");
+	int ip=service.sin_addr.s_addr;
+	for(int i=0;i<4;i++)
+	{
+			printf("%d ",ip&0xff);
+		    ip>>=8;
+	}
+	printf("\n");
 #else
-  service.sin_addr.s_addr = inet_addr("127.0.0.1");
+	#define BIND_ADR "127.0.0.1"
+    service.sin_addr.s_addr = inet_addr(BIND_ADR);
+	printf("Binding on %s\n",BIND_ADR);
 #endif
+  
+  
   service.sin_port = htons(port);
 
-   if (bind( mySocket,   (SOCKADDR*) &service,  sizeof(service)) == SOCKET_ERROR) 
-   {
-    printf("bind() failed to port %u \n",port);
-	fflush(stdout);
-    closesocket(mySocket);
-	mySocket=0;
-    exit(-1);
+
+  int one=true;
+  if (bind( mySocket,   (SOCKADDR*) &service,  sizeof(service)) == SOCKET_ERROR) 
+  {
+	int opt=setsockopt(mySocket,
+				SOL_SOCKET,
+				SO_REUSEADDR,
+				(char *)&one,sizeof(one));
+	printf("Trying to use SO_REUSEADDR\n");
+	if(opt) printf("Error in setsockopt:%d\n",opt);
+  
+	  // Retry with SO_REUSEADDR set...
+	   if (bind( mySocket,   (SOCKADDR*) &service,  sizeof(service)) == SOCKET_ERROR) 
+	   {
+		printf("bind() failed to port %u \n",port);
+		fflush(stdout);
+		closesocket(mySocket);
+		mySocket=0;
+		exit(-1);
+	  }
   }
    // Set high buffer + low delay
   printf("Socket bound to port %u\n",port);
@@ -82,10 +116,10 @@
 	SktHeader header;
 	memset(&header,0,sizeof(header));
 
-
-	if( sizeof(header)!=recv(workSocket,(char *)&header,sizeof(header),0))
+	int rx=recv(workSocket,(char *)&header,sizeof(header),0);
+	if( sizeof(header)!=rx)
 	{
-		printf("Error in receivedata: header\n");
+		printf("Error in receivedata: header, expected %d, received %d\n",(int) sizeof(header),rx);
 		fflush(stdout);
 		exit(-1);
 	}

Modified: branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/sket.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/sket.h	2010-04-06 12:44:01 UTC (rev 6069)
+++ branches/avidemux_2.5_branch_gruntster/addons/avisynthproxy/sket.h	2010-04-06 12:49:08 UTC (rev 6070)
@@ -7,7 +7,7 @@
 #include "proxytype.h"
 #ifndef SKET_H
 #define SKET_H
-
+//#define DEBUG
 #define MAGGIC 0xDEADBEEF
 
 typedef struct SktHeader



From gruntster at mail.berlios.de  Tue Apr  6 14:52:13 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 6 Apr 2010 14:52:13 +0200
Subject: [Avidemux-svn-commit] r6071 - in
	branches/avidemux_2.5_branch_gruntster: avidemux
	avidemux/ADM_audiocodec avidemux/ADM_audiofilter
	avidemux/ADM_toolkit avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog
	avidemux/ADM_userInterfaces/ADM_commonUI cmake cmake/patches
Message-ID: <201004061252.o36CqDig006558@sheep.berlios.de>

Author: gruntster
Date: 2010-04-06 14:52:04 +0200 (Tue, 06 Apr 2010)
New Revision: 6071

Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_audiocodeclist.h
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_buildchain.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_toolkit/automation.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_acodec.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/cmake/admConfigSummary.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/config.h.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch
Log:
[misc] minor clean ups

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_audiocodeclist.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_audiocodeclist.h	2010-04-06 12:49:08 UTC (rev 6070)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiocodec/ADM_audiocodeclist.h	2010-04-06 12:52:04 UTC (rev 6071)
@@ -1,34 +0,0 @@
-
-#ifndef CODECA_LIST
-#define CODECA_LIST
-#if 0
-typedef struct {
-        const char *name;
-        const char *menuName;
-        AUDIOENCODER codec;
-        uint32_t     wavTag;
-}CODECLIST;
-
- const CODECLIST myCodecList[]=
-{
-                {"copy","Copy", AUDIOENC_COPY,WAV_PCM},
-#ifdef HAVE_LIBMP3LAME
-                {"lame","MP3 (LAME)", AUDIOENC_MP3,WAV_MP3},
-#endif
-#ifdef USE_FAAC
-                {"aac","AAC (FAAC)", AUDIOENC_FAAC,WAV_AAC},
-#endif
-#ifdef USE_VORBIS
-                {"vorbis","Vorbis", AUDIOENC_VORBIS,WAV_OGG},
-#endif
-#ifdef USE_AFTEN
-                {"aften","AC3 (Aften)", AUDIOENC_AFTEN,WAV_AC3},
-#endif
-                {"twolame","MP2 (TwoLAME)", AUDIOENC_2LAME,WAV_MP2},
-                {"mp2", "MP2 (lavc)", AUDIOENC_MP2,WAV_MP2},
-                {"ac3", "AC3 (lavc)",AUDIOENC_AC3,WAV_AC3},
-                {"none", "WAV PCM",AUDIOENC_NONE,WAV_PCM},
-                {"lpcm", "WAV LPCM",AUDIOENC_LPCM,WAV_LPCM}
-};
-#endif
-#endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp	2010-04-06 12:49:08 UTC (rev 6070)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp	2010-04-06 12:52:04 UTC (rev 6071)
@@ -26,10 +26,6 @@
 
 
 #include "audioencoder.h"
-
-#include "ADM_audiocodec/ADM_audiocodeclist.h"
-
-
 #include "audiofilter_bridge.h"
 #include "audiofilter_mixer.h"
 #include "audiofilter_normalize.h"

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_buildchain.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_buildchain.cpp	2010-04-06 12:49:08 UTC (rev 6070)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_audiofilter/audiofilter_buildchain.cpp	2010-04-06 12:52:04 UTC (rev 6071)
@@ -31,9 +31,6 @@
 
 /* ************* Encoder *********** */
 
-#include "ADM_audiocodec/ADM_audiocodeclist.h"
-
-
 #include "prefs.h"
 
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_toolkit/automation.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_toolkit/automation.cpp	2010-04-06 12:49:08 UTC (rev 6070)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_toolkit/automation.cpp	2010-04-06 12:52:04 UTC (rev 6071)
@@ -397,10 +397,8 @@
 {
 	if(!strcasecmp(p,"MP2"))
 		audio_selectCodecByTag(WAV_MP2);
-#ifdef USE_FAAC
 	else if(!strcasecmp(p,"AAC"))
-		audioCodecSetcodec( AUDIOENC_FAAC );
-#endif
+		audio_selectCodecByTag( WAV_AAC );
 	else if(!strcasecmp(p,"AC3"))
 		audio_selectCodecByTag( WAV_AC3 );
 	else if(!strcasecmp(p,"MP3"))

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_acodec.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_acodec.cpp	2010-04-06 12:49:08 UTC (rev 6070)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_acodec.cpp	2010-04-06 12:52:04 UTC (rev 6071)
@@ -6,7 +6,6 @@
 
 #include "ADM_audiofilter/audioprocess.hxx"
 #include "ADM_audiofilter/audioeng_buildfilters.h"
-//#include "ADM_audiocodec/ADM_audiocodeclist.h"
 
 extern uint32_t audioEncoderGetNumberOfEncoders(void);
 extern const char  *audioEncoderGetDisplayName(uint32_t i);
@@ -93,20 +92,6 @@
   GtkWidget *vbox1;
   GtkWidget *optionmenu_CodecList;
   GtkWidget *menu1;
-  GtkWidget *uncompressed;
-  GtkWidget *ffmpeg_mpeg_audio;
-  GtkWidget *ffmpeg_ac3_2_channels1;
-  #ifdef HAVE_LIBMP3LAME
-  GtkWidget *lame_mp1;
-  #endif
-    #ifdef USE_VORBIS
-  GtkWidget *vorbis;
-  #endif
-
-#ifdef USE_FAAC
-  GtkWidget *faac;
-#endif
-  GtkWidget *toolame,*libtoolame;
   GtkWidget *buttonConfigure;
   GtkWidget *dialog_action_area1;
   GtkWidget *cancelbutton1;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp	2010-04-06 12:49:08 UTC (rev 6070)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp	2010-04-06 12:52:04 UTC (rev 6071)
@@ -41,7 +41,7 @@
 
 uint8_t DIA_builtin(void)
 {
-  uint32_t altivec=0,freetype=0,win32=0;
+  uint32_t altivec=0,win32=0;
   uint32_t sdl=0,xvideo=0,x86=0,x86_64=0;
   uint32_t adm_powerpc=0,adm_gettext=0,adm_fontconfig=0;
 #ifdef USE_FONTCONFIG
@@ -50,9 +50,6 @@
 #ifdef ADM_CPU_ALTIVEC
         altivec=1;
 #endif
-#ifdef USE_FREETYPE
-        freetype=1;
-#endif
 #ifdef __WIN32
         win32=1;
 #endif
@@ -81,7 +78,6 @@
 
 
         diaElemNotch tFontConfig(adm_fontconfig, QT_TR_NOOP("Fontconfig"));
-	diaElemNotch tFreetype(freetype, QT_TR_NOOP("FreeType 2"));
 	diaElemNotch tGettext(adm_gettext, QT_TR_NOOP("Gettext"));
 	diaElemNotch tSdl(sdl, QT_TR_NOOP("SDL"));
 	diaElemNotch tXvideo(xvideo, QT_TR_NOOP("XVideo"));
@@ -93,10 +89,10 @@
 
 
 
-	diaElem *libsElems[] = {&tFontConfig, &tFreetype, &tGettext, &tSdl, &tXvideo};
+	diaElem *libsElems[] = {&tFontConfig, &tGettext, &tSdl, &tXvideo};
 	diaElem *CPUElems[] = {&tAltivec, &tPowerPc, &tX86, &tX86_64};
 
-	diaElemTabs tabLibs(QT_TR_NOOP("Libraries"), 5, libsElems);
+	diaElemTabs tabLibs(QT_TR_NOOP("Libraries"), 4, libsElems);
 	diaElemTabs tabCPU(QT_TR_NOOP("CPU"), 4, CPUElems);
 
 	diaElemTabs *tabs[] = { &tabLibs, &tabCPU};

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2010-04-06 12:49:08 UTC (rev 6070)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2010-04-06 12:52:04 UTC (rev 6071)
@@ -398,37 +398,7 @@
 		TARGET_LINK_LIBRARIES(avidemux2_qt4 ${SDL_LIBRARY})
 	ENDIF (ADM_UI_QT4)
 ENDIF (USE_SDL)
-# LAME
-IF (HAVE_LIBMP3LAME)
-	ADD_LIB_ALL_TARGETS("${LAME_LIBRARY_DIR}")
-ENDIF (HAVE_LIBMP3LAME)
 
-# Vorbis
-IF (USE_VORBIS)
-	ADD_LIB_ALL_TARGETS("${VORBIS_LIBRARY_DIR}")
-	ADD_LIB_ALL_TARGETS("${VORBISENC_LIBRARY_DIR}")
-ENDIF (USE_VORBIS)
-
-# FAAC
-IF (USE_FAAC)
-	ADD_LIB_ALL_TARGETS("${FAAC_LIBRARY_DIR}")
-ENDIF (USE_FAAC)
-
-# Aften
-IF (USE_AFTEN)
-	ADD_LIB_ALL_TARGETS("${AFTEN_LIBRARY_DIR}")
-ENDIF (USE_AFTEN)
-
-# Secret Rabbit Code
-IF (USE_SRC)
-	ADD_LIB_ALL_TARGETS("${SRC_LIBRARY_DIR}")
-ENDIF (USE_SRC)
-
-# Xvid
-IF (USE_XVID_4)
-	ADD_LIB_ALL_TARGETS("${XVID_LIBRARY_DIR}")
-ENDIF (USE_XVID_4)
-
 ###########################################
 # UI Specific
 ###########################################

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admConfigSummary.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admConfigSummary.cmake	2010-04-06 12:49:08 UTC (rev 6070)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admConfigSummary.cmake	2010-04-06 12:52:04 UTC (rev 6071)
@@ -23,18 +23,6 @@
 ADM_DISPLAY("GTK+      " "${ADM_UI_GTK}")
 ADM_DISPLAY("Qt 4      " "${ADM_UI_QT4}")
 
-#MESSAGE("*** Audio Device  ***")
-#ADM_DISPLAY("ALSA      " "${ALSA_SUPPORT}" "${ALSA_CAPABLE}")
-#ADM_DISPLAY("aRts      " "${USE_ARTS}" "${ARTS_CAPABLE}")
-#ADM_DISPLAY("ESD       " "${USE_ESD}" "${ESD_CAPABLE}")
-#ADM_DISPLAY("JACK      " "${USE_JACK}" "${JACK_CAPABLE}")
-#ADM_DISPLAY("OSS       " "${OSS_SUPPORT}" "${OSS_CAPABLE}")
-#ADM_DISPLAY("SRC       " "${USE_SRC}" "${JACK_CAPABLE}")
-
-#IF (WIN32)
-#	ADM_DISPLAY("Win32     " 1)
-#ENDIF (WIN32)
-
 MESSAGE("*** Miscellaneous ***")
 ADM_DISPLAY("gettext   " "${HAVE_GETTEXT}")
 ADM_DISPLAY("SDL       " "${USE_SDL}")

Modified: branches/avidemux_2.5_branch_gruntster/cmake/config.h.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/config.h.cmake	2010-04-06 12:49:08 UTC (rev 6070)
+++ branches/avidemux_2.5_branch_gruntster/cmake/config.h.cmake	2010-04-06 12:52:04 UTC (rev 6071)
@@ -26,9 +26,6 @@
 // GTK+ uses X11 framework
 #cmakedefine HAVE_GTK_X11
 
-/* Define to 1 if you have the `mp3lame' library (-lmp3lame). */
-#cmakedefine HAVE_LIBMP3LAME
-
 /* OSS detected */
 #cmakedefine OSS_SUPPORT
 
@@ -51,31 +48,17 @@
 /* Jack detected */
 #cmakedefine USE_JACK
 
-/* Use faac audio enccoder */
-#cmakedefine USE_FAAC
-
 /* FFmpeg */
 #define USE_FFMPEG
 
-/* FreeType2 detected */
-#cmakedefine USE_FREETYPE
-
 /* Libxml2 is available */
 #cmakedefine USE_LIBXML2
 
-#define USE_MJPEG
-
-/* use libsamplerate */
-#cmakedefine USE_SRC
-
 #if ${CONFIG_HEADER_TYPE} == ADM_BUILD_GTK || ${CONFIG_HEADER_TYPE} == ADM_BUILD_QT4
 /* SDL detected */
 #cmakedefine USE_SDL
 #endif
 
-/* Vorbis detected */
-#cmakedefine USE_VORBIS
-
 #if ${CONFIG_HEADER_TYPE} == ADM_BUILD_GTK || ${CONFIG_HEADER_TYPE} == ADM_BUILD_QT4
 /* XVideo detected */
 #cmakedefine USE_XV

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch	2010-04-06 12:49:08 UTC (rev 6070)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch	2010-04-06 12:52:04 UTC (rev 6071)
@@ -1,24 +1,6 @@
 *** libavformat/flvenc.c.old	Sat Mar 27 20:05:43 2010
 --- libavformat/flvenc.c	Sat Mar 27 20:05:43 2010
 ***************
-*** 406,412 ****
-      "video/x-flv",
-      "flv",
-      sizeof(FLVContext),
-! #if CONFIG_LIBMP3LAME
-      CODEC_ID_MP3,
-  #else // CONFIG_LIBMP3LAME
-      CODEC_ID_ADPCM_SWF,
---- 406,413 ----
-      "video/x-flv",
-      "flv",
-      sizeof(FLVContext),
-! //MEANX #if CONFIG_LIBMP3LAME
-! #ifdef HAVE_LIBMP3LAME
-      CODEC_ID_MP3,
-  #else // CONFIG_LIBMP3LAME
-      CODEC_ID_ADPCM_SWF,
-***************
 *** 418,420 ****
 --- 419,429 ----
       .codec_tag= (const AVCodecTag* const []){flv_video_codec_ids, flv_audio_codec_ids, 0},



From mean at mail.berlios.de  Tue Apr  6 17:10:25 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 6 Apr 2010 17:10:25 +0200
Subject: [Avidemux-svn-commit] r6072 -
	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui
Message-ID: <201004061510.o36FAPMD023905@sheep.berlios.de>

Author: mean
Date: 2010-04-06 17:10:24 +0200 (Tue, 06 Apr 2010)
New Revision: 6072

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/file_qt4.cpp
Log:
[OsX] Use native file selector

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/file_qt4.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/file_qt4.cpp	2010-04-06 12:52:04 UTC (rev 6071)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/file_qt4.cpp	2010-04-06 15:10:24 UTC (rev 6072)
@@ -59,9 +59,6 @@
 		QString fileName;
 		QFileDialog::Options options = 0;
 
-#if defined(__APPLE__)
-		options |= QFileDialog::DontUseNativeDialog;
-#endif
 
 		if (access)
 			fileName = QFileDialog::getSaveFileName(NULL, label, str, NULL, NULL, options);
@@ -129,9 +126,6 @@
 		QString fileName;
 		QFileDialog::Options options = 0;
 
-#if defined(__APPLE__)
-		options |= QFileDialog::DontUseNativeDialog;
-#endif
 
 		fileName=QFileDialog::getSaveFileName(NULL, title, source, NULL, NULL, options);
 
@@ -160,9 +154,6 @@
 		QString fileName;
 		QFileDialog::Options options = 0;
 
-#if defined(__APPLE__)
-		options |= QFileDialog::DontUseNativeDialog;
-#endif
 
 		fileName = QFileDialog::getOpenFileName(NULL, title, source, NULL, NULL, options);
 
@@ -191,9 +182,6 @@
 		QString fileName;
 		QFileDialog::Options options = QFileDialog::ShowDirsOnly;
 
-#if defined(__APPLE__)
-		options |= QFileDialog::DontUseNativeDialog;
-#endif
 
 		fileName = QFileDialog::getExistingDirectory(NULL, title, source, options);
 



From mean at mail.berlios.de  Tue Apr  6 17:10:27 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 6 Apr 2010 17:10:27 +0200
Subject: [Avidemux-svn-commit] r6073 - in branches/avidemux_2.6_branch_mean:
	avidemux_core/ADM_coreImage/include avidemux_core/ADM_coreImage/src
	avidemux_plugins/ADM_videoFilters6
	avidemux_plugins/ADM_videoFilters6/printInfo
Message-ID: <201004061510.o36FARaq023915@sheep.berlios.de>

Author: mean
Date: 2010-04-06 17:10:26 +0200 (Tue, 06 Apr 2010)
New Revision: 6073

Added:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/printInfo/
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/printInfo/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/printInfo/printInfo.cpp
Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_image.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_print.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/CMakeLists.txt
Log:
[videoFilter] Add printInfo video filter

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_image.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_image.h	2010-04-06 15:10:24 UTC (rev 6072)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/include/ADM_image.h	2010-04-06 15:10:26 UTC (rev 6073)
@@ -147,6 +147,7 @@
         /* Some utilitarian functions */
         uint8_t  saveAsBmp(const char *filename);
         uint8_t  saveAsJpg(const char *filename);
+        bool     printString(uint32_t x,uint32_t y, const char *strng);
         
 static uint32_t lumaDiff(ADMImage *src1,ADMImage *src2,uint32_t noise);
 };

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_print.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_print.cpp	2010-04-06 15:10:24 UTC (rev 6072)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_print.cpp	2010-04-06 15:10:26 UTC (rev 6073)
@@ -82,17 +82,18 @@
 		}
 	}
 }
-
-
-void drawString(ADMImage *dst, int x, int y, const char *s) 
+/**
+    \fn printString
+*/
+bool     ADMImage::printString(uint32_t x,uint32_t y, const char *s)
 {
 	int len=strlen(s);
-	if( ((x+len)*20)<dst->_width)
+	if( ((x+len)*20)<_width)
 	{
 		for (int xx = 0; *s; ++s, ++xx) 
 			{
 				if(*s==0x0d || *s==0x0a) continue;
-				drawDigit(dst, x + xx, y, *s - ' ');
+				drawDigit(this, x + xx, y, *s - ' ');
 			}	
 	}
 	else
@@ -100,9 +101,8 @@
 		for (int xx = 0; *s; ++s, ++xx) 
 				{
 					if(*s==0x0d || *s==0x0a) continue;
-					drawDigitSmall(dst, x + xx, y, *s - ' ');
+					drawDigitSmall(this, x + xx, y, *s - ' ');
 				}	
 	}
-	
 }
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/CMakeLists.txt	2010-04-06 15:10:24 UTC (rev 6072)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/CMakeLists.txt	2010-04-06 15:10:26 UTC (rev 6073)
@@ -4,3 +4,4 @@
 ADD_SUBDIRECTORY(crop)
 ADD_SUBDIRECTORY(yadif)
 ADD_SUBDIRECTORY(mplayerDenoise3D)
+ADD_SUBDIRECTORY(printInfo)

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/printInfo/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/printInfo/CMakeLists.txt	2010-04-06 15:10:24 UTC (rev 6072)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/printInfo/CMakeLists.txt	2010-04-06 15:10:26 UTC (rev 6073)
@@ -0,0 +1,9 @@
+INCLUDE(vf_plugin)
+
+
+SET(ADM_vf_printInfo_SRCS printInfo.cpp)
+
+ADD_VIDEO_FILTER(ADM_vf_printInfo ${ADM_vf_printInfo_SRCS})
+
+INIT_VIDEO_FILTER(ADM_vf_printInfo)
+INSTALL_VIDEO_FILTER(ADM_vf_printInfo)

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/printInfo/printInfo.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/printInfo/printInfo.cpp	2010-04-06 15:10:24 UTC (rev 6072)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/printInfo/printInfo.cpp	2010-04-06 15:10:26 UTC (rev 6073)
@@ -0,0 +1,111 @@
+/** *************************************************************************
+                    \fn       printInfoFilter.cpp  
+                    \brief simplest of all video filters, it does nothing
+
+    copyright            : (C) 2009 by mean
+
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include "ADM_default.h"
+#include "ADM_coreVideoFilterInternal.h"
+#include "ADM_vidMisc.h"
+#define ADM_NO_PTS 0xFFFFFFFFFFFFFFFFLL // FIXME
+/**
+    \class printInfoFilter
+*/
+class printInfoFilter : public  ADM_coreVideoFilter
+{
+public:
+                    printInfoFilter(ADM_coreVideoFilter *previous,CONFcouple *conf);
+                    ~printInfoFilter();
+
+        virtual const char   *getConfiguration(void);                   /// Return  current configuration as a human readable string
+        virtual bool         getNextFrame(uint32_t *frameNumner,ADMImage *image);    /// Return the next image
+	 //  virtual FilterInfo  *getInfo(void);                             /// Return picture parameters after this filter
+        virtual bool         getCoupledConf(CONFcouple **couples) ;   /// Return the current filter configuration
+        virtual bool         configure(void) {return true;}             /// Start graphical user interface
+};
+
+// Add the hook to make it valid plugin
+DECLARE_VIDEO_FILTER(   printInfoFilter,   // Class
+                        1,0,0,              // Version
+                        ADM_UI_ALL,         // UI
+                        VF_MISC,            // Category
+                        "printInfo",            // internal name (must be uniq!)
+                        "PrintInfo",            // Display name
+                        "Display some informations on Screen." // Description
+                    );
+
+// Now implements the interesting parts
+/**
+    \fn printInfoFilter
+    \brief constructor
+*/
+printInfoFilter::printInfoFilter(  ADM_coreVideoFilter *in,CONFcouple *setup) : ADM_coreVideoFilter(in,setup)
+{
+UNUSED_ARG(setup);
+
+    // By default the info field contains the output of previous filter
+    // Tweak it here if you change fps, duration, width,...
+}
+/**
+    \fn printInfoFilter
+    \brief destructor
+*/
+printInfoFilter::~printInfoFilter()
+{
+		
+}
+/**
+    \fn getFrame
+    \brief Get a processed frame
+*/
+bool printInfoFilter::getNextFrame(uint32_t *fn,ADMImage *image)
+{
+    // since we do nothing, just get the output of previous filter
+    if(false==previousFilter->getNextFrame(fn,image))
+    {
+        return false;
+    }
+#define INFO_MAX 1024
+    char info[INFO_MAX+1];
+    snprintf(info,INFO_MAX,"Frame number : %06d",(int)*fn);
+    image->printString(0,1,info);
+
+    if(image->Pts==ADM_NO_PTS)
+        sprintf(info,"Pts : No info");
+    else
+    snprintf(info,INFO_MAX,"Pts : %s",ADM_us2plain(image->Pts));
+    image->printString(0,3,info);
+
+    return true;
+}
+/**
+    \fn getCoupledConf
+    \brief Return our current configuration as couple name=value
+*/
+bool         printInfoFilter::getCoupledConf(CONFcouple **couples)
+{
+    *couples=new CONFcouple(0); // Even if we dont have configuration we must allocate one 
+    return true;
+}
+/**
+    \fn getConfiguration
+    \brief Return current setting as a string
+*/
+const char *printInfoFilter::getConfiguration(void)
+{
+    
+    return "Dummy Filter.";
+}
+// Normally not needed :virtual FilterInfo  *getInfo(void)
+//EOF



From mean at mail.berlios.de  Tue Apr  6 17:10:28 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 6 Apr 2010 17:10:28 +0200
Subject: [Avidemux-svn-commit] r6074 - in
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2:
	include src
Message-ID: <201004061510.o36FASQQ023925@sheep.berlios.de>

Author: mean
Date: 2010-04-06 17:10:28 +0200 (Tue, 06 Apr 2010)
New Revision: 6074

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/include/ADM_filterChain.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/src/ADM_videoFilters.cpp
Log:
[videoChain] Cleanup

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/include/ADM_filterChain.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/include/ADM_filterChain.h	2010-04-06 15:10:26 UTC (rev 6073)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/include/ADM_filterChain.h	2010-04-06 15:10:28 UTC (rev 6074)
@@ -21,8 +21,7 @@
 #include "ADM_coreVideoFilter.h"
 #include <vector>
 typedef std::vector <ADM_coreVideoFilter *>ADM_videoFilterChain;
-
-
+ADM_videoFilterChain *createEmptyVideoFilterChain(uint64_t startAt,uint64_t endAt);
 ADM_videoFilterChain *createVideoFilterChain(uint64_t startAt,uint64_t endAt);
 bool                 destroyVideoFilterChain(ADM_videoFilterChain *chain);
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/src/ADM_videoFilters.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/src/ADM_videoFilters.cpp	2010-04-06 15:10:26 UTC (rev 6073)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoFilter2/src/ADM_videoFilters.cpp	2010-04-06 15:10:28 UTC (rev 6074)
@@ -237,6 +237,26 @@
     return chain;
 }
 /**
+    \fn createEmptyVideoFilterChain
+    \brief Create an empty filter chain
+*/
+ADM_videoFilterChain *createEmptyVideoFilterChain(uint64_t startAt,uint64_t endAt)
+{
+    ADM_videoFilterChain *chain=new ADM_videoFilterChain;
+    // 1- Add bridge always # 1
+    ADM_videoFilterBridge *bridge=new ADM_videoFilterBridge(startAt,endAt);
+    chain->push_back(bridge);
+    ADM_coreVideoFilter *f=bridge;
+    // Last create the thread
+#if 1
+    int m=chain->size();
+    ADM_coreVideoFilter *last=(*chain)[m-1];
+    ADM_videoFilterQueue *thread=new ADM_videoFilterQueue(last);
+    chain->push_back(thread);
+#endif
+    return chain;
+}
+/**
         \fn destroyVideoFilterChain
         \brief Destroy a filter chain
 */



From mean at mail.berlios.de  Tue Apr  6 17:10:30 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 6 Apr 2010 17:10:30 +0200
Subject: [Avidemux-svn-commit] r6075 -
	branches/avidemux_2.6_branch_mean/avidemux/common
Message-ID: <201004061510.o36FAUWQ023935@sheep.berlios.de>

Author: mean
Date: 2010-04-06 17:10:29 +0200 (Tue, 06 Apr 2010)
New Revision: 6075

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp
Log:
[playback] Use filter chain so that we can switch from input to output

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp	2010-04-06 15:10:28 UTC (rev 6074)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp	2010-04-06 15:10:29 UTC (rev 6075)
@@ -284,41 +284,6 @@
       renderUnlock();
 }
 /**
-      \fn admPreview::updateFilters
-      \brief Signal from filter that the filter chain has been updated
-      @param w : width
-      @param h : height
-*/
-
-void admPreview::updateFilters(AVDMGenericVideoStream *first,AVDMGenericVideoStream *last)
-{
-   switch(previewMode)
-            {
-              case  ADM_PREVIEW_SEPARATE:
-                  preview=last;
-                  break;
-              case  ADM_PREVIEW_NONE:
-                  break;
-              case  ADM_PREVIEW_OUTPUT:
-                preview=last;
-                break;
-              case  ADM_PREVIEW_SIDE:
-              {
-                  
-                  preview=last;
-                  break;
-              }
-              case  ADM_PREVIEW_TOP:
-              {
-                  
-                  preview=last;
-                  break;
-              }
-              default: ADM_assert(0);
-            }
-  
-}
-/**
     \fn getCurrentPts
     \brief returns the PTS in us of the last displayed frame
 */

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h	2010-04-06 15:10:28 UTC (rev 6074)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h	2010-04-06 15:10:29 UTC (rev 6075)
@@ -30,7 +30,6 @@
       static void start(void);
       static void stop(void);
       static void setMainDimension(uint32_t, uint32_t );
-      static void updateFilters(AVDMGenericVideoStream *first,AVDMGenericVideoStream *last);
       static void deferDisplay(uint32_t onoff,uint32_t startat);
       static void displayNow(void);
       static void cleanUp(void);  

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp	2010-04-06 15:10:28 UTC (rev 6074)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp	2010-04-06 15:10:29 UTC (rev 6075)
@@ -27,6 +27,7 @@
 #include "ADM_preview.h"
 #include "audiofilter.h"
 #include "GUI_ui.h"
+#include "ADM_filterChain.h"
 //___________________________________
 // In 10 ms chunks
 #define AUDIO_PRELOAD 100
@@ -55,6 +56,8 @@
         uint64_t        firstPts,lastPts;
         uint64_t        vuMeterPts;
         uint64_t        audioLatency;
+        ADM_coreVideoFilter  *videoFilter;
+        ADM_videoFilterChain *videoChain;
 
 private :
         bool initialized;
@@ -77,6 +80,8 @@
 {
     playbackAudio=NULL;
     wavbuf=NULL;
+    videoFilter=NULL;
+    videoChain=NULL;
 }
 /**
     \fn ~GUIPlayback
@@ -114,15 +119,6 @@
 	prefs->get(PRIORITY_PLAYBACK,&priorityLevel);
 	setpriority(PRIO_PROCESS, 0, ADM_getNiceValue(priorityLevel));
 
-    if(getPreviewMode()==ADM_PREVIEW_OUTPUT)
-    {
-//            filter=getLastVideoFilter();
-    }
-    else
-    {
-  //          filter=getFirstVideoFilter( );
-    }
-
     stop_req = 0;
     playing = 1;
 
@@ -134,16 +130,18 @@
     playLoop->run();
 
     delete playLoop;
-   playing = 0;
+    playing = 0;
 
 //   getFirstVideoFilter( );
 
    admPreview::deferDisplay(0,0);
-
-
+   // Resize the output window to original size...
+   ADM_info("Restoring display.\n");
+   aviInfo info;
+   video_body->getVideoInfo(&info);
+   admPreview::setMainDimension(info.width,info.height);
    UI_purge();
-#warning FIXME
-//   admPreview::seekToFrame(oldTimeFrame);
+   
    admPreview::samePicture();
    GUI_setCurrentFrameAndTime();
    UI_purge();
@@ -167,7 +165,6 @@
             playbackAudio=NULL;
        }
        return true;
-
 }
 /**
     \fn cleanupAudio
@@ -175,10 +172,16 @@
 bool GUIPlayback::cleanup(void)
 {
         cleanupAudio();
+        if(videoChain)
+        {
+            ADM_info("Destroying video playback chain\n");
+            destroyVideoFilterChain(videoChain);
+            videoChain=NULL;
+        }
+        videoFilter=NULL; // it has been destroyed by the chain
        // done.
 	   setpriority(PRIO_PROCESS, 0, originalPriority);
        return true;
-
 }
 
 /**
@@ -187,6 +190,23 @@
 bool GUIPlayback::initialize(void)
 {
     firstPts=admPreview::getCurrentPts();
+    if(getPreviewMode()==ADM_PREVIEW_NONE) // copy
+    {
+        videoChain=createEmptyVideoFilterChain(firstPts,1000*1000*1000*1000LL); 
+    }else
+    {
+        videoChain=createVideoFilterChain(firstPts,1000*1000*1000*1000LL); 
+    }
+    if(!videoChain)
+    {
+        ADM_warning("Cannot create video chain\n");
+        return false;
+    }
+    int nb=videoChain->size();
+    videoFilter=(*videoChain)[nb-1];
+    FilterInfo *info=videoFilter->getInfo();
+    admPreview::setMainDimension(info->width,info->height);
+
     initializeAudio();
     return true;
 }
@@ -199,15 +219,17 @@
 
     uint32_t movieTime;
     uint32_t systemTime;
+    uint32_t fn;
     int refreshCounter=0;
     ticktock.reset();
     vuMeterPts=0;
+    ADMImage *previewBuffer=admPreview::getBuffer();
     do
     {
 
         admPreview::displayNow();;
         GUI_setCurrentFrameAndTime();
-        if(false==admPreview::nextPicture())
+        if(false==videoFilter->getNextFrame(&fn,previewBuffer))
         {
             printf("[Play] Cancelling playback, nextPicture failed\n");
             break;
@@ -215,7 +237,7 @@
         audioPump(false);
         lastPts=admPreview::getCurrentPts();
         systemTime = ticktock.getElapsedMS();
-        movieTime=(uint32_t)((lastPts-firstPts)/1000);
+        movieTime=(uint32_t)((lastPts-firstPts*0)/1000);
         movieTime+=audioLatency;
        // printf("[Playback] systemTime: %lu movieTime : %lu  \r",systemTime,movieTime);
         if(systemTime>movieTime) // We are late, the current PTS is after current closk



From mean at mail.berlios.de  Tue Apr  6 17:10:31 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 6 Apr 2010 17:10:31 +0200
Subject: [Avidemux-svn-commit] r6076 -
	branches/avidemux_2.6_branch_mean/avidemux/common
Message-ID: <201004061510.o36FAV7K023945@sheep.berlios.de>

Author: mean
Date: 2010-04-06 17:10:31 +0200 (Tue, 06 Apr 2010)
New Revision: 6076

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp
Log:
[play/preview] Go back to where we started once playback is done

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp	2010-04-06 15:10:29 UTC (rev 6075)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp	2010-04-06 15:10:31 UTC (rev 6076)
@@ -311,7 +311,24 @@
 
 }
 #endif
+
 /**
+      \fn admPreview::seekToTime
+      \brief Seek to any given frame
+      
+      @param timeframe Time of the image 
+*/
+
+bool admPreview::seekToTime(uint64_t timeframe)
+{
+    if(!video_body->goToTimeVideo(timeframe)) 
+    {
+        ADM_warning(" seeking for frame at %"LLU" ms failed\n",timeframe/1000LL);
+        return false;
+    }
+    return samePicture();
+}
+/**
       \fn admPreview::seekToIntraPts
       \brief Seek to intra at PTS given as arg
       

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h	2010-04-06 15:10:29 UTC (rev 6075)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h	2010-04-06 15:10:31 UTC (rev 6076)
@@ -25,7 +25,7 @@
       static uint8_t nextPicture(void);
       static uint8_t previousPicture(void);
       static uint8_t samePicture(void);
-//      static uint8_t seekToIntra(uint32_t framenum);
+      static bool seekToTime(uint64_t timeFrame);
       static bool seekToIntraPts(uint64_t timeframe);
       static void start(void);
       static void stop(void);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp	2010-04-06 15:10:29 UTC (rev 6075)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp	2010-04-06 15:10:31 UTC (rev 6076)
@@ -19,6 +19,8 @@
 #include <math.h>
 #include "prefs.h"
 #include "avi_vars.h"
+#include "ADM_Video.h"
+#include "ADM_editor/ADM_edit.hxx"
 #include "audio_out.h"
 #include "DIA_coreToolkit.h"
 #include "gtkgui.h"
@@ -26,8 +28,9 @@
 #include "avidemutils.h"
 #include "ADM_preview.h"
 #include "audiofilter.h"
+#include "ADM_filterChain.h"
 #include "GUI_ui.h"
-#include "ADM_filterChain.h"
+
 //___________________________________
 // In 10 ms chunks
 #define AUDIO_PRELOAD 100
@@ -40,8 +43,8 @@
 uint8_t stop_req;
 
 extern renderZoom currentZoom;
+extern ADM_Composer *video_body;
 
-
 /**
     \class GUIPlayback
     \brief Wrapper for the playback stuff
@@ -73,6 +76,9 @@
         ~GUIPlayback();
 
 };
+
+
+
 /**
     \fn GUIPlayback
 */
@@ -102,11 +108,11 @@
     uint32_t framelen,flags;
     uint32_t max,err;
     uint64_t oldTimeFrame;
+    aviInfo info;
+    video_body->getVideoInfo(&info);
 
     // check we got everything...
-    if (!avifileinfo)	return;
-    if (!avifileinfo->fps1000)        return;
-
+    if (!video_body->getNbSegment())	return;
     if (playing)
       {
         stop_req = 1;
@@ -122,7 +128,7 @@
     stop_req = 0;
     playing = 1;
 
-    admPreview::deferDisplay(1,curframe);
+    admPreview::deferDisplay(1,0);
     admPreview::samePicture();
 
     GUIPlayback *playLoop=new GUIPlayback;
@@ -137,9 +143,9 @@
    admPreview::deferDisplay(0,0);
    // Resize the output window to original size...
    ADM_info("Restoring display.\n");
-   aviInfo info;
-   video_body->getVideoInfo(&info);
+   
    admPreview::setMainDimension(info.width,info.height);
+   admPreview::seekToTime(oldTimeFrame);
    UI_purge();
    
    admPreview::samePicture();



From mean at mail.berlios.de  Tue Apr  6 17:10:33 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 6 Apr 2010 17:10:33 +0200
Subject: [Avidemux-svn-commit] r6077 - in
	branches/avidemux_2.6_branch_mean/avidemux: common
	qt4/ADM_userInterfaces/ADM_gui
Message-ID: <201004061510.o36FAXxl023955@sheep.berlios.de>

Author: mean
Date: 2010-04-06 17:10:32 +0200 (Tue, 06 Apr 2010)
New Revision: 6077

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui
Log:
[playback] Allow input & output playback

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp	2010-04-06 15:10:31 UTC (rev 6076)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp	2010-04-06 15:10:32 UTC (rev 6077)
@@ -49,14 +49,11 @@
 #include "ADM_preview.h"
 #define MAX(a,b) ( (a)>(b) ? (a) : (b) )
 #include "DIA_coreToolkit.h"
-extern void    UI_setCurrentTime(uint64_t curTime);
+extern void                 UI_setCurrentTime(uint64_t curTime);
 
-static void previewBlit(ADMImage *from,ADMImage *to,uint32_t startx,uint32_t starty);
+static void                 previewBlit(ADMImage *from,ADMImage *to,uint32_t startx,uint32_t starty);
+static ADM_PREVIEW_MODE     previewMode=ADM_PREVIEW_NONE;
 
-static   AVDMGenericVideoStream *preview=NULL;
-
-static ADM_PREVIEW_MODE previewMode=ADM_PREVIEW_NONE;
-
 static uint32_t             defered_display=0;  /* When 1, it means we are in playback mode */
 static uint32_t             playbackOffset=0;   /* in playback mode, frame 0 = playbackOffset compared to real beginning of the file */
 static renderZoom           zoom=ZOOM_1_1;
@@ -173,24 +170,12 @@
 {
             aprintf("--killing\n");
             renderLock();
-#if 0
-            getFirstVideoFilter();
-            
-            preview=videofilters[  nb_active_filter-1].filter;
-            aprintf("--spawning\n");
-            ADM_assert(!previewImage)
-                
-            previewImage=new ADMImage(preview->getInfo()->width,preview->getInfo()->height);
-#endif            
             ADM_assert(!original);
             switch(previewMode)
             {
-#if 0
-              case  ADM_PREVIEW_SEPARATE:
-                  DIA_previewInit(preview->getInfo()->width,preview->getInfo()->height);
-#endif                  
                   /* no break here, not a mistake */
               case  ADM_PREVIEW_NONE:
+              case  ADM_PREVIEW_OUTPUT:
               
                   rdrWindowWUnzoomed=rdrPhysicalW;
                   rdrWindowHUnzoomed=rdrPhysicalH;
@@ -200,6 +185,7 @@
                   rdrWindowWUnzoomed=preview->getInfo()->width;
                   rdrWindowHUnzoomed=preview->getInfo()->height;
                   break;
+
               case  ADM_PREVIEW_SIDE:
               {
                   rdrWindowWUnzoomed=rdrPhysicalW+preview->getInfo()->width;
@@ -703,7 +689,7 @@
     switch(previewMode)
     {
       case ADM_PREVIEW_NONE:
-           
+      case ADM_PREVIEW_OUTPUT:     
            if(zoom==ZOOM_1_1 || renderHasAccelZoom() )
             {
                 renderUpdateImage(rdrImage->data,zoom);
@@ -713,6 +699,7 @@
                 renderUpdateImage(resized->data,zoom);
             }
         break;
+#if 0
       case ADM_PREVIEW_OUTPUT:
             if(zoom==ZOOM_1_1 || renderHasAccelZoom() )
             {
@@ -723,7 +710,7 @@
                 renderUpdateImage(resized->data,zoom);
             }
             break;
-#if 0
+
       case ADM_PREVIEW_SEPARATE:
             if(zoom==ZOOM_1_1 || renderHasAccelZoom()  )
             {

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp	2010-04-06 15:10:31 UTC (rev 6076)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp	2010-04-06 15:10:32 UTC (rev 6077)
@@ -278,13 +278,6 @@
                     systemTime = ticktock.getElapsedMS();
                     delta=movieTime-systemTime;
                 }
-
-                if(getPreviewMode()==ADM_PREVIEW_SEPARATE )
-                {
-                  UI_purge();
-                  UI_purge();
-                  refreshCounter=0;
-                }
         }
       }
     while (!stop_req);

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui	2010-04-06 15:10:31 UTC (rev 6076)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui	2010-04-06 15:10:32 UTC (rev 6077)
@@ -1481,9 +1481,6 @@
    </attribute>
    <addaction name="actionPreviewInput"/>
    <addaction name="actionPreviewOutput"/>
-   <addaction name="actionPreviewSide"/>
-   <addaction name="actionPreviewTop"/>
-   <addaction name="actionPreviewSeparate"/>
   </widget>
   <action name="actionOpen">
    <property name="icon">



From gruntster at mail.berlios.de  Tue Apr  6 18:20:54 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 6 Apr 2010 18:20:54 +0200
Subject: [Avidemux-svn-commit] r6078 -
	branches/avidemux_2.5_branch_gruntster/cmake
Message-ID: <201004061620.o36GKs8G029412@sheep.berlios.de>

Author: gruntster
Date: 2010-04-06 18:20:49 +0200 (Tue, 06 Apr 2010)
New Revision: 6078

Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
Log:
[ffmpeg] enable missing codecs and remove unnecessary options

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2010-04-06 15:10:32 UTC (rev 6077)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2010-04-06 16:20:49 UTC (rev 6078)
@@ -7,16 +7,15 @@
 set(FFMPEG_SOURCE_DIR "${LIBRARY_SOURCE_DIR}/ffmpeg")
 set(FFMPEG_BINARY_DIR "${CMAKE_BINARY_DIR}/avidemux/ADM_libraries/ffmpeg")
 
-set(FFMPEG_DECODERS  adpcm_ima_amv  amv  bmp  cinepak  dca  dnxhd  dvbsub  dvvideo  ffv1  ffvhuff  flv  fourxm  fraps  h263  h264  huffyuv  indeo2  indeo3
-					 interplay_video  mjpeg  mjpegb  mpeg1video  mpeg2video  mpeg4  mpegaudio_hp  mpegvideo  msmpeg4v1  msmpeg4v2  msmpeg4v3  msvideo1
-					 nellymoser  png  qdm2  rawvideo rv10  rv20  snow  svq1  svq3  tscc  vc1  vcr1  vp3  vp5  vp6  vp6a  vp6f  wmav2  wmv1  wmv2  wmv3)
-set(FFMPEG_ENCODERS  ac3  dvbsub  dvvideo  ffv1  ffvhuff  flv  flv1  h263  h263p  huffyuv  mjpeg  mpeg1video  mpeg2video  mp2  mpeg4  msmpeg4v3  snow)
-set(FFMPEG_MUXERS  flv  ipod  matroska  mov  mp4  psp  tg2  tgp)
-set(FFMPEG_PARSERS  h263  h264  mpeg4video ac3)
+set(FFMPEG_DECODERS  adpcm_ima_amv  amv  bmp  cinepak  cyuv  dca  dvbsub  dvvideo  ffv1  ffvhuff  flv  fraps  h263  h264  huffyuv  mjpeg
+					 mjpegb  mpeg2video  mpeg4  msmpeg4v2  msmpeg4v3  msvideo1  nellymoser  png  qdm2  rawvideo  snow  svq3  theora  tscc
+					 vc1  vp3  vp6  vp6a  vp6f  wmav2  wmv1  wmv2  wmv3)
+set(FFMPEG_ENCODERS  ac3  dvvideo  ffv1  ffvhuff  flv  h263  huffyuv  mjpeg  mp2  mpeg1video  mpeg2video  mpeg4  snow)
+set(FFMPEG_MUXERS  flv  matroska  mpeg1vcd  mpeg2dvd  mpeg2svcd  mpegts  mov  mp4  psp)
+set(FFMPEG_PARSERS  ac3  h263  h264  mpeg4video)
 set(FFMPEG_PROTOCOLS  file)
-set(FFMPEG_FLAGS  --enable-shared --disable-static --disable-filters --disable-protocols --disable-indevs --disable-outdevs --disable-bsfs
-				  --disable-parsers --disable-decoders --disable-encoders --disable-demuxers --disable-muxers --enable-postproc --enable-gpl 
-				  --enable-runtime-cpudetect --disable-ffplay --prefix=${CMAKE_INSTALL_PREFIX})
+set(FFMPEG_FLAGS  --enable-shared --disable-static --disable-everything --enable-hwaccels --enable-postproc --enable-gpl 
+				  --enable-runtime-cpudetect --disable-network --disable-ffplay --disable-ffprobe --prefix=${CMAKE_INSTALL_PREFIX})
 
 include(admFFmpegPatch)
 include(admFFmpegPrepareTar)



From gruntster at mail.berlios.de  Tue Apr  6 18:24:57 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 6 Apr 2010 18:24:57 +0200
Subject: [Avidemux-svn-commit] r6079 - in
	branches/avidemux_2.5_branch_gruntster: avidemux/ADM_outputs
	cmake/patches
Message-ID: <201004061624.o36GOvC8030008@sheep.berlios.de>

Author: gruntster
Date: 2010-04-06 18:24:50 +0200 (Tue, 06 Apr 2010)
New Revision: 6079

Removed:
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_lavformat.cpp
   branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
Log:
[ffmpeg] check that all necessary muxers and protocols exist on startup

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_lavformat.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_lavformat.cpp	2010-04-06 16:20:49 UTC (rev 6078)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/ADM_lavformat.cpp	2010-04-06 16:24:50 UTC (rev 6079)
@@ -699,21 +699,35 @@
 {
 	return 0;
 }
-extern "C"
-{
-     extern  int        mpegps_init(void );
-     extern  int        movenc_init(void );
-     extern  int        flvenc_init(void );
-     extern  int        matroskaenc_init(void );
-};
-extern URLProtocol file_protocol ;
+
 uint8_t lavformat_init(void)
 {
-                movenc_init();
-                flvenc_init();
-                matroskaenc_init();
-                av_register_protocol(&file_protocol);
+	av_register_all();
+
+	// Make sure avformat is correctly configured
+	const char* formats[] = {"mpegts", "dvd", "vcd", "svcd", "mp4", "psp", "flv", "matroska"};
+	AVOutputFormat *avfmt;
+
+	for (int i = 0; i < 8; i++)
+	{
+		avfmt = av_guess_format(formats[i], NULL, NULL);
+
+		if (avfmt == NULL)
+		{
+			printf("Error: %s muxer isn't registered\n", formats[i]);
+			ADM_assert(0);
+		}
+	}
+
+	URLProtocol *up = av_protocol_next(NULL);
+
+	if (strcmp(up->name, "file") != 0)
+	{
+		printf("Error: file protocol isn't registered\n");
+		ADM_assert(0);
+	}
 }
+
 extern "C"
 {
 /**

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh	2010-04-06 16:20:49 UTC (rev 6078)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh	2010-04-06 16:24:50 UTC (rev 6079)
@@ -27,9 +27,7 @@
 updatePatch libavcodec mpegvideo_enc.c
 updatePatch libavcodec utils.c
 updatePatch libavformat file.c
-updatePatch libavformat flvenc.c
 updatePatch libavformat isom.c
 updatePatch libavformat matroskaenc.c
-updatePatch libavformat movenc.c
 updatePatch libavutil avutil.h
 

Deleted: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch	2010-04-06 16:20:49 UTC (rev 6078)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_flvenc.c.patch	2010-04-06 16:24:50 UTC (rev 6079)
@@ -1,17 +0,0 @@
-*** libavformat/flvenc.c.old	Sat Mar 27 20:05:43 2010
---- libavformat/flvenc.c	Sat Mar 27 20:05:43 2010
-***************
-*** 418,420 ****
---- 419,429 ----
-      .codec_tag= (const AVCodecTag* const []){flv_video_codec_ids, flv_audio_codec_ids, 0},
-      .flags= AVFMT_GLOBALHEADER | AVFMT_VARIABLE_FPS,
-  };
-+ // MEANX
-+ int flvenc_init(void);
-+ 
-+ int flvenc_init(void)
-+ {
-+     av_register_output_format(&flv_muxer);
-+     return 0;
-+ }
-\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2010-04-06 16:20:49 UTC (rev 6078)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2010-04-06 16:24:50 UTC (rev 6079)
@@ -68,19 +68,3 @@
           if ((tag = av_metadata_get(st->metadata, "title", NULL, 0)))
               put_ebml_string(pb, MATROSKA_ID_TRACKNAME, tag->value);
           tag = av_metadata_get(st->metadata, "language", NULL, 0);
-***************
-*** 1004,1006 ****
---- 1045,1057 ----
-      .flags = AVFMT_GLOBALHEADER,
-      .codec_tag = (const AVCodecTag* const []){ff_codec_wav_tags, 0},
-  };
-+ // MEANX
-+ //
-+ int matroskaenc_init(void);
-+ 
-+ int matroskaenc_init(void)
-+ {
-+     av_register_output_format(&matroska_muxer);
-+     return 0;
-+ }
-+ // /MEANX

Deleted: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch	2010-04-06 16:20:49 UTC (rev 6078)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_movenc.c.patch	2010-04-06 16:24:50 UTC (rev 6079)
@@ -1,22 +0,0 @@
-*** libavformat/movenc.c.old	Sat Mar 27 20:05:46 2010
---- libavformat/movenc.c	Sat Mar 27 20:05:46 2010
-***************
-*** 2140,2142 ****
---- 2140,2156 ----
-      .codec_tag = (const AVCodecTag* const []){codec_ipod_tags, 0},
-  };
-  #endif
-+ /* MEANX */
-+ int movenc_init(void);
-+ 
-+ int movenc_init(void)
-+ {
-+     av_register_output_format(&mov_muxer);
-+     av_register_output_format(&tgp_muxer);
-+     av_register_output_format(&mp4_muxer);
-+     av_register_output_format(&psp_muxer);
-+     av_register_output_format(&tg2_muxer);
-+     av_register_output_format(&ipod_muxer);
-+     return 0;
-+ }
-+ /* MEANX */



From gruntster at mail.berlios.de  Tue Apr  6 19:55:06 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 6 Apr 2010 19:55:06 +0200
Subject: [Avidemux-svn-commit] r6080 - in
	branches/avidemux_2.5_branch_gruntster/avidemux: .
	ADM_encoder ADM_libraries ADM_libraries/ADM_mplex
	ADM_osSupport ADM_outputs/oplug_mpegFF ADM_toolkit
	ADM_userInterfaces/ADM_commonUI
Message-ID: <201004061755.o36Ht6od005282@sheep.berlios.de>

Author: gruntster
Date: 2010-04-06 19:54:55 +0200 (Tue, 06 Apr 2010)
New Revision: 6080

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/yuv4mpeg_ratio.c
Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encffmatrix.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encmpeg2enc.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encmpeg2enc.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_libmpeg2enc/
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_xvidratectl/
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_encCodecDesc.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_vidEncode.hxx
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_osSupport/ADM_debugID.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_toolkit/automation.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp
Log:
[mpeg2enc] remove old mpeg2enc and xvid rate control logic

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_encCodecDesc.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_encCodecDesc.h	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_encCodecDesc.h	2010-04-06 17:54:55 UTC (rev 6080)
@@ -23,67 +23,6 @@
   NULL
 };
 
-#include "ADM_libraries/ADM_libmpeg2enc/ADM_mpeg2enc.h"
-// ************ Mpeg2enc VCD *************
-Mpeg2encParam VCDExtra = {
-  (1152 * 1000) >> 3,		// Max BR
-  18,				// Gop size
-  0,				//int   wideScreen;
-  0,				//int   matrix;
-  0,				//int   interlacingType;
-  0				// bff
-};
-
-
-COMPRES_PARAMS VCDCodec = {
-  CodecVCD,
-  QT_TR_NOOP("VCD (mpeg2enc)"),
-  "VCD",
-  "Mpeg2enc (VCD)",
-  COMPRESS_CBR,
-  4,
-  1500,
-  700,
-  1000, // AVG
-  ADM_ENC_CAP_CBR,
-  ADM_EXTRA_PARAM,
-  &VCDExtra,
-  sizeof (VCDExtra),
-  NULL
-};
-//************  MPEG2Enc SVCD *******************
-
-
-
-extern uint8_t DIA_SVCDParam (COMPRES_PARAMS * toto);
-
-
-Mpeg2encParam SVCDExtra = {
-  2500 ,		// Max BR
-  12,				// Gop size
-  0,				//int   wideScreen;
-  0,				//int   matrix;
-  0,				//int   interlacingType;
-  0				// bff
-};
-
-COMPRES_PARAMS SVCDCodec = {
-  CodecSVCD,
-  QT_TR_NOOP("SVCD (mpeg2enc)"),
-  "SVCD",
-  "Mpeg2enc (SVCD)",
-  COMPRESS_CQ,
-  4,
-  1500,
-  700,
-  1000, // AVG
-  ADM_ENC_CAP_CQ + ADM_ENC_CAP_2PASS+ADM_ENC_CAP_2PASS_BR,
-  ADM_EXTRA_PARAM,
-  &SVCDExtra,
-  sizeof (SVCDExtra),
-  DIA_SVCDParam
-};
-//*******************
 #if defined REQUANT_AS_CODE
 uint32_t RequantFactorExtra=1000; // 1000* the actual requant factor
 COMPRES_PARAMS RequantCodec = {
@@ -103,33 +42,7 @@
     DIA_requant
 };
 #endif
-//********************************************
-Mpeg2encParam DVDExtra = {
-  9000            ,		// Max BR
-  12,				// Gop size
-  0,				//int   wideScreen;
-  0,				//int   matrix;
-  0,				//int   interlacingType;
-  0				// bff
-};
 
-COMPRES_PARAMS DVDCodec = {
-  CodecDVD,
-  QT_TR_NOOP("DVD (mpeg2enc)"),
-  "DVD",
-  "Mpeg2enc (DVD)",
-  COMPRESS_CQ,
-  4,
-  1500,
-  700,
-  1000, // AVG
-  ADM_ENC_CAP_CBR + ADM_ENC_CAP_CQ + ADM_ENC_CAP_2PASS,
-  ADM_EXTRA_PARAM,
-  &DVDExtra,
-  sizeof (DVDExtra),
-  DIA_SVCDParam
-};
-
 COMPRES_PARAMS DUMMYONE =
   { CodecDummy, QT_TR_NOOP("dummy"), "dummy", "dummy", COMPRESS_CQ, 4, 1500, 700,1000, 0, 0,
 NULL, 0 };
@@ -139,9 +52,6 @@
 
 COMPRES_PARAMS *internalVideoCodec[] = {
   &CopyCodec,
-  &VCDCodec,
-  &SVCDCodec,
-  &DVDCodec,
   &RequantCodec,
   &yv12codec,
   &DUMMYONE

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_vidEncode.hxx
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_vidEncode.hxx	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/ADM_vidEncode.hxx	2010-04-06 17:54:55 UTC (rev 6080)
@@ -20,9 +20,6 @@
 typedef enum 
 {
   CodecCopy,
-  CodecVCD,
-  CodecSVCD,
-  CodecDVD,
   CodecYV12,
   CodecRequant,
   CodecExternal,

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/CMakeLists.txt	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/CMakeLists.txt	2010-04-06 17:54:55 UTC (rev 6080)
@@ -1,6 +1,6 @@
 SET(ADM_encoder_SRCS 
 	adm_encConfig.cpp  adm_encoder.cpp
-	adm_encCopy.cpp    adm_encmpeg2enc.cpp  adm_encRequant.cpp  adm_encyv12.cpp
+	adm_encCopy.cpp    adm_encRequant.cpp  adm_encyv12.cpp
 	ADM_pluginLoad.cpp ADM_externalEncoder.cpp)
 
 ADD_ADM_LIB_ALL_TARGETS(ADM_encoder ${ADM_encoder_SRCS})

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encConfig.cpp	2010-04-06 17:54:55 UTC (rev 6080)
@@ -49,7 +49,6 @@
 #include "adm_encoder.h"
 #include "adm_encCopy.h"
 #include "adm_encyv12.h"
-#include "adm_encmpeg2enc.h"
 #include "adm_encRequant.h"
 #include "ADM_pluginLoad.h"
 #include "ADM_externalEncoder.h"
@@ -87,10 +86,9 @@
 	{
 		return CodecFamilyXVCD;
 	}
-	else if ((currentCodecType == CodecExternal && (
+	else if (currentCodecType == CodecExternal && (
 		strcmp(videoCodecPluginGetGuid(), "056FE919-C1D3-4450-A812-A767EAB07786") == 0 || // mpeg2enc MPEG-1 plugin
-		strcmp(videoCodecPluginGetGuid(), "C16E9CCE-D9B3-4fbe-B0C5-8B1BEBF2178E") == 0)) || // mpeg2enc MPEG-2 plugin
-		currentCodecType == CodecVCD || currentCodecType == CodecSVCD || currentCodecType == CodecDVD || currentCodecType == CodecRequant)
+		strcmp(videoCodecPluginGetGuid(), "C16E9CCE-D9B3-4fbe-B0C5-8B1BEBF2178E") == 0))  // mpeg2enc MPEG-2 plugin
 	{
 		return CodecFamilyMpeg;
 	}
@@ -195,56 +193,6 @@
 			aprintf ("Follow mode\n");
 		}
 
-		// search for other options
-		if (!strcasecmp (cs, "mbr"))
-		{
-			compmode = NO_COMPRESSION_MODE;
-			iparam = (iparam * 1000) >> 3;
-
-			switch (currentCodecType)
-			{
-			case CodecSVCD:
-				SVCDExtra.maxBitrate = (int) iparam;
-				break;
-			case CodecDVD:
-				DVDExtra.maxBitrate = (int) iparam;
-				break;
-			default:
-				break;
-			}
-		}
-
-		if (!strcasecmp (cs, "matrix"))
-		{
-			compmode = NO_COMPRESSION_MODE;
-
-			switch (currentCodecType)
-			{
-			case CodecSVCD:
-				SVCDExtra.user_matrix = (int) iparam;
-				break;
-			case CodecDVD:
-				DVDExtra.user_matrix = (int) iparam;
-				break;
-			default:
-				break;
-			}
-		}
-
-		if (!strcmp (cs, "ws"))
-		{
-			switch (currentCodecType)
-			{
-			case CodecDVD:
-				DVDExtra.widescreen = 1;
-			case CodecSVCD:
-				SVCDExtra.widescreen = 1;
-				break;
-			default:
-				break;
-			}
-		}
-
 		if (compmode == UNSET_COMPRESSION_MODE)
 		{
 			printf ("\n ***** Unknown mode for video codec (%s)\n", cmdString);
@@ -606,10 +554,6 @@
 	case CodecYV12:
 		e = new EncoderYV12 ();
 		break;
-	case CodecDVD:
-		e=new EncoderMpeg2enc(MPEG2ENC_DVD, desc);
-		printf("\n Using mpeg2enc encoder (DVD)\n");
-		break;
 	case CodecRequant:
 		if(!isMpeg12Compatible(avifileinfo->fcc))
 		{
@@ -621,14 +565,6 @@
 
 		printf("\n Using mpeg2 requant\n");
 		break;
-	case CodecSVCD:
-		e=new EncoderMpeg2enc(MPEG2ENC_SVCD, desc);
-		printf("\n Using mpeg2enc encoder (SVCD)\n");
-		break;
-	case CodecVCD:
-		e=new EncoderMpeg2enc(MPEG2ENC_VCD, desc);
-		printf("\n Using mpeg2enc encoder (VCD)\n");
-		break;
 	case CodecExternal:
 		e = new externalEncoder(&AllVideoCodec[currentCodecIndex], globalHeaderFlag);
 		break;

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encffmatrix.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encffmatrix.h	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encffmatrix.h	2010-04-06 17:54:55 UTC (rev 6080)
@@ -1,113 +0,0 @@
-/***************************************************************************
-                          adm_encffmmatrix.g  -  description
-                             -------------------
-
-	Defined mpeg1/2 custom matrices
-
-    begin                : Tue Sep 1 2003
-    copyright            : (C) 2002 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#define ADM_MATRIX_DEFAULT 	0
-#define ADM_MATRIX_TMP	     	1
-#define ADM_MATRIX_ANIME	     	2
-#define ADM_MATRIX_KVCD 		3
-#define ADM_MATRIX_HRTMP	4
-
-static uint16_t tmpgenc_intra[64] = {
-  8, 16, 19, 22, 26, 27, 29, 34,
-  16, 16, 22, 24, 27, 29, 34, 37,
-  19, 22, 26, 27, 29, 34, 34, 38,
-  22, 22, 26, 27, 29, 34, 37, 40,
-  22, 26, 27, 29, 32, 35, 40, 48,
-  26, 27, 29, 32, 35, 40, 48, 58,
-  26, 27, 29, 34, 38, 46, 56, 69,
-  27, 29, 35, 38, 46, 56, 69, 83
-};
-static uint16_t tmpgenc_inter[64] = {
-  16, 17, 18, 19, 20, 21, 22, 23,	//0
-  17, 18, 19, 20, 21, 22, 23, 24,
-  18, 19, 20, 21, 22, 23, 24, 25,
-  19, 20, 21, 22, 23, 24, 26, 27,
-  20, 21, 22, 23, 25, 26, 27, 28,	//4
-  21, 22, 23, 24, 26, 27, 28, 30,
-  22, 23, 24, 26, 27, 28, 30, 31,
-  23, 24, 25, 27, 28, 30, 31, 33
-};
-static uint16_t anime_intra[64] = {
-  8, 32, 32, 32, 32, 32, 32, 32,	//0
-  32, 32, 32, 32, 32, 32, 32, 32,
-  32, 32, 32, 32, 32, 32, 32, 32,
-  32, 32, 32, 32, 32, 32, 32, 32,
-  32, 32, 32, 32, 32, 32, 32, 32,	//4
-  32, 32, 32, 32, 32, 32, 32, 32,
-  32, 32, 32, 32, 32, 32, 32, 32,
-  32, 32, 32, 32, 32, 32, 32, 32
-};
-static uint16_t anime_inter[64] = {
-  16, 16, 16, 16, 16, 16, 16, 16,	//0
-  16, 16, 16, 16, 16, 16, 16, 16,
-  16, 16, 16, 16, 16, 16, 16, 16,
-  16, 16, 16, 16, 16, 16, 16, 16,
-  16, 16, 16, 16, 16, 16, 16, 16,	//4
-  16, 16, 16, 16, 16, 16, 16, 16,
-  16, 16, 16, 16, 16, 16, 16, 16,
-  16, 16, 16, 16, 16, 16, 16, 16,
-};
-//----------------------------------------------
-static uint16_t kvcd_intra[64] = {
-  8, 9, 12, 22, 26, 27, 29, 34,	//0
-  9, 10, 14, 26, 27, 29, 37, 37,
-  12, 14, 18, 27, 29, 34, 37, 38,
-  22, 26, 27, 31, 36, 37, 38, 40,
-
-  26, 27, 29, 36, 39, 38, 40, 48,	//4
-  27, 29, 34, 37, 38, 40, 48, 58,
-  29, 34, 37, 38, 40, 48, 58, 69,
-  34, 37, 38, 40, 48, 58, 69, 79
-};
-static uint16_t kvcd_inter[64] = {
-  16, 18, 20, 22, 24, 26, 28, 30,	//0
-  18, 20, 22, 24, 26, 28, 30, 32,	//0
-  20, 22, 24, 26, 28, 30, 32, 34,	//0
-  22, 24, 26, 28, 30, 32, 34, 36,	//0
-
-  24, 26, 28, 30, 32, 34, 36, 38,	//0
-  26, 28, 30, 32, 34, 36, 38, 40,	//0
-  28, 30, 32, 34, 36, 38, 40, 42,	//0
-  30, 32, 34, 36, 38, 40, 42, 44	//0
-};
-//----------------------------------------------
-static uint16_t hrtmpgenc_intra[64] = {
-// High resolution INTRA table
-  8, 16, 18, 20, 24, 25, 26, 30,
-  16, 16, 20, 23, 25, 26, 30, 30,
-  18, 20, 22, 24, 26, 28, 29, 31,
-  20, 21, 23, 24, 26, 28, 31, 31,
-  21, 23, 24, 25, 28, 30, 30, 33,
-  23, 24, 25, 28, 30, 30, 33, 36,
-  24, 25, 26, 29, 29, 31, 34, 38,
-  25, 26, 28, 29, 31, 34, 38, 42
-};
-static uint16_t hrtmpgenc_inter[64] = {
-// TMPEGEnc INTER table
-  16, 17, 18, 19, 20, 21, 22, 23,
-  17, 18, 19, 20, 21, 22, 23, 24,
-  18, 19, 20, 21, 22, 23, 24, 25,
-  19, 20, 21, 22, 23, 24, 26, 27,
-  20, 21, 22, 23, 25, 26, 27, 28,
-  21, 22, 23, 24, 26, 27, 28, 30,
-  22, 23, 24, 26, 27, 28, 30, 31,
-  23, 24, 25, 27, 28, 30, 31, 33
-};
-
-// EOF

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encmpeg2enc.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encmpeg2enc.cpp	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encmpeg2enc.cpp	2010-04-06 17:54:55 UTC (rev 6080)
@@ -1,431 +0,0 @@
-/***************************************************************************
-                         
-    copyright            : (C) 2006 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include "config.h"
-
-#include <stdio.h>
-#include <stdlib.h>
-#include <math.h>
-#include <unistd.h>
-#include <time.h>
-#include <sys/time.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <errno.h>
-
-#include "fourcc.h"
-#include "ADM_osSupport/ADM_quota.h"
-#include "avi_vars.h"
-
-#include "ADM_assert.h"
-
-
-#include "ADM_encoder/ADM_vidEncode.hxx"
-#include "ADM_videoFilter.h"
-#include "ADM_encoder/adm_encoder.h"
-#include "ADM_encoder/adm_encConfig.h"
-
-#include "ADM_audiofilter/audioprocess.hxx"
-
-#include "ADM_libraries/ADM_libmpeg2enc/ADM_mpeg2enc.h"
-#include "ADM_audiofilter/audioeng_buildfilters.h"
-#include "prefs.h"
-#include "adm_encmpeg2enc.h"
-#include "ADM_libraries/ADM_xvidratectl/ADM_ratecontrol.h"
-
-#include "ADM_osSupport/ADM_debugID.h"
-#define MODULE_NAME MODULE_ENCODER
-#include "ADM_osSupport/ADM_debug.h"
-
-
-#warning FIXME: Duplicate define with mpeg2enc -> bad
-#define MPEG_PREFILL 5
-
-static ADM_newXvidRcVBV *_xrc = NULL;
-extern uint32_t ADM_computeBitrate(uint32_t fps1000, uint32_t nbFrame, uint32_t sizeInMB);
-
-/**
-      \fn verifyLog
-      \brief Ask the RC if the 2pass log file is correct
-      @param file filename
-      @param nb nbFrames expected to be present
-      @return 1 if file is ok, 0 is corrupted
-
-*/
-uint8_t EncoderMpeg2enc::verifyLog(const char *file,uint32_t nbFrame)
-{
-      return ADM_newXvidRcVBV::verifyLog(file,nbFrame+2);
-}
-/*_________________________________________________*/
-EncoderMpeg2enc::EncoderMpeg2enc (MPEG2ENC_ID id, COMPRES_PARAMS * config)
-{
-  _frametogo = 0;
-  _pass1Done = 0;
-  _lastQz = 0;
-  _lastBitrate = 0;
-  _totalframe = 0;
-  _id=id;
-  memcpy (&_param, config, sizeof (_param));
-  ADM_assert (config->extraSettingsLen == sizeof (_settings)); //Mpeg2encParam
-  memcpy (&_settings, config->extraSettings, sizeof (_settings));
-  _delayed=0;
-  _availableFrames=0;
-
-};
-#define MPEG1_MIN_Q 2
-#define MPEG1_MAX_Q 28
-
-uint8_t     EncoderMpeg2enc::encode (uint32_t frame, ADMBitstream *out)
-{
-  uint32_t l,flags;
-  ADM_assert (_codec);
-  ADM_assert (_in);
-  ADM_rframe rf;
-  uint32_t asked;
-  uint32_t nq;
-  uint32_t nf;
-  ADM_rframe f;
-
-_retry:
-  asked=frame+_delayed;
-  if(asked>=_availableFrames) asked=_availableFrames-1;
-  if (!_in->getFrameNumberNoAlloc (asked, &l, _vbuffer, &flags))
-  {
-    printf ("\n Error : Cannot read incoming frame !");
-    return 0;
-  }
-  
-  if(_state==enc_Pass2)
-  {
-      _xrc->getQz (&nq, &f);
-      switch (f)
-      {
-        case RF_I:
-          nf = AVI_KEY_FRAME;
-          break;
-        default:
-          nf = 0;
-      }
-  
-      if (nq < MPEG1_MIN_Q)
-        nq = MPEG1_MIN_Q;
-      if (nq > MPEG1_MAX_Q)
-        nq = MPEG1_MAX_Q;
-  
-        //printf("asked :%d ",nq);
-        out->in_quantizer=nq;
-        out->flags=nf;
-   }else
-  {
-      out->in_quantizer=0;
-  }
-   if(!_codec->encode (_vbuffer, out ))
-   {
-     printf("[mpeg2enc]Codec error frame %u delay %u\n", frame,_delayed);
-     return 0;
-   }
-   
-   switch (out->flags)
-   {
-     case AVI_KEY_FRAME:
-       rf = RF_I;
-       break;
-     case AVI_B_FRAME:
-       rf = RF_B;
-       break;
-     case 0:
-       rf = RF_P;
-       break;
-     default:
-       ADM_assert (0);
-
-   }
-   
-   switch(_state)
-   {
-     case enc_Pass1:
-        {
-          if (!out->len)
-          {
-            printf ("Skipping delay\n");
-            goto _retry;
-          }
-         
-          _xrc->logPass1 (out->out_quantizer, rf, out->len);
-          _frametogo++;
-        }
-        break;
-     case enc_Pass2:
-     {
-       if (!out->len)
-       {
-         printf ("Skipping delay\n");
-         goto _retry;
-       }
-       {
-         _xrc->logPass2 (out->out_quantizer, rf, out->len);
-       }
-     }
-     break;
-     default:
-       break;
-   }
-   return 1;
-}
-EncoderMpeg2enc::~EncoderMpeg2enc ()
-{
-  stop ();
-};
-
-
-
-//--------------------------------
-uint8_t     EncoderMpeg2enc::configure (AVDMGenericVideoStream * instream, int useExistingLogFile)
-{
-
-  ADM_assert (instream);
-  ADV_Info *info;
-  fd = NULL;
-
-  uint32_t flag1, flag2, flag3,qz,br;
-  flag1 = flag2 = flag3 = 0;
-
-  info = instream->getInfo ();
-  _fps1000 = info->fps1000;
-  _w = info->width;
-  _h = info->height;
-
-  _vbuffer = new ADMImage (_w, _h);
-  ADM_assert (_vbuffer);
-  _in = instream;
-
-  _availableFrames=instream->getInfo()->nb_frames;
-  
-  uint32_t interlaced=_settings.interlaced;
-  uint32_t bff=_settings.bff;
-  uint32_t widescreen=_settings.widescreen;
-  
-  _codec=NULL;
-  switch (_param.mode)
-  {
-    case COMPRESS_CQ:
-          qz=_param.qz;
-          br=_settings.maxBitrate*1000;
-          _state = enc_CQ;
-      break;
-    case COMPRESS_CBR:
-          qz=0;
-          br=_param.bitrate*1000;
-          _state = enc_CBR;
-          break;
-    case COMPRESS_2PASS:
-    case COMPRESS_2PASS_BITRATE:
-          qz=2;
-          br=0;
-          _state = enc_Pass1;
-          _xrc = new ADM_newXvidRcVBV (_fps1000, _logname);
-          break;
-  }
-  switch(_id)
-  {
-    case MPEG2ENC_VCD:
-      {
-        Mpeg2encVCD *dec;
-        dec = new Mpeg2encVCD (_w, _h);
-        dec->init (1, 0, _fps1000, interlaced, bff, widescreen, 0);
-        _codec = dec;	
-      }
-      break;
-    case MPEG2ENC_SVCD:
-    {
-        Mpeg2encSVCD * dec;
-        dec = new Mpeg2encSVCD (_w, _h);
-        dec->setMatrix (_settings.user_matrix);
-        dec->init (qz, br, _fps1000, interlaced, bff, widescreen, 0);
-        _codec = dec;
-    }
-        break;
-    case MPEG2ENC_DVD:
-      {
-        Mpeg2encDVD *dec;
-        dec = new Mpeg2encDVD (_w, _h);
-        dec->setMatrix (_settings.user_matrix);
-        dec->init (qz, br, _fps1000, interlaced, bff, widescreen, 0);
-        _codec = dec;
-      }
-      break;
-      default:
-        ADM_assert (0);
-    }
-
-  ADM_assert(_codec);
-
-  _in = instream;
-  printf ("\n Mpeg2enc Encoder , w: %lu h:%lu mode:%d", _w, _h, _state);
-  return 1;
-}
-
-
-
-
-uint8_t    EncoderMpeg2enc::startPass1 (void)
-{
-  ADM_assert (_state == enc_Pass1);
-  _frametogo = 0;
-  printf ("\n Starting pass 1\n");
-  printf (" Creating logfile :%s\n", _logname);
-  _pass1Done = 1;
-  {
-    printf ("Using Xvid 2 pass rate control (%s)\n", _logname);
-    _xrc->startPass1 ();
-  }
-  return 1;
-}
-
-int EncoderMpeg2enc::getRequirements (void) { return 0; }
-
-uint8_t   EncoderMpeg2enc::isDualPass (void)
-{
-  if ((_state == enc_Pass1) || (_state == enc_Pass2))
-  {
-    return 1;
-  }
-  return 0;
-}
-
-uint8_t    EncoderMpeg2enc::setLogFile (const char *lofile, uint32_t nbframe)
-{
-  strcpy (_logname, lofile);
-  _frametogo = nbframe;
-  _totalframe = nbframe;
-  return 1;
-}
-
-//_______________________________
-uint8_t     EncoderMpeg2enc::stop (void)
-{
-  printf ("[Mpeg2enc]Stopping encoder\n");
-  if (_codec)     delete _codec;
-  _codec = NULL;
-    if (_state == enc_Pass1 || _state == enc_Pass2)
-    {
-      if (_xrc)
-      {
-        delete _xrc;
-        _xrc = NULL;
-      }
-
-    }
-  return 1;
-}
-//_______________________________
-
-uint8_t    EncoderMpeg2enc::startPass2 (void)
-{
-  uint32_t br,avg_bitrate,size;
-  
-  ADM_assert (_state == enc_Pass1);
-  printf ("[Mpeg2enc]-------* Starting pass 2*-------------\n");
-
-  if(_param.mode==COMPRESS_2PASS)
-  {
-    br=ADM_computeBitrate( _fps1000,_totalframe,_param.finalsize);
-    size=_param.finalsize;
-    printf("[Mpeg2enc] Final Size: %u MB, avg bitrate %u kb/s \n",size,br/1000);
-  }else if(_param.mode==COMPRESS_2PASS_BITRATE)
-  {
-    double d;
-    br=_param.avg_bitrate;
-    d=_totalframe;
-    d/=_fps1000;
-    d*=_param.avg_bitrate*1000*1000;
-    d/=(1024*1024);
-    size=(uint32_t )d;
-
-    printf("[Mpeg2enc]  Final Size: %u MB 2pass avg bitrate %u kb/s\n",size,br);
-    
-  }else ADM_assert(0);
-
-  uint32_t maxbr;
-
-  maxbr=_settings.maxBitrate*1000; // B/s
-
-  printf("[Mpeg2enc] Max bitrate %u kbps\n",maxbr/1000);
-  /* Check Max bitrate */
-  if(br>maxbr)
-  {
-     br=maxbr;
-     printf("[Mpeg2enc] Max bitrate exceeeded, Clipping..\n");
-  }
-
-
-  printf ("[Mpeg2enc] ** Total size     : %lu MBytes \n", _param.finalsize);
-  printf ("[Mpeg2enc] ** Total frame    : %lu  \n", _totalframe);
-
-  printf ("[Mpeg2enc] VBR parameters computed\n");
-  _state = enc_Pass2;
-  // Delete codec and start new one
-  if (_codec)
-  {
-    delete _codec;
-    _codec = NULL;
-  }
-
-  /*********/
-  uint32_t interlaced=_settings.interlaced;
-  uint32_t bff=_settings.bff;
-  uint32_t widescreen=_settings.widescreen;
-  uint32_t vbv;
-  
-  switch(_id)
-  {
-    case MPEG2ENC_SVCD:
-
-      Mpeg2encSVCD * dec;
-      dec = new Mpeg2encSVCD (_w, _h);
-      dec->setMatrix (_settings.user_matrix);
-      dec->init (2, br, _fps1000, interlaced, bff, widescreen, 0);	// WLA
-      _codec = dec;
-      vbv=122*1024;
-      break;
-    case MPEG2ENC_DVD:
-    {
-
-      Mpeg2encDVD *dec;
-      dec = new Mpeg2encDVD (_w, _h);
-      dec->setMatrix (_settings.user_matrix);
-      dec->init (2, br, _fps1000, interlaced, bff, widescreen, 0);	// WLA
-      _codec = dec;
-      vbv=224*1024;
-    }
-    break;
-    default:
-      ADM_assert (0);
-      break;
-  }
-  _xrc->setVBVInfo (_settings.maxBitrate, 0,  vbv);
-  ADM_assert (_xrc->startPass2 (size, _totalframe));
-  
-  printf ("\n XV:ready to encode in 2pass(%s)\n", _logname);
-  _frametogo = 0;
-  return 1;
-
-
-}
-
-////***********************************
-////***********************************
-////***********************************
-////***********************************
-////***********************************

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encmpeg2enc.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encmpeg2enc.h	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_encoder/adm_encmpeg2enc.h	2010-04-06 17:54:55 UTC (rev 6080)
@@ -1,64 +0,0 @@
-/***************************************************************************
-                         
-    copyright            : (C) 2006 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef ENC_MPEG2ENC_H
-#define ENC_MPEG2ENC_H
-#include "ADM_libraries/ADM_libmpeg2enc/ADM_mpeg2Param.h"
-#include "ADM_libraries/ADM_libmpeg2enc/ADM_mpeg2enc.h"
-typedef enum 
-{
-  MPEG2ENC_INVALID=0,
-  MPEG2ENC_VCD=1,
-  MPEG2ENC_SVCD=2,
-  MPEG2ENC_DVD=3
-}MPEG2ENC_ID;
-
-class EncoderMpeg2enc:public Encoder
-{
-  private:
-    uint8_t setMatrix (void);
-    uint8_t _lastQz;
-    uint32_t _lastBitrate;
-    MPEG2ENC_ID _id;
-    Mpeg2encParam _settings;
-    Mpeg2enc      *_codec;
-    uint32_t      _fps1000;
-    uint32_t      _delayed;
-    uint32_t      _availableFrames;
-  public:
-
-
-    uint32_t _totalframe;
-    uint32_t _pass1Done;
-
-  public:
-    EncoderMpeg2enc (MPEG2ENC_ID id, COMPRES_PARAMS * config);
-    virtual ~ EncoderMpeg2enc ();	// can be called twice if needed ..
-	virtual int getRequirements (void);
-    virtual uint8_t isDualPass (void);
-    virtual uint8_t configure (AVDMGenericVideoStream * instream, int useExistingLogFile);
-    virtual uint8_t encode (uint32_t frame, ADMBitstream *out);
-    virtual uint8_t setLogFile (const char *p, uint32_t fr);
-    virtual uint8_t stop (void);
-    virtual uint8_t startPass2 (void);
-    virtual uint8_t startPass1 (void);
-    virtual const char *getCodecName (void) {return "MPEG";};
-    virtual const char *getFCCHandler (void) {return "MPEG";};
-    virtual const char *getDisplayName (void) {return QT_TR_NOOP("MPEG");}; // FIXME
-            uint8_t verifyLog(const char *name,uint32_t nbFrame);
-
-};
-
-#endif
-//EOF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/CMakeLists.txt	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/CMakeLists.txt	2010-04-06 17:54:55 UTC (rev 6080)
@@ -4,7 +4,7 @@
 	ac3strm_in.cpp      ADM_mplexout.cpp   audiostrm_out.cpp  dtsstrm_in.cpp  lpcmstrm_in.cpp   multiplexor.cpp   stream_params.cpp  videostrm_in.cpp
 	ADM_mplexin.cpp     ADM_mthread.cpp    bits.cpp           inputstrm.cpp   padstrm.cpp       systems.cpp       videostrm_out.cpp
 	ADM_mplexmuxer.cpp  ADM_transfert.cpp  interact.cpp       mpastrm_in.cpp  stillsstream.cpp  mpegconsts.c      mjpeg_logging.c    decodebufmodel.cpp
-	yuv4mpeg.c          cpu_accel.c)
+	yuv4mpeg.c          yuv4mpeg_ratio.c   cpu_accel.c)
 
 include_directories("${PTHREAD_INCLUDE_DIR}")
 ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/yuv4mpeg_ratio.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/yuv4mpeg_ratio.c	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_mplex/yuv4mpeg_ratio.c	2010-04-06 17:54:55 UTC (rev 6080)
@@ -0,0 +1,157 @@
+/*
+ *  yuv4mpeg_ratio.c:  Functions for dealing with y4m_ratio_t datatype.
+ *
+ *  Copyright (C) 2001 Matthew J. Marjanovic <maddog at mir.com>
+ *
+ *
+ *  This program is free software; you can redistribute it and/or
+ *  modify it under the terms of the GNU General Public License
+ *  as published by the Free Software Foundation; either version 2
+ *  of the License, or (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+ *
+ */
+
+#include <config.h>
+
+#include <string.h>
+#include "yuv4mpeg.h"
+#include "yuv4mpeg_intern.h"
+
+
+/* useful list of standard framerates */
+const y4m_ratio_t y4m_fps_UNKNOWN    = Y4M_FPS_UNKNOWN;
+const y4m_ratio_t y4m_fps_NTSC_FILM  = Y4M_FPS_NTSC_FILM;
+const y4m_ratio_t y4m_fps_FILM       = Y4M_FPS_FILM;
+const y4m_ratio_t y4m_fps_PAL        = Y4M_FPS_PAL;
+const y4m_ratio_t y4m_fps_NTSC       = Y4M_FPS_NTSC;
+const y4m_ratio_t y4m_fps_30         = Y4M_FPS_30;
+const y4m_ratio_t y4m_fps_PAL_FIELD  = Y4M_FPS_PAL_FIELD;
+const y4m_ratio_t y4m_fps_NTSC_FIELD = Y4M_FPS_NTSC_FIELD;
+const y4m_ratio_t y4m_fps_60         = Y4M_FPS_60;
+
+/* useful list of standard sample aspect ratios */
+const y4m_ratio_t y4m_sar_UNKNOWN        = Y4M_SAR_UNKNOWN;
+const y4m_ratio_t y4m_sar_SQUARE         = Y4M_SAR_SQUARE;
+const y4m_ratio_t y4m_sar_SQR_ANA_16_9   = Y4M_SAR_SQR_ANA_16_9;
+const y4m_ratio_t y4m_sar_NTSC_CCIR601   = Y4M_SAR_NTSC_CCIR601;
+const y4m_ratio_t y4m_sar_NTSC_16_9      = Y4M_SAR_NTSC_16_9;
+const y4m_ratio_t y4m_sar_NTSC_SVCD_4_3  = Y4M_SAR_NTSC_SVCD_4_3;
+const y4m_ratio_t y4m_sar_NTSC_SVCD_16_9 = Y4M_SAR_NTSC_SVCD_16_9;
+const y4m_ratio_t y4m_sar_PAL_CCIR601    = Y4M_SAR_PAL_CCIR601;
+const y4m_ratio_t y4m_sar_PAL_16_9       = Y4M_SAR_PAL_16_9;
+const y4m_ratio_t y4m_sar_PAL_SVCD_4_3   = Y4M_SAR_PAL_SVCD_4_3;
+const y4m_ratio_t y4m_sar_PAL_SVCD_16_9  = Y4M_SAR_PAL_SVCD_16_9;
+
+/* useful list of standard display aspect ratios */
+const y4m_ratio_t y4m_dar_UNKNOWN        = Y4M_DAR_UNKNOWN;
+const y4m_ratio_t y4m_dar_4_3            = Y4M_DAR_4_3;
+const y4m_ratio_t y4m_dar_16_9           = Y4M_DAR_16_9;
+const y4m_ratio_t y4m_dar_221_100        = Y4M_DAR_221_100;
+
+/*
+ *  Euler's algorithm for greatest common divisor
+ */
+
+static int gcd(int a, int b)
+{
+  a = (a >= 0) ? a : -a;
+  b = (b >= 0) ? b : -b;
+
+  while (b > 0) {
+    int x = b;
+    b = a % b;
+    a = x;
+  }
+  return a;
+}
+    
+
+/*************************************************************************
+ *
+ * Remove common factors from a ratio
+ *
+ *************************************************************************/
+
+
+void y4m_ratio_reduce(y4m_ratio_t *r)
+{
+  int d;
+  if ((r->n == 0) && (r->d == 0)) return;  /* "unknown" */
+  d = gcd(r->n, r->d);
+  r->n /= d;
+  r->d /= d;
+}
+
+
+
+/*************************************************************************
+ *
+ * Parse "nnn:ddd" into a ratio
+ *
+ * returns:         Y4M_OK  - success
+ *           Y4M_ERR_RANGE  - range error 
+ *
+ *************************************************************************/
+
+int y4m_parse_ratio(y4m_ratio_t *r, const char *s)
+{
+  char *t = strchr(s, ':');
+  if (t == NULL) return Y4M_ERR_RANGE;
+  r->n = atoi(s);
+  r->d = atoi(t+1);
+  if (r->d < 0) return Y4M_ERR_RANGE;
+  /* 0:0 == unknown, so that is ok, otherwise zero denominator is bad */
+  if ((r->d == 0) && (r->n != 0)) return Y4M_ERR_RANGE;
+  y4m_ratio_reduce(r);
+  return Y4M_OK;
+}
+
+
+
+/*************************************************************************
+ *
+ * Guess the true SAR (sample aspect ratio) from a list of commonly 
+ * encountered values, given the "suggested" display aspect ratio, and
+ * the true frame width and height.
+ *
+ * Returns y4m_sar_UNKNOWN if no match is found.
+ *
+ *************************************************************************/
+
+/* this is big enough to accommodate the difference between 720 and 704 */
+#define GUESS_ASPECT_TOLERANCE 0.03
+
+y4m_ratio_t y4m_guess_sar(int width, int height, y4m_ratio_t dar)
+{
+  int i;
+  double implicit_sar = (double)(dar.n * height) / (double)(dar.d * width);
+  const y4m_ratio_t *sarray[] =
+    {
+      &y4m_sar_SQUARE,
+      &y4m_sar_NTSC_CCIR601,
+      &y4m_sar_NTSC_16_9,
+      &y4m_sar_NTSC_SVCD_4_3,
+      &y4m_sar_NTSC_SVCD_16_9,
+      &y4m_sar_PAL_CCIR601,
+      &y4m_sar_PAL_16_9,
+      &y4m_sar_PAL_SVCD_4_3,
+      &y4m_sar_PAL_SVCD_16_9,
+      &y4m_sar_UNKNOWN
+    };
+  for (i = 0; !(Y4M_RATIO_EQL(*(sarray[i]),y4m_sar_UNKNOWN)); i++) {
+    double ratio = implicit_sar / Y4M_RATIO_DBL(*(sarray[i]));
+    if ( (ratio > (1.0 - GUESS_ASPECT_TOLERANCE)) &&
+	 (ratio < (1.0 + GUESS_ASPECT_TOLERANCE)) )
+      return *(sarray[i]);
+  }
+  return y4m_sar_UNKNOWN;
+} 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/CMakeLists.txt	2010-04-06 17:54:55 UTC (rev 6080)
@@ -1,4 +1,3 @@
-add_subdirectory(ADM_libmpeg2enc)
 add_subdirectory(ADM_lvemux)
 add_subdirectory(ADM_mplex)
 
@@ -7,7 +6,6 @@
 endif (NOT USE_SYSTEM_SPIDERMONKEY)
 
 add_subdirectory(ADM_utilities)
-add_subdirectory(ADM_xvidratectl)
 
 if (ADM_DEBUG AND FIND_LEAKS)
 	add_subdirectory(ADM_nvwa)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_osSupport/ADM_debugID.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_osSupport/ADM_debugID.h	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_osSupport/ADM_debugID.h	2010-04-06 17:54:55 UTC (rev 6080)
@@ -21,7 +21,6 @@
 #define  MODULE_MPEG_DEMUX	0x040000
 #define  MODULE_AUDIO_EDITOR    0x080000
 #define MODULE_INPIC		0x100000
-#define MODULE_MPEG2ENC		0x200000
 #define MODULE_ODML		0x400000
 #define MODULE_OGM_AUDIO	0x800000
 #define MODULE_REQUANT		0x1000000

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp	2010-04-06 17:54:55 UTC (rev 6080)
@@ -207,15 +207,6 @@
       encoding =new DIA_encoding(_fps1000);
       switch (videoCodecGetType())
       {
-          case CodecVCD:
-            encoding->setCodec(QT_TR_NOOP("libmpeg2enc VCD"));
-            break;
-          case CodecSVCD:
-            encoding->setCodec(QT_TR_NOOP("libmpeg2enc SVCD"));
-            break;
-          case CodecDVD:
-            encoding->setCodec(QT_TR_NOOP("libmpeg2enc DVD"));
-            break;
           case CodecRequant:
             encoding->setCodec(QT_TR_NOOP("MPEG Requantizer"));
             break;

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_toolkit/automation.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_toolkit/automation.cpp	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_toolkit/automation.cpp	2010-04-06 17:54:55 UTC (rev 6080)
@@ -207,17 +207,7 @@
 
 }  ;
 #define NB_AUTO (sizeof(reaction_table)/sizeof(AUTOMATON))
-//_________________________________________________________________________
 
-typedef enum {
-	SOME_UNKNOWN,
-	MPEG2ENC_VCD,    // pseudo codec with profile
-	MPEG2ENC_SVCD,   // pseudo codec with profile
-	MPEG2ENC_DVD     // pseudo codec with profile
-} codec_t;
-static codec_t codec = SOME_UNKNOWN;
-
-//void automation(int argc, char **argv)
 int automation(void )
 
 {

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt	2010-04-06 17:54:55 UTC (rev 6080)
@@ -8,7 +8,6 @@
 DIA_postproc.cpp  
 DIA_bitrateHisto.cpp  
 DIA_prefs.cpp     
-DIA_SVCD.cpp       
 DIA_builtin.cpp       
 DIA_lavDecoder.cpp  
 DIA_requant.cpp   

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp	2010-04-06 17:54:55 UTC (rev 6080)
@@ -1,83 +0,0 @@
-//
-//
-// C++ Implementation: DIA_SVCD
-//
-// Description: 
-//
-//
-// Author: mean <fixounet at free.fr>, (C) 2003
-//
-// Copyright: See COPYING file that comes with this distribution
-//
-//
-
-#include "config.h"
-//#include "ADM_lavcodec.h"
-
-
-#include <string.h>
-#include <stdio.h>
-
-# include <math.h>
-
-#include "ADM_default.h"
-
-#include "ADM_codecs/ADM_codec.h"
-#include "ADM_encoder/ADM_vidEncode.hxx"
-#include "ADM_assert.h" 
-#include "DIA_factory.h"
-#include "../../ADM_libraries/ADM_libmpeg2enc/ADM_mpeg2enc.h"
-
-/**
-      \fn DIA_SVCDParam
-      \brief Dialog to set encoding options for SVCD/DVD mpeg2enc based
-*/
-uint8_t DIA_SVCDParam(COMPRES_PARAMS *incoming)
-{	
-
-Mpeg2encParam *conf=(Mpeg2encParam *)incoming->extraSettings;
-ADM_assert(incoming->extraSettingsLen==sizeof(Mpeg2encParam));
-
-diaMenuEntry wideM[]={
-  {0,QT_TR_NOOP("4:3")},
-  {1,QT_TR_NOOP("16:9")}};
-diaMenuEntry matrixM[]={
-  {0,QT_TR_NOOP("Default")},
-  {1,QT_TR_NOOP("TMPGEnc")},
-  {2,QT_TR_NOOP("Anime")},
-  {3,QT_TR_NOOP("KVCD")}
-};
-diaMenuEntry interM[]={
-  {0,QT_TR_NOOP("Progressive")},
-  {1,QT_TR_NOOP("Interlaced TFF")},
-  {2,QT_TR_NOOP("Interlaced BFF")}
-};
-                      
-         diaElemBitrate bitrate(incoming,NULL);
-         diaElemMenu      widescreen(&(conf->widescreen),QT_TR_NOOP("Aspect _ratio:"),2,wideM);
-         diaElemMenu      matrix(&(conf->user_matrix),QT_TR_NOOP("_Matrices:"),4,matrixM);
-         diaElemUInteger gop(&(conf->gop_size),QT_TR_NOOP("_GOP size:"),1,30);
-         diaElemUInteger maxb(&(conf->maxBitrate),QT_TR_NOOP("Ma_x. bitrate:"),100,9000);
-
-uint32_t inter;
-          if(!conf->interlaced) inter=0;
-            else if(conf->bff) inter=2;
-                else inter=1;
-         diaElemMenu      interW(&inter,QT_TR_NOOP("_Interlacing:"),3,interM);
-  
-      diaElem *elems[6]={&bitrate,&widescreen,&interW,&matrix,&gop,&maxb};
-    
-  if( diaFactoryRun(QT_TR_NOOP("MPEG-2 Configuration"),6,elems))
-  {
-    switch(inter)
-    {
-      case 0: conf->interlaced=0;conf->bff=0;break;
-      case 1: conf->interlaced=1;conf->bff=0;break;
-      case 2: conf->interlaced=1;conf->bff=1;break;
-      default: ADM_assert(0);
-    }
-    return 1;
-  }
-  return 0;
-}	
-// EOF

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2010-04-06 17:54:55 UTC (rev 6080)
@@ -101,7 +101,7 @@
 	SET(MACOSX_BUNDLE_SHORT_VERSION_STRING "${ADM_OSX_VERSION}")
 	SET(MACOSX_BUNDLE_VERSION "${ADM_OSX_VERSION}")
 	SET(MACOSX_BUNDLE_BUNDLE_NAME "Avidemux" )
-	SET(MACOSX_BUNDLE_COPYRIGHT "Copyright 2001-2009 Mean" )
+	SET(MACOSX_BUNDLE_COPYRIGHT "Copyright 2001-2010 Mean" )
 	SET(MACOSX_BUNDLE_SIGNATURE "Avdx" )
 	SET(MACOSX_BUNDLE_GUI_IDENTIFIER www.avidemux.org)
 
@@ -259,10 +259,8 @@
 
 ADD_ADMLIB_ALL_TARGETS(
 	ADM_mplex
-	ADM_libmpeg2enc
 	ADM_lvemux
 	ADM_utilities
-	ADM_xvidratectl
 )
 
 ADD_LIB_ALL_TARGETS(
@@ -483,5 +481,3 @@
                       WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
                       COMMENT "Creating temporary lib directory for proper plugins linking")
 ENDIF (UNIX AND NOT APPLE)
-
-

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp	2010-04-06 16:24:50 UTC (rev 6079)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp	2010-04-06 17:54:55 UTC (rev 6080)
@@ -56,7 +56,6 @@
 #include "ADM_videoFilter.h"
 #include "ADM_videoFilter_internal.h"
 #include "ADM_encoder/ADM_vidEncode.hxx"
-#include "ADM_libraries/ADM_libmpeg2enc/ADM_mpeg2enc.h"
 #include "ADM_video/ADM_vidMisc.h"
 #include "ADM_preview.h"
 



From gruntster at mail.berlios.de  Tue Apr  6 20:40:28 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 6 Apr 2010 20:40:28 +0200
Subject: [Avidemux-svn-commit] r6081 - in
	branches/avidemux_2.5_branch_gruntster/avidemux: .
	ADM_libraries/ADM_utilities ADM_userInterfaces/ADM_commonUI
Message-ID: <201004061840.o36IeSF0008974@sheep.berlios.de>

Author: gruntster
Date: 2010-04-06 20:40:22 +0200 (Tue, 06 Apr 2010)
New Revision: 6081

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/prefs.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/prefs.h
   branches/avidemux_2.5_branch_gruntster/avidemux/prefs.in
Log:
[prefs] remove mpeg split option as its now governed by mpeg2enc plugin

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/prefs.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/prefs.cpp	2010-04-06 17:54:55 UTC (rev 6080)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_libraries/ADM_utilities/prefs.cpp	2010-04-06 18:40:22 UTC (rev 6081)
@@ -91,7 +91,6 @@
 	{"filters.avsfilter.avs_loader",		FILENAME,"",	NULL, NULL, NULL },
 	{"filters.avsfilter.pipe_timeout",		UINT,	"10",	NULL,	"1",	"30"	},
 	{"filters.avsfilter.debug_msg",		UINT,	"1",	NULL,	"0",	"1"	},
-	{"settings.mpegsplit",	UINT,	"790",	NULL,	"400",	"5000"	},
 #ifdef __WIN32
 	{"device.audiodevice",		STRING,"WIN32",NULL, NULL, NULL },
 #else
@@ -141,7 +140,7 @@
 	{"priority.playback",		UINT,	"0",	NULL,	"0",	"4"	}
 };
 
-int num_opts = 77;
+int num_opts = 76;
 // </prefs_gen>
 
 #ifdef USE_LIBXML2

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2010-04-06 17:54:55 UTC (rev 6080)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2010-04-06 18:40:22 UTC (rev 6081)
@@ -43,7 +43,6 @@
 uint32_t olddevice,newdevice;
 
 uint32_t        use_odml=0;
-uint32_t	autosplit=0;
 uint32_t render;
 uint32_t useTray=0;
 uint32_t useMaster=0;
@@ -136,10 +135,6 @@
 		if(!prefs->get(PRIORITY_PLAYBACK, &playbackPriority))
                 playbackPriority=0;
 
-        // VCD/SVCD split point		
-        if(!prefs->get(SETTINGS_MPEGSPLIT, &autosplit))
-                autosplit=690;		
-                        
         // Open DML (Gmv)
         if(!prefs->get(FEATURE_USE_ODML, &use_odml))
           use_odml=0;
@@ -231,8 +226,6 @@
 		framePriority.swallow(&menuIndexPriority);
 		framePriority.swallow(&menuPlaybackPriority);
 
-        diaElemUInteger autoSplit(&autosplit,QT_TR_NOOP("_Split MPEG files every (MB):"),10,4096);
-        
         diaElemToggle   togTagMp3(&alternate_mp3_tag,QT_TR_NOOP("_Use alternative tag for MP3 in .mp4"));
         diaMenuEntry videoMode[]={
                              {RENDER_GTK, getNativeRendererDesc(), NULL}
@@ -319,24 +312,12 @@
         diaElemTabs tabInput(QT_TR_NOOP("Input"),1,(diaElem **)diaInput);
         
         /* Output */
-        diaElem *diaOutput[]={&autoSplit,&openDml,&allowAnyMpeg,&togTagMp3};
-        diaElemTabs tabOutput(QT_TR_NOOP("Output"),4,(diaElem **)diaOutput);
+        diaElem *diaOutput[]={&openDml,&allowAnyMpeg,&togTagMp3};
+        diaElemTabs tabOutput(QT_TR_NOOP("Output"),3,(diaElem **)diaOutput);
         
         /* Audio */
-
-#if 0 //defined(ALSA_SUPPORT)
-        diaElem *diaAudio[]={&menuMixer,&menuVolume,&menuAudio,&entryAlsaDevice};
-        diaElemTabs tabAudio(QT_TR_NOOP("Audio"),4,(diaElem **)diaAudio);
-//#elif defined(OSS_SUPPORT)
-        diaElem *diaAudio[]={&menuMixer,&menuVolume,&menuAudio};
-        diaElemTabs tabAudio(QT_TR_NOOP("Audio"),3,(diaElem **)diaAudio);
-#endif
-
-#if 1
         diaElem *diaAudio[]={&menuMixer,&menuAudio};
         diaElemTabs tabAudio(QT_TR_NOOP("Audio"),2,(diaElem **)diaAudio);
-#endif
-
         
         /* Video */
         diaElem *diaVideo[]={&menuVideoMode,&framePP};
@@ -424,8 +405,6 @@
                 prefs->set(DEVICE_VIDEODEVICE,render);
                 // Odml
                 prefs->set(FEATURE_USE_ODML, use_odml);
-				// Split
-                prefs->set(SETTINGS_MPEGSPLIT, autosplit);
                 
                 // number of threads
                 prefs->set(FEATURE_THREADING_LAVC, lavcThreads);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/prefs.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/prefs.h	2010-04-06 17:54:55 UTC (rev 6080)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/prefs.h	2010-04-06 18:40:22 UTC (rev 6081)
@@ -41,7 +41,6 @@
 	FILTERS_AVSFILTER_AVS_LOADER,
 	FILTERS_AVSFILTER_PIPE_TIMEOUT,
 	FILTERS_AVSFILTER_DEBUG_MSG,
-	SETTINGS_MPEGSPLIT,
 	DEVICE_AUDIODEVICE,
 	DEVICE_AUDIO_ALSA_DEVICE,
 	DEVICE_VIDEODEVICE,

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/prefs.in
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/prefs.in	2010-04-06 17:54:55 UTC (rev 6080)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/prefs.in	2010-04-06 18:40:22 UTC (rev 6081)
@@ -48,8 +48,6 @@
 filters.avsfilter.avs_loader,		FILENAME,	""
 filters.avsfilter.pipe_timeout,		UINT,	10,     1,       30
 filters.avsfilter.debug_msg,		UINT,	1,      0,       1
-# codec metasettings for mpeg2enc based
-settings.mpegsplit, 			UINT,	790,	400,	5000
 #ifdef __WIN32
 device.audiodevice,			STRING,	WIN32
 #else



From gruntster at mail.berlios.de  Tue Apr  6 21:23:01 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 6 Apr 2010 21:23:01 +0200
Subject: [Avidemux-svn-commit] r6082 - in
	branches/avidemux_2.5_branch_gruntster:
	avidemux/ADM_coreUI/include avidemux/ADM_coreUI/src
	plugins/ADM_videoEncoder/ADM_vidEnc_avcodec
	plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc
	plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc
	plugins/ADM_videoEncoder/ADM_vidEnc_x264
	plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk
	plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4
	plugins/ADM_videoEncoder/ADM_vidEnc_xvid
	plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk
	plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4
	plugins/ADM_videoEncoder/common/pluginOptions
	plugins/ADM_videoEncoder/common/xvidRateCtl
Message-ID: <201004061923.o36JN1at012559@sheep.berlios.de>

Author: gruntster
Date: 2010-04-06 21:22:30 +0200 (Tue, 06 Apr 2010)
New Revision: 6082

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factory.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/src/DIA_factory.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/flv1Encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/flv1EncoderOptions.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/h263Encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/h263EncoderOptions.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mjpegEncoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg1Encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg1EncoderOptions.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg2Encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg2EncoderOptions.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg4aspEncoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg4aspEncoderOptions.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/encoder.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Options.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Options.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/cpu_accel.cc
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/feedframe.cc
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/global.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/mpeg2enc.cc
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/mpeg2enc_if.cc
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/mpeg2setup.cc
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/putseq.cc
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/ratectl.cc
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/readpic.cc
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264CustomMatrixDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableDelegate.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableModel.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidCustomMatrixDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/xvidOptions.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/common/pluginOptions/PluginOptions.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/common/xvidRateCtl/xvidRateCtl.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/common/xvidRateCtl/xvidRateCtlVbv.cpp
Log:
[vidEnc] clean up source code of various video encoder plugins

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factory.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factory.h	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factory.h	2010-04-06 19:22:30 UTC (rev 6082)
@@ -140,7 +140,7 @@
 public:
 	                diaElemSliderBase() : diaElem(ELEM_SLIDER) {}
   virtual           ~diaElemSliderBase() {};
-  virtual uint8_t   setDigits(uint32_t digits) { this->digits = digits; }
+  virtual void   setDigits(uint32_t digits) { this->digits = digits; }
 };
 
 typedef diaElem *CREATE_USLIDER_T(uint32_t *value,const char *toggleTitle, uint32_t min,uint32_t max,uint32_t incr , const char *tip);
@@ -155,7 +155,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
-  uint8_t   setDigits(uint32_t digits) ;
+  void   setDigits(uint32_t digits) ;
   int getRequiredLayout(void);
   void updateMe(void);
 };
@@ -171,7 +171,7 @@
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
-  uint8_t   setDigits(uint32_t digits) ;
+  void   setDigits(uint32_t digits) ;
   int getRequiredLayout(void);
   void updateMe(void);
 };

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/src/DIA_factory.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/src/DIA_factory.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/src/DIA_factory.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -528,7 +528,7 @@
 		ADM_assert(internalPointer); 
 		internalPointer->enable(onoff); 
 	}
-uint8_t   diaElemUSlider::setDigits(uint32_t digits)
+void   diaElemUSlider::setDigits(uint32_t digits)
 {
 	diaElemSliderBase *cast=(diaElemSliderBase *)internalPointer;
 			cast->setDigits(digits);	
@@ -553,7 +553,7 @@
 		ADM_assert(internalPointer); 
 		internalPointer->enable(onoff); 
 	}
-uint8_t   diaElemSlider::setDigits(uint32_t digits)
+void   diaElemSlider::setDigits(uint32_t digits)
 {
 	diaElemSliderBase *cast=(diaElemSliderBase *)internalPointer;
 			cast->setDigits(digits);	

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/encoder.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/encoder.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -494,7 +494,7 @@
 	printf("dark_masking: %f\n", _context->dark_masking);
 	printf("idct_algo: %d\n", _context->idct_algo);
 	printf("slice_count: %d\n", _context->slice_count);
-	printf("*slice_offset: %d\n", _context->slice_offset);
+	printf("slice_offset: %p\n", _context->slice_offset);
 	printf("error_concealment: %d\n", _context->error_concealment);
 	printf("dsp_mask: %d\n", _context->dsp_mask);
 	printf("bits_per_coded_sample: %d\n", _context->bits_per_coded_sample);

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/flv1Encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/flv1Encoder.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/flv1Encoder.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -176,7 +176,7 @@
 		}
 	}
 
-	return configType == CONFIG_MENU_CUSTOM | !failure;
+	return (configType == CONFIG_MENU_CUSTOM) | !failure;
 }
 
 char *serializeConfig(void)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/flv1EncoderOptions.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/flv1EncoderOptions.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/flv1EncoderOptions.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -56,7 +56,6 @@
 {
 	const int bufferSize = 100;
 	xmlChar xmlBuffer[bufferSize + 1];
-	xmlNodePtr xmlNodeChild, xmlNodeChild2;
 
 	xmlNodeRoot = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)getOptionsTagRoot(), NULL);
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"gopSize", number2String(xmlBuffer, bufferSize, getGopSize()));

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/h263Encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/h263Encoder.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/h263Encoder.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -387,7 +387,7 @@
 		}
 	}
 
-	return configType == CONFIG_MENU_CUSTOM | !failure;
+	return (configType == CONFIG_MENU_CUSTOM) | !failure;
 }
 
 char *serializeConfig(void)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/h263EncoderOptions.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/h263EncoderOptions.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/h263EncoderOptions.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -195,7 +195,6 @@
 {
 	const int bufferSize = 100;
 	xmlChar xmlBuffer[bufferSize + 1];
-	xmlNodePtr xmlNodeChild, xmlNodeChild2;
 
 	xmlNodeRoot = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)getOptionsTagRoot(), NULL);
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mjpegEncoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mjpegEncoder.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mjpegEncoder.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -166,7 +166,7 @@
 		}
 	}
 
-	return configType == CONFIG_MENU_CUSTOM | !failure;
+	return (configType == CONFIG_MENU_CUSTOM) | !failure;
 }
 
 char *serializeConfig(void)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg1Encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg1Encoder.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg1Encoder.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -366,7 +366,7 @@
 		}
 	}
 
-	return configType == CONFIG_MENU_CUSTOM | !failure;
+	return (configType == CONFIG_MENU_CUSTOM) | !failure;
 }
 
 char *serializeConfig(void)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg1EncoderOptions.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg1EncoderOptions.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg1EncoderOptions.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -140,7 +140,6 @@
 {
 	const int bufferSize = 100;
 	xmlChar xmlBuffer[bufferSize + 1];
-	xmlNodePtr xmlNodeChild, xmlNodeChild2;
 
 	xmlNodeRoot = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)getOptionsTagRoot(), NULL);
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"minBitrate", number2String(xmlBuffer, bufferSize, getMinBitrate()));

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg2Encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg2Encoder.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg2Encoder.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -392,7 +392,7 @@
 		}
 	}
 
-	return configType == CONFIG_MENU_CUSTOM | !failure;
+	return (configType == CONFIG_MENU_CUSTOM) | !failure;
 }
 
 char *serializeConfig(void)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg2EncoderOptions.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg2EncoderOptions.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg2EncoderOptions.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -140,7 +140,6 @@
 {
 	const int bufferSize = 100;
 	xmlChar xmlBuffer[bufferSize + 1];
-	xmlNodePtr xmlNodeChild, xmlNodeChild2;
 
 	xmlNodeRoot = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)getOptionsTagRoot(), NULL);
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"minBitrate", number2String(xmlBuffer, bufferSize, getMinBitrate()));

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg4aspEncoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg4aspEncoder.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg4aspEncoder.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -387,7 +387,7 @@
 		}
 	}
 
-	return configType == CONFIG_MENU_CUSTOM | !failure;
+	return (configType == CONFIG_MENU_CUSTOM) | !failure;
 }
 
 char *serializeConfig(void)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg4aspEncoderOptions.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg4aspEncoderOptions.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg4aspEncoderOptions.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -195,7 +195,6 @@
 {
 	const int bufferSize = 100;
 	xmlChar xmlBuffer[bufferSize + 1];
-	xmlNodePtr xmlNodeChild, xmlNodeChild2;
 
 	xmlNodeRoot = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)getOptionsTagRoot(), NULL);
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/encoder.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/encoder.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -203,7 +203,7 @@
 	_fpsDen = properties->fpsDen;
 
 	_frameCount = properties->frameCount;
-	_bufferSize = (properties->width * properties->height) + 2 * ((properties->width + 1 >> 1) * (properties->height + 1 >> 1));
+	_bufferSize = (properties->width * properties->height) + 2 * (((properties->width + 1) >> 1) * ((properties->height + 1) >> 1));
 	_buffer = new uint8_t[_bufferSize];
 	_xvidRc = NULL;
 
@@ -277,7 +277,7 @@
 
 				d *= 1000.;
 				d /= (_fpsNum * 1000) / _fpsDen;   // D is a duration in second
-				d *= bitrate;   // * bitrate = total bits
+				d *= encodeModeParameter;   // * bitrate = total bits
 				d /= 8;   // Byte
 				d /= 1024 * 1024;   // MB
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/encoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/encoder.h	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/encoder.h	2010-04-06 19:22:30 UTC (rev 6082)
@@ -47,7 +47,7 @@
 
 		int getFrameType(int flags);
 		unsigned int calculateBitrate(unsigned int fpsNum, unsigned int fpsDen, unsigned int frameCount, unsigned int sizeInMb);
-		virtual int initParameters(int *encodeModeParameter, int *maxBitrate, int *vbv) = 0;
+		virtual void initParameters(int *encodeModeParameter, int *maxBitrate, int *vbv) = 0;
 
 	public:
 		virtual ~Mpeg2encEncoder(void);

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -179,7 +179,7 @@
 		return ADM_VIDENC_ERR_FAILED;
 }
 
-int Mpeg1Encoder::initParameters(int *encodeModeParameter, int *maxBitrate, int *vbv)
+void Mpeg1Encoder::initParameters(int *encodeModeParameter, int *maxBitrate, int *vbv)
 {
 	_param.fieldenc = 0;
 	_param.format = MPEG_FORMAT_VCD;

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.h	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Encoder.h	2010-04-06 19:22:30 UTC (rev 6082)
@@ -42,7 +42,7 @@
 		int _bufferSize;
 		uint8_t *_buffer;
 
-		int initParameters(int *encodeModeParameter, int *maxBitrate, int *vbv);
+		void initParameters(int *encodeModeParameter, int *maxBitrate, int *vbv);
 
 	public:
 		Mpeg1Encoder(void);

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Options.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg1Options.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -58,7 +58,6 @@
 {
 	const int bufferSize = 100;
 	xmlChar xmlBuffer[bufferSize + 1];
-	xmlNodePtr xmlNodeChild, xmlNodeChild2;
 
 	xmlNodeRoot = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)getOptionsTagRoot(), NULL);
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"fileSplit", number2String(xmlBuffer, bufferSize, getFileSplit()));

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -222,7 +222,7 @@
 		}
 	}
 
-	return configType == CONFIG_MENU_CUSTOM | !failure;
+	return (configType == CONFIG_MENU_CUSTOM) | !failure;
 }
 
 char *serializeConfig(void)
@@ -280,7 +280,7 @@
 		return ADM_VIDENC_ERR_FAILED;
 }
 
-int Mpeg2Encoder::initParameters(int *encodeModeParameter, int *maxBitrate, int *vbv)
+void Mpeg2Encoder::initParameters(int *encodeModeParameter, int *maxBitrate, int *vbv)
 {
 	switch (_options.getMatrix())
 	{

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.h	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Encoder.h	2010-04-06 19:22:30 UTC (rev 6082)
@@ -44,7 +44,7 @@
 		uint8_t *_buffer;
 
 		void updateEncodeProperties(vidEncOptions *encodeOptions);
-		int initParameters(int *encodeModeParameter, int *maxBitrate, int *vbv);
+		void initParameters(int *encodeModeParameter, int *maxBitrate, int *vbv);
 
 	public:
 		Mpeg2Encoder(void);

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Options.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2Options.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -117,7 +117,6 @@
 {
 	const int bufferSize = 100;
 	xmlChar xmlBuffer[bufferSize + 1];
-	xmlNodePtr xmlNodeChild, xmlNodeChild2;
 
 	xmlNodeRoot = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)getOptionsTagRoot(), NULL);
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"maxBitrate", number2String(xmlBuffer, bufferSize, getMaxBitrate()));

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/cpu_accel.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/cpu_accel.cc	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/cpu_accel.cc	2010-04-06 19:22:30 UTC (rev 6082)
@@ -43,8 +43,6 @@
 
 static int x86_accel (void)
 {
-   int32_t eax, ebx, ecx, edx;
-   int32_t AMD;
    int32_t caps=0;
 
    if(CpuCaps::hasMMX()) caps |=ACCEL_X86_MMX;

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/feedframe.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/feedframe.cc	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/feedframe.cc	2010-04-06 19:22:30 UTC (rev 6082)
@@ -121,7 +121,7 @@
 }
 void feedOneFrame(char *y, char *u,char *vv)
 {
-	int n,v,h,i;
+	int n,v,h;
       	n = frames_read % frame_buffer_size;
 
       	v = opt->vertical_size;

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/global.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/global.h	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/global.h	2010-04-06 19:22:30 UTC (rev 6082)
@@ -149,9 +149,9 @@
 #define PUSH
 
 EXTERN void feedframe_buffer(int num_frame);
-#warning duplicate define -> bad!
-#define PREFILL 6
 
+#define MPEG2ENC_PREFILL 6
+
 // to be easily free-ed
 EXTERN int *lum_mean
 #ifdef GLOBAL

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/mpeg2enc.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/mpeg2enc.cc	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/mpeg2enc.cc	2010-04-06 19:22:30 UTC (rev 6082)
@@ -559,7 +559,7 @@
 	
 		fedPictures++;
 	
-		if(fedPictures<PREFILL) continue;
+		if(fedPictures<MPEG2ENC_PREFILL) continue;
 
 		printf(">> %d / 100 \n",i);
 		putseq_next();

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/mpeg2enc_if.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/mpeg2enc_if.cc	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/mpeg2enc_if.cc	2010-04-06 19:22:30 UTC (rev 6082)
@@ -300,7 +300,7 @@
 
 		fedPictures++;
 
-		if(fedPictures<PREFILL)
+		if(fedPictures<MPEG2ENC_PREFILL)
 		{
 			*size=mpeg2enc_buffer-(unsigned char *)out;
 			*quant=2;
@@ -330,7 +330,6 @@
 */
 int  mpeg_cleanup( void )
 {
-int n,i;
 	if(!frame_buffers)
 	{
 		printf("Trying to clean already cleaned frame_buffers!!!\n");

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/mpeg2setup.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/mpeg2setup.cc	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/mpeg2setup.cc	2010-04-06 19:22:30 UTC (rev 6082)
@@ -251,7 +251,7 @@
 		if( param->quant == 0 )
 			param->quant = 8;
 		param->seq_hdr_every_gop = 1;
-		printf("Br: %ld\n",param->bitrate);
+		printf("Br: %d\n",param->bitrate);
 		break;
 	}
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/putseq.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/putseq.cc	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/putseq.cc	2010-04-06 19:22:30 UTC (rev 6082)
@@ -811,7 +811,7 @@
 
 volatile static pict_data_ptr picture_to_encode;
 
-
+#if 0
 static void *parencodeworker(void *start_arg)
 {
 	pict_data_ptr picture;
@@ -909,8 +909,8 @@
 
 	return NULL;
 }
+#endif
 
-
 static void parencodepict( Picture *picture )
 {
 
@@ -1062,7 +1062,7 @@
         bits_after_mux = (uint64_t)((frame_periods / opt->frame_rate) *
                                     (ctl->nonvid_bit_rate + opt->bit_rate));
 
-    mjpeg_info( "Guesstimated final muxed size = %lld\n", bits_after_mux/8 );
+    //mjpeg_info( "Guesstimated final muxed size = %lld\n", bits_after_mux/8 );
     /* END DEBUG */
 
 }
@@ -1138,7 +1138,7 @@
 	memset(&ss,0,sizeof(ss));	
 	ss.seq_split_length = ((int64_t)ctl->seq_length_limit)*(8*1024*1024);
 	ss.next_split_point = BITCOUNT_OFFSET + ss.seq_split_length;
-	mjpeg_debug( "Split len = %%llu", ss.seq_split_length );
+	//mjpeg_debug( "Split len = %%llu", ss.seq_split_length );
 
 	frame_num = 0;              /* Encoding number */
 
@@ -1241,7 +1241,7 @@
         bits_after_mux = (uint64_t)((frame_periods / opt->frame_rate) *
                                     (ctl->nonvid_bit_rate + opt->bit_rate));
 
-    mjpeg_info( "Guesstimated final muxed size = %lld\n", bits_after_mux/8 );
+    //mjpeg_info( "Guesstimated final muxed size = %lld\n", bits_after_mux/8 );
     /* END DEBUG */
 
     for(int i=0;i<B_PICS;i++)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/ratectl.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/ratectl.cc	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/ratectl.cc	2010-04-06 19:22:30 UTC (rev 6082)
@@ -355,7 +355,7 @@
 		if( undershoot_carry < 0 )
                 {
                         printf("Buffer %d buffer_size %d\n",buffer_safe,ctl->video_buffer_size);
-                        printf("Avg bitrate : %d  framerate %d\n",opt->bit_rate,ctl->decode_frame_rate);
+                        printf("Avg bitrate : %f  framerate %f\n",opt->bit_rate,ctl->decode_frame_rate);
 			mjpeg_error_exit1("Rate control can't cope with a video buffer smaller 4 frame intervals");
                 }
 		overshoot_gain =  opt->bit_rate / (ctl->video_buffer_size-buffer_safe);
@@ -841,7 +841,7 @@
 	bits_used += (bitcount()-prev_bitcount);
 	prev_bitcount = bitcount();
 	bits_transported += per_pict_bits;
-	mjpeg_debug( "TR=%llu USD=%llu ", bits_transported/8, bits_used/8);
+	//mjpeg_debug( "TR=%llu USD=%llu ", bits_transported/8, bits_used/8);
 	buffer_variation  = (int32_t)(bits_transported - bits_used);
 
 	if( buffer_variation > 0 )

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/readpic.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/readpic.cc	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/readpic.cc	2010-04-06 19:22:30 UTC (rev 6082)
@@ -88,7 +88,6 @@
 
 
 static volatile int frames_read = 0;
-static int last_frame = -1;
 
 
 /* Buffers for frame luminance means */

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -118,15 +118,14 @@
 		delete [] configGuiPath;
 	}
 
-	if (_loader->isAvailable())
-		if (_loader->showX264ConfigDialog(configParameters, properties, &_encodeOptions, &_options))
-		{
-			updateEncodeParameters(NULL);
+	if (_loader->isAvailable() && _loader->showX264ConfigDialog(configParameters, properties, &_encodeOptions, &_options))
+	{
+		updateEncodeParameters(NULL);
 
-			return 1;
-		}
-	else
-		return 0;
+		return 1;
+	}
+
+	return 0;
 }
 
 int x264Encoder::getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize)
@@ -190,7 +189,7 @@
 
 	_opened = true;
 	_currentPass = 0;
-	_bufferSize = (properties->width * properties->height) + 2 * ((properties->width + 1 >> 1) * (properties->height + 1 >> 1));
+	_bufferSize = (properties->width * properties->height) + 2 * (((properties->width + 1) >> 1) * ((properties->height + 1) >> 1));
 	_buffer = new uint8_t[_bufferSize];
 
 	memcpy(&_properties, properties, sizeof(vidEncVideoProperties));

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.h	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.h	2010-04-06 19:22:30 UTC (rev 6082)
@@ -90,7 +90,9 @@
 	int x264Encoder_getPassCount(void);
 	int x264Encoder_getCurrentPass(void);
 	int x264Encoder_open(vidEncVideoProperties *properties);
+	int x264Encoder_beginPass(vidEncPassParameters *passParameters);
+	int x264Encoder_encodeFrame(vidEncEncodeParameters *encodeParams);
+	int x264Encoder_finishPass(void);
 	void x264Encoder_close(void);
-	int x264Encoder_encodeFrame(vidEncEncodeParameters *encodeParams);
 #endif	// __cplusplus
 #endif	// encoder_h

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -215,14 +215,14 @@
 	gtk_widget_set_sensitive(WID(table8), toggled);
 }
 
-int signalReceiver(GtkObject* object, gpointer user_data)
+void signalReceiver(GtkObject* object, gpointer user_data)
 {
 	GtkWidget *dialog = (GtkWidget*)user_data;
 
 	if (object == GTK_OBJECT(WID(comboboxMode)))
 	{
 		int modeIndex = gtk_combo_box_get_active(GTK_COMBO_BOX(WID(comboboxMode)));
-		int encodeModeParameter;
+		int encodeModeParameter = 0;
 
 		switch (modeIndex)
 		{
@@ -249,7 +249,7 @@
 		updateDeblockingFilter(dialog);
 }
 
-int entryTarget_changed(GtkObject* object, gpointer user_data)
+void entryTarget_changed(GtkObject* object, gpointer user_data)
 {
 	GtkWidget *dialog = (GtkWidget*)user_data;
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.h	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.h	2010-04-06 19:22:30 UTC (rev 6082)
@@ -14,8 +14,8 @@
 static int getCurrentEncodeMode(GtkWidget *dialog);
 static void updateMode(GtkWidget *dialog, int encodeMode, int encodeModeParameter);
 static void updateDeblockingFilter(GtkWidget *dialog);
-static int signalReceiver(GtkObject* object, gpointer user_data);
-static int entryTarget_changed(GtkObject* object, gpointer user_data);
+static void signalReceiver(GtkObject* object, gpointer user_data);
+static void entryTarget_changed(GtkObject* object, gpointer user_data);
 static void loadOptions(GtkWidget *dialog, x264Options *options);
 static void saveOptions(GtkWidget *dialog, x264Options *options);
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -434,10 +434,12 @@
 void x264ConfigDialog::mbTreeCheckBox_toggled(bool checked)
 {
 	if (!disableGenericSlots && checked && !ui.aqVarianceCheckBox->isChecked())
+	{
 		if (GUI_Question(QT_TR_NOOP("Macroblock-Tree optimisation requires Variance Adaptive Quantisation to be enabled.  Variance Adaptive Quantisation will automatically be enabled.\n\nDo you wish to continue?")))
 			ui.aqVarianceCheckBox->setChecked(true);
 		else
 			ui.mbTreeCheckBox->setChecked(false);
+	}
 }
 #endif
 
@@ -480,20 +482,24 @@
 void x264ConfigDialog::cabacCheckBox_toggled(bool checked)
 {
 	if (!disableGenericSlots && !checked && ui.trellisCheckBox->isChecked())
+	{
 		if (GUI_Question(QT_TR_NOOP("Trellis optimisation isn't possible without CABAC coding enabled.  Trellis optimisation will automatically be disabled.\n\n Do you wish to continue?")))
 			ui.trellisCheckBox->setChecked(false);
 		else
 			ui.cabacCheckBox->setChecked(true);
+	}
 }
 
 // Analysis tab
 void x264ConfigDialog::trellisCheckBox_toggled(bool checked)
 {
 	if (!disableGenericSlots && checked && !ui.cabacCheckBox->isChecked())
+	{
 		if (GUI_Question(QT_TR_NOOP("Trellis optimisation requires CABAC coding to be enabled.  CABAC coding will automatically be enabled.\n\nDo you wish to continue?")))
 			ui.cabacCheckBox->setChecked(true);
 		else
 			ui.trellisCheckBox->setChecked(false);
+	}
 }
 
 void x264ConfigDialog::matrixCustomEditButton_pressed()
@@ -512,10 +518,12 @@
 void x264ConfigDialog::aqVarianceCheckBox_toggled(bool checked)
 {
 	if (!disableGenericSlots && !checked && ui.mbTreeCheckBox->isChecked())
+	{
 		if (GUI_Question(QT_TR_NOOP("Macroblock-Tree optimisation requires Variance Adaptive Quantisation to be enabled.  Macroblock-Tree optimisation will automatically be disabled.\n\nDo you wish to continue?")))
 			ui.mbTreeCheckBox->setChecked(false);
 		else
 			ui.aqVarianceCheckBox->setChecked(true);
+	}
 }
 #endif
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264CustomMatrixDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264CustomMatrixDialog.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264CustomMatrixDialog.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -47,6 +47,7 @@
 	uint8_t intra8x8Luma[64], inter8x8Luma[64];
 
 	if (FileSel_SelectRead(QT_TR_NOOP("Select Matrix File"), cqmFileName, 1023, NULL) && ADM_fileExist(cqmFileName))
+	{
 		if (x264_cqm_parse_file(cqmFileName, intra4x4Luma, intra4x4Chroma, inter4x4Luma, inter4x4Chroma, intra8x8Luma, inter8x8Luma) == 0)
 		{
 			setIntra4x4Luma(intra4x4Luma);
@@ -58,6 +59,7 @@
 		}
 		else
 			GUI_Error_HIG(QT_TR_NOOP("Read Error"), QT_TR_NOOP("Error reading custom matrix file."));
+	}
 }
 
 void x264CustomMatrixDialog::getMatrix(uint8_t* intra4x4Luma, uint8_t* intraChroma, uint8_t* inter4x4Luma, 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableDelegate.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableDelegate.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableDelegate.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -60,6 +60,8 @@
 
 			return spinBox;
 	}
+
+	return NULL;
 }
 
 void x264ZoneTableDelegate::setEditorData(QWidget *editor, const QModelIndex &index) const

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableModel.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableModel.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ZoneTableModel.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -168,6 +168,8 @@
 {
 	if (_zoneData.size())
 		return removeRows(0, _zoneData.size(), QModelIndex());
+
+	return false;
 }
 
 bool x264ZoneTableModel::setData(const QModelIndex &index, const QVariant &value, int role)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -150,14 +150,16 @@
 	}
 
 	if (_loader->isAvailable())
+	{
 		if (_loader->showXvidConfigDialog(configParameters, properties, &_encodeOptions, &_options))
 		{
 			updateEncodeParameters(NULL);
 
 			return 1;
 		}
-	else
-		return 0;
+	}
+
+	return 0;
 }
 
 int XvidEncoder::getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize)
@@ -221,7 +223,7 @@
 
 	_opened = true;
 	_currentPass = 0;
-	_bufferSize = (properties->width * properties->height) + 2 * ((properties->width + 1 >> 1) * (properties->height + 1 >> 1));
+	_bufferSize = (properties->width * properties->height) + 2 * (((properties->width + 1) >> 1) * ((properties->height + 1) >> 1));
 	_buffer = new uint8_t[_bufferSize];
 
 	memcpy(&_properties, properties, sizeof(vidEncVideoProperties));
@@ -393,6 +395,8 @@
 		xvid_encore(_xvid_enc_create.handle, XVID_ENC_DESTROY, NULL, NULL);
 		_xvid_enc_create.handle = NULL;
 	}
+
+	return ADM_VIDENC_ERR_SUCCESS;
 }
 
 void XvidEncoder::close(void)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.h	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.h	2010-04-06 19:22:30 UTC (rev 6082)
@@ -89,7 +89,9 @@
 	int XvidEncoder_getPassCount(void);
 	int XvidEncoder_getCurrentPass(void);
 	int XvidEncoder_open(vidEncVideoProperties *properties);
+	int XvidEncoder_beginPass(vidEncPassParameters *passParameters);
+	int XvidEncoder_encodeFrame(vidEncEncodeParameters *encodeParams);
+	int XvidEncoder_finishPass(void);
 	void XvidEncoder_close(void);
-	int XvidEncoder_encodeFrame(vidEncEncodeParameters *encodeParams);
 #endif	// __cplusplus
 #endif	// encoder_h

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -78,7 +78,6 @@
 
 _again:
 	int code = gtk_dialog_run(GTK_DIALOG(dialog));
-	int b;
 
 	if (code == XVID4_RESPONSE_EDIT_MATRIX)
 	{
@@ -437,7 +436,7 @@
 {
 	GtkWidget *dialog = (GtkWidget*)user_data;
 	int r = getRangeInMenu(WID(optionmenuType));
-	int encodeModeParameter;
+	int encodeModeParameter = 0;
 
 	switch (r)
 	{
@@ -458,7 +457,7 @@
 	return 0;
 }
 
-int entryEntry_changed(GtkObject* object, gpointer user_data)
+void entryEntry_changed(GtkObject* object, gpointer user_data)
 {
 	GtkWidget *dialog = (GtkWidget*)user_data;
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.h	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.h	2010-04-06 19:22:30 UTC (rev 6082)
@@ -18,6 +18,6 @@
 
 static int cb_mod(GtkObject *object, gpointer user_data);
 static int ch_par_asinput(GtkObject *object, gpointer user_data);
-static int entryEntry_changed(GtkObject* object, gpointer user_data);
+static void entryEntry_changed(GtkObject* object, gpointer user_data);
 
 #endif	// xvidConfigDialog_h

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidCustomMatrixDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidCustomMatrixDialog.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidCustomMatrixDialog.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -39,6 +39,7 @@
 	unsigned char intra8x8Luma[64], inter8x8Luma[64];
 
 	if (FileSel_SelectRead(QT_TR_NOOP("Select Matrix File"), cqmFileName, 1023, NULL) && ADM_fileExist(cqmFileName))
+	{
 		if (parseCqmFile(cqmFileName, intra8x8Luma, inter8x8Luma) == 0)
 		{
 			setIntra8x8Luma(intra8x8Luma);
@@ -46,6 +47,7 @@
 		}
 		else
 			GUI_Error_HIG(QT_TR_NOOP("Read Error"), QT_TR_NOOP("Error reading custom matrix file."));
+	}
 }
 
 bool XvidCustomMatrixDialog::parseCqmFile(const char cqmFileName[1024], unsigned char intra8x8Luma[64], unsigned char inter8x8Luma[64])

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/xvidOptions.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/xvidOptions.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/xvidOptions.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -730,7 +730,7 @@
 {
 	const int bufferSize = 100;
 	xmlChar xmlBuffer[bufferSize + 1];
-	xmlNodePtr xmlNodeChild, xmlNodeChild2;
+	xmlNodePtr xmlNodeChild;
 
 	xmlNodeRoot = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)getOptionsTagRoot(), NULL);
 	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)"threads", number2String(xmlBuffer, bufferSize, getThreads()));

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/common/pluginOptions/PluginOptions.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/common/pluginOptions/PluginOptions.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/common/pluginOptions/PluginOptions.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -297,7 +297,7 @@
 
 	xmlDocPtr doc = xmlReadMemory(xml, strlen(xml), "options.xml", NULL, 0);
 
-	if (success = validateXml(doc, getSchemaFile()))
+	if ((success = validateXml(doc, getSchemaFile())))
 	{
 		xmlNode *xmlNodeRoot = xmlDocGetRootElement(doc);
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/common/xvidRateCtl/xvidRateCtl.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/common/xvidRateCtl/xvidRateCtl.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/common/xvidRateCtl/xvidRateCtl.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -410,7 +410,7 @@
 			*type=RF_B;
 			break;
 		default:
-			printf("f:%lu Type : %d\n",framenum,rc->stats[framenum].type);
+			printf("f:%u Type : %d\n",framenum,rc->stats[framenum].type);
 			assert(0);
 	}
 
@@ -441,7 +441,7 @@
 
 	//avg/=1000; //bps / kbps
 
-	printf("Xvidr: pass2 : %lu MB, avg:%d, nbframe:%lu\n",final_size,0,_nbFrames);
+	printf("Xvidr: pass2 : %u MB, avg:%d, nbframe:%u\n",final_size,0,_nbFrames);
 
 	create.version=FAKE_VERSION;
 	create.param=&data;	
@@ -1098,7 +1098,6 @@
 int
 rc_2pass2_after(rc_2pass2_t * rc, xvid_plg_data_t * data)
 {
-	const char frame_type[4] = { 'i', 'p', 'b', 's'};
 	twopass_stat_t * s = &rc->stats[data->frame_num];
 
 	/* Insufficent stats data */

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/common/xvidRateCtl/xvidRateCtlVbv.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/common/xvidRateCtl/xvidRateCtlVbv.cpp	2010-04-06 18:40:22 UTC (rev 6081)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/common/xvidRateCtl/xvidRateCtlVbv.cpp	2010-04-06 19:22:30 UTC (rev 6082)
@@ -54,9 +54,9 @@
 	_minbr=minbr*1000;
 	_vbvsize=vbvsize*1024;
 	printf("RC: Initializing vbv buffer \n");
-	printf("RC: with min br= %lu kbps\n",(minbr)/1000);
-	printf("RC:      max br= %lu kbps\n",(maxbr)/1000);
-	printf("Rc:      VBV   = %lu kB\n",_vbvsize/1024);
+	printf("RC: with min br= %u kbps\n",(minbr)/1000);
+	printf("RC:      max br= %u kbps\n",(maxbr)/1000);
+	printf("Rc:      VBV   = %u kB\n",_vbvsize/1024);
 
 	return 1;
 }
@@ -67,7 +67,7 @@
 }
 uint8_t ADM_newXvidRcVBV::startPass2( uint32_t size,uint32_t nbFrame )
 {
-	printf("Starting Xvid VBV with %lu frames, target size :%lu MB\n",nbFrame,size);
+	printf("Starting Xvid VBV with %u frames, target size :%u MB\n",nbFrame,size);
 	_nbFrames=nbFrame;
 	if(! rc->startPass2(size,nbFrame)) return 0;
 	// Built pass 1 stat file in memory
@@ -95,7 +95,7 @@
 		_compr[1][i]=1.0;
 		_compr[2][i]=1.0;
 	}
-	printf("Rc: Byte per image : %lu \n",_byte_per_image);
+	printf("Rc: Byte per image : %u \n",_byte_per_image);
 	return 1;
 }
 uint8_t ADM_newXvidRcVBV::logPass1(uint32_t qz, ADM_rframe ftype,uint32_t size)
@@ -110,7 +110,7 @@
 	_vbv_fullness+=_byte_per_image;
 	if(_vbv_fullness<size)
 	{
-		printf("VBV buffer underflow :frame %lu, underflow : %lu\n",_frame,size-_vbv_fullness);
+		printf("VBV buffer underflow :frame %u, underflow : %u\n",_frame,size-_vbv_fullness);
 	}
 	else
 	{
@@ -212,7 +212,7 @@
 
 		// Q increase ratio
 
-		float compI=0,compP=0,compB=0,comp=0,size,qr;
+		float compI=0,compP=0,compB=0,comp=0,size;
 		float ratioI,ratioP,ratioB,ratio;
 
 		for(uint32_t i=0;i<AVG_LOOKUP;i++)



From gruntster at mail.berlios.de  Tue Apr  6 21:27:20 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 6 Apr 2010 21:27:20 +0200
Subject: [Avidemux-svn-commit] r6083 - in
	branches/avidemux_2.5_branch_gruntster/platforms/windows:
	build_scripts/avidemux installer
Message-ID: <201004061927.o36JRK96012790@sheep.berlios.de>

Author: gruntster
Date: 2010-04-06 21:27:15 +0200 (Tue, 06 Apr 2010)
New Revision: 6083

Modified:
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Package Notes.xml
   branches/avidemux_2.5_branch_gruntster/platforms/windows/installer/avidemux.nsi
Log:
[win32] add mpeg2enc presets to installer

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Package Notes.xml
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Package Notes.xml	2010-04-06 19:22:30 UTC (rev 6082)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Package Notes.xml	2010-04-06 19:27:15 UTC (rev 6083)
@@ -1,5 +1,8 @@
 <?xml version="1.0"?>
 <log>
+  <buildentry revision="6064" date="2010-04-05">
+    <comment>Updated x264 to r1510.</comment>
+  </buildentry>
   <buildentry revision="6028" date="2010-03-27">
     <comment>Updated Avisynth Proxy GUI to version 2.11.</comment>
     <comment>Updated GLib to version 2.22.5-1.</comment>

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/installer/avidemux.nsi
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/installer/avidemux.nsi	2010-04-06 19:22:30 UTC (rev 6082)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/installer/avidemux.nsi	2010-04-06 19:27:15 UTC (rev 6083)
@@ -510,7 +510,11 @@
 			SetOutPath $INSTDIR\plugins\videoEncoder
 			${File} plugins\videoEncoder\libADM_vidEnc_mpeg2enc.dll
 			SetOutPath $INSTDIR\plugins\videoEncoder\mpeg2enc
-			${File} plugins\videoEncoder\avcodec\*.xsd
+			${File} plugins\videoEncoder\mpeg2enc\*.xsd
+			SetOutPath $INSTDIR\plugins\videoEncoder\mpeg2enc\mpeg-1
+			${File} plugins\videoEncoder\mpeg2enc\mpeg-1\*.xml
+			SetOutPath $INSTDIR\plugins\videoEncoder\mpeg2enc\mpeg-2
+			${File} plugins\videoEncoder\mpeg2enc\mpeg-2\*.xml
 		${MementoSectionEnd}
 		${MementoSection} "x264 (MPEG-4 AVC)" SecVidEncX264
 			SectionIn 1 2



From mean at mail.berlios.de  Wed Apr  7 09:39:21 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 7 Apr 2010 09:39:21 +0200
Subject: [Avidemux-svn-commit] r6084 - in
	branches/avidemux_2.6_branch_mean/avidemux_core: ADM_core/src
	ADM_ffmpeg/ffmpeg_config ADM_ffmpeg/libavutil
Message-ID: <201004070739.o377dLEW024840@sheep.berlios.de>

Author: mean
Date: 2010-04-07 09:39:21 +0200 (Wed, 07 Apr 2010)
New Revision: 6084

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_memsupport.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/config.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/ffconf.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/mem.c
Log:
[libav*] Do like 2.5 as far as av_malloc etc are concerned

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_memsupport.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_memsupport.cpp	2010-04-06 19:27:15 UTC (rev 6083)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_memsupport.cpp	2010-04-07 07:39:21 UTC (rev 6084)
@@ -189,6 +189,7 @@
 //********************************
 // lavcodec wrapper
 //********************************
+#if defined(WRAP_LAV_ALLOC)
 extern "C"
 {
 	void *av_malloc(unsigned int size)
@@ -229,7 +230,7 @@
 		return ptr;
 	}
 }
-
+#endif
 /**
  * av_realloc semantics (same as glibc): if ptr is NULL and size > 0,
  * identical to malloc(size). If size is zero, it is identical to
@@ -288,6 +289,7 @@
 #endif
 }
 
+#if defined(WRAP_LAV_ALLOC)
 void *av_realloc(void *ptr, unsigned int newsize)
 {
 	return ADM_realloc(ptr,newsize);
@@ -299,7 +301,7 @@
 	if(ptr)
 		ADM_dealloc(ptr);
 }
-
+#endif
 char *ADM_strdup(const char *in)
 {
 	if(!in)
@@ -371,6 +373,7 @@
 
 	return nalloc;
 }
+#if defined(WRAP_LAV_ALLOC)
 
 extern "C"
 {
@@ -425,4 +428,5 @@
 		operator delete(ptr, (char*)_DEBUG_NEW_CALLER_ADDRESS, 0);
 }
 #endif
+#endif
 // EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/config.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/config.h	2010-04-06 19:27:15 UTC (rev 6083)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/config.h	2010-04-07 07:39:21 UTC (rev 6084)
@@ -521,6 +521,9 @@
 #define HAVE_ROUND 1
 #define HAVE_ROUNDF 1
 #define HAVE_THREADS 1
+#ifndef HAVE_MALLOC_H 
+#define HAVE_MALLOC_H 1
+#endif 
 #define RUNTIME_CPUDETECT 1
 #define CONFIG_RUNTIME_CPUDETECT 1
 #if defined( __MINGW32__) || defined(__APPLE__)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/ffconf.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/ffconf.c	2010-04-06 19:27:15 UTC (rev 6083)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/ffconf.c	2010-04-07 07:39:21 UTC (rev 6084)
@@ -597,6 +597,9 @@
 	printf("#define HAVE_ROUND 1\n");
 	printf("#define HAVE_ROUNDF 1\n");
 	printf("#define HAVE_THREADS 1\n");
+        printf("#ifndef HAVE_MALLOC_H \n");
+        printf("#define HAVE_MALLOC_H 1\n");
+        printf("#endif \n");
 	printf("#define RUNTIME_CPUDETECT 1\n");
 	printf("#define CONFIG_RUNTIME_CPUDETECT 1\n");
     printf("#if defined( __MINGW32__) || defined(__APPLE__)\n");

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/CMakeLists.txt	2010-04-06 19:27:15 UTC (rev 6083)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/CMakeLists.txt	2010-04-07 07:39:21 UTC (rev 6084)
@@ -23,6 +23,7 @@
 avstring.c
 tree.c
 lfg.c
+mem.c
 )
 
 ADD_LIBRARY(${ADM_LIB} SHARED ${${ADM_LIB}_SRCS})

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/mem.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/mem.c	2010-04-06 19:27:15 UTC (rev 6083)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/mem.c	2010-04-07 07:39:21 UTC (rev 6084)
@@ -29,7 +29,7 @@
 #include <limits.h>
 #include <stdlib.h>
 #include <string.h>
-#if HAVE_MALLOC_H
+#ifdef HAVE_MALLOC_H
 #include <malloc.h>
 #endif
 



From mean at mail.berlios.de  Wed Apr  7 17:34:39 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 7 Apr 2010 17:34:39 +0200
Subject: [Avidemux-svn-commit] r6085 - in
	branches/avidemux_2.6_branch_mean/avidemux: . common
	common/ADM_render qt4/ADM_userInterfaces/ADM_gui
Message-ID: <201004071534.o37FYdqC029967@sheep.berlios.de>

Author: mean
Date: 2010-04-07 17:34:38 +0200 (Wed, 07 Apr 2010)
New Revision: 6085

Added:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_previewNavigate.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_simpleRender.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_simpleRender.h
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_accelRender.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.h
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
   branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/T_preview.cpp
Log:
[Render] Simplification + merge colorconvert and scale in one operation

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp	2010-04-07 07:39:21 UTC (rev 6084)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp	2010-04-07 15:34:38 UTC (rev 6085)
@@ -34,51 +34,35 @@
 #include "config.h"
 
 #include "ADM_default.h"
-
-
 #include "ADM_editor/ADM_edit.hxx"
-//#include "ADM_videoFilter.h"
-//#include "ADM_videoFilter_internal.h"
 #include "ADM_render/GUI_render.h"
-
-#include "ADM_debugID.h"
-#define MODULE_NAME MODULE_PREVIEW
-#include "ADM_debug.h"
-#include "ADM_ffmpeg/libswscale/ADM_mp.h"
 #include "ADM_commonUI/GUI_ui.h"
 #include "ADM_preview.h"
-#define MAX(a,b) ( (a)>(b) ? (a) : (b) )
+
 #include "DIA_coreToolkit.h"
-extern void                 UI_setCurrentTime(uint64_t curTime);
 
+
 static void                 previewBlit(ADMImage *from,ADMImage *to,uint32_t startx,uint32_t starty);
 static ADM_PREVIEW_MODE     previewMode=ADM_PREVIEW_NONE;
 
-static uint32_t             defered_display=0;  /* When 1, it means we are in playback mode */
-static uint32_t             playbackOffset=0;   /* in playback mode, frame 0 = playbackOffset compared to real beginning of the file */
+static bool                 defered_display=false;  /* When 1, it means we are in playback mode */
 static renderZoom           zoom=ZOOM_1_1;
 static ADMImage             *resized=NULL;
 static ADMImageResizer      *resizer=NULL;
-static ADMImage             *original=NULL;
 
+
 /*************************************/
-static ADMImage *rdrImage=NULL; /* Unprocessed image */
-static ADMImage *previewImage;  /* Processed image if any */
+ADMImage *admPreview::rdrImage=NULL; /* Unprocessed image */
 
 static uint32_t  rdrPhysicalW=0;  /* W*H of the INPUT window */
 static uint32_t  rdrPhysicalH=0;
 
-static uint32_t  rdrWindowWUnzoomed=0;  /* W*H of the output window WITHOUT zoom */
-static uint32_t  rdrWindowHUnzoomed=0;
 
-static uint32_t  rdrWindowWZoomed=0;    /* Same but with zoom */
-static uint32_t  rdrWindowHZoomed=0;
 
-
 /*************************************/
 extern ADM_Composer *video_body;
 /**
-
+    \fn getBuffer
 */
 ADMImage *admPreview::getBuffer(void)
 {
@@ -97,12 +81,7 @@
   rdrImage=new ADMImage(w,h);
   rdrPhysicalW=w;
   rdrPhysicalH=h;
-  
-  rdrWindowWZoomed=rdrWindowWUnzoomed=w;
-  rdrWindowHZoomed=rdrWindowHUnzoomed=h;
-  
-  renderResize(w,h,w,h);
-  
+  renderDisplayResize(rdrPhysicalW,rdrPhysicalH,zoom);
 }
 
 
@@ -117,13 +96,16 @@
 {
   return previewMode; 
 }
-
+/**
+    \fn changePreviewZoom
+*/
 void changePreviewZoom(renderZoom nzoom)
 {
     admPreview::stop();
+    ADM_info("Preview :: Change zoom %d->%d\n",zoom,nzoom);
     zoom=nzoom;
+    renderDisplayResize(rdrPhysicalW,rdrPhysicalH,zoom);
     admPreview::start();
-  
 }
 
 /**
@@ -143,22 +125,19 @@
       \brief Enable or disable defered display. Used by playback mode to have smooth output
 
 */
-void admPreview::deferDisplay(uint32_t onoff,uint32_t startat)
+void admPreview::deferDisplay(bool onoff)
 {
       
-      if(onoff)
+      if(true==onoff)
       {
         renderStartPlaying();
         defered_display=1;
-        playbackOffset=startat;
       }
       else
       {
         renderStopPlaying();
         defered_display=0;
-        playbackOffset=0;
       }
-  
 }
 /**
       \fn admPreview::start
@@ -168,71 +147,7 @@
 
 void 	admPreview::start( void )
 {
-            aprintf("--killing\n");
-            renderLock();
-            ADM_assert(!original);
-            switch(previewMode)
-            {
-                  /* no break here, not a mistake */
-              case  ADM_PREVIEW_NONE:
-              case  ADM_PREVIEW_OUTPUT:
-              
-                  rdrWindowWUnzoomed=rdrPhysicalW;
-                  rdrWindowHUnzoomed=rdrPhysicalH;
-                  break;
-#if 0
-              case  ADM_PREVIEW_OUTPUT:
-                  rdrWindowWUnzoomed=preview->getInfo()->width;
-                  rdrWindowHUnzoomed=preview->getInfo()->height;
-                  break;
-
-              case  ADM_PREVIEW_SIDE:
-              {
-                  rdrWindowWUnzoomed=rdrPhysicalW+preview->getInfo()->width;
-                  rdrWindowHUnzoomed=MAX(rdrPhysicalH,preview->getInfo()->height);
-                  original=new ADMImage(rdrWindowWUnzoomed,rdrWindowHUnzoomed);
-                  break;
-              }
-              case  ADM_PREVIEW_TOP:
-              {
-                  
-                  rdrWindowWUnzoomed=MAX(rdrPhysicalW,preview->getInfo()->width);
-                  rdrWindowHUnzoomed=rdrPhysicalH+preview->getInfo()->height;
-                  original=new ADMImage(rdrWindowWUnzoomed,rdrWindowHUnzoomed);
-                  break;
-              }
-#endif
-              default: ADM_assert(0);
-            }
-        if(zoom!=ZOOM_1_1)
-        {
-            int mul;
-            switch(zoom)
-            {
-                    case ZOOM_1_4: mul=1;break;
-                    case ZOOM_1_2: mul=2;break;
-                    case ZOOM_1_1: mul=4;break;
-                    case ZOOM_2:   mul=8;break;
-                    case ZOOM_4:   mul=16;break;
-                    default : ADM_assert(0);
-    
-            }
-            rdrWindowWZoomed=(rdrWindowWUnzoomed*mul+3)/4;
-            rdrWindowHZoomed=(rdrWindowHUnzoomed*mul+3)/4;
-            
-    
-            if(rdrWindowWZoomed&1) rdrWindowWZoomed++;
-            if(rdrWindowHZoomed&1) rdrWindowHZoomed++;
-            ADM_assert(!resized);
-            resized=new ADMImage(rdrWindowWZoomed,rdrWindowHZoomed);
-            ADM_assert(!resizer);
-            resizer=new  ADMImageResizer(rdrWindowWUnzoomed,rdrWindowHUnzoomed,rdrWindowWZoomed,rdrWindowHZoomed);
-            renderResize(rdrWindowWZoomed,rdrWindowHZoomed,rdrWindowWUnzoomed,rdrWindowHUnzoomed);
-        }else
-        {
-             renderResize(rdrWindowWUnzoomed,rdrWindowHUnzoomed,rdrWindowWUnzoomed,rdrWindowHUnzoomed);
-        }
-        renderUnlock();
+            ADM_info("admPreview, killing\n");
 }
 /**
       \fn admPreview::stop
@@ -241,431 +156,12 @@
 
 void admPreview::stop( void )
 {
-  renderLock();
-#if 0
-      if(previewMode==ADM_PREVIEW_SEPARATE)
-                DIA_previewEnd();
-      if(  previewMode==ADM_PREVIEW_SIDE || previewMode==ADM_PREVIEW_TOP)
-      {
-        ADM_assert(original);
-        delete original;
-        original=NULL; 
-      }
-#endif
-      renderResize(rdrWindowWUnzoomed,rdrWindowHUnzoomed,rdrWindowWUnzoomed,rdrWindowHUnzoomed);
-      if(previewImage)
-      {
-        delete  previewImage; 
-        previewImage=NULL;
-      }
-      if(zoom!=ZOOM_1_1)
-      {
-          
-          
-          if(resized) delete resized;
-          if(resizer) delete resizer;
-          resized=NULL;
-          resizer=NULL;
-      }
+      renderLock();
+     
       renderUnlock();
 }
-/**
-    \fn getCurrentPts
-    \brief returns the PTS in us of the last displayed frame
-*/
-uint64_t admPreview::getCurrentPts(void)
-{
-        if(rdrImage) return rdrImage->Pts;
 
-}
-
 /**
-      \fn admPreview::update
-      \brief display data associated with framenum image
-      @param image : current main image (input)
-      @param framenum, framenumber
-*/
-#if 0 // OBSOLETE
-uint8_t admPreview::seekToIntra(uint32_t frame)
-{
-    if(!video_body->GoToIntra(frame)) 
-    {
-        printf("[PReview::seekToIntra] GoToIntra %u failed\n",frame);
-        return 0;
-    }
-    return samePicture();
-
-}
-#endif
-
-/**
-      \fn admPreview::seekToTime
-      \brief Seek to any given frame
-      
-      @param timeframe Time of the image 
-*/
-
-bool admPreview::seekToTime(uint64_t timeframe)
-{
-    if(!video_body->goToTimeVideo(timeframe)) 
-    {
-        ADM_warning(" seeking for frame at %"LLU" ms failed\n",timeframe/1000LL);
-        return false;
-    }
-    return samePicture();
-}
-/**
-      \fn admPreview::seekToIntraPts
-      \brief Seek to intra at PTS given as arg
-      
-      @param timeframe Time of the image 
-*/
-
-bool admPreview::seekToIntraPts(uint64_t timeframe)
-{
-    if(!video_body->goToIntraTimeVideo(timeframe)) 
-    {
-        ADM_warning(" seeking for frame at %"LLU" ms failed\n",timeframe/1000LL);
-        return false;
-    }
-    return samePicture();
-}
-/**
-    \fn samePicture
-*/
-uint8_t admPreview::samePicture(void)
-{
-    if(!video_body->samePicture(rdrImage)) return false;
-    UI_setFrameType(  rdrImage->flags,rdrImage->_Qp);
-    if(zoom==ZOOM_1_1 || renderHasAccelZoom() )
-    {
-       if(!defered_display) 
-       {
-          renderUpdateImage(rdrImage->data,zoom);
-          
-        }
-    }else
-    {
-        ADM_assert(resizer);
-        ADM_assert(resized);
-        resizer->resize(rdrImage,resized);
-        if(!defered_display) 
-          renderUpdateImage(resized->data,ZOOM_1_1);
-    }
-    return true;
-}
-/**
-      \fn admPreview::update
-      \brief display data associated with framenum image
-      @param image : current main image (input)
-      @param framenum, framenumber
-*/
-
-uint8_t admPreview::nextPicture(void)
-{
-    uint32_t fl,len,flags;	
-
-    switch(previewMode)
-    {
-      case ADM_PREVIEW_NONE:
-       {
-#if 0
-        if( !video_body->getUncompressedFrame(framenum+playbackOffset,rdrImage,&flags))
-        {
-          return 0; 
-        }
-#else
-
-        if(!video_body->nextPicture(rdrImage)) return 0;
-#endif
-            UI_setFrameType(  rdrImage->flags,rdrImage->_Qp);
-
-            if(zoom==ZOOM_1_1 || renderHasAccelZoom() )
-            {
-               if(!defered_display) 
-               {
-                  renderUpdateImage(rdrImage->data,zoom);
-                  
-                }
-            }else
-            {
-                ADM_assert(resizer);
-                ADM_assert(resized);
-                resizer->resize(rdrImage,resized);
-                if(!defered_display) 
-                  renderUpdateImage(resized->data,ZOOM_1_1);
-            }
-           // printf("[admPreview] PTs: %llu\n",rdrImage->Pts);
-        }
-        break;
-#if 0
-      case ADM_PREVIEW_OUTPUT:
-            if(framenum<=preview->getInfo()->nb_frames-1)
-                  {
-                          if(!preview->getFrameNumberNoAlloc(framenum,&len,previewImage,&fl)) return 0;
-                          if(zoom==ZOOM_1_1 || renderHasAccelZoom() )
-                          {
-                            if(!defered_display) renderUpdateImage(previewImage->data,zoom);
-                          }
-                          else
-                          {
-                             resizer->resize(previewImage,resized);
-                             if(!defered_display) 
-                                  renderUpdateImage(resized->data,ZOOM_1_1);
-                          }
-                  }
-            break;
-      case ADM_PREVIEW_SEPARATE:
-            ADM_assert(preview);
-            ADM_assert(previewImage);
-
-              if( !video_body->getUncompressedFrame(framenum+playbackOffset,rdrImage,&flags))
-              {
-                  return 0; 
-              }
-              UI_setFrameType(  rdrImage->flags,rdrImage->_Qp);
-
-            if(zoom==ZOOM_1_1 || renderHasAccelZoom()  )
-            {
-              if(!defered_display) 
-				  renderUpdateImage(rdrImage->data,zoom);
-            }
-			else
-            {
-                ADM_assert(resizer);
-                ADM_assert(resized);
-                resizer->resize(rdrImage,resized);
-                if(!defered_display) 
-                  renderUpdateImage(resized->data,zoom);
-            }
-          if( DIA_previewStillAlive())
-          {
-                  aprintf("Preview: Ask for frame %lu\n",framenum);
-                  if(framenum<=preview->getInfo()->nb_frames-1)
-                  {
-                          preview->getFrameNumberNoAlloc(framenum,&len,previewImage,&fl);
-                          if(!defered_display) DIA_previewUpdate(previewImage->data);
-                  }
-          }
-          break;
-      case ADM_PREVIEW_SIDE:
-              ADM_assert(preview);
-              ADM_assert(previewImage);
-              ADM_assert(original);
-              
-              if( !video_body->getUncompressedFrame(framenum+playbackOffset,rdrImage,&flags))
-              {
-                  return 0; 
-              }
-              UI_setFrameType(  rdrImage->flags,rdrImage->_Qp);
-              previewBlit(rdrImage,original,0,0);
-              
-              if(preview->getFrameNumberNoAlloc(framenum,&len,previewImage,&fl))
-              {
-                previewBlit(previewImage,original,rdrPhysicalW,0);
-              }
-              else printf("Cannot get frame %u\n",framenum);
-              if(zoom==ZOOM_1_1  || renderHasAccelZoom() )
-              {
-                if(!defered_display)
-                  renderUpdateImage(original->data,zoom);
-              }else
-              {
-                resizer->resize(original,resized);
-                if(!defered_display) 
-                  renderUpdateImage(resized->data,ZOOM_1_1);
-              }
-              break;
-        
-      case ADM_PREVIEW_TOP:
-              ADM_assert(preview);
-              ADM_assert(previewImage);
-              ADM_assert(original);
-              
-              if( !video_body->getUncompressedFrame(framenum+playbackOffset,rdrImage,&flags))
-              {
-                  return 0; 
-              }
-              UI_setFrameType(  rdrImage->flags,rdrImage->_Qp);
-              previewBlit(rdrImage,original,0,0);
-              if(preview->getFrameNumberNoAlloc(framenum,&len,previewImage,&fl))
-              {
-                previewBlit(previewImage,original,0,rdrPhysicalH);
-              }
-              else printf("Cannot get frame %u\n",framenum);
-              if(zoom==ZOOM_1_1 || renderHasAccelZoom() )
-              {
-                if(!defered_display)
-                  renderUpdateImage(original->data,zoom);
-              }else
-              {
-                resizer->resize(original,resized);
-                if(!defered_display) 
-                  renderUpdateImage(resized->data,ZOOM_1_1);
-              }
-              break;
-#endif
-      default: ADM_assert(0);
-    }
-    return true;
-}
-
-/**
-      \fn admPreview::update
-      \brief display data associated with framenum image
-      @param image : current main image (input)
-      @param framenum, framenumber
-*/
-
-uint8_t admPreview::previousPicture(void)
-{
-    uint32_t fl,len,flags;	
-
-    switch(previewMode)
-    {
-      case ADM_PREVIEW_NONE:
-       {
-#if 0
-        if( !video_body->getUncompressedFrame(framenum+playbackOffset,rdrImage,&flags))
-        {
-          return 0; 
-        }
-#else
-
-        if(!video_body->previousPicture(rdrImage)) return 0;
-#endif
-            UI_setFrameType(  rdrImage->flags,rdrImage->_Qp);
-
-            if(zoom==ZOOM_1_1 || renderHasAccelZoom() )
-            {
-               if(!defered_display) 
-               {
-                  renderUpdateImage(rdrImage->data,zoom);
-                  
-                }
-            }else
-            {
-                ADM_assert(resizer);
-                ADM_assert(resized);
-                resizer->resize(rdrImage,resized);
-                if(!defered_display) 
-                  renderUpdateImage(resized->data,ZOOM_1_1);
-            }
-           // printf("[admPreview] PTs: %llu\n",rdrImage->Pts);
-        }
-        break;
-#if 0
-      case ADM_PREVIEW_OUTPUT:
-            if(framenum<=preview->getInfo()->nb_frames-1)
-                  {
-                          if(!preview->getFrameNumberNoAlloc(framenum,&len,previewImage,&fl)) return 0;
-                          if(zoom==ZOOM_1_1 || renderHasAccelZoom() )
-                          {
-                            if(!defered_display) renderUpdateImage(previewImage->data,zoom);
-                          }
-                          else
-                          {
-                             resizer->resize(previewImage,resized);
-                             if(!defered_display) 
-                                  renderUpdateImage(resized->data,ZOOM_1_1);
-                          }
-                  }
-            break;
-      case ADM_PREVIEW_SEPARATE:
-            ADM_assert(preview);
-            ADM_assert(previewImage);
-
-              if( !video_body->getUncompressedFrame(framenum+playbackOffset,rdrImage,&flags))
-              {
-                  return 0; 
-              }
-              UI_setFrameType(  rdrImage->flags,rdrImage->_Qp);
-
-            if(zoom==ZOOM_1_1 || renderHasAccelZoom()  )
-            {
-              if(!defered_display) 
-				  renderUpdateImage(rdrImage->data,zoom);
-            }
-			else
-            {
-                ADM_assert(resizer);
-                ADM_assert(resized);
-                resizer->resize(rdrImage,resized);
-                if(!defered_display) 
-                  renderUpdateImage(resized->data,zoom);
-            }
-          if( DIA_previewStillAlive())
-          {
-                  aprintf("Preview: Ask for frame %lu\n",framenum);
-                  if(framenum<=preview->getInfo()->nb_frames-1)
-                  {
-                          preview->getFrameNumberNoAlloc(framenum,&len,previewImage,&fl);
-                          if(!defered_display) DIA_previewUpdate(previewImage->data);
-                  }
-          }
-          break;
-      case ADM_PREVIEW_SIDE:
-              ADM_assert(preview);
-              ADM_assert(previewImage);
-              ADM_assert(original);
-              
-              if( !video_body->getUncompressedFrame(framenum+playbackOffset,rdrImage,&flags))
-              {
-                  return 0; 
-              }
-              UI_setFrameType(  rdrImage->flags,rdrImage->_Qp);
-              previewBlit(rdrImage,original,0,0);
-              
-              if(preview->getFrameNumberNoAlloc(framenum,&len,previewImage,&fl))
-              {
-                previewBlit(previewImage,original,rdrPhysicalW,0);
-              }
-              else printf("Cannot get frame %u\n",framenum);
-              if(zoom==ZOOM_1_1  || renderHasAccelZoom() )
-              {
-                if(!defered_display)
-                  renderUpdateImage(original->data,zoom);
-              }else
-              {
-                resizer->resize(original,resized);
-                if(!defered_display) 
-                  renderUpdateImage(resized->data,ZOOM_1_1);
-              }
-              break;
-        
-      case ADM_PREVIEW_TOP:
-              ADM_assert(preview);
-              ADM_assert(previewImage);
-              ADM_assert(original);
-              
-              if( !video_body->getUncompressedFrame(framenum+playbackOffset,rdrImage,&flags))
-              {
-                  return 0; 
-              }
-              UI_setFrameType(  rdrImage->flags,rdrImage->_Qp);
-              previewBlit(rdrImage,original,0,0);
-              if(preview->getFrameNumberNoAlloc(framenum,&len,previewImage,&fl))
-              {
-                previewBlit(previewImage,original,0,rdrPhysicalH);
-              }
-              else printf("Cannot get frame %u\n",framenum);
-              if(zoom==ZOOM_1_1 || renderHasAccelZoom() )
-              {
-                if(!defered_display)
-                  renderUpdateImage(original->data,zoom);
-              }else
-              {
-                resizer->resize(original,resized);
-                if(!defered_display) 
-                  renderUpdateImage(resized->data,ZOOM_1_1);
-              }
-              break;
-#endif
-      default: ADM_assert(0);
-    }
-    return true;
-}
-/**
       \fn previewBlit(ADMImage *from,ADMImage *to,uint32_t startx,uint32_t starty)
       \brief Blit "from" to "to" at position startx,starty
 */
@@ -690,52 +186,8 @@
     {
       case ADM_PREVIEW_NONE:
       case ADM_PREVIEW_OUTPUT:     
-           if(zoom==ZOOM_1_1 || renderHasAccelZoom() )
-            {
-                renderUpdateImage(rdrImage->data,zoom);
-            }else
-            {
-                ADM_assert(resized);
-                renderUpdateImage(resized->data,zoom);
-            }
+        renderUpdateImage(rdrImage);
         break;
-#if 0
-      case ADM_PREVIEW_OUTPUT:
-            if(zoom==ZOOM_1_1 || renderHasAccelZoom() )
-            {
-                renderUpdateImage(previewImage->data,zoom);
-            }else
-            {
-                ADM_assert(resized);
-                renderUpdateImage(resized->data,zoom);
-            }
-            break;
-
-      case ADM_PREVIEW_SEPARATE:
-            if(zoom==ZOOM_1_1 || renderHasAccelZoom()  )
-            {
-                renderUpdateImage(rdrImage->data,zoom);
-            }else{
-                ADM_assert(resized);
-                renderUpdateImage(resized->data,zoom);
-            }
-            if( DIA_previewStillAlive())
-            {
-                DIA_previewUpdate(previewImage->data);
-            }
-          break;
-      case ADM_PREVIEW_SIDE:
-      case ADM_PREVIEW_TOP:
-            if(zoom==ZOOM_1_1|| renderHasAccelZoom() )
-            {
-               renderUpdateImage(original->data,zoom);
-            }else
-            {
-              ADM_assert(resized);
-              renderUpdateImage(resized->data,zoom);
-            }
-              break;
-#endif
       default: ADM_assert(0);
     }
 }
@@ -761,66 +213,15 @@
 		delete rdrImage;
 		rdrImage = NULL;
 	}
-
-	if(original)
-    {
-		delete original;
-		original=NULL;
-	}
-
-	if(previewImage)
-	{
-		delete previewImage; 
-		previewImage=NULL;
-	}
 }
 /**
-    \fn nextKeyFrame
-
+    \fn updateImage
 */
-bool admPreview::nextKeyFrame(void)
+bool admPreview::updateImage(void)
 {
-    uint64_t pts=getCurrentPts();
-    ADM_info("Current PTS :%"LLD" ms\n",pts/1000LL);
-    if(false==video_body->getNKFramePTS(&pts))
-    {
-        ADM_warning("Cannot find next keyframe\n");
-        return false;
-    }
-    ADM_info("next kf PTS :%"LLD" ms\n",pts/1000LL);
-    return seekToIntraPts(pts);
+            UI_setFrameType(  rdrImage->flags,rdrImage->_Qp);
+            if(!defered_display) 
+                renderUpdateImage(rdrImage);                  
+            return true;
 }
-/**
-    \fn previousKeyFrame
-
-*/
-bool admPreview::previousKeyFrame(void)
-{
-    uint64_t pts=getCurrentPts();
-    ADM_info("Current PTS :%"LLD" ms\n",pts/1000LL);
-    if(false==video_body->getPKFramePTS(&pts))
-    {
-        ADM_warning("Cannot find previous keyframe\n");
-        return false;
-    }
-    ADM_info("next kf PTS :%"LLD" ms\n",pts/1000LL);
-    return seekToIntraPts(pts);
-}/**
-    \fn previousFrame
-
-*/
-bool admPreview::previousFrame(void)
-{
-    uint64_t pts=rdrImage->Pts;
-    ADMImage *tmpImage=NULL;
-    //tmpImage=video_body->seekAndGetImageBefore(pts);
-    if(!tmpImage)
-    {
-        GUI_Error_HIG("Seek","Cannot find previous frame");
-        return false;
-    }
-    rdrImage=tmpImage;
-    renderUpdateImage(rdrImage->data,zoom);
-    return true;
-}
 // EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h	2010-04-07 07:39:21 UTC (rev 6084)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.h	2010-04-07 15:34:38 UTC (rev 6085)
@@ -18,9 +18,13 @@
 ADM_PREVIEW_MODE  getPreviewMode(void);
 void             setPreviewMode(ADM_PREVIEW_MODE preview);
 void             changePreviewZoom(renderZoom nzoom);
-
+/**
+    class admPreview
+*/
 class admPreview
 {
+  protected:
+      static ADMImage *rdrImage;
   public:
       static uint8_t nextPicture(void);
       static uint8_t previousPicture(void);
@@ -30,7 +34,7 @@
       static void start(void);
       static void stop(void);
       static void setMainDimension(uint32_t, uint32_t );
-      static void deferDisplay(uint32_t onoff,uint32_t startat);
+      static void deferDisplay(bool onoff);
       static void displayNow(void);
       static void cleanUp(void);  
       static ADMImage *getBuffer(void);
@@ -39,5 +43,6 @@
       static bool previousKeyFrame(void);
       static bool previousFrame(void);
       static void destroy(void);
+      static bool updateImage(void);
 };
 #endif

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_previewNavigate.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_previewNavigate.cpp	2010-04-07 07:39:21 UTC (rev 6084)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_previewNavigate.cpp	2010-04-07 15:34:38 UTC (rev 6085)
@@ -0,0 +1,157 @@
+/***************************************************************************
+    
+    Handle preview mode
+    
+    It is displayed in 3 layers
+    
+    
+    Engine : Call setPreviewMode and amdPreview depending on the actions
+            previewMode is the **current** preview mode
+    
+    admPreview : 
+          Allocate/desallocate ressources
+          Build preview window
+          Call display properly to display it
+          
+    GUI_PreviewXXXX
+          UI toolkit to actually display the window
+          See GUI_ui.h to see them
+                 
+    
+    
+    copyright            : (C) 2007 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "config.h"
+
+#include "ADM_default.h"
+#include "ADM_editor/ADM_edit.hxx"
+#include "ADM_render/GUI_render.h"
+
+#include "ADM_debugID.h"
+#include "ADM_commonUI/GUI_ui.h"
+#include "ADM_preview.h"
+
+#include "DIA_coreToolkit.h"
+
+#define MAX(a,b) ( (a)>(b) ? (a) : (b) )
+
+/*************************************/
+/*************************************/
+extern ADM_Composer *video_body;
+/**
+    \fn getCurrentPts
+    \brief returns the PTS in us of the last displayed frame
+*/
+uint64_t admPreview::getCurrentPts(void)
+{
+        if(rdrImage) return rdrImage->Pts;
+}
+/**
+      \fn admPreview::seekToTime
+      \brief Seek to any given frame
+      
+      @param timeframe Time of the image 
+*/
+
+bool admPreview::seekToTime(uint64_t timeframe)
+{
+    if(!video_body->goToTimeVideo(timeframe)) 
+    {
+        ADM_warning(" seeking for frame at %"LLU" ms failed\n",timeframe/1000LL);
+        return false;
+    }
+    return samePicture();
+}
+/**
+      \fn admPreview::seekToIntraPts
+      \brief Seek to intra at PTS given as arg
+      
+      @param timeframe Time of the image 
+*/
+
+bool admPreview::seekToIntraPts(uint64_t timeframe)
+{
+    if(!video_body->goToIntraTimeVideo(timeframe)) 
+    {
+        ADM_warning(" seeking for frame at %"LLU" ms failed\n",timeframe/1000LL);
+        return false;
+    }
+    return samePicture();
+}
+/**
+    \fn samePicture
+*/
+uint8_t admPreview::samePicture(void)
+{
+    if(!video_body->samePicture(rdrImage)) return false;
+    return updateImage();
+}
+/**
+      \fn admPreview::update
+      \brief display data associated with framenum image
+      @param image : current main image (input)
+      @param framenum, framenumber
+*/
+
+uint8_t admPreview::nextPicture(void)
+{
+   
+   if(!video_body->nextPicture(rdrImage)) return 0;
+   return updateImage();
+}
+
+/**
+      \fn admPreview::update
+      \brief display data associated with framenum image
+      @param image : current main image (input)
+      @param framenum, framenumber
+*/
+
+uint8_t admPreview::previousPicture(void)
+{
+    if(!video_body->previousPicture(rdrImage)) return 0;
+    return updateImage();
+}
+/**
+    \fn nextKeyFrame
+
+*/
+bool admPreview::nextKeyFrame(void)
+{
+    uint64_t pts=getCurrentPts();
+    ADM_info("Current PTS :%"LLD" ms\n",pts/1000LL);
+    if(false==video_body->getNKFramePTS(&pts))
+    {
+        ADM_warning("Cannot find next keyframe\n");
+        return false;
+    }
+    ADM_info("next kf PTS :%"LLD" ms\n",pts/1000LL);
+    return seekToIntraPts(pts);
+}
+/**
+    \fn previousKeyFrame
+
+*/
+bool admPreview::previousKeyFrame(void)
+{
+    uint64_t pts=getCurrentPts();
+    ADM_info("Current PTS :%"LLD" ms\n",pts/1000LL);
+    if(false==video_body->getPKFramePTS(&pts))
+    {
+        ADM_warning("Cannot find previous keyframe\n");
+        return false;
+    }
+    ADM_info("next kf PTS :%"LLD" ms\n",pts/1000LL);
+    return seekToIntraPts(pts);
+}
+// EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/CMakeLists.txt	2010-04-07 07:39:21 UTC (rev 6084)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/CMakeLists.txt	2010-04-07 15:34:38 UTC (rev 6085)
@@ -2,8 +2,9 @@
 
 SET(${ADM_LIB}_SRCS
 GUI_render.cpp
-GUI_sdlRender.cpp
-GUI_xvRender.cpp
+GUI_simpleRender.cpp
+#GUI_sdlRender.cpp
+#GUI_xvRender.cpp
 )
 
 IF (APPLE)
@@ -17,8 +18,8 @@
         TARGET_LINK_LIBRARIES(${ADM_LIB}  ${GETTEXT_LIBRARY_DIR})
 ENDIF (GETTEXT_FOUND)
 
-IF (USE_SDL)
-        TARGET_LINK_LIBRARIES(${ADM_LIB}  ${SDL_LIBRARY})
-ENDIF (USE_SDL)
+#IF (USE_SDL)
+       # TARGET_LINK_LIBRARIES(${ADM_LIB}  ${SDL_LIBRARY})
+#ENDIF (USE_SDL)
 
 ADM_INSTALL_LIB(${ADM_LIB})

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_accelRender.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_accelRender.h	2010-04-07 07:39:21 UTC (rev 6084)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_accelRender.h	2010-04-07 15:34:38 UTC (rev 6085)
@@ -4,21 +4,36 @@
 // Description: 
 //  Class to hold all accelerated display (xv, sdl....)
 //
-// Author: mean <fixounet at free.fr>, (C) 2004
+// Author: mean <fixounet at free.fr>, (C) 2004/2010
 //
 // Copyright: See COPYING file that comes with this distribution
 //
 //
 #ifndef GUI_ACCELRENDER_H
 #define GUI_ACCELRENDER_H
-class AccelRender
+#include "ADM_colorspace.h"
+/**
+    \class VideoRenderBase
+*/
+class VideoRenderBase
 {
-      public:
-                              AccelRender( void) {};
-              virtual	uint8_t init(GUI_WindowInfo * window, uint32_t w, uint32_t h)=0;
-              virtual	uint8_t end(void)=0;
-              virtual uint8_t display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom=ZOOM_1_1)=0;
-              virtual uint8_t hasHwZoom(void) {return 0;}
-              
+      protected:
+                        ADMColorScalerFull *scaler;
+                        uint32_t imageWidth;
+                        uint32_t imageHeight;
+                        uint32_t displayWidth;
+                        uint32_t displayHeight;
+                        renderZoom currentZoom;
+
+                        bool calcDisplayFromZoom(renderZoom zoom);
+                        bool baseInit(uint32_t w,uint32_t h,renderZoom zoom);
+       public:
+                                VideoRenderBase( void) {scaler=NULL;};
+                                ~VideoRenderBase() {if(scaler) delete scaler;scaler=NULL;}
+              virtual	bool    init(GUI_WindowInfo * window, uint32_t w, uint32_t h,renderZoom zoom)=0;
+              virtual	bool    stop(void)=0;
+              virtual   bool    displayImage(ADMImage *pic)=0;
+              virtual   bool    refresh(void) {return true;}
+              virtual   bool    changeZoom(renderZoom newzoom)=0;
 };
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2010-04-07 07:39:21 UTC (rev 6084)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2010-04-07 15:34:38 UTC (rev 6085)
@@ -24,6 +24,7 @@
 #include "GUI_render.h"
 #include "GUI_renderInternal.h"
 #include "GUI_accelRender.h"
+#include "GUI_simpleRender.h"
 
 #ifdef USE_XV
 #include "GUI_xvRender.h"
@@ -33,39 +34,19 @@
 #include "GUI_sdlRender.h"
 #endif
 
-
 #include "ADM_colorspace.h"
-
 #include "DIA_uiTypes.h"
-#if ADM_UI_TYPE_BUILD == ADM_UI_QT4 
-    #define IVERT ADM_COLOR_BGR32A
-#else
-    #define IVERT ADM_COLOR_RGB32A
-#endif    
-#warning FIXME
-static ADMColorScalerSimple rgbConverter(640,480,ADM_COLOR_YV12,IVERT);
 
-
-static uint8_t	updateWindowSize(void * win, uint32_t w, uint32_t h);
-static uint8_t  GUI_ConvertRGB(uint8_t * in, uint8_t * out, uint32_t w, uint32_t h);
-
-// Used by flyDialog
-void GUI_RGBDisplay(uint8_t * dis, uint32_t w, uint32_t h, void *widg);
-
 //_____________________________________
-
 //_____________________________________
-static AccelRender    *accel_mode=NULL;
-static uint8_t        *accelSurface=NULL;
+static VideoRenderBase *renderer=NULL;
+static uint8_t         *accelSurface=NULL;
 //_______________________________________
 
-static uint8_t 	*screenBuffer=NULL;
-static uint8_t		*lastImage=NULL;
-static void           *draw=NULL;
-static uint32_t 	 renderW=0,renderH=0; /* Zoomed/display size */
-static uint32_t         phyW=0,phyH=0; /* Unzoomed size, only used when accel can do hw resize */
-static renderZoom       lastZoom;
-static uint8_t          _lock=0;
+static void         *draw=NULL;
+static uint32_t     phyW=0,phyH=0; /* physical window size */
+static renderZoom   lastZoom=ZOOM_1_1;
+static uint8_t      _lock=0;
 
 static const UI_FUNCTIONS_T *HookFunc=NULL;
 //_______________________________________
@@ -94,13 +75,13 @@
    RENDER_CHECK(UI_updateDrawWindowSize);
    HookFunc->UI_updateDrawWindowSize(win,w,h);
 }
-static  void MUI_rgbDraw(void *widg,uint32_t w, uint32_t h,uint8_t *ptr)
+void MUI_rgbDraw(void *widg,uint32_t w, uint32_t h,uint8_t *ptr)
 {
     RENDER_CHECK(UI_rgbDraw);
     HookFunc->UI_rgbDraw(widg, w,  h,ptr);
   
 }
-static  void *MUI_getDrawWidget(void)
+void *MUI_getDrawWidget(void)
 {
   RENDER_CHECK(UI_getDrawWidget);
   return HookFunc->UI_getDrawWidget();
@@ -127,11 +108,6 @@
 void renderDestroy(void)
 {
     ADM_info("Cleaning up Render\n");
-	if(screenBuffer) 
-	{
-		delete[] screenBuffer;
-		screenBuffer = NULL;
-	}
 }
 
 /**
@@ -154,18 +130,43 @@
 
 */
 //----------------------------------------
-uint8_t renderResize(uint32_t w, uint32_t h,uint32_t pw, uint32_t ph)
+uint8_t renderDisplayResize(uint32_t w, uint32_t h,renderZoom zoom)
 {
-	if(screenBuffer) 
+        bool create=false;
+        ADM_info("Render to %"LU"x%"LU" zoom=%d\n",w,h,zoom);
+        if(!renderer) create=true;
+        else
         {
-                delete  [] screenBuffer;
-                screenBuffer=NULL;
+            if(w!=phyW || h!=phyH) create=true;
         }
-        screenBuffer=new uint8_t[w*h*4];
-        phyW=pw;
-        phyH=ph;
-  
-        updateWindowSize( draw,w,h);
+        if(create)
+        {
+            if(renderer) delete renderer;
+            renderer=new simpleRender();
+            GUI_WindowInfo xinfo;
+            MUI_getWindowInfo(draw, &xinfo);
+
+            renderer->init(&xinfo,w,h,zoom);
+            lastZoom=zoom;
+            phyW=w;
+            phyH=h;
+        }else
+        {
+            if(lastZoom!=zoom) renderer->changeZoom(zoom);
+        }
+        lastZoom=zoom;
+         int mul;
+         switch(zoom)
+            {
+                    case ZOOM_1_4: mul=1;break;
+                    case ZOOM_1_2: mul=2;break;
+                    case ZOOM_1_1: mul=4;break;
+                    case ZOOM_2:   mul=8;break;
+                    case ZOOM_4:   mul=16;break;
+                    default : ADM_assert(0);
+    
+            }
+        MUI_updateDrawWindowSize(draw,(w*mul)/4,(h*mul)/4);
         UI_purge();
         return 1;
 }
@@ -175,30 +176,11 @@
 
 */
 //----------------------------------------
-uint8_t renderUpdateImage(uint8_t *ptr,renderZoom zoom)
+uint8_t renderUpdateImage(ADMImage *image)
 {
-
-    ADM_assert(screenBuffer);
-    lastImage=ptr;
     ADM_assert(!_lock);
-    if(accel_mode)
-    {
-        lastZoom=zoom;
-        if(accel_mode ->hasHwZoom())
-        {
-           accel_mode->display(lastImage, phyW, phyH,zoom);
-        }else
-        {
-          accel_mode->display(lastImage, renderW, renderH,zoom);
-        }
-      
-    }else
-    {
-      GUI_ConvertRGB(ptr,screenBuffer, renderW,renderH);
-      renderRefresh();
-    }
-  return 1;
-
+    renderer->displayImage(image);
+    return 1;
 }
 /**
 	Refresh the image from internal buffer / last image
@@ -209,34 +191,22 @@
 uint8_t renderRefresh(void)
 {
       if(_lock) return 1;
-      if(!screenBuffer)
-      {
-              if(accel_mode) ADM_assert(0);
-              return 0;
-      }
-
-      if(accel_mode)
-      {
-          if(lastImage)
-               if(accel_mode ->hasHwZoom())
-                {
-                  accel_mode->display(lastImage, phyW, phyH,lastZoom);
-                }else
-                {
-                  accel_mode->display(lastImage, renderW, renderH,lastZoom);
-                }
-      }
-      else
-              GUI_RGBDisplay(screenBuffer, renderW, renderH,draw);
-  return 1;
+      renderer->refresh();
+      return 1;
 }
-
+/**
+    \fn renderExpose
+*/
 uint8_t renderExpose(void)
 {
     renderRefresh();
 }
+/**
+    \fn 
+*/
 uint8_t renderStartPlaying( void )
 {
+#if 0
 char *displ;
 unsigned int renderI;
 ADM_RENDER_TYPE render;
@@ -244,7 +214,7 @@
 	ADM_assert(!accel_mode);
         
 
-	render=MUI_getPreferredRender();
+        render=MUI_getPreferredRender();
         GUI_WindowInfo xinfo;
         MUI_getWindowInfo(draw, &xinfo);
         switch(render)
@@ -301,59 +271,49 @@
            accelSurface=new uint8_t[ (renderW*renderH*3)>>1];
           
         }
-	
+#endif	
 	return 1;
 }
+
 /**
-      \fn renderHasAccelZoom
-      \brief returns 1 if accel can do hw zoom
+    \fn renderStopPlaying
 */
-uint8_t renderHasAccelZoom(void)
-{
-    if(!accel_mode) return 0;
-    return accel_mode->hasHwZoom(); 
-}
-
 uint8_t renderStopPlaying( void )
-{
-      
-      if(accel_mode)
-      {
-              accel_mode->end();
-              delete accel_mode;
-              if(accelSurface) delete [] accelSurface;
-              accelSurface=NULL;
-                              
-      }
-      accel_mode=NULL;	
-      
-      return 1;
+{      
+      return true;
 }
-
-
-//___________________________________________________________________________
-//
-//
-uint8_t	updateWindowSize(void * win, uint32_t w, uint32_t h)
+//***************************************
+/**
+    \fn bool calcDisplayFromZoom(renderZoom zoom);
+*/
+bool VideoRenderBase::calcDisplayFromZoom(renderZoom zoom)
 {
-    ADM_assert(screenBuffer);
-    renderW = w;
-    renderH = h;
-
-    MUI_updateDrawWindowSize(win,w,h);
-    rgbConverter.changeWidthHeight(w,h);
-    return 1;
+        int mul;
+         switch(zoom)
+            {
+                    case ZOOM_1_4: mul=1;break;
+                    case ZOOM_1_2: mul=2;break;
+                    case ZOOM_1_1: mul=4;break;
+                    case ZOOM_2:   mul=8;break;
+                    case ZOOM_4:   mul=16;break;
+                    default : ADM_assert(0);
+    
+            }
+        displayWidth=(imageWidth*mul)/4;
+        displayHeight=(imageHeight*mul)/4;
+        return true;
 }
 
-uint8_t GUI_ConvertRGB(uint8_t * in, uint8_t * out, uint32_t w, uint32_t h)
+/**
+    \fn baseInit
+*/
+bool VideoRenderBase::baseInit(uint32_t w,uint32_t h,renderZoom zoom)
 {
-    rgbConverter.changeWidthHeight(w,h);
-    rgbConverter.convert(in,out);
-    return 1;
+        imageWidth=w;
+        imageHeight=h;
+        currentZoom=zoom;
+        calcDisplayFromZoom(zoom);
+        return true;
 }
-void GUI_RGBDisplay(uint8_t * dis, uint32_t w, uint32_t h, void *widg)
-{
-    
-    MUI_rgbDraw(widg,w,h,dis);
-}
+
 //EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.h	2010-04-07 07:39:21 UTC (rev 6084)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.h	2010-04-07 15:34:38 UTC (rev 6085)
@@ -21,8 +21,6 @@
 
 #include "ADM_image.h"
 
-class AVDMGenericVideoStream;
-
 typedef struct
 {
     void *display;
@@ -45,16 +43,15 @@
 }renderZoom;
 
 uint8_t renderInit( void );
-void   renderDestroy(void);
-uint8_t renderResize(uint32_t w, uint32_t h,uint32_t phyW,uint32_t phyH);
+void    renderDestroy(void);
+uint8_t renderDisplayResize(uint32_t w, uint32_t h,renderZoom zoom);
 uint8_t renderRefresh(void);
 uint8_t renderExpose(void);
-uint8_t renderUpdateImage(uint8_t *ptr,renderZoom zoom);
+uint8_t renderUpdateImage(ADMImage *img);
 uint8_t renderUpdateImageBlit(uint8_t *ptr,uint32_t startx, uint32_t starty, uint32_t w, uint32_t,uint32_t primary);
 
 uint8_t renderStartPlaying( void );
 uint8_t renderStopPlaying( void );
-uint8_t renderHasAccelZoom(void);
 
 uint8_t renderLock(void);
 uint8_t renderUnlock(void);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.h	2010-04-07 07:39:21 UTC (rev 6084)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.h	2010-04-07 15:34:38 UTC (rev 6085)
@@ -17,18 +17,19 @@
 
 #ifndef TSDLRENDER_H
 #define TSDLRENDER_H
-
-class sdlAccelRender: public AccelRender
+/**
+    \class sdlRender
+*/
+class sdlRender: public VideoRenderBase
 {
   protected:
-              int     useYV12;
+              bool     useYV12;
               uint8_t *decoded;
-      public:
-                                sdlAccelRender( void ) ;
-              virtual	uint8_t init( GUI_WindowInfo * window, uint32_t w, uint32_t h);
-              virtual	uint8_t end(void);
-              virtual   uint8_t display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom);
-              			uint8_t hasHwZoom(void) {return 1;}
+  public:
+                             sdlRender( void ) ;
+              virtual	bool init( GUI_WindowInfo *  window, uint32_t w, uint32_t h,renderZoom zoom);
+              virtual	bool stop(void);				
+              virtual   bool displayImage(ADMImage *pic);
 };
 
 void initSdl(int videoDevice);

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_simpleRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_simpleRender.cpp	2010-04-07 07:39:21 UTC (rev 6084)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_simpleRender.cpp	2010-04-07 15:34:38 UTC (rev 6085)
@@ -0,0 +1,110 @@
+/**
+    \author mean fixounet at free.fr 2010
+*/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "config.h"
+#include "ADM_default.h"
+#include "DIA_coreToolkit.h"
+#include "GUI_render.h"
+#include "GUI_renderInternal.h"
+#include "GUI_accelRender.h"
+#include "GUI_simpleRender.h"
+
+extern void MUI_rgbDraw(void *widg,uint32_t w, uint32_t h,uint8_t *ptr);
+extern void *MUI_getDrawWidget(void);
+/**
+    \fn simpleRender
+*/
+simpleRender::simpleRender()
+{
+    ADM_info("creating simple render.\n");
+    videoBuffer=NULL;
+}
+/**
+    \fn simpleRender
+*/
+simpleRender::~simpleRender()
+{
+    ADM_info("Destroying simple render.\n");
+    if(videoBuffer) delete [] videoBuffer;
+    videoBuffer=NULL;
+}
+
+/**
+    \fn stop
+*/
+bool simpleRender::stop(void)
+{
+    ADM_info("stopping simple render.\n");
+    return true;
+}
+/**
+    \fn displayImage
+*/
+bool simpleRender::displayImage(ADMImage *pic)
+{
+    scaler->convert(pic->data,videoBuffer);
+    // Display RGB data
+    MUI_rgbDraw(MUI_getDrawWidget(),displayWidth,displayHeight,videoBuffer);
+    return true;
+}
+#if ADM_UI_TYPE_BUILD == ADM_UI_QT4
+    #define IVERT ADM_COLOR_BGR32A
+#else
+    #define IVERT ADM_COLOR_RGB32A
+#endif
+/**
+    \fn cleanup
+*/
+bool simpleRender::cleanup(void)
+{
+    if(videoBuffer) delete [] videoBuffer;
+    videoBuffer=NULL;
+    if(scaler) delete scaler;
+    scaler=NULL;
+    return true;
+}
+/**
+    \fn allocateStuff
+*/
+bool simpleRender::allocateStuff(void)
+{
+        cleanup();
+        scaler=new ADMColorScalerFull(ADM_CS_BICUBIC,imageWidth,imageHeight,displayWidth,displayHeight,
+            ADM_COLOR_YV12,
+            IVERT
+        );
+        videoBuffer=new uint8_t[displayWidth*displayHeight*4];
+        return true;
+}
+
+/**
+    \fn changeZoom
+*/
+bool simpleRender::changeZoom(renderZoom newZoom)
+{
+        ADM_info("changing zoom, simple render.\n");
+        calcDisplayFromZoom(newZoom);
+        currentZoom=newZoom;
+        allocateStuff();
+        return true;
+}
+/**
+    \fn changeZoom
+*/
+bool simpleRender::init( GUI_WindowInfo *  window, uint32_t w, uint32_t h,renderZoom zoom)
+{
+    info=*window;
+    baseInit(w,h,zoom);
+    ADM_info("init, simple render. w=%d, h=%d,zoom=%d\n",(int)w,(int)h,(int)zoom);
+    allocateStuff();
+    return true;
+}

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_simpleRender.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_simpleRender.h	2010-04-07 07:39:21 UTC (rev 6084)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_simpleRender.h	2010-04-07 15:34:38 UTC (rev 6085)
@@ -0,0 +1,41 @@
+
+/***************************************************************************
+    \brief Class to handle native (QT/Gtk render)
+    \author (C) 2010 by mean  email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef T_SIMPLE_RENDER_H
+#define T_SIMPLE_RENDER_H
+/**
+    \fn class simpleRender
+*/
+class simpleRender: public VideoRenderBase
+{
+      protected:
+                             GUI_WindowInfo info;
+                             uint8_t *videoBuffer;
+                             void    *handle;
+                             bool    cleanup(void);
+                             bool    allocateStuff(void);
+      public:
+                             simpleRender( void ) ;
+                             ~simpleRender();
+              virtual	bool init( GUI_WindowInfo *  window, uint32_t w, uint32_t h,renderZoom zoom);
+              virtual	bool stop(void);				
+              virtual   bool displayImage(ADMImage *pic);
+              virtual   bool changeZoom(renderZoom newZoom);
+};
+#endif
+
+
+
+

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.h	2010-04-07 07:39:21 UTC (rev 6084)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.h	2010-04-07 15:34:38 UTC (rev 6085)
@@ -17,14 +17,16 @@
 
 #ifndef T_XVRENDER_H
 #define T_XVRENDER_H
-class XvAccelRender: public AccelRender
+/**
+    \fn class XvRender
+*/
+class XvRender: public VideoRenderBase
 {
       public:
-                              XvAccelRender( void ) ;
-              virtual	uint8_t init( GUI_WindowInfo *  window, uint32_t w, uint32_t h);
-              virtual	uint8_t end(void);				
-              virtual uint8_t display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom);
-                      uint8_t hasHwZoom(void) {return 1;}
+                             XvRender( void ) ;
+              virtual	bool init( GUI_WindowInfo *  window, uint32_t w, uint32_t h,renderZoom zoom);
+              virtual	bool stop(void);				
+              virtual   bool displayImage(ADMImage *pic);
 };
 #endif
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp	2010-04-07 07:39:21 UTC (rev 6084)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_play.cpp	2010-04-07 15:34:38 UTC (rev 6085)
@@ -128,8 +128,8 @@
     stop_req = 0;
     playing = 1;
 
-    admPreview::deferDisplay(1,0);
-    admPreview::samePicture();
+    admPreview::deferDisplay(true);
+    //admPreview::samePicture();
 
     GUIPlayback *playLoop=new GUIPlayback;
     playLoop->initialize();
@@ -138,9 +138,7 @@
     delete playLoop;
     playing = 0;
 
-//   getFirstVideoFilter( );
-
-   admPreview::deferDisplay(0,0);
+   admPreview::deferDisplay(false);
    // Resize the output window to original size...
    ADM_info("Restoring display.\n");
    

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2010-04-07 07:39:21 UTC (rev 6084)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2010-04-07 15:34:38 UTC (rev 6085)
@@ -191,7 +191,7 @@
 
 	prefs->get(DEVICE_VIDEODEVICE, &videoDevice);
 
-	initSdl(videoDevice);
+//	initSdl(videoDevice);
 #endif
 
 	atexit(onexit);
@@ -312,7 +312,7 @@
 	ADM_lavDestroy();
 
 #ifdef USE_SDL
-	quitSdl();
+//	quitSdl();
 #endif
 
 #ifdef HAVE_AUDIO

Modified: branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake	2010-04-07 07:39:21 UTC (rev 6084)
+++ branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake	2010-04-07 15:34:38 UTC (rev 6085)
@@ -39,6 +39,7 @@
 #
 SET(ADM_EXE_SRCS 
 ../common/ADM_preview.cpp  
+../common/ADM_previewNavigate.cpp  
 ../common/gtk_gui.cpp  
 ../common/gui_autodrive.cpp  
 ../common/GUI_jobs.cpp  

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/T_preview.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/T_preview.cpp	2010-04-07 07:39:21 UTC (rev 6084)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/T_preview.cpp	2010-04-07 15:34:38 UTC (rev 6085)
@@ -27,14 +27,12 @@
 #endif
 
 #include "T_preview.h"
-//#include "Q_seekablePreview.h"
 #include "../ADM_render/GUI_render.h"
 #include "../ADM_render/GUI_accelRender.h"
 #include "DIA_coreToolkit.h"
     
 void UI_QT4VideoWidget(QFrame *host);
 static QFrame *hostFrame=NULL;
-static AccelRender *accelRender=NULL;
 static uint8_t *lastImage=NULL;
 extern QWidget *QuiMainWindows;
 
@@ -44,18 +42,7 @@
 void DIA_previewEnd(void) {}
 uint8_t DIA_previewStillAlive(void) {return 1;}
 
-uint8_t	DIA_filterPreview(const char *captionText, AVDMGenericVideoStream *videoStream, uint32_t frame)
-{
-#if 0
-	ADM_assert(frame <= videoStream->getInfo()->nb_frames);
 
-	printf("** DIA_filterPreview %i **\n", frame);
-	Ui_seekablePreviewWindow previewDialog(NULL,videoStream, frame);
-
-	previewDialog.exec();
-#endif
-}
-
 //****************************************************************************************************
 /*
   Function to display
@@ -78,17 +65,11 @@
 
 void ADM_Qvideo::paintEvent(QPaintEvent *ev)
 {
-	if(!displayW || !displayH || !rgbDataBuffer || accelRender)
+	if(!displayW || !displayH || !rgbDataBuffer )
 		return ;
 
-	if(accelRender) 
+	
 	{
-		if(lastImage)
-		{
-			accelRender->display(lastImage,displayW,displayH);
-		}
-	}else
-	{
 		QImage image(rgbDataBuffer,displayW,displayH,QImage::Format_RGB32);
 		QPainter painter(this);
 		painter.drawImage(QPoint(0,0),image);



From mean at mail.berlios.de  Wed Apr  7 17:34:41 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 7 Apr 2010 17:34:41 +0200
Subject: [Avidemux-svn-commit] r6086 - in
	branches/avidemux_2.6_branch_mean/avidemux/common: . ADM_render
Message-ID: <201004071534.o37FYf9f029977@sheep.berlios.de>

Author: mean
Date: 2010-04-07 17:34:41 +0200 (Wed, 07 Apr 2010)
New Revision: 6086

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.h
   branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
Log:
[SDL] Put it back, but never called

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/CMakeLists.txt	2010-04-07 15:34:38 UTC (rev 6085)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/CMakeLists.txt	2010-04-07 15:34:41 UTC (rev 6086)
@@ -3,8 +3,8 @@
 SET(${ADM_LIB}_SRCS
 GUI_render.cpp
 GUI_simpleRender.cpp
-#GUI_sdlRender.cpp
-#GUI_xvRender.cpp
+GUI_sdlRender.cpp
+GUI_xvRender.cpp
 )
 
 IF (APPLE)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2010-04-07 15:34:38 UTC (rev 6085)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2010-04-07 15:34:41 UTC (rev 6086)
@@ -41,6 +41,7 @@
 //_____________________________________
 static VideoRenderBase *renderer=NULL;
 static uint8_t         *accelSurface=NULL;
+static bool             spawnRenderer(void);
 //_______________________________________
 
 static void         *draw=NULL;
@@ -142,14 +143,11 @@
         if(create)
         {
             if(renderer) delete renderer;
-            renderer=new simpleRender();
-            GUI_WindowInfo xinfo;
-            MUI_getWindowInfo(draw, &xinfo);
-
-            renderer->init(&xinfo,w,h,zoom);
-            lastZoom=zoom;
+            renderer=NULL;
             phyW=w;
             phyH=h;
+            lastZoom=zoom;
+            spawnRenderer();
         }else
         {
             if(lastZoom!=zoom) renderer->changeZoom(zoom);
@@ -202,6 +200,69 @@
     renderRefresh();
 }
 /**
+    \fn spawnRenderer
+    \brief Create renderer according to prefs
+*/
+bool spawnRenderer(void)
+{
+        
+        int prefRenderer=MUI_getPreferredRender();
+        bool r=false;
+
+        GUI_WindowInfo xinfo;
+        MUI_getWindowInfo(draw, &xinfo);
+        switch(prefRenderer)
+        {
+#if defined(USE_XV)
+       case RENDER_XV:
+                renderer=new XvRender();
+                r=renderer->init(&xinfo,phyW,phyH,lastZoom);
+                if(!r)
+                {
+                    delete renderer;
+                    renderer=NULL;
+                    ADM_warning("Xv init failed\n");
+                }
+                else
+                {
+                    ADM_info("Xv init ok\n");
+                }
+                break;
+#endif
+
+#if 0 &&  defined(USE_SDL)
+			case RENDER_SDL:
+#ifdef __WIN32
+			case RENDER_DIRECTX:
+#endif
+				renderer=new sdlRender();
+                r=renderer->init(&xinfo,phyW,phyH,lastZoom);
+                if(!r)
+                {
+                    delete renderer;
+                    renderer=NULL;
+                    ADM_warning("SDL init failed\n");
+                }
+                else
+                {
+                    ADM_info("SDL init ok\n");
+                }
+                break;
+#endif
+        }
+        if(!renderer)
+        {
+            ADM_info("Using simple renderer\n");
+            renderer=new simpleRender();
+            GUI_WindowInfo xinfo;
+            MUI_getWindowInfo(draw, &xinfo);
+
+            renderer->init(&xinfo,phyW,phyH,lastZoom);
+        }
+        return true;
+}
+
+/**
     \fn 
 */
 uint8_t renderStartPlaying( void )

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.cpp	2010-04-07 15:34:38 UTC (rev 6085)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.cpp	2010-04-07 15:34:41 UTC (rev 6086)
@@ -11,10 +11,6 @@
 *   (at your option) any later version.                                   *
 *                                                                         *
 ***************************************************************************///
-//  The pitch stride has to be changed as there could be some padding depending on the OS
-//
-//
-
 #include "config.h"
 
 #if defined(USE_SDL)
@@ -32,13 +28,13 @@
 #include "SDL.h"
 #include "SDL_syswm.h"
 }
-
+#include "ADM_default.h"
 #include "ADM_colorspace.h"
 #include "GUI_render.h"
 #include "GUI_accelRender.h"
 #include "GUI_sdlRender.h"
-#include "ADM_assert.h"
 
+
 #ifdef __APPLE__
 extern "C"
 {
@@ -55,14 +51,17 @@
 #ifdef __WIN32
 HWND sdlWin32;
 #endif
-static ADMColorScalerSimple *color=NULL;
-
-sdlAccelRender::sdlAccelRender( void)
+/**
+    \fn sdlRender
+*/
+sdlRender::sdlRender( void)
 {
-        useYV12=1;
-        decoded=NULL;
-}
-uint8_t sdlAccelRender::end( void)
+        useYV12=true;
+}
+/**
+    \fn stop
+*/
+bool sdlRender::stop( void)
 {
         if(sdl_overlay)
         {
@@ -81,42 +80,35 @@
 				destroyCocoaView();
 #endif
         }
-        if(decoded)
-        {
-		        delete [] decoded;
-		        decoded=NULL;
-        }
         sdl_running=0;
         sdl_overlay=NULL;
         sdl_display=NULL;
-        printf("[SDL] Video subsystem closed and destroyed\n");
-}
-uint8_t sdlAccelRender::init( GUI_WindowInfo * window, uint32_t w, uint32_t h)
+        ADM_info("[SDL] Video subsystem closed and destroyed\n");
+}
+/**
+    \fn init
+*/
+bool sdlRender::init( GUI_WindowInfo * window, uint32_t w, uint32_t h,renderZoom zoom)
 {
-	printf("[SDL] Initialising video subsystem\n");
+	ADM_info("[SDL] Initialising video subsystem\n");
 
 #ifdef __APPLE__
 	if (window->width > w && window->height > h)
 	{
-		printf("[SDL] Disabling acceleration.  Zoom increase not supported on Mac\n");
+		ADM_info("[SDL] Disabling acceleration.  Zoom increase not supported on Mac\n");
 		return 0;
 	}
 #endif
 
 	int bpp;
 	int flags;
-
+    baseInit(w,h,zoom);
     // Ask for the position of the drawing window at start
     disp.w=w;
     disp.h=h;
     disp.x=0;
     disp.y=0;
 
-    if(!useYV12)
-    {
-		color=new ADMColorScalerSimple(720,480,ADM_COLOR_YV12,ADM_COLOR_YUV422);
-		decoded=new uint8_t[w*h*2];
-    }
 
     // Hack to get SDL to use GTK window, ugly but works
 #if !defined(__WIN32) && !defined(__APPLE__)
@@ -129,12 +121,12 @@
 
     if (SDL_InitSubSystem(SDL_INIT_VIDEO) < 0)
     {
-		printf("[SDL] FAILED initialising video subsystem\n");
-		printf("[SDL] ERROR: %s\n", SDL_GetError());
+		ADM_warning("[SDL] FAILED initialising video subsystem\n");
+		ADM_warning("[SDL] ERROR: %s\n", SDL_GetError());
 
         return 0;
     }
-
+    ADM_info("SDL subsystem init ok\n");
     // Do it twice as the 1st time does not work
     // Hack to get SDL to use GTK window, ugly but works
 #if !defined(__WIN32) && !defined(__APPLE__)
@@ -142,8 +134,8 @@
     SDL_QuitSubSystem(SDL_INIT_VIDEO);
     if (SDL_InitSubSystem(SDL_INIT_VIDEO) < 0)
     {
-                printf("[SDL] FAILED initialising video subsystem\n");
-                printf("[SDL] ERROR: %s\n", SDL_GetError());
+                ADM_warning("[SDL] FAILED initialising video subsystem\n");
+                ADM_warning("[SDL] ERROR: %s\n", SDL_GetError());
                 return 0;
     }
 #endif
@@ -180,14 +172,15 @@
 #endif
 
 	// SDL will resize our window to width and height passed to SetVideoMode.
-	// This is fine until we use zoomed views so pass window dimensions instead.
-	sdl_display= SDL_SetVideoMode(window->width, window->height, bpp, flags);
+	// This is fine until we use zoomed views so pass window dimensions instead.
+    ADM_info("SDL setting video mode %d,%d\n",(int)window->width,(int)window->height);
+	sdl_display= SDL_SetVideoMode(window->width,window->height, bpp, flags);
 
     if (!sdl_display)
     {
-        end();
-        printf("[SDL] Cannot create surface\n");
-		printf("[SDL] ERROR: %s\n", SDL_GetError());
+        stop();
+        ADM_warning("[SDL] Cannot create surface\n");
+		ADM_warning("[SDL] ERROR: %s\n", SDL_GetError());
         return 0;
     }
 
@@ -223,21 +216,22 @@
 
         if(useYV12) cspace=SDL_YV12_OVERLAY;
             else    cspace=SDL_YUY2_OVERLAY;
-        //_______________________________________________________
+        //_______________________________________________________
+        ADM_info("Creating overlay\n");
         sdl_overlay=SDL_CreateYUVOverlay((w),(h), cspace, sdl_display);
 
 		// DirectX may fail but overlay still created.
 		// Not a showstopper but log failure.
 		if (strlen(SDL_GetError()))
 		{
-			printf("[SDL] ERROR: %s\n", SDL_GetError());
+			ADM_warning("[SDL] ERROR: %s\n", SDL_GetError());
 		}
 
         if(!sdl_overlay)
         {
-			end();
-			printf("[SDL] Cannot create SDL overlay\n");
-			printf("[SDL] ERROR: %s\n", SDL_GetError());
+			stop();
+			ADM_warning("[SDL] Cannot create SDL overlay\n");
+			ADM_warning("[SDL] ERROR: %s\n", SDL_GetError());
 
 			return 0;
         }
@@ -247,10 +241,12 @@
         if(!sdl_overlay->hw_overlay)
             printf("[SDL] Hardware acceleration disabled\n");
 
-        if(!useYV12) color->changeWidthHeight(w,h);
+        if(!useYV12)
+        {
+          // Create YV12->YUY2 here!
+        }
+		ADM_info("[SDL] Video subsystem initalised successfully\n");
 
-		printf("[SDL] Video subsystem initalised successfully\n");
-
         return 1;
 }
 
@@ -262,8 +258,11 @@
         src+=width;
         dst+=stride;
     }
-}
-uint8_t sdlAccelRender::display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom)
+}
+/**
+    \fn displayImage
+*/
+bool sdlRender::displayImage(ADMImage *pic)
 {
 #ifdef __WIN32
 	// DirectX playback doesn't refresh correctly if the parent window is moved.
@@ -285,8 +284,12 @@
 	}
 #endif
 
-int pitch;
-int page=w*h;
+int pitch;
+int w=imageWidth;
+int h=imageHeight;
+int page=w*h;
+uint8_t *ptr=pic->data;
+
         ADM_assert(sdl_overlay);
         SDL_LockYUVOverlay(sdl_overlay);
         pitch=sdl_overlay->pitches[0];
@@ -310,7 +313,8 @@
 	        else
 	            interleave(sdl_overlay->pixels[2],ptr+(page*5)/4,w>>1,pitch,h>>1);
         }else
-        {
+        {
+#if 0
 	        color->changeWidthHeight(w,h);
 	        if(pitch==2*w)
 	        {
@@ -320,21 +324,12 @@
 	        {
 	            color->convert(ptr,decoded);
 	            interleave(sdl_overlay->pixels[0],decoded,2*w,pitch,h);
-	        }
+	        }
+#endif
         }
-        uint32_t factor=4;
-               switch(zoom)
-               {
-                   case ZOOM_1_4: factor=1;break;
-                   case ZOOM_1_2: factor=2;break;
-                   case ZOOM_1_1: factor=4;break;
-                   case ZOOM_2:   factor=8;break;
-                   case ZOOM_4:   factor=16;break;
-                   default : ADM_assert(0);
-
-               }
-        disp.w=(w*factor)/4;
-        disp.h=(h*factor)/4;
+       
+        disp.w=displayWidth;
+        disp.h=displayHeight;
         disp.x=0;
         disp.y=0;
 
@@ -342,8 +337,21 @@
         SDL_DisplayYUVOverlay(sdl_overlay,&disp);
 
         return 1;
+}
+
+/**
+    \fn changeZoom
+*/
+bool sdlRender::changeZoom(renderZoom newZoom)
+{
+        ADM_info("changing zoom, sdl render.\n");
+        calcDisplayFromZoom(newZoom);
+        currentZoom=newZoom;
+        return true;
 }
-
+/**
+    \fn initSdl
+*/
 void initSdl(int videoDevice)
 {
 	printf("\n");
@@ -394,7 +402,9 @@
 
 	printf("\n");
 }
-
+/**
+    \fn quitSdl
+*/
 void quitSdl(void)
 {
 	if (SDL_WasInit(SDL_INIT_EVERYTHING))

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.h	2010-04-07 15:34:38 UTC (rev 6085)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.h	2010-04-07 15:34:41 UTC (rev 6086)
@@ -24,12 +24,12 @@
 {
   protected:
               bool     useYV12;
-              uint8_t *decoded;
   public:
                              sdlRender( void ) ;
               virtual	bool init( GUI_WindowInfo *  window, uint32_t w, uint32_t h,renderZoom zoom);
               virtual	bool stop(void);				
               virtual   bool displayImage(ADMImage *pic);
+              virtual   bool changeZoom(renderZoom newZoom);
 };
 
 void initSdl(int videoDevice);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.cpp	2010-04-07 15:34:38 UTC (rev 6085)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.cpp	2010-04-07 15:34:41 UTC (rev 6086)
@@ -46,31 +46,45 @@
 static uint8_t 	GUI_XvList(Display * dis, uint32_t port, uint32_t * fmt);
 static uint8_t 	GUI_XvInit(GUI_WindowInfo * window, uint32_t w, uint32_t h);
 static void 	GUI_XvEnd( void );
-static uint8_t 	GUI_XvDisplay(uint8_t * src, uint32_t w, uint32_t h,renderZoom zoom);
+static uint8_t GUI_XvDisplay(uint8_t * src, uint32_t w, uint32_t h,uint32_t destW,uint32_t destH);
 static uint8_t 	GUI_XvSync(void);
 
 static uint8_t getAtom(const char *string);
 //________________Wrapper around Xv_______________
-XvAccelRender::XvAccelRender( void )
+XvRender::XvRender( void )
 {
 
 }
-uint8_t XvAccelRender::init( GUI_WindowInfo * window, uint32_t w, uint32_t h)
+bool XvRender::init( GUI_WindowInfo * window, uint32_t w, uint32_t h,renderZoom zoom)
 {
-	printf("[Xvideo]Xv start\n");
+	ADM_info("[Xvideo]Xv start\n");
+    info=*window;
+    baseInit(w,h,zoom);
 	return  GUI_XvInit( window,  w,  h);
 }
-uint8_t XvAccelRender::end(void)
+bool XvRender::stop(void)
 {
 	 GUI_XvEnd( );
 	 printf("[Xvideo]Xv end\n");
 	 return 1;
 }
 
-uint8_t XvAccelRender::display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom)
+bool XvRender::displayImage(ADMImage *pic)
 {
-	return GUI_XvDisplay(ptr, w, h,zoom);
+
+	return GUI_XvDisplay(pic->data, imageWidth, imageHeight,displayWidth,displayHeight);
 }
+
+/**
+    \fn changeZoom
+*/
+bool XvRender::changeZoom(renderZoom newZoom)
+{
+        ADM_info("changing zoom, xv render.\n");
+        calcDisplayFromZoom(newZoom);
+        currentZoom=newZoom;
+        return true;
+}
 //________________Wrapper around Xv_______________
 
 static unsigned int xv_port;
@@ -107,9 +121,9 @@
 }
 
 //------------------------------------
-uint8_t GUI_XvDisplay(uint8_t * src, uint32_t w, uint32_t h,renderZoom zoom)
+uint8_t GUI_XvDisplay(uint8_t * src, uint32_t w, uint32_t h,uint32_t destW,uint32_t destH)
 {
-    uint32_t destW,destH;
+    
     if (xvimage)
       {
 
@@ -117,21 +131,8 @@
 
 	  // for YV12, 4 bits for Y 4 bits for u, 4 bits for v
 	  // total 1.5*
-         XLockDisplay (xv_display);
-	  memcpy(xvimage->data, src, (w*h*3)>>1);
-          uint32_t factor=4;
-        switch(zoom)
-        {
-            case ZOOM_1_4: factor=1;break;
-            case ZOOM_1_2: factor=2;break;
-            case ZOOM_1_1: factor=4;break;
-            case ZOOM_2:   factor=8;break;
-            case ZOOM_4:   factor=16;break;
-            default : ADM_assert(0);
-
-        }
-	destW=(w*factor)/4;
-        destH=(h*factor)/4;
+          XLockDisplay (xv_display);
+          memcpy(xvimage->data, src, (w*h*3)>>1);
         //printf("%u x %u => %u x %u\n",w,h,destW,destH);
         // And display it !
 #if 1
@@ -148,11 +149,8 @@
 
 	  XSync(xv_display, False);
 	  XUnlockDisplay (xv_display);
-	  //GUI_XvExpose();
-
       }
     return 1;
-
 }
 uint8_t GUI_XvSync(void)
 {

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.h	2010-04-07 15:34:38 UTC (rev 6085)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.h	2010-04-07 15:34:41 UTC (rev 6086)
@@ -22,11 +22,15 @@
 */
 class XvRender: public VideoRenderBase
 {
+      protected:
+                            GUI_WindowInfo info;
       public:
                              XvRender( void ) ;
+                             ~XvRender();
               virtual	bool init( GUI_WindowInfo *  window, uint32_t w, uint32_t h,renderZoom zoom);
               virtual	bool stop(void);				
               virtual   bool displayImage(ADMImage *pic);
+              virtual   bool changeZoom(renderZoom newzoom);
 };
 #endif
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2010-04-07 15:34:38 UTC (rev 6085)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/main.cpp	2010-04-07 15:34:41 UTC (rev 6086)
@@ -191,7 +191,7 @@
 
 	prefs->get(DEVICE_VIDEODEVICE, &videoDevice);
 
-//	initSdl(videoDevice);
+	initSdl(videoDevice);
 #endif
 
 	atexit(onexit);
@@ -312,7 +312,7 @@
 	ADM_lavDestroy();
 
 #ifdef USE_SDL
-//	quitSdl();
+	quitSdl();
 #endif
 
 #ifdef HAVE_AUDIO



From mean at mail.berlios.de  Wed Apr  7 17:34:43 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 7 Apr 2010 17:34:43 +0200
Subject: [Avidemux-svn-commit] r6087 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src
Message-ID: <201004071534.o37FYhdG029987@sheep.berlios.de>

Author: mean
Date: 2010-04-07 17:34:43 +0200 (Wed, 07 Apr 2010)
New Revision: 6087

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp
Log:
[colorScaler] To have BGRA32, to first RGB32 then swap R and B, it is much faster, else swscale uses C code

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp	2010-04-07 15:34:41 UTC (rev 6086)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp	2010-04-07 15:34:43 UTC (rev 6087)
@@ -53,7 +53,7 @@
     case ADM_COLOR_YV12: return PIX_FMT_YUV420P;
     case ADM_COLOR_YUV422P: return PIX_FMT_YUV422P;
     case ADM_COLOR_RGB32A: return PIX_FMT_RGB32;
-    case ADM_COLOR_BGR32A: return PIX_FMT_BGR32;
+    case ADM_COLOR_BGR32A: return PIX_FMT_RGB32; // Faster that way...PIX_FMT_BGR32;
     case ADM_COLOR_RGB24: return PIX_FMT_RGB24;
     default : ADM_assert(0); 
   }
@@ -105,13 +105,6 @@
             srcStride[2]=width>>1;
             break;
     case ADM_COLOR_RGB32A:
-            srcData[0]=from;
-            srcData[1]=NULL;
-            srcData[2]=NULL;
-            srcStride[0]=width*4;
-            srcStride[1]=0;
-            srcStride[2]=0;
-            break;
     case ADM_COLOR_BGR32A:
             srcData[0]=from;
             srcData[1]=NULL;
@@ -120,6 +113,7 @@
             srcStride[1]=0;
             srcStride[2]=0;
             break;
+    
     default:
         ADM_assert(0);
   }
@@ -131,7 +125,7 @@
   @param from Source image
   @param to Target image
 */
-
+#define swap16(x) x=((x>>8)&0xff)+(x<<8)
 bool ADMColorScalerFull::convert(uint8_t  *from, uint8_t *to)
 {
   uint8_t *srcData[3];
@@ -142,6 +136,21 @@
   getStrideAndPointers(false,from,fromColor,srcData,srcStride);
   getStrideAndPointers(true,to,toColor,dstData,dstStride);
   sws_scale(CONTEXT,srcData,srcStride,0,srcHeight,dstData,dstStride);
+  if(toColor==ADM_COLOR_BGR32A)
+  {
+    // RGB32->BG32
+    uint32_t l=dstWidth*dstHeight;
+    uint8_t *d=(uint8_t *)to;
+    int r,b,g,a;
+    while(l--)
+    {
+        uint8_t s=d[0];
+        d[0]=d[2];
+        d[2]=s;
+        d+=4;
+        
+    }
+  }
   return true;
   
 }



From mean at mail.berlios.de  Wed Apr  7 17:34:44 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 7 Apr 2010 17:34:44 +0200
Subject: [Avidemux-svn-commit] r6088 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <201004071534.o37FYiNj029997@sheep.berlios.de>

Author: mean
Date: 2010-04-07 17:34:44 +0200 (Wed, 07 Apr 2010)
New Revision: 6088

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
Log:
[Render] Disable SDL on linux, it crashes at least with KDE4 (2.5 and 2.6 both)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2010-04-07 15:34:43 UTC (rev 6087)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2010-04-07 15:34:44 UTC (rev 6088)
@@ -230,7 +230,7 @@
                 break;
 #endif
 
-#if 0 &&  defined(USE_SDL)
+#if (defined(WIN32) || defined(APPLE) )&&  defined(USE_SDL)
 			case RENDER_SDL:
 #ifdef __WIN32
 			case RENDER_DIRECTX:



From mean at mail.berlios.de  Wed Apr  7 17:42:15 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 7 Apr 2010 17:42:15 +0200
Subject: [Avidemux-svn-commit] r6089 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <201004071542.o37FgF73030354@sheep.berlios.de>

Author: mean
Date: 2010-04-07 17:42:15 +0200 (Wed, 07 Apr 2010)
New Revision: 6089

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/CMakeLists.txt
Log:
[render] Link to sdl if we use it

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/CMakeLists.txt	2010-04-07 15:34:44 UTC (rev 6088)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/CMakeLists.txt	2010-04-07 15:42:15 UTC (rev 6089)
@@ -18,8 +18,8 @@
         TARGET_LINK_LIBRARIES(${ADM_LIB}  ${GETTEXT_LIBRARY_DIR})
 ENDIF (GETTEXT_FOUND)
 
-#IF (USE_SDL)
-       # TARGET_LINK_LIBRARIES(${ADM_LIB}  ${SDL_LIBRARY})
-#ENDIF (USE_SDL)
+IF (USE_SDL)
+       TARGET_LINK_LIBRARIES(${ADM_LIB}  ${SDL_LIBRARY})
+ENDIF (USE_SDL)
 
 ADM_INSTALL_LIB(${ADM_LIB})



From mean at mail.berlios.de  Wed Apr  7 18:05:23 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 7 Apr 2010 18:05:23 +0200
Subject: [Avidemux-svn-commit] r6090 -
	branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src
Message-ID: <201004071605.o37G5Nwc000887@sheep.berlios.de>

Author: mean
Date: 2010-04-07 18:05:23 +0200 (Wed, 07 Apr 2010)
New Revision: 6090

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/DIA_flyDialogGtk.cpp
Log:
[Gtk] Fix build (untested)

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/DIA_flyDialogGtk.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/DIA_flyDialogGtk.cpp	2010-04-07 15:42:15 UTC (rev 6089)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_UIs/src/DIA_flyDialogGtk.cpp	2010-04-07 16:05:23 UTC (rev 6090)
@@ -24,7 +24,6 @@
 extern PhysicalJogShuttle *physical_jog_shuttle;
 #endif
 
-extern void GUI_RGBDisplay(uint8_t * dis, uint32_t w, uint32_t h, void *widg);
 extern float UI_calcZoomToFitScreen(GtkWindow* window, GtkWidget* drawingArea, uint32_t imageWidth, uint32_t imageHeight);
 extern void UI_centreCanvasWindow(GtkWindow *window, GtkWidget *canvas, int newCanvasWidth, int newCanvasHeight);
 
@@ -115,9 +114,18 @@
 uint8_t  ADM_flyDialogGtk::display(void)
 {
 	ADM_assert(_canvas);
-	ADM_assert(_rgbBufferOut);
+	ADM_assert(_rgbBufferOut);
+    GtkWidget *widget=(GtkWidget*)_canvas;
+    gdk_draw_rgb_32_image(widget->window, widget->style->fg_gc[GTK_STATE_NORMAL], 0,    // X
+                       0,       // y
+                       _zoomW,       //width
+                       _zoomH,       //h*2, // heigth
+                       GDK_RGB_DITHER_NONE,
+                       //GDK_RGB_DITHER_MAX,  // dithering
+                       (guchar *) _rgbBufferOut,  // buffer
+                       _zoomW * 4);
 
-	GUI_RGBDisplay(_rgbBufferOut, _zoomW, _zoomH, _canvas);
+	//GUI_RGBDisplay(_rgbBufferOut, _zoomW, _zoomH, _canvas);
 
 	return 1; 
 }



From mean at mail.berlios.de  Thu Apr  8 11:03:26 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 8 Apr 2010 11:03:26 +0200
Subject: [Avidemux-svn-commit] r6091 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <201004080903.o3893QfG020990@sheep.berlios.de>

Author: mean
Date: 2010-04-08 11:03:25 +0200 (Thu, 08 Apr 2010)
New Revision: 6091

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
Log:
[Render] Dont refresh if no renderer are present

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2010-04-07 16:05:23 UTC (rev 6090)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2010-04-08 09:03:25 UTC (rev 6091)
@@ -189,7 +189,8 @@
 uint8_t renderRefresh(void)
 {
       if(_lock) return 1;
-      renderer->refresh();
+      if(renderer)
+        renderer->refresh();
       return 1;
 }
 /**



From mean at mail.berlios.de  Thu Apr  8 11:03:29 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 8 Apr 2010 11:03:29 +0200
Subject: [Avidemux-svn-commit] r6092 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <201004080903.o3893TnO021000@sheep.berlios.de>

Author: mean
Date: 2010-04-08 11:03:29 +0200 (Thu, 08 Apr 2010)
New Revision: 6092

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_simpleRender.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_simpleRender.h
Log:
[simpleRender] implement refresh

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_simpleRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_simpleRender.cpp	2010-04-08 09:03:25 UTC (rev 6091)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_simpleRender.cpp	2010-04-08 09:03:29 UTC (rev 6092)
@@ -47,6 +47,14 @@
     return true;
 }
 /**
+    \fn refresh
+*/
+bool simpleRender::refresh(void)
+{
+     MUI_rgbDraw(MUI_getDrawWidget(),displayWidth,displayHeight,videoBuffer);
+     return true;
+}
+/**
     \fn displayImage
 */
 bool simpleRender::displayImage(ADMImage *pic)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_simpleRender.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_simpleRender.h	2010-04-08 09:03:25 UTC (rev 6091)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_simpleRender.h	2010-04-08 09:03:29 UTC (rev 6092)
@@ -33,6 +33,7 @@
               virtual	bool stop(void);				
               virtual   bool displayImage(ADMImage *pic);
               virtual   bool changeZoom(renderZoom newZoom);
+              virtual   bool refresh(void);
 };
 #endif
 



From mean at mail.berlios.de  Thu Apr  8 11:03:31 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 8 Apr 2010 11:03:31 +0200
Subject: [Avidemux-svn-commit] r6093 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include
Message-ID: <201004080903.o3893V9d021010@sheep.berlios.de>

Author: mean
Date: 2010-04-08 11:03:30 +0200 (Thu, 08 Apr 2010)
New Revision: 6093

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_ffmp43.h
Log:
[codec] h264 can have bframes

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_ffmp43.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_ffmp43.h	2010-04-08 09:03:29 UTC (rev 6092)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_ffmp43.h	2010-04-08 09:03:30 UTC (rev 6093)
@@ -112,7 +112,7 @@
   decoderFFH264 (uint32_t w, uint32_t h,uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData,uint32_t bpp);
   virtual bool bFramePossible (void)
   {
-      return _lowDelay;
+      return true;
   }
   bool   uncompress (ADMCompressedImage * in, ADMImage * out);
 };



From mean at mail.berlios.de  Thu Apr  8 11:03:32 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 8 Apr 2010 11:03:32 +0200
Subject: [Avidemux-svn-commit] r6094 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor
Message-ID: <201004080903.o3893WFc021020@sheep.berlios.de>

Author: mean
Date: 2010-04-08 11:03:32 +0200 (Thu, 08 Apr 2010)
New Revision: 6094

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp
Log:
[editor] Remove false message

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp	2010-04-08 09:03:30 UTC (rev 6093)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp	2010-04-08 09:03:32 UTC (rev 6094)
@@ -323,7 +323,6 @@
         ADM_info("[Editor] no decoder to check for B- frame\n");
     }else
     {       
-        ADM_info("[Editor] This container does not provide PTS \n");
         if(video.decoder->bFramePossible())
         {
             printf("[Editor] B- frame possible with that codec \n");



From mean at mail.berlios.de  Thu Apr  8 11:03:33 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 8 Apr 2010 11:03:33 +0200
Subject: [Avidemux-svn-commit] r6095 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <201004080903.o3893XlK021030@sheep.berlios.de>

Author: mean
Date: 2010-04-08 11:03:33 +0200 (Thu, 08 Apr 2010)
New Revision: 6095

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.h
Log:
[Xv] Placeholder for resfresh

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.cpp	2010-04-08 09:03:32 UTC (rev 6094)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.cpp	2010-04-08 09:03:33 UTC (rev 6095)
@@ -48,7 +48,7 @@
 static void 	GUI_XvEnd( void );
 static uint8_t GUI_XvDisplay(uint8_t * src, uint32_t w, uint32_t h,uint32_t destW,uint32_t destH);
 static uint8_t 	GUI_XvSync(void);
-
+static uint8_t GUI_XvRedraw( void );
 static uint8_t getAtom(const char *string);
 //________________Wrapper around Xv_______________
 XvRender::XvRender( void )
@@ -85,6 +85,14 @@
         currentZoom=newZoom;
         return true;
 }
+/**
+    \fn refresh
+*/
+bool XvRender::refresh(void)
+{
+    GUI_XvRedraw();
+    return true;
+}
 //________________Wrapper around Xv_______________
 
 static unsigned int xv_port;

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.h	2010-04-08 09:03:32 UTC (rev 6094)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.h	2010-04-08 09:03:33 UTC (rev 6095)
@@ -31,6 +31,7 @@
               virtual	bool stop(void);				
               virtual   bool displayImage(ADMImage *pic);
               virtual   bool changeZoom(renderZoom newzoom);
+              virtual   bool refresh(void);
 };
 #endif
 



From mean at mail.berlios.de  Thu Apr  8 11:03:35 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 8 Apr 2010 11:03:35 +0200
Subject: [Avidemux-svn-commit] r6096 - in
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec:
	include src
Message-ID: <201004080903.o3893ZTq021040@sheep.berlios.de>

Author: mean
Date: 2010-04-08 11:03:35 +0200 (Thu, 08 Apr 2010)
New Revision: 6096

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/include/ADM_codecVdpau.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp
Log:
[Vdpau] we cannot avoid a copy

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/include/ADM_codecVdpau.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/include/ADM_codecVdpau.h	2010-04-08 09:03:33 UTC (rev 6095)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/include/ADM_codecVdpau.h	2010-04-08 09:03:35 UTC (rev 6096)
@@ -20,10 +20,12 @@
                     decoderFFVDPAU (uint32_t w, uint32_t h,uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData,uint32_t bpp);
                     ~decoderFFVDPAU();
     virtual bool uncompress (ADMCompressedImage * in, ADMImage * out);
+
     virtual bool dontcopy (void)
                       {
-                        return 0;
+                        return 0; // We cannot use ffmpeg internal buffer, they dont exist!
                       }
+
     virtual bool bFramePossible (void)
       {
         return 1;

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp	2010-04-08 09:03:33 UTC (rev 6095)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp	2010-04-08 09:03:35 UTC (rev 6096)
@@ -217,7 +217,7 @@
         vdpau=(void *)new vdpauContext;
         VDPAU->vdpDecoder=VDP_INVALID_HANDLE;
         WRAP_OpenByName(h264_vdpau,CODEC_ID_H264);
-        
+        ADM_info("[VDPAU] Decoder created \n");
         // Now instantiate our VDPAU surface & decoder
         ADM_assert(VDP_STATUS_OK==funcs.decoderCreate(vdpDevice,VDP_DECODER_PROFILE_H264_HIGH,w,h,15,&(VDPAU->vdpDecoder)));
         // Create our surfaces...



From mean at mail.berlios.de  Thu Apr  8 11:03:38 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 8 Apr 2010 11:03:38 +0200
Subject: [Avidemux-svn-commit] r6097 - in branches/avidemux_2.6_branch_mean:
	avidemux/common avidemux/common/ADM_commonUI
	avidemux/common/ADM_editor avidemux/common/ADM_videoCodec/include
	avidemux/qt4/ADM_userInterfaces/ADM_gui
	avidemux_core/ADM_coreVideoCodec/include
Message-ID: <201004080903.o3893c6N021050@sheep.berlios.de>

Author: mean
Date: 2010-04-08 11:03:37 +0200 (Thu, 08 Apr 2010)
New Revision: 6097

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/GUI_ui.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.hxx
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/include/ADM_codecVdpau.h
   branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/translation_table.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_codec.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_codecFFsimple.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_ffmp43.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_png.h
Log:
[ui] Display decoder + move decoder configure option to left panel

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/GUI_ui.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/GUI_ui.h	2010-04-08 09:03:35 UTC (rev 6096)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_commonUI/GUI_ui.h	2010-04-08 09:03:37 UTC (rev 6097)
@@ -51,6 +51,6 @@
 void UI_refreshCustomMenu(void);
 
 bool UI_setVUMeter( uint32_t volume[6]); // Volume between 0 and 255.
-
+bool UI_setDecoderName(const char *name);
 #endif
 // EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp	2010-04-08 09:03:35 UTC (rev 6096)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.cpp	2010-04-08 09:03:37 UTC (rev 6097)
@@ -649,5 +649,16 @@
     v->_aviheader->getPtsDts(frame,pts,dts);
     return true;
 }
+/**
+    \fn getVideoDecoderName
+*/
+const char          *ADM_Composer::getVideoDecoderName(void)
+{
+    if(!_segments.getNbRefVideos()) return "????";
+     _VIDEOS *v=_segments.getRefVideo(0);
+    if(!v) return "????";
+    if(!v->decoder) return "????";
+    return v->decoder->getDecoderName();
+}
 //
 //

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.hxx
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.hxx	2010-04-08 09:03:35 UTC (rev 6096)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edit.hxx	2010-04-08 09:03:37 UTC (rev 6097)
@@ -231,6 +231,7 @@
                     uint8_t             setEnv(_ENV_EDITOR_FLAGS newflag);
                     uint8_t             getEnv(_ENV_EDITOR_FLAGS newflag);
 /******************************* /Misc ************************************/				
-
+/******************************** Info ************************************/
+                    const char          *getVideoDecoderName(void);
 };
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/include/ADM_codecVdpau.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/include/ADM_codecVdpau.h	2010-04-08 09:03:35 UTC (rev 6096)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/include/ADM_codecVdpau.h	2010-04-08 09:03:37 UTC (rev 6097)
@@ -30,5 +30,6 @@
       {
         return 1;
       }
+    virtual const char *getDecoderName(void) {return "VDPAU";}
 };
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp	2010-04-08 09:03:35 UTC (rev 6096)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp	2010-04-08 09:03:37 UTC (rev 6097)
@@ -728,8 +728,10 @@
   }
 
 
-    A_Rewind();
+   A_Rewind();
    ADM_info(" conf updated \n");
+   UI_setDecoderName(video_body->getVideoDecoderName());
+
 }
 
 //___________________________________________

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2010-04-08 09:03:35 UTC (rev 6096)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2010-04-08 09:03:37 UTC (rev 6097)
@@ -1056,5 +1056,13 @@
     UI_vuUpdate( volume);
     return true;
 }
+/**
+    \fn setDecodeName
+*/
+bool UI_setDecoderName(const char *name)
+{
+    WIDGET(labelVideoDecoder)->setText(name);	
+    return true;
+}
 //********************************************
 //EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui	2010-04-08 09:03:35 UTC (rev 6096)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui	2010-04-08 09:03:37 UTC (rev 6097)
@@ -7,8 +7,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>800</width>
-    <height>664</height>
+    <width>1090</width>
+    <height>744</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -26,1103 +26,334 @@
    </size>
   </property>
   <widget class="QWidget" name="centralwidget">
-   <layout class="QVBoxLayout">
-    <property name="spacing">
-     <number>6</number>
+   <widget class="QWidget" name="">
+    <property name="geometry">
+     <rect>
+      <x>10</x>
+      <y>500</y>
+      <width>791</width>
+      <height>111</height>
+     </rect>
     </property>
-    <property name="margin">
-     <number>9</number>
-    </property>
-    <item>
-     <layout class="QHBoxLayout">
-      <property name="spacing">
-       <number>6</number>
-      </property>
-      <property name="margin">
-       <number>0</number>
-      </property>
-      <item>
-       <layout class="QVBoxLayout">
-        <property name="spacing">
-         <number>6</number>
-        </property>
-        <property name="margin">
-         <number>0</number>
-        </property>
-        <item>
-         <layout class="QVBoxLayout">
-          <property name="spacing">
-           <number>0</number>
-          </property>
-          <property name="margin">
-           <number>0</number>
-          </property>
-          <item>
-           <widget class="QLabel" name="label_3">
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="maximumSize">
-             <size>
-              <width>180</width>
-              <height>16777215</height>
-             </size>
-            </property>
-            <property name="text">
-             <string>&lt;b&gt;Video&lt;/b&gt;</string>
-            </property>
-            <property name="textFormat">
-             <enum>Qt::AutoText</enum>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <spacer>
-            <property name="orientation">
-             <enum>Qt::Vertical</enum>
-            </property>
-            <property name="sizeType">
-             <enum>QSizePolicy::Fixed</enum>
-            </property>
-            <property name="sizeHint" stdset="0">
-             <size>
-              <width>20</width>
-              <height>5</height>
-             </size>
-            </property>
-           </spacer>
-          </item>
-          <item>
-           <layout class="QHBoxLayout">
-            <property name="spacing">
-             <number>0</number>
-            </property>
-            <property name="margin">
-             <number>0</number>
-            </property>
-            <item>
-             <spacer>
-              <property name="orientation">
-               <enum>Qt::Horizontal</enum>
-              </property>
-              <property name="sizeType">
-               <enum>QSizePolicy::Fixed</enum>
-              </property>
-              <property name="sizeHint" stdset="0">
-               <size>
-                <width>12</width>
-                <height>0</height>
-               </size>
-              </property>
-             </spacer>
-            </item>
-            <item>
-             <layout class="QVBoxLayout">
-              <property name="spacing">
-               <number>6</number>
-              </property>
-              <property name="margin">
-               <number>0</number>
-              </property>
-              <item>
-               <widget class="QComboBox" name="comboBoxVideo">
-                <property name="sizePolicy">
-                 <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                  <horstretch>0</horstretch>
-                  <verstretch>0</verstretch>
-                 </sizepolicy>
-                </property>
-                <item>
-                 <property name="text">
-                  <string>Copy</string>
-                 </property>
-                </item>
-               </widget>
-              </item>
-              <item>
-               <widget class="QPushButton" name="pushButtonVideoConf">
-                <property name="enabled">
-                 <bool>true</bool>
-                </property>
-                <property name="sizePolicy">
-                 <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                  <horstretch>0</horstretch>
-                  <verstretch>0</verstretch>
-                 </sizepolicy>
-                </property>
-                <property name="text">
-                 <string>Configure</string>
-                </property>
-               </widget>
-              </item>
-              <item>
-               <widget class="QPushButton" name="pushButtonVideoFilter">
-                <property name="enabled">
-                 <bool>true</bool>
-                </property>
-                <property name="sizePolicy">
-                 <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                  <horstretch>0</horstretch>
-                  <verstretch>0</verstretch>
-                 </sizepolicy>
-                </property>
-                <property name="text">
-                 <string>Filters</string>
-                </property>
-               </widget>
-              </item>
-             </layout>
-            </item>
-           </layout>
-          </item>
-          <item>
-           <spacer>
-            <property name="orientation">
-             <enum>Qt::Vertical</enum>
-            </property>
-            <property name="sizeType">
-             <enum>QSizePolicy::Fixed</enum>
-            </property>
-            <property name="sizeHint" stdset="0">
-             <size>
-              <width>1</width>
-              <height>14</height>
-             </size>
-            </property>
-           </spacer>
-          </item>
-          <item>
-           <widget class="QLabel" name="label_5">
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="maximumSize">
-             <size>
-              <width>180</width>
-              <height>16777215</height>
-             </size>
-            </property>
-            <property name="text">
-             <string>&lt;b&gt;Audio&lt;/b&gt;</string>
-            </property>
-            <property name="textFormat">
-             <enum>Qt::AutoText</enum>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <spacer>
-            <property name="orientation">
-             <enum>Qt::Vertical</enum>
-            </property>
-            <property name="sizeType">
-             <enum>QSizePolicy::Fixed</enum>
-            </property>
-            <property name="sizeHint" stdset="0">
-             <size>
-              <width>20</width>
-              <height>5</height>
-             </size>
-            </property>
-           </spacer>
-          </item>
-          <item>
-           <layout class="QHBoxLayout">
-            <property name="spacing">
-             <number>0</number>
-            </property>
-            <property name="margin">
-             <number>0</number>
-            </property>
-            <item>
-             <spacer>
-              <property name="orientation">
-               <enum>Qt::Horizontal</enum>
-              </property>
-              <property name="sizeType">
-               <enum>QSizePolicy::Fixed</enum>
-              </property>
-              <property name="sizeHint" stdset="0">
-               <size>
-                <width>12</width>
-                <height>0</height>
-               </size>
-              </property>
-             </spacer>
-            </item>
-            <item>
-             <layout class="QVBoxLayout">
-              <property name="spacing">
-               <number>6</number>
-              </property>
-              <property name="margin">
-               <number>0</number>
-              </property>
-              <item>
-               <widget class="QComboBox" name="comboBoxAudio">
-                <property name="sizePolicy">
-                 <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                  <horstretch>0</horstretch>
-                  <verstretch>0</verstretch>
-                 </sizepolicy>
-                </property>
-                <item>
-                 <property name="text">
-                  <string>Copy</string>
-                 </property>
-                </item>
-               </widget>
-              </item>
-              <item>
-               <widget class="QPushButton" name="pushButtonAudioConf">
-                <property name="enabled">
-                 <bool>true</bool>
-                </property>
-                <property name="sizePolicy">
-                 <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                  <horstretch>0</horstretch>
-                  <verstretch>0</verstretch>
-                 </sizepolicy>
-                </property>
-                <property name="text">
-                 <string>Configure</string>
-                </property>
-               </widget>
-              </item>
-              <item>
-               <widget class="QPushButton" name="pushButtonAudioFilter">
-                <property name="enabled">
-                 <bool>true</bool>
-                </property>
-                <property name="sizePolicy">
-                 <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                  <horstretch>0</horstretch>
-                  <verstretch>0</verstretch>
-                 </sizepolicy>
-                </property>
-                <property name="text">
-                 <string>Filters</string>
-                </property>
-               </widget>
-              </item>
-              <item>
-               <layout class="QHBoxLayout">
-                <property name="spacing">
-                 <number>6</number>
-                </property>
-                <property name="margin">
-                 <number>0</number>
-                </property>
-                <item>
-                 <widget class="QCheckBox" name="checkBox_TimeShift">
-                  <property name="text">
-                   <string>&amp;Shift:</string>
-                  </property>
-                 </widget>
-                </item>
-                <item>
-                 <widget class="QSpinBox" name="spinBox_TimeValue">
-                  <property name="sizePolicy">
-                   <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                    <horstretch>0</horstretch>
-                    <verstretch>0</verstretch>
-                   </sizepolicy>
-                  </property>
-                  <property name="minimum">
-                   <number>-99999</number>
-                  </property>
-                  <property name="maximum">
-                   <number>99999</number>
-                  </property>
-                 </widget>
-                </item>
-               </layout>
-              </item>
-             </layout>
-            </item>
-           </layout>
-          </item>
-          <item>
-           <spacer>
-            <property name="orientation">
-             <enum>Qt::Vertical</enum>
-            </property>
-            <property name="sizeType">
-             <enum>QSizePolicy::Fixed</enum>
-            </property>
-            <property name="sizeHint" stdset="0">
-             <size>
-              <width>1</width>
-              <height>14</height>
-             </size>
-            </property>
-           </spacer>
-          </item>
-          <item>
-           <widget class="QLabel" name="label_4">
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="text">
-             <string>&lt;b&gt;Format&lt;/b&gt;</string>
-            </property>
-            <property name="textFormat">
-             <enum>Qt::AutoText</enum>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <spacer>
-            <property name="orientation">
-             <enum>Qt::Vertical</enum>
-            </property>
-            <property name="sizeType">
-             <enum>QSizePolicy::Fixed</enum>
-            </property>
-            <property name="sizeHint" stdset="0">
-             <size>
-              <width>20</width>
-              <height>5</height>
-             </size>
-            </property>
-           </spacer>
-          </item>
-         </layout>
-        </item>
-        <item>
-         <layout class="QHBoxLayout">
-          <property name="spacing">
-           <number>0</number>
-          </property>
-          <property name="margin">
-           <number>0</number>
-          </property>
-          <item>
-           <spacer>
-            <property name="orientation">
-             <enum>Qt::Horizontal</enum>
-            </property>
-            <property name="sizeType">
-             <enum>QSizePolicy::Fixed</enum>
-            </property>
-            <property name="sizeHint" stdset="0">
-             <size>
-              <width>12</width>
-              <height>1</height>
-             </size>
-            </property>
-           </spacer>
-          </item>
-          <item>
-           <widget class="QComboBox" name="comboBoxFormat">
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-           </widget>
-          </item>
-         </layout>
-        </item>
-        <item>
-         <widget class="QPushButton" name="pushButtonFormatConfigure">
-          <property name="enabled">
-           <bool>true</bool>
-          </property>
-          <property name="sizePolicy">
-           <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
-          </property>
-          <property name="text">
-           <string>Configure</string>
-          </property>
-         </widget>
-        </item>
-       </layout>
-      </item>
-      <item>
-       <layout class="QHBoxLayout">
-        <property name="spacing">
-         <number>6</number>
-        </property>
-        <property name="margin">
-         <number>0</number>
-        </property>
-        <item>
-         <widget class="QFrame" name="frame_video">
-          <property name="sizePolicy">
-           <sizepolicy hsizetype="Expanding" vsizetype="Expanding">
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
-          </property>
-          <property name="minimumSize">
-           <size>
-            <width>100</width>
-            <height>100</height>
-           </size>
-          </property>
-          <property name="autoFillBackground">
-           <bool>false</bool>
-          </property>
-          <property name="frameShape">
-           <enum>QFrame::NoFrame</enum>
-          </property>
-          <property name="frameShadow">
-           <enum>QFrame::Raised</enum>
-          </property>
-          <property name="lineWidth">
-           <number>0</number>
-          </property>
-         </widget>
-        </item>
-        <item>
-         <spacer>
-          <property name="orientation">
-           <enum>Qt::Horizontal</enum>
-          </property>
-          <property name="sizeType">
-           <enum>QSizePolicy::Expanding</enum>
-          </property>
-          <property name="sizeHint" stdset="0">
-           <size>
-            <width>0</width>
-            <height>0</height>
-           </size>
-          </property>
-         </spacer>
-        </item>
-       </layout>
-      </item>
-     </layout>
-    </item>
-    <item>
-     <layout class="QHBoxLayout">
-      <property name="spacing">
-       <number>6</number>
-      </property>
-      <property name="margin">
-       <number>0</number>
-      </property>
-      <item>
-       <layout class="QVBoxLayout">
-        <property name="spacing">
-         <number>6</number>
-        </property>
-        <property name="margin">
-         <number>0</number>
-        </property>
-        <item>
-         <spacer>
-          <property name="orientation">
-           <enum>Qt::Vertical</enum>
-          </property>
-          <property name="sizeType">
-           <enum>QSizePolicy::Expanding</enum>
-          </property>
-          <property name="sizeHint" stdset="0">
-           <size>
-            <width>0</width>
-            <height>0</height>
-           </size>
-          </property>
-         </spacer>
-        </item>
-        <item>
-         <widget class="ADM_QSlider" name="horizontalSlider">
-          <property name="sizePolicy">
-           <sizepolicy hsizetype="Expanding" vsizetype="Fixed">
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
-          </property>
-          <property name="orientation">
-           <enum>Qt::Horizontal</enum>
-          </property>
-         </widget>
-        </item>
-        <item>
-         <layout class="QHBoxLayout">
-          <property name="spacing">
-           <number>6</number>
-          </property>
-          <property name="margin">
-           <number>0</number>
-          </property>
-          <item>
-           <widget class="QToolButton" name="toolButtonPlay">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/player_play.png</normaloff>:/new/prefix1/pics/player_play.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonStop">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/player_stop.png</normaloff>:/new/prefix1/pics/player_stop.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonPreviousFrame">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/back.png</normaloff>:/new/prefix1/pics/back.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonNextFrame">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/forward.png</normaloff>:/new/prefix1/pics/forward.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonPreviousIntraFrame">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/player_rew.png</normaloff>:/new/prefix1/pics/player_rew.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonNextIntraFrame">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/player_fwd.png</normaloff>:/new/prefix1/pics/player_fwd.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonSetMarkerA">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/markA.png</normaloff>:/new/prefix1/pics/markA.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonSetMarkerB">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/markB.png</normaloff>:/new/prefix1/pics/markB.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonPreviousBlackFrame">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/prev_black.png</normaloff>:/new/prefix1/pics/prev_black.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonNextBlackFrame">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/next_black.png</normaloff>:/new/prefix1/pics/next_black.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonFirstFrame">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/player_start.png</normaloff>:/new/prefix1/pics/player_start.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonLastFrame">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/player_end.png</normaloff>:/new/prefix1/pics/player_end.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <spacer>
-            <property name="orientation">
-             <enum>Qt::Horizontal</enum>
-            </property>
-            <property name="sizeHint" stdset="0">
-             <size>
-              <width>20</width>
-              <height>20</height>
-             </size>
-            </property>
-           </spacer>
-          </item>
-         </layout>
-        </item>
-        <item>
-         <layout class="QHBoxLayout">
-          <property name="spacing">
-           <number>6</number>
-          </property>
-          <property name="margin">
-           <number>0</number>
-          </property>
-          <item>
-           <widget class="QLabel" name="label_6">
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="font">
-             <font>
-              <family>MS Shell Dlg 2</family>
-              <pointsize>8</pointsize>
-              <weight>75</weight>
-              <italic>false</italic>
-              <bold>true</bold>
-              <underline>false</underline>
-              <strikeout>false</strikeout>
-             </font>
-            </property>
-            <property name="text">
-             <string>Time:</string>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QLineEdit" name="currentTime">
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="maximumSize">
-             <size>
-              <width>84</width>
-              <height>16777215</height>
-             </size>
-            </property>
-            <property name="text">
-             <string>00:00:00.000</string>
-            </property>
-            <property name="maxLength">
-             <number>12</number>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QLabel" name="totalTime">
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="text">
-             <string>/ 00:00:00.000</string>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <spacer>
-            <property name="orientation">
-             <enum>Qt::Horizontal</enum>
-            </property>
-            <property name="sizeType">
-             <enum>QSizePolicy::Fixed</enum>
-            </property>
-            <property name="sizeHint" stdset="0">
-             <size>
-              <width>20</width>
-              <height>20</height>
-             </size>
-            </property>
-           </spacer>
-          </item>
-          <item>
-           <widget class="QLabel" name="label_14">
-            <property name="font">
-             <font>
-              <family>MS Shell Dlg 2</family>
-              <pointsize>8</pointsize>
-              <weight>75</weight>
-              <italic>false</italic>
-              <bold>true</bold>
-              <underline>false</underline>
-              <strikeout>false</strikeout>
-             </font>
-            </property>
-            <property name="text">
-             <string>Frame Type:</string>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QLabel" name="label_8">
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="text">
-             <string>?</string>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <spacer>
-            <property name="orientation">
-             <enum>Qt::Horizontal</enum>
-            </property>
-            <property name="sizeHint" stdset="0">
-             <size>
-              <width>60</width>
-              <height>20</height>
-             </size>
-            </property>
-           </spacer>
-          </item>
-         </layout>
-        </item>
-       </layout>
-      </item>
-      <item>
-       <spacer>
-        <property name="orientation">
-         <enum>Qt::Horizontal</enum>
-        </property>
-        <property name="sizeType">
-         <enum>QSizePolicy::Fixed</enum>
-        </property>
-        <property name="sizeHint" stdset="0">
-         <size>
-          <width>14</width>
-          <height>95</height>
-         </size>
-        </property>
-       </spacer>
-      </item>
-      <item>
-       <layout class="QVBoxLayout" name="verticalLayout">
-        <item>
-         <spacer name="verticalSpacer">
-          <property name="orientation">
-           <enum>Qt::Vertical</enum>
-          </property>
-          <property name="sizeHint" stdset="0">
-           <size>
-            <width>20</width>
-            <height>40</height>
-           </size>
-          </property>
-         </spacer>
-        </item>
-        <item>
-         <widget class="QFrame" name="frameVU">
-          <property name="minimumSize">
-           <size>
-            <width>64</width>
-            <height>64</height>
-           </size>
-          </property>
-          <property name="frameShape">
-           <enum>QFrame::StyledPanel</enum>
-          </property>
-          <property name="frameShadow">
-           <enum>QFrame::Raised</enum>
-          </property>
-         </widget>
-        </item>
-       </layout>
-      </item>
-      <item>
-       <spacer name="horizontalSpacer">
-        <property name="orientation">
-         <enum>Qt::Horizontal</enum>
-        </property>
-        <property name="sizeHint" stdset="0">
-         <size>
-          <width>40</width>
-          <height>20</height>
-         </size>
-        </property>
-       </spacer>
-      </item>
-      <item>
-       <layout class="QVBoxLayout">
-        <property name="spacing">
-         <number>6</number>
-        </property>
-        <property name="margin">
-         <number>0</number>
-        </property>
-        <item>
-         <spacer>
-          <property name="orientation">
-           <enum>Qt::Vertical</enum>
-          </property>
-          <property name="sizeType">
-           <enum>QSizePolicy::Expanding</enum>
-          </property>
-          <property name="sizeHint" stdset="0">
-           <size>
-            <width>0</width>
-            <height>0</height>
-           </size>
-          </property>
-         </spacer>
-        </item>
-        <item>
-         <widget class="QGroupBox" name="groupBox">
-          <property name="sizePolicy">
-           <sizepolicy hsizetype="Minimum" vsizetype="Minimum">
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
-          </property>
-          <property name="minimumSize">
-           <size>
-            <width>116</width>
-            <height>80</height>
-           </size>
-          </property>
-          <property name="font">
-           <font>
-            <family>MS Shell Dlg 2</family>
-            <pointsize>8</pointsize>
-            <weight>75</weight>
-            <italic>false</italic>
-            <bold>true</bold>
-            <underline>false</underline>
-            <strikeout>false</strikeout>
-           </font>
-          </property>
-          <property name="title">
-           <string>Selection</string>
-          </property>
-          <property name="alignment">
-           <set>Qt::AlignLeading|Qt::AlignLeft|Qt::AlignVCenter</set>
-          </property>
-          <widget class="QLabel" name="label_11">
-           <property name="geometry">
-            <rect>
-             <x>10</x>
-             <y>50</y>
-             <width>16</width>
-             <height>23</height>
-            </rect>
+    <layout class="QHBoxLayout">
+     <property name="spacing">
+      <number>6</number>
+     </property>
+     <property name="margin">
+      <number>0</number>
+     </property>
+     <item>
+      <layout class="QVBoxLayout">
+       <property name="spacing">
+        <number>6</number>
+       </property>
+       <property name="margin">
+        <number>0</number>
+       </property>
+       <item>
+        <spacer>
+         <property name="orientation">
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeType">
+          <enum>QSizePolicy::Expanding</enum>
+         </property>
+         <property name="sizeHint" stdset="0">
+          <size>
+           <width>0</width>
+           <height>0</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+       <item>
+        <widget class="ADM_QSlider" name="horizontalSlider">
+         <property name="sizePolicy">
+          <sizepolicy hsizetype="Expanding" vsizetype="Fixed">
+           <horstretch>0</horstretch>
+           <verstretch>0</verstretch>
+          </sizepolicy>
+         </property>
+         <property name="orientation">
+          <enum>Qt::Horizontal</enum>
+         </property>
+        </widget>
+       </item>
+       <item>
+        <layout class="QHBoxLayout">
+         <property name="spacing">
+          <number>6</number>
+         </property>
+         <property name="margin">
+          <number>0</number>
+         </property>
+         <item>
+          <widget class="QToolButton" name="toolButtonPlay">
+           <property name="text">
+            <string>...</string>
            </property>
-           <property name="font">
-            <font>
-             <family>MS Shell Dlg 2</family>
-             <pointsize>8</pointsize>
-             <weight>50</weight>
-             <italic>false</italic>
-             <bold>false</bold>
-             <underline>false</underline>
-             <strikeout>false</strikeout>
-            </font>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/player_play.png</normaloff>:/new/prefix1/pics/player_play.png</iconset>
            </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonStop">
            <property name="text">
-            <string> B:</string>
+            <string>...</string>
            </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/player_stop.png</normaloff>:/new/prefix1/pics/player_stop.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
           </widget>
-          <widget class="QLabel" name="label_12">
-           <property name="geometry">
-            <rect>
-             <x>10</x>
-             <y>20</y>
-             <width>16</width>
-             <height>23</height>
-            </rect>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonPreviousFrame">
+           <property name="text">
+            <string>...</string>
            </property>
-           <property name="font">
-            <font>
-             <family>MS Shell Dlg 2</family>
-             <pointsize>8</pointsize>
-             <weight>50</weight>
-             <italic>false</italic>
-             <bold>false</bold>
-             <underline>false</underline>
-             <strikeout>false</strikeout>
-            </font>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/back.png</normaloff>:/new/prefix1/pics/back.png</iconset>
            </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonNextFrame">
            <property name="text">
-            <string> A:</string>
+            <string>...</string>
            </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/forward.png</normaloff>:/new/prefix1/pics/forward.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
           </widget>
-          <widget class="QPushButton" name="pushButtonJumpToMarkerA">
-           <property name="geometry">
-            <rect>
-             <x>30</x>
-             <y>20</y>
-             <width>75</width>
-             <height>23</height>
-            </rect>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonPreviousIntraFrame">
+           <property name="text">
+            <string>...</string>
            </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/player_rew.png</normaloff>:/new/prefix1/pics/player_rew.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonNextIntraFrame">
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/player_fwd.png</normaloff>:/new/prefix1/pics/player_fwd.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonSetMarkerA">
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/markA.png</normaloff>:/new/prefix1/pics/markA.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonSetMarkerB">
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/markB.png</normaloff>:/new/prefix1/pics/markB.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonPreviousBlackFrame">
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/prev_black.png</normaloff>:/new/prefix1/pics/prev_black.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonNextBlackFrame">
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/next_black.png</normaloff>:/new/prefix1/pics/next_black.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonFirstFrame">
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/player_start.png</normaloff>:/new/prefix1/pics/player_start.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonLastFrame">
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/player_end.png</normaloff>:/new/prefix1/pics/player_end.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <spacer>
+           <property name="orientation">
+            <enum>Qt::Horizontal</enum>
+           </property>
+           <property name="sizeHint" stdset="0">
+            <size>
+             <width>20</width>
+             <height>20</height>
+            </size>
+           </property>
+          </spacer>
+         </item>
+        </layout>
+       </item>
+       <item>
+        <layout class="QHBoxLayout">
+         <property name="spacing">
+          <number>6</number>
+         </property>
+         <property name="margin">
+          <number>0</number>
+         </property>
+         <item>
+          <widget class="QLabel" name="label_6">
            <property name="sizePolicy">
-            <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+            <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
              <horstretch>0</horstretch>
              <verstretch>0</verstretch>
             </sizepolicy>
@@ -1131,151 +362,968 @@
             <font>
              <family>MS Shell Dlg 2</family>
              <pointsize>8</pointsize>
-             <weight>50</weight>
+             <weight>75</weight>
              <italic>false</italic>
-             <bold>false</bold>
+             <bold>true</bold>
              <underline>false</underline>
              <strikeout>false</strikeout>
             </font>
            </property>
            <property name="text">
-            <string>000000</string>
+            <string>Time:</string>
            </property>
           </widget>
-          <widget class="QPushButton" name="pushButtonJumpToMarkerB">
-           <property name="geometry">
-            <rect>
-             <x>30</x>
-             <y>50</y>
-             <width>75</width>
-             <height>23</height>
-            </rect>
+         </item>
+         <item>
+          <widget class="QLineEdit" name="currentTime">
+           <property name="sizePolicy">
+            <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
+             <horstretch>0</horstretch>
+             <verstretch>0</verstretch>
+            </sizepolicy>
            </property>
+           <property name="maximumSize">
+            <size>
+             <width>84</width>
+             <height>16777215</height>
+            </size>
+           </property>
+           <property name="text">
+            <string>00:00:00.000</string>
+           </property>
+           <property name="maxLength">
+            <number>12</number>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QLabel" name="totalTime">
            <property name="sizePolicy">
-            <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+            <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
              <horstretch>0</horstretch>
              <verstretch>0</verstretch>
             </sizepolicy>
            </property>
+           <property name="text">
+            <string>/ 00:00:00.000</string>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <spacer>
+           <property name="orientation">
+            <enum>Qt::Horizontal</enum>
+           </property>
+           <property name="sizeType">
+            <enum>QSizePolicy::Fixed</enum>
+           </property>
+           <property name="sizeHint" stdset="0">
+            <size>
+             <width>20</width>
+             <height>20</height>
+            </size>
+           </property>
+          </spacer>
+         </item>
+         <item>
+          <widget class="QLabel" name="label_14">
            <property name="font">
             <font>
              <family>MS Shell Dlg 2</family>
              <pointsize>8</pointsize>
-             <weight>50</weight>
+             <weight>75</weight>
              <italic>false</italic>
-             <bold>false</bold>
+             <bold>true</bold>
              <underline>false</underline>
              <strikeout>false</strikeout>
             </font>
            </property>
-           <property name="layoutDirection">
-            <enum>Qt::LeftToRight</enum>
+           <property name="text">
+            <string>Frame Type:</string>
            </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QLabel" name="label_8">
+           <property name="sizePolicy">
+            <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
+             <horstretch>0</horstretch>
+             <verstretch>0</verstretch>
+            </sizepolicy>
+           </property>
            <property name="text">
-            <string>000000</string>
+            <string>?</string>
            </property>
           </widget>
-         </widget>
-        </item>
-       </layout>
-      </item>
-      <item>
-       <spacer>
-        <property name="orientation">
-         <enum>Qt::Horizontal</enum>
-        </property>
-        <property name="sizeType">
-         <enum>QSizePolicy::Fixed</enum>
-        </property>
-        <property name="sizeHint" stdset="0">
-         <size>
-          <width>14</width>
-          <height>95</height>
-         </size>
-        </property>
-       </spacer>
-      </item>
-      <item>
-       <layout class="QVBoxLayout">
-        <property name="spacing">
-         <number>4</number>
-        </property>
-        <property name="margin">
-         <number>0</number>
-        </property>
-        <item>
-         <spacer>
-          <property name="orientation">
-           <enum>Qt::Vertical</enum>
+         </item>
+         <item>
+          <spacer>
+           <property name="orientation">
+            <enum>Qt::Horizontal</enum>
+           </property>
+           <property name="sizeHint" stdset="0">
+            <size>
+             <width>60</width>
+             <height>20</height>
+            </size>
+           </property>
+          </spacer>
+         </item>
+        </layout>
+       </item>
+      </layout>
+     </item>
+     <item>
+      <spacer>
+       <property name="orientation">
+        <enum>Qt::Horizontal</enum>
+       </property>
+       <property name="sizeType">
+        <enum>QSizePolicy::Fixed</enum>
+       </property>
+       <property name="sizeHint" stdset="0">
+        <size>
+         <width>14</width>
+         <height>95</height>
+        </size>
+       </property>
+      </spacer>
+     </item>
+     <item>
+      <layout class="QVBoxLayout" name="verticalLayout">
+       <item>
+        <spacer name="verticalSpacer">
+         <property name="orientation">
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeHint" stdset="0">
+          <size>
+           <width>20</width>
+           <height>40</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+       <item>
+        <widget class="QFrame" name="frameVU">
+         <property name="minimumSize">
+          <size>
+           <width>64</width>
+           <height>64</height>
+          </size>
+         </property>
+         <property name="frameShape">
+          <enum>QFrame::StyledPanel</enum>
+         </property>
+         <property name="frameShadow">
+          <enum>QFrame::Raised</enum>
+         </property>
+        </widget>
+       </item>
+      </layout>
+     </item>
+     <item>
+      <spacer name="horizontalSpacer">
+       <property name="orientation">
+        <enum>Qt::Horizontal</enum>
+       </property>
+       <property name="sizeHint" stdset="0">
+        <size>
+         <width>40</width>
+         <height>20</height>
+        </size>
+       </property>
+      </spacer>
+     </item>
+     <item>
+      <layout class="QVBoxLayout">
+       <property name="spacing">
+        <number>6</number>
+       </property>
+       <property name="margin">
+        <number>0</number>
+       </property>
+       <item>
+        <spacer>
+         <property name="orientation">
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeType">
+          <enum>QSizePolicy::Expanding</enum>
+         </property>
+         <property name="sizeHint" stdset="0">
+          <size>
+           <width>0</width>
+           <height>0</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+       <item>
+        <widget class="QGroupBox" name="groupBox">
+         <property name="sizePolicy">
+          <sizepolicy hsizetype="Minimum" vsizetype="Minimum">
+           <horstretch>0</horstretch>
+           <verstretch>0</verstretch>
+          </sizepolicy>
+         </property>
+         <property name="minimumSize">
+          <size>
+           <width>116</width>
+           <height>80</height>
+          </size>
+         </property>
+         <property name="font">
+          <font>
+           <family>MS Shell Dlg 2</family>
+           <pointsize>8</pointsize>
+           <weight>75</weight>
+           <italic>false</italic>
+           <bold>true</bold>
+           <underline>false</underline>
+           <strikeout>false</strikeout>
+          </font>
+         </property>
+         <property name="title">
+          <string>Selection</string>
+         </property>
+         <property name="alignment">
+          <set>Qt::AlignLeading|Qt::AlignLeft|Qt::AlignVCenter</set>
+         </property>
+         <widget class="QWidget" name="">
+          <property name="geometry">
+           <rect>
+            <x>10</x>
+            <y>10</y>
+            <width>101</width>
+            <height>61</height>
+           </rect>
           </property>
-          <property name="sizeType">
-           <enum>QSizePolicy::Expanding</enum>
-          </property>
-          <property name="sizeHint" stdset="0">
-           <size>
-            <width>0</width>
-            <height>0</height>
-           </size>
-          </property>
-         </spacer>
-        </item>
-        <item>
-         <widget class="QToolButton" name="toolButtonAudioToggle">
-          <property name="enabled">
-           <bool>true</bool>
-          </property>
-          <property name="text">
-           <string>...</string>
-          </property>
-          <property name="icon">
-           <iconset resource="avidemux.qrc">
-            <normaloff>:/new/prefix1/pics/arts.png</normaloff>:/new/prefix1/pics/arts.png</iconset>
-          </property>
-          <property name="checkable">
-           <bool>true</bool>
-          </property>
-          <property name="checked">
-           <bool>true</bool>
-          </property>
+          <layout class="QVBoxLayout" name="verticalLayout_4">
+           <item>
+            <widget class="QLabel" name="label_12">
+             <property name="font">
+              <font>
+               <family>MS Shell Dlg 2</family>
+               <pointsize>8</pointsize>
+               <weight>50</weight>
+               <italic>false</italic>
+               <bold>false</bold>
+               <underline>false</underline>
+               <strikeout>false</strikeout>
+              </font>
+             </property>
+             <property name="text">
+              <string> A:</string>
+             </property>
+            </widget>
+           </item>
+           <item>
+            <widget class="QPushButton" name="pushButtonJumpToMarkerA">
+             <property name="sizePolicy">
+              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+               <horstretch>0</horstretch>
+               <verstretch>0</verstretch>
+              </sizepolicy>
+             </property>
+             <property name="font">
+              <font>
+               <family>MS Shell Dlg 2</family>
+               <pointsize>8</pointsize>
+               <weight>50</weight>
+               <italic>false</italic>
+               <bold>false</bold>
+               <underline>false</underline>
+               <strikeout>false</strikeout>
+              </font>
+             </property>
+             <property name="text">
+              <string>000000</string>
+             </property>
+            </widget>
+           </item>
+           <item>
+            <widget class="QLabel" name="label_11">
+             <property name="font">
+              <font>
+               <family>MS Shell Dlg 2</family>
+               <pointsize>8</pointsize>
+               <weight>50</weight>
+               <italic>false</italic>
+               <bold>false</bold>
+               <underline>false</underline>
+               <strikeout>false</strikeout>
+              </font>
+             </property>
+             <property name="text">
+              <string> B:</string>
+             </property>
+            </widget>
+           </item>
+           <item>
+            <widget class="QPushButton" name="pushButtonJumpToMarkerB">
+             <property name="sizePolicy">
+              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+               <horstretch>0</horstretch>
+               <verstretch>0</verstretch>
+              </sizepolicy>
+             </property>
+             <property name="font">
+              <font>
+               <family>MS Shell Dlg 2</family>
+               <pointsize>8</pointsize>
+               <weight>50</weight>
+               <italic>false</italic>
+               <bold>false</bold>
+               <underline>false</underline>
+               <strikeout>false</strikeout>
+              </font>
+             </property>
+             <property name="layoutDirection">
+              <enum>Qt::LeftToRight</enum>
+             </property>
+             <property name="text">
+              <string>000000</string>
+             </property>
+            </widget>
+           </item>
+          </layout>
          </widget>
-        </item>
-        <item>
-         <widget class="QSlider" name="horizontalSlider_2">
-          <property name="sizePolicy">
-           <sizepolicy hsizetype="Preferred" vsizetype="Minimum">
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
-          </property>
-          <property name="maximumSize">
-           <size>
-            <width>16777215</width>
-            <height>64</height>
-           </size>
-          </property>
-          <property name="maximum">
-           <number>100</number>
-          </property>
-          <property name="value">
-           <number>100</number>
-          </property>
-          <property name="orientation">
-           <enum>Qt::Vertical</enum>
-          </property>
-         </widget>
-        </item>
-       </layout>
-      </item>
-     </layout>
-    </item>
-   </layout>
+        </widget>
+       </item>
+      </layout>
+     </item>
+     <item>
+      <spacer>
+       <property name="orientation">
+        <enum>Qt::Horizontal</enum>
+       </property>
+       <property name="sizeType">
+        <enum>QSizePolicy::Fixed</enum>
+       </property>
+       <property name="sizeHint" stdset="0">
+        <size>
+         <width>14</width>
+         <height>95</height>
+        </size>
+       </property>
+      </spacer>
+     </item>
+     <item>
+      <layout class="QVBoxLayout">
+       <property name="spacing">
+        <number>4</number>
+       </property>
+       <property name="margin">
+        <number>0</number>
+       </property>
+       <item>
+        <spacer>
+         <property name="orientation">
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeType">
+          <enum>QSizePolicy::Expanding</enum>
+         </property>
+         <property name="sizeHint" stdset="0">
+          <size>
+           <width>0</width>
+           <height>0</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+       <item>
+        <widget class="QToolButton" name="toolButtonAudioToggle">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="text">
+          <string>...</string>
+         </property>
+         <property name="icon">
+          <iconset resource="avidemux.qrc">
+           <normaloff>:/new/prefix1/pics/arts.png</normaloff>:/new/prefix1/pics/arts.png</iconset>
+         </property>
+         <property name="checkable">
+          <bool>true</bool>
+         </property>
+         <property name="checked">
+          <bool>true</bool>
+         </property>
+        </widget>
+       </item>
+       <item>
+        <widget class="QSlider" name="horizontalSlider_2">
+         <property name="sizePolicy">
+          <sizepolicy hsizetype="Preferred" vsizetype="Minimum">
+           <horstretch>0</horstretch>
+           <verstretch>0</verstretch>
+          </sizepolicy>
+         </property>
+         <property name="maximumSize">
+          <size>
+           <width>16777215</width>
+           <height>64</height>
+          </size>
+         </property>
+         <property name="maximum">
+          <number>100</number>
+         </property>
+         <property name="value">
+          <number>100</number>
+         </property>
+         <property name="orientation">
+          <enum>Qt::Vertical</enum>
+         </property>
+        </widget>
+       </item>
+      </layout>
+     </item>
+    </layout>
+   </widget>
+   <widget class="QWidget" name="">
+    <property name="geometry">
+     <rect>
+      <x>10</x>
+      <y>14</y>
+      <width>781</width>
+      <height>477</height>
+     </rect>
+    </property>
+    <layout class="QHBoxLayout" name="horizontalLayout_2">
+     <item>
+      <layout class="QVBoxLayout" name="verticalLayout_3">
+       <item>
+        <widget class="QLabel" name="label_7">
+         <property name="sizePolicy">
+          <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+           <horstretch>0</horstretch>
+           <verstretch>0</verstretch>
+          </sizepolicy>
+         </property>
+         <property name="maximumSize">
+          <size>
+           <width>180</width>
+           <height>16777215</height>
+          </size>
+         </property>
+         <property name="text">
+          <string>&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0//EN&quot; &quot;http://www.w3.org/TR/REC-html40/strict.dtd&quot;&gt;
+&lt;html&gt;&lt;head&gt;&lt;meta name=&quot;qrichtext&quot; content=&quot;1&quot; /&gt;&lt;style type=&quot;text/css&quot;&gt;
+p, li { white-space: pre-wrap; }
+&lt;/style&gt;&lt;/head&gt;&lt;body style=&quot; font-family:'DejaVu Sans'; font-size:8pt; font-weight:400; font-style:normal;&quot;&gt;
+&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;&lt;span style=&quot; font-weight:600;&quot;&gt;Decoder&lt;/span&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</string>
+         </property>
+         <property name="textFormat">
+          <enum>Qt::AutoText</enum>
+         </property>
+        </widget>
+       </item>
+       <item>
+        <spacer name="spacer">
+         <property name="orientation">
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeType">
+          <enum>QSizePolicy::Fixed</enum>
+         </property>
+         <property name="sizeHint" stdset="0">
+          <size>
+           <width>20</width>
+           <height>13</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+       <item>
+        <layout class="QHBoxLayout" name="videoLayout_2">
+         <property name="spacing">
+          <number>0</number>
+         </property>
+         <property name="margin">
+          <number>0</number>
+         </property>
+         <item>
+          <spacer>
+           <property name="orientation">
+            <enum>Qt::Horizontal</enum>
+           </property>
+           <property name="sizeType">
+            <enum>QSizePolicy::Fixed</enum>
+           </property>
+           <property name="sizeHint" stdset="0">
+            <size>
+             <width>12</width>
+             <height>0</height>
+            </size>
+           </property>
+          </spacer>
+         </item>
+         <item>
+          <layout class="QVBoxLayout" name="_2">
+           <property name="spacing">
+            <number>6</number>
+           </property>
+           <property name="margin">
+            <number>0</number>
+           </property>
+           <item>
+            <widget class="QLabel" name="labelVideoDecoder">
+             <property name="text">
+              <string>XXXX</string>
+             </property>
+            </widget>
+           </item>
+           <item>
+            <widget class="QPushButton" name="pushButtonDecoderConf">
+             <property name="enabled">
+              <bool>true</bool>
+             </property>
+             <property name="sizePolicy">
+              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+               <horstretch>0</horstretch>
+               <verstretch>0</verstretch>
+              </sizepolicy>
+             </property>
+             <property name="text">
+              <string>Configure</string>
+             </property>
+            </widget>
+           </item>
+          </layout>
+         </item>
+        </layout>
+       </item>
+       <item>
+        <spacer name="spacer_2">
+         <property name="orientation">
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeType">
+          <enum>QSizePolicy::Fixed</enum>
+         </property>
+         <property name="sizeHint" stdset="0">
+          <size>
+           <width>13</width>
+           <height>14</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+       <item>
+        <widget class="QLabel" name="label_3">
+         <property name="sizePolicy">
+          <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+           <horstretch>0</horstretch>
+           <verstretch>0</verstretch>
+          </sizepolicy>
+         </property>
+         <property name="maximumSize">
+          <size>
+           <width>180</width>
+           <height>16777215</height>
+          </size>
+         </property>
+         <property name="text">
+          <string>&lt;b&gt;Video&lt;/b&gt;</string>
+         </property>
+         <property name="textFormat">
+          <enum>Qt::AutoText</enum>
+         </property>
+        </widget>
+       </item>
+       <item>
+        <layout class="QHBoxLayout" name="videoLayout">
+         <property name="spacing">
+          <number>0</number>
+         </property>
+         <property name="margin">
+          <number>0</number>
+         </property>
+         <item>
+          <spacer>
+           <property name="orientation">
+            <enum>Qt::Horizontal</enum>
+           </property>
+           <property name="sizeType">
+            <enum>QSizePolicy::Fixed</enum>
+           </property>
+           <property name="sizeHint" stdset="0">
+            <size>
+             <width>12</width>
+             <height>0</height>
+            </size>
+           </property>
+          </spacer>
+         </item>
+         <item>
+          <layout class="QVBoxLayout">
+           <property name="spacing">
+            <number>6</number>
+           </property>
+           <property name="margin">
+            <number>0</number>
+           </property>
+           <item>
+            <widget class="QComboBox" name="comboBoxVideo">
+             <property name="sizePolicy">
+              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+               <horstretch>0</horstretch>
+               <verstretch>0</verstretch>
+              </sizepolicy>
+             </property>
+             <item>
+              <property name="text">
+               <string>Copy</string>
+              </property>
+             </item>
+            </widget>
+           </item>
+           <item>
+            <widget class="QPushButton" name="pushButtonVideoConf">
+             <property name="enabled">
+              <bool>true</bool>
+             </property>
+             <property name="sizePolicy">
+              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+               <horstretch>0</horstretch>
+               <verstretch>0</verstretch>
+              </sizepolicy>
+             </property>
+             <property name="text">
+              <string>Configure</string>
+             </property>
+            </widget>
+           </item>
+           <item>
+            <widget class="QPushButton" name="pushButtonVideoFilter">
+             <property name="enabled">
+              <bool>true</bool>
+             </property>
+             <property name="sizePolicy">
+              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+               <horstretch>0</horstretch>
+               <verstretch>0</verstretch>
+              </sizepolicy>
+             </property>
+             <property name="text">
+              <string>Filters</string>
+             </property>
+            </widget>
+           </item>
+          </layout>
+         </item>
+        </layout>
+       </item>
+       <item>
+        <spacer>
+         <property name="orientation">
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeType">
+          <enum>QSizePolicy::Fixed</enum>
+         </property>
+         <property name="sizeHint" stdset="0">
+          <size>
+           <width>13</width>
+           <height>14</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+       <item>
+        <widget class="QLabel" name="label_5">
+         <property name="sizePolicy">
+          <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+           <horstretch>0</horstretch>
+           <verstretch>0</verstretch>
+          </sizepolicy>
+         </property>
+         <property name="maximumSize">
+          <size>
+           <width>180</width>
+           <height>16777215</height>
+          </size>
+         </property>
+         <property name="text">
+          <string>&lt;b&gt;Audio&lt;/b&gt;</string>
+         </property>
+         <property name="textFormat">
+          <enum>Qt::AutoText</enum>
+         </property>
+        </widget>
+       </item>
+       <item>
+        <layout class="QHBoxLayout" name="AudioLayout">
+         <property name="spacing">
+          <number>0</number>
+         </property>
+         <property name="margin">
+          <number>0</number>
+         </property>
+         <item>
+          <spacer>
+           <property name="orientation">
+            <enum>Qt::Horizontal</enum>
+           </property>
+           <property name="sizeType">
+            <enum>QSizePolicy::Fixed</enum>
+           </property>
+           <property name="sizeHint" stdset="0">
+            <size>
+             <width>12</width>
+             <height>0</height>
+            </size>
+           </property>
+          </spacer>
+         </item>
+         <item>
+          <layout class="QVBoxLayout">
+           <property name="spacing">
+            <number>6</number>
+           </property>
+           <property name="margin">
+            <number>0</number>
+           </property>
+           <item>
+            <widget class="QComboBox" name="comboBoxAudio">
+             <property name="sizePolicy">
+              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+               <horstretch>0</horstretch>
+               <verstretch>0</verstretch>
+              </sizepolicy>
+             </property>
+             <item>
+              <property name="text">
+               <string>Copy</string>
+              </property>
+             </item>
+            </widget>
+           </item>
+           <item>
+            <widget class="QPushButton" name="pushButtonAudioConf">
+             <property name="enabled">
+              <bool>true</bool>
+             </property>
+             <property name="sizePolicy">
+              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+               <horstretch>0</horstretch>
+               <verstretch>0</verstretch>
+              </sizepolicy>
+             </property>
+             <property name="text">
+              <string>Configure</string>
+             </property>
+            </widget>
+           </item>
+           <item>
+            <widget class="QPushButton" name="pushButtonAudioFilter">
+             <property name="enabled">
+              <bool>true</bool>
+             </property>
+             <property name="sizePolicy">
+              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+               <horstretch>0</horstretch>
+               <verstretch>0</verstretch>
+              </sizepolicy>
+             </property>
+             <property name="text">
+              <string>Filters</string>
+             </property>
+            </widget>
+           </item>
+           <item>
+            <layout class="QHBoxLayout">
+             <property name="spacing">
+              <number>6</number>
+             </property>
+             <property name="margin">
+              <number>0</number>
+             </property>
+             <item>
+              <widget class="QCheckBox" name="checkBox_TimeShift">
+               <property name="text">
+                <string>&amp;Shift:</string>
+               </property>
+              </widget>
+             </item>
+             <item>
+              <widget class="QSpinBox" name="spinBox_TimeValue">
+               <property name="sizePolicy">
+                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                 <horstretch>0</horstretch>
+                 <verstretch>0</verstretch>
+                </sizepolicy>
+               </property>
+               <property name="minimum">
+                <number>-99999</number>
+               </property>
+               <property name="maximum">
+                <number>99999</number>
+               </property>
+              </widget>
+             </item>
+            </layout>
+           </item>
+          </layout>
+         </item>
+        </layout>
+       </item>
+       <item>
+        <spacer>
+         <property name="orientation">
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeType">
+          <enum>QSizePolicy::Fixed</enum>
+         </property>
+         <property name="sizeHint" stdset="0">
+          <size>
+           <width>13</width>
+           <height>14</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+       <item>
+        <widget class="QLabel" name="label_4">
+         <property name="sizePolicy">
+          <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+           <horstretch>0</horstretch>
+           <verstretch>0</verstretch>
+          </sizepolicy>
+         </property>
+         <property name="text">
+          <string>&lt;b&gt;Format&lt;/b&gt;</string>
+         </property>
+         <property name="textFormat">
+          <enum>Qt::AutoText</enum>
+         </property>
+        </widget>
+       </item>
+       <item>
+        <layout class="QHBoxLayout" name="horizontalLayout">
+         <item>
+          <spacer>
+           <property name="orientation">
+            <enum>Qt::Horizontal</enum>
+           </property>
+           <property name="sizeType">
+            <enum>QSizePolicy::Fixed</enum>
+           </property>
+           <property name="sizeHint" stdset="0">
+            <size>
+             <width>18</width>
+             <height>13</height>
+            </size>
+           </property>
+          </spacer>
+         </item>
+         <item>
+          <layout class="QVBoxLayout" name="verticalLayout_2">
+           <item>
+            <widget class="QComboBox" name="comboBoxFormat">
+             <property name="sizePolicy">
+              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+               <horstretch>0</horstretch>
+               <verstretch>0</verstretch>
+              </sizepolicy>
+             </property>
+            </widget>
+           </item>
+           <item>
+            <widget class="QPushButton" name="pushButtonFormatConfigure">
+             <property name="enabled">
+              <bool>true</bool>
+             </property>
+             <property name="sizePolicy">
+              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+               <horstretch>0</horstretch>
+               <verstretch>0</verstretch>
+              </sizepolicy>
+             </property>
+             <property name="text">
+              <string>Configure</string>
+             </property>
+            </widget>
+           </item>
+          </layout>
+         </item>
+        </layout>
+       </item>
+      </layout>
+     </item>
+     <item>
+      <layout class="QHBoxLayout">
+       <property name="spacing">
+        <number>6</number>
+       </property>
+       <property name="margin">
+        <number>0</number>
+       </property>
+       <item>
+        <spacer>
+         <property name="orientation">
+          <enum>Qt::Horizontal</enum>
+         </property>
+         <property name="sizeType">
+          <enum>QSizePolicy::Expanding</enum>
+         </property>
+         <property name="sizeHint" stdset="0">
+          <size>
+           <width>0</width>
+           <height>0</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+       <item>
+        <widget class="QFrame" name="frame_video">
+         <property name="sizePolicy">
+          <sizepolicy hsizetype="Expanding" vsizetype="Expanding">
+           <horstretch>0</horstretch>
+           <verstretch>0</verstretch>
+          </sizepolicy>
+         </property>
+         <property name="minimumSize">
+          <size>
+           <width>100</width>
+           <height>100</height>
+          </size>
+         </property>
+         <property name="autoFillBackground">
+          <bool>false</bool>
+         </property>
+         <property name="frameShape">
+          <enum>QFrame::NoFrame</enum>
+         </property>
+         <property name="frameShadow">
+          <enum>QFrame::Raised</enum>
+         </property>
+         <property name="lineWidth">
+          <number>0</number>
+         </property>
+        </widget>
+       </item>
+      </layout>
+     </item>
+    </layout>
+   </widget>
+   <zorder>spacer</zorder>
+   <zorder>label_7</zorder>
+   <zorder>layoutWidget</zorder>
+   <zorder>spacer_2</zorder>
+   <zorder></zorder>
+   <zorder>label_4</zorder>
+   <zorder>verticalSpacer</zorder>
   </widget>
   <widget class="QMenuBar" name="menubar">
    <property name="geometry">
     <rect>
      <x>0</x>
      <y>0</y>
-     <width>800</width>
+     <width>1090</width>
      <height>21</height>
     </rect>
    </property>

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/translation_table.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/translation_table.h	2010-04-08 09:03:35 UTC (rev 6096)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/translation_table.h	2010-04-08 09:03:37 UTC (rev 6097)
@@ -84,6 +84,7 @@
 PROCESS(pushButtonAudioConf, ACT_AudioCodec) \
 PROCESS(pushButtonFormatConfigure, ACT_SetMuxParam) \
 PROCESS(pushButtonAudioFilter, ACT_AudioFilters) \
+PROCESS(pushButtonDecoderConf, ACT_DecoderOption) \
 PROCESS(toolButtonPlay, ACT_PlayAvi) \
 PROCESS(toolButtonStop, ACT_StopAvi) \
 PROCESS(toolButtonPreviousFrame, ACT_PreviousFrame) \

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_codec.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_codec.h	2010-04-08 09:03:35 UTC (rev 6096)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_codec.h	2010-04-08 09:03:37 UTC (rev 6097)
@@ -84,6 +84,7 @@
     {
         return true;
     }
+  virtual const char *getDecoderName(void) {return "????";}
 };
 /* This function is to be implemented by the application, it is just here for reference */
 decoders *ADM_getDecoder (uint32_t fcc, uint32_t w, uint32_t h, uint32_t extraLen, uint8_t * extraData,uint32_t bpp=0);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_codecFFsimple.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_codecFFsimple.h	2010-04-08 09:03:35 UTC (rev 6096)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_codecFFsimple.h	2010-04-08 09:03:37 UTC (rev 6097)
@@ -36,7 +36,7 @@
 
 public:
   decoderFFSimple (uint32_t w, uint32_t h,uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData,uint32_t bpp);
-
+  virtual const char *getDecoderName(void) {return "lavcodec";}
 };
 
 decoders *admCreateFFSimple(uint32_t w, uint32_t h,uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData,uint32_t bpp);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_ffmp43.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_ffmp43.h	2010-04-08 09:03:35 UTC (rev 6096)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_ffmp43.h	2010-04-08 09:03:37 UTC (rev 6097)
@@ -63,6 +63,7 @@
   virtual uint8_t getPARWidth (void);
   virtual uint8_t getPARHeight (void);
   virtual bool    flush(void);
+  virtual const char *getDecoderName(void) {return "Lavcodec";}
 };
 
 class decoderFFDiv3:public decoderFF

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_png.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_png.h	2010-04-08 09:03:35 UTC (rev 6096)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_png.h	2010-04-08 09:03:37 UTC (rev 6097)
@@ -57,7 +57,8 @@
     bool dontcopy (void)
             {
                 return true;
-            }
+            }
+    virtual const char *getDecoderName(void) {return "Png";}
 };
 
 #endif 



From mean at mail.berlios.de  Thu Apr  8 11:03:41 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 8 Apr 2010 11:03:41 +0200
Subject: [Avidemux-svn-commit] r6098 - in
	branches/avidemux_2.6_branch_mean/avidemux: cli/ADM_UIs/src
	cli/ADM_userInterfaces/ADM_dialog gtk/ADM_userInterfaces/ADM_gui2
	qt4/ADM_userInterfaces/ADM_gui
Message-ID: <201004080903.o3893fFw021060@sheep.berlios.de>

Author: mean
Date: 2010-04-08 11:03:40 +0200 (Thu, 08 Apr 2010)
New Revision: 6098

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_UIs/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_gui2/GUI_bindings.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui
Log:
[UI] Add stubs for UI_setDecoderName + fix cli linking with new render

Modified: branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_UIs/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_UIs/src/CMakeLists.txt	2010-04-08 09:03:37 UTC (rev 6097)
+++ branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_UIs/src/CMakeLists.txt	2010-04-08 09:03:40 UTC (rev 6098)
@@ -9,4 +9,5 @@
 INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/../include)
 ADD_LIBRARY(${ADM_LIB}  SHARED ${${ADM_LIB}_SRCS})
 ADD_SOURCE_CFLAGS(DIA_flyDialogCli.cpp " -DADM_UI_TYPE_BUILD=1")
-INSTALL(TARGETS ${ADM_LIB} RUNTIME DESTINATION ${BIN_DIR}  LIBRARY DESTINATION lib  ARCHIVE DESTINATION lib)
+TARGET_LINK_LIBRARIES(${ADM_LIB} ADM_core6 ADM_coreUI6  ADM_render6_cli ADM_coreVideoFilter6)
+ADM_INSTALL_LIB(${ADM_LIB} )

Modified: branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ADM_dialog/DIA_none.cpp	2010-04-08 09:03:37 UTC (rev 6097)
+++ branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ADM_dialog/DIA_none.cpp	2010-04-08 09:03:40 UTC (rev 6098)
@@ -75,31 +75,9 @@
 uint8_t DIA_glyphEdit(void) {return 0;}
 struct THRESHOLD_PARAM;
 struct ADMVideoThreshold;
-uint8_t DIA_threshold(AVDMGenericVideoStream *in,
-                      ADMVideoThreshold * thresholdp,
-                      THRESHOLD_PARAM * param) { return 255; }
 struct SWISSARMYKNIFE_PARAM;
 struct ADMVideoSwissArmyKnife;
 struct MenuMapping;
-uint8_t DIA_SwissArmyKnife (AVDMGenericVideoStream * in,
-                            ADMVideoSwissArmyKnife * sakp,
-                            SWISSARMYKNIFE_PARAM * param,
-                            const MenuMapping * menu_mapping,
-                            uint32_t menu_mapping_count) { return 255; }
-struct ERASER_PARAM;
-struct ADMVideoEraser;
-uint8_t DIA_eraser (AVDMGenericVideoStream * in,
-                    ADMVideoEraser * eraserp,
-                    ERASER_PARAM * param,
-                    const MenuMapping * menu_mapping,
-                    uint32_t menu_mapping_count) { return 255; }
-struct PARTICLE_PARAM;
-struct ADMVideoParticle;
-uint8_t DIA_particle (AVDMGenericVideoStream *in,
-                      ADMVideoParticle * particlep,
-                      PARTICLE_PARAM * param,
-                      const MenuMapping * menu_mapping,
-                      uint32_t menu_mapping_count) { return 255; }
 //uint8_t ADM_ocrUpdateNbLines(void *ui,uint32_t cur,uint32_t total) {return 0;}
 //uint8_t ADM_ocrUpdateNbGlyphs(void *ui,uint32_t nbGlyphs) {return 0;}
 //uint8_t ADM_ocrUpdateTextAndTime(void *ui,char *decodedString,char *timeCode) {	return 0;}
@@ -142,5 +120,5 @@
 	printf("*********************************\n");
 	printf("*********************************\n");
 }
-
+bool UI_setDecoderName(const char *name) {return true;}
 //EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_gui2/GUI_bindings.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_gui2/GUI_bindings.cpp	2010-04-08 09:03:37 UTC (rev 6097)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_gui2/GUI_bindings.cpp	2010-04-08 09:03:40 UTC (rev 6098)
@@ -1597,4 +1597,11 @@
 {
     return true;
 }
+/**
+        \fn UI_setDecoderName
+*/
+bool UI_setDecoderName(const char *name)
+{
+        return true;
+}
 // EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui	2010-04-08 09:03:37 UTC (rev 6097)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui	2010-04-08 09:03:40 UTC (rev 6098)
@@ -7,8 +7,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>1090</width>
-    <height>744</height>
+    <width>782</width>
+    <height>642</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -26,316 +26,441 @@
    </size>
   </property>
   <widget class="QWidget" name="centralwidget">
+   <property name="sizePolicy">
+    <sizepolicy hsizetype="MinimumExpanding" vsizetype="MinimumExpanding">
+     <horstretch>0</horstretch>
+     <verstretch>0</verstretch>
+    </sizepolicy>
+   </property>
+   <property name="minimumSize">
+    <size>
+     <width>640</width>
+     <height>480</height>
+    </size>
+   </property>
    <widget class="QWidget" name="">
     <property name="geometry">
      <rect>
       <x>10</x>
-      <y>500</y>
-      <width>791</width>
-      <height>111</height>
+      <y>10</y>
+      <width>740</width>
+      <height>551</height>
      </rect>
     </property>
-    <layout class="QHBoxLayout">
-     <property name="spacing">
-      <number>6</number>
+    <layout class="QVBoxLayout" name="verticalLayout_5">
+     <property name="sizeConstraint">
+      <enum>QLayout::SetMinAndMaxSize</enum>
      </property>
-     <property name="margin">
-      <number>0</number>
-     </property>
      <item>
-      <layout class="QVBoxLayout">
-       <property name="spacing">
-        <number>6</number>
-       </property>
-       <property name="margin">
-        <number>0</number>
-       </property>
+      <layout class="QHBoxLayout" name="horizontalLayout_2">
        <item>
-        <spacer>
-         <property name="orientation">
-          <enum>Qt::Vertical</enum>
-         </property>
-         <property name="sizeType">
-          <enum>QSizePolicy::Expanding</enum>
-         </property>
-         <property name="sizeHint" stdset="0">
-          <size>
-           <width>0</width>
-           <height>0</height>
-          </size>
-         </property>
-        </spacer>
-       </item>
-       <item>
-        <widget class="ADM_QSlider" name="horizontalSlider">
-         <property name="sizePolicy">
-          <sizepolicy hsizetype="Expanding" vsizetype="Fixed">
-           <horstretch>0</horstretch>
-           <verstretch>0</verstretch>
-          </sizepolicy>
-         </property>
-         <property name="orientation">
-          <enum>Qt::Horizontal</enum>
-         </property>
-        </widget>
-       </item>
-       <item>
-        <layout class="QHBoxLayout">
-         <property name="spacing">
-          <number>6</number>
-         </property>
-         <property name="margin">
-          <number>0</number>
-         </property>
+        <layout class="QVBoxLayout" name="verticalLayout_3">
          <item>
-          <widget class="QToolButton" name="toolButtonPlay">
-           <property name="text">
-            <string>...</string>
+          <widget class="QLabel" name="label_7">
+           <property name="sizePolicy">
+            <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+             <horstretch>0</horstretch>
+             <verstretch>0</verstretch>
+            </sizepolicy>
            </property>
-           <property name="icon">
-            <iconset resource="avidemux.qrc">
-             <normaloff>:/new/prefix1/pics/player_play.png</normaloff>:/new/prefix1/pics/player_play.png</iconset>
-           </property>
-           <property name="iconSize">
+           <property name="maximumSize">
             <size>
-             <width>24</width>
-             <height>24</height>
+             <width>180</width>
+             <height>16777215</height>
             </size>
            </property>
-           <property name="autoRaise">
-            <bool>true</bool>
-           </property>
-          </widget>
-         </item>
-         <item>
-          <widget class="QToolButton" name="toolButtonStop">
            <property name="text">
-            <string>...</string>
+            <string>&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0//EN&quot; &quot;http://www.w3.org/TR/REC-html40/strict.dtd&quot;&gt;
+&lt;html&gt;&lt;head&gt;&lt;meta name=&quot;qrichtext&quot; content=&quot;1&quot; /&gt;&lt;style type=&quot;text/css&quot;&gt;
+p, li { white-space: pre-wrap; }
+&lt;/style&gt;&lt;/head&gt;&lt;body style=&quot; font-family:'DejaVu Sans'; font-size:8pt; font-weight:400; font-style:normal;&quot;&gt;
+&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;&lt;span style=&quot; font-weight:600;&quot;&gt;Video Decoder&lt;/span&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</string>
            </property>
-           <property name="icon">
-            <iconset resource="avidemux.qrc">
-             <normaloff>:/new/prefix1/pics/player_stop.png</normaloff>:/new/prefix1/pics/player_stop.png</iconset>
+           <property name="textFormat">
+            <enum>Qt::AutoText</enum>
            </property>
-           <property name="iconSize">
-            <size>
-             <width>24</width>
-             <height>24</height>
-            </size>
-           </property>
-           <property name="autoRaise">
-            <bool>true</bool>
-           </property>
           </widget>
          </item>
          <item>
-          <widget class="QToolButton" name="toolButtonPreviousFrame">
-           <property name="text">
-            <string>...</string>
+          <layout class="QHBoxLayout" name="videoLayout_2">
+           <property name="spacing">
+            <number>0</number>
            </property>
-           <property name="icon">
-            <iconset resource="avidemux.qrc">
-             <normaloff>:/new/prefix1/pics/back.png</normaloff>:/new/prefix1/pics/back.png</iconset>
+           <property name="margin">
+            <number>0</number>
            </property>
-           <property name="iconSize">
-            <size>
-             <width>24</width>
-             <height>24</height>
-            </size>
-           </property>
-           <property name="autoRaise">
-            <bool>true</bool>
-           </property>
-          </widget>
+           <item>
+            <spacer>
+             <property name="orientation">
+              <enum>Qt::Horizontal</enum>
+             </property>
+             <property name="sizeType">
+              <enum>QSizePolicy::Fixed</enum>
+             </property>
+             <property name="sizeHint" stdset="0">
+              <size>
+               <width>12</width>
+               <height>0</height>
+              </size>
+             </property>
+            </spacer>
+           </item>
+           <item>
+            <layout class="QVBoxLayout" name="_2">
+             <property name="spacing">
+              <number>6</number>
+             </property>
+             <property name="margin">
+              <number>0</number>
+             </property>
+             <item>
+              <widget class="QLabel" name="labelVideoDecoder">
+               <property name="text">
+                <string>XXXX</string>
+               </property>
+              </widget>
+             </item>
+             <item>
+              <widget class="QPushButton" name="pushButtonDecoderConf">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="sizePolicy">
+                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                 <horstretch>0</horstretch>
+                 <verstretch>0</verstretch>
+                </sizepolicy>
+               </property>
+               <property name="text">
+                <string>Configure</string>
+               </property>
+              </widget>
+             </item>
+            </layout>
+           </item>
+          </layout>
          </item>
          <item>
-          <widget class="QToolButton" name="toolButtonNextFrame">
-           <property name="text">
-            <string>...</string>
+          <widget class="QLabel" name="label_3">
+           <property name="sizePolicy">
+            <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+             <horstretch>0</horstretch>
+             <verstretch>0</verstretch>
+            </sizepolicy>
            </property>
-           <property name="icon">
-            <iconset resource="avidemux.qrc">
-             <normaloff>:/new/prefix1/pics/forward.png</normaloff>:/new/prefix1/pics/forward.png</iconset>
-           </property>
-           <property name="iconSize">
+           <property name="maximumSize">
             <size>
-             <width>24</width>
-             <height>24</height>
+             <width>180</width>
+             <height>16777215</height>
             </size>
            </property>
-           <property name="autoRaise">
-            <bool>true</bool>
-           </property>
-          </widget>
-         </item>
-         <item>
-          <widget class="QToolButton" name="toolButtonPreviousIntraFrame">
            <property name="text">
-            <string>...</string>
+            <string>&lt;b&gt;Video&lt;/b&gt;</string>
            </property>
-           <property name="icon">
-            <iconset resource="avidemux.qrc">
-             <normaloff>:/new/prefix1/pics/player_rew.png</normaloff>:/new/prefix1/pics/player_rew.png</iconset>
+           <property name="textFormat">
+            <enum>Qt::AutoText</enum>
            </property>
-           <property name="iconSize">
-            <size>
-             <width>24</width>
-             <height>24</height>
-            </size>
-           </property>
-           <property name="autoRaise">
-            <bool>true</bool>
-           </property>
           </widget>
          </item>
          <item>
-          <widget class="QToolButton" name="toolButtonNextIntraFrame">
-           <property name="text">
-            <string>...</string>
+          <layout class="QHBoxLayout" name="videoLayout">
+           <property name="spacing">
+            <number>0</number>
            </property>
-           <property name="icon">
-            <iconset resource="avidemux.qrc">
-             <normaloff>:/new/prefix1/pics/player_fwd.png</normaloff>:/new/prefix1/pics/player_fwd.png</iconset>
+           <property name="margin">
+            <number>0</number>
            </property>
-           <property name="iconSize">
-            <size>
-             <width>24</width>
-             <height>24</height>
-            </size>
-           </property>
-           <property name="autoRaise">
-            <bool>true</bool>
-           </property>
-          </widget>
+           <item>
+            <spacer>
+             <property name="orientation">
+              <enum>Qt::Horizontal</enum>
+             </property>
+             <property name="sizeType">
+              <enum>QSizePolicy::Fixed</enum>
+             </property>
+             <property name="sizeHint" stdset="0">
+              <size>
+               <width>12</width>
+               <height>0</height>
+              </size>
+             </property>
+            </spacer>
+           </item>
+           <item>
+            <layout class="QVBoxLayout">
+             <property name="spacing">
+              <number>6</number>
+             </property>
+             <property name="margin">
+              <number>0</number>
+             </property>
+             <item>
+              <widget class="QComboBox" name="comboBoxVideo">
+               <property name="sizePolicy">
+                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                 <horstretch>0</horstretch>
+                 <verstretch>0</verstretch>
+                </sizepolicy>
+               </property>
+               <item>
+                <property name="text">
+                 <string>Copy</string>
+                </property>
+               </item>
+              </widget>
+             </item>
+             <item>
+              <widget class="QPushButton" name="pushButtonVideoConf">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="sizePolicy">
+                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                 <horstretch>0</horstretch>
+                 <verstretch>0</verstretch>
+                </sizepolicy>
+               </property>
+               <property name="text">
+                <string>Configure</string>
+               </property>
+              </widget>
+             </item>
+             <item>
+              <widget class="QPushButton" name="pushButtonVideoFilter">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="sizePolicy">
+                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                 <horstretch>0</horstretch>
+                 <verstretch>0</verstretch>
+                </sizepolicy>
+               </property>
+               <property name="text">
+                <string>Filters</string>
+               </property>
+              </widget>
+             </item>
+            </layout>
+           </item>
+          </layout>
          </item>
          <item>
-          <widget class="QToolButton" name="toolButtonSetMarkerA">
-           <property name="text">
-            <string>...</string>
+          <widget class="QLabel" name="label_5">
+           <property name="sizePolicy">
+            <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+             <horstretch>0</horstretch>
+             <verstretch>0</verstretch>
+            </sizepolicy>
            </property>
-           <property name="icon">
-            <iconset resource="avidemux.qrc">
-             <normaloff>:/new/prefix1/pics/markA.png</normaloff>:/new/prefix1/pics/markA.png</iconset>
-           </property>
-           <property name="iconSize">
+           <property name="maximumSize">
             <size>
-             <width>24</width>
-             <height>24</height>
+             <width>180</width>
+             <height>16777215</height>
             </size>
            </property>
-           <property name="autoRaise">
-            <bool>true</bool>
-           </property>
-          </widget>
-         </item>
-         <item>
-          <widget class="QToolButton" name="toolButtonSetMarkerB">
            <property name="text">
-            <string>...</string>
+            <string>&lt;b&gt;Audio&lt;/b&gt;</string>
            </property>
-           <property name="icon">
-            <iconset resource="avidemux.qrc">
-             <normaloff>:/new/prefix1/pics/markB.png</normaloff>:/new/prefix1/pics/markB.png</iconset>
+           <property name="textFormat">
+            <enum>Qt::AutoText</enum>
            </property>
-           <property name="iconSize">
-            <size>
-             <width>24</width>
-             <height>24</height>
-            </size>
-           </property>
-           <property name="autoRaise">
-            <bool>true</bool>
-           </property>
           </widget>
          </item>
          <item>
-          <widget class="QToolButton" name="toolButtonPreviousBlackFrame">
-           <property name="text">
-            <string>...</string>
+          <layout class="QHBoxLayout" name="AudioLayout">
+           <property name="spacing">
+            <number>0</number>
            </property>
-           <property name="icon">
-            <iconset resource="avidemux.qrc">
-             <normaloff>:/new/prefix1/pics/prev_black.png</normaloff>:/new/prefix1/pics/prev_black.png</iconset>
+           <property name="margin">
+            <number>0</number>
            </property>
-           <property name="iconSize">
-            <size>
-             <width>24</width>
-             <height>24</height>
-            </size>
-           </property>
-           <property name="autoRaise">
-            <bool>true</bool>
-           </property>
-          </widget>
+           <item>
+            <spacer>
+             <property name="orientation">
+              <enum>Qt::Horizontal</enum>
+             </property>
+             <property name="sizeType">
+              <enum>QSizePolicy::Fixed</enum>
+             </property>
+             <property name="sizeHint" stdset="0">
+              <size>
+               <width>12</width>
+               <height>0</height>
+              </size>
+             </property>
+            </spacer>
+           </item>
+           <item>
+            <layout class="QVBoxLayout">
+             <property name="spacing">
+              <number>6</number>
+             </property>
+             <property name="margin">
+              <number>0</number>
+             </property>
+             <item>
+              <widget class="QComboBox" name="comboBoxAudio">
+               <property name="sizePolicy">
+                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                 <horstretch>0</horstretch>
+                 <verstretch>0</verstretch>
+                </sizepolicy>
+               </property>
+               <item>
+                <property name="text">
+                 <string>Copy</string>
+                </property>
+               </item>
+              </widget>
+             </item>
+             <item>
+              <widget class="QPushButton" name="pushButtonAudioConf">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="sizePolicy">
+                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                 <horstretch>0</horstretch>
+                 <verstretch>0</verstretch>
+                </sizepolicy>
+               </property>
+               <property name="text">
+                <string>Configure</string>
+               </property>
+              </widget>
+             </item>
+             <item>
+              <widget class="QPushButton" name="pushButtonAudioFilter">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="sizePolicy">
+                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                 <horstretch>0</horstretch>
+                 <verstretch>0</verstretch>
+                </sizepolicy>
+               </property>
+               <property name="text">
+                <string>Filters</string>
+               </property>
+              </widget>
+             </item>
+             <item>
+              <layout class="QHBoxLayout">
+               <property name="spacing">
+                <number>6</number>
+               </property>
+               <property name="margin">
+                <number>0</number>
+               </property>
+               <item>
+                <widget class="QCheckBox" name="checkBox_TimeShift">
+                 <property name="text">
+                  <string>&amp;Shift:</string>
+                 </property>
+                </widget>
+               </item>
+               <item>
+                <widget class="QSpinBox" name="spinBox_TimeValue">
+                 <property name="sizePolicy">
+                  <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                   <horstretch>0</horstretch>
+                   <verstretch>0</verstretch>
+                  </sizepolicy>
+                 </property>
+                 <property name="minimum">
+                  <number>-99999</number>
+                 </property>
+                 <property name="maximum">
+                  <number>99999</number>
+                 </property>
+                </widget>
+               </item>
+              </layout>
+             </item>
+            </layout>
+           </item>
+          </layout>
          </item>
          <item>
-          <widget class="QToolButton" name="toolButtonNextBlackFrame">
-           <property name="text">
-            <string>...</string>
+          <widget class="QLabel" name="label_4">
+           <property name="sizePolicy">
+            <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+             <horstretch>0</horstretch>
+             <verstretch>0</verstretch>
+            </sizepolicy>
            </property>
-           <property name="icon">
-            <iconset resource="avidemux.qrc">
-             <normaloff>:/new/prefix1/pics/next_black.png</normaloff>:/new/prefix1/pics/next_black.png</iconset>
-           </property>
-           <property name="iconSize">
-            <size>
-             <width>24</width>
-             <height>24</height>
-            </size>
-           </property>
-           <property name="autoRaise">
-            <bool>true</bool>
-           </property>
-          </widget>
-         </item>
-         <item>
-          <widget class="QToolButton" name="toolButtonFirstFrame">
            <property name="text">
-            <string>...</string>
+            <string>&lt;b&gt;Format&lt;/b&gt;</string>
            </property>
-           <property name="icon">
-            <iconset resource="avidemux.qrc">
-             <normaloff>:/new/prefix1/pics/player_start.png</normaloff>:/new/prefix1/pics/player_start.png</iconset>
+           <property name="textFormat">
+            <enum>Qt::AutoText</enum>
            </property>
-           <property name="iconSize">
-            <size>
-             <width>24</width>
-             <height>24</height>
-            </size>
-           </property>
-           <property name="autoRaise">
-            <bool>true</bool>
-           </property>
           </widget>
          </item>
          <item>
-          <widget class="QToolButton" name="toolButtonLastFrame">
-           <property name="text">
-            <string>...</string>
-           </property>
-           <property name="icon">
-            <iconset resource="avidemux.qrc">
-             <normaloff>:/new/prefix1/pics/player_end.png</normaloff>:/new/prefix1/pics/player_end.png</iconset>
-           </property>
-           <property name="iconSize">
-            <size>
-             <width>24</width>
-             <height>24</height>
-            </size>
-           </property>
-           <property name="autoRaise">
-            <bool>true</bool>
-           </property>
-          </widget>
+          <layout class="QHBoxLayout" name="horizontalLayout">
+           <item>
+            <spacer>
+             <property name="orientation">
+              <enum>Qt::Horizontal</enum>
+             </property>
+             <property name="sizeType">
+              <enum>QSizePolicy::Fixed</enum>
+             </property>
+             <property name="sizeHint" stdset="0">
+              <size>
+               <width>18</width>
+               <height>13</height>
+              </size>
+             </property>
+            </spacer>
+           </item>
+           <item>
+            <layout class="QVBoxLayout" name="verticalLayout_2">
+             <item>
+              <widget class="QComboBox" name="comboBoxFormat">
+               <property name="sizePolicy">
+                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                 <horstretch>0</horstretch>
+                 <verstretch>0</verstretch>
+                </sizepolicy>
+               </property>
+              </widget>
+             </item>
+             <item>
+              <widget class="QPushButton" name="pushButtonFormatConfigure">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="sizePolicy">
+                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                 <horstretch>0</horstretch>
+                 <verstretch>0</verstretch>
+                </sizepolicy>
+               </property>
+               <property name="text">
+                <string>Configure</string>
+               </property>
+              </widget>
+             </item>
+            </layout>
+           </item>
+          </layout>
          </item>
          <item>
           <spacer>
            <property name="orientation">
-            <enum>Qt::Horizontal</enum>
+            <enum>Qt::Vertical</enum>
            </property>
+           <property name="sizeType">
+            <enum>QSizePolicy::Fixed</enum>
+           </property>
            <property name="sizeHint" stdset="0">
             <size>
-             <width>20</width>
-             <height>20</height>
+             <width>13</width>
+             <height>14</height>
             </size>
            </property>
           </spacer>
@@ -351,61 +476,30 @@
           <number>0</number>
          </property>
          <item>
-          <widget class="QLabel" name="label_6">
+          <widget class="QFrame" name="frame_video">
            <property name="sizePolicy">
-            <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
+            <sizepolicy hsizetype="Expanding" vsizetype="Expanding">
              <horstretch>0</horstretch>
              <verstretch>0</verstretch>
             </sizepolicy>
            </property>
-           <property name="font">
-            <font>
-             <family>MS Shell Dlg 2</family>
-             <pointsize>8</pointsize>
-             <weight>75</weight>
-             <italic>false</italic>
-             <bold>true</bold>
-             <underline>false</underline>
-             <strikeout>false</strikeout>
-            </font>
-           </property>
-           <property name="text">
-            <string>Time:</string>
-           </property>
-          </widget>
-         </item>
-         <item>
-          <widget class="QLineEdit" name="currentTime">
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
-           </property>
-           <property name="maximumSize">
+           <property name="minimumSize">
             <size>
-             <width>84</width>
-             <height>16777215</height>
+             <width>100</width>
+             <height>100</height>
             </size>
            </property>
-           <property name="text">
-            <string>00:00:00.000</string>
+           <property name="autoFillBackground">
+            <bool>false</bool>
            </property>
-           <property name="maxLength">
-            <number>12</number>
+           <property name="frameShape">
+            <enum>QFrame::NoFrame</enum>
            </property>
-          </widget>
-         </item>
-         <item>
-          <widget class="QLabel" name="totalTime">
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
+           <property name="frameShadow">
+            <enum>QFrame::Raised</enum>
            </property>
-           <property name="text">
-            <string>/ 00:00:00.000</string>
+           <property name="lineWidth">
+            <number>0</number>
            </property>
           </widget>
          </item>
@@ -415,550 +509,330 @@
             <enum>Qt::Horizontal</enum>
            </property>
            <property name="sizeType">
-            <enum>QSizePolicy::Fixed</enum>
+            <enum>QSizePolicy::Expanding</enum>
            </property>
            <property name="sizeHint" stdset="0">
             <size>
-             <width>20</width>
-             <height>20</height>
+             <width>0</width>
+             <height>0</height>
             </size>
            </property>
           </spacer>
          </item>
+        </layout>
+       </item>
+      </layout>
+     </item>
+     <item>
+      <layout class="QHBoxLayout">
+       <property name="spacing">
+        <number>6</number>
+       </property>
+       <property name="margin">
+        <number>0</number>
+       </property>
+       <item>
+        <layout class="QVBoxLayout">
+         <property name="spacing">
+          <number>6</number>
+         </property>
+         <property name="margin">
+          <number>0</number>
+         </property>
          <item>
-          <widget class="QLabel" name="label_14">
-           <property name="font">
-            <font>
-             <family>MS Shell Dlg 2</family>
-             <pointsize>8</pointsize>
-             <weight>75</weight>
-             <italic>false</italic>
-             <bold>true</bold>
-             <underline>false</underline>
-             <strikeout>false</strikeout>
-            </font>
+          <spacer>
+           <property name="orientation">
+            <enum>Qt::Vertical</enum>
            </property>
-           <property name="text">
-            <string>Frame Type:</string>
+           <property name="sizeType">
+            <enum>QSizePolicy::Expanding</enum>
            </property>
-          </widget>
+           <property name="sizeHint" stdset="0">
+            <size>
+             <width>0</width>
+             <height>0</height>
+            </size>
+           </property>
+          </spacer>
          </item>
          <item>
-          <widget class="QLabel" name="label_8">
+          <widget class="ADM_QSlider" name="horizontalSlider">
            <property name="sizePolicy">
-            <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
+            <sizepolicy hsizetype="Expanding" vsizetype="Fixed">
              <horstretch>0</horstretch>
              <verstretch>0</verstretch>
             </sizepolicy>
            </property>
-           <property name="text">
-            <string>?</string>
+           <property name="orientation">
+            <enum>Qt::Horizontal</enum>
            </property>
           </widget>
          </item>
          <item>
-          <spacer>
-           <property name="orientation">
-            <enum>Qt::Horizontal</enum>
+          <layout class="QHBoxLayout">
+           <property name="spacing">
+            <number>6</number>
            </property>
-           <property name="sizeHint" stdset="0">
-            <size>
-             <width>60</width>
-             <height>20</height>
-            </size>
+           <property name="margin">
+            <number>0</number>
            </property>
-          </spacer>
-         </item>
-        </layout>
-       </item>
-      </layout>
-     </item>
-     <item>
-      <spacer>
-       <property name="orientation">
-        <enum>Qt::Horizontal</enum>
-       </property>
-       <property name="sizeType">
-        <enum>QSizePolicy::Fixed</enum>
-       </property>
-       <property name="sizeHint" stdset="0">
-        <size>
-         <width>14</width>
-         <height>95</height>
-        </size>
-       </property>
-      </spacer>
-     </item>
-     <item>
-      <layout class="QVBoxLayout" name="verticalLayout">
-       <item>
-        <spacer name="verticalSpacer">
-         <property name="orientation">
-          <enum>Qt::Vertical</enum>
-         </property>
-         <property name="sizeHint" stdset="0">
-          <size>
-           <width>20</width>
-           <height>40</height>
-          </size>
-         </property>
-        </spacer>
-       </item>
-       <item>
-        <widget class="QFrame" name="frameVU">
-         <property name="minimumSize">
-          <size>
-           <width>64</width>
-           <height>64</height>
-          </size>
-         </property>
-         <property name="frameShape">
-          <enum>QFrame::StyledPanel</enum>
-         </property>
-         <property name="frameShadow">
-          <enum>QFrame::Raised</enum>
-         </property>
-        </widget>
-       </item>
-      </layout>
-     </item>
-     <item>
-      <spacer name="horizontalSpacer">
-       <property name="orientation">
-        <enum>Qt::Horizontal</enum>
-       </property>
-       <property name="sizeHint" stdset="0">
-        <size>
-         <width>40</width>
-         <height>20</height>
-        </size>
-       </property>
-      </spacer>
-     </item>
-     <item>
-      <layout class="QVBoxLayout">
-       <property name="spacing">
-        <number>6</number>
-       </property>
-       <property name="margin">
-        <number>0</number>
-       </property>
-       <item>
-        <spacer>
-         <property name="orientation">
-          <enum>Qt::Vertical</enum>
-         </property>
-         <property name="sizeType">
-          <enum>QSizePolicy::Expanding</enum>
-         </property>
-         <property name="sizeHint" stdset="0">
-          <size>
-           <width>0</width>
-           <height>0</height>
-          </size>
-         </property>
-        </spacer>
-       </item>
-       <item>
-        <widget class="QGroupBox" name="groupBox">
-         <property name="sizePolicy">
-          <sizepolicy hsizetype="Minimum" vsizetype="Minimum">
-           <horstretch>0</horstretch>
-           <verstretch>0</verstretch>
-          </sizepolicy>
-         </property>
-         <property name="minimumSize">
-          <size>
-           <width>116</width>
-           <height>80</height>
-          </size>
-         </property>
-         <property name="font">
-          <font>
-           <family>MS Shell Dlg 2</family>
-           <pointsize>8</pointsize>
-           <weight>75</weight>
-           <italic>false</italic>
-           <bold>true</bold>
-           <underline>false</underline>
-           <strikeout>false</strikeout>
-          </font>
-         </property>
-         <property name="title">
-          <string>Selection</string>
-         </property>
-         <property name="alignment">
-          <set>Qt::AlignLeading|Qt::AlignLeft|Qt::AlignVCenter</set>
-         </property>
-         <widget class="QWidget" name="">
-          <property name="geometry">
-           <rect>
-            <x>10</x>
-            <y>10</y>
-            <width>101</width>
-            <height>61</height>
-           </rect>
-          </property>
-          <layout class="QVBoxLayout" name="verticalLayout_4">
            <item>
-            <widget class="QLabel" name="label_12">
-             <property name="font">
-              <font>
-               <family>MS Shell Dlg 2</family>
-               <pointsize>8</pointsize>
-               <weight>50</weight>
-               <italic>false</italic>
-               <bold>false</bold>
-               <underline>false</underline>
-               <strikeout>false</strikeout>
-              </font>
+            <widget class="QToolButton" name="toolButtonPlay">
+             <property name="text">
+              <string>...</string>
              </property>
+             <property name="icon">
+              <iconset resource="avidemux.qrc">
+               <normaloff>:/new/prefix1/pics/player_play.png</normaloff>:/new/prefix1/pics/player_play.png</iconset>
+             </property>
+             <property name="iconSize">
+              <size>
+               <width>24</width>
+               <height>24</height>
+              </size>
+             </property>
+             <property name="autoRaise">
+              <bool>true</bool>
+             </property>
+            </widget>
+           </item>
+           <item>
+            <widget class="QToolButton" name="toolButtonStop">
              <property name="text">
-              <string> A:</string>
+              <string>...</string>
              </property>
+             <property name="icon">
+              <iconset resource="avidemux.qrc">
+               <normaloff>:/new/prefix1/pics/player_stop.png</normaloff>:/new/prefix1/pics/player_stop.png</iconset>
+             </property>
+             <property name="iconSize">
+              <size>
+               <width>24</width>
+               <height>24</height>
+              </size>
+             </property>
+             <property name="autoRaise">
+              <bool>true</bool>
+             </property>
             </widget>
            </item>
            <item>
-            <widget class="QPushButton" name="pushButtonJumpToMarkerA">
-             <property name="sizePolicy">
-              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-               <horstretch>0</horstretch>
-               <verstretch>0</verstretch>
-              </sizepolicy>
+            <widget class="QToolButton" name="toolButtonPreviousFrame">
+             <property name="text">
+              <string>...</string>
              </property>
-             <property name="font">
-              <font>
-               <family>MS Shell Dlg 2</family>
-               <pointsize>8</pointsize>
-               <weight>50</weight>
-               <italic>false</italic>
-               <bold>false</bold>
-               <underline>false</underline>
-               <strikeout>false</strikeout>
-              </font>
+             <property name="icon">
+              <iconset resource="avidemux.qrc">
+               <normaloff>:/new/prefix1/pics/back.png</normaloff>:/new/prefix1/pics/back.png</iconset>
              </property>
+             <property name="iconSize">
+              <size>
+               <width>24</width>
+               <height>24</height>
+              </size>
+             </property>
+             <property name="autoRaise">
+              <bool>true</bool>
+             </property>
+            </widget>
+           </item>
+           <item>
+            <widget class="QToolButton" name="toolButtonNextFrame">
              <property name="text">
-              <string>000000</string>
+              <string>...</string>
              </property>
+             <property name="icon">
+              <iconset resource="avidemux.qrc">
+               <normaloff>:/new/prefix1/pics/forward.png</normaloff>:/new/prefix1/pics/forward.png</iconset>
+             </property>
+             <property name="iconSize">
+              <size>
+               <width>24</width>
+               <height>24</height>
+              </size>
+             </property>
+             <property name="autoRaise">
+              <bool>true</bool>
+             </property>
             </widget>
            </item>
            <item>
-            <widget class="QLabel" name="label_11">
-             <property name="font">
-              <font>
-               <family>MS Shell Dlg 2</family>
-               <pointsize>8</pointsize>
-               <weight>50</weight>
-               <italic>false</italic>
-               <bold>false</bold>
-               <underline>false</underline>
-               <strikeout>false</strikeout>
-              </font>
+            <widget class="QToolButton" name="toolButtonPreviousIntraFrame">
+             <property name="text">
+              <string>...</string>
              </property>
+             <property name="icon">
+              <iconset resource="avidemux.qrc">
+               <normaloff>:/new/prefix1/pics/player_rew.png</normaloff>:/new/prefix1/pics/player_rew.png</iconset>
+             </property>
+             <property name="iconSize">
+              <size>
+               <width>24</width>
+               <height>24</height>
+              </size>
+             </property>
+             <property name="autoRaise">
+              <bool>true</bool>
+             </property>
+            </widget>
+           </item>
+           <item>
+            <widget class="QToolButton" name="toolButtonNextIntraFrame">
              <property name="text">
-              <string> B:</string>
+              <string>...</string>
              </property>
+             <property name="icon">
+              <iconset resource="avidemux.qrc">
+               <normaloff>:/new/prefix1/pics/player_fwd.png</normaloff>:/new/prefix1/pics/player_fwd.png</iconset>
+             </property>
+             <property name="iconSize">
+              <size>
+               <width>24</width>
+               <height>24</height>
+              </size>
+             </property>
+             <property name="autoRaise">
+              <bool>true</bool>
+             </property>
             </widget>
            </item>
            <item>
-            <widget class="QPushButton" name="pushButtonJumpToMarkerB">
-             <property name="sizePolicy">
-              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-               <horstretch>0</horstretch>
-               <verstretch>0</verstretch>
-              </sizepolicy>
+            <widget class="QToolButton" name="toolButtonSetMarkerA">
+             <property name="text">
+              <string>...</string>
              </property>
-             <property name="font">
-              <font>
-               <family>MS Shell Dlg 2</family>
-               <pointsize>8</pointsize>
-               <weight>50</weight>
-               <italic>false</italic>
-               <bold>false</bold>
-               <underline>false</underline>
-               <strikeout>false</strikeout>
-              </font>
+             <property name="icon">
+              <iconset resource="avidemux.qrc">
+               <normaloff>:/new/prefix1/pics/markA.png</normaloff>:/new/prefix1/pics/markA.png</iconset>
              </property>
-             <property name="layoutDirection">
-              <enum>Qt::LeftToRight</enum>
+             <property name="iconSize">
+              <size>
+               <width>24</width>
+               <height>24</height>
+              </size>
              </property>
+             <property name="autoRaise">
+              <bool>true</bool>
+             </property>
+            </widget>
+           </item>
+           <item>
+            <widget class="QToolButton" name="toolButtonSetMarkerB">
              <property name="text">
-              <string>000000</string>
+              <string>...</string>
              </property>
+             <property name="icon">
+              <iconset resource="avidemux.qrc">
+               <normaloff>:/new/prefix1/pics/markB.png</normaloff>:/new/prefix1/pics/markB.png</iconset>
+             </property>
+             <property name="iconSize">
+              <size>
+               <width>24</width>
+               <height>24</height>
+              </size>
+             </property>
+             <property name="autoRaise">
+              <bool>true</bool>
+             </property>
             </widget>
            </item>
-          </layout>
-         </widget>
-        </widget>
-       </item>
-      </layout>
-     </item>
-     <item>
-      <spacer>
-       <property name="orientation">
-        <enum>Qt::Horizontal</enum>
-       </property>
-       <property name="sizeType">
-        <enum>QSizePolicy::Fixed</enum>
-       </property>
-       <property name="sizeHint" stdset="0">
-        <size>
-         <width>14</width>
-         <height>95</height>
-        </size>
-       </property>
-      </spacer>
-     </item>
-     <item>
-      <layout class="QVBoxLayout">
-       <property name="spacing">
-        <number>4</number>
-       </property>
-       <property name="margin">
-        <number>0</number>
-       </property>
-       <item>
-        <spacer>
-         <property name="orientation">
-          <enum>Qt::Vertical</enum>
-         </property>
-         <property name="sizeType">
-          <enum>QSizePolicy::Expanding</enum>
-         </property>
-         <property name="sizeHint" stdset="0">
-          <size>
-           <width>0</width>
-           <height>0</height>
-          </size>
-         </property>
-        </spacer>
-       </item>
-       <item>
-        <widget class="QToolButton" name="toolButtonAudioToggle">
-         <property name="enabled">
-          <bool>true</bool>
-         </property>
-         <property name="text">
-          <string>...</string>
-         </property>
-         <property name="icon">
-          <iconset resource="avidemux.qrc">
-           <normaloff>:/new/prefix1/pics/arts.png</normaloff>:/new/prefix1/pics/arts.png</iconset>
-         </property>
-         <property name="checkable">
-          <bool>true</bool>
-         </property>
-         <property name="checked">
-          <bool>true</bool>
-         </property>
-        </widget>
-       </item>
-       <item>
-        <widget class="QSlider" name="horizontalSlider_2">
-         <property name="sizePolicy">
-          <sizepolicy hsizetype="Preferred" vsizetype="Minimum">
-           <horstretch>0</horstretch>
-           <verstretch>0</verstretch>
-          </sizepolicy>
-         </property>
-         <property name="maximumSize">
-          <size>
-           <width>16777215</width>
-           <height>64</height>
-          </size>
-         </property>
-         <property name="maximum">
-          <number>100</number>
-         </property>
-         <property name="value">
-          <number>100</number>
-         </property>
-         <property name="orientation">
-          <enum>Qt::Vertical</enum>
-         </property>
-        </widget>
-       </item>
-      </layout>
-     </item>
-    </layout>
-   </widget>
-   <widget class="QWidget" name="">
-    <property name="geometry">
-     <rect>
-      <x>10</x>
-      <y>14</y>
-      <width>781</width>
-      <height>477</height>
-     </rect>
-    </property>
-    <layout class="QHBoxLayout" name="horizontalLayout_2">
-     <item>
-      <layout class="QVBoxLayout" name="verticalLayout_3">
-       <item>
-        <widget class="QLabel" name="label_7">
-         <property name="sizePolicy">
-          <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
-           <horstretch>0</horstretch>
-           <verstretch>0</verstretch>
-          </sizepolicy>
-         </property>
-         <property name="maximumSize">
-          <size>
-           <width>180</width>
-           <height>16777215</height>
-          </size>
-         </property>
-         <property name="text">
-          <string>&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0//EN&quot; &quot;http://www.w3.org/TR/REC-html40/strict.dtd&quot;&gt;
-&lt;html&gt;&lt;head&gt;&lt;meta name=&quot;qrichtext&quot; content=&quot;1&quot; /&gt;&lt;style type=&quot;text/css&quot;&gt;
-p, li { white-space: pre-wrap; }
-&lt;/style&gt;&lt;/head&gt;&lt;body style=&quot; font-family:'DejaVu Sans'; font-size:8pt; font-weight:400; font-style:normal;&quot;&gt;
-&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;&lt;span style=&quot; font-weight:600;&quot;&gt;Decoder&lt;/span&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</string>
-         </property>
-         <property name="textFormat">
-          <enum>Qt::AutoText</enum>
-         </property>
-        </widget>
-       </item>
-       <item>
-        <spacer name="spacer">
-         <property name="orientation">
-          <enum>Qt::Vertical</enum>
-         </property>
-         <property name="sizeType">
-          <enum>QSizePolicy::Fixed</enum>
-         </property>
-         <property name="sizeHint" stdset="0">
-          <size>
-           <width>20</width>
-           <height>13</height>
-          </size>
-         </property>
-        </spacer>
-       </item>
-       <item>
-        <layout class="QHBoxLayout" name="videoLayout_2">
-         <property name="spacing">
-          <number>0</number>
-         </property>
-         <property name="margin">
-          <number>0</number>
-         </property>
-         <item>
-          <spacer>
-           <property name="orientation">
-            <enum>Qt::Horizontal</enum>
-           </property>
-           <property name="sizeType">
-            <enum>QSizePolicy::Fixed</enum>
-           </property>
-           <property name="sizeHint" stdset="0">
-            <size>
-             <width>12</width>
-             <height>0</height>
-            </size>
-           </property>
-          </spacer>
-         </item>
-         <item>
-          <layout class="QVBoxLayout" name="_2">
-           <property name="spacing">
-            <number>6</number>
-           </property>
-           <property name="margin">
-            <number>0</number>
-           </property>
            <item>
-            <widget class="QLabel" name="labelVideoDecoder">
+            <widget class="QToolButton" name="toolButtonPreviousBlackFrame">
              <property name="text">
-              <string>XXXX</string>
+              <string>...</string>
              </property>
+             <property name="icon">
+              <iconset resource="avidemux.qrc">
+               <normaloff>:/new/prefix1/pics/prev_black.png</normaloff>:/new/prefix1/pics/prev_black.png</iconset>
+             </property>
+             <property name="iconSize">
+              <size>
+               <width>24</width>
+               <height>24</height>
+              </size>
+             </property>
+             <property name="autoRaise">
+              <bool>true</bool>
+             </property>
             </widget>
            </item>
            <item>
-            <widget class="QPushButton" name="pushButtonDecoderConf">
-             <property name="enabled">
+            <widget class="QToolButton" name="toolButtonNextBlackFrame">
+             <property name="text">
+              <string>...</string>
+             </property>
+             <property name="icon">
+              <iconset resource="avidemux.qrc">
+               <normaloff>:/new/prefix1/pics/next_black.png</normaloff>:/new/prefix1/pics/next_black.png</iconset>
+             </property>
+             <property name="iconSize">
+              <size>
+               <width>24</width>
+               <height>24</height>
+              </size>
+             </property>
+             <property name="autoRaise">
               <bool>true</bool>
              </property>
-             <property name="sizePolicy">
-              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-               <horstretch>0</horstretch>
-               <verstretch>0</verstretch>
-              </sizepolicy>
+            </widget>
+           </item>
+           <item>
+            <widget class="QToolButton" name="toolButtonFirstFrame">
+             <property name="text">
+              <string>...</string>
              </property>
+             <property name="icon">
+              <iconset resource="avidemux.qrc">
+               <normaloff>:/new/prefix1/pics/player_start.png</normaloff>:/new/prefix1/pics/player_start.png</iconset>
+             </property>
+             <property name="iconSize">
+              <size>
+               <width>24</width>
+               <height>24</height>
+              </size>
+             </property>
+             <property name="autoRaise">
+              <bool>true</bool>
+             </property>
+            </widget>
+           </item>
+           <item>
+            <widget class="QToolButton" name="toolButtonLastFrame">
              <property name="text">
-              <string>Configure</string>
+              <string>...</string>
              </property>
+             <property name="icon">
+              <iconset resource="avidemux.qrc">
+               <normaloff>:/new/prefix1/pics/player_end.png</normaloff>:/new/prefix1/pics/player_end.png</iconset>
+             </property>
+             <property name="iconSize">
+              <size>
+               <width>24</width>
+               <height>24</height>
+              </size>
+             </property>
+             <property name="autoRaise">
+              <bool>true</bool>
+             </property>
             </widget>
            </item>
+           <item>
+            <spacer>
+             <property name="orientation">
+              <enum>Qt::Horizontal</enum>
+             </property>
+             <property name="sizeHint" stdset="0">
+              <size>
+               <width>20</width>
+               <height>20</height>
+              </size>
+             </property>
+            </spacer>
+           </item>
           </layout>
          </item>
-        </layout>
-       </item>
-       <item>
-        <spacer name="spacer_2">
-         <property name="orientation">
-          <enum>Qt::Vertical</enum>
-         </property>
-         <property name="sizeType">
-          <enum>QSizePolicy::Fixed</enum>
-         </property>
-         <property name="sizeHint" stdset="0">
-          <size>
-           <width>13</width>
-           <height>14</height>
-          </size>
-         </property>
-        </spacer>
-       </item>
-       <item>
-        <widget class="QLabel" name="label_3">
-         <property name="sizePolicy">
-          <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
-           <horstretch>0</horstretch>
-           <verstretch>0</verstretch>
-          </sizepolicy>
-         </property>
-         <property name="maximumSize">
-          <size>
-           <width>180</width>
-           <height>16777215</height>
-          </size>
-         </property>
-         <property name="text">
-          <string>&lt;b&gt;Video&lt;/b&gt;</string>
-         </property>
-         <property name="textFormat">
-          <enum>Qt::AutoText</enum>
-         </property>
-        </widget>
-       </item>
-       <item>
-        <layout class="QHBoxLayout" name="videoLayout">
-         <property name="spacing">
-          <number>0</number>
-         </property>
-         <property name="margin">
-          <number>0</number>
-         </property>
          <item>
-          <spacer>
-           <property name="orientation">
-            <enum>Qt::Horizontal</enum>
-           </property>
-           <property name="sizeType">
-            <enum>QSizePolicy::Fixed</enum>
-           </property>
-           <property name="sizeHint" stdset="0">
-            <size>
-             <width>12</width>
-             <height>0</height>
-            </size>
-           </property>
-          </spacer>
-         </item>
-         <item>
-          <layout class="QVBoxLayout">
+          <layout class="QHBoxLayout">
            <property name="spacing">
             <number>6</number>
            </property>
@@ -966,205 +840,123 @@
             <number>0</number>
            </property>
            <item>
-            <widget class="QComboBox" name="comboBoxVideo">
+            <widget class="QLabel" name="label_6">
              <property name="sizePolicy">
-              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+              <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
                <horstretch>0</horstretch>
                <verstretch>0</verstretch>
               </sizepolicy>
              </property>
-             <item>
-              <property name="text">
-               <string>Copy</string>
-              </property>
-             </item>
+             <property name="font">
+              <font>
+               <family>MS Shell Dlg 2</family>
+               <pointsize>8</pointsize>
+               <weight>75</weight>
+               <italic>false</italic>
+               <bold>true</bold>
+               <underline>false</underline>
+               <strikeout>false</strikeout>
+              </font>
+             </property>
+             <property name="text">
+              <string>Time:</string>
+             </property>
             </widget>
            </item>
            <item>
-            <widget class="QPushButton" name="pushButtonVideoConf">
-             <property name="enabled">
-              <bool>true</bool>
-             </property>
+            <widget class="QLineEdit" name="currentTime">
              <property name="sizePolicy">
-              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+              <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
                <horstretch>0</horstretch>
                <verstretch>0</verstretch>
               </sizepolicy>
              </property>
+             <property name="maximumSize">
+              <size>
+               <width>84</width>
+               <height>16777215</height>
+              </size>
+             </property>
              <property name="text">
-              <string>Configure</string>
+              <string>00:00:00.000</string>
              </property>
+             <property name="maxLength">
+              <number>12</number>
+             </property>
             </widget>
            </item>
            <item>
-            <widget class="QPushButton" name="pushButtonVideoFilter">
-             <property name="enabled">
-              <bool>true</bool>
-             </property>
+            <widget class="QLabel" name="totalTime">
              <property name="sizePolicy">
-              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+              <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
                <horstretch>0</horstretch>
                <verstretch>0</verstretch>
               </sizepolicy>
              </property>
              <property name="text">
-              <string>Filters</string>
+              <string>/ 00:00:00.000</string>
              </property>
             </widget>
            </item>
-          </layout>
-         </item>
-        </layout>
-       </item>
-       <item>
-        <spacer>
-         <property name="orientation">
-          <enum>Qt::Vertical</enum>
-         </property>
-         <property name="sizeType">
-          <enum>QSizePolicy::Fixed</enum>
-         </property>
-         <property name="sizeHint" stdset="0">
-          <size>
-           <width>13</width>
-           <height>14</height>
-          </size>
-         </property>
-        </spacer>
-       </item>
-       <item>
-        <widget class="QLabel" name="label_5">
-         <property name="sizePolicy">
-          <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
-           <horstretch>0</horstretch>
-           <verstretch>0</verstretch>
-          </sizepolicy>
-         </property>
-         <property name="maximumSize">
-          <size>
-           <width>180</width>
-           <height>16777215</height>
-          </size>
-         </property>
-         <property name="text">
-          <string>&lt;b&gt;Audio&lt;/b&gt;</string>
-         </property>
-         <property name="textFormat">
-          <enum>Qt::AutoText</enum>
-         </property>
-        </widget>
-       </item>
-       <item>
-        <layout class="QHBoxLayout" name="AudioLayout">
-         <property name="spacing">
-          <number>0</number>
-         </property>
-         <property name="margin">
-          <number>0</number>
-         </property>
-         <item>
-          <spacer>
-           <property name="orientation">
-            <enum>Qt::Horizontal</enum>
-           </property>
-           <property name="sizeType">
-            <enum>QSizePolicy::Fixed</enum>
-           </property>
-           <property name="sizeHint" stdset="0">
-            <size>
-             <width>12</width>
-             <height>0</height>
-            </size>
-           </property>
-          </spacer>
-         </item>
-         <item>
-          <layout class="QVBoxLayout">
-           <property name="spacing">
-            <number>6</number>
-           </property>
-           <property name="margin">
-            <number>0</number>
-           </property>
            <item>
-            <widget class="QComboBox" name="comboBoxAudio">
-             <property name="sizePolicy">
-              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-               <horstretch>0</horstretch>
-               <verstretch>0</verstretch>
-              </sizepolicy>
+            <spacer>
+             <property name="orientation">
+              <enum>Qt::Horizontal</enum>
              </property>
-             <item>
-              <property name="text">
-               <string>Copy</string>
-              </property>
-             </item>
-            </widget>
+             <property name="sizeType">
+              <enum>QSizePolicy::Fixed</enum>
+             </property>
+             <property name="sizeHint" stdset="0">
+              <size>
+               <width>20</width>
+               <height>20</height>
+              </size>
+             </property>
+            </spacer>
            </item>
            <item>
-            <widget class="QPushButton" name="pushButtonAudioConf">
-             <property name="enabled">
-              <bool>true</bool>
+            <widget class="QLabel" name="label_14">
+             <property name="font">
+              <font>
+               <family>MS Shell Dlg 2</family>
+               <pointsize>8</pointsize>
+               <weight>75</weight>
+               <italic>false</italic>
+               <bold>true</bold>
+               <underline>false</underline>
+               <strikeout>false</strikeout>
+              </font>
              </property>
-             <property name="sizePolicy">
-              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-               <horstretch>0</horstretch>
-               <verstretch>0</verstretch>
-              </sizepolicy>
-             </property>
              <property name="text">
-              <string>Configure</string>
+              <string>Frame Type:</string>
              </property>
             </widget>
            </item>
            <item>
-            <widget class="QPushButton" name="pushButtonAudioFilter">
-             <property name="enabled">
-              <bool>true</bool>
-             </property>
+            <widget class="QLabel" name="label_8">
              <property name="sizePolicy">
-              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+              <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
                <horstretch>0</horstretch>
                <verstretch>0</verstretch>
               </sizepolicy>
              </property>
              <property name="text">
-              <string>Filters</string>
+              <string>?</string>
              </property>
             </widget>
            </item>
            <item>
-            <layout class="QHBoxLayout">
-             <property name="spacing">
-              <number>6</number>
+            <spacer>
+             <property name="orientation">
+              <enum>Qt::Horizontal</enum>
              </property>
-             <property name="margin">
-              <number>0</number>
+             <property name="sizeHint" stdset="0">
+              <size>
+               <width>60</width>
+               <height>20</height>
+              </size>
              </property>
-             <item>
-              <widget class="QCheckBox" name="checkBox_TimeShift">
-               <property name="text">
-                <string>&amp;Shift:</string>
-               </property>
-              </widget>
-             </item>
-             <item>
-              <widget class="QSpinBox" name="spinBox_TimeValue">
-               <property name="sizePolicy">
-                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                 <horstretch>0</horstretch>
-                 <verstretch>0</verstretch>
-                </sizepolicy>
-               </property>
-               <property name="minimum">
-                <number>-99999</number>
-               </property>
-               <property name="maximum">
-                <number>99999</number>
-               </property>
-              </widget>
-             </item>
-            </layout>
+            </spacer>
            </item>
           </layout>
          </item>
@@ -1173,157 +965,323 @@
        <item>
         <spacer>
          <property name="orientation">
-          <enum>Qt::Vertical</enum>
+          <enum>Qt::Horizontal</enum>
          </property>
          <property name="sizeType">
           <enum>QSizePolicy::Fixed</enum>
          </property>
          <property name="sizeHint" stdset="0">
           <size>
-           <width>13</width>
-           <height>14</height>
+           <width>14</width>
+           <height>95</height>
           </size>
          </property>
         </spacer>
        </item>
        <item>
-        <widget class="QLabel" name="label_4">
-         <property name="sizePolicy">
-          <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
-           <horstretch>0</horstretch>
-           <verstretch>0</verstretch>
-          </sizepolicy>
-         </property>
-         <property name="text">
-          <string>&lt;b&gt;Format&lt;/b&gt;</string>
-         </property>
-         <property name="textFormat">
-          <enum>Qt::AutoText</enum>
-         </property>
-        </widget>
+        <layout class="QVBoxLayout" name="verticalLayout">
+         <item>
+          <spacer name="verticalSpacer">
+           <property name="orientation">
+            <enum>Qt::Vertical</enum>
+           </property>
+           <property name="sizeHint" stdset="0">
+            <size>
+             <width>20</width>
+             <height>40</height>
+            </size>
+           </property>
+          </spacer>
+         </item>
+         <item>
+          <widget class="QFrame" name="frameVU">
+           <property name="minimumSize">
+            <size>
+             <width>64</width>
+             <height>64</height>
+            </size>
+           </property>
+           <property name="frameShape">
+            <enum>QFrame::StyledPanel</enum>
+           </property>
+           <property name="frameShadow">
+            <enum>QFrame::Raised</enum>
+           </property>
+          </widget>
+         </item>
+        </layout>
        </item>
        <item>
-        <layout class="QHBoxLayout" name="horizontalLayout">
+        <layout class="QVBoxLayout" name="verticalLayout_6">
          <item>
-          <spacer>
+          <spacer name="verticalSpacer_2">
            <property name="orientation">
-            <enum>Qt::Horizontal</enum>
+            <enum>Qt::Vertical</enum>
            </property>
-           <property name="sizeType">
-            <enum>QSizePolicy::Fixed</enum>
-           </property>
            <property name="sizeHint" stdset="0">
             <size>
-             <width>18</width>
+             <width>20</width>
              <height>13</height>
             </size>
            </property>
           </spacer>
          </item>
          <item>
-          <layout class="QVBoxLayout" name="verticalLayout_2">
-           <item>
-            <widget class="QComboBox" name="comboBoxFormat">
-             <property name="sizePolicy">
-              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-               <horstretch>0</horstretch>
-               <verstretch>0</verstretch>
-              </sizepolicy>
-             </property>
-            </widget>
-           </item>
-           <item>
-            <widget class="QPushButton" name="pushButtonFormatConfigure">
-             <property name="enabled">
-              <bool>true</bool>
-             </property>
-             <property name="sizePolicy">
-              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-               <horstretch>0</horstretch>
-               <verstretch>0</verstretch>
-              </sizepolicy>
-             </property>
-             <property name="text">
-              <string>Configure</string>
-             </property>
-            </widget>
-           </item>
-          </layout>
+          <widget class="QGroupBox" name="groupBox">
+           <property name="sizePolicy">
+            <sizepolicy hsizetype="Minimum" vsizetype="Minimum">
+             <horstretch>0</horstretch>
+             <verstretch>0</verstretch>
+            </sizepolicy>
+           </property>
+           <property name="minimumSize">
+            <size>
+             <width>116</width>
+             <height>100</height>
+            </size>
+           </property>
+           <property name="maximumSize">
+            <size>
+             <width>100</width>
+             <height>100</height>
+            </size>
+           </property>
+           <property name="font">
+            <font>
+             <family>MS Shell Dlg 2</family>
+             <pointsize>8</pointsize>
+             <weight>75</weight>
+             <italic>false</italic>
+             <bold>true</bold>
+             <underline>false</underline>
+             <strikeout>false</strikeout>
+            </font>
+           </property>
+           <property name="title">
+            <string>Selection</string>
+           </property>
+           <property name="alignment">
+            <set>Qt::AlignLeading|Qt::AlignLeft|Qt::AlignVCenter</set>
+           </property>
+           <widget class="QWidget" name="">
+            <property name="geometry">
+             <rect>
+              <x>9</x>
+              <y>32</y>
+              <width>98</width>
+              <height>58</height>
+             </rect>
+            </property>
+            <layout class="QVBoxLayout" name="verticalLayout_4">
+             <item>
+              <layout class="QHBoxLayout" name="horizontalLayout_3">
+               <item>
+                <widget class="QLabel" name="label_12">
+                 <property name="font">
+                  <font>
+                   <family>MS Shell Dlg 2</family>
+                   <pointsize>8</pointsize>
+                   <weight>50</weight>
+                   <italic>false</italic>
+                   <bold>false</bold>
+                   <underline>false</underline>
+                   <strikeout>false</strikeout>
+                  </font>
+                 </property>
+                 <property name="text">
+                  <string> A:</string>
+                 </property>
+                </widget>
+               </item>
+               <item>
+                <widget class="QPushButton" name="pushButtonJumpToMarkerA">
+                 <property name="sizePolicy">
+                  <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                   <horstretch>0</horstretch>
+                   <verstretch>0</verstretch>
+                  </sizepolicy>
+                 </property>
+                 <property name="font">
+                  <font>
+                   <family>MS Shell Dlg 2</family>
+                   <pointsize>8</pointsize>
+                   <weight>50</weight>
+                   <italic>false</italic>
+                   <bold>false</bold>
+                   <underline>false</underline>
+                   <strikeout>false</strikeout>
+                  </font>
+                 </property>
+                 <property name="text">
+                  <string>000000</string>
+                 </property>
+                </widget>
+               </item>
+              </layout>
+             </item>
+             <item>
+              <layout class="QHBoxLayout" name="horizontalLayout_4">
+               <item>
+                <widget class="QLabel" name="label_11">
+                 <property name="font">
+                  <font>
+                   <family>MS Shell Dlg 2</family>
+                   <pointsize>8</pointsize>
+                   <weight>50</weight>
+                   <italic>false</italic>
+                   <bold>false</bold>
+                   <underline>false</underline>
+                   <strikeout>false</strikeout>
+                  </font>
+                 </property>
+                 <property name="text">
+                  <string> B:</string>
+                 </property>
+                </widget>
+               </item>
+               <item>
+                <widget class="QPushButton" name="pushButtonJumpToMarkerB">
+                 <property name="sizePolicy">
+                  <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                   <horstretch>0</horstretch>
+                   <verstretch>0</verstretch>
+                  </sizepolicy>
+                 </property>
+                 <property name="font">
+                  <font>
+                   <family>MS Shell Dlg 2</family>
+                   <pointsize>8</pointsize>
+                   <weight>50</weight>
+                   <italic>false</italic>
+                   <bold>false</bold>
+                   <underline>false</underline>
+                   <strikeout>false</strikeout>
+                  </font>
+                 </property>
+                 <property name="layoutDirection">
+                  <enum>Qt::LeftToRight</enum>
+                 </property>
+                 <property name="text">
+                  <string>000000</string>
+                 </property>
+                </widget>
+               </item>
+              </layout>
+             </item>
+            </layout>
+           </widget>
+          </widget>
          </item>
         </layout>
        </item>
-      </layout>
-     </item>
-     <item>
-      <layout class="QHBoxLayout">
-       <property name="spacing">
-        <number>6</number>
-       </property>
-       <property name="margin">
-        <number>0</number>
-       </property>
        <item>
-        <spacer>
-         <property name="orientation">
-          <enum>Qt::Horizontal</enum>
+        <layout class="QVBoxLayout">
+         <property name="spacing">
+          <number>6</number>
          </property>
-         <property name="sizeType">
-          <enum>QSizePolicy::Expanding</enum>
+         <property name="margin">
+          <number>0</number>
          </property>
-         <property name="sizeHint" stdset="0">
-          <size>
-           <width>0</width>
-           <height>0</height>
-          </size>
-         </property>
-        </spacer>
+         <item>
+          <spacer>
+           <property name="orientation">
+            <enum>Qt::Vertical</enum>
+           </property>
+           <property name="sizeType">
+            <enum>QSizePolicy::Expanding</enum>
+           </property>
+           <property name="sizeHint" stdset="0">
+            <size>
+             <width>0</width>
+             <height>0</height>
+            </size>
+           </property>
+          </spacer>
+         </item>
+        </layout>
        </item>
        <item>
-        <widget class="QFrame" name="frame_video">
-         <property name="sizePolicy">
-          <sizepolicy hsizetype="Expanding" vsizetype="Expanding">
-           <horstretch>0</horstretch>
-           <verstretch>0</verstretch>
-          </sizepolicy>
+        <layout class="QVBoxLayout">
+         <property name="spacing">
+          <number>4</number>
          </property>
-         <property name="minimumSize">
-          <size>
-           <width>100</width>
-           <height>100</height>
-          </size>
-         </property>
-         <property name="autoFillBackground">
-          <bool>false</bool>
-         </property>
-         <property name="frameShape">
-          <enum>QFrame::NoFrame</enum>
-         </property>
-         <property name="frameShadow">
-          <enum>QFrame::Raised</enum>
-         </property>
-         <property name="lineWidth">
+         <property name="margin">
           <number>0</number>
          </property>
-        </widget>
+         <item>
+          <spacer>
+           <property name="orientation">
+            <enum>Qt::Vertical</enum>
+           </property>
+           <property name="sizeType">
+            <enum>QSizePolicy::Expanding</enum>
+           </property>
+           <property name="sizeHint" stdset="0">
+            <size>
+             <width>0</width>
+             <height>0</height>
+            </size>
+           </property>
+          </spacer>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonAudioToggle">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/arts.png</normaloff>:/new/prefix1/pics/arts.png</iconset>
+           </property>
+           <property name="checkable">
+            <bool>true</bool>
+           </property>
+           <property name="checked">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QSlider" name="horizontalSlider_2">
+           <property name="sizePolicy">
+            <sizepolicy hsizetype="Preferred" vsizetype="Minimum">
+             <horstretch>0</horstretch>
+             <verstretch>0</verstretch>
+            </sizepolicy>
+           </property>
+           <property name="maximumSize">
+            <size>
+             <width>16777215</width>
+             <height>64</height>
+            </size>
+           </property>
+           <property name="maximum">
+            <number>100</number>
+           </property>
+           <property name="value">
+            <number>100</number>
+           </property>
+           <property name="orientation">
+            <enum>Qt::Vertical</enum>
+           </property>
+          </widget>
+         </item>
+        </layout>
        </item>
       </layout>
      </item>
     </layout>
    </widget>
-   <zorder>spacer</zorder>
-   <zorder>label_7</zorder>
-   <zorder>layoutWidget</zorder>
-   <zorder>spacer_2</zorder>
-   <zorder></zorder>
-   <zorder>label_4</zorder>
-   <zorder>verticalSpacer</zorder>
   </widget>
   <widget class="QMenuBar" name="menubar">
    <property name="geometry">
     <rect>
      <x>0</x>
      <y>0</y>
-     <width>1090</width>
+     <width>782</width>
      <height>21</height>
     </rect>
    </property>



From mean at mail.berlios.de  Thu Apr  8 20:26:08 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 8 Apr 2010 20:26:08 +0200
Subject: [Avidemux-svn-commit] r6099 - in branches/avidemux_2.6_branch_mean:
	avidemux/common/ADM_render avidemux/common/ADM_videoCodec/src
	avidemux/qt4/ADM_userInterfaces/ADM_gui
	avidemux_core/ADM_coreVideoCodec/src
Message-ID: <201004081826.o38IQ8kI014327@sheep.berlios.de>

Author: mean
Date: 2010-04-08 20:26:07 +0200 (Thu, 08 Apr 2010)
New Revision: 6099

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_accelRender.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_simpleRender.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/T_preview.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/ADM_ffmp43.cpp
Log:
[All] First part of Refresh/expose, try to silence out vdpau when delaing with field encoded video

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_accelRender.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_accelRender.h	2010-04-08 09:03:40 UTC (rev 6098)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_accelRender.h	2010-04-08 18:26:07 UTC (rev 6099)
@@ -35,5 +35,6 @@
               virtual   bool    displayImage(ADMImage *pic)=0;
               virtual   bool    refresh(void) {return true;}
               virtual   bool    changeZoom(renderZoom newzoom)=0;
+              virtual   bool    usingUIRedraw(void)=0;
 };
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2010-04-08 09:03:40 UTC (rev 6098)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2010-04-08 18:26:07 UTC (rev 6099)
@@ -25,6 +25,7 @@
 #include "GUI_renderInternal.h"
 #include "GUI_accelRender.h"
 #include "GUI_simpleRender.h"
+#include "ADM_preview.h"
 
 #ifdef USE_XV
 #include "GUI_xvRender.h"
@@ -194,6 +195,15 @@
       return 1;
 }
 /**
+    \fn renderCompleteRedrawRequest
+    \brief ask the *caller* to redraw, whereas expose/refresh asks the renderer to refresh
+*/
+bool renderCompleteRedrawRequest(void)
+{
+    ADM_info("RedrawRequest");
+    admPreview::samePicture();
+}
+/**
     \fn renderExpose
 */
 uint8_t renderExpose(void)
@@ -344,6 +354,18 @@
 {      
       return true;
 }
+/**
+    \fn renderExposeEventFromUI
+    \brief retrurn true if UI(gtk/qt) should handle redraw
+*/
+bool    renderExposeEventFromUI(void)
+{
+    if(!renderer) return true;
+    if(renderer->usingUIRedraw()==true) return true;
+    //renderer->refresh();
+    return false;
+
+}
 //***************************************
 /**
     \fn bool calcDisplayFromZoom(renderZoom zoom);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.h	2010-04-08 09:03:40 UTC (rev 6098)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.h	2010-04-08 18:26:07 UTC (rev 6099)
@@ -49,9 +49,10 @@
 uint8_t renderExpose(void);
 uint8_t renderUpdateImage(ADMImage *img);
 uint8_t renderUpdateImageBlit(uint8_t *ptr,uint32_t startx, uint32_t starty, uint32_t w, uint32_t,uint32_t primary);
-
+bool    renderCompleteRedrawRequest(void); // will call admPreview 
 uint8_t renderStartPlaying( void );
 uint8_t renderStopPlaying( void );
+bool    renderExposeEventFromUI(void); // This is called by UI, return true if UI should redraw, false else
 
 uint8_t renderLock(void);
 uint8_t renderUnlock(void);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.h	2010-04-08 09:03:40 UTC (rev 6098)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_sdlRender.h	2010-04-08 18:26:07 UTC (rev 6099)
@@ -30,6 +30,7 @@
               virtual	bool stop(void);				
               virtual   bool displayImage(ADMImage *pic);
               virtual   bool changeZoom(renderZoom newZoom);
+              virtual   bool    usingUIRedraw(void) {return false;};
 };
 
 void initSdl(int videoDevice);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_simpleRender.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_simpleRender.h	2010-04-08 09:03:40 UTC (rev 6098)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_simpleRender.h	2010-04-08 18:26:07 UTC (rev 6099)
@@ -34,6 +34,7 @@
               virtual   bool displayImage(ADMImage *pic);
               virtual   bool changeZoom(renderZoom newZoom);
               virtual   bool refresh(void);
+              virtual   bool usingUIRedraw(void) {return true;};
 };
 #endif
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.cpp	2010-04-08 09:03:40 UTC (rev 6098)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.cpp	2010-04-08 18:26:07 UTC (rev 6099)
@@ -90,7 +90,9 @@
 */
 bool XvRender::refresh(void)
 {
-    GUI_XvRedraw();
+    // since we dont know how to redraw without help, ask above
+    ADM_info("XV:refresh\n");
+    renderCompleteRedrawRequest();
     return true;
 }
 //________________Wrapper around Xv_______________

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.h	2010-04-08 09:03:40 UTC (rev 6098)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.h	2010-04-08 18:26:07 UTC (rev 6099)
@@ -32,6 +32,7 @@
               virtual   bool displayImage(ADMImage *pic);
               virtual   bool changeZoom(renderZoom newzoom);
               virtual   bool refresh(void);
+              virtual   bool usingUIRedraw(void) {return false;};
 };
 #endif
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp	2010-04-08 09:03:40 UTC (rev 6098)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp	2010-04-08 18:26:07 UTC (rev 6099)
@@ -119,7 +119,7 @@
     uint32_t version=0xff;
         funcs.getInformationString(&versionString);
         funcs.getApiVersion(&version);
-        printf("[VDPAU] API : 0x%x, info : %s\n",version,versionString);
+        ADM_info("[VDPAU] API : 0x%x, info : %s\n",version,versionString);
 
     vdpauWorking=true;
     return true;
@@ -142,7 +142,7 @@
     vdpau_render_state * render;
     if(VDPAU->freeQueue.size()==0)
     {
-        printf("[VDPAU] No more available surface\n");
+        aprintf("[VDPAU] No more available surface\n");
         return -1;
     }
     // Get an image   
@@ -237,14 +237,14 @@
 */
 decoderFFVDPAU::~decoderFFVDPAU()
 {
-        printf("[VDPAU] Cleaning up\n");
+        ADM_info("[VDPAU] Cleaning up\n");
         destroying=true;
         for(int i=0;i<NB_SURFACE;i++)
         {
             ADM_assert(VDP_STATUS_OK==funcs.destroySurface((VDPAU->renders[i]->surface)));
             delete VDPAU->renders[i];
         }
-        printf("[VDPAU] Destroying decoder\n");
+        ADM_info("[VDPAU] Destroying decoder\n");
          ADM_assert(VDP_STATUS_OK==funcs.decoderDestroy(VDPAU->vdpDecoder));
          delete VDPAU;
          vdpau=NULL;
@@ -261,7 +261,7 @@
     decode_status=false;
     if(!decoderFF::uncompress (in, scratch))
     {
-        printf("[VDPAU] No data from libavcodec\n");
+        aprintf("[VDPAU] No data from libavcodec\n");
         return 0;
     }
     if(decode_status!=true)

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2010-04-08 09:03:40 UTC (rev 6098)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2010-04-08 18:26:07 UTC (rev 6099)
@@ -219,9 +219,6 @@
 
 	groupPreviewModes->addAction(ui.actionPreviewInput);
 	groupPreviewModes->addAction(ui.actionPreviewOutput);
-	groupPreviewModes->addAction(ui.actionPreviewSide);
-	groupPreviewModes->addAction(ui.actionPreviewTop);
-	groupPreviewModes->addAction(ui.actionPreviewSeparate);
 	connect(groupPreviewModes, SIGNAL(triggered(QAction*)), this, SLOT(previewModeChanged(QAction*)));
 
 	// Zoom modes
@@ -276,9 +273,6 @@
 	connect(ui.spinBox_TimeValue,SIGNAL(valueChanged(int)),this,SLOT(timeChanged(int)));
 	connect(ui.spinBox_TimeValue, SIGNAL(editingFinished()), this, SLOT(timeChangeFinished()));
 
-
-
-
 	QRegExp timeRegExp("^[0-9]{2}:[0-5][0-9]:[0-5][0-9]\\.[0-9]{3}$");
 	QRegExpValidator *timeValidator = new QRegExpValidator(timeRegExp, this);
 	ui.currentTime->setValidator(timeValidator);

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/T_preview.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/T_preview.cpp	2010-04-08 09:03:40 UTC (rev 6098)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/T_preview.cpp	2010-04-08 18:26:07 UTC (rev 6099)
@@ -67,13 +67,14 @@
 {
 	if(!displayW || !displayH || !rgbDataBuffer )
 		return ;
-
-	
 	{
-		QImage image(rgbDataBuffer,displayW,displayH,QImage::Format_RGB32);
-		QPainter painter(this);
-		painter.drawImage(QPoint(0,0),image);
-		painter.end();
+        if(true==renderExposeEventFromUI())
+        {
+            QImage image(rgbDataBuffer,displayW,displayH,QImage::Format_RGB32);
+            QPainter painter(this);
+            painter.drawImage(QPoint(0,0),image);
+            painter.end();
+        }
 	}
 }
 
@@ -125,6 +126,9 @@
 
 	hostFrame->resize(displayW, displayH);
 	videoWindow->resize(displayW, displayH);
+
+	hostFrame->setMaximumSize(displayW, displayH);
+	videoWindow->setMaximumSize(displayW, displayH);	
 	UI_purge();
 
 	QuiMainWindows->adjustSize();

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui	2010-04-08 09:03:40 UTC (rev 6098)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui	2010-04-08 18:26:07 UTC (rev 6099)
@@ -7,17 +7,28 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>782</width>
-    <height>642</height>
+    <width>640</width>
+    <height>640</height>
    </rect>
   </property>
+  <property name="sizePolicy">
+   <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+    <horstretch>0</horstretch>
+    <verstretch>0</verstretch>
+   </sizepolicy>
+  </property>
+  <property name="minimumSize">
+   <size>
+    <width>640</width>
+    <height>640</height>
+   </size>
+  </property>
   <property name="windowTitle">
    <string>Avidemux</string>
   </property>
   <property name="windowIcon">
    <iconset>
-    <normaloff/>
-   </iconset>
+    <normaloff>pics/avidemux_icon_small.png</normaloff>pics/avidemux_icon_small.png</iconset>
   </property>
   <property name="iconSize">
    <size>
@@ -26,1262 +37,1198 @@
    </size>
   </property>
   <widget class="QWidget" name="centralwidget">
-   <property name="sizePolicy">
-    <sizepolicy hsizetype="MinimumExpanding" vsizetype="MinimumExpanding">
-     <horstretch>0</horstretch>
-     <verstretch>0</verstretch>
-    </sizepolicy>
-   </property>
    <property name="minimumSize">
     <size>
-     <width>640</width>
-     <height>480</height>
+     <width>200</width>
+     <height>200</height>
     </size>
    </property>
-   <widget class="QWidget" name="">
-    <property name="geometry">
-     <rect>
-      <x>10</x>
-      <y>10</y>
-      <width>740</width>
-      <height>551</height>
-     </rect>
-    </property>
-    <layout class="QVBoxLayout" name="verticalLayout_5">
-     <property name="sizeConstraint">
-      <enum>QLayout::SetMinAndMaxSize</enum>
-     </property>
-     <item>
-      <layout class="QHBoxLayout" name="horizontalLayout_2">
-       <item>
-        <layout class="QVBoxLayout" name="verticalLayout_3">
-         <item>
-          <widget class="QLabel" name="label_7">
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
-           </property>
-           <property name="maximumSize">
-            <size>
-             <width>180</width>
-             <height>16777215</height>
-            </size>
-           </property>
-           <property name="text">
-            <string>&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0//EN&quot; &quot;http://www.w3.org/TR/REC-html40/strict.dtd&quot;&gt;
+   <layout class="QVBoxLayout" name="verticalLayout_5">
+    <item>
+     <layout class="QHBoxLayout" name="horizontalLayout_2">
+      <item>
+       <layout class="QVBoxLayout" name="verticalLayout_3">
+        <item>
+         <widget class="QLabel" name="label_7">
+          <property name="sizePolicy">
+           <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+            <horstretch>0</horstretch>
+            <verstretch>0</verstretch>
+           </sizepolicy>
+          </property>
+          <property name="maximumSize">
+           <size>
+            <width>180</width>
+            <height>16777215</height>
+           </size>
+          </property>
+          <property name="text">
+           <string>&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0//EN&quot; &quot;http://www.w3.org/TR/REC-html40/strict.dtd&quot;&gt;
 &lt;html&gt;&lt;head&gt;&lt;meta name=&quot;qrichtext&quot; content=&quot;1&quot; /&gt;&lt;style type=&quot;text/css&quot;&gt;
 p, li { white-space: pre-wrap; }
 &lt;/style&gt;&lt;/head&gt;&lt;body style=&quot; font-family:'DejaVu Sans'; font-size:8pt; font-weight:400; font-style:normal;&quot;&gt;
 &lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;&lt;span style=&quot; font-weight:600;&quot;&gt;Video Decoder&lt;/span&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</string>
-           </property>
-           <property name="textFormat">
-            <enum>Qt::AutoText</enum>
-           </property>
-          </widget>
-         </item>
-         <item>
-          <layout class="QHBoxLayout" name="videoLayout_2">
-           <property name="spacing">
-            <number>0</number>
-           </property>
-           <property name="margin">
-            <number>0</number>
-           </property>
-           <item>
-            <spacer>
-             <property name="orientation">
-              <enum>Qt::Horizontal</enum>
-             </property>
-             <property name="sizeType">
-              <enum>QSizePolicy::Fixed</enum>
-             </property>
-             <property name="sizeHint" stdset="0">
-              <size>
-               <width>12</width>
-               <height>0</height>
-              </size>
-             </property>
-            </spacer>
-           </item>
-           <item>
-            <layout class="QVBoxLayout" name="_2">
-             <property name="spacing">
-              <number>6</number>
-             </property>
-             <property name="margin">
-              <number>0</number>
-             </property>
-             <item>
-              <widget class="QLabel" name="labelVideoDecoder">
+          </property>
+          <property name="textFormat">
+           <enum>Qt::AutoText</enum>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <layout class="QHBoxLayout" name="videoLayout_2">
+          <property name="spacing">
+           <number>0</number>
+          </property>
+          <property name="margin">
+           <number>0</number>
+          </property>
+          <item>
+           <spacer>
+            <property name="orientation">
+             <enum>Qt::Horizontal</enum>
+            </property>
+            <property name="sizeType">
+             <enum>QSizePolicy::Fixed</enum>
+            </property>
+            <property name="sizeHint" stdset="0">
+             <size>
+              <width>13</width>
+              <height>44</height>
+             </size>
+            </property>
+           </spacer>
+          </item>
+          <item>
+           <layout class="QVBoxLayout" name="_2">
+            <property name="spacing">
+             <number>6</number>
+            </property>
+            <property name="margin">
+             <number>0</number>
+            </property>
+            <item>
+             <widget class="QLabel" name="labelVideoDecoder">
+              <property name="text">
+               <string>XXXX</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QPushButton" name="pushButtonDecoderConf">
+              <property name="enabled">
+               <bool>true</bool>
+              </property>
+              <property name="sizePolicy">
+               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+              <property name="text">
+               <string>Configure</string>
+              </property>
+             </widget>
+            </item>
+           </layout>
+          </item>
+         </layout>
+        </item>
+        <item>
+         <widget class="QLabel" name="label_3">
+          <property name="sizePolicy">
+           <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+            <horstretch>0</horstretch>
+            <verstretch>0</verstretch>
+           </sizepolicy>
+          </property>
+          <property name="maximumSize">
+           <size>
+            <width>180</width>
+            <height>16777215</height>
+           </size>
+          </property>
+          <property name="text">
+           <string>&lt;b&gt;Video&lt;/b&gt;</string>
+          </property>
+          <property name="textFormat">
+           <enum>Qt::AutoText</enum>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <layout class="QHBoxLayout" name="videoLayout">
+          <property name="spacing">
+           <number>0</number>
+          </property>
+          <property name="margin">
+           <number>0</number>
+          </property>
+          <item>
+           <spacer>
+            <property name="orientation">
+             <enum>Qt::Horizontal</enum>
+            </property>
+            <property name="sizeType">
+             <enum>QSizePolicy::Fixed</enum>
+            </property>
+            <property name="sizeHint" stdset="0">
+             <size>
+              <width>13</width>
+              <height>83</height>
+             </size>
+            </property>
+           </spacer>
+          </item>
+          <item>
+           <layout class="QVBoxLayout">
+            <property name="spacing">
+             <number>6</number>
+            </property>
+            <property name="margin">
+             <number>0</number>
+            </property>
+            <item>
+             <widget class="QComboBox" name="comboBoxVideo">
+              <property name="sizePolicy">
+               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+              <item>
                <property name="text">
-                <string>XXXX</string>
+                <string>Copy</string>
                </property>
-              </widget>
-             </item>
-             <item>
-              <widget class="QPushButton" name="pushButtonDecoderConf">
-               <property name="enabled">
-                <bool>true</bool>
-               </property>
-               <property name="sizePolicy">
-                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                 <horstretch>0</horstretch>
-                 <verstretch>0</verstretch>
-                </sizepolicy>
-               </property>
+              </item>
+             </widget>
+            </item>
+            <item>
+             <widget class="QPushButton" name="pushButtonVideoConf">
+              <property name="enabled">
+               <bool>true</bool>
+              </property>
+              <property name="sizePolicy">
+               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+              <property name="text">
+               <string>Configure</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QPushButton" name="pushButtonVideoFilter">
+              <property name="enabled">
+               <bool>true</bool>
+              </property>
+              <property name="sizePolicy">
+               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+              <property name="text">
+               <string>Filters</string>
+              </property>
+             </widget>
+            </item>
+           </layout>
+          </item>
+         </layout>
+        </item>
+        <item>
+         <widget class="QLabel" name="label_5">
+          <property name="sizePolicy">
+           <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+            <horstretch>0</horstretch>
+            <verstretch>0</verstretch>
+           </sizepolicy>
+          </property>
+          <property name="maximumSize">
+           <size>
+            <width>180</width>
+            <height>16777215</height>
+           </size>
+          </property>
+          <property name="text">
+           <string>&lt;b&gt;Audio&lt;/b&gt;</string>
+          </property>
+          <property name="textFormat">
+           <enum>Qt::AutoText</enum>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <layout class="QHBoxLayout" name="AudioLayout">
+          <property name="spacing">
+           <number>0</number>
+          </property>
+          <property name="margin">
+           <number>0</number>
+          </property>
+          <item>
+           <spacer>
+            <property name="orientation">
+             <enum>Qt::Horizontal</enum>
+            </property>
+            <property name="sizeType">
+             <enum>QSizePolicy::Fixed</enum>
+            </property>
+            <property name="sizeHint" stdset="0">
+             <size>
+              <width>13</width>
+              <height>116</height>
+             </size>
+            </property>
+           </spacer>
+          </item>
+          <item>
+           <layout class="QVBoxLayout">
+            <property name="spacing">
+             <number>6</number>
+            </property>
+            <property name="margin">
+             <number>0</number>
+            </property>
+            <item>
+             <widget class="QComboBox" name="comboBoxAudio">
+              <property name="sizePolicy">
+               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+              <item>
                <property name="text">
-                <string>Configure</string>
+                <string>Copy</string>
                </property>
-              </widget>
-             </item>
-            </layout>
-           </item>
-          </layout>
-         </item>
-         <item>
-          <widget class="QLabel" name="label_3">
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
-           </property>
-           <property name="maximumSize">
-            <size>
-             <width>180</width>
-             <height>16777215</height>
-            </size>
-           </property>
-           <property name="text">
-            <string>&lt;b&gt;Video&lt;/b&gt;</string>
-           </property>
-           <property name="textFormat">
-            <enum>Qt::AutoText</enum>
-           </property>
-          </widget>
-         </item>
-         <item>
-          <layout class="QHBoxLayout" name="videoLayout">
-           <property name="spacing">
-            <number>0</number>
-           </property>
-           <property name="margin">
-            <number>0</number>
-           </property>
-           <item>
-            <spacer>
-             <property name="orientation">
-              <enum>Qt::Horizontal</enum>
-             </property>
-             <property name="sizeType">
-              <enum>QSizePolicy::Fixed</enum>
-             </property>
-             <property name="sizeHint" stdset="0">
-              <size>
-               <width>12</width>
-               <height>0</height>
-              </size>
-             </property>
-            </spacer>
-           </item>
-           <item>
-            <layout class="QVBoxLayout">
-             <property name="spacing">
-              <number>6</number>
-             </property>
-             <property name="margin">
-              <number>0</number>
-             </property>
-             <item>
-              <widget class="QComboBox" name="comboBoxVideo">
-               <property name="sizePolicy">
-                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                 <horstretch>0</horstretch>
-                 <verstretch>0</verstretch>
-                </sizepolicy>
-               </property>
-               <item>
+              </item>
+             </widget>
+            </item>
+            <item>
+             <widget class="QPushButton" name="pushButtonAudioConf">
+              <property name="enabled">
+               <bool>true</bool>
+              </property>
+              <property name="sizePolicy">
+               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+              <property name="text">
+               <string>Configure</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QPushButton" name="pushButtonAudioFilter">
+              <property name="enabled">
+               <bool>true</bool>
+              </property>
+              <property name="sizePolicy">
+               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+              <property name="text">
+               <string>Filters</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <layout class="QHBoxLayout">
+              <property name="spacing">
+               <number>6</number>
+              </property>
+              <property name="margin">
+               <number>0</number>
+              </property>
+              <item>
+               <widget class="QCheckBox" name="checkBox_TimeShift">
                 <property name="text">
-                 <string>Copy</string>
+                 <string>&amp;Shift:</string>
                 </property>
-               </item>
-              </widget>
-             </item>
-             <item>
-              <widget class="QPushButton" name="pushButtonVideoConf">
-               <property name="enabled">
-                <bool>true</bool>
-               </property>
-               <property name="sizePolicy">
-                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                 <horstretch>0</horstretch>
-                 <verstretch>0</verstretch>
-                </sizepolicy>
-               </property>
-               <property name="text">
-                <string>Configure</string>
-               </property>
-              </widget>
-             </item>
-             <item>
-              <widget class="QPushButton" name="pushButtonVideoFilter">
-               <property name="enabled">
-                <bool>true</bool>
-               </property>
-               <property name="sizePolicy">
-                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                 <horstretch>0</horstretch>
-                 <verstretch>0</verstretch>
-                </sizepolicy>
-               </property>
-               <property name="text">
-                <string>Filters</string>
-               </property>
-              </widget>
-             </item>
-            </layout>
-           </item>
-          </layout>
-         </item>
-         <item>
-          <widget class="QLabel" name="label_5">
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
-           </property>
-           <property name="maximumSize">
-            <size>
-             <width>180</width>
-             <height>16777215</height>
-            </size>
-           </property>
-           <property name="text">
-            <string>&lt;b&gt;Audio&lt;/b&gt;</string>
-           </property>
-           <property name="textFormat">
-            <enum>Qt::AutoText</enum>
-           </property>
-          </widget>
-         </item>
-         <item>
-          <layout class="QHBoxLayout" name="AudioLayout">
-           <property name="spacing">
-            <number>0</number>
-           </property>
-           <property name="margin">
-            <number>0</number>
-           </property>
-           <item>
-            <spacer>
-             <property name="orientation">
-              <enum>Qt::Horizontal</enum>
-             </property>
-             <property name="sizeType">
-              <enum>QSizePolicy::Fixed</enum>
-             </property>
-             <property name="sizeHint" stdset="0">
-              <size>
-               <width>12</width>
-               <height>0</height>
-              </size>
-             </property>
-            </spacer>
-           </item>
-           <item>
-            <layout class="QVBoxLayout">
-             <property name="spacing">
-              <number>6</number>
-             </property>
-             <property name="margin">
-              <number>0</number>
-             </property>
-             <item>
-              <widget class="QComboBox" name="comboBoxAudio">
-               <property name="sizePolicy">
-                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                 <horstretch>0</horstretch>
-                 <verstretch>0</verstretch>
-                </sizepolicy>
-               </property>
-               <item>
-                <property name="text">
-                 <string>Copy</string>
+               </widget>
+              </item>
+              <item>
+               <widget class="QSpinBox" name="spinBox_TimeValue">
+                <property name="sizePolicy">
+                 <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                  <horstretch>0</horstretch>
+                  <verstretch>0</verstretch>
+                 </sizepolicy>
                 </property>
-               </item>
-              </widget>
-             </item>
-             <item>
-              <widget class="QPushButton" name="pushButtonAudioConf">
-               <property name="enabled">
-                <bool>true</bool>
-               </property>
-               <property name="sizePolicy">
-                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                 <horstretch>0</horstretch>
-                 <verstretch>0</verstretch>
-                </sizepolicy>
-               </property>
-               <property name="text">
-                <string>Configure</string>
-               </property>
-              </widget>
-             </item>
-             <item>
-              <widget class="QPushButton" name="pushButtonAudioFilter">
-               <property name="enabled">
-                <bool>true</bool>
-               </property>
-               <property name="sizePolicy">
-                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                 <horstretch>0</horstretch>
-                 <verstretch>0</verstretch>
-                </sizepolicy>
-               </property>
-               <property name="text">
-                <string>Filters</string>
-               </property>
-              </widget>
-             </item>
-             <item>
-              <layout class="QHBoxLayout">
-               <property name="spacing">
-                <number>6</number>
-               </property>
-               <property name="margin">
-                <number>0</number>
-               </property>
-               <item>
-                <widget class="QCheckBox" name="checkBox_TimeShift">
-                 <property name="text">
-                  <string>&amp;Shift:</string>
-                 </property>
-                </widget>
-               </item>
-               <item>
-                <widget class="QSpinBox" name="spinBox_TimeValue">
-                 <property name="sizePolicy">
-                  <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                   <horstretch>0</horstretch>
-                   <verstretch>0</verstretch>
-                  </sizepolicy>
-                 </property>
-                 <property name="minimum">
-                  <number>-99999</number>
-                 </property>
-                 <property name="maximum">
-                  <number>99999</number>
-                 </property>
-                </widget>
-               </item>
-              </layout>
-             </item>
-            </layout>
-           </item>
-          </layout>
-         </item>
-         <item>
-          <widget class="QLabel" name="label_4">
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
-           </property>
-           <property name="text">
-            <string>&lt;b&gt;Format&lt;/b&gt;</string>
-           </property>
-           <property name="textFormat">
-            <enum>Qt::AutoText</enum>
-           </property>
-          </widget>
-         </item>
-         <item>
-          <layout class="QHBoxLayout" name="horizontalLayout">
-           <item>
-            <spacer>
-             <property name="orientation">
-              <enum>Qt::Horizontal</enum>
-             </property>
-             <property name="sizeType">
-              <enum>QSizePolicy::Fixed</enum>
-             </property>
-             <property name="sizeHint" stdset="0">
-              <size>
-               <width>18</width>
-               <height>13</height>
-              </size>
-             </property>
-            </spacer>
-           </item>
-           <item>
-            <layout class="QVBoxLayout" name="verticalLayout_2">
-             <item>
-              <widget class="QComboBox" name="comboBoxFormat">
-               <property name="sizePolicy">
-                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                 <horstretch>0</horstretch>
-                 <verstretch>0</verstretch>
-                </sizepolicy>
-               </property>
-              </widget>
-             </item>
-             <item>
-              <widget class="QPushButton" name="pushButtonFormatConfigure">
-               <property name="enabled">
-                <bool>true</bool>
-               </property>
-               <property name="sizePolicy">
-                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                 <horstretch>0</horstretch>
-                 <verstretch>0</verstretch>
-                </sizepolicy>
-               </property>
-               <property name="text">
-                <string>Configure</string>
-               </property>
-              </widget>
-             </item>
-            </layout>
-           </item>
-          </layout>
-         </item>
-         <item>
-          <spacer>
-           <property name="orientation">
-            <enum>Qt::Vertical</enum>
-           </property>
-           <property name="sizeType">
-            <enum>QSizePolicy::Fixed</enum>
-           </property>
-           <property name="sizeHint" stdset="0">
-            <size>
-             <width>13</width>
-             <height>14</height>
-            </size>
-           </property>
-          </spacer>
-         </item>
-        </layout>
-       </item>
-       <item>
-        <layout class="QHBoxLayout">
-         <property name="spacing">
-          <number>6</number>
-         </property>
-         <property name="margin">
-          <number>0</number>
-         </property>
-         <item>
-          <widget class="QFrame" name="frame_video">
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Expanding" vsizetype="Expanding">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
-           </property>
-           <property name="minimumSize">
-            <size>
-             <width>100</width>
-             <height>100</height>
-            </size>
-           </property>
-           <property name="autoFillBackground">
-            <bool>false</bool>
-           </property>
-           <property name="frameShape">
-            <enum>QFrame::NoFrame</enum>
-           </property>
-           <property name="frameShadow">
-            <enum>QFrame::Raised</enum>
-           </property>
-           <property name="lineWidth">
-            <number>0</number>
-           </property>
-          </widget>
-         </item>
-         <item>
-          <spacer>
-           <property name="orientation">
-            <enum>Qt::Horizontal</enum>
-           </property>
-           <property name="sizeType">
-            <enum>QSizePolicy::Expanding</enum>
-           </property>
-           <property name="sizeHint" stdset="0">
-            <size>
-             <width>0</width>
-             <height>0</height>
-            </size>
-           </property>
-          </spacer>
-         </item>
-        </layout>
-       </item>
-      </layout>
-     </item>
-     <item>
-      <layout class="QHBoxLayout">
-       <property name="spacing">
-        <number>6</number>
-       </property>
-       <property name="margin">
-        <number>0</number>
-       </property>
-       <item>
-        <layout class="QVBoxLayout">
-         <property name="spacing">
-          <number>6</number>
-         </property>
-         <property name="margin">
-          <number>0</number>
-         </property>
-         <item>
-          <spacer>
-           <property name="orientation">
-            <enum>Qt::Vertical</enum>
-           </property>
-           <property name="sizeType">
-            <enum>QSizePolicy::Expanding</enum>
-           </property>
-           <property name="sizeHint" stdset="0">
-            <size>
-             <width>0</width>
-             <height>0</height>
-            </size>
-           </property>
-          </spacer>
-         </item>
-         <item>
-          <widget class="ADM_QSlider" name="horizontalSlider">
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Expanding" vsizetype="Fixed">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
-           </property>
-           <property name="orientation">
-            <enum>Qt::Horizontal</enum>
-           </property>
-          </widget>
-         </item>
-         <item>
-          <layout class="QHBoxLayout">
-           <property name="spacing">
-            <number>6</number>
-           </property>
-           <property name="margin">
-            <number>0</number>
-           </property>
-           <item>
-            <widget class="QToolButton" name="toolButtonPlay">
-             <property name="text">
-              <string>...</string>
-             </property>
-             <property name="icon">
-              <iconset resource="avidemux.qrc">
-               <normaloff>:/new/prefix1/pics/player_play.png</normaloff>:/new/prefix1/pics/player_play.png</iconset>
-             </property>
-             <property name="iconSize">
-              <size>
-               <width>24</width>
-               <height>24</height>
-              </size>
-             </property>
-             <property name="autoRaise">
-              <bool>true</bool>
-             </property>
-            </widget>
-           </item>
-           <item>
-            <widget class="QToolButton" name="toolButtonStop">
-             <property name="text">
-              <string>...</string>
-             </property>
-             <property name="icon">
-              <iconset resource="avidemux.qrc">
-               <normaloff>:/new/prefix1/pics/player_stop.png</normaloff>:/new/prefix1/pics/player_stop.png</iconset>
-             </property>
-             <property name="iconSize">
-              <size>
-               <width>24</width>
-               <height>24</height>
-              </size>
-             </property>
-             <property name="autoRaise">
-              <bool>true</bool>
-             </property>
-            </widget>
-           </item>
-           <item>
-            <widget class="QToolButton" name="toolButtonPreviousFrame">
-             <property name="text">
-              <string>...</string>
-             </property>
-             <property name="icon">
-              <iconset resource="avidemux.qrc">
-               <normaloff>:/new/prefix1/pics/back.png</normaloff>:/new/prefix1/pics/back.png</iconset>
-             </property>
-             <property name="iconSize">
-              <size>
-               <width>24</width>
-               <height>24</height>
-              </size>
-             </property>
-             <property name="autoRaise">
-              <bool>true</bool>
-             </property>
-            </widget>
-           </item>
-           <item>
-            <widget class="QToolButton" name="toolButtonNextFrame">
-             <property name="text">
-              <string>...</string>
-             </property>
-             <property name="icon">
-              <iconset resource="avidemux.qrc">
-               <normaloff>:/new/prefix1/pics/forward.png</normaloff>:/new/prefix1/pics/forward.png</iconset>
-             </property>
-             <property name="iconSize">
-              <size>
-               <width>24</width>
-               <height>24</height>
-              </size>
-             </property>
-             <property name="autoRaise">
-              <bool>true</bool>
-             </property>
-            </widget>
-           </item>
-           <item>
-            <widget class="QToolButton" name="toolButtonPreviousIntraFrame">
-             <property name="text">
-              <string>...</string>
-             </property>
-             <property name="icon">
-              <iconset resource="avidemux.qrc">
-               <normaloff>:/new/prefix1/pics/player_rew.png</normaloff>:/new/prefix1/pics/player_rew.png</iconset>
-             </property>
-             <property name="iconSize">
-              <size>
-               <width>24</width>
-               <height>24</height>
-              </size>
-             </property>
-             <property name="autoRaise">
-              <bool>true</bool>
-             </property>
-            </widget>
-           </item>
-           <item>
-            <widget class="QToolButton" name="toolButtonNextIntraFrame">
-             <property name="text">
-              <string>...</string>
-             </property>
-             <property name="icon">
-              <iconset resource="avidemux.qrc">
-               <normaloff>:/new/prefix1/pics/player_fwd.png</normaloff>:/new/prefix1/pics/player_fwd.png</iconset>
-             </property>
-             <property name="iconSize">
-              <size>
-               <width>24</width>
-               <height>24</height>
-              </size>
-             </property>
-             <property name="autoRaise">
-              <bool>true</bool>
-             </property>
-            </widget>
-           </item>
-           <item>
-            <widget class="QToolButton" name="toolButtonSetMarkerA">
-             <property name="text">
-              <string>...</string>
-             </property>
-             <property name="icon">
-              <iconset resource="avidemux.qrc">
-               <normaloff>:/new/prefix1/pics/markA.png</normaloff>:/new/prefix1/pics/markA.png</iconset>
-             </property>
-             <property name="iconSize">
-              <size>
-               <width>24</width>
-               <height>24</height>
-              </size>
-             </property>
-             <property name="autoRaise">
-              <bool>true</bool>
-             </property>
-            </widget>
-           </item>
-           <item>
-            <widget class="QToolButton" name="toolButtonSetMarkerB">
-             <property name="text">
-              <string>...</string>
-             </property>
-             <property name="icon">
-              <iconset resource="avidemux.qrc">
-               <normaloff>:/new/prefix1/pics/markB.png</normaloff>:/new/prefix1/pics/markB.png</iconset>
-             </property>
-             <property name="iconSize">
-              <size>
-               <width>24</width>
-               <height>24</height>
-              </size>
-             </property>
-             <property name="autoRaise">
-              <bool>true</bool>
-             </property>
-            </widget>
-           </item>
-           <item>
-            <widget class="QToolButton" name="toolButtonPreviousBlackFrame">
-             <property name="text">
-              <string>...</string>
-             </property>
-             <property name="icon">
-              <iconset resource="avidemux.qrc">
-               <normaloff>:/new/prefix1/pics/prev_black.png</normaloff>:/new/prefix1/pics/prev_black.png</iconset>
-             </property>
-             <property name="iconSize">
-              <size>
-               <width>24</width>
-               <height>24</height>
-              </size>
-             </property>
-             <property name="autoRaise">
-              <bool>true</bool>
-             </property>
-            </widget>
-           </item>
-           <item>
-            <widget class="QToolButton" name="toolButtonNextBlackFrame">
-             <property name="text">
-              <string>...</string>
-             </property>
-             <property name="icon">
-              <iconset resource="avidemux.qrc">
-               <normaloff>:/new/prefix1/pics/next_black.png</normaloff>:/new/prefix1/pics/next_black.png</iconset>
-             </property>
-             <property name="iconSize">
-              <size>
-               <width>24</width>
-               <height>24</height>
-              </size>
-             </property>
-             <property name="autoRaise">
-              <bool>true</bool>
-             </property>
-            </widget>
-           </item>
-           <item>
-            <widget class="QToolButton" name="toolButtonFirstFrame">
-             <property name="text">
-              <string>...</string>
-             </property>
-             <property name="icon">
-              <iconset resource="avidemux.qrc">
-               <normaloff>:/new/prefix1/pics/player_start.png</normaloff>:/new/prefix1/pics/player_start.png</iconset>
-             </property>
-             <property name="iconSize">
-              <size>
-               <width>24</width>
-               <height>24</height>
-              </size>
-             </property>
-             <property name="autoRaise">
-              <bool>true</bool>
-             </property>
-            </widget>
-           </item>
-           <item>
-            <widget class="QToolButton" name="toolButtonLastFrame">
-             <property name="text">
-              <string>...</string>
-             </property>
-             <property name="icon">
-              <iconset resource="avidemux.qrc">
-               <normaloff>:/new/prefix1/pics/player_end.png</normaloff>:/new/prefix1/pics/player_end.png</iconset>
-             </property>
-             <property name="iconSize">
-              <size>
-               <width>24</width>
-               <height>24</height>
-              </size>
-             </property>
-             <property name="autoRaise">
-              <bool>true</bool>
-             </property>
-            </widget>
-           </item>
-           <item>
-            <spacer>
-             <property name="orientation">
-              <enum>Qt::Horizontal</enum>
-             </property>
-             <property name="sizeHint" stdset="0">
-              <size>
-               <width>20</width>
-               <height>20</height>
-              </size>
-             </property>
-            </spacer>
-           </item>
-          </layout>
-         </item>
-         <item>
-          <layout class="QHBoxLayout">
-           <property name="spacing">
-            <number>6</number>
-           </property>
-           <property name="margin">
-            <number>0</number>
-           </property>
-           <item>
-            <widget class="QLabel" name="label_6">
-             <property name="sizePolicy">
-              <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
-               <horstretch>0</horstretch>
-               <verstretch>0</verstretch>
-              </sizepolicy>
-             </property>
-             <property name="font">
-              <font>
-               <family>MS Shell Dlg 2</family>
-               <pointsize>8</pointsize>
-               <weight>75</weight>
-               <italic>false</italic>
-               <bold>true</bold>
-               <underline>false</underline>
-               <strikeout>false</strikeout>
-              </font>
-             </property>
-             <property name="text">
-              <string>Time:</string>
-             </property>
-            </widget>
-           </item>
-           <item>
-            <widget class="QLineEdit" name="currentTime">
-             <property name="sizePolicy">
-              <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-               <horstretch>0</horstretch>
-               <verstretch>0</verstretch>
-              </sizepolicy>
-             </property>
-             <property name="maximumSize">
-              <size>
-               <width>84</width>
-               <height>16777215</height>
-              </size>
-             </property>
-             <property name="text">
-              <string>00:00:00.000</string>
-             </property>
-             <property name="maxLength">
-              <number>12</number>
-             </property>
-            </widget>
-           </item>
-           <item>
-            <widget class="QLabel" name="totalTime">
-             <property name="sizePolicy">
-              <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
-               <horstretch>0</horstretch>
-               <verstretch>0</verstretch>
-              </sizepolicy>
-             </property>
-             <property name="text">
-              <string>/ 00:00:00.000</string>
-             </property>
-            </widget>
-           </item>
-           <item>
-            <spacer>
-             <property name="orientation">
-              <enum>Qt::Horizontal</enum>
-             </property>
-             <property name="sizeType">
-              <enum>QSizePolicy::Fixed</enum>
-             </property>
-             <property name="sizeHint" stdset="0">
-              <size>
-               <width>20</width>
-               <height>20</height>
-              </size>
-             </property>
-            </spacer>
-           </item>
-           <item>
-            <widget class="QLabel" name="label_14">
-             <property name="font">
-              <font>
-               <family>MS Shell Dlg 2</family>
-               <pointsize>8</pointsize>
-               <weight>75</weight>
-               <italic>false</italic>
-               <bold>true</bold>
-               <underline>false</underline>
-               <strikeout>false</strikeout>
-              </font>
-             </property>
-             <property name="text">
-              <string>Frame Type:</string>
-             </property>
-            </widget>
-           </item>
-           <item>
-            <widget class="QLabel" name="label_8">
-             <property name="sizePolicy">
-              <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
-               <horstretch>0</horstretch>
-               <verstretch>0</verstretch>
-              </sizepolicy>
-             </property>
-             <property name="text">
-              <string>?</string>
-             </property>
-            </widget>
-           </item>
-           <item>
-            <spacer>
-             <property name="orientation">
-              <enum>Qt::Horizontal</enum>
-             </property>
-             <property name="sizeHint" stdset="0">
-              <size>
-               <width>60</width>
-               <height>20</height>
-              </size>
-             </property>
-            </spacer>
-           </item>
-          </layout>
-         </item>
-        </layout>
-       </item>
-       <item>
-        <spacer>
-         <property name="orientation">
-          <enum>Qt::Horizontal</enum>
-         </property>
-         <property name="sizeType">
-          <enum>QSizePolicy::Fixed</enum>
-         </property>
-         <property name="sizeHint" stdset="0">
-          <size>
-           <width>14</width>
-           <height>95</height>
-          </size>
-         </property>
-        </spacer>
-       </item>
-       <item>
-        <layout class="QVBoxLayout" name="verticalLayout">
-         <item>
-          <spacer name="verticalSpacer">
-           <property name="orientation">
-            <enum>Qt::Vertical</enum>
-           </property>
-           <property name="sizeHint" stdset="0">
-            <size>
-             <width>20</width>
-             <height>40</height>
-            </size>
-           </property>
-          </spacer>
-         </item>
-         <item>
-          <widget class="QFrame" name="frameVU">
-           <property name="minimumSize">
-            <size>
-             <width>64</width>
-             <height>64</height>
-            </size>
-           </property>
-           <property name="frameShape">
-            <enum>QFrame::StyledPanel</enum>
-           </property>
-           <property name="frameShadow">
-            <enum>QFrame::Raised</enum>
-           </property>
-          </widget>
-         </item>
-        </layout>
-       </item>
-       <item>
-        <layout class="QVBoxLayout" name="verticalLayout_6">
-         <item>
-          <spacer name="verticalSpacer_2">
-           <property name="orientation">
-            <enum>Qt::Vertical</enum>
-           </property>
-           <property name="sizeHint" stdset="0">
-            <size>
-             <width>20</width>
-             <height>13</height>
-            </size>
-           </property>
-          </spacer>
-         </item>
-         <item>
-          <widget class="QGroupBox" name="groupBox">
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Minimum" vsizetype="Minimum">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
-           </property>
-           <property name="minimumSize">
-            <size>
-             <width>116</width>
-             <height>100</height>
-            </size>
-           </property>
-           <property name="maximumSize">
-            <size>
-             <width>100</width>
-             <height>100</height>
-            </size>
-           </property>
-           <property name="font">
-            <font>
-             <family>MS Shell Dlg 2</family>
-             <pointsize>8</pointsize>
-             <weight>75</weight>
-             <italic>false</italic>
-             <bold>true</bold>
-             <underline>false</underline>
-             <strikeout>false</strikeout>
-            </font>
-           </property>
-           <property name="title">
-            <string>Selection</string>
-           </property>
-           <property name="alignment">
-            <set>Qt::AlignLeading|Qt::AlignLeft|Qt::AlignVCenter</set>
-           </property>
-           <widget class="QWidget" name="">
-            <property name="geometry">
-             <rect>
-              <x>9</x>
-              <y>32</y>
-              <width>98</width>
-              <height>58</height>
-             </rect>
+                <property name="minimum">
+                 <number>-99999</number>
+                </property>
+                <property name="maximum">
+                 <number>99999</number>
+                </property>
+               </widget>
+              </item>
+             </layout>
+            </item>
+           </layout>
+          </item>
+         </layout>
+        </item>
+        <item>
+         <widget class="QLabel" name="label_4">
+          <property name="sizePolicy">
+           <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+            <horstretch>0</horstretch>
+            <verstretch>0</verstretch>
+           </sizepolicy>
+          </property>
+          <property name="text">
+           <string>&lt;b&gt;Format&lt;/b&gt;</string>
+          </property>
+          <property name="textFormat">
+           <enum>Qt::AutoText</enum>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <layout class="QHBoxLayout" name="horizontalLayout">
+          <item>
+           <spacer>
+            <property name="orientation">
+             <enum>Qt::Horizontal</enum>
             </property>
-            <layout class="QVBoxLayout" name="verticalLayout_4">
-             <item>
-              <layout class="QHBoxLayout" name="horizontalLayout_3">
-               <item>
-                <widget class="QLabel" name="label_12">
-                 <property name="font">
-                  <font>
-                   <family>MS Shell Dlg 2</family>
-                   <pointsize>8</pointsize>
-                   <weight>50</weight>
-                   <italic>false</italic>
-                   <bold>false</bold>
-                   <underline>false</underline>
-                   <strikeout>false</strikeout>
-                  </font>
-                 </property>
-                 <property name="text">
-                  <string> A:</string>
-                 </property>
-                </widget>
-               </item>
-               <item>
-                <widget class="QPushButton" name="pushButtonJumpToMarkerA">
-                 <property name="sizePolicy">
-                  <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                   <horstretch>0</horstretch>
-                   <verstretch>0</verstretch>
-                  </sizepolicy>
-                 </property>
-                 <property name="font">
-                  <font>
-                   <family>MS Shell Dlg 2</family>
-                   <pointsize>8</pointsize>
-                   <weight>50</weight>
-                   <italic>false</italic>
-                   <bold>false</bold>
-                   <underline>false</underline>
-                   <strikeout>false</strikeout>
-                  </font>
-                 </property>
-                 <property name="text">
-                  <string>000000</string>
-                 </property>
-                </widget>
-               </item>
-              </layout>
-             </item>
-             <item>
-              <layout class="QHBoxLayout" name="horizontalLayout_4">
-               <item>
-                <widget class="QLabel" name="label_11">
-                 <property name="font">
-                  <font>
-                   <family>MS Shell Dlg 2</family>
-                   <pointsize>8</pointsize>
-                   <weight>50</weight>
-                   <italic>false</italic>
-                   <bold>false</bold>
-                   <underline>false</underline>
-                   <strikeout>false</strikeout>
-                  </font>
-                 </property>
-                 <property name="text">
-                  <string> B:</string>
-                 </property>
-                </widget>
-               </item>
-               <item>
-                <widget class="QPushButton" name="pushButtonJumpToMarkerB">
-                 <property name="sizePolicy">
-                  <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                   <horstretch>0</horstretch>
-                   <verstretch>0</verstretch>
-                  </sizepolicy>
-                 </property>
-                 <property name="font">
-                  <font>
-                   <family>MS Shell Dlg 2</family>
-                   <pointsize>8</pointsize>
-                   <weight>50</weight>
-                   <italic>false</italic>
-                   <bold>false</bold>
-                   <underline>false</underline>
-                   <strikeout>false</strikeout>
-                  </font>
-                 </property>
-                 <property name="layoutDirection">
-                  <enum>Qt::LeftToRight</enum>
-                 </property>
-                 <property name="text">
-                  <string>000000</string>
-                 </property>
-                </widget>
-               </item>
-              </layout>
-             </item>
-            </layout>
+            <property name="sizeType">
+             <enum>QSizePolicy::Fixed</enum>
+            </property>
+            <property name="sizeHint" stdset="0">
+             <size>
+              <width>18</width>
+              <height>13</height>
+             </size>
+            </property>
+           </spacer>
+          </item>
+          <item>
+           <layout class="QVBoxLayout" name="verticalLayout_2">
+            <item>
+             <widget class="QComboBox" name="comboBoxFormat">
+              <property name="sizePolicy">
+               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QPushButton" name="pushButtonFormatConfigure">
+              <property name="enabled">
+               <bool>true</bool>
+              </property>
+              <property name="sizePolicy">
+               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+              <property name="text">
+               <string>Configure</string>
+              </property>
+             </widget>
+            </item>
+           </layout>
+          </item>
+         </layout>
+        </item>
+        <item>
+         <spacer>
+          <property name="orientation">
+           <enum>Qt::Vertical</enum>
+          </property>
+          <property name="sizeType">
+           <enum>QSizePolicy::Fixed</enum>
+          </property>
+          <property name="sizeHint" stdset="0">
+           <size>
+            <width>13</width>
+            <height>14</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+       </layout>
+      </item>
+      <item>
+       <layout class="QHBoxLayout">
+        <property name="spacing">
+         <number>6</number>
+        </property>
+        <property name="margin">
+         <number>0</number>
+        </property>
+        <item>
+         <widget class="QFrame" name="frame_video">
+          <property name="sizePolicy">
+           <sizepolicy hsizetype="MinimumExpanding" vsizetype="MinimumExpanding">
+            <horstretch>0</horstretch>
+            <verstretch>0</verstretch>
+           </sizepolicy>
+          </property>
+          <property name="minimumSize">
+           <size>
+            <width>100</width>
+            <height>100</height>
+           </size>
+          </property>
+          <property name="autoFillBackground">
+           <bool>false</bool>
+          </property>
+          <property name="frameShape">
+           <enum>QFrame::NoFrame</enum>
+          </property>
+          <property name="frameShadow">
+           <enum>QFrame::Raised</enum>
+          </property>
+          <property name="lineWidth">
+           <number>0</number>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <spacer>
+          <property name="orientation">
+           <enum>Qt::Horizontal</enum>
+          </property>
+          <property name="sizeType">
+           <enum>QSizePolicy::Expanding</enum>
+          </property>
+          <property name="sizeHint" stdset="0">
+           <size>
+            <width>13</width>
+            <height>13</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+       </layout>
+      </item>
+     </layout>
+    </item>
+    <item>
+     <spacer name="verticalSpacer_3">
+      <property name="orientation">
+       <enum>Qt::Vertical</enum>
+      </property>
+      <property name="sizeType">
+       <enum>QSizePolicy::MinimumExpanding</enum>
+      </property>
+      <property name="sizeHint" stdset="0">
+       <size>
+        <width>716</width>
+        <height>1</height>
+       </size>
+      </property>
+     </spacer>
+    </item>
+    <item>
+     <layout class="QHBoxLayout">
+      <property name="spacing">
+       <number>6</number>
+      </property>
+      <property name="margin">
+       <number>0</number>
+      </property>
+      <item>
+       <layout class="QVBoxLayout">
+        <property name="spacing">
+         <number>6</number>
+        </property>
+        <property name="margin">
+         <number>0</number>
+        </property>
+        <item>
+         <widget class="ADM_QSlider" name="horizontalSlider">
+          <property name="sizePolicy">
+           <sizepolicy hsizetype="Expanding" vsizetype="Fixed">
+            <horstretch>0</horstretch>
+            <verstretch>0</verstretch>
+           </sizepolicy>
+          </property>
+          <property name="orientation">
+           <enum>Qt::Horizontal</enum>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <layout class="QHBoxLayout">
+          <property name="spacing">
+           <number>6</number>
+          </property>
+          <property name="margin">
+           <number>0</number>
+          </property>
+          <item>
+           <widget class="QToolButton" name="toolButtonPlay">
+            <property name="text">
+             <string>...</string>
+            </property>
+            <property name="icon">
+             <iconset resource="avidemux.qrc">
+              <normaloff>:/new/prefix1/pics/player_play.png</normaloff>:/new/prefix1/pics/player_play.png</iconset>
+            </property>
+            <property name="iconSize">
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise">
+             <bool>true</bool>
+            </property>
            </widget>
-          </widget>
-         </item>
-        </layout>
-       </item>
-       <item>
-        <layout class="QVBoxLayout">
-         <property name="spacing">
-          <number>6</number>
-         </property>
-         <property name="margin">
-          <number>0</number>
-         </property>
-         <item>
-          <spacer>
-           <property name="orientation">
-            <enum>Qt::Vertical</enum>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonStop">
+            <property name="text">
+             <string>...</string>
+            </property>
+            <property name="icon">
+             <iconset resource="avidemux.qrc">
+              <normaloff>:/new/prefix1/pics/player_stop.png</normaloff>:/new/prefix1/pics/player_stop.png</iconset>
+            </property>
+            <property name="iconSize">
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise">
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonPreviousFrame">
+            <property name="text">
+             <string>...</string>
+            </property>
+            <property name="icon">
+             <iconset resource="avidemux.qrc">
+              <normaloff>:/new/prefix1/pics/back.png</normaloff>:/new/prefix1/pics/back.png</iconset>
+            </property>
+            <property name="iconSize">
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise">
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonNextFrame">
+            <property name="text">
+             <string>...</string>
+            </property>
+            <property name="icon">
+             <iconset resource="avidemux.qrc">
+              <normaloff>:/new/prefix1/pics/forward.png</normaloff>:/new/prefix1/pics/forward.png</iconset>
+            </property>
+            <property name="iconSize">
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise">
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonPreviousIntraFrame">
+            <property name="text">
+             <string>...</string>
+            </property>
+            <property name="icon">
+             <iconset resource="avidemux.qrc">
+              <normaloff>:/new/prefix1/pics/player_rew.png</normaloff>:/new/prefix1/pics/player_rew.png</iconset>
+            </property>
+            <property name="iconSize">
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise">
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonNextIntraFrame">
+            <property name="text">
+             <string>...</string>
+            </property>
+            <property name="icon">
+             <iconset resource="avidemux.qrc">
+              <normaloff>:/new/prefix1/pics/player_fwd.png</normaloff>:/new/prefix1/pics/player_fwd.png</iconset>
+            </property>
+            <property name="iconSize">
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise">
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonSetMarkerA">
+            <property name="text">
+             <string>...</string>
+            </property>
+            <property name="icon">
+             <iconset resource="avidemux.qrc">
+              <normaloff>:/new/prefix1/pics/markA.png</normaloff>:/new/prefix1/pics/markA.png</iconset>
+            </property>
+            <property name="iconSize">
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise">
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonSetMarkerB">
+            <property name="text">
+             <string>...</string>
+            </property>
+            <property name="icon">
+             <iconset resource="avidemux.qrc">
+              <normaloff>:/new/prefix1/pics/markB.png</normaloff>:/new/prefix1/pics/markB.png</iconset>
+            </property>
+            <property name="iconSize">
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise">
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonPreviousBlackFrame">
+            <property name="text">
+             <string>...</string>
+            </property>
+            <property name="icon">
+             <iconset resource="avidemux.qrc">
+              <normaloff>:/new/prefix1/pics/prev_black.png</normaloff>:/new/prefix1/pics/prev_black.png</iconset>
+            </property>
+            <property name="iconSize">
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise">
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonNextBlackFrame">
+            <property name="text">
+             <string>...</string>
+            </property>
+            <property name="icon">
+             <iconset resource="avidemux.qrc">
+              <normaloff>:/new/prefix1/pics/next_black.png</normaloff>:/new/prefix1/pics/next_black.png</iconset>
+            </property>
+            <property name="iconSize">
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise">
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonFirstFrame">
+            <property name="text">
+             <string>...</string>
+            </property>
+            <property name="icon">
+             <iconset resource="avidemux.qrc">
+              <normaloff>:/new/prefix1/pics/player_start.png</normaloff>:/new/prefix1/pics/player_start.png</iconset>
+            </property>
+            <property name="iconSize">
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise">
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QToolButton" name="toolButtonLastFrame">
+            <property name="text">
+             <string>...</string>
+            </property>
+            <property name="icon">
+             <iconset resource="avidemux.qrc">
+              <normaloff>:/new/prefix1/pics/player_end.png</normaloff>:/new/prefix1/pics/player_end.png</iconset>
+            </property>
+            <property name="iconSize">
+             <size>
+              <width>24</width>
+              <height>24</height>
+             </size>
+            </property>
+            <property name="autoRaise">
+             <bool>true</bool>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <spacer>
+            <property name="orientation">
+             <enum>Qt::Horizontal</enum>
+            </property>
+            <property name="sizeHint" stdset="0">
+             <size>
+              <width>20</width>
+              <height>20</height>
+             </size>
+            </property>
+           </spacer>
+          </item>
+         </layout>
+        </item>
+        <item>
+         <layout class="QHBoxLayout">
+          <property name="spacing">
+           <number>6</number>
+          </property>
+          <property name="margin">
+           <number>0</number>
+          </property>
+          <item>
+           <widget class="QLabel" name="label_6">
+            <property name="sizePolicy">
+             <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
+              <horstretch>0</horstretch>
+              <verstretch>0</verstretch>
+             </sizepolicy>
+            </property>
+            <property name="font">
+             <font>
+              <family>MS Shell Dlg 2</family>
+              <pointsize>8</pointsize>
+              <weight>75</weight>
+              <italic>false</italic>
+              <bold>true</bold>
+              <underline>false</underline>
+              <strikeout>false</strikeout>
+             </font>
+            </property>
+            <property name="text">
+             <string>Time:</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QLineEdit" name="currentTime">
+            <property name="sizePolicy">
+             <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
+              <horstretch>0</horstretch>
+              <verstretch>0</verstretch>
+             </sizepolicy>
+            </property>
+            <property name="maximumSize">
+             <size>
+              <width>84</width>
+              <height>16777215</height>
+             </size>
+            </property>
+            <property name="text">
+             <string>00:00:00.000</string>
+            </property>
+            <property name="maxLength">
+             <number>12</number>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QLabel" name="totalTime">
+            <property name="sizePolicy">
+             <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
+              <horstretch>0</horstretch>
+              <verstretch>0</verstretch>
+             </sizepolicy>
+            </property>
+            <property name="text">
+             <string>/ 00:00:00.000</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <spacer>
+            <property name="orientation">
+             <enum>Qt::Horizontal</enum>
+            </property>
+            <property name="sizeType">
+             <enum>QSizePolicy::Fixed</enum>
+            </property>
+            <property name="sizeHint" stdset="0">
+             <size>
+              <width>20</width>
+              <height>20</height>
+             </size>
+            </property>
+           </spacer>
+          </item>
+          <item>
+           <widget class="QLabel" name="label_14">
+            <property name="font">
+             <font>
+              <family>MS Shell Dlg 2</family>
+              <pointsize>8</pointsize>
+              <weight>75</weight>
+              <italic>false</italic>
+              <bold>true</bold>
+              <underline>false</underline>
+              <strikeout>false</strikeout>
+             </font>
+            </property>
+            <property name="text">
+             <string>Frame Type:</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <widget class="QLabel" name="label_8">
+            <property name="sizePolicy">
+             <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
+              <horstretch>0</horstretch>
+              <verstretch>0</verstretch>
+             </sizepolicy>
+            </property>
+            <property name="text">
+             <string>?</string>
+            </property>
+           </widget>
+          </item>
+          <item>
+           <spacer>
+            <property name="orientation">
+             <enum>Qt::Horizontal</enum>
+            </property>
+            <property name="sizeHint" stdset="0">
+             <size>
+              <width>60</width>
+              <height>20</height>
+             </size>
+            </property>
+           </spacer>
+          </item>
+         </layout>
+        </item>
+       </layout>
+      </item>
+      <item>
+       <spacer>
+        <property name="orientation">
+         <enum>Qt::Horizontal</enum>
+        </property>
+        <property name="sizeType">
+         <enum>QSizePolicy::Fixed</enum>
+        </property>
+        <property name="sizeHint" stdset="0">
+         <size>
+          <width>14</width>
+          <height>95</height>
+         </size>
+        </property>
+       </spacer>
+      </item>
+      <item>
+       <layout class="QVBoxLayout" name="verticalLayout">
+        <item>
+         <widget class="QFrame" name="frameVU">
+          <property name="minimumSize">
+           <size>
+            <width>64</width>
+            <height>64</height>
+           </size>
+          </property>
+          <property name="frameShape">
+           <enum>QFrame::StyledPanel</enum>
+          </property>
+          <property name="frameShadow">
+           <enum>QFrame::Raised</enum>
+          </property>
+         </widget>
+        </item>
+       </layout>
+      </item>
+      <item>
+       <layout class="QVBoxLayout" name="verticalLayout_6">
+        <item>
+         <widget class="QGroupBox" name="groupBox">
+          <property name="sizePolicy">
+           <sizepolicy hsizetype="Minimum" vsizetype="Minimum">
+            <horstretch>0</horstretch>
+            <verstretch>0</verstretch>
+           </sizepolicy>
+          </property>
+          <property name="minimumSize">
+           <size>
+            <width>116</width>
+            <height>100</height>
+           </size>
+          </property>
+          <property name="maximumSize">
+           <size>
+            <width>100</width>
+            <height>100</height>
+           </size>
+          </property>
+          <property name="font">
+           <font>
+            <family>MS Shell Dlg 2</family>
+            <pointsize>8</pointsize>
+            <weight>75</weight>
+            <italic>false</italic>
+            <bold>true</bold>
+            <underline>false</underline>
+            <strikeout>false</strikeout>
+           </font>
+          </property>
+          <property name="title">
+           <string>Selection</string>
+          </property>
+          <property name="alignment">
+           <set>Qt::AlignLeading|Qt::AlignLeft|Qt::AlignVCenter</set>
+          </property>
+          <widget class="QWidget" name="layoutWidget">
+           <property name="geometry">
+            <rect>
+             <x>9</x>
+             <y>32</y>
+             <width>98</width>
+             <height>58</height>
+            </rect>
            </property>
-           <property name="sizeType">
-            <enum>QSizePolicy::Expanding</enum>
-           </property>
-           <property name="sizeHint" stdset="0">
-            <size>
-             <width>0</width>
-             <height>0</height>
-            </size>
-           </property>
-          </spacer>
-         </item>
-        </layout>
-       </item>
-       <item>
-        <layout class="QVBoxLayout">
-         <property name="spacing">
-          <number>4</number>
-         </property>
-         <property name="margin">
-          <number>0</number>
-         </property>
-         <item>
-          <spacer>
-           <property name="orientation">
-            <enum>Qt::Vertical</enum>
-           </property>
-           <property name="sizeType">
-            <enum>QSizePolicy::Expanding</enum>
-           </property>
-           <property name="sizeHint" stdset="0">
-            <size>
-             <width>0</width>
-             <height>0</height>
-            </size>
-           </property>
-          </spacer>
-         </item>
-         <item>
-          <widget class="QToolButton" name="toolButtonAudioToggle">
-           <property name="enabled">
-            <bool>true</bool>
-           </property>
-           <property name="text">
-            <string>...</string>
-           </property>
-           <property name="icon">
-            <iconset resource="avidemux.qrc">
-             <normaloff>:/new/prefix1/pics/arts.png</normaloff>:/new/prefix1/pics/arts.png</iconset>
-           </property>
-           <property name="checkable">
-            <bool>true</bool>
-           </property>
-           <property name="checked">
-            <bool>true</bool>
-           </property>
+           <layout class="QVBoxLayout" name="verticalLayout_4">
+            <item>
+             <layout class="QHBoxLayout" name="horizontalLayout_3">
+              <item>
+               <widget class="QLabel" name="label_12">
+                <property name="font">
+                 <font>
+                  <family>MS Shell Dlg 2</family>
+                  <pointsize>8</pointsize>
+                  <weight>50</weight>
+                  <italic>false</italic>
+                  <bold>false</bold>
+                  <underline>false</underline>
+                  <strikeout>false</strikeout>
+                 </font>
+                </property>
+                <property name="text">
+                 <string> A:</string>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <widget class="QPushButton" name="pushButtonJumpToMarkerA">
+                <property name="sizePolicy">
+                 <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                  <horstretch>0</horstretch>
+                  <verstretch>0</verstretch>
+                 </sizepolicy>
+                </property>
+                <property name="font">
+                 <font>
+                  <family>MS Shell Dlg 2</family>
+                  <pointsize>8</pointsize>
+                  <weight>50</weight>
+                  <italic>false</italic>
+                  <bold>false</bold>
+                  <underline>false</underline>
+                  <strikeout>false</strikeout>
+                 </font>
+                </property>
+                <property name="text">
+                 <string>000000</string>
+                </property>
+               </widget>
+              </item>
+             </layout>
+            </item>
+            <item>
+             <layout class="QHBoxLayout" name="horizontalLayout_4">
+              <item>
+               <widget class="QLabel" name="label_11">
+                <property name="font">
+                 <font>
+                  <family>MS Shell Dlg 2</family>
+                  <pointsize>8</pointsize>
+                  <weight>50</weight>
+                  <italic>false</italic>
+                  <bold>false</bold>
+                  <underline>false</underline>
+                  <strikeout>false</strikeout>
+                 </font>
+                </property>
+                <property name="text">
+                 <string> B:</string>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <widget class="QPushButton" name="pushButtonJumpToMarkerB">
+                <property name="sizePolicy">
+                 <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                  <horstretch>0</horstretch>
+                  <verstretch>0</verstretch>
+                 </sizepolicy>
+                </property>
+                <property name="font">
+                 <font>
+                  <family>MS Shell Dlg 2</family>
+                  <pointsize>8</pointsize>
+                  <weight>50</weight>
+                  <italic>false</italic>
+                  <bold>false</bold>
+                  <underline>false</underline>
+                  <strikeout>false</strikeout>
+                 </font>
+                </property>
+                <property name="layoutDirection">
+                 <enum>Qt::LeftToRight</enum>
+                </property>
+                <property name="text">
+                 <string>000000</string>
+                </property>
+               </widget>
+              </item>
+             </layout>
+            </item>
+           </layout>
           </widget>
-         </item>
-         <item>
-          <widget class="QSlider" name="horizontalSlider_2">
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Preferred" vsizetype="Minimum">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
-           </property>
-           <property name="maximumSize">
-            <size>
-             <width>16777215</width>
-             <height>64</height>
-            </size>
-           </property>
-           <property name="maximum">
-            <number>100</number>
-           </property>
-           <property name="value">
-            <number>100</number>
-           </property>
-           <property name="orientation">
-            <enum>Qt::Vertical</enum>
-           </property>
-          </widget>
-         </item>
-        </layout>
-       </item>
-      </layout>
-     </item>
-    </layout>
-   </widget>
+         </widget>
+        </item>
+       </layout>
+      </item>
+      <item>
+       <spacer name="horizontalSpacer">
+        <property name="orientation">
+         <enum>Qt::Horizontal</enum>
+        </property>
+        <property name="sizeHint" stdset="0">
+         <size>
+          <width>40</width>
+          <height>20</height>
+         </size>
+        </property>
+       </spacer>
+      </item>
+      <item>
+       <layout class="QVBoxLayout">
+        <property name="spacing">
+         <number>6</number>
+        </property>
+        <property name="margin">
+         <number>0</number>
+        </property>
+       </layout>
+      </item>
+      <item>
+       <layout class="QVBoxLayout">
+        <property name="spacing">
+         <number>4</number>
+        </property>
+        <property name="margin">
+         <number>0</number>
+        </property>
+        <item>
+         <widget class="QToolButton" name="toolButtonAudioToggle">
+          <property name="enabled">
+           <bool>true</bool>
+          </property>
+          <property name="text">
+           <string>...</string>
+          </property>
+          <property name="icon">
+           <iconset resource="avidemux.qrc">
+            <normaloff>:/new/prefix1/pics/arts.png</normaloff>:/new/prefix1/pics/arts.png</iconset>
+          </property>
+          <property name="checkable">
+           <bool>true</bool>
+          </property>
+          <property name="checked">
+           <bool>true</bool>
+          </property>
+         </widget>
+        </item>
+        <item>
+         <widget class="QSlider" name="horizontalSlider_2">
+          <property name="sizePolicy">
+           <sizepolicy hsizetype="Preferred" vsizetype="Minimum">
+            <horstretch>0</horstretch>
+            <verstretch>0</verstretch>
+           </sizepolicy>
+          </property>
+          <property name="maximumSize">
+           <size>
+            <width>16777215</width>
+            <height>64</height>
+           </size>
+          </property>
+          <property name="maximum">
+           <number>100</number>
+          </property>
+          <property name="value">
+           <number>100</number>
+          </property>
+          <property name="orientation">
+           <enum>Qt::Vertical</enum>
+          </property>
+         </widget>
+        </item>
+       </layout>
+      </item>
+     </layout>
+    </item>
+   </layout>
   </widget>
   <widget class="QMenuBar" name="menubar">
    <property name="geometry">
     <rect>
      <x>0</x>
      <y>0</y>
-     <width>782</width>
+     <width>640</width>
      <height>21</height>
     </rect>
    </property>

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/ADM_ffmp43.cpp	2010-04-08 09:03:40 UTC (rev 6098)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/ADM_ffmp43.cpp	2010-04-08 18:26:07 UTC (rev 6099)
@@ -395,8 +395,10 @@
 	  return 1;
 
 	}
+#if 0
       printf ("[lavc] Err: %d, size: %d\n", ret, in->dataLength);
       printf ("\n[lavc] error in FFMP43/mpeg4!: got picture\n");
+#endif
       //GUI_Alert("Please retry with misc->Turbo off");
       //return 1;
       return 0;



From gruntster at mail.berlios.de  Thu Apr  8 21:19:43 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 8 Apr 2010 21:19:43 +0200
Subject: [Avidemux-svn-commit] r6100 -
	branches/avidemux_2.5_branch_gruntster/cmake
Message-ID: <201004081919.o38JJh4X018879@sheep.berlios.de>

Author: gruntster
Date: 2010-04-08 21:19:39 +0200 (Thu, 08 Apr 2010)
New Revision: 6100

Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
Log:
[ffmpeg] replace XPLATFORM cmake flag with CROSS_ARCH and CROSS_OS

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2010-04-08 18:26:07 UTC (rev 6099)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2010-04-08 19:19:39 UTC (rev 6100)
@@ -88,11 +88,20 @@
 	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --extra-ldflags=${CMAKE_SHARED_LINKER_FLAGS})
 endif (CMAKE_SHARED_LINKER_FLAGS)
 
-if (XPLATFORM)
-	set(XPLATFORM "${XPLATFORM}" CACHE STRING "")
-	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-cross-compile --arch=${XPLATFORM})
-endif (XPLATFORM)
+if (CROSS_ARCH OR CROSS_OS)
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-cross-compile)
+endif (CROSS_ARCH OR CROSS_OS)
 
+if (CROSS_ARCH)
+	set(CROSS_ARCH "${CROSS_ARCH}" CACHE STRING "")
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --arch=${CROSS_ARCH})
+endif (CROSS_ARCH)
+
+if (CROSS_OS)
+	set(CROSS_OS "${CROSS_OS}" CACHE STRING "")
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --target-os=${CROSS_OS})
+endif (CROSS_OS)
+
 if (NOT "${LAST_FFMPEG_FLAGS}" STREQUAL "${FFMPEG_FLAGS}")
 	set(FFMPEG_PERFORM_BUILD 1)
 endif (NOT "${LAST_FFMPEG_FLAGS}" STREQUAL "${FFMPEG_FLAGS}")



From gruntster at mail.berlios.de  Thu Apr  8 21:20:35 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 8 Apr 2010 21:20:35 +0200
Subject: [Avidemux-svn-commit] r6101 -
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi
Message-ID: <201004081920.o38JKZt2018957@sheep.berlios.de>

Author: gruntster
Date: 2010-04-08 21:20:31 +0200 (Thu, 08 Apr 2010)
New Revision: 6101

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp
Log:
[ffmpeg] compilation fix for osx

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp	2010-04-08 19:19:39 UTC (rev 6100)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp	2010-04-08 19:20:31 UTC (rev 6101)
@@ -21,6 +21,9 @@
 extern "C"
 {
 #include "ADM_libraries/ffmpeg/config.h"
+#ifdef __APPLE__
+#define restrict
+#endif
 #include "libavcodec/put_bits.h"
 #undef printf
 }



From gruntster at mail.berlios.de  Fri Apr  9 08:49:33 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri, 9 Apr 2010 08:49:33 +0200
Subject: [Avidemux-svn-commit] r6102 -
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec
Message-ID: <201004090649.o396nXQq002595@sheep.berlios.de>

Author: gruntster
Date: 2010-04-09 08:49:28 +0200 (Fri, 09 Apr 2010)
New Revision: 6102

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/h263Encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg4aspEncoder.cpp
Log:
[vidEnc] fix single pass of H.263 and MPEG-4 ASP avcodec encoder

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/h263Encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/h263Encoder.cpp	2010-04-08 19:20:31 UTC (rev 6101)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/h263Encoder.cpp	2010-04-09 06:49:28 UTC (rev 6102)
@@ -521,8 +521,8 @@
 {
 	int ret = AvcodecEncoder::encodeFrame(encodeParams);
 
-	if (_context->stats_out)
-		fprintf (_statFile, "%s", _context->stats_out);
+	if (_context->stats_out && _statFile)
+		fprintf(_statFile, "%s", _context->stats_out);
 
 	return ret;
 }

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg4aspEncoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg4aspEncoder.cpp	2010-04-08 19:20:31 UTC (rev 6101)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg4aspEncoder.cpp	2010-04-09 06:49:28 UTC (rev 6102)
@@ -484,8 +484,8 @@
 {
 	int ret = AvcodecEncoder::encodeFrame(encodeParams);
 
-	if (_context->stats_out)
-		fprintf (_statFile, "%s", _context->stats_out);
+	if (_context->stats_out && _statFile)
+		fprintf(_statFile, "%s", _context->stats_out);
 
 	return ret;
 }



From mean at mail.berlios.de  Fri Apr  9 17:22:58 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 9 Apr 2010 17:22:58 +0200
Subject: [Avidemux-svn-commit] r6103 - branches/avidemux_2.6_branch_mean
Message-ID: <201004091522.o39FMwuS010277@sheep.berlios.de>

Author: mean
Date: 2010-04-09 17:22:58 +0200 (Fri, 09 Apr 2010)
New Revision: 6103

Modified:
   branches/avidemux_2.6_branch_mean/bootStrap.bash
Log:
[bootstrap] Fix debug mode

Modified: branches/avidemux_2.6_branch_mean/bootStrap.bash
===================================================================
--- branches/avidemux_2.6_branch_mean/bootStrap.bash	2010-04-09 06:49:28 UTC (rev 6102)
+++ branches/avidemux_2.6_branch_mean/bootStrap.bash	2010-04-09 15:22:58 UTC (rev 6103)
@@ -135,34 +135,39 @@
 config
 echo "**BootStrapping avidemux **"
 export TOP=$PWD
+export POSTFIX=""
 echo "Top dir : $TOP"
+if [ "x$debug" = "x1" ] ; then echo   
+POSTFIX="_debug"
+fi
+
 if [ "x$do_core" = "x1" ] ; then 
         echo "** CORE **"
         cd $TOP
         Process buildCore ../avidemux_core
         echo " Core needs to be installed, installing through sudo make install ...."
-        cd $TOP/buildCore && sudo make install
+        cd $TOP/buildCore${POSTFIX} && sudo make install
 fi
 if [ "x$do_qt4" = "x1" ] ; then 
         echo "** QT4 **"
         cd $TOP
         Process buildQt4 ../avidemux/qt4
         echo " Qt4 needs to be installed, installing through sudo make install ...."
-        cd $TOP/buildQt4 && sudo make install
+        cd $TOP/buildQt4${POSTFIX} && sudo make install
 fi
 if [ "x$do_cli" = "x1" ] ; then 
         echo "** CLI **"
         cd $TOP
         Process buildCli ../avidemux/cli
         echo " Cli needs to be installed, installing through sudo make install ...."
-        cd $TOP/buildCli && sudo make install
+        cd $TOP/buildCli${POSTFIX} && sudo make install
 fi
 if [ "x$do_gtk" = "x1" ] ; then 
         echo "** GTK **"
         cd $TOP
         Process buildGtk ../avidemux/gtk
         echo " Gtk needs to be installed, installing through sudo make install ...."
-        cd $TOP/buildGtk && sudo make install
+        cd $TOP/buildGtk${POSTFIX} && sudo make install
 fi
 if [ "x$do_plugins" = "x1" ] ; then 
         echo "** Plugins **"



From mean at mail.berlios.de  Fri Apr  9 17:23:01 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 9 Apr 2010 17:23:01 +0200
Subject: [Avidemux-svn-commit] r6104 - in branches/avidemux_2.6_branch_mean:
	avidemux_core cmake
Message-ID: <201004091523.o39FN1rD010289@sheep.berlios.de>

Author: mean
Date: 2010-04-09 17:23:01 +0200 (Fri, 09 Apr 2010)
New Revision: 6104

Added:
   branches/avidemux_2.6_branch_mean/avidemux_core/corePackageTarGz.cmake
   branches/avidemux_2.6_branch_mean/cmake/admPackager.cmake
Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt
Log:
[build] Prepare to be able to generate rpm,deb and tar.gz

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt	2010-04-09 15:22:58 UTC (rev 6103)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt	2010-04-09 15:23:01 UTC (rev 6104)
@@ -76,10 +76,7 @@
 #
 # Packaging
 #
-IF(RPM)
-        INCLUDE(./corePackageRpm.cmake)
-ELSE(RPM)
-        INCLUDE(./corePackageDebian.cmake)
-ENDIF(RPM)
+include(admPackager)
+admPackager(corePackage)
 INSTALL(FILES ${CMAKE_BINARY_DIR}/config/ADM_coreConfig.h DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6") 
 MESSAGE("")

Added: branches/avidemux_2.6_branch_mean/avidemux_core/corePackageTarGz.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/corePackageTarGz.cmake	2010-04-09 15:22:58 UTC (rev 6103)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/corePackageTarGz.cmake	2010-04-09 15:23:01 UTC (rev 6104)
@@ -0,0 +1,16 @@
+##############################
+# Tar GZ
+##############################
+SET(CPACK_SET_DESTDIR "ON")
+SET(CPACK_GENERATOR "TGZ")
+# Some more infos
+SET(CPACK_PACKAGE_VERSION_MAJOR "2")
+SET(CPACK_PACKAGE_VERSION_MINOR "6")
+SET(CPACK_PACKAGE_VERSION_PATCH "0")
+
+SET(CPACK_PACKAGE_VERSION_PATCH "0_r${ADM_SUBVERSION}")
+#
+SET(CPACK_PACKAGE_NAME "avidemux3-core")
+#
+
+include(CPack)

Added: branches/avidemux_2.6_branch_mean/cmake/admPackager.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admPackager.cmake	2010-04-09 15:22:58 UTC (rev 6103)
+++ branches/avidemux_2.6_branch_mean/cmake/admPackager.cmake	2010-04-09 15:23:01 UTC (rev 6104)
@@ -0,0 +1,22 @@
+#
+# Set ADM_SUBVERSION either using subversion or git SVN to 
+#  get the revision
+#
+MACRO(admPackager _prog)
+        IF(NOT AVIDEMUX_PACKAGER)
+                SET(AVIDEMUX_PACKAGER "none" CACHE STRING "")
+        ELSE(NOT AVIDEMUX_PACKAGER)
+                SET(AVIDEMUX_PACKAGER "${AVIDEMUX_PACKAGER}" CACHE STRING "")
+                MESSAGE(STATUS "Packager=${AVIDEMUX_PACKAGER}, valid choices= {deb,rpm,tgz,none}")
+        ENDIF(NOT AVIDEMUX_PACKAGER)
+        
+        if("${AVIDEMUX_PACKAGER}" STREQUAL "rpm")
+                include("./${_prog}Rpm.cmake")
+        elseif ("${AVIDEMUX_PACKAGER}" STREQUAL "deb")
+                include("./${_prog}Debian.cmake")
+        elseif("${AVIDEMUX_PACKAGER}" STREQUAL "tgz")
+                include("./${_prog}TarGz.cmake")
+        else("${AVIDEMUX_PACKAGER}" STREQUAL "rpm")
+                MESSAGE(STATUS "No packaging... (package=${_package})")
+        endif("${AVIDEMUX_PACKAGER}" STREQUAL "rpm")
+ENDMACRO(admPackager _prog )



From mean at mail.berlios.de  Fri Apr  9 17:23:03 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 9 Apr 2010 17:23:03 +0200
Subject: [Avidemux-svn-commit] r6105 - in
	branches/avidemux_2.6_branch_mean/avidemux: cli gtk qt4
Message-ID: <201004091523.o39FN3F1010302@sheep.berlios.de>

Author: mean
Date: 2010-04-09 17:23:03 +0200 (Fri, 09 Apr 2010)
New Revision: 6105

Added:
   branches/avidemux_2.6_branch_mean/avidemux/cli/cliPackageRpm.cmake
   branches/avidemux_2.6_branch_mean/avidemux/cli/cliPackageTarGz.cmake
   branches/avidemux_2.6_branch_mean/avidemux/gtk/gtkPackageTarGz.cmake
   branches/avidemux_2.6_branch_mean/avidemux/qt4/qt4PackageTarGz.cmake
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/gtk/gtkPackageDebian.cmake
   branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
Log:
[All] Packaging

Modified: branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt	2010-04-09 15:23:01 UTC (rev 6104)
+++ branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt	2010-04-09 15:23:03 UTC (rev 6105)
@@ -124,4 +124,8 @@
 ADM_LINK_THREAD(avidemux3_cli)
 ADM_INSTALL_BIN(avidemux3_cli)
 INSTALL(FILES ${CMAKE_BINARY_DIR}/config/cli/config.h DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/cli") 
-include(./cliPackageDebian.cmake)
+#
+# Packaging
+#
+include(admPackager)
+admPackager(cliPackage)

Added: branches/avidemux_2.6_branch_mean/avidemux/cli/cliPackageRpm.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/cli/cliPackageRpm.cmake	2010-04-09 15:23:01 UTC (rev 6104)
+++ branches/avidemux_2.6_branch_mean/avidemux/cli/cliPackageRpm.cmake	2010-04-09 15:23:03 UTC (rev 6105)
@@ -0,0 +1,26 @@
+##############################
+# RPM
+##############################
+SET(CPACK_SET_DESTDIR "ON")
+SET(CPACK_RPM_PACKAGE_NAME "avidemux3-cli")
+SET (CPACK_GENERATOR "RPM")
+# ARCH
+IF (X86_64_SUPPORTED)
+SET(CPACK_RPM_PACKAGE_ARCHITECTURE "amd64")
+ELSE (X86_64_SUPPORTED)
+SET(CPACK_RPM_PACKAGE_ARCHITECTURE "i386")
+ENDIF (X86_64_SUPPORTED)
+# Mandatory
+SET(CPACK_RPM_PACKAGE_VENDOR "mean")
+SET(CPACK_RPM_PACKAGE_DESCRIPTION "Simple video editor,main program cli version ")
+
+# Some more infos
+SET(CPACK_PACKAGE_VERSION_MAJOR "2")
+SET(CPACK_PACKAGE_VERSION_MINOR "6")
+SET(CPACK_PACKAGE_VERSION_PATCH "0")
+SET(CPACK_PACKAGE_VERSION_PATCH "0_${ADM_SUBVERSION}")
+#
+SET(CPACK_PACKAGE_NAME "avidemux3-cli")
+#
+
+include(CPack)

Added: branches/avidemux_2.6_branch_mean/avidemux/cli/cliPackageTarGz.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/cli/cliPackageTarGz.cmake	2010-04-09 15:23:01 UTC (rev 6104)
+++ branches/avidemux_2.6_branch_mean/avidemux/cli/cliPackageTarGz.cmake	2010-04-09 15:23:03 UTC (rev 6105)
@@ -0,0 +1,15 @@
+##############################
+# DEBIAN
+##############################
+SET(CPACK_SET_DESTDIR "ON")
+SET (CPACK_GENERATOR "TGZ")
+# Some more infos
+SET(CPACK_PACKAGE_VERSION_MAJOR "2")
+SET(CPACK_PACKAGE_VERSION_MINOR "6")
+SET(CPACK_PACKAGE_VERSION_PATCH "0")
+SET(CPACK_PACKAGE_VERSION_PATCH "0-${ADM_SUBVERSION}")
+#
+SET(CPACK_PACKAGE_NAME "avidemux3-cli")
+#
+
+include(CPack)

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/gtkPackageDebian.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/gtkPackageDebian.cmake	2010-04-09 15:23:01 UTC (rev 6104)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/gtkPackageDebian.cmake	2010-04-09 15:23:03 UTC (rev 6105)
@@ -1,32 +1,24 @@
 ##############################
-# DEBIAN
+# RPM
 ##############################
 SET(CPACK_SET_DESTDIR "ON")
-SET(CPACK_DEBIAN_PACKAGE_NAME "avidemux3-gtk")
-SET (CPACK_GENERATOR "DEB")
+SET(CPACK_RPM_PACKAGE_NAME "avidemux3-gtk")
+SET (CPACK_GENERATOR "RPM")
 # ARCH
 IF (X86_64_SUPPORTED)
-SET(CPACK_DEBIAN_PACKAGE_ARCHITECTURE "amd64")
+SET(CPACK_RPM_PACKAGE_ARCHITECTURE "amd64")
 ELSE (X86_64_SUPPORTED)
-SET(CPACK_DEBIAN_PACKAGE_ARCHITECTURE "i386")
+SET(CPACK_RPM_PACKAGE_ARCHITECTURE "i386")
 ENDIF (X86_64_SUPPORTED)
 # Mandatory
-SET(CPACK_DEBIAN_PACKAGE_MAINTAINER "mean")
-SET(CPACK_DEBIAN_PACKAGE_DESCRIPTION "Simple video editori,main program gtk version ")
+SET(CPACK_RPM_PACKAGE_VENDOR "mean")
+SET(CPACK_RPM_PACKAGE_DESCRIPTION "Simple video editor,main program gtk version ")
 
-# Build our deps list
-# Build deps SET(DEPS "debhelper (>> 4), libfreetype6-dev, libxml2-dev,  libxv-dev, dpatch , cmake, desktop-file-utils")
-SET(DEPS "libc6 (>=2.4),libglib2.0-0 (>=2.14.0),libstdc++6 (>=4.2.1),libx11-6,  libxml2 (>=2.6.27), libxv1, zlib1g (>=1:1.1.4), avidemux3-core (>=2.6.0)")
-# Add optional DEPS here
-SET(CPACK_DEBIAN_PACKAGE_DEPENDS "${DEPS}")
-#
-SET(CPACK_DEBIAN_PACKAGE_SECTION "extra")
-SET(CPACK_DEBIAN_PACKAGE_PRIORITY "optional")
 # Some more infos
 SET(CPACK_PACKAGE_VERSION_MAJOR "2")
 SET(CPACK_PACKAGE_VERSION_MINOR "6")
 SET(CPACK_PACKAGE_VERSION_PATCH "0")
-SET(CPACK_PACKAGE_VERSION_PATCH "0-${ADM_SUBVERSION}")
+SET(CPACK_PACKAGE_VERSION_PATCH "0_${ADM_SUBVERSION}")
 #
 SET(CPACK_PACKAGE_NAME "avidemux3-gtk")
 #

Added: branches/avidemux_2.6_branch_mean/avidemux/gtk/gtkPackageTarGz.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/gtkPackageTarGz.cmake	2010-04-09 15:23:01 UTC (rev 6104)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/gtkPackageTarGz.cmake	2010-04-09 15:23:03 UTC (rev 6105)
@@ -0,0 +1,15 @@
+##############################
+# DEBIAN
+##############################
+SET(CPACK_SET_DESTDIR "ON")
+SET (CPACK_GENERATOR "TGZ")
+# Some more infos
+SET(CPACK_PACKAGE_VERSION_MAJOR "2")
+SET(CPACK_PACKAGE_VERSION_MINOR "6")
+SET(CPACK_PACKAGE_VERSION_PATCH "0")
+SET(CPACK_PACKAGE_VERSION_PATCH "0-${ADM_SUBVERSION}")
+#
+SET(CPACK_PACKAGE_NAME "avidemux3-gtk")
+#
+
+include(CPack)

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2010-04-09 15:23:01 UTC (rev 6104)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2010-04-09 15:23:03 UTC (rev 6105)
@@ -164,8 +164,8 @@
 ADM_LINK_THREAD(avidemux3_qt4)
 ADM_INSTALL_BIN(avidemux3_qt4)
 INSTALL(FILES ${CMAKE_BINARY_DIR}/config/qt4/config.h DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/qt4") 
-IF(RPM)
-        INCLUDE(./qt4PackageRpm.cmake)
-ELSE(RPM)
-        INCLUDE(./qt4PackageDebian.cmake)
-ENDIF(RPM)
+#
+# Packaging
+#
+include(admPackager)
+admPackager(qt4Package)

Added: branches/avidemux_2.6_branch_mean/avidemux/qt4/qt4PackageTarGz.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/qt4PackageTarGz.cmake	2010-04-09 15:23:01 UTC (rev 6104)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/qt4PackageTarGz.cmake	2010-04-09 15:23:03 UTC (rev 6105)
@@ -0,0 +1,15 @@
+##############################
+# DEBIAN
+##############################
+SET(CPACK_SET_DESTDIR "ON")
+SET (CPACK_GENERATOR "TGZ")
+# Some more infos
+SET(CPACK_PACKAGE_VERSION_MAJOR "2")
+SET(CPACK_PACKAGE_VERSION_MINOR "6")
+SET(CPACK_PACKAGE_VERSION_PATCH "0")
+SET(CPACK_PACKAGE_VERSION_PATCH "0-${ADM_SUBVERSION}")
+#
+SET(CPACK_PACKAGE_NAME "avidemux3-qt4")
+#
+
+include(CPack)



From mean at mail.berlios.de  Fri Apr  9 17:23:05 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 9 Apr 2010 17:23:05 +0200
Subject: [Avidemux-svn-commit] r6106 - in branches/avidemux_2.6_branch_mean:
	. avidemux/gtk cmake
Message-ID: <201004091523.o39FN5rO010313@sheep.berlios.de>

Author: mean
Date: 2010-04-09 17:23:04 +0200 (Fri, 09 Apr 2010)
New Revision: 6106

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/bootStrap.bash
   branches/avidemux_2.6_branch_mean/cmake/admPackager.cmake
Log:
[build] More fixes (gtk/cli/qt4)

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt	2010-04-09 15:23:03 UTC (rev 6105)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt	2010-04-09 15:23:04 UTC (rev 6106)
@@ -130,4 +130,8 @@
 ADM_LINK_THREAD(avidemux3_gtk)
 ADM_INSTALL_BIN(avidemux3_gtk)
 INSTALL(FILES ${CMAKE_BINARY_DIR}/config/gtk/config.h DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/gtk") 
-include(./gtkPackageDebian.cmake)
+#
+# Packaging
+#
+include(admPackager)
+admPackager(gtkPackage)

Modified: branches/avidemux_2.6_branch_mean/bootStrap.bash
===================================================================
--- branches/avidemux_2.6_branch_mean/bootStrap.bash	2010-04-09 15:23:03 UTC (rev 6105)
+++ branches/avidemux_2.6_branch_mean/bootStrap.bash	2010-04-09 15:23:04 UTC (rev 6106)
@@ -2,7 +2,7 @@
 # Bootstrapper to semi-automatically build avidemux deb/rpm from source
 # (c) Mean 2009
 #
-packages_ext=deb
+packages_ext=""
 do_core=1
 do_cli=0
 do_gtk=1
@@ -65,7 +65,9 @@
         echo "Bootstrap avidemux 2.6:"
         echo "***********************"
         echo "  --help            : Print usage"
-        echo "  --rpm             : Build rpm packages rather than deb"
+        echo "  --rpm             : Build rpm packages"
+        echo "  --deb             : Build deb packages"
+        echo "  --tgz             : Build tgz packages"
         echo "  --debug           : Switch debugging on"
         echo "  --with-core       : Build core"
         echo "  --without-core    : Dont build core"
@@ -90,9 +92,17 @@
          --debug)
                 debug=1
                 ;;
+         --tgz)
+                packages_ext=tar.gz
+                PKG="$PKG -DAVIDEMUX_PACKAGER=tgz"
+                ;;
+         --deb)
+                packages_ext=deb
+                PKG="$PKG -DAVIDEMUX_PACKAGER=deb"
+                ;;
          --rpm)
                 packages_ext=rpm
-                PKG="$PKG -DRPM=1"
+                PKG="$PKG -DAVIDEMUX_PACKAGER=rpm"
                 ;;
          --without-qt4)
                 do_qt4=0
@@ -192,9 +202,14 @@
 
 echo "** Preparing debs **"
 cd $TOP
-rm -Rf debs
-mkdir debs
-find . -name "*.$packages_ext" | grep -vi cpa | xargs cp -t debs
-echo "** debs directory ready **"
-ls -l debs
+if [ "x$packages_ext" = "x" ]; then 
+        echo "No packaging"
+else
+        echo "Preparing packages"
+        rm -Rf debs
+        mkdir debs
+        find . -name "*.$packages_ext" | grep -vi cpa | xargs cp -t debs
+        echo "** debs directory ready **"
+        ls -l debs
+fi
 echo "** ALL DONE **"

Modified: branches/avidemux_2.6_branch_mean/cmake/admPackager.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admPackager.cmake	2010-04-09 15:23:03 UTC (rev 6105)
+++ branches/avidemux_2.6_branch_mean/cmake/admPackager.cmake	2010-04-09 15:23:04 UTC (rev 6106)
@@ -12,7 +12,7 @@
         
         if("${AVIDEMUX_PACKAGER}" STREQUAL "rpm")
                 include("./${_prog}Rpm.cmake")
-        elseif ("${AVIDEMUX_PACKAGER}" STREQUAL "deb")
+        elseif("${AVIDEMUX_PACKAGER}" STREQUAL "deb")
                 include("./${_prog}Debian.cmake")
         elseif("${AVIDEMUX_PACKAGER}" STREQUAL "tgz")
                 include("./${_prog}TarGz.cmake")



From mean at mail.berlios.de  Fri Apr  9 17:23:06 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 9 Apr 2010 17:23:06 +0200
Subject: [Avidemux-svn-commit] r6107 -
	branches/avidemux_2.6_branch_mean/avidemux/gtk
Message-ID: <201004091523.o39FN6FE010325@sheep.berlios.de>

Author: mean
Date: 2010-04-09 17:23:06 +0200 (Fri, 09 Apr 2010)
New Revision: 6107

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/gtk/gtkPackageDebian.cmake
Log:
[build] Deb is not rpm (gtk)

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/gtkPackageDebian.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/gtkPackageDebian.cmake	2010-04-09 15:23:04 UTC (rev 6106)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/gtkPackageDebian.cmake	2010-04-09 15:23:06 UTC (rev 6107)
@@ -1,24 +1,32 @@
 ##############################
-# RPM
+# DEBIAN
 ##############################
 SET(CPACK_SET_DESTDIR "ON")
-SET(CPACK_RPM_PACKAGE_NAME "avidemux3-gtk")
-SET (CPACK_GENERATOR "RPM")
+SET(CPACK_DEBIAN_PACKAGE_NAME "avidemux3-gtk")
+SET (CPACK_GENERATOR "DEB")
 # ARCH
 IF (X86_64_SUPPORTED)
-SET(CPACK_RPM_PACKAGE_ARCHITECTURE "amd64")
+SET(CPACK_DEBIAN_PACKAGE_ARCHITECTURE "amd64")
 ELSE (X86_64_SUPPORTED)
-SET(CPACK_RPM_PACKAGE_ARCHITECTURE "i386")
+SET(CPACK_DEBIAN_PACKAGE_ARCHITECTURE "i386")
 ENDIF (X86_64_SUPPORTED)
 # Mandatory
-SET(CPACK_RPM_PACKAGE_VENDOR "mean")
-SET(CPACK_RPM_PACKAGE_DESCRIPTION "Simple video editor,main program gtk version ")
+SET(CPACK_DEBIAN_PACKAGE_MAINTAINER "mean")
+SET(CPACK_DEBIAN_PACKAGE_DESCRIPTION "Simple video editor,main program gtk version ")
 
+# Build our deps list
+# Build deps SET(DEPS "debhelper (>> 4), libfreetype6-dev, libxml2-dev,  libxv-dev, dpatch , cmake, desktop-file-utils")
+SET(DEPS "libc6 (>=2.4),libglib2.0-0 (>=2.14.0),libstdc++6 (>=4.2.1),libx11-6,  libxml2 (>=2.6.27), libxv1, zlib1g (>=1:1.1.4), avidemux3-core (>=2.6.0)")
+# Add optional DEPS here
+SET(CPACK_DEBIAN_PACKAGE_DEPENDS "${DEPS}")
+#
+SET(CPACK_DEBIAN_PACKAGE_SECTION "extra")
+SET(CPACK_DEBIAN_PACKAGE_PRIORITY "optional")
 # Some more infos
 SET(CPACK_PACKAGE_VERSION_MAJOR "2")
 SET(CPACK_PACKAGE_VERSION_MINOR "6")
 SET(CPACK_PACKAGE_VERSION_PATCH "0")
-SET(CPACK_PACKAGE_VERSION_PATCH "0_${ADM_SUBVERSION}")
+SET(CPACK_PACKAGE_VERSION_PATCH "0-${ADM_SUBVERSION}")
 #
 SET(CPACK_PACKAGE_NAME "avidemux3-gtk")
 #



From mean at mail.berlios.de  Fri Apr  9 17:23:07 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 9 Apr 2010 17:23:07 +0200
Subject: [Avidemux-svn-commit] r6108 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins
Message-ID: <201004091523.o39FN73l010335@sheep.berlios.de>

Author: mean
Date: 2010-04-09 17:23:07 +0200 (Fri, 09 Apr 2010)
New Revision: 6108

Added:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/pluginsPackageTarGz.cmake
Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/CMakeLists.txt
Log:
[Build] Plugins

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/CMakeLists.txt	2010-04-09 15:23:06 UTC (rev 6107)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/CMakeLists.txt	2010-04-09 15:23:07 UTC (rev 6108)
@@ -158,8 +158,8 @@
 ########################################
 INCLUDE(admPluginConfigSummary)
 MESSAGE("")
-IF(RPM)
-        include(./pluginsPackageRpm.cmake)
-ELSE(RPM)
-        include(./pluginsPackageDebian.cmake)
-ENDIF(RPM)
+#
+# Packaging
+#
+include(admPackager)
+admPackager(pluginsPackage)

Added: branches/avidemux_2.6_branch_mean/avidemux_plugins/pluginsPackageTarGz.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/pluginsPackageTarGz.cmake	2010-04-09 15:23:06 UTC (rev 6107)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/pluginsPackageTarGz.cmake	2010-04-09 15:23:07 UTC (rev 6108)
@@ -0,0 +1,15 @@
+##############################
+# DEBIAN
+##############################
+SET(CPACK_SET_DESTDIR "ON")
+SET (CPACK_GENERATOR "TGZ")
+# Some more infos
+SET(CPACK_PACKAGE_VERSION_MAJOR "2")
+SET(CPACK_PACKAGE_VERSION_MINOR "6")
+SET(CPACK_PACKAGE_VERSION_PATCH "0")
+SET(CPACK_PACKAGE_VERSION_PATCH "0-${ADM_SUBVERSION}")
+#
+SET(CPACK_PACKAGE_NAME "avidemux3-plugins-${PLUGIN_UI}")
+#
+
+include(CPack)



From mean at mail.berlios.de  Fri Apr  9 18:20:11 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 9 Apr 2010 18:20:11 +0200
Subject: [Avidemux-svn-commit] r6109 - in
	branches/avidemux_2.6_branch_mean/avidemux/common: . ADM_render
Message-ID: <201004091620.o39GKBEm014263@sheep.berlios.de>

Author: mean
Date: 2010-04-09 18:20:10 +0200 (Fri, 09 Apr 2010)
New Revision: 6109

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.h
Log:
[render] Do not call admPreview::samePicture directly, use a hook (win32)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp	2010-04-09 15:23:07 UTC (rev 6108)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp	2010-04-09 16:20:10 UTC (rev 6109)
@@ -77,11 +77,15 @@
 
 void admPreview::setMainDimension(uint32_t w, uint32_t h)
 {
+  
   if(rdrImage) delete rdrImage;
   rdrImage=new ADMImage(w,h);
   rdrPhysicalW=w;
   rdrPhysicalH=h;
   renderDisplayResize(rdrPhysicalW,rdrPhysicalH,zoom);
+ // Install our hook, we will do it more than needed
+ // but it does not really harm
+  renderHookRefreshRequest(admPreview::samePicture);
 }
 
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2010-04-09 15:23:07 UTC (rev 6108)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2010-04-09 16:20:10 UTC (rev 6109)
@@ -25,7 +25,6 @@
 #include "GUI_renderInternal.h"
 #include "GUI_accelRender.h"
 #include "GUI_simpleRender.h"
-#include "ADM_preview.h"
 
 #ifdef USE_XV
 #include "GUI_xvRender.h"
@@ -51,8 +50,18 @@
 static uint8_t      _lock=0;
 
 static const UI_FUNCTIONS_T *HookFunc=NULL;
-//_______________________________________
+
+refreshSB refreshCallback=NULL;
 /**
+    \fn renderHookRefreshRequest
+    \brief Hook the callback when a renderer requests a full redraw
+*/
+bool renderHookRefreshRequest(refreshSB cb)
+{
+    refreshCallback=cb;
+    return true;
+}
+/**
  *      \fn ADM_renderLibInit
  *      \brief Initialize the renderlib with the needed external functions
  * 
@@ -201,7 +210,9 @@
 bool renderCompleteRedrawRequest(void)
 {
     ADM_info("RedrawRequest");
-    admPreview::samePicture();
+    if(refreshCallback)
+        refreshCallback();
+    return true;
 }
 /**
     \fn renderExpose

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.h	2010-04-09 15:23:07 UTC (rev 6108)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.h	2010-04-09 16:20:10 UTC (rev 6109)
@@ -20,6 +20,7 @@
 
 
 #include "ADM_image.h"
+typedef uint8_t (*refreshSB)(void);
 
 typedef struct
 {
@@ -56,6 +57,7 @@
 
 uint8_t renderLock(void);
 uint8_t renderUnlock(void);
+bool renderHookRefreshRequest(refreshSB cb);
 
 /* These functions are trampolined through render as they are UI dependant */
 



From gruntster at mail.berlios.de  Sat Apr 10 14:23:19 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 10 Apr 2010 14:23:19 +0200
Subject: [Avidemux-svn-commit] r6110 - in
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder:
	ADM_vidEnc_x264/qt4 ADM_vidEnc_xvid/qt4
Message-ID: <201004101223.o3ACNJqI024352@sheep.berlios.de>

Author: gruntster
Date: 2010-04-10 14:23:14 +0200 (Sat, 10 Apr 2010)
New Revision: 6110

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui
Log:
[x264/xvid] don't explicitly set the font family on Qt dialogs

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui	2010-04-09 16:20:10 UTC (rev 6109)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui	2010-04-10 12:23:14 UTC (rev 6110)
@@ -144,17 +144,6 @@
             </property>
             <item row="1" column="0" >
              <widget class="QLabel" name="targetRateControlLabel1" >
-              <property name="font" >
-               <font>
-                <family>MS Shell Dlg 2</family>
-                <pointsize>8</pointsize>
-                <weight>50</weight>
-                <italic>false</italic>
-                <bold>false</bold>
-                <underline>false</underline>
-                <strikeout>false</strikeout>
-               </font>
-              </property>
               <property name="text" >
                <string>Target Video Size:</string>
               </property>
@@ -170,17 +159,6 @@
               </property>
               <item>
                <widget class="QComboBox" name="encodingModeComboBox" >
-                <property name="font" >
-                 <font>
-                  <family>MS Shell Dlg 2</family>
-                  <pointsize>8</pointsize>
-                  <weight>50</weight>
-                  <italic>false</italic>
-                  <bold>false</bold>
-                  <underline>false</underline>
-                  <strikeout>false</strikeout>
-                 </font>
-                </property>
                 <property name="currentIndex" >
                  <number>3</number>
                 </property>
@@ -228,17 +206,6 @@
             </item>
             <item row="0" column="0" >
              <widget class="QLabel" name="label" >
-              <property name="font" >
-               <font>
-                <family>MS Shell Dlg 2</family>
-                <pointsize>8</pointsize>
-                <weight>50</weight>
-                <italic>false</italic>
-                <bold>false</bold>
-                <underline>false</underline>
-                <strikeout>false</strikeout>
-               </font>
-              </property>
               <property name="text" >
                <string>Encoding Mode:</string>
               </property>
@@ -254,17 +221,6 @@
               </property>
               <item>
                <widget class="QSpinBox" name="targetRateControlSpinBox" >
-                <property name="font" >
-                 <font>
-                  <family>MS Shell Dlg 2</family>
-                  <pointsize>8</pointsize>
-                  <weight>50</weight>
-                  <italic>false</italic>
-                  <bold>false</bold>
-                  <underline>false</underline>
-                  <strikeout>false</strikeout>
-                 </font>
-                </property>
                 <property name="prefix" >
                  <string/>
                 </property>
@@ -278,17 +234,6 @@
               </item>
               <item>
                <widget class="QLabel" name="targetRateControlLabel2" >
-                <property name="font" >
-                 <font>
-                  <family>MS Shell Dlg 2</family>
-                  <pointsize>8</pointsize>
-                  <weight>50</weight>
-                  <italic>false</italic>
-                  <bold>false</bold>
-                  <underline>false</underline>
-                  <strikeout>false</strikeout>
-                 </font>
-                </property>
                 <property name="text" >
                  <string>MB</string>
                 </property>
@@ -3030,17 +2975,6 @@
             </property>
             <item row="0" column="0" >
              <widget class="QLabel" name="label_9" >
-              <property name="font" >
-               <font>
-                <family>MS Shell Dlg 2</family>
-                <pointsize>8</pointsize>
-                <weight>50</weight>
-                <italic>false</italic>
-                <bold>false</bold>
-                <underline>false</underline>
-                <strikeout>false</strikeout>
-               </font>
-              </property>
               <property name="text" >
                <string>Maximum VBV Bitrate:</string>
               </property>
@@ -3048,17 +2982,6 @@
             </item>
             <item row="2" column="0" >
              <widget class="QLabel" name="label_14" >
-              <property name="font" >
-               <font>
-                <family>MS Shell Dlg 2</family>
-                <pointsize>8</pointsize>
-                <weight>50</weight>
-                <italic>false</italic>
-                <bold>false</bold>
-                <underline>false</underline>
-                <strikeout>false</strikeout>
-               </font>
-              </property>
               <property name="text" >
                <string>Initial VBV Buffer Occupancy:</string>
               </property>
@@ -3074,17 +2997,6 @@
               </property>
               <item>
                <widget class="QSpinBox" name="vbvBufferSizeSpinBox" >
-                <property name="font" >
-                 <font>
-                  <family>MS Shell Dlg 2</family>
-                  <pointsize>8</pointsize>
-                  <weight>50</weight>
-                  <italic>false</italic>
-                  <bold>false</bold>
-                  <underline>false</underline>
-                  <strikeout>false</strikeout>
-                 </font>
-                </property>
                 <property name="maximum" >
                  <number>99999</number>
                 </property>
@@ -3092,17 +3004,6 @@
               </item>
               <item>
                <widget class="QLabel" name="label_12" >
-                <property name="font" >
-                 <font>
-                  <family>MS Shell Dlg 2</family>
-                  <pointsize>8</pointsize>
-                  <weight>50</weight>
-                  <italic>false</italic>
-                  <bold>false</bold>
-                  <underline>false</underline>
-                  <strikeout>false</strikeout>
-                 </font>
-                </property>
                 <property name="text" >
                  <string>kbit</string>
                 </property>
@@ -3133,17 +3034,6 @@
               </property>
               <item>
                <widget class="QSpinBox" name="vbvBufferOccupancySpinBox" >
-                <property name="font" >
-                 <font>
-                  <family>MS Shell Dlg 2</family>
-                  <pointsize>8</pointsize>
-                  <weight>50</weight>
-                  <italic>false</italic>
-                  <bold>false</bold>
-                  <underline>false</underline>
-                  <strikeout>false</strikeout>
-                 </font>
-                </property>
                 <property name="maximum" >
                  <number>100</number>
                 </property>
@@ -3154,17 +3044,6 @@
               </item>
               <item>
                <widget class="QLabel" name="label_13" >
-                <property name="font" >
-                 <font>
-                  <family>MS Shell Dlg 2</family>
-                  <pointsize>8</pointsize>
-                  <weight>50</weight>
-                  <italic>false</italic>
-                  <bold>false</bold>
-                  <underline>false</underline>
-                  <strikeout>false</strikeout>
-                 </font>
-                </property>
                 <property name="text" >
                  <string>%</string>
                 </property>
@@ -3195,17 +3074,6 @@
               </property>
               <item>
                <widget class="QSpinBox" name="vbvMaxBitrateSpinBox" >
-                <property name="font" >
-                 <font>
-                  <family>MS Shell Dlg 2</family>
-                  <pointsize>8</pointsize>
-                  <weight>50</weight>
-                  <italic>false</italic>
-                  <bold>false</bold>
-                  <underline>false</underline>
-                  <strikeout>false</strikeout>
-                 </font>
-                </property>
                 <property name="maximum" >
                  <number>99999</number>
                 </property>
@@ -3213,17 +3081,6 @@
               </item>
               <item>
                <widget class="QLabel" name="label_10" >
-                <property name="font" >
-                 <font>
-                  <family>MS Shell Dlg 2</family>
-                  <pointsize>8</pointsize>
-                  <weight>50</weight>
-                  <italic>false</italic>
-                  <bold>false</bold>
-                  <underline>false</underline>
-                  <strikeout>false</strikeout>
-                 </font>
-                </property>
                 <property name="text" >
                  <string>kbit/s</string>
                 </property>
@@ -3246,17 +3103,6 @@
             </item>
             <item row="1" column="0" >
              <widget class="QLabel" name="label_11" >
-              <property name="font" >
-               <font>
-                <family>MS Shell Dlg 2</family>
-                <pointsize>8</pointsize>
-                <weight>50</weight>
-                <italic>false</italic>
-                <bold>false</bold>
-                <underline>false</underline>
-                <strikeout>false</strikeout>
-               </font>
-              </property>
               <property name="text" >
                <string>VBV Buffer Size:</string>
               </property>

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui	2010-04-09 16:20:10 UTC (rev 6109)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.ui	2010-04-10 12:23:14 UTC (rev 6110)
@@ -144,17 +144,6 @@
             </property>
             <item row="1" column="0" >
              <widget class="QLabel" name="targetRateControlLabel1" >
-              <property name="font" >
-               <font>
-                <family>MS Shell Dlg 2</family>
-                <pointsize>8</pointsize>
-                <weight>50</weight>
-                <italic>false</italic>
-                <bold>false</bold>
-                <underline>false</underline>
-                <strikeout>false</strikeout>
-               </font>
-              </property>
               <property name="text" >
                <string>Target Video Size:</string>
               </property>
@@ -170,17 +159,6 @@
               </property>
               <item>
                <widget class="QComboBox" name="encodingModeComboBox" >
-                <property name="font" >
-                 <font>
-                  <family>MS Shell Dlg 2</family>
-                  <pointsize>8</pointsize>
-                  <weight>50</weight>
-                  <italic>false</italic>
-                  <bold>false</bold>
-                  <underline>false</underline>
-                  <strikeout>false</strikeout>
-                 </font>
-                </property>
                 <property name="currentIndex" >
                  <number>2</number>
                 </property>
@@ -223,17 +201,6 @@
             </item>
             <item row="0" column="0" >
              <widget class="QLabel" name="label" >
-              <property name="font" >
-               <font>
-                <family>MS Shell Dlg 2</family>
-                <pointsize>8</pointsize>
-                <weight>50</weight>
-                <italic>false</italic>
-                <bold>false</bold>
-                <underline>false</underline>
-                <strikeout>false</strikeout>
-               </font>
-              </property>
               <property name="text" >
                <string>Encoding Mode:</string>
               </property>
@@ -249,17 +216,6 @@
               </property>
               <item>
                <widget class="QSpinBox" name="targetRateControlSpinBox" >
-                <property name="font" >
-                 <font>
-                  <family>MS Shell Dlg 2</family>
-                  <pointsize>8</pointsize>
-                  <weight>50</weight>
-                  <italic>false</italic>
-                  <bold>false</bold>
-                  <underline>false</underline>
-                  <strikeout>false</strikeout>
-                 </font>
-                </property>
                 <property name="prefix" >
                  <string/>
                 </property>
@@ -273,17 +229,6 @@
               </item>
               <item>
                <widget class="QLabel" name="targetRateControlLabel2" >
-                <property name="font" >
-                 <font>
-                  <family>MS Shell Dlg 2</family>
-                  <pointsize>8</pointsize>
-                  <weight>50</weight>
-                  <italic>false</italic>
-                  <bold>false</bold>
-                  <underline>false</underline>
-                  <strikeout>false</strikeout>
-                 </font>
-                </property>
                 <property name="text" >
                  <string>MB</string>
                 </property>



From gruntster at mail.berlios.de  Sat Apr 10 21:22:05 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 10 Apr 2010 21:22:05 +0200
Subject: [Avidemux-svn-commit] r6111 -
	branches/avidemux_2.5_branch_gruntster/scripts/video
Message-ID: <201004101922.o3AJM5rx020250@sheep.berlios.de>

Author: gruntster
Date: 2010-04-10 21:22:00 +0200 (Sat, 10 Apr 2010)
New Revision: 6111

Modified:
   branches/avidemux_2.5_branch_gruntster/scripts/video/autoWizard.js
   branches/avidemux_2.5_branch_gruntster/scripts/video/filter.js
   branches/avidemux_2.5_branch_gruntster/scripts/video/functions.js
Log:
[script] tweak system scripts so they're a bit more reusable

Modified: branches/avidemux_2.5_branch_gruntster/scripts/video/autoWizard.js
===================================================================
--- branches/avidemux_2.5_branch_gruntster/scripts/video/autoWizard.js	2010-04-10 12:23:14 UTC (rev 6110)
+++ branches/avidemux_2.5_branch_gruntster/scripts/video/autoWizard.js	2010-04-10 19:22:00 UTC (rev 6111)
@@ -7,8 +7,11 @@
     var dlgWizard = new DialogFactory(title);
     var i;
 
-    for (i = 0; i < resolutions.length; i++)
-        mnuResolution.addItem(resolutions[i][0].toString() + " x " + resolutions[i][1].toString());
+    if (resolutions != null)
+    {
+        for (i = 0; i < resolutions.length; i++)
+            mnuResolution.addItem(resolutions[i][0].toString() + " x " + resolutions[i][1].toString());
+    }
 
     for (i = 0; i < aspectRatios.length; i++)
     {
@@ -26,12 +29,14 @@
             mnuCodec.addItem(codecs[i]);
     }
 
-    dlgWizard.addControl(mnuResolution);
+    if (resolutions != null)
+        dlgWizard.addControl(mnuResolution);
+
     dlgWizard.addControl(mnuSourceRatio);
     dlgWizard.addControl(mnuDestinationRatio);
 
     if (dlgWizard.show())
-        return [[resolutions[mnuResolution.index][0], resolutions[mnuResolution.index][1]],
+        return [[resolutions == null ? -1 : resolutions[mnuResolution.index][0], resolutions == null ? -1 : resolutions[mnuResolution.index][1]],
             [aspectRatios[mnuSourceRatio.index][0], aspectRatios[mnuSourceRatio.index][1]],
             [aspectRatios[mnuDestinationRatio.index][0], aspectRatios[mnuDestinationRatio.index][1]], codecs == null ? -1 : mnuCodec.index];
     else

Modified: branches/avidemux_2.5_branch_gruntster/scripts/video/filter.js
===================================================================
--- branches/avidemux_2.5_branch_gruntster/scripts/video/filter.js	2010-04-10 12:23:14 UTC (rev 6110)
+++ branches/avidemux_2.5_branch_gruntster/scripts/video/filter.js	2010-04-10 19:22:00 UTC (rev 6111)
@@ -4,23 +4,11 @@
 {
     var app = new Avidemux();
     var filters = app.video.appliedFilters;
-    var width, height, fps1000;
+    var props = getVideoProperties(app.video);
+    var width = props[0];
+    var height = props[1];
+    var fps1000 = props[2];
 
-    if (filters.length > 0)
-    {
-        var lastFilter = app.video.appliedFilters[filters.length - 1];
-
-        width = lastFilter.width;
-        height = lastFilter.height;
-        fps1000 = lastFilter.fps1000;
-    }
-    else
-    {
-        width = app.video.width;
-        height = app.video.height;
-        fps1000 = app.video.fps1000;
-    }
-
     // Resizing
     var scaledWidth = rescaleVideoDimension(width, sourceRatio, destinationRatio, getColourEncodingSystem(fps1000));
     var rX = scaledWidth / targetX;

Modified: branches/avidemux_2.5_branch_gruntster/scripts/video/functions.js
===================================================================
--- branches/avidemux_2.5_branch_gruntster/scripts/video/functions.js	2010-04-10 12:23:14 UTC (rev 6110)
+++ branches/avidemux_2.5_branch_gruntster/scripts/video/functions.js	2010-04-10 19:22:00 UTC (rev 6111)
@@ -34,5 +34,28 @@
     else if (fps1000 > 29670 && fps1000 < 30270)
         encodingSystem = "NTSC";
 
-    return encodingSystem;
+    return encodingSystem;
+}
+
+function getVideoProperties(video)
+{
+    var filters = video.appliedFilters;
+    var width, height, fps1000;
+
+    if (filters.length > 0)
+    {
+        var lastFilter = video.appliedFilters[filters.length - 1];
+
+        width = lastFilter.width;
+        height = lastFilter.height;
+        fps1000 = lastFilter.fps1000;
+    }
+    else
+    {
+        width = video.width;
+        height = video.height;
+        fps1000 = video.fps1000;
+    }
+
+    return [width, height, fps1000];
 }
\ No newline at end of file



From gruntster at mail.berlios.de  Sat Apr 10 21:23:11 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 10 Apr 2010 21:23:11 +0200
Subject: [Avidemux-svn-commit] r6112 - in
	branches/avidemux_2.5_branch_gruntster/scripts/auto: . Optical Disc
Message-ID: <201004101923.o3AJNBaI020320@sheep.berlios.de>

Author: gruntster
Date: 2010-04-10 21:23:06 +0200 (Sat, 10 Apr 2010)
New Revision: 6112

Added:
   branches/avidemux_2.5_branch_gruntster/scripts/auto/Optical Disc/
   branches/avidemux_2.5_branch_gruntster/scripts/auto/Optical Disc/DVD.js
   branches/avidemux_2.5_branch_gruntster/scripts/auto/Optical Disc/Super Video CD.js
   branches/avidemux_2.5_branch_gruntster/scripts/auto/Optical Disc/Video CD.js
Log:
[auto] add optical disc auto wizards

Added: branches/avidemux_2.5_branch_gruntster/scripts/auto/Optical Disc/DVD.js
===================================================================
--- branches/avidemux_2.5_branch_gruntster/scripts/auto/Optical Disc/DVD.js	2010-04-10 19:22:00 UTC (rev 6111)
+++ branches/avidemux_2.5_branch_gruntster/scripts/auto/Optical Disc/DVD.js	2010-04-10 19:23:06 UTC (rev 6112)
@@ -0,0 +1,52 @@
+//AD
+include("video/autoWizard.js");
+include("video/functions.js");
+include("video/filter.js");
+
+var app = new Avidemux();
+
+if (app.video == null)
+    displayError("A video file must be open to use this Auto Wizard.");
+else
+{
+    var result = videoAutoWizard("DVD Auto Wizard");
+
+    if (result)
+    {
+        var props = getVideoProperties(app.video);
+        var fps1000 = props[2];
+        var targetX = 720;
+
+        if (getColourEncodingSystem(fps1000) == "NTSC")
+            targetY = 576;
+        else
+            targetY = 480;
+
+        var sourceRatio = result[1][0] + ":" + result[1][1];
+        var destinationRatio = result[2][0] + ":" + result[2][1];
+
+        resizeAndFillVideo(targetX, targetY, sourceRatio, destinationRatio);
+
+        app.video.codecPlugin("DBAECD8B-CF29-4846-AF57-B596427FE7D3", "avcodec", "2PASSBITRATE=6000", "<?xml version='1.0'?><Mpeg2Config><Mpeg2Options><minBitrate>0</minBitrate><maxBitrate>8000</maxBitrate><xvidRateControl>true</xvidRateControl><bufferSize>224</bufferSize><widescreen>false</widescreen><interlaced>none</interlaced><gopSize>12</gopSize></Mpeg2Options></Mpeg2Config>");
+
+        if (app.audio.targetTrackInfo.length > 0)
+        {
+            if ((app.audio.targetTrackInfo[0].codec == "MP2" || app.audio.targetTrackInfo[0].codec == "AC3" || app.audio.targetTrackInfo[0].codec == "LPCM") && app.audio.targetTrackInfo[0].frequency == 48000)
+                app.video.codec("Copy", "CQ=4", "0 ");
+            else
+            {
+                app.audio.codec("TwoLame", 160, 8, "a0 00 00 00 01 00 00 00 ");
+
+                if (app.audio.targetTrackInfo[0].frequency != 48000)
+                    app.audio.resample = 48000;
+
+                if (app.audio.targetTrackInfo[0].channelCount == 2)
+                    app.audio.mixer = "NONE";
+                else
+                    app.audio.mixer = "DOLBY_PROLOGIC2";
+            }
+        }
+
+        app.setContainer("PS", "00 00 00 00 00 00 00 00 ");
+    }
+}
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/scripts/auto/Optical Disc/Super Video CD.js
===================================================================
--- branches/avidemux_2.5_branch_gruntster/scripts/auto/Optical Disc/Super Video CD.js	2010-04-10 19:22:00 UTC (rev 6111)
+++ branches/avidemux_2.5_branch_gruntster/scripts/auto/Optical Disc/Super Video CD.js	2010-04-10 19:23:06 UTC (rev 6112)
@@ -0,0 +1,52 @@
+//AD
+include("video/autoWizard.js");
+include("video/functions.js");
+include("video/filter.js");
+
+var app = new Avidemux();
+
+if (app.video == null)
+    displayError("A video file must be open to use this Auto Wizard.");
+else
+{
+    var result = videoAutoWizard("Super Video CD Auto Wizard");
+
+    if (result)
+    {
+        var props = getVideoProperties(app.video);
+        var fps1000 = props[2];
+        var targetX = 480;
+
+        if (getColourEncodingSystem(fps1000) == "NTSC")
+            targetY = 576;
+        else
+            targetY = 480;
+
+        var sourceRatio = result[1][0] + ":" + result[1][1];
+        var destinationRatio = result[2][0] + ":" + result[2][1];
+
+        resizeAndFillVideo(targetX, targetY, sourceRatio, destinationRatio);
+
+        app.video.codecPlugin("DBAECD8B-CF29-4846-AF57-B596427FE7D3", "avcodec", "2PASSBITRATE=2000", "<?xml version='1.0'?><Mpeg2Config><Mpeg2Options><minBitrate>0</minBitrate><maxBitrate>2400</maxBitrate><xvidRateControl>true</xvidRateControl><bufferSize>112</bufferSize><widescreen>false</widescreen><interlaced>none</interlaced><gopSize>12</gopSize></Mpeg2Options></Mpeg2Config>");
+
+        if (app.audio.targetTrackInfo.length > 0)
+        {
+            if (app.audio.targetTrackInfo[0].codec == "MP2" && app.audio.targetTrackInfo[0].frequency == 44100 && app.audio.targetTrackInfo[0].channelCount == 2)
+                app.video.codec("Copy", "CQ=4", "0 ");
+            else
+            {
+                app.audio.codec("TwoLame", 160, 8, "a0 00 00 00 01 00 00 00 ");
+
+                if (app.audio.targetTrackInfo[0].frequency != 44100)
+                    app.audio.resample = 44100;
+
+                if (app.audio.targetTrackInfo[0].channelCount == 2)
+                    app.audio.mixer = "NONE";
+                else
+                    app.audio.mixer = "DOLBY_PROLOGIC2";
+            }
+        }
+
+        app.setContainer("PS", "02 00 00 00 00 00 00 00 ");
+    }
+}
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/scripts/auto/Optical Disc/Video CD.js
===================================================================
--- branches/avidemux_2.5_branch_gruntster/scripts/auto/Optical Disc/Video CD.js	2010-04-10 19:22:00 UTC (rev 6111)
+++ branches/avidemux_2.5_branch_gruntster/scripts/auto/Optical Disc/Video CD.js	2010-04-10 19:23:06 UTC (rev 6112)
@@ -0,0 +1,53 @@
+//AD
+include("video/autoWizard.js");
+include("video/functions.js");
+include("video/filter.js");
+
+var app = new Avidemux();
+
+if (app.video == null)
+    displayError("A video file must be open to use this Auto Wizard.");
+else
+{
+    var result = videoAutoWizard("Video CD Auto Wizard");
+
+    if (result)
+    {
+        var props = getVideoProperties(app.video);
+        var fps1000 = props[2];
+        var targetX = 352;
+        var targetY;
+
+        if (getColourEncodingSystem(fps1000) == "NTSC")
+            targetY = 288;
+        else
+            targetY = 240;
+
+        var sourceRatio = result[1][0] + ":" + result[1][1];
+        var destinationRatio = result[2][0] + ":" + result[2][1];
+
+        resizeAndFillVideo(targetX, targetY, sourceRatio, destinationRatio);
+
+        app.video.codecPlugin("056FE919-C1D3-4450-A812-A767EAB07786", "mpeg2enc", "CBR=1000", "<?xml version='1.0'?><Mpeg1Config><presetConfiguration><name>Video CD</name><type>system</type></presetConfiguration><Mpeg1Options></Mpeg1Options></Mpeg1Config>");
+
+        if (app.audio.targetTrackInfo.length > 0)
+        {
+            if (app.audio.targetTrackInfo[0].codec == "MP2" && app.audio.targetTrackInfo[0].frequency == 44100 && app.audio.targetTrackInfo[0].channelCount == 2)
+                app.video.codec("Copy", "CQ=4", "0 ");
+            else
+            {
+                app.audio.codec("TwoLame", 224, 8, "e0 00 00 00 01 00 00 00 ");
+
+                if (app.audio.targetTrackInfo[0].frequency != 44100)
+                    app.audio.resample = 44100;
+
+                if (app.audio.targetTrackInfo[0].channelCount == 2)
+                    app.audio.mixer = "NONE";
+                else
+                    app.audio.mixer = "DOLBY_PROLOGIC2";
+            }
+        }
+
+        app.setContainer("PS", "01 00 00 00 00 00 00 00 ");
+    }
+}
\ No newline at end of file



From gruntster at mail.berlios.de  Sat Apr 10 21:39:25 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 10 Apr 2010 21:39:25 +0200
Subject: [Avidemux-svn-commit] r6113 - in
	branches/avidemux_2.5_branch_gruntster/scripts/auto: . Apple
Message-ID: <201004101939.o3AJdPhh021293@sheep.berlios.de>

Author: gruntster
Date: 2010-04-10 21:39:20 +0200 (Sat, 10 Apr 2010)
New Revision: 6113

Modified:
   branches/avidemux_2.5_branch_gruntster/scripts/auto/Apple/Apple iPhone.js
   branches/avidemux_2.5_branch_gruntster/scripts/auto/Apple/Apple iPod 5.5G.js
   branches/avidemux_2.5_branch_gruntster/scripts/auto/Apple/Apple iPod.js
   branches/avidemux_2.5_branch_gruntster/scripts/auto/Microsoft Zune.js
   branches/avidemux_2.5_branch_gruntster/scripts/auto/Sony PlayStation Portable.js
Log:
[auto] set audio to copy if existing track is appropriate when using auto wizards

Modified: branches/avidemux_2.5_branch_gruntster/scripts/auto/Apple/Apple iPhone.js
===================================================================
--- branches/avidemux_2.5_branch_gruntster/scripts/auto/Apple/Apple iPhone.js	2010-04-10 19:23:06 UTC (rev 6112)
+++ branches/avidemux_2.5_branch_gruntster/scripts/auto/Apple/Apple iPhone.js	2010-04-10 19:39:20 UTC (rev 6113)
@@ -23,7 +23,9 @@
 
         if (app.audio.targetTrackInfo.length > 0)
         {
-            if (app.audio.targetTrackInfo[0].codec != "AAC" || app.audio.targetTrackInfo[0].channelCount != 2)
+            if (app.audio.targetTrackInfo[0].codec == "AAC" && app.audio.targetTrackInfo[0].channelCount == 2)
+                app.video.codec("Copy", "CQ=4", "0 ");
+            else
             {
                 app.audio.codec("Faac", 128, 4, "80 00 00 00 ");
 

Modified: branches/avidemux_2.5_branch_gruntster/scripts/auto/Apple/Apple iPod 5.5G.js
===================================================================
--- branches/avidemux_2.5_branch_gruntster/scripts/auto/Apple/Apple iPod 5.5G.js	2010-04-10 19:23:06 UTC (rev 6112)
+++ branches/avidemux_2.5_branch_gruntster/scripts/auto/Apple/Apple iPod 5.5G.js	2010-04-10 19:39:20 UTC (rev 6113)
@@ -23,7 +23,9 @@
 
         if (app.audio.targetTrackInfo.length > 0)
         {
-            if (app.audio.targetTrackInfo[0].codec != "AAC" || app.audio.targetTrackInfo[0].channelCount != 2)
+            if (app.audio.targetTrackInfo[0].codec == "AAC" && app.audio.targetTrackInfo[0].channelCount == 2)
+                app.video.codec("Copy", "CQ=4", "0 ");
+            else
             {
                 app.audio.codec("Faac", 128, 4, "80 00 00 00 ");
 

Modified: branches/avidemux_2.5_branch_gruntster/scripts/auto/Apple/Apple iPod.js
===================================================================
--- branches/avidemux_2.5_branch_gruntster/scripts/auto/Apple/Apple iPod.js	2010-04-10 19:23:06 UTC (rev 6112)
+++ branches/avidemux_2.5_branch_gruntster/scripts/auto/Apple/Apple iPod.js	2010-04-10 19:39:20 UTC (rev 6113)
@@ -23,7 +23,9 @@
 
         if (app.audio.targetTrackInfo.length > 0)
         {
-            if (app.audio.targetTrackInfo[0].codec != "AAC" || app.audio.targetTrackInfo[0].channelCount != 2)
+            if (app.audio.targetTrackInfo[0].codec == "AAC" && app.audio.targetTrackInfo[0].channelCount == 2)
+                app.video.codec("Copy", "CQ=4", "0 ");
+            else
             {
                 app.audio.codec("Faac", 128, 4, "80 00 00 00 ");
 

Modified: branches/avidemux_2.5_branch_gruntster/scripts/auto/Microsoft Zune.js
===================================================================
--- branches/avidemux_2.5_branch_gruntster/scripts/auto/Microsoft Zune.js	2010-04-10 19:23:06 UTC (rev 6112)
+++ branches/avidemux_2.5_branch_gruntster/scripts/auto/Microsoft Zune.js	2010-04-10 19:39:20 UTC (rev 6113)
@@ -23,7 +23,9 @@
 
         if (app.audio.targetTrackInfo.length > 0)
         {
-            if (app.audio.targetTrackInfo[0].codec != "AAC" || app.audio.targetTrackInfo[0].channelCount != 2)
+            if (app.audio.targetTrackInfo[0].codec == "AAC" && app.audio.targetTrackInfo[0].channelCount == 2)
+                app.video.codec("Copy", "CQ=4", "0 ");
+            else
             {
                 app.audio.codec("Faac", 128, 4, "80 00 00 00 ");
 

Modified: branches/avidemux_2.5_branch_gruntster/scripts/auto/Sony PlayStation Portable.js
===================================================================
--- branches/avidemux_2.5_branch_gruntster/scripts/auto/Sony PlayStation Portable.js	2010-04-10 19:23:06 UTC (rev 6112)
+++ branches/avidemux_2.5_branch_gruntster/scripts/auto/Sony PlayStation Portable.js	2010-04-10 19:39:20 UTC (rev 6113)
@@ -23,7 +23,9 @@
 
         if (app.audio.targetTrackInfo.length > 0)
         {
-            if (app.audio.targetTrackInfo[0].codec != "AAC" || app.audio.targetTrackInfo[0].channelCount != 2)
+            if (app.audio.targetTrackInfo[0].codec == "AAC" && app.audio.targetTrackInfo[0].channelCount == 2)
+                app.video.codec("Copy", "CQ=4", "0 ");
+            else
             {
                 app.audio.codec("Faac", 128, 4, "80 00 00 00 ");
 



From mean at mail.berlios.de  Sun Apr 11 09:55:24 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 11 Apr 2010 09:55:24 +0200
Subject: [Avidemux-svn-commit] r6114 -
	branches/avidemux_2.6_branch_mean/avidemux/common
Message-ID: <201004110755.o3B7tOfu028235@sheep.berlios.de>

Author: mean
Date: 2010-04-11 09:55:23 +0200 (Sun, 11 Apr 2010)
New Revision: 6114

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp
Log:
[preview] Use updateImage rather than samePicture (faster)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp	2010-04-10 19:39:20 UTC (rev 6113)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_preview.cpp	2010-04-11 07:55:23 UTC (rev 6114)
@@ -85,7 +85,7 @@
   renderDisplayResize(rdrPhysicalW,rdrPhysicalH,zoom);
  // Install our hook, we will do it more than needed
  // but it does not really harm
-  renderHookRefreshRequest(admPreview::samePicture);
+  renderHookRefreshRequest(admPreview::updateImage);
 }
 
 
@@ -223,9 +223,9 @@
 */
 bool admPreview::updateImage(void)
 {
-            UI_setFrameType(  rdrImage->flags,rdrImage->_Qp);
-            if(!defered_display) 
-                renderUpdateImage(rdrImage);                  
-            return true;
+    UI_setFrameType(  rdrImage->flags,rdrImage->_Qp);
+    if(!defered_display) 
+        renderUpdateImage(rdrImage);                  
+    return true;
 }
 // EOF



From mean at mail.berlios.de  Sun Apr 11 09:55:26 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 11 Apr 2010 09:55:26 +0200
Subject: [Avidemux-svn-commit] r6115 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render
Message-ID: <201004110755.o3B7tQiF028245@sheep.berlios.de>

Author: mean
Date: 2010-04-11 09:55:25 +0200 (Sun, 11 Apr 2010)
New Revision: 6115

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.cpp
Log:
[render] Cosmetic

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2010-04-11 07:55:23 UTC (rev 6114)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.cpp	2010-04-11 07:55:25 UTC (rev 6115)
@@ -175,6 +175,7 @@
     
             }
         MUI_updateDrawWindowSize(draw,(w*mul)/4,(h*mul)/4);
+        renderCompleteRedrawRequest();
         UI_purge();
         return 1;
 }
@@ -209,7 +210,7 @@
 */
 bool renderCompleteRedrawRequest(void)
 {
-    ADM_info("RedrawRequest");
+    ADM_info("RedrawRequest\n");
     if(refreshCallback)
         refreshCallback();
     return true;
@@ -373,7 +374,7 @@
 {
     if(!renderer) return true;
     if(renderer->usingUIRedraw()==true) return true;
-    //renderer->refresh();
+    renderer->refresh();
     return false;
 
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.h	2010-04-11 07:55:23 UTC (rev 6114)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_render.h	2010-04-11 07:55:25 UTC (rev 6115)
@@ -20,7 +20,7 @@
 
 
 #include "ADM_image.h"
-typedef uint8_t (*refreshSB)(void);
+typedef bool (*refreshSB)(void);
 
 typedef struct
 {

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.cpp	2010-04-11 07:55:23 UTC (rev 6114)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_render/GUI_xvRender.cpp	2010-04-11 07:55:25 UTC (rev 6115)
@@ -1,9 +1,7 @@
 /***************************************************************************
-                          gui_xv.cpp  -  description
-                             -------------------
+    \file GUI_xvRender.cpp
+    \author mean fixounet at free.fr, This file is strongly derivated from xine/mplayer/mpeg2dec
 
-	This part is strongly derivated from xine/mplayer/mpeg2dec
-
     begin                : Tue Jan 1 2002
     copyright            : (C) 2002 by mean
     email                : fixounet at free.fr
@@ -35,26 +33,28 @@
 #include <X11/extensions/XShm.h>
 
 #include "ADM_default.h"
-
-
 #include "GUI_render.h"
 
 #include "GUI_accelRender.h"
 #include "GUI_xvRender.h"
-#include "ADM_assert.h"
 
 static uint8_t 	GUI_XvList(Display * dis, uint32_t port, uint32_t * fmt);
 static uint8_t 	GUI_XvInit(GUI_WindowInfo * window, uint32_t w, uint32_t h);
 static void 	GUI_XvEnd( void );
-static uint8_t GUI_XvDisplay(uint8_t * src, uint32_t w, uint32_t h,uint32_t destW,uint32_t destH);
-static uint8_t 	GUI_XvSync(void);
-static uint8_t GUI_XvRedraw( void );
-static uint8_t getAtom(const char *string);
+static uint8_t  GUI_XvDisplay(uint8_t * src, uint32_t w, uint32_t h,uint32_t destW,uint32_t destH);
+static uint8_t  GUI_XvRedraw( void );
+static uint8_t  getAtom(const char *string);
 //________________Wrapper around Xv_______________
+/**
+    \fn XvRender
+*/
 XvRender::XvRender( void )
 {
 
 }
+/**
+    \fn init
+*/
 bool XvRender::init( GUI_WindowInfo * window, uint32_t w, uint32_t h,renderZoom zoom)
 {
 	ADM_info("[Xvideo]Xv start\n");
@@ -62,16 +62,20 @@
     baseInit(w,h,zoom);
 	return  GUI_XvInit( window,  w,  h);
 }
+/**
+    \fn stop
+*/
 bool XvRender::stop(void)
 {
 	 GUI_XvEnd( );
 	 printf("[Xvideo]Xv end\n");
 	 return 1;
 }
-
+/**
+    \fn displayImage
+*/
 bool XvRender::displayImage(ADMImage *pic)
 {
-
 	return GUI_XvDisplay(pic->data, imageWidth, imageHeight,displayWidth,displayHeight);
 }
 
@@ -106,18 +110,18 @@
 static Window xv_win;
 static XShmSegmentInfo Shminfo;
 static uint8_t GUI_XvExpose( void );
-//
-//	Free all ressources allocated by xv
-//
 
-
+/**
+    \fn GUI_XvEnd
+    \brief Free all ressources allocated by xv
+*/
 void GUI_XvEnd( void )
 {
 	ADM_assert(xv_port);
  	ADM_assert(xv_display);
 
 
-  	printf("[Xvideo] Releasing Xv Port\n");
+  	ADM_info("[Xvideo] Releasing Xv Port\n");
   	XLockDisplay (xv_display);
 	if(XvUngrabPort(xv_display,xv_port,0)!=Success)
  				printf("[Xvideo] Trouble releasing port...\n");
@@ -129,8 +133,9 @@
      xv_port=0;
 
 }
-
-//------------------------------------
+/**
+    \fn GUI_XvList
+*/
 uint8_t GUI_XvDisplay(uint8_t * src, uint32_t w, uint32_t h,uint32_t destW,uint32_t destH)
 {
     
@@ -146,31 +151,24 @@
         //printf("%u x %u => %u x %u\n",w,h,destW,destH);
         // And display it !
 #if 1
-	  XvShmPutImage(xv_display, xv_port, xv_win, xv_gc, xvimage, 0, 0, w, h,	// src
+        XvShmPutImage(xv_display, xv_port, xv_win, xv_gc, xvimage, 0, 0, w, h,	// src
 			0, 0, destW, destH,	// dst
 			False);
 #else
-	 XvPutImage(xv_display, xv_port, xv_win, xv_gc, xvimage, 0, 0, w, h,	// src
+        XvPutImage(xv_display, xv_port, xv_win, xv_gc, xvimage, 0, 0, w, h,	// src
 			0, 0, w, h	// dst
 			);
-
 #endif
-	  //XSetForeground (xv_display, xv_gc, 0);
-
-	  XSync(xv_display, False);
-	  XUnlockDisplay (xv_display);
+          XUnlockDisplay (xv_display);
+          XSync(xv_display, False);
+          
       }
     return 1;
 }
-uint8_t GUI_XvSync(void)
-{
-	if(xv_display)
-	  	XSync(xv_display, False);
-	return 1;
-}
-//------------------------------------
-//
-//------------------------------------
+/**
+    \fn GUI_XvList
+*/
+
 uint8_t GUI_XvInit(GUI_WindowInfo * window, uint32_t w, uint32_t h)
 {
 
@@ -337,9 +335,9 @@
     return 0;
 }
 
-// _________________________________________________
-//
-// _________________________________________________
+/**
+    \fn GUI_XvList
+*/
 uint8_t GUI_XvList(Display * dis, uint32_t port, uint32_t * fmt)
 {
     XvImageFormatValues *formatValues;
@@ -369,6 +367,10 @@
 	    XFree(formatValues);
     return f;
 }
+/**
+    \fn getAtom
+*/
+
 uint8_t getAtom(const char *string)
 {
   XvAttribute * attributes;
@@ -392,6 +394,10 @@
   return xv_atom;
 
 }
+/**
+    \fn GUI_XvBuildAtom
+*/
+
 void GUI_XvBuildAtom(Display * dis, Atom * atom, char *string)
 {
     UNUSED_ARG(dis);
@@ -399,7 +405,9 @@
     UNUSED_ARG(string);
 }
 
-
+/**
+    \fn GUI_XvRedraw
+*/
 uint8_t GUI_XvRedraw( void )
 {
 	printf("Xv need redraw !\n");



From mean at mail.berlios.de  Sun Apr 11 09:55:27 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 11 Apr 2010 09:55:27 +0200
Subject: [Avidemux-svn-commit] r6116 -
	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui
Message-ID: <201004110755.o3B7tRUV028260@sheep.berlios.de>

Author: mean
Date: 2010-04-11 09:55:27 +0200 (Sun, 11 Apr 2010)
New Revision: 6116

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui
Log:
[Qt4] UI, use Jakub s gui2.ui

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2010-04-11 07:55:25 UTC (rev 6115)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2010-04-11 07:55:27 UTC (rev 6116)
@@ -574,8 +574,8 @@
 
 	UI_QT4VideoWidget(mw->ui.frame_video);  // Add the widget that will handle video display
 	UI_updateRecentMenu();
-        // Init vumeter
-        UI_InitVUMeter(mw->ui.frameVU);
+    // Init vumeter
+    UI_InitVUMeter(mw->ui.frameVU);
 	return 0;
 }
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui	2010-04-11 07:55:25 UTC (rev 6115)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui	2010-04-11 07:55:27 UTC (rev 6116)
@@ -12,7 +12,7 @@
    </rect>
   </property>
   <property name="sizePolicy">
-   <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+   <sizepolicy hsizetype="Minimum" vsizetype="Minimum">
     <horstretch>0</horstretch>
     <verstretch>0</verstretch>
    </sizepolicy>
@@ -37,6 +37,12 @@
    </size>
   </property>
   <widget class="QWidget" name="centralwidget">
+   <property name="sizePolicy">
+    <sizepolicy hsizetype="Minimum" vsizetype="Minimum">
+     <horstretch>0</horstretch>
+     <verstretch>0</verstretch>
+    </sizepolicy>
+   </property>
    <property name="minimumSize">
     <size>
      <width>200</width>
@@ -48,31 +54,34 @@
      <layout class="QHBoxLayout" name="horizontalLayout_2">
       <item>
        <layout class="QVBoxLayout" name="verticalLayout_3">
+        <property name="spacing">
+         <number>0</number>
+        </property>
+        <property name="sizeConstraint">
+         <enum>QLayout::SetDefaultConstraint</enum>
+        </property>
         <item>
          <widget class="QLabel" name="label_7">
-          <property name="sizePolicy">
-           <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
+          <property name="text">
+           <string>&lt;b&gt;Video Decoder&lt;b&gt;</string>
           </property>
-          <property name="maximumSize">
+         </widget>
+        </item>
+        <item>
+         <spacer name="verticalSpacer_7">
+          <property name="orientation">
+           <enum>Qt::Vertical</enum>
+          </property>
+          <property name="sizeType">
+           <enum>QSizePolicy::Fixed</enum>
+          </property>
+          <property name="sizeHint" stdset="0">
            <size>
-            <width>180</width>
-            <height>16777215</height>
+            <width>20</width>
+            <height>6</height>
            </size>
           </property>
-          <property name="text">
-           <string>&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0//EN&quot; &quot;http://www.w3.org/TR/REC-html40/strict.dtd&quot;&gt;
-&lt;html&gt;&lt;head&gt;&lt;meta name=&quot;qrichtext&quot; content=&quot;1&quot; /&gt;&lt;style type=&quot;text/css&quot;&gt;
-p, li { white-space: pre-wrap; }
-&lt;/style&gt;&lt;/head&gt;&lt;body style=&quot; font-family:'DejaVu Sans'; font-size:8pt; font-weight:400; font-style:normal;&quot;&gt;
-&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;&lt;span style=&quot; font-weight:600;&quot;&gt;Video Decoder&lt;/span&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</string>
-          </property>
-          <property name="textFormat">
-           <enum>Qt::AutoText</enum>
-          </property>
-         </widget>
+         </spacer>
         </item>
         <item>
          <layout class="QHBoxLayout" name="videoLayout_2">
@@ -92,14 +101,14 @@
             </property>
             <property name="sizeHint" stdset="0">
              <size>
-              <width>13</width>
-              <height>44</height>
+              <width>12</width>
+              <height>0</height>
              </size>
             </property>
            </spacer>
           </item>
           <item>
-           <layout class="QVBoxLayout" name="_2">
+           <layout class="QVBoxLayout" name="_6">
             <property name="spacing">
              <number>6</number>
             </property>
@@ -134,6 +143,22 @@
          </layout>
         </item>
         <item>
+         <spacer name="verticalSpacer_11">
+          <property name="orientation">
+           <enum>Qt::Vertical</enum>
+          </property>
+          <property name="sizeType">
+           <enum>QSizePolicy::Fixed</enum>
+          </property>
+          <property name="sizeHint" stdset="0">
+           <size>
+            <width>20</width>
+            <height>12</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+        <item>
          <widget class="QLabel" name="label_3">
           <property name="sizePolicy">
            <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
@@ -148,7 +173,7 @@
            </size>
           </property>
           <property name="text">
-           <string>&lt;b&gt;Video&lt;/b&gt;</string>
+           <string>&lt;b&gt;Video Output&lt;/b&gt;</string>
           </property>
           <property name="textFormat">
            <enum>Qt::AutoText</enum>
@@ -156,6 +181,22 @@
          </widget>
         </item>
         <item>
+         <spacer name="verticalSpacer_8">
+          <property name="orientation">
+           <enum>Qt::Vertical</enum>
+          </property>
+          <property name="sizeType">
+           <enum>QSizePolicy::Fixed</enum>
+          </property>
+          <property name="sizeHint" stdset="0">
+           <size>
+            <width>20</width>
+            <height>6</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+        <item>
          <layout class="QHBoxLayout" name="videoLayout">
           <property name="spacing">
            <number>0</number>
@@ -173,24 +214,27 @@
             </property>
             <property name="sizeHint" stdset="0">
              <size>
-              <width>13</width>
-              <height>83</height>
+              <width>12</width>
+              <height>0</height>
              </size>
             </property>
            </spacer>
           </item>
           <item>
-           <layout class="QVBoxLayout">
+           <layout class="QVBoxLayout" name="_7" stretch="0,0,0">
             <property name="spacing">
              <number>6</number>
             </property>
+            <property name="sizeConstraint">
+             <enum>QLayout::SetDefaultConstraint</enum>
+            </property>
             <property name="margin">
              <number>0</number>
             </property>
             <item>
              <widget class="QComboBox" name="comboBoxVideo">
               <property name="sizePolicy">
-               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+               <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
                 <horstretch>0</horstretch>
                 <verstretch>0</verstretch>
                </sizepolicy>
@@ -239,6 +283,22 @@
          </layout>
         </item>
         <item>
+         <spacer name="verticalSpacer_12">
+          <property name="orientation">
+           <enum>Qt::Vertical</enum>
+          </property>
+          <property name="sizeType">
+           <enum>QSizePolicy::Fixed</enum>
+          </property>
+          <property name="sizeHint" stdset="0">
+           <size>
+            <width>20</width>
+            <height>12</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+        <item>
          <widget class="QLabel" name="label_5">
           <property name="sizePolicy">
            <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
@@ -253,7 +313,7 @@
            </size>
           </property>
           <property name="text">
-           <string>&lt;b&gt;Audio&lt;/b&gt;</string>
+           <string>&lt;b&gt;Audio Output&lt;/b&gt;</string>
           </property>
           <property name="textFormat">
            <enum>Qt::AutoText</enum>
@@ -261,6 +321,22 @@
          </widget>
         </item>
         <item>
+         <spacer name="verticalSpacer_9">
+          <property name="orientation">
+           <enum>Qt::Vertical</enum>
+          </property>
+          <property name="sizeType">
+           <enum>QSizePolicy::Fixed</enum>
+          </property>
+          <property name="sizeHint" stdset="0">
+           <size>
+            <width>20</width>
+            <height>6</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+        <item>
          <layout class="QHBoxLayout" name="AudioLayout">
           <property name="spacing">
            <number>0</number>
@@ -278,24 +354,27 @@
             </property>
             <property name="sizeHint" stdset="0">
              <size>
-              <width>13</width>
-              <height>116</height>
+              <width>12</width>
+              <height>0</height>
              </size>
             </property>
            </spacer>
           </item>
           <item>
-           <layout class="QVBoxLayout">
+           <layout class="QVBoxLayout" name="_8">
             <property name="spacing">
              <number>6</number>
             </property>
+            <property name="sizeConstraint">
+             <enum>QLayout::SetDefaultConstraint</enum>
+            </property>
             <property name="margin">
              <number>0</number>
             </property>
             <item>
              <widget class="QComboBox" name="comboBoxAudio">
               <property name="sizePolicy">
-               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+               <sizepolicy hsizetype="Preferred" vsizetype="Minimum">
                 <horstretch>0</horstretch>
                 <verstretch>0</verstretch>
                </sizepolicy>
@@ -340,10 +419,13 @@
              </widget>
             </item>
             <item>
-             <layout class="QHBoxLayout">
+             <layout class="QHBoxLayout" name="_9">
               <property name="spacing">
                <number>6</number>
               </property>
+              <property name="sizeConstraint">
+               <enum>QLayout::SetDefaultConstraint</enum>
+              </property>
               <property name="margin">
                <number>0</number>
               </property>
@@ -356,6 +438,9 @@
               </item>
               <item>
                <widget class="QSpinBox" name="spinBox_TimeValue">
+                <property name="enabled">
+                 <bool>false</bool>
+                </property>
                 <property name="sizePolicy">
                  <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
                   <horstretch>0</horstretch>
@@ -370,6 +455,19 @@
                 </property>
                </widget>
               </item>
+              <item>
+               <widget class="QLabel" name="label_11">
+                <property name="sizePolicy">
+                 <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+                  <horstretch>0</horstretch>
+                  <verstretch>0</verstretch>
+                 </sizepolicy>
+                </property>
+                <property name="text">
+                 <string>ms</string>
+                </property>
+               </widget>
+              </item>
              </layout>
             </item>
            </layout>
@@ -377,6 +475,22 @@
          </layout>
         </item>
         <item>
+         <spacer name="verticalSpacer_13">
+          <property name="orientation">
+           <enum>Qt::Vertical</enum>
+          </property>
+          <property name="sizeType">
+           <enum>QSizePolicy::Fixed</enum>
+          </property>
+          <property name="sizeHint" stdset="0">
+           <size>
+            <width>20</width>
+            <height>12</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+        <item>
          <widget class="QLabel" name="label_4">
           <property name="sizePolicy">
            <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
@@ -385,7 +499,7 @@
            </sizepolicy>
           </property>
           <property name="text">
-           <string>&lt;b&gt;Format&lt;/b&gt;</string>
+           <string>&lt;b&gt;Output Format&lt;/b&gt;</string>
           </property>
           <property name="textFormat">
            <enum>Qt::AutoText</enum>
@@ -393,7 +507,26 @@
          </widget>
         </item>
         <item>
+         <spacer name="verticalSpacer_10">
+          <property name="orientation">
+           <enum>Qt::Vertical</enum>
+          </property>
+          <property name="sizeType">
+           <enum>QSizePolicy::Fixed</enum>
+          </property>
+          <property name="sizeHint" stdset="0">
+           <size>
+            <width>20</width>
+            <height>6</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+        <item>
          <layout class="QHBoxLayout" name="horizontalLayout">
+          <property name="spacing">
+           <number>0</number>
+          </property>
           <item>
            <spacer>
             <property name="orientation">
@@ -404,18 +537,21 @@
             </property>
             <property name="sizeHint" stdset="0">
              <size>
-              <width>18</width>
-              <height>13</height>
+              <width>12</width>
+              <height>0</height>
              </size>
             </property>
            </spacer>
           </item>
           <item>
            <layout class="QVBoxLayout" name="verticalLayout_2">
+            <property name="spacing">
+             <number>6</number>
+            </property>
             <item>
              <widget class="QComboBox" name="comboBoxFormat">
               <property name="sizePolicy">
-               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+               <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
                 <horstretch>0</horstretch>
                 <verstretch>0</verstretch>
                </sizepolicy>
@@ -442,26 +578,10 @@
           </item>
          </layout>
         </item>
-        <item>
-         <spacer>
-          <property name="orientation">
-           <enum>Qt::Vertical</enum>
-          </property>
-          <property name="sizeType">
-           <enum>QSizePolicy::Fixed</enum>
-          </property>
-          <property name="sizeHint" stdset="0">
-           <size>
-            <width>13</width>
-            <height>14</height>
-           </size>
-          </property>
-         </spacer>
-        </item>
        </layout>
       </item>
       <item>
-       <layout class="QHBoxLayout">
+       <layout class="QHBoxLayout" name="_10">
         <property name="spacing">
          <number>6</number>
         </property>
@@ -471,7 +591,7 @@
         <item>
          <widget class="QFrame" name="frame_video">
           <property name="sizePolicy">
-           <sizepolicy hsizetype="MinimumExpanding" vsizetype="MinimumExpanding">
+           <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>
@@ -522,33 +642,27 @@
        <enum>Qt::Vertical</enum>
       </property>
       <property name="sizeType">
-       <enum>QSizePolicy::MinimumExpanding</enum>
+       <enum>QSizePolicy::Expanding</enum>
       </property>
       <property name="sizeHint" stdset="0">
        <size>
-        <width>716</width>
-        <height>1</height>
+        <width>619</width>
+        <height>0</height>
        </size>
       </property>
      </spacer>
     </item>
     <item>
-     <layout class="QHBoxLayout">
-      <property name="spacing">
-       <number>6</number>
-      </property>
-      <property name="margin">
-       <number>0</number>
-      </property>
+     <layout class="QHBoxLayout" name="horizontalLayout_3">
       <item>
-       <layout class="QVBoxLayout">
-        <property name="spacing">
-         <number>6</number>
+       <layout class="QGridLayout" name="gridLayout_2">
+        <property name="horizontalSpacing">
+         <number>12</number>
         </property>
-        <property name="margin">
+        <property name="verticalSpacing">
          <number>0</number>
         </property>
-        <item>
+        <item row="0" column="0">
          <widget class="ADM_QSlider" name="horizontalSlider">
           <property name="sizePolicy">
            <sizepolicy hsizetype="Expanding" vsizetype="Fixed">
@@ -561,622 +675,554 @@
           </property>
          </widget>
         </item>
-        <item>
-         <layout class="QHBoxLayout">
+        <item row="1" column="0">
+         <layout class="QVBoxLayout" name="verticalLayout">
           <property name="spacing">
-           <number>6</number>
-          </property>
-          <property name="margin">
            <number>0</number>
           </property>
+          <property name="sizeConstraint">
+           <enum>QLayout::SetDefaultConstraint</enum>
+          </property>
           <item>
-           <widget class="QToolButton" name="toolButtonPlay">
-            <property name="text">
-             <string>...</string>
+           <spacer name="verticalSpacer">
+            <property name="orientation">
+             <enum>Qt::Vertical</enum>
             </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/player_play.png</normaloff>:/new/prefix1/pics/player_play.png</iconset>
+            <property name="sizeType">
+             <enum>QSizePolicy::Preferred</enum>
             </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonStop">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/player_stop.png</normaloff>:/new/prefix1/pics/player_stop.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonPreviousFrame">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/back.png</normaloff>:/new/prefix1/pics/back.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonNextFrame">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/forward.png</normaloff>:/new/prefix1/pics/forward.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonPreviousIntraFrame">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/player_rew.png</normaloff>:/new/prefix1/pics/player_rew.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonNextIntraFrame">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/player_fwd.png</normaloff>:/new/prefix1/pics/player_fwd.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonSetMarkerA">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/markA.png</normaloff>:/new/prefix1/pics/markA.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonSetMarkerB">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/markB.png</normaloff>:/new/prefix1/pics/markB.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonPreviousBlackFrame">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/prev_black.png</normaloff>:/new/prefix1/pics/prev_black.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonNextBlackFrame">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/next_black.png</normaloff>:/new/prefix1/pics/next_black.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonFirstFrame">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/player_start.png</normaloff>:/new/prefix1/pics/player_start.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QToolButton" name="toolButtonLastFrame">
-            <property name="text">
-             <string>...</string>
-            </property>
-            <property name="icon">
-             <iconset resource="avidemux.qrc">
-              <normaloff>:/new/prefix1/pics/player_end.png</normaloff>:/new/prefix1/pics/player_end.png</iconset>
-            </property>
-            <property name="iconSize">
-             <size>
-              <width>24</width>
-              <height>24</height>
-             </size>
-            </property>
-            <property name="autoRaise">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <spacer>
-            <property name="orientation">
-             <enum>Qt::Horizontal</enum>
-            </property>
             <property name="sizeHint" stdset="0">
              <size>
               <width>20</width>
-              <height>20</height>
+              <height>12</height>
              </size>
             </property>
            </spacer>
           </item>
-         </layout>
-        </item>
-        <item>
-         <layout class="QHBoxLayout">
-          <property name="spacing">
-           <number>6</number>
-          </property>
-          <property name="margin">
-           <number>0</number>
-          </property>
           <item>
-           <widget class="QLabel" name="label_6">
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
+           <layout class="QHBoxLayout" name="_3">
+            <property name="spacing">
+             <number>0</number>
             </property>
-            <property name="font">
-             <font>
-              <family>MS Shell Dlg 2</family>
-              <pointsize>8</pointsize>
-              <weight>75</weight>
-              <italic>false</italic>
-              <bold>true</bold>
-              <underline>false</underline>
-              <strikeout>false</strikeout>
-             </font>
+            <property name="margin">
+             <number>0</number>
             </property>
-            <property name="text">
-             <string>Time:</string>
-            </property>
-           </widget>
+            <item>
+             <widget class="QToolButton" name="toolButtonPlay">
+              <property name="text">
+               <string>...</string>
+              </property>
+              <property name="icon">
+               <iconset resource="avidemux.qrc">
+                <normaloff>:/new/prefix1/pics/player_play.png</normaloff>:/new/prefix1/pics/player_play.png</iconset>
+              </property>
+              <property name="iconSize">
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise">
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonStop">
+              <property name="text">
+               <string>...</string>
+              </property>
+              <property name="icon">
+               <iconset resource="avidemux.qrc">
+                <normaloff>:/new/prefix1/pics/player_stop.png</normaloff>:/new/prefix1/pics/player_stop.png</iconset>
+              </property>
+              <property name="iconSize">
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise">
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonPreviousFrame">
+              <property name="text">
+               <string>...</string>
+              </property>
+              <property name="icon">
+               <iconset resource="avidemux.qrc">
+                <normaloff>:/new/prefix1/pics/back.png</normaloff>:/new/prefix1/pics/back.png</iconset>
+              </property>
+              <property name="iconSize">
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise">
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonNextFrame">
+              <property name="text">
+               <string>...</string>
+              </property>
+              <property name="icon">
+               <iconset resource="avidemux.qrc">
+                <normaloff>:/new/prefix1/pics/forward.png</normaloff>:/new/prefix1/pics/forward.png</iconset>
+              </property>
+              <property name="iconSize">
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise">
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonPreviousIntraFrame">
+              <property name="text">
+               <string>...</string>
+              </property>
+              <property name="icon">
+               <iconset resource="avidemux.qrc">
+                <normaloff>:/new/prefix1/pics/player_rew.png</normaloff>:/new/prefix1/pics/player_rew.png</iconset>
+              </property>
+              <property name="iconSize">
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise">
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonNextIntraFrame">
+              <property name="text">
+               <string>...</string>
+              </property>
+              <property name="icon">
+               <iconset resource="avidemux.qrc">
+                <normaloff>:/new/prefix1/pics/player_fwd.png</normaloff>:/new/prefix1/pics/player_fwd.png</iconset>
+              </property>
+              <property name="iconSize">
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise">
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonSetMarkerA">
+              <property name="text">
+               <string>...</string>
+              </property>
+              <property name="icon">
+               <iconset resource="avidemux.qrc">
+                <normaloff>:/new/prefix1/pics/markA.png</normaloff>:/new/prefix1/pics/markA.png</iconset>
+              </property>
+              <property name="iconSize">
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise">
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonSetMarkerB">
+              <property name="text">
+               <string>...</string>
+              </property>
+              <property name="icon">
+               <iconset resource="avidemux.qrc">
+                <normaloff>:/new/prefix1/pics/markB.png</normaloff>:/new/prefix1/pics/markB.png</iconset>
+              </property>
+              <property name="iconSize">
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise">
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonPreviousBlackFrame">
+              <property name="text">
+               <string>...</string>
+              </property>
+              <property name="icon">
+               <iconset resource="avidemux.qrc">
+                <normaloff>:/new/prefix1/pics/prev_black.png</normaloff>:/new/prefix1/pics/prev_black.png</iconset>
+              </property>
+              <property name="iconSize">
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise">
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonNextBlackFrame">
+              <property name="text">
+               <string>...</string>
+              </property>
+              <property name="icon">
+               <iconset resource="avidemux.qrc">
+                <normaloff>:/new/prefix1/pics/next_black.png</normaloff>:/new/prefix1/pics/next_black.png</iconset>
+              </property>
+              <property name="iconSize">
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise">
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonFirstFrame">
+              <property name="text">
+               <string>...</string>
+              </property>
+              <property name="icon">
+               <iconset resource="avidemux.qrc">
+                <normaloff>:/new/prefix1/pics/player_start.png</normaloff>:/new/prefix1/pics/player_start.png</iconset>
+              </property>
+              <property name="iconSize">
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise">
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QToolButton" name="toolButtonLastFrame">
+              <property name="text">
+               <string>...</string>
+              </property>
+              <property name="icon">
+               <iconset resource="avidemux.qrc">
+                <normaloff>:/new/prefix1/pics/player_end.png</normaloff>:/new/prefix1/pics/player_end.png</iconset>
+              </property>
+              <property name="iconSize">
+               <size>
+                <width>24</width>
+                <height>24</height>
+               </size>
+              </property>
+              <property name="autoRaise">
+               <bool>true</bool>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer name="horizontalSpacer_3">
+              <property name="orientation">
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeType">
+               <enum>QSizePolicy::Expanding</enum>
+              </property>
+              <property name="sizeHint" stdset="0">
+               <size>
+                <width>0</width>
+                <height>0</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
           </item>
           <item>
-           <widget class="QLineEdit" name="currentTime">
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="maximumSize">
-             <size>
-              <width>84</width>
-              <height>16777215</height>
-             </size>
-            </property>
-            <property name="text">
-             <string>00:00:00.000</string>
-            </property>
-            <property name="maxLength">
-             <number>12</number>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QLabel" name="totalTime">
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="text">
-             <string>/ 00:00:00.000</string>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <spacer>
+           <spacer name="verticalSpacer_2">
             <property name="orientation">
-             <enum>Qt::Horizontal</enum>
+             <enum>Qt::Vertical</enum>
             </property>
             <property name="sizeType">
-             <enum>QSizePolicy::Fixed</enum>
+             <enum>QSizePolicy::Preferred</enum>
             </property>
             <property name="sizeHint" stdset="0">
              <size>
               <width>20</width>
-              <height>20</height>
+              <height>12</height>
              </size>
             </property>
            </spacer>
           </item>
           <item>
-           <widget class="QLabel" name="label_14">
-            <property name="font">
-             <font>
-              <family>MS Shell Dlg 2</family>
-              <pointsize>8</pointsize>
-              <weight>75</weight>
-              <italic>false</italic>
-              <bold>true</bold>
-              <underline>false</underline>
-              <strikeout>false</strikeout>
-             </font>
+           <layout class="QHBoxLayout" name="_4">
+            <property name="spacing">
+             <number>6</number>
             </property>
-            <property name="text">
-             <string>Frame Type:</string>
+            <property name="margin">
+             <number>0</number>
             </property>
-           </widget>
+            <item>
+             <widget class="QLabel" name="label_6">
+              <property name="sizePolicy">
+               <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+              <property name="text">
+               <string>Time:</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QLineEdit" name="currentTime">
+              <property name="sizePolicy">
+               <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+              <property name="maximumSize">
+               <size>
+                <width>84</width>
+                <height>16777215</height>
+               </size>
+              </property>
+              <property name="text">
+               <string>00:00:00.000</string>
+              </property>
+              <property name="maxLength">
+               <number>12</number>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QLabel" name="totalTime">
+              <property name="sizePolicy">
+               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+              <property name="text">
+               <string>/ 00:00:00.000</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation">
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeType">
+               <enum>QSizePolicy::Fixed</enum>
+              </property>
+              <property name="sizeHint" stdset="0">
+               <size>
+                <width>24</width>
+                <height>0</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+            <item>
+             <widget class="QLabel" name="label_10">
+              <property name="sizePolicy">
+               <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+              <property name="text">
+               <string>Frame type:</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <widget class="QLabel" name="label_8">
+              <property name="sizePolicy">
+               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                <horstretch>0</horstretch>
+                <verstretch>0</verstretch>
+               </sizepolicy>
+              </property>
+              <property name="text">
+               <string>?</string>
+              </property>
+             </widget>
+            </item>
+            <item>
+             <spacer>
+              <property name="orientation">
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeType">
+               <enum>QSizePolicy::Expanding</enum>
+              </property>
+              <property name="sizeHint" stdset="0">
+               <size>
+                <width>0</width>
+                <height>0</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+           </layout>
           </item>
+         </layout>
+        </item>
+        <item row="1" column="1">
+         <layout class="QVBoxLayout" name="verticalLayout_6">
+          <property name="spacing">
+           <number>6</number>
+          </property>
+          <property name="sizeConstraint">
+           <enum>QLayout::SetDefaultConstraint</enum>
+          </property>
           <item>
-           <widget class="QLabel" name="label_8">
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Minimum" vsizetype="Preferred">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
+           <widget class="QLabel" name="label">
             <property name="text">
-             <string>?</string>
+             <string>&lt;b&gt;Selection&lt;/b&gt;</string>
             </property>
            </widget>
           </item>
           <item>
-           <spacer>
-            <property name="orientation">
-             <enum>Qt::Horizontal</enum>
+           <layout class="QGridLayout" name="gridLayout">
+            <property name="spacing">
+             <number>6</number>
             </property>
-            <property name="sizeHint" stdset="0">
-             <size>
-              <width>60</width>
-              <height>20</height>
-             </size>
-            </property>
-           </spacer>
-          </item>
-         </layout>
-        </item>
-       </layout>
-      </item>
-      <item>
-       <spacer>
-        <property name="orientation">
-         <enum>Qt::Horizontal</enum>
-        </property>
-        <property name="sizeType">
-         <enum>QSizePolicy::Fixed</enum>
-        </property>
-        <property name="sizeHint" stdset="0">
-         <size>
-          <width>14</width>
-          <height>95</height>
-         </size>
-        </property>
-       </spacer>
-      </item>
-      <item>
-       <layout class="QVBoxLayout" name="verticalLayout">
-        <item>
-         <widget class="QFrame" name="frameVU">
-          <property name="minimumSize">
-           <size>
-            <width>64</width>
-            <height>64</height>
-           </size>
-          </property>
-          <property name="frameShape">
-           <enum>QFrame::StyledPanel</enum>
-          </property>
-          <property name="frameShadow">
-           <enum>QFrame::Raised</enum>
-          </property>
-         </widget>
-        </item>
-       </layout>
-      </item>
-      <item>
-       <layout class="QVBoxLayout" name="verticalLayout_6">
-        <item>
-         <widget class="QGroupBox" name="groupBox">
-          <property name="sizePolicy">
-           <sizepolicy hsizetype="Minimum" vsizetype="Minimum">
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
-          </property>
-          <property name="minimumSize">
-           <size>
-            <width>116</width>
-            <height>100</height>
-           </size>
-          </property>
-          <property name="maximumSize">
-           <size>
-            <width>100</width>
-            <height>100</height>
-           </size>
-          </property>
-          <property name="font">
-           <font>
-            <family>MS Shell Dlg 2</family>
-            <pointsize>8</pointsize>
-            <weight>75</weight>
-            <italic>false</italic>
-            <bold>true</bold>
-            <underline>false</underline>
-            <strikeout>false</strikeout>
-           </font>
-          </property>
-          <property name="title">
-           <string>Selection</string>
-          </property>
-          <property name="alignment">
-           <set>Qt::AlignLeading|Qt::AlignLeft|Qt::AlignVCenter</set>
-          </property>
-          <widget class="QWidget" name="layoutWidget">
-           <property name="geometry">
-            <rect>
-             <x>9</x>
-             <y>32</y>
-             <width>98</width>
-             <height>58</height>
-            </rect>
-           </property>
-           <layout class="QVBoxLayout" name="verticalLayout_4">
-            <item>
-             <layout class="QHBoxLayout" name="horizontalLayout_3">
-              <item>
-               <widget class="QLabel" name="label_12">
-                <property name="font">
-                 <font>
-                  <family>MS Shell Dlg 2</family>
-                  <pointsize>8</pointsize>
-                  <weight>50</weight>
-                  <italic>false</italic>
-                  <bold>false</bold>
-                  <underline>false</underline>
-                  <strikeout>false</strikeout>
-                 </font>
-                </property>
-                <property name="text">
-                 <string> A:</string>
-                </property>
-               </widget>
-              </item>
-              <item>
-               <widget class="QPushButton" name="pushButtonJumpToMarkerA">
-                <property name="sizePolicy">
-                 <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                  <horstretch>0</horstretch>
-                  <verstretch>0</verstretch>
-                 </sizepolicy>
-                </property>
-                <property name="font">
-                 <font>
-                  <family>MS Shell Dlg 2</family>
-                  <pointsize>8</pointsize>
-                  <weight>50</weight>
-                  <italic>false</italic>
-                  <bold>false</bold>
-                  <underline>false</underline>
-                  <strikeout>false</strikeout>
-                 </font>
-                </property>
-                <property name="text">
-                 <string>000000</string>
-                </property>
-               </widget>
-              </item>
-             </layout>
+            <item row="1" column="0">
+             <spacer name="horizontalSpacer">
+              <property name="orientation">
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeType">
+               <enum>QSizePolicy::Fixed</enum>
+              </property>
+              <property name="sizeHint" stdset="0">
+               <size>
+                <width>12</width>
+                <height>0</height>
+               </size>
+              </property>
+             </spacer>
             </item>
-            <item>
-             <layout class="QHBoxLayout" name="horizontalLayout_4">
-              <item>
-               <widget class="QLabel" name="label_11">
-                <property name="font">
-                 <font>
-                  <family>MS Shell Dlg 2</family>
-                  <pointsize>8</pointsize>
-                  <weight>50</weight>
-                  <italic>false</italic>
-                  <bold>false</bold>
-                  <underline>false</underline>
-                  <strikeout>false</strikeout>
-                 </font>
-                </property>
-                <property name="text">
-                 <string> B:</string>
-                </property>
-               </widget>
-              </item>
-              <item>
-               <widget class="QPushButton" name="pushButtonJumpToMarkerB">
-                <property name="sizePolicy">
-                 <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                  <horstretch>0</horstretch>
-                  <verstretch>0</verstretch>
-                 </sizepolicy>
-                </property>
-                <property name="font">
-                 <font>
-                  <family>MS Shell Dlg 2</family>
-                  <pointsize>8</pointsize>
-                  <weight>50</weight>
-                  <italic>false</italic>
-                  <bold>false</bold>
-                  <underline>false</underline>
-                  <strikeout>false</strikeout>
-                 </font>
-                </property>
-                <property name="layoutDirection">
-                 <enum>Qt::LeftToRight</enum>
-                </property>
-                <property name="text">
-                 <string>000000</string>
-                </property>
-               </widget>
-              </item>
-             </layout>
+            <item row="2" column="0">
+             <spacer name="horizontalSpacer_2">
+              <property name="orientation">
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeType">
+               <enum>QSizePolicy::Fixed</enum>
+              </property>
+              <property name="sizeHint" stdset="0">
+               <size>
+                <width>12</width>
+                <height>0</height>
+               </size>
+              </property>
+             </spacer>
             </item>
+            <item row="1" column="1">
+             <widget class="QLabel" name="label_2">
+              <property name="text">
+               <string>A:</string>
+              </property>
+             </widget>
+            </item>
+            <item row="2" column="1">
+             <widget class="QLabel" name="label_9">
+              <property name="text">
+               <string>B:</string>
+              </property>
+             </widget>
+            </item>
+            <item row="1" column="2">
+             <widget class="QPushButton" name="pushButtonJumpToMarkerA">
+              <property name="text">
+               <string>000000</string>
+              </property>
+             </widget>
+            </item>
+            <item row="2" column="2">
+             <widget class="QPushButton" name="pushButtonJumpToMarkerB">
+              <property name="text">
+               <string>000000</string>
+              </property>
+             </widget>
+            </item>
            </layout>
-          </widget>
-         </widget>
+          </item>
+         </layout>
         </item>
        </layout>
       </item>
       <item>
-       <spacer name="horizontalSpacer">
-        <property name="orientation">
-         <enum>Qt::Horizontal</enum>
+       <widget class="QFrame" name="frameVU">
+        <property name="sizePolicy">
+         <sizepolicy hsizetype="Fixed" vsizetype="Preferred">
+          <horstretch>0</horstretch>
+          <verstretch>0</verstretch>
+         </sizepolicy>
         </property>
-        <property name="sizeHint" stdset="0">
+        <property name="minimumSize">
          <size>
-          <width>40</width>
-          <height>20</height>
+          <width>64</width>
+          <height>64</height>
          </size>
         </property>
-       </spacer>
-      </item>
-      <item>
-       <layout class="QVBoxLayout">
-        <property name="spacing">
-         <number>6</number>
+        <property name="frameShape">
+         <enum>QFrame::StyledPanel</enum>
         </property>
-        <property name="margin">
-         <number>0</number>
+        <property name="frameShadow">
+         <enum>QFrame::Raised</enum>
         </property>
-       </layout>
+       </widget>
       </item>
       <item>
-       <layout class="QVBoxLayout">
+       <layout class="QVBoxLayout" name="verticalLayout_4">
         <property name="spacing">
-         <number>4</number>
+         <number>5</number>
         </property>
-        <property name="margin">
-         <number>0</number>
-        </property>
         <item>
          <widget class="QToolButton" name="toolButtonAudioToggle">
           <property name="enabled">
            <bool>true</bool>
           </property>
+          <property name="sizePolicy">
+           <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
+            <horstretch>0</horstretch>
+            <verstretch>0</verstretch>
+           </sizepolicy>
+          </property>
           <property name="text">
            <string>...</string>
           </property>
@@ -1195,7 +1241,7 @@
         <item>
          <widget class="QSlider" name="horizontalSlider_2">
           <property name="sizePolicy">
-           <sizepolicy hsizetype="Preferred" vsizetype="Minimum">
+           <sizepolicy hsizetype="Preferred" vsizetype="Expanding">
             <horstretch>0</horstretch>
             <verstretch>0</verstretch>
            </sizepolicy>



From mean at mail.berlios.de  Sun Apr 11 09:55:29 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 11 Apr 2010 09:55:29 +0200
Subject: [Avidemux-svn-commit] r6117 - branches/avidemux_2.6_branch_mean
Message-ID: <201004110755.o3B7tTgk028270@sheep.berlios.de>

Author: mean
Date: 2010-04-11 09:55:29 +0200 (Sun, 11 Apr 2010)
New Revision: 6117

Added:
   branches/avidemux_2.6_branch_mean/bootStrapOsx.bash
Log:
[OsX] BootStrap file by surfer

Added: branches/avidemux_2.6_branch_mean/bootStrapOsx.bash
===================================================================
--- branches/avidemux_2.6_branch_mean/bootStrapOsx.bash	2010-04-11 07:55:27 UTC (rev 6116)
+++ branches/avidemux_2.6_branch_mean/bootStrapOsx.bash	2010-04-11 07:55:29 UTC (rev 6117)
@@ -0,0 +1,212 @@
+#!/bin/bash
+# Bootstrapper to semi-automatically build avidemux from source on OSX
+# (c) Mean 2009
+
+# Specify the the directory where you want to install avidemux (a.k.a. the cmake_install_prefix)
+# like export BASE_INSTALL_DIR="<full_path_to_installation>". This can be /usr/local or /opt/local (macports) or /sw (Fink)
+export BASE_INSTALL_DIR="opt/local";
+
+packages_ext=""
+do_core=1
+do_cli=0
+do_gtk=0   # Note that gtk is no fully longer supported on OSX. You are on your own here
+do_qt4=1
+do_plugins=1
+debug=0
+fail()
+{
+        echo "** Failed at $1**"
+        exit 1
+}
+
+
+Process()
+{
+        export BUILDDIR=$1
+        export SOURCEDIR=$2
+        export EXTRA=$3
+        export DEBUG=""
+        BUILDER="Unix Makefiles"
+        if [ "x$debug" = "x1" ] ; then 
+                DEBUG="-DVERBOSE=1 -DCMAKE_BUILD_TYPE=Debug  "
+                BUILDDIR="${BUILDDIR}_debug"
+                BUILDER="CodeBlocks - Unix Makefiles"
+        fi
+        
+        echo "Building $BUILDDIR from $SOURCEDIR with EXTRA=<$EXTRA>, DEBUG=<$DEBUG>"
+        rm -Rf ./$BUILDDIR
+        mkdir $BUILDDIR || fail mkdir
+        cd $BUILDDIR 
+        cmake $PKG -DCMAKE_EDIT_COMMAND=vim -DAVIDEMUX_SOURCE_DIR=$TOP -DCMAKE_INSTALL_PREFIX="$BASE_INSTALL_DIR" $EXTRA $DEBUG -G "$BUILDER" $SOURCEDIR || fail cmakeZ
+        make -j 2 > /tmp/log$BUILDDIR || fail make
+}
+printModule()
+{
+        value=$1
+        name=$2
+        if [ "x$value" = "x1" ]; then echo "    $name will be built"
+        else echo "     $name will be skipped"
+        fi
+        
+
+}
+config()
+{
+        echo "Build configuration :"
+        echo "******************* :"
+        echo "Build type :"
+        if [ "x$debug" = "x1" ] ; then echo   "Debug build"
+        else echo   "Release build"
+        fi
+        printModule $do_core Core
+        printModule $do_gtk Gtk
+        printModule $do_qt4 Qt4
+        printModule $do_cli Cli
+        printModule $do_plugins Plugins
+}
+usage()
+{
+        echo "Bootstrap avidemux 2.6:"
+        echo "***********************"
+        echo "  --help            : Print usage"
+        echo "  --tgz             : Build tgz packages"
+        echo "  --debug           : Switch debugging on"
+        echo "  --with-core       : Build core"
+        echo "  --without-core    : Dont build core"
+        echo "  --with-cli        : Build cli"
+        echo "  --without-cli     : Dont build cli"
+        echo "  --with-gtk        : Build gtk"
+        echo "  --without-gtk     : Dont build gtk"
+        echo "  --with-core       : Build core"
+        echo "  --without-qt4     : Dont build qt4"
+        echo "  --with-plugins    : Build plugins"
+        echo "  --without-plugins : Dont build plugins"
+        config 
+
+}
+# Could probably do it with getopts...
+while [ $# != 0 ] ;do
+        case "$1" in
+         -h|--help)
+             usage
+             exit 1
+             ;;
+         --debug)
+                debug=1
+                ;;
+         --pause)
+                pause_script=true
+                ;;
+         --tgz)
+                packages_ext=tar.gz
+                PKG="$PKG -DAVIDEMUX_PACKAGER=tgz"
+                ;;
+         --without-qt4)
+                do_qt4=0
+             ;;
+         --without-cli)
+                do_cli=0
+             ;;
+         --without-gtk)
+                do_gtk=0
+             ;;
+         --without-plugins)
+                do_plugins=0
+             ;;
+         --without-core)
+                do_core=0
+             ;;
+         --with-qt4)
+                do_qt4=1
+             ;;
+         --with-cli)
+                do_cli=1
+             ;;
+         --with-gtk)
+                do_gtk=1
+             ;;
+         --with-plugins)
+                do_plugins=1
+             ;;
+         --with-core)
+                do_core=1
+             ;;
+        *)
+                echo "unknown parameter $1"
+                usage
+                exit 1
+                ;;
+     esac
+     shift
+done
+config
+echo "**BootStrapping avidemux **"
+export TOP=$PWD
+export POSTFIX=""
+echo "Top dir : $TOP"
+if [ "x$debug" = "x1" ] ; then echo   
+POSTFIX="_debug"
+fi
+
+if [ "x$do_core" = "x1" ] ; then 
+        echo "** CORE **"
+        cd $TOP
+        Process buildCore ../avidemux_core
+        echo " Core needs to be installed, installing through sudo make install ...."
+        cd $TOP/buildCore${POSTFIX} && sudo make install
+fi
+if [ "x$do_qt4" = "x1" ] ; then 
+        echo "** QT4 **"
+        cd $TOP
+        Process buildQt4 ../avidemux/qt4
+        echo " Qt4 needs to be installed, installing through sudo make install ...."
+        cd $TOP/buildQt4${POSTFIX} && sudo make install
+fi
+if [ "x$do_cli" = "x1" ] ; then 
+        echo "** CLI **"
+        cd $TOP
+        Process buildCli ../avidemux/cli
+        echo " Cli needs to be installed, installing through sudo make install ...."
+        cd $TOP/buildCli${POSTFIX} && sudo make install
+fi
+if [ "x$do_gtk" = "x1" ] ; then 
+        echo "** GTK **"
+        cd $TOP
+        Process buildGtk ../avidemux/gtk
+        echo " Gtk needs to be installed, installing through sudo make install ...."
+        cd $TOP/buildGtk${POSTFIX} && sudo make install
+fi
+if [ "x$do_plugins" = "x1" ] ; then 
+        echo "** Plugins **"
+        cd $TOP
+        Process buildPluginsCommon ../avidemux_plugins -DPLUGIN_UI=COMMON
+fi
+if [ "x$do_plugins" = "x1" -a "x$do_qt4" = "x1" ] ; then 
+        echo "** Plugins Qt4 **"
+        cd $TOP
+        Process buildPluginsQt4 ../avidemux_plugins -DPLUGIN_UI=QT4
+fi
+if [ "x$do_plugins" = "x1" -a "x$do_gtk" = "x1" ] ; then 
+        echo "** Plugins Gtk **"
+        cd $TOP
+        Process buildPluginsGtk ../avidemux_plugins -DPLUGIN_UI=GTK
+fi
+if [ "x$do_plugins" = "x1" -a "x$do_cli" = "x1" ] ; then 
+        echo "** Plugins CLI **"
+        cd $TOP
+        Process buildPluginsCLI ../avidemux_plugins -DPLUGIN_UI=CLI
+fi
+
+echo "** Preparing debs **"
+cd $TOP
+if [ "x$packages_ext" = "x" ]; then 
+        echo "No packaging"
+else
+        echo "Preparing packages"
+        rm -Rf debs
+        mkdir debs
+        find . -name "*.$packages_ext" | grep -vi cpa | xargs cp -t debs
+        echo "** debs directory ready **"
+        ls -l debs
+fi
+echo "** ALL DONE **"



From mean at mail.berlios.de  Sun Apr 11 09:55:30 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 11 Apr 2010 09:55:30 +0200
Subject: [Avidemux-svn-commit] r6118 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config
Message-ID: <201004110755.o3B7tU0R028280@sheep.berlios.de>

Author: mean
Date: 2010-04-11 09:55:30 +0200 (Sun, 11 Apr 2010)
New Revision: 6118

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/config.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/ffconf.c
Log:
[ffmpegconfig] Dont force have_malloc_h, osx does not have it

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/config.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/config.h	2010-04-11 07:55:29 UTC (rev 6117)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/config.h	2010-04-11 07:55:30 UTC (rev 6118)
@@ -521,9 +521,6 @@
 #define HAVE_ROUND 1
 #define HAVE_ROUNDF 1
 #define HAVE_THREADS 1
-#ifndef HAVE_MALLOC_H 
-#define HAVE_MALLOC_H 1
-#endif 
 #define RUNTIME_CPUDETECT 1
 #define CONFIG_RUNTIME_CPUDETECT 1
 #if defined( __MINGW32__) || defined(__APPLE__)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/ffconf.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/ffconf.c	2010-04-11 07:55:29 UTC (rev 6117)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/ffconf.c	2010-04-11 07:55:30 UTC (rev 6118)
@@ -597,9 +597,6 @@
 	printf("#define HAVE_ROUND 1\n");
 	printf("#define HAVE_ROUNDF 1\n");
 	printf("#define HAVE_THREADS 1\n");
-        printf("#ifndef HAVE_MALLOC_H \n");
-        printf("#define HAVE_MALLOC_H 1\n");
-        printf("#endif \n");
 	printf("#define RUNTIME_CPUDETECT 1\n");
 	printf("#define CONFIG_RUNTIME_CPUDETECT 1\n");
     printf("#if defined( __MINGW32__) || defined(__APPLE__)\n");



From gruntster at mail.berlios.de  Sun Apr 11 11:46:46 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 11 Apr 2010 11:46:46 +0200
Subject: [Avidemux-svn-commit] r6119 - in
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK:
	ADM_gui2 glade
Message-ID: <201004110946.o3B9kk1H001970@sheep.berlios.de>

Author: gruntster
Date: 2010-04-11 11:46:39 +0200 (Sun, 11 Apr 2010)
New Revision: 6119

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/glade/gtk2_build.glade
Log:
[auto] remove internal auto wizards from GTK+ interface and populate with contents of script dir

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2010-04-11 07:55:30 UTC (rev 6118)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2010-04-11 09:46:39 UTC (rev 6119)
@@ -15,6 +15,8 @@
  ***************************************************************************/
 
 #include <math.h>
+#include <stack>
+
 #include "ADM_toolkitGtk.h"
 
 #include "../ADM_render/GUI_render.h"
@@ -65,16 +67,18 @@
 
 static int keyPressHandlerId=0;
 
-//static gint	  guiCursorEvtMask=0;
 static gint       jogChange( void );
 static void volumeChange( void );
+
 static char     *customNames[ADM_MAC_CUSTOM_SCRIPT];
+static std::stack<gchar*> autoWizardStack;
+
 static uint32_t ADM_nbCustom=0;
 // Needed for DND
 // extern int A_openAvi (char *name);
 extern int A_appendAvi (const char *name);
+extern bool A_parseECMAScript(const char *name);
 
-
 static void on_audio_change(void);
 static void on_video_change(void);
 static void on_preview_change(void);
@@ -82,6 +86,7 @@
 static int update_ui=0;
 void GUI_gtk_grow_off(int onff);
 static void GUI_initCustom(void);
+static void GUI_buildAutoMenu(void);
 const char * GUI_getCustomScript(uint32_t nb);
 uint32_t audioEncoderGetNumberOfEncoders(void);
 const char  *audioEncoderGetDisplayName(uint32_t i);
@@ -338,6 +343,13 @@
 
 	for(int i=0;i<ADM_nbCustom;i++)
 		delete(customNames[i]);
+
+	while (!autoWizardStack.empty())
+	{
+		g_free(autoWizardStack.top());
+		autoWizardStack.pop();
+	}
+
 #ifdef USE_JOG
         physical_jog_shuttle->deregisterCBs (NULL);
         delete physical_jog_shuttle;
@@ -585,6 +597,7 @@
    UI_arrow_enabled();
   // Add custom menu
  GUI_initCustom();
+ GUI_buildAutoMenu();
     return 1;
 
 }
@@ -637,6 +650,75 @@
   #undef CALLBACK
   printf("Menu built\n");
 }
+
+static void autoMenuCallback(GtkMenuItem* menuitem, gpointer user_data)
+{
+	A_parseECMAScript((char*)user_data);
+}
+
+static void addDirEntryToMenu(GtkWidget *parentMenu, const gchar *parentPath)
+{
+	GDir *dir = g_dir_open(parentPath, 0, NULL);
+
+	if (!dir)
+		return;
+
+	const gchar *name = g_dir_read_name(dir);
+
+	while (name != NULL)
+	{
+		gchar *path, *display_name;
+
+		path = g_build_filename(parentPath, name, NULL);
+		display_name = g_filename_to_utf8(name, -1, NULL, NULL, NULL);
+
+		if (g_file_test(path, G_FILE_TEST_IS_DIR))
+		{
+			GtkWidget *menuItem = gtk_menu_item_new_with_mnemonic(display_name);
+			gtk_widget_show(menuItem);
+			gtk_container_add(GTK_CONTAINER(parentMenu), menuItem);
+
+			GtkWidget *menu = gtk_menu_new();
+			gtk_menu_item_set_submenu(GTK_MENU_ITEM(menuItem), menu);
+
+			addDirEntryToMenu(menu, path);
+		}
+		else
+		{
+			gchar *pathCopy = g_strdup(path);
+
+			*(strrchr(display_name, '.')) = 0;
+			autoWizardStack.push(pathCopy);
+
+			GtkWidget *menuItem = gtk_menu_item_new_with_mnemonic(display_name);
+			gtk_widget_show(menuItem);
+			gtk_container_add(GTK_CONTAINER(parentMenu), menuItem);
+			gtk_signal_connect(GTK_OBJECT(menuItem), "activate", GTK_SIGNAL_FUNC(autoMenuCallback), (gpointer)pathCopy);
+		}
+
+		g_free(path);
+		g_free(display_name);
+
+		name = g_dir_read_name(dir);      
+	}
+
+	g_dir_close(dir);
+}
+
+void GUI_buildAutoMenu(void)
+{
+	GtkWidget *menuItem = lookup_widget(guiRootWindow, "help1");
+	GtkWidget *menu = gtk_menu_new();
+	char *scriptDir = ADM_getScriptPath();
+	gchar *autoDir = g_build_filename(scriptDir, "auto", NULL);
+
+	delete scriptDir;
+	gtk_menu_item_set_submenu(GTK_MENU_ITEM(menuItem), menu);
+	addDirEntryToMenu(menu, autoDir);
+
+	g_free(autoDir);
+}
+
 gboolean  on_drawingarea1_expose_event(GtkWidget * widget,  GdkEventExpose * event, gpointer user_data)
 {
 UNUSED_ARG(widget);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp	2010-04-11 07:55:30 UTC (rev 6118)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp	2010-04-11 09:46:39 UTC (rev 6119)
@@ -128,14 +128,6 @@
   GtkWidget *separator17;
   GtkWidget *see_hex1;
   GtkWidget *help1;
-  GtkWidget *help1_menu;
-  GtkWidget *vcd1;
-  GtkWidget *svcd1;
-  GtkWidget *dvd1;
-  GtkWidget *psp1;
-  GtkWidget *psp__h264_1;
-  GtkWidget *flv1;
-  GtkWidget *Ipod;
   GtkWidget *go1;
   GtkWidget *go1_menu;
   GtkWidget *play_video1;
@@ -766,37 +758,6 @@
   gtk_widget_show (help1);
   gtk_container_add (GTK_CONTAINER (menuBar), help1);
 
-  help1_menu = gtk_menu_new ();
-  gtk_menu_item_set_submenu (GTK_MENU_ITEM (help1), help1_menu);
-
-  vcd1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("_VCD"));
-  gtk_widget_show (vcd1);
-  gtk_container_add (GTK_CONTAINER (help1_menu), vcd1);
-
-  svcd1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("_SVCD"));
-  gtk_widget_show (svcd1);
-  gtk_container_add (GTK_CONTAINER (help1_menu), svcd1);
-
-  dvd1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("_DVD"));
-  gtk_widget_show (dvd1);
-  gtk_container_add (GTK_CONTAINER (help1_menu), dvd1);
-
-  psp1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("_PSP"));
-  gtk_widget_show (psp1);
-  gtk_container_add (GTK_CONTAINER (help1_menu), psp1);
-
-  psp__h264_1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("PSP (_H.264)"));
-  gtk_widget_show (psp__h264_1);
-  gtk_container_add (GTK_CONTAINER (help1_menu), psp__h264_1);
-
-  flv1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("F_LV"));
-  gtk_widget_show (flv1);
-  gtk_container_add (GTK_CONTAINER (help1_menu), flv1);
-
-  Ipod = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("IPOD (mpeg4)"));
-  gtk_widget_show (Ipod);
-  gtk_container_add (GTK_CONTAINER (help1_menu), Ipod);
-
   go1 = gtk_menu_item_new_with_mnemonic (QT_TR_NOOP("_Go"));
   gtk_widget_show (go1);
   gtk_container_add (GTK_CONTAINER (menuBar), go1);
@@ -1591,14 +1552,6 @@
   GLADE_HOOKUP_OBJECT (mainWindow, separator17, "separator17");
   GLADE_HOOKUP_OBJECT (mainWindow, see_hex1, "see_hex1");
   GLADE_HOOKUP_OBJECT (mainWindow, help1, "help1");
-  GLADE_HOOKUP_OBJECT (mainWindow, help1_menu, "help1_menu");
-  GLADE_HOOKUP_OBJECT (mainWindow, vcd1, "vcd1");
-  GLADE_HOOKUP_OBJECT (mainWindow, svcd1, "svcd1");
-  GLADE_HOOKUP_OBJECT (mainWindow, dvd1, "dvd1");
-  GLADE_HOOKUP_OBJECT (mainWindow, psp1, "psp1");
-  GLADE_HOOKUP_OBJECT (mainWindow, psp__h264_1, "psp__h264_1");
-  GLADE_HOOKUP_OBJECT (mainWindow, flv1, "flv1");
-  GLADE_HOOKUP_OBJECT (mainWindow, Ipod, "Ipod");
   GLADE_HOOKUP_OBJECT (mainWindow, go1, "go1");
   GLADE_HOOKUP_OBJECT (mainWindow, go1_menu, "go1_menu");
   GLADE_HOOKUP_OBJECT (mainWindow, play_video1, "play_video1");

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h	2010-04-11 07:55:30 UTC (rev 6118)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_menumap.h	2010-04-11 09:46:39 UTC (rev 6119)
@@ -89,14 +89,6 @@
 //CALLBACK(display_output1                       ,ACT_OutputToggle);
 CALLBACK(second_audio_track1                   ,ACT_SecondAudioTrack);
 
-CALLBACK(vcd1                                   ,ACT_AUTO_VCD);
-CALLBACK(svcd1                                  ,ACT_AUTO_SVCD);
-CALLBACK(dvd1                                   ,ACT_AUTO_DVD);
-CALLBACK(psp1                                   ,ACT_AUTO_PSP);
-CALLBACK(psp__h264_1,                           ACT_AUTO_PSP_H264);
-CALLBACK(flv1,                                  ACT_AUTO_FLV);
-CALLBACK(Ipod,                                  ACT_AUTO_IPOD);
-
 CALLBACK(add_to_joblist1                       ,ACT_ADD_JOB);
 CALLBACK(joblist1                              ,ACT_HANDLE_JOB);
 CALLBACK(v2v                                   ,ACT_V2V);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/glade/gtk2_build.glade
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/glade/gtk2_build.glade	2010-04-11 07:55:30 UTC (rev 6118)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/glade/gtk2_build.glade	2010-04-11 09:46:39 UTC (rev 6119)
@@ -853,67 +853,6 @@
 	      <property name="visible">True</property>
 	      <property name="label" translatable="yes">A_uto</property>
 	      <property name="use_underline">True</property>
-
-	      <child>
-		<widget class="GtkMenu" id="help1_menu">
-
-		  <child>
-		    <widget class="GtkMenuItem" id="vcd1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_VCD</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="svcd1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_SVCD</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="dvd1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_DVD</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="psp1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">_PSP</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="psp_(h264)1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">PSP (_H.264)</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="flv1">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">F_LV</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkMenuItem" id="Ipod">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">IPOD (mpeg4)</property>
-		      <property name="use_underline">True</property>
-		    </widget>
-		  </child>
-		</widget>
-	      </child>
 	    </widget>
 	  </child>
 



From gruntster at mail.berlios.de  Sun Apr 11 12:25:56 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 11 Apr 2010 12:25:56 +0200
Subject: [Avidemux-svn-commit] r6120 - in
	branches/avidemux_2.5_branch_gruntster/avidemux: . ADM_filter
	ADM_script ADM_toolkit ADM_userInterfaces/ADM_GTK/ADM_filters
	ADM_userInterfaces/ADM_QT4/ADM_filters
	ADM_userInterfaces/ADM_commonUI
Message-ID: <201004111025.o3BAPuKB005918@sheep.berlios.de>

Author: gruntster
Date: 2010-04-11 12:25:45 +0200 (Sun, 11 Apr 2010)
New Revision: 6120

Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_autoFilter.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/vidVCD.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/vidVCD.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.h
   branches/avidemux_2.5_branch_gruntster/avidemux/gui_autodrive.cpp
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSAvidemux.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_toolkit/automation.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/filter.qrc
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/mainfilter.ui
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/gui_action.names
Log:
[auto] remove remnants of internal auto wizards

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/CMakeLists.txt	2010-04-11 09:46:39 UTC (rev 6119)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/CMakeLists.txt	2010-04-11 10:25:45 UTC (rev 6120)
@@ -2,9 +2,8 @@
 ADM_vidDummyFilter.cpp  
 filter.cpp  
 filter_declaration.cpp  
-filter_saveload.cpp  
-filter_autoFilter.cpp
-vidVCD.cpp)
+filter_saveload.cpp
+)
 
 ADD_ADM_LIB_ALL_TARGETS(ADM_filter ${ADM_filter_SRCS})
 ADD_CFLAGS_ALL_TARGETS(ADM_filter -I${LIBXML2_INCLUDE_DIR} ${LIBXML2_DEFINITIONS})

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_autoFilter.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_autoFilter.cpp	2010-04-11 09:46:39 UTC (rev 6119)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/filter_autoFilter.cpp	2010-04-11 10:25:45 UTC (rev 6120)
@@ -1,95 +0,0 @@
-
-/***************************************************************************
-    \fn filter_autoFilter
-    \brief Build aut8omatically addborder & resize filter.
-    copyright            : (C) 200 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include "config.h"
-#include "ADM_default.h"
-
-#include "ADM_videoFilter.h"
-#include "ADM_videoFilter_internal.h"
-
-#include "DIA_coreToolkit.h"
-
-
-extern uint32_t nb_active_filter;
-extern FILTER  videofilters[VF_MAX_FILTER];
-extern AVDMGenericVideoStream *filterCreateFromTag(VF_FILTERS tag,CONFcouple *couple, AVDMGenericVideoStream *in);
-//#include "ADM_video/ADM_vidCommonFilter.h"
-//BUILD_CREATE(crop_create,AVDMVideoStreamCrop);
-
-/**
- *      \fn insertFilter
- *      \brief Create filter
- */
-static AVDMGenericVideoStream *insertFilter(AVDMGenericVideoStream *in,VF_FILTERS tag, CONFcouple *conf)
-{
-  
-  AVDMGenericVideoStream *filter;
-   
-  filter=filterCreateFromTag(tag,conf, in) ;
-  if(!filter)
-    {
-      GUI_Error_HIG("Filter","Cannot create filter.\nMake sure your plugins are properly installed.\n I might crash soon.");
-      return NULL;
-    }
-  return filter;
-}
-/**
- *      \fn create_addBorder
- * 
- */
-AVDMGenericVideoStream *create_addBorder(VF_FILTERS *tag,AVDMGenericVideoStream *in,uint32_t x,uint32_t x2,uint32_t y,uint32_t y2)
-{
-  VF_FILTERS filterTag=VF_INVALID;
-  
-  filterTag=filterGetTagFromName("addblack");
-  if(filterTag==VF_INVALID)
-    {
-        GUI_Error_HIG("Border","The filter addBorder cannot be found.\nMake sure your plugins are properly installed.");
-        return NULL;
-    }
-    // Create confcouples
-  CONFcouple couple(4);
-    couple.setCouple("left",x);
-    couple.setCouple("right",x2);
-    couple.setCouple("top",y);
-    couple.setCouple("bottom",y2);
-    *tag=filterTag;
-    return insertFilter(in,filterTag,&couple);
-}
-
-/**
- *      \fn createResizeFromParam
- *      \brief Create & instert a resize filter
- */
-AVDMGenericVideoStream *createResizeFromParam(VF_FILTERS *tag,AVDMGenericVideoStream*in, unsigned int a, unsigned int b)
-{
-  VF_FILTERS filterTag=VF_INVALID;
-   
-   filterTag=filterGetTagFromName("mpresize");
-   if(filterTag==VF_INVALID)
-     {
-         GUI_Error_HIG("Resize","The filter resize cannot be found.\nMake sure your plugins are properly installed.");
-         return NULL;
-     }
-     // Create confcouples
-   CONFcouple couple(3);
-     couple.setCouple("w",a);
-     couple.setCouple("h",b);
-     couple.setCouple("algo",1);
-     *tag=filterTag;
-     return insertFilter(in,filterTag,&couple);     
-}

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/vidVCD.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/vidVCD.cpp	2010-04-11 09:46:39 UTC (rev 6119)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/vidVCD.cpp	2010-04-11 10:25:45 UTC (rev 6120)
@@ -1,329 +0,0 @@
-/***************************************************************************
-                          vidVCD.cpp  -  description
-                             -------------------
-    begin                : Wed Aug 21 2002
-    copyright            : (C) 2002 by mean
-    email                : fixounet at free.fr
-
-	This is a meta filter that adds the needed filter to convert the stream to VCD resolution
-   It computes the parmater and create
-			- A resize filter
-			- A Add border filter
-
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include "ADM_assert.h"
-
-#include "ADM_assert.h"
-
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <unistd.h>
-#include <string.h>
-#include <math.h>
-#include "config.h"
-#include "fourcc.h"
-#include "avi_vars.h"
-
-
-#include "prototype.h"
-#include "ADM_editor/ADM_edit.hxx"
-#include "ADM_videoFilter.h"
-#include "ADM_videoFilter_internal.h"
-#include "ADM_filter/vidVCD.h"
-#include "prefs.h"
-#include "ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.h"
-#include "ADM_video/ADM_vidMisc.h"
-//___________________________________________
-extern FILTER videofilters[VF_MAX_FILTER];
-extern uint32_t nb_active_filter;
-extern ADM_Composer *video_body;
-
-static uint8_t computeResize (void);
-
-
-RESWIZ_FORMAT format;
-RESWIZ_AR sourceAR, destinationAR;
-static double aspectRatio[2][3]={
-                                                                {1.,0.888888,1.19}, // NTSC 1:1 4:3 16:9
-                                                                {1.,1.066667,1.43} // PAL  1:1 4:3 16:9
-                                                        };
-
-struct targetFmt
-{
-        int x1,x2,y1,y2;
-};
-
-
-static targetFmt VCD={352, 352, 288, 240};
-static targetFmt SVCD={480, 720, 576, 480};
-static targetFmt DVD={720, 720, 576, 480};
-static targetFmt DVDHD1={352, 720, 576, 480};
-static targetFmt PSP={480, 480, 272, 272};
-static targetFmt PSPH264={720, 720, 480, 480};
-static targetFmt IPOD={320, 320, 240, 240};
-static targetFmt IPOD640={640, 640, 480, 480};
-
-/* Dont forget to update DIA_resizeWiz if you change something here */
-
-targetFmt *allFormats[]={&VCD,&SVCD,&DVD,&DVDHD1,&PSP,&PSPH264,&IPOD,&IPOD640};
-extern AVDMGenericVideoStream *createResampleFps(AVDMGenericVideoStream *in,uint32_t targetfps1000);
-#define ARME(x) format=RESWIZ_##x
-
-uint8_t setVCD (void)
-{
-
-  ARME (VCD);
-  return computeResize();
-}
-
-/**
-    \fn     setIPOD (void)
-    \brief  Setup  video size & fps to be compatible with IPOD
-*/
-uint8_t setIPOD (void)
-{
-  int8_t r=0;
-ADV_Info *info;
-uint32_t fps1000;
-
-    ARME (IPOD);
-    return computeResize();
-}
-
-/**
-    \fn     setPSP (void)
-    \brief  Setup  video size & fps to be compatible with PSP
-*/
-uint8_t setPSP (void)
-{
-uint8_t r=0;
-ADV_Info *info;
-uint32_t fps1000;
-
-    ARME (PSP);
-    return computeResize();
-}
-/**
-    \fn     setPSPFullRes (void)
-    \brief  Setup  video size & fps to be compatible with PSP FULL SCREEN
-*/
-uint8_t setPSPFullRes (void)
-{
-uint8_t r=0;
-ADV_Info *info;
-uint32_t fps1000;
-
-    ARME (PSP_FULLRES);
-    return computeResize();
-}
-
-uint8_t setSVCD (void)
-{
-
-  ARME (SVCD);
-  return computeResize();
-}
-uint8_t setDVD (void)
-{
-
-  ARME (DVD);
-  return computeResize();
-}
-uint8_t setHalfD1 (void)
-{
-
-  ARME (DVD_HD1);
-  return computeResize();
-}
-
-
-extern AVDMGenericVideoStream *create_addBorder (VF_FILTERS *o, AVDMGenericVideoStream * in,
-						 uint32_t x, uint32_t x2,
-						 uint32_t y, uint32_t y2);
-extern AVDMGenericVideoStream *createResizeFromParam (VF_FILTERS *o, AVDMGenericVideoStream *
-						      in, uint32_t x,
-						      uint32_t y);
-//
-//  Compute the filters, aspect is the reduction factor for h
-//  =1 for VCD/DVD
-//      =2/3 for SVCD
-//------------------------------
-/********************************************************************/
-uint8_t
-computeResize (void)
-{
-
-int targetx,targetxFinal,targetyPAL,targetyNTSC;
-
-  ADV_Info *info;
-  char *inputratio = NULL;
-
-
-  uint8_t res = 0;		/* 1 Pal, 2 NSTC or film */
-  uint32_t targety;
-
-  // scale as if it was 1:1 -> 4:3
-        prefs->get (FEATURE_SVCDRES_PREFEREDSOURCERATIO, &inputratio);
-        if(inputratio)
-        {
-                if (inputratio && !strcmp (inputratio, "1:1")) 
-                        sourceAR=RESWIZ_AR_1_1;
-                if (inputratio && !strcmp (inputratio, "4:3")) 
-                        sourceAR=RESWIZ_AR_4_3;
-                if (inputratio && !strcmp (inputratio, "16:9")) 
-                        sourceAR=RESWIZ_AR_16_9;
-     
-                ADM_dealloc (inputratio);
-                inputratio = NULL;
-        }
-        
-  
-  if (!DIA_resizeWiz (&format, &sourceAR, &destinationAR))
-    return 0;
-
- targetx=allFormats[format]->x1;
- targetxFinal=allFormats[format]->x2;
- targetyPAL=allFormats[format]->y1;
- targetyNTSC=allFormats[format]->y2;
-        
-
-  info = getLastVideoFilter (frameStart, frameEnd - frameStart)->getInfo ();
-
-
-  res = identMovieType (info->fps1000);
-  //printf("fps : %lu / %d \n",info->fps1000,res);
-  switch (res)
-    {
-    case FRAME_PAL:
-      res = 1;
-      break;
-    case FRAME_NTSC:
-    case FRAME_FILM:
-      res = 2;
-      break;
-    default:
-      res = 0;
-      return 0;
-      break;
-    }
-  if (res == 2)
-    targety = targetyNTSC;
-  else
-    targety = targetyPAL;
-
-
-  double rx, ry;
-  uint32_t newx, newy;
-  uint32_t cropx, cropy;
-  uint32_t original_x, original_y;
-
-
-  original_x = info->width;
-  original_y = info->height;
-
-  
-  // scale as if it was 1:1 -> 4:3
-  rx = original_x;
-  switch (res)
-  {
-      case 1:		//PAL
-                rx = rx *aspectRatio[1][sourceAR]/aspectRatio[1][destinationAR];
-                break;
-       case 2:		// NTSC
-                rx = rx * aspectRatio[0][sourceAR]/aspectRatio[0][destinationAR];
-                break;
-   }
-
-  original_x = (uint32_t) floor (rx + 0.49);
-
-  rx = original_x;
-  rx = rx / targetxFinal;
-
-
-  ry = original_y;
-  ry = ry / targety;
-
-  // which do do we compress less ?
-  if (rx > ry)			// resize by X, add border afterward
-    {
-      newx = targetx;
-      ry = original_y;
-      ry = ry / rx;
-      newy = (uint32_t) floor (ry + 0.49);
-      printf (" resize by x\n");
-
-    }
-  else
-    {
-      newy = targety;
-      rx = original_x;
-      rx = rx / ry;
-      rx *= targetx;
-      rx /= targetxFinal;
-      newx = (uint32_t) floor (rx + 0.49);
-      printf (" resize by y\n");
-
-    }
-
-  printf ("\n New X x Y = %u x %u\n", newx, newy);
-
-  // correct odd / even
-
-  newx -= newx % 4;
-  newy -= newy % 4;
-
-  // Now correct crop
-
-
-  cropx = targetx - newx;
-  cropy = targety - newy;
-
-  printf ("\n Resized to : %u x %u, add black border %u x %u",
-	  newx, newy, cropx, cropy);
-
-  // now build filter
-
-
-// first resize (if needed)
-
-  CONFcouple *couple;
-  if (newx != info->width || newy != info->height)
-    {
-      VF_FILTERS rtag=VF_INVALID;
-      videofilters[nb_active_filter].filter =
-	createResizeFromParam (&rtag,getLastVideoFilter (), newx, newy);
-      if(! videofilters[nb_active_filter].filter) return 0;
-
-      videofilters[nb_active_filter].tag = rtag;
-      videofilters[nb_active_filter].filter->getCoupledConf (&couple);
-      videofilters[nb_active_filter].conf = couple;;
-      nb_active_filter++;
-    }
-// then add crop (if needed)
-
-  if (cropx || cropy)
-    {
-      VF_FILTERS ctag=VF_INVALID;
-      videofilters[nb_active_filter].filter =
-	create_addBorder (&ctag,videofilters[nb_active_filter - 1].filter,
-			  cropx >> 1, cropx >> 1, cropy >> 1, cropy >> 1);
-      if(! videofilters[nb_active_filter].filter) return 0;
-      videofilters[nb_active_filter].tag = ctag;
-      videofilters[nb_active_filter].filter->getCoupledConf (&couple);
-      videofilters[nb_active_filter].conf = couple;;
-      nb_active_filter++;
-    }
-  return 1;
-}

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/vidVCD.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/vidVCD.h	2010-04-11 09:46:39 UTC (rev 6119)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_filter/vidVCD.h	2010-04-11 10:25:45 UTC (rev 6120)
@@ -1,31 +0,0 @@
-/***************************************************************************
-                          vidVCD.h  -  description
-                             -------------------
-    begin                : Wed Aug 21 2002
-    copyright            : (C) 2002 by mean
-    email                : fixounet at free.fr
-
-	
-
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef vidVCD_H
-#define vidVCD_H
-
-uint8_t setSVCD( void );
-uint8_t setVCD( void );
-uint8_t setPSP(void);
-uint8_t setPSPFullRes(void);
-uint8_t setDVD( void );
-uint8_t setHalfD1( void );
-uint8_t setIPOD( void);
-
-#endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSAvidemux.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSAvidemux.cpp	2010-04-11 09:46:39 UTC (rev 6119)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSAvidemux.cpp	2010-04-11 10:25:45 UTC (rev 6120)
@@ -61,8 +61,6 @@
 	{ "load", Load, 1, 0, 0 },	// Load movie
 	{ "loadFilters", LoadFilters, 1, 0, 0 },	// Load filters from file
 	{ "save", Save, 1, 0, 0 },	// Save movie
-/*	{ "saveDVD", SaveDVD, 1, 0, 0 },	// Save movie as DVD
-	{ "saveOGM", SaveOGM, 1, 0, 0 },	// Save movie as OGM*/
         { "clearSegments", ClearSegments ,0,0,0}, // Clear all segments
         { "addSegment", AddSegment ,3,0,0}, // Clear all segments
 	{ "goToTime", GoToTime, 3, 0, 0 },	// more current frame to time index

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_toolkit/automation.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_toolkit/automation.cpp	2010-04-11 09:46:39 UTC (rev 6119)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_toolkit/automation.cpp	2010-04-11 10:25:45 UTC (rev 6120)
@@ -42,7 +42,6 @@
 #include "ADM_osSupport/ADM_debug.h"
 #include "ADM_libraries/ADM_utilities/avidemutils.h"
 
-#include "ADM_filter/vidVCD.h"
 #include "ADM_video/ADM_vidMisc.h"
 
 extern void filterListAll(void );
@@ -98,7 +97,6 @@
 static void set_autoindex(char *p);
 extern int A_SaveUnpackedVop(const char *name);
 extern int A_SavePackedVop(const char *name);
-extern int A_saveDVDPS(char *name);
 extern void A_saveWorkbench (const char *name);
 extern uint8_t A_rebuildKeyFrame (void);
 extern uint8_t A_setContainer(const char *cont);
@@ -150,10 +148,6 @@
         {"audio-resample",	1,"resample to x hz",			call_resample},
         {"filters",		1,"load a filter preset",		(one_arg_type)filterLoadXml}   ,
         {"codec-conf",		1,"load a codec configuration",		(one_arg_type )loadVideoCodecConf}   ,
-        {"vcd-res",		0,"set VCD resolution",			(one_arg_type)setVCD}              ,
-        {"svcd-res",		0,"set SVCD resolution",		(one_arg_type)setSVCD}              ,
-        {"dvd-res",		0,"set DVD resolution",			(one_arg_type)setDVD}  ,
-        {"halfd1-res",		0,"set 1/2 DVD resolution",		(one_arg_type)setHalfD1} ,  
         {"save-jpg",		1,"save JPEG images",			(one_arg_type)A_saveBunchJpg},
         {"begin",		1,"set start frame",			setBegin},
         {"end",			1,"set end frame",			setEnd},
@@ -185,7 +179,7 @@
         {"fps",	                1,"set frames per second",	call_fps},
         {"audio-codec",		1,"set audio codec (AAC/AC3/COPY/MP2/MP3/NONE (WAV PCM)/TWOLAME)",call_audiocodec},
         
-        {"video-codec",		1,"set video codec (COPY/DV/DVD/FFHUFF/FFmpeg4/FFV1/FLV1/H263/HUFF/MJPEG/REQUANT/SVCD/VCD/x264/XDVD/Xvid4/XVCD/XSVCD/Y800/YV12)", call_videocodec},
+        {"video-codec",		1,"set video codec (COPY/DV/FFHUFF/FFmpeg4/FFV1/FLV1/H263/HUFF/MJPEG/REQUANT/x264/XDVD/Xvid4/YV12)", call_videocodec},
         {"video-conf",		1	,"set video codec conf (cq=q|cbr=br|2pass=size)[,mbr=br][,matrix=(0|1|2|3)]",				call_videoconf},
         {"reuse-2pass-log",	0	,"reuse 2pass logfile if it exists",	set_reuse_2pass_log},
         {"set-pp",		2	,"set post processing default value, value(1=hdeblok|2=vdeblock|4=dering) and strength (0-5)",

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp	2010-04-11 09:46:39 UTC (rev 6119)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp	2010-04-11 10:25:45 UTC (rev 6120)
@@ -19,8 +19,7 @@
 
 #include "ADM_video/ADM_vidPartial.h"
 #include "avi_vars.h"
-#include "ADM_filter/vidVCD.h"
-//___________________________________________
+
 typedef enum 
 {
   A_BEGIN = 10,
@@ -30,10 +29,6 @@
   A_DOWN,
   A_REMOVE,
   A_DONE,
-  A_VCD,
-  A_SVCD,
-  A_DVD,
-  A_HALFD1,
   A_LOAD,
   A_SAVE,
   A_PREVIEW,
@@ -177,31 +172,6 @@
         updateFilterList ();
         setSelectionNumber(nb_active_filter-1, WID(treeviewActive), stores[0], nb_active_filter-2);
         break;
-
-    case A_VCD:
-        setVCD ();
-        updateFilterList ();
-        setSelectionNumber(nb_active_filter-1, WID(treeviewActive), stores[0], nb_active_filter-2);
-        break;
-
-    case A_SVCD:
-        setSVCD ();
-        updateFilterList ();
-        setSelectionNumber(nb_active_filter-1, WID(treeviewActive), stores[0], nb_active_filter-2);
-        break;
-
-    case A_DVD:
-        setDVD ();
-        updateFilterList ();
-        setSelectionNumber(nb_active_filter-1, WID(treeviewActive), stores[0], nb_active_filter-2);
-        break;
-
-    case A_HALFD1:
-        setHalfD1 ();
-        updateFilterList ();
-        setSelectionNumber(nb_active_filter-1, WID(treeviewActive), stores[0], nb_active_filter-2);
-        break;
-
     default:
     case A_DOUBLECLICK:
         printf ("Double clicked..");
@@ -415,10 +385,6 @@
 	CONNECT (buttonDown, A_DOWN)
 	CONNECT (buttonPreview, A_PREVIEW)
 	CONNECT (buttonPartial, A_PARTIAL)
-	CONNECT (buttonVCDRes, A_VCD)
-	CONNECT (buttonSVCDRes, A_SVCD)
-	CONNECT (buttonHalfD1Res, A_HALFD1)
-	CONNECT (buttonDVDRes, A_DVD)
 	CONNECT (buttonOpen, A_LOAD)
 	CONNECT (buttonSave, A_SAVE)
 

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp	2010-04-11 09:46:39 UTC (rev 6119)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp	2010-04-11 10:25:45 UTC (rev 6120)
@@ -32,12 +32,8 @@
   GtkWidget *table2;
   GtkWidget *scrolledwindowAvailable;
   GtkWidget *treeviewAvailable;
-  GtkWidget *buttonVCDRes;
-  GtkWidget *buttonSVCDRes;
-  GtkWidget *buttonHalfD1Res;
   GtkWidget *hbox2;
   GtkWidget *label1;
-  GtkWidget *buttonDVDRes;
   GtkWidget *frame1;
   GtkWidget *mainTree;
   GtkWidget *hboxActionAvailable;
@@ -137,33 +133,6 @@
   gtk_widget_show (table2);
   gtk_box_pack_start (GTK_BOX (vbox3), table2, FALSE, FALSE, 0);
 
-  buttonVCDRes = gtk_button_new_with_mnemonic (QT_TR_NOOP("_VCD"));
-  gtk_tooltips_set_tip (tooltips, buttonVCDRes, QT_TR_NOOP("VCD resolution"), NULL);
-  gtk_widget_show (buttonVCDRes);
-  gtk_table_attach_defaults (GTK_TABLE(table2), buttonVCDRes, 0, 1, 0, 1);
-
-  buttonSVCDRes = gtk_button_new_with_mnemonic (QT_TR_NOOP("_SVCD"));
-  gtk_tooltips_set_tip (tooltips, buttonSVCDRes, QT_TR_NOOP("SVCD resolution"), NULL);
-  gtk_widget_show (buttonSVCDRes);
-  gtk_table_attach_defaults (GTK_TABLE(table2), buttonSVCDRes, 1, 2, 0, 1);
-
-  buttonHalfD1Res = gtk_button_new ();
-  gtk_tooltips_set_tip (tooltips, buttonHalfD1Res, QT_TR_NOOP("Half D1 resolution"), NULL);
-  gtk_widget_show (buttonHalfD1Res);
-  hbox2 = gtk_hbox_new (FALSE, 2);
-  gtk_widget_show (hbox2);
-  gtk_container_add (GTK_CONTAINER (buttonHalfD1Res), hbox2);
-  label1 = gtk_label_new_with_mnemonic (QT_TR_NOOP("<sup>1</sup>/<sub>2</sub> D_1"));
-  gtk_label_set_use_markup (GTK_LABEL(label1), TRUE);
-  gtk_widget_show (label1);
-  gtk_box_pack_start (GTK_BOX (hbox2), label1, FALSE, FALSE, 0);
-  gtk_table_attach_defaults (GTK_TABLE(table2), buttonHalfD1Res, 0, 1, 1, 2);
-
-  buttonDVDRes = gtk_button_new_with_mnemonic (QT_TR_NOOP("_DVD"));
-  gtk_tooltips_set_tip (tooltips, buttonDVDRes, QT_TR_NOOP("DVD resolution"), NULL);
-  gtk_widget_show (buttonDVDRes);
-  gtk_table_attach_defaults (GTK_TABLE(table2), buttonDVDRes, 1, 2, 1, 2);
-
   scrolledwindowAvailable = gtk_scrolled_window_new (NULL, NULL);
   gtk_table_attach_defaults (GTK_TABLE(table1), scrolledwindowAvailable, 1, 2, 0, 1);
   gtk_scrolled_window_set_policy (GTK_SCROLLED_WINDOW (scrolledwindowAvailable), GTK_POLICY_NEVER, GTK_POLICY_AUTOMATIC);
@@ -331,12 +300,8 @@
   GLADE_HOOKUP_OBJECT (dialog1, table2, "table2");
   GLADE_HOOKUP_OBJECT (dialog1, scrolledwindowAvailable, "scrolledwindowAvailable");
   GLADE_HOOKUP_OBJECT (dialog1, treeviewAvailable, "treeviewAvailable");
-  GLADE_HOOKUP_OBJECT (dialog1, buttonVCDRes, "buttonVCDRes");
-  GLADE_HOOKUP_OBJECT (dialog1, buttonSVCDRes, "buttonSVCDRes");
-  GLADE_HOOKUP_OBJECT (dialog1, buttonHalfD1Res, "buttonHalfD1Res");
   GLADE_HOOKUP_OBJECT (dialog1, hbox2, "hbox2");
   GLADE_HOOKUP_OBJECT (dialog1, label1, "label1");
-  GLADE_HOOKUP_OBJECT (dialog1, buttonDVDRes, "buttonDVDRes");
   GLADE_HOOKUP_OBJECT (dialog1, frame1, "frame1");
   GLADE_HOOKUP_OBJECT (dialog1, mainTree, "mainTree");
   GLADE_HOOKUP_OBJECT (dialog1, hboxActionAvailable, "hboxActionAvailable");

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp	2010-04-11 09:46:39 UTC (rev 6119)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp	2010-04-11 10:25:45 UTC (rev 6120)
@@ -40,7 +40,6 @@
 #include "ADM_videoFilter.h"
 #include "ADM_videoFilter_internal.h"
 #include "ADM_video/ADM_vidPartial.h"
-#include "ADM_filter/vidVCD.h"
 #include "DIA_factory.h"
 #include "ADM_toolkitQt.h"
 
@@ -283,26 +282,7 @@
 			if (previewDialogOpen)
 				preview(true);
 }
-#define MAKE_BUTTON(button,call) \
-void filtermainWindow::button( bool b) \
-{ \
-    if (call()) \
-	{ \
-		bool previewDialogOpen = (previewDialog != NULL); \
-\
-		closePreview(); \
-		getFirstVideoFilter (); \
-		buildActiveFilterList ();  \
-		setSelected(nb_active_filter - 1); \
-\
-		if (previewDialogOpen) \
-			preview(true); \
-	} \
-}
-MAKE_BUTTON(DVD,setDVD)
-MAKE_BUTTON(VCD,setVCD)
-MAKE_BUTTON(SVCD,setSVCD)
-MAKE_BUTTON(halfD1,setHalfD1)
+
 /**
         \fn     configure( bool b)
         \brief  Configure the selected active filter
@@ -655,10 +635,6 @@
 	connect(ui.toolButtonLoad, SIGNAL(clicked(bool)), this, SLOT(loadScript(bool)));
 	connect(ui.toolButtonSaveScript, SIGNAL(clicked(bool)), this, SLOT(saveScript(bool)));
 
-    connect(ui.pushButtonDVD, SIGNAL(clicked(bool)), this, SLOT(DVD(bool)));
-    connect(ui.pushButtonVCD, SIGNAL(clicked(bool)), this, SLOT(VCD(bool)));
-    connect(ui.pushButtonSVCD, SIGNAL(clicked(bool)), this, SLOT(SVCD(bool)));
-    connect(ui.pushButtonHalfDVD, SIGNAL(clicked(bool)), this, SLOT(halfD1(bool)));
 	connect(ui.pushButtonPreview, SIGNAL(clicked(bool)), this, SLOT(preview(bool)));
 
 	activeList->setItemDelegate(new FilterItemDelegate(activeList));

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.h	2010-04-11 09:46:39 UTC (rev 6119)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.h	2010-04-11 10:25:45 UTC (rev 6120)
@@ -42,10 +42,6 @@
 	QListWidget *activeList;
 
 public slots:
-	void VCD(bool b);
-	void DVD(bool b);
-	void SVCD(bool b);
-	void halfD1(bool b);
 	void add(bool b);
 	void up(bool b);
 	void down(bool b);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/filter.qrc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/filter.qrc	2010-04-11 09:46:39 UTC (rev 6119)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/filter.qrc	2010-04-11 10:25:45 UTC (rev 6120)
@@ -8,7 +8,6 @@
         <file>icons/6.png</file>
         <file>icons/7.png</file>
         <file>icons/add.png</file>
-        <file>icons/cd.png</file>
         <file>icons/close.png</file>
         <file>icons/down.png</file>
         <file>icons/exec.png</file>

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/mainfilter.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/mainfilter.ui	2010-04-11 09:46:39 UTC (rev 6119)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/mainfilter.ui	2010-04-11 10:25:45 UTC (rev 6120)
@@ -33,112 +33,6 @@
      <property name="spacing" >
       <number>6</number>
      </property>
-     <item row="4" column="0" colspan="2" >
-      <layout class="QGridLayout" >
-       <property name="margin" >
-        <number>0</number>
-       </property>
-       <property name="spacing" >
-        <number>6</number>
-       </property>
-       <item row="0" column="1" >
-        <widget class="QPushButton" name="pushButtonSVCD" >
-         <property name="sizePolicy" >
-          <sizepolicy>
-           <hsizetype>5</hsizetype>
-           <vsizetype>0</vsizetype>
-           <horstretch>0</horstretch>
-           <verstretch>0</verstretch>
-          </sizepolicy>
-         </property>
-         <property name="minimumSize" >
-          <size>
-           <width>72</width>
-           <height>0</height>
-          </size>
-         </property>
-         <property name="text" >
-          <string>&amp;SVCD Res</string>
-         </property>
-         <property name="icon" >
-          <iconset resource="filter.qrc" >:/new/prefix1/icons/cd.png</iconset>
-         </property>
-        </widget>
-       </item>
-       <item row="1" column="1" >
-        <widget class="QPushButton" name="pushButtonVCD" >
-         <property name="sizePolicy" >
-          <sizepolicy>
-           <hsizetype>5</hsizetype>
-           <vsizetype>5</vsizetype>
-           <horstretch>0</horstretch>
-           <verstretch>0</verstretch>
-          </sizepolicy>
-         </property>
-         <property name="minimumSize" >
-          <size>
-           <width>72</width>
-           <height>0</height>
-          </size>
-         </property>
-         <property name="text" >
-          <string>&amp;VCD Res</string>
-         </property>
-         <property name="icon" >
-          <iconset resource="filter.qrc" >:/new/prefix1/icons/cd.png</iconset>
-         </property>
-        </widget>
-       </item>
-       <item row="1" column="0" >
-        <widget class="QPushButton" name="pushButtonHalfDVD" >
-         <property name="sizePolicy" >
-          <sizepolicy>
-           <hsizetype>5</hsizetype>
-           <vsizetype>0</vsizetype>
-           <horstretch>0</horstretch>
-           <verstretch>0</verstretch>
-          </sizepolicy>
-         </property>
-         <property name="minimumSize" >
-          <size>
-           <width>72</width>
-           <height>0</height>
-          </size>
-         </property>
-         <property name="text" >
-          <string>&amp;Half D1 Res</string>
-         </property>
-         <property name="icon" >
-          <iconset resource="filter.qrc" >:/new/prefix1/icons/cd.png</iconset>
-         </property>
-        </widget>
-       </item>
-       <item row="0" column="0" >
-        <widget class="QPushButton" name="pushButtonDVD" >
-         <property name="sizePolicy" >
-          <sizepolicy>
-           <hsizetype>5</hsizetype>
-           <vsizetype>0</vsizetype>
-           <horstretch>0</horstretch>
-           <verstretch>0</verstretch>
-          </sizepolicy>
-         </property>
-         <property name="minimumSize" >
-          <size>
-           <width>72</width>
-           <height>0</height>
-          </size>
-         </property>
-         <property name="text" >
-          <string>&amp;DVD Res</string>
-         </property>
-         <property name="icon" >
-          <iconset resource="filter.qrc" >:/new/prefix1/icons/cd.png</iconset>
-         </property>
-        </widget>
-       </item>
-      </layout>
-     </item>
      <item rowspan="4" row="1" column="2" colspan="2" >
       <widget class="QListWidget" name="listWidgetAvailable" >
        <property name="sizePolicy" >
@@ -160,106 +54,6 @@
        </property>
       </widget>
      </item>
-     <item rowspan="3" row="1" column="0" colspan="2" >
-      <widget class="QListWidget" name="listFilterCategory" >
-       <property name="sizePolicy" >
-        <sizepolicy>
-         <hsizetype>0</hsizetype>
-         <vsizetype>7</vsizetype>
-         <horstretch>0</horstretch>
-         <verstretch>0</verstretch>
-        </sizepolicy>
-       </property>
-       <property name="minimumSize" >
-        <size>
-         <width>100</width>
-         <height>340</height>
-        </size>
-       </property>
-       <property name="selectionBehavior" >
-        <enum>QAbstractItemView::SelectRows</enum>
-       </property>
-       <property name="iconSize" >
-        <size>
-         <width>24</width>
-         <height>24</height>
-        </size>
-       </property>
-       <property name="resizeMode" >
-        <enum>QListView::Adjust</enum>
-       </property>
-       <property name="spacing" >
-        <number>3</number>
-       </property>
-       <property name="currentRow" >
-        <number>0</number>
-       </property>
-       <item>
-        <property name="text" >
-         <string>Transform</string>
-        </property>
-        <property name="icon" >
-         <iconset resource="filter.qrc" >:/new/prefix1/icons/1.png</iconset>
-        </property>
-       </item>
-       <item>
-        <property name="text" >
-         <string>Interlacing</string>
-        </property>
-        <property name="icon" >
-         <iconset resource="filter.qrc" >:/new/prefix1/icons/2.png</iconset>
-        </property>
-       </item>
-       <item>
-        <property name="text" >
-         <string>Colors</string>
-        </property>
-        <property name="icon" >
-         <iconset resource="filter.qrc" >:/new/prefix1/icons/4.png</iconset>
-        </property>
-       </item>
-       <item>
-        <property name="text" >
-         <string>Noise</string>
-        </property>
-        <property name="icon" >
-         <iconset resource="filter.qrc" >:/new/prefix1/icons/5.png</iconset>
-        </property>
-       </item>
-       <item>
-        <property name="text" >
-         <string>Sharpness</string>
-        </property>
-        <property name="icon" >
-         <iconset resource="filter.qrc" >:/new/prefix1/icons/3.png</iconset>
-        </property>
-       </item>
-       <item>
-        <property name="text" >
-         <string>Subtitles</string>
-        </property>
-        <property name="icon" >
-         <iconset resource="filter.qrc" >:/new/prefix1/icons/7.png</iconset>
-        </property>
-       </item>
-       <item>
-        <property name="text" >
-         <string>Miscellaneous</string>
-        </property>
-        <property name="icon" >
-         <iconset resource="filter.qrc" >:/new/prefix1/icons/6.png</iconset>
-        </property>
-       </item>
-       <item>
-        <property name="text" >
-         <string>External</string>
-        </property>
-        <property name="icon" >
-         <iconset resource="filter.qrc" >:/new/prefix1/icons/exec.png</iconset>
-        </property>
-       </item>
-      </widget>
-     </item>
      <item row="1" column="4" >
       <spacer>
        <property name="orientation" >
@@ -469,16 +263,108 @@
        </item>
       </layout>
      </item>
-     <item row="0" column="2" >
-      <widget class="QLabel" name="label" >
+     <item rowspan="4" row="1" column="0" colspan="2" >
+      <widget class="QListWidget" name="listFilterCategory" >
        <property name="sizePolicy" >
         <sizepolicy>
-         <hsizetype>5</hsizetype>
-         <vsizetype>4</vsizetype>
+         <hsizetype>0</hsizetype>
+         <vsizetype>7</vsizetype>
          <horstretch>0</horstretch>
          <verstretch>0</verstretch>
         </sizepolicy>
        </property>
+       <property name="minimumSize" >
+        <size>
+         <width>100</width>
+         <height>340</height>
+        </size>
+       </property>
+       <property name="selectionBehavior" >
+        <enum>QAbstractItemView::SelectRows</enum>
+       </property>
+       <property name="iconSize" >
+        <size>
+         <width>24</width>
+         <height>24</height>
+        </size>
+       </property>
+       <property name="resizeMode" >
+        <enum>QListView::Adjust</enum>
+       </property>
+       <property name="spacing" >
+        <number>3</number>
+       </property>
+       <property name="currentRow" >
+        <number>0</number>
+       </property>
+       <item>
+        <property name="text" >
+         <string>Transform</string>
+        </property>
+        <property name="icon" >
+         <iconset resource="filter.qrc" >:/new/prefix1/icons/1.png</iconset>
+        </property>
+       </item>
+       <item>
+        <property name="text" >
+         <string>Interlacing</string>
+        </property>
+        <property name="icon" >
+         <iconset resource="filter.qrc" >:/new/prefix1/icons/2.png</iconset>
+        </property>
+       </item>
+       <item>
+        <property name="text" >
+         <string>Colors</string>
+        </property>
+        <property name="icon" >
+         <iconset resource="filter.qrc" >:/new/prefix1/icons/4.png</iconset>
+        </property>
+       </item>
+       <item>
+        <property name="text" >
+         <string>Noise</string>
+        </property>
+        <property name="icon" >
+         <iconset resource="filter.qrc" >:/new/prefix1/icons/5.png</iconset>
+        </property>
+       </item>
+       <item>
+        <property name="text" >
+         <string>Sharpness</string>
+        </property>
+        <property name="icon" >
+         <iconset resource="filter.qrc" >:/new/prefix1/icons/3.png</iconset>
+        </property>
+       </item>
+       <item>
+        <property name="text" >
+         <string>Subtitles</string>
+        </property>
+        <property name="icon" >
+         <iconset resource="filter.qrc" >:/new/prefix1/icons/7.png</iconset>
+        </property>
+       </item>
+       <item>
+        <property name="text" >
+         <string>Miscellaneous</string>
+        </property>
+        <property name="icon" >
+         <iconset resource="filter.qrc" >:/new/prefix1/icons/6.png</iconset>
+        </property>
+       </item>
+       <item>
+        <property name="text" >
+         <string>External</string>
+        </property>
+        <property name="icon" >
+         <iconset resource="filter.qrc" >:/new/prefix1/icons/exec.png</iconset>
+        </property>
+       </item>
+      </widget>
+     </item>
+     <item row="0" column="0" colspan="2" >
+      <widget class="QLabel" name="label_3" >
        <property name="text" >
         <string>&lt;big>&lt;b>Available Filters&lt;/b>&lt;/big></string>
        </property>
@@ -562,10 +448,6 @@
   <tabstop>listFilterCategory</tabstop>
   <tabstop>listWidgetAvailable</tabstop>
   <tabstop>listWidgetActive</tabstop>
-  <tabstop>pushButtonDVD</tabstop>
-  <tabstop>pushButtonSVCD</tabstop>
-  <tabstop>pushButtonHalfDVD</tabstop>
-  <tabstop>pushButtonVCD</tabstop>
   <tabstop>toolButtonAdd</tabstop>
   <tabstop>toolButtonConfigure</tabstop>
   <tabstop>toolButtonPartial</tabstop>

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt	2010-04-11 09:46:39 UTC (rev 6119)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt	2010-04-11 10:25:45 UTC (rev 6120)
@@ -1,7 +1,6 @@
 SET(ADM_LIB ADM_commonUI)
 
 SET(${ADM_LIB}_SRCS
-DIA_resizeWiz.cpp  
 DIA_v2v.cpp
 DIA_audioFilter.cpp   
 DIA_gototime.cpp    
@@ -18,20 +17,4 @@
 DIA_muxerMpegPs.cpp
 )
 
-SET(OBSOLETE_SRCS
-DIA_flyThreshold.cpp 
-DIA_flyParticle.cpp 
-DIA_flyEraser.cpp 
-DIA_flySwissArmyKnife.cpp
-DIA_flyContrast.cpp  
-DIA_flySrtPos.cpp   
-DIA_srt.cpp        
-DIA_flyCrop.cpp      
-DIA_flyAsharp.cpp    
-DIA_flyHue.cpp       
-DIA_flyEq2.cpp        
-
-)
-
-ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
-
+ADD_ADM_LIB_ALL_TARGETS(${ADM_LIB} ${${ADM_LIB}_SRCS})
\ No newline at end of file

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.cpp	2010-04-11 09:46:39 UTC (rev 6119)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.cpp	2010-04-11 10:25:45 UTC (rev 6120)
@@ -1,68 +0,0 @@
-
-/***************************************************************************
-                         DIA_resizeWiz
-                             -------------------
-
-                           Ui for hue & sat
-    copyright            : (C) 2004/5 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include "config.h"
-#include "ADM_default.h"
-
-#include "DIA_resizeWiz.h"
-#include "DIA_factory.h"
-
-
-uint8_t DIA_resizeWiz(RESWIZ_FORMAT *format, RESWIZ_AR *source, RESWIZ_AR *destination)
-{
-uint8_t r=0;
-#define ONELINE(x,y) {RESWIZ_##x,y,NULL}
-            diaMenuEntry menuFTarget[]={
-                             ONELINE(VCD,QT_TR_NOOP("VCD")),
-                             ONELINE(SVCD,QT_TR_NOOP("SVCD")),
-                             ONELINE(DVD,QT_TR_NOOP("DVD")),
-                             ONELINE(DVD_HD1,QT_TR_NOOP("DVD half D1")),
-                             ONELINE(PSP,QT_TR_NOOP("PSP (480 * 272)")),
-                             ONELINE(PSP_FULLRES,QT_TR_NOOP("PSP full res. (720 * 480)")),
-                             ONELINE(IPOD,"iPod (320 * 240)"),
-                             ONELINE(IPOD640,"iPod (640 * 480)"),
-                          };
-             diaMenuEntry menuFAspect[3]={
-               {RESWIZ_AR_1_1,QT_TR_NOOP("1:1"),NULL},
-               {RESWIZ_AR_4_3,QT_TR_NOOP("4:3"),NULL},
-               {RESWIZ_AR_16_9,QT_TR_NOOP("16:9"),NULL}
-                          };
-  
-  
-                          
-    uint32_t tformat=(uint32_t )*format;
-    uint32_t tsource=(uint32_t )*source;
-    uint32_t tdestination=(uint32_t )*destination;
-                          
-    diaElemMenu     menu1(&tformat,QT_TR_NOOP("_Target type:"), sizeof(menuFTarget) / sizeof(diaMenuEntry),menuFTarget);
-    diaElemMenu     menu2(&tsource,QT_TR_NOOP("_Source aspect ratio:"), 3,menuFAspect);
-    diaElemMenu     menu3(&tdestination,QT_TR_NOOP("_Destination aspect ratio:"), 3,menuFAspect);
-    
-    
-    
-      diaElem *elems[3]={&menu1,&menu2,&menu3};
-    if(diaFactoryRun(QT_TR_NOOP("Auto Wizard"),3,elems))
-    {
-       *format=(RESWIZ_FORMAT) tformat;
-       *source=(RESWIZ_AR) tsource;
-       *destination=(RESWIZ_AR) tdestination;
-      return 1; 
-    }
-    return 0;
-}

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.h	2010-04-11 09:46:39 UTC (rev 6119)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.h	2010-04-11 10:25:45 UTC (rev 6120)
@@ -1,45 +0,0 @@
-
-
-/***************************************************************************
-                         DIA_resizeWiz
-                             -------------------
-
-                           Ui for hue & sat
-    copyright            : (C) 2004/5 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef DIA_RES_WIZ_H
-#define DIA_RES_WIZ_H
-
-typedef enum 
-{
-        RESWIZ_VCD,
-        RESWIZ_SVCD,
-        RESWIZ_DVD,
-        RESWIZ_DVD_HD1,
-        RESWIZ_PSP,
-        RESWIZ_PSP_FULLRES,
-        RESWIZ_IPOD,
-        RESWIZ_IPOD640
-        
-}RESWIZ_FORMAT;
-
-typedef enum 
-{
-        RESWIZ_AR_1_1,
-        RESWIZ_AR_4_3,
-        RESWIZ_AR_16_9
-}RESWIZ_AR;
-
-uint8_t DIA_resizeWiz(RESWIZ_FORMAT *format, RESWIZ_AR *source, RESWIZ_AR *destination);
-
-#endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2010-04-11 09:46:39 UTC (rev 6119)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2010-04-11 10:25:45 UTC (rev 6120)
@@ -150,7 +150,7 @@
 ########################################
 # Our exectuables
 ########################################
-SET(ADM_EXE_SRCS ${ADM_EXE_SRCS} ADM_preview.cpp  gtk_gui.cpp  gui_autodrive.cpp  GUI_jobs.cpp  gui_navigate.cpp  guiplay.cpp  gui_savenew.cpp  main.cpp  gui_action.cpp)
+SET(ADM_EXE_SRCS ${ADM_EXE_SRCS} ADM_preview.cpp  gtk_gui.cpp  GUI_jobs.cpp  gui_navigate.cpp  guiplay.cpp  gui_savenew.cpp  main.cpp  gui_action.cpp)
 
 ADD_EXECUTABLE(avidemux2_cli MACOSX_BUNDLE ${ADM_EXE_SRCS} ${MO_FILES} ${WIN_RES_GTK})
 ADD_TARGET_CFLAGS(avidemux2_cli "-I${CMAKE_BINARY_DIR}/config/cli")

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp	2010-04-11 09:46:39 UTC (rev 6119)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/gtk_gui.cpp	2010-04-11 10:25:45 UTC (rev 6120)
@@ -120,7 +120,6 @@
 static void A_videoCheck( void);
 extern uint8_t parseScript(char *scriptname);
 static void	A_setPostproc( void );
-extern uint8_t ogmSave(const char  *name);
 //
 static uint8_t A_pass(char *name);
 uint8_t A_jumpToTime(uint32_t hh,uint32_t mm,uint32_t ss,uint32_t ms);
@@ -133,7 +132,6 @@
 extern void audioCodecChanged(int newcodec);
 extern void videoCodecChanged(int newcodec);
 extern void DIA_Calculator(uint32_t *sizeInMeg, uint32_t *avgBitrate );
-extern uint8_t A_autoDrive(Action action);
 int ignore_change;
 
 extern uint8_t DIA_ocrGen(void);
@@ -417,16 +415,6 @@
                 admPreview::update(curframe);
                 break;
 
-
-        case ACT_AUTO_VCD:
-        case ACT_AUTO_SVCD:
-        case ACT_AUTO_DVD:
-        case ACT_AUTO_PSP:
-        case ACT_AUTO_IPOD:
-        case ACT_AUTO_FLV:
-        case ACT_AUTO_PSP_H264:
-                A_autoDrive( action);
-                break;
      case ACT_TimeShift:
                 A_TimeShift();
                 break;
@@ -441,18 +429,7 @@
 				DIA_Calculator(&a,&b );
 			}
     			break;
-    case ACT_SaveUnpackedMpeg4:
-      if(GUI_Question(QT_TR_NOOP("This is to be used to undo packed VOP on MPEG-4.\nContinue ?")))
-			{ 
-                          GUI_FileSelWrite (QT_TR_NOOP("Select AVI File to Write"), (SELFILE_CB *)A_SaveUnpackedVop);
-				
-			}
-    			break;
-			
-    case ACT_SaveOGM:
-                        GUI_FileSelWrite (QT_TR_NOOP("Select OGM File to Write"), (SELFILE_CB *)ogmSave);
-    			break;
-				
+
     case ACT_SaveWork:
       GUI_FileSelWrite (QT_TR_NOOP("Select Workbench to Save"), A_saveWorkbench);
 	  UI_refreshCustomMenu();

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/gui_action.names
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/gui_action.names	2010-04-11 09:46:39 UTC (rev 6119)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/gui_action.names	2010-04-11 10:25:45 UTC (rev 6120)
@@ -6,28 +6,15 @@
 ACT(PlayAvi)
 ACT(StopAvi)
 ACT(SaveImg)
-ACT(SaveOGM)
 ACT(SaveJPG)
 ACT(SaveBunchJPG)
-ACT(SaveDVDPS)
-ACT(SaveUnpackedMpeg4)
 ACT(RecentFiles)
 
 ACT(SaveDualAudio)
 ACT(SaveAvi)
 ACT(SaveWave)
-ACT(Pipe2Lame)
-ACT(PipeLame)
-ACT(Pipe2Other)
-
-ACT(SaveMpeg1vcd)
-ACT(SaveMpeg2svcd)
-ACT(SaveMpeg2dvd)
-
 ACT(SaveRaw)
 
-ACT(XVCD)
-
 ACT(SetPostProcessing)
 ACT(NextFrame)
 ACT(Back100Frames)
@@ -91,11 +78,6 @@
 
 ACT(SecondAudioTrack)
 
-ACT(SelectDevOSS)
-ACT(SelectDevDummy)
-ACT(SelectDevArts)
-ACT(SelectDevALSA)
-
 ACT(CutWizard)
 
 ACT(MpegIndex)
@@ -147,14 +129,6 @@
 ACT(RECENTPROJECT4)
 ACT(RECENTPROJECT5)
 
-ACT(AUTO_VCD)
-ACT(AUTO_SVCD)
-ACT(AUTO_DVD)
-ACT(AUTO_PSP)
-ACT(AUTO_PSP_H264)
-ACT(AUTO_IPOD)
-ACT(AUTO_FLV)
-
 ACT(ADD_JOB)
 ACT(HANDLE_JOB)
 ACT(V2V)

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/gui_autodrive.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/gui_autodrive.cpp	2010-04-11 09:46:39 UTC (rev 6119)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/gui_autodrive.cpp	2010-04-11 10:25:45 UTC (rev 6120)
@@ -1,310 +0,0 @@
-/***************************************************************************
-                          gui_navigate.cpp  -  description
-                             -------------------
-
-            GUI Part of get next frame, previous key frame, any frame etc...
-
-    begin                : Fri Apr 12 2002
-    copyright            : (C) 2002 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include "config.h"
-
-#include <math.h>
-
-#include "avi_vars.h"
-#include "ADM_userInterfaces/ADM_commonUI/GUI_ui.h"
-#include "DIA_coreToolkit.h"
-#include "ADM_assert.h"
-
-#include "ADM_audiodevice/audio_out.h"
-#include "ADM_audio/aviaudio.hxx"
-#include "ADM_audiofilter/audioprocess.hxx"
-#include "ADM_audiofilter/audioeng_buildfilters.h"
-#include "gui_action.hxx"
-
-#include "ADM_encoder/adm_encConfig.h"
-#include "ADM_filter/vidVCD.h"
-#include "ADM_encoder/ADM_vidEncode.hxx"
-
-extern void setVideoEncoderSettings (COMPRESSION_MODE mode, uint32_t param,     uint32_t extraConf, uint8_t * extraData);
-
-uint8_t A_autoDrive(Action action)
-{
-  uint32_t fq;
-        //
-        if(!currentaudiostream)
-        {
-          GUI_Error_HIG(QT_TR_NOOP("No audio track"),QT_TR_NOOP( "An audio track is necessary to create such file"));
-                return 0;
-        }
-
-      
-#define PSP_AUDIO_FQ 24000        
-        switch(action)
-        {
-                case ACT_AUTO_IPOD:
-					if(!setIPOD())
-						return 0;
-
-					// Video codec
-
-					if(!videoCodecSelectByName("XVID4")) 
-					{
-						GUI_Error_HIG(QT_TR_NOOP("Codec Error"),QT_TR_NOOP( "Cannot select the MPEG-4 SP codec."));
-						return 0;
-					}
-                    GUI_Info_HIG(ADM_LOG_INFO,"CODE DISABLED","XVID4 PROFILE FOR IPOD");
-					//setIpod_Xvid4Preset();
-					// Set mode & bitrate
-					setVideoEncoderSettings(COMPRESS_CBR,400,0,NULL);
-					// Audio Codec
-					if((currentaudiostream->getInfo()->channels == 2)&& currentaudiostream->getInfo()->encoding == WAV_AAC)
-						audio_setCopyCodec();
-					else
-					{
-						if(audio_selectCodecByTag(WAV_AAC))
-                        {
-                            GUI_Error_HIG(QT_TR_NOOP("Codec Error"),QT_TR_NOOP( "No AAC audio encoder plugin found."));
-                        }else
-                        {
-                            audioFilter_SetBitrate(128);
-
-                            if (currentaudiostream->getInfo()->channels != 2)
-                                setCurrentMixerFromString("STEREO");
-                        }
-					}
-
-                      break;
-//******************************** IPOD *******************************
-                          
-                          
-                          break;
-        		case ACT_AUTO_FLV:
-        			// Check audio is mp3 @ 44.1/22.05/11.025 kHz MP3
-        			if(currentaudiostream)
-        			{
-        				fq=currentaudiostream->getInfo()->frequency;
-        				if(currentaudiostream->getInfo()->encoding==WAV_MP3 && (fq==44100 || fq==22050 || fq==11025))
-        						{
-        	                		audio_setCopyCodec();
-        						}
-        				else
-        				{
-                            if(audio_selectCodecByTag(WAV_MP3))
-                            {
-                                    audioFilter_SetBitrate(128);
-                                    if(!audioSetOption("MP3DisableReservoir",1))
-                                    {
-        					 GUI_Error_HIG(QT_TR_NOOP("Codec Error"),
-        					        QT_TR_NOOP( "The MP3 codec does not allow disabling reservoir.\nInstall lame plugin"));
-
-                                    }
-        					}else
-        					{
-        					 GUI_Error_HIG(QT_TR_NOOP("Codec Error"),
-        					        QT_TR_NOOP( "You don't have LAME!.\nIt is needed to create FLV  video."));
-                             }
-        					 if(fq==44100 || fq==22050 || fq==11025)
-        					         						{}
-        					 else
-        					 {
-        						 audioFilterResample(22050);
-        					 }
-        					 
-        				}
-        			}
-        			// Now video
-        			 if(!videoCodecSelectByName("FLV1")) 
-                    {
-                      GUI_Error_HIG(QT_TR_NOOP("Codec Error"),QT_TR_NOOP( "Cannot select FLV1  codec."));
-                        return 0;
-                    }
-        			break;
-        			
-                case ACT_AUTO_PSP:
-                case ACT_AUTO_PSP_H264:
-                    // Resize
-                  if(action==ACT_AUTO_PSP_H264)
-                  {
-                    if(!setPSPFullRes()) return 0;
-                  }
-                  else
-                  {
-                    if(!setPSP()) return 0;
-                  }
-                    // Video codec
-                    switch(action)
-                    {
-                    case ACT_AUTO_PSP:
-                          {
-                            if(!videoCodecSelectByName("FFMpeg4"))            
-                            {
-                              GUI_Error_HIG(QT_TR_NOOP("Codec Error"),QT_TR_NOOP( "Cannot select mpeg4 sp codec."));
-                                return 0;
-                            }
-                            // Set mode & bitrate 
-                            setVideoEncoderSettings(COMPRESS_CBR,768,0,NULL);
-                            fq=24000;
-                          }
-                          break;
-                    case ACT_AUTO_PSP_H264:
-                    {
-						// FIXME
-/*#ifdef USE_X264
-                          videoCodecSelectByName("X264"); 
-                          setPSP_X264Preset(); 
-                          setVideoEncoderSettings(COMPRESS_CBR,768,0,NULL);
-#endif */
-                          fq=48000;
-                    }
-                    break;
-                    
-                    default:
-                          ADM_assert(0);
-                    }
-                    // Audio Codec
-                    if((currentaudiostream->getInfo()->frequency==fq)&&
-                        (currentaudiostream->getInfo()->channels==2)&&
-                        (currentaudiostream->getInfo()->encoding==WAV_AAC))
-                    {
-                        audio_setCopyCodec();
-                    }
-                    else
-                    {
-
-
-                          if(!audio_selectCodecByTag(WAV_AAC))
-                            GUI_Error_HIG(QT_TR_NOOP("Codec Error"),
-                                        QT_TR_NOOP( "You don't have FAAC!.\nIt is needed to create PSP compatible video."));
-                                    // ? Needed ?
-                          if(currentaudiostream->getInfo()->frequency!=fq)
-                          {
-                              audioFilterResample(fq);
-                          }
-                          audioFilter_SetBitrate(128);
-                      }
-                                break;
-                case ACT_AUTO_VCD:
-                                // Check video size
-                                if(!setVCD()) return 0;
-                                // Set codec
-                                if(!videoCodecSelectByName("VCD"))  return 0;
-                                // Set audio
-                                // Check if it is ok
-                               if((currentaudiostream->getInfo()->frequency==44100)&&
-                                        (currentaudiostream->getInfo()->channels==2)&&
-                                                (currentaudiostream->getInfo()->encoding==WAV_MP2)&&
-                                                        (currentaudiostream->getInfo()->byterate==28000))
-                                {
-                                        audio_setCopyCodec();
-                                }
-                                else
-                                {
-                                        audio_selectCodecByTag(WAV_MP2);
-                                        if(currentaudiostream->getInfo()->frequency!=44100)
-                                        {
-                                                audioFilterResample(44100);
-                                        }
-#warning use mixer!!
-                                        audioFilter_SetBitrate(224);
-                                        if(currentaudiostream->getInfo()->channels!=2)
-                                        {
-                                          setCurrentMixerFromString("DOLBY_PROLOGIC2");
-                                        }else
-                                        {
-                                          setCurrentMixerFromString("NONE");
-                                        }
-                                }
-                                break;
-                case ACT_AUTO_SVCD:
-                                // Check video size
-                                if(!setSVCD()) return 0;
-                                // Set codec
-                                if(!videoCodecSelectByName("XSVCD"))  return 0;
-                                setVideoEncoderSettings (COMPRESS_2PASS_BITRATE,2000,0,NULL);
-                                if((currentaudiostream->getInfo()->frequency==44100)&&
-                                        (currentaudiostream->getInfo()->channels==2)&&
-                                                (currentaudiostream->getInfo()->encoding==WAV_MP2))
-                                {
-                                        audio_setCopyCodec();
-                                }
-                                else
-                                {
-                                        audio_selectCodecByTag(WAV_MP2);
-                                        if(currentaudiostream->getInfo()->frequency!=44100)
-                                        {
-                                                audioFilterResample(44100);
-                                        }
-                                        if(currentaudiostream->getInfo()->channels!=2)
-                                        {
-                                          setCurrentMixerFromString("DOLBY_PROLOGIC2");
-                                        }else
-                                        {
-                                          setCurrentMixerFromString("NONE");
-                                        }
-                                        audioFilter_SetBitrate(160);
-                                }
-                                break;
-                                break;
-
-                case ACT_AUTO_DVD:
-                                // Check video size
-                                if(!setDVD()) return 0;
-                                // Set codec
-                                if(!videoCodecSelectByName("XDVD"))  return 0;
-                                // Set 2 pass, avg bitrate  6 M
-                                setVideoEncoderSettings (COMPRESS_2PASS_BITRATE,6000,0,NULL);
-                                // Set audio
-                                if(currentaudiostream->getInfo()->frequency!=48000
-                                        || (currentaudiostream->getInfo()->encoding!=WAV_MP2 &&
-                                         currentaudiostream->getInfo()->encoding!=WAV_AC3))
-                                {
-                                        audio_selectCodecByTag(WAV_MP2);
-                                        audioFilterResample(48000);
-                                        audioFilter_SetBitrate(160);
-                                        if(currentaudiostream->getInfo()->channels!=2)
-                                        {
-                                          setCurrentMixerFromString("DOLBY_PROLOGIC2");
-                                        }else
-                                        {
-                                          setCurrentMixerFromString("NONE");
-                                        }
-                                }
-                                else
-                                {
-                                        audio_setCopyCodec();
-                                }
-                                break;
-
-        }
-        // Set output format to mpeg PS
-        // Except for PSP
-        switch(action)
-        {
-          case ACT_AUTO_IPOD:
-              UI_SetCurrentFormat(ADM_MP4);
-              break;
-          case ACT_AUTO_PSP:
-          case ACT_AUTO_PSP_H264:
-              UI_SetCurrentFormat(ADM_PSP);
-              break;
-          case ACT_AUTO_FLV:
-        	  UI_SetCurrentFormat(ADM_FLV);
-        	  break;
-          default:
-              UI_SetCurrentFormat(ADM_PS);
-        }
-        return 1;
-}
-//EOF



From gruntster at mail.berlios.de  Sun Apr 11 12:58:25 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 11 Apr 2010 12:58:25 +0200
Subject: [Avidemux-svn-commit] r6121 - in
	branches/avidemux_2.5_branch_gruntster/cmake: . patches
Message-ID: <201004111058.o3BAwPqq029912@sheep.berlios.de>

Author: gruntster
Date: 2010-04-11 12:58:16 +0200 (Sun, 11 Apr 2010)
New Revision: 6121

Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch
Log:
[ffmpeg] update FFmpeg to r22831 & libswscale to r31028

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2010-04-11 10:25:45 UTC (rev 6120)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2010-04-11 10:58:16 UTC (rev 6121)
@@ -1,7 +1,7 @@
 include(admFFmpegUtil)
 
-set(FFMPEG_VERSION 22703)	# http://git.ffmpeg.org/?p=ffmpeg;a=snapshot;h=bb116bdcfc2d1059af8475e861c6998c688cb55b;sf=tgz
-set(SWSCALE_VERSION 30970)	# http://git.ffmpeg.org/?p=libswscale;a=snapshot;h=efc190382dc560b47ab559ff6ecdce77dbc0c1e7;sf=tgz
+set(FFMPEG_VERSION 22831)	# http://git.ffmpeg.org/?p=ffmpeg;a=snapshot;h=887b9ab184ed849001bbf9c5bad60d52d92e688c;sf=tgz
+set(SWSCALE_VERSION 31028)	# http://git.ffmpeg.org/?p=libswscale;a=snapshot;h=a9639b0b6c96c6b0c30ec1ef6f737f1204a2697a;sf=tgz
 
 set(LIBRARY_SOURCE_DIR "${CMAKE_SOURCE_DIR}/avidemux/ADM_libraries")
 set(FFMPEG_SOURCE_DIR "${LIBRARY_SOURCE_DIR}/ffmpeg")

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2010-04-11 10:25:45 UTC (rev 6120)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2010-04-11 10:58:16 UTC (rev 6121)
@@ -1,8 +1,8 @@
-*** libavcodec/avcodec.h.old	Sat Mar 27 20:05:32 2010
---- libavcodec/avcodec.h	Sat Mar 27 20:05:32 2010
+*** libavcodec/avcodec.h.old	Sun Apr 11 11:34:06 2010
+--- libavcodec/avcodec.h	Sun Apr 11 11:34:06 2010
 ***************
-*** 594,599 ****
---- 594,601 ----
+*** 597,602 ****
+--- 597,604 ----
   #define CODEC_FLAG2_MBTREE        0x00040000 ///< Use macroblock tree ratecontrol (x264 only)
   #define CODEC_FLAG2_PSY           0x00080000 ///< Use psycho visual optimizations.
   #define CODEC_FLAG2_SSIM          0x00100000 ///< Compute SSIM during encoding, error[] values are undefined.
@@ -12,8 +12,8 @@
   /* Unsupported options :
    *              Syntax Arithmetic coding (SAC)
 ***************
-*** 1464,1469 ****
---- 1466,1472 ----
+*** 1467,1472 ****
+--- 1469,1475 ----
        * - decoding: unused
        */
       int rc_max_rate;
@@ -22,8 +22,8 @@
       /**
        * minimum bitrate
 ***************
-*** 1478,1483 ****
---- 1481,1488 ----
+*** 1481,1486 ****
+--- 1484,1491 ----
        * - decoding: unused
        */
       int rc_buffer_size;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch	2010-04-11 10:25:45 UTC (rev 6120)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch	2010-04-11 10:58:16 UTC (rev 6121)
@@ -1,13 +1,13 @@
-*** libavcodec/ffv1.c.old	Sat Mar 27 20:05:33 2010
---- libavcodec/ffv1.c	Sat Mar 27 20:05:33 2010
+*** libavcodec/ffv1.c.old	Sun Apr 11 11:34:07 2010
+--- libavcodec/ffv1.c	Sun Apr 11 11:34:07 2010
 ***************
-*** 1070,1075 ****
---- 1070,1077 ----
+*** 1107,1112 ****
+--- 1107,1114 ----
           clear_state(f);
       }else{
           p->key_frame= 0;
 +          p->pict_type= FF_P_TYPE; // MEANX : looks more like a P to me as user
 + 
       }
-      if(!f->plane[0].state && !f->plane[0].vlc_state)
-          return -1;
+      if(f->ac>1){
+          int i;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2010-04-11 10:25:45 UTC (rev 6120)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2010-04-11 10:58:16 UTC (rev 6121)
@@ -1,8 +1,8 @@
-*** libavcodec/h264.c.old	Sat Mar 27 20:05:35 2010
---- libavcodec/h264.c	Sat Mar 27 20:05:35 2010
+*** libavcodec/h264.c.old	Sun Apr 11 11:34:08 2010
+--- libavcodec/h264.c	Sun Apr 11 11:34:08 2010
 ***************
-*** 3116,3121 ****
---- 3116,3134 ----
+*** 3146,3151 ****
+--- 3146,3164 ----
       return 0;
   }
   

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2010-04-11 10:25:45 UTC (rev 6120)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2010-04-11 10:58:16 UTC (rev 6121)
@@ -1,8 +1,8 @@
-*** libavcodec/utils.c.old	Sat Mar 27 20:05:41 2010
---- libavcodec/utils.c	Sat Mar 27 20:05:41 2010
+*** libavcodec/utils.c.old	Sun Apr 11 11:34:10 2010
+--- libavcodec/utils.c	Sun Apr 11 11:34:10 2010
 ***************
-*** 638,647 ****
---- 638,649 ----
+*** 643,652 ****
+--- 643,654 ----
   
       if((avctx->codec->capabilities & CODEC_CAP_DELAY) || avpkt->size){
           //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
@@ -16,7 +16,7 @@
           *frame_size_ptr < avctx->channels * avctx->frame_size * sizeof(int16_t)){
               av_log(avctx, AV_LOG_ERROR, "buffer %d too small\n", *frame_size_ptr);
 ***************
-*** 1080,1086 ****
+*** 1085,1091 ****
           return -1;
       }
   #if !HAVE_MKSTEMP
@@ -24,7 +24,7 @@
   #else
       snprintf(*filename, len, "/tmp/%sXXXXXX", prefix);
       fd = mkstemp(*filename);
---- 1082,1088 ----
+--- 1087,1093 ----
           return -1;
       }
   #if !HAVE_MKSTEMP

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch	2010-04-11 10:25:45 UTC (rev 6120)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch	2010-04-11 10:58:16 UTC (rev 6121)
@@ -1,8 +1,8 @@
-*** libavformat/file.c.old	Sat Mar 27 20:05:42 2010
---- libavformat/file.c	Sat Mar 27 20:05:42 2010
+*** libavformat/file.c.old	Sun Apr 11 11:34:11 2010
+--- libavformat/file.c	Sun Apr 11 11:34:11 2010
 ***************
-*** 30,35 ****
---- 30,104 ----
+*** 31,36 ****
+--- 31,105 ----
   #include <stdlib.h>
   #include "os_support.h"
   



From gruntster at mail.berlios.de  Sun Apr 11 21:12:03 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 11 Apr 2010 21:12:03 +0200
Subject: [Avidemux-svn-commit] r6122 -
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec
Message-ID: <201004111912.o3BJC3ie009324@sheep.berlios.de>

Author: gruntster
Date: 2010-04-11 21:11:58 +0200 (Sun, 11 Apr 2010)
New Revision: 6122

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/encoder.cpp
Log:
[avcodec] correctly flush encoder

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/encoder.cpp	2010-04-11 10:58:16 UTC (rev 6121)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/encoder.cpp	2010-04-11 19:11:58 UTC (rev 6122)
@@ -358,31 +358,28 @@
 	_frame.key_frame = 0;
 	_frame.pict_type = 0;
 
-	if (encodeParams->frameData[0])
+	if (_supportedCsps[0] == ADM_CSP_YV12)
 	{
-		if (_supportedCsps[0] == ADM_CSP_YV12)
-		{
-			// Swap planes so YV12 looks like YUV420P
-			uint8_t *tmpPlane = encodeParams->frameData[1];
+		// Swap planes so YV12 looks like YUV420P
+		uint8_t *tmpPlane = encodeParams->frameData[1];
 
-			encodeParams->frameData[1] = encodeParams->frameData[2];
-			encodeParams->frameData[2] = tmpPlane;
-		}
+		encodeParams->frameData[1] = encodeParams->frameData[2];
+		encodeParams->frameData[2] = tmpPlane;
+	}
 
-		_frame.data[0] = encodeParams->frameData[0];
-		_frame.data[1] = encodeParams->frameData[1];
-		_frame.data[2] = encodeParams->frameData[2];
-		_frame.linesize[0] = encodeParams->frameLineSize[0];
-		_frame.linesize[1] = encodeParams->frameLineSize[1];
-		_frame.linesize[2] = encodeParams->frameLineSize[2];
+	_frame.data[0] = encodeParams->frameData[0];
+	_frame.data[1] = encodeParams->frameData[1];
+	_frame.data[2] = encodeParams->frameData[2];
+	_frame.linesize[0] = encodeParams->frameLineSize[0];
+	_frame.linesize[1] = encodeParams->frameLineSize[1];
+	_frame.linesize[2] = encodeParams->frameLineSize[2];
 
-		int size = avcodec_encode_video(_context, _buffer, _bufferSize, &_frame);
+	int size = avcodec_encode_video(_context, _buffer, _bufferSize, _frame.data[0] == NULL ? NULL : &_frame);
 
-		if (size < 0)
-			return ADM_VIDENC_ERR_FAILED;
+	if (size < 0)
+		return ADM_VIDENC_ERR_FAILED;
 
-		updateEncodeParameters(encodeParams, _buffer, size);
-	}
+	updateEncodeParameters(encodeParams, _buffer, size);
 
 	return ADM_VIDENC_ERR_SUCCESS;
 }



From gruntster at mail.berlios.de  Sun Apr 11 21:27:37 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 11 Apr 2010 21:27:37 +0200
Subject: [Avidemux-svn-commit] r6123 - in
	branches/avidemux_2.5_branch_gruntster: cmake
	plugins/ADM_audioDevices/Jack
Message-ID: <201004111927.o3BJRbX6010357@sheep.berlios.de>

Author: gruntster
Date: 2010-04-11 21:27:32 +0200 (Sun, 11 Apr 2010)
New Revision: 6123

Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioDeviceLibs.cmake
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Jack/CMakeLists.txt
Log:
[jack] use bundled secret rabbit code for JACK audio device plugin

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioDeviceLibs.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioDeviceLibs.cmake	2010-04-11 19:11:58 UTC (rev 6122)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioDeviceLibs.cmake	2010-04-11 19:27:32 UTC (rev 6123)
@@ -103,23 +103,6 @@
 ENDIF (UNIX)
 
 ########################################
-# Secret Rabbit Code
-########################################
-IF (JACK_FOUND)
-	MESSAGE(STATUS "Checking for Secret Rabbit Code")
-	MESSAGE(STATUS "*******************************")
-
-	FIND_HEADER_AND_LIB(SRC samplerate.h samplerate src_get_version)
-	PRINT_LIBRARY_INFO("Secret Rabbit Code" SRC_FOUND "${SRC_INCLUDE_DIR}" "${SRC_LIBRARY_DIR}")
-
-	IF (SRC_FOUND)
-		SET(USE_SRC 1)
-	ENDIF (SRC_FOUND)
-
-	MESSAGE("")
-ENDIF (JACK_FOUND)
-
-########################################
 # OSS
 ########################################
 IF (UNIX AND NOT APPLE)
@@ -143,14 +126,15 @@
 ELSE (UNIX AND NOT APPLE)
 	SET(OSS_CAPABLE FALSE)
 ENDIF (UNIX AND NOT APPLE)
+
 ########################################
 # PulseAudioSimple
 ########################################
 IF (UNIX AND NOT APPLE)
 	OPTION(PULSEAUDIOSIMPLE "" ON)
 
-	MESSAGE(STATUS "Checking for PULSEAUDIOSIMPLE")
-	MESSAGE(STATUS "*****************************")
+	MESSAGE(STATUS "Checking for PulseAudio Simple")
+	MESSAGE(STATUS "******************************")
         IF (PULSEAUDIOSIMPLE_INCLUDE_DIR AND PULSEAUDIOSIMPLE_LIBRARIES)
         # in cache already
          SET(PULSEAUDIOSIMPLE_FIND_QUIETLY TRUE)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Jack/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Jack/CMakeLists.txt	2010-04-11 19:11:58 UTC (rev 6122)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioDevices/Jack/CMakeLists.txt	2010-04-11 19:27:32 UTC (rev 6123)
@@ -1,11 +1,11 @@
 INCLUDE(av_plugin)
 
-
 SET(ADM_av_jack_SRCS ADM_deviceJack.cpp)
 
+add_definitions(-DUSE_SRC)
 ADD_LIBRARY(ADM_av_jack SHARED ${ADM_av_jack_SRCS})
 TARGET_LINK_LIBRARIES(ADM_av_jack ${JACK_LIBRARY_DIR})
-include_directories(${JACK_INCLUDE_DIR})
+include_directories("${JACK_INCLUDE_DIR}" "${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_coreAudio/src/ADM_libsamplerate")
 
 INIT_AUDIO_DEVICE(ADM_av_jack)
 INSTALL_AUDIODEVICE(ADM_av_jack)



From gruntster at mail.berlios.de  Sun Apr 11 22:51:30 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 11 Apr 2010 22:51:30 +0200
Subject: [Avidemux-svn-commit] r6124 - in
	branches/avidemux_2.5_branch_gruntster: cmake
	plugins/ADM_audioEncoders
Message-ID: <201004112051.o3BKpUoX015818@sheep.berlios.de>

Author: gruntster
Date: 2010-04-11 22:51:24 +0200 (Sun, 11 Apr 2010)
New Revision: 6124

Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioDeviceLibs.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioEncoderLibs.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admCheckVorbisDec.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/admPluginConfigSummary.cmake
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/CMakeLists.txt
Log:
[cmake] enhance configure summary

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioDeviceLibs.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioDeviceLibs.cmake	2010-04-11 19:27:32 UTC (rev 6123)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioDeviceLibs.cmake	2010-04-11 20:51:24 UTC (rev 6124)
@@ -18,6 +18,8 @@
 
 			SET(USE_ALSA 1)
 		ENDIF (ALSA_FOUND)
+		
+		SET(ENV{ADM_HAVE_ALSA} ${ALSA_FOUND})
 	ELSE (ALSA)
 		MESSAGE("${MSG_DISABLE_OPTION}")
 	ENDIF (ALSA)
@@ -43,6 +45,8 @@
 		IF (ARTS_FOUND)
 			SET(USE_ARTS 1)
 		ENDIF (ARTS_FOUND)
+		
+		SET(ENV{ADM_HAVE_ARTS} ${ARTS_FOUND})
 	ELSE (ARTS)
 		MESSAGE("${MSG_DISABLE_OPTION}")
 	ENDIF (ARTS)
@@ -68,6 +72,8 @@
 		IF (ESD_FOUND)
 			SET(USE_ESD 1)
 		ENDIF (ESD_FOUND)
+		
+		SET(ENV{ADM_HAVE_ESD} ${ESD_FOUND})
 	ELSE (ESD)
 		MESSAGE("${MSG_DISABLE_OPTION}")
 	ENDIF (ESD)
@@ -93,6 +99,8 @@
 		IF (JACK_FOUND)
 			SET(USE_JACK 1)
 		ENDIF (JACK_FOUND)
+		
+		SET(ENV{ADM_HAVE_JACK} ${JACK_FOUND})
 	ELSE (JACK)
 		MESSAGE("${MSG_DISABLE_OPTION}")
 	ENDIF (JACK)
@@ -118,6 +126,8 @@
 		IF (OSS_FOUND)
 			SET(USE_OSS 1)
 		ENDIF (OSS_FOUND)
+		
+		SET(ENV{ADM_HAVE_OSS} ${OSS_FOUND})
 	ELSE (OSS)
 		MESSAGE("${MSG_DISABLE_OPTION}")
 	ENDIF (OSS)
@@ -172,8 +182,10 @@
          MESSAGE(STATUS "Could NOT find PulseAudioSimple")
         ENDIF (PULSEAUDIOSIMPLE_FOUND)
 
+		SET(ENV{ADM_HAVE_PULSEAUDIO} ${PULSEAUDIOSIMPLE_FOUND})
         MARK_AS_ADVANCED(PULSEAUDIOSIMPLE_INCLUDE_DIR PULSEAUDIOSIMPLE_LIBRARIES)
 
+		MESSAGE("")
 ELSE (UNIX AND NOT APPLE)
 	SET(PULSEAUDIOSIMPLE_CAPABLE FALSE)
 ENDIF (UNIX AND NOT APPLE)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioEncoderLibs.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioEncoderLibs.cmake	2010-04-11 19:27:32 UTC (rev 6123)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admCheckAudioEncoderLibs.cmake	2010-04-11 20:51:24 UTC (rev 6124)
@@ -36,6 +36,8 @@
 			MESSAGE(STATUS "Warning: Unable to determine Aften version - support for Aften will be turned off ${AFTEN_TEST_RUN_RESULT}")
 			SET(USE_AFTEN 0)
 		ENDIF (AFTEN_TEST_RUN_RESULT EQUAL 99)
+		
+		SET(ENV{ADM_HAVE_AFTEN} ${USE_AFTEN})
 	ENDIF (AFTEN_FOUND)
 ELSE (AFTEN)
 	MESSAGE("${MSG_DISABLE_OPTION}")
@@ -62,6 +64,8 @@
 	IF (LAME_FOUND)
 		SET(USE_LAME 1)
 	ENDIF (LAME_FOUND)
+	
+	SET(ENV{ADM_HAVE_LAME} ${LAME_FOUND})
 ELSE (LAME)
 	MESSAGE("${MSG_DISABLE_OPTION}")
 ENDIF (LAME)
@@ -84,6 +88,8 @@
 	IF (FAAC_FOUND)
 		SET(USE_FAAC 1)
 	ENDIF (FAAC_FOUND)
+	
+	SET(ENV{ADM_HAVE_FAAC} ${FAAC_FOUND})
 ELSE (FAAC)
 	MESSAGE("${MSG_DISABLE_OPTION}")
 ENDIF (FAAC)
@@ -95,8 +101,8 @@
 ########################################
 OPTION(VORBIS "" ON)
 
-MESSAGE(STATUS "Checking for Vorbis")
-MESSAGE(STATUS "*******************")
+MESSAGE(STATUS "Checking for Vorbis Encoder")
+MESSAGE(STATUS "***************************")
 
 IF (VORBIS)
 	FIND_HEADER_AND_LIB(VORBIS vorbis/vorbisenc.h vorbis vorbis_info_init)
@@ -108,7 +114,9 @@
 		SET(VORBIS_FOUND 0 CACHE INTERNAL "")
 	ENDIF (VORBIS_FOUND AND VORBISENC_FOUND)
 
-	PRINT_LIBRARY_INFO("Vorbis" VORBIS_FOUND "${VORBIS_INCLUDE_DIR}" "${VORBIS_LIBRARY_DIR} ${VORBISENC_LIBRARY_DIR}")
+	SET(ENV{ADM_HAVE_VORBIS_ENC} ${VORBIS_FOUND})
+
+	PRINT_LIBRARY_INFO("Vorbis Encoder" VORBIS_FOUND "${VORBIS_INCLUDE_DIR}" "${VORBIS_LIBRARY_DIR} ${VORBISENC_LIBRARY_DIR}")
 ELSE (VORBIS)
 	MESSAGE("${MSG_DISABLE_OPTION}")
 ENDIF (VORBIS)

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admCheckVorbisDec.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admCheckVorbisDec.cmake	2010-04-11 19:27:32 UTC (rev 6123)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admCheckVorbisDec.cmake	2010-04-11 20:51:24 UTC (rev 6124)
@@ -5,15 +5,14 @@
 	IF (NOT LIBVORBIS_CHECKED)
 		OPTION(LIBVORBIS "" ON)
 
-		MESSAGE(STATUS "Checking for LIBVORBIS")
-		MESSAGE(STATUS "*******************")
+		MESSAGE(STATUS "Checking for Vorbis Decoder")
+		MESSAGE(STATUS "***************************")
 
 		IF (LIBVORBIS)
 			IF (UNIX)
 				SET(LIBVORBIS_REQUIRED_FLAGS "-lm")
 			ENDIF (UNIX)
 
-
 			FIND_HEADER_AND_LIB(LIBVORBIS vorbis/codec.h vorbis vorbis_synthesis_init ${LIBVORBIS_REQUIRED_FLAGS})
 
 			IF (LIBVORBIS_FOUND)
@@ -23,11 +22,12 @@
 				SET(LIBVORBIS_LIBRARY_DIR "${LIBVORBIS_LIBRARY_DIR}")
 			ENDIF (LIBVORBIS_FOUND)
 
-			PRINT_LIBRARY_INFO("LIBVORBIS" LIBVORBIS_FOUND "${LIBVORBIS_INCLUDE_DIR}" "${LIBVORBIS_LIBRARY_DIR}")
+			PRINT_LIBRARY_INFO("Vorbis Decoder" LIBVORBIS_FOUND "${LIBVORBIS_INCLUDE_DIR}" "${LIBVORBIS_LIBRARY_DIR}")
 		ELSE (LIBVORBIS)
 			MESSAGE("${MSG_DISABLE_OPTION}")
 		ENDIF (LIBVORBIS)
 
+		SET(ENV{ADM_HAVE_VORBIS_DEC} ${LIBVORBIS_FOUND})
 		SET(LIBVORBIS_CHECKED 1)
 
 		MESSAGE("")

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admPluginConfigSummary.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admPluginConfigSummary.cmake	2010-04-11 19:27:32 UTC (rev 6123)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admPluginConfigSummary.cmake	2010-04-11 20:51:24 UTC (rev 6124)
@@ -25,10 +25,32 @@
 ADM_DISPLAY("Xvid          " "$ENV{ADM_HAVE_XVID}")
 
 MESSAGE("***    Audio Codec    ***")
+ADM_DISPLAY("Aften         " "$ENV{ADM_HAVE_AFTEN}")
+ADM_DISPLAY("FAAC          " "$ENV{ADM_HAVE_FAAC}")
 ADM_DISPLAY("FAAD          " "$ENV{ADM_HAVE_FAAD}")
+ADM_DISPLAY("LAME          " "$ENV{ADM_HAVE_LAME}")
 ADM_DISPLAY("opencore-amrnb" "$ENV{ADM_HAVE_OPENCORE_AMRNB}")
 ADM_DISPLAY("opencore-amrwb" "$ENV{ADM_HAVE_OPENCORE_AMRWB}")
+ADM_DISPLAY("Vorbis Decoder" "$ENV{ADM_HAVE_VORBIS_DEC}")
+ADM_DISPLAY("Vorbis Encoder" "$ENV{ADM_HAVE_VORBIS_ENC}")
 
+IF (UNIX)
+	MESSAGE("***   Audio Devices   ***")
+	
+IF (NOT APPLE)
+	ADM_DISPLAY("ALSA          " "$ENV{ADM_HAVE_ALSA}")
+ENDIF (NOT APPLE)
+
+	ADM_DISPLAY("aRts          " "$ENV{ADM_HAVE_ARTS}")
+	ADM_DISPLAY("ESD           " "$ENV{ADM_HAVE_ESD}")
+	ADM_DISPLAY("JACK          " "$ENV{ADM_HAVE_JACK}")
+	
+IF (NOT APPLE)
+	ADM_DISPLAY("OSS           " "$ENV{ADM_HAVE_OSS}")
+	ADM_DISPLAY("PulseAudio    " "$ENV{ADM_HAVE_PULSEAUDIO}")
+ENDIF (NOT APPLE)
+ENDIF (UNIX)
+
 MESSAGE("***   Miscellaneous   ***")
 ADM_DISPLAY("FontConfig    " "$ENV{ADM_HAVE_FONTCONFIG}")
 ADM_DISPLAY("FreeType2     " "${FREETYPE2_FOUND}")

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/CMakeLists.txt	2010-04-11 19:27:32 UTC (rev 6123)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_audioEncoders/CMakeLists.txt	2010-04-11 20:51:24 UTC (rev 6124)
@@ -1,14 +1,7 @@
 #######################################
 include (admCheckAudioEncoderLibs)
 include (admConfigSummary)
-MESSAGE("***  Audio Codec  ***")
-ADM_DISPLAY("Aften     " "${USE_AFTEN}")
-ADM_DISPLAY("LAME      " "${USE_LAME}")
-ADM_DISPLAY("FAAC      " "${USE_FAAC}")
-ADM_DISPLAY("Vorbis    " "${USE_VORBIS}")
-MESSAGE("***  /Audio Codec  ***")
 
-
 ADD_SUBDIRECTORY(twolame)
 ADD_SUBDIRECTORY(pcm)
 ADD_SUBDIRECTORY(lavcodec)



From gruntster at mail.berlios.de  Tue Apr 13 19:53:24 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 13 Apr 2010 19:53:24 +0200
Subject: [Avidemux-svn-commit] r6125 -
	branches/avidemux_2.5_branch_gruntster/avidemux
Message-ID: <201004131753.o3DHrODN024230@sheep.berlios.de>

Author: gruntster
Date: 2010-04-13 19:53:20 +0200 (Tue, 13 Apr 2010)
New Revision: 6125

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
Log:
[Qt] rename main Qt executable on Win32 and Apple

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2010-04-11 20:51:24 UTC (rev 6124)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2010-04-13 17:53:20 UTC (rev 6125)
@@ -164,6 +164,11 @@
 
 IF (ADM_UI_QT4)
 	ADD_EXECUTABLE(avidemux2_qt4 MACOSX_BUNDLE ${ADM_EXE_SRCS} ${QM_FILES} ${WIN_RES_QT})
+	
+	IF (WIN32 OR APPLE)
+		set_property(TARGET avidemux2_qt4 PROPERTY OUTPUT_NAME avidemux2)
+	ENDIF (WIN32 OR APPLE)
+	
 	ADD_TARGET_CFLAGS(avidemux2_qt4 "-I${CMAKE_BINARY_DIR}/config/qt4")
 	ADD_DEPENDENCIES(avidemux2_qt4 qmfiles  ffmpeg)
 ENDIF (ADM_UI_QT4)



From gruntster at mail.berlios.de  Tue Apr 13 20:43:14 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 13 Apr 2010 20:43:14 +0200
Subject: [Avidemux-svn-commit] r6126 - in
	branches/avidemux_2.5_branch_gruntster: cmake
	platforms/windows/build_scripts/avidemux platforms/windows/installer
Message-ID: <201004131843.o3DIhEgf027140@sheep.berlios.de>

Author: gruntster
Date: 2010-04-13 20:43:08 +0200 (Tue, 13 Apr 2010)
New Revision: 6126

Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admWin32.rc.in
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2b. Package Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Package Notes.xml
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Set Avidemux Environment Variables.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/installer/avidemux.nsi
Log:
[win32] bundle less in zip and update nsis with new exe name

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admWin32.rc.in
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admWin32.rc.in	2010-04-13 17:53:20 UTC (rev 6125)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admWin32.rc.in	2010-04-13 18:43:08 UTC (rev 6126)
@@ -15,7 +15,7 @@
             VALUE "FileDescription",  "Avidemux ${PRODUCTVERSION_STRING}"
             VALUE "FileVersion",      "${FILEVERSION_STRING}"
             VALUE "InternalName",     "avidemux"
-            VALUE "LegalCopyright",   "Copyright ? 2001-2009 Free Software Foundation"
+            VALUE "LegalCopyright",   "Copyright ? 2001-2010 Free Software Foundation"
             VALUE "OriginalFilename", ""
             VALUE "ProductName",      "Avidemux"
             VALUE "ProductVersion",   "${PRODUCTVERSION_STRING}"

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2b. Package Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2b. Package Build.bat	2010-04-13 17:53:20 UTC (rev 6125)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2b. Package Build.bat	2010-04-13 18:43:08 UTC (rev 6126)
@@ -7,7 +7,8 @@
 cd ..
 
 set curDir=%CD%
-set zipFile=avidemux_2.5_r%revisionNo%_full_win%BuildBits%.zip
+set baseFile=avidemux_2.5_r%revisionNo%_win%BuildBits%
+set zipFile=%baseFile%.zip
 set packageDir=%CD%\%revisionNo%
 
 echo %packageDir%
@@ -18,14 +19,25 @@
 copy "%sourceDir%\po\avidemux.pot" "%packageDir%"
 
 cd %buildDir%
-zip -r "%packageDir%\%zipFile%" *
-cd %curDir%
-advzip -z -4 "%packageDir%\%zipFile%"
-
-cd %buildDir%
 echo -- Generating GTK+ Installer --
 "%nsisDir%\makensis" /V2 /NOCD /DINST_GTK /DBUILD_BITS=%BuildBits% /DNSIDIR="%curDir%\..\..\installer" /DEXEDIR="%packageDir%" "%curDir%\..\..\installer\avidemux.nsi"
 echo -- Generating Qt Installer --
 "%nsisDir%\makensis" /V2 /NOCD /DINST_QT /DBUILD_BITS=%BuildBits% /DNSIDIR="%curDir%\..\..\installer" /DEXEDIR="%packageDir%" "%curDir%\..\..\installer\avidemux.nsi"
 
+mkdir "%packageDir%\temp"
+cd "%packageDir%\temp"
+"%SevenZipDir%\7z" x "%packageDir%\%baseFile%.exe"
+rmdir /s/q $PLUGINSDIR
+mkdir scripts
+move $_OUTDIR\auto scripts
+move $_OUTDIR\video scripts
+mkdir etc\fonts\conf.d
+copy "%buildDir%\etc\fonts\conf.d" etc\fonts\conf.d\
+move $_OUTDIR\conf.avail etc\fonts
+rmdir /s/q $_OUTDIR
+zip -r "%packageDir%\%zipFile%" *
+cd %curDir%
+advzip -z -4 "%packageDir%\%zipFile%"
+rmdir /s/q "%packageDir%\temp"
+
 pause

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Package Notes.xml
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Package Notes.xml	2010-04-13 17:53:20 UTC (rev 6125)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Package Notes.xml	2010-04-13 18:43:08 UTC (rev 6126)
@@ -1,5 +1,17 @@
 <?xml version="1.0"?>
 <log>
+  <buildentry revision="6121" date="2010-04-11">
+    <comment>Updated ATK to version 1.30.0-1.</comment>
+    <comment>Updated Cairo to version 1.8.10-3.</comment>
+    <comment>Updated GLib to version 2.24.0-2.</comment>
+    <comment>Updated GTK+ to version 2.20.0-1.</comment>
+    <comment>Updated Libxml2 to version 2.7.7-1.</comment>
+    <comment>Updated Pango to version 1.28.0-1.</comment>
+    <comment>Updated x264 to r1523.</comment>
+    <comment>Updated zlib to version 1.2.4-2.</comment>
+  </buildentry>
+  <buildentry revision="6083" date="2010-04-06">
+  </buildentry>
   <buildentry revision="6064" date="2010-04-05">
     <comment>Updated x264 to r1510.</comment>
   </buildentry>

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Set Avidemux Environment Variables.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Set Avidemux Environment Variables.bat	2010-04-13 17:53:20 UTC (rev 6125)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Set Avidemux Environment Variables.bat	2010-04-13 18:43:08 UTC (rev 6126)
@@ -26,6 +26,13 @@
 	goto error
 )
 
+if exist "%ProgramFiles32%\7-zip" (
+	set SevenZipDir=%ProgramFiles32%\7-zip
+) else (
+	echo 7-zip could not be found.  Please download from http://www.7-zip.org
+	goto error
+)
+
 if "%BuildBits%" == "32" (set buildFolder=build)
 if "%BuildBits%" == "64" (set buildFolder=build64)
 

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/installer/avidemux.nsi
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/installer/avidemux.nsi	2010-04-13 17:53:20 UTC (rev 6125)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/installer/avidemux.nsi	2010-04-13 18:43:08 UTC (rev 6126)
@@ -365,7 +365,7 @@
         SetOutPath $INSTDIR
         SetOverwrite on
         ${File} QtGui4.dll
-        ${File} avidemux2_qt4.exe
+        ${File} avidemux2.exe
         ${File} libADM_render_qt4.dll
         ${File} libADM_UIQT4.dll
         ${File} QtCore4.dll
@@ -1340,7 +1340,7 @@
     CreateDirectory $SMPROGRAMS\$StartMenuGroup
     !insertmacro MUI_STARTMENU_WRITE_BEGIN Application
     SetOutPath $INSTDIR
-    CreateShortcut "$SMPROGRAMS\$StartMenuGroup\${DISPLAYNAME}.lnk" $INSTDIR\avidemux2_qt4.exe
+    CreateShortcut "$SMPROGRAMS\$StartMenuGroup\${DISPLAYNAME}.lnk" $INSTDIR\avidemux2.exe
     !insertmacro MUI_STARTMENU_WRITE_END
 !endif
 ${MementoSectionEnd}
@@ -1363,7 +1363,7 @@
 ${MementoSection} "-Quick Launch Qt" SecQuickLaunchQt
 !ifdef INST_QT
     SetOutPath $INSTDIR
-    CreateShortcut "$QUICKLAUNCH\${DISPLAYNAME}.lnk" $INSTDIR\avidemux2_qt4.exe
+    CreateShortcut "$QUICKLAUNCH\${DISPLAYNAME}.lnk" $INSTDIR\avidemux2.exe
 !endif
 ${MementoSectionEnd}
 
@@ -1377,7 +1377,7 @@
 ${MementoSection} "-Desktop Qt" SecDesktopQt
 !ifdef INST_QT
     SetOutPath $INSTDIR
-    CreateShortcut "$DESKTOP\${DISPLAYNAME}.lnk" $INSTDIR\avidemux2_qt4.exe
+    CreateShortcut "$DESKTOP\${DISPLAYNAME}.lnk" $INSTDIR\avidemux2.exe
 !endif
 ${MementoSectionEnd}
 
@@ -1714,7 +1714,7 @@
     IntOp $0 $0 & ${SF_SELECTED}
 
     StrCmp $0 ${SF_SELECTED} 0 GTK
-        Exec "$INSTDIR\avidemux2_qt4.exe"
+        Exec "$INSTDIR\avidemux2.exe"
 
     Goto end
 GTK:



From mean at mail.berlios.de  Thu Apr 15 19:50:43 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 15 Apr 2010 19:50:43 +0200
Subject: [Avidemux-svn-commit] r6127 -
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss
Message-ID: <201004151750.o3FHohqj031642@sheep.berlios.de>

Author: mean
Date: 2010-04-15 19:50:42 +0200 (Thu, 15 Apr 2010)
New Revision: 6127

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass.c
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass_fontconfig.c
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass_parse.c
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass_render.c
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass_strtod.c
Log:
[Ass] update by erunamo

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass.c	2010-04-13 18:43:08 UTC (rev 6126)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass.c	2010-04-15 17:50:42 UTC (rev 6127)
@@ -38,6 +38,8 @@
 #include "ass_utils.h"
 #include "ass_library.h"
 
+#define ass_atof(STR) (ass_strtod((STR),NULL))
+
 typedef enum {
     PST_UNKNOWN = 0,
     PST_INFO,
@@ -250,7 +252,7 @@
 		ass_msg(track->library, MSGL_DBG2, "%s = %s", #name, token);
 
 #define INTVAL(name) ANYVAL(name,atoi)
-#define FPVAL(name) ANYVAL(name,atof)
+#define FPVAL(name) ANYVAL(name,ass_atof)
 #define TIMEVAL(name) \
 	} else if (strcasecmp(tname, #name) == 0) { \
 		target->name = string2timecode(track->library, token); \
@@ -384,7 +386,7 @@
         else if (!strcasecmp(*fs, "PlayResY"))
             track->PlayResY = atoi(token);
         else if (!strcasecmp(*fs, "Timer"))
-            track->Timer = atof(token);
+            track->Timer = ass_atof(token);
         else if (!strcasecmp(*fs, "WrapStyle"))
             track->WrapStyle = atoi(token);
         else if (!strcasecmp(*fs, "ScaledBorderAndShadow"))
@@ -568,7 +570,7 @@
     } else if (!strncmp(str, "PlayResY:", 9)) {
         track->PlayResY = atoi(str + 9);
     } else if (!strncmp(str, "Timer:", 6)) {
-        track->Timer = atof(str + 6);
+        track->Timer = ass_atof(str + 6);
     } else if (!strncmp(str, "WrapStyle:", 10)) {
         track->WrapStyle = atoi(str + 10);
     } else if (!strncmp(str, "ScaledBorderAndShadow:", 22)) {
@@ -1019,14 +1021,6 @@
     sz = ftell(fp);
     rewind(fp);
 
-    if (sz > 10 * 1024 * 1024) {
-        ass_msg(library, MSGL_INFO,
-               "ass_read_file(%s): Refusing to load subtitles "
-               "larger than 10MiB", fname);
-        fclose(fp);
-        return 0;
-    }
-
     ass_msg(library, MSGL_V, "File size: %ld", sz);
 
     buf = malloc(sz + 1);

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass.h	2010-04-13 18:43:08 UTC (rev 6126)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass.h	2010-04-15 17:50:42 UTC (rev 6127)
@@ -25,7 +25,7 @@
 #include <stdarg.h>
 #include "ass_types.h"
 
-#define LIBASS_VERSION 0x00908000
+#define LIBASS_VERSION 0x00909000
 
 /*
  * A linked list of images produced by an ass renderer.
@@ -75,11 +75,13 @@
 void ass_library_done(ASS_Library *priv);
 
 /**
- * \brief Set private font directory.
- * It is used for saving embedded fonts and also in font lookup.
+ * \brief Set additional fonts directory.
+ * Optional directory that will be scanned for fonts recursively.  The fonts
+ * found are used for font lookup.
+ * NOTE: A valid font directory is not needed to support embedded fonts.
  *
  * \param priv library handle
- * \param fonts_dir private directory for font extraction
+ * \param fonts_dir directory with additional fonts
  */
 void ass_set_fonts_dir(ASS_Library *priv, const char *fonts_dir);
 
@@ -203,6 +205,8 @@
  * if fontconfig is used.
  * \param update whether fontconfig cache should be built/updated now.  Only
  * relevant if fontconfig is used.
+ *
+ * NOTE: font lookup must be configured before an ASS_Renderer can be used.
  */
 void ass_set_fonts(ASS_Renderer *priv, const char *default_font,
                    const char *default_family, int fc, const char *config,
@@ -297,7 +301,8 @@
 void ass_process_data(ASS_Track *track, char *data, int size);
 
 /**
- * \brief Parse Codec Private section of subtitle stream.
+ * \brief Parse Codec Private section of the subtitle stream, in Matroska
+ * format.  See the Matroska specification for details.
  * \param track target track
  * \param data string to parse
  * \param size length of data
@@ -305,8 +310,8 @@
 void ass_process_codec_private(ASS_Track *track, char *data, int size);
 
 /**
- * \brief Parse a chunk of subtitle stream data. In Matroska,
- * this contains exactly 1 event (or a commentary).
+ * \brief Parse a chunk of subtitle stream data. A chunk contains exactly one
+ * event in Matroska format.  See the Matroska specification for details.
  * \param track track
  * \param data string to parse
  * \param size length of data

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass_fontconfig.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass_fontconfig.c	2010-04-13 18:43:08 UTC (rev 6126)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass_fontconfig.c	2010-04-15 17:50:42 UTC (rev 6127)
@@ -52,6 +52,47 @@
 #ifdef CONFIG_FONTCONFIG
 
 /**
+ * \brief Case-insensitive match ASS/SSA font family against full name. (also
+ * known as "name for humans")
+ *
+ * \param lib library instance
+ * \param priv fontconfig instance
+ * \param family font family
+ * \return font set
+ */
+static FcFontSet *match_fullname(ASS_Library *lib, FCInstance *priv,
+                                 const char *family)
+{
+    FcFontSet *sets[2];
+    FcFontSet *result = FcFontSetCreate();
+    int nsets = 0;
+    int i, fi;
+
+    if ((sets[nsets] = FcConfigGetFonts(priv->config, FcSetSystem)))
+        nsets++;
+    if ((sets[nsets] = FcConfigGetFonts(priv->config, FcSetApplication)))
+        nsets++;
+
+    // Run over font sets and patterns and try to match against full name
+    for (i = 0; i < nsets; i++) {
+        FcFontSet *set = sets[i];
+        for (fi = 0; fi < set->nfont; fi++) {
+            FcPattern *pat = set->fonts[fi];
+            char *fullname;
+            int pi = 0;
+            while (FcPatternGetString(pat, FC_FULLNAME, pi++,
+                   (FcChar8 **) &fullname) == FcResultMatch)
+                if (strcasecmp(fullname, family) == 0) {
+                    FcFontSetAdd(result, FcPatternDuplicate(pat));
+                    break;
+                }
+        }
+    }
+
+    return result;
+}
+
+/**
  * \brief Low-level font selection.
  * \param priv private data
  * \param family font family
@@ -62,7 +103,7 @@
  * \param code: the character that should be present in the font, can be 0
  * \return font file path
 */
-static char *_select_font(ASS_Library *library, FCInstance *priv,
+static char *select_font(ASS_Library *library, FCInstance *priv,
                           const char *family, int treat_family_as_pattern,
                           unsigned bold, unsigned italic, int *index,
                           uint32_t code)
@@ -74,7 +115,7 @@
     FcChar8 *r_family, *r_style, *r_file, *r_fullname;
     FcBool r_outline, r_embolden;
     FcCharSet *r_charset;
-    FcFontSet *fset = NULL;
+    FcFontSet *ffullname = NULL, *fsorted = NULL, *fset = NULL;
     int curf;
     char *retval = NULL;
     int family_cnt = 0;
@@ -126,10 +167,23 @@
     if (!rc)
         goto error;
 
-    fset = FcFontSort(priv->config, pat, FcTrue, NULL, &result);
-    if (!fset)
+    fsorted = FcFontSort(priv->config, pat, FcTrue, NULL, &result);
+    ffullname = match_fullname(library, priv, family);
+    if (!fsorted || !ffullname)
         goto error;
 
+    fset = FcFontSetCreate();
+    for (curf = 0; curf < ffullname->nfont; ++curf) {
+        FcPattern *curp = ffullname->fonts[curf];
+        FcPatternReference(curp);
+        FcFontSetAdd(fset, curp);
+    }
+    for (curf = 0; curf < fsorted->nfont; ++curf) {
+        FcPattern *curp = fsorted->fonts[curf];
+        FcPatternReference(curp);
+        FcFontSetAdd(fset, curp);
+    }
+
     for (curf = 0; curf < fset->nfont; ++curf) {
         FcPattern *curp = fset->fonts[curf];
 
@@ -215,6 +269,10 @@
         FcPatternDestroy(pat);
     if (rpat)
         FcPatternDestroy(rpat);
+    if (fsorted)
+        FcFontSetDestroy(fsorted);
+    if (ffullname)
+        FcFontSetDestroy(ffullname);
     if (fset)
         FcFontSetDestroy(fset);
     return retval;
@@ -244,11 +302,11 @@
     }
     if (family && *family)
         res =
-            _select_font(library, priv, family, treat_family_as_pattern,
+            select_font(library, priv, family, treat_family_as_pattern,
                          bold, italic, index, code);
     if (!res && priv->family_default) {
         res =
-            _select_font(library, priv, priv->family_default, 0, bold,
+            select_font(library, priv, priv->family_default, 0, bold,
                          italic, index, code);
         if (res)
             ass_msg(library, MSGL_WARN, "fontconfig_select: Using default "
@@ -263,7 +321,7 @@
                 res, *index);
     }
     if (!res) {
-        res = _select_font(library, priv, "Arial", 0, bold, italic,
+        res = select_font(library, priv, "Arial", 0, bold, italic,
                            index, code);
         if (res)
             ass_msg(library, MSGL_WARN, "fontconfig_select: Using 'Arial' "
@@ -283,8 +341,8 @@
  * \param library library object
  * \param ftlibrary freetype library object
  * \param idx index of the processed font in library->fontdata
- * With FontConfig >= 2.4.2, builds a font pattern in memory via FT_New_Memory_Face/FcFreeTypeQueryFace.
- * With older FontConfig versions, save the font to ~/.mplayer/fonts.
+ *
+ * Builds a font pattern in memory via FT_New_Memory_Face/FcFreeTypeQueryFace.
 */
 static void process_fontdata(FCInstance *priv, ASS_Library *library,
                              FT_Library ftlibrary, int idx)
@@ -388,7 +446,7 @@
         process_fontdata(priv, library, ftlibrary, i);
 
     if (dir) {
-        ass_msg(library, MSGL_INFO, "Updating font cache");
+        ass_msg(library, MSGL_V, "Updating font cache");
 
         rc = FcConfigAppFontAddDir(priv->config, (const FcChar8 *) dir);
         if (!rc) {

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass_parse.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass_parse.c	2010-04-13 18:43:08 UTC (rev 6126)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass_parse.c	2010-04-15 17:50:42 UTC (rev 6127)
@@ -586,7 +586,7 @@
         for (cnt = 0; cnt < 3; ++cnt) {
             if (*p == '\\')
                 break;
-            v[cnt] = strtod(p, &p);
+            mystrtod(&p, &v[cnt]);
             skip(',');
         }
         if (cnt == 3) {

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass_render.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass_render.c	2010-04-13 18:43:08 UTC (rev 6126)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass_render.c	2010-04-15 17:50:42 UTC (rev 6127)
@@ -123,9 +123,11 @@
         calloc(MAX_GLYPHS_INITIAL, sizeof(GlyphInfo));
     priv->text_info.lines = calloc(MAX_LINES_INITIAL, sizeof(LineInfo));
 
+    priv->settings.font_size_coeff = 1.;
+
   ass_init_exit:
     if (priv)
-        ass_msg(library, MSGL_INFO, "Init");
+        ass_msg(library, MSGL_V, "Init");
     else
         ass_msg(library, MSGL_ERR, "Init failed");
 
@@ -538,7 +540,7 @@
     FT_Glyph_Copy((FT_Glyph) drawing->glyph, &glyph);
     error = FT_Glyph_To_Bitmap(&glyph, FT_RENDER_MODE_NORMAL, 0, 1);
     if (error) {
-        ass_msg(render_priv->library, MSGL_V,
+        ass_msg(render_priv->library, MSGL_WARN,
             "Clip vector rasterization failed: %d. Skipping.", error);
         goto blend_vector_exit;
     }
@@ -1158,8 +1160,9 @@
                                          render_priv->border_scale),
                             double_to_d6(render_priv->state.border_y *
                                          render_priv->border_scale));
-        } else if (render_priv->state.border_x > 0 ||
-                   render_priv->state.border_y > 0) {
+        } else if ((render_priv->state.border_x > 0
+                    || render_priv->state.border_y > 0)
+                   && key.scale_x && key.scale_y) {
 
             FT_Glyph_Copy(info->glyph, &info->outline_glyph);
             stroke_outline_glyph(render_priv,
@@ -2072,7 +2075,7 @@
             double scr_y;
             if (valign != VALIGN_SUB)
                 ass_msg(render_priv->library, MSGL_V,
-                       "Invalid valign, supposing 0 (subtitle)");
+                       "Invalid valign, assuming 0 (subtitle)");
             scr_y =
                 y2scr_sub(render_priv,
                           render_priv->track->PlayResY - MarginV);
@@ -2211,6 +2214,8 @@
 
 static void ass_reconfigure(ASS_Renderer *priv)
 {
+    ASS_Settings *settings = &priv->settings;
+
     priv->render_id++;
     priv->cache.glyph_cache =
         ass_glyph_cache_reset(priv->cache.glyph_cache);
@@ -2220,6 +2225,19 @@
         ass_composite_cache_reset(priv->cache.composite_cache);
     ass_free_images(priv->prev_images_root);
     priv->prev_images_root = 0;
+
+    priv->width = settings->frame_width;
+    priv->height = settings->frame_height;
+    priv->orig_width = settings->frame_width - settings->left_margin -
+        settings->right_margin;
+    priv->orig_height = settings->frame_height - settings->top_margin -
+        settings->bottom_margin;
+    priv->orig_width_nocrop =
+        settings->frame_width - FFMAX(settings->left_margin, 0) -
+        FFMAX(settings->right_margin, 0);
+    priv->orig_height_nocrop =
+        settings->frame_height - FFMAX(settings->top_margin, 0) -
+        FFMAX(settings->bottom_margin, 0);
 }
 
 void ass_set_frame_size(ASS_Renderer *priv, int w, int h)
@@ -2323,27 +2341,14 @@
     if (render_priv->library != track->library)
         return 1;
 
+    if (!render_priv->fontconfig_priv)
+        return 1;
+
     free_list_clear(render_priv);
 
     if (track->n_events == 0)
         return 1;               // nothing to do
 
-    render_priv->width = settings_priv->frame_width;
-    render_priv->height = settings_priv->frame_height;
-    render_priv->orig_width =
-        settings_priv->frame_width - settings_priv->left_margin -
-        settings_priv->right_margin;
-    render_priv->orig_height =
-        settings_priv->frame_height - settings_priv->top_margin -
-        settings_priv->bottom_margin;
-    render_priv->orig_width_nocrop =
-        settings_priv->frame_width - FFMAX(settings_priv->left_margin,
-                                           0) -
-        FFMAX(settings_priv->right_margin, 0);
-    render_priv->orig_height_nocrop =
-        settings_priv->frame_height - FFMAX(settings_priv->top_margin,
-                                            0) -
-        FFMAX(settings_priv->bottom_margin, 0);
     render_priv->track = track;
     render_priv->time = now;
 
@@ -2505,7 +2510,7 @@
             s.hb = priv->left + priv->width;
             if (priv->height != imgs[i].height) {       // no, it's not
                 ass_msg(render_priv->library, MSGL_WARN,
-                        "Warning! Event height has changed");
+                        "Event height has changed");
                 priv->top = 0;
                 priv->height = 0;
                 priv->left = 0;

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass_strtod.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass_strtod.c	2010-04-13 18:43:08 UTC (rev 6126)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Ass/ADM_libAss/ass_strtod.c	2010-04-15 17:50:42 UTC (rev 6127)
@@ -16,12 +16,14 @@
 #include <ctype.h>
 #include <errno.h>
 
+const
 static int maxExponent = 511;   /* Largest possible base 10 exponent.  Any
                                  * exponent larger than this will already
                                  * produce underflow or overflow, so there's
                                  * no need to worry about additional digits.
                                  */
 
+const
 static double powersOf10[] = {  /* Table giving binary powers of 10.  Entry */
     10.,                        /* is 10^2^i.  Used to convert decimal */
     100.,                       /* exponents into floating-point numbers. */
@@ -224,7 +226,7 @@
         errno = ERANGE;
     }
     dblExp = 1.0;
-    for (d = powersOf10; exp != 0; exp >>= 1, d += 1) {
+    for (d = (double *) powersOf10; exp != 0; exp >>= 1, d += 1) {
         if (exp & 01) {
             dblExp *= *d;
         }



From gruntster at mail.berlios.de  Thu Apr 15 21:17:55 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 15 Apr 2010 21:17:55 +0200
Subject: [Avidemux-svn-commit] r6128 - in
	branches/avidemux_2.5_branch_gruntster:
	avidemux/ADM_coreUI/include cmake
	plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc
	plugins/ADM_videoFilters/Fade
Message-ID: <201004151917.o3FJHtgJ005693@sheep.berlios.de>

Author: gruntster
Date: 2010-04-15 21:17:48 +0200 (Thu, 15 Apr 2010)
New Revision: 6128

Added:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/mjpeg_logging.c
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factory.h
   branches/avidemux_2.5_branch_gruntster/cmake/admPluginVideoEncoder.cmake
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/mpeg2enc_if.cc
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Fade/ADM_vidFade.cpp
Log:
[plugin] cosmetic tidy ups

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factory.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factory.h	2010-04-15 17:50:42 UTC (rev 6127)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factory.h	2010-04-15 19:17:48 UTC (rev 6128)
@@ -416,7 +416,7 @@
 
 /*************************************************/
 #ifndef ADM_MINIMAL_UI_INTERFACE
-#include "../../ADM_encoder/ADM_vidEncode.hxx"
+#include "ADM_encoder/ADM_vidEncode.hxx"
 typedef diaElem  *(CREATE_BITRATE_T)(COMPRES_PARAMS *p,const char *toggleTitle,const char *tip);
 class diaElemBitrateBase : public diaElem
 {

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admPluginVideoEncoder.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admPluginVideoEncoder.cmake	2010-04-15 17:50:42 UTC (rev 6127)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admPluginVideoEncoder.cmake	2010-04-15 19:17:48 UTC (rev 6128)
@@ -6,6 +6,7 @@
 
 MACRO(INIT_VIDEO_ENCODER_PLUGIN _lib)
 	INCLUDE_DIRECTORIES("${CMAKE_BINARY_DIR}/config")
+	INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux")
 	INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_core/include")
 	INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_coreUI/include")
 	INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_plugin")

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/CMakeLists.txt	2010-04-15 17:50:42 UTC (rev 6127)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/CMakeLists.txt	2010-04-15 19:17:48 UTC (rev 6128)
@@ -1,48 +1,48 @@
-SET(ADM_LIB mpeg2enc)
-
-SET(${ADM_LIB}_SRCS
-ad_layer.cc           fdct_x86.cc           mblock_bsad_mmx.cc          motionest.cc     predcomp_mmxe.cc  putpic.cc        readpic.cc       yuv4mpeg.cc
-build_sub22_mests.cc  feedframe.cc          mblock_bsumsq_mmx.cc        motionsearch.cc  predict.cc        putseq.cc        stats.cc         yuv4mpeg_ratio.cc
-build_sub44_mests.cc  find_best_one_pel.cc  mblock_sad_mmx.cc           mpeg2enc.cc      predict_mmx.cc    putvlc.cc        synchrolib.cc
-conform.cc            idct.cc               mblock_sad_mmxe.cc          mpeg2enc_if.cc   predict_ref.cc    quantize.cc      transfrm.cc
-cpu_accel.cc          idctdata.cc           mblock_sub44_sads_x86.cc    mpeg2param.cc    predict_x86.cc    quantize_ref.cc  transfrm_ref.cc
-fdctdata.cc           idct_mmx.cc           mpeg2setup.cc               putbits.cc       quantize_x86.cc   transfrm_x86.cc
-fdct_mmx.cc           ioio.c                mblock_sumsq_mmx.cc         mpegconsts.cc    puthdr.cc         quant_mmx2.cc    writepic.cc
-fdctref.cc            macroblock.cc         motion.cc                   predcomp_mmx.cc  putmpg.cc         ratectl.cc)
-
-IF (ADM_CPU_ALTIVEC)
-	SET(${ADM_LIB}_SRCS ${${ADM_LIB}_SRCS}
-		altivec/add_pred.c   altivec/amber.c  altivec/benchmark.c  altivec/bsad.c  altivec/bsumsq.c  altivec/bsumsq_sub22.c  altivec/build_sub22_mests.c
-		altivec/build_sub44_mests.c  altivec/detect.c  altivec/fdct.c  altivec/fdct_idct.c  altivec/field_dct_best.c  altivec/find_best_one_pel.c
-		altivec/idct.c  altivec/iquant_intra.c  altivec/iquant_non_intra.c  altivec/motion.c  altivec/pred_comp.c  altivec/quant_non_intra.c
-		altivec/quant_weight_coeff_sum.c  altivec/quantize.c  altivec/sad_00.c  altivec/sad_01.c  altivec/sad_10.c  altivec/sad_11.c
-		altivec/sub_mean_reduction.c  altivec/sub_mean_reduction_ppc.S  altivec/sub_pred.c  altivec/subsample_image.c  altivec/sumsq.c
-		altivec/sumsq_sub22.c  altivec/variance.c)
-ENDIF (ADM_CPU_ALTIVEC)
-
-include_directories("${CMAKE_CURRENT_SOURCE_DIR}"
-					"${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_core/include"
-					"${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_coreImage/include"
-					"${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_codecs"
-					"${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_utilities")
-add_definitions(-DHAVE_CONFIG_H)
-
-IF (ADM_CPU_X86)
-	add_definitions(-DHAVE_X86CPU)
-
-	IF (ADM_CPU_X86_64)
-		add_definitions(-DHAVE_X86_64_CPU)
-	ENDIF (ADM_CPU_X86_64)
-ELSEIF (ADM_CPU_ALTIVEC)
-	add_definitions(-DHAVE_ALTIVEC)
-
-	IF (NOT APPLE)
-		add_definitions(-DHAVE_ALTIVEC_H)
-	ENDIF (NOT APPLE)
-ENDIF (ADM_CPU_X86)
-
-add_library(${ADM_LIB} ${${ADM_LIB}_SRCS})
-
+SET(ADM_LIB mpeg2enc)
+
+SET(${ADM_LIB}_SRCS
+ad_layer.cc           fdct_x86.cc           mblock_bsad_mmx.cc          motionest.cc     predcomp_mmxe.cc  putpic.cc        readpic.cc       yuv4mpeg.cc
+build_sub22_mests.cc  feedframe.cc          mblock_bsumsq_mmx.cc        motionsearch.cc  predict.cc        putseq.cc        stats.cc         yuv4mpeg_ratio.cc
+build_sub44_mests.cc  find_best_one_pel.cc  mblock_sad_mmx.cc           mpeg2enc.cc      predict_mmx.cc    putvlc.cc        synchrolib.cc
+conform.cc            idct.cc               mblock_sad_mmxe.cc          mpeg2enc_if.cc   predict_ref.cc    quantize.cc      transfrm.cc
+cpu_accel.cc          idctdata.cc           mblock_sub44_sads_x86.cc    mpeg2param.cc    predict_x86.cc    quantize_ref.cc  transfrm_ref.cc
+fdctdata.cc           idct_mmx.cc           mjpeg_logging.c				mpeg2setup.cc    putbits.cc        quantize_x86.cc  transfrm_x86.cc
+fdct_mmx.cc           ioio.c                mblock_sumsq_mmx.cc         mpegconsts.cc    puthdr.cc         quant_mmx2.cc    writepic.cc
+fdctref.cc            macroblock.cc         motion.cc                   predcomp_mmx.cc  putmpg.cc         ratectl.cc)
+
+IF (ADM_CPU_ALTIVEC)
+	SET(${ADM_LIB}_SRCS ${${ADM_LIB}_SRCS}
+		altivec/add_pred.c   altivec/amber.c  altivec/benchmark.c  altivec/bsad.c  altivec/bsumsq.c  altivec/bsumsq_sub22.c  altivec/build_sub22_mests.c
+		altivec/build_sub44_mests.c  altivec/detect.c  altivec/fdct.c  altivec/fdct_idct.c  altivec/field_dct_best.c  altivec/find_best_one_pel.c
+		altivec/idct.c  altivec/iquant_intra.c  altivec/iquant_non_intra.c  altivec/motion.c  altivec/pred_comp.c  altivec/quant_non_intra.c
+		altivec/quant_weight_coeff_sum.c  altivec/quantize.c  altivec/sad_00.c  altivec/sad_01.c  altivec/sad_10.c  altivec/sad_11.c
+		altivec/sub_mean_reduction.c  altivec/sub_mean_reduction_ppc.S  altivec/sub_pred.c  altivec/subsample_image.c  altivec/sumsq.c
+		altivec/sumsq_sub22.c  altivec/variance.c)
+ENDIF (ADM_CPU_ALTIVEC)
+
+include_directories("${CMAKE_CURRENT_SOURCE_DIR}"
+					"${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_core/include"
+					"${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_coreImage/include"
+					"${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_codecs"
+					"${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_utilities")
+add_definitions(-DHAVE_CONFIG_H)
+
+IF (ADM_CPU_X86)
+	add_definitions(-DHAVE_X86CPU)
+
+	IF (ADM_CPU_X86_64)
+		add_definitions(-DHAVE_X86_64_CPU)
+	ENDIF (ADM_CPU_X86_64)
+ELSEIF (ADM_CPU_ALTIVEC)
+	add_definitions(-DHAVE_ALTIVEC)
+
+	IF (NOT APPLE)
+		add_definitions(-DHAVE_ALTIVEC_H)
+	ENDIF (NOT APPLE)
+ENDIF (ADM_CPU_X86)
+
+add_library(${ADM_LIB} ${${ADM_LIB}_SRCS})
+
 if (UNIX)
 	add_target_cflags(mpeg2enc -fPIC)
 endif (UNIX)
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/mjpeg_logging.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/mjpeg_logging.c	2010-04-15 17:50:42 UTC (rev 6127)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/mjpeg_logging.c	2010-04-15 19:17:48 UTC (rev 6128)
@@ -0,0 +1,227 @@
+/*
+    $Id: mjpeg_logging.c,v 1.14 2005/05/18 17:21:47 sms00 Exp $
+
+    Copyright (C) 2000 Herbert Valerio Riedel <hvr at gnu.org>
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+
+#ifdef HAVE_CONFIG_H
+# include <config.h>
+#endif
+
+#include <stdlib.h>
+#include <stdarg.h>
+#include <stdio.h>
+#include <assert.h>
+#include <string.h>
+
+#include "mjpeg_logging.h"
+
+#define MAX_DEFAULT_ID_SIZE 16
+#define DEFAULT_DEFAULT_ID "???"
+
+#ifdef HAVE___PROGNAME
+extern const char *__progname;
+#endif
+
+static log_level_t mjpeg_log_verbosity = LOG_NONE;
+static char default_handler_id[MAX_DEFAULT_ID_SIZE];
+static char default_handler_id_is_set = 0;
+
+static int default_mjpeg_log_filter( log_level_t level )
+{
+  int verb_from_env;
+  if( mjpeg_log_verbosity == 0 )
+    {
+      char *mjpeg_verb_env = getenv("MJPEG_VERBOSITY");
+      if( mjpeg_verb_env != NULL )
+        {
+          verb_from_env = LOG_WARN-atoi(mjpeg_verb_env);
+          if( verb_from_env >= LOG_DEBUG && verb_from_env <= LOG_ERROR )
+            mjpeg_log_verbosity = (log_level_t)verb_from_env;
+        }
+    }
+  return (level < LOG_WARN && level < mjpeg_log_verbosity);
+}
+
+static mjpeg_log_filter_t _filter = default_mjpeg_log_filter;
+
+static void
+default_mjpeg_log_handler(log_level_t level, const char message[])
+{
+  const char *ids;
+
+  if( (*_filter)( level ) )
+    return;
+  if (default_handler_id_is_set) {
+    ids = default_handler_id;
+  } else {
+#ifdef HAVE___PROGNAME
+    ids = __progname;
+#else
+    ids = DEFAULT_DEFAULT_ID;
+#endif
+  }
+  switch(level) {
+  case LOG_ERROR:
+    fprintf(stderr, "**ERROR: [%s] %s\n", ids, message);
+    break;
+  case LOG_DEBUG:
+    fprintf(stderr, "--DEBUG: [%s] %s\n", ids, message);
+    break;
+  case LOG_WARN:
+    fprintf(stderr, "++ WARN: [%s] %s\n", ids, message);
+    break;
+  case LOG_INFO:
+    fprintf(stderr, "   INFO: [%s] %s\n", ids, message);
+    break;
+  default:
+    assert(0);
+  }
+}
+
+static mjpeg_log_handler_t _handler = default_mjpeg_log_handler;
+
+
+mjpeg_log_handler_t
+mjpeg_log_set_handler(mjpeg_log_handler_t new_handler)
+{
+  mjpeg_log_handler_t old_handler = _handler;
+
+  _handler = new_handler;
+
+  return old_handler;
+}
+
+/***************
+ *
+ * Set default log handlers degree of verboseity.
+ * 0 = quiet, 1 = info, 2 = debug
+ *
+ *************/
+
+int
+mjpeg_default_handler_verbosity(int verbosity)
+{
+  int prev_verb = mjpeg_log_verbosity;
+  mjpeg_log_verbosity = (log_level_t)(LOG_WARN - verbosity);
+  return prev_verb;
+}
+
+/*
+ * Set identifier string used by default handler
+ *
+ */
+int
+mjpeg_default_handler_identifier(const char *new_id)
+{
+  const char *s;
+  if (new_id == NULL) {
+    default_handler_id_is_set = 0;
+    return 0;
+  }
+  /* find basename of new_id (remove any directory prefix) */
+  if ((s = strrchr(new_id, '/')) == NULL)
+    s = new_id;
+  else
+    s = s + 1;
+  strncpy(default_handler_id, s, MAX_DEFAULT_ID_SIZE);
+  default_handler_id[MAX_DEFAULT_ID_SIZE-1] = '\0';
+  default_handler_id_is_set = 1;
+  return 0;
+}
+
+
+static void
+mjpeg_logv(log_level_t level, const char format[], va_list args)
+{
+  char buf[1024] = { 0, };
+
+  /* TODO: Original had a re-entrancy error trap to assist bug
+     finding.  To make this work with multi-threaded applications a
+     lock is needed hence delete.
+  */
+
+  
+  vsnprintf(buf, sizeof(buf)-1, format, args);
+
+  _handler(level, buf);
+}
+
+void
+mjpeg_log(log_level_t level, const char format[], ...)
+{
+  va_list args;
+  va_start (args, format);
+  mjpeg_logv(level, format, args);
+  va_end (args);
+}
+
+void
+mjpeg_debug(const char format[], ...)
+{
+  va_list args;
+  va_start (args, format);
+  mjpeg_logv(LOG_DEBUG, format, args);
+  va_end (args);
+}
+
+void
+mjpeg_info(const char format[], ...)
+{
+  va_list args;
+  va_start (args, format);
+  mjpeg_logv(LOG_INFO, format, args);
+  va_end (args);
+}
+
+void
+mjpeg_warn(const char format[], ...)
+{
+  va_list args;
+  va_start (args, format);
+  mjpeg_logv(LOG_WARN, format, args);
+  va_end (args);
+}
+
+void
+mjpeg_error(const char format[], ...)
+{
+  va_list args;
+  va_start (args, format);
+  mjpeg_logv(LOG_ERROR, format, args);
+  va_end (args);
+}
+
+void
+mjpeg_error_exit1(const char format[], ...)
+{
+  va_list args;
+  va_start( args, format );
+  mjpeg_logv( LOG_ERROR, format, args);
+  va_end(args);           
+  exit(EXIT_FAILURE);
+}
+
+
+/* 
+ * Local variables:
+ *  c-file-style: "gnu"
+ *  tab-width: 8
+ *  indent-tabs-mode: nil
+ * End:
+ */

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/mpeg2enc_if.cc
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/mpeg2enc_if.cc	2010-04-15 17:50:42 UTC (rev 6127)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_mpeg2enc/mpeg2enc/mpeg2enc_if.cc	2010-04-15 19:17:48 UTC (rev 6128)
@@ -44,7 +44,6 @@
 //#include "../utils/altivec/altivec_conf.h"
 #endif
 #include "mpeg2parm.h"
-#include "ADM_codec.h"
 //int verbose = 1;
 #define aprintf printf
 /* private prototypes */

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Fade/ADM_vidFade.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Fade/ADM_vidFade.cpp	2010-04-15 17:50:42 UTC (rev 6127)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoFilters/Fade/ADM_vidFade.cpp	2010-04-15 19:17:48 UTC (rev 6128)
@@ -11,7 +11,6 @@
 
 #include "ADM_default.h"
 #include "ADM_videoFilterDynamic.h"
-#include "DIA_enter.h"
 #include "DIA_factory.h"
 #include "DIA_coreToolkit.h"
 #include "ADM_vidFade_param.h"



From gruntster at mail.berlios.de  Thu Apr 15 21:22:55 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu, 15 Apr 2010 21:22:55 +0200
Subject: [Avidemux-svn-commit] r6129 - in
	branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux:
	. Tools
Message-ID: <201004151922.o3FJMt4i005978@sheep.berlios.de>

Author: gruntster
Date: 2010-04-15 21:22:45 +0200 (Thu, 15 Apr 2010)
New Revision: 6129

Added:
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1a. Pre-build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1b. Perform Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1c. Post-build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2b. Package SDK.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2c. Package Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Tools/Build Plugins.bat
Removed:
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1a. Prepare Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1b. Continue Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2b. Package Build.bat
Modified:
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1. Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2. Create Packages.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2a. Update Notes.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Set Avidemux Environment Variables.bat
Log:
[Win32] update build scripts to build sdk

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1. Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1. Build.bat	2010-04-15 19:17:48 UTC (rev 6128)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1. Build.bat	2010-04-15 19:22:45 UTC (rev 6129)
@@ -25,6 +25,24 @@
 verify >nul
 echo.
 
-call "1a. Prepare Build"
+set curDir=%CD%
 
-:end
\ No newline at end of file
+call "Set Avidemux Environment Variables"
+if errorlevel 1 goto end
+
+cd "%curDir%"
+call "1a. Pre-build"
+if errorlevel 1 goto end
+
+cd "%curDir%"
+call "1b. Perform Build"
+if errorlevel 1 goto end
+
+cd "%curDir%"
+call "1c. Post-build"
+if errorlevel 1 goto end
+
+echo Finished!
+
+:end
+pause
\ No newline at end of file

Copied: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1a. Pre-build.bat (from rev 6126, branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1a. Prepare Build.bat)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1a. Prepare Build.bat	2010-04-13 18:43:08 UTC (rev 6126)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1a. Pre-build.bat	2010-04-15 19:22:45 UTC (rev 6129)
@@ -0,0 +1,26 @@
+cd "%sourceDir%"
+echo Cleaning build directory (%CD%\%BuildFolder%)
+rmdir /s /q %buildFolder% 2> NUL
+
+cd "%sourceDir%\plugins"
+echo Cleaning plugin build directory (%CD%\%BuildFolder%)
+rmdir /s /q %buildFolder% 2> NUL
+
+if exist %buildFolder% goto removalFailure
+cd "%sourceDir%"
+if exist %buildFolder% goto removalFailure
+
+mkdir %buildFolder%
+mkdir plugins\%buildFolder%
+
+echo Performing Subversion update
+svn up .
+
+goto :EOF
+
+:removalFailure
+echo ERROR - build directories could not be fully deleted.
+echo Aborting.
+
+:error
+set ERRORLEVEL=1
\ No newline at end of file

Deleted: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1a. Prepare Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1a. Prepare Build.bat	2010-04-15 19:17:48 UTC (rev 6128)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1a. Prepare Build.bat	2010-04-15 19:22:45 UTC (rev 6129)
@@ -1,39 +0,0 @@
- at echo off
-
-set curDir=%CD%
-call "Set Avidemux Environment Variables"
-
-if errorlevel 1 goto error
-
-cd "%sourceDir%"
-echo Cleaning build directory (%CD%\%BuildFolder%)
-rmdir /s /q %buildFolder% 2> NUL
-
-cd "%sourceDir%\plugins"
-echo Cleaning plugin build directory (%CD%\%BuildFolder%)
-rmdir /s /q %buildFolder% 2> NUL
-
-if exist %buildFolder% goto removalFailure
-cd "%sourceDir%"
-if exist %buildFolder% goto removalFailure
-
-mkdir %buildFolder%
-mkdir plugins\%buildFolder%
-
-echo Performing Subversion update
-svn up .
-
-cd %curDir%
-call "1b. Continue Build"
-
-goto end
-
-:removalFailure
-echo ERROR - build directories could not be fully deleted.
-echo Aborting.
-
-:error
-set ERRORLEVEL=1
-pause
-
-:end

Deleted: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1b. Continue Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1b. Continue Build.bat	2010-04-15 19:17:48 UTC (rev 6128)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1b. Continue Build.bat	2010-04-15 19:22:45 UTC (rev 6129)
@@ -1,39 +0,0 @@
- at echo off
-
-call "Set Avidemux Environment Variables"
-if errorlevel 1 goto error
-
-cd "%sourceDir%\%buildFolder%"
-cmake -G"MSYS Makefiles" -DCMAKE_INSTALL_PREFIX="%buildDir%" -DCMAKE_EXE_LINKER_FLAGS="-shared-libgcc" -DCMAKE_SHARED_LINKER_FLAGS="-shared-libgcc" -DUSE_SYSTEM_SPIDERMONKEY=ON -DCMAKE_INCLUDE_PATH="%SpiderMonkeySourceDir%" -DCMAKE_LIBRARY_PATH="%SpiderMonkeyLibDir%" %DebugFlags% ..
-
-if errorlevel 1 goto error
-pause
-
-set msysSourceDir=%sourceDir:\=/%
-cd "%sourceDir%\plugins\%buildFolder%"
-cmake -G"MSYS Makefiles" -DCMAKE_INSTALL_PREFIX="%buildDir%" -DAVIDEMUX_CORECONFIG_DIR="%msysSourceDir%/%buildFolder%/config" -DAVIDEMUX_INSTALL_PREFIX="%buildDir%" -DAVIDEMUX_SOURCE_DIR="%msysSourceDir%" -DCMAKE_EXE_LINKER_FLAGS="-shared-libgcc" -DCMAKE_SHARED_LINKER_FLAGS="-shared-libgcc" %DebugFlags% ..
-
-if errorlevel 1 goto error
-pause
-
-cd "%sourceDir%\%buildFolder%"
-make install
-
-if errorlevel 1 goto error
-
-cd "%sourceDir%\plugins\%buildFolder%"
-rmdir /s /q "%buildDir%\plugins" 2> NUL
-make install
-
-if errorlevel 1 goto error
-
-del /s "%buildDir%\*.a"
-
-echo Finished!
-goto end
-
-:error
-set ERRORLEVEL=1
-
-:end
-pause
\ No newline at end of file

Copied: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1b. Perform Build.bat (from rev 6126, branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1b. Continue Build.bat)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1b. Continue Build.bat	2010-04-13 18:43:08 UTC (rev 6126)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1b. Perform Build.bat	2010-04-15 19:22:45 UTC (rev 6129)
@@ -0,0 +1,27 @@
+cd "%sourceDir%\%buildFolder%"
+cmake -G"MSYS Makefiles" -DCMAKE_INSTALL_PREFIX="%buildDir%" -DCMAKE_EXE_LINKER_FLAGS="-shared-libgcc" -DCMAKE_SHARED_LINKER_FLAGS="-shared-libgcc" -DUSE_SYSTEM_SPIDERMONKEY=ON -DCMAKE_INCLUDE_PATH="%SpiderMonkeySourceDir%" -DCMAKE_LIBRARY_PATH="%SpiderMonkeyLibDir%" %DebugFlags% ..
+
+if errorlevel 1 goto error
+pause
+
+set msysSourceDir=%sourceDir:\=/%
+cd "%sourceDir%\plugins\%buildFolder%"
+cmake -G"MSYS Makefiles" -DCMAKE_INSTALL_PREFIX="%buildDir%" -DAVIDEMUX_CORECONFIG_DIR="%msysSourceDir%/%buildFolder%/config" -DAVIDEMUX_INSTALL_PREFIX="%buildDir%" -DAVIDEMUX_SOURCE_DIR="%msysSourceDir%" -DCMAKE_EXE_LINKER_FLAGS="-shared-libgcc" -DCMAKE_SHARED_LINKER_FLAGS="-shared-libgcc" %DebugFlags% ..
+
+if errorlevel 1 goto error
+pause
+
+cd "%sourceDir%\%buildFolder%"
+make install
+
+if errorlevel 1 goto error
+
+cd "%sourceDir%\plugins\%buildFolder%"
+rmdir /s /q "%buildDir%\plugins" 2> NUL
+make install
+
+if errorlevel 1 goto error
+goto :EOF
+
+:error
+set ERRORLEVEL=1
\ No newline at end of file

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1c. Post-build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1c. Post-build.bat	2010-04-15 19:17:48 UTC (rev 6128)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/1c. Post-build.bat	2010-04-15 19:22:45 UTC (rev 6129)
@@ -0,0 +1,77 @@
+rmdir /s/q "%sdkBuildDir%"
+mkdir "%sdkBuildDir%"
+mkdir "%sdkBuildDir%\lib"
+move "%buildDir%\lib\*.a" "%sdkBuildDir%\lib"
+del /s "%buildDir%\*.a"
+
+mkdir "%sdkBuildDir%\plugin-examples"
+cd "%sdkBuildDir%\plugin-examples"
+copy "%curDir%\Tools\Build Plugins.bat" "%sdkBuildDir%\plugin-examples"
+
+mkdir "audioDecoders"
+mkdir "audioDecoders\ac3"
+xcopy /s "%sourceDir%\plugins\ADM_audioDecoders\ADM_ad_ac3" "audioDecoders\ac3"
+
+mkdir "audioDevices"
+mkdir "audioDevices\win32"
+xcopy /s "%sourceDir%\plugins\ADM_audioDevices\Win32" "audioDevices\win32"
+
+mkdir "audioEncoders"
+mkdir "audioEncoders\pcm"
+xcopy /s "%sourceDir%\plugins\ADM_audioEncoders\pcm" "audioEncoders\pcm"
+
+mkdir "videoEncoders"
+mkdir "videoEncoders\mpeg2enc"
+mkdir "videoEncoders\mpeg2enc\common"
+xcopy /s "%sourceDir%\plugins\ADM_videoEncoder\ADM_vidEnc_mpeg2enc" "videoEncoders\mpeg2enc"
+xcopy /s "%sourceDir%\plugins\ADM_videoEncoder\common" "videoEncoders\mpeg2enc\common"
+xcopy /s "%msysDir%\local\lib\libxml2.dll.a" "videoEncoders\mpeg2enc"
+xcopy /s "%msysDir%\local\include\libxml2" "videoEncoders\mpeg2enc"
+rmdir /s/q "videoEncoders\mpeg2enc\mpeg2enc\altivec"
+
+mkdir "videoFilters"
+mkdir "videoFilters\fade"
+xcopy /s "%sourceDir%\plugins\ADM_videoFilters\Fade" "videoFilters\fade"
+
+del /s CMakeLists.txt
+
+mkdir "%sdkBuildDir%\include"
+mkdir "%sdkBuildDir%\include\ADM_encoder"
+mkdir "%sdkBuildDir%\include\libavutil"
+cd "%sdkBuildDir%\include"
+
+copy "%sourceDir%\%buildFolder%\config\ADM_coreConfig.h"
+copy "%sourceDir%\%buildFolder%\config\libavutil\avconfig.h" libavutil
+copy "%sourceDir%\avidemux\ADM_audiocodec\ADM_ad_plugin.h"
+copy "%sourceDir%\avidemux\ADM_audiocodec\ADM_audiocodec.h"
+copy "%sourceDir%\avidemux\ADM_audiodevice\ADM_audiodevice.h"
+copy "%sourceDir%\avidemux\ADM_audiodevice\ADM_audioDeviceInternal.h"
+copy "%sourceDir%\avidemux\ADM_core\include\ADM_assert.h"
+copy "%sourceDir%\avidemux\ADM_core\include\ADM_clock.h"
+copy "%sourceDir%\avidemux\ADM_core\include\ADM_cpucap.h"
+copy "%sourceDir%\avidemux\ADM_core\include\ADM_default.h"
+copy "%sourceDir%\avidemux\ADM_core\include\ADM_dynamicLoading.h"
+copy "%sourceDir%\avidemux\ADM_core\include\ADM_files.h"
+copy "%sourceDir%\avidemux\ADM_core\include\ADM_inttype.h"
+copy "%sourceDir%\avidemux\ADM_core\include\ADM_mangle.h"
+copy "%sourceDir%\avidemux\ADM_core\include\ADM_misc.h"
+copy "%sourceDir%\avidemux\ADM_coreAudio\include\ADM_audioCodecEnum.h"
+copy "%sourceDir%\avidemux\ADM_coreAudio\include\ADM_audiodef.h"
+copy "%sourceDir%\avidemux\ADM_coreAudio\include\ADM_audioFilter.h"
+copy "%sourceDir%\avidemux\ADM_coreAudio\include\ADM_coreAudio.h"
+copy "%sourceDir%\avidemux\ADM_coreAudio\include\audioencoder.h"
+copy "%sourceDir%\avidemux\ADM_coreAudio\include\audioencoderInternal.h"
+copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_confCouple.h"
+copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_image.h"
+copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_rgb.h"
+copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_videoFilter.h"
+copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_videoFilterCache.h"
+copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_videoFilterDynamic.h"
+copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_videoFilter_iface.h"
+copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_videoFilter_internal.h"
+copy "%sourceDir%\avidemux\ADM_coreUI\include\DIA_coreToolkit.h"
+copy "%sourceDir%\avidemux\ADM_coreUI\include\DIA_factory.h"
+copy "%sourceDir%\avidemux\ADM_coreUI\include\DIA_uiTypes.h"
+copy "%sourceDir%\avidemux\ADM_encoder\ADM_vidEncode.hxx" ADM_encoder
+copy "%sourceDir%\avidemux\ADM_libraries\ffmpeg\libavutil\pixfmt.h" libavutil
+copy "%sourceDir%\avidemux\ADM_plugin\ADM_vidEnc_plugin.h"
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2. Create Packages.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2. Create Packages.bat	2010-04-15 19:17:48 UTC (rev 6128)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2. Create Packages.bat	2010-04-15 19:22:45 UTC (rev 6129)
@@ -16,15 +16,34 @@
 verify >nul
 echo.
 
+set curDir=%CD%
+
+call "Set Avidemux Environment Variables"
+if errorlevel 1 goto error
+
+cd "%curDir%"
 call "2a. Update Notes.bat"
+if errorlevel 1 goto error
 
+cd "%curDir%\Tools"
+call "Get Revision Number"
+cd ..
+
+set packageDir=%CD%\%revisionNo%
+mkdir %packageDir%
+
+cd "%curDir%"
+call "2b. Package SDK.bat"
 if errorlevel 1 goto error
 
-call "2b. Package Build.bat"
+cd "%curDir%"
+call "2c. Package Build.bat"
+if errorlevel 1 goto error
 
 goto end
 
 :error
 set ERRORLEVEL 1
 
-:end
\ No newline at end of file
+:end
+pause
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2a. Update Notes.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2a. Update Notes.bat	2010-04-15 19:17:48 UTC (rev 6128)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2a. Update Notes.bat	2010-04-15 19:22:45 UTC (rev 6129)
@@ -1,10 +1,4 @@
- at echo off
-
-call "Set Avidemux Environment Variables"
-if errorlevel 1 goto error
-
 set PATH=%msysDir%\bin;%PATH%
-set curDir=%CD%
 
 echo -- Generating Change Log.html --
 cd "..\..\installer"
@@ -21,7 +15,6 @@
 cd "%sourceDir%\po"
 sh update_pot.bash
 
-cd "%curDir%"
 goto end
 
 :error

Deleted: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2b. Package Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2b. Package Build.bat	2010-04-15 19:17:48 UTC (rev 6128)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2b. Package Build.bat	2010-04-15 19:22:45 UTC (rev 6129)
@@ -1,43 +0,0 @@
- at echo off
-
-call "Set Avidemux Environment Variables"
-
-cd Tools
-call "Get Revision Number"
-cd ..
-
-set curDir=%CD%
-set baseFile=avidemux_2.5_r%revisionNo%_win%BuildBits%
-set zipFile=%baseFile%.zip
-set packageDir=%CD%\%revisionNo%
-
-echo %packageDir%
-mkdir %packageDir%
-
-copy "%buildDir%\Change Log.html" "%packageDir%"
-move "Tools\Package Notes.html" "%packageDir%"
-copy "%sourceDir%\po\avidemux.pot" "%packageDir%"
-
-cd %buildDir%
-echo -- Generating GTK+ Installer --
-"%nsisDir%\makensis" /V2 /NOCD /DINST_GTK /DBUILD_BITS=%BuildBits% /DNSIDIR="%curDir%\..\..\installer" /DEXEDIR="%packageDir%" "%curDir%\..\..\installer\avidemux.nsi"
-echo -- Generating Qt Installer --
-"%nsisDir%\makensis" /V2 /NOCD /DINST_QT /DBUILD_BITS=%BuildBits% /DNSIDIR="%curDir%\..\..\installer" /DEXEDIR="%packageDir%" "%curDir%\..\..\installer\avidemux.nsi"
-
-mkdir "%packageDir%\temp"
-cd "%packageDir%\temp"
-"%SevenZipDir%\7z" x "%packageDir%\%baseFile%.exe"
-rmdir /s/q $PLUGINSDIR
-mkdir scripts
-move $_OUTDIR\auto scripts
-move $_OUTDIR\video scripts
-mkdir etc\fonts\conf.d
-copy "%buildDir%\etc\fonts\conf.d" etc\fonts\conf.d\
-move $_OUTDIR\conf.avail etc\fonts
-rmdir /s/q $_OUTDIR
-zip -r "%packageDir%\%zipFile%" *
-cd %curDir%
-advzip -z -4 "%packageDir%\%zipFile%"
-rmdir /s/q "%packageDir%\temp"
-
-pause

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2b. Package SDK.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2b. Package SDK.bat	2010-04-15 19:17:48 UTC (rev 6128)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2b. Package SDK.bat	2010-04-15 19:22:45 UTC (rev 6129)
@@ -0,0 +1,6 @@
+set baseFile=avidemux_sdk_2.5_r%revisionNo%_win%BuildBits%
+set zipFile=%baseFile%.zip
+
+cd "%sdkBuildDir%"
+zip -r "%packageDir%\%zipFile%" *
+advzip -z -4 "%packageDir%\%zipFile%"
\ No newline at end of file

Copied: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2c. Package Build.bat (from rev 6126, branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2b. Package Build.bat)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2b. Package Build.bat	2010-04-13 18:43:08 UTC (rev 6126)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/2c. Package Build.bat	2010-04-15 19:22:45 UTC (rev 6129)
@@ -0,0 +1,28 @@
+set baseFile=avidemux_2.5_r%revisionNo%_win%BuildBits%
+set zipFile=%baseFile%.zip
+
+copy "%buildDir%\Change Log.html" "%packageDir%"
+move "Tools\Package Notes.html" "%packageDir%"
+copy "%sourceDir%\po\avidemux.pot" "%packageDir%"
+
+cd %buildDir%
+echo -- Generating GTK+ Installer --
+"%nsisDir%\makensis" /V2 /NOCD /DINST_GTK /DBUILD_BITS=%BuildBits% /DNSIDIR="%curDir%\..\..\installer" /DEXEDIR="%packageDir%" "%curDir%\..\..\installer\avidemux.nsi"
+echo -- Generating Qt Installer --
+"%nsisDir%\makensis" /V2 /NOCD /DINST_QT /DBUILD_BITS=%BuildBits% /DNSIDIR="%curDir%\..\..\installer" /DEXEDIR="%packageDir%" "%curDir%\..\..\installer\avidemux.nsi"
+
+mkdir "%packageDir%\temp"
+cd "%packageDir%\temp"
+"%SevenZipDir%\7z" x "%packageDir%\%baseFile%.exe"
+rmdir /s/q $PLUGINSDIR
+mkdir scripts
+move $_OUTDIR\auto scripts
+move $_OUTDIR\video scripts
+mkdir etc\fonts\conf.d
+copy "%buildDir%\etc\fonts\conf.d" etc\fonts\conf.d\
+move $_OUTDIR\conf.avail etc\fonts
+rmdir /s/q $_OUTDIR
+zip -r "%packageDir%\%zipFile%" *
+cd %curDir%
+advzip -z -4 "%packageDir%\%zipFile%"
+rmdir /s/q "%packageDir%\temp"
\ No newline at end of file

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Set Avidemux Environment Variables.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Set Avidemux Environment Variables.bat	2010-04-15 19:17:48 UTC (rev 6128)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Set Avidemux Environment Variables.bat	2010-04-15 19:22:45 UTC (rev 6129)
@@ -37,6 +37,8 @@
 if "%BuildBits%" == "64" (set buildFolder=build64)
 
 set buildDir=%devDir%\avidemux_2.5_%buildFolder%
+set sdkBuildDir=%devDir%\avidemux_2.5_%buildFolder%_sdk
+
 set curDir=%CD%
 cd ..\..\..\..
 set sourceDir=%CD%

Added: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Tools/Build Plugins.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Tools/Build Plugins.bat	2010-04-15 19:17:48 UTC (rev 6128)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Tools/Build Plugins.bat	2010-04-15 19:22:45 UTC (rev 6129)
@@ -0,0 +1,55 @@
+ at echo off
+
+if "%1" == "" (
+	echo Usage: "Build Plugins.bat" [MinGW directory]
+	echo e.g. "Build Plugins.bat" C:\MinGW
+	goto :EOF
+)
+
+set curDir=%CD%
+set includeDir="%curDir%\..\include"
+set libDir="%curDir%\..\lib"
+set ar="%1\bin\ar"
+set gcc="%1\bin\gcc" -O3 -DNDEBUG
+set gxx="%1\bin\g++" -O3 -DNDEBUG -Wl,-enable-auto-import -Wl,-s
+
+echo ** AC-3 Audio Decoder **
+
+cd audioDecoders\ac3\ADM_liba52
+%gcc% -c *.c -I%includeDir% -L%libDir% -lADM_core.dll
+%ar% rs libADM_liba52.a *.o
+cd ..
+%gxx% -shared *.cpp -o libADM_ad_a52.dll -I%includeDir% -LADM_liba52 -lADM_liba52 -L%libDir% -lADM_core.dll
+cd %curDir%
+
+echo.
+echo ** Win32 Audio Device **
+
+cd audioDevices\win32
+%gxx% -shared *.cpp -o libADM_av_win32.dll -I%includeDir% -L%libDir% -lADM_core.dll -lADM_coreAudio.dll -lwinmm
+cd %curDir%
+
+echo.
+echo ** PCM Audio Encoder **
+
+cd audioEncoders\pcm
+%gxx% -shared *.cpp -o libADM_ae_pcm.dll -I%includeDir% -L%libDir% -lADM_core.dll -lADM_coreAudio.dll
+cd %curDir%
+
+echo.
+echo ** mpeg2enc Video Encoder **
+
+cd videoEncoders\mpeg2enc\mpeg2enc
+%gcc% -c *.c *.cc -I. -I%includeDir% -DHAVE_CONFIG_H -DHAVE_X86CPU
+%ar% rs libmpeg2enc.a *.o
+cd ..
+%gcc% -c *.c -I%includeDir%
+%gxx% -shared *.o *.cpp common\pluginOptions\*.cpp common\xvidRateCtl\*.cpp -o libADM_vidEnc_mpeg2enc.dll -I%includeDir% -I. -I.\mpeg2enc -I.\common\pluginOptions -I.\common\xvidRateCtl -DMPEG1_PLUGIN_CONFIG_DIR=\"mpeg2enc/mpeg-1\" -DMPEG2_PLUGIN_CONFIG_DIR=\"mpeg2enc/mpeg-2\" -L. -lxml2.dll -Lmpeg2enc -lmpeg2enc -L%libDir% -lADM_coreUI.dll -lADM_core.dll
+cd %curDir%
+
+echo.
+echo ** Fade Video Filter **
+
+cd videoFilters\fade
+%gxx% -shared *.cpp -o libADM_vf_fade.dll -I%includeDir% -L%libDir% -lADM_coreImage.dll -lADM_core.dll -lADM_coreUI.dll
+cd %curDir%
\ No newline at end of file



From mean at mail.berlios.de  Fri Apr 16 22:26:18 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 16 Apr 2010 22:26:18 +0200
Subject: [Avidemux-svn-commit] r6130 -
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv
Message-ID: <201004162026.o3GKQI8I026730@sheep.berlios.de>

Author: mean
Date: 2010-04-16 22:26:18 +0200 (Fri, 16 Apr 2010)
New Revision: 6130

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv/ADM_flv.h
Log:
[Flv] Better decoding of metadata, fixes #92

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp	2010-04-15 19:22:45 UTC (rev 6129)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp	2010-04-16 20:26:18 UTC (rev 6130)
@@ -27,7 +27,8 @@
 // Borrowed from lavformt/flv.h
 #include "libavformat/flv.h"
 // Borrowed from lavformt/flv.h    
-
+#define ADM_warning printfs
+#define LU  "u"
 uint32_t ADM_UsecFromFps1000(uint32_t fps1000);
 extern uint8_t extractH263FLVInfo(uint8_t *buffer,uint32_t len,uint32_t *w,uint32_t *h);
 /**
@@ -118,38 +119,51 @@
     }
 
 }
+
 /**
-    \fn parseMetaData
-    \brief
+    \fn parseOneMeta
 */
-uint8_t flvHeader::parseMetaData(uint32_t remaining)
+bool flvHeader::parseOneMeta(const char *s,uint64_t endPos)
 {
-    uint32_t endPos=ftello(_fd)+remaining;
-    {
-        // Check the first one is onMetaData...
-        uint8_t type=read8();
-
-        if(type!=AMF_DATA_TYPE_STRING) // String!
-            goto endit;
-        char *z=readFlvString();
-        printf("[FlashString] %s\n",z);
-        if(z && strncmp(z,"onMetaData",10)) goto endit;
-        // Normally the next one is mixed array
-        Skip(4);
-        Skip(1);
-        while(ftello(_fd)<endPos-4)
-        {
-
-            char *s=readFlvString();
-            printf("[FlvType] :%d String : %s",type,s);
-            type=read8();
+            int type=read8();
+            printf("type :%d : ",type);
             switch(type)
             {
+                case AMF_DATA_TYPE_OBJECT_END:break;
+                case AMF_DATA_TYPE_OBJECT: 
+                {
+                        printf("\n");
+                        while(ftello(_fd)<endPos-4)
+                        {
+                                char *o=readFlvString();
+                                printf("\t Object:%s",o);
+                                if(false==parseOneMeta(o,endPos)) return false;
+/*
+                                char objType=read8();
+                                printf("-->%d",objType);
+                                if(objType!=10) 
+                                {
+                                        ADM_warning("type is not strict array\n");
+                                        goto xxer;
+                                }
+                                int count=read32();
+                                printf(", count=%d\n",count);
+                                for(int i=0;i<count;i++)
+                                {
+                                        if(false==parseOneMeta(endPos)) return false;
+                                }
+                                break;
+*/
+                        }
+                        break;
+                        
+                }
                 case AMF_DATA_TYPE_ARRAY:
                                     {
                                             uint32_t len=read32();
-                                            printf("[FLV] Array :");
-                                            for(int i=0;i<len;i++) printf("%02x ",read8());
+                                            printf("\n\t[FLV] Array : %"LU" entries\n",len);
+                                            for(int i=0;i<len;i++) 
+                                                if(false==parseOneMeta("",endPos)) return false;
                                             printf("\n");
                                             break;
                                     }
@@ -161,20 +175,45 @@
                                             hi=read32();lo=read32();
                                             hi=(hi<<32)+lo;
                                             val=(float)av_int2dbl(hi);
-                                            printf("->%f\n",val);
+                                            printf("->%f",val);
                                             setProperties(s,val);
                                         }
                                         ;break;
                 case AMF_DATA_TYPE_STRING: {int r=read16();Skip(r);}break;
                 case AMF_DATA_TYPE_BOOL: read8();break;
-                case AMF_DATA_TYPE_OBJECT: goto endit; // unsupported for the moment
+                
                 default : printf("\n");ADM_assert(0);
             }
             printf("\n");
-
+            return true;
+xxer:
+    return false;
+}
+/**
+    \fn parseMetaData
+    \brief
+*/
+uint8_t flvHeader::parseMetaData(uint32_t remaining)
+{
+    uint32_t endPos=ftello(_fd)+remaining;
+    {
+        // Check the first one is onMetaData...
+        uint8_t type=read8();
+        if(type!=AMF_DATA_TYPE_STRING) // String!
+            goto endit;
+        char *z=readFlvString();
+        printf("[FlashString] %s\n",z);
+        if(z && strncmp(z,"onMetaData",10)) goto endit;
+        // Normally the next one is mixed array
+        Skip(4);
+        Skip(1);
+        while(ftello(_fd)<endPos-4)
+        {
+            char *s=readFlvString();
+            printf("[FlvType]  String : %s",s);
+            
+            if(false==parseOneMeta(s,endPos)) goto endit;
         }
-
-        // Process them...
     }
 endit:
     fseeko(_fd,endPos,SEEK_SET);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv/ADM_flv.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv/ADM_flv.h	2010-04-15 19:22:45 UTC (rev 6129)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_flv/ADM_flv.h	2010-04-16 20:26:18 UTC (rev 6130)
@@ -105,6 +105,7 @@
     
     uint8_t     getFrameSize (uint32_t frame, uint32_t * size);
     uint8_t     parseMetaData(uint32_t remaining);
+    bool        parseOneMeta(const char *s,uint64_t endPos);
     void        setProperties(const char *name,float value);
     char        *readFlvString(void);
  



From gruntster at mail.berlios.de  Sun Apr 18 14:21:50 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 18 Apr 2010 14:21:50 +0200
Subject: [Avidemux-svn-commit] r6131 -
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script
Message-ID: <201004181221.o3ICLo4K001119@sheep.berlios.de>

Author: gruntster
Date: 2010-04-18 14:21:45 +0200 (Sun, 18 Apr 2010)
New Revision: 6131

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSAvidemuxAudio.cpp
Log:
[js] check properly for missing audio streams

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSAvidemuxAudio.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSAvidemuxAudio.cpp	2010-04-16 20:26:18 UTC (rev 6130)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSAvidemuxAudio.cpp	2010-04-18 12:21:45 UTC (rev 6131)
@@ -178,7 +178,7 @@
 void ADM_JSAvidemuxAudio::AddAudioSourceToJSArray(JSContext *cx, JSObject *obj, int trackIndex, AudioSource audioSource, 
 												  AVDMGenericAudioStream *audioStream, JSObject *tracks)
 {
-	if (audioSource != AudioNone)
+	if (audioStream != NULL)
 	{
 		WAVHeader *trackHeader = audioStream->getInfo();
 



From gruntster at mail.berlios.de  Sun Apr 18 15:05:56 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 18 Apr 2010 15:05:56 +0200
Subject: [Avidemux-svn-commit] r6132 -
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec
Message-ID: <201004181305.o3ID5u5B003604@sheep.berlios.de>

Author: gruntster
Date: 2010-04-18 15:05:52 +0200 (Sun, 18 Apr 2010)
New Revision: 6132

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg1Encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg2Encoder.cpp
Log:
[avcodec] fix reuse existing log file for mpeg-1 & mpeg-2 avcodec video encoder plugins

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg1Encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg1Encoder.cpp	2010-04-18 12:21:45 UTC (rev 6131)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg1Encoder.cpp	2010-04-18 13:05:52 UTC (rev 6132)
@@ -431,7 +431,7 @@
 
 	if (_encodeOptions.encodeMode == ADM_VIDENC_MODE_CQP)
 		qz = _encodeOptions.encodeModeParameter;
-	else if (_encodeOptions.encodeMode == ADM_VIDENC_MODE_2PASS_SIZE || _encodeOptions.encodeMode == ADM_VIDENC_MODE_2PASS_ABR)
+	else if ((_encodeOptions.encodeMode == ADM_VIDENC_MODE_2PASS_SIZE || _encodeOptions.encodeMode == ADM_VIDENC_MODE_2PASS_ABR) && ret == ADM_VIDENC_ERR_SUCCESS)
 	{
 		if (_currentPass == 1)
 		{

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg2Encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg2Encoder.cpp	2010-04-18 12:21:45 UTC (rev 6131)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/mpeg2Encoder.cpp	2010-04-18 13:05:52 UTC (rev 6132)
@@ -457,7 +457,7 @@
 
 	if (_encodeOptions.encodeMode == ADM_VIDENC_MODE_CQP)
 		qz = _encodeOptions.encodeModeParameter;
-	else if (_encodeOptions.encodeMode == ADM_VIDENC_MODE_2PASS_SIZE || _encodeOptions.encodeMode == ADM_VIDENC_MODE_2PASS_ABR)
+	else if ((_encodeOptions.encodeMode == ADM_VIDENC_MODE_2PASS_SIZE || _encodeOptions.encodeMode == ADM_VIDENC_MODE_2PASS_ABR) && ret == ADM_VIDENC_ERR_SUCCESS)
 	{
 		if (_currentPass == 1)
 		{



From mean at mail.berlios.de  Mon Apr 19 20:02:27 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 19 Apr 2010 20:02:27 +0200
Subject: [Avidemux-svn-commit] r6133 - in
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script: .
	dialogFactory
Message-ID: <201004191802.o3JI2Rur030842@sheep.berlios.de>

Author: mean
Date: 2010-04-19 20:02:26 +0200 (Mon, 19 Apr 2010)
New Revision: 6133

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDF.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFInteger.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFInteger.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFMenu.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFMenu.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFToggle.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFToggle.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory_if.cpp
Removed:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDFMenu.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDFMenu.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDialogFactory.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDialogFactory.h
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSGlobal.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/CMakeLists.txt
Log:
[js/dialogFactory] Add toggle and integer to existing menu

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDFMenu.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDFMenu.cpp	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDFMenu.cpp	2010-04-19 18:02:26 UTC (rev 6133)
@@ -1,177 +0,0 @@
-#include "ADM_JSDFMenu.h"
-
-ADM_JSDFMenuHelper::ADM_JSDFMenuHelper(const char *title)
-{
-	_title = ADM_strdup(title);
-	_menuEntries = NULL;
-	_index = 0;
-}
-
-ADM_JSDFMenuHelper::~ADM_JSDFMenuHelper(void)
-{
-	if (_title)
-		delete _title;
-
-	_title = NULL;
-
-	std::vector<char*>::iterator it;
-
-	for (it = _items.begin(); it != _items.end(); it++)
-		delete *it;
-
-	_items.clear();
-
-	if (_menuEntries)
-		delete _menuEntries;
-
-	_menuEntries = NULL;
-}
-
-void ADM_JSDFMenuHelper::addItem(const char* item)
-{
-	_items.push_back(ADM_strdup(item));
-}
-
-diaElem* ADM_JSDFMenuHelper::getControl(void)
-{
-	if (_menuEntries)
-		delete _menuEntries;
-
-	std::vector<char*>::iterator it;
-	int i = 0;
-
-	_menuEntries = new diaMenuEntry[_items.size()];	
-
-	for (it = _items.begin(); it != _items.end(); it++)
-	{
-		_menuEntries[i].val = i;
-		_menuEntries[i].text = *it;
-		_menuEntries[i].desc = NULL;
-
-		i++;
-	}
-
-	return new diaElemMenu(&_index, _title, _items.size(), _menuEntries);
-}
-
-int ADM_JSDFMenuHelper::index(void)
-{
-	return _index;
-}
-
-void ADM_JSDFMenuHelper::setIndex(int index)
-{
-	_index = index;
-}
-
-JSPropertySpec ADM_JSDFMenu::properties[] = 
-{ 
-	{ "index", indexProperty, JSPROP_ENUMERATE },
-	{ 0 }
-};
-
-JSFunctionSpec ADM_JSDFMenu::methods[] =
-{
-	{ "addItem", addItem, 1, 0, 0 },
-	{ 0 }
-};
-
-JSClass ADM_JSDFMenu::m_dfMenuHelper =
-{
-	"DFMenu", JSCLASS_HAS_PRIVATE,
-	JS_PropertyStub, JS_PropertyStub,
-	ADM_JSDFMenu::JSGetProperty, ADM_JSDFMenu::JSSetProperty,
-	JS_EnumerateStub, JS_ResolveStub,
-	JS_ConvertStub, ADM_JSDFMenu::JSDestructor
-};
-
-JSObject *ADM_JSDFMenu::JSInit(JSContext *cx, JSObject *obj, JSObject *proto)
-{
-	return JS_InitClass(cx, obj, proto, &m_dfMenuHelper, 
-		ADM_JSDFMenu::JSConstructor, 1,
-		ADM_JSDFMenu::properties, ADM_JSDFMenu::methods,
-		NULL, NULL);
-}
-
-JSBool ADM_JSDFMenu::JSConstructor(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
-{
-	if (argc != 1)
-		return JS_FALSE;
-
-	if (!JSVAL_IS_STRING(argv[0]))
-		return JS_FALSE;
-
-	ADM_JSDFMenuHelper *pObject = new ADM_JSDFMenuHelper(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
-
-	if (!JS_SetPrivate(cx, obj, pObject))
-		return JS_FALSE;
-
-	*rval = OBJECT_TO_JSVAL(obj);
-
-	return JS_TRUE;
-}
-
-void ADM_JSDFMenu::JSDestructor(JSContext *cx, JSObject *obj)
-{
-	ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &m_dfMenuHelper, NULL);
-
-	if (pObject)
-		delete pObject;
-}
-
-JSBool ADM_JSDFMenu::addItem(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
-{
-	ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &m_dfMenuHelper, NULL);
-
-	if (argc != 1)
-		return JS_FALSE;
-
-	if (!JSVAL_IS_STRING(argv[0]))
-		return JS_FALSE;
-
-	pObject->addItem(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
-
-	return JS_TRUE;
-}
-
-JSBool ADM_JSDFMenu::JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
-{
-	if (JSVAL_IS_INT(id)) 
-	{
-		ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &m_dfMenuHelper, NULL);
-
-		switch(JSVAL_TO_INT(id))
-		{
-			case indexProperty:
-			{
-				*vp = INT_TO_JSVAL(pObject->index());
-				break;
-			}
-		}
-	}
-
-	return JS_TRUE;
-}
-
-JSBool ADM_JSDFMenu::JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
-{
-	if (JSVAL_IS_INT(id)) 
-	{
-		ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &m_dfMenuHelper, NULL);
-
-		switch(JSVAL_TO_INT(id))
-		{
-			case indexProperty:
-			{
-				if (JSVAL_IS_INT(*vp))
-					pObject->setIndex(JSVAL_TO_INT(*vp));
-
-				break;
-			}
-			default:
-				return JS_FALSE;
-		}
-	}
-
-	return JS_TRUE;
-}

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDFMenu.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDFMenu.h	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDFMenu.h	2010-04-19 18:02:26 UTC (rev 6133)
@@ -1,50 +0,0 @@
-#ifndef _ADM_JSDFMenu_H
-#define _ADM_JSDFMenu_H
-
-#include "config.h"
-#include "jsapi.h"
-#include "DIA_factory.h"
-#include <vector>
-
-class ADM_JSDFMenuHelper
-{
-private:
-	char* _title;
-	uint32_t _index;
-	diaMenuEntry *_menuEntries;
-	std::vector <char*> _items;
-
-public:
-	ADM_JSDFMenuHelper(const char *title);
-	~ADM_JSDFMenuHelper(void);
-	void addItem(const char* item);
-	diaElem* getControl(void);
-	int index(void);
-	void setIndex(int index);
-};
-
-class ADM_JSDFMenu
-{
-public:
-	ADM_JSDFMenu(void) {}
-
-	static JSBool JSConstructor(JSContext *cx, JSObject *obj, uintN argc, 
-								jsval *argv, jsval *rval);
-	static void JSDestructor(JSContext *cx, JSObject *obj);
-	static JSObject *JSInit(JSContext *cx, JSObject *obj, JSObject *proto = NULL);
-	static JSBool JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
-	static JSBool JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
-
-	static JSBool addItem(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);	
-
-	static JSPropertySpec properties[];
-	static JSFunctionSpec methods[];
-	static JSClass m_dfMenuHelper;
-
-	enum
-	{
-		indexProperty
-	};
-};
-
-#endif

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDialogFactory.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDialogFactory.cpp	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDialogFactory.cpp	2010-04-19 18:02:26 UTC (rev 6133)
@@ -1,123 +0,0 @@
-#include "ADM_JSDialogFactory.h"
-
-ADM_JSDialogFactoryHelper::ADM_JSDialogFactoryHelper(const char *title)
-{
-	_title = ADM_strdup(title);
-}
-
-ADM_JSDialogFactoryHelper::~ADM_JSDialogFactoryHelper(void)
-{
-	if (_title)
-		delete _title;
-
-	_title = NULL;
-}
-
-void ADM_JSDialogFactoryHelper::addControl(ADM_JSDFMenuHelper* control)
-{
-	_controls.push_back(control);
-}
-
-diaElem** ADM_JSDialogFactoryHelper::getControls(int *controlCount)
-{
-	*controlCount = (int)_controls.size();
-
-	std::vector<ADM_JSDFMenuHelper*>::iterator it;
-	int i = 0;
-	diaElem **elems = new diaElem*[*controlCount];
-
-	for (it = _controls.begin(); it != _controls.end(); it++)
-	{
-		elems[i] = (*it)->getControl();
-		i++;
-	}
-
-	return elems;
-}
-
-const char* ADM_JSDialogFactoryHelper::title(void)
-{
-	return _title;
-}
-
-JSFunctionSpec ADM_JSDialogFactory::methods[] =
-{
-	{ "addControl", addControl, 1, 0, 0 },
-	{ "show", show, 0, 0, 0 },
-	{ 0 }
-};
-
-JSClass ADM_JSDialogFactory::m_dialogFactoryHelper =
-{
-	"DialogFactory", JSCLASS_HAS_PRIVATE,
-	JS_PropertyStub, JS_PropertyStub,
-	JS_PropertyStub, JS_PropertyStub,
-	JS_EnumerateStub, JS_ResolveStub,
-	JS_ConvertStub, ADM_JSDialogFactory::JSDestructor
-};
-
-JSObject *ADM_JSDialogFactory::JSInit(JSContext *cx, JSObject *obj, JSObject *proto)
-{
-	return JS_InitClass(cx, obj, proto, &m_dialogFactoryHelper, 
-		ADM_JSDialogFactory::JSConstructor, 1,
-		NULL, ADM_JSDialogFactory::methods,
-		NULL, NULL);
-}
-
-JSBool ADM_JSDialogFactory::JSConstructor(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
-{
-	if (argc != 1)
-		return JS_FALSE;
-
-	if (JSVAL_IS_STRING(argv[0]) == false)
-		return JS_FALSE;
-
-	ADM_JSDialogFactoryHelper *pObject = new ADM_JSDialogFactoryHelper(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
-
-	if (!JS_SetPrivate(cx, obj, pObject))
-		return JS_FALSE;
-
-	*rval = OBJECT_TO_JSVAL(obj);
-
-	return JS_TRUE;
-}
-
-void ADM_JSDialogFactory::JSDestructor(JSContext *cx, JSObject *obj)
-{
-	ADM_JSDialogFactoryHelper *pObject = (ADM_JSDialogFactoryHelper*)JS_GetInstancePrivate(cx, obj, &m_dialogFactoryHelper, NULL);
-
-	if (pObject != NULL)
-		delete pObject;
-}
-
-JSBool ADM_JSDialogFactory::addControl(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
-{
-	ADM_JSDialogFactoryHelper *p = (ADM_JSDialogFactoryHelper*)JS_GetInstancePrivate(cx, obj, &m_dialogFactoryHelper, NULL);
-
-	if (argc != 1)
-		return JS_FALSE;
-
-	p->addControl((ADM_JSDFMenuHelper*)JS_GetPrivate(cx, JSVAL_TO_OBJECT(argv[0])));
-
-	return JS_TRUE;
-}
-
-JSBool ADM_JSDialogFactory::show(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
-{
-	ADM_JSDialogFactoryHelper *p = (ADM_JSDialogFactoryHelper*)JS_GetInstancePrivate(cx, obj, &m_dialogFactoryHelper, NULL);
-
-	if (argc != 0)
-		return JS_FALSE;
-
-	int controlCount;
-	diaElem **elems = p->getControls(&controlCount);
-
-	*rval = BOOLEAN_TO_JSVAL(diaFactoryRun(p->title(), controlCount, elems));
-
-	for (int i = 0; i < controlCount; i++)
-		delete elems[i];
-
-	delete elems;
-
-	return JS_TRUE;
-}

Deleted: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDialogFactory.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDialogFactory.h	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDialogFactory.h	2010-04-19 18:02:26 UTC (rev 6133)
@@ -1,41 +0,0 @@
-#ifndef _ADM_JSDialogFactory_H
-#define _ADM_JSDialogFactory_H
-
-#include "config.h"
-#include "jsapi.h"
-#include "DIA_factory.h"
-#include "ADM_JSDFMenu.h"
-#include <vector>
-
-class ADM_JSDialogFactoryHelper
-{
-private:
-	char* _title;
-	std::vector <ADM_JSDFMenuHelper*> _controls;
-
-public:
-	ADM_JSDialogFactoryHelper(const char *title);
-	~ADM_JSDialogFactoryHelper(void);
-	void addControl(ADM_JSDFMenuHelper* control);
-	diaElem** getControls(int *controlCount);
-	const char* title(void);
-};
-
-class ADM_JSDialogFactory
-{
-public:
-	ADM_JSDialogFactory(void) {}
-	virtual ~ADM_JSDialogFactory(void);
-
-	static JSBool JSConstructor(JSContext *cx, JSObject *obj, uintN argc, 
-								jsval *argv, jsval *rval);
-	static void JSDestructor(JSContext *cx, JSObject *obj);
-	static JSObject *JSInit(JSContext *cx, JSObject *obj, JSObject *proto = NULL);
-	static JSBool addControl(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
-	static JSBool show(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
-
-	static JSFunctionSpec methods[];
-	static JSClass m_dialogFactoryHelper;
-};
-
-#endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSGlobal.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSGlobal.cpp	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSGlobal.cpp	2010-04-19 18:02:26 UTC (rev 6133)
@@ -18,12 +18,13 @@
 #include "ADM_JSGlobal.h"
 #include "ADM_JSAvidemux.h"
 #include "ADM_JSDirectorySearch.h"
-#include "ADM_JSDialogFactory.h"
-#include "ADM_JSDFMenu.h"
+#include "dialogFactory/ADM_JSDialogFactory.h"
+#include "dialogFactory/ADM_JSDFMenu.h"
 
 extern uint8_t JS_AvidemuxFunction(JSContext *cx,JSObject *global);
 extern void A_Resync(void);
 extern char * actual_workbench_file;
+extern bool ADM_JSDialogFactoryInit(JSContext *cx, JSObject *obj);
 
 void
 printJSError(JSContext *cx, const char *message, JSErrorReport *report)
@@ -96,9 +97,10 @@
 			// load our custom JS class objects
 			JSObject *obj = ADM_JSAvidemux::JSInit(cx, global);
 			JSObject *dsObj = ADM_JSDirectorySearch::JSInit(cx, global);
-			JSObject *df = ADM_JSDialogFactory::JSInit(cx, global);
-			JSObject *dfmenu = ADM_JSDFMenu::JSInit(cx, global);
-
+                        if(false==ADM_JSDialogFactoryInit(cx,global))
+                        {
+                                printf("Cannot register dialog factory classes \n");
+                        }
 			// register error handler
 			JS_SetErrorReporter(cx, printJSError);
                         JS_AvidemuxFunction(cx,global);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/CMakeLists.txt	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/CMakeLists.txt	2010-04-19 18:02:26 UTC (rev 6133)
@@ -1,7 +1,13 @@
 SET(ADM_script_SRCS
 	ADM_AvidemuxAudio.cpp  ADM_AvidemuxVideo.cpp    ADM_JSAvidemux.cpp       ADM_JSDirectorySearch.cpp  ADM_JSGlobal.cpp
 	ADM_Avidemux.cpp       ADM_JSAvidemuxAudio.cpp  ADM_JSAvidemuxVideo.cpp  ADM_JSFunctions.cpp        DirectorySearch.cpp
-	ADM_JSDialogFactory.cpp  ADM_JSDFMenu.cpp  ADM_JSAppliedVideoFilter.cpp  ADM_JSAudioTrackInfo.cpp)
+        ADM_JSAppliedVideoFilter.cpp  ADM_JSAudioTrackInfo.cpp
+        dialogFactory/ADM_JSDFMenu.cpp
+        dialogFactory/ADM_JSDFToggle.cpp
+        dialogFactory/ADM_JSDialogFactory.cpp
+        dialogFactory/ADM_JSDialogFactory_if.cpp
+        dialogFactory/ADM_JSDFInteger.cpp
+)
 
 include_directories("${PTHREAD_INCLUDE_DIR}")
 ADD_ADM_LIB_ALL_TARGETS(ADM_script ${ADM_script_SRCS})
@@ -16,4 +22,4 @@
 	include_directories(${SPIDERMONKEY_INCLUDE_DIR})
 else (USE_SYSTEM_SPIDERMONKEY)
 	include_directories(${CMAKE_SOURCE_DIR}/avidemux/ADM_libraries/ADM_smjs)
-endif (USE_SYSTEM_SPIDERMONKEY)
\ No newline at end of file
+endif (USE_SYSTEM_SPIDERMONKEY)

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDF.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDF.h	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDF.h	2010-04-19 18:02:26 UTC (rev 6133)
@@ -0,0 +1,35 @@
+/**
+    \file   ADM_JSDF.h
+    \brief  JS / DF binding
+    \author gruntster/Mean 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef _ADM_JSDF_H
+#define _ADM_JSDF_H
+
+/**
+    \class ADM_JSBaseHelper
+*/
+class ADM_JSDFBaseHelper
+{
+public:
+                        ADM_JSDFBaseHelper() {};
+    virtual             ~ADM_JSDFBaseHelper() {};
+    virtual diaElem*    getControl(void)=0;
+};
+// Compatibility with 2.6
+#define ADM_error printf
+#define ADM_info  printf
+
+
+#endif

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFInteger.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFInteger.cpp	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFInteger.cpp	2010-04-19 18:02:26 UTC (rev 6133)
@@ -0,0 +1,160 @@
+/**
+    \file   ADM_JSDFInteger.cpp
+    \brief  JS / DF binding
+    \author gruntster/mean 2010
+
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "ADM_JSDFInteger.h"
+
+ADM_JSDFIntegerHelper::ADM_JSDFIntegerHelper(const char *title,int32_t mn,int32_t mx)
+{
+	_title = ADM_strdup(title); 
+    _min=mn;
+    _max=mx;
+	_value = 0;
+}
+
+ADM_JSDFIntegerHelper::~ADM_JSDFIntegerHelper(void)
+{
+	if (_title)
+		delete _title;
+
+	_title = NULL;
+
+
+}
+
+
+diaElem* ADM_JSDFIntegerHelper::getControl(void)
+{
+    return new diaElemInteger(&_value,_title, _min,_max);
+}
+
+int32_t ADM_JSDFIntegerHelper::value(void)
+{
+	return _value;
+}
+
+void ADM_JSDFIntegerHelper::setValue(int32_t index)
+{
+	_value = index;
+}
+/*************************************************/
+JSPropertySpec ADM_JSDFInteger::properties[] = 
+{ 
+	{ "value", valueProperty, JSPROP_ENUMERATE },
+	{ 0 }
+};
+
+JSFunctionSpec ADM_JSDFInteger::methods[] =
+{
+	{ 0 }
+};
+
+JSClass ADM_JSDFInteger::m_dfIntegerHelper =
+{
+	"DFInteger", JSCLASS_HAS_PRIVATE,
+	JS_PropertyStub, JS_PropertyStub,
+	ADM_JSDFInteger::JSGetProperty, ADM_JSDFInteger::JSSetProperty,
+	JS_EnumerateStub, JS_ResolveStub,
+	JS_ConvertStub, ADM_JSDFInteger::JSDestructor
+};
+
+JSObject *ADM_JSDFInteger::JSInit(JSContext *cx, JSObject *obj, JSObject *proto)
+{
+	return JS_InitClass(cx, obj, proto, &m_dfIntegerHelper, 
+		ADM_JSDFInteger::JSConstructor, 1,
+		ADM_JSDFInteger::properties, ADM_JSDFInteger::methods,
+		NULL, NULL);
+}
+/**
+    \fn ctor
+*/
+JSBool ADM_JSDFInteger::JSConstructor(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	if (argc != 3)
+		return JS_FALSE;
+
+	if (!JSVAL_IS_STRING(argv[0]))
+		return JS_FALSE;
+
+	if (!JSVAL_IS_INT(argv[1]))
+		return JS_FALSE;
+
+	if (!JSVAL_IS_INT(argv[2]))
+		return JS_FALSE;
+
+
+	ADM_JSDFIntegerHelper *pObject = new ADM_JSDFIntegerHelper(
+                                                    JS_GetStringBytes(JSVAL_TO_STRING(argv[0])),
+                                                    JSVAL_TO_INT(argv[1]),
+                                                    JSVAL_TO_INT(argv[2])
+                                                );
+
+	if (!JS_SetPrivate(cx, obj, pObject))
+		return JS_FALSE;
+
+	*rval = OBJECT_TO_JSVAL(obj);
+
+	return JS_TRUE;
+}
+
+void ADM_JSDFInteger::JSDestructor(JSContext *cx, JSObject *obj)
+{
+	ADM_JSDFIntegerHelper *pObject = (ADM_JSDFIntegerHelper*)JS_GetInstancePrivate(cx, obj, &m_dfIntegerHelper, NULL);
+
+	if (pObject)
+		delete pObject;
+}
+
+JSBool ADM_JSDFInteger::JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
+{
+	if (JSVAL_IS_INT(id)) 
+	{
+		ADM_JSDFIntegerHelper *pObject = (ADM_JSDFIntegerHelper*)JS_GetInstancePrivate(cx, obj, &m_dfIntegerHelper, NULL);
+
+		switch(JSVAL_TO_INT(id))
+		{
+			case valueProperty:
+			{
+				*vp = INT_TO_JSVAL(pObject->value());
+				break;
+			}
+		}
+	}
+
+	return JS_TRUE;
+}
+
+JSBool ADM_JSDFInteger::JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
+{
+	if (JSVAL_IS_INT(id)) 
+	{
+		ADM_JSDFIntegerHelper *pObject = (ADM_JSDFIntegerHelper*)JS_GetInstancePrivate(cx, obj, &m_dfIntegerHelper, NULL);
+
+		switch(JSVAL_TO_INT(id))
+		{
+			case valueProperty:
+			{
+				if (JSVAL_IS_INT(*vp))
+					pObject->setValue(JSVAL_TO_INT(*vp));
+
+				break;
+			}
+			default:
+				return JS_FALSE;
+		}
+	}
+
+	return JS_TRUE;
+}

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFInteger.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFInteger.h	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFInteger.h	2010-04-19 18:02:26 UTC (rev 6133)
@@ -0,0 +1,66 @@
+/**
+    \file   ADM_JSDFInteger.h
+    \brief  JS / DF binding
+    \author gruntster/mean 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef _ADM_JSDFInteger_H
+#define _ADM_JSDFInteger_H
+
+#include "jsapi.h"
+#include "DIA_factory.h"
+#include "ADM_JSDF.h"
+/**
+    \class ADM_JSDFIntegerHelper
+*/
+class ADM_JSDFIntegerHelper : public ADM_JSDFBaseHelper
+{
+private:
+	char                *_title;
+	int32_t             _value;
+    int32_t             _min,_max;
+
+public:
+                     ADM_JSDFIntegerHelper(const char *title,int32_t mn, int32_t mx);
+                     ~ADM_JSDFIntegerHelper(void);
+	virtual diaElem* getControl(void);
+            int32_t value(void);
+            void     setValue(int32_t value);
+};
+/**
+    \class ADM_JSDFInteger
+*/
+class ADM_JSDFInteger
+{
+protected:
+    int32_t   minimum,maximum;
+public:
+	ADM_JSDFInteger(int32_t mn,int32_t mx) {minimum=mn;maximum=mx;}
+
+	static JSBool         JSConstructor(JSContext *cx, JSObject *obj, uintN argc, 
+								jsval *argv, jsval *rval);
+	static void           JSDestructor(JSContext *cx, JSObject *obj);
+	static JSObject       *JSInit(JSContext *cx, JSObject *obj, JSObject *proto = NULL);
+	static JSBool         JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+	static JSBool         JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+	static JSPropertySpec properties[];
+	static JSFunctionSpec methods[];
+	static JSClass        m_dfIntegerHelper;
+
+	enum
+	{
+		valueProperty
+	};
+};
+
+#endif

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFMenu.cpp (from rev 6132, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDFMenu.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDFMenu.cpp	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFMenu.cpp	2010-04-19 18:02:26 UTC (rev 6133)
@@ -0,0 +1,193 @@
+/**
+    \file   ADM_JSDFMenu.cpp
+    \brief  JS / DF binding
+    \author gruntster 2010
+
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "ADM_JSDFMenu.h"
+
+ADM_JSDFMenuHelper::ADM_JSDFMenuHelper(const char *title)
+{
+	_title = ADM_strdup(title);
+	_menuEntries = NULL;
+	_index = 0;
+}
+
+ADM_JSDFMenuHelper::~ADM_JSDFMenuHelper(void)
+{
+	if (_title)
+		delete _title;
+
+	_title = NULL;
+
+	std::vector<char*>::iterator it;
+
+	for (it = _items.begin(); it != _items.end(); it++)
+		delete *it;
+
+	_items.clear();
+
+	if (_menuEntries)
+		delete _menuEntries;
+
+	_menuEntries = NULL;
+}
+
+void ADM_JSDFMenuHelper::addItem(const char* item)
+{
+	_items.push_back(ADM_strdup(item));
+}
+
+diaElem* ADM_JSDFMenuHelper::getControl(void)
+{
+	if (_menuEntries)
+		delete _menuEntries;
+
+	std::vector<char*>::iterator it;
+	int i = 0;
+
+	_menuEntries = new diaMenuEntry[_items.size()];	
+
+	for (it = _items.begin(); it != _items.end(); it++)
+	{
+		_menuEntries[i].val = i;
+		_menuEntries[i].text = *it;
+		_menuEntries[i].desc = NULL;
+
+		i++;
+	}
+
+	return new diaElemMenu(&_index, _title, _items.size(), _menuEntries);
+}
+
+int ADM_JSDFMenuHelper::index(void)
+{
+	return _index;
+}
+
+void ADM_JSDFMenuHelper::setIndex(int index)
+{
+	_index = index;
+}
+
+JSPropertySpec ADM_JSDFMenu::properties[] = 
+{ 
+	{ "index", indexProperty, JSPROP_ENUMERATE },
+	{ 0 }
+};
+
+JSFunctionSpec ADM_JSDFMenu::methods[] =
+{
+	{ "addItem", addItem, 1, 0, 0 },
+	{ 0 }
+};
+
+JSClass ADM_JSDFMenu::m_dfMenuHelper =
+{
+	"DFMenu", JSCLASS_HAS_PRIVATE,
+	JS_PropertyStub, JS_PropertyStub,
+	ADM_JSDFMenu::JSGetProperty, ADM_JSDFMenu::JSSetProperty,
+	JS_EnumerateStub, JS_ResolveStub,
+	JS_ConvertStub, ADM_JSDFMenu::JSDestructor
+};
+
+JSObject *ADM_JSDFMenu::JSInit(JSContext *cx, JSObject *obj, JSObject *proto)
+{
+	return JS_InitClass(cx, obj, proto, &m_dfMenuHelper, 
+		ADM_JSDFMenu::JSConstructor, 1,
+		ADM_JSDFMenu::properties, ADM_JSDFMenu::methods,
+		NULL, NULL);
+}
+
+JSBool ADM_JSDFMenu::JSConstructor(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	if (argc != 1)
+		return JS_FALSE;
+
+	if (!JSVAL_IS_STRING(argv[0]))
+		return JS_FALSE;
+
+	ADM_JSDFMenuHelper *pObject = new ADM_JSDFMenuHelper(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
+
+	if (!JS_SetPrivate(cx, obj, pObject))
+		return JS_FALSE;
+
+	*rval = OBJECT_TO_JSVAL(obj);
+
+	return JS_TRUE;
+}
+
+void ADM_JSDFMenu::JSDestructor(JSContext *cx, JSObject *obj)
+{
+	ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &m_dfMenuHelper, NULL);
+
+	if (pObject)
+		delete pObject;
+}
+
+JSBool ADM_JSDFMenu::addItem(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &m_dfMenuHelper, NULL);
+
+	if (argc != 1)
+		return JS_FALSE;
+
+	if (!JSVAL_IS_STRING(argv[0]))
+		return JS_FALSE;
+
+	pObject->addItem(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
+
+	return JS_TRUE;
+}
+
+JSBool ADM_JSDFMenu::JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
+{
+	if (JSVAL_IS_INT(id)) 
+	{
+		ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &m_dfMenuHelper, NULL);
+
+		switch(JSVAL_TO_INT(id))
+		{
+			case indexProperty:
+			{
+				*vp = INT_TO_JSVAL(pObject->index());
+				break;
+			}
+		}
+	}
+
+	return JS_TRUE;
+}
+
+JSBool ADM_JSDFMenu::JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
+{
+	if (JSVAL_IS_INT(id)) 
+	{
+		ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &m_dfMenuHelper, NULL);
+
+		switch(JSVAL_TO_INT(id))
+		{
+			case indexProperty:
+			{
+				if (JSVAL_IS_INT(*vp))
+					pObject->setIndex(JSVAL_TO_INT(*vp));
+
+				break;
+			}
+			default:
+				return JS_FALSE;
+		}
+	}
+
+	return JS_TRUE;
+}

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFMenu.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFMenu.h	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFMenu.h	2010-04-19 18:02:26 UTC (rev 6133)
@@ -0,0 +1,70 @@
+/**
+    \file   ADM_JSDFMenu.h
+    \brief  JS / DF binding
+    \author gruntster 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef _ADM_JSDFMenu_H
+#define _ADM_JSDFMenu_H
+
+#include "jsapi.h"
+#include "DIA_factory.h"
+#include "ADM_JSDF.h"
+#include <vector>
+/**
+    \class ADM_JSDFMenuHelper
+*/
+class ADM_JSDFMenuHelper : public ADM_JSDFBaseHelper
+{
+private:
+	char                *_title;
+	uint32_t            _index;
+	diaMenuEntry        *_menuEntries;
+	std::vector <char*> _items;
+
+public:
+                     ADM_JSDFMenuHelper(const char *title);
+                     ~ADM_JSDFMenuHelper(void);
+            void     addItem(const char* item);
+	virtual diaElem* getControl(void);
+            int      index(void);
+            void     setIndex(int index);
+};
+/**
+    \class ADM_JSDFMenu
+*/
+class ADM_JSDFMenu
+{
+public:
+	ADM_JSDFMenu(void) {}
+
+	static JSBool   JSConstructor(JSContext *cx, JSObject *obj, uintN argc, 
+								jsval *argv, jsval *rval);
+	static void     JSDestructor(JSContext *cx, JSObject *obj);
+	static JSObject *JSInit(JSContext *cx, JSObject *obj, JSObject *proto = NULL);
+	static JSBool   JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+	static JSBool   JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+
+	static JSBool   addItem(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);	
+
+	static JSPropertySpec properties[];
+	static JSFunctionSpec methods[];
+	static JSClass m_dfMenuHelper;
+
+	enum
+	{
+		indexProperty
+	};
+};
+
+#endif

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFToggle.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFToggle.cpp	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFToggle.cpp	2010-04-19 18:02:26 UTC (rev 6133)
@@ -0,0 +1,147 @@
+/**
+    \file   ADM_JSDFToggle.cpp
+    \brief  JS / DF binding
+    \author gruntster/mean 2010
+
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "ADM_JSDFToggle.h"
+
+ADM_JSDFToggleHelper::ADM_JSDFToggleHelper(const char *title)
+{
+	_title = ADM_strdup(title);
+	_value = 0;
+}
+
+ADM_JSDFToggleHelper::~ADM_JSDFToggleHelper(void)
+{
+	if (_title)
+		delete _title;
+
+	_title = NULL;
+
+
+}
+
+
+diaElem* ADM_JSDFToggleHelper::getControl(void)
+{
+    return new   diaElemToggle(&_value,_title,NULL);
+}
+
+uint32_t ADM_JSDFToggleHelper::value(void)
+{
+	return _value;
+}
+
+void ADM_JSDFToggleHelper::setValue(uint32_t index)
+{
+	_value = index;
+}
+/*************************************************/
+JSPropertySpec ADM_JSDFToggle::properties[] = 
+{ 
+	{ "value", valueProperty, JSPROP_ENUMERATE },
+	{ 0 }
+};
+
+JSFunctionSpec ADM_JSDFToggle::methods[] =
+{
+	{ 0 }
+};
+
+JSClass ADM_JSDFToggle::m_dfToggleHelper =
+{
+	"DFToggle", JSCLASS_HAS_PRIVATE,
+	JS_PropertyStub, JS_PropertyStub,
+	ADM_JSDFToggle::JSGetProperty, ADM_JSDFToggle::JSSetProperty,
+	JS_EnumerateStub, JS_ResolveStub,
+	JS_ConvertStub, ADM_JSDFToggle::JSDestructor
+};
+
+JSObject *ADM_JSDFToggle::JSInit(JSContext *cx, JSObject *obj, JSObject *proto)
+{
+	return JS_InitClass(cx, obj, proto, &m_dfToggleHelper, 
+		ADM_JSDFToggle::JSConstructor, 1,
+		ADM_JSDFToggle::properties, ADM_JSDFToggle::methods,
+		NULL, NULL);
+}
+/**
+    \fn ctor
+*/
+JSBool ADM_JSDFToggle::JSConstructor(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	if (argc != 1)
+		return JS_FALSE;
+
+	if (!JSVAL_IS_STRING(argv[0]))
+		return JS_FALSE;
+
+	ADM_JSDFToggleHelper *pObject = new ADM_JSDFToggleHelper(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
+
+	if (!JS_SetPrivate(cx, obj, pObject))
+		return JS_FALSE;
+
+	*rval = OBJECT_TO_JSVAL(obj);
+
+	return JS_TRUE;
+}
+
+void ADM_JSDFToggle::JSDestructor(JSContext *cx, JSObject *obj)
+{
+	ADM_JSDFToggleHelper *pObject = (ADM_JSDFToggleHelper*)JS_GetInstancePrivate(cx, obj, &m_dfToggleHelper, NULL);
+
+	if (pObject)
+		delete pObject;
+}
+
+JSBool ADM_JSDFToggle::JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
+{
+	if (JSVAL_IS_INT(id)) 
+	{
+		ADM_JSDFToggleHelper *pObject = (ADM_JSDFToggleHelper*)JS_GetInstancePrivate(cx, obj, &m_dfToggleHelper, NULL);
+
+		switch(JSVAL_TO_INT(id))
+		{
+			case valueProperty:
+			{
+				*vp = INT_TO_JSVAL(pObject->value());
+				break;
+			}
+		}
+	}
+
+	return JS_TRUE;
+}
+
+JSBool ADM_JSDFToggle::JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
+{
+	if (JSVAL_IS_INT(id)) 
+	{
+		ADM_JSDFToggleHelper *pObject = (ADM_JSDFToggleHelper*)JS_GetInstancePrivate(cx, obj, &m_dfToggleHelper, NULL);
+
+		switch(JSVAL_TO_INT(id))
+		{
+			case valueProperty:
+			{
+				if (JSVAL_IS_INT(*vp))
+					pObject->setValue(JSVAL_TO_INT(*vp));
+
+				break;
+			}
+			default:
+				return JS_FALSE;
+		}
+	}
+
+	return JS_TRUE;
+}

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFToggle.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFToggle.h	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDFToggle.h	2010-04-19 18:02:26 UTC (rev 6133)
@@ -0,0 +1,63 @@
+/**
+    \file   ADM_JSDFToggle.h
+    \brief  JS / DF binding
+    \author gruntster/mean 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef _ADM_JSDFToggle_H
+#define _ADM_JSDFToggle_H
+
+#include "jsapi.h"
+#include "DIA_factory.h"
+#include "ADM_JSDF.h"
+/**
+    \class ADM_JSDFToggleHelper
+*/
+class ADM_JSDFToggleHelper : public ADM_JSDFBaseHelper
+{
+private:
+	char                *_title;
+	uint32_t            _value;
+
+public:
+                     ADM_JSDFToggleHelper(const char *title);
+                     ~ADM_JSDFToggleHelper(void);
+	virtual diaElem* getControl(void);
+            uint32_t value(void);
+            void     setValue(uint32_t value);
+};
+/**
+    \class ADM_JSDFToggle
+*/
+class ADM_JSDFToggle
+{
+public:
+	ADM_JSDFToggle(void) {}
+
+	static JSBool         JSConstructor(JSContext *cx, JSObject *obj, uintN argc, 
+								jsval *argv, jsval *rval);
+	static void           JSDestructor(JSContext *cx, JSObject *obj);
+	static JSObject       *JSInit(JSContext *cx, JSObject *obj, JSObject *proto = NULL);
+	static JSBool         JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+	static JSBool         JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+	static JSPropertySpec properties[];
+	static JSFunctionSpec methods[];
+	static JSClass        m_dfToggleHelper;
+
+	enum
+	{
+		valueProperty
+	};
+};
+
+#endif

Copied: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory.cpp (from rev 6132, branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDialogFactory.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/ADM_JSDialogFactory.cpp	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory.cpp	2010-04-19 18:02:26 UTC (rev 6133)
@@ -0,0 +1,138 @@
+/**
+    \file   ADM_JSDialogFactory.cpp
+    \brief  JS / DF binding
+    \author gruntster 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "ADM_JSDialogFactory.h"
+
+ADM_JSDialogFactoryHelper::ADM_JSDialogFactoryHelper(const char *title)
+{
+	_title = ADM_strdup(title);
+}
+
+ADM_JSDialogFactoryHelper::~ADM_JSDialogFactoryHelper(void)
+{
+	if (_title)
+		delete _title;
+
+	_title = NULL;
+}
+
+void ADM_JSDialogFactoryHelper::addControl(ADM_JSDFBaseHelper* control)
+{
+	_controls.push_back(control);
+}
+
+diaElem** ADM_JSDialogFactoryHelper::getControls(int *controlCount)
+{
+	*controlCount = (int)_controls.size();
+
+	std::vector<ADM_JSDFBaseHelper*>::iterator it;
+	int i = 0;
+	diaElem **elems = new diaElem*[*controlCount];
+
+	for (it = _controls.begin(); it != _controls.end(); it++)
+	{
+		elems[i] = (*it)->getControl();
+		i++;
+	}
+
+	return elems;
+}
+
+const char* ADM_JSDialogFactoryHelper::title(void)
+{
+	return _title;
+}
+
+JSFunctionSpec ADM_JSDialogFactory::methods[] =
+{
+	{ "addControl", addControl, 1, 0, 0 },
+	{ "show", show, 0, 0, 0 },
+	{ 0 }
+};
+
+JSClass ADM_JSDialogFactory::m_dialogFactoryHelper =
+{
+	"DialogFactory", JSCLASS_HAS_PRIVATE,
+	JS_PropertyStub, JS_PropertyStub,
+	JS_PropertyStub, JS_PropertyStub,
+	JS_EnumerateStub, JS_ResolveStub,
+	JS_ConvertStub, ADM_JSDialogFactory::JSDestructor
+};
+
+JSObject *ADM_JSDialogFactory::JSInit(JSContext *cx, JSObject *obj, JSObject *proto)
+{
+	return JS_InitClass(cx, obj, proto, &m_dialogFactoryHelper, 
+		ADM_JSDialogFactory::JSConstructor, 1,
+		NULL, ADM_JSDialogFactory::methods,
+		NULL, NULL);
+}
+
+JSBool ADM_JSDialogFactory::JSConstructor(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	if (argc != 1)
+		return JS_FALSE;
+
+	if (JSVAL_IS_STRING(argv[0]) == false)
+		return JS_FALSE;
+
+	ADM_JSDialogFactoryHelper *pObject = new ADM_JSDialogFactoryHelper(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
+
+	if (!JS_SetPrivate(cx, obj, pObject))
+		return JS_FALSE;
+
+	*rval = OBJECT_TO_JSVAL(obj);
+
+	return JS_TRUE;
+}
+
+void ADM_JSDialogFactory::JSDestructor(JSContext *cx, JSObject *obj)
+{
+	ADM_JSDialogFactoryHelper *pObject = (ADM_JSDialogFactoryHelper*)JS_GetInstancePrivate(cx, obj, &m_dialogFactoryHelper, NULL);
+
+	if (pObject != NULL)
+		delete pObject;
+}
+
+JSBool ADM_JSDialogFactory::addControl(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	ADM_JSDialogFactoryHelper *p = (ADM_JSDialogFactoryHelper*)JS_GetInstancePrivate(cx, obj, &m_dialogFactoryHelper, NULL);
+
+	if (argc != 1)
+		return JS_FALSE;
+
+	p->addControl((ADM_JSDFMenuHelper*)JS_GetPrivate(cx, JSVAL_TO_OBJECT(argv[0])));
+
+	return JS_TRUE;
+}
+
+JSBool ADM_JSDialogFactory::show(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	ADM_JSDialogFactoryHelper *p = (ADM_JSDialogFactoryHelper*)JS_GetInstancePrivate(cx, obj, &m_dialogFactoryHelper, NULL);
+
+	if (argc != 0)
+		return JS_FALSE;
+
+	int controlCount;
+	diaElem **elems = p->getControls(&controlCount);
+
+	*rval = BOOLEAN_TO_JSVAL(diaFactoryRun(p->title(), controlCount, elems));
+
+	for (int i = 0; i < controlCount; i++)
+		delete elems[i];
+
+	delete elems;
+
+	return JS_TRUE;
+}

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory.h	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory.h	2010-04-19 18:02:26 UTC (rev 6133)
@@ -0,0 +1,61 @@
+/**
+    \file   ADM_JSDialogFactory.h
+    \brief  JS / DF binding
+    \author gruntster 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef _ADM_JSDialogFactory_H
+#define _ADM_JSDialogFactory_H
+
+#include "jsapi.h"
+#include "DIA_factory.h"
+#include "ADM_JSDFMenu.h"
+#include <vector>
+/**
+    \class ADM_JSDialogFactoryHelper
+*/
+class ADM_JSDialogFactoryHelper
+{
+private:
+	char* _title;
+	std::vector <ADM_JSDFBaseHelper*> _controls;
+
+public:
+	ADM_JSDialogFactoryHelper(const char *title);
+	~ADM_JSDialogFactoryHelper(void);
+	void addControl(ADM_JSDFBaseHelper* control);
+	diaElem** getControls(int *controlCount);
+	const char* title(void);
+};
+/**
+    \class ADM_JSDialogFactory
+*/
+
+class ADM_JSDialogFactory
+{
+public:
+	ADM_JSDialogFactory(void) {}
+	virtual ~ADM_JSDialogFactory(void);
+
+	static JSBool JSConstructor(JSContext *cx, JSObject *obj, uintN argc, 
+								jsval *argv, jsval *rval);
+	static void JSDestructor(JSContext *cx, JSObject *obj);
+	static JSObject *JSInit(JSContext *cx, JSObject *obj, JSObject *proto = NULL);
+	static JSBool addControl(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
+	static JSBool show(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
+
+	static JSFunctionSpec methods[];
+	static JSClass m_dialogFactoryHelper;
+};
+
+#endif

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory_if.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory_if.cpp	2010-04-18 13:05:52 UTC (rev 6132)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_script/dialogFactory/ADM_JSDialogFactory_if.cpp	2010-04-19 18:02:26 UTC (rev 6133)
@@ -0,0 +1,56 @@
+/**
+    \file   ADM_JSDialogFactory_if.cpp
+    \brief  JS / DF binding
+    \author gruntster, mean (c) 2010
+
+
+    jsapigen does not like much variable number of arguments
+    In that case, we patch the generated file to go back to native spidermonkey api
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "ADM_default.h"
+#include "jsapi.h"
+#include "DIA_factory.h"
+#include "ADM_JSDFMenu.h"
+#include "ADM_JSDFToggle.h"
+#include "ADM_JSDFInteger.h"
+#include "ADM_JSDialogFactory.h"
+
+/**
+    \fn ADM_JSDialogFactoryInit()
+    \brief Hook classes to spidermonkey
+*/
+bool ADM_JSDialogFactoryInit(JSContext *cx, JSObject *obj)
+{
+    if(NULL==ADM_JSDialogFactory::JSInit(cx,obj))
+    {
+        ADM_error("Cannot register dialogFactory js class\n");
+        return false;
+    }
+    if(NULL==ADM_JSDFMenu::JSInit(cx,obj))
+    {
+        ADM_error("Cannot register  menu js class\n");
+        return false;
+    }
+    if(NULL==ADM_JSDFToggle::JSInit(cx,obj))
+    {
+        ADM_error("Cannot register toggle js class\n");
+        return false;
+    }
+    if(NULL==ADM_JSDFInteger::JSInit(cx,obj))
+    {
+        ADM_error("Cannot register integer js class\n");
+        return false;
+    }
+    ADM_info("Registered DialogFactory classes\n");
+    return true;
+}
\ No newline at end of file



From mean at mail.berlios.de  Sun Apr 25 16:30:37 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 25 Apr 2010 16:30:37 +0200
Subject: [Avidemux-svn-commit] r6134 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Flv
Message-ID: <201004251430.o3PEUbQa014950@sheep.berlios.de>

Author: mean
Date: 2010-04-25 16:30:34 +0200 (Sun, 25 Apr 2010)
New Revision: 6134

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Flv/ADM_flv.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Flv/ADM_flv.h
Log:
[Flv] Better decoding of metadata, refs # 92

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Flv/ADM_flv.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Flv/ADM_flv.cpp	2010-04-19 18:02:26 UTC (rev 6133)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Flv/ADM_flv.cpp	2010-04-25 14:30:34 UTC (rev 6134)
@@ -119,37 +119,49 @@
 
 }
 /**
-    \fn parseMetaData
-    \brief
+    \fn parseOneMeta
 */
-uint8_t flvHeader::parseMetaData(uint32_t remaining)
+bool flvHeader::parseOneMeta(const char *s,uint64_t endPos)
 {
-    uint32_t endPos=ftello(_fd)+remaining;
-    {
-        // Check the first one is onMetaData...
-        uint8_t type=read8();
-
-        if(type!=AMF_DATA_TYPE_STRING) // String!
-            goto endit;
-        char *z=readFlvString();
-        printf("[FlashString] %s\n",z);
-        if(z && strncmp(z,"onMetaData",10)) goto endit;
-        // Normally the next one is mixed array
-        Skip(4);
-        Skip(1);
-        while(ftello(_fd)<endPos-4)
-        {
-
-            char *s=readFlvString();
-            printf("[FlvType] :%d String : %s",type,s);
-            type=read8();
+            int type=read8();
+            printf("type :%d : ",type);
             switch(type)
             {
+                case AMF_DATA_TYPE_OBJECT_END:break;
+                case AMF_DATA_TYPE_OBJECT: 
+                {
+                        printf("\n");
+                        while(ftello(_fd)<endPos-4)
+                        {
+                                char *o=readFlvString();
+                                printf("\t Object:%s",o);
+                                if(false==parseOneMeta(o,endPos)) return false;
+/*
+                                char objType=read8();
+                                printf("-->%d",objType);
+                                if(objType!=10) 
+                                {
+                                        ADM_warning("type is not strict array\n");
+                                        goto xxer;
+                                }
+                                int count=read32();
+                                printf(", count=%d\n",count);
+                                for(int i=0;i<count;i++)
+                                {
+                                        if(false==parseOneMeta(endPos)) return false;
+                                }
+                                break;
+*/
+                        }
+                        break;
+                        
+                }
                 case AMF_DATA_TYPE_ARRAY:
                                     {
                                             uint32_t len=read32();
-                                            printf("[FLV] Array :");
-                                            for(int i=0;i<len;i++) printf("%02x ",read8());
+                                            printf("\n\t[FLV] Array : %"LU" entries\n",len);
+                                            for(int i=0;i<len;i++) 
+                                                if(false==parseOneMeta("",endPos)) return false;
                                             printf("\n");
                                             break;
                                     }
@@ -167,14 +179,39 @@
                                         ;break;
                 case AMF_DATA_TYPE_STRING: {int r=read16();Skip(r);}break;
                 case AMF_DATA_TYPE_BOOL: read8();break;
-                case AMF_DATA_TYPE_OBJECT: goto endit; // unsupported for the moment
+                
                 default : printf("\n");ADM_assert(0);
             }
             printf("\n");
-
+            return true;
+xxer:
+    return false;
+}
+/**
+    \fn parseMetaData
+    \brief
+*/
+uint8_t flvHeader::parseMetaData(uint32_t remaining)
+{
+    uint32_t endPos=ftello(_fd)+remaining;
+    {
+        // Check the first one is onMetaData...
+        uint8_t type=read8();
+        if(type!=AMF_DATA_TYPE_STRING) // String!
+            goto endit;
+        char *z=readFlvString();
+        printf("[FlashString] %s\n",z);
+        if(z && strncmp(z,"onMetaData",10)) goto endit;
+        // Normally the next one is mixed array
+        Skip(4);
+        Skip(1);
+        while(ftello(_fd)<endPos-4)
+        {
+            char *s=readFlvString();
+            printf("[FlvType]  String : %s",s);
+            
+            if(false==parseOneMeta(s,endPos)) goto endit;
         }
-
-        // Process them...
     }
 endit:
     fseeko(_fd,endPos,SEEK_SET);

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Flv/ADM_flv.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Flv/ADM_flv.h	2010-04-19 18:02:26 UTC (rev 6133)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Flv/ADM_flv.h	2010-04-25 14:30:34 UTC (rev 6134)
@@ -121,6 +121,7 @@
     uint8_t     parseMetaData(uint32_t remaining);
     void        setProperties(const char *name,float value);
     uint32_t    searchMinimum(void);
+    bool        parseOneMeta(const char *key,uint64_t endPos);
   public:
 
 



From mean at mail.berlios.de  Sun Apr 25 16:30:39 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 25 Apr 2010 16:30:39 +0200
Subject: [Avidemux-svn-commit] r6135 - in
	branches/avidemux_2.6_branch_mean/avidemux: .
	common/ADM_script2 common/ADM_script2/include
	common/ADM_script2/src common/ADM_script2/src_dialogFactory
Message-ID: <201004251430.o3PEUdEZ014981@sheep.berlios.de>

Author: mean
Date: 2010-04-25 16:30:38 +0200 (Sun, 25 Apr 2010)
New Revision: 6135

Added:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_jsDFactory.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFMenu.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFMenu.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/CMakeLists.txt
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_js.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsIf.cpp
   branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake
Log:
[JS/DF] Import from 2.5

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/CMakeLists.txt	2010-04-25 14:30:34 UTC (rev 6134)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/CMakeLists.txt	2010-04-25 14:30:38 UTC (rev 6135)
@@ -1 +1,2 @@
 subdirs (src)
+subdirs (src_dialogFactory)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_js.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_js.h	2010-04-25 14:30:34 UTC (rev 6134)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_js.h	2010-04-25 14:30:38 UTC (rev 6135)
@@ -25,8 +25,11 @@
 #include "ADM_jsUtils.h"
 #include "ADM_jsShell.h"
 #include "ADM_jsDebug.h"
+#include "ADM_jsDFactory.h"
 
 typedef JSBool JS_PROTOTYPE(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
+
+
 /**
     \struct ADM_JS_HOOK
 */

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_jsDFactory.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_jsDFactory.h	2010-04-25 14:30:34 UTC (rev 6134)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_jsDFactory.h	2010-04-25 14:30:38 UTC (rev 6135)
@@ -0,0 +1,21 @@
+/**
+    \file ADM_jsDialogFactory.h
+    \brief Base class for dialog factory mapping
+    \author mean, fixounet at free.fr
+*/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef ADM_JS_DIALOG_H
+#define ADM_JS_DIALOG_H
+#include "ADM_jsIf.h"
+extern "C"  JSObject *jsDialogFactoryInit(JSContext *cx,JSObject *obj);
+
+#endif // ADM_JS_SHELL_H

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsIf.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsIf.cpp	2010-04-25 14:30:34 UTC (rev 6134)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsIf.cpp	2010-04-25 14:30:38 UTC (rev 6135)
@@ -23,7 +23,7 @@
 static void *jsLoggerCookie=NULL;
 vector <ADM_JS_HOOK >jsHooks;
 extern ADM_Composer *video_body;
-
+extern bool ADM_JSDialogFactoryInit(JSContext *cx, JSObject *obj);
 #define JSVAR(a,b,c) a b=c
 
 #if defined( __MINGW32__) 
@@ -147,6 +147,7 @@
 extern "C" JSFunctionSpec  *jsGetTestFunctions(void);
 extern "C" JSFunctionSpec  *jsGetAdmFunctions(void);
 extern "C" JSFunctionSpec  *jsGetEditFunctions(void);
+extern "C" JSFunctionSpec  *jsGetDialogFactoryFunctions(void);
 extern "C" JSObject *jsEditorInit(JSContext *cx,JSObject *obj);
 extern "C" JSObject *jsAvidemuxInit(JSContext *cx,JSObject *obj);
 static bool registerOne(const char *name,const char *text,JSFunctionSpec *s,JSContext *cx,JSObject *obj)
@@ -222,9 +223,16 @@
             h.name="editor";
             h.text="Please prefix this with editor.";
             h.jsFunctions=jsGetEditFunctions();
+            jsEditorInit(cx,obj);
             jsHooks.push_back(h);
-            jsEditorInit(cx,obj);
-            return true;
+        // Register dialogFactory functions
+#if 0
+            h.name="dialog";
+            h.text=".";
+            h.jsFunctions=jsGetDialogFactoryFunctions();
+            jsHooks.push_back(h);
+#endif
+            return ADM_JSDialogFactoryInit(cx,obj);
 }
 /**
     \fn SpidermonkeyInit

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFMenu.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFMenu.cpp	2010-04-25 14:30:34 UTC (rev 6134)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFMenu.cpp	2010-04-25 14:30:38 UTC (rev 6135)
@@ -0,0 +1,193 @@
+/**
+    \file   ADM_JSDFMenu.cpp
+    \brief  JS / DF binding
+    \author gruntster 2010
+
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "ADM_JSDFMenu.h"
+
+ADM_JSDFMenuHelper::ADM_JSDFMenuHelper(const char *title)
+{
+	_title = ADM_strdup(title);
+	_menuEntries = NULL;
+	_index = 0;
+}
+
+ADM_JSDFMenuHelper::~ADM_JSDFMenuHelper(void)
+{
+	if (_title)
+		delete _title;
+
+	_title = NULL;
+
+	std::vector<char*>::iterator it;
+
+	for (it = _items.begin(); it != _items.end(); it++)
+		delete *it;
+
+	_items.clear();
+
+	if (_menuEntries)
+		delete _menuEntries;
+
+	_menuEntries = NULL;
+}
+
+void ADM_JSDFMenuHelper::addItem(const char* item)
+{
+	_items.push_back(ADM_strdup(item));
+}
+
+diaElem* ADM_JSDFMenuHelper::getControl(void)
+{
+	if (_menuEntries)
+		delete _menuEntries;
+
+	std::vector<char*>::iterator it;
+	int i = 0;
+
+	_menuEntries = new diaMenuEntry[_items.size()];	
+
+	for (it = _items.begin(); it != _items.end(); it++)
+	{
+		_menuEntries[i].val = i;
+		_menuEntries[i].text = *it;
+		_menuEntries[i].desc = NULL;
+
+		i++;
+	}
+
+	return new diaElemMenu(&_index, _title, _items.size(), _menuEntries);
+}
+
+int ADM_JSDFMenuHelper::index(void)
+{
+	return _index;
+}
+
+void ADM_JSDFMenuHelper::setIndex(int index)
+{
+	_index = index;
+}
+
+JSPropertySpec ADM_JSDFMenu::properties[] = 
+{ 
+	{ "index", indexProperty, JSPROP_ENUMERATE },
+	{ 0 }
+};
+
+JSFunctionSpec ADM_JSDFMenu::methods[] =
+{
+	{ "addItem", addItem, 1, 0, 0 },
+	{ 0 }
+};
+
+JSClass ADM_JSDFMenu::m_dfMenuHelper =
+{
+	"DFMenu", JSCLASS_HAS_PRIVATE,
+	JS_PropertyStub, JS_PropertyStub,
+	ADM_JSDFMenu::JSGetProperty, ADM_JSDFMenu::JSSetProperty,
+	JS_EnumerateStub, JS_ResolveStub,
+	JS_ConvertStub, ADM_JSDFMenu::JSDestructor
+};
+
+JSObject *ADM_JSDFMenu::JSInit(JSContext *cx, JSObject *obj, JSObject *proto)
+{
+	return JS_InitClass(cx, obj, proto, &m_dfMenuHelper, 
+		ADM_JSDFMenu::JSConstructor, 1,
+		ADM_JSDFMenu::properties, ADM_JSDFMenu::methods,
+		NULL, NULL);
+}
+
+JSBool ADM_JSDFMenu::JSConstructor(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	if (argc != 1)
+		return JS_FALSE;
+
+	if (!JSVAL_IS_STRING(argv[0]))
+		return JS_FALSE;
+
+	ADM_JSDFMenuHelper *pObject = new ADM_JSDFMenuHelper(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
+
+	if (!JS_SetPrivate(cx, obj, pObject))
+		return JS_FALSE;
+
+	*rval = OBJECT_TO_JSVAL(obj);
+
+	return JS_TRUE;
+}
+
+void ADM_JSDFMenu::JSDestructor(JSContext *cx, JSObject *obj)
+{
+	ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &m_dfMenuHelper, NULL);
+
+	if (pObject)
+		delete pObject;
+}
+
+JSBool ADM_JSDFMenu::addItem(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &m_dfMenuHelper, NULL);
+
+	if (argc != 1)
+		return JS_FALSE;
+
+	if (!JSVAL_IS_STRING(argv[0]))
+		return JS_FALSE;
+
+	pObject->addItem(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
+
+	return JS_TRUE;
+}
+
+JSBool ADM_JSDFMenu::JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
+{
+	if (JSVAL_IS_INT(id)) 
+	{
+		ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &m_dfMenuHelper, NULL);
+
+		switch(JSVAL_TO_INT(id))
+		{
+			case indexProperty:
+			{
+				*vp = INT_TO_JSVAL(pObject->index());
+				break;
+			}
+		}
+	}
+
+	return JS_TRUE;
+}
+
+JSBool ADM_JSDFMenu::JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
+{
+	if (JSVAL_IS_INT(id)) 
+	{
+		ADM_JSDFMenuHelper *pObject = (ADM_JSDFMenuHelper*)JS_GetInstancePrivate(cx, obj, &m_dfMenuHelper, NULL);
+
+		switch(JSVAL_TO_INT(id))
+		{
+			case indexProperty:
+			{
+				if (JSVAL_IS_INT(*vp))
+					pObject->setIndex(JSVAL_TO_INT(*vp));
+
+				break;
+			}
+			default:
+				return JS_FALSE;
+		}
+	}
+
+	return JS_TRUE;
+}

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFMenu.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFMenu.h	2010-04-25 14:30:34 UTC (rev 6134)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFMenu.h	2010-04-25 14:30:38 UTC (rev 6135)
@@ -0,0 +1,65 @@
+/**
+    \file   ADM_JSDFMenu.h
+    \brief  JS / DF binding
+    \author gruntster 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef _ADM_JSDFMenu_H
+#define _ADM_JSDFMenu_H
+
+#include "jsapi.h"
+#include "DIA_factory.h"
+#include <vector>
+
+class ADM_JSDFMenuHelper
+{
+private:
+	char* _title;
+	uint32_t _index;
+	diaMenuEntry *_menuEntries;
+	std::vector <char*> _items;
+
+public:
+	ADM_JSDFMenuHelper(const char *title);
+	~ADM_JSDFMenuHelper(void);
+	void addItem(const char* item);
+	diaElem* getControl(void);
+	int index(void);
+	void setIndex(int index);
+};
+
+class ADM_JSDFMenu
+{
+public:
+	ADM_JSDFMenu(void) {}
+
+	static JSBool JSConstructor(JSContext *cx, JSObject *obj, uintN argc, 
+								jsval *argv, jsval *rval);
+	static void JSDestructor(JSContext *cx, JSObject *obj);
+	static JSObject *JSInit(JSContext *cx, JSObject *obj, JSObject *proto = NULL);
+	static JSBool JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+	static JSBool JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+
+	static JSBool addItem(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);	
+
+	static JSPropertySpec properties[];
+	static JSFunctionSpec methods[];
+	static JSClass m_dfMenuHelper;
+
+	enum
+	{
+		indexProperty
+	};
+};
+
+#endif

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.cpp	2010-04-25 14:30:34 UTC (rev 6134)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.cpp	2010-04-25 14:30:38 UTC (rev 6135)
@@ -0,0 +1,138 @@
+/**
+    \file   ADM_JSDialogFactory.cpp
+    \brief  JS / DF binding
+    \author gruntster 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "ADM_JSDialogFactory.h"
+
+ADM_JSDialogFactoryHelper::ADM_JSDialogFactoryHelper(const char *title)
+{
+	_title = ADM_strdup(title);
+}
+
+ADM_JSDialogFactoryHelper::~ADM_JSDialogFactoryHelper(void)
+{
+	if (_title)
+		delete _title;
+
+	_title = NULL;
+}
+
+void ADM_JSDialogFactoryHelper::addControl(ADM_JSDFMenuHelper* control)
+{
+	_controls.push_back(control);
+}
+
+diaElem** ADM_JSDialogFactoryHelper::getControls(int *controlCount)
+{
+	*controlCount = (int)_controls.size();
+
+	std::vector<ADM_JSDFMenuHelper*>::iterator it;
+	int i = 0;
+	diaElem **elems = new diaElem*[*controlCount];
+
+	for (it = _controls.begin(); it != _controls.end(); it++)
+	{
+		elems[i] = (*it)->getControl();
+		i++;
+	}
+
+	return elems;
+}
+
+const char* ADM_JSDialogFactoryHelper::title(void)
+{
+	return _title;
+}
+
+JSFunctionSpec ADM_JSDialogFactory::methods[] =
+{
+	{ "addControl", addControl, 1, 0, 0 },
+	{ "show", show, 0, 0, 0 },
+	{ 0 }
+};
+
+JSClass ADM_JSDialogFactory::m_dialogFactoryHelper =
+{
+	"DialogFactory", JSCLASS_HAS_PRIVATE,
+	JS_PropertyStub, JS_PropertyStub,
+	JS_PropertyStub, JS_PropertyStub,
+	JS_EnumerateStub, JS_ResolveStub,
+	JS_ConvertStub, ADM_JSDialogFactory::JSDestructor
+};
+
+JSObject *ADM_JSDialogFactory::JSInit(JSContext *cx, JSObject *obj, JSObject *proto)
+{
+	return JS_InitClass(cx, obj, proto, &m_dialogFactoryHelper, 
+		ADM_JSDialogFactory::JSConstructor, 1,
+		NULL, ADM_JSDialogFactory::methods,
+		NULL, NULL);
+}
+
+JSBool ADM_JSDialogFactory::JSConstructor(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	if (argc != 1)
+		return JS_FALSE;
+
+	if (JSVAL_IS_STRING(argv[0]) == false)
+		return JS_FALSE;
+
+	ADM_JSDialogFactoryHelper *pObject = new ADM_JSDialogFactoryHelper(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
+
+	if (!JS_SetPrivate(cx, obj, pObject))
+		return JS_FALSE;
+
+	*rval = OBJECT_TO_JSVAL(obj);
+
+	return JS_TRUE;
+}
+
+void ADM_JSDialogFactory::JSDestructor(JSContext *cx, JSObject *obj)
+{
+	ADM_JSDialogFactoryHelper *pObject = (ADM_JSDialogFactoryHelper*)JS_GetInstancePrivate(cx, obj, &m_dialogFactoryHelper, NULL);
+
+	if (pObject != NULL)
+		delete pObject;
+}
+
+JSBool ADM_JSDialogFactory::addControl(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	ADM_JSDialogFactoryHelper *p = (ADM_JSDialogFactoryHelper*)JS_GetInstancePrivate(cx, obj, &m_dialogFactoryHelper, NULL);
+
+	if (argc != 1)
+		return JS_FALSE;
+
+	p->addControl((ADM_JSDFMenuHelper*)JS_GetPrivate(cx, JSVAL_TO_OBJECT(argv[0])));
+
+	return JS_TRUE;
+}
+
+JSBool ADM_JSDialogFactory::show(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	ADM_JSDialogFactoryHelper *p = (ADM_JSDialogFactoryHelper*)JS_GetInstancePrivate(cx, obj, &m_dialogFactoryHelper, NULL);
+
+	if (argc != 0)
+		return JS_FALSE;
+
+	int controlCount;
+	diaElem **elems = p->getControls(&controlCount);
+
+	*rval = BOOLEAN_TO_JSVAL(diaFactoryRun(p->title(), controlCount, elems));
+
+	for (int i = 0; i < controlCount; i++)
+		delete elems[i];
+
+	delete elems;
+
+	return JS_TRUE;
+}

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.h	2010-04-25 14:30:34 UTC (rev 6134)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.h	2010-04-25 14:30:38 UTC (rev 6135)
@@ -0,0 +1,61 @@
+/**
+    \file   ADM_JSDialogFactory.h
+    \brief  JS / DF binding
+    \author gruntster 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef _ADM_JSDialogFactory_H
+#define _ADM_JSDialogFactory_H
+
+#include "jsapi.h"
+#include "DIA_factory.h"
+#include "ADM_JSDFMenu.h"
+#include <vector>
+/**
+    \class ADM_JSDialogFactoryHelper
+*/
+class ADM_JSDialogFactoryHelper
+{
+private:
+	char* _title;
+	std::vector <ADM_JSDFMenuHelper*> _controls;
+
+public:
+	ADM_JSDialogFactoryHelper(const char *title);
+	~ADM_JSDialogFactoryHelper(void);
+	void addControl(ADM_JSDFMenuHelper* control);
+	diaElem** getControls(int *controlCount);
+	const char* title(void);
+};
+/**
+    \class ADM_JSDialogFactory
+*/
+
+class ADM_JSDialogFactory
+{
+public:
+	ADM_JSDialogFactory(void) {}
+	virtual ~ADM_JSDialogFactory(void);
+
+	static JSBool JSConstructor(JSContext *cx, JSObject *obj, uintN argc, 
+								jsval *argv, jsval *rval);
+	static void JSDestructor(JSContext *cx, JSObject *obj);
+	static JSObject *JSInit(JSContext *cx, JSObject *obj, JSObject *proto = NULL);
+	static JSBool addControl(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
+	static JSBool show(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
+
+	static JSFunctionSpec methods[];
+	static JSClass m_dialogFactoryHelper;
+};
+
+#endif

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/CMakeLists.txt	2010-04-25 14:30:34 UTC (rev 6134)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/CMakeLists.txt	2010-04-25 14:30:38 UTC (rev 6135)
@@ -0,0 +1,11 @@
+SET(ADM_scriptDF_SRCS
+        ADM_JSDFMenu.cpp
+        ADM_JSDialogFactory.cpp
+        ADM_JSDialogFactory_if.cpp 
+)
+
+ADD_DEFINITIONS("-DJS_THREADSAFE -DXP_UNIX")
+ADD_LIBRARY(ADM_scriptDF STATIC ${ADM_scriptDF_SRCS})
+include_directories(../include)
+include_directories(.)
+include_directories(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core/ADM_smjs)

Modified: branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake	2010-04-25 14:30:34 UTC (rev 6134)
+++ branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake	2010-04-25 14:30:38 UTC (rev 6135)
@@ -98,6 +98,7 @@
 ADM_requant6 
 #ADM_script6 
 ADM_script26 
+ADM_scriptDF
 ADM_videoEncoder6 
 ADM_internalVideoFilter6
 ADM_toolkit6



From mean at mail.berlios.de  Sun Apr 25 16:30:40 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 25 Apr 2010 16:30:40 +0200
Subject: [Avidemux-svn-commit] r6136 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory
Message-ID: <201004251430.o3PEUeaT014994@sheep.berlios.de>

Author: mean
Date: 2010-04-25 16:30:40 +0200 (Sun, 25 Apr 2010)
New Revision: 6136

Added:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory_if.cpp
Log:
[JS/DF] Import from 2.5

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory_if.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory_if.cpp	2010-04-25 14:30:38 UTC (rev 6135)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory_if.cpp	2010-04-25 14:30:40 UTC (rev 6136)
@@ -0,0 +1,44 @@
+/**
+    \file   ADM_JSDialogFactory_if.cpp
+    \brief  JS / DF binding
+    \author gruntster, mean (c) 2010
+
+
+    jsapigen does not like much variable number of arguments
+    In that case, we patch the generated file to go back to native spidermonkey api
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "ADM_default.h"
+#include "jsapi.h"
+#include "DIA_factory.h"
+#include "ADM_JSDFMenu.h"
+#include "ADM_JSDialogFactory.h"
+
+/**
+    \fn ADM_JSDialogFactoryInit()
+    \brief Hook classes to spidermonkey
+*/
+bool ADM_JSDialogFactoryInit(JSContext *cx, JSObject *obj)
+{
+    if(NULL==ADM_JSDialogFactory::JSInit(cx,obj))
+    {
+        ADM_error("Cannot register dialogFactory js class\n");
+        return false;
+    }
+    if(NULL==ADM_JSDFMenu::JSInit(cx,obj))
+    {
+        ADM_error("Cannot register dialogFactory js class\n");
+        return false;
+    }
+    ADM_info("Registered DialogFactory classes\n");
+    return true;
+}
\ No newline at end of file



From mean at mail.berlios.de  Sun Apr 25 16:30:43 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 25 Apr 2010 16:30:43 +0200
Subject: [Avidemux-svn-commit] r6137 - in branches/avidemux_2.6_branch_mean:
	autononreg/dialogFactory autononreg/dialogFactory/unit
	avidemux/common/ADM_script2/src
	avidemux/common/ADM_script2/src_dialogFactory
Message-ID: <201004251430.o3PEUh0J015005@sheep.berlios.de>

Author: mean
Date: 2010-04-25 16:30:41 +0200 (Sun, 25 Apr 2010)
New Revision: 6137

Added:
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/bar.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/binhex.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/bitrate.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/button.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/dirsel.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/encoding.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/fileread.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/float.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/frame.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/hex.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/integer.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/matrix.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/menu.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/notch.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/readonlytext.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/run_non_reg.sh
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/slider.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/tabs.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/text.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/threadcount.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/toggle.js
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDF.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFToggle.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFToggle.h
Removed:
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/bar.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/binhex.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/bitrate.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/button.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/dirsel.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/encoding.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/fileread.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/float.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/frame.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/hex.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/integer.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/matrix.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/notch.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/readonlytext.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/run_non_reg.sh
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/slider.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/tabs.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/text.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/threadcount.js
Modified:
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/menu.js
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/toggle.js
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsIf.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFMenu.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory_if.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/CMakeLists.txt
Log:
[JS/DF] Add toggle, cleanup

Deleted: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/bar.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/bar.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/bar.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,7 +0,0 @@
-//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
-print("Testing factory bar");
-	admTestFacBar();
-print("/Testing factory bar");
-
-/* End of test
-*/

Deleted: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/binhex.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/binhex.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/binhex.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,6 +0,0 @@
-//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
-print("Testing factory Hex");
-	admTestFacHex();
-print("Testing factory Hex");
-/* End of test
-*/

Deleted: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/bitrate.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/bitrate.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/bitrate.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,6 +0,0 @@
-//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
-print("Testing factory Bitrate");
-	admTestFacBitrate();
-print("Testing factory Bitrate");
-/* End of test
-*/

Deleted: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/button.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/button.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/button.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,4 +0,0 @@
-//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
-print("Testing factory Button");
-	admTestFacButton();
-print("Testing factory Button");

Deleted: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/dirsel.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/dirsel.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/dirsel.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,7 +0,0 @@
-//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
-print("Testing factory DirSel");
-	admTestFacDirSel();
-print("Testing factory DirSel");
-
-/* End of test
-*/

Deleted: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/encoding.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/encoding.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/encoding.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,6 +0,0 @@
-//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
-print("Testing factory FileSel");
-admTestEncoding();
-print("Testing factory FileSel");
-/* End of test
-*/

Deleted: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/fileread.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/fileread.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/fileread.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,6 +0,0 @@
-//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
-print("Testing factory FileSel");
-	admTestFacFile();
-print("Testing factory FileSel");
-/* End of test
-*/

Deleted: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/float.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/float.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/float.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,6 +0,0 @@
-//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
-print("Testing factory Float");
-	admTestFacFloat();
-print("Testing factory Float");
-/* End of test
-*/

Deleted: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/frame.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/frame.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/frame.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,4 +0,0 @@
-//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
-print("Testing factory Frame");
-	admTestFacFrame();
-print("Testing factory Frame");

Deleted: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/hex.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/hex.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/hex.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,4 +0,0 @@
-//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
-print("Testing factory hex");
-	admTestFacHex();
-print("Testing factory hex");

Deleted: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/integer.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/integer.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/integer.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,6 +0,0 @@
-//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
-print("Testing factory int");
-	admTestFacInt();
-print("Testing factory int");
-/* End of test
-*/

Deleted: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/matrix.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/matrix.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/matrix.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,4 +0,0 @@
-//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
-print("Testing factory Matrix");
-	admTestFacMatrix();
-print("Testing factory Matrix");

Modified: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/menu.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/menu.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/menu.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,6 +1,22 @@
-//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
-print("Testing factory Menu");
-	admTestFacMenu();
-print("Testing factory Menu");
-/* End of test
-*/
+    var aspectRatios = [[1, 1], [4, 3], [16, 9]];
+    var mnuResolution = new DFMenu("Resolution:");
+    var mnuSourceRatio = new DFMenu("Source Aspect Ratio:");
+    var mnuDestinationRatio = new DFMenu("Destination Aspect Ratio:");
+    var dlgWizard = new DialogFactory("Dialog Factory menu");
+    var i;
+
+    for (i = 0; i < aspectRatios.length; i++)
+    {
+        mnuSourceRatio.addItem(aspectRatios[i][0].toString() + ":" + aspectRatios[i][1].toString());
+        mnuDestinationRatio.addItem(aspectRatios[i][0].toString() + ":" + aspectRatios[i][1].toString());
+    }
+    
+
+    dlgWizard.addControl(mnuSourceRatio);
+    dlgWizard.addControl(mnuDestinationRatio);
+
+    if (dlgWizard.show())
+    {
+                var out="source index"+mnuSourceRatio.index+", dest index="+mnuDestinationRatio.index;
+                print(out);
+    }

Deleted: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/notch.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/notch.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/notch.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,6 +0,0 @@
-//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
-print("Testing factory Notch");
-	admTestFacNotch();
-print("Testing factory Notch");
-/* End of test
-*/

Deleted: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/readonlytext.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/readonlytext.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/readonlytext.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,6 +0,0 @@
-//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
-print("Testing factory RoTexy");
-	admTestFacRoText();
-print("Testing factory RoText");
-/* End of test
-*/

Deleted: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/run_non_reg.sh
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/run_non_reg.sh	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/run_non_reg.sh	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,11 +0,0 @@
-#!/bin/bash
-export PRG=~/workspace/qt4/avidemux3_qt4
-export SRC=.
-echo "Running tests..."
-#*****************
-cd functiontest
-perl ../foreach.pl $SRC/*.js "echo %f &&  $PRG    --run %f --quit > /dev/null"
-cd ..
-#*****************
-echo "## ALL done checking...##"
-		

Deleted: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/slider.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/slider.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/slider.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,4 +0,0 @@
-//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
-print("Testing factory Slider");
-	admTestFacSlider();
-print("Testing factory Slider");

Deleted: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/tabs.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/tabs.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/tabs.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,6 +0,0 @@
-//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
-print("Testing factory Tabs");
-	admTestFacTab();
-print("Testing factory Tabs");
-/* End of test
-*/

Deleted: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/text.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/text.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/text.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,6 +0,0 @@
-//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
-print("Testing factory Text");
-	admTestFacText();
-print("Testing factory Text");
-/* End of test
-*/

Deleted: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/threadcount.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/threadcount.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/threadcount.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,4 +0,0 @@
-//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
-print("Testing factory ThreadCount");
-	admTestFacThreadCount();
-print("Testing factory ThreadCount");

Modified: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/toggle.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/toggle.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/toggle.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,4 +1,12 @@
-//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
-print("Testing factory Toggle");
-	admTestFacToggle();
-print("Testing factory Toggle");
+    var toggle = new DFToggle("Toggle:");
+    var dlgWizard = new DialogFactory("Dialog Factory toggle");
+
+    
+    toggle.value=0;
+    dlgWizard.addControl(toggle);
+
+    if (dlgWizard.show())
+    {
+                var out="toggle "+toggle.value;
+                print(out);
+    }

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/bar.js (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/bar.js)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/bar.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/bar.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,7 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print("Testing factory bar");
+	admTestFacBar();
+print("/Testing factory bar");
+
+/* End of test
+*/

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/binhex.js (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/binhex.js)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/binhex.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/binhex.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,6 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print("Testing factory Hex");
+	admTestFacHex();
+print("Testing factory Hex");
+/* End of test
+*/

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/bitrate.js (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/bitrate.js)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/bitrate.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/bitrate.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,6 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print("Testing factory Bitrate");
+	admTestFacBitrate();
+print("Testing factory Bitrate");
+/* End of test
+*/

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/button.js (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/button.js)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/button.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/button.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,4 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print("Testing factory Button");
+	admTestFacButton();
+print("Testing factory Button");

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/dirsel.js (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/dirsel.js)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/dirsel.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/dirsel.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,7 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print("Testing factory DirSel");
+	admTestFacDirSel();
+print("Testing factory DirSel");
+
+/* End of test
+*/

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/encoding.js (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/encoding.js)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/encoding.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/encoding.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,6 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print("Testing factory FileSel");
+admTestEncoding();
+print("Testing factory FileSel");
+/* End of test
+*/

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/fileread.js (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/fileread.js)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/fileread.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/fileread.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,6 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print("Testing factory FileSel");
+	admTestFacFile();
+print("Testing factory FileSel");
+/* End of test
+*/

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/float.js (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/float.js)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/float.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/float.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,6 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print("Testing factory Float");
+	admTestFacFloat();
+print("Testing factory Float");
+/* End of test
+*/

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/frame.js (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/frame.js)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/frame.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/frame.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,4 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print("Testing factory Frame");
+	admTestFacFrame();
+print("Testing factory Frame");

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/hex.js (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/hex.js)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/hex.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/hex.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,4 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print("Testing factory hex");
+	admTestFacHex();
+print("Testing factory hex");

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/integer.js (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/integer.js)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/integer.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/integer.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,6 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print("Testing factory int");
+	admTestFacInt();
+print("Testing factory int");
+/* End of test
+*/

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/matrix.js (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/matrix.js)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/matrix.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/matrix.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,4 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print("Testing factory Matrix");
+	admTestFacMatrix();
+print("Testing factory Matrix");

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/menu.js (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/menu.js)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/menu.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/menu.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,6 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print("Testing factory Menu");
+	admTestFacMenu();
+print("Testing factory Menu");
+/* End of test
+*/

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/notch.js (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/notch.js)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/notch.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/notch.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,6 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print("Testing factory Notch");
+	admTestFacNotch();
+print("Testing factory Notch");
+/* End of test
+*/

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/readonlytext.js (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/readonlytext.js)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/readonlytext.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/readonlytext.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,6 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print("Testing factory RoTexy");
+	admTestFacRoText();
+print("Testing factory RoText");
+/* End of test
+*/

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/run_non_reg.sh (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/run_non_reg.sh)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/run_non_reg.sh	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/run_non_reg.sh	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,11 @@
+#!/bin/bash
+export PRG=~/workspace/qt4/avidemux3_qt4
+export SRC=.
+echo "Running tests..."
+#*****************
+cd functiontest
+perl ../foreach.pl $SRC/*.js "echo %f &&  $PRG    --run %f --quit > /dev/null"
+cd ..
+#*****************
+echo "## ALL done checking...##"
+		

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/slider.js (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/slider.js)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/slider.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/slider.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,4 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print("Testing factory Slider");
+	admTestFacSlider();
+print("Testing factory Slider");

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/tabs.js (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/tabs.js)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/tabs.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/tabs.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,6 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print("Testing factory Tabs");
+	admTestFacTab();
+print("Testing factory Tabs");
+/* End of test
+*/

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/text.js (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/text.js)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/text.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/text.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,6 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print("Testing factory Text");
+	admTestFacText();
+print("Testing factory Text");
+/* End of test
+*/

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/threadcount.js (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/threadcount.js)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/threadcount.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/threadcount.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,4 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print("Testing factory ThreadCount");
+	admTestFacThreadCount();
+print("Testing factory ThreadCount");

Copied: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/toggle.js (from rev 6136, branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/toggle.js)
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/toggle.js	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/unit/toggle.js	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,4 @@
+//AD  <- These first 4 characters need to be the first 4 characters to identify the ECMAScript file to Avidemux
+print("Testing factory Toggle");
+	admTestFacToggle();
+print("Testing factory Toggle");

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsIf.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsIf.cpp	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_jsIf.cpp	2010-04-25 14:30:41 UTC (rev 6137)
@@ -60,7 +60,7 @@
 	ADM_info("Done.\n");
 	if(pJSScript != NULL)
 	{// begin execute external file
-		printf("Spidermonkey executing \"%s\"...",name);
+		printf("Spidermonkey executing \"%s\"...\n",name);
 		JSBool ok = JS_ExecuteScript(g_pCx, g_pObject, pJSScript, &rval);
 		JS_DestroyScript(g_pCx,pJSScript);
 		ADM_info("Done.\n");

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDF.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDF.h	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDF.h	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,31 @@
+/**
+    \file   ADM_JSDF.h
+    \brief  JS / DF binding
+    \author gruntster/Mean 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef _ADM_JSDF_H
+#define _ADM_JSDF_H
+
+/**
+    \class ADM_JSBaseHelper
+*/
+class ADM_JSDFBaseHelper
+{
+public:
+                        ADM_JSDFBaseHelper() {};
+    virtual             ~ADM_JSDFBaseHelper() {};
+    virtual diaElem*    getControl(void)=0;
+};
+
+#endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFMenu.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFMenu.h	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFMenu.h	2010-04-25 14:30:41 UTC (rev 6137)
@@ -18,39 +18,44 @@
 #define _ADM_JSDFMenu_H
 
 #include "jsapi.h"
-#include "DIA_factory.h"
-#include <vector>
-
-class ADM_JSDFMenuHelper
+#include "DIA_factory.h"
+#include "ADM_JSDF.h"
+#include <vector>
+/**
+    \class ADM_JSDFMenuHelper
+*/
+class ADM_JSDFMenuHelper : public ADM_JSDFBaseHelper
 {
 private:
-	char* _title;
-	uint32_t _index;
-	diaMenuEntry *_menuEntries;
+	char                *_title;
+	uint32_t            _index;
+	diaMenuEntry        *_menuEntries;
 	std::vector <char*> _items;
 
 public:
-	ADM_JSDFMenuHelper(const char *title);
-	~ADM_JSDFMenuHelper(void);
-	void addItem(const char* item);
-	diaElem* getControl(void);
-	int index(void);
-	void setIndex(int index);
+                     ADM_JSDFMenuHelper(const char *title);
+                     ~ADM_JSDFMenuHelper(void);
+            void     addItem(const char* item);
+	virtual diaElem* getControl(void);
+            int      index(void);
+            void     setIndex(int index);
 };
-
+/**
+    \class ADM_JSDFMenu
+*/
 class ADM_JSDFMenu
 {
 public:
 	ADM_JSDFMenu(void) {}
 
-	static JSBool JSConstructor(JSContext *cx, JSObject *obj, uintN argc, 
+	static JSBool   JSConstructor(JSContext *cx, JSObject *obj, uintN argc, 
 								jsval *argv, jsval *rval);
-	static void JSDestructor(JSContext *cx, JSObject *obj);
+	static void     JSDestructor(JSContext *cx, JSObject *obj);
 	static JSObject *JSInit(JSContext *cx, JSObject *obj, JSObject *proto = NULL);
-	static JSBool JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
-	static JSBool JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+	static JSBool   JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+	static JSBool   JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
 
-	static JSBool addItem(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);	
+	static JSBool   addItem(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);	
 
 	static JSPropertySpec properties[];
 	static JSFunctionSpec methods[];

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFToggle.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFToggle.cpp	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFToggle.cpp	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,147 @@
+/**
+    \file   ADM_JSDFToggle.cpp
+    \brief  JS / DF binding
+    \author gruntster/mean 2010
+
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "ADM_JSDFToggle.h"
+
+ADM_JSDFToggleHelper::ADM_JSDFToggleHelper(const char *title)
+{
+	_title = ADM_strdup(title);
+	_value = 0;
+}
+
+ADM_JSDFToggleHelper::~ADM_JSDFToggleHelper(void)
+{
+	if (_title)
+		delete _title;
+
+	_title = NULL;
+
+
+}
+
+
+diaElem* ADM_JSDFToggleHelper::getControl(void)
+{
+    return new   diaElemToggle(&_value,_title,NULL);
+}
+
+uint32_t ADM_JSDFToggleHelper::value(void)
+{
+	return _value;
+}
+
+void ADM_JSDFToggleHelper::setValue(uint32_t index)
+{
+	_value = index;
+}
+/*************************************************/
+JSPropertySpec ADM_JSDFToggle::properties[] = 
+{ 
+	{ "value", valueProperty, JSPROP_ENUMERATE },
+	{ 0 }
+};
+
+JSFunctionSpec ADM_JSDFToggle::methods[] =
+{
+	{ 0 }
+};
+
+JSClass ADM_JSDFToggle::m_dfToggleHelper =
+{
+	"DFToggle", JSCLASS_HAS_PRIVATE,
+	JS_PropertyStub, JS_PropertyStub,
+	ADM_JSDFToggle::JSGetProperty, ADM_JSDFToggle::JSSetProperty,
+	JS_EnumerateStub, JS_ResolveStub,
+	JS_ConvertStub, ADM_JSDFToggle::JSDestructor
+};
+
+JSObject *ADM_JSDFToggle::JSInit(JSContext *cx, JSObject *obj, JSObject *proto)
+{
+	return JS_InitClass(cx, obj, proto, &m_dfToggleHelper, 
+		ADM_JSDFToggle::JSConstructor, 1,
+		ADM_JSDFToggle::properties, ADM_JSDFToggle::methods,
+		NULL, NULL);
+}
+/**
+    \fn ctor
+*/
+JSBool ADM_JSDFToggle::JSConstructor(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	if (argc != 1)
+		return JS_FALSE;
+
+	if (!JSVAL_IS_STRING(argv[0]))
+		return JS_FALSE;
+
+	ADM_JSDFToggleHelper *pObject = new ADM_JSDFToggleHelper(JS_GetStringBytes(JSVAL_TO_STRING(argv[0])));
+
+	if (!JS_SetPrivate(cx, obj, pObject))
+		return JS_FALSE;
+
+	*rval = OBJECT_TO_JSVAL(obj);
+
+	return JS_TRUE;
+}
+
+void ADM_JSDFToggle::JSDestructor(JSContext *cx, JSObject *obj)
+{
+	ADM_JSDFToggleHelper *pObject = (ADM_JSDFToggleHelper*)JS_GetInstancePrivate(cx, obj, &m_dfToggleHelper, NULL);
+
+	if (pObject)
+		delete pObject;
+}
+
+JSBool ADM_JSDFToggle::JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
+{
+	if (JSVAL_IS_INT(id)) 
+	{
+		ADM_JSDFToggleHelper *pObject = (ADM_JSDFToggleHelper*)JS_GetInstancePrivate(cx, obj, &m_dfToggleHelper, NULL);
+
+		switch(JSVAL_TO_INT(id))
+		{
+			case valueProperty:
+			{
+				*vp = INT_TO_JSVAL(pObject->value());
+				break;
+			}
+		}
+	}
+
+	return JS_TRUE;
+}
+
+JSBool ADM_JSDFToggle::JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
+{
+	if (JSVAL_IS_INT(id)) 
+	{
+		ADM_JSDFToggleHelper *pObject = (ADM_JSDFToggleHelper*)JS_GetInstancePrivate(cx, obj, &m_dfToggleHelper, NULL);
+
+		switch(JSVAL_TO_INT(id))
+		{
+			case valueProperty:
+			{
+				if (JSVAL_IS_INT(*vp))
+					pObject->setValue(JSVAL_TO_INT(*vp));
+
+				break;
+			}
+			default:
+				return JS_FALSE;
+		}
+	}
+
+	return JS_TRUE;
+}

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFToggle.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFToggle.h	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFToggle.h	2010-04-25 14:30:41 UTC (rev 6137)
@@ -0,0 +1,63 @@
+/**
+    \file   ADM_JSDFToggle.h
+    \brief  JS / DF binding
+    \author gruntster/mean 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef _ADM_JSDFToggle_H
+#define _ADM_JSDFToggle_H
+
+#include "jsapi.h"
+#include "DIA_factory.h"
+#include "ADM_JSDF.h"
+/**
+    \class ADM_JSDFToggleHelper
+*/
+class ADM_JSDFToggleHelper : public ADM_JSDFBaseHelper
+{
+private:
+	char                *_title;
+	uint32_t            _value;
+
+public:
+                     ADM_JSDFToggleHelper(const char *title);
+                     ~ADM_JSDFToggleHelper(void);
+	virtual diaElem* getControl(void);
+            uint32_t value(void);
+            void     setValue(uint32_t value);
+};
+/**
+    \class ADM_JSDFToggle
+*/
+class ADM_JSDFToggle
+{
+public:
+	ADM_JSDFToggle(void) {}
+
+	static JSBool         JSConstructor(JSContext *cx, JSObject *obj, uintN argc, 
+								jsval *argv, jsval *rval);
+	static void           JSDestructor(JSContext *cx, JSObject *obj);
+	static JSObject       *JSInit(JSContext *cx, JSObject *obj, JSObject *proto = NULL);
+	static JSBool         JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+	static JSBool         JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+	static JSPropertySpec properties[];
+	static JSFunctionSpec methods[];
+	static JSClass        m_dfToggleHelper;
+
+	enum
+	{
+		valueProperty
+	};
+};
+
+#endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.cpp	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.cpp	2010-04-25 14:30:41 UTC (rev 6137)
@@ -28,7 +28,7 @@
 	_title = NULL;
 }
 
-void ADM_JSDialogFactoryHelper::addControl(ADM_JSDFMenuHelper* control)
+void ADM_JSDialogFactoryHelper::addControl(ADM_JSDFBaseHelper* control)
 {
 	_controls.push_back(control);
 }
@@ -37,7 +37,7 @@
 {
 	*controlCount = (int)_controls.size();
 
-	std::vector<ADM_JSDFMenuHelper*>::iterator it;
+	std::vector<ADM_JSDFBaseHelper*>::iterator it;
 	int i = 0;
 	diaElem **elems = new diaElem*[*controlCount];
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.h	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory.h	2010-04-25 14:30:41 UTC (rev 6137)
@@ -28,12 +28,12 @@
 {
 private:
 	char* _title;
-	std::vector <ADM_JSDFMenuHelper*> _controls;
+	std::vector <ADM_JSDFBaseHelper*> _controls;
 
 public:
 	ADM_JSDialogFactoryHelper(const char *title);
 	~ADM_JSDialogFactoryHelper(void);
-	void addControl(ADM_JSDFMenuHelper* control);
+	void addControl(ADM_JSDFBaseHelper* control);
 	diaElem** getControls(int *controlCount);
 	const char* title(void);
 };

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory_if.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory_if.cpp	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory_if.cpp	2010-04-25 14:30:41 UTC (rev 6137)
@@ -21,6 +21,7 @@
 #include "jsapi.h"
 #include "DIA_factory.h"
 #include "ADM_JSDFMenu.h"
+#include "ADM_JSDFToggle.h"
 #include "ADM_JSDialogFactory.h"
 
 /**
@@ -36,9 +37,14 @@
     }
     if(NULL==ADM_JSDFMenu::JSInit(cx,obj))
     {
-        ADM_error("Cannot register dialogFactory js class\n");
+        ADM_error("Cannot register  menu js class\n");
         return false;
     }
+    if(NULL==ADM_JSDFToggle::JSInit(cx,obj))
+    {
+        ADM_error("Cannot register toggle js class\n");
+        return false;
+    }
     ADM_info("Registered DialogFactory classes\n");
     return true;
 }
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/CMakeLists.txt	2010-04-25 14:30:40 UTC (rev 6136)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/CMakeLists.txt	2010-04-25 14:30:41 UTC (rev 6137)
@@ -1,7 +1,9 @@
 SET(ADM_scriptDF_SRCS
         ADM_JSDFMenu.cpp
+        ADM_JSDFToggle.cpp
         ADM_JSDialogFactory.cpp
         ADM_JSDialogFactory_if.cpp 
+        
 )
 
 ADD_DEFINITIONS("-DJS_THREADSAFE -DXP_UNIX")



From mean at mail.berlios.de  Sun Apr 25 16:30:45 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 25 Apr 2010 16:30:45 +0200
Subject: [Avidemux-svn-commit] r6138 - in branches/avidemux_2.6_branch_mean:
	autononreg/dialogFactory
	avidemux/common/ADM_script2/src_dialogFactory
Message-ID: <201004251430.o3PEUjYV015019@sheep.berlios.de>

Author: mean
Date: 2010-04-25 16:30:45 +0200 (Sun, 25 Apr 2010)
New Revision: 6138

Added:
   branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/integer.js
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFInteger.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFInteger.h
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory_if.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/CMakeLists.txt
Log:
[JS/DF] Added integer

Added: branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/integer.js
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/integer.js	2010-04-25 14:30:41 UTC (rev 6137)
+++ branches/avidemux_2.6_branch_mean/autononreg/dialogFactory/integer.js	2010-04-25 14:30:45 UTC (rev 6138)
@@ -0,0 +1,12 @@
+    var toggle = new DFInteger("Integer (5-10)",5,10);
+    var dlgWizard = new DialogFactory("Dialog Factory toggle");
+
+    
+    toggle.value=7;
+    dlgWizard.addControl(toggle);
+
+    if (dlgWizard.show())
+    {
+                var out="toggle "+toggle.value;
+                print(out);
+    }

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFInteger.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFInteger.cpp	2010-04-25 14:30:41 UTC (rev 6137)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFInteger.cpp	2010-04-25 14:30:45 UTC (rev 6138)
@@ -0,0 +1,160 @@
+/**
+    \file   ADM_JSDFInteger.cpp
+    \brief  JS / DF binding
+    \author gruntster/mean 2010
+
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "ADM_JSDFInteger.h"
+
+ADM_JSDFIntegerHelper::ADM_JSDFIntegerHelper(const char *title,int32_t mn,int32_t mx)
+{
+	_title = ADM_strdup(title); 
+    _min=mn;
+    _max=mx;
+	_value = 0;
+}
+
+ADM_JSDFIntegerHelper::~ADM_JSDFIntegerHelper(void)
+{
+	if (_title)
+		delete _title;
+
+	_title = NULL;
+
+
+}
+
+
+diaElem* ADM_JSDFIntegerHelper::getControl(void)
+{
+    return new diaElemInteger(&_value,_title, _min,_max);
+}
+
+int32_t ADM_JSDFIntegerHelper::value(void)
+{
+	return _value;
+}
+
+void ADM_JSDFIntegerHelper::setValue(int32_t index)
+{
+	_value = index;
+}
+/*************************************************/
+JSPropertySpec ADM_JSDFInteger::properties[] = 
+{ 
+	{ "value", valueProperty, JSPROP_ENUMERATE },
+	{ 0 }
+};
+
+JSFunctionSpec ADM_JSDFInteger::methods[] =
+{
+	{ 0 }
+};
+
+JSClass ADM_JSDFInteger::m_dfIntegerHelper =
+{
+	"DFInteger", JSCLASS_HAS_PRIVATE,
+	JS_PropertyStub, JS_PropertyStub,
+	ADM_JSDFInteger::JSGetProperty, ADM_JSDFInteger::JSSetProperty,
+	JS_EnumerateStub, JS_ResolveStub,
+	JS_ConvertStub, ADM_JSDFInteger::JSDestructor
+};
+
+JSObject *ADM_JSDFInteger::JSInit(JSContext *cx, JSObject *obj, JSObject *proto)
+{
+	return JS_InitClass(cx, obj, proto, &m_dfIntegerHelper, 
+		ADM_JSDFInteger::JSConstructor, 1,
+		ADM_JSDFInteger::properties, ADM_JSDFInteger::methods,
+		NULL, NULL);
+}
+/**
+    \fn ctor
+*/
+JSBool ADM_JSDFInteger::JSConstructor(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)
+{
+	if (argc != 3)
+		return JS_FALSE;
+
+	if (!JSVAL_IS_STRING(argv[0]))
+		return JS_FALSE;
+
+	if (!JSVAL_IS_INT(argv[1]))
+		return JS_FALSE;
+
+	if (!JSVAL_IS_INT(argv[2]))
+		return JS_FALSE;
+
+
+	ADM_JSDFIntegerHelper *pObject = new ADM_JSDFIntegerHelper(
+                                                    JS_GetStringBytes(JSVAL_TO_STRING(argv[0])),
+                                                    JSVAL_TO_INT(argv[1]),
+                                                    JSVAL_TO_INT(argv[2])
+                                                );
+
+	if (!JS_SetPrivate(cx, obj, pObject))
+		return JS_FALSE;
+
+	*rval = OBJECT_TO_JSVAL(obj);
+
+	return JS_TRUE;
+}
+
+void ADM_JSDFInteger::JSDestructor(JSContext *cx, JSObject *obj)
+{
+	ADM_JSDFIntegerHelper *pObject = (ADM_JSDFIntegerHelper*)JS_GetInstancePrivate(cx, obj, &m_dfIntegerHelper, NULL);
+
+	if (pObject)
+		delete pObject;
+}
+
+JSBool ADM_JSDFInteger::JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
+{
+	if (JSVAL_IS_INT(id)) 
+	{
+		ADM_JSDFIntegerHelper *pObject = (ADM_JSDFIntegerHelper*)JS_GetInstancePrivate(cx, obj, &m_dfIntegerHelper, NULL);
+
+		switch(JSVAL_TO_INT(id))
+		{
+			case valueProperty:
+			{
+				*vp = INT_TO_JSVAL(pObject->value());
+				break;
+			}
+		}
+	}
+
+	return JS_TRUE;
+}
+
+JSBool ADM_JSDFInteger::JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
+{
+	if (JSVAL_IS_INT(id)) 
+	{
+		ADM_JSDFIntegerHelper *pObject = (ADM_JSDFIntegerHelper*)JS_GetInstancePrivate(cx, obj, &m_dfIntegerHelper, NULL);
+
+		switch(JSVAL_TO_INT(id))
+		{
+			case valueProperty:
+			{
+				if (JSVAL_IS_INT(*vp))
+					pObject->setValue(JSVAL_TO_INT(*vp));
+
+				break;
+			}
+			default:
+				return JS_FALSE;
+		}
+	}
+
+	return JS_TRUE;
+}

Added: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFInteger.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFInteger.h	2010-04-25 14:30:41 UTC (rev 6137)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDFInteger.h	2010-04-25 14:30:45 UTC (rev 6138)
@@ -0,0 +1,66 @@
+/**
+    \file   ADM_JSDFInteger.h
+    \brief  JS / DF binding
+    \author gruntster/mean 2010
+
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef _ADM_JSDFInteger_H
+#define _ADM_JSDFInteger_H
+
+#include "jsapi.h"
+#include "DIA_factory.h"
+#include "ADM_JSDF.h"
+/**
+    \class ADM_JSDFIntegerHelper
+*/
+class ADM_JSDFIntegerHelper : public ADM_JSDFBaseHelper
+{
+private:
+	char                *_title;
+	int32_t             _value;
+    int32_t             _min,_max;
+
+public:
+                     ADM_JSDFIntegerHelper(const char *title,int32_t mn, int32_t mx);
+                     ~ADM_JSDFIntegerHelper(void);
+	virtual diaElem* getControl(void);
+            int32_t value(void);
+            void     setValue(int32_t value);
+};
+/**
+    \class ADM_JSDFInteger
+*/
+class ADM_JSDFInteger
+{
+protected:
+    int32_t   minimum,maximum;
+public:
+	ADM_JSDFInteger(int32_t mn,int32_t mx) {minimum=mn;maximum=mx;}
+
+	static JSBool         JSConstructor(JSContext *cx, JSObject *obj, uintN argc, 
+								jsval *argv, jsval *rval);
+	static void           JSDestructor(JSContext *cx, JSObject *obj);
+	static JSObject       *JSInit(JSContext *cx, JSObject *obj, JSObject *proto = NULL);
+	static JSBool         JSGetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+	static JSBool         JSSetProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp);
+	static JSPropertySpec properties[];
+	static JSFunctionSpec methods[];
+	static JSClass        m_dfIntegerHelper;
+
+	enum
+	{
+		valueProperty
+	};
+};
+
+#endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory_if.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory_if.cpp	2010-04-25 14:30:41 UTC (rev 6137)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/ADM_JSDialogFactory_if.cpp	2010-04-25 14:30:45 UTC (rev 6138)
@@ -22,6 +22,7 @@
 #include "DIA_factory.h"
 #include "ADM_JSDFMenu.h"
 #include "ADM_JSDFToggle.h"
+#include "ADM_JSDFInteger.h"
 #include "ADM_JSDialogFactory.h"
 
 /**
@@ -45,6 +46,11 @@
         ADM_error("Cannot register toggle js class\n");
         return false;
     }
+    if(NULL==ADM_JSDFInteger::JSInit(cx,obj))
+    {
+        ADM_error("Cannot register integer js class\n");
+        return false;
+    }
     ADM_info("Registered DialogFactory classes\n");
     return true;
 }
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/CMakeLists.txt	2010-04-25 14:30:41 UTC (rev 6137)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src_dialogFactory/CMakeLists.txt	2010-04-25 14:30:45 UTC (rev 6138)
@@ -1,6 +1,7 @@
 SET(ADM_scriptDF_SRCS
         ADM_JSDFMenu.cpp
         ADM_JSDFToggle.cpp
+        ADM_JSDFInteger.cpp
         ADM_JSDialogFactory.cpp
         ADM_JSDialogFactory_if.cpp 
         



From mean at mail.berlios.de  Sun Apr 25 16:30:47 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 25 Apr 2010 16:30:47 +0200
Subject: [Avidemux-svn-commit] r6139 - in
	branches/avidemux_2.6_branch_mean/avidemux/common: .
	ADM_editor ADM_script2/include
Message-ID: <201004251430.o3PEUlwH015029@sheep.berlios.de>

Author: mean
Date: 2010-04-25 16:30:46 +0200 (Sun, 25 Apr 2010)
New Revision: 6139

Removed:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_JSif.h
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp
Log:
[js] Fix js vs JS

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp	2010-04-25 14:30:45 UTC (rev 6138)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_segment.cpp	2010-04-25 14:30:46 UTC (rev 6139)
@@ -23,7 +23,7 @@
 #include "ADM_colorspace.h"
 #include "ADM_vidMisc.h"
 #include "ADM_audiocodec/ADM_audiocodec.h"
-#include "ADM_script2/include/ADM_JSif.h"
+#include "ADM_script2/include/ADM_jsIf.h"
 #include "ADM_codec.h"
 
 ADM_EditorSegment::ADM_EditorSegment(void)

Deleted: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_JSif.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_JSif.h	2010-04-25 14:30:45 UTC (rev 6138)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_JSif.h	2010-04-25 14:30:46 UTC (rev 6139)
@@ -1,51 +0,0 @@
-/**
-    \file ADM_JSif.cpp
-    \brief interface to js
-*/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef ADM_JS_IF_H
-#define ADM_JS_IF_H
-
-/**
-    \enum JS_LOG_TYPE
-*/
-typedef enum
-{
-    JS_LOG_NORMAL,
-    JS_LOG_ERROR
-}JS_LOG_TYPE;
-/**
-    \typedef jsLoggerFunc
-*/
-typedef bool (jsLoggerFunc)(void *cookie,JS_LOG_TYPE type,const char *);
-/*
-
-*/
-bool ADM_jsRegisterLogger(void *cookie,jsLoggerFunc *fun);
-bool ADM_jsUnregisterLogger(void);
-
-/**
-    \fn parseECMAScript
-    \brief Compile & execute ecma script
-*/
-bool parseECMAScript(const char *name);
-
-/**
-    \fn    interactiveECMAScript
-    \brief interprete & execute ecma script (interactive)
-*/
-bool interactiveECMAScript(const char *name);
-/**
-    \fn jsLog
-
-*/
-bool jsLog(JS_LOG_TYPE type, const char *fmt,...);
-#endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp	2010-04-25 14:30:45 UTC (rev 6138)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp	2010-04-25 14:30:46 UTC (rev 6139)
@@ -40,7 +40,7 @@
 
 #include "avi_vars.h"
 #include "prototype.h" // FIXME
-#include "ADM_script2/include/ADM_JSif.h"
+#include "ADM_script2/include/ADM_jsIf.h"
 renderZoom currentZoom=ZOOM_1_1;
 //***********************************
 //******** A Function ***************



From mean at mail.berlios.de  Sun Apr 25 17:35:56 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 25 Apr 2010 17:35:56 +0200
Subject: [Avidemux-svn-commit] r6141 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src
Message-ID: <201004251535.o3PFZugJ018809@sheep.berlios.de>

Author: mean
Date: 2010-04-25 17:35:55 +0200 (Sun, 25 Apr 2010)
New Revision: 6141

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src/ADM_audioDeviceThreaded.cpp
Log:
[audioDevice] Verbose state changing, try not to deadlock when the audio thread get stuck

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src/ADM_audioDeviceThreaded.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src/ADM_audioDeviceThreaded.cpp	2010-04-25 14:30:48 UTC (rev 6140)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioDevice/src/ADM_audioDeviceThreaded.cpp	2010-04-25 15:35:55 UTC (rev 6141)
@@ -19,6 +19,17 @@
 #include "ADM_audiodevice.h"
 #include "ADM_audioDeviceInternal.h"
 #include "math.h"
+
+const char *i2state(int a)
+{
+    if(a==AUDIO_DEVICE_STARTED) return "DeviceStarted";
+    if(a==AUDIO_DEVICE_STOPPED) return "DeviceStopped";
+    if(a==AUDIO_DEVICE_STOP_REQ) return "DeviceStop_Requested";
+    if(a==AUDIO_DEVICE_STOP_GR) return "DeviceStop_Granted";
+    return "?????";
+
+}
+#define CHANGE_STATE(x) { printf("%s -> %s\n",i2state(stopRequest),i2state(x));stopRequest=x;}
 /**
     \fn audioDeviceThreaded
     \brief constructor
@@ -58,7 +69,7 @@
         sendData();
 
     }
-    stopRequest=AUDIO_DEVICE_STOP_GR;
+    CHANGE_STATE(AUDIO_DEVICE_STOP_GR);
     printf("[AudioDeviceThreaded] Exiting loop\n");
 }
 /**
@@ -77,11 +88,11 @@
     memset(silence,0,sizeOf10ms);
     audioBuffer=new uint8_t[ADM_THREAD_BUFFER_SIZE];
     rdIndex=wrIndex=0;
-    stopRequest=AUDIO_DEVICE_STOPPED;
+    CHANGE_STATE(AUDIO_DEVICE_STOPPED);
     //
     if(!localInit()) return 0;
     // Spawn
-    stopRequest=AUDIO_DEVICE_STARTED;
+    CHANGE_STATE(AUDIO_DEVICE_STARTED);
     ADM_assert(!pthread_create(&myThread,NULL,bouncer,this));
 
 
@@ -106,17 +117,21 @@
 */
 uint8_t audioDeviceThreaded::stop()
 {
-
-
+ uint32_t maxWait=3*1000; // Should be enough to drain
+    ADM_info("[audioDevice]Stopping device...");
     if(stopRequest==AUDIO_DEVICE_STARTED)
     {
-        stopRequest=AUDIO_DEVICE_STOP_REQ;
-        while(stopRequest==AUDIO_DEVICE_STOP_REQ)
+        CHANGE_STATE(AUDIO_DEVICE_STOP_REQ);
+        while(stopRequest==AUDIO_DEVICE_STOP_REQ && maxWait)
         {
             ADM_usleep(1000);
+            maxWait--;
         }
     }
-
+    if(!maxWait)
+    {
+        ADM_error("Audio device did not stop cleanly\n");
+    }
     localStop();
     if(audioBuffer)
     {
@@ -125,7 +140,7 @@
     }
     if(silence) delete [] silence;
     silence=NULL;
-    stopRequest=AUDIO_DEVICE_STOPPED;
+    CHANGE_STATE(AUDIO_DEVICE_STOPPED);
     return 1;
 }
 /**



From mean at mail.berlios.de  Sun Apr 25 17:35:59 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 25 Apr 2010 17:35:59 +0200
Subject: [Avidemux-svn-commit] r6142 - in branches/avidemux_2.6_branch_mean:
	avidemux/common/ADM_videoCodec/include
	avidemux/common/ADM_videoCodec/src
	avidemux_core/ADM_coreVideoCodec/include
Message-ID: <201004251535.o3PFZxSI018830@sheep.berlios.de>

Author: mean
Date: 2010-04-25 17:35:58 +0200 (Sun, 25 Apr 2010)
New Revision: 6142

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/include/ADM_codecVdpau.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_videoCodec.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_codec.h
Log:
[VDPAU] Add a new method to know if the decoder did get initialized properly. By default it is set to true. Vdpau can return false if, for example, the decoder is already used by another application. The cleanup in that case is a bit messy

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/include/ADM_codecVdpau.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/include/ADM_codecVdpau.h	2010-04-25 15:35:55 UTC (rev 6141)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/include/ADM_codecVdpau.h	2010-04-25 15:35:58 UTC (rev 6142)
@@ -2,6 +2,7 @@
 class decoderFFVDPAU:public decoderFF
 {
 protected:
+                    bool alive;
                     int b_age;
                     int ip_age[2];
 
@@ -31,5 +32,6 @@
         return 1;
       }
     virtual const char *getDecoderName(void) {return "VDPAU";}
+    virtual bool  initializedOk(void)  {return alive;};
 };
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp	2010-04-25 15:35:55 UTC (rev 6141)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp	2010-04-25 15:35:58 UTC (rev 6142)
@@ -206,6 +206,8 @@
 :decoderFF (w,h,fcc,extraDataLen,extraData,bpp)
 {
         destroying=false;
+        alive=true;
+        scratch=NULL;
         _context->opaque          = this;
         _context->get_buffer      = ADM_VDPAUgetBuffer;
         _context->release_buffer  = ADM_VDPAUreleaseBuffer;
@@ -219,13 +221,27 @@
         WRAP_OpenByName(h264_vdpau,CODEC_ID_H264);
         ADM_info("[VDPAU] Decoder created \n");
         // Now instantiate our VDPAU surface & decoder
-        ADM_assert(VDP_STATUS_OK==funcs.decoderCreate(vdpDevice,VDP_DECODER_PROFILE_H264_HIGH,w,h,15,&(VDPAU->vdpDecoder)));
+        for(int i=0;i<NB_SURFACE;i++)
+            VDPAU->renders[i]=NULL;
+
+        if(VDP_STATUS_OK!=funcs.decoderCreate(vdpDevice,VDP_DECODER_PROFILE_H264_HIGH,
+                                w,h,15,&(VDPAU->vdpDecoder)))
+        {
+            ADM_error("Cannot create VDPAU decoder\n");
+            alive=false;
+            return;
+        }
         // Create our surfaces...
         for(int i=0;i<NB_SURFACE;i++)
         {
             VDPAU->renders[i]=new vdpau_render_state;
             memset(VDPAU->renders[i],0,sizeof( vdpau_render_state));
-            ADM_assert(VDP_STATUS_OK==funcs.createSurface(vdpDevice,VDP_CHROMA_TYPE_420,w,h,&(VDPAU->renders[i]->surface)));
+            if(VDP_STATUS_OK!=funcs.createSurface(vdpDevice,VDP_CHROMA_TYPE_420,w,h,&(VDPAU->renders[i]->surface)))
+            {
+                ADM_error("Cannot create surface %d/%d\n",i,NB_SURFACE);
+                alive=false;
+                return;
+            }
             VDPAU->freeQueue.push_back(VDPAU->renders[i]);
         }
         scratch=new ADMImage(w,h,1);
@@ -241,11 +257,20 @@
         destroying=true;
         for(int i=0;i<NB_SURFACE;i++)
         {
-            ADM_assert(VDP_STATUS_OK==funcs.destroySurface((VDPAU->renders[i]->surface)));
-            delete VDPAU->renders[i];
+            if(VDPAU->renders[i])
+            {
+                if(VDPAU->renders[i]->surface)
+                {
+                    if(VDPAU->renders[i]->surface)
+                        if(VDP_STATUS_OK!=funcs.destroySurface((VDPAU->renders[i]->surface)))
+                                ADM_error("Error destroying surface %d\n",i);
+                }
+                delete VDPAU->renders[i];
+            }
         }
-        ADM_info("[VDPAU] Destroying decoder\n");
-         ADM_assert(VDP_STATUS_OK==funcs.decoderDestroy(VDPAU->vdpDecoder));
+         ADM_info("[VDPAU] Destroying decoder\n");
+         if(VDP_STATUS_OK!=funcs.decoderDestroy(VDPAU->vdpDecoder))
+                ADM_error("Error destroying VDPAU decoder\n");
          delete VDPAU;
          vdpau=NULL;
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_videoCodec.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_videoCodec.cpp	2010-04-25 15:35:55 UTC (rev 6141)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_videoCodec.cpp	2010-04-25 15:35:58 UTC (rev 6142)
@@ -27,7 +27,7 @@
 #include "avidemutils.h"
 #include "fourcc.h"
 #include "ADM_codecVdpau.h"
-
+#include "DIA_coreToolkit.h"
 extern bool vdpauUsable(void);
 
 /**
@@ -41,7 +41,16 @@
     {
 #if defined(USE_VDPAU) 
         if(vdpauUsable()==true)
-            return (decoders *) (new decoderFFVDPAU (w,h,fcc,extraLen,extraData,bpp));
+        {
+            decoderFFVDPAU *dec=new decoderFFVDPAU (w,h,fcc,extraLen,extraData,bpp);
+            if(dec->initializedOk()==true)
+                return (decoders *) (dec);
+            else
+            {
+                GUI_Error_HIG("VDPAU","Cannot initialize VDPAU, make sure it is not already used by another application.\nSwitching to default decoder.");
+                delete dec;
+            }
+        }
         
 #endif
     }

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_codec.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_codec.h	2010-04-25 15:35:55 UTC (rev 6141)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_codec.h	2010-04-25 15:35:58 UTC (rev 6142)
@@ -48,6 +48,7 @@
   virtual ~ decoders ()
   {
   };
+  virtual bool   initializedOk(void) {return true;};
   virtual uint8_t getPARWidth (void)
   {
     return 1;



From mean at mail.berlios.de  Thu Apr 29 07:38:29 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 29 Apr 2010 07:38:29 +0200
Subject: [Avidemux-svn-commit] r6143 -
	branches/avidemux_2.5_branch_gruntster/cmake
Message-ID: <201004290538.o3T5cT8P031164@sheep.berlios.de>

Author: mean
Date: 2010-04-29 07:38:27 +0200 (Thu, 29 Apr 2010)
New Revision: 6143

Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/Ts.cmake
Log:
[i18n] Merge modified 18n/qm patch from Florent Rougon

Modified: branches/avidemux_2.5_branch_gruntster/cmake/Ts.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/Ts.cmake	2010-04-25 15:35:58 UTC (rev 6142)
+++ branches/avidemux_2.5_branch_gruntster/cmake/Ts.cmake	2010-04-29 05:38:27 UTC (rev 6143)
@@ -27,7 +27,20 @@
 
 	ENDIF(NOT LRELEASE_EXECUTABLE AND NOT LRELEASE_NOT_FOUND)
 ENDMACRO(FIND_LRELEASE)
-
+#
+#
+#
+MACRO(INSTALL_I18N _files)
+        IF(WIN32)
+                SET(i18dir "${CMAKE_INSTALL_PREFIX}/${BIN_DIR}/i18n")
+        ELSE(WIN32)
+                SET(i18dir "${CMAKE_INSTALL_PREFIX}/share/avidemux/i18n")
+        ENDIF(WIN32)
+        INSTALL(FILES ${_files} DESTINATION "${i18dir}")
+ENDMACRO(INSTALL_I18N _files)
+#
+#
+#
 MACRO(COMPILE_AVIDEMUX_TS_FILES ts_subdir _sources)
     IF(XSLTPROC_EXECUTABLE AND LRELEASE_EXECUTABLE)
         FILE(GLOB ts_files ${ts_subdir}/avidemux_*.ts)
@@ -63,8 +76,7 @@
             )
                 
             SET(qm_files ${qm_files} ${_outXml} ${_out})
-
-			INSTALL(FILES ${_out} DESTINATION "${CMAKE_INSTALL_PREFIX}/${BIN_DIR}/i18n")
+            INSTALL_I18N( ${_out})
         ENDFOREACH(ts_input ${ts_files})
 
         SET(${_sources} ${${_sources}} ${qm_files})
@@ -95,7 +107,7 @@
                 
             SET(qm_files ${qm_files} ${_out})
 
-			INSTALL(FILES ${_out} DESTINATION "${CMAKE_INSTALL_PREFIX}/${BIN_DIR}/i18n")
+            INSTALL_I18N( ${_out})
         ENDFOREACH(ts_input ${ts_files})
 
         SET(${_sources} ${${_sources}} ${qm_files})



From mean at mail.berlios.de  Thu Apr 29 19:58:34 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 29 Apr 2010 19:58:34 +0200
Subject: [Avidemux-svn-commit] r6144 -
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4
Message-ID: <201004291758.o3THwYV2013323@sheep.berlios.de>

Author: mean
Date: 2010-04-29 19:58:34 +0200 (Thu, 29 Apr 2010)
New Revision: 6144

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp
Log:
[i18n/qt] first part, handle win32 and unix differently

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp	2010-04-29 05:38:27 UTC (rev 6143)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp	2010-04-29 17:58:34 UTC (rev 6144)
@@ -72,7 +72,9 @@
 
 #ifdef __APPLE__
 	QString appdir = QCoreApplication::applicationDirPath() + "/../Resources/locale/";
-#else
+#elif defined(__WIN32)
+	QString appdir = QCoreApplication::applicationDirPath() + "/i18n/";
+#else
 	QString appdir = QCoreApplication::applicationDirPath() + "/i18n/";
 #endif
 



From mean at mail.berlios.de  Thu Apr 29 19:58:36 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Thu, 29 Apr 2010 19:58:36 +0200
Subject: [Avidemux-svn-commit] r6145 -
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4
Message-ID: <201004291758.o3THwaGf013335@sheep.berlios.de>

Author: mean
Date: 2010-04-29 19:58:36 +0200 (Thu, 29 Apr 2010)
New Revision: 6145

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp
Log:
[i18n/qt4] Handle correctly install path, modification of Florent Rougon patch

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp	2010-04-29 17:58:34 UTC (rev 6144)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp	2010-04-29 17:58:36 UTC (rev 6145)
@@ -75,7 +75,7 @@
 #elif defined(__WIN32)
 	QString appdir = QCoreApplication::applicationDirPath() + "/i18n/";
 #else
-	QString appdir = QCoreApplication::applicationDirPath() + "/i18n/";
+	QString appdir = ADM_getInstallRelativePath("share","avidemux","i18n");
 #endif
 
 	loadTranslation(&qtTranslator, appdir + "qt_" + QLocale::system().name());



From mean at mail.berlios.de  Fri Apr 30 18:30:21 2010
From: mean at mail.berlios.de (mean at BerliOS)
Date: Fri, 30 Apr 2010 18:30:21 +0200
Subject: [Avidemux-svn-commit] r6146 - in
	branches/avidemux_2.5_branch_gruntster: avidemux plugins
	plugins/ADM_videoEncoder/ADM_vidEnc_avcodec
Message-ID: <201004301630.o3UGULOM012557@sheep.berlios.de>

Author: mean
Date: 2010-04-30 18:30:20 +0200 (Fri, 30 Apr 2010)
New Revision: 6146

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/CMakeLists.txt
Log:
[build] Merged/modified 2nd patch from Florent Rougon (not tested much)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2010-04-29 17:58:36 UTC (rev 6145)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/CMakeLists.txt	2010-04-30 16:30:20 UTC (rev 6146)
@@ -478,11 +478,17 @@
 	INSTALL(TARGETS ${ADM_EXES} RUNTIME DESTINATION ${BIN_DIR} LIBRARY DESTINATION lib${LIB_SUFFIX})
 ENDIF (APPLE)
 
-IF (UNIX AND NOT APPLE)
-   ADD_CUSTOM_COMMAND(TARGET ffmpeg
+MACRO (ADM_SYMLINK_LIBS)
+       FOREACH (t ${ARGV})
+             ADD_CUSTOM_COMMAND(TARGET ${t}
                       POST_BUILD
                       COMMAND mkdir -p ${CMAKE_BINARY_DIR}/lib${LIB_SUFFIX}
                       COMMAND find ${CMAKE_BINARY_DIR}/avidemux -name '*.so*' | xargs ln -sft ${CMAKE_BINARY_DIR}/lib${LIB_SUFFIX}
                       WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
                       COMMENT "Creating temporary lib directory for proper plugins linking")
-ENDIF (UNIX AND NOT APPLE)
+       ENDFOREACH (t )
+ENDMACRO (ADM_SYMLINK_LIBS)
+IF (UNIX AND NOT APPLE)
+   # Some plugins link to ADM_coreImage (e.g., ADM_vf_addborders) and thus need the symlink in ${CMAKE_BINARY_DIR}/lib${LIB_SUFFIX}
+   ADM_SYMLINK_LIBS(ffmpeg ADM_coreImage)
+ENDIF(UNIX AND NOT APPLE)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/CMakeLists.txt	2010-04-29 17:58:36 UTC (rev 6145)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_avcodec/CMakeLists.txt	2010-04-30 16:30:20 UTC (rev 6146)
@@ -34,7 +34,8 @@
 getFfmpegLibNames(${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ffmpeg)
 
 add_library(ADM_libavcodec UNKNOWN IMPORTED)
-set_property(TARGET ADM_libavcodec PROPERTY IMPORTED_LOCATION "${FFMPEG_INSTALL_DIR}/${LIBAVCODEC_LIB}")
+#set_property(TARGET ADM_libavcodec PROPERTY IMPORTED_LOCATION "${FFMPEG_INSTALL_DIR}/${LIBAVCODEC_LIB}")
+set_property(TARGET ADM_libavcodec PROPERTY IMPORTED_LOCATION "${FFMPEG_LIB_DIR}/${LIBAVCODEC_LIB}")
 
 add_subdirectory(xml)
 
@@ -48,4 +49,4 @@
 INSTALL(FILES Flv1Param.xsd DESTINATION "${VIDENC_INSTALL_DIR}${PLUGIN_SCHEMA_DIR}")
 INSTALL(FILES MjpegParam.xsd DESTINATION "${VIDENC_INSTALL_DIR}${PLUGIN_SCHEMA_DIR}")
 INSTALL(FILES H263Param.xsd DESTINATION "${VIDENC_INSTALL_DIR}${PLUGIN_SCHEMA_DIR}")
-INSTALL(FILES Mpeg4aspParam.xsd DESTINATION "${VIDENC_INSTALL_DIR}${PLUGIN_SCHEMA_DIR}")
\ No newline at end of file
+INSTALL(FILES Mpeg4aspParam.xsd DESTINATION "${VIDENC_INSTALL_DIR}${PLUGIN_SCHEMA_DIR}")

Modified: branches/avidemux_2.5_branch_gruntster/plugins/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/CMakeLists.txt	2010-04-29 17:58:36 UTC (rev 6145)
+++ branches/avidemux_2.5_branch_gruntster/plugins/CMakeLists.txt	2010-04-30 16:30:20 UTC (rev 6146)
@@ -42,8 +42,18 @@
 ELSE (NOT AVIDEMUX_INSTALL_PREFIX)
 	SET(AVIDEMUX_INSTALL_PREFIX "${AVIDEMUX_INSTALL_PREFIX}" CACHE STRING "")
 ENDIF (NOT AVIDEMUX_INSTALL_PREFIX)
+########################################
+# If avidemux_lib_dir is set, use it
+# else use prefix
+########################################
+IF (AVIDEMUX_LIB_DIR)
+	SET(AVIDEMUX_LIB_DIR "${AVIDEMUX_LIB_DIR}" CACHE STRING "")
+ELSE (AVIDEMUX_LIB_DIR)
+	SET(AVIDEMUX_LIB_DIR "${AVIDEMUX_INSTALL_PREFIX}/lib${LIB_SUFFIX}" CACHE STRING "")
+ENDIF (AVIDEMUX_LIB_DIR)
 
-LINK_DIRECTORIES(${AVIDEMUX_INSTALL_PREFIX}/lib${LIB_SUFFIX})
+MESSAGE(STATUS "Using ${AVIDEMUX_LIB_DIR} to look for avidemux libraries")
+LINK_DIRECTORIES(${AVIDEMUX_LIB_DIR})
 
 ########################################
 # Where is coreConfig ?
@@ -98,7 +108,7 @@
 	ENDIF (CMAKE_BUILD_TYPE STREQUAL "Release")
 ELSE (WIN32)
 	SET(BIN_DIR bin)
-	set(FFMPEG_LIB_DIR ${AVIDEMUX_INSTALL_PREFIX}/lib${LIB_SUFFIX})
+	set(FFMPEG_LIB_DIR ${AVIDEMUX_LIB_DIR})
 ENDIF (WIN32)
 
 ########################################



