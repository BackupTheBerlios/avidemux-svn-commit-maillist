<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r5017 - in	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264:	. gtk qt4
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2009-July/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5017%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264%3A%0A%09.%20gtk%20qt4&In-Reply-To=%3C200907081336.n68DaAQ9008400%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002231.html">
   <LINK REL="Next"  HREF="002233.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r5017 - in	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264:	. gtk qt4</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5017%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264%3A%0A%09.%20gtk%20qt4&In-Reply-To=%3C200907081336.n68DaAQ9008400%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r5017 - in	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264:	. gtk qt4">gruntster at mail.berlios.de
       </A><BR>
    <I>Wed Jul  8 15:36:10 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002231.html">[Avidemux-svn-commit] r5016 - in	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder:	. common
</A></li>
        <LI>Next message: <A HREF="002233.html">[Avidemux-svn-commit] r5018 - in branches/avidemux_2.6_branch_mean:	avidemux_core/ADM_coreVideoEncoder/include	avidemux_core/ADM_coreVideoEncoder/src	avidemux_plugins/ADM_videoEncoder/ffMpeg4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2232">[ date ]</a>
              <a href="thread.html#2232">[ thread ]</a>
              <a href="subject.html#2232">[ subject ]</a>
              <a href="author.html#2232">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2009-07-08 15:35:56 +0200 (Wed, 08 Jul 2009)
New Revision: 5017

Added:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Options.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Options.h
Removed:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/presetOptions.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/presetOptions.h
Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/config.h.cmake
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/configGuiLoader.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/interface.c
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.h
Log:
[x264] use generic options class

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/CMakeLists.txt	2009-07-08 13:35:21 UTC (rev 5016)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/CMakeLists.txt	2009-07-08 13:35:56 UTC (rev 5017)
@@ -8,13 +8,16 @@
 	checkLibxml2()
 
 	IF (LIBXML2_FOUND)
-		INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR} ${X264_INCLUDE_DIR} ${LIBXML2_INCLUDE_DIR})
+		SET(PLUGIN_SUBDIR &quot;x264&quot;)
+		SET(QT_PLUGIN_NAME &quot;ADM_vidEnc_x264_Qt&quot;)
+		SET(GTK_PLUGIN_NAME &quot;ADM_vidEnc_x264_Gtk&quot;)
+		
+		INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR} ${X264_INCLUDE_DIR} ${LIBXML2_INCLUDE_DIR} ../common)
 		ADD_DEFINITIONS(${LIBXML2_DEFINITIONS})
+		ADD_DEFINITIONS(-DPLUGIN_SUBDIR=&quot;${PLUGIN_SUBDIR}&quot;)
 		
-		SET(QT_PLUGIN_NAME &quot;ADM_vidEnc_x264_Qt&quot;)
-		SET(GTK_PLUGIN_NAME &quot;ADM_vidEnc_x264_Gtk&quot;)
-		SET(PLUGIN_SUBDIR &quot;x264&quot;)
-		SET(ADM_vidEnc_x264_SRCS interface.c configGuiLoader.cpp encoder.cpp guiHelper.cpp options.cpp presetOptions.cpp zoneOptions.cpp)
+		SET(ADM_vidEnc_x264_SRCS interface.c configGuiLoader.cpp encoder.cpp guiHelper.cpp zoneOptions.cpp x264Options.cpp
+								 ../common/PluginOptions.cpp)
 
 		CONFIGURE_FILE(&quot;${CMAKE_CURRENT_SOURCE_DIR}/config.h.cmake&quot; &quot;${CMAKE_CURRENT_BINARY_DIR}/config.h&quot;)
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/config.h.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/config.h.cmake	2009-07-08 13:35:21 UTC (rev 5016)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/config.h.cmake	2009-07-08 13:35:56 UTC (rev 5017)
@@ -3,7 +3,6 @@
 
 #define QT_PLUGIN_NAME &quot;${QT_PLUGIN_NAME}&quot;
 #define GTK_PLUGIN_NAME &quot;${GTK_PLUGIN_NAME}&quot;
-#define PLUGIN_SUBDIR &quot;${PLUGIN_SUBDIR}&quot;
 		
 #define PLUGIN_PREFIX &quot;${CMAKE_SHARED_LIBRARY_PREFIX}&quot;
 #define PLUGIN_SUFFIX &quot;${CMAKE_SHARED_LIBRARY_SUFFIX}&quot;

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/configGuiLoader.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/configGuiLoader.h	2009-07-08 13:35:21 UTC (rev 5016)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/configGuiLoader.h	2009-07-08 13:35:56 UTC (rev 5017)
@@ -2,7 +2,7 @@
 #define configGuiLoader_h
 
 #include &quot;ADM_dynamicLoading.h&quot;
-#include &quot;options.h&quot;
+#include &quot;x264Options.h&quot;
 
 extern &quot;C&quot;
 {

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.cpp	2009-07-08 13:35:21 UTC (rev 5016)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/encoder.cpp	2009-07-08 13:35:56 UTC (rev 5017)
@@ -20,7 +20,7 @@
 #include &quot;ADM_inttype.h&quot;
 #include &quot;ADM_files.h&quot;
 #include &quot;encoder.h&quot;
-#include &quot;options.h&quot;
+#include &quot;x264Options.h&quot;
 
 static x264Encoder encoder;
 static void* encoders = { &amp;encoder };
@@ -133,7 +133,7 @@
 
 int x264Encoder::getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize)
 {
-	char* xml = _options.toXml();
+	char* xml = _options.toXml(PLUGIN_XML_INTERNAL);
 	int xmlLength = strlen(xml);
 
 	if (bufferSize &gt;= xmlLength)
@@ -157,7 +157,7 @@
 	bool success = true;
 
 	if (pluginOptions)
-		success = _options.fromXml(pluginOptions);
+		success = _options.fromXml(pluginOptions, PLUGIN_XML_INTERNAL);
 
 	if (encodeOptions &amp;&amp; success)
 	{

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.h	2009-07-08 13:35:21 UTC (rev 5016)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/gtk/x264ConfigDialog.h	2009-07-08 13:35:56 UTC (rev 5017)
@@ -3,7 +3,7 @@
 
 #include &lt;gtk/gtk.h&gt;
 
-#include &quot;../options.h&quot;
+#include &quot;../x264Options.h&quot;
 
 extern &quot;C&quot;
 {

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/interface.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/interface.c	2009-07-08 13:35:21 UTC (rev 5016)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/interface.c	2009-07-08 13:35:56 UTC (rev 5017)
@@ -66,7 +66,7 @@
 {
 	*major = 1;
 	*minor = 0;
-	*patch = 0;
+	*patch = 1;
 }
 
 const char* vidEncGetEncoderGuid(int encoderId)

Deleted: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.cpp	2009-07-08 13:35:21 UTC (rev 5016)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.cpp	2009-07-08 13:35:56 UTC (rev 5017)
@@ -1,2063 +0,0 @@
- /***************************************************************************
-                               x264Options.cpp
-
-	These settings are intended for scripting and can contain a Preset 
-	Configuration block.  If this block exists then &quot;internal&quot; settings are
-	ignored and an external configuration file should be read instead, 
-	e.g. PlayStation Portable profile.  However, if the external file is 
-	missing, internal settings have to be used and will reflect a snapshot
-	of the external configuration file at the time the script was generated.
-
-    begin                : Mon Apr 21 2008
-    copyright            : (C) 2008 by gruntster
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &lt;math.h&gt;
-#include &lt;libxml/parser.h&gt;
-#include &lt;libxml/xmlschemas.h&gt;
-#include &lt;sstream&gt;
-#include &lt;string&gt;
-
-#include &quot;config.h&quot;
-#include &quot;ADM_inttype.h&quot;
-#include &quot;ADM_files.h&quot;
-#include &quot;options.h&quot;
-
-x264Options::x264Options(void)
-{
-	_configurationName = NULL;
-	memset(&amp;_param, 0, sizeof(x264_param_t));
-
-	reset();
-}
-
-x264Options::~x264Options(void)
-{
-	cleanUp();
-}
-
-void x264Options::cleanUp(void)
-{
-	if (_configurationName)
-	{
-		free(_configurationName);
-		_configurationName = NULL;
-	}
-
-	clearZones();
-}
-
-void x264Options::reset(void)
-{
-	cleanUp();
-
-	x264_param_default(&amp;_param);
-	_param.vui.i_sar_height = 1;
-	_param.vui.i_sar_width = 1;
-	_param.i_threads = 0;	// set to auto-detect; default is disabled
-
-	_sarAsInput = false;
-
-	setPresetConfiguration(&quot;&lt;default&gt;&quot;, CONFIG_DEFAULT);
-}
-
-x264_param_t* x264Options::getParameters(void)
-{
-	x264_param_t *param = new x264_param_t;
-
-	memcpy(param, &amp;_param, sizeof(x264_param_t));
-	param-&gt;rc.i_zones = getZoneCount();
-
-	if (param-&gt;rc.i_zones)
-	{
-		param-&gt;rc.zones = new x264_zone_t[param-&gt;rc.i_zones];
-
-		for (int zone = 0; zone &lt; param-&gt;rc.i_zones; zone++)
-			_zoneOptions[zone]-&gt;setX264Zone(&amp;param-&gt;rc.zones[zone]);
-	}
-
-	return param;
-}
-
-void x264Options::getPresetConfiguration(char** configurationName, configType *configurationType)
-{
-	if (_configurationName)
-		*configurationName = strdup(_configurationName);
-	else
-		*configurationName = NULL;
-
-	*configurationType = _configurationType;
-}
-
-void x264Options::setPresetConfiguration(const char* configurationName, configType configurationType)
-{
-	clearPresetConfiguration();
-
-	_configurationName = strdup(configurationName);
-	_configurationType = configurationType;
-}
-
-void x264Options::clearPresetConfiguration(void)
-{
-	if (_configurationName)
-		free(_configurationName);
-
-	_configurationName = strdup(&quot;&lt;custom&gt;&quot;);
-	_configurationType = CONFIG_CUSTOM;
-}
-
-int x264Options::getThreads(void)
-{
-	return _param.i_threads;
-}
-
-void x264Options::setThreads(int threads)
-{
-	if (threads &gt;= 0)
-		_param.i_threads = threads;
-}
-
-bool x264Options::getDeterministic(void)
-{
-	return _param.b_deterministic;
-}
-
-void x264Options::setDeterministic(bool deterministic)
-{
-	_param.b_deterministic = deterministic;
-}
-
-int x264Options::getIdcLevel(void)
-{
-	return _param.i_level_idc;
-}
-
-void x264Options::setIdcLevel(int idcLevel)
-{
-	switch (idcLevel)
-	{
-		case -1:
-		case 1:
-		case 11:
-		case 12:
-		case 13:
-		case 2:
-		case 21:
-		case 22:
-		case 3:
-		case 31:
-		case 32:
-		case 4:
-		case 41:
-		case 42:
-		case 5:
-		case 51:
-			_param.i_level_idc = idcLevel;
-	}
-}
-
-bool x264Options::getSarAsInput(void)
-{
-	return _sarAsInput;
-}
-
-void x264Options::setSarAsInput(bool sarAsInput)
-{
-	_sarAsInput = sarAsInput;
-}
-
-unsigned int x264Options::getSarHeight(void)
-{
-	return _param.vui.i_sar_height;
-}
-
-void x264Options::setSarHeight(unsigned int height)
-{
-	_param.vui.i_sar_height = height;
-}
-
-unsigned int x264Options::getSarWidth(void)
-{
-	return _param.vui.i_sar_width;
-}
-
-void x264Options::setSarWidth(unsigned int width)
-{
-	_param.vui.i_sar_width = width;
-}
-
-unsigned int x264Options::getOverscan(void)
-{
-	return _param.vui.i_overscan;
-}
-
-void x264Options::setOverscan(unsigned int overscan)
-{
-	if (overscan &lt;= 2)
-		_param.vui.i_overscan = overscan;
-}
-
-unsigned int x264Options::getVideoFormat(void)
-{
-	return _param.vui.i_vidformat;
-}
-
-void x264Options::setVideoFormat(unsigned int videoFormat)
-{
-	if (videoFormat &lt;= 5)
-		_param.vui.i_vidformat = videoFormat;
-}
-
-bool x264Options::getFullRangeSamples(void)
-{
-	return _param.vui.b_fullrange;
-}
-
-void x264Options::setFullRangeSamples(bool fullRangeSamples)
-{
-	_param.vui.b_fullrange = fullRangeSamples;
-}
-
-unsigned int x264Options::getColorPrimaries(void)
-{
-	return _param.vui.i_colorprim;
-}
-
-void x264Options::setColorPrimaries(unsigned int colorPrimaries)
-{
-	if (colorPrimaries &lt;= 8 &amp;&amp; colorPrimaries != 0 &amp;&amp; colorPrimaries != 3)
-		_param.vui.i_colorprim = colorPrimaries;
-}
-
-unsigned int x264Options::getTransfer(void)
-{
-	return _param.vui.i_transfer;
-}
-
-void x264Options::setTransfer(unsigned int transfer)
-{
-	if (transfer &lt;= 10 &amp;&amp; transfer != 0 &amp;&amp; transfer != 3)
-		_param.vui.i_transfer = transfer;
-}
-
-unsigned int x264Options::getColorMatrix(void)
-{
-	return _param.vui.i_colmatrix;
-}
-
-void x264Options::setColorMatrix(unsigned int colorMatrix)
-{
-	if (colorMatrix &lt;= 8 &amp;&amp; colorMatrix != 3)
-		_param.vui.i_colmatrix = colorMatrix;
-}
-
-unsigned int x264Options::getChromaSampleLocation(void)
-{
-	return _param.vui.i_chroma_loc;
-}
-
-void x264Options::setChromaSampleLocation(unsigned int chromaSampleLocation)
-{
-	if (chromaSampleLocation &lt;= 5)
-		_param.vui.i_chroma_loc = chromaSampleLocation;
-}
-
-unsigned int x264Options::getReferenceFrames(void)
-{
-	return _param.i_frame_reference;
-}
-
-void x264Options::setReferenceFrames(unsigned int referenceFrames)
-{
-	if (referenceFrames &lt;= 16)
-		_param.i_frame_reference = referenceFrames;
-}
-
-unsigned int x264Options::getGopMinimumSize(void)
-{
-	return _param.i_keyint_min;
-}
-
-void x264Options::setGopMinimumSize(unsigned int gopSize)
-{
-	if (gopSize &lt;= 100)
-		_param.i_keyint_min = gopSize;
-}
-
-unsigned int x264Options::getGopMaximumSize(void)
-{
-	return _param.i_keyint_max;
-}
-
-void x264Options::setGopMaximumSize(unsigned int gopSize)
-{
-	if (gopSize &lt;= 1000)
-		_param.i_keyint_max = gopSize;
-}
-
-unsigned int x264Options::getScenecutThreshold(void)
-{
-	return _param.i_scenecut_threshold;
-}
-
-void x264Options::setScenecutThreshold(unsigned int scenecutThreshold)
-{
-	if (scenecutThreshold &lt;= 100)
-		_param.i_scenecut_threshold = scenecutThreshold;
-}
-
-#if X264_BUILD &lt; 67
-bool x264Options::getPreScenecutDetection(void)
-{
-	return _param.b_pre_scenecut;
-}
-
-void x264Options::setPreScenecutDetection(bool preScenecutDetection)
-{
-	_param.b_pre_scenecut = preScenecutDetection;
-}
-#endif
-
-unsigned int x264Options::getBFrames(void)
-{
-	return _param.i_bframe;
-}
-
-void x264Options::setBFrames(unsigned int bFrames)
-{
-	if (bFrames &lt;= 100)
-		_param.i_bframe = bFrames;
-}
-
-unsigned int x264Options::getAdaptiveBFrameDecision(void)
-{
-#if X264_BUILD &gt;= 63
-	return _param.i_bframe_adaptive;
-#else
-	return _param.b_bframe_adaptive;
-#endif
-}
-
-void x264Options::setAdaptiveBFrameDecision(unsigned int adaptiveBframeDecision)
-{
-	if (adaptiveBframeDecision &lt;= 2)
-#if X264_BUILD &gt;= 63
-		_param.i_bframe_adaptive = adaptiveBframeDecision;
-#else
-		_param.b_bframe_adaptive = adaptiveBframeDecision;
-#endif
-}
-
-int x264Options::getBFrameBias(void)
-{
-	return _param.i_bframe_bias;
-}
-
-void x264Options::setBFrameBias(int bFrameBias)
-{
-	if (bFrameBias &gt;= -100 &amp;&amp; bFrameBias &lt;= 100)
-		_param.i_bframe_bias = bFrameBias;
-}
-
-bool x264Options::getBFrameReferences(void)
-{
-	return _param.b_bframe_pyramid;
-}
-
-void x264Options::setBFrameReferences(bool bFrameReferences)
-{
-	_param.b_bframe_pyramid = bFrameReferences;
-}
-
-bool x264Options::getLoopFilter(void)
-{
-	return _param.b_deblocking_filter;
-}
-
-void x264Options::setLoopFilter(bool loopFilter)
-{
-	_param.b_deblocking_filter = loopFilter;
-}
-
-int x264Options::getLoopFilterAlphaC0(void)
-{
-	return _param.i_deblocking_filter_alphac0;
-}
-
-void x264Options::setLoopFilterAlphaC0(int loopFilterAlphaC0)
-{
-	if (loopFilterAlphaC0 &gt;= -6 &amp;&amp; loopFilterAlphaC0 &lt;= 6)
-		_param.i_deblocking_filter_alphac0 = loopFilterAlphaC0;
-}
-
-int x264Options::getLoopFilterBeta(void)
-{
-	return _param.i_deblocking_filter_beta;
-}
-
-void x264Options::setLoopFilterBeta(int loopFilterBeta)
-{
-	if (loopFilterBeta &gt;= -6 &amp;&amp; loopFilterBeta &lt;= 6)
-		_param.i_deblocking_filter_beta = loopFilterBeta;
-}
-
-bool x264Options::getCabac(void)
-{
-	return _param.b_cabac;
-}
-
-void x264Options::setCabac(bool cabac)
-{
-	_param.b_cabac = cabac;
-}
-
-bool x264Options::getInterlaced(void)
-{
-	return _param.b_interlaced;
-}
-
-void x264Options::setInterlaced(bool interlaced)
-{
-	_param.b_interlaced = interlaced;
-}
-
-unsigned int x264Options::getCqmPreset(void)
-{
-	return _param.i_cqm_preset;
-}
-
-void x264Options::setCqmPreset(unsigned int cqmPreset)
-{
-	if (cqmPreset &lt;= 2)
-		_param.i_cqm_preset = cqmPreset;
-}
-
-uint8_t* x264Options::getIntra4x4Luma(void)
-{
-	return _param.cqm_4iy;
-}
-
-void x264Options::setIntra4x4Luma(uint8_t intra4x4Luma[])
-{
-	memcpy(_param.cqm_4iy, intra4x4Luma, 16 * sizeof(uint8_t));
-}
-
-uint8_t* x264Options::getIntraChroma(void)
-{
-	return _param.cqm_4ic;
-}
-
-void x264Options::setIntraChroma(uint8_t intraChroma[])
-{
-	memcpy(_param.cqm_4ic, intraChroma, 16 * sizeof(uint8_t));
-}
-
-uint8_t* x264Options::getInter4x4Luma(void)
-{
-	return _param.cqm_4py;
-}
-
-void x264Options::setInter4x4Luma(uint8_t inter4x4Luma[])
-{
-	memcpy(_param.cqm_4py, inter4x4Luma, 16 * sizeof(uint8_t));
-}
-
-uint8_t* x264Options::getInterChroma(void)
-{
-	return _param.cqm_4pc;
-}
-
-void x264Options::setInterChroma(uint8_t interChroma[])
-{
-	memcpy(_param.cqm_4pc, interChroma, 16 * sizeof(uint8_t));
-}
-
-uint8_t* x264Options::getIntra8x8Luma(void)
-{
-	return _param.cqm_8iy;
-}
-
-void x264Options::setIntra8x8Luma(uint8_t intra8x8Luma[])
-{
-	memcpy(_param.cqm_8iy, intra8x8Luma, 64 * sizeof(uint8_t));
-}
-
-uint8_t* x264Options::getInter8x8Luma(void)
-{
-	return _param.cqm_8py;
-}
-
-void x264Options::setInter8x8Luma(uint8_t inter8x8Luma[])
-{
-	memcpy(_param.cqm_8py, inter8x8Luma, 64 * sizeof(uint8_t));
-}
-
-bool x264Options::getPartitionI4x4(void)
-{
-	return (_param.analyse.inter &amp; X264_ANALYSE_I4x4) == X264_ANALYSE_I4x4;
-}
-
-void x264Options::setPartitionI4x4(bool partitionI4x4)
-{
-	if (partitionI4x4)
-		_param.analyse.inter |= X264_ANALYSE_I4x4;
-	else
-		_param.analyse.inter &amp;= ~X264_ANALYSE_I4x4;
-}
-
-bool x264Options::getPartitionI8x8(void)
-{
-	return (_param.analyse.inter &amp; X264_ANALYSE_I8x8) == X264_ANALYSE_I8x8;
-}
-
-void x264Options::setPartitionI8x8(bool partitionI8x8)
-{
-	if (partitionI8x8)
-		_param.analyse.inter |= X264_ANALYSE_I8x8;
-	else
-		_param.analyse.inter &amp;= ~X264_ANALYSE_I8x8;
-}
-
-bool x264Options::getPartitionP8x8(void)
-{
-	return (_param.analyse.inter &amp; X264_ANALYSE_PSUB16x16) == X264_ANALYSE_PSUB16x16;
-}
-
-void x264Options::setPartitionP8x8(bool partitionP8x8)
-{
-	if (partitionP8x8)
-		_param.analyse.inter |= X264_ANALYSE_PSUB16x16;
-	else
-		_param.analyse.inter &amp;= ~X264_ANALYSE_PSUB16x16;
-}
-
-bool x264Options::getPartitionP4x4(void)
-{
-	return (_param.analyse.inter &amp; X264_ANALYSE_PSUB8x8) == X264_ANALYSE_PSUB8x8;
-}
-
-void x264Options::setPartitionP4x4(bool partitionP4x4)
-{
-	if (partitionP4x4)
-		_param.analyse.inter |= X264_ANALYSE_PSUB8x8;
-	else
-		_param.analyse.inter &amp;= ~X264_ANALYSE_PSUB8x8;
-}
-
-bool x264Options::getPartitionB8x8(void)
-{
-	return (_param.analyse.inter &amp; X264_ANALYSE_BSUB16x16) == X264_ANALYSE_BSUB16x16;
-}
-
-void x264Options::setPartitionB8x8(bool partitionB8x8)
-{
-	if (partitionB8x8)
-		_param.analyse.inter |= X264_ANALYSE_BSUB16x16;
-	else
-		_param.analyse.inter &amp;= ~X264_ANALYSE_BSUB16x16;
-}
-
-bool x264Options::getDct8x8(void)
-{
-	return _param.analyse.b_transform_8x8;
-}
-
-void x264Options::setDct8x8(bool dct8x8)
-{
-	_param.analyse.b_transform_8x8 = dct8x8;
-}
-
-bool x264Options::getWeightedPrediction(void)
-{
-	return _param.analyse.b_weighted_bipred;
-}
-
-void x264Options::setWeightedPrediction(bool weightedPrediction)
-{
-	_param.analyse.b_weighted_bipred = weightedPrediction;
-}
-
-unsigned int x264Options::getDirectPredictionMode(void)
-{
-	return _param.analyse.i_direct_mv_pred;
-}
-
-void x264Options::setDirectPredictionMode(unsigned int directPredictionMode)
-{
-	if (directPredictionMode &lt;= 3)
-		_param.analyse.i_direct_mv_pred = directPredictionMode;
-}
-
-#if X264_BUILD &lt; 66
-int x264Options::getDirectPredictionSize(void)
-{
-	return _param.analyse.i_direct_8x8_inference;
-}
-
-void x264Options::setDirectPredictionSize(int directPredictionSize)
-{
-	if (directPredictionSize &gt;= -1 &amp;&amp; directPredictionSize &lt;= 1)
-		_param.analyse.i_direct_8x8_inference = directPredictionSize;
-}
-#endif
-
-int x264Options::getChromaLumaQuantiserDifference(void)
-{
-	return _param.analyse.i_chroma_qp_offset;
-}
-
-void x264Options::setChromaLumaQuantiserDifference(int chromaLumaQuantiserDifference)
-{
-	if (chromaLumaQuantiserDifference &gt;= -12 &amp;&amp; chromaLumaQuantiserDifference &lt;= 12)
-		_param.analyse.i_chroma_qp_offset = chromaLumaQuantiserDifference;
-}
-
-unsigned int x264Options::getMotionEstimationMethod(void)
-{
-	return _param.analyse.i_me_method;
-}
-
-void x264Options::setMotionEstimationMethod(unsigned int motionEstimationMethod)
-{
-	if (motionEstimationMethod &lt;= 4)
-		_param.analyse.i_me_method = motionEstimationMethod;
-}
-
-unsigned int x264Options::getMotionVectorSearchRange(void)
-{
-	return _param.analyse.i_me_range;
-}
-
-void x264Options::setMotionVectorSearchRange(unsigned int motionVectorSearchRange)
-{
-	if (motionVectorSearchRange &lt;= 64)
-		_param.analyse.i_me_range = motionVectorSearchRange;
-}
-
-int x264Options::getMotionVectorLength(void)
-{
-	return _param.analyse.i_mv_range;
-}
-
-void x264Options::setMotionVectorLength(int motionVectorLength)
-{
-	if (motionVectorLength == -1 || (motionVectorLength &gt;= 32 &amp;&amp; motionVectorLength &lt;= 512))
-		_param.analyse.i_mv_range = motionVectorLength;
-}
-
-int x264Options::getMotionVectorThreadBuffer(void)
-{
-	return _param.analyse.i_mv_range_thread;
-}
-
-void x264Options::setMotionVectorThreadBuffer(int motionVectorThreadBuffer)
-{
-	_param.analyse.i_mv_range_thread = motionVectorThreadBuffer;
-}
-
-unsigned int x264Options::getSubpixelRefinement(void)
-{
-	return _param.analyse.i_subpel_refine;
-}
-
-void x264Options::setSubpixelRefinement(unsigned int subpixelRefinement)
-{
-	if (subpixelRefinement &gt;= 1 &amp;&amp; subpixelRefinement &lt;= 9)
-		_param.analyse.i_subpel_refine = subpixelRefinement;
-}
-
-#if X264_BUILD &lt; 65
-bool x264Options::getBidirectionalMotionEstimation(void)
-{
-	return _param.analyse.b_bidir_me;
-}
-
-void x264Options::setBidirectionalMotionEstimation(bool bidirectionalMotionEstimation)
-{
-	_param.analyse.b_bidir_me = bidirectionalMotionEstimation;
-}
-#endif
-
-bool x264Options::getChromaMotionEstimation(void)
-{
-	return _param.analyse.b_chroma_me;
-}
-
-void x264Options::setChromaMotionEstimation(bool chromaMotionEstimation)
-{
-	_param.analyse.b_chroma_me = chromaMotionEstimation;
-}
-
-#if X264_BUILD &lt; 65
-bool x264Options::getBFrameRdo(void)
-{
-	return _param.analyse.b_bframe_rdo;
-}
-
-void x264Options::setBFrameRdo(bool bFrameRdo)
-{
-	_param.analyse.b_bframe_rdo = bFrameRdo;
-}
-#endif
-
-bool x264Options::getMixedReferences(void)
-{
-	return _param.analyse.b_mixed_references;
-}
-
-void x264Options::setMixedReferences(bool mixedReferences)
-{
-	_param.analyse.b_mixed_references = mixedReferences;
-}
-
-unsigned int x264Options::getTrellis(void)
-{
-	return _param.analyse.i_trellis;
-}
-
-void x264Options::setTrellis(unsigned int trellis)
-{
-	if (trellis &lt;= 2)
-		_param.analyse.i_trellis = trellis;
-}
-
-bool x264Options::getFastPSkip(void)
-{
-	return _param.analyse.b_fast_pskip;
-}
-
-void x264Options::setFastPSkip(bool fastPSkip)
-{
-	_param.analyse.b_fast_pskip = fastPSkip;
-}
-
-bool x264Options::getDctDecimate(void)
-{
-	return _param.analyse.b_dct_decimate;
-}
-
-void x264Options::setDctDecimate(bool dctDecimate)
-{
-	_param.analyse.b_dct_decimate = dctDecimate;
-}
-
-unsigned int x264Options::getNoiseReduction(void)
-{
-	return _param.analyse.i_noise_reduction;
-}
-
-void x264Options::setNoiseReduction(unsigned int noiseReduction)
-{
-	if (noiseReduction &lt;= 65536)
-		_param.analyse.i_noise_reduction = noiseReduction;
-}
-
-unsigned int x264Options::getInterLumaDeadzone(void)
-{
-	return _param.analyse.i_luma_deadzone[0];
-}
-
-void x264Options::setInterLumaDeadzone(unsigned int interLumaDeadzone)
-{
-	if (interLumaDeadzone &lt;= 32)
-		_param.analyse.i_luma_deadzone[0] = interLumaDeadzone;
-}
-
-unsigned int x264Options::getIntraLumaDeadzone(void)
-{
-	return _param.analyse.i_luma_deadzone[1];
-}
-
-void x264Options::setIntraLumaDeadzone(unsigned int intraLumaDeadzone)
-{
-	if (intraLumaDeadzone &lt;= 32)
-		_param.analyse.i_luma_deadzone[1] = intraLumaDeadzone;
-}
-
-unsigned int x264Options::getQuantiserMinimum(void)
-{
-	return _param.rc.i_qp_min;
-}
-
-void x264Options::setQuantiserMinimum(unsigned int quantiserMinimum)
-{
-	if (quantiserMinimum &gt;= 10 &amp;&amp; quantiserMinimum &lt;= 51)
-		_param.rc.i_qp_min = quantiserMinimum;
-}
-
-unsigned int x264Options::getQuantiserMaximum(void)
-{
-	return _param.rc.i_qp_max;
-}
-
-void x264Options::setQuantiserMaximum(unsigned int quantiserMaximum)
-{
-	if (quantiserMaximum &gt;= 10 &amp;&amp; quantiserMaximum &lt;= 51)
-		_param.rc.i_qp_max = quantiserMaximum;
-}
-
-unsigned int x264Options::getQuantiserStep(void)
-{
-	return _param.rc.i_qp_step;
-}
-
-void x264Options::setQuantiserStep(unsigned int quantiserStep)
-{
-	if (quantiserStep &lt;= 10)
-		_param.rc.i_qp_step = quantiserStep;
-}
-
-float x264Options::getAverageBitrateTolerance(void)
-{
-	return _param.rc.f_rate_tolerance;
-}
-
-void x264Options::setAverageBitrateTolerance(float averageBitrateTolerance)
-{
-	if (averageBitrateTolerance &gt;= 0 &amp;&amp; averageBitrateTolerance &lt;= 1)
-		_param.rc.f_rate_tolerance = averageBitrateTolerance;
-}
-
-unsigned int x264Options::getVbvMaximumBitrate(void)
-{
-	return _param.rc.i_vbv_max_bitrate;
-}
-
-void x264Options::setVbvMaximumBitrate(unsigned int vbvMaximumBitrate)
-{
-	if (vbvMaximumBitrate &lt;= 99999)
-		_param.rc.i_vbv_max_bitrate = vbvMaximumBitrate;
-}
-
-unsigned int x264Options::getVbvBufferSize(void)
-{
-	return _param.rc.i_vbv_buffer_size;
-}
-
-void x264Options::setVbvBufferSize(unsigned int vbvBufferSize)
-{
-	if (vbvBufferSize &lt;= 99999)
-		_param.rc.i_vbv_buffer_size = vbvBufferSize;
-}
-
-float x264Options::getVbvInitialOccupancy(void)
-{
-	return _param.rc.f_vbv_buffer_init;
-}
-
-void x264Options::setVbvInitialOccupancy(float vbvInitialOccupancy)
-{
-	if (vbvInitialOccupancy &gt;= 0 &amp;&amp; vbvInitialOccupancy &lt;= 1)
-		_param.rc.f_vbv_buffer_init = vbvInitialOccupancy;
-}
-
-float x264Options::getIpFrameQuantiser(void)
-{
-	return _param.rc.f_ip_factor;
-}
-
-void x264Options::setIpFrameQuantiser(float ipFrameQuantiser)
-{
-	if (ipFrameQuantiser &gt;= 1 &amp;&amp; ipFrameQuantiser &lt;= 10)
-		_param.rc.f_ip_factor = ipFrameQuantiser;
-}
-
-float x264Options::getPbFrameQuantiser(void)
-{
-	return _param.rc.f_pb_factor;
-}
-
-void x264Options::setPbFrameQuantiser(float pbFrameQuantiser)
-{
-	if (pbFrameQuantiser &gt;= 1 &amp;&amp; pbFrameQuantiser &lt;= 10)
-		_param.rc.f_pb_factor = pbFrameQuantiser;
-}
-
-#if X264_BUILD &gt;= 62
-unsigned int x264Options::getAdaptiveQuantiserMode(void)
-{
-	return _param.rc.i_aq_mode;
-}
-
-void x264Options::setAdaptiveQuantiserMode(unsigned int adaptiveQuantiserMode)
-{
-	if (adaptiveQuantiserMode &lt;= 1)
-		_param.rc.i_aq_mode = adaptiveQuantiserMode;
-}
-
-float x264Options::getAdaptiveQuantiserStrength(void)
-{
-	return _param.rc.f_aq_strength;
-}
-
-void x264Options::setAdaptiveQuantiserStrength(float adaptiveQuantiserStrength)
-{
-	_param.rc.f_aq_strength = adaptiveQuantiserStrength;
-}
-#endif
-
-float x264Options::getQuantiserCurveCompression(void)
-{
-	return _param.rc.f_qcompress;
-}
-
-void x264Options::setQuantiserCurveCompression(float quantiserCurveCompression)
-{
-	if (quantiserCurveCompression &gt;= 0 &amp;&amp; quantiserCurveCompression &lt;= 1)
-		_param.rc.f_qcompress = quantiserCurveCompression;
-}
-
-float x264Options::getReduceFluxBeforeCurveCompression(void)
-{
-	return _param.rc.f_complexity_blur;
-}
-
-void x264Options::setReduceFluxBeforeCurveCompression(float reduceFluxBeforeCurveCompression)
-{
-	if (reduceFluxBeforeCurveCompression &gt;= 0 &amp;&amp; reduceFluxBeforeCurveCompression &lt;= 999)
-		_param.rc.f_complexity_blur = reduceFluxBeforeCurveCompression;
-}
-
-float x264Options::getReduceFluxAfterCurveCompression(void)
-{
-	return _param.rc.f_qblur;
-}
-
-void x264Options::setReduceFluxAfterCurveCompression(float reduceFluxAfterCurveCompression)
-{
-	if (reduceFluxAfterCurveCompression &gt;= 0 &amp;&amp; reduceFluxAfterCurveCompression &lt;= 1)
-		_param.rc.f_qblur = reduceFluxAfterCurveCompression;
-}
-
-unsigned int x264Options::getZoneCount(void)
-{
-	return _zoneOptions.size();
-}
-
-x264ZoneOptions** x264Options::getZones(void)
-{
-	unsigned int zoneCount = getZoneCount();
-	x264ZoneOptions **zoneOptions = new x264ZoneOptions*[zoneCount];
-
-	for (int zone = 0; zone &lt; zoneCount; zone++)
-		zoneOptions[zone] = _zoneOptions[zone]-&gt;clone();
-
-	return zoneOptions;
-}
-
-void x264Options::clearZones(void)
-{
-	for (int zone = 0; zone &lt; getZoneCount(); zone++)
-		delete _zoneOptions[zone];
-
-	_zoneOptions.clear();
-}
-
-void x264Options::addZone(x264ZoneOptions *zoneOptions)
-{
-	x264ZoneOptions *clonedOptions = zoneOptions-&gt;clone();
-
-	_zoneOptions.push_back(clonedOptions);
-}
-
-bool x264Options::getAccessUnitDelimiters(void)
-{
-	return _param.b_aud;
-}
-
-void x264Options::setAccessUnitDelimiters(bool accessUnitDelimiters)
-{
-	_param.b_aud = accessUnitDelimiters;
-}
-
-unsigned int x264Options::getSpsIdentifier(void)
-{
-	return _param.i_sps_id;
-}
-
-void x264Options::setSpsIdentifier(unsigned int spsIdentifier)
-{
-	switch (spsIdentifier)
-	{
-		case 0:
-		case 1:
-		case 3:
-		case 7:
-		case 15:
-		case 31:
-			_param.i_sps_id = spsIdentifier;
-	}
-}
-
-char* x264Options::toXml(void)
-{
-	xmlDocPtr xmlDoc = xmlNewDoc((const xmlChar*)&quot;1.0&quot;);
-	xmlNodePtr xmlNodeRoot, xmlNodeChild;
-	const int bufferSize = 100;
-	xmlChar xmlBuffer[bufferSize + 1];
-	char *xml = NULL;
-
-	while (true)
-	{
-		if (!xmlDoc)
-			break;
-
-		if (!(xmlNodeRoot = xmlNewDocNode(xmlDoc, NULL, (xmlChar*)&quot;x264Config&quot;, NULL)))
-			break;
-
-		xmlDocSetRootElement(xmlDoc, xmlNodeRoot);
-
-		if (_configurationType != CONFIG_CUSTOM)
-		{
-			xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;presetConfiguration&quot;, NULL);
-
-			xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;name&quot;, (xmlChar*)_configurationName);
-
-			if (_configurationType == CONFIG_USER)
-				strcpy((char*)xmlBuffer, &quot;user&quot;);
-			else if (_configurationType == CONFIG_SYSTEM)
-				strcpy((char*)xmlBuffer, &quot;system&quot;);
-			else
-				strcpy((char*)xmlBuffer, &quot;default&quot;);
-
-			xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;type&quot;, xmlBuffer);
-		}
-
-		addX264OptionsToXml(xmlNodeRoot);
-		xml = dumpXmlDocToMemory(xmlDoc);
-		xmlFreeDoc(xmlDoc);
-
-		break;
-	}
-
-	return xml;
-}
-
-char* x264Options::dumpXmlDocToMemory(xmlDocPtr xmlDoc)
-{
-	xmlChar *tempBuffer;
-	int tempBufferSize;
-	char *xml = NULL;
-
-	xmlDocDumpMemory(xmlDoc, &amp;tempBuffer, &amp;tempBufferSize);
-
-	// remove carriage returns (even though libxml was instructed not to format the XML)
-	xmlChar* bufferChar = tempBuffer;
-	int bufferCharIndex = 0;
-
-	while (*bufferChar != '\0')
-	{
-		if (*bufferChar == '\n')
-		{
-			memmove(bufferChar, bufferChar + 1, tempBufferSize - bufferCharIndex);
-			tempBufferSize--;
-		}
-		else if (*bufferChar == '\&quot;')
-			*bufferChar = '\'';
-
-		bufferChar++;
-		bufferCharIndex++;
-	}
-
-	xml = new char[tempBufferSize + 1];
-	memcpy(xml, tempBuffer, tempBufferSize);
-	xml[tempBufferSize] = 0;
-
-	return xml;
-}
-
-void x264Options::addX264OptionsToXml(xmlNodePtr xmlNodeRoot)
-{
-	const int bufferSize = 100;
-	xmlChar xmlBuffer[bufferSize + 1];
-	xmlNodePtr xmlNodeChild, xmlNodeChild2;
-
-	xmlNodeRoot = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;x264Options&quot;, NULL);
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;threads&quot;, number2String(xmlBuffer, bufferSize, getThreads()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;deterministic&quot;, boolean2String(xmlBuffer, bufferSize, getDeterministic()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;idcLevel&quot;, number2String(xmlBuffer, bufferSize, getIdcLevel()));
-
-	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;vui&quot;, NULL);
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;sarAsInput&quot;, boolean2String(xmlBuffer, bufferSize, getSarAsInput()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;sarHeight&quot;, number2String(xmlBuffer, bufferSize, getSarHeight()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;sarWidth&quot;, number2String(xmlBuffer, bufferSize, getSarWidth()));
-
-	switch (getOverscan())
-	{
-		case 0:
-			strcpy((char*)xmlBuffer, &quot;undefined&quot;);
-			break;
-		case 1:
-			strcpy((char*)xmlBuffer, &quot;show&quot;);
-			break;
-		case 2:
-			strcpy((char*)xmlBuffer, &quot;crop&quot;);
-			break;
-	}
-
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;overscan&quot;, xmlBuffer);
-
-	switch (getVideoFormat())
-	{
-		case 0:
-			strcpy((char*)xmlBuffer, &quot;component&quot;);
-			break;
-		case 1:
-			strcpy((char*)xmlBuffer, &quot;pal&quot;);
-			break;
-		case 2:
-			strcpy((char*)xmlBuffer, &quot;ntsc&quot;);
-			break;
-		case 3:
-			strcpy((char*)xmlBuffer, &quot;secam&quot;);
-			break;
-		case 4:
-			strcpy((char*)xmlBuffer, &quot;mac&quot;);
-			break;
-		case 5:
-			strcpy((char*)xmlBuffer, &quot;undefined&quot;);
-			break;
-	}
-
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;videoFormat&quot;, xmlBuffer);
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;fullRangeSamples&quot;, boolean2String(xmlBuffer, bufferSize, getFullRangeSamples()));
-
-	switch (getColorPrimaries())
-	{
-		case 1:
-			strcpy((char*)xmlBuffer, &quot;bt709&quot;);
-			break;
-		case 2:
-			strcpy((char*)xmlBuffer, &quot;undefined&quot;);
-			break;
-		case 4:
-			strcpy((char*)xmlBuffer, &quot;bt470m&quot;);
-			break;
-		case 5:
-			strcpy((char*)xmlBuffer, &quot;bt470bg&quot;);
-			break;
-		case 6:
-			strcpy((char*)xmlBuffer, &quot;smpte170m&quot;);
-			break;
-		case 7:
-			strcpy((char*)xmlBuffer, &quot;smpte240m&quot;);
-			break;
-		case 8:
-			strcpy((char*)xmlBuffer, &quot;film&quot;);
-			break;
-	}
-
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;colorPrimaries&quot;, xmlBuffer);
-
-	switch (getTransfer())
-	{
-		case 1:
-			strcpy((char*)xmlBuffer, &quot;bt709&quot;);
-			break;
-		case 2:
-			strcpy((char*)xmlBuffer, &quot;undefined&quot;);
-			break;
-		case 4:
-			strcpy((char*)xmlBuffer, &quot;bt470m&quot;);
-			break;
-		case 5:
-			strcpy((char*)xmlBuffer, &quot;bt470bg&quot;);
-			break;
-		case 6:
-			strcpy((char*)xmlBuffer, &quot;smpte170m&quot;);
-			break;
-		case 7:
-			strcpy((char*)xmlBuffer, &quot;smpte240m&quot;);
-			break;
-		case 8:
-			strcpy((char*)xmlBuffer, &quot;linear&quot;);
-			break;
-		case 9:
-			strcpy((char*)xmlBuffer, &quot;log100&quot;);
-			break;
-		case 10:
-			strcpy((char*)xmlBuffer, &quot;log316&quot;);
-			break;
-	}
-
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;transfer&quot;, xmlBuffer);
-
-	switch (getColorMatrix())
-	{
-		case 0:
-			strcpy((char*)xmlBuffer, &quot;gbr&quot;);
-			break;
-		case 1:
-			strcpy((char*)xmlBuffer, &quot;bt709&quot;);
-			break;
-		case 2:
-			strcpy((char*)xmlBuffer, &quot;undefined&quot;);
-			break;
-		case 4:
-			strcpy((char*)xmlBuffer, &quot;fcc&quot;);
-			break;
-		case 5:
-			strcpy((char*)xmlBuffer, &quot;bt470bg&quot;);
-			break;
-		case 6:
-			strcpy((char*)xmlBuffer, &quot;smpte170m&quot;);
-			break;
-		case 7:
-			strcpy((char*)xmlBuffer, &quot;smpte240m&quot;);
-			break;
-		case 8:
-			strcpy((char*)xmlBuffer, &quot;ycgco&quot;);
-			break;
-	}
-
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;colorMatrix&quot;, xmlBuffer);
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;chromaSampleLocation&quot;, number2String(xmlBuffer, bufferSize, getChromaSampleLocation()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;referenceFrames&quot;, number2String(xmlBuffer, bufferSize, getReferenceFrames()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;gopMaximumSize&quot;, number2String(xmlBuffer, bufferSize, getGopMaximumSize()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;gopMinimumSize&quot;, number2String(xmlBuffer, bufferSize, getGopMinimumSize()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;scenecutThreshold&quot;, number2String(xmlBuffer, bufferSize, getScenecutThreshold()));
-#if X264_BUILD &lt; 67
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;preScenecutDetection&quot;, boolean2String(xmlBuffer, bufferSize, getPreScenecutDetection()));
-#endif
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;bFrames&quot;, number2String(xmlBuffer, bufferSize, getBFrames()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;adaptiveBframeDecision&quot;, number2String(xmlBuffer, bufferSize, getAdaptiveBFrameDecision()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;bFrameBias&quot;, number2String(xmlBuffer, bufferSize, getBFrameBias()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;bFrameReferences&quot;, number2String(xmlBuffer, bufferSize, getBFrameReferences()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;loopFilter&quot;, boolean2String(xmlBuffer, bufferSize, getLoopFilter()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;loopFilterAlphaC0&quot;, number2String(xmlBuffer, bufferSize, getLoopFilterAlphaC0()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;loopFilterBeta&quot;, number2String(xmlBuffer, bufferSize, getLoopFilterBeta()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;cabac&quot;, boolean2String(xmlBuffer, bufferSize, getCabac()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;interlaced&quot;, boolean2String(xmlBuffer, bufferSize, getInterlaced()));
-
-	switch (getCqmPreset())
-	{
-		case X264_CQM_FLAT:
-			strcpy((char*)xmlBuffer, &quot;flat&quot;);
-			break;
-		case X264_CQM_JVT:
-			strcpy((char*)xmlBuffer, &quot;jvt&quot;);
-			break;
-		case X264_CQM_CUSTOM:
-			strcpy((char*)xmlBuffer, &quot;custom&quot;);
-			break;
-	}
-
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;cqmPreset&quot;, xmlBuffer);
-
-	uint8_t* intra4x4Luma = getIntra4x4Luma();
-	uint8_t* intraChroma = getIntraChroma();
-	uint8_t* inter4x4Luma = getInter4x4Luma();
-	uint8_t* interChroma = getInterChroma();
-	uint8_t* intra8x8Luma = getIntra8x8Luma();
-	uint8_t* inter8x8Luma = getInter8x8Luma();
-
-	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;intra4x4Luma&quot;, NULL);
-
-	for (int i = 0; i &lt; 16; i++)
-		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;value&quot;, number2String(xmlBuffer, bufferSize, intra4x4Luma[i]));
-
-	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;intraChroma&quot;, NULL);
-
-	for (int i = 0; i &lt; 16; i++)
-		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;value&quot;, number2String(xmlBuffer, bufferSize, intraChroma[i]));
-
-	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;inter4x4Luma&quot;, NULL);
-
-	for (int i = 0; i &lt; 16; i++)
-		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;value&quot;, number2String(xmlBuffer, bufferSize, inter4x4Luma[i]));
-
-	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;interChroma&quot;, NULL);
-
-	for (int i = 0; i &lt; 16; i++)
-		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;value&quot;, number2String(xmlBuffer, bufferSize, interChroma[i]));
-
-	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;intra8x8Luma&quot;, NULL);
-
-	for (int i = 0; i &lt; 64; i++)
-		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;value&quot;, number2String(xmlBuffer, bufferSize, intra8x8Luma[i]));
-
-	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;inter8x8Luma&quot;, NULL);
-
-	for (int i = 0; i &lt; 64; i++)
-		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;value&quot;, number2String(xmlBuffer, bufferSize, inter8x8Luma[i]));
-
-	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;analyse&quot;, NULL);
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;partitionI4x4&quot;, boolean2String(xmlBuffer, bufferSize, getPartitionI4x4()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;partitionI8x8&quot;, boolean2String(xmlBuffer, bufferSize, getPartitionI8x8()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;partitionP8x8&quot;, boolean2String(xmlBuffer, bufferSize, getPartitionP8x8()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;partitionP4x4&quot;, boolean2String(xmlBuffer, bufferSize, getPartitionP4x4()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;partitionB8x8&quot;, boolean2String(xmlBuffer, bufferSize, getPartitionB8x8()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;dct8x8&quot;, boolean2String(xmlBuffer, bufferSize, getDct8x8()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;weightedPrediction&quot;, boolean2String(xmlBuffer, bufferSize, getWeightedPrediction()));
-
-	switch (getDirectPredictionMode())
-	{
-		case X264_DIRECT_PRED_NONE:
-			strcpy((char*)xmlBuffer, &quot;none&quot;);
-			break;
-		case X264_DIRECT_PRED_SPATIAL:
-			strcpy((char*)xmlBuffer, &quot;spatial&quot;);
-			break;
-		case X264_DIRECT_PRED_TEMPORAL:
-			strcpy((char*)xmlBuffer, &quot;temporal&quot;);
-			break;
-		case X264_DIRECT_PRED_AUTO:
-			strcpy((char*)xmlBuffer, &quot;auto&quot;);
-			break;
-	}
-
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;directPredictionMode&quot;, xmlBuffer);
-
-#if X264_BUILD &lt; 66
-	switch (getDirectPredictionSize())
-	{
-		case 0:
-			strcpy((char*)xmlBuffer, &quot;4x4&quot;);
-			break;
-		case 1:
-			strcpy((char*)xmlBuffer, &quot;8x8&quot;);
-			break;
-		case -1:
-			strcpy((char*)xmlBuffer, &quot;smallest&quot;);
-			break;
-	}
-
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;directPredictionSize&quot;, xmlBuffer);
-#endif
-
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;chromaLumaQuantiserDifference&quot;, number2String(xmlBuffer, bufferSize, getChromaLumaQuantiserDifference()));
-
-	switch (getMotionEstimationMethod())
-	{
-		case X264_ME_DIA:
-			strcpy((char*)xmlBuffer, &quot;diamond&quot;);
-			break;
-		case X264_ME_UMH:
-			strcpy((char*)xmlBuffer, &quot;multi-hexagonal&quot;);
-			break;
-		case X264_ME_ESA:
-			strcpy((char*)xmlBuffer, &quot;exhaustive&quot;);
-			break;
-#if X264_BUILD &gt;= 57
-		case X264_ME_TESA:
-			strcpy((char*)xmlBuffer, &quot;hadamard&quot;);
-			break;
-#endif
-		case X264_ME_HEX:
-		default:
-			strcpy((char*)xmlBuffer, &quot;hexagonal&quot;);
-			break;
-	}
-
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;motionEstimationMethod&quot;, xmlBuffer);
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;motionVectorSearchRange&quot;, number2String(xmlBuffer, bufferSize, getMotionVectorSearchRange()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;motionVectorLength&quot;, number2String(xmlBuffer, bufferSize, getMotionVectorLength()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;motionVectorThreadBuffer&quot;, number2String(xmlBuffer, bufferSize, getMotionVectorThreadBuffer()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;subpixelRefinement&quot;, number2String(xmlBuffer, bufferSize, getSubpixelRefinement()));
-#if X264_BUILD &lt; 65
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;bidirectionalMotionEstimation&quot;, boolean2String(xmlBuffer, bufferSize, getBidirectionalMotionEstimation()));
-#endif
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;chromaMotionEstimation&quot;, boolean2String(xmlBuffer, bufferSize, getChromaMotionEstimation()));
-#if X264_BUILD &lt; 65
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;bFrameRdo&quot;, boolean2String(xmlBuffer, bufferSize, getBFrameRdo()));
-#endif
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;mixedReferences&quot;, boolean2String(xmlBuffer, bufferSize, getMixedReferences()));
-
-	switch (getTrellis())
-	{
-		case 0:
-			strcpy((char*)xmlBuffer, &quot;disabled&quot;);
-			break;
-		case 1:
-			strcpy((char*)xmlBuffer, &quot;finalMacroblock&quot;);
-			break;
-		case 2:
-			strcpy((char*)xmlBuffer, &quot;allModeDecisions&quot;);
-			break;
-	}
-
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;trellis&quot;, xmlBuffer);
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;fastPSkip&quot;, boolean2String(xmlBuffer, bufferSize, getFastPSkip()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;dctDecimate&quot;, boolean2String(xmlBuffer, bufferSize, getDctDecimate()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;noiseReduction&quot;, number2String(xmlBuffer, bufferSize, getNoiseReduction()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;interLumaDeadzone&quot;, number2String(xmlBuffer, bufferSize, getInterLumaDeadzone()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;intraLumaDeadzone&quot;, number2String(xmlBuffer, bufferSize, getIntraLumaDeadzone()));
-
-	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;rateControl&quot;, NULL);
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;quantiserMinimum&quot;, number2String(xmlBuffer, bufferSize, getQuantiserMinimum()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;quantiserMaximum&quot;, number2String(xmlBuffer, bufferSize, getQuantiserMaximum()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;quantiserStep&quot;, number2String(xmlBuffer, bufferSize, getQuantiserStep()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;averageBitrateTolerance&quot;, number2String(xmlBuffer, bufferSize, getAverageBitrateTolerance()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;vbvMaximumBitrate&quot;, number2String(xmlBuffer, bufferSize, getVbvMaximumBitrate()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;vbvBufferSize&quot;, number2String(xmlBuffer, bufferSize, getVbvBufferSize()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;vbvInitialOccupancy&quot;, number2String(xmlBuffer, bufferSize, getVbvInitialOccupancy()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;ipFrameQuantiser&quot;, number2String(xmlBuffer, bufferSize, getIpFrameQuantiser()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;pbFrameQuantiser&quot;, number2String(xmlBuffer, bufferSize, getPbFrameQuantiser()));
-
-#if X264_BUILD &gt;= 62
-	switch (getAdaptiveQuantiserMode())
-	{
-		case X264_AQ_NONE:
-			strcpy((char*)xmlBuffer, &quot;none&quot;);
-			break;
-		case X264_AQ_VARIANCE:
-			strcpy((char*)xmlBuffer, &quot;variance&quot;);
-			break;
-	}
-
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;adaptiveQuantiserMode&quot;, xmlBuffer);
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;adaptiveQuantiserStrength&quot;, number2String(xmlBuffer, bufferSize, getAdaptiveQuantiserStrength()));
-#endif
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;quantiserCurveCompression&quot;, number2String(xmlBuffer, bufferSize, getQuantiserCurveCompression()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;reduceFluxBeforeCurveCompression&quot;, number2String(xmlBuffer, bufferSize, getReduceFluxBeforeCurveCompression()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;reduceFluxAfterCurveCompression&quot;, number2String(xmlBuffer, bufferSize, getReduceFluxAfterCurveCompression()));
-
-	int zoneCount = getZoneCount();
-
-	if (zoneCount)
-	{
-		x264ZoneOptions** zoneOptions = getZones();
-
-		for (int zoneIndex = 0; zoneIndex &lt; zoneCount; zoneIndex++)
-		{
-			xmlNodeChild2 = xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;zone&quot;, NULL);
-			x264ZoneOptions* option = zoneOptions[zoneIndex];
-
-			xmlNewChild(xmlNodeChild2, NULL, (xmlChar*)&quot;frameStart&quot;, number2String(xmlBuffer, bufferSize, option-&gt;getFrameStart()));
-			xmlNewChild(xmlNodeChild2, NULL, (xmlChar*)&quot;frameEnd&quot;, number2String(xmlBuffer, bufferSize, option-&gt;getFrameEnd()));
-
-			if (zoneOptions[zoneIndex]-&gt;getZoneMode() == ZONE_MODE_QUANTISER)
-				xmlNewChild(xmlNodeChild2, NULL, (xmlChar*)&quot;quantiser&quot;, number2String(xmlBuffer, bufferSize, option-&gt;getZoneParameter()));
-			else
-				xmlNewChild(xmlNodeChild2, NULL, (xmlChar*)&quot;bitrateFactor&quot;, number2String(xmlBuffer, bufferSize, option-&gt;getZoneParameter() / 100.f));
-
-			delete option;
-		}
-
-		delete [] zoneOptions;
-	}
-
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;accessUnitDelimiters&quot;, boolean2String(xmlBuffer, bufferSize, getAccessUnitDelimiters()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;spsIdentifier&quot;, number2String(xmlBuffer, bufferSize, getSpsIdentifier()));
-}
-
-bool x264Options::validateXml(xmlDocPtr doc)
-{
-	const char *schemaFile = &quot;x264Param.xsd&quot;;
-	char *pluginDir = ADM_getPluginPath();
-	char schemaPath[strlen(pluginDir) + strlen(PLUGIN_SUBDIR) + 1 + strlen(schemaFile) + 1];
-	bool success = false;
-
-	strcpy(schemaPath, pluginDir);
-	strcat(schemaPath, PLUGIN_SUBDIR);
-	strcat(schemaPath, &quot;/&quot;);
-	strcat(schemaPath, schemaFile);
-	delete [] pluginDir;
-
-	xmlSchemaParserCtxtPtr xmlSchemaParserCtxt = xmlSchemaNewParserCtxt(schemaPath);
-	xmlSchemaPtr xmlSchema = xmlSchemaParse(xmlSchemaParserCtxt);
-
- 	xmlSchemaFreeParserCtxt(xmlSchemaParserCtxt);
-
- 	xmlSchemaValidCtxtPtr xmlSchemaValidCtxt = xmlSchemaNewValidCtxt(xmlSchema);
-
- 	if (xmlSchemaValidCtxt)
-	{
- 		success = !xmlSchemaValidateDoc(xmlSchemaValidCtxt, doc);
-	 	xmlSchemaFree(xmlSchema);
-		xmlSchemaFreeValidCtxt(xmlSchemaValidCtxt);
- 	}
-	else
- 		xmlSchemaFree(xmlSchema);
-
-	return success;
-}
-
-int x264Options::fromXml(const char *xml)
-{
-	bool success = false;
-
-	clearPresetConfiguration();
-	clearZones();
-
-	xmlDocPtr doc = xmlReadMemory(xml, strlen(xml), &quot;x264.xml&quot;, NULL, 0);
-
-	if (success = validateXml(doc))
-	{
-		xmlNode *xmlNodeRoot = xmlDocGetRootElement(doc);
-
-		for (xmlNode *xmlChild = xmlNodeRoot-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
-		{
-			if (xmlChild-&gt;type == XML_ELEMENT_NODE)
-			{
-				char *content = (char*)xmlNodeGetContent(xmlChild);
-
-				if (strcmp((char*)xmlChild-&gt;name, &quot;presetConfiguration&quot;) == 0)
-					parsePresetConfiguration(xmlChild);
-				else if (strcmp((char*)xmlChild-&gt;name, &quot;x264Options&quot;) == 0)
-					parseX264Options(xmlChild);
-
-				xmlFree(content);
-			}
-		}
-	}
-
-	xmlFreeDoc(doc);
-
-	return success;
-}
-
-void x264Options::parsePresetConfiguration(xmlNode *node)
-{
-	char* name = NULL;
-	configType type = CONFIG_CUSTOM;
-
-	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
-	{
-		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
-		{
-			char *content = (char*)xmlNodeGetContent(xmlChild);
-
-			if (strcmp((char*)xmlChild-&gt;name, &quot;name&quot;) == 0)
-				name = strdup((char*)content);
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;type&quot;) == 0)
-			{
-				if (strcmp(content, &quot;user&quot;) == 0)
-					type = CONFIG_USER;
-				else if (strcmp(content, &quot;system&quot;) == 0)
-					type = CONFIG_SYSTEM;
-				else
-					type = CONFIG_DEFAULT;
-			}
-
-			xmlFree(content);
-		}
-	}
-
-	setPresetConfiguration(name, type);
-	free(name);
-}
-
-void x264Options::parseX264Options(xmlNode *node)
-{
-	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
-	{
-		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
-		{
-			char *content = (char*)xmlNodeGetContent(xmlChild);
-
-			if (strcmp((char*)xmlChild-&gt;name, &quot;threads&quot;) == 0)
-				setThreads(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;deterministic&quot;) == 0)
-				setDeterministic(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;idcLevel&quot;) == 0)
-				setIdcLevel(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;vui&quot;) == 0)
-				parseVuiOptions(xmlChild);
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;referenceFrames&quot;) == 0)
-				setReferenceFrames(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;gopMaximumSize&quot;) == 0)
-				setGopMaximumSize(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;gopMinimumSize&quot;) == 0)
-				setGopMinimumSize(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;scenecutThreshold&quot;) == 0)
-				setScenecutThreshold(atoi(content));
-#if X264_BUILD &lt; 67
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;preScenecutDetection&quot;) == 0)
-				setPreScenecutDetection(string2Boolean(content));
-#endif
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;bFrames&quot;) == 0)
-				setBFrames(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;adaptiveBframeDecision&quot;) == 0)
-				setAdaptiveBFrameDecision(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;bFrameBias&quot;) == 0)
-				setBFrameBias(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;bFrameReferences&quot;) == 0)
-				setBFrameReferences(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;loopFilter&quot;) == 0)
-				setLoopFilter(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;loopFilterAlphaC0&quot;) == 0)
-				setLoopFilterAlphaC0(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;loopFilterBeta&quot;) == 0)
-				setLoopFilterBeta(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;cabac&quot;) == 0)
-				setCabac(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;interlaced&quot;) == 0)
-				setInterlaced(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;cqmPreset&quot;) == 0)
-			{
-				int cqmPreset = 0;
-
-				if (strcmp(content, &quot;flat&quot;) == 0)
-					cqmPreset = X264_CQM_FLAT;
-				else if (strcmp(content, &quot;jvt&quot;) == 0)
-					cqmPreset = X264_CQM_JVT;
-				else if (strcmp(content, &quot;custom&quot;) == 0)
-					cqmPreset = X264_CQM_CUSTOM;
-
-				setCqmPreset(cqmPreset);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;intra4x4Luma&quot;) == 0)
-			{
-				uint8_t intra4x4Luma[16];
-
-				parseCqmOption(xmlChild, intra4x4Luma);
-				setIntra4x4Luma(intra4x4Luma);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;intraChroma&quot;) == 0)
-			{
-				uint8_t intraChroma[16];
-
-				parseCqmOption(xmlChild, intraChroma);
-				setIntraChroma(intraChroma);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;inter4x4Luma&quot;) == 0)
-			{
-				uint8_t inter4x4Luma[16];
-
-				parseCqmOption(xmlChild, inter4x4Luma);
-				setInter4x4Luma(inter4x4Luma);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;interChroma&quot;) == 0)
-			{
-				uint8_t interChroma[16];
-
-				parseCqmOption(xmlChild, interChroma);
-				setInterChroma(interChroma);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;intra8x8Luma&quot;) == 0)
-			{
-				uint8_t intra8x8Luma[64];
-
-				parseCqmOption(xmlChild, intra8x8Luma);
-				setIntra8x8Luma(intra8x8Luma);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;inter8x8Luma&quot;) == 0)
-			{
-				uint8_t inter8x8Luma[64];
-
-				parseCqmOption(xmlChild, inter8x8Luma);
-				setInter8x8Luma(inter8x8Luma);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;analyse&quot;) == 0)
-				parseAnalyseOptions(xmlChild);
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;rateControl&quot;) == 0)
-				parseRateControlOptions(xmlChild);
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;accessUnitDelimiters&quot;) == 0)
-				setAccessUnitDelimiters(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;spsIdentifier&quot;) == 0)
-				setSpsIdentifier(atoi(content));
-
-			xmlFree(content);
-		}
-	}
-}
-
-void x264Options::parseVuiOptions(xmlNode *node)
-{
-	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
-	{
-		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
-		{
-			char *content = (char*)xmlNodeGetContent(xmlChild);
-
-			if (strcmp((char*)xmlChild-&gt;name, &quot;sarAsInput&quot;) == 0)
-				setSarAsInput(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;sarHeight&quot;) == 0)
-				setSarHeight(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;sarWidth&quot;) == 0)
-				setSarWidth(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;overscan&quot;) == 0)
-			{
-				int overscan = 0;
-
-				if (strcmp(content, &quot;undefined&quot;) == 0)
-					overscan = 0;
-				else if (strcmp(content, &quot;show&quot;) == 0)
-					overscan = 1;
-				else if (strcmp(content, &quot;crop&quot;) == 0)
-					overscan = 2;
-
-				setOverscan(overscan);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;videoFormat&quot;) == 0)
-			{
-				int videoFormat = 5;
-
-				if (strcmp(content, &quot;component&quot;) == 0)
-					videoFormat = 0;
-				else if (strcmp(content, &quot;pal&quot;) == 0)
-					videoFormat = 1;
-				else if (strcmp(content, &quot;ntsc&quot;) == 0)
-					videoFormat = 2;
-				else if (strcmp(content, &quot;secam&quot;) == 0)
-					videoFormat = 3;
-				else if (strcmp(content, &quot;mac&quot;) == 0)
-					videoFormat = 4;
-				else if (strcmp(content, &quot;undefined&quot;) == 0)
-					videoFormat = 5;
-
-				setVideoFormat(videoFormat);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;fullRangeSamples&quot;) == 0)
-				setFullRangeSamples(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;colorPrimaries&quot;) == 0)
-			{
-				int colorPrimaries = 2;
-
-				if (strcmp(content, &quot;bt709&quot;) == 0)
-					colorPrimaries = 1;
-				else if (strcmp(content, &quot;undefined&quot;) == 0)
-					colorPrimaries = 2;
-				else if (strcmp(content, &quot;bt470m&quot;) == 0)
-					colorPrimaries = 4;
-				else if (strcmp(content, &quot;bt470bg&quot;) == 0)
-					colorPrimaries = 5;
-				else if (strcmp(content, &quot;smpte170m&quot;) == 0)
-					colorPrimaries = 6;
-				else if (strcmp(content, &quot;smpte240m&quot;) == 0)
-					colorPrimaries = 7;
-				else if (strcmp(content, &quot;film&quot;) == 0)
-					colorPrimaries = 8;
-
-				setColorPrimaries(colorPrimaries);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;transfer&quot;) == 0)
-			{
-				int transfer = 2;
-
-				if (strcmp(content, &quot;bt709&quot;) == 0)
-					transfer = 1;
-				else if (strcmp(content, &quot;undefined&quot;) == 0)
-					transfer = 2;
-				else if (strcmp(content, &quot;bt470m&quot;) == 0)
-					transfer = 4;
-				else if (strcmp(content, &quot;bt470bg&quot;) == 0)
-					transfer = 5;
-				else if (strcmp(content, &quot;smpte170m&quot;) == 0)
-					transfer = 6;
-				else if (strcmp(content, &quot;smpte240m&quot;) == 0)
-					transfer = 7;
-				else if (strcmp(content, &quot;linear&quot;) == 0)
-					transfer = 8;
-				else if (strcmp(content, &quot;log100&quot;) == 0)
-					transfer = 9;
-				else if (strcmp(content, &quot;log316&quot;) == 0)
-					transfer = 8;
-
-				setTransfer(transfer);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;colorMatrix&quot;) == 0)
-			{
-				int colorMatrix = 2;
-
-				if (strcmp(content, &quot;gbr&quot;) == 0)
-					colorMatrix = 0;
-				else if (strcmp(content, &quot;bt709&quot;) == 0)
-					colorMatrix = 1;
-				else if (strcmp(content, &quot;undefined&quot;) == 0)
-					colorMatrix = 2;
-				else if (strcmp(content, &quot;fcc&quot;) == 0)
-					colorMatrix = 4;
-				else if (strcmp(content, &quot;bt470bg&quot;) == 0)
-					colorMatrix = 5;
-				else if (strcmp(content, &quot;smpte170m&quot;) == 0)
-					colorMatrix = 6;
-				else if (strcmp(content, &quot;smpte240m&quot;) == 0)
-					colorMatrix = 7;
-				else if (strcmp(content, &quot;ycgco&quot;) == 0)
-					colorMatrix = 8;
-
-				setColorMatrix(colorMatrix);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;chromaSampleLocation&quot;) == 0)
-				setChromaSampleLocation(atoi(content));
-
-			xmlFree(content);
-		}
-	}
-}
-
-void x264Options::parseCqmOption(xmlNode *node, uint8_t cqm[])
-{
-	int index = 0;
-
-	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
-	{
-		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
-		{
-			char *content = (char*)xmlNodeGetContent(xmlChild);
-
-			cqm[index] = atoi(content);
-			index++;
-
-			xmlFree(content);
-		}
-	}
-}
-
-void x264Options::parseAnalyseOptions(xmlNode *node)
-{
-	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
-	{
-		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
-		{
-			char *content = (char*)xmlNodeGetContent(xmlChild);
-
-			if (strcmp((char*)xmlChild-&gt;name, &quot;partitionI4x4&quot;) == 0)
-				setPartitionI4x4(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;partitionI8x8&quot;) == 0)
-				setPartitionI8x8(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;partitionP8x8&quot;) == 0)
-				setPartitionP8x8(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;partitionP4x4&quot;) == 0)
-				setPartitionP4x4(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;partitionB8x8&quot;) == 0)
-				setPartitionB8x8(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;dct8x8&quot;) == 0)
-				setDct8x8(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;weightedPrediction&quot;) == 0)
-				setWeightedPrediction(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;directPredictionMode&quot;) == 0)
-			{
-				int directPredictionMode = X264_DIRECT_PRED_SPATIAL;
-
-				if (strcmp(content, &quot;none&quot;) == 0)
-					directPredictionMode = X264_DIRECT_PRED_NONE;
-				else if (strcmp(content, &quot;spatial&quot;) == 0)
-					directPredictionMode = X264_DIRECT_PRED_SPATIAL;
-				else if (strcmp(content, &quot;temporal&quot;) == 0)
-					directPredictionMode = X264_DIRECT_PRED_TEMPORAL;
-				else if (strcmp(content, &quot;auto&quot;) == 0)
-					directPredictionMode = X264_DIRECT_PRED_AUTO;
-
-				setDirectPredictionMode(directPredictionMode);
-			}
-#if X264_BUILD &lt; 66
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;directPredictionSize&quot;) == 0)
-			{
-				int directPredictionSize = -1;
-
-				if (strcmp(content, &quot;4x4&quot;) == 0)
-					directPredictionSize = 0;
-				else if (strcmp(content, &quot;8x8&quot;) == 0)
-					directPredictionSize = 1;
-				else if (strcmp(content, &quot;smallest&quot;) == 0)
-					directPredictionSize = -1;
-
-				setDirectPredictionSize(directPredictionSize);
-			}
-#endif
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;chromaLumaQuantiserDifference&quot;) == 0)
-				setChromaLumaQuantiserDifference(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;motionEstimationMethod&quot;) == 0)
-			{
-				int motionEstimationMethod = X264_ME_HEX;
-
-				if (strcmp(content, &quot;diamond&quot;) == 0)
-					motionEstimationMethod = X264_ME_DIA;
-				else if (strcmp(content, &quot;hexagonal&quot;) == 0)
-					motionEstimationMethod = X264_ME_HEX;
-				else if (strcmp(content, &quot;multi-hexagonal&quot;) == 0)
-					motionEstimationMethod = X264_ME_UMH;
-				else if (strcmp(content, &quot;exhaustive&quot;) == 0)
-					motionEstimationMethod = X264_ME_ESA;
-#if X264_BUILD &gt;= 57
-				else if (strcmp(content, &quot;hadamard&quot;) == 0)
-					motionEstimationMethod = X264_ME_TESA;
-#endif
-
-				setMotionEstimationMethod(motionEstimationMethod);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;motionVectorSearchRange&quot;) == 0)
-				setMotionVectorSearchRange(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;motionVectorLength&quot;) == 0)
-				setMotionVectorLength(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;motionVectorThreadBuffer&quot;) == 0)
-				setMotionVectorThreadBuffer(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;subpixelRefinement&quot;) == 0)
-				setSubpixelRefinement(atoi(content));
-#if X264_BUILD &lt; 65
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;bidirectionalMotionEstimation&quot;) == 0)
-				setBidirectionalMotionEstimation(string2Boolean(content));
-#endif
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;chromaMotionEstimation&quot;) == 0)
-				setChromaMotionEstimation(string2Boolean(content));
-#if X264_BUILD &lt; 65
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;bFrameRdo&quot;) == 0)
-				setBFrameRdo(string2Boolean(content));
-#endif
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;mixedReferences&quot;) == 0)
-				setMixedReferences(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;trellis&quot;) == 0)
-			{
-				int trellis = 0;
-
-				if (strcmp(content, &quot;disabled&quot;) == 0)
-					trellis = 0;
-				else if (strcmp(content, &quot;finalMacroblock&quot;) == 0)
-					trellis = 1;
-				else if (strcmp(content, &quot;allModeDecisions&quot;) == 0)
-					trellis = 2;
-
-				setTrellis(trellis);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;fastPSkip&quot;) == 0)
-				setFastPSkip(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;dctDecimate&quot;) == 0)
-				setDctDecimate(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;noiseReduction&quot;) == 0)
-				setNoiseReduction(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;interLumaDeadzone&quot;) == 0)
-				setInterLumaDeadzone(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;intraLumaDeadzone&quot;) == 0)
-				setIntraLumaDeadzone(atoi(content));
-
-			xmlFree(content);
-		}
-	}
-}
-
-void x264Options::parseRateControlOptions(xmlNode *node)
-{
-	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
-	{
-		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
-		{
-			char *content = (char*)xmlNodeGetContent(xmlChild);
-
-			if (strcmp((char*)xmlChild-&gt;name, &quot;quantiserMinimum&quot;) == 0)
-				setQuantiserMinimum(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantiserMaximum&quot;) == 0)
-				setQuantiserMaximum(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantiserStep&quot;) == 0)
-				setQuantiserStep(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;averageBitrateTolerance&quot;) == 0)
-				setAverageBitrateTolerance(atof(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;vbvMaximumBitrate&quot;) == 0)
-				setVbvMaximumBitrate(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;vbvBufferSize&quot;) == 0)
-				setVbvBufferSize(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;vbvInitialOccupancy&quot;) == 0)
-				setVbvInitialOccupancy(atof(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;ipFrameQuantiser&quot;) == 0)
-				setIpFrameQuantiser(atof(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;pbFrameQuantiser&quot;) == 0)
-				setPbFrameQuantiser(atof(content));
-#if X264_BUILD &gt;= 62
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;adaptiveQuantiserMode&quot;) == 0)
-			{
-				int adaptiveQuantiserMode = X264_AQ_VARIANCE;
-
-				if (strcmp(content, &quot;none&quot;) == 0)
-					adaptiveQuantiserMode = X264_AQ_NONE;
-				else if (strcmp(content, &quot;variance&quot;) == 0)
-					adaptiveQuantiserMode = X264_AQ_VARIANCE;
-
-				setAdaptiveQuantiserMode(adaptiveQuantiserMode);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;adaptiveQuantiserStrength&quot;) == 0)
-				setAdaptiveQuantiserStrength(atof(content));
-#endif
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantiserCurveCompression&quot;) == 0)
-				setQuantiserCurveCompression(atof(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;reduceFluxBeforeCurveCompression&quot;) == 0)
-				setReduceFluxBeforeCurveCompression(atof(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;reduceFluxAfterCurveCompression&quot;) == 0)
-				setReduceFluxAfterCurveCompression(atof(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;zone&quot;) == 0)
-				parseZoneOptions(xmlChild);
-			else
-				printf(&quot;%s\n&quot;, xmlChild-&gt;name);
-
-			xmlFree(content);
-		}
-	}
-}
-
-void x264Options::parseZoneOptions(xmlNode *zoneNode)
-{
-	x264ZoneOptions option;
-
-	for (xmlNode *xmlChild = zoneNode-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
-	{
-		char *content = (char*)xmlNodeGetContent(xmlChild);
-
-		if (strcmp((char*)xmlChild-&gt;name, &quot;frameStart&quot;) == 0)
-			option.setFrameRange(atoi(content), option.getFrameEnd());
-		else if (strcmp((char*)xmlChild-&gt;name, &quot;frameEnd&quot;) == 0)
-			option.setFrameRange(option.getFrameStart(), atoi(content));
-		else if (strcmp((char*)xmlChild-&gt;name, &quot;quantiser&quot;) == 0)
-			option.setQuantiser(atoi(content));
-		else if (strcmp((char*)xmlChild-&gt;name, &quot;bitrateFactor&quot;) == 0)
-			option.setBitrateFactor((int)floor(atoi(content) * 100 + .5));
-
-		xmlFree(content);
-	}
-
-	addZone(&amp;option);
-}
-
-
-xmlChar* x264Options::number2String(xmlChar *buffer, size_t size, int number)
-{
-	std::ostringstream stream;
-
-	stream.imbue(std::locale::classic());
-	stream &lt;&lt; number;
-	std::string string = stream.str();
-
-	strncpy((char*)buffer, string.c_str(), size);
-
-	return buffer;
-}
-
-xmlChar* x264Options::number2String(xmlChar *buffer, size_t size, unsigned int number)
-{
-	std::ostringstream stream;
-
-	stream.imbue(std::locale::classic());
-	stream &lt;&lt; number;
-	std::string string = stream.str();
-
-	strncpy((char*)buffer, string.c_str(), size);
-
-	return buffer;
-}
-
-xmlChar* x264Options::number2String(xmlChar *buffer, size_t size, float number)
-{
-	std::ostringstream stream;
-
-	stream.imbue(std::locale::classic());
-	stream &lt;&lt; number;
-	std::string string = stream.str();
-
-	strncpy((char*)buffer, string.c_str(), size);
-
-	return buffer;
-}
-
-xmlChar* x264Options::boolean2String(xmlChar *buffer, size_t size, bool boolean)
-{
-	if (boolean)
-		strncpy((char*)buffer, &quot;true&quot;, size);
-	else
-		strncpy((char*)buffer, &quot;false&quot;, size);
-
-	return buffer;
-}
-
-bool x264Options::string2Boolean(char *buffer)
-{
-	return (strcmp(buffer, &quot;true&quot;) == 0);
-}

Deleted: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.h	2009-07-08 13:35:21 UTC (rev 5016)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.h	2009-07-08 13:35:56 UTC (rev 5017)
@@ -1,334 +0,0 @@
-/***************************************************************************
-                                x264Options.h
-
-    begin                : Mon Apr 21 2008
-    copyright            : (C) 2008 by gruntster
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifndef options_h
-#define options_h
-
-#include &lt;vector&gt;
-#include &lt;libxml/tree.h&gt;
-
-#include &quot;zoneOptions.h&quot;
-
-extern &quot;C&quot;
-{
-#include &quot;x264.h&quot;
-#include &quot;ADM_vidEnc_plugin.h&quot;
-}
-
-#define DEFAULT_ENCODE_MODE ADM_VIDENC_MODE_AQP
-#define DEFAULT_ENCODE_MODE_PARAMETER 26
-
-typedef enum
-{
-	CONFIG_CUSTOM,
-	CONFIG_DEFAULT,
-	CONFIG_USER,
-	CONFIG_SYSTEM
-} configType;
-
-class x264Options
-{
-protected:
-	x264_param_t _param;
-	std::vector&lt;x264ZoneOptions*&gt; _zoneOptions;
-
-	char* _configurationName;
-	configType _configurationType;
-
-	bool _sarAsInput;
-
-	void cleanUp(void);
-	xmlChar* number2String(xmlChar *buffer, size_t size, int number);
-	xmlChar* number2String(xmlChar *buffer, size_t size, unsigned int number);
-	xmlChar* number2String(xmlChar *buffer, size_t size, float number);
-	xmlChar* boolean2String(xmlChar *buffer, size_t size, bool boolean);
-	bool string2Boolean(char *buffer);
-
-	void addX264OptionsToXml(xmlNodePtr xmlNodeRoot);
-	char* dumpXmlDocToMemory(xmlDocPtr xmlDoc);
-	bool validateXml(xmlDocPtr doc);
-	void parsePresetConfiguration(xmlNode *node);
-	void parseX264Options(xmlNode *node);
-
-private:
-	void parseVuiOptions(xmlNode *node);
-	void parseCqmOption(xmlNode *node, uint8_t cqm[]);
-	void parseAnalyseOptions(xmlNode *node);
-	void parseRateControlOptions(xmlNode *node);
-	void parseZoneOptions(xmlNode *zoneNode);
-
-public:
-	x264Options(void);
-	~x264Options(void);
-
-	void reset(void);
-	x264_param_t* getParameters(void);
-
-	void getPresetConfiguration(char** configurationName, configType *configurationType);
-	void setPresetConfiguration(const char* configurationName, configType configurationType);
-	void clearPresetConfiguration(void);
-
-	int getThreads(void);
-	void setThreads(int threads);
-
-	bool getDeterministic(void);
-	void setDeterministic(bool deterministic);
-
-	int getIdcLevel(void);
-	void setIdcLevel(int idcLevel);
-
-	bool getSarAsInput(void);
-	void setSarAsInput(bool sarAsInput);
-
-	unsigned int getSarHeight(void);
-	void setSarHeight(unsigned int height);
-
-	unsigned int getSarWidth(void);
-	void setSarWidth(unsigned int width);
-
-	unsigned int getOverscan(void);
-	void setOverscan(unsigned int overscan);
-
-	unsigned int getVideoFormat(void);
-	void setVideoFormat(unsigned int videoFormat);
-
-	bool getFullRangeSamples(void);
-	void setFullRangeSamples(bool fullRangeSamples);
-
-	unsigned int getColorPrimaries(void);
-	void setColorPrimaries(unsigned int colorPrimaries);
-
-	unsigned int getTransfer(void);
-	void setTransfer(unsigned int transfer);
-
-	unsigned int getColorMatrix(void);
-	void setColorMatrix(unsigned int transfer);
-
-	unsigned int getChromaSampleLocation(void);
-	void setChromaSampleLocation(unsigned int chromaSampleLocation);
-
-	unsigned int getReferenceFrames(void);
-	void setReferenceFrames(unsigned int referenceFrames);
-
-	unsigned int getGopMinimumSize(void);
-	void setGopMinimumSize(unsigned int gopSize);
-
-	unsigned int getGopMaximumSize(void);
-	void setGopMaximumSize(unsigned int gopSize);
-
-	unsigned int getScenecutThreshold(void);
-	void setScenecutThreshold(unsigned int scenecutThreshold);
-
-#if X264_BUILD &lt; 67
-	bool getPreScenecutDetection(void);
-	void setPreScenecutDetection(bool preScenecutDetection);
-#endif
-
-	unsigned int getBFrames(void);
-	void setBFrames(unsigned int bFrames);
-
-	unsigned int getAdaptiveBFrameDecision(void);
-	void setAdaptiveBFrameDecision(unsigned int adaptiveBframeDecision);
-
-	int getBFrameBias(void);
-	void setBFrameBias(int bFrameBias);
-
-	bool getBFrameReferences(void);
-	void setBFrameReferences(bool bFrameReferences);
-
-	bool getLoopFilter(void);
-	void setLoopFilter(bool loopFilter);
-
-	int getLoopFilterAlphaC0(void);
-	void setLoopFilterAlphaC0(int loopFilterAlphaC0);
-
-	int getLoopFilterBeta(void);
-	void setLoopFilterBeta(int loopFilterBeta);
-
-	bool getCabac(void);
-	void setCabac(bool cabac);
-
-	bool getInterlaced(void);
-	void setInterlaced(bool interlaced);
-
-	unsigned int getCqmPreset(void);
-	void setCqmPreset(unsigned int cqmPreset);
-
-	uint8_t* getIntra4x4Luma(void);
-	void setIntra4x4Luma(uint8_t intra4x4Luma[]);
-
-	uint8_t* getIntraChroma(void);
-	void setIntraChroma(uint8_t intraChroma[]);
-
-	uint8_t* getInter4x4Luma(void);
-	void setInter4x4Luma(uint8_t inter4x4Luma[]);
-
-	uint8_t* getInterChroma(void);
-	void setInterChroma(uint8_t interChroma[]);
-
-	uint8_t* getIntra8x8Luma(void);
-	void setIntra8x8Luma(uint8_t intra8x8Luma[]);
-
-	uint8_t* getInter8x8Luma(void);
-	void setInter8x8Luma(uint8_t inter8x8Luma[]);
-
-	bool getPartitionI4x4(void);
-	void setPartitionI4x4(bool partitionI4x4);
-
-	bool getPartitionI8x8(void);
-	void setPartitionI8x8(bool partitionI8x8);
-
-	bool getPartitionP8x8(void);
-	void setPartitionP8x8(bool partitionP8x8);
-
-	bool getPartitionP4x4(void);
-	void setPartitionP4x4(bool partitionP4x4);
-
-	bool getPartitionB8x8(void);
-	void setPartitionB8x8(bool partitionB8x8);
-
-	bool getDct8x8(void);
-	void setDct8x8(bool dct8x8);
-
-	bool getWeightedPrediction(void);
-	void setWeightedPrediction(bool weightedPrediction);
-
-	unsigned int getDirectPredictionMode(void);
-	void setDirectPredictionMode(unsigned int directPredictionMode);
-
-#if X264_BUILD &lt; 66
-	int getDirectPredictionSize(void);
-	void setDirectPredictionSize(int directPredictionSize);
-#endif
-
-	int getChromaLumaQuantiserDifference(void);
-	void setChromaLumaQuantiserDifference(int chromaLumaQuantiserDifference);
-
-	unsigned int getMotionEstimationMethod(void);
-	void setMotionEstimationMethod(unsigned int motionEstimationMethod);
-
-	unsigned int getMotionVectorSearchRange(void);
-	void setMotionVectorSearchRange(unsigned int motionVectorSearchRange);
-
-	int getMotionVectorLength(void);
-	void setMotionVectorLength(int motionVectorLength);
-
-	int getMotionVectorThreadBuffer(void);
-	void setMotionVectorThreadBuffer(int motionVectorThreadBuffer);
-
-	unsigned int getSubpixelRefinement(void);
-	void setSubpixelRefinement(unsigned int subpixelRefinement);
-
-#if X264_BUILD &lt; 65
-	bool getBidirectionalMotionEstimation(void);
-	void setBidirectionalMotionEstimation(bool bidirectionalMotionEstimation);
-#endif
-
-	bool getChromaMotionEstimation(void);
-	void setChromaMotionEstimation(bool chromaMotionEstimation);
-
-#if X264_BUILD &lt; 65
-	bool getBFrameRdo(void);
-	void setBFrameRdo(bool bFrameRdo);
-#endif
-
-	bool getMixedReferences(void);
-	void setMixedReferences(bool mixedReferences);
-
-	unsigned int getTrellis(void);
-	void setTrellis(unsigned int trellis);
-
-	bool getFastPSkip(void);
-	void setFastPSkip(bool fastPSkip);
-
-	bool getDctDecimate(void);
-	void setDctDecimate(bool dctDecimate);
-
-	unsigned int getNoiseReduction(void);
-	void setNoiseReduction(unsigned int noiseReduction);
-
-	unsigned int getInterLumaDeadzone(void);
-	void setInterLumaDeadzone(unsigned int interLumaDeadzone);
-
-	unsigned int getIntraLumaDeadzone(void);
-	void setIntraLumaDeadzone(unsigned int intraLumaDeadzone);
-
-	bool getComputePsnr(void);
-	void setComputePsnr(bool computePsnr);
-
-	bool getComputeSsim(void);
-	void setComputeSsim(bool computeSsim);
-
-	unsigned int getQuantiserMinimum(void);
-	void setQuantiserMinimum(unsigned int quantiserMinimum);
-
-	unsigned int getQuantiserMaximum(void);
-	void setQuantiserMaximum(unsigned int quantiserMaximum);
-
-	unsigned int getQuantiserStep(void);
-	void setQuantiserStep(unsigned int quantiserStep);
-
-	float getAverageBitrateTolerance(void);
-	void setAverageBitrateTolerance(float averageBitrateTolerance);
-
-	unsigned int getVbvMaximumBitrate(void);
-	void setVbvMaximumBitrate(unsigned int vbvMaximumBitrate);
-
-	unsigned int getVbvBufferSize(void);
-	void setVbvBufferSize(unsigned int vbvBufferSize);
-
-	float getVbvInitialOccupancy(void);
-	void setVbvInitialOccupancy(float vbvInitialOccupancy);
-
-	float getIpFrameQuantiser(void);
-	void setIpFrameQuantiser(float ipFrameQuantiser);
-
-	float getPbFrameQuantiser(void);
-	void setPbFrameQuantiser(float pbFrameQuantiser);
-
-#if X264_BUILD &gt;= 62
-	unsigned int getAdaptiveQuantiserMode(void);
-	void setAdaptiveQuantiserMode(unsigned int adaptiveQuantiserMode);
-
-	float getAdaptiveQuantiserStrength(void);
-	void setAdaptiveQuantiserStrength(float adaptiveQuantiserStrength);
-#endif
-
-	float getQuantiserCurveCompression(void);
-	void setQuantiserCurveCompression(float quantiserCurveCompression);
-
-	float getReduceFluxBeforeCurveCompression(void);
-	void setReduceFluxBeforeCurveCompression(float reduceFluxBeforeCurveCompression);
-
-	float getReduceFluxAfterCurveCompression(void);
-	void setReduceFluxAfterCurveCompression(float reduceFluxAfterCurveCompression);
-
-	unsigned int getZoneCount(void);
-	x264ZoneOptions** getZones(void);
-	void clearZones(void);
-	void addZone(x264ZoneOptions *zoneOptions);
-
-	bool getAccessUnitDelimiters(void);
-	void setAccessUnitDelimiters(bool accessUnitDelimiters);
-
-	unsigned int getSpsIdentifier(void);
-	void setSpsIdentifier(unsigned int spsIdentifier);
-
-	virtual char* toXml(void);
-	virtual int fromXml(const char *xml);
-};
-
-#endif	// options_h

Deleted: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/presetOptions.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/presetOptions.cpp	2009-07-08 13:35:21 UTC (rev 5016)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/presetOptions.cpp	2009-07-08 13:35:56 UTC (rev 5017)
@@ -1,163 +0,0 @@
- /***************************************************************************
-                             presetOptions.cpp
-
-	These settings are intended for external configuration files and don't
-	contain a Preset Configuration block but may contain an Encode Options
-	block.
-
-    begin                : Fri May 23 2008
-    copyright            : (C) 2008 by gruntster
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &lt;libxml/parser.h&gt;
-#include &quot;ADM_default.h&quot;
-#include &quot;presetOptions.h&quot;
-
-x264PresetOptions::x264PresetOptions(void) : x264Options()
-{
-	setEncodeOptionsToDefaults();
-}
-
-vidEncOptions* x264PresetOptions::getEncodeOptions(void)
-{
-	vidEncOptions *encodeOptions = new vidEncOptions;
-
-	memcpy(encodeOptions, &amp;_encodeOptions, sizeof(vidEncOptions));
-
-	return encodeOptions;
-}
-
-void x264PresetOptions::setEncodeOptions(vidEncOptions* encodeOptions)
-{
-	memcpy(&amp;_encodeOptions, encodeOptions, sizeof(vidEncOptions));
-}
-
-char* x264PresetOptions::toXml(void)
-{
-	xmlDocPtr xmlDoc = xmlNewDoc((const xmlChar*)&quot;1.0&quot;);
-	xmlNodePtr xmlNodeRoot, xmlNodeChild;
-	const int bufferSize = 100;
-	xmlChar xmlBuffer[bufferSize + 1];
-	char *xml = NULL;
-
-	while (true)
-	{
-		if (!xmlDoc)
-			break;
-
-		if (!(xmlNodeRoot = xmlNewDocNode(xmlDoc, NULL, (xmlChar*)&quot;x264Config&quot;, NULL)))
-			break;
-
-		xmlDocSetRootElement(xmlDoc, xmlNodeRoot);
-
-		xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;encodeOptions&quot;, NULL);
-
-		switch (_encodeOptions.encodeMode)
-		{
-			case ADM_VIDENC_MODE_CBR:
-				strcpy((char*)xmlBuffer, &quot;CBR&quot;);
-				break;
-			case ADM_VIDENC_MODE_CQP:
-				strcpy((char*)xmlBuffer, &quot;CQP&quot;);
-				break;
-			case ADM_VIDENC_MODE_AQP:
-				strcpy((char*)xmlBuffer, &quot;AQP&quot;);
-				break;
-			case ADM_VIDENC_MODE_2PASS_SIZE:
-				strcpy((char*)xmlBuffer, &quot;2PASS SIZE&quot;);
-				break;
-			case ADM_VIDENC_MODE_2PASS_ABR:
-				strcpy((char*)xmlBuffer, &quot;2PASS ABR&quot;);
-				break;
-		}
-
-		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;mode&quot;, xmlBuffer);
-		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;parameter&quot;, number2String(xmlBuffer, bufferSize, _encodeOptions.encodeModeParameter));
-
-		addX264OptionsToXml(xmlNodeRoot);
-		xml = dumpXmlDocToMemory(xmlDoc);
-		xmlFreeDoc(xmlDoc);
-
-		break;
-	}
-
-	return xml;
-}
-
-int x264PresetOptions::fromXml(const char *xml)
-{
-	bool success = false;
-
-	clearPresetConfiguration();
-	clearZones();
-	setEncodeOptionsToDefaults();
-
-	xmlDocPtr doc = xmlReadMemory(xml, strlen(xml), &quot;x264.xml&quot;, NULL, 0);
-
-	if (success = validateXml(doc))
-	{
-		xmlNode *xmlNodeRoot = xmlDocGetRootElement(doc);
-
-		for (xmlNode *xmlChild = xmlNodeRoot-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
-		{
-			if (xmlChild-&gt;type == XML_ELEMENT_NODE)
-			{
-				char *content = (char*)xmlNodeGetContent(xmlChild);
-
-				if (strcmp((char*)xmlChild-&gt;name, &quot;encodeOptions&quot;) == 0)
-					parseEncodeOptions(xmlChild, &amp;_encodeOptions);
-				else if (strcmp((char*)xmlChild-&gt;name, &quot;x264Options&quot;) == 0)
-					parseX264Options(xmlChild);
-
-				xmlFree(content);
-			}
-		}
-	}
-
-	xmlFreeDoc(doc);
-
-	return success;
-}
-
-void x264PresetOptions::parseEncodeOptions(xmlNode *node, vidEncOptions *encodeOptions)
-{
-	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
-	{
-		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
-		{
-			char *content = (char*)xmlNodeGetContent(xmlChild);
-
-			if (strcmp((char*)xmlChild-&gt;name, &quot;mode&quot;) == 0)
-			{
-				if (strcmp(content, &quot;CBR&quot;) == 0)
-					encodeOptions-&gt;encodeMode = ADM_VIDENC_MODE_CBR;
-				else if (strcmp(content, &quot;CQP&quot;) == 0)
-					encodeOptions-&gt;encodeMode = ADM_VIDENC_MODE_CQP;
-				else if (strcmp(content, &quot;AQP&quot;) == 0)
-					encodeOptions-&gt;encodeMode = ADM_VIDENC_MODE_AQP;
-				else if (strcmp(content, &quot;2PASS SIZE&quot;) == 0)
-					encodeOptions-&gt;encodeMode = ADM_VIDENC_MODE_2PASS_SIZE;
-				else if (strcmp(content, &quot;2PASS ABR&quot;) == 0)
-					encodeOptions-&gt;encodeMode = ADM_VIDENC_MODE_2PASS_ABR;
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;parameter&quot;) == 0)
-				encodeOptions-&gt;encodeModeParameter = atoi(content);
-
-			xmlFree(content);
-		}
-	}
-}
-
-void x264PresetOptions::setEncodeOptionsToDefaults(void)
-{
-	_encodeOptions.encodeMode = DEFAULT_ENCODE_MODE;
-	_encodeOptions.encodeModeParameter = DEFAULT_ENCODE_MODE_PARAMETER;
-}

Deleted: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/presetOptions.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/presetOptions.h	2009-07-08 13:35:21 UTC (rev 5016)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/presetOptions.h	2009-07-08 13:35:56 UTC (rev 5017)
@@ -1,39 +0,0 @@
-/***************************************************************************
-                              presetOptions.h
-
-    begin                : Fri May 23 2008
-    copyright            : (C) 2008 by gruntster
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifndef presetOptions_h
-#define presetOptions_h
-
-#include &quot;options.h&quot;
-
-class x264PresetOptions : public x264Options
-{
-private:
-	vidEncOptions _encodeOptions;
-
-	void parseEncodeOptions(xmlNode *node, vidEncOptions *encodeOptions);
-	void setEncodeOptionsToDefaults(void);
-
-public:
-	x264PresetOptions(void);
-
-	vidEncOptions* getEncodeOptions(void);
-	void setEncodeOptions(vidEncOptions* encodeOptions);
-	char* toXml(void);
-	int fromXml(const char *xml);
-};
-
-#endif	// presetOptions_h

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp	2009-07-08 13:35:21 UTC (rev 5016)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp	2009-07-08 13:35:56 UTC (rev 5017)
@@ -21,7 +21,6 @@
 #include &lt;QtGui/QFileDialog&gt;
 
 #include &quot;../config.h&quot;
-#include &quot;../presetOptions.h&quot;
 #include &quot;x264ConfigDialog.h&quot;
 #include &quot;x264CustomMatrixDialog.h&quot;
 
@@ -177,16 +176,16 @@
 	disableGenericSlots = true;
 
 	for (int item = 0; item &lt; list.size(); item++)
-		configs.insert(QFileInfo(list[item]).completeBaseName(), CONFIG_USER);
+		configs.insert(QFileInfo(list[item]).completeBaseName(), PLUGIN_CONFIG_USER);
 
 	list = QDir(getSystemConfigDirectory()).entryList(filter, QDir::Files | QDir::Readable);
 
 	for (int item = 0; item &lt; list.size(); item++)
-		configs.insert(QFileInfo(list[item]).completeBaseName(), CONFIG_SYSTEM);
+		configs.insert(QFileInfo(list[item]).completeBaseName(), PLUGIN_CONFIG_SYSTEM);
 
 	ui.configurationComboBox-&gt;clear();
-	ui.configurationComboBox-&gt;addItem(QT_TR_NOOP(&quot;&lt;default&gt;&quot;), CONFIG_DEFAULT);
-	ui.configurationComboBox-&gt;addItem(QT_TR_NOOP(&quot;&lt;custom&gt;&quot;), CONFIG_CUSTOM);
+	ui.configurationComboBox-&gt;addItem(QT_TR_NOOP(&quot;&lt;default&gt;&quot;), PLUGIN_CONFIG_DEFAULT);
+	ui.configurationComboBox-&gt;addItem(QT_TR_NOOP(&quot;&lt;custom&gt;&quot;), PLUGIN_CONFIG_CUSTOM);
 
 	QMap&lt;QString, int&gt;::const_iterator mapIterator = configs.constBegin();
 
@@ -199,14 +198,14 @@
 	disableGenericSlots = origDisableGenericSlots;
 }
 
-bool x264ConfigDialog::selectConfiguration(QString *selectFile, configType configurationType)
+bool x264ConfigDialog::selectConfiguration(QString *selectFile, PluginConfigType configurationType)
 {
 	bool success = false;
 	bool origDisableGenericSlots = disableGenericSlots;
 
 	disableGenericSlots = true;
 
-	if (configurationType == CONFIG_DEFAULT)
+	if (configurationType == PLUGIN_CONFIG_DEFAULT)
 	{
 		ui.configurationComboBox-&gt;setCurrentIndex(0);
 		success = true;
@@ -272,7 +271,7 @@
 	{
 		ui.deleteButton-&gt;setEnabled(false);
 
-		x264PresetOptions defaultOptions;
+		x264Options defaultOptions;
 		vidEncOptions *defaultEncodeOptions = defaultOptions.getEncodeOptions();
 
 		loadSettings(defaultEncodeOptions, &amp;defaultOptions);
@@ -286,11 +285,11 @@
 		int configType = ui.configurationComboBox-&gt;itemData(index).toInt();
 		QString configFileName;
 
-		ui.deleteButton-&gt;setEnabled(configType == CONFIG_USER);
+		ui.deleteButton-&gt;setEnabled(configType == PLUGIN_CONFIG_USER);
 
-		if (configType == CONFIG_SYSTEM)
+		if (configType == PLUGIN_CONFIG_SYSTEM)
 			configFileName = QFileInfo(getSystemConfigDirectory(), ui.configurationComboBox-&gt;itemText(index) + &quot;.xml&quot;).filePath();
-		else	// CONFIG_USER
+		else	// PLUGIN_CONFIG_USER
 			configFileName = QFileInfo(getUserConfigDirectory(), ui.configurationComboBox-&gt;itemText(index) + &quot;.xml&quot;).filePath();
 
 		QFile configFile(configFileName);
@@ -300,11 +299,11 @@
 			configFile.open(QIODevice::ReadOnly | QIODevice::Text);
 
 			QByteArray fileContents = configFile.readAll();
-			x264PresetOptions options;
+			x264Options options;
 			vidEncOptions *encodeOptions;
 
 			configFile.close();
-			options.fromXml(fileContents.constData());
+			options.fromXml(fileContents.constData(), PLUGIN_XML_EXTERNAL);
 			encodeOptions = options.getEncodeOptions();
 
 			loadSettings(encodeOptions, &amp;options);
@@ -330,13 +329,13 @@
 	{
 		QFile configFile(configFileName);
 		vidEncOptions encodeOptions;
-		x264PresetOptions presetOptions;
+		x264Options options;
 
 		configFile.open(QIODevice::WriteOnly | QIODevice::Truncate | QIODevice::Text);
-		saveSettings(&amp;encodeOptions, &amp;presetOptions);
-		presetOptions.setEncodeOptions(&amp;encodeOptions);
+		saveSettings(&amp;encodeOptions, &amp;options);
+		options.setEncodeOptions(&amp;encodeOptions);
 
-		char* xml = presetOptions.toXml();
+		char* xml = options.toXml(PLUGIN_XML_EXTERNAL);
 
 		configFile.write(xml, strlen(xml));
 		configFile.close();
@@ -344,7 +343,7 @@
 		delete [] xml;
 
 		fillConfigurationComboBox();
-		selectConfiguration(&amp;QFileInfo(configFileName).completeBaseName(), CONFIG_USER);
+		selectConfiguration(&amp;QFileInfo(configFileName).completeBaseName(), PLUGIN_CONFIG_USER);
 	}
 
 	delete [] configDirectory;
@@ -553,7 +552,7 @@
 {
 	bool origDisableGenericSlots = disableGenericSlots;
 	char *configurationName;
-	configType configurationType;
+	PluginConfigType configurationType;
 
 	disableGenericSlots = true;
 	options-&gt;getPresetConfiguration(&amp;configurationName, &amp;configurationType);		
@@ -568,7 +567,7 @@
 
 	disableGenericSlots = origDisableGenericSlots;
 
-	return (foundConfig &amp;&amp; configurationType != CONFIG_CUSTOM);
+	return (foundConfig &amp;&amp; configurationType != PLUGIN_CONFIG_CUSTOM);
 }
 
 void x264ConfigDialog::loadSettings(vidEncOptions *encodeOptions, x264Options *options)
@@ -829,7 +828,7 @@
 			break;
 	}
 
-	configType configurationType = (configType)ui.configurationComboBox-&gt;itemData(ui.configurationComboBox-&gt;currentIndex()).toInt();
+	PluginConfigType configurationType = (PluginConfigType)ui.configurationComboBox-&gt;itemData(ui.configurationComboBox-&gt;currentIndex()).toInt();
 
 	options-&gt;setPresetConfiguration(ui.configurationComboBox-&gt;currentText().toUtf8().constData(), configurationType);
 	options-&gt;setSarAsInput(ui.sarAsInputRadioButton-&gt;isChecked());
@@ -1024,4 +1023,4 @@
 	}
 
 	return 0;
-}
\ No newline at end of file
+}

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.h	2009-07-08 13:35:21 UTC (rev 5016)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.h	2009-07-08 13:35:56 UTC (rev 5017)
@@ -2,7 +2,7 @@
 #define x264ConfigDialog_h
 
 #include &quot;ui_x264ConfigDialog.h&quot;
-#include &quot;../options.h&quot;
+#include &quot;../x264Options.h&quot;
 #include &quot;x264ZoneTableModel.h&quot;
 #include &quot;x264ZoneTableDelegate.h&quot;
 
@@ -45,7 +45,7 @@
 	uint8_t intra8x8Luma[64], inter8x8Luma[64];
 
 	void fillConfigurationComboBox(void);
-	bool selectConfiguration(QString *selectFile, configType configurationType);
+	bool selectConfiguration(QString *selectFile, PluginConfigType configurationType);
 	bool loadPresetSettings(vidEncOptions *encodeOptions, x264Options *options);
 	void loadSettings(vidEncOptions *encodeOptions, x264Options *options);
 	int getValueIndexInArray(uint8_t value, const uint8_t valueArray[], int elementCount);

Copied: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Options.cpp (from rev 5002, branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.cpp	2009-07-06 05:48:05 UTC (rev 5002)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Options.cpp	2009-07-08 13:35:56 UTC (rev 5017)
@@ -0,0 +1,1807 @@
+ /***************************************************************************
+                               x264Options.cpp
+
+	These settings are intended for scripting and can contain a Preset 
+	Configuration block.  If this block exists then &quot;internal&quot; settings are
+	ignored and an external configuration file should be read instead, 
+	e.g. PlayStation Portable profile.  However, if the external file is 
+	missing, internal settings have to be used and will reflect a snapshot
+	of the external configuration file at the time the script was generated.
+
+    begin                : Mon Apr 21 2008
+    copyright            : (C) 2008 by gruntster
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &lt;math.h&gt;
+#include &lt;libxml/parser.h&gt;
+#include &lt;libxml/xmlschemas.h&gt;
+#include &lt;sstream&gt;
+#include &lt;string&gt;
+
+#include &quot;config.h&quot;
+#include &quot;ADM_inttype.h&quot;
+#include &quot;ADM_files.h&quot;
+#include &quot;x264Options.h&quot;
+
+x264Options::x264Options(void) : PluginOptions(&quot;x264&quot;, &quot;x264Param.xsd&quot;, DEFAULT_ENCODE_MODE, DEFAULT_ENCODE_MODE_PARAMETER)
+{
+	_configurationName = NULL;
+	memset(&amp;_param, 0, sizeof(x264_param_t));
+
+	reset();
+}
+
+x264Options::~x264Options(void)
+{
+	cleanUp();
+}
+
+void x264Options::cleanUp(void)
+{
+	PluginOptions::cleanUp();
+	clearZones();
+}
+
+void x264Options::reset(void)
+{
+	PluginOptions::reset();
+
+	x264_param_default(&amp;_param);
+	_param.vui.i_sar_height = 1;
+	_param.vui.i_sar_width = 1;
+	_param.i_threads = 0;	// set to auto-detect; default is disabled
+
+	_sarAsInput = false;
+}
+
+x264_param_t* x264Options::getParameters(void)
+{
+	x264_param_t *param = new x264_param_t;
+
+	memcpy(param, &amp;_param, sizeof(x264_param_t));
+	param-&gt;rc.i_zones = getZoneCount();
+
+	if (param-&gt;rc.i_zones)
+	{
+		param-&gt;rc.zones = new x264_zone_t[param-&gt;rc.i_zones];
+
+		for (int zone = 0; zone &lt; param-&gt;rc.i_zones; zone++)
+			_zoneOptions[zone]-&gt;setX264Zone(&amp;param-&gt;rc.zones[zone]);
+	}
+
+	return param;
+}
+
+int x264Options::getThreads(void)
+{
+	return _param.i_threads;
+}
+
+void x264Options::setThreads(int threads)
+{
+	if (threads &gt;= 0)
+		_param.i_threads = threads;
+}
+
+bool x264Options::getDeterministic(void)
+{
+	return _param.b_deterministic;
+}
+
+void x264Options::setDeterministic(bool deterministic)
+{
+	_param.b_deterministic = deterministic;
+}
+
+int x264Options::getIdcLevel(void)
+{
+	return _param.i_level_idc;
+}
+
+void x264Options::setIdcLevel(int idcLevel)
+{
+	switch (idcLevel)
+	{
+		case -1:
+		case 1:
+		case 11:
+		case 12:
+		case 13:
+		case 2:
+		case 21:
+		case 22:
+		case 3:
+		case 31:
+		case 32:
+		case 4:
+		case 41:
+		case 42:
+		case 5:
+		case 51:
+			_param.i_level_idc = idcLevel;
+	}
+}
+
+bool x264Options::getSarAsInput(void)
+{
+	return _sarAsInput;
+}
+
+void x264Options::setSarAsInput(bool sarAsInput)
+{
+	_sarAsInput = sarAsInput;
+}
+
+unsigned int x264Options::getSarHeight(void)
+{
+	return _param.vui.i_sar_height;
+}
+
+void x264Options::setSarHeight(unsigned int height)
+{
+	_param.vui.i_sar_height = height;
+}
+
+unsigned int x264Options::getSarWidth(void)
+{
+	return _param.vui.i_sar_width;
+}
+
+void x264Options::setSarWidth(unsigned int width)
+{
+	_param.vui.i_sar_width = width;
+}
+
+unsigned int x264Options::getOverscan(void)
+{
+	return _param.vui.i_overscan;
+}
+
+void x264Options::setOverscan(unsigned int overscan)
+{
+	if (overscan &lt;= 2)
+		_param.vui.i_overscan = overscan;
+}
+
+unsigned int x264Options::getVideoFormat(void)
+{
+	return _param.vui.i_vidformat;
+}
+
+void x264Options::setVideoFormat(unsigned int videoFormat)
+{
+	if (videoFormat &lt;= 5)
+		_param.vui.i_vidformat = videoFormat;
+}
+
+bool x264Options::getFullRangeSamples(void)
+{
+	return _param.vui.b_fullrange;
+}
+
+void x264Options::setFullRangeSamples(bool fullRangeSamples)
+{
+	_param.vui.b_fullrange = fullRangeSamples;
+}
+
+unsigned int x264Options::getColorPrimaries(void)
+{
+	return _param.vui.i_colorprim;
+}
+
+void x264Options::setColorPrimaries(unsigned int colorPrimaries)
+{
+	if (colorPrimaries &lt;= 8 &amp;&amp; colorPrimaries != 0 &amp;&amp; colorPrimaries != 3)
+		_param.vui.i_colorprim = colorPrimaries;
+}
+
+unsigned int x264Options::getTransfer(void)
+{
+	return _param.vui.i_transfer;
+}
+
+void x264Options::setTransfer(unsigned int transfer)
+{
+	if (transfer &lt;= 10 &amp;&amp; transfer != 0 &amp;&amp; transfer != 3)
+		_param.vui.i_transfer = transfer;
+}
+
+unsigned int x264Options::getColorMatrix(void)
+{
+	return _param.vui.i_colmatrix;
+}
+
+void x264Options::setColorMatrix(unsigned int colorMatrix)
+{
+	if (colorMatrix &lt;= 8 &amp;&amp; colorMatrix != 3)
+		_param.vui.i_colmatrix = colorMatrix;
+}
+
+unsigned int x264Options::getChromaSampleLocation(void)
+{
+	return _param.vui.i_chroma_loc;
+}
+
+void x264Options::setChromaSampleLocation(unsigned int chromaSampleLocation)
+{
+	if (chromaSampleLocation &lt;= 5)
+		_param.vui.i_chroma_loc = chromaSampleLocation;
+}
+
+unsigned int x264Options::getReferenceFrames(void)
+{
+	return _param.i_frame_reference;
+}
+
+void x264Options::setReferenceFrames(unsigned int referenceFrames)
+{
+	if (referenceFrames &lt;= 16)
+		_param.i_frame_reference = referenceFrames;
+}
+
+unsigned int x264Options::getGopMinimumSize(void)
+{
+	return _param.i_keyint_min;
+}
+
+void x264Options::setGopMinimumSize(unsigned int gopSize)
+{
+	if (gopSize &lt;= 100)
+		_param.i_keyint_min = gopSize;
+}
+
+unsigned int x264Options::getGopMaximumSize(void)
+{
+	return _param.i_keyint_max;
+}
+
+void x264Options::setGopMaximumSize(unsigned int gopSize)
+{
+	if (gopSize &lt;= 1000)
+		_param.i_keyint_max = gopSize;
+}
+
+unsigned int x264Options::getScenecutThreshold(void)
+{
+	return _param.i_scenecut_threshold;
+}
+
+void x264Options::setScenecutThreshold(unsigned int scenecutThreshold)
+{
+	if (scenecutThreshold &lt;= 100)
+		_param.i_scenecut_threshold = scenecutThreshold;
+}
+
+#if X264_BUILD &lt; 67
+bool x264Options::getPreScenecutDetection(void)
+{
+	return _param.b_pre_scenecut;
+}
+
+void x264Options::setPreScenecutDetection(bool preScenecutDetection)
+{
+	_param.b_pre_scenecut = preScenecutDetection;
+}
+#endif
+
+unsigned int x264Options::getBFrames(void)
+{
+	return _param.i_bframe;
+}
+
+void x264Options::setBFrames(unsigned int bFrames)
+{
+	if (bFrames &lt;= 100)
+		_param.i_bframe = bFrames;
+}
+
+unsigned int x264Options::getAdaptiveBFrameDecision(void)
+{
+#if X264_BUILD &gt;= 63
+	return _param.i_bframe_adaptive;
+#else
+	return _param.b_bframe_adaptive;
+#endif
+}
+
+void x264Options::setAdaptiveBFrameDecision(unsigned int adaptiveBframeDecision)
+{
+	if (adaptiveBframeDecision &lt;= 2)
+#if X264_BUILD &gt;= 63
+		_param.i_bframe_adaptive = adaptiveBframeDecision;
+#else
+		_param.b_bframe_adaptive = adaptiveBframeDecision;
+#endif
+}
+
+int x264Options::getBFrameBias(void)
+{
+	return _param.i_bframe_bias;
+}
+
+void x264Options::setBFrameBias(int bFrameBias)
+{
+	if (bFrameBias &gt;= -100 &amp;&amp; bFrameBias &lt;= 100)
+		_param.i_bframe_bias = bFrameBias;
+}
+
+bool x264Options::getBFrameReferences(void)
+{
+	return _param.b_bframe_pyramid;
+}
+
+void x264Options::setBFrameReferences(bool bFrameReferences)
+{
+	_param.b_bframe_pyramid = bFrameReferences;
+}
+
+bool x264Options::getLoopFilter(void)
+{
+	return _param.b_deblocking_filter;
+}
+
+void x264Options::setLoopFilter(bool loopFilter)
+{
+	_param.b_deblocking_filter = loopFilter;
+}
+
+int x264Options::getLoopFilterAlphaC0(void)
+{
+	return _param.i_deblocking_filter_alphac0;
+}
+
+void x264Options::setLoopFilterAlphaC0(int loopFilterAlphaC0)
+{
+	if (loopFilterAlphaC0 &gt;= -6 &amp;&amp; loopFilterAlphaC0 &lt;= 6)
+		_param.i_deblocking_filter_alphac0 = loopFilterAlphaC0;
+}
+
+int x264Options::getLoopFilterBeta(void)
+{
+	return _param.i_deblocking_filter_beta;
+}
+
+void x264Options::setLoopFilterBeta(int loopFilterBeta)
+{
+	if (loopFilterBeta &gt;= -6 &amp;&amp; loopFilterBeta &lt;= 6)
+		_param.i_deblocking_filter_beta = loopFilterBeta;
+}
+
+bool x264Options::getCabac(void)
+{
+	return _param.b_cabac;
+}
+
+void x264Options::setCabac(bool cabac)
+{
+	_param.b_cabac = cabac;
+}
+
+bool x264Options::getInterlaced(void)
+{
+	return _param.b_interlaced;
+}
+
+void x264Options::setInterlaced(bool interlaced)
+{
+	_param.b_interlaced = interlaced;
+}
+
+unsigned int x264Options::getCqmPreset(void)
+{
+	return _param.i_cqm_preset;
+}
+
+void x264Options::setCqmPreset(unsigned int cqmPreset)
+{
+	if (cqmPreset &lt;= 2)
+		_param.i_cqm_preset = cqmPreset;
+}
+
+uint8_t* x264Options::getIntra4x4Luma(void)
+{
+	return _param.cqm_4iy;
+}
+
+void x264Options::setIntra4x4Luma(uint8_t intra4x4Luma[])
+{
+	memcpy(_param.cqm_4iy, intra4x4Luma, 16 * sizeof(uint8_t));
+}
+
+uint8_t* x264Options::getIntraChroma(void)
+{
+	return _param.cqm_4ic;
+}
+
+void x264Options::setIntraChroma(uint8_t intraChroma[])
+{
+	memcpy(_param.cqm_4ic, intraChroma, 16 * sizeof(uint8_t));
+}
+
+uint8_t* x264Options::getInter4x4Luma(void)
+{
+	return _param.cqm_4py;
+}
+
+void x264Options::setInter4x4Luma(uint8_t inter4x4Luma[])
+{
+	memcpy(_param.cqm_4py, inter4x4Luma, 16 * sizeof(uint8_t));
+}
+
+uint8_t* x264Options::getInterChroma(void)
+{
+	return _param.cqm_4pc;
+}
+
+void x264Options::setInterChroma(uint8_t interChroma[])
+{
+	memcpy(_param.cqm_4pc, interChroma, 16 * sizeof(uint8_t));
+}
+
+uint8_t* x264Options::getIntra8x8Luma(void)
+{
+	return _param.cqm_8iy;
+}
+
+void x264Options::setIntra8x8Luma(uint8_t intra8x8Luma[])
+{
+	memcpy(_param.cqm_8iy, intra8x8Luma, 64 * sizeof(uint8_t));
+}
+
+uint8_t* x264Options::getInter8x8Luma(void)
+{
+	return _param.cqm_8py;
+}
+
+void x264Options::setInter8x8Luma(uint8_t inter8x8Luma[])
+{
+	memcpy(_param.cqm_8py, inter8x8Luma, 64 * sizeof(uint8_t));
+}
+
+bool x264Options::getPartitionI4x4(void)
+{
+	return (_param.analyse.inter &amp; X264_ANALYSE_I4x4) == X264_ANALYSE_I4x4;
+}
+
+void x264Options::setPartitionI4x4(bool partitionI4x4)
+{
+	if (partitionI4x4)
+		_param.analyse.inter |= X264_ANALYSE_I4x4;
+	else
+		_param.analyse.inter &amp;= ~X264_ANALYSE_I4x4;
+}
+
+bool x264Options::getPartitionI8x8(void)
+{
+	return (_param.analyse.inter &amp; X264_ANALYSE_I8x8) == X264_ANALYSE_I8x8;
+}
+
+void x264Options::setPartitionI8x8(bool partitionI8x8)
+{
+	if (partitionI8x8)
+		_param.analyse.inter |= X264_ANALYSE_I8x8;
+	else
+		_param.analyse.inter &amp;= ~X264_ANALYSE_I8x8;
+}
+
+bool x264Options::getPartitionP8x8(void)
+{
+	return (_param.analyse.inter &amp; X264_ANALYSE_PSUB16x16) == X264_ANALYSE_PSUB16x16;
+}
+
+void x264Options::setPartitionP8x8(bool partitionP8x8)
+{
+	if (partitionP8x8)
+		_param.analyse.inter |= X264_ANALYSE_PSUB16x16;
+	else
+		_param.analyse.inter &amp;= ~X264_ANALYSE_PSUB16x16;
+}
+
+bool x264Options::getPartitionP4x4(void)
+{
+	return (_param.analyse.inter &amp; X264_ANALYSE_PSUB8x8) == X264_ANALYSE_PSUB8x8;
+}
+
+void x264Options::setPartitionP4x4(bool partitionP4x4)
+{
+	if (partitionP4x4)
+		_param.analyse.inter |= X264_ANALYSE_PSUB8x8;
+	else
+		_param.analyse.inter &amp;= ~X264_ANALYSE_PSUB8x8;
+}
+
+bool x264Options::getPartitionB8x8(void)
+{
+	return (_param.analyse.inter &amp; X264_ANALYSE_BSUB16x16) == X264_ANALYSE_BSUB16x16;
+}
+
+void x264Options::setPartitionB8x8(bool partitionB8x8)
+{
+	if (partitionB8x8)
+		_param.analyse.inter |= X264_ANALYSE_BSUB16x16;
+	else
+		_param.analyse.inter &amp;= ~X264_ANALYSE_BSUB16x16;
+}
+
+bool x264Options::getDct8x8(void)
+{
+	return _param.analyse.b_transform_8x8;
+}
+
+void x264Options::setDct8x8(bool dct8x8)
+{
+	_param.analyse.b_transform_8x8 = dct8x8;
+}
+
+bool x264Options::getWeightedPrediction(void)
+{
+	return _param.analyse.b_weighted_bipred;
+}
+
+void x264Options::setWeightedPrediction(bool weightedPrediction)
+{
+	_param.analyse.b_weighted_bipred = weightedPrediction;
+}
+
+unsigned int x264Options::getDirectPredictionMode(void)
+{
+	return _param.analyse.i_direct_mv_pred;
+}
+
+void x264Options::setDirectPredictionMode(unsigned int directPredictionMode)
+{
+	if (directPredictionMode &lt;= 3)
+		_param.analyse.i_direct_mv_pred = directPredictionMode;
+}
+
+#if X264_BUILD &lt; 66
+int x264Options::getDirectPredictionSize(void)
+{
+	return _param.analyse.i_direct_8x8_inference;
+}
+
+void x264Options::setDirectPredictionSize(int directPredictionSize)
+{
+	if (directPredictionSize &gt;= -1 &amp;&amp; directPredictionSize &lt;= 1)
+		_param.analyse.i_direct_8x8_inference = directPredictionSize;
+}
+#endif
+
+int x264Options::getChromaLumaQuantiserDifference(void)
+{
+	return _param.analyse.i_chroma_qp_offset;
+}
+
+void x264Options::setChromaLumaQuantiserDifference(int chromaLumaQuantiserDifference)
+{
+	if (chromaLumaQuantiserDifference &gt;= -12 &amp;&amp; chromaLumaQuantiserDifference &lt;= 12)
+		_param.analyse.i_chroma_qp_offset = chromaLumaQuantiserDifference;
+}
+
+unsigned int x264Options::getMotionEstimationMethod(void)
+{
+	return _param.analyse.i_me_method;
+}
+
+void x264Options::setMotionEstimationMethod(unsigned int motionEstimationMethod)
+{
+	if (motionEstimationMethod &lt;= 4)
+		_param.analyse.i_me_method = motionEstimationMethod;
+}
+
+unsigned int x264Options::getMotionVectorSearchRange(void)
+{
+	return _param.analyse.i_me_range;
+}
+
+void x264Options::setMotionVectorSearchRange(unsigned int motionVectorSearchRange)
+{
+	if (motionVectorSearchRange &lt;= 64)
+		_param.analyse.i_me_range = motionVectorSearchRange;
+}
+
+int x264Options::getMotionVectorLength(void)
+{
+	return _param.analyse.i_mv_range;
+}
+
+void x264Options::setMotionVectorLength(int motionVectorLength)
+{
+	if (motionVectorLength == -1 || (motionVectorLength &gt;= 32 &amp;&amp; motionVectorLength &lt;= 512))
+		_param.analyse.i_mv_range = motionVectorLength;
+}
+
+int x264Options::getMotionVectorThreadBuffer(void)
+{
+	return _param.analyse.i_mv_range_thread;
+}
+
+void x264Options::setMotionVectorThreadBuffer(int motionVectorThreadBuffer)
+{
+	_param.analyse.i_mv_range_thread = motionVectorThreadBuffer;
+}
+
+unsigned int x264Options::getSubpixelRefinement(void)
+{
+	return _param.analyse.i_subpel_refine;
+}
+
+void x264Options::setSubpixelRefinement(unsigned int subpixelRefinement)
+{
+	if (subpixelRefinement &gt;= 1 &amp;&amp; subpixelRefinement &lt;= 9)
+		_param.analyse.i_subpel_refine = subpixelRefinement;
+}
+
+#if X264_BUILD &lt; 65
+bool x264Options::getBidirectionalMotionEstimation(void)
+{
+	return _param.analyse.b_bidir_me;
+}
+
+void x264Options::setBidirectionalMotionEstimation(bool bidirectionalMotionEstimation)
+{
+	_param.analyse.b_bidir_me = bidirectionalMotionEstimation;
+}
+#endif
+
+bool x264Options::getChromaMotionEstimation(void)
+{
+	return _param.analyse.b_chroma_me;
+}
+
+void x264Options::setChromaMotionEstimation(bool chromaMotionEstimation)
+{
+	_param.analyse.b_chroma_me = chromaMotionEstimation;
+}
+
+#if X264_BUILD &lt; 65
+bool x264Options::getBFrameRdo(void)
+{
+	return _param.analyse.b_bframe_rdo;
+}
+
+void x264Options::setBFrameRdo(bool bFrameRdo)
+{
+	_param.analyse.b_bframe_rdo = bFrameRdo;
+}
+#endif
+
+bool x264Options::getMixedReferences(void)
+{
+	return _param.analyse.b_mixed_references;
+}
+
+void x264Options::setMixedReferences(bool mixedReferences)
+{
+	_param.analyse.b_mixed_references = mixedReferences;
+}
+
+unsigned int x264Options::getTrellis(void)
+{
+	return _param.analyse.i_trellis;
+}
+
+void x264Options::setTrellis(unsigned int trellis)
+{
+	if (trellis &lt;= 2)
+		_param.analyse.i_trellis = trellis;
+}
+
+bool x264Options::getFastPSkip(void)
+{
+	return _param.analyse.b_fast_pskip;
+}
+
+void x264Options::setFastPSkip(bool fastPSkip)
+{
+	_param.analyse.b_fast_pskip = fastPSkip;
+}
+
+bool x264Options::getDctDecimate(void)
+{
+	return _param.analyse.b_dct_decimate;
+}
+
+void x264Options::setDctDecimate(bool dctDecimate)
+{
+	_param.analyse.b_dct_decimate = dctDecimate;
+}
+
+unsigned int x264Options::getNoiseReduction(void)
+{
+	return _param.analyse.i_noise_reduction;
+}
+
+void x264Options::setNoiseReduction(unsigned int noiseReduction)
+{
+	if (noiseReduction &lt;= 65536)
+		_param.analyse.i_noise_reduction = noiseReduction;
+}
+
+unsigned int x264Options::getInterLumaDeadzone(void)
+{
+	return _param.analyse.i_luma_deadzone[0];
+}
+
+void x264Options::setInterLumaDeadzone(unsigned int interLumaDeadzone)
+{
+	if (interLumaDeadzone &lt;= 32)
+		_param.analyse.i_luma_deadzone[0] = interLumaDeadzone;
+}
+
+unsigned int x264Options::getIntraLumaDeadzone(void)
+{
+	return _param.analyse.i_luma_deadzone[1];
+}
+
+void x264Options::setIntraLumaDeadzone(unsigned int intraLumaDeadzone)
+{
+	if (intraLumaDeadzone &lt;= 32)
+		_param.analyse.i_luma_deadzone[1] = intraLumaDeadzone;
+}
+
+unsigned int x264Options::getQuantiserMinimum(void)
+{
+	return _param.rc.i_qp_min;
+}
+
+void x264Options::setQuantiserMinimum(unsigned int quantiserMinimum)
+{
+	if (quantiserMinimum &gt;= 10 &amp;&amp; quantiserMinimum &lt;= 51)
+		_param.rc.i_qp_min = quantiserMinimum;
+}
+
+unsigned int x264Options::getQuantiserMaximum(void)
+{
+	return _param.rc.i_qp_max;
+}
+
+void x264Options::setQuantiserMaximum(unsigned int quantiserMaximum)
+{
+	if (quantiserMaximum &gt;= 10 &amp;&amp; quantiserMaximum &lt;= 51)
+		_param.rc.i_qp_max = quantiserMaximum;
+}
+
+unsigned int x264Options::getQuantiserStep(void)
+{
+	return _param.rc.i_qp_step;
+}
+
+void x264Options::setQuantiserStep(unsigned int quantiserStep)
+{
+	if (quantiserStep &lt;= 10)
+		_param.rc.i_qp_step = quantiserStep;
+}
+
+float x264Options::getAverageBitrateTolerance(void)
+{
+	return _param.rc.f_rate_tolerance;
+}
+
+void x264Options::setAverageBitrateTolerance(float averageBitrateTolerance)
+{
+	if (averageBitrateTolerance &gt;= 0 &amp;&amp; averageBitrateTolerance &lt;= 1)
+		_param.rc.f_rate_tolerance = averageBitrateTolerance;
+}
+
+unsigned int x264Options::getVbvMaximumBitrate(void)
+{
+	return _param.rc.i_vbv_max_bitrate;
+}
+
+void x264Options::setVbvMaximumBitrate(unsigned int vbvMaximumBitrate)
+{
+	if (vbvMaximumBitrate &lt;= 99999)
+		_param.rc.i_vbv_max_bitrate = vbvMaximumBitrate;
+}
+
+unsigned int x264Options::getVbvBufferSize(void)
+{
+	return _param.rc.i_vbv_buffer_size;
+}
+
+void x264Options::setVbvBufferSize(unsigned int vbvBufferSize)
+{
+	if (vbvBufferSize &lt;= 99999)
+		_param.rc.i_vbv_buffer_size = vbvBufferSize;
+}
+
+float x264Options::getVbvInitialOccupancy(void)
+{
+	return _param.rc.f_vbv_buffer_init;
+}
+
+void x264Options::setVbvInitialOccupancy(float vbvInitialOccupancy)
+{
+	if (vbvInitialOccupancy &gt;= 0 &amp;&amp; vbvInitialOccupancy &lt;= 1)
+		_param.rc.f_vbv_buffer_init = vbvInitialOccupancy;
+}
+
+float x264Options::getIpFrameQuantiser(void)
+{
+	return _param.rc.f_ip_factor;
+}
+
+void x264Options::setIpFrameQuantiser(float ipFrameQuantiser)
+{
+	if (ipFrameQuantiser &gt;= 1 &amp;&amp; ipFrameQuantiser &lt;= 10)
+		_param.rc.f_ip_factor = ipFrameQuantiser;
+}
+
+float x264Options::getPbFrameQuantiser(void)
+{
+	return _param.rc.f_pb_factor;
+}
+
+void x264Options::setPbFrameQuantiser(float pbFrameQuantiser)
+{
+	if (pbFrameQuantiser &gt;= 1 &amp;&amp; pbFrameQuantiser &lt;= 10)
+		_param.rc.f_pb_factor = pbFrameQuantiser;
+}
+
+#if X264_BUILD &gt;= 62
+unsigned int x264Options::getAdaptiveQuantiserMode(void)
+{
+	return _param.rc.i_aq_mode;
+}
+
+void x264Options::setAdaptiveQuantiserMode(unsigned int adaptiveQuantiserMode)
+{
+	if (adaptiveQuantiserMode &lt;= 1)
+		_param.rc.i_aq_mode = adaptiveQuantiserMode;
+}
+
+float x264Options::getAdaptiveQuantiserStrength(void)
+{
+	return _param.rc.f_aq_strength;
+}
+
+void x264Options::setAdaptiveQuantiserStrength(float adaptiveQuantiserStrength)
+{
+	_param.rc.f_aq_strength = adaptiveQuantiserStrength;
+}
+#endif
+
+float x264Options::getQuantiserCurveCompression(void)
+{
+	return _param.rc.f_qcompress;
+}
+
+void x264Options::setQuantiserCurveCompression(float quantiserCurveCompression)
+{
+	if (quantiserCurveCompression &gt;= 0 &amp;&amp; quantiserCurveCompression &lt;= 1)
+		_param.rc.f_qcompress = quantiserCurveCompression;
+}
+
+float x264Options::getReduceFluxBeforeCurveCompression(void)
+{
+	return _param.rc.f_complexity_blur;
+}
+
+void x264Options::setReduceFluxBeforeCurveCompression(float reduceFluxBeforeCurveCompression)
+{
+	if (reduceFluxBeforeCurveCompression &gt;= 0 &amp;&amp; reduceFluxBeforeCurveCompression &lt;= 999)
+		_param.rc.f_complexity_blur = reduceFluxBeforeCurveCompression;
+}
+
+float x264Options::getReduceFluxAfterCurveCompression(void)
+{
+	return _param.rc.f_qblur;
+}
+
+void x264Options::setReduceFluxAfterCurveCompression(float reduceFluxAfterCurveCompression)
+{
+	if (reduceFluxAfterCurveCompression &gt;= 0 &amp;&amp; reduceFluxAfterCurveCompression &lt;= 1)
+		_param.rc.f_qblur = reduceFluxAfterCurveCompression;
+}
+
+unsigned int x264Options::getZoneCount(void)
+{
+	return _zoneOptions.size();
+}
+
+x264ZoneOptions** x264Options::getZones(void)
+{
+	unsigned int zoneCount = getZoneCount();
+	x264ZoneOptions **zoneOptions = new x264ZoneOptions*[zoneCount];
+
+	for (int zone = 0; zone &lt; zoneCount; zone++)
+		zoneOptions[zone] = _zoneOptions[zone]-&gt;clone();
+
+	return zoneOptions;
+}
+
+void x264Options::clearZones(void)
+{
+	for (int zone = 0; zone &lt; getZoneCount(); zone++)
+		delete _zoneOptions[zone];
+
+	_zoneOptions.clear();
+}
+
+void x264Options::addZone(x264ZoneOptions *zoneOptions)
+{
+	x264ZoneOptions *clonedOptions = zoneOptions-&gt;clone();
+
+	_zoneOptions.push_back(clonedOptions);
+}
+
+bool x264Options::getAccessUnitDelimiters(void)
+{
+	return _param.b_aud;
+}
+
+void x264Options::setAccessUnitDelimiters(bool accessUnitDelimiters)
+{
+	_param.b_aud = accessUnitDelimiters;
+}
+
+unsigned int x264Options::getSpsIdentifier(void)
+{
+	return _param.i_sps_id;
+}
+
+void x264Options::setSpsIdentifier(unsigned int spsIdentifier)
+{
+	switch (spsIdentifier)
+	{
+		case 0:
+		case 1:
+		case 3:
+		case 7:
+		case 15:
+		case 31:
+			_param.i_sps_id = spsIdentifier;
+	}
+}
+
+void x264Options::addOptionsToXml(xmlNodePtr xmlNodeRoot)
+{
+	const int bufferSize = 100;
+	xmlChar xmlBuffer[bufferSize + 1];
+	xmlNodePtr xmlNodeChild, xmlNodeChild2;
+
+	xmlNodeRoot = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)getOptionsTagRoot(), NULL);
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;threads&quot;, number2String(xmlBuffer, bufferSize, getThreads()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;deterministic&quot;, boolean2String(xmlBuffer, bufferSize, getDeterministic()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;idcLevel&quot;, number2String(xmlBuffer, bufferSize, getIdcLevel()));
+
+	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;vui&quot;, NULL);
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;sarAsInput&quot;, boolean2String(xmlBuffer, bufferSize, getSarAsInput()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;sarHeight&quot;, number2String(xmlBuffer, bufferSize, getSarHeight()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;sarWidth&quot;, number2String(xmlBuffer, bufferSize, getSarWidth()));
+
+	switch (getOverscan())
+	{
+		case 0:
+			strcpy((char*)xmlBuffer, &quot;undefined&quot;);
+			break;
+		case 1:
+			strcpy((char*)xmlBuffer, &quot;show&quot;);
+			break;
+		case 2:
+			strcpy((char*)xmlBuffer, &quot;crop&quot;);
+			break;
+	}
+
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;overscan&quot;, xmlBuffer);
+
+	switch (getVideoFormat())
+	{
+		case 0:
+			strcpy((char*)xmlBuffer, &quot;component&quot;);
+			break;
+		case 1:
+			strcpy((char*)xmlBuffer, &quot;pal&quot;);
+			break;
+		case 2:
+			strcpy((char*)xmlBuffer, &quot;ntsc&quot;);
+			break;
+		case 3:
+			strcpy((char*)xmlBuffer, &quot;secam&quot;);
+			break;
+		case 4:
+			strcpy((char*)xmlBuffer, &quot;mac&quot;);
+			break;
+		case 5:
+			strcpy((char*)xmlBuffer, &quot;undefined&quot;);
+			break;
+	}
+
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;videoFormat&quot;, xmlBuffer);
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;fullRangeSamples&quot;, boolean2String(xmlBuffer, bufferSize, getFullRangeSamples()));
+
+	switch (getColorPrimaries())
+	{
+		case 1:
+			strcpy((char*)xmlBuffer, &quot;bt709&quot;);
+			break;
+		case 2:
+			strcpy((char*)xmlBuffer, &quot;undefined&quot;);
+			break;
+		case 4:
+			strcpy((char*)xmlBuffer, &quot;bt470m&quot;);
+			break;
+		case 5:
+			strcpy((char*)xmlBuffer, &quot;bt470bg&quot;);
+			break;
+		case 6:
+			strcpy((char*)xmlBuffer, &quot;smpte170m&quot;);
+			break;
+		case 7:
+			strcpy((char*)xmlBuffer, &quot;smpte240m&quot;);
+			break;
+		case 8:
+			strcpy((char*)xmlBuffer, &quot;film&quot;);
+			break;
+	}
+
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;colorPrimaries&quot;, xmlBuffer);
+
+	switch (getTransfer())
+	{
+		case 1:
+			strcpy((char*)xmlBuffer, &quot;bt709&quot;);
+			break;
+		case 2:
+			strcpy((char*)xmlBuffer, &quot;undefined&quot;);
+			break;
+		case 4:
+			strcpy((char*)xmlBuffer, &quot;bt470m&quot;);
+			break;
+		case 5:
+			strcpy((char*)xmlBuffer, &quot;bt470bg&quot;);
+			break;
+		case 6:
+			strcpy((char*)xmlBuffer, &quot;smpte170m&quot;);
+			break;
+		case 7:
+			strcpy((char*)xmlBuffer, &quot;smpte240m&quot;);
+			break;
+		case 8:
+			strcpy((char*)xmlBuffer, &quot;linear&quot;);
+			break;
+		case 9:
+			strcpy((char*)xmlBuffer, &quot;log100&quot;);
+			break;
+		case 10:
+			strcpy((char*)xmlBuffer, &quot;log316&quot;);
+			break;
+	}
+
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;transfer&quot;, xmlBuffer);
+
+	switch (getColorMatrix())
+	{
+		case 0:
+			strcpy((char*)xmlBuffer, &quot;gbr&quot;);
+			break;
+		case 1:
+			strcpy((char*)xmlBuffer, &quot;bt709&quot;);
+			break;
+		case 2:
+			strcpy((char*)xmlBuffer, &quot;undefined&quot;);
+			break;
+		case 4:
+			strcpy((char*)xmlBuffer, &quot;fcc&quot;);
+			break;
+		case 5:
+			strcpy((char*)xmlBuffer, &quot;bt470bg&quot;);
+			break;
+		case 6:
+			strcpy((char*)xmlBuffer, &quot;smpte170m&quot;);
+			break;
+		case 7:
+			strcpy((char*)xmlBuffer, &quot;smpte240m&quot;);
+			break;
+		case 8:
+			strcpy((char*)xmlBuffer, &quot;ycgco&quot;);
+			break;
+	}
+
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;colorMatrix&quot;, xmlBuffer);
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;chromaSampleLocation&quot;, number2String(xmlBuffer, bufferSize, getChromaSampleLocation()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;referenceFrames&quot;, number2String(xmlBuffer, bufferSize, getReferenceFrames()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;gopMaximumSize&quot;, number2String(xmlBuffer, bufferSize, getGopMaximumSize()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;gopMinimumSize&quot;, number2String(xmlBuffer, bufferSize, getGopMinimumSize()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;scenecutThreshold&quot;, number2String(xmlBuffer, bufferSize, getScenecutThreshold()));
+#if X264_BUILD &lt; 67
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;preScenecutDetection&quot;, boolean2String(xmlBuffer, bufferSize, getPreScenecutDetection()));
+#endif
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;bFrames&quot;, number2String(xmlBuffer, bufferSize, getBFrames()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;adaptiveBframeDecision&quot;, number2String(xmlBuffer, bufferSize, getAdaptiveBFrameDecision()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;bFrameBias&quot;, number2String(xmlBuffer, bufferSize, getBFrameBias()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;bFrameReferences&quot;, number2String(xmlBuffer, bufferSize, getBFrameReferences()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;loopFilter&quot;, boolean2String(xmlBuffer, bufferSize, getLoopFilter()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;loopFilterAlphaC0&quot;, number2String(xmlBuffer, bufferSize, getLoopFilterAlphaC0()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;loopFilterBeta&quot;, number2String(xmlBuffer, bufferSize, getLoopFilterBeta()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;cabac&quot;, boolean2String(xmlBuffer, bufferSize, getCabac()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;interlaced&quot;, boolean2String(xmlBuffer, bufferSize, getInterlaced()));
+
+	switch (getCqmPreset())
+	{
+		case X264_CQM_FLAT:
+			strcpy((char*)xmlBuffer, &quot;flat&quot;);
+			break;
+		case X264_CQM_JVT:
+			strcpy((char*)xmlBuffer, &quot;jvt&quot;);
+			break;
+		case X264_CQM_CUSTOM:
+			strcpy((char*)xmlBuffer, &quot;custom&quot;);
+			break;
+	}
+
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;cqmPreset&quot;, xmlBuffer);
+
+	uint8_t* intra4x4Luma = getIntra4x4Luma();
+	uint8_t* intraChroma = getIntraChroma();
+	uint8_t* inter4x4Luma = getInter4x4Luma();
+	uint8_t* interChroma = getInterChroma();
+	uint8_t* intra8x8Luma = getIntra8x8Luma();
+	uint8_t* inter8x8Luma = getInter8x8Luma();
+
+	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;intra4x4Luma&quot;, NULL);
+
+	for (int i = 0; i &lt; 16; i++)
+		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;value&quot;, number2String(xmlBuffer, bufferSize, intra4x4Luma[i]));
+
+	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;intraChroma&quot;, NULL);
+
+	for (int i = 0; i &lt; 16; i++)
+		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;value&quot;, number2String(xmlBuffer, bufferSize, intraChroma[i]));
+
+	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;inter4x4Luma&quot;, NULL);
+
+	for (int i = 0; i &lt; 16; i++)
+		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;value&quot;, number2String(xmlBuffer, bufferSize, inter4x4Luma[i]));
+
+	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;interChroma&quot;, NULL);
+
+	for (int i = 0; i &lt; 16; i++)
+		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;value&quot;, number2String(xmlBuffer, bufferSize, interChroma[i]));
+
+	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;intra8x8Luma&quot;, NULL);
+
+	for (int i = 0; i &lt; 64; i++)
+		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;value&quot;, number2String(xmlBuffer, bufferSize, intra8x8Luma[i]));
+
+	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;inter8x8Luma&quot;, NULL);
+
+	for (int i = 0; i &lt; 64; i++)
+		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;value&quot;, number2String(xmlBuffer, bufferSize, inter8x8Luma[i]));
+
+	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;analyse&quot;, NULL);
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;partitionI4x4&quot;, boolean2String(xmlBuffer, bufferSize, getPartitionI4x4()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;partitionI8x8&quot;, boolean2String(xmlBuffer, bufferSize, getPartitionI8x8()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;partitionP8x8&quot;, boolean2String(xmlBuffer, bufferSize, getPartitionP8x8()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;partitionP4x4&quot;, boolean2String(xmlBuffer, bufferSize, getPartitionP4x4()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;partitionB8x8&quot;, boolean2String(xmlBuffer, bufferSize, getPartitionB8x8()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;dct8x8&quot;, boolean2String(xmlBuffer, bufferSize, getDct8x8()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;weightedPrediction&quot;, boolean2String(xmlBuffer, bufferSize, getWeightedPrediction()));
+
+	switch (getDirectPredictionMode())
+	{
+		case X264_DIRECT_PRED_NONE:
+			strcpy((char*)xmlBuffer, &quot;none&quot;);
+			break;
+		case X264_DIRECT_PRED_SPATIAL:
+			strcpy((char*)xmlBuffer, &quot;spatial&quot;);
+			break;
+		case X264_DIRECT_PRED_TEMPORAL:
+			strcpy((char*)xmlBuffer, &quot;temporal&quot;);
+			break;
+		case X264_DIRECT_PRED_AUTO:
+			strcpy((char*)xmlBuffer, &quot;auto&quot;);
+			break;
+	}
+
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;directPredictionMode&quot;, xmlBuffer);
+
+#if X264_BUILD &lt; 66
+	switch (getDirectPredictionSize())
+	{
+		case 0:
+			strcpy((char*)xmlBuffer, &quot;4x4&quot;);
+			break;
+		case 1:
+			strcpy((char*)xmlBuffer, &quot;8x8&quot;);
+			break;
+		case -1:
+			strcpy((char*)xmlBuffer, &quot;smallest&quot;);
+			break;
+	}
+
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;directPredictionSize&quot;, xmlBuffer);
+#endif
+
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;chromaLumaQuantiserDifference&quot;, number2String(xmlBuffer, bufferSize, getChromaLumaQuantiserDifference()));
+
+	switch (getMotionEstimationMethod())
+	{
+		case X264_ME_DIA:
+			strcpy((char*)xmlBuffer, &quot;diamond&quot;);
+			break;
+		case X264_ME_UMH:
+			strcpy((char*)xmlBuffer, &quot;multi-hexagonal&quot;);
+			break;
+		case X264_ME_ESA:
+			strcpy((char*)xmlBuffer, &quot;exhaustive&quot;);
+			break;
+#if X264_BUILD &gt;= 57
+		case X264_ME_TESA:
+			strcpy((char*)xmlBuffer, &quot;hadamard&quot;);
+			break;
+#endif
+		case X264_ME_HEX:
+		default:
+			strcpy((char*)xmlBuffer, &quot;hexagonal&quot;);
+			break;
+	}
+
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;motionEstimationMethod&quot;, xmlBuffer);
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;motionVectorSearchRange&quot;, number2String(xmlBuffer, bufferSize, getMotionVectorSearchRange()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;motionVectorLength&quot;, number2String(xmlBuffer, bufferSize, getMotionVectorLength()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;motionVectorThreadBuffer&quot;, number2String(xmlBuffer, bufferSize, getMotionVectorThreadBuffer()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;subpixelRefinement&quot;, number2String(xmlBuffer, bufferSize, getSubpixelRefinement()));
+#if X264_BUILD &lt; 65
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;bidirectionalMotionEstimation&quot;, boolean2String(xmlBuffer, bufferSize, getBidirectionalMotionEstimation()));
+#endif
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;chromaMotionEstimation&quot;, boolean2String(xmlBuffer, bufferSize, getChromaMotionEstimation()));
+#if X264_BUILD &lt; 65
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;bFrameRdo&quot;, boolean2String(xmlBuffer, bufferSize, getBFrameRdo()));
+#endif
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;mixedReferences&quot;, boolean2String(xmlBuffer, bufferSize, getMixedReferences()));
+
+	switch (getTrellis())
+	{
+		case 0:
+			strcpy((char*)xmlBuffer, &quot;disabled&quot;);
+			break;
+		case 1:
+			strcpy((char*)xmlBuffer, &quot;finalMacroblock&quot;);
+			break;
+		case 2:
+			strcpy((char*)xmlBuffer, &quot;allModeDecisions&quot;);
+			break;
+	}
+
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;trellis&quot;, xmlBuffer);
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;fastPSkip&quot;, boolean2String(xmlBuffer, bufferSize, getFastPSkip()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;dctDecimate&quot;, boolean2String(xmlBuffer, bufferSize, getDctDecimate()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;noiseReduction&quot;, number2String(xmlBuffer, bufferSize, getNoiseReduction()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;interLumaDeadzone&quot;, number2String(xmlBuffer, bufferSize, getInterLumaDeadzone()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;intraLumaDeadzone&quot;, number2String(xmlBuffer, bufferSize, getIntraLumaDeadzone()));
+
+	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;rateControl&quot;, NULL);
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;quantiserMinimum&quot;, number2String(xmlBuffer, bufferSize, getQuantiserMinimum()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;quantiserMaximum&quot;, number2String(xmlBuffer, bufferSize, getQuantiserMaximum()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;quantiserStep&quot;, number2String(xmlBuffer, bufferSize, getQuantiserStep()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;averageBitrateTolerance&quot;, number2String(xmlBuffer, bufferSize, getAverageBitrateTolerance()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;vbvMaximumBitrate&quot;, number2String(xmlBuffer, bufferSize, getVbvMaximumBitrate()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;vbvBufferSize&quot;, number2String(xmlBuffer, bufferSize, getVbvBufferSize()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;vbvInitialOccupancy&quot;, number2String(xmlBuffer, bufferSize, getVbvInitialOccupancy()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;ipFrameQuantiser&quot;, number2String(xmlBuffer, bufferSize, getIpFrameQuantiser()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;pbFrameQuantiser&quot;, number2String(xmlBuffer, bufferSize, getPbFrameQuantiser()));
+
+#if X264_BUILD &gt;= 62
+	switch (getAdaptiveQuantiserMode())
+	{
+		case X264_AQ_NONE:
+			strcpy((char*)xmlBuffer, &quot;none&quot;);
+			break;
+		case X264_AQ_VARIANCE:
+			strcpy((char*)xmlBuffer, &quot;variance&quot;);
+			break;
+	}
+
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;adaptiveQuantiserMode&quot;, xmlBuffer);
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;adaptiveQuantiserStrength&quot;, number2String(xmlBuffer, bufferSize, getAdaptiveQuantiserStrength()));
+#endif
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;quantiserCurveCompression&quot;, number2String(xmlBuffer, bufferSize, getQuantiserCurveCompression()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;reduceFluxBeforeCurveCompression&quot;, number2String(xmlBuffer, bufferSize, getReduceFluxBeforeCurveCompression()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;reduceFluxAfterCurveCompression&quot;, number2String(xmlBuffer, bufferSize, getReduceFluxAfterCurveCompression()));
+
+	int zoneCount = getZoneCount();
+
+	if (zoneCount)
+	{
+		x264ZoneOptions** zoneOptions = getZones();
+
+		for (int zoneIndex = 0; zoneIndex &lt; zoneCount; zoneIndex++)
+		{
+			xmlNodeChild2 = xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;zone&quot;, NULL);
+			x264ZoneOptions* option = zoneOptions[zoneIndex];
+
+			xmlNewChild(xmlNodeChild2, NULL, (xmlChar*)&quot;frameStart&quot;, number2String(xmlBuffer, bufferSize, option-&gt;getFrameStart()));
+			xmlNewChild(xmlNodeChild2, NULL, (xmlChar*)&quot;frameEnd&quot;, number2String(xmlBuffer, bufferSize, option-&gt;getFrameEnd()));
+
+			if (zoneOptions[zoneIndex]-&gt;getZoneMode() == ZONE_MODE_QUANTISER)
+				xmlNewChild(xmlNodeChild2, NULL, (xmlChar*)&quot;quantiser&quot;, number2String(xmlBuffer, bufferSize, option-&gt;getZoneParameter()));
+			else
+				xmlNewChild(xmlNodeChild2, NULL, (xmlChar*)&quot;bitrateFactor&quot;, number2String(xmlBuffer, bufferSize, option-&gt;getZoneParameter() / 100.f));
+
+			delete option;
+		}
+
+		delete [] zoneOptions;
+	}
+
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;accessUnitDelimiters&quot;, boolean2String(xmlBuffer, bufferSize, getAccessUnitDelimiters()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;spsIdentifier&quot;, number2String(xmlBuffer, bufferSize, getSpsIdentifier()));
+}
+
+int x264Options::fromXml(const char *xml, PluginXmlType xmlType)
+{
+	clearZones();
+
+	return PluginOptions::fromXml(xml, xmlType);
+}
+
+void x264Options::parseOptions(xmlNode *node)
+{
+	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
+	{
+		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
+		{
+			char *content = (char*)xmlNodeGetContent(xmlChild);
+
+			if (strcmp((char*)xmlChild-&gt;name, &quot;threads&quot;) == 0)
+				setThreads(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;deterministic&quot;) == 0)
+				setDeterministic(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;idcLevel&quot;) == 0)
+				setIdcLevel(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;vui&quot;) == 0)
+				parseVuiOptions(xmlChild);
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;referenceFrames&quot;) == 0)
+				setReferenceFrames(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;gopMaximumSize&quot;) == 0)
+				setGopMaximumSize(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;gopMinimumSize&quot;) == 0)
+				setGopMinimumSize(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;scenecutThreshold&quot;) == 0)
+				setScenecutThreshold(atoi(content));
+#if X264_BUILD &lt; 67
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;preScenecutDetection&quot;) == 0)
+				setPreScenecutDetection(string2Boolean(content));
+#endif
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;bFrames&quot;) == 0)
+				setBFrames(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;adaptiveBframeDecision&quot;) == 0)
+				setAdaptiveBFrameDecision(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;bFrameBias&quot;) == 0)
+				setBFrameBias(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;bFrameReferences&quot;) == 0)
+				setBFrameReferences(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;loopFilter&quot;) == 0)
+				setLoopFilter(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;loopFilterAlphaC0&quot;) == 0)
+				setLoopFilterAlphaC0(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;loopFilterBeta&quot;) == 0)
+				setLoopFilterBeta(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;cabac&quot;) == 0)
+				setCabac(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;interlaced&quot;) == 0)
+				setInterlaced(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;cqmPreset&quot;) == 0)
+			{
+				int cqmPreset = 0;
+
+				if (strcmp(content, &quot;flat&quot;) == 0)
+					cqmPreset = X264_CQM_FLAT;
+				else if (strcmp(content, &quot;jvt&quot;) == 0)
+					cqmPreset = X264_CQM_JVT;
+				else if (strcmp(content, &quot;custom&quot;) == 0)
+					cqmPreset = X264_CQM_CUSTOM;
+
+				setCqmPreset(cqmPreset);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;intra4x4Luma&quot;) == 0)
+			{
+				uint8_t intra4x4Luma[16];
+
+				parseCqmOption(xmlChild, intra4x4Luma);
+				setIntra4x4Luma(intra4x4Luma);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;intraChroma&quot;) == 0)
+			{
+				uint8_t intraChroma[16];
+
+				parseCqmOption(xmlChild, intraChroma);
+				setIntraChroma(intraChroma);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;inter4x4Luma&quot;) == 0)
+			{
+				uint8_t inter4x4Luma[16];
+
+				parseCqmOption(xmlChild, inter4x4Luma);
+				setInter4x4Luma(inter4x4Luma);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;interChroma&quot;) == 0)
+			{
+				uint8_t interChroma[16];
+
+				parseCqmOption(xmlChild, interChroma);
+				setInterChroma(interChroma);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;intra8x8Luma&quot;) == 0)
+			{
+				uint8_t intra8x8Luma[64];
+
+				parseCqmOption(xmlChild, intra8x8Luma);
+				setIntra8x8Luma(intra8x8Luma);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;inter8x8Luma&quot;) == 0)
+			{
+				uint8_t inter8x8Luma[64];
+
+				parseCqmOption(xmlChild, inter8x8Luma);
+				setInter8x8Luma(inter8x8Luma);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;analyse&quot;) == 0)
+				parseAnalyseOptions(xmlChild);
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;rateControl&quot;) == 0)
+				parseRateControlOptions(xmlChild);
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;accessUnitDelimiters&quot;) == 0)
+				setAccessUnitDelimiters(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;spsIdentifier&quot;) == 0)
+				setSpsIdentifier(atoi(content));
+
+			xmlFree(content);
+		}
+	}
+}
+
+void x264Options::parseVuiOptions(xmlNode *node)
+{
+	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
+	{
+		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
+		{
+			char *content = (char*)xmlNodeGetContent(xmlChild);
+
+			if (strcmp((char*)xmlChild-&gt;name, &quot;sarAsInput&quot;) == 0)
+				setSarAsInput(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;sarHeight&quot;) == 0)
+				setSarHeight(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;sarWidth&quot;) == 0)
+				setSarWidth(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;overscan&quot;) == 0)
+			{
+				int overscan = 0;
+
+				if (strcmp(content, &quot;undefined&quot;) == 0)
+					overscan = 0;
+				else if (strcmp(content, &quot;show&quot;) == 0)
+					overscan = 1;
+				else if (strcmp(content, &quot;crop&quot;) == 0)
+					overscan = 2;
+
+				setOverscan(overscan);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;videoFormat&quot;) == 0)
+			{
+				int videoFormat = 5;
+
+				if (strcmp(content, &quot;component&quot;) == 0)
+					videoFormat = 0;
+				else if (strcmp(content, &quot;pal&quot;) == 0)
+					videoFormat = 1;
+				else if (strcmp(content, &quot;ntsc&quot;) == 0)
+					videoFormat = 2;
+				else if (strcmp(content, &quot;secam&quot;) == 0)
+					videoFormat = 3;
+				else if (strcmp(content, &quot;mac&quot;) == 0)
+					videoFormat = 4;
+				else if (strcmp(content, &quot;undefined&quot;) == 0)
+					videoFormat = 5;
+
+				setVideoFormat(videoFormat);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;fullRangeSamples&quot;) == 0)
+				setFullRangeSamples(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;colorPrimaries&quot;) == 0)
+			{
+				int colorPrimaries = 2;
+
+				if (strcmp(content, &quot;bt709&quot;) == 0)
+					colorPrimaries = 1;
+				else if (strcmp(content, &quot;undefined&quot;) == 0)
+					colorPrimaries = 2;
+				else if (strcmp(content, &quot;bt470m&quot;) == 0)
+					colorPrimaries = 4;
+				else if (strcmp(content, &quot;bt470bg&quot;) == 0)
+					colorPrimaries = 5;
+				else if (strcmp(content, &quot;smpte170m&quot;) == 0)
+					colorPrimaries = 6;
+				else if (strcmp(content, &quot;smpte240m&quot;) == 0)
+					colorPrimaries = 7;
+				else if (strcmp(content, &quot;film&quot;) == 0)
+					colorPrimaries = 8;
+
+				setColorPrimaries(colorPrimaries);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;transfer&quot;) == 0)
+			{
+				int transfer = 2;
+
+				if (strcmp(content, &quot;bt709&quot;) == 0)
+					transfer = 1;
+				else if (strcmp(content, &quot;undefined&quot;) == 0)
+					transfer = 2;
+				else if (strcmp(content, &quot;bt470m&quot;) == 0)
+					transfer = 4;
+				else if (strcmp(content, &quot;bt470bg&quot;) == 0)
+					transfer = 5;
+				else if (strcmp(content, &quot;smpte170m&quot;) == 0)
+					transfer = 6;
+				else if (strcmp(content, &quot;smpte240m&quot;) == 0)
+					transfer = 7;
+				else if (strcmp(content, &quot;linear&quot;) == 0)
+					transfer = 8;
+				else if (strcmp(content, &quot;log100&quot;) == 0)
+					transfer = 9;
+				else if (strcmp(content, &quot;log316&quot;) == 0)
+					transfer = 8;
+
+				setTransfer(transfer);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;colorMatrix&quot;) == 0)
+			{
+				int colorMatrix = 2;
+
+				if (strcmp(content, &quot;gbr&quot;) == 0)
+					colorMatrix = 0;
+				else if (strcmp(content, &quot;bt709&quot;) == 0)
+					colorMatrix = 1;
+				else if (strcmp(content, &quot;undefined&quot;) == 0)
+					colorMatrix = 2;
+				else if (strcmp(content, &quot;fcc&quot;) == 0)
+					colorMatrix = 4;
+				else if (strcmp(content, &quot;bt470bg&quot;) == 0)
+					colorMatrix = 5;
+				else if (strcmp(content, &quot;smpte170m&quot;) == 0)
+					colorMatrix = 6;
+				else if (strcmp(content, &quot;smpte240m&quot;) == 0)
+					colorMatrix = 7;
+				else if (strcmp(content, &quot;ycgco&quot;) == 0)
+					colorMatrix = 8;
+
+				setColorMatrix(colorMatrix);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;chromaSampleLocation&quot;) == 0)
+				setChromaSampleLocation(atoi(content));
+
+			xmlFree(content);
+		}
+	}
+}
+
+void x264Options::parseCqmOption(xmlNode *node, uint8_t cqm[])
+{
+	int index = 0;
+
+	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
+	{
+		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
+		{
+			char *content = (char*)xmlNodeGetContent(xmlChild);
+
+			cqm[index] = atoi(content);
+			index++;
+
+			xmlFree(content);
+		}
+	}
+}
+
+void x264Options::parseAnalyseOptions(xmlNode *node)
+{
+	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
+	{
+		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
+		{
+			char *content = (char*)xmlNodeGetContent(xmlChild);
+
+			if (strcmp((char*)xmlChild-&gt;name, &quot;partitionI4x4&quot;) == 0)
+				setPartitionI4x4(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;partitionI8x8&quot;) == 0)
+				setPartitionI8x8(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;partitionP8x8&quot;) == 0)
+				setPartitionP8x8(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;partitionP4x4&quot;) == 0)
+				setPartitionP4x4(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;partitionB8x8&quot;) == 0)
+				setPartitionB8x8(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;dct8x8&quot;) == 0)
+				setDct8x8(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;weightedPrediction&quot;) == 0)
+				setWeightedPrediction(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;directPredictionMode&quot;) == 0)
+			{
+				int directPredictionMode = X264_DIRECT_PRED_SPATIAL;
+
+				if (strcmp(content, &quot;none&quot;) == 0)
+					directPredictionMode = X264_DIRECT_PRED_NONE;
+				else if (strcmp(content, &quot;spatial&quot;) == 0)
+					directPredictionMode = X264_DIRECT_PRED_SPATIAL;
+				else if (strcmp(content, &quot;temporal&quot;) == 0)
+					directPredictionMode = X264_DIRECT_PRED_TEMPORAL;
+				else if (strcmp(content, &quot;auto&quot;) == 0)
+					directPredictionMode = X264_DIRECT_PRED_AUTO;
+
+				setDirectPredictionMode(directPredictionMode);
+			}
+#if X264_BUILD &lt; 66
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;directPredictionSize&quot;) == 0)
+			{
+				int directPredictionSize = -1;
+
+				if (strcmp(content, &quot;4x4&quot;) == 0)
+					directPredictionSize = 0;
+				else if (strcmp(content, &quot;8x8&quot;) == 0)
+					directPredictionSize = 1;
+				else if (strcmp(content, &quot;smallest&quot;) == 0)
+					directPredictionSize = -1;
+
+				setDirectPredictionSize(directPredictionSize);
+			}
+#endif
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;chromaLumaQuantiserDifference&quot;) == 0)
+				setChromaLumaQuantiserDifference(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;motionEstimationMethod&quot;) == 0)
+			{
+				int motionEstimationMethod = X264_ME_HEX;
+
+				if (strcmp(content, &quot;diamond&quot;) == 0)
+					motionEstimationMethod = X264_ME_DIA;
+				else if (strcmp(content, &quot;hexagonal&quot;) == 0)
+					motionEstimationMethod = X264_ME_HEX;
+				else if (strcmp(content, &quot;multi-hexagonal&quot;) == 0)
+					motionEstimationMethod = X264_ME_UMH;
+				else if (strcmp(content, &quot;exhaustive&quot;) == 0)
+					motionEstimationMethod = X264_ME_ESA;
+#if X264_BUILD &gt;= 57
+				else if (strcmp(content, &quot;hadamard&quot;) == 0)
+					motionEstimationMethod = X264_ME_TESA;
+#endif
+
+				setMotionEstimationMethod(motionEstimationMethod);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;motionVectorSearchRange&quot;) == 0)
+				setMotionVectorSearchRange(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;motionVectorLength&quot;) == 0)
+				setMotionVectorLength(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;motionVectorThreadBuffer&quot;) == 0)
+				setMotionVectorThreadBuffer(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;subpixelRefinement&quot;) == 0)
+				setSubpixelRefinement(atoi(content));
+#if X264_BUILD &lt; 65
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;bidirectionalMotionEstimation&quot;) == 0)
+				setBidirectionalMotionEstimation(string2Boolean(content));
+#endif
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;chromaMotionEstimation&quot;) == 0)
+				setChromaMotionEstimation(string2Boolean(content));
+#if X264_BUILD &lt; 65
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;bFrameRdo&quot;) == 0)
+				setBFrameRdo(string2Boolean(content));
+#endif
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;mixedReferences&quot;) == 0)
+				setMixedReferences(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;trellis&quot;) == 0)
+			{
+				int trellis = 0;
+
+				if (strcmp(content, &quot;disabled&quot;) == 0)
+					trellis = 0;
+				else if (strcmp(content, &quot;finalMacroblock&quot;) == 0)
+					trellis = 1;
+				else if (strcmp(content, &quot;allModeDecisions&quot;) == 0)
+					trellis = 2;
+
+				setTrellis(trellis);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;fastPSkip&quot;) == 0)
+				setFastPSkip(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;dctDecimate&quot;) == 0)
+				setDctDecimate(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;noiseReduction&quot;) == 0)
+				setNoiseReduction(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;interLumaDeadzone&quot;) == 0)
+				setInterLumaDeadzone(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;intraLumaDeadzone&quot;) == 0)
+				setIntraLumaDeadzone(atoi(content));
+
+			xmlFree(content);
+		}
+	}
+}
+
+void x264Options::parseRateControlOptions(xmlNode *node)
+{
+	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
+	{
+		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
+		{
+			char *content = (char*)xmlNodeGetContent(xmlChild);
+
+			if (strcmp((char*)xmlChild-&gt;name, &quot;quantiserMinimum&quot;) == 0)
+				setQuantiserMinimum(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantiserMaximum&quot;) == 0)
+				setQuantiserMaximum(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantiserStep&quot;) == 0)
+				setQuantiserStep(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;averageBitrateTolerance&quot;) == 0)
+				setAverageBitrateTolerance(atof(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;vbvMaximumBitrate&quot;) == 0)
+				setVbvMaximumBitrate(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;vbvBufferSize&quot;) == 0)
+				setVbvBufferSize(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;vbvInitialOccupancy&quot;) == 0)
+				setVbvInitialOccupancy(atof(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;ipFrameQuantiser&quot;) == 0)
+				setIpFrameQuantiser(atof(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;pbFrameQuantiser&quot;) == 0)
+				setPbFrameQuantiser(atof(content));
+#if X264_BUILD &gt;= 62
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;adaptiveQuantiserMode&quot;) == 0)
+			{
+				int adaptiveQuantiserMode = X264_AQ_VARIANCE;
+
+				if (strcmp(content, &quot;none&quot;) == 0)
+					adaptiveQuantiserMode = X264_AQ_NONE;
+				else if (strcmp(content, &quot;variance&quot;) == 0)
+					adaptiveQuantiserMode = X264_AQ_VARIANCE;
+
+				setAdaptiveQuantiserMode(adaptiveQuantiserMode);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;adaptiveQuantiserStrength&quot;) == 0)
+				setAdaptiveQuantiserStrength(atof(content));
+#endif
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantiserCurveCompression&quot;) == 0)
+				setQuantiserCurveCompression(atof(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;reduceFluxBeforeCurveCompression&quot;) == 0)
+				setReduceFluxBeforeCurveCompression(atof(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;reduceFluxAfterCurveCompression&quot;) == 0)
+				setReduceFluxAfterCurveCompression(atof(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;zone&quot;) == 0)
+				parseZoneOptions(xmlChild);
+			else
+				printf(&quot;%s\n&quot;, xmlChild-&gt;name);
+
+			xmlFree(content);
+		}
+	}
+}
+
+void x264Options::parseZoneOptions(xmlNode *zoneNode)
+{
+	x264ZoneOptions option;
+
+	for (xmlNode *xmlChild = zoneNode-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
+	{
+		char *content = (char*)xmlNodeGetContent(xmlChild);
+
+		if (strcmp((char*)xmlChild-&gt;name, &quot;frameStart&quot;) == 0)
+			option.setFrameRange(atoi(content), option.getFrameEnd());
+		else if (strcmp((char*)xmlChild-&gt;name, &quot;frameEnd&quot;) == 0)
+			option.setFrameRange(option.getFrameStart(), atoi(content));
+		else if (strcmp((char*)xmlChild-&gt;name, &quot;quantiser&quot;) == 0)
+			option.setQuantiser(atoi(content));
+		else if (strcmp((char*)xmlChild-&gt;name, &quot;bitrateFactor&quot;) == 0)
+			option.setBitrateFactor((int)floor(atoi(content) * 100 + .5));
+
+		xmlFree(content);
+	}
+
+	addZone(&amp;option);
+}

Copied: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Options.h (from rev 5002, branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/options.h	2009-07-06 05:48:05 UTC (rev 5002)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Options.h	2009-07-08 13:35:56 UTC (rev 5017)
@@ -0,0 +1,311 @@
+/***************************************************************************
+                                x264Options.h
+
+    begin                : Mon Apr 21 2008
+    copyright            : (C) 2008 by gruntster
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef x264Options_h
+#define x264Options_h
+
+#include &lt;vector&gt;
+#include &lt;libxml/tree.h&gt;
+
+#include &quot;PluginOptions.h&quot;
+#include &quot;zoneOptions.h&quot;
+
+extern &quot;C&quot;
+{
+#include &quot;x264.h&quot;
+#include &quot;ADM_vidEnc_plugin.h&quot;
+}
+
+#define DEFAULT_ENCODE_MODE ADM_VIDENC_MODE_AQP
+#define DEFAULT_ENCODE_MODE_PARAMETER 26
+
+class x264Options : public PluginOptions
+{
+protected:
+	x264_param_t _param;
+	std::vector&lt;x264ZoneOptions*&gt; _zoneOptions;
+
+	bool _sarAsInput;
+
+	void cleanUp(void);
+
+	void addOptionsToXml(xmlNodePtr xmlNodeRoot);
+	void parseOptions(xmlNode *node);
+
+private:
+	void parseVuiOptions(xmlNode *node);
+	void parseCqmOption(xmlNode *node, uint8_t cqm[]);
+	void parseAnalyseOptions(xmlNode *node);
+	void parseRateControlOptions(xmlNode *node);
+	void parseZoneOptions(xmlNode *zoneNode);
+
+public:
+	x264Options(void);
+	~x264Options(void);
+
+	void reset(void);
+	x264_param_t* getParameters(void);
+
+	int getThreads(void);
+	void setThreads(int threads);
+
+	bool getDeterministic(void);
+	void setDeterministic(bool deterministic);
+
+	int getIdcLevel(void);
+	void setIdcLevel(int idcLevel);
+
+	bool getSarAsInput(void);
+	void setSarAsInput(bool sarAsInput);
+
+	unsigned int getSarHeight(void);
+	void setSarHeight(unsigned int height);
+
+	unsigned int getSarWidth(void);
+	void setSarWidth(unsigned int width);
+
+	unsigned int getOverscan(void);
+	void setOverscan(unsigned int overscan);
+
+	unsigned int getVideoFormat(void);
+	void setVideoFormat(unsigned int videoFormat);
+
+	bool getFullRangeSamples(void);
+	void setFullRangeSamples(bool fullRangeSamples);
+
+	unsigned int getColorPrimaries(void);
+	void setColorPrimaries(unsigned int colorPrimaries);
+
+	unsigned int getTransfer(void);
+	void setTransfer(unsigned int transfer);
+
+	unsigned int getColorMatrix(void);
+	void setColorMatrix(unsigned int transfer);
+
+	unsigned int getChromaSampleLocation(void);
+	void setChromaSampleLocation(unsigned int chromaSampleLocation);
+
+	unsigned int getReferenceFrames(void);
+	void setReferenceFrames(unsigned int referenceFrames);
+
+	unsigned int getGopMinimumSize(void);
+	void setGopMinimumSize(unsigned int gopSize);
+
+	unsigned int getGopMaximumSize(void);
+	void setGopMaximumSize(unsigned int gopSize);
+
+	unsigned int getScenecutThreshold(void);
+	void setScenecutThreshold(unsigned int scenecutThreshold);
+
+#if X264_BUILD &lt; 67
+	bool getPreScenecutDetection(void);
+	void setPreScenecutDetection(bool preScenecutDetection);
+#endif
+
+	unsigned int getBFrames(void);
+	void setBFrames(unsigned int bFrames);
+
+	unsigned int getAdaptiveBFrameDecision(void);
+	void setAdaptiveBFrameDecision(unsigned int adaptiveBframeDecision);
+
+	int getBFrameBias(void);
+	void setBFrameBias(int bFrameBias);
+
+	bool getBFrameReferences(void);
+	void setBFrameReferences(bool bFrameReferences);
+
+	bool getLoopFilter(void);
+	void setLoopFilter(bool loopFilter);
+
+	int getLoopFilterAlphaC0(void);
+	void setLoopFilterAlphaC0(int loopFilterAlphaC0);
+
+	int getLoopFilterBeta(void);
+	void setLoopFilterBeta(int loopFilterBeta);
+
+	bool getCabac(void);
+	void setCabac(bool cabac);
+
+	bool getInterlaced(void);
+	void setInterlaced(bool interlaced);
+
+	unsigned int getCqmPreset(void);
+	void setCqmPreset(unsigned int cqmPreset);
+
+	uint8_t* getIntra4x4Luma(void);
+	void setIntra4x4Luma(uint8_t intra4x4Luma[]);
+
+	uint8_t* getIntraChroma(void);
+	void setIntraChroma(uint8_t intraChroma[]);
+
+	uint8_t* getInter4x4Luma(void);
+	void setInter4x4Luma(uint8_t inter4x4Luma[]);
+
+	uint8_t* getInterChroma(void);
+	void setInterChroma(uint8_t interChroma[]);
+
+	uint8_t* getIntra8x8Luma(void);
+	void setIntra8x8Luma(uint8_t intra8x8Luma[]);
+
+	uint8_t* getInter8x8Luma(void);
+	void setInter8x8Luma(uint8_t inter8x8Luma[]);
+
+	bool getPartitionI4x4(void);
+	void setPartitionI4x4(bool partitionI4x4);
+
+	bool getPartitionI8x8(void);
+	void setPartitionI8x8(bool partitionI8x8);
+
+	bool getPartitionP8x8(void);
+	void setPartitionP8x8(bool partitionP8x8);
+
+	bool getPartitionP4x4(void);
+	void setPartitionP4x4(bool partitionP4x4);
+
+	bool getPartitionB8x8(void);
+	void setPartitionB8x8(bool partitionB8x8);
+
+	bool getDct8x8(void);
+	void setDct8x8(bool dct8x8);
+
+	bool getWeightedPrediction(void);
+	void setWeightedPrediction(bool weightedPrediction);
+
+	unsigned int getDirectPredictionMode(void);
+	void setDirectPredictionMode(unsigned int directPredictionMode);
+
+#if X264_BUILD &lt; 66
+	int getDirectPredictionSize(void);
+	void setDirectPredictionSize(int directPredictionSize);
+#endif
+
+	int getChromaLumaQuantiserDifference(void);
+	void setChromaLumaQuantiserDifference(int chromaLumaQuantiserDifference);
+
+	unsigned int getMotionEstimationMethod(void);
+	void setMotionEstimationMethod(unsigned int motionEstimationMethod);
+
+	unsigned int getMotionVectorSearchRange(void);
+	void setMotionVectorSearchRange(unsigned int motionVectorSearchRange);
+
+	int getMotionVectorLength(void);
+	void setMotionVectorLength(int motionVectorLength);
+
+	int getMotionVectorThreadBuffer(void);
+	void setMotionVectorThreadBuffer(int motionVectorThreadBuffer);
+
+	unsigned int getSubpixelRefinement(void);
+	void setSubpixelRefinement(unsigned int subpixelRefinement);
+
+#if X264_BUILD &lt; 65
+	bool getBidirectionalMotionEstimation(void);
+	void setBidirectionalMotionEstimation(bool bidirectionalMotionEstimation);
+#endif
+
+	bool getChromaMotionEstimation(void);
+	void setChromaMotionEstimation(bool chromaMotionEstimation);
+
+#if X264_BUILD &lt; 65
+	bool getBFrameRdo(void);
+	void setBFrameRdo(bool bFrameRdo);
+#endif
+
+	bool getMixedReferences(void);
+	void setMixedReferences(bool mixedReferences);
+
+	unsigned int getTrellis(void);
+	void setTrellis(unsigned int trellis);
+
+	bool getFastPSkip(void);
+	void setFastPSkip(bool fastPSkip);
+
+	bool getDctDecimate(void);
+	void setDctDecimate(bool dctDecimate);
+
+	unsigned int getNoiseReduction(void);
+	void setNoiseReduction(unsigned int noiseReduction);
+
+	unsigned int getInterLumaDeadzone(void);
+	void setInterLumaDeadzone(unsigned int interLumaDeadzone);
+
+	unsigned int getIntraLumaDeadzone(void);
+	void setIntraLumaDeadzone(unsigned int intraLumaDeadzone);
+
+	bool getComputePsnr(void);
+	void setComputePsnr(bool computePsnr);
+
+	bool getComputeSsim(void);
+	void setComputeSsim(bool computeSsim);
+
+	unsigned int getQuantiserMinimum(void);
+	void setQuantiserMinimum(unsigned int quantiserMinimum);
+
+	unsigned int getQuantiserMaximum(void);
+	void setQuantiserMaximum(unsigned int quantiserMaximum);
+
+	unsigned int getQuantiserStep(void);
+	void setQuantiserStep(unsigned int quantiserStep);
+
+	float getAverageBitrateTolerance(void);
+	void setAverageBitrateTolerance(float averageBitrateTolerance);
+
+	unsigned int getVbvMaximumBitrate(void);
+	void setVbvMaximumBitrate(unsigned int vbvMaximumBitrate);
+
+	unsigned int getVbvBufferSize(void);
+	void setVbvBufferSize(unsigned int vbvBufferSize);
+
+	float getVbvInitialOccupancy(void);
+	void setVbvInitialOccupancy(float vbvInitialOccupancy);
+
+	float getIpFrameQuantiser(void);
+	void setIpFrameQuantiser(float ipFrameQuantiser);
+
+	float getPbFrameQuantiser(void);
+	void setPbFrameQuantiser(float pbFrameQuantiser);
+
+#if X264_BUILD &gt;= 62
+	unsigned int getAdaptiveQuantiserMode(void);
+	void setAdaptiveQuantiserMode(unsigned int adaptiveQuantiserMode);
+
+	float getAdaptiveQuantiserStrength(void);
+	void setAdaptiveQuantiserStrength(float adaptiveQuantiserStrength);
+#endif
+
+	float getQuantiserCurveCompression(void);
+	void setQuantiserCurveCompression(float quantiserCurveCompression);
+
+	float getReduceFluxBeforeCurveCompression(void);
+	void setReduceFluxBeforeCurveCompression(float reduceFluxBeforeCurveCompression);
+
+	float getReduceFluxAfterCurveCompression(void);
+	void setReduceFluxAfterCurveCompression(float reduceFluxAfterCurveCompression);
+
+	unsigned int getZoneCount(void);
+	x264ZoneOptions** getZones(void);
+	void clearZones(void);
+	void addZone(x264ZoneOptions *zoneOptions);
+
+	bool getAccessUnitDelimiters(void);
+	void setAccessUnitDelimiters(bool accessUnitDelimiters);
+
+	unsigned int getSpsIdentifier(void);
+	void setSpsIdentifier(unsigned int spsIdentifier);
+
+	int fromXml(const char *xml, PluginXmlType xmlType);
+};
+
+#endif	// x264Options_h


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002231.html">[Avidemux-svn-commit] r5016 - in	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder:	. common
</A></li>
	<LI>Next message: <A HREF="002233.html">[Avidemux-svn-commit] r5018 - in branches/avidemux_2.6_branch_mean:	avidemux_core/ADM_coreVideoEncoder/include	avidemux_core/ADM_coreVideoEncoder/src	avidemux_plugins/ADM_videoEncoder/ffMpeg4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2232">[ date ]</a>
              <a href="thread.html#2232">[ thread ]</a>
              <a href="subject.html#2232">[ subject ]</a>
              <a href="author.html#2232">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
