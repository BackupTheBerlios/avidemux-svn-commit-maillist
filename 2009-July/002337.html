<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r5122 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_UIs/ADM_GTK/src ADM_UIs/ADM_QT4/include	ADM_UIs/ADM_QT4/src ADM_coreUI/include ADM_coreUI/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2009-July/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5122%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%0A%09ADM_UIs/ADM_GTK/src%20ADM_UIs/ADM_QT4/include%0A%09ADM_UIs/ADM_QT4/src%20ADM_coreUI/include%20ADM_coreUI/src&In-Reply-To=%3C200907191945.n6JJjxTe025016%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002336.html">
   <LINK REL="Next"  HREF="002338.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r5122 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_UIs/ADM_GTK/src ADM_UIs/ADM_QT4/include	ADM_UIs/ADM_QT4/src ADM_coreUI/include ADM_coreUI/src</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5122%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/avidemux%3A%0A%09ADM_UIs/ADM_GTK/src%20ADM_UIs/ADM_QT4/include%0A%09ADM_UIs/ADM_QT4/src%20ADM_coreUI/include%20ADM_coreUI/src&In-Reply-To=%3C200907191945.n6JJjxTe025016%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r5122 - in	branches/avidemux_2.5_branch_gruntster/avidemux:	ADM_UIs/ADM_GTK/src ADM_UIs/ADM_QT4/include	ADM_UIs/ADM_QT4/src ADM_coreUI/include ADM_coreUI/src">gruntster at mail.berlios.de
       </A><BR>
    <I>Sun Jul 19 21:45:59 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002336.html">[Avidemux-svn-commit] r5121 - in branches/avidemux_2.6_branch_mean:	avidemux/common/ADM_audiocodec avidemux/common/ADM_osSupport	avidemux/common/ADM_render avidemux/gtk/ADM_UIs/include	avidemux/gtk/ADM_UIs/src avidemux/gtk/ADM_userInterfaces/ADM_dialog	avidemux/gtk/ADM_userInterfaces/ADM_toolkit_gtk	avidemux/qt4/ADM_userInterfaces/ADM_dialog	avidemux_core/ADM_coreUI/include avidemux_core/ADM_coreUI/src
</A></li>
        <LI>Next message: <A HREF="002338.html">[Avidemux-svn-commit] r5123 - in	branches/avidemux_2.5_branch_gruntster: .	plugins/ADM_videoFilters/AvisynthResize/qt4	plugins/ADM_videoFilters/CNR2/qt4 plugins/ADM_videoFilters/MPDelogo	plugins/ADM_videoFilters/MplayerResize/qt4	plugins/ADM_videoFilters/colorYUV
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2337">[ date ]</a>
              <a href="thread.html#2337">[ thread ]</a>
              <a href="subject.html#2337">[ subject ]</a>
              <a href="author.html#2337">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2009-07-19 21:45:45 +0200 (Sun, 19 Jul 2009)
New Revision: 5122

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_configMenu.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_configMenu.h
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/DIA_dialogFactory.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/include/ADM_dialogFactoryQt4.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_dialogFactory.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_coreUI_internal.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factory.h
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/src/DIA_factory.cpp
Log:
[dlgFactory] add config menu dialog factory control (incomplete)

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/DIA_dialogFactory.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/DIA_dialogFactory.cpp	2009-07-19 17:52:49 UTC (rev 5121)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_GTK/src/DIA_dialogFactory.cpp	2009-07-19 19:45:45 UTC (rev 5122)
@@ -365,6 +365,7 @@
 	&amp;gtkFactoryGetVersion,
 	&amp;gtkDiaFactoryRun,
 	&amp;gtkDiaFactoryRunTabs,
+	NULL,
 	// Buttons
 	&amp;gtkCreateButton,
 	&amp;gtkDeleteButton,
@@ -427,7 +428,10 @@
 	&amp;gtkCreateUSlider,
 	&amp;gtkDestroyUSlider,
 	&amp;gtkCreateSlider,
-	&amp;gtkDestroySlider
+	&amp;gtkDestroySlider,
+	// Config Menu
+	NULL,
+	NULL
 };
 
 /**

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/include/ADM_dialogFactoryQt4.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/include/ADM_dialogFactoryQt4.h	2009-07-19 17:52:49 UTC (rev 5121)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/include/ADM_dialogFactoryQt4.h	2009-07-19 19:45:45 UTC (rev 5122)
@@ -1,2 +1,2 @@
 #define FAC_QT_GRIDLAYOUT 1
-#define FAC_QT_VBOXLAYOUT 2
\ No newline at end of file
+#define FAC_QT_VBOXLAYOUT 2

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/CMakeLists.txt	2009-07-19 17:52:49 UTC (rev 5121)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/CMakeLists.txt	2009-07-19 19:45:45 UTC (rev 5122)
@@ -2,12 +2,12 @@
 
 QT4_WRAP_CPP(${ADM_LIB}_source
 	T_bitrate.h  T_button.h  T_dialogFactory.h  T_filesel.h  T_menu.h  T_slider.h
-	T_threadCount.h  T_toggle.h  T_notch.h)
+	T_threadCount.h  T_toggle.h  T_notch.h  T_configMenu.h)
 
 SET(${ADM_LIB}_T
 	T_bitrate.cpp  T_button.cpp  T_dialogFactory.cpp  T_filesel.cpp  T_menu.cpp
 	T_slider.cpp  T_threadCount.cpp  T_toggle.cpp  T_notch.cpp
-    T_flyDialogQt4.cpp T_QCanvas.cpp
+    T_flyDialogQt4.cpp T_QCanvas.cpp  T_configMenu.cpp
 )
 
 SET(${ADM_LIB}_SRCS

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_configMenu.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_configMenu.cpp	2009-07-19 17:52:49 UTC (rev 5121)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_configMenu.cpp	2009-07-19 19:45:45 UTC (rev 5122)
@@ -0,0 +1,259 @@
+/***************************************************************************
+T_configMenu.cpp
+Handle dialog factory element : Config Menu
+(C) 2009 Gruntster 
+***************************************************************************/
+
+/***************************************************************************
+*                                                                         *
+*   This program is free software; you can redistribute it and/or modify  *
+*   it under the terms of the GNU General Public License as published by  *
+*   the Free Software Foundation; either version 2 of the License, or     *
+*   (at your option) any later version.                                   *
+*                                                                         *
+***************************************************************************/
+
+#include &lt;QtGui/QFileDialog&gt;
+#include &quot;T_configMenu.h&quot;
+#include &quot;ADM_dialogFactoryQt4.h&quot;
+#include &quot;ADM_files.h&quot;
+#include &quot;DIA_coreToolkit.h&quot;
+
+extern &quot;C&quot;
+{
+#include &quot;ADM_plugin/ADM_vidEnc_plugin.h&quot;
+}
+
+extern const char* shortkey(const char*);
+
+namespace ADM_Qt4Factory
+{
+	ADM_QconfigMenu::ADM_QconfigMenu(QWidget *widget, QGridLayout *layout, int line, 
+		const char* userConfigDir, const char* systemConfigDir, CONFIG_MENU_CHANGED_T *changedFunc, 
+		CONFIG_MENU_SERIALIZE_T *serializeFunc, diaElem **controls, unsigned int controlCount) : QWidget(widget) 
+	{
+		this-&gt;userConfigDir = userConfigDir;
+		this-&gt;systemConfigDir = systemConfigDir;
+
+		this-&gt;changedFunc = changedFunc;
+		this-&gt;serializeFunc = serializeFunc;
+
+		this-&gt;controls = controls;
+		this-&gt;controlCount = controlCount;
+
+		label = new QLabel(QString::fromUtf8(QT_TR_NOOP(&quot;Configuration:&quot;)), widget);
+		combobox = new QComboBox(widget);
+		saveAsButton = new QPushButton(QString::fromUtf8(QT_TR_NOOP(&quot;Save As&quot;)), widget);
+		deleteButton = new QPushButton(QString::fromUtf8(QT_TR_NOOP(&quot;Delete&quot;)), widget);
+
+		QSpacerItem *spacer1 = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
+		QSpacerItem *spacer2 = new QSpacerItem(20, 20, QSizePolicy::Expanding, QSizePolicy::Minimum);
+
+		layout-&gt;addItem(spacer1, line, 0);
+		layout-&gt;addWidget(label, line, 1);
+		layout-&gt;addWidget(combobox, line, 2);
+		layout-&gt;addWidget(saveAsButton, line, 3);
+		layout-&gt;addWidget(deleteButton, line, 4);
+		layout-&gt;addItem(spacer2, line, 5);
+
+		QObject::connect(deleteButton, SIGNAL(clicked(bool)), this, SLOT(deleteClicked(bool)));
+		QObject::connect(saveAsButton, SIGNAL(clicked(bool)), this, SLOT(saveAsClicked(bool)));
+		QObject::connect(combobox, SIGNAL(currentIndexChanged(int)), this, SLOT(comboboxIndexChanged(int)));
+
+		fillConfigurationComboBox();
+	}
+
+	ADM_QconfigMenu::~ADM_QconfigMenu() 
+	{
+	}
+
+	void ADM_QconfigMenu::fillConfigurationComboBox(void)
+	{
+		QMap&lt;QString, int&gt; configs;
+		QStringList filter(&quot;*.xml&quot;);
+		QStringList list = QDir(this-&gt;userConfigDir).entryList(filter, QDir::Files | QDir::Readable);
+
+		for (int item = 0; item &lt; list.size(); item++)
+			configs.insert(QFileInfo(list[item]).completeBaseName(), CONFIG_MENU_USER);
+
+		list = QDir(this-&gt;systemConfigDir).entryList(filter, QDir::Files | QDir::Readable);
+
+		for (int item = 0; item &lt; list.size(); item++)
+			configs.insert(QFileInfo(list[item]).completeBaseName(), CONFIG_MENU_SYSTEM);
+
+		combobox-&gt;clear();
+		combobox-&gt;addItem(QT_TR_NOOP(&quot;&lt;default&gt;&quot;), CONFIG_MENU_DEFAULT);
+		combobox-&gt;addItem(QT_TR_NOOP(&quot;&lt;custom&gt;&quot;), CONFIG_MENU_CUSTOM);
+
+		QMap&lt;QString, int&gt;::const_iterator mapIterator = configs.constBegin();
+
+		while (mapIterator != configs.constEnd())
+		{
+			combobox-&gt;addItem(mapIterator.key(), mapIterator.value());
+			mapIterator++;
+		}
+	}
+
+	bool ADM_QconfigMenu::selectConfiguration(QString *selectFile, ConfigMenuType configurationType)
+	{
+		bool success = false;
+
+		if (configurationType == CONFIG_MENU_DEFAULT)
+		{
+			combobox-&gt;setCurrentIndex(0);
+			success = true;
+		}
+		else
+		{
+			for (int index = 0; index &lt; combobox-&gt;count(); index++)
+			{
+				if (combobox-&gt;itemText(index) == selectFile &amp;&amp; combobox-&gt;itemData(index).toInt() == configurationType)
+				{
+					combobox-&gt;setCurrentIndex(index);
+					success = true;
+					break;
+				}
+			}
+
+			if (!success)
+				combobox-&gt;setCurrentIndex(1);
+		}
+
+		return success;
+	}
+
+	void ADM_QconfigMenu::deleteClicked(bool checked)
+	{
+		if (combobox-&gt;itemData(combobox-&gt;currentIndex()).toInt() == CONFIG_MENU_USER)
+		{
+			QString configFileName = QFileInfo(QString(this-&gt;userConfigDir), combobox-&gt;currentText() + &quot;.xml&quot;).filePath();
+			QFile configFile(configFileName);
+
+			if (GUI_Question(QT_TR_NOOP(&quot;Are you sure you wish to delete the selected configuration?&quot;)) &amp;&amp; configFile.exists())
+			{
+				configFile.remove();
+				combobox-&gt;removeItem(combobox-&gt;currentIndex());
+				combobox-&gt;setCurrentIndex(0);	// default
+			}
+		}
+	}
+
+	void ADM_QconfigMenu::saveAsClicked(bool checked)
+	{
+		if (this-&gt;serializeFunc)
+		{
+			ADM_mkdir(this-&gt;userConfigDir);
+
+			QString configFileName = QFileDialog::getSaveFileName(this, QT_TR_NOOP(&quot;Save As&quot;), this-&gt;userConfigDir, QT_TR_NOOP(&quot;Configuration File (*.xml)&quot;));
+
+			if (!configFileName.isNull())
+			{
+				for (int i = 0; i &lt; this-&gt;controlCount; i++)
+					this-&gt;controls[i]-&gt;getMe();
+
+				char *configData = this-&gt;serializeFunc();
+				QFile configFile(configFileName);
+
+				configFile.open(QIODevice::WriteOnly | QIODevice::Truncate | QIODevice::Text);
+				configFile.write(configData, strlen(configData));
+				configFile.close();
+
+				delete [] configData;
+
+				fillConfigurationComboBox();
+				selectConfiguration(&amp;QFileInfo(configFileName).completeBaseName(), CONFIG_MENU_USER);
+			}
+		}
+	}
+
+	void ADM_QconfigMenu::comboboxIndexChanged(int index)
+	{
+		ConfigMenuType configType = (ConfigMenuType)combobox-&gt;itemData(index).toInt();
+
+		deleteButton-&gt;setEnabled(configType == CONFIG_MENU_USER);
+
+		if (changedFunc)
+			changedFunc(combobox-&gt;itemText(index).toUtf8().constData(), configType);
+	}
+
+	class diaElemConfigMenu : public diaElem
+	{
+	protected:
+		const char *userConfigDir, *systemConfigDir;
+		diaElem **controls;
+		unsigned int controlCount;
+
+		CONFIG_MENU_CHANGED_T *changedFunc;
+		CONFIG_MENU_SERIALIZE_T *serializeFunc;
+
+	public:
+		diaElemConfigMenu(const char* userConfigDir, const char* systemConfigDir, CONFIG_MENU_CHANGED_T *changedFunc,
+				CONFIG_MENU_SERIALIZE_T *serializeFunc, diaElem **controls, unsigned int controlCount);
+		~diaElemConfigMenu();
+		void setMe(void *dialog, void *opaque, uint32_t line);
+		void getMe(void);
+		void enable(uint32_t onoff);
+		int getRequiredLayout(void);
+	};
+
+	diaElemConfigMenu::diaElemConfigMenu(const char* userConfigDir, const char* systemConfigDir, CONFIG_MENU_CHANGED_T *changedFunc,
+				CONFIG_MENU_SERIALIZE_T *serializeFunc, diaElem **controls, unsigned int controlCount) : diaElem(ELEM_CONFIG_MENU)
+	{
+		this-&gt;userConfigDir = userConfigDir;
+		this-&gt;systemConfigDir = systemConfigDir;
+
+		this-&gt;changedFunc = changedFunc;
+		this-&gt;serializeFunc = serializeFunc;
+
+		this-&gt;controls = controls;
+		this-&gt;controlCount = controlCount;
+	}
+
+	diaElemConfigMenu::~diaElemConfigMenu()
+	{
+	}
+
+	void diaElemConfigMenu::setMe(void *dialog, void *opaque, uint32_t line)
+	{
+		QGridLayout *layout = (QGridLayout*)opaque;
+		ADM_QconfigMenu *configMenu = new ADM_QconfigMenu((QWidget*)dialog, layout, line, this-&gt;userConfigDir, 
+			this-&gt;systemConfigDir, this-&gt;changedFunc, this-&gt;serializeFunc, this-&gt;controls, this-&gt;controlCount);
+
+		myWidget = (void*)configMenu;
+	}
+
+	void diaElemConfigMenu::getMe(void)
+	{
+		/*ADM_QconfigMenu *configMenu = (ADM_QconfigMenu*)myWidget;
+		uint32_t *val = (uint32_t*)param;
+
+		if ((configMenu-&gt;radiobutton1)-&gt;isChecked())
+			*val = 1;
+		else if ((configMenu-&gt;radiobutton2)-&gt;isChecked())
+			*val = 0;
+		else
+			*val = (configMenu-&gt;spinBox)-&gt;value(); */
+	}
+
+	void diaElemConfigMenu::enable(uint32_t onoff)
+	{
+	}
+
+	int diaElemConfigMenu::getRequiredLayout(void)
+	{
+		return FAC_QT_GRIDLAYOUT;
+	}
+}
+
+diaElem* qt4CreateConfigMenu(const char* userConfigDir, const char* systemConfigDir, CONFIG_MENU_CHANGED_T *changedFunc, 
+							 CONFIG_MENU_SERIALIZE_T *serializeFunc, diaElem **controls, unsigned int controlCount)
+{
+	return new ADM_Qt4Factory::diaElemConfigMenu(userConfigDir, systemConfigDir, changedFunc, serializeFunc, controls, controlCount);
+}
+
+void qt4DestroyConfigMenu(diaElem *e)
+{
+	ADM_Qt4Factory::diaElemConfigMenu *a = (ADM_Qt4Factory::diaElemConfigMenu*)e;
+
+	delete a;
+}

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_configMenu.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_configMenu.h	2009-07-19 17:52:49 UTC (rev 5121)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_configMenu.h	2009-07-19 19:45:45 UTC (rev 5122)
@@ -0,0 +1,43 @@
+#ifndef T_configMenu_h
+#define T_configMenu_h
+#include &lt;QtGui/QLabel&gt;
+#include &lt;QtGui/QComboBox&gt;
+#include &lt;QtGui/QGridLayout&gt;
+#include &lt;QtGui/QPushButton&gt;
+#include &quot;DIA_factory.h&quot;
+
+namespace ADM_Qt4Factory
+{
+	class ADM_QconfigMenu : public QWidget
+	{
+		Q_OBJECT
+
+	private:
+		const char *userConfigDir, *systemConfigDir;
+		diaElem **controls;
+		unsigned int controlCount;
+
+		CONFIG_MENU_CHANGED_T *changedFunc;
+		CONFIG_MENU_SERIALIZE_T *serializeFunc;
+
+		void fillConfigurationComboBox(void);
+		bool selectConfiguration(QString *selectFile, ConfigMenuType configurationType);
+
+	public slots:
+		void deleteClicked(bool checked);
+		void saveAsClicked(bool checked);
+		void comboboxIndexChanged(int index);
+
+	public:
+		QLabel *label;
+		QComboBox *combobox;
+		QPushButton *saveAsButton;
+		QPushButton *deleteButton;
+
+		ADM_QconfigMenu(QWidget *widget, QGridLayout *layout, int line,
+			const char* userConfigDir, const char* systemConfigDir, CONFIG_MENU_CHANGED_T *changedFunc,
+			CONFIG_MENU_SERIALIZE_T *serializeFunc, diaElem **controls, unsigned int controlCount);
+		~ADM_QconfigMenu();
+	};
+}
+#endif	// T_configMenu_h

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_dialogFactory.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_dialogFactory.cpp	2009-07-19 17:52:49 UTC (rev 5121)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_UIs/ADM_QT4/src/T_dialogFactory.cpp	2009-07-19 19:45:45 UTC (rev 5122)
@@ -26,6 +26,7 @@
 #include &quot;ADM_dialogFactoryQt4.h&quot;
 
 static void insertTab(uint32_t index, diaElemTabs *tab, QTabWidget *wtab);
+static void addControls(QWidget *parent, QVBoxLayout *vboxLayout, diaElem **controls, unsigned int controlCount);
 
 /**
     \fn qt4DiaFactoryRun(const char *title,uint32_t nb,diaElem **elems)
@@ -47,53 +48,15 @@
   QSpacerItem *spacer = new QSpacerItem(20, 16, QSizePolicy::Minimum, QSizePolicy::Fixed);
   QDialogButtonBox *buttonBox = new QDialogButtonBox();
   QVBoxLayout *vboxLayout = new QVBoxLayout();
-  QLayout *layout = NULL;
-  int currentLayout = 0;
 
- int  v=0;
+  addControls(&amp;dialog, vboxLayout, elems, nb);
 
- for(int i=0;i&lt;nb;i++)
- {
-	 ADM_assert(elems[i]);
-
-	 if (elems[i]-&gt;getRequiredLayout() != currentLayout)
-	 {
-		 if (layout)
-			 vboxLayout-&gt;addLayout(layout);
-
-		 switch (elems[i]-&gt;getRequiredLayout())
-		 {
-			 case FAC_QT_GRIDLAYOUT:
-				 layout = new QGridLayout();
-				 break;
-			 case FAC_QT_VBOXLAYOUT:
-				 layout = new QVBoxLayout();
-				 break;
-		 }
-
-		 currentLayout = elems[i]-&gt;getRequiredLayout();
-		 v = 0;
-	 }
-
-	 elems[i]-&gt;setMe( (void *)&amp;dialog,layout,v);
-	 v+=elems[i]-&gt;getSize();
- }
-
-   for(int i=0;i&lt;nb;i++)
-  {
-    ADM_assert(elems[i]);
-     elems[i]-&gt;finalize(); 
-  }
-
   // Add buttons
    buttonBox-&gt;setStandardButtons(QDialogButtonBox::Ok | QDialogButtonBox::Cancel);
 
    QObject::connect(buttonBox, SIGNAL(accepted()), &amp;dialog, SLOT(accept()));
    QObject::connect(buttonBox, SIGNAL(rejected()), &amp;dialog, SLOT(reject()));
 
-   if (layout)
-	   vboxLayout-&gt;addLayout(layout);
-
    vboxLayout-&gt;addItem(spacer);
    vboxLayout-&gt;addWidget(buttonBox);
 
@@ -135,15 +98,15 @@
 /**
  * 	\fn qt4DiaFactoryRunTabs
  */
-uint8_t qt4DiaFactoryRunTabs(const char *title,uint32_t nb,diaElemTabs **tabs)
+uint8_t qt4DiaFactoryRunTabs2(const char *title, unsigned int headerControlCount, diaElem **headerControls, unsigned int tabControlCount, diaElemTabs **tabControls)
 {
     QDialog dialog(qtLastRegisteredDialog());
 
 	qtRegisterDialog(&amp;dialog);
   
   ADM_assert(title);
-  ADM_assert(nb);
-  ADM_assert(tabs);
+  ADM_assert(tabControlCount);
+  ADM_assert(tabControls);
   
   dialog.setWindowTitle(QString::fromUtf8(title));
 
@@ -153,17 +116,20 @@
   QTabWidget *wtabs = new QTabWidget();
   QDialogButtonBox *buttonBox = new QDialogButtonBox();
 
-    buttonBox-&gt;setStandardButtons(QDialogButtonBox::Ok | QDialogButtonBox::Cancel);
+  if (headerControls)
+	  addControls(&amp;dialog, vboxLayout, headerControls, headerControlCount);
 
-     QObject::connect(buttonBox, SIGNAL(accepted()), &amp;dialog, SLOT(accept()));
-     QObject::connect(buttonBox, SIGNAL(rejected()), &amp;dialog, SLOT(reject()));
-
-     for(int i=0;i&lt;nb;i++)
+     for(int i=0;i&lt;tabControlCount;i++)
      {
-        ADM_assert(tabs[i]);
-        insertTab(i,tabs[i],wtabs);
+        ADM_assert(tabControls[i]);
+        insertTab(i,tabControls[i],wtabs);
       }
 
+	 buttonBox-&gt;setStandardButtons(QDialogButtonBox::Ok | QDialogButtonBox::Cancel);
+
+     QObject::connect(buttonBox, SIGNAL(accepted()), &amp;dialog, SLOT(accept()));
+     QObject::connect(buttonBox, SIGNAL(rejected()), &amp;dialog, SLOT(reject()));
+
 	 vboxLayout-&gt;addLayout(layout);
      vboxLayout-&gt;addWidget(wtabs,0,0);
 	 vboxLayout-&gt;addItem(spacer);
@@ -179,10 +145,10 @@
   if(dialog.exec()==QDialog::Accepted)
   {
       // Read tabs
-       for(int tab=0;tab&lt;nb;tab++)
+       for(int tab=0;tab&lt;tabControlCount;tab++)
      {
-        ADM_assert(tabs[tab]);
-        diaElemTabs *myTab=tabs[tab];
+        ADM_assert(tabControls[tab]);
+        diaElemTabs *myTab=tabControls[tab];
         for(int i=0;i&lt;myTab-&gt;nbElems;i++)
         {
           myTab-&gt;dias[i]-&gt;getMe();
@@ -200,35 +166,26 @@
   
 }
 
-void insertTab(uint32_t index, diaElemTabs *tab, QTabWidget *wtab)
+uint8_t qt4DiaFactoryRunTabs(const char *title, uint32_t tabControlCount, diaElemTabs **tabControls)
 {
+	return qt4DiaFactoryRunTabs2(title, 0, NULL, tabControlCount, tabControls);
+}
 
-  QWidget *wid=new QWidget;  
-  QSpacerItem *spacerItem = new QSpacerItem(20, 40, QSizePolicy::Minimum, QSizePolicy::Expanding);
-  int currentLayout = 0;
-  QVBoxLayout *vboxLayout = new QVBoxLayout(wid);
-  QLayout *layout = NULL;
-  
-  /* First compute the size of our window */
-  int vsize=0;
-  for(int i=0;i&lt;tab-&gt;nbElems;i++)
-  {
-    ADM_assert(tab-&gt;dias[i]);
-     vsize+=tab-&gt;dias[i]-&gt;getSize(); 
-  }
+void addControls(QWidget *parent, QVBoxLayout *vboxLayout, diaElem **controls, unsigned int controlCount)
+{
+	int v = 0, currentLayout = 0;
+	QLayout *layout = NULL;
 
-	int  v=0;
-
-	for(int i=0;i&lt;tab-&gt;nbElems;i++)
+	for(int i = 0; i &lt; controlCount; i++)
 	{
-		ADM_assert(tab-&gt;dias[i]);
+		ADM_assert(controls[i]);
 
-		if (tab-&gt;dias[i]-&gt;getRequiredLayout() != currentLayout)
+		if (controls[i]-&gt;getRequiredLayout() != currentLayout)
 		{
 			if (layout)
 				vboxLayout-&gt;addLayout(layout);
 
-			switch (tab-&gt;dias[i]-&gt;getRequiredLayout())
+			switch (controls[i]-&gt;getRequiredLayout())
 			{
 				case FAC_QT_GRIDLAYOUT:
 					layout = new QGridLayout();
@@ -238,31 +195,38 @@
 					break;
 			}
 
-			currentLayout = tab-&gt;dias[i]-&gt;getRequiredLayout();
+			currentLayout = controls[i]-&gt;getRequiredLayout();
 			v = 0;
 		}
 
-		tab-&gt;dias[i]-&gt;setMe( wid,layout,v); 
-		v+=tab-&gt;dias[i]-&gt;getSize();
+		controls[i]-&gt;setMe(parent, layout, v); 
+		v += controls[i]-&gt;getSize();
 	}
-  
-  wtab-&gt;addTab(wid,QString::fromUtf8(tab-&gt;title));
-  for(int i=0;i&lt;tab-&gt;nbElems;i++)
-  {
-    tab-&gt;dias[i]-&gt;finalize(); 
-  }
 
-  if (layout)
-	  vboxLayout-&gt;addLayout(layout);
+	if (layout)
+		vboxLayout-&gt;addLayout(layout);
 
-  vboxLayout-&gt;addItem(spacerItem);
+	for(int i = 0; i &lt; controlCount; i++)
+		controls[i]-&gt;finalize(); 
 }
 
+void insertTab(uint32_t index, diaElemTabs *tab, QTabWidget *wtab)
+{
+	QWidget *wid = new QWidget;
+	QVBoxLayout *vboxLayout = new QVBoxLayout(wid);
+	QSpacerItem *spacerItem = new QSpacerItem(20, 40, QSizePolicy::Minimum, QSizePolicy::Expanding);
+
+	addControls(wid, vboxLayout, tab-&gt;dias, tab-&gt;nbElems);
+
+	wtab-&gt;addTab(wid,QString::fromUtf8(tab-&gt;title));
+	vboxLayout-&gt;addItem(spacerItem);
+}
+
 /**
  * 
  */
 /**
- *  \fn gtkFactoryGetVersion
+ *  \fn qt4FactoryGetVersion
  * 	\brief returns the version this has been compiled with
  */
 void      qt4FactoryGetVersion(uint32_t *maj,uint32_t *minor,uint32_t *patch)
@@ -316,6 +280,8 @@
 extern DELETE_DIA_ELEM_T    qt4DestroyToggleInt;
 extern CREATE_TOGGLE_T      qt4CreateToggle;
 extern DELETE_DIA_ELEM_T    qt4DestroyToggle;
+extern CREATE_CONFIG_MENU_T qt4CreateConfigMenu;
+extern DELETE_DIA_ELEM_T    qt4DestroyConfigMenu;
 
 //************
 static FactoryDescriptor Qt4FactoryDescriptor=
@@ -323,6 +289,7 @@
 	&amp;qt4FactoryGetVersion,
 	&amp;qt4DiaFactoryRun,
 	&amp;qt4DiaFactoryRunTabs,
+	&amp;qt4DiaFactoryRunTabs2,
 	// Buttons
 	&amp;qt4CreateButton,
 	&amp;qt4DestroyButton,
@@ -385,7 +352,10 @@
 	&amp;qt4CreateUSlider,
 	&amp;qt4DestroyUSlider,
 	&amp;qt4CreateSlider,
-	&amp;qt4DestroySlider
+	&amp;qt4DestroySlider,
+	// Config Menu
+	&amp;qt4CreateConfigMenu,
+	&amp;qt4DestroyConfigMenu
 };
 
 /**

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_coreUI_internal.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_coreUI_internal.h	2009-07-19 17:52:49 UTC (rev 5121)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_coreUI_internal.h	2009-07-19 19:45:45 UTC (rev 5122)
@@ -38,12 +38,15 @@
 
 //
 typedef uint8_t DIA_FACTORY_RUN_TABS(const char *title,uint32_t nb,diaElemTabs **tabs);
+typedef uint8_t DIA_FACTORY_RUN_TABS2(const char *title, unsigned int headerControlCount, diaElem **headerControls, unsigned int tabControlCount, diaElemTabs **tabControls);
 typedef uint8_t DIA_FACTORY_RUN(const char *title,uint32_t nb,diaElem **elems);
+
 typedef struct
 {
 	COREUI_GET_VERSION   *FactoryGetVersion;
 	DIA_FACTORY_RUN      *FactoryRun;
 	DIA_FACTORY_RUN_TABS *FactoryRunTab;
+	DIA_FACTORY_RUN_TABS2 *FactoryRunTab2;
 //	
 	CREATE_BUTTON_T 	 *CreareButton;
 	DELETE_DIA_ELEM_T    *DestroyButton;
@@ -110,6 +113,9 @@
 // Slider
 	CREATE_SLIDER_T      *CreateSlider;
 	DELETE_DIA_ELEM_T    *DestroySlider;
+// Config Menu
+	CREATE_CONFIG_MENU_T *CreateConfigMenu;
+	DELETE_DIA_ELEM_T    *DestroyConfigMenu;
 }FactoryDescriptor;
 //
 uint8_t DIA_factoryInit(FactoryDescriptor *d);

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factory.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factory.h	2009-07-19 17:52:49 UTC (rev 5121)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/include/DIA_factory.h	2009-07-19 19:45:45 UTC (rev 5122)
@@ -23,7 +23,7 @@
 
 #define ADM_COREUI_MAJOR 1
 #define ADM_COREUI_MINOR 0
-#define ADM_COREUI_PATCH 0
+#define ADM_COREUI_PATCH 1
 
 typedef enum 
 {
@@ -47,8 +47,9 @@
   ELEM_SLIDER,
   ELEM_THREAD_COUNT,
   ELEM_MATRIX,
+  ELEM_ASPECT_RATIO,
+  ELEM_CONFIG_MENU,
   ELEM_COUNT,
-  ELEM_ASPECT_RATIO,
   ELEM_MAX=ELEM_COUNT-1
 }elemEnum;
 typedef void ADM_FAC_CALLBACK(void *cookie);
@@ -630,9 +631,42 @@
 	void enable(uint32_t onoff);
 	int getRequiredLayout(void);
 };
+/*********************************************/
+typedef enum
+{
+	CONFIG_MENU_CUSTOM,
+	CONFIG_MENU_DEFAULT,
+	CONFIG_MENU_USER,
+	CONFIG_MENU_SYSTEM
+} ConfigMenuType;
 
+typedef char *(CONFIG_MENU_SERIALIZE_T)(void);
+typedef bool (CONFIG_MENU_CHANGED_T)(const char* configName, ConfigMenuType configType);
+typedef diaElem *(CREATE_CONFIG_MENU_T)(const char* userConfigDir, const char* systemConfigDir,	CONFIG_MENU_CHANGED_T *changedFunc, 
+										CONFIG_MENU_SERIALIZE_T *serializeFunc, diaElem **controls, unsigned int controlCount);
+
+class diaElemConfigMenu : public diaElem
+{
+protected:
+	const char *userConfigDir, *systemConfigDir;
+	diaElem **controls;
+	unsigned int controlCount;
+
+	CONFIG_MENU_CHANGED_T *changedFunc;
+	CONFIG_MENU_SERIALIZE_T *serializeFunc;
+
+public:
+	diaElemConfigMenu(const char* userConfigDir, const char* systemConfigDir, CONFIG_MENU_CHANGED_T *changedFunc,
+			CONFIG_MENU_SERIALIZE_T *serializeFunc, diaElem **controls, unsigned int controlCount);
+	~diaElemConfigMenu();
+	void setMe(void *dialog, void *opaque, uint32_t line);
+	void getMe(void);
+	void enable(uint32_t onoff);
+	int getRequiredLayout(void);
+};
 /*********************************************/
 uint8_t diaFactoryRun(const char *title,uint32_t nb,diaElem **elems);
 uint8_t diaFactoryRunTabs(const char *title,uint32_t nb,diaElemTabs **tabs);
+uint8_t diaFactoryRunTabs(const char *title, unsigned int headerControlCount, diaElem **headerControls, unsigned int tabControlCount, diaElemTabs **tabControls);
 /*********************************************/
 #endif

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/src/DIA_factory.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/src/DIA_factory.cpp	2009-07-19 17:52:49 UTC (rev 5121)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_coreUI/src/DIA_factory.cpp	2009-07-19 19:45:45 UTC (rev 5122)
@@ -58,6 +58,11 @@
 	ADM_assert(Factory); 
 	return Factory-&gt;FactoryRunTab(title,nb,tabs);
 }
+uint8_t diaFactoryRunTabs(const char *title, unsigned int headerControlCount, diaElem **headerControls, unsigned int tabControlCount, diaElemTabs **tabControls)
+{
+	ADM_assert(Factory);
+	return Factory-&gt;FactoryRunTab2(title, headerControlCount, headerControls, tabControlCount, tabControls);
+}
 
 // ****************** Buttons ********************
 diaElemButton ::diaElemButton(const char *toggleTitle, ADM_FAC_CALLBACK *cb,void *cookie,const char *tip) :diaElem(ELEM_BUTTON)
@@ -566,5 +571,25 @@
 			cast-&gt;setDigits(digits);	
 }
 DIA_MKSTUBS(diaElemSlider)
-//
-// EOF
+// ****************** diaElemConfigMenu ********************
+diaElemConfigMenu::diaElemConfigMenu(const char* userConfigDir, const char* systemConfigDir, CONFIG_MENU_CHANGED_T *changedFunc, 
+									 CONFIG_MENU_SERIALIZE_T *serializeFunc, diaElem **controls, unsigned int controlCount) : diaElem(ELEM_CONFIG_MENU)
+{
+	ADM_assert(Factory);
+	internalPointer = Factory-&gt;CreateConfigMenu(userConfigDir, systemConfigDir, changedFunc, serializeFunc, controls, controlCount);
+}
+
+diaElemConfigMenu::~diaElemConfigMenu()
+{
+	ADM_assert(Factory); 
+	Factory-&gt;DestroyConfigMenu(internalPointer);
+	internalPointer = NULL;
+}
+
+void diaElemConfigMenu::enable(uint32_t onoff)
+{ 
+	ADM_assert(internalPointer); 
+	internalPointer-&gt;enable(onoff);
+}
+
+DIA_MKSTUBS(diaElemConfigMenu)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002336.html">[Avidemux-svn-commit] r5121 - in branches/avidemux_2.6_branch_mean:	avidemux/common/ADM_audiocodec avidemux/common/ADM_osSupport	avidemux/common/ADM_render avidemux/gtk/ADM_UIs/include	avidemux/gtk/ADM_UIs/src avidemux/gtk/ADM_userInterfaces/ADM_dialog	avidemux/gtk/ADM_userInterfaces/ADM_toolkit_gtk	avidemux/qt4/ADM_userInterfaces/ADM_dialog	avidemux_core/ADM_coreUI/include avidemux_core/ADM_coreUI/src
</A></li>
	<LI>Next message: <A HREF="002338.html">[Avidemux-svn-commit] r5123 - in	branches/avidemux_2.5_branch_gruntster: .	plugins/ADM_videoFilters/AvisynthResize/qt4	plugins/ADM_videoFilters/CNR2/qt4 plugins/ADM_videoFilters/MPDelogo	plugins/ADM_videoFilters/MplayerResize/qt4	plugins/ADM_videoFilters/colorYUV
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2337">[ date ]</a>
              <a href="thread.html#2337">[ thread ]</a>
              <a href="subject.html#2337">[ subject ]</a>
              <a href="author.html#2337">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
