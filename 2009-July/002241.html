<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r5026 - in	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid:	. gtk qt4
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2009-July/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5026%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid%3A%0A%09.%20gtk%20qt4&In-Reply-To=%3C200907091105.n69B5Osl020869%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002240.html">
   <LINK REL="Next"  HREF="002242.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r5026 - in	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid:	. gtk qt4</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r5026%20-%20in%0A%09branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid%3A%0A%09.%20gtk%20qt4&In-Reply-To=%3C200907091105.n69B5Osl020869%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r5026 - in	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid:	. gtk qt4">gruntster at mail.berlios.de
       </A><BR>
    <I>Thu Jul  9 13:05:24 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002240.html">[Avidemux-svn-commit] r5025 -	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264
</A></li>
        <LI>Next message: <A HREF="002242.html">[Avidemux-svn-commit] r5027 - in	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder:	ADM_vidEnc_avcodec ADM_vidEnc_xvid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2241">[ date ]</a>
              <a href="thread.html#2241">[ thread ]</a>
              <a href="subject.html#2241">[ subject ]</a>
              <a href="author.html#2241">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2009-07-09 12:48:18 +0200 (Thu, 09 Jul 2009)
New Revision: 5026

Added:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/xvidOptions.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/xvidOptions.h
Removed:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/presetOptions.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/presetOptions.h
Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/CMakeLists.txt
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/configGuiLoader.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/interface.c
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.h
Log:
[xvid] use generic options class

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/CMakeLists.txt	2009-07-09 10:41:55 UTC (rev 5025)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/CMakeLists.txt	2009-07-09 10:48:18 UTC (rev 5026)
@@ -7,14 +7,17 @@
 	checkLibxml2()
 
 	IF (LIBXML2_FOUND)
-		INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR} ${XVID_INCLUDE_DIR} ${LIBXML2_INCLUDE_DIR})
-		ADD_DEFINITIONS(${LIBXML2_DEFINITIONS})
-
 		SET(QT_PLUGIN_NAME &quot;ADM_vidEnc_Xvid_Qt&quot;)
 		SET(GTK_PLUGIN_NAME &quot;ADM_vidEnc_Xvid_Gtk&quot;)
 		SET(PLUGIN_SUBDIR &quot;xvid&quot;)
-		SET(ADM_vidEnc_xvid_SRCS interface.c  encoder.cpp  options.cpp  configGuiLoader.cpp  presetOptions.cpp)
 
+		INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR} ${XVID_INCLUDE_DIR} ${LIBXML2_INCLUDE_DIR} ../common)
+		ADD_DEFINITIONS(${LIBXML2_DEFINITIONS})
+		ADD_DEFINITIONS(-DPLUGIN_SUBDIR=&quot;${PLUGIN_SUBDIR}&quot;)
+
+		SET(ADM_vidEnc_xvid_SRCS interface.c  encoder.cpp  xvidOptions.cpp  configGuiLoader.cpp
+								 ../common/PluginOptions.cpp)
+
 		CONFIGURE_FILE(&quot;${CMAKE_CURRENT_SOURCE_DIR}/config.h.cmake&quot; &quot;${CMAKE_CURRENT_BINARY_DIR}/config.h&quot;)
 
 		ADD_SUBDIRECTORY(gtk)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/configGuiLoader.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/configGuiLoader.h	2009-07-09 10:41:55 UTC (rev 5025)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/configGuiLoader.h	2009-07-09 10:48:18 UTC (rev 5026)
@@ -2,7 +2,7 @@
 #define configGuiLoader_h
 
 #include &quot;ADM_dynamicLoading.h&quot;
-#include &quot;options.h&quot;
+#include &quot;xvidOptions.h&quot;
 
 extern &quot;C&quot;
 {

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp	2009-07-09 10:41:55 UTC (rev 5025)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/encoder.cpp	2009-07-09 10:48:18 UTC (rev 5026)
@@ -20,7 +20,7 @@
 #include &quot;ADM_inttype.h&quot;
 #include &quot;ADM_files.h&quot;
 #include &quot;encoder.h&quot;
-#include &quot;options.h&quot;
+#include &quot;xvidOptions.h&quot;
 
 int avidemuxHook(void *handle, int opt, void *param1, void *param2);
 static XvidEncoder encoder;
@@ -161,7 +161,7 @@
 
 int XvidEncoder::getOptions(vidEncOptions *encodeOptions, char *pluginOptions, int bufferSize)
 {
-	char* xml = _options.toXml();
+	char* xml = _options.toXml(PLUGIN_XML_INTERNAL);
 	int xmlLength = strlen(xml);
 
 	if (bufferSize &gt;= xmlLength)
@@ -185,8 +185,12 @@
 	bool success = true;
 
 	if (pluginOptions)
-		success = _options.fromXml(pluginOptions);
+	{
+		success = _options.fromXml(pluginOptions, PLUGIN_XML_INTERNAL);
 
+		_options.loadPresetConfiguration();
+	}
+
 	if (encodeOptions &amp;&amp; success)
 	{
 		memcpy(&amp;_encodeOptions, encodeOptions, sizeof(vidEncOptions));

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp	2009-07-09 10:41:55 UTC (rev 5025)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/gtk/xvidConfigDialog.cpp	2009-07-09 10:48:18 UTC (rev 5026)
@@ -30,7 +30,7 @@
 #include &quot;DIA_fileSel.h&quot;
 #include &quot;DIA_coreToolkit.h&quot;
 
-#include &quot;../presetOptions.h&quot;
+#include &quot;../xvidOptions.h&quot;
 #include &quot;xvidConfigDialog.h&quot;
 
 #define WID(x) lookup_widget(dialog, #x)

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/interface.c
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/interface.c	2009-07-09 10:41:55 UTC (rev 5025)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/interface.c	2009-07-09 10:48:18 UTC (rev 5026)
@@ -66,7 +66,7 @@
 {
 	*major = 1;
 	*minor = 0;
-	*patch = 0;
+	*patch = 1;
 }
 
 const char* vidEncGetEncoderGuid(int encoderId)

Deleted: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-07-09 10:41:55 UTC (rev 5025)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-07-09 10:48:18 UTC (rev 5026)
@@ -1,1367 +0,0 @@
- /***************************************************************************
-                               XvidOptions.cpp
-
-	These settings are intended for scripting and can contain a Preset 
-	Configuration block.  If this block exists then &quot;internal&quot; settings are
-	ignored and an external configuration file should be read instead, 
-	e.g. PlayStation Portable profile.  However, if the external file is 
-	missing, internal settings have to be used and will reflect a snapshot
-	of the external configuration file at the time the script was generated.
-
-    begin                : Fri Jun 13 2008
-    copyright            : (C) 2008 by gruntster
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &lt;libxml/parser.h&gt;
-#include &lt;libxml/xmlschemas.h&gt;
-#include &lt;sstream&gt;
-#include &lt;string&gt;
-
-#include &quot;config.h&quot;
-#include &quot;ADM_inttype.h&quot;
-#include &quot;ADM_files.h&quot;
-#include &quot;options.h&quot;
-
-XvidOptions::XvidOptions(void)
-{
-	_configurationName = NULL;
-
-	reset();
-}
-
-XvidOptions::~XvidOptions(void)
-{
-	cleanUp();
-}
-
-void XvidOptions::cleanUp(void)
-{
-	if (_configurationName)
-	{
-		free(_configurationName);
-		_configurationName = NULL;
-	}
-}
-
-void XvidOptions::reset(void)
-{
-	cleanUp();
-
-	memset(&amp;xvid_enc_create, 0, sizeof(xvid_enc_create_t));
-	memset(&amp;xvid_enc_frame, 0, sizeof(xvid_enc_frame_t));
-	memset(&amp;xvid_plugin_single, 0, sizeof(xvid_plugin_single_t));
-	memset(&amp;xvid_plugin_2pass2, 0, sizeof(xvid_plugin_2pass2_t));
-	memset(&amp;_intraMatrix, 8, sizeof(unsigned char) * 64);
-	memset(&amp;_interMatrix, 1, sizeof(unsigned char) * 64);
-
-	xvid_enc_create.version = XVID_VERSION;
-	xvid_enc_frame.version = XVID_VERSION;
-	xvid_plugin_single.version = XVID_VERSION;
-	xvid_plugin_2pass2.version = XVID_VERSION;
-
-	xvid_enc_frame.vop_flags = XVID_VOP_HALFPEL | XVID_VOP_HQACPRED;
-
-	setPar(1, 1);
-	setParAsInput(false);
-	setCqmPreset(CQM_H263);
-	setMotionEstimation(ME_LOW);
-	setRateDistortion(RD_DCT_ME);
-	setMinQuantiser(2, 2, 2);
-	setMaxQuantiser(31, 31, 31);
-	setBframeQuantiserRatio(150);
-	setBframeQuantiserOffset(100);
-	setOverflowControlStrength(5);
-	setMaxOverflowImprovement(5);
-	setMaxOverflowDegradation(5);
-
-	setPresetConfiguration(&quot;&lt;default&gt;&quot;, CONFIG_DEFAULT);
-}
-
-void XvidOptions::getParameters(xvid_enc_create_t **xvid_enc_create, xvid_enc_frame_t **xvid_enc_frame,
-	xvid_plugin_single_t **xvid_plugin_single, xvid_plugin_2pass2_t **xvid_plugin_2pass2)
-{
-	*xvid_enc_create = new xvid_enc_create_t;
-	*xvid_enc_frame = new xvid_enc_frame_t;
-	*xvid_plugin_single = new xvid_plugin_single_t;
-	*xvid_plugin_2pass2 = new xvid_plugin_2pass2_t;
-
-	memcpy(*xvid_enc_create, &amp;this-&gt;xvid_enc_create, sizeof(xvid_enc_create_t));
-	memcpy(*xvid_enc_frame, &amp;this-&gt;xvid_enc_frame, sizeof(xvid_enc_frame_t));
-	memcpy(*xvid_plugin_single, &amp;this-&gt;xvid_plugin_single, sizeof(xvid_plugin_single_t));
-	memcpy(*xvid_plugin_2pass2, &amp;this-&gt;xvid_plugin_2pass2, sizeof(xvid_plugin_2pass2_t));
-
-	if (getCqmPreset() == CQM_CUSTOM)
-	{
-		(*xvid_enc_frame)-&gt;quant_intra_matrix = new unsigned char[64];
-		(*xvid_enc_frame)-&gt;quant_inter_matrix = new unsigned char[64];
-
-		getIntraMatrix((*xvid_enc_frame)-&gt;quant_intra_matrix);
-		getInterMatrix((*xvid_enc_frame)-&gt;quant_inter_matrix);
-	}
-}
-
-void XvidOptions::getPresetConfiguration(char** configurationName, ConfigType *configurationType)
-{
-	if (_configurationName)
-		*configurationName = strdup(_configurationName);
-	else
-		*configurationName = NULL;
-
-	*configurationType = _configurationType;
-}
-
-void XvidOptions::setPresetConfiguration(const char* configurationName, ConfigType configurationType)
-{
-	clearPresetConfiguration();
-
-	_configurationName = strdup(configurationName);
-	_configurationType = configurationType;
-}
-
-void XvidOptions::clearPresetConfiguration(void)
-{
-	if (_configurationName)
-		free(_configurationName);
-
-	_configurationName = strdup(&quot;&lt;custom&gt;&quot;);
-	_configurationType = CONFIG_CUSTOM;
-}
-
-unsigned int XvidOptions::getThreads(void)
-{
-	return xvid_enc_create.num_threads;
-}
-
-void XvidOptions::setThreads(unsigned int threads)
-{
-	xvid_enc_create.num_threads = threads;
-}
-
-bool XvidOptions::getParAsInput(void)
-{
-	return _parAsInput;
-}
-
-void XvidOptions::setParAsInput(bool parAsInput)
-{
-	_parAsInput = parAsInput;
-}
-
-void XvidOptions::getPar(unsigned int *width, unsigned int *height)
-{
-	*width = xvid_enc_frame.par_width;
-	*height = xvid_enc_frame.par_height;
-}
-
-void XvidOptions::setPar(unsigned int width, unsigned int height)
-{
-	if (width &gt; 0)
-		xvid_enc_frame.par_width = width;
-
-	if (height &gt; 0)
-		xvid_enc_frame.par_height = height;
-
-	if (xvid_enc_frame.par_width == xvid_enc_frame.par_height)
-		xvid_enc_frame.par = XVID_PAR_11_VGA;
-	else
-		xvid_enc_frame.par = XVID_PAR_EXT;
-}
-
-MotionEstimationMode XvidOptions::getMotionEstimation(void)
-{
-	MotionEstimationMode motionEstimation = ME_NONE;
-
-	if ((xvid_enc_frame.motion &amp; ME_HIGH) == ME_HIGH)
-		motionEstimation = ME_HIGH;
-	else if ((xvid_enc_frame.motion &amp; ME_MEDIUM) == ME_MEDIUM)
-		motionEstimation = ME_MEDIUM;
-	else if ((xvid_enc_frame.motion &amp; ME_LOW) == ME_LOW)
-		motionEstimation = ME_LOW;
-
-	return motionEstimation;
-}
-
-void XvidOptions::setMotionEstimation(MotionEstimationMode motionEstimation)
-{
-	if (motionEstimation == ME_NONE || motionEstimation == ME_LOW || motionEstimation == ME_MEDIUM || motionEstimation == ME_HIGH)
-	{
-		xvid_enc_frame.motion &amp;= ~ME_NONE;
-		xvid_enc_frame.motion &amp;= ~ME_LOW;
-		xvid_enc_frame.motion &amp;= ~ME_MEDIUM;
-		xvid_enc_frame.motion &amp;= ~ME_HIGH;
-		xvid_enc_frame.motion |= motionEstimation;
-
-		if (motionEstimation == ME_NONE)
-			xvid_enc_frame.type = XVID_TYPE_IVOP;
-		else
-			xvid_enc_frame.type = XVID_TYPE_AUTO;
-	}
-}
-
-RateDistortionMode XvidOptions::getRateDistortion(void)
-{
-	RateDistortionMode rateDistortion = RD_NONE;
-
-	if ((xvid_enc_frame.motion &amp; RD_SQUARE) == RD_SQUARE)
-		rateDistortion = RD_SQUARE;
-	else if ((xvid_enc_frame.motion &amp; RD_HPEL_QPEL_8) == RD_HPEL_QPEL_8)
-		rateDistortion = RD_HPEL_QPEL_8;
-	else if ((xvid_enc_frame.motion &amp; RD_HPEL_QPEL_16) == RD_HPEL_QPEL_16)
-		rateDistortion = RD_HPEL_QPEL_16;
-	else if ((xvid_enc_frame.vop_flags &amp; XVID_VOP_MODEDECISION_RD) == XVID_VOP_MODEDECISION_RD)
-		rateDistortion = RD_DCT_ME;
-
-	return rateDistortion;
-}
-
-void XvidOptions::setRateDistortion(RateDistortionMode rateDistortion)
-{
-	if (rateDistortion == RD_NONE || rateDistortion == RD_DCT_ME || rateDistortion == RD_HPEL_QPEL_16 || 
-		rateDistortion == RD_HPEL_QPEL_8 || rateDistortion == RD_SQUARE)
-	{
-		xvid_enc_frame.motion &amp;= ~RD_HPEL_QPEL_16;
-		xvid_enc_frame.motion &amp;= ~RD_HPEL_QPEL_8;
-		xvid_enc_frame.motion &amp;= ~RD_SQUARE;
-
-		if (rateDistortion == RD_NONE)
-			xvid_enc_frame.vop_flags &amp;= ~XVID_VOP_MODEDECISION_RD;
-		else
-		{
-			if (rateDistortion != RD_DCT_ME)
-				xvid_enc_frame.motion |= rateDistortion;
-
-			xvid_enc_frame.vop_flags |= XVID_VOP_MODEDECISION_RD;
-		}
-	}
-}
-
-bool XvidOptions::getBframeRdo(void)
-{
-	return xvid_enc_frame.vop_flags &amp; XVID_VOP_RD_BVOP;
-}
-
-void XvidOptions::setBframeRdo(bool bFrameRdo)
-{
-	if (bFrameRdo)
-		xvid_enc_frame.vop_flags |= XVID_VOP_RD_BVOP;
-	else
-		xvid_enc_frame.vop_flags &amp;= ~XVID_VOP_RD_BVOP;
-}
-
-bool XvidOptions::getChromaMotionEstimation(void)
-{
-	return xvid_enc_frame.motion &amp; CHROMA_ME;
-}
-
-void XvidOptions::setChromaMotionEstimation(bool chromaMotionEstimation)
-{
-	if (chromaMotionEstimation)
-		xvid_enc_frame.motion |= CHROMA_ME;
-	else
-		xvid_enc_frame.motion &amp;= ~CHROMA_ME;
-}
-
-bool XvidOptions::getQpel(void)
-{
-	return xvid_enc_frame.vol_flags &amp; XVID_VOL_QUARTERPEL;
-}
-
-void XvidOptions::setQpel(bool qpel)
-{
-	if (qpel)
-	{
-		xvid_enc_frame.vol_flags |= XVID_VOL_QUARTERPEL;
-		xvid_enc_frame.motion |= XVID_ME_QUARTERPELREFINE16;
-
-		if (getInterMotionVector())
-			xvid_enc_frame.motion |= XVID_ME_QUARTERPELREFINE8;
-	}
-	else
-	{
-		xvid_enc_frame.vol_flags &amp;= ~XVID_VOL_QUARTERPEL;
-		xvid_enc_frame.motion &amp;= ~XVID_ME_QUARTERPELREFINE16;
-		xvid_enc_frame.motion &amp;= ~XVID_ME_QUARTERPELREFINE8;
-	}
-}
-
-bool XvidOptions::getGmc(void)
-{
-	return xvid_enc_frame.vol_flags &amp; XVID_VOL_GMC;
-}
-
-void XvidOptions::setGmc(bool gmc)
-{
-	if (gmc)
-	{
-		xvid_enc_frame.vol_flags |= XVID_VOL_GMC;
-		xvid_enc_frame.motion |= XVID_ME_GME_REFINE;
-	}
-	else
-	{
-		xvid_enc_frame.vol_flags &amp;= ~XVID_VOL_GMC;
-		xvid_enc_frame.motion &amp;= ~XVID_ME_GME_REFINE;
-	}
-}
-
-bool XvidOptions::getTurboMode(void)
-{
-	return xvid_enc_frame.motion &amp; TURBO_MODE;
-}
-
-void XvidOptions::setTurboMode(bool turboMode)
-{
-	if (turboMode)
-		xvid_enc_frame.motion |= TURBO_MODE;
-	else
-		xvid_enc_frame.motion &amp;= ~TURBO_MODE;
-}
-
-bool XvidOptions::getChromaOptimisation(void)
-{
-	return xvid_enc_frame.vop_flags &amp; XVID_VOP_CHROMAOPT;
-}
-
-void XvidOptions::setChromaOptimisation(bool chromaOptimisation)
-{
-	if (chromaOptimisation)
-		xvid_enc_frame.vop_flags |= XVID_VOP_CHROMAOPT;
-	else
-		xvid_enc_frame.vop_flags &amp;= ~XVID_VOP_CHROMAOPT;
-}
-
-bool XvidOptions::getInterMotionVector(void)
-{
-	return xvid_enc_frame.vop_flags &amp; XVID_VOP_INTER4V;
-}
-
-void XvidOptions::setInterMotionVector(bool interMotionVector)
-{
-	if (interMotionVector)
-	{
-		xvid_enc_frame.vop_flags |= XVID_VOP_INTER4V;
-
-		if (getQpel())
-			setQpel(true);
-	}
-	else
-		xvid_enc_frame.vop_flags &amp;= ~XVID_VOP_INTER4V;
-}
-
-bool XvidOptions::getCartoon(void)
-{
-	return xvid_enc_frame.vop_flags &amp; XVID_VOP_CARTOON;
-}
-
-void XvidOptions::setCartoon(bool cartoon)
-{
-	if (cartoon)
-		xvid_enc_frame.vop_flags |= XVID_VOP_CARTOON;
-	else
-		xvid_enc_frame.vop_flags &amp;= ~XVID_VOP_CARTOON;
-}
-
-bool XvidOptions::getGreyscale(void)
-{
-	return xvid_enc_frame.vop_flags &amp; XVID_VOP_GREYSCALE;
-}
-
-void XvidOptions::setGreyscale(bool greyscale)
-{
-	if (greyscale)
-		xvid_enc_frame.vop_flags |= XVID_VOP_GREYSCALE;
-	else
-		xvid_enc_frame.vop_flags &amp;= ~XVID_VOP_GREYSCALE;
-}
-
-InterlacedMode XvidOptions::getInterlaced(void)
-{
-	InterlacedMode interlaced = INTERLACED_NONE;
-
-	if (xvid_enc_frame.vop_flags &amp; XVID_VOP_TOPFIELDFIRST)
-		interlaced = INTERLACED_TFF;
-	else if (xvid_enc_frame.vol_flags &amp; XVID_VOL_INTERLACING)
-		interlaced = INTERLACED_BFF;
-
-	return interlaced;
-}
-
-void XvidOptions::setInterlaced(InterlacedMode interlaced)
-{
-	if (interlaced == INTERLACED_NONE)
-	{
-		xvid_enc_frame.vol_flags &amp;= ~XVID_VOL_INTERLACING;
-		xvid_enc_frame.vop_flags &amp;= ~XVID_VOP_TOPFIELDFIRST;
-	}
-	else if (interlaced == INTERLACED_BFF || interlaced == INTERLACED_TFF)
-	{
-		xvid_enc_frame.vol_flags |= XVID_VOL_INTERLACING;
-
-		if (interlaced == INTERLACED_TFF)
-			xvid_enc_frame.vop_flags |= XVID_VOP_TOPFIELDFIRST;
-		else
-			xvid_enc_frame.vop_flags &amp;= ~XVID_VOP_TOPFIELDFIRST;
-	}
-}
-
-unsigned int XvidOptions::getFrameDropRatio(void)
-{
-	return xvid_enc_create.frame_drop_ratio;
-}
-
-void XvidOptions::setFrameDropRatio(unsigned int frameDropRatio)
-{
-	if (frameDropRatio &lt;= 100)
-		xvid_enc_create.frame_drop_ratio = frameDropRatio;
-}
-
-unsigned int XvidOptions::getMaxKeyInterval(void)
-{
-	return xvid_enc_create.max_key_interval;
-}
-
-void XvidOptions::setMaxKeyInterval(unsigned int maxKeyInterval)
-{
-	xvid_enc_create.max_key_interval = maxKeyInterval;
-}
-
-unsigned int XvidOptions::getMaxBframes(void)
-{
-	return xvid_enc_create.max_bframes;
-}
-
-void XvidOptions::setMaxBframes(unsigned int maxBframes)
-{
-	if (maxBframes &lt;= 20)
-		xvid_enc_create.max_bframes = maxBframes;
-}
-
-int XvidOptions::getBframeSensitivity(void)
-{
-	return xvid_enc_frame.bframe_threshold;
-}
-
-void XvidOptions::setBframeSensitivity(int bFrameSensitivity)
-{
-	if (bFrameSensitivity &gt;= -255 &amp;&amp; bFrameSensitivity &lt;= 255)
-		xvid_enc_frame.bframe_threshold = bFrameSensitivity;
-}
-
-bool XvidOptions::getClosedGop(void)
-{
-	return xvid_enc_create.global &amp; XVID_GLOBAL_CLOSED_GOP;
-}
-
-void XvidOptions::setClosedGop(bool closedGop)
-{
-	if (closedGop)
-		xvid_enc_create.global |= XVID_GLOBAL_CLOSED_GOP;
-	else
-		xvid_enc_create.global &amp;= ~XVID_GLOBAL_CLOSED_GOP;
-}
-
-bool XvidOptions::getPacked(void)
-{
-	return xvid_enc_create.global &amp; XVID_GLOBAL_PACKED;
-}
-
-void XvidOptions::setPacked(bool packed)
-{
-	if (packed)
-		xvid_enc_create.global |= XVID_GLOBAL_PACKED;
-	else
-		xvid_enc_create.global &amp;= ~XVID_GLOBAL_PACKED;
-}
-
-void XvidOptions::getMinQuantiser(unsigned int *i, unsigned int *p, unsigned int *b)
-{
-	*i = xvid_enc_create.min_quant[0];
-	*p = xvid_enc_create.min_quant[1];
-	*b = xvid_enc_create.min_quant[2];
-}
-
-void XvidOptions::setMinQuantiser(unsigned int i, unsigned int p, unsigned int b)
-{
-	if (i &gt; 0 &amp;&amp; i &lt;= 31)
-		xvid_enc_create.min_quant[0] = i;
-
-	if (p &gt; 0 &amp;&amp; p &lt;= 31)
-		xvid_enc_create.min_quant[1] = p;
-
-	if (b &gt; 0 &amp;&amp; b &lt;= 31)
-		xvid_enc_create.min_quant[2] = b;
-}
-
-void XvidOptions::getMaxQuantiser(unsigned int *i, unsigned int *p, unsigned int *b)
-{
-	*i = xvid_enc_create.max_quant[0];
-	*p = xvid_enc_create.max_quant[1];
-	*b = xvid_enc_create.max_quant[2];
-}
-
-void XvidOptions::setMaxQuantiser(unsigned int i, unsigned int p, unsigned int b)
-{
-	if (i &gt; 0 &amp;&amp; i &lt;= 31)
-		xvid_enc_create.max_quant[0] = i;
-
-	if (p &gt; 0 &amp;&amp; p &lt;= 31)
-		xvid_enc_create.max_quant[1] = p;
-
-	if (b &gt; 0 &amp;&amp; b &lt;= 31)
-		xvid_enc_create.max_quant[2] = b;
-}
-
-unsigned int XvidOptions::getBframeQuantiserRatio(void)
-{
-	return xvid_enc_create.bquant_ratio;
-}
-
-void XvidOptions::setBframeQuantiserRatio(unsigned int ratio)
-{
-	if (ratio &lt;= 200)
-		xvid_enc_create.bquant_ratio = ratio;
-}
-
-unsigned int XvidOptions::getBframeQuantiserOffset(void)
-{
-	return xvid_enc_create.bquant_offset;
-}
-
-void XvidOptions::setBframeQuantiserOffset(unsigned int offset)
-{
-	if (offset &lt;= 200)
-		xvid_enc_create.bquant_offset = offset;
-}
-
-CqmPresetMode XvidOptions::getCqmPreset(void)
-{
-	return _cqmPreset;
-}
-
-void XvidOptions::setCqmPreset(CqmPresetMode cqmPreset)
-{
-	if (cqmPreset == CQM_H263 || cqmPreset == CQM_MPEG || cqmPreset == CQM_CUSTOM)
-	{
-		_cqmPreset = cqmPreset;
-
-		switch (cqmPreset)
-		{
-			case CQM_MPEG:
-			case CQM_CUSTOM:
-				xvid_enc_frame.vol_flags |= XVID_VOL_MPEGQUANT;
-				break;
-			default:
-				xvid_enc_frame.vol_flags &amp;= ~XVID_VOL_MPEGQUANT;
-		}
-	}
-}
-
-void XvidOptions::getIntraMatrix(unsigned char intra[64])
-{
-	memcpy(intra, _intraMatrix, 64 * sizeof(unsigned char));
-}
-
-void XvidOptions::setIntraMatrix(unsigned char intra[64])
-{
-	memcpy(_intraMatrix, intra, 64 * sizeof(unsigned char));
-}
-
-void XvidOptions::getInterMatrix(unsigned char inter[64])
-{
-	memcpy(inter, _interMatrix, 64 * sizeof(unsigned char));
-}
-
-void XvidOptions::setInterMatrix(unsigned char inter[64])
-{
-	memcpy(_interMatrix, inter, 64 * sizeof(unsigned char));
-}
-
-bool XvidOptions::getTrellis(void)
-{
-	return xvid_enc_frame.vop_flags &amp; XVID_VOP_TRELLISQUANT;
-}
-
-void XvidOptions::setTrellis(bool trellis)
-{
-	if (trellis)
-		xvid_enc_frame.vop_flags |= XVID_VOP_TRELLISQUANT;
-	else
-		xvid_enc_frame.vop_flags &amp;= ~XVID_VOP_TRELLISQUANT;
-}
-
-unsigned int XvidOptions::getReactionDelayFactor(void)
-{
-	return xvid_plugin_single.reaction_delay_factor;
-}
-
-void XvidOptions::setReactionDelayFactor(unsigned int delayFactor)
-{
-	if (delayFactor &lt;= 100)
-		xvid_plugin_single.reaction_delay_factor = delayFactor;
-}
-
-unsigned int XvidOptions::getAveragingQuantiserPeriod(void)
-{
-	return xvid_plugin_single.averaging_period;
-}
-
-void XvidOptions::setAveragingQuantiserPeriod(unsigned int averagingPeriod)
-{
-	xvid_plugin_single.averaging_period = averagingPeriod;
-}
-
-unsigned int XvidOptions::getSmoother(void)
-{
-	return xvid_plugin_single.buffer;
-}
-
-void XvidOptions::setSmoother(unsigned int smoother)
-{
-	xvid_plugin_single.buffer = smoother;
-}
-
-unsigned int XvidOptions::getKeyFrameBoost(void)
-{
-	return xvid_plugin_2pass2.keyframe_boost;
-}
-
-void XvidOptions::setKeyFrameBoost(unsigned int keyFrameBoost)
-{
-	if (keyFrameBoost &lt;= 100)
-		xvid_plugin_2pass2.keyframe_boost = keyFrameBoost;
-}
-
-unsigned int XvidOptions::getMaxKeyFrameReduceBitrate(void)
-{
-	return xvid_plugin_2pass2.kfreduction;
-}
-
-void XvidOptions::setMaxKeyFrameReduceBitrate(unsigned int bitrateReduction)
-{
-	if (bitrateReduction &lt;= 100)
-		xvid_plugin_2pass2.kfreduction = bitrateReduction;
-}
-
-unsigned int XvidOptions::getKeyFrameBitrateThreshold(void)
-{
-	return xvid_plugin_2pass2.kfthreshold;
-}
-
-void XvidOptions::setKeyFrameBitrateThreshold(unsigned int bitrateThreshold)
-{
-	xvid_plugin_2pass2.kfthreshold = bitrateThreshold;
-}
-
-unsigned int XvidOptions::getOverflowControlStrength(void)
-{
-	return xvid_plugin_2pass2.overflow_control_strength;
-}
-
-void XvidOptions::setOverflowControlStrength(unsigned int overflowControlStrength)
-{
-	if (overflowControlStrength &lt;= 100)
-		xvid_plugin_2pass2.overflow_control_strength = overflowControlStrength;
-}
-
-unsigned int XvidOptions::getMaxOverflowImprovement(void)
-{
-	return xvid_plugin_2pass2.max_overflow_improvement;
-}
-
-void XvidOptions::setMaxOverflowImprovement(unsigned int overflowImprovement)
-{
-	if (overflowImprovement &lt;= 100)
-		xvid_plugin_2pass2.max_overflow_improvement = overflowImprovement;
-}
-
-unsigned int XvidOptions::getMaxOverflowDegradation(void)
-{
-	return xvid_plugin_2pass2.max_overflow_degradation;
-}
-
-void XvidOptions::setMaxOverflowDegradation(unsigned int overflowDegradation)
-{
-	if (overflowDegradation &lt;= 100)
-		xvid_plugin_2pass2.max_overflow_degradation = overflowDegradation;
-}
-
-unsigned int XvidOptions::getAboveAverageCurveCompression(void)
-{
-	return xvid_plugin_2pass2.curve_compression_high;
-}
-
-void XvidOptions::setAboveAverageCurveCompression(unsigned int curveCompression)
-{
-	if (curveCompression &lt;= 100)
-		xvid_plugin_2pass2.curve_compression_high = curveCompression;
-}
-
-unsigned int XvidOptions::getBelowAverageCurveCompression(void)
-{
-	return xvid_plugin_2pass2.curve_compression_low;
-}
-
-void XvidOptions::setBelowAverageCurveCompression(unsigned int curveCompression)
-{
-	if (curveCompression &lt;= 100)
-		xvid_plugin_2pass2.curve_compression_low = curveCompression;
-}
-
-unsigned int XvidOptions::getVbvBufferSize(void)
-{
-	return xvid_plugin_2pass2.vbv_size;
-}
-
-void XvidOptions::setVbvBufferSize(unsigned int bufferSize)
-{
-	if (bufferSize &lt;= 6291456)
-	{
-		xvid_plugin_2pass2.vbv_size = bufferSize;
-		xvid_plugin_2pass2.vbv_initial = (bufferSize * 3) &gt;&gt; 2;
-	}
-}
-
-unsigned int XvidOptions::getMaxVbvBitrate(void)
-{
-	return xvid_plugin_2pass2.vbv_maxrate;
-}
-
-void XvidOptions::setMaxVbvBitrate(unsigned int bitrate)
-{
-	if (bitrate &lt;= 9708400)
-		xvid_plugin_2pass2.vbv_maxrate = bitrate;
-}
-
-unsigned int XvidOptions::getVbvPeakBitrate(void)
-{
-	return xvid_plugin_2pass2.vbv_peakrate;
-}
-
-void XvidOptions::setVbvPeakBitrate(unsigned int peakBitrate)
-{
-	if (peakBitrate &lt;= 16000000)
-		xvid_plugin_2pass2.vbv_peakrate = peakBitrate;
-}
-
-char* XvidOptions::toXml(void)
-{
-	xmlDocPtr xmlDoc = xmlNewDoc((const xmlChar*)&quot;1.0&quot;);
-	xmlNodePtr xmlNodeRoot, xmlNodeChild;
-	const int bufferSize = 100;
-	xmlChar xmlBuffer[bufferSize + 1];
-	char *xml = NULL;
-
-	while (true)
-	{
-		if (!xmlDoc)
-			break;
-
-		if (!(xmlNodeRoot = xmlNewDocNode(xmlDoc, NULL, (xmlChar*)&quot;XvidConfig&quot;, NULL)))
-			break;
-
-		xmlDocSetRootElement(xmlDoc, xmlNodeRoot);
-
-		if (_configurationType != CONFIG_CUSTOM)
-		{
-			xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;presetConfiguration&quot;, NULL);
-
-			xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;name&quot;, (xmlChar*)_configurationName);
-
-			if (_configurationType == CONFIG_USER)
-				strcpy((char*)xmlBuffer, &quot;user&quot;);
-			else if (_configurationType == CONFIG_SYSTEM)
-				strcpy((char*)xmlBuffer, &quot;system&quot;);
-			else
-				strcpy((char*)xmlBuffer, &quot;default&quot;);
-
-			xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;type&quot;, xmlBuffer);
-		}
-
-		addXvidOptionsToXml(xmlNodeRoot);
-		xml = dumpXmlDocToMemory(xmlDoc);
-		xmlFreeDoc(xmlDoc);
-
-		break;
-	}
-
-	return xml;
-}
-
-char* XvidOptions::dumpXmlDocToMemory(xmlDocPtr xmlDoc)
-{
-	xmlChar *tempBuffer;
-	int tempBufferSize;
-	char *xml = NULL;
-
-	xmlDocDumpMemory(xmlDoc, &amp;tempBuffer, &amp;tempBufferSize);
-
-	// remove carriage returns (even though libxml was instructed not to format the XML)
-	xmlChar* bufferChar = tempBuffer;
-	int bufferCharIndex = 0;
-
-	while (*bufferChar != '\0')
-	{
-		if (*bufferChar == '\n')
-		{
-			memmove(bufferChar, bufferChar + 1, tempBufferSize - bufferCharIndex);
-			tempBufferSize--;
-		}
-		else if (*bufferChar == '\&quot;')
-			*bufferChar = '\'';
-
-		bufferChar++;
-		bufferCharIndex++;
-	}
-
-	xml = new char[tempBufferSize + 1];
-	memcpy(xml, tempBuffer, tempBufferSize);
-	xml[tempBufferSize] = 0;
-
-	return xml;
-}
-
-void XvidOptions::addXvidOptionsToXml(xmlNodePtr xmlNodeRoot)
-{
-	const int bufferSize = 100;
-	xmlChar xmlBuffer[bufferSize + 1];
-	xmlNodePtr xmlNodeChild, xmlNodeChild2;
-
-	xmlNodeRoot = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;XvidOptions&quot;, NULL);
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;threads&quot;, number2String(xmlBuffer, bufferSize, getThreads()));
-
-	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;vui&quot;, NULL);
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;sarAsInput&quot;, boolean2String(xmlBuffer, bufferSize, getParAsInput()));
-
-	unsigned int width, height;
-
-	getPar(&amp;width, &amp;height);
-
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;sarHeight&quot;, number2String(xmlBuffer, bufferSize, height));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;sarWidth&quot;, number2String(xmlBuffer, bufferSize, width));
-
-	switch (getMotionEstimation())
-	{
-		case ME_LOW:
-			strcpy((char*)xmlBuffer, &quot;low&quot;);
-			break;
-		case ME_MEDIUM:
-			strcpy((char*)xmlBuffer, &quot;medium&quot;);
-			break;
-		case ME_HIGH:
-			strcpy((char*)xmlBuffer, &quot;high&quot;);
-			break;
-		default:
-			strcpy((char*)xmlBuffer, &quot;none&quot;);
-			break;
-	}
-
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;motionEstimation&quot;, xmlBuffer);
-
-	switch (getRateDistortion())
-	{
-		case RD_DCT_ME:
-			strcpy((char*)xmlBuffer, &quot;dct&quot;);
-			break;
-		case RD_HPEL_QPEL_16:
-			strcpy((char*)xmlBuffer, &quot;hpelQpel16&quot;);
-			break;
-		case RD_HPEL_QPEL_8:
-			strcpy((char*)xmlBuffer, &quot;hpelQpel8&quot;);
-			break;
-		case RD_SQUARE:
-			strcpy((char*)xmlBuffer, &quot;square&quot;);
-			break;
-		default:
-			strcpy((char*)xmlBuffer, &quot;none&quot;);
-			break;
-	}
-
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;rdo&quot;, xmlBuffer);
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;bFrameRdo&quot;, boolean2String(xmlBuffer, bufferSize, getBframeRdo()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;chromaMotionEstimation&quot;, boolean2String(xmlBuffer, bufferSize, getChromaMotionEstimation()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;qPel&quot;, boolean2String(xmlBuffer, bufferSize, getQpel()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;gmc&quot;, boolean2String(xmlBuffer, bufferSize, getGmc()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;turboMode&quot;, boolean2String(xmlBuffer, bufferSize, getTurboMode()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;chromaOptimiser&quot;, boolean2String(xmlBuffer, bufferSize, getChromaOptimisation()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;fourMv&quot;, boolean2String(xmlBuffer, bufferSize, getInterMotionVector()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;cartoon&quot;, boolean2String(xmlBuffer, bufferSize, getCartoon()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;greyscale&quot;, boolean2String(xmlBuffer, bufferSize, getGreyscale()));
-
-	switch (getInterlaced())
-	{
-		case INTERLACED_BFF:
-			strcpy((char*)xmlBuffer, &quot;bff&quot;);
-			break;
-		case INTERLACED_TFF:
-			strcpy((char*)xmlBuffer, &quot;tff&quot;);
-			break;
-		default:
-			strcpy((char*)xmlBuffer, &quot;none&quot;);
-			break;
-	}
-
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;interlaced&quot;, xmlBuffer);
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;frameDropRatio&quot;, number2String(xmlBuffer, bufferSize, getFrameDropRatio()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;maxIframeInterval&quot;, number2String(xmlBuffer, bufferSize, getMaxKeyInterval()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;maxBframes&quot;, number2String(xmlBuffer, bufferSize, getMaxBframes()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;bFrameSensitivity&quot;, number2String(xmlBuffer, bufferSize, getBframeSensitivity()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;closedGop&quot;, boolean2String(xmlBuffer, bufferSize, getClosedGop()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;packed&quot;, boolean2String(xmlBuffer, bufferSize, getPacked()));
-
-	unsigned int minI, minP, minB;
-	unsigned int maxI, maxP, maxB;
-
-	getMinQuantiser(&amp;minI, &amp;minP, &amp;minB);
-	getMaxQuantiser(&amp;maxI, &amp;maxP, &amp;maxB);
-
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;quantImin&quot;, number2String(xmlBuffer, bufferSize, minI));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;quantPmin&quot;, number2String(xmlBuffer, bufferSize, minP));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;quantBmin&quot;, number2String(xmlBuffer, bufferSize, minB));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;quantImax&quot;, number2String(xmlBuffer, bufferSize, maxI));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;quantPmax&quot;, number2String(xmlBuffer, bufferSize, maxP));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;quantBmax&quot;, number2String(xmlBuffer, bufferSize, maxB));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;quantBratio&quot;, number2String(xmlBuffer, bufferSize, getBframeQuantiserRatio()));
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;quantBoffset&quot;, number2String(xmlBuffer, bufferSize, getBframeQuantiserOffset()));
-
-	switch (getCqmPreset())
-	{
-		case CQM_H263:
-			strcpy((char*)xmlBuffer, &quot;h.263&quot;);
-			break;
-		case CQM_MPEG:
-			strcpy((char*)xmlBuffer, &quot;mpeg&quot;);
-			break;
-		case CQM_CUSTOM:
-			strcpy((char*)xmlBuffer, &quot;custom&quot;);
-			break;
-	}
-
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;quantType&quot;, xmlBuffer);
-
-	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;intraMatrix&quot;, NULL);
-
-	for (int i = 0; i &lt; 64; i++)
-		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;value&quot;, number2String(xmlBuffer, bufferSize, _intraMatrix[i]));
-
-	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;interMatrix&quot;, NULL);
-
-	for (int i = 0; i &lt; 64; i++)
-		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;value&quot;, number2String(xmlBuffer, bufferSize, _interMatrix[i]));
-
-	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;trellis&quot;, boolean2String(xmlBuffer, bufferSize, getTrellis()));
-
-	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;singlePass&quot;, NULL);
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;reactionDelayFactor&quot;, number2String(xmlBuffer, bufferSize, getReactionDelayFactor()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;averagingQuantiserPeriod&quot;, number2String(xmlBuffer, bufferSize, getAveragingQuantiserPeriod()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;smoother&quot;, number2String(xmlBuffer, bufferSize, getSmoother()));
-
-	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;twoPass&quot;, NULL);
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;keyFrameBoost&quot;, number2String(xmlBuffer, bufferSize, getKeyFrameBoost()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;maxKeyFrameReduceBitrate&quot;, number2String(xmlBuffer, bufferSize, getMaxKeyFrameReduceBitrate()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;keyFrameBitrateThreshold&quot;, number2String(xmlBuffer, bufferSize, getKeyFrameBitrateThreshold()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;overflowControlStrength&quot;, number2String(xmlBuffer, bufferSize, getOverflowControlStrength()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;maxOverflowImprovement&quot;, number2String(xmlBuffer, bufferSize, getMaxOverflowImprovement()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;maxOverflowDegradation&quot;, number2String(xmlBuffer, bufferSize, getMaxOverflowDegradation()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;aboveAverageCurveCompression&quot;, number2String(xmlBuffer, bufferSize, getAboveAverageCurveCompression()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;belowAverageCurveCompression&quot;, number2String(xmlBuffer, bufferSize, getBelowAverageCurveCompression()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;vbvBufferSize&quot;, number2String(xmlBuffer, bufferSize, getVbvBufferSize()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;maxVbvBitrate&quot;, number2String(xmlBuffer, bufferSize, getMaxVbvBitrate()));
-	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;vbvPeakBitrate&quot;, number2String(xmlBuffer, bufferSize, getVbvPeakBitrate()));
-}
-
-bool XvidOptions::validateXml(xmlDocPtr doc)
-{
-	const char *schemaFile = &quot;XvidParam.xsd&quot;;
-	char *pluginDir = ADM_getPluginPath();
-	char schemaPath[strlen(pluginDir) + strlen(PLUGIN_SUBDIR) + 1 + strlen(schemaFile) + 1];
-	bool success = false;
-
-	strcpy(schemaPath, pluginDir);
-	strcat(schemaPath, PLUGIN_SUBDIR);
-	strcat(schemaPath, &quot;/&quot;);
-	strcat(schemaPath, schemaFile);
-	delete [] pluginDir;
-
-	xmlSchemaParserCtxtPtr xmlSchemaParserCtxt = xmlSchemaNewParserCtxt(schemaPath);
-	xmlSchemaPtr xmlSchema = xmlSchemaParse(xmlSchemaParserCtxt);
-
- 	xmlSchemaFreeParserCtxt(xmlSchemaParserCtxt);
-
- 	xmlSchemaValidCtxtPtr xmlSchemaValidCtxt = xmlSchemaNewValidCtxt(xmlSchema);
-
- 	if (xmlSchemaValidCtxt)
-	{
- 		success = !xmlSchemaValidateDoc(xmlSchemaValidCtxt, doc);
-	 	xmlSchemaFree(xmlSchema);
-		xmlSchemaFreeValidCtxt(xmlSchemaValidCtxt);
- 	}
-	else
- 		xmlSchemaFree(xmlSchema);
-
-	return success;
-}
-
-int XvidOptions::fromXml(const char *xml)
-{
-	bool success = false;
-
-	clearPresetConfiguration();
-
-	xmlDocPtr doc = xmlReadMemory(xml, strlen(xml), &quot;Xvid.xml&quot;, NULL, 0);
-
-	if (success = validateXml(doc))
-	{
-		xmlNode *xmlNodeRoot = xmlDocGetRootElement(doc);
-
-		for (xmlNode *xmlChild = xmlNodeRoot-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
-		{
-			if (xmlChild-&gt;type == XML_ELEMENT_NODE)
-			{
-				char *content = (char*)xmlNodeGetContent(xmlChild);
-
-				if (strcmp((char*)xmlChild-&gt;name, &quot;presetConfiguration&quot;) == 0)
-					parsePresetConfiguration(xmlChild);
-				else if (strcmp((char*)xmlChild-&gt;name, &quot;XvidOptions&quot;) == 0)
-					parseXvidOptions(xmlChild);
-
-				xmlFree(content);
-			}
-		}
-	}
-
-	xmlFreeDoc(doc);
-
-	return success;
-}
-
-void XvidOptions::parsePresetConfiguration(xmlNode *node)
-{
-	char* name = NULL;
-	ConfigType type = CONFIG_CUSTOM;
-
-	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
-	{
-		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
-		{
-			char *content = (char*)xmlNodeGetContent(xmlChild);
-
-			if (strcmp((char*)xmlChild-&gt;name, &quot;name&quot;) == 0)
-				name = strdup((char*)content);
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;type&quot;) == 0)
-			{
-				if (strcmp(content, &quot;user&quot;) == 0)
-					type = CONFIG_USER;
-				else if (strcmp(content, &quot;system&quot;) == 0)
-					type = CONFIG_SYSTEM;
-				else
-					type = CONFIG_DEFAULT;
-			}
-
-			xmlFree(content);
-		}
-	}
-
-	setPresetConfiguration(name, type);
-	free(name);
-}
-
-void XvidOptions::parseXvidOptions(xmlNode *node)
-{
-	int minI = -1, minP = -1, minB = -1;
-	int maxI = -1, maxP = -1, maxB = -1;
-
-	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
-	{
-		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
-		{
-			char *content = (char*)xmlNodeGetContent(xmlChild);
-
-			if (strcmp((char*)xmlChild-&gt;name, &quot;threads&quot;) == 0)
-				setThreads(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;vui&quot;) == 0)
-				parseVuiOptions(xmlChild);
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;motionEstimation&quot;) == 0)
-			{
-				MotionEstimationMode motionEstimation = ME_NONE;
-
-				if (strcmp(content, &quot;low&quot;) == 0)
-					motionEstimation = ME_LOW;
-				else if (strcmp(content, &quot;medium&quot;) == 0)
-					motionEstimation = ME_MEDIUM;
-				else if (strcmp(content, &quot;high&quot;) == 0)
-					motionEstimation = ME_HIGH;
-
-				setMotionEstimation(motionEstimation);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;rdo&quot;) == 0)
-			{
-				RateDistortionMode rateDistortion = RD_NONE;
-
-				if (strcmp(content, &quot;dct&quot;) == 0)
-					rateDistortion = RD_DCT_ME;
-				else if (strcmp(content, &quot;hpelQpel16&quot;) == 0)
-					rateDistortion = RD_HPEL_QPEL_16;
-				else if (strcmp(content, &quot;hpelQpel8&quot;) == 0)
-					rateDistortion = RD_HPEL_QPEL_8;
-				else if (strcmp(content, &quot;square&quot;) == 0)
-					rateDistortion = RD_SQUARE;
-
-				setRateDistortion(rateDistortion);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;bFrameRdo&quot;) == 0)
-				setBframeRdo(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;chromaMotionEstimation&quot;) == 0)
-				setChromaMotionEstimation(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;qPel&quot;) == 0)
-				setQpel(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;gmc&quot;) == 0)
-				setGmc(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;turboMode&quot;) == 0)
-				setTurboMode(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;chromaOptimiser&quot;) == 0)
-				setChromaOptimisation(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;fourMv&quot;) == 0)
-				setInterMotionVector(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;cartoon&quot;) == 0)
-				setCartoon(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;greyscale&quot;) == 0)
-				setGreyscale(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;interlaced&quot;) == 0)
-			{
-				InterlacedMode interlaced = INTERLACED_NONE;
-
-				if (strcmp(content, &quot;bff&quot;) == 0)
-					interlaced = INTERLACED_BFF;
-				else if (strcmp(content, &quot;tff&quot;) == 0)
-					interlaced = INTERLACED_TFF;
-
-				setInterlaced(interlaced);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;frameDropRatio&quot;) == 0)
-				setFrameDropRatio(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;maxIframeInterval&quot;) == 0)
-				setMaxKeyInterval(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;maxBframes&quot;) == 0)
-				setMaxBframes(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;bFrameSensitivity&quot;) == 0)
-				setBframeSensitivity(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;closedGop&quot;) == 0)
-				setClosedGop(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;packed&quot;) == 0)
-				setPacked(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantImin&quot;) == 0)
-				minI = atoi(content);
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantPmin&quot;) == 0)
-				minP = atoi(content);
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantBmin&quot;) == 0)
-				minB = atoi(content);
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantImax&quot;) == 0)
-				maxI = atoi(content);
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantPmax&quot;) == 0)
-				maxP = atoi(content);
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantBmax&quot;) == 0)
-				maxB = atoi(content);
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantBratio&quot;) == 0)
-				setBframeQuantiserRatio(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantBoffset&quot;) == 0)
-				setBframeQuantiserOffset(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantType&quot;) == 0)
-			{
-				if (strcmp(content, &quot;mpeg&quot;) == 0)
-					setCqmPreset(CQM_MPEG);
-				else if (strcmp(content, &quot;custom&quot;) == 0)
-					setCqmPreset(CQM_CUSTOM);
-				else
-					setCqmPreset(CQM_H263);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;intraMatrix&quot;) == 0)
-			{
-				unsigned char intraMatrix[64];
-
-				parseCqmOption(xmlChild, intraMatrix);
-				setIntraMatrix(intraMatrix);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;interMatrix&quot;) == 0)
-			{
-				unsigned char interMatrix[64];
-
-				parseCqmOption(xmlChild, interMatrix);
-				setInterMatrix(interMatrix);
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;trellis&quot;) == 0)
-				setTrellis(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;singlePass&quot;) == 0)
-				parseSinglePassOptions(xmlChild);
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;twoPass&quot;) == 0)
-				parseTwoPassOptions(xmlChild);
-
-			xmlFree(content);
-		}
-	}
-
-	if (minI != -1 &amp;&amp; minP != -1 &amp;&amp; minB != -1)
-		setMinQuantiser(minI, minP, minB);
-
-	if (maxI != -1 &amp;&amp; maxP != -1 &amp;&amp; maxB != -1)
-		setMaxQuantiser(maxI, maxP, maxB);
-}
-
-void XvidOptions::parseVuiOptions(xmlNode *node)
-{
-	unsigned int width = 0, height = 0;
-
-	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
-	{
-		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
-		{
-			char *content = (char*)xmlNodeGetContent(xmlChild);
-
-			if (strcmp((char*)xmlChild-&gt;name, &quot;sarAsInput&quot;) == 0)
-				setParAsInput(string2Boolean(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;sarHeight&quot;) == 0)
-				height = atoi(content);
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;sarWidth&quot;) == 0)
-				width = atoi(content);
-
-			xmlFree(content);
-		}
-	}
-
-	setPar(width, height);
-}
-
-void XvidOptions::parseCqmOption(xmlNode *node, unsigned char matrix[])
-{
-	int index = 0;
-
-	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
-	{
-		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
-		{
-			char *content = (char*)xmlNodeGetContent(xmlChild);
-
-			matrix[index] = atoi(content);
-			index++;
-
-			xmlFree(content);
-		}
-	}
-}
-
-void XvidOptions::parseSinglePassOptions(xmlNode *node)
-{
-	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
-	{
-		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
-		{
-			char *content = (char*)xmlNodeGetContent(xmlChild);
-
-			if (strcmp((char*)xmlChild-&gt;name, &quot;reactionDelayFactor&quot;) == 0)
-				setReactionDelayFactor(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;averagingQuantiserPeriod&quot;) == 0)
-				setAveragingQuantiserPeriod(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;smoother&quot;) == 0)
-				setSmoother(atoi(content));
-
-			xmlFree(content);
-		}
-	}
-}
-
-void XvidOptions::parseTwoPassOptions(xmlNode *node)
-{
-	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
-	{
-		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
-		{
-			char *content = (char*)xmlNodeGetContent(xmlChild);
-
-			if (strcmp((char*)xmlChild-&gt;name, &quot;keyFrameBoost&quot;) == 0)
-				setKeyFrameBoost(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;maxKeyFrameReduceBitrate&quot;) == 0)
-				setMaxKeyFrameReduceBitrate(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;keyFrameBitrateThreshold&quot;) == 0)
-				setKeyFrameBitrateThreshold(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;overflowControlStrength&quot;) == 0)
-				setOverflowControlStrength(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;maxOverflowImprovement&quot;) == 0)
-				setMaxOverflowImprovement(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;maxOverflowDegradation&quot;) == 0)
-				setMaxOverflowDegradation(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;aboveAverageCurveCompression&quot;) == 0)
-				setAboveAverageCurveCompression(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;belowAverageCurveCompression&quot;) == 0)
-				setBelowAverageCurveCompression(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;vbvBufferSize&quot;) == 0)
-				setVbvBufferSize(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;maxVbvBitrate&quot;) == 0)
-				setMaxVbvBitrate(atoi(content));
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;vbvPeakBitrate&quot;) == 0)
-				setVbvPeakBitrate(atoi(content));
-
-			xmlFree(content);
-		}
-	}
-}
-
-xmlChar* XvidOptions::number2String(xmlChar *buffer, size_t size, int number)
-{
-	std::ostringstream stream;
-
-	stream.imbue(std::locale::classic());
-	stream &lt;&lt; number;
-	std::string string = stream.str();
-
-	strncpy((char*)buffer, string.c_str(), size);
-
-	return buffer;
-}
-
-xmlChar* XvidOptions::number2String(xmlChar *buffer, size_t size, unsigned int number)
-{
-	std::ostringstream stream;
-
-	stream.imbue(std::locale::classic());
-	stream &lt;&lt; number;
-	std::string string = stream.str();
-
-	strncpy((char*)buffer, string.c_str(), size);
-
-	return buffer;
-}
-
-xmlChar* XvidOptions::number2String(xmlChar *buffer, size_t size, float number)
-{
-	std::ostringstream stream;
-
-	stream.imbue(std::locale::classic());
-	stream &lt;&lt; number;
-	std::string string = stream.str();
-
-	strncpy((char*)buffer, string.c_str(), size);
-
-	return buffer;
-}
-
-xmlChar* XvidOptions::boolean2String(xmlChar *buffer, size_t size, bool boolean)
-{
-	if (boolean)
-		strcpy((char*)buffer, &quot;true&quot;);
-	else
-		strcpy((char*)buffer, &quot;false&quot;);
-
-	return buffer;
-}
-
-bool XvidOptions::string2Boolean(char *buffer)
-{
-	return (strcmp(buffer, &quot;true&quot;) == 0);
-}

Deleted: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-07-09 10:41:55 UTC (rev 5025)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-07-09 10:48:18 UTC (rev 5026)
@@ -1,250 +0,0 @@
-/***************************************************************************
-                                XvidOptions.h
-
-    begin                : Fri Jun 13 2008
-    copyright            : (C) 2008 by gruntster
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifndef options_h
-#define options_h
-
-#include &lt;libxml/tree.h&gt;
-#include &quot;xvid.h&quot;
-
-extern &quot;C&quot;
-{
-#include &quot;ADM_vidEnc_plugin.h&quot;
-}
-
-#define DEFAULT_ENCODE_MODE	(ADM_VIDENC_MODE_CQP)
-#define DEFAULT_ENCODE_MODE_PARAMETER (4)
-#define TURBO_MODE (XVID_ME_FASTREFINE16 | XVID_ME_FASTREFINE8 | XVID_ME_SKIP_DELTASEARCH | XVID_ME_FAST_MODEINTERPOLATE | XVID_ME_BFRAME_EARLYSTOP)
-#define CHROMA_ME (XVID_ME_CHROMA_PVOP | XVID_ME_CHROMA_BVOP)
-
-typedef enum
-{
-	CONFIG_CUSTOM,
-	CONFIG_DEFAULT,
-	CONFIG_USER,
-	CONFIG_SYSTEM
-} ConfigType;
-
-typedef enum
-{
-	ME_NONE = 0,
-	ME_LOW = XVID_ME_HALFPELREFINE16,	
-	ME_MEDIUM = XVID_ME_HALFPELREFINE16 | XVID_ME_ADVANCEDDIAMOND16,	
-	ME_HIGH = XVID_ME_HALFPELREFINE16 | XVID_ME_EXTSEARCH16 | XVID_ME_HALFPELREFINE8 | XVID_ME_USESQUARES16
-} MotionEstimationMode;
-
-typedef enum
-{
-	INTERLACED_NONE,
-	INTERLACED_BFF,
-	INTERLACED_TFF
-} InterlacedMode;
-
-typedef enum
-{
-	RD_NONE = -1,
-	RD_DCT_ME = 0,
-	RD_HPEL_QPEL_16 = RD_DCT_ME | XVID_ME_HALFPELREFINE16_RD | XVID_ME_QUARTERPELREFINE16_RD,
-	RD_HPEL_QPEL_8 = RD_HPEL_QPEL_16 | XVID_ME_HALFPELREFINE8_RD | XVID_ME_QUARTERPELREFINE8_RD | XVID_ME_CHECKPREDICTION_RD,
-	RD_SQUARE = RD_HPEL_QPEL_8 | XVID_ME_EXTSEARCH_RD
-} RateDistortionMode;
-
-typedef enum
-{
-	CQM_H263,
-	CQM_MPEG,
-	CQM_CUSTOM
-} CqmPresetMode;
-
-class XvidOptions
-{
-protected:
-	xvid_enc_create_t xvid_enc_create;
-	xvid_enc_frame_t xvid_enc_frame;
-	xvid_plugin_single_t xvid_plugin_single;
-	xvid_plugin_2pass2_t xvid_plugin_2pass2;
-
-	char* _configurationName;
-	ConfigType _configurationType;
-
-	bool _parAsInput;
-	CqmPresetMode _cqmPreset;
-	unsigned char _intraMatrix[64], _interMatrix[64];
-
-	void cleanUp(void);
-	xmlChar* number2String(xmlChar *buffer, size_t size, int number);
-	xmlChar* number2String(xmlChar *buffer, size_t size, unsigned int number);
-	xmlChar* number2String(xmlChar *buffer, size_t size, float number);
-	xmlChar* boolean2String(xmlChar *buffer, size_t size, bool boolean);
-	bool string2Boolean(char *buffer);
-
-	void addXvidOptionsToXml(xmlNodePtr xmlNodeRoot);
-	char* dumpXmlDocToMemory(xmlDocPtr xmlDoc);
-	bool validateXml(xmlDocPtr doc);
-	void parsePresetConfiguration(xmlNode *node);
-	void parseXvidOptions(xmlNode *node);
-	void parseVuiOptions(xmlNode *node);
-	void parseCqmOption(xmlNode *node, unsigned char matrix[]);
-	void parseSinglePassOptions(xmlNode *node);
-	void parseTwoPassOptions(xmlNode *node);
-
-public:
-	XvidOptions(void);
-	~XvidOptions(void);
-
-	void reset(void);
-
-	void getParameters(xvid_enc_create_t **xvid_enc_create, xvid_enc_frame_t **xvid_enc_frame,
-		xvid_plugin_single_t **xvid_plugin_single, xvid_plugin_2pass2_t **xvid_plugin_2pass2);
-
-	void getPresetConfiguration(char** configurationName, ConfigType *configurationType);
-	void setPresetConfiguration(const char* configurationName, ConfigType configurationType);
-	void clearPresetConfiguration(void);
-
-	unsigned int getThreads(void);
-	void setThreads(unsigned int threads);
-
-	bool getParAsInput(void);
-	void setParAsInput(bool parAsInput);
-
-	void getPar(unsigned int *width, unsigned int *height);
-	void setPar(unsigned int width, unsigned int height);
-
-	MotionEstimationMode getMotionEstimation(void);
-	void setMotionEstimation(MotionEstimationMode motionEstimation);
-
-	RateDistortionMode getRateDistortion(void);
-	void setRateDistortion(RateDistortionMode rateDistortion);
-
-	bool getBframeRdo(void);
-	void setBframeRdo(bool bFrameRdo);
-
-	bool getChromaMotionEstimation(void);
-	void setChromaMotionEstimation(bool chromaMotionEstimation);
-
-	bool getQpel(void);
-	void setQpel(bool qpel);
-
-	bool getGmc(void);
-	void setGmc(bool gmc);
-
-	bool getTurboMode(void);
-	void setTurboMode(bool turboMode);
-
-	bool getChromaOptimisation(void);
-	void setChromaOptimisation(bool chromaOptimisation);
-
-	bool getInterMotionVector(void);
-	void setInterMotionVector(bool interMotionVector);
-
-	bool getCartoon(void);
-	void setCartoon(bool cartoon);
-
-	bool getGreyscale(void);
-	void setGreyscale(bool greyscale);
-
-	InterlacedMode getInterlaced(void);
-	void setInterlaced(InterlacedMode interlaced);
-
-	unsigned int getFrameDropRatio(void);
-	void setFrameDropRatio(unsigned int frameDropRatio);
-
-	unsigned int getMaxKeyInterval(void);
-	void setMaxKeyInterval(unsigned int maxKeyInterval);
-
-	unsigned int getMaxBframes(void);
-	void setMaxBframes(unsigned int maxBFrames);
-
-	int getBframeSensitivity(void);
-	void setBframeSensitivity(int bFrameSensitivity);
-
-	bool getClosedGop(void);
-	void setClosedGop(bool closedGop);
-
-	bool getPacked(void);
-	void setPacked(bool packed);
-
-	void getMinQuantiser(unsigned int *i, unsigned int *p, unsigned int *b);
-	void setMinQuantiser(unsigned int i, unsigned int p, unsigned int b);
-
-	void getMaxQuantiser(unsigned int *i, unsigned int *p, unsigned int *b);
-	void setMaxQuantiser(unsigned int i, unsigned int p, unsigned int b);
-
-	unsigned int getBframeQuantiserRatio(void);
-	void setBframeQuantiserRatio(unsigned int ratio);
-
-	unsigned int getBframeQuantiserOffset(void);
-	void setBframeQuantiserOffset(unsigned int offset);
-
-	CqmPresetMode getCqmPreset(void);
-	void setCqmPreset(CqmPresetMode cqmPreset);
-
-	void getIntraMatrix(unsigned char intra[64]);
-	void setIntraMatrix(unsigned char intra[64]);
-
-	void getInterMatrix(unsigned char inter[64]);
-	void setInterMatrix(unsigned char inter[64]);
-
-	bool getTrellis(void);
-	void setTrellis(bool trellis);
-
-	unsigned int getReactionDelayFactor(void);
-	void setReactionDelayFactor(unsigned int delayFactor);
-
-	unsigned int getAveragingQuantiserPeriod(void);
-	void setAveragingQuantiserPeriod(unsigned int averagingPeriod);
-
-	unsigned int getSmoother(void);
-	void setSmoother(unsigned int smoother);
-
-	unsigned int getKeyFrameBoost(void);
-	void setKeyFrameBoost(unsigned int keyFrameBoost);
-
-	unsigned int getMaxKeyFrameReduceBitrate(void);
-	void setMaxKeyFrameReduceBitrate(unsigned int bitrateReduction);
-
-	unsigned int getKeyFrameBitrateThreshold(void);
-	void setKeyFrameBitrateThreshold(unsigned int bitrateThreshold);
-
-	unsigned int getOverflowControlStrength(void);
-	void setOverflowControlStrength(unsigned int overflowControlStrength);
-
-	unsigned int getMaxOverflowImprovement(void);
-	void setMaxOverflowImprovement(unsigned int overflowImprovement);
-
-	unsigned int getMaxOverflowDegradation(void);
-	void setMaxOverflowDegradation(unsigned int overflowDegradation);
-
-	unsigned int getAboveAverageCurveCompression(void);
-	void setAboveAverageCurveCompression(unsigned int curveCompression);
-
-	unsigned int getBelowAverageCurveCompression(void);
-	void setBelowAverageCurveCompression(unsigned int curveCompression);
-
-	unsigned int getVbvBufferSize(void);
-	void setVbvBufferSize(unsigned int bufferSize);
-
-	unsigned int getMaxVbvBitrate(void);
-	void setMaxVbvBitrate(unsigned int bitrate);
-
-	unsigned int getVbvPeakBitrate(void);
-	void setVbvPeakBitrate(unsigned int peakBitrate);
-
-	virtual char* toXml(void);
-	virtual int fromXml(const char *xml);
-};
-
-#endif	// options_h

Deleted: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/presetOptions.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/presetOptions.cpp	2009-07-09 10:41:55 UTC (rev 5025)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/presetOptions.cpp	2009-07-09 10:48:18 UTC (rev 5026)
@@ -1,158 +0,0 @@
- /***************************************************************************
-                             presetOptions.cpp
-
-	These settings are intended for external configuration files and don't
-	contain a Preset Configuration block but may contain an Encode Options
-	block.
-
-    begin                : Fri May 23 2008
-    copyright            : (C) 2008 by gruntster
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &lt;libxml/parser.h&gt;
-#include &lt;string.h&gt;
-#include &quot;ADM_inttype.h&quot;
-#include &quot;presetOptions.h&quot;
-
-XvidPresetOptions::XvidPresetOptions(void) : XvidOptions()
-{
-	setEncodeOptionsToDefaults();
-}
-
-vidEncOptions* XvidPresetOptions::getEncodeOptions(void)
-{
-	vidEncOptions *encodeOptions = new vidEncOptions;
-
-	memcpy(encodeOptions, &amp;_encodeOptions, sizeof(vidEncOptions));
-
-	return encodeOptions;
-}
-
-void XvidPresetOptions::setEncodeOptions(vidEncOptions* encodeOptions)
-{
-	memcpy(&amp;_encodeOptions, encodeOptions, sizeof(vidEncOptions));
-}
-
-char* XvidPresetOptions::toXml(void)
-{
-	xmlDocPtr xmlDoc = xmlNewDoc((const xmlChar*)&quot;1.0&quot;);
-	xmlNodePtr xmlNodeRoot, xmlNodeChild;
-	const int bufferSize = 100;
-	xmlChar xmlBuffer[bufferSize + 1];
-	char *xml = NULL;
-
-	while (true)
-	{
-		if (!xmlDoc)
-			break;
-
-		if (!(xmlNodeRoot = xmlNewDocNode(xmlDoc, NULL, (xmlChar*)&quot;XvidConfig&quot;, NULL)))
-			break;
-
-		xmlDocSetRootElement(xmlDoc, xmlNodeRoot);
-
-		xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;encodeOptions&quot;, NULL);
-
-		switch (_encodeOptions.encodeMode)
-		{
-			case ADM_VIDENC_MODE_CBR:
-				strcpy((char*)xmlBuffer, &quot;CBR&quot;);
-				break;
-			case ADM_VIDENC_MODE_CQP:
-				strcpy((char*)xmlBuffer, &quot;CQP&quot;);
-				break;
-			case ADM_VIDENC_MODE_2PASS_SIZE:
-				strcpy((char*)xmlBuffer, &quot;2PASS SIZE&quot;);
-				break;
-			case ADM_VIDENC_MODE_2PASS_ABR:
-				strcpy((char*)xmlBuffer, &quot;2PASS ABR&quot;);
-				break;
-		}
-
-		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;mode&quot;, xmlBuffer);
-		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;parameter&quot;, number2String(xmlBuffer, bufferSize, _encodeOptions.encodeModeParameter));
-
-		addXvidOptionsToXml(xmlNodeRoot);
-		xml = dumpXmlDocToMemory(xmlDoc);
-		xmlFreeDoc(xmlDoc);
-
-		break;
-	}
-
-	return xml;
-}
-
-int XvidPresetOptions::fromXml(const char *xml)
-{
-	bool success = false;
-
-	clearPresetConfiguration();
-	setEncodeOptionsToDefaults();
-
-	xmlDocPtr doc = xmlReadMemory(xml, strlen(xml), &quot;Xvid.xml&quot;, NULL, 0);
-
-	if (success = validateXml(doc))
-	{
-		xmlNode *xmlNodeRoot = xmlDocGetRootElement(doc);
-
-		for (xmlNode *xmlChild = xmlNodeRoot-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
-		{
-			if (xmlChild-&gt;type == XML_ELEMENT_NODE)
-			{
-				char *content = (char*)xmlNodeGetContent(xmlChild);
-
-				if (strcmp((char*)xmlChild-&gt;name, &quot;encodeOptions&quot;) == 0)
-					parseEncodeOptions(xmlChild, &amp;_encodeOptions);
-				else if (strcmp((char*)xmlChild-&gt;name, &quot;XvidOptions&quot;) == 0)
-					parseXvidOptions(xmlChild);
-
-				xmlFree(content);
-			}
-		}
-	}
-
-	xmlFreeDoc(doc);
-
-	return success;
-}
-
-void XvidPresetOptions::parseEncodeOptions(xmlNode *node, vidEncOptions *encodeOptions)
-{
-	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
-	{
-		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
-		{
-			char *content = (char*)xmlNodeGetContent(xmlChild);
-
-			if (strcmp((char*)xmlChild-&gt;name, &quot;mode&quot;) == 0)
-			{
-				if (strcmp(content, &quot;CBR&quot;) == 0)
-					encodeOptions-&gt;encodeMode = ADM_VIDENC_MODE_CBR;
-				else if (strcmp(content, &quot;CQP&quot;) == 0)
-					encodeOptions-&gt;encodeMode = ADM_VIDENC_MODE_CQP;
-				else if (strcmp(content, &quot;2PASS SIZE&quot;) == 0)
-					encodeOptions-&gt;encodeMode = ADM_VIDENC_MODE_2PASS_SIZE;
-				else if (strcmp(content, &quot;2PASS ABR&quot;) == 0)
-					encodeOptions-&gt;encodeMode = ADM_VIDENC_MODE_2PASS_ABR;
-			}
-			else if (strcmp((char*)xmlChild-&gt;name, &quot;parameter&quot;) == 0)
-				encodeOptions-&gt;encodeModeParameter = atoi(content);
-
-			xmlFree(content);
-		}
-	}
-}
-
-void XvidPresetOptions::setEncodeOptionsToDefaults(void)
-{
-	_encodeOptions.encodeMode = DEFAULT_ENCODE_MODE;
-	_encodeOptions.encodeModeParameter = DEFAULT_ENCODE_MODE_PARAMETER;
-}

Deleted: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/presetOptions.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/presetOptions.h	2009-07-09 10:41:55 UTC (rev 5025)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/presetOptions.h	2009-07-09 10:48:18 UTC (rev 5026)
@@ -1,39 +0,0 @@
-/***************************************************************************
-                              presetOptions.h
-
-    begin                : Fri May 23 2008
-    copyright            : (C) 2008 by gruntster
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifndef presetOptions_h
-#define presetOptions_h
-
-#include &quot;options.h&quot;
-
-class XvidPresetOptions : public XvidOptions
-{
-private:
-	vidEncOptions _encodeOptions;
-
-	void parseEncodeOptions(xmlNode *node, vidEncOptions *encodeOptions);
-	void setEncodeOptionsToDefaults(void);
-
-public:
-	XvidPresetOptions(void);
-
-	vidEncOptions* getEncodeOptions(void);
-	void setEncodeOptions(vidEncOptions* encodeOptions);
-	char* toXml(void);
-	int fromXml(const char *xml);
-};
-
-#endif	// presetOptions_h

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp	2009-07-09 10:41:55 UTC (rev 5025)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.cpp	2009-07-09 10:48:18 UTC (rev 5026)
@@ -20,7 +20,6 @@
 #include &lt;QtGui/QFileDialog&gt;
 
 #include &quot;../config.h&quot;
-#include &quot;../presetOptions.h&quot;
 #include &quot;xvidConfigDialog.h&quot;
 #include &quot;xvidCustomMatrixDialog.h&quot;
 
@@ -102,16 +101,16 @@
 	disableGenericSlots = true;
 
 	for (int item = 0; item &lt; list.size(); item++)
-		configs.insert(QFileInfo(list[item]).completeBaseName(), CONFIG_USER);
+		configs.insert(QFileInfo(list[item]).completeBaseName(), PLUGIN_CONFIG_USER);
 
 	list = QDir(getSystemConfigDirectory()).entryList(filter, QDir::Files | QDir::Readable);
 
 	for (int item = 0; item &lt; list.size(); item++)
-		configs.insert(QFileInfo(list[item]).completeBaseName(), CONFIG_SYSTEM);
+		configs.insert(QFileInfo(list[item]).completeBaseName(), PLUGIN_CONFIG_SYSTEM);
 
 	ui.configurationComboBox-&gt;clear();
-	ui.configurationComboBox-&gt;addItem(QT_TR_NOOP(&quot;&lt;default&gt;&quot;), CONFIG_DEFAULT);
-	ui.configurationComboBox-&gt;addItem(QT_TR_NOOP(&quot;&lt;custom&gt;&quot;), CONFIG_CUSTOM);
+	ui.configurationComboBox-&gt;addItem(QT_TR_NOOP(&quot;&lt;default&gt;&quot;), PLUGIN_CONFIG_DEFAULT);
+	ui.configurationComboBox-&gt;addItem(QT_TR_NOOP(&quot;&lt;custom&gt;&quot;), PLUGIN_CONFIG_CUSTOM);
 
 	QMap&lt;QString, int&gt;::const_iterator mapIterator = configs.constBegin();
 
@@ -124,14 +123,14 @@
 	disableGenericSlots = origDisableGenericSlots;
 }
 
-bool XvidConfigDialog::selectConfiguration(QString *selectFile, ConfigType configurationType)
+bool XvidConfigDialog::selectConfiguration(QString *selectFile, PluginConfigType configurationType)
 {
 	bool success = false;
 	bool origDisableGenericSlots = disableGenericSlots;
 
 	disableGenericSlots = true;
 
-	if (configurationType == CONFIG_DEFAULT)
+	if (configurationType == PLUGIN_CONFIG_DEFAULT)
 	{
 		ui.configurationComboBox-&gt;setCurrentIndex(0);
 		success = true;
@@ -167,7 +166,7 @@
 	{
 		ui.deleteButton-&gt;setEnabled(false);
 
-		XvidPresetOptions defaultOptions;
+		XvidOptions defaultOptions;
 		vidEncOptions *defaultEncodeOptions = defaultOptions.getEncodeOptions();
 
 		loadSettings(defaultEncodeOptions, &amp;defaultOptions);
@@ -178,28 +177,18 @@
 		ui.deleteButton-&gt;setEnabled(false);
 	else
 	{
-		int configType = ui.configurationComboBox-&gt;itemData(index).toInt();
+		PluginConfigType configType = (PluginConfigType)ui.configurationComboBox-&gt;itemData(index).toInt();
 		QString configFileName;
 
-		ui.deleteButton-&gt;setEnabled(configType == CONFIG_USER);
+		ui.deleteButton-&gt;setEnabled(configType == PLUGIN_CONFIG_USER);
 
-		if (configType == CONFIG_SYSTEM)
-			configFileName = QFileInfo(getSystemConfigDirectory(), ui.configurationComboBox-&gt;itemText(index) + &quot;.xml&quot;).filePath();
-		else	// CONFIG_USER
-			configFileName = QFileInfo(getUserConfigDirectory(), ui.configurationComboBox-&gt;itemText(index) + &quot;.xml&quot;).filePath();
+		XvidOptions options;
+		vidEncOptions *encodeOptions;
 
-		QFile configFile(configFileName);
+		options.setPresetConfiguration(ui.configurationComboBox-&gt;itemText(index).toUtf8().constData(), configType);
 
-		if (configFile.exists())
+		if (options.loadPresetConfiguration())
 		{
-			configFile.open(QIODevice::ReadOnly | QIODevice::Text);
-
-			QByteArray fileContents = configFile.readAll();
-			XvidPresetOptions options;
-			vidEncOptions *encodeOptions;
-
-			configFile.close();
-			options.fromXml(fileContents.constData());
 			encodeOptions = options.getEncodeOptions();
 
 			loadSettings(encodeOptions, &amp;options);
@@ -225,13 +214,13 @@
 	{
 		QFile configFile(configFileName);
 		vidEncOptions encodeOptions;
-		XvidPresetOptions presetOptions;
+		XvidOptions presetOptions;
 
 		configFile.open(QIODevice::WriteOnly | QIODevice::Truncate | QIODevice::Text);
 		saveSettings(&amp;encodeOptions, &amp;presetOptions);
 		presetOptions.setEncodeOptions(&amp;encodeOptions);
 
-		char* xml = presetOptions.toXml();
+		char* xml = presetOptions.toXml(PLUGIN_XML_EXTERNAL);
 
 		configFile.write(xml, strlen(xml));
 		configFile.close();
@@ -239,7 +228,7 @@
 		delete [] xml;
 
 		fillConfigurationComboBox();
-		selectConfiguration(&amp;QFileInfo(configFileName).completeBaseName(), CONFIG_USER);
+		selectConfiguration(&amp;QFileInfo(configFileName).completeBaseName(), PLUGIN_CONFIG_USER);
 	}
 
 	delete [] configDirectory;
@@ -370,7 +359,7 @@
 {
 	bool origDisableGenericSlots = disableGenericSlots;
 	char *configurationName;
-	ConfigType configurationType;
+	PluginConfigType configurationType;
 
 	disableGenericSlots = true;
 	options-&gt;getPresetConfiguration(&amp;configurationName, &amp;configurationType);		
@@ -385,7 +374,7 @@
 
 	disableGenericSlots = origDisableGenericSlots;
 
-	return (foundConfig &amp;&amp; configurationType != CONFIG_CUSTOM);
+	return (foundConfig &amp;&amp; configurationType != PLUGIN_CONFIG_CUSTOM);
 }
 
 void XvidConfigDialog::loadSettings(vidEncOptions *encodeOptions, XvidOptions *options)
@@ -603,7 +592,7 @@
 			break;
 	}
 
-	ConfigType configurationType = (ConfigType)ui.configurationComboBox-&gt;itemData(ui.configurationComboBox-&gt;currentIndex()).toInt();
+	PluginConfigType configurationType = (PluginConfigType)ui.configurationComboBox-&gt;itemData(ui.configurationComboBox-&gt;currentIndex()).toInt();
 
 	options-&gt;setPresetConfiguration(ui.configurationComboBox-&gt;currentText().toUtf8().constData(), configurationType);
 	options-&gt;setParAsInput(ui.sarAsInputRadioButton-&gt;isChecked());

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.h	2009-07-09 10:41:55 UTC (rev 5025)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/qt4/xvidConfigDialog.h	2009-07-09 10:48:18 UTC (rev 5026)
@@ -2,7 +2,7 @@
 #define XvidConfigDialog_h
 
 #include &quot;ui_xvidConfigDialog.h&quot;
-#include &quot;../options.h&quot;
+#include &quot;../xvidOptions.h&quot;
 
 extern &quot;C&quot;
 {
@@ -24,7 +24,7 @@
 	unsigned char intraMatrix[64], interMatrix[64];
 
 	void fillConfigurationComboBox(void);
-	bool selectConfiguration(QString *selectFile, ConfigType configurationType);
+	bool selectConfiguration(QString *selectFile, PluginConfigType configurationType);
 	bool loadPresetSettings(vidEncOptions *encodeOptions, XvidOptions *options);
 	void loadSettings(vidEncOptions *encodeOptions, XvidOptions *options);
 	QString getUserConfigDirectory(void);

Copied: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/xvidOptions.cpp (from rev 5002, branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.cpp	2009-07-06 05:48:05 UTC (rev 5002)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/xvidOptions.cpp	2009-07-09 10:48:18 UTC (rev 5026)
@@ -0,0 +1,1094 @@
+ /***************************************************************************
+                               XvidOptions.cpp
+
+	These settings are intended for scripting and can contain a Preset 
+	Configuration block.  If this block exists then &quot;internal&quot; settings are
+	ignored and an external configuration file should be read instead, 
+	e.g. PlayStation Portable profile.  However, if the external file is 
+	missing, internal settings have to be used and will reflect a snapshot
+	of the external configuration file at the time the script was generated.
+
+    begin                : Fri Jun 13 2008
+    copyright            : (C) 2008 by gruntster
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &lt;libxml/parser.h&gt;
+#include &lt;libxml/xmlschemas.h&gt;
+#include &lt;sstream&gt;
+#include &lt;string&gt;
+
+#include &quot;config.h&quot;
+#include &quot;ADM_inttype.h&quot;
+#include &quot;ADM_files.h&quot;
+#include &quot;xvidOptions.h&quot;
+
+XvidOptions::XvidOptions(void) : PluginOptions(&quot;Xvid&quot;, &quot;XvidParam.xsd&quot;, DEFAULT_ENCODE_MODE, DEFAULT_ENCODE_MODE_PARAMETER)
+{
+}
+
+void XvidOptions::reset(void)
+{
+	PluginOptions::reset();
+
+	memset(&amp;xvid_enc_create, 0, sizeof(xvid_enc_create_t));
+	memset(&amp;xvid_enc_frame, 0, sizeof(xvid_enc_frame_t));
+	memset(&amp;xvid_plugin_single, 0, sizeof(xvid_plugin_single_t));
+	memset(&amp;xvid_plugin_2pass2, 0, sizeof(xvid_plugin_2pass2_t));
+	memset(&amp;_intraMatrix, 8, sizeof(unsigned char) * 64);
+	memset(&amp;_interMatrix, 1, sizeof(unsigned char) * 64);
+
+	xvid_enc_create.version = XVID_VERSION;
+	xvid_enc_frame.version = XVID_VERSION;
+	xvid_plugin_single.version = XVID_VERSION;
+	xvid_plugin_2pass2.version = XVID_VERSION;
+
+	xvid_enc_frame.vop_flags = XVID_VOP_HALFPEL | XVID_VOP_HQACPRED;
+
+	setPar(1, 1);
+	setParAsInput(false);
+	setCqmPreset(CQM_H263);
+	setMotionEstimation(ME_LOW);
+	setRateDistortion(RD_DCT_ME);
+	setMinQuantiser(2, 2, 2);
+	setMaxQuantiser(31, 31, 31);
+	setBframeQuantiserRatio(150);
+	setBframeQuantiserOffset(100);
+	setOverflowControlStrength(5);
+	setMaxOverflowImprovement(5);
+	setMaxOverflowDegradation(5);
+}
+
+void XvidOptions::getParameters(xvid_enc_create_t **xvid_enc_create, xvid_enc_frame_t **xvid_enc_frame,
+	xvid_plugin_single_t **xvid_plugin_single, xvid_plugin_2pass2_t **xvid_plugin_2pass2)
+{
+	*xvid_enc_create = new xvid_enc_create_t;
+	*xvid_enc_frame = new xvid_enc_frame_t;
+	*xvid_plugin_single = new xvid_plugin_single_t;
+	*xvid_plugin_2pass2 = new xvid_plugin_2pass2_t;
+
+	memcpy(*xvid_enc_create, &amp;this-&gt;xvid_enc_create, sizeof(xvid_enc_create_t));
+	memcpy(*xvid_enc_frame, &amp;this-&gt;xvid_enc_frame, sizeof(xvid_enc_frame_t));
+	memcpy(*xvid_plugin_single, &amp;this-&gt;xvid_plugin_single, sizeof(xvid_plugin_single_t));
+	memcpy(*xvid_plugin_2pass2, &amp;this-&gt;xvid_plugin_2pass2, sizeof(xvid_plugin_2pass2_t));
+
+	if (getCqmPreset() == CQM_CUSTOM)
+	{
+		(*xvid_enc_frame)-&gt;quant_intra_matrix = new unsigned char[64];
+		(*xvid_enc_frame)-&gt;quant_inter_matrix = new unsigned char[64];
+
+		getIntraMatrix((*xvid_enc_frame)-&gt;quant_intra_matrix);
+		getInterMatrix((*xvid_enc_frame)-&gt;quant_inter_matrix);
+	}
+}
+
+unsigned int XvidOptions::getThreads(void)
+{
+	return xvid_enc_create.num_threads;
+}
+
+void XvidOptions::setThreads(unsigned int threads)
+{
+	xvid_enc_create.num_threads = threads;
+}
+
+bool XvidOptions::getParAsInput(void)
+{
+	return _parAsInput;
+}
+
+void XvidOptions::setParAsInput(bool parAsInput)
+{
+	_parAsInput = parAsInput;
+}
+
+void XvidOptions::getPar(unsigned int *width, unsigned int *height)
+{
+	*width = xvid_enc_frame.par_width;
+	*height = xvid_enc_frame.par_height;
+}
+
+void XvidOptions::setPar(unsigned int width, unsigned int height)
+{
+	if (width &gt; 0)
+		xvid_enc_frame.par_width = width;
+
+	if (height &gt; 0)
+		xvid_enc_frame.par_height = height;
+
+	if (xvid_enc_frame.par_width == xvid_enc_frame.par_height)
+		xvid_enc_frame.par = XVID_PAR_11_VGA;
+	else
+		xvid_enc_frame.par = XVID_PAR_EXT;
+}
+
+MotionEstimationMode XvidOptions::getMotionEstimation(void)
+{
+	MotionEstimationMode motionEstimation = ME_NONE;
+
+	if ((xvid_enc_frame.motion &amp; ME_HIGH) == ME_HIGH)
+		motionEstimation = ME_HIGH;
+	else if ((xvid_enc_frame.motion &amp; ME_MEDIUM) == ME_MEDIUM)
+		motionEstimation = ME_MEDIUM;
+	else if ((xvid_enc_frame.motion &amp; ME_LOW) == ME_LOW)
+		motionEstimation = ME_LOW;
+
+	return motionEstimation;
+}
+
+void XvidOptions::setMotionEstimation(MotionEstimationMode motionEstimation)
+{
+	if (motionEstimation == ME_NONE || motionEstimation == ME_LOW || motionEstimation == ME_MEDIUM || motionEstimation == ME_HIGH)
+	{
+		xvid_enc_frame.motion &amp;= ~ME_NONE;
+		xvid_enc_frame.motion &amp;= ~ME_LOW;
+		xvid_enc_frame.motion &amp;= ~ME_MEDIUM;
+		xvid_enc_frame.motion &amp;= ~ME_HIGH;
+		xvid_enc_frame.motion |= motionEstimation;
+
+		if (motionEstimation == ME_NONE)
+			xvid_enc_frame.type = XVID_TYPE_IVOP;
+		else
+			xvid_enc_frame.type = XVID_TYPE_AUTO;
+	}
+}
+
+RateDistortionMode XvidOptions::getRateDistortion(void)
+{
+	RateDistortionMode rateDistortion = RD_NONE;
+
+	if ((xvid_enc_frame.motion &amp; RD_SQUARE) == RD_SQUARE)
+		rateDistortion = RD_SQUARE;
+	else if ((xvid_enc_frame.motion &amp; RD_HPEL_QPEL_8) == RD_HPEL_QPEL_8)
+		rateDistortion = RD_HPEL_QPEL_8;
+	else if ((xvid_enc_frame.motion &amp; RD_HPEL_QPEL_16) == RD_HPEL_QPEL_16)
+		rateDistortion = RD_HPEL_QPEL_16;
+	else if ((xvid_enc_frame.vop_flags &amp; XVID_VOP_MODEDECISION_RD) == XVID_VOP_MODEDECISION_RD)
+		rateDistortion = RD_DCT_ME;
+
+	return rateDistortion;
+}
+
+void XvidOptions::setRateDistortion(RateDistortionMode rateDistortion)
+{
+	if (rateDistortion == RD_NONE || rateDistortion == RD_DCT_ME || rateDistortion == RD_HPEL_QPEL_16 || 
+		rateDistortion == RD_HPEL_QPEL_8 || rateDistortion == RD_SQUARE)
+	{
+		xvid_enc_frame.motion &amp;= ~RD_HPEL_QPEL_16;
+		xvid_enc_frame.motion &amp;= ~RD_HPEL_QPEL_8;
+		xvid_enc_frame.motion &amp;= ~RD_SQUARE;
+
+		if (rateDistortion == RD_NONE)
+			xvid_enc_frame.vop_flags &amp;= ~XVID_VOP_MODEDECISION_RD;
+		else
+		{
+			if (rateDistortion != RD_DCT_ME)
+				xvid_enc_frame.motion |= rateDistortion;
+
+			xvid_enc_frame.vop_flags |= XVID_VOP_MODEDECISION_RD;
+		}
+	}
+}
+
+bool XvidOptions::getBframeRdo(void)
+{
+	return xvid_enc_frame.vop_flags &amp; XVID_VOP_RD_BVOP;
+}
+
+void XvidOptions::setBframeRdo(bool bFrameRdo)
+{
+	if (bFrameRdo)
+		xvid_enc_frame.vop_flags |= XVID_VOP_RD_BVOP;
+	else
+		xvid_enc_frame.vop_flags &amp;= ~XVID_VOP_RD_BVOP;
+}
+
+bool XvidOptions::getChromaMotionEstimation(void)
+{
+	return xvid_enc_frame.motion &amp; CHROMA_ME;
+}
+
+void XvidOptions::setChromaMotionEstimation(bool chromaMotionEstimation)
+{
+	if (chromaMotionEstimation)
+		xvid_enc_frame.motion |= CHROMA_ME;
+	else
+		xvid_enc_frame.motion &amp;= ~CHROMA_ME;
+}
+
+bool XvidOptions::getQpel(void)
+{
+	return xvid_enc_frame.vol_flags &amp; XVID_VOL_QUARTERPEL;
+}
+
+void XvidOptions::setQpel(bool qpel)
+{
+	if (qpel)
+	{
+		xvid_enc_frame.vol_flags |= XVID_VOL_QUARTERPEL;
+		xvid_enc_frame.motion |= XVID_ME_QUARTERPELREFINE16;
+
+		if (getInterMotionVector())
+			xvid_enc_frame.motion |= XVID_ME_QUARTERPELREFINE8;
+	}
+	else
+	{
+		xvid_enc_frame.vol_flags &amp;= ~XVID_VOL_QUARTERPEL;
+		xvid_enc_frame.motion &amp;= ~XVID_ME_QUARTERPELREFINE16;
+		xvid_enc_frame.motion &amp;= ~XVID_ME_QUARTERPELREFINE8;
+	}
+}
+
+bool XvidOptions::getGmc(void)
+{
+	return xvid_enc_frame.vol_flags &amp; XVID_VOL_GMC;
+}
+
+void XvidOptions::setGmc(bool gmc)
+{
+	if (gmc)
+	{
+		xvid_enc_frame.vol_flags |= XVID_VOL_GMC;
+		xvid_enc_frame.motion |= XVID_ME_GME_REFINE;
+	}
+	else
+	{
+		xvid_enc_frame.vol_flags &amp;= ~XVID_VOL_GMC;
+		xvid_enc_frame.motion &amp;= ~XVID_ME_GME_REFINE;
+	}
+}
+
+bool XvidOptions::getTurboMode(void)
+{
+	return xvid_enc_frame.motion &amp; TURBO_MODE;
+}
+
+void XvidOptions::setTurboMode(bool turboMode)
+{
+	if (turboMode)
+		xvid_enc_frame.motion |= TURBO_MODE;
+	else
+		xvid_enc_frame.motion &amp;= ~TURBO_MODE;
+}
+
+bool XvidOptions::getChromaOptimisation(void)
+{
+	return xvid_enc_frame.vop_flags &amp; XVID_VOP_CHROMAOPT;
+}
+
+void XvidOptions::setChromaOptimisation(bool chromaOptimisation)
+{
+	if (chromaOptimisation)
+		xvid_enc_frame.vop_flags |= XVID_VOP_CHROMAOPT;
+	else
+		xvid_enc_frame.vop_flags &amp;= ~XVID_VOP_CHROMAOPT;
+}
+
+bool XvidOptions::getInterMotionVector(void)
+{
+	return xvid_enc_frame.vop_flags &amp; XVID_VOP_INTER4V;
+}
+
+void XvidOptions::setInterMotionVector(bool interMotionVector)
+{
+	if (interMotionVector)
+	{
+		xvid_enc_frame.vop_flags |= XVID_VOP_INTER4V;
+
+		if (getQpel())
+			setQpel(true);
+	}
+	else
+		xvid_enc_frame.vop_flags &amp;= ~XVID_VOP_INTER4V;
+}
+
+bool XvidOptions::getCartoon(void)
+{
+	return xvid_enc_frame.vop_flags &amp; XVID_VOP_CARTOON;
+}
+
+void XvidOptions::setCartoon(bool cartoon)
+{
+	if (cartoon)
+		xvid_enc_frame.vop_flags |= XVID_VOP_CARTOON;
+	else
+		xvid_enc_frame.vop_flags &amp;= ~XVID_VOP_CARTOON;
+}
+
+bool XvidOptions::getGreyscale(void)
+{
+	return xvid_enc_frame.vop_flags &amp; XVID_VOP_GREYSCALE;
+}
+
+void XvidOptions::setGreyscale(bool greyscale)
+{
+	if (greyscale)
+		xvid_enc_frame.vop_flags |= XVID_VOP_GREYSCALE;
+	else
+		xvid_enc_frame.vop_flags &amp;= ~XVID_VOP_GREYSCALE;
+}
+
+InterlacedMode XvidOptions::getInterlaced(void)
+{
+	InterlacedMode interlaced = INTERLACED_NONE;
+
+	if (xvid_enc_frame.vop_flags &amp; XVID_VOP_TOPFIELDFIRST)
+		interlaced = INTERLACED_TFF;
+	else if (xvid_enc_frame.vol_flags &amp; XVID_VOL_INTERLACING)
+		interlaced = INTERLACED_BFF;
+
+	return interlaced;
+}
+
+void XvidOptions::setInterlaced(InterlacedMode interlaced)
+{
+	if (interlaced == INTERLACED_NONE)
+	{
+		xvid_enc_frame.vol_flags &amp;= ~XVID_VOL_INTERLACING;
+		xvid_enc_frame.vop_flags &amp;= ~XVID_VOP_TOPFIELDFIRST;
+	}
+	else if (interlaced == INTERLACED_BFF || interlaced == INTERLACED_TFF)
+	{
+		xvid_enc_frame.vol_flags |= XVID_VOL_INTERLACING;
+
+		if (interlaced == INTERLACED_TFF)
+			xvid_enc_frame.vop_flags |= XVID_VOP_TOPFIELDFIRST;
+		else
+			xvid_enc_frame.vop_flags &amp;= ~XVID_VOP_TOPFIELDFIRST;
+	}
+}
+
+unsigned int XvidOptions::getFrameDropRatio(void)
+{
+	return xvid_enc_create.frame_drop_ratio;
+}
+
+void XvidOptions::setFrameDropRatio(unsigned int frameDropRatio)
+{
+	if (frameDropRatio &lt;= 100)
+		xvid_enc_create.frame_drop_ratio = frameDropRatio;
+}
+
+unsigned int XvidOptions::getMaxKeyInterval(void)
+{
+	return xvid_enc_create.max_key_interval;
+}
+
+void XvidOptions::setMaxKeyInterval(unsigned int maxKeyInterval)
+{
+	xvid_enc_create.max_key_interval = maxKeyInterval;
+}
+
+unsigned int XvidOptions::getMaxBframes(void)
+{
+	return xvid_enc_create.max_bframes;
+}
+
+void XvidOptions::setMaxBframes(unsigned int maxBframes)
+{
+	if (maxBframes &lt;= 20)
+		xvid_enc_create.max_bframes = maxBframes;
+}
+
+int XvidOptions::getBframeSensitivity(void)
+{
+	return xvid_enc_frame.bframe_threshold;
+}
+
+void XvidOptions::setBframeSensitivity(int bFrameSensitivity)
+{
+	if (bFrameSensitivity &gt;= -255 &amp;&amp; bFrameSensitivity &lt;= 255)
+		xvid_enc_frame.bframe_threshold = bFrameSensitivity;
+}
+
+bool XvidOptions::getClosedGop(void)
+{
+	return xvid_enc_create.global &amp; XVID_GLOBAL_CLOSED_GOP;
+}
+
+void XvidOptions::setClosedGop(bool closedGop)
+{
+	if (closedGop)
+		xvid_enc_create.global |= XVID_GLOBAL_CLOSED_GOP;
+	else
+		xvid_enc_create.global &amp;= ~XVID_GLOBAL_CLOSED_GOP;
+}
+
+bool XvidOptions::getPacked(void)
+{
+	return xvid_enc_create.global &amp; XVID_GLOBAL_PACKED;
+}
+
+void XvidOptions::setPacked(bool packed)
+{
+	if (packed)
+		xvid_enc_create.global |= XVID_GLOBAL_PACKED;
+	else
+		xvid_enc_create.global &amp;= ~XVID_GLOBAL_PACKED;
+}
+
+void XvidOptions::getMinQuantiser(unsigned int *i, unsigned int *p, unsigned int *b)
+{
+	*i = xvid_enc_create.min_quant[0];
+	*p = xvid_enc_create.min_quant[1];
+	*b = xvid_enc_create.min_quant[2];
+}
+
+void XvidOptions::setMinQuantiser(unsigned int i, unsigned int p, unsigned int b)
+{
+	if (i &gt; 0 &amp;&amp; i &lt;= 31)
+		xvid_enc_create.min_quant[0] = i;
+
+	if (p &gt; 0 &amp;&amp; p &lt;= 31)
+		xvid_enc_create.min_quant[1] = p;
+
+	if (b &gt; 0 &amp;&amp; b &lt;= 31)
+		xvid_enc_create.min_quant[2] = b;
+}
+
+void XvidOptions::getMaxQuantiser(unsigned int *i, unsigned int *p, unsigned int *b)
+{
+	*i = xvid_enc_create.max_quant[0];
+	*p = xvid_enc_create.max_quant[1];
+	*b = xvid_enc_create.max_quant[2];
+}
+
+void XvidOptions::setMaxQuantiser(unsigned int i, unsigned int p, unsigned int b)
+{
+	if (i &gt; 0 &amp;&amp; i &lt;= 31)
+		xvid_enc_create.max_quant[0] = i;
+
+	if (p &gt; 0 &amp;&amp; p &lt;= 31)
+		xvid_enc_create.max_quant[1] = p;
+
+	if (b &gt; 0 &amp;&amp; b &lt;= 31)
+		xvid_enc_create.max_quant[2] = b;
+}
+
+unsigned int XvidOptions::getBframeQuantiserRatio(void)
+{
+	return xvid_enc_create.bquant_ratio;
+}
+
+void XvidOptions::setBframeQuantiserRatio(unsigned int ratio)
+{
+	if (ratio &lt;= 200)
+		xvid_enc_create.bquant_ratio = ratio;
+}
+
+unsigned int XvidOptions::getBframeQuantiserOffset(void)
+{
+	return xvid_enc_create.bquant_offset;
+}
+
+void XvidOptions::setBframeQuantiserOffset(unsigned int offset)
+{
+	if (offset &lt;= 200)
+		xvid_enc_create.bquant_offset = offset;
+}
+
+CqmPresetMode XvidOptions::getCqmPreset(void)
+{
+	return _cqmPreset;
+}
+
+void XvidOptions::setCqmPreset(CqmPresetMode cqmPreset)
+{
+	if (cqmPreset == CQM_H263 || cqmPreset == CQM_MPEG || cqmPreset == CQM_CUSTOM)
+	{
+		_cqmPreset = cqmPreset;
+
+		switch (cqmPreset)
+		{
+			case CQM_MPEG:
+			case CQM_CUSTOM:
+				xvid_enc_frame.vol_flags |= XVID_VOL_MPEGQUANT;
+				break;
+			default:
+				xvid_enc_frame.vol_flags &amp;= ~XVID_VOL_MPEGQUANT;
+		}
+	}
+}
+
+void XvidOptions::getIntraMatrix(unsigned char intra[64])
+{
+	memcpy(intra, _intraMatrix, 64 * sizeof(unsigned char));
+}
+
+void XvidOptions::setIntraMatrix(unsigned char intra[64])
+{
+	memcpy(_intraMatrix, intra, 64 * sizeof(unsigned char));
+}
+
+void XvidOptions::getInterMatrix(unsigned char inter[64])
+{
+	memcpy(inter, _interMatrix, 64 * sizeof(unsigned char));
+}
+
+void XvidOptions::setInterMatrix(unsigned char inter[64])
+{
+	memcpy(_interMatrix, inter, 64 * sizeof(unsigned char));
+}
+
+bool XvidOptions::getTrellis(void)
+{
+	return xvid_enc_frame.vop_flags &amp; XVID_VOP_TRELLISQUANT;
+}
+
+void XvidOptions::setTrellis(bool trellis)
+{
+	if (trellis)
+		xvid_enc_frame.vop_flags |= XVID_VOP_TRELLISQUANT;
+	else
+		xvid_enc_frame.vop_flags &amp;= ~XVID_VOP_TRELLISQUANT;
+}
+
+unsigned int XvidOptions::getReactionDelayFactor(void)
+{
+	return xvid_plugin_single.reaction_delay_factor;
+}
+
+void XvidOptions::setReactionDelayFactor(unsigned int delayFactor)
+{
+	if (delayFactor &lt;= 100)
+		xvid_plugin_single.reaction_delay_factor = delayFactor;
+}
+
+unsigned int XvidOptions::getAveragingQuantiserPeriod(void)
+{
+	return xvid_plugin_single.averaging_period;
+}
+
+void XvidOptions::setAveragingQuantiserPeriod(unsigned int averagingPeriod)
+{
+	xvid_plugin_single.averaging_period = averagingPeriod;
+}
+
+unsigned int XvidOptions::getSmoother(void)
+{
+	return xvid_plugin_single.buffer;
+}
+
+void XvidOptions::setSmoother(unsigned int smoother)
+{
+	xvid_plugin_single.buffer = smoother;
+}
+
+unsigned int XvidOptions::getKeyFrameBoost(void)
+{
+	return xvid_plugin_2pass2.keyframe_boost;
+}
+
+void XvidOptions::setKeyFrameBoost(unsigned int keyFrameBoost)
+{
+	if (keyFrameBoost &lt;= 100)
+		xvid_plugin_2pass2.keyframe_boost = keyFrameBoost;
+}
+
+unsigned int XvidOptions::getMaxKeyFrameReduceBitrate(void)
+{
+	return xvid_plugin_2pass2.kfreduction;
+}
+
+void XvidOptions::setMaxKeyFrameReduceBitrate(unsigned int bitrateReduction)
+{
+	if (bitrateReduction &lt;= 100)
+		xvid_plugin_2pass2.kfreduction = bitrateReduction;
+}
+
+unsigned int XvidOptions::getKeyFrameBitrateThreshold(void)
+{
+	return xvid_plugin_2pass2.kfthreshold;
+}
+
+void XvidOptions::setKeyFrameBitrateThreshold(unsigned int bitrateThreshold)
+{
+	xvid_plugin_2pass2.kfthreshold = bitrateThreshold;
+}
+
+unsigned int XvidOptions::getOverflowControlStrength(void)
+{
+	return xvid_plugin_2pass2.overflow_control_strength;
+}
+
+void XvidOptions::setOverflowControlStrength(unsigned int overflowControlStrength)
+{
+	if (overflowControlStrength &lt;= 100)
+		xvid_plugin_2pass2.overflow_control_strength = overflowControlStrength;
+}
+
+unsigned int XvidOptions::getMaxOverflowImprovement(void)
+{
+	return xvid_plugin_2pass2.max_overflow_improvement;
+}
+
+void XvidOptions::setMaxOverflowImprovement(unsigned int overflowImprovement)
+{
+	if (overflowImprovement &lt;= 100)
+		xvid_plugin_2pass2.max_overflow_improvement = overflowImprovement;
+}
+
+unsigned int XvidOptions::getMaxOverflowDegradation(void)
+{
+	return xvid_plugin_2pass2.max_overflow_degradation;
+}
+
+void XvidOptions::setMaxOverflowDegradation(unsigned int overflowDegradation)
+{
+	if (overflowDegradation &lt;= 100)
+		xvid_plugin_2pass2.max_overflow_degradation = overflowDegradation;
+}
+
+unsigned int XvidOptions::getAboveAverageCurveCompression(void)
+{
+	return xvid_plugin_2pass2.curve_compression_high;
+}
+
+void XvidOptions::setAboveAverageCurveCompression(unsigned int curveCompression)
+{
+	if (curveCompression &lt;= 100)
+		xvid_plugin_2pass2.curve_compression_high = curveCompression;
+}
+
+unsigned int XvidOptions::getBelowAverageCurveCompression(void)
+{
+	return xvid_plugin_2pass2.curve_compression_low;
+}
+
+void XvidOptions::setBelowAverageCurveCompression(unsigned int curveCompression)
+{
+	if (curveCompression &lt;= 100)
+		xvid_plugin_2pass2.curve_compression_low = curveCompression;
+}
+
+unsigned int XvidOptions::getVbvBufferSize(void)
+{
+	return xvid_plugin_2pass2.vbv_size;
+}
+
+void XvidOptions::setVbvBufferSize(unsigned int bufferSize)
+{
+	if (bufferSize &lt;= 6291456)
+	{
+		xvid_plugin_2pass2.vbv_size = bufferSize;
+		xvid_plugin_2pass2.vbv_initial = (bufferSize * 3) &gt;&gt; 2;
+	}
+}
+
+unsigned int XvidOptions::getMaxVbvBitrate(void)
+{
+	return xvid_plugin_2pass2.vbv_maxrate;
+}
+
+void XvidOptions::setMaxVbvBitrate(unsigned int bitrate)
+{
+	if (bitrate &lt;= 9708400)
+		xvid_plugin_2pass2.vbv_maxrate = bitrate;
+}
+
+unsigned int XvidOptions::getVbvPeakBitrate(void)
+{
+	return xvid_plugin_2pass2.vbv_peakrate;
+}
+
+void XvidOptions::setVbvPeakBitrate(unsigned int peakBitrate)
+{
+	if (peakBitrate &lt;= 16000000)
+		xvid_plugin_2pass2.vbv_peakrate = peakBitrate;
+}
+
+void XvidOptions::addOptionsToXml(xmlNodePtr xmlNodeRoot)
+{
+	const int bufferSize = 100;
+	xmlChar xmlBuffer[bufferSize + 1];
+	xmlNodePtr xmlNodeChild, xmlNodeChild2;
+
+	xmlNodeRoot = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;XvidOptions&quot;, NULL);
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;threads&quot;, number2String(xmlBuffer, bufferSize, getThreads()));
+
+	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;vui&quot;, NULL);
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;sarAsInput&quot;, boolean2String(xmlBuffer, bufferSize, getParAsInput()));
+
+	unsigned int width, height;
+
+	getPar(&amp;width, &amp;height);
+
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;sarHeight&quot;, number2String(xmlBuffer, bufferSize, height));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;sarWidth&quot;, number2String(xmlBuffer, bufferSize, width));
+
+	switch (getMotionEstimation())
+	{
+		case ME_LOW:
+			strcpy((char*)xmlBuffer, &quot;low&quot;);
+			break;
+		case ME_MEDIUM:
+			strcpy((char*)xmlBuffer, &quot;medium&quot;);
+			break;
+		case ME_HIGH:
+			strcpy((char*)xmlBuffer, &quot;high&quot;);
+			break;
+		default:
+			strcpy((char*)xmlBuffer, &quot;none&quot;);
+			break;
+	}
+
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;motionEstimation&quot;, xmlBuffer);
+
+	switch (getRateDistortion())
+	{
+		case RD_DCT_ME:
+			strcpy((char*)xmlBuffer, &quot;dct&quot;);
+			break;
+		case RD_HPEL_QPEL_16:
+			strcpy((char*)xmlBuffer, &quot;hpelQpel16&quot;);
+			break;
+		case RD_HPEL_QPEL_8:
+			strcpy((char*)xmlBuffer, &quot;hpelQpel8&quot;);
+			break;
+		case RD_SQUARE:
+			strcpy((char*)xmlBuffer, &quot;square&quot;);
+			break;
+		default:
+			strcpy((char*)xmlBuffer, &quot;none&quot;);
+			break;
+	}
+
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;rdo&quot;, xmlBuffer);
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;bFrameRdo&quot;, boolean2String(xmlBuffer, bufferSize, getBframeRdo()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;chromaMotionEstimation&quot;, boolean2String(xmlBuffer, bufferSize, getChromaMotionEstimation()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;qPel&quot;, boolean2String(xmlBuffer, bufferSize, getQpel()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;gmc&quot;, boolean2String(xmlBuffer, bufferSize, getGmc()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;turboMode&quot;, boolean2String(xmlBuffer, bufferSize, getTurboMode()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;chromaOptimiser&quot;, boolean2String(xmlBuffer, bufferSize, getChromaOptimisation()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;fourMv&quot;, boolean2String(xmlBuffer, bufferSize, getInterMotionVector()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;cartoon&quot;, boolean2String(xmlBuffer, bufferSize, getCartoon()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;greyscale&quot;, boolean2String(xmlBuffer, bufferSize, getGreyscale()));
+
+	switch (getInterlaced())
+	{
+		case INTERLACED_BFF:
+			strcpy((char*)xmlBuffer, &quot;bff&quot;);
+			break;
+		case INTERLACED_TFF:
+			strcpy((char*)xmlBuffer, &quot;tff&quot;);
+			break;
+		default:
+			strcpy((char*)xmlBuffer, &quot;none&quot;);
+			break;
+	}
+
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;interlaced&quot;, xmlBuffer);
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;frameDropRatio&quot;, number2String(xmlBuffer, bufferSize, getFrameDropRatio()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;maxIframeInterval&quot;, number2String(xmlBuffer, bufferSize, getMaxKeyInterval()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;maxBframes&quot;, number2String(xmlBuffer, bufferSize, getMaxBframes()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;bFrameSensitivity&quot;, number2String(xmlBuffer, bufferSize, getBframeSensitivity()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;closedGop&quot;, boolean2String(xmlBuffer, bufferSize, getClosedGop()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;packed&quot;, boolean2String(xmlBuffer, bufferSize, getPacked()));
+
+	unsigned int minI, minP, minB;
+	unsigned int maxI, maxP, maxB;
+
+	getMinQuantiser(&amp;minI, &amp;minP, &amp;minB);
+	getMaxQuantiser(&amp;maxI, &amp;maxP, &amp;maxB);
+
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;quantImin&quot;, number2String(xmlBuffer, bufferSize, minI));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;quantPmin&quot;, number2String(xmlBuffer, bufferSize, minP));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;quantBmin&quot;, number2String(xmlBuffer, bufferSize, minB));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;quantImax&quot;, number2String(xmlBuffer, bufferSize, maxI));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;quantPmax&quot;, number2String(xmlBuffer, bufferSize, maxP));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;quantBmax&quot;, number2String(xmlBuffer, bufferSize, maxB));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;quantBratio&quot;, number2String(xmlBuffer, bufferSize, getBframeQuantiserRatio()));
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;quantBoffset&quot;, number2String(xmlBuffer, bufferSize, getBframeQuantiserOffset()));
+
+	switch (getCqmPreset())
+	{
+		case CQM_H263:
+			strcpy((char*)xmlBuffer, &quot;h.263&quot;);
+			break;
+		case CQM_MPEG:
+			strcpy((char*)xmlBuffer, &quot;mpeg&quot;);
+			break;
+		case CQM_CUSTOM:
+			strcpy((char*)xmlBuffer, &quot;custom&quot;);
+			break;
+	}
+
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;quantType&quot;, xmlBuffer);
+
+	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;intraMatrix&quot;, NULL);
+
+	for (int i = 0; i &lt; 64; i++)
+		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;value&quot;, number2String(xmlBuffer, bufferSize, _intraMatrix[i]));
+
+	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;interMatrix&quot;, NULL);
+
+	for (int i = 0; i &lt; 64; i++)
+		xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;value&quot;, number2String(xmlBuffer, bufferSize, _interMatrix[i]));
+
+	xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;trellis&quot;, boolean2String(xmlBuffer, bufferSize, getTrellis()));
+
+	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;singlePass&quot;, NULL);
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;reactionDelayFactor&quot;, number2String(xmlBuffer, bufferSize, getReactionDelayFactor()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;averagingQuantiserPeriod&quot;, number2String(xmlBuffer, bufferSize, getAveragingQuantiserPeriod()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;smoother&quot;, number2String(xmlBuffer, bufferSize, getSmoother()));
+
+	xmlNodeChild = xmlNewChild(xmlNodeRoot, NULL, (xmlChar*)&quot;twoPass&quot;, NULL);
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;keyFrameBoost&quot;, number2String(xmlBuffer, bufferSize, getKeyFrameBoost()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;maxKeyFrameReduceBitrate&quot;, number2String(xmlBuffer, bufferSize, getMaxKeyFrameReduceBitrate()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;keyFrameBitrateThreshold&quot;, number2String(xmlBuffer, bufferSize, getKeyFrameBitrateThreshold()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;overflowControlStrength&quot;, number2String(xmlBuffer, bufferSize, getOverflowControlStrength()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;maxOverflowImprovement&quot;, number2String(xmlBuffer, bufferSize, getMaxOverflowImprovement()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;maxOverflowDegradation&quot;, number2String(xmlBuffer, bufferSize, getMaxOverflowDegradation()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;aboveAverageCurveCompression&quot;, number2String(xmlBuffer, bufferSize, getAboveAverageCurveCompression()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;belowAverageCurveCompression&quot;, number2String(xmlBuffer, bufferSize, getBelowAverageCurveCompression()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;vbvBufferSize&quot;, number2String(xmlBuffer, bufferSize, getVbvBufferSize()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;maxVbvBitrate&quot;, number2String(xmlBuffer, bufferSize, getMaxVbvBitrate()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)&quot;vbvPeakBitrate&quot;, number2String(xmlBuffer, bufferSize, getVbvPeakBitrate()));
+}
+
+void XvidOptions::parseOptions(xmlNode *node)
+{
+	int minI = -1, minP = -1, minB = -1;
+	int maxI = -1, maxP = -1, maxB = -1;
+
+	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
+	{
+		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
+		{
+			char *content = (char*)xmlNodeGetContent(xmlChild);
+
+			if (strcmp((char*)xmlChild-&gt;name, &quot;threads&quot;) == 0)
+				setThreads(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;vui&quot;) == 0)
+				parseVuiOptions(xmlChild);
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;motionEstimation&quot;) == 0)
+			{
+				MotionEstimationMode motionEstimation = ME_NONE;
+
+				if (strcmp(content, &quot;low&quot;) == 0)
+					motionEstimation = ME_LOW;
+				else if (strcmp(content, &quot;medium&quot;) == 0)
+					motionEstimation = ME_MEDIUM;
+				else if (strcmp(content, &quot;high&quot;) == 0)
+					motionEstimation = ME_HIGH;
+
+				setMotionEstimation(motionEstimation);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;rdo&quot;) == 0)
+			{
+				RateDistortionMode rateDistortion = RD_NONE;
+
+				if (strcmp(content, &quot;dct&quot;) == 0)
+					rateDistortion = RD_DCT_ME;
+				else if (strcmp(content, &quot;hpelQpel16&quot;) == 0)
+					rateDistortion = RD_HPEL_QPEL_16;
+				else if (strcmp(content, &quot;hpelQpel8&quot;) == 0)
+					rateDistortion = RD_HPEL_QPEL_8;
+				else if (strcmp(content, &quot;square&quot;) == 0)
+					rateDistortion = RD_SQUARE;
+
+				setRateDistortion(rateDistortion);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;bFrameRdo&quot;) == 0)
+				setBframeRdo(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;chromaMotionEstimation&quot;) == 0)
+				setChromaMotionEstimation(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;qPel&quot;) == 0)
+				setQpel(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;gmc&quot;) == 0)
+				setGmc(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;turboMode&quot;) == 0)
+				setTurboMode(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;chromaOptimiser&quot;) == 0)
+				setChromaOptimisation(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;fourMv&quot;) == 0)
+				setInterMotionVector(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;cartoon&quot;) == 0)
+				setCartoon(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;greyscale&quot;) == 0)
+				setGreyscale(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;interlaced&quot;) == 0)
+			{
+				InterlacedMode interlaced = INTERLACED_NONE;
+
+				if (strcmp(content, &quot;bff&quot;) == 0)
+					interlaced = INTERLACED_BFF;
+				else if (strcmp(content, &quot;tff&quot;) == 0)
+					interlaced = INTERLACED_TFF;
+
+				setInterlaced(interlaced);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;frameDropRatio&quot;) == 0)
+				setFrameDropRatio(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;maxIframeInterval&quot;) == 0)
+				setMaxKeyInterval(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;maxBframes&quot;) == 0)
+				setMaxBframes(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;bFrameSensitivity&quot;) == 0)
+				setBframeSensitivity(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;closedGop&quot;) == 0)
+				setClosedGop(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;packed&quot;) == 0)
+				setPacked(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantImin&quot;) == 0)
+				minI = atoi(content);
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantPmin&quot;) == 0)
+				minP = atoi(content);
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantBmin&quot;) == 0)
+				minB = atoi(content);
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantImax&quot;) == 0)
+				maxI = atoi(content);
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantPmax&quot;) == 0)
+				maxP = atoi(content);
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantBmax&quot;) == 0)
+				maxB = atoi(content);
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantBratio&quot;) == 0)
+				setBframeQuantiserRatio(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantBoffset&quot;) == 0)
+				setBframeQuantiserOffset(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;quantType&quot;) == 0)
+			{
+				if (strcmp(content, &quot;mpeg&quot;) == 0)
+					setCqmPreset(CQM_MPEG);
+				else if (strcmp(content, &quot;custom&quot;) == 0)
+					setCqmPreset(CQM_CUSTOM);
+				else
+					setCqmPreset(CQM_H263);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;intraMatrix&quot;) == 0)
+			{
+				unsigned char intraMatrix[64];
+
+				parseCqmOption(xmlChild, intraMatrix);
+				setIntraMatrix(intraMatrix);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;interMatrix&quot;) == 0)
+			{
+				unsigned char interMatrix[64];
+
+				parseCqmOption(xmlChild, interMatrix);
+				setInterMatrix(interMatrix);
+			}
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;trellis&quot;) == 0)
+				setTrellis(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;singlePass&quot;) == 0)
+				parseSinglePassOptions(xmlChild);
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;twoPass&quot;) == 0)
+				parseTwoPassOptions(xmlChild);
+
+			xmlFree(content);
+		}
+	}
+
+	if (minI != -1 &amp;&amp; minP != -1 &amp;&amp; minB != -1)
+		setMinQuantiser(minI, minP, minB);
+
+	if (maxI != -1 &amp;&amp; maxP != -1 &amp;&amp; maxB != -1)
+		setMaxQuantiser(maxI, maxP, maxB);
+}
+
+void XvidOptions::parseVuiOptions(xmlNode *node)
+{
+	unsigned int width = 0, height = 0;
+
+	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
+	{
+		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
+		{
+			char *content = (char*)xmlNodeGetContent(xmlChild);
+
+			if (strcmp((char*)xmlChild-&gt;name, &quot;sarAsInput&quot;) == 0)
+				setParAsInput(string2Boolean(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;sarHeight&quot;) == 0)
+				height = atoi(content);
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;sarWidth&quot;) == 0)
+				width = atoi(content);
+
+			xmlFree(content);
+		}
+	}
+
+	setPar(width, height);
+}
+
+void XvidOptions::parseCqmOption(xmlNode *node, unsigned char matrix[])
+{
+	int index = 0;
+
+	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
+	{
+		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
+		{
+			char *content = (char*)xmlNodeGetContent(xmlChild);
+
+			matrix[index] = atoi(content);
+			index++;
+
+			xmlFree(content);
+		}
+	}
+}
+
+void XvidOptions::parseSinglePassOptions(xmlNode *node)
+{
+	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
+	{
+		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
+		{
+			char *content = (char*)xmlNodeGetContent(xmlChild);
+
+			if (strcmp((char*)xmlChild-&gt;name, &quot;reactionDelayFactor&quot;) == 0)
+				setReactionDelayFactor(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;averagingQuantiserPeriod&quot;) == 0)
+				setAveragingQuantiserPeriod(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;smoother&quot;) == 0)
+				setSmoother(atoi(content));
+
+			xmlFree(content);
+		}
+	}
+}
+
+void XvidOptions::parseTwoPassOptions(xmlNode *node)
+{
+	for (xmlNode *xmlChild = node-&gt;children; xmlChild; xmlChild = xmlChild-&gt;next)
+	{
+		if (xmlChild-&gt;type == XML_ELEMENT_NODE)
+		{
+			char *content = (char*)xmlNodeGetContent(xmlChild);
+
+			if (strcmp((char*)xmlChild-&gt;name, &quot;keyFrameBoost&quot;) == 0)
+				setKeyFrameBoost(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;maxKeyFrameReduceBitrate&quot;) == 0)
+				setMaxKeyFrameReduceBitrate(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;keyFrameBitrateThreshold&quot;) == 0)
+				setKeyFrameBitrateThreshold(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;overflowControlStrength&quot;) == 0)
+				setOverflowControlStrength(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;maxOverflowImprovement&quot;) == 0)
+				setMaxOverflowImprovement(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;maxOverflowDegradation&quot;) == 0)
+				setMaxOverflowDegradation(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;aboveAverageCurveCompression&quot;) == 0)
+				setAboveAverageCurveCompression(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;belowAverageCurveCompression&quot;) == 0)
+				setBelowAverageCurveCompression(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;vbvBufferSize&quot;) == 0)
+				setVbvBufferSize(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;maxVbvBitrate&quot;) == 0)
+				setMaxVbvBitrate(atoi(content));
+			else if (strcmp((char*)xmlChild-&gt;name, &quot;vbvPeakBitrate&quot;) == 0)
+				setVbvPeakBitrate(atoi(content));
+
+			xmlFree(content);
+		}
+	}
+}

Copied: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/xvidOptions.h (from rev 5002, branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h)
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/options.h	2009-07-06 05:48:05 UTC (rev 5002)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_xvid/xvidOptions.h	2009-07-09 10:48:18 UTC (rev 5026)
@@ -0,0 +1,221 @@
+/***************************************************************************
+                                XvidOptions.h
+
+    begin                : Fri Jun 13 2008
+    copyright            : (C) 2008 by gruntster
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef xvidOptions_h
+#define xvidOptions_h
+
+#include &lt;libxml/tree.h&gt;
+#include &quot;xvid.h&quot;
+#include &quot;PluginOptions.h&quot;
+
+extern &quot;C&quot;
+{
+#include &quot;ADM_vidEnc_plugin.h&quot;
+}
+
+#define DEFAULT_ENCODE_MODE	(ADM_VIDENC_MODE_CQP)
+#define DEFAULT_ENCODE_MODE_PARAMETER (4)
+#define TURBO_MODE (XVID_ME_FASTREFINE16 | XVID_ME_FASTREFINE8 | XVID_ME_SKIP_DELTASEARCH | XVID_ME_FAST_MODEINTERPOLATE | XVID_ME_BFRAME_EARLYSTOP)
+#define CHROMA_ME (XVID_ME_CHROMA_PVOP | XVID_ME_CHROMA_BVOP)
+
+typedef enum
+{
+	ME_NONE = 0,
+	ME_LOW = XVID_ME_HALFPELREFINE16,	
+	ME_MEDIUM = XVID_ME_HALFPELREFINE16 | XVID_ME_ADVANCEDDIAMOND16,	
+	ME_HIGH = XVID_ME_HALFPELREFINE16 | XVID_ME_EXTSEARCH16 | XVID_ME_HALFPELREFINE8 | XVID_ME_USESQUARES16
+} MotionEstimationMode;
+
+typedef enum
+{
+	INTERLACED_NONE,
+	INTERLACED_BFF,
+	INTERLACED_TFF
+} InterlacedMode;
+
+typedef enum
+{
+	RD_NONE = -1,
+	RD_DCT_ME = 0,
+	RD_HPEL_QPEL_16 = RD_DCT_ME | XVID_ME_HALFPELREFINE16_RD | XVID_ME_QUARTERPELREFINE16_RD,
+	RD_HPEL_QPEL_8 = RD_HPEL_QPEL_16 | XVID_ME_HALFPELREFINE8_RD | XVID_ME_QUARTERPELREFINE8_RD | XVID_ME_CHECKPREDICTION_RD,
+	RD_SQUARE = RD_HPEL_QPEL_8 | XVID_ME_EXTSEARCH_RD
+} RateDistortionMode;
+
+typedef enum
+{
+	CQM_H263,
+	CQM_MPEG,
+	CQM_CUSTOM
+} CqmPresetMode;
+
+class XvidOptions : public PluginOptions
+{
+protected:
+	xvid_enc_create_t xvid_enc_create;
+	xvid_enc_frame_t xvid_enc_frame;
+	xvid_plugin_single_t xvid_plugin_single;
+	xvid_plugin_2pass2_t xvid_plugin_2pass2;
+
+	bool _parAsInput;
+	CqmPresetMode _cqmPreset;
+	unsigned char _intraMatrix[64], _interMatrix[64];
+
+	void addOptionsToXml(xmlNodePtr xmlNodeRoot);
+	void parseOptions(xmlNode *node);
+	void parseVuiOptions(xmlNode *node);
+	void parseCqmOption(xmlNode *node, unsigned char matrix[]);
+	void parseSinglePassOptions(xmlNode *node);
+	void parseTwoPassOptions(xmlNode *node);
+
+public:
+	XvidOptions(void);
+	void reset(void);
+
+	void getParameters(xvid_enc_create_t **xvid_enc_create, xvid_enc_frame_t **xvid_enc_frame,
+		xvid_plugin_single_t **xvid_plugin_single, xvid_plugin_2pass2_t **xvid_plugin_2pass2);
+
+	unsigned int getThreads(void);
+	void setThreads(unsigned int threads);
+
+	bool getParAsInput(void);
+	void setParAsInput(bool parAsInput);
+
+	void getPar(unsigned int *width, unsigned int *height);
+	void setPar(unsigned int width, unsigned int height);
+
+	MotionEstimationMode getMotionEstimation(void);
+	void setMotionEstimation(MotionEstimationMode motionEstimation);
+
+	RateDistortionMode getRateDistortion(void);
+	void setRateDistortion(RateDistortionMode rateDistortion);
+
+	bool getBframeRdo(void);
+	void setBframeRdo(bool bFrameRdo);
+
+	bool getChromaMotionEstimation(void);
+	void setChromaMotionEstimation(bool chromaMotionEstimation);
+
+	bool getQpel(void);
+	void setQpel(bool qpel);
+
+	bool getGmc(void);
+	void setGmc(bool gmc);
+
+	bool getTurboMode(void);
+	void setTurboMode(bool turboMode);
+
+	bool getChromaOptimisation(void);
+	void setChromaOptimisation(bool chromaOptimisation);
+
+	bool getInterMotionVector(void);
+	void setInterMotionVector(bool interMotionVector);
+
+	bool getCartoon(void);
+	void setCartoon(bool cartoon);
+
+	bool getGreyscale(void);
+	void setGreyscale(bool greyscale);
+
+	InterlacedMode getInterlaced(void);
+	void setInterlaced(InterlacedMode interlaced);
+
+	unsigned int getFrameDropRatio(void);
+	void setFrameDropRatio(unsigned int frameDropRatio);
+
+	unsigned int getMaxKeyInterval(void);
+	void setMaxKeyInterval(unsigned int maxKeyInterval);
+
+	unsigned int getMaxBframes(void);
+	void setMaxBframes(unsigned int maxBFrames);
+
+	int getBframeSensitivity(void);
+	void setBframeSensitivity(int bFrameSensitivity);
+
+	bool getClosedGop(void);
+	void setClosedGop(bool closedGop);
+
+	bool getPacked(void);
+	void setPacked(bool packed);
+
+	void getMinQuantiser(unsigned int *i, unsigned int *p, unsigned int *b);
+	void setMinQuantiser(unsigned int i, unsigned int p, unsigned int b);
+
+	void getMaxQuantiser(unsigned int *i, unsigned int *p, unsigned int *b);
+	void setMaxQuantiser(unsigned int i, unsigned int p, unsigned int b);
+
+	unsigned int getBframeQuantiserRatio(void);
+	void setBframeQuantiserRatio(unsigned int ratio);
+
+	unsigned int getBframeQuantiserOffset(void);
+	void setBframeQuantiserOffset(unsigned int offset);
+
+	CqmPresetMode getCqmPreset(void);
+	void setCqmPreset(CqmPresetMode cqmPreset);
+
+	void getIntraMatrix(unsigned char intra[64]);
+	void setIntraMatrix(unsigned char intra[64]);
+
+	void getInterMatrix(unsigned char inter[64]);
+	void setInterMatrix(unsigned char inter[64]);
+
+	bool getTrellis(void);
+	void setTrellis(bool trellis);
+
+	unsigned int getReactionDelayFactor(void);
+	void setReactionDelayFactor(unsigned int delayFactor);
+
+	unsigned int getAveragingQuantiserPeriod(void);
+	void setAveragingQuantiserPeriod(unsigned int averagingPeriod);
+
+	unsigned int getSmoother(void);
+	void setSmoother(unsigned int smoother);
+
+	unsigned int getKeyFrameBoost(void);
+	void setKeyFrameBoost(unsigned int keyFrameBoost);
+
+	unsigned int getMaxKeyFrameReduceBitrate(void);
+	void setMaxKeyFrameReduceBitrate(unsigned int bitrateReduction);
+
+	unsigned int getKeyFrameBitrateThreshold(void);
+	void setKeyFrameBitrateThreshold(unsigned int bitrateThreshold);
+
+	unsigned int getOverflowControlStrength(void);
+	void setOverflowControlStrength(unsigned int overflowControlStrength);
+
+	unsigned int getMaxOverflowImprovement(void);
+	void setMaxOverflowImprovement(unsigned int overflowImprovement);
+
+	unsigned int getMaxOverflowDegradation(void);
+	void setMaxOverflowDegradation(unsigned int overflowDegradation);
+
+	unsigned int getAboveAverageCurveCompression(void);
+	void setAboveAverageCurveCompression(unsigned int curveCompression);
+
+	unsigned int getBelowAverageCurveCompression(void);
+	void setBelowAverageCurveCompression(unsigned int curveCompression);
+
+	unsigned int getVbvBufferSize(void);
+	void setVbvBufferSize(unsigned int bufferSize);
+
+	unsigned int getMaxVbvBitrate(void);
+	void setMaxVbvBitrate(unsigned int bitrate);
+
+	unsigned int getVbvPeakBitrate(void);
+	void setVbvPeakBitrate(unsigned int peakBitrate);
+};
+
+#endif	// xvidOptions_h


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002240.html">[Avidemux-svn-commit] r5025 -	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264
</A></li>
	<LI>Next message: <A HREF="002242.html">[Avidemux-svn-commit] r5027 - in	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder:	ADM_vidEnc_avcodec ADM_vidEnc_xvid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2241">[ date ]</a>
              <a href="thread.html#2241">[ thread ]</a>
              <a href="subject.html#2241">[ subject ]</a>
              <a href="author.html#2241">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
