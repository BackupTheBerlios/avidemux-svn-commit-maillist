From gruntster at mail.berlios.de  Thu Dec  2 18:55:51 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu,  2 Dec 2010 18:55:51 +0100
Subject: [Avidemux-svn-commit] r6800 -
	branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame
Message-ID: <20101202175551.F0CC04805E2@sheep.berlios.de>

Author: gruntster
Date: 2010-12-02 18:55:51 +0100 (Thu, 02 Dec 2010)
New Revision: 6800

Modified:
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/Perform Build.bat
Log:
[win] update lame build script

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/Perform Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/Perform Build.bat	2010-11-30 06:24:07 UTC (rev 6799)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/Perform Build.bat	2010-12-02 17:55:51 UTC (rev 6800)
@@ -47,17 +47,11 @@
   move "%CD%\%tarFolder%\%%a" "%CD%"
 )
 
-if "%BuildBits%" == "64" (
-	echo.
-	echo Patching
-	patch -p0 -i "%curDir%\configure.patch"
-	patch -p0 -i "%curDir%\nasm.h.patch"
-)
-
 echo.
 echo Configuring
 
-sh ./configure --prefix="%usrLocalDir%" --disable-static --enable-nasm
+if "%BuildBits%" == "32" sh ./configure --prefix="%usrLocalDir%" --disable-static --enable-nasm
+if "%BuildBits%" == "64" sh ./configure --prefix="%usrLocalDir%" --disable-static
 
 if errorlevel 1 goto end
 echo.



From gruntster at mail.berlios.de  Thu Dec  2 18:59:43 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Thu,  2 Dec 2010 18:59:43 +0100
Subject: [Avidemux-svn-commit] r6801 - in
	branches/avidemux_2.6_branch_mean/foreignBuilds: . mswin
	mswin/avidemux mswin/avidemux/Tools mswin/x264
Message-ID: <20101202175944.4CC384805DD@sheep.berlios.de>

Author: gruntster
Date: 2010-12-02 18:59:43 +0100 (Thu, 02 Dec 2010)
New Revision: 6801

Added:
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/Set Common Environment Variables.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1. Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1a. Pre-build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1b. Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1c. Post-build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2. Create Packages.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2a. Update Notes.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2b. Package SDK.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2c. Package Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Package Notes.xml
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Set Avidemux Environment Variables.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Build Plugins.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Build Qt Translations.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Get Revision Number.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Revision No template.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/gennotes.sh
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/gentouch.sh
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/package_notes.xslt
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/touch_files.xslt
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/x264/
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/x264/Perform Build.bat
Log:
[win] out of date build scripts

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/Set Common Environment Variables.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/Set Common Environment Variables.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/Set Common Environment Variables.bat	2010-12-02 17:59:43 UTC (rev 6801)
@@ -0,0 +1,83 @@
+set ProgramFiles32=%ProgramFiles%
+if "%PROCESSOR_ARCHITECTURE%" == "AMD64" for /D %%d in ("%ProgramFiles(x86)%") do set ProgramFiles32=%%~fsd
+set nsisDir=%ProgramFiles32%\NSIS
+
+set devDir=E:\Dev
+
+if "%BuildBits%" == "32" (
+	set msysDir=E:/Dev/MSYS
+	set qtDir=%devDir%\Qt32
+	set CFLAGS=-m32 
+	set CXXFLAGS=-m32
+	set LDFLAGS=-m32
+	goto :setVars )
+
+if "%BuildBits%" == "64" (
+	set msysDir=E:/Dev/MSYS-64
+	set qtDir=%devDir%\Qt64
+	goto :setVars )
+
+echo Error - BuildBits variable not set
+goto error
+
+:setVars
+set mingwDir=%devDir%\MinGW64
+set usrLocalDir=%msysDir%/local32
+set CMAKE_INCLUDE_PATH=%usrLocalDir%/include
+set CMAKE_LIBRARY_PATH=%usrLocalDir%/lib
+set PKG_CONFIG_PATH=%usrLocalDir%\lib\pkgconfig
+set SDLDIR=%usrLocalDir%
+set CFLAGS=%CFLAGS% -I%CMAKE_INCLUDE_PATH% -L%CMAKE_LIBRARY_PATH%
+set CXXFLAGS=%CXXFLAGS% -I%CMAKE_INCLUDE_PATH% -L%CMAKE_LIBRARY_PATH%
+set LDFLAGS=%LDFLAGS% -shared-libgcc -lstdc++ -L%CMAKE_LIBRARY_PATH%
+
+if exist "%qtDir%" (
+	for /f %%d in ('dir /b /ad /on %qtDir%') do set qtVer=%%d
+) else (
+	echo Qt 4 could not be found at "%qtDir%".  Please download from http://www.trolltech.com
+	goto error
+)
+
+set qtDir=%qtDir%\%qtVer%
+
+if exist "%devDir%\CMake 2.8\bin" (
+	set cmakeDir=%devDir%\CMake 2.8\bin
+	goto foundCMake
+)
+
+if exist "%ProgramFiles32%\CMake 2.8\bin" (
+	set cmakeDir=%ProgramFiles32%\CMake 2.8\bin
+) else (
+	echo CMake could not be found.  Please download from http://www.cmake.org
+	goto error
+)
+
+:foundCMake
+if not exist "%mingwDir%" (
+	echo MinGW could not be found at "%mingwDir%".  Please download from http://www.mingw.org
+	goto error
+)
+
+if not exist "%CMAKE_INCLUDE_PATH%" (
+	echo Include path could not be found at "%CMAKE_INCLUDE_PATH%".
+	goto error
+)
+
+if not exist "%CMAKE_LIBRARY_PATH%" (
+	echo Library path could not be found at "%CMAKE_LIBRARY_PATH%".
+	goto error
+)
+
+if not exist "%nsisDir%" (
+	echo NSIS could not be found at "%nsisDir%".  Please download from http://nsis.sourceforge.net
+	goto error
+)
+
+set PATH=%cmakeDir%;%mingwDir%\bin;%usrLocalDir%\bin;%msysDir%\bin;%msysDir%\local32\bin;%qtDir%\bin;%PATH%
+
+goto end
+
+:error
+exit /b 1
+
+:end
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1. Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1. Build.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1. Build.bat	2010-12-02 17:59:43 UTC (rev 6801)
@@ -0,0 +1,48 @@
+ at echo off
+
+:start
+echo MinGW build for Avidemux
+echo ========================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo 3. Debug build
+echo X. Exit
+echo.
+
+choice /c 123x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 (
+	set DebugFlags=-DCMAKE_BUILD_TYPE=Debug
+	echo.
+	echo -- Debug mode set --
+	echo.
+	goto :start	)
+
+if errorlevel 4 goto end
+
+verify >nul
+echo.
+
+set curDir=%CD%
+
+call "Set Avidemux Environment Variables"
+if errorlevel 1 goto end
+
+cd "%curDir%"
+call "1a. Pre-build"
+if errorlevel 1 goto end
+
+cd "%curDir%"
+call "1b. Perform Build"
+if errorlevel 1 goto end
+
+cd "%curDir%"
+call "1c. Post-build"
+if errorlevel 1 goto end
+
+echo Finished!
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1a. Pre-build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1a. Pre-build.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1a. Pre-build.bat	2010-12-02 17:59:43 UTC (rev 6801)
@@ -0,0 +1,31 @@
+cd "%sourceDir%"
+echo Cleaning build directory (%CD%\%buildFolder%)
+rmdir /s /q "%buildFolder%" 2> NUL
+
+echo Cleaning SDK directory (%sdkBuildDir%)
+rmdir /s /q "%sdkBuildDir%" 2> NUL
+
+if exist "%buildFolder%" goto removalFailure
+if exist "%sdkBuildDir%" goto removalFailure
+
+mkdir "%buildCoreFolder%"
+mkdir "%buildCliFolder%"
+mkdir "%buildGtkFolder%"
+mkdir "%buildQtFolder%"
+mkdir "%buildPluginFolder%"
+mkdir "%sdkBuildDir%"
+
+echo.
+echo Performing Subversion update
+svn up .
+echo.
+
+goto :EOF
+
+:removalFailure
+echo.
+echo ERROR - build directories could not be fully deleted.
+echo Aborting.
+
+:error
+exit /b 1
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1b. Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1b. Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1b. Perform Build.bat	2010-12-02 17:59:43 UTC (rev 6801)
@@ -0,0 +1,60 @@
+cd "%sourceDir%\%buildCoreFolder%"
+cmake -G"MSYS Makefiles" -DCMAKE_INSTALL_PREFIX="%buildDir%" -DUSE_SYSTEM_SPIDERMONKEY=ON -DCMAKE_INCLUDE_PATH="%SpiderMonkeySourceDir%" -DCMAKE_LIBRARY_PATH="%SpiderMonkeyLibDir%" %DebugFlags% ../../avidemux_core
+
+if errorlevel 1 goto error
+pause
+
+cd "%sourceDir%\%buildCliFolder%"
+cmake -G"MSYS Makefiles" -DCMAKE_INSTALL_PREFIX="%buildDir%" -DUSE_SYSTEM_SPIDERMONKEY=ON -DCMAKE_INCLUDE_PATH="%SpiderMonkeySourceDir%" -DCMAKE_LIBRARY_PATH="%SpiderMonkeyLibDir%" %DebugFlags% ../../avidemux/cli
+
+if errorlevel 1 goto error
+pause
+
+cd "%sourceDir%\%buildGtkFolder%"
+cmake -G"MSYS Makefiles" -DCMAKE_INSTALL_PREFIX="%buildDir%" -DUSE_SYSTEM_SPIDERMONKEY=ON -DCMAKE_INCLUDE_PATH="%SpiderMonkeySourceDir%" -DCMAKE_LIBRARY_PATH="%SpiderMonkeyLibDir%" %DebugFlags% ../../avidemux/gtk
+
+if errorlevel 1 goto error
+pause
+
+cd "%sourceDir%\%buildQtFolder%"
+cmake -G"MSYS Makefiles" -DCMAKE_INSTALL_PREFIX="%buildDir%" -DUSE_SYSTEM_SPIDERMONKEY=ON -DCMAKE_INCLUDE_PATH="%SpiderMonkeySourceDir%" -DCMAKE_LIBRARY_PATH="%SpiderMonkeyLibDir%" %DebugFlags% ../../avidemux/qt4
+
+if errorlevel 1 goto error
+pause
+
+set msysSourceDir=%sourceDir:\=/%
+cd "%sourceDir%\%buildPluginFolder%"
+cmake -G"MSYS Makefiles" -DCMAKE_INSTALL_PREFIX="%buildDir%" -DAVIDEMUX_SOURCE_DIR="%msysSourceDir%" -DPLUGIN_UI=ALL %DebugFlags% ../../avidemux_plugins
+
+if errorlevel 1 goto error
+pause
+
+cd "%sourceDir%\%buildCoreFolder%"
+make install
+
+if errorlevel 1 goto error
+
+cd "%sourceDir%\%buildCliFolder%"
+make install
+
+if errorlevel 1 goto error
+
+cd "%sourceDir%\%buildGtkFolder%"
+make install
+
+if errorlevel 1 goto error
+
+cd "%sourceDir%\%buildQtFolder%"
+make install
+
+if errorlevel 1 goto error
+
+cd "%sourceDir%\%buildPluginFolder%"
+rmdir /s /q "%buildDir%\plugins" 2> NUL
+make install
+
+if errorlevel 1 goto error
+goto :EOF
+
+:error
+exit /b 1
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1c. Post-build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1c. Post-build.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1c. Post-build.bat	2010-12-02 17:59:43 UTC (rev 6801)
@@ -0,0 +1,98 @@
+mkdir "%sdkBuildDir%\lib"
+move "%buildDir%\lib\*.a" "%sdkBuildDir%\lib"
+del /s "%buildDir%\*.a"
+
+mkdir "%sdkBuildDir%\plugin-examples"
+cd "%sdkBuildDir%\plugin-examples"
+copy "%curDir%\Tools\Build Plugins.bat" "%sdkBuildDir%\plugin-examples"
+
+mkdir "audioDecoders"
+mkdir "audioDecoders\ac3"
+xcopy /s "%sourceDir%\plugins\ADM_audioDecoders\ADM_ad_ac3" "audioDecoders\ac3"
+
+mkdir "audioDevices"
+mkdir "audioDevices\win32"
+xcopy /s "%sourceDir%\plugins\ADM_audioDevices\Win32" "audioDevices\win32"
+
+mkdir "audioEncoders"
+mkdir "audioEncoders\pcm"
+xcopy /s "%sourceDir%\plugins\ADM_audioEncoders\pcm" "audioEncoders\pcm"
+
+mkdir "videoEncoders"
+mkdir "videoEncoders\mpeg2enc"
+mkdir "videoEncoders\mpeg2enc\common"
+xcopy /s "%sourceDir%\plugins\ADM_videoEncoder\ADM_vidEnc_mpeg2enc" "videoEncoders\mpeg2enc"
+xcopy /s "%sourceDir%\plugins\ADM_videoEncoder\common" "videoEncoders\mpeg2enc\common"
+xcopy /s "%msysDir%\local\lib\libxml2.dll.a" "videoEncoders\mpeg2enc"
+xcopy /s "%msysDir%\local\include\libxml2" "videoEncoders\mpeg2enc"
+rmdir /s/q "videoEncoders\mpeg2enc\mpeg2enc\altivec"
+
+mkdir "videoFilters"
+mkdir "videoFilters\fade"
+xcopy /s "%sourceDir%\plugins\ADM_videoFilters\Fade" "videoFilters\fade"
+
+del /s CMakeLists.txt
+
+mkdir "%sdkBuildDir%\include"
+mkdir "%sdkBuildDir%\include\ADM_encoder"
+mkdir "%sdkBuildDir%\include\libavutil"
+cd "%sdkBuildDir%\include"
+
+copy "%sourceDir%\%buildFolder%\config\ADM_coreConfig.h"
+copy "%sourceDir%\%buildFolder%\config\libavutil\avconfig.h" libavutil
+copy "%sourceDir%\avidemux\ADM_audiocodec\ADM_ad_plugin.h"
+copy "%sourceDir%\avidemux\ADM_audiocodec\ADM_audiocodec.h"
+copy "%sourceDir%\avidemux\ADM_audiodevice\ADM_audiodevice.h"
+copy "%sourceDir%\avidemux\ADM_audiodevice\ADM_audioDeviceInternal.h"
+copy "%sourceDir%\avidemux\ADM_core\include\ADM_assert.h"
+copy "%sourceDir%\avidemux\ADM_core\include\ADM_clock.h"
+copy "%sourceDir%\avidemux\ADM_core\include\ADM_cpucap.h"
+copy "%sourceDir%\avidemux\ADM_core\include\ADM_default.h"
+copy "%sourceDir%\avidemux\ADM_core\include\ADM_dynamicLoading.h"
+copy "%sourceDir%\avidemux\ADM_core\include\ADM_files.h"
+copy "%sourceDir%\avidemux\ADM_core\include\ADM_inttype.h"
+copy "%sourceDir%\avidemux\ADM_core\include\ADM_mangle.h"
+copy "%sourceDir%\avidemux\ADM_core\include\ADM_misc.h"
+copy "%sourceDir%\avidemux\ADM_coreAudio\include\ADM_audioCodecEnum.h"
+copy "%sourceDir%\avidemux\ADM_coreAudio\include\ADM_audiodef.h"
+copy "%sourceDir%\avidemux\ADM_coreAudio\include\ADM_audioFilter.h"
+copy "%sourceDir%\avidemux\ADM_coreAudio\include\ADM_coreAudio.h"
+copy "%sourceDir%\avidemux\ADM_coreAudio\include\audioencoder.h"
+copy "%sourceDir%\avidemux\ADM_coreAudio\include\audioencoderInternal.h"
+copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_confCouple.h"
+copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_image.h"
+copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_rgb.h"
+copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_videoFilter.h"
+copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_videoFilterCache.h"
+copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_videoFilterDynamic.h"
+copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_videoFilter_iface.h"
+copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_videoFilter_internal.h"
+copy "%sourceDir%\avidemux\ADM_coreUI\include\DIA_coreToolkit.h"
+copy "%sourceDir%\avidemux\ADM_coreUI\include\DIA_factory.h"
+copy "%sourceDir%\avidemux\ADM_coreUI\include\DIA_uiTypes.h"
+copy "%sourceDir%\avidemux\ADM_encoder\ADM_vidEncode.hxx" ADM_encoder
+copy "%sourceDir%\avidemux\ADM_libraries\ffmpeg\libavutil\pixfmt.h" libavutil
+copy "%sourceDir%\avidemux\ADM_plugin\ADM_vidEnc_plugin.h"
+copy "%sourceDir%\avidemux\ADM_plugin\ADM_plugin_translate.h"
+
+cd "%sourceDir%\po"
+svn revert -R .
+sh qt_update_pro.sh
+echo ./avidemux_blank.ts >> avidemux.pro
+lupdate avidemux.pro
+
+mkdir "%sdkBuildDir%\i18n"
+mkdir "%sdkBuildDir%\i18n\qt4"
+mkdir "%sdkBuildDir%\i18n\gtk"
+
+copy *.ts "%sdkBuildDir%\i18n\qt4"
+copy qt_filter_context.xslt "%sdkBuildDir%\i18n\qt4\qt_filter_context.xsl"
+copy "%curDir%\Tools\Build Qt Translations.bat" "%sdkBuildDir%\i18n\qt4\Build Translations.bat"
+
+del avidemux_blank.ts
+
+sh update_pot.bash
+copy avidemux.pot "%sdkBuildDir%\i18n\gtk"
+for %%A in (*.po) do msgmerge %%A avidemux.pot -o "%sdkBuildDir%\i18n\gtk\%%A"
+
+svn revert -R .
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2. Create Packages.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2. Create Packages.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2. Create Packages.bat	2010-12-02 17:59:43 UTC (rev 6801)
@@ -0,0 +1,49 @@
+ at echo off
+
+echo Package Avidemux
+echo ================
+echo 1. 32-bit package
+echo 2. 64-bit package
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto end
+
+verify >nul
+echo.
+
+set curDir=%CD%
+
+call "Set Avidemux Environment Variables"
+if errorlevel 1 goto error
+
+cd "%curDir%"
+call "2a. Update Notes.bat"
+if errorlevel 1 goto error
+
+cd "%curDir%\Tools"
+call "Get Revision Number"
+cd ..
+
+set packageDir=%CD%\%revisionNo%
+mkdir %packageDir%
+
+cd "%curDir%"
+call "2b. Package SDK.bat"
+if errorlevel 1 goto error
+
+cd "%curDir%"
+call "2c. Package Build.bat"
+if errorlevel 1 goto error
+
+goto end
+
+:error
+exit /b 1
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2a. Update Notes.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2a. Update Notes.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2a. Update Notes.bat	2010-12-02 17:59:43 UTC (rev 6801)
@@ -0,0 +1,20 @@
+set PATH=%msysDir%\bin;%PATH%
+
+echo -- Generating Change Log.html --
+cd "..\..\installer"
+sh genlog.sh
+
+echo -- Generating Package Notes.html --
+cd "%curDir%\Tools"
+sh gennotes.sh
+
+echo -- Generating Touch Files.html --
+sh gentouch.sh
+
+goto end
+
+:error
+exit /b 1
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2b. Package SDK.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2b. Package SDK.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2b. Package SDK.bat	2010-12-02 17:59:43 UTC (rev 6801)
@@ -0,0 +1,6 @@
+set baseFile=avidemux_sdk_2.5_r%revisionNo%_win%BuildBits%
+set zipFile=%baseFile%.zip
+
+cd "%sdkBuildDir%"
+zip -r "%packageDir%\%zipFile%" *
+advzip -z -4 "%packageDir%\%zipFile%"
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2c. Package Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2c. Package Build.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2c. Package Build.bat	2010-12-02 17:59:43 UTC (rev 6801)
@@ -0,0 +1,27 @@
+set baseFile=avidemux_2.5_r%revisionNo%_win%BuildBits%
+set zipFile=%baseFile%.zip
+
+copy "%buildDir%\Change Log.html" "%packageDir%"
+move "Tools\Package Notes.html" "%packageDir%"
+
+cd %buildDir%
+echo -- Generating GTK+ Installer --
+"%nsisDir%\makensis" /V2 /NOCD /DINST_GTK /DBUILD_BITS=%BuildBits% /DNSIDIR="%curDir%\..\..\installer" /DEXEDIR="%packageDir%" "%curDir%\..\..\installer\avidemux.nsi"
+echo -- Generating Qt Installer --
+"%nsisDir%\makensis" /V2 /NOCD /DINST_QT /DBUILD_BITS=%BuildBits% /DNSIDIR="%curDir%\..\..\installer" /DEXEDIR="%packageDir%" "%curDir%\..\..\installer\avidemux.nsi"
+
+mkdir "%packageDir%\temp"
+cd "%packageDir%\temp"
+"%SevenZipDir%\7z" x "%packageDir%\%baseFile%.exe"
+rmdir /s/q $PLUGINSDIR
+mkdir scripts
+move $_OUTDIR\auto scripts
+move $_OUTDIR\video scripts
+mkdir etc\fonts\conf.d
+copy "%buildDir%\etc\fonts\conf.d" etc\fonts\conf.d\
+move $_OUTDIR\conf.avail etc\fonts
+rmdir /s/q $_OUTDIR
+zip -r "%packageDir%\%zipFile%" *
+cd %curDir%
+advzip -z -4 "%packageDir%\%zipFile%"
+rmdir /s/q "%packageDir%\temp"
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Package Notes.xml
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Package Notes.xml	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Package Notes.xml	2010-12-02 17:59:43 UTC (rev 6801)
@@ -0,0 +1,259 @@
+<?xml version="1.0"?>
+<log>
+	<buildentry revision="6587" date="2010-09-05">
+		<comment>Compiled with GCC 4.5.1.</comment>
+		<comment>Updated Cairo to version 1.8.10-4.</comment>
+		<comment>Updated Freetype to version 2.4.2-1.</comment>
+		<comment>Updated GLib to version 2.24.2-1.</comment>
+		<comment>Updated libvpx to version 0.9.2.</comment>
+		<comment>Updated NSPR to version 4.8.6.</comment>
+		<comment>Updated Pango to version 1.28.1-1.</comment>
+		<comment>Updated x264 to r1713.</comment>
+		<comment>Updated zlib to version 1.2.5-2.</comment>
+	</buildentry>
+	<buildentry revision="6502" date="2010-08-03">
+		<comment>Updated x264 to r1688.</comment>
+	</buildentry>
+	<buildentry revision="6442" date="2010-07-06">
+		<comment>Compiled with GCC 4.4.5 pre-release (r161668).</comment>
+		<comment>Updated libvpx to version 0.9.1.</comment>
+		<comment>Updated x264 to r1666.</comment>
+	</buildentry>
+	<buildentry revision="6370" date="2010-06-13">
+		<comment>Added libvpx, git version (commit: 5ef25a9728507d259c6ccd05064ce1208e7abd9f).</comment>
+		<comment>Updated x264 to r1624.</comment>
+	</buildentry>
+	<buildentry revision="6340" date="2010-06-07">
+	</buildentry>
+	<buildentry revision="6303" date="2010-06-04">
+	</buildentry>
+	<buildentry revision="6288" date="2010-06-01">
+	</buildentry>
+	<buildentry revision="6261" date="2010-05-27">
+		<comment>Updated x264 to r1613.</comment>
+	</buildentry>
+	<buildentry revision="6195" date="2010-05-16">
+		<comment>Updated Freetype to version 2.3.12-1.</comment>
+		<comment>Updated GLib to version 2.24.1-1.</comment>
+		<comment>Updated GTK+ to version 2.20.1-1.</comment>
+		<comment>Updated x264 to r1583.</comment>
+	</buildentry>
+	<buildentry revision="6161 [2.5.3 Final]" date="2010-05-16">
+		<comment>Updated Avisynth Proxy GUI to version 2.12.</comment>
+	</buildentry>
+	<buildentry revision="6129" date="2010-04-15">
+		<comment>Updated x264 to r1542.</comment>
+	</buildentry>
+	<buildentry revision="6121" date="2010-04-11">
+		<comment>Updated ATK to version 1.30.0-1.</comment>
+		<comment>Updated Cairo to version 1.8.10-3.</comment>
+		<comment>Updated GLib to version 2.24.0-2.</comment>
+		<comment>Updated GTK+ to version 2.20.0-1.</comment>
+		<comment>Updated Libxml2 to version 2.7.7-1.</comment>
+		<comment>Updated Pango to version 1.28.0-1.</comment>
+		<comment>Updated x264 to r1523.</comment>
+		<comment>Updated zlib to version 1.2.4-2.</comment>
+	</buildentry>
+	<buildentry revision="6083" date="2010-04-06">
+	</buildentry>
+	<buildentry revision="6064" date="2010-04-05">
+		<comment>Updated x264 to r1510.</comment>
+	</buildentry>
+	<buildentry revision="6028" date="2010-03-27">
+		<comment>Updated Avisynth Proxy GUI to version 2.11.</comment>
+		<comment>Updated GLib to version 2.22.5-1.</comment>
+		<comment>Updated GTK+ to version 2.18.9-1.</comment>
+		<comment>Updated LAME to version 3.98.4.</comment>
+		<comment>Updated Ogg to version 1.2.0.</comment>
+		<comment>Updated NSPR to version 4.8.4.</comment>
+		<comment>Updated Vorbis to version 1.3.1.</comment>
+	</buildentry>
+	<buildentry revision="5955" date="2010-02-28">
+		<comment>Compiled with GCC 4.4.3.</comment>
+		<comment>Updated Cairo to version 1.8.10-1.</comment>
+		<comment>Updated Freetype to version 2.3.11-2.</comment>
+		<comment>Updated GTK+ to version 2.18.7-1.</comment>
+		<comment>Updated LAME to version 3.98.3.</comment>
+		<comment>Updated libpng to version 1.4.0-1.</comment>
+		<comment>Updated NSPR to version 4.8.3.</comment>
+		<comment>Updated Pango to version 1.26.2-1.</comment>
+		<comment>Updated Qt to version 4.6.2.</comment>
+		<comment>Updated x264 to r1471.</comment>
+	</buildentry>
+	<buildentry revision="5869" date="2010-01-23">
+		<comment>Updated GLib to version 2.22.4-1.</comment>
+		<comment>Updated Qt to version 4.6.1.</comment>
+		<comment>Updated x264 to r1400.</comment>
+	</buildentry>
+	<buildentry revision="5830" date="2010-01-07">
+		<comment>Compiled with GCC 4.4.3 pre-release (r155431).</comment>
+	</buildentry>
+	<buildentry revision="5810" date="2010-01-02">
+	</buildentry>
+	<buildentry revision="5801" date="2009-12-31">
+	</buildentry>
+	<buildentry revision="5775" date="2009-12-29">
+	</buildentry>
+	<buildentry revision="5747" date="2009-12-28">
+	</buildentry>
+	<buildentry revision="5676" date="2009-12-20">
+		<comment>Packaged using NSIS 2.46.</comment>
+		<comment>Updated GTK+ to version 2.18.5-1.</comment>
+		<comment>Updated libpng to version 1.2.40-1.</comment>
+		<comment>Updated Pango to version 1.26.1-1.</comment>
+		<comment>Updated Qt to version 4.6.0.</comment>
+		<comment>Updated x264 to r1376.</comment>
+	</buildentry>
+	<buildentry revision="5660 [2.5.2 Final]" date="2009-12-19">
+	</buildentry>
+	<buildentry revision="5636 [2.5.2 RC1]" date="2009-12-12">
+	</buildentry>
+	<buildentry revision="5602" date="2009-11-30">
+	</buildentry>
+	<buildentry revision="5590" date="2009-11-28">
+		<comment>Updated Cairo to version 1.8.8-3.</comment>
+		<comment>Updated Fontconfig to version 2.8.0-1.</comment>
+		<comment>Updated Freetype to version 2.3.11-1.</comment>
+		<comment>Updated GLib to version 2.22.2-1.</comment>
+		<comment>Updated GTK+ to version 2.18.3-1.</comment>
+		<comment>Updated Pango to version 1.26.0-1.</comment>
+		<comment>Updated x264 to r1352.</comment>
+	</buildentry>
+	<buildentry revision="5567" date="2009-11-26">
+	</buildentry>
+	<buildentry revision="5558" date="2009-11-24">
+	</buildentry>
+	<buildentry revision="5546" date="2009-11-23">
+		<comment>Updated x264 to r1347.</comment>
+	</buildentry>
+	<buildentry revision="5530" date="2009-11-19">
+		<comment>Updated x264 to r1342.</comment>
+	</buildentry>
+	<buildentry revision="5422" date="2009-10-27">
+		<comment>Updated SDL to version 1.2.14.</comment>
+		<comment>Updated x264 to r1310.</comment>
+	</buildentry>
+	<buildentry revision="5369" date="2009-10-05">
+		<comment>Updated ATK to version 1.28.0-1.</comment>
+		<comment>Updated Fontconfig to version 2.7.3-1.</comment>
+		<comment>Updated GLib to version 2.22.1-1.</comment>
+		<comment>Updated GTK+ to version 2.18.1-1.</comment>
+		<comment>Updated libpng to version 1.2.39-1.</comment>
+		<comment>Updated Libxml2 to version 2.7.4-1.</comment>
+		<comment>Updated NSPR to version 4.8.</comment>
+		<comment>Updated opencore-amr to version 0.1.2.</comment>
+		<comment>Updated Qt to version 4.5.3.</comment>
+		<comment>Updated x264 to r1271.</comment>
+	</buildentry>
+	<buildentry revision="5341" date="2009-09-17">
+		<comment>Updated x264 to r1259.</comment>
+	</buildentry>
+	<buildentry revision="5327" date="2009-09-09">
+		<comment>Updated x264 to r1251.</comment>
+	</buildentry>
+	<buildentry revision="5281" date="2009-08-29">
+		<comment>Updated x264 to r1240.</comment>
+	</buildentry>
+	<buildentry revision="5273" date="2009-08-27">
+		<comment>Updated x264 to r1235.</comment>
+		<comment>Updated Xvid to version 1.2.2.</comment>
+	</buildentry>
+	<buildentry revision="5268" date="2009-08-23">
+		<comment>Updated x264 to r1222.</comment>
+	</buildentry>
+	<buildentry revision="5249 [2.5.1 Final]" date="2009-08-16">
+		<comment>Updated Fontconfig to version 2.7.1-2.</comment>
+	</buildentry>
+	<buildentry revision="5234" date="2009-08-12">
+		<comment>Updated Cairo to version 1.8.8-1.</comment>
+		<comment>Updated Fontconfig to version 2.7.1-1.</comment>
+		<comment>Updated Freetype to version 2.3.9-1.</comment>
+		<comment>Updated GLib to version 2.20.4-1.</comment>
+		<comment>Updated GTK+ to version 2.16.5-1.</comment>
+		<comment>Updated libpng to version 1.2.38-1.</comment>
+		<comment>Updated Pango to version 1.24.5-1.</comment>
+		<comment>Updated x264 to r1206.</comment>
+	</buildentry>
+	<buildentry revision="5204" date="2009-08-03">
+	</buildentry>
+	<buildentry revision="5181" date="2009-07-30">
+		<comment>Updated x264 to r1195.</comment>
+	</buildentry>
+	<buildentry revision="5152" date="2009-07-25">
+		<comment>Updated Avisynth Proxy GUI to version 2.09d.</comment>
+		<comment>Updated x264 to r1185.</comment>
+	</buildentry>
+	<buildentry revision="5104" date="2009-07-17">
+		<comment>Added opencore-amr version 0.1.1.</comment>
+		<comment>Updated x264 to r1183.</comment>
+	</buildentry>
+	<buildentry revision="5087" date="2009-07-13">
+	</buildentry>
+	<buildentry revision="5065" date="2009-07-12">
+		<comment>Updated Vorbis to version 1.2.3.</comment>
+		<comment>Updated x264 to r1181.</comment>
+	</buildentry>
+	<buildentry revision="5031" date="2009-07-10">
+		<comment>Recompiled FAAC with MinGW's GCC 4.2.1-sjlj-2.</comment>
+		<comment>Updated x264 to r1179.</comment>
+	</buildentry>
+	<buildentry revision="5010" date="2009-07-06">
+	</buildentry>
+	<buildentry revision="4997" date="2009-07-05">
+	</buildentry>
+	<buildentry revision="4992" date="2009-07-04">
+		<comment>Updated FAAC to version 1.28.</comment>
+		<comment>Updated FAAD2 to version 2.7.</comment>
+	</buildentry>
+	<buildentry revision="4968" date="2009-06-27">
+		<comment>Updated ATK to version 1.26.0-1.</comment>
+		<comment>Updated GLib to version 2.20.3-1.</comment>
+		<comment>Updated GTK+ to version 2.16.2-1.</comment>
+		<comment>Updated libpng to version 1.2.37-1.</comment>
+		<comment>Updated Ogg to version 1.1.4.</comment>
+		<comment>Updated Pango to version 1.24.2-1.</comment>
+		<comment>Updated Qt to version 4.5.2.</comment>
+		<comment>Updated Vorbis to version 1.2.2.</comment>
+		<comment>Updated x264 to r1173.</comment>
+	</buildentry>
+	<buildentry revision="4944 [2.5.0 Final]" date="2009-06-23">
+		<comment>Updated x264 to r1170.</comment>
+	</buildentry>
+	<buildentry revision="4871" date="2009-05-25">
+		<comment>Updated x264 to r1159.</comment>
+	</buildentry>
+	<buildentry revision="4763" date="2009-04-26">
+		<comment>Added Netscape Portable Runtime version 4.7.4.</comment>
+		<comment>Updated Pango to version 1.24.1-1.</comment>
+		<comment>Updated Qt to version 4.5.1.</comment>
+		<comment>Updated SpiderMonkey to version 1.7.0.</comment>
+	</buildentry>
+	<buildentry revision="4758" date="2009-04-22">
+		<comment>Updated Avisynth Proxy GUI to version 2.08.</comment>
+		<comment>Updated x264 to r1145.</comment>
+	</buildentry>
+	<buildentry revision="4741" date="2009-04-20">
+		<comment>Updated GLib to version 2.20.1-1.</comment>
+		<comment>Updated GTK+ to version 2.16.1-1.</comment>
+		<comment>Updated Pango to version 1.24.0-1.</comment>
+	</buildentry>
+	<buildentry revision="4685" date="2009-03-14">
+	</buildentry>
+	<buildentry revision="4658" date="2009-03-05">
+		<comment>Updated Qt to version 4.5.0.</comment>
+	</buildentry>
+	<buildentry revision="4648" date="2009-03-02">
+		<comment>Updated x264 to r1115.</comment>
+	</buildentry>
+	<buildentry revision="4629" date="2009-02-24">
+	</buildentry>
+	<buildentry revision="4618" date="2009-02-21">
+		<comment>Updated x264 to r1114.</comment>
+	</buildentry>
+	<buildentry revision="4609" date="2009-02-16">
+		<comment>Packaged using NSIS 2.43.</comment>
+		<comment>Updated Avisynth Proxy GUI to version 2.07 (2nd release).</comment>
+		<comment>Updated Libxml2 to version 2.7.3.</comment>
+		<comment>Updated x264 to r1113.</comment>
+	</buildentry>
+</log>

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Set Avidemux Environment Variables.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Set Avidemux Environment Variables.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Set Avidemux Environment Variables.bat	2010-12-02 17:59:43 UTC (rev 6801)
@@ -0,0 +1,67 @@
+call "..\Set Common Environment Variables"
+
+if errorlevel 1 goto error
+
+zip > NUL 2> NUL
+if errorlevel 1 (
+	echo Info-ZIP could not be found in the PATH.  Please download from http://www.info-zip.org
+	goto error
+)
+
+advzip > NUL 2> NUL
+if errorlevel 1 (
+	echo AdvanceCOMP could not be found in the PATH.  Please download from http://advancemame.sourceforge.net
+	goto error
+)
+
+svn help > NUL 2> NUL
+if errorlevel 1 (
+	echo Subversion could not be found in the PATH.  Please download from http://subversion.tigris.org/
+	goto error
+)
+
+xsltproc --version > NUL 2> NUL
+if errorlevel 1 (
+	echo xsltproc could not be found in the PATH.  Please download from http://www.zlatkovic.com
+	goto error
+)
+
+if exist "%ProgramFiles32%\7-zip" (
+	set SevenZipDir=%ProgramFiles32%\7-zip
+) else (
+	echo 7-zip could not be found.  Please download from http://www.7-zip.org
+	goto error
+)
+
+set buildFolder=build%BuildBits%
+set buildCoreFolder=%buildFolder%\core
+set buildCliFolder=%buildFolder%\cli
+set buildGtkFolder=%buildFolder%\gtk
+set buildQtFolder=%buildFolder%\qt
+set buildPluginFolder=%buildFolder%\plugins
+
+set buildDir=%devDir%\avidemux_2.6_build%BuildBits%
+set sdkBuildDir=%devDir%\avidemux_2.6_build%BuildBits%_sdk
+
+set curDir=%CD%
+cd ..\..\..
+set sourceDir=%CD%
+cd "%curDir%"
+
+if not exist "%sourceDir%" (
+	echo Source directory could not be found at "%sourceDir%".
+	goto error
+)
+
+if "%BuildBits%" == "32" (set jsFolder=js)
+if "%BuildBits%" == "64" (set jsFolder=js-64)
+
+set SpiderMonkeySourceDir=%devDir%\%jsFolder%\src
+set SpiderMonkeyLibDir=%devDir%\%jsFolder%\src\WINNT6.1_OPT.OBJ
+
+goto end
+
+:error
+exit /b 1
+
+:end
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Build Plugins.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Build Plugins.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Build Plugins.bat	2010-12-02 17:59:43 UTC (rev 6801)
@@ -0,0 +1,55 @@
+ at echo off
+
+if "%1" == "" (
+	echo Usage: "Build Plugins.bat" [MinGW directory]
+	echo e.g. "Build Plugins.bat" C:\MinGW
+	goto :EOF
+)
+
+set curDir=%CD%
+set includeDir="%curDir%\..\include"
+set libDir="%curDir%\..\lib"
+set ar="%1\bin\ar"
+set gcc="%1\bin\gcc" -O3 -DNDEBUG
+set gxx="%1\bin\g++" -O3 -DNDEBUG -Wl,-enable-auto-import -Wl,-s
+
+echo ** AC-3 Audio Decoder **
+
+cd audioDecoders\ac3\ADM_liba52
+%gcc% -c *.c -I%includeDir% -L%libDir% -lADM_core.dll
+%ar% rs libADM_liba52.a *.o
+cd ..
+%gxx% -shared *.cpp -o libADM_ad_a52.dll -I%includeDir% -LADM_liba52 -lADM_liba52 -L%libDir% -lADM_core.dll
+cd %curDir%
+
+echo.
+echo ** Win32 Audio Device **
+
+cd audioDevices\win32
+%gxx% -shared *.cpp -o libADM_av_win32.dll -I%includeDir% -L%libDir% -lADM_core.dll -lADM_coreAudio.dll -lwinmm
+cd %curDir%
+
+echo.
+echo ** PCM Audio Encoder **
+
+cd audioEncoders\pcm
+%gxx% -shared *.cpp -o libADM_ae_pcm.dll -I%includeDir% -L%libDir% -lADM_core.dll -lADM_coreAudio.dll
+cd %curDir%
+
+echo.
+echo ** mpeg2enc Video Encoder **
+
+cd videoEncoders\mpeg2enc\mpeg2enc
+%gcc% -c *.c *.cc -I. -I%includeDir% -DHAVE_CONFIG_H -DHAVE_X86CPU
+%ar% rs libmpeg2enc.a *.o
+cd ..
+%gcc% -c *.c -I%includeDir%
+%gxx% -shared *.o *.cpp common\pluginOptions\*.cpp common\xvidRateCtl\*.cpp -o libADM_vidEnc_mpeg2enc.dll -I%includeDir% -I. -I.\mpeg2enc -I.\common\pluginOptions -I.\common\xvidRateCtl -DMPEG1_PLUGIN_CONFIG_DIR=\"mpeg2enc/mpeg-1\" -DMPEG2_PLUGIN_CONFIG_DIR=\"mpeg2enc/mpeg-2\" -L. -lxml2.dll -Lmpeg2enc -lmpeg2enc -L%libDir% -lADM_coreUI.dll -lADM_core.dll
+cd %curDir%
+
+echo.
+echo ** Fade Video Filter **
+
+cd videoFilters\fade
+%gxx% -shared *.cpp -o libADM_vf_fade.dll -I%includeDir% -L%libDir% -lADM_coreImage.dll -lADM_core.dll -lADM_coreUI.dll
+cd %curDir%
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Build Qt Translations.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Build Qt Translations.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Build Qt Translations.bat	2010-12-02 17:59:43 UTC (rev 6801)
@@ -0,0 +1,23 @@
+ at echo off
+
+if "%1" == "" (
+	echo Usage: "Build Translations.bat" [Qt directory]
+	echo e.g. "Build Translations.bat" C:\Qt\4.5.3
+	goto :EOF
+)
+
+for %%A in (avidemux*.ts) do (
+	echo.
+	echo Building %%~nA
+	echo.
+	"%1\bin\xmlpatterns" qt_filter_context.xsl "%%A" -output "%%~nA.xml"
+	"%1\bin\lrelease" "%%~nA.xml" -qm "%%~nA.qm"
+	del "%%~nA.xml"
+)
+
+for %%A in (qt*.ts) do (
+	echo.
+	echo Building %%~nA
+	echo.
+	"%1\bin\lrelease" "%%A"
+)

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Get Revision Number.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Get Revision Number.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Get Revision Number.bat	2010-12-02 17:59:43 UTC (rev 6801)
@@ -0,0 +1,10 @@
+if not exist "..\..\..\installer\revision.nsh" goto end
+
+copy "Revision No template.bat" + "..\..\..\installer\revision.nsh" temp.bat > NUL
+
+call temp.bat
+del temp.bat
+
+set revisionNo=%revisionNo:~17,4%
+
+:end
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Revision No template.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Revision No template.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Revision No template.bat	2010-12-02 17:59:43 UTC (rev 6801)
@@ -0,0 +1 @@
+set revisionNo=
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/gennotes.sh
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/gennotes.sh	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/gennotes.sh	2010-12-02 17:59:43 UTC (rev 6801)
@@ -0,0 +1 @@
+xsltproc package_notes.xslt "../Package Notes.xml" > "Package Notes.html"
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/gentouch.sh
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/gentouch.sh	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/gentouch.sh	2010-12-02 17:59:43 UTC (rev 6801)
@@ -0,0 +1 @@
+xsltproc touch_files.xslt "../Package Notes.xml" > "../Touch 2.5 Files.html"
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/package_notes.xslt
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/package_notes.xslt	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/package_notes.xslt	2010-12-02 17:59:43 UTC (rev 6801)
@@ -0,0 +1,127 @@
+<?xml version="1.0" encoding="utf-8"?>
+
+<xsl:stylesheet version="1.0"
+    xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
+  <xsl:output method="html" indent="yes" />
+
+  <xsl:template match="log">
+    <html>
+      <head>
+        <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type" />
+        <style type="text/css">
+          body {
+          margin: 10px 15px 0px 15px;
+          height: 100%;
+          font-size: 82%;
+          }
+
+          h1 {
+          padding: 0;
+          font-family: Helvetica,Arial,sans-serif;
+          font-size: 1.7em;
+          font-weight: bold;
+          color: #1B57B1;
+          vertical-align: bottom;
+          text-align: center;
+          width: 100%;
+          }
+
+          div, p, table, td, th {
+          font-family: Tahoma,Helvetica,Arial,sans-serif;
+          font-size: 1em;
+          color: #333;
+          }
+
+          table.build {
+          border-collapse: collapse;
+          border: 1px solid #ccc;
+          }
+
+          table.build td, table.roadmap th {
+          border: 1px solid #ccc;
+          }
+
+          table.build th {
+          background: #ddd;
+          padding: 5px;
+          }
+
+          table.build td {
+          background: #f7f7f7;
+          padding-left: 15px;
+          padding-right: 15px;
+          padding-top: 5px;
+          padding-bottom: 5px;
+          }
+        </style>
+        <title>Avidemux 2.5 Win32 Package Notes</title>
+      </head>
+      <body>
+        <h1>Avidemux 2.5 Win32 Package Notes</h1>
+        <div>
+          <xsl:apply-templates select="buildentry" />
+        </div>
+      </body>
+    </html>
+  </xsl:template>
+
+  <xsl:template match="buildentry">
+    <p>
+      <b>
+        <xsl:text>Revision&#160;</xsl:text>
+        <xsl:value-of select="@revision"/>
+      </b>
+      <xsl:text>&#160;(</xsl:text>
+      <xsl:call-template name="FormatDate">
+        <xsl:with-param name="Date" select="@date" />
+      </xsl:call-template>
+      <xsl:text>)</xsl:text>
+      <br/>
+
+      <xsl:for-each select="comment">
+        <li>
+          <xsl:value-of select="."/>
+        </li>
+      </xsl:for-each>
+    </p>
+  </xsl:template>
+
+  <xsl:template name="FormatDate">
+    <xsl:param name="Date"/>
+
+    <!-- Day -->
+    <xsl:value-of select="substring($Date, 9, 2)" />
+    <xsl:text>&#160;</xsl:text>
+
+    <!-- Month -->
+    <xsl:call-template name="FormatMonth">
+      <xsl:with-param name="Month" select="substring($Date, 6, 2)" />
+    </xsl:call-template>
+    <xsl:text>&#160;</xsl:text>
+
+    <!-- Year -->
+    <xsl:value-of select="substring($Date, 1, 4)"/>
+    <!-- <xsl:text>&#160;</xsl:text>-->
+
+    <!-- Time -->
+    <!-- <xsl:value-of select="substring($Date, 12, 8)"/>-->
+  </xsl:template>
+
+  <xsl:template name="FormatMonth">
+    <xsl:param name="Month"/>
+    <xsl:choose>
+      <xsl:when test="$Month = '01'">Jan</xsl:when>
+      <xsl:when test="$Month = '02'">Feb</xsl:when>
+      <xsl:when test="$Month = '03'">Mar</xsl:when>
+      <xsl:when test="$Month = '04'">Apr</xsl:when>
+      <xsl:when test="$Month = '05'">May</xsl:when>
+      <xsl:when test="$Month = '06'">Jun</xsl:when>
+      <xsl:when test="$Month = '07'">Jul</xsl:when>
+      <xsl:when test="$Month = '08'">Aug</xsl:when>
+      <xsl:when test="$Month = '09'">Sep</xsl:when>
+      <xsl:when test="$Month = '10'">Oct</xsl:when>
+      <xsl:when test="$Month = '11'">Nov</xsl:when>
+      <xsl:when test="$Month = '12'">Dec</xsl:when>
+    </xsl:choose>
+  </xsl:template>
+</xsl:stylesheet>
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/touch_files.xslt
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/touch_files.xslt	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/touch_files.xslt	2010-12-02 17:59:43 UTC (rev 6801)
@@ -0,0 +1,152 @@
+<xsl:stylesheet version="1.0"
+    xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
+  <xsl:output method="html" indent="yes" />
+
+  <xsl:template match="/">
+    <xsl:text disable-output-escaping="yes">&lt;?php
+      function touchDirContents($path, $time)
+      {
+        $dirHandle = opendir($path);
+
+        while (($resource = readdir($dirHandle)) != false)
+        {
+          if (is_file($path . "/" . $resource))
+          {
+            touch($path . "/" . $resource, $time);
+          }
+        }
+
+        closedir($dirHandle);
+      }
+      </xsl:text>
+    <xsl:apply-templates select="log" />
+    <xsl:text disable-output-escaping="yes">?&gt;</xsl:text>
+  </xsl:template>
+
+  <xsl:template match="log" mode="php">
+    <script language="php">
+      <xsl:apply-templates select="buildentry" />
+    </script>
+  </xsl:template>
+
+  <xsl:template match="buildentry">
+    <xsl:variable name="fileName">
+      <xsl:call-template name="getFileName">
+        <xsl:with-param name="revision" select="@revision" />
+      </xsl:call-template>
+    </xsl:variable>
+    <xsl:variable name="day">
+      <xsl:call-template name="getDay">
+        <xsl:with-param name="date" select="@date" />
+      </xsl:call-template>
+    </xsl:variable>
+    <xsl:variable name="month">
+      <xsl:call-template name="getMonth">
+        <xsl:with-param name="date" select="@date" />
+      </xsl:call-template>
+    </xsl:variable>
+    <xsl:variable name="year">
+      <xsl:call-template name="getYear">
+        <xsl:with-param name="date" select="@date" />
+      </xsl:call-template>
+    </xsl:variable>
+
+    <xsl:text>touch("</xsl:text>
+    <xsl:value-of select="$fileName" />
+    <xsl:text>", mktime(0, 0, 0, </xsl:text>
+    <xsl:value-of select="$month" />
+    <xsl:text>, </xsl:text>
+    <xsl:value-of select="$day" />
+    <xsl:text>, </xsl:text>
+    <xsl:value-of select="$year" />
+    <xsl:text>)); </xsl:text>
+
+    <xsl:text>touchDirContents("</xsl:text>
+    <xsl:value-of select="$fileName" />
+    <xsl:text>", mktime(0, 0, 0, </xsl:text>
+    <xsl:value-of select="$month" />
+    <xsl:text>, </xsl:text>
+    <xsl:value-of select="$day" />
+    <xsl:text>, </xsl:text>
+    <xsl:value-of select="$year" />
+    <xsl:text>)); </xsl:text>
+  </xsl:template>
+
+  <xsl:template name='getDay'>
+    <xsl:param name='date' />
+    <xsl:variable name="day" select="substring(@date, 9, 2)"/>
+    <xsl:choose>
+      <xsl:when test="starts-with($day, '0')">
+        <xsl:value-of select="substring($day, 2)" />
+      </xsl:when>
+      <xsl:otherwise>
+        <xsl:value-of select="$day" />
+      </xsl:otherwise>
+    </xsl:choose>
+  </xsl:template>
+
+  <xsl:template name='getMonth'>
+    <xsl:param name='date' />
+    <xsl:variable name="month" select="substring(@date, 6, 2)"/>
+    <xsl:choose>
+      <xsl:when test="starts-with($month, '0')">
+        <xsl:value-of select="substring($month, 2)" />
+      </xsl:when>
+      <xsl:otherwise>
+        <xsl:value-of select="$month" />
+      </xsl:otherwise>
+    </xsl:choose>
+  </xsl:template>
+
+  <xsl:template name='getYear'>
+    <xsl:param name='date' />
+    <xsl:value-of select="substring(@date, 1, 4)"/>
+  </xsl:template>
+
+  <xsl:template name='getFileName'>
+    <xsl:param name='revision' />
+
+    <xsl:text>2.5/</xsl:text>
+
+    <xsl:choose>
+      <xsl:when test="contains($revision, 'Final')">
+        <xsl:text>Milestone/</xsl:text>
+        <xsl:variable name="version" select="substring-after($revision, ' [')"/>
+        <xsl:value-of select="substring-before($version, ' ')" />
+        <xsl:text>_(</xsl:text>
+        <xsl:value-of select="substring-before($revision, ' [')" />
+        <xsl:text>)</xsl:text>
+      </xsl:when>
+      <xsl:otherwise>
+        <xsl:text>SVN/</xsl:text>
+        <xsl:choose>
+          <xsl:when test="contains($revision, 'Preview')">
+            <xsl:variable name="version" select="substring-after($revision, ' [')"/>
+            <xsl:variable name="minorVersion" select="substring-after($version, ' ')"/>
+            <xsl:value-of select="substring-before($revision, ' [')"/>
+            <xsl:text>_</xsl:text>
+            <xsl:call-template name="convertToLower">
+              <xsl:with-param name="toconvert" select="translate(substring-before($minorVersion, ']'), ' ', '_')" />
+            </xsl:call-template>
+          </xsl:when>
+          <xsl:when test="contains($revision, 'Release')">
+            <xsl:value-of select="substring-before($revision, ' [')" />
+            <xsl:text>_r</xsl:text>
+            <xsl:variable name="version" select="substring-after($revision, ' [Release ')"/>
+            <xsl:value-of select="substring-before($version, ']')" />
+          </xsl:when>
+          <xsl:otherwise>
+            <xsl:value-of select="$revision"/>
+          </xsl:otherwise>
+        </xsl:choose>
+      </xsl:otherwise>
+    </xsl:choose>
+  </xsl:template>
+
+  <xsl:template name='convertToLower'>
+    <xsl:param name='toconvert' />
+    <xsl:variable name="lcletters">abcdefghijklmnopqrstuvwxyz</xsl:variable>
+    <xsl:variable name="ucletters">ABCDEFGHIJKLMNOPQRSTUVWXYZ</xsl:variable>
+    <xsl:value-of select="translate($toconvert,$ucletters,$lcletters)" />
+  </xsl:template>
+</xsl:stylesheet>
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/x264/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/x264/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/x264/Perform Build.bat	2010-12-02 17:59:43 UTC (rev 6801)
@@ -0,0 +1,55 @@
+ at echo off
+
+echo MSYS build for x264
+echo ===================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify >nul
+call "../Set Common Environment Variables"
+
+if errorlevel 1 goto error
+
+set PATH=%PATH%;%devDir%\Git\bin
+
+del "%usrLocalDir%\bin\libx264-*.dll"
+del "%usrLocalDir%\include\x264.h"
+cd "%devDir%"
+
+if "%BuildBits%" == "32" (
+	set sourceFolder=x264
+	set buildFolder=build
+)
+
+if "%BuildBits%" == "64" (
+	set sourceFolder=x264-64
+	set buildFolder=build64
+	set configFlags=--host=x86_64-pc-mingw32
+)
+
+rm -r -f %sourceFolder%
+
+echo Downloading from git
+git clone git://git.videolan.org/x264.git %sourceFolder%
+if errorlevel 1 goto end
+
+cd "%devDir%/%sourceFolder%"
+sh ./configure --prefix=/usr/local --enable-shared %configFlags%
+if errorlevel 1 goto end
+
+make install
+if errorlevel 1 goto end
+
+del "%devDir%\avidemux_2.5_%buildFolder%\libx264-*.dll"
+copy "%usrLocalDir%/bin/libx264-*.dll" "%devDir%\avidemux_2.5_%buildFolder%"
+
+:end
+pause
\ No newline at end of file



From mean at mail.berlios.de  Sat Dec  4 11:54:52 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat,  4 Dec 2010 11:54:52 +0100
Subject: [Avidemux-svn-commit] r6802 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS
Message-ID: <20101204105452.5D5B148071A@sheep.berlios.de>

Author: mean
Date: 2010-12-04 11:54:51 +0100 (Sat, 04 Dec 2010)
New Revision: 6802

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsIndexH264.cpp
Log:
[h264/TS] Read just enough to get SPS

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsIndexH264.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsIndexH264.cpp	2010-12-02 17:59:43 UTC (rev 6801)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsIndexH264.cpp	2010-12-04 10:54:51 UTC (rev 6802)
@@ -138,7 +138,6 @@
     //******************
     // 1 search SPS
     //******************
-#define SPS_READ_AHEAD 32
       while(1)
       {
         int startCode=pkt->findStartCode();
@@ -148,14 +147,24 @@
         if(startCode!=NAL_SPS) continue;
 
           // Got SPS!
-          uint8_t buffer[60] ; // should be enough
+          
           uint32_t xA,xR;
           // Get info
           pkt->getInfo(&tmpInfo);
-          pkt->read(SPS_READ_AHEAD,buffer);
-          if (extractSPSInfo(buffer, SPS_READ_AHEAD,&spsInfo))
+          // Read just enough...
           {
-              
+            SEI_nal.empty();
+            uint32_t code=0xffff+0xffff0000;
+            while((code!=1) && pkt->stillOk())
+            {
+                    uint8_t r=pkt->readi8();
+                    code=(code<<8)+r;
+                    SEI_nal.pushByte(r);
+            }
+            if(!pkt->stillOk()) break;;
+            pkt->seek(tmpInfo.startAt,tmpInfo.offset-5);
+            if (extractSPSInfo(SEI_nal.payload, SEI_nal.payloadSize-4,&spsInfo))
+            {
               printf("[TsIndexer] Found video %"LU"x%"LU", fps=%"LU"\n",video.w,video.h,video.fps);
               seq_found=1;
               video.w=spsInfo.width;
@@ -167,9 +176,10 @@
               writeAudio();
               qfprintf(index,"[Data]");
               // Rewind
-              pkt->seek(tmpInfo.startAt,tmpInfo.offset-5);
+              
               break;              
           };
+        }
       }
       
         if(!seq_found) goto the_end;



From mean at mail.berlios.de  Sat Dec  4 11:54:54 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat,  4 Dec 2010 11:54:54 +0100
Subject: [Avidemux-svn-commit] r6803 - in
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg:
	libavcodec patches/avcodec
Message-ID: <20101204105454.F1B1348071A@sheep.berlios.de>

Author: mean
Date: 2010-12-04 11:54:54 +0100 (Sat, 04 Dec 2010)
New Revision: 6803

Added:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/ff_spsinfo.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/h264_parser.c.patch
Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/h264_parser.c
Log:
[avcodec] Export parser/h264 stuff to decode SPS

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/ff_spsinfo.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/ff_spsinfo.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/ff_spsinfo.h	2010-12-04 10:54:54 UTC (rev 6803)
@@ -0,0 +1,17 @@
+#ifndef FF_SPS_INFO_H
+#define FF_SPS_INFO_H
+
+typedef struct
+{
+	int width;
+	int height;
+	int fps1000;
+	int darNum;
+	int darDen;
+	int hasStructInfo;
+	int CpbDpbToSkip;
+}ffSpsInfo;
+
+
+#endif
+

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/h264_parser.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/h264_parser.c	2010-12-04 10:54:51 UTC (rev 6802)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/h264_parser.c	2010-12-04 10:54:54 UTC (rev 6803)
@@ -29,10 +29,51 @@
 #include "h264_parser.h"
 #include "h264data.h"
 #include "golomb.h"
-
+#include "ff_spsinfo.h" // MEANX
 #include <assert.h>
+ // MEANX
+/**
+    \fn AVCodecParserContext
+*/
+int ff_h264_info(AVCodecParserContext *parser,ffSpsInfo *info)
+{
+    H264Context *ctx = parser->priv_data;
+    memset(info,0,sizeof(*info));
+    if(!ctx->sps.mb_width || !ctx->sps.mb_height)
+    {
+        return 0;
+    }
+    info->width=ctx->sps.mb_width  * 16;
+    info->height=(2-ctx->sps.frame_mbs_only_flag)*ctx->sps.mb_height * 16;
+    if(ctx->sps.timing_info_present_flag)
+    {
+            float scale=ctx->sps.time_scale ;
+            float ticks=ctx->sps.num_units_in_tick;
+            info->fps1000 =  (uint32_t) ((scale/ticks) *    1000.);
+#undef printf
+            printf("Scale : %d, tick=%d, fps=%d\n",(int)scale,(int)ticks,(int)info->fps1000);
+    }else
+    {
+            ADM_warning("[H264] No timing information\n");
+            info->fps1000=25000;
+    }
+    // D.2.2 SEI Timing present if CpbDbpDelayPresentFlag=1 or pictStructPresent=1
+    // CpbDbpDelayPresentFlag =1 if nal_hdr or vcl_hrd or ???
+    int f=ctx->sps.nal_hrd_parameters_present_flag | ctx->sps.vcl_hrd_parameters_present_flag;
+    info->hasStructInfo=f | ctx->sps.pic_struct_present_flag;;
+    // While decoding SEI, if CpbDpbDelaysPresentFlags is there we skip cpb_removal_delay + dpb_output_delay
 
-
+    info->CpbDpbToSkip=0;
+    if(f)
+    {
+        info->CpbDpbToSkip=ctx->sps.cpb_removal_delay_length+ctx->sps.dpb_output_delay_length;
+    }
+#warning fixme sar vs dar
+    info->darNum=ctx->sps.sar.num;
+    info->darDen=ctx->sps.sar.den;
+    return 1;
+}
+// /MEANX
 int ff_h264_find_frame_end(H264Context *h, const uint8_t *buf, int buf_size)
 {
     int i;

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/h264_parser.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/h264_parser.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/h264_parser.c.patch	2010-12-04 10:54:54 UTC (rev 6803)
@@ -0,0 +1,58 @@
+diff --git a/avidemux_core/ADM_ffmpeg/libavcodec/h264_parser.c b/avidemux_core/ADM_ffmpeg/libavcodec/h264_parser.c
+index 70d08f4..437f9d0 100644
+--- a/avidemux_core/ADM_ffmpeg/libavcodec/h264_parser.c
++++ b/avidemux_core/ADM_ffmpeg/libavcodec/h264_parser.c
+@@ -29,10 +29,51 @@
+ #include "h264_parser.h"
+ #include "h264data.h"
+ #include "golomb.h"
+-
++#include "ff_spsinfo.h" // MEANX
+ #include <assert.h>
++ // MEANX
++/**
++    \fn AVCodecParserContext
++*/
++int ff_h264_info(AVCodecParserContext *parser,ffSpsInfo *info)
++{
++    H264Context *ctx = parser->priv_data;
++    memset(info,0,sizeof(*info));
++    if(!ctx->sps.mb_width || !ctx->sps.mb_height)
++    {
++        return 0;
++    }
++    info->width=ctx->sps.mb_width  * 16;
++    info->height=(2-ctx->sps.frame_mbs_only_flag)*ctx->sps.mb_height * 16;
++    if(ctx->sps.timing_info_present_flag)
++    {
++            float scale=ctx->sps.time_scale ;
++            float ticks=ctx->sps.num_units_in_tick;
++            info->fps1000 =  (uint32_t) ((scale/ticks) *    1000.);
++#undef printf
++            printf("Scale : %d, tick=%d, fps=%d\n",(int)scale,(int)ticks,(int)info->fps1000);
++    }else
++    {
++            ADM_warning("[H264] No timing information\n");
++            info->fps1000=25000;
++    }
++    // D.2.2 SEI Timing present if CpbDbpDelayPresentFlag=1 or pictStructPresent=1
++    // CpbDbpDelayPresentFlag =1 if nal_hdr or vcl_hrd or ???
++    int f=ctx->sps.nal_hrd_parameters_present_flag | ctx->sps.vcl_hrd_parameters_present_flag;
++    info->hasStructInfo=f | ctx->sps.pic_struct_present_flag;;
++    // While decoding SEI, if CpbDpbDelaysPresentFlags is there we skip cpb_removal_delay + dpb_output_delay
+ 
+-
++    info->CpbDpbToSkip=0;
++    if(f)
++    {
++        info->CpbDpbToSkip=ctx->sps.cpb_removal_delay_length+ctx->sps.dpb_output_delay_length;
++    }
++#warning fixme sar vs dar
++    info->darNum=ctx->sps.sar.num;
++    info->darDen=ctx->sps.sar.den;
++    return 1;
++}
++// /MEANX
+ int ff_h264_find_frame_end(H264Context *h, const uint8_t *buf, int buf_size)
+ {
+     int i;



From mean at mail.berlios.de  Sat Dec  4 11:54:56 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat,  4 Dec 2010 11:54:56 +0100
Subject: [Avidemux-svn-commit] r6804 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src
Message-ID: <20101204105456.4C0F648071A@sheep.berlios.de>

Author: mean
Date: 2010-12-04 11:54:56 +0100 (Sat, 04 Dec 2010)
New Revision: 6804

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_infoExtractorH264.cpp
Log:
[util/h264] use avcodec to decode SPS

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_infoExtractorH264.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_infoExtractorH264.cpp	2010-12-04 10:54:54 UTC (rev 6803)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_infoExtractorH264.cpp	2010-12-04 10:54:56 UTC (rev 6804)
@@ -14,6 +14,13 @@
 
 
 #include "ADM_includeFfmpeg.h"
+extern "C"
+{
+#include "libavcodec/parser.h"
+#include "libavcodec/avcodec.h"
+#include "libavcodec/ff_spsinfo.h"
+extern int ff_h264_info(AVCodecParserContext *parser,ffSpsInfo *ndo);
+}
 #include "ADM_default.h"
 #include "ADM_Video.h"
 
@@ -138,15 +145,16 @@
 */
     }
     uint32_t f=0;
+    spsinfo->CpbDpbToSkip=0;
     if(bits.get(1)) // nal_hrd_param
     {
         f++;
-        spsinfo->CpbDpbToSkip=hrd(bits);
+        spsinfo->CpbDpbToSkip+=hrd(bits);
     }
     if(bits.get(1)) // vcl_hrd_param
     {
         f++;
-        spsinfo->CpbDpbToSkip=hrd(bits);
+        spsinfo->CpbDpbToSkip+=hrd(bits);
     }
     if(f) bits.get(1); // low delay flag
     
@@ -202,7 +210,7 @@
     \brief Extract info from H264 SPS
     See 7.3.2.1 of 14496-10
 */
-uint8_t extractSPSInfo (uint8_t * data, uint32_t len, ADM_SPSInfo *spsinfo)
+uint8_t extractSPSInfo_internal (uint8_t * data, uint32_t len, ADM_SPSInfo *spsinfo)
 {
    
   uint32_t profile, constraint, level, pic_order_cnt_type, w, h, mbh,
@@ -333,8 +341,7 @@
   if (bits.get(1))
     {
       extractVUIInfo (bits, spsinfo);
-      printf ("[H264] Fps %" LU ", a.r. %" LU ",%" LU "\n", spsinfo->fps1000, spsinfo->darNum,
-	      spsinfo->darDen);
+//      printf ("[H264] Fps %" LU ", a.r. %" LU ",%" LU "\n", spsinfo->fps1000, spsinfo->darNum,  spsinfo->darDen);
     }
   else
     {
@@ -526,4 +533,120 @@
   printf ("No stream\n");
   return 0;
 }
+/**
+        \fn extractSPSInfo2
+        \brief Same as extractSPSInfo, but using libavcodec
+*/
+uint8_t extractSPSInfo_lavcodec (uint8_t * data, uint32_t len, ADM_SPSInfo *spsinfo)
+{
+    static const uint8_t sig[5]={0,0,0,1,0};
+    uint32_t myLen=len+5+5+FF_INPUT_BUFFER_PADDING_SIZE;
+    uint8_t myData[myLen];
+    bool r=false;
+
+    memset(myData,myLen,1);
+    mixDump(data,len);
+    // put dummy SPS tag + dummy filler at the end
+    // so that lavcodec can split it
+    memcpy(myData,sig,5);
+    memcpy(myData+5,data,len);
+    memcpy(myData+5+len,sig,5);
+    myData[4]=NAL_SPS;
+    myData[5+len+4]=NAL_FILLER;
+    
+    
+    // 1-Create parser
+    AVCodecParserContext *parser=av_parser_init(CODEC_ID_H264);
+    AVCodecContext *ctx=NULL; 
+    AVCodec *codec=NULL;
+    uint8_t *d=NULL;
+  
+    if(!parser)
+    {
+        ADM_error("cannot create h264 parser\n");
+        goto theEnd;
+    }
+    ADM_info("Parser created\n");
+    codec=avcodec_find_decoder(CODEC_ID_H264);
+    if(!codec)
+    {
+        ADM_error("cannot create h264 codec\n");
+        goto theEnd;
+    }
+    ADM_info("Codec created\n");
+    ctx=avcodec_alloc_context();
+   if (avcodec_open(ctx, codec) < 0)  
+   {
+        ADM_error("cannot create h264 context\n");
+        goto theEnd;
+    }
+    ADM_info("Context created\n");
+    //2- Parse, let's add SPS prefix + Filler postfix to make life easier for libavcodec parser
+    ctx->extradata=myData;
+    ctx->extradata_size=myLen;
+     {
+         uint8_t *outptr=NULL;
+         int outsize=0;
+         int consumed = av_parser_parse2(parser, ctx, 
+                                      &outptr, &outsize,
+                                      d, 0,
+                                      0, 0,0);
+    }
+    ADM_info("Width  : %d\n",ctx->width);
+    ADM_info("Height : %d\n",ctx->height);
+    {
+        ffSpsInfo nfo;
+        if(!ff_h264_info(parser,&nfo))
+        {
+            ADM_error("Cannot get sps info from lavcodec\n");
+            r=false;
+            goto theEnd;
+        }
+        ADM_info("Width2 : %d\n",nfo.width);
+        ADM_info("Height2: %d\n",nfo.height);
+        #define CPY(x) spsinfo->x=nfo.x
+        CPY(width);
+        CPY(height);
+        CPY(fps1000);
+        CPY(hasStructInfo);
+        CPY(CpbDpbToSkip);
+        CPY(darNum);
+        CPY(darDen);
+        r=true;
+     }
+    // cleanup
+theEnd:
+    if(ctx)
+        avcodec_close(ctx);
+    if(parser)
+        av_parser_close(parser);
+    return r;
+}
+
+uint8_t extractSPSInfo (uint8_t * data, uint32_t len, ADM_SPSInfo *spsinfo)
+{
+#define DPY(x) ADM_info(#x":%d\n",(int)spsinfo->x);
+#if 1        
+        
+        bool l=extractSPSInfo_lavcodec(data,len,spsinfo);
+        DPY(width);
+        DPY(height);
+        DPY(fps1000);
+        DPY(hasStructInfo);
+        DPY(CpbDpbToSkip);
+        DPY(darNum);
+        DPY(darDen);
+        return l;
+#else           
+        bool i=extractSPSInfo_internal(data,len,spsinfo);
+        DPY(width);
+        DPY(height);
+        DPY(fps1000);
+        DPY(hasStructInfo);
+        DPY(CpbDpbToSkip);
+        DPY(darNum);
+        DPY(darDen);
+        return i;
+#endif
+}
 //EOF



From mean at mail.berlios.de  Sat Dec  4 17:10:56 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat,  4 Dec 2010 17:10:56 +0100
Subject: [Avidemux-svn-commit] r6805 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec
Message-ID: <20101204161056.D71C5480B21@sheep.berlios.de>

Author: mean
Date: 2010-12-04 17:10:56 +0100 (Sat, 04 Dec 2010)
New Revision: 6805

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/h264_parser.c
Log:
[core/parser] Dont use ADM_warning

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/h264_parser.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/h264_parser.c	2010-12-04 10:54:56 UTC (rev 6804)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/h264_parser.c	2010-12-04 16:10:56 UTC (rev 6805)
@@ -54,7 +54,7 @@
             printf("Scale : %d, tick=%d, fps=%d\n",(int)scale,(int)ticks,(int)info->fps1000);
     }else
     {
-            ADM_warning("[H264] No timing information\n");
+            printf("[H264] No timing information\n");
             info->fps1000=25000;
     }
     // D.2.2 SEI Timing present if CpbDbpDelayPresentFlag=1 or pictStructPresent=1



From mean at mail.berlios.de  Sat Dec  4 17:10:57 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat,  4 Dec 2010 17:10:57 +0100
Subject: [Avidemux-svn-commit] r6806 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src
Message-ID: <20101204161057.A8C9A480B21@sheep.berlios.de>

Author: mean
Date: 2010-12-04 17:10:57 +0100 (Sat, 04 Dec 2010)
New Revision: 6806

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_infoExtractorH264.cpp
Log:
[SPSinfo] Use lavcodec one

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_infoExtractorH264.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_infoExtractorH264.cpp	2010-12-04 16:10:56 UTC (rev 6805)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_infoExtractorH264.cpp	2010-12-04 16:10:57 UTC (rev 6806)
@@ -626,7 +626,7 @@
 uint8_t extractSPSInfo (uint8_t * data, uint32_t len, ADM_SPSInfo *spsinfo)
 {
 #define DPY(x) ADM_info(#x":%d\n",(int)spsinfo->x);
-#if 1        
+#if 0        
         
         bool l=extractSPSInfo_lavcodec(data,len,spsinfo);
         DPY(width);



From mean at mail.berlios.de  Sun Dec  5 09:07:17 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sun,  5 Dec 2010 09:07:17 +0100
Subject: [Avidemux-svn-commit] r6807 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxer/include
Message-ID: <20101205080717.AEAAE480C98@sheep.berlios.de>

Author: mean
Date: 2010-12-05 09:07:17 +0100 (Sun, 05 Dec 2010)
New Revision: 6807

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxer/include/ADM_coreDemuxerMpegTemplate.cpp
Log:
[Mpeg TS/PS] Hack : Get a duration when there is no DTS (avchd)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxer/include/ADM_coreDemuxerMpegTemplate.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxer/include/ADM_coreDemuxerMpegTemplate.cpp	2010-12-04 16:10:57 UTC (rev 6806)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreDemuxer/include/ADM_coreDemuxerMpegTemplate.cpp	2010-12-05 08:07:17 UTC (rev 6807)
@@ -26,9 +26,21 @@
     int index=ListOfFrames.size();
     if(!index) return 0;
     index--;
+    int maxLookup=100;
+    if(maxLookup>index) maxLookup=index;
     int offset=0;
+    int maxPts=0;
     do
     {
+	if(maxLookup)
+	{
+        uint64_t p=ListOfFrames[index]->pts;
+	if(p!=ADM_NO_PTS) 
+		{
+			if(p>maxPts) maxPts=p;
+		}
+	maxLookup--;
+	}
         if(ListOfFrames[index]->dts!=ADM_NO_PTS) break;
         index--;
         offset++;
@@ -36,8 +48,9 @@
     }while(index);
     if(!index)
     {
-        ADM_error("Cannot find a valid DTS in the file\n");
-        return 0;
+        ADM_warning("Cannot find a valid DTS in the file\n");
+        ADM_warning("Using PTS instead\n");
+        return maxPts;
     }
     float f,g;
     f=1000*1000*1000;
@@ -184,4 +197,4 @@
 
 }
 
-// EOF
\ No newline at end of file
+// EOF



From mean at mail.berlios.de  Sun Dec  5 09:07:18 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sun,  5 Dec 2010 09:07:18 +0100
Subject: [Avidemux-svn-commit] r6808 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src
Message-ID: <20101205080718.887E8480C98@sheep.berlios.de>

Author: mean
Date: 2010-12-05 09:07:18 +0100 (Sun, 05 Dec 2010)
New Revision: 6808

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_infoExtractorH264.cpp
Log:
[SPS] use lavcodec info extractor

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_infoExtractorH264.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_infoExtractorH264.cpp	2010-12-05 08:07:17 UTC (rev 6807)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_infoExtractorH264.cpp	2010-12-05 08:07:18 UTC (rev 6808)
@@ -626,7 +626,7 @@
 uint8_t extractSPSInfo (uint8_t * data, uint32_t len, ADM_SPSInfo *spsinfo)
 {
 #define DPY(x) ADM_info(#x":%d\n",(int)spsinfo->x);
-#if 0        
+#if 1        
         
         bool l=extractSPSInfo_lavcodec(data,len,spsinfo);
         DPY(width);



From mean at mail.berlios.de  Sun Dec  5 09:56:54 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sun,  5 Dec 2010 09:56:54 +0100
Subject: [Avidemux-svn-commit] r6809 -
	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces
Message-ID: <20101205085655.074D1480C98@sheep.berlios.de>

Author: mean
Date: 2010-12-05 09:56:54 +0100 (Sun, 05 Dec 2010)
New Revision: 6809

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ui_support.cpp
Log:
[Qt4] Use avidemux6 as prefix for i18n

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ui_support.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ui_support.cpp	2010-12-05 08:07:18 UTC (rev 6808)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ui_support.cpp	2010-12-05 08:56:54 UTC (rev 6809)
@@ -75,7 +75,7 @@
 #elif defined(__WIN32)
 	QString appdir = QCoreApplication::applicationDirPath() + "/i18n/";
 #else
-	QString appdir = ADM_getInstallRelativePath("share","avidemux","i18n");
+	QString appdir = ADM_getInstallRelativePath("share","avidemux6","i18n");
 #endif
     int nbLoaded=0;
 	nbLoaded+=loadTranslation(&qtTranslator, appdir + "qt_" + QLocale::system().name());



From gruntster at mail.berlios.de  Tue Dec  7 20:25:23 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue,  7 Dec 2010 20:25:23 +0100
Subject: [Avidemux-svn-commit] r6810 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_vorbis
Message-ID: <20101207192524.2B49A480D89@sheep.berlios.de>

Author: gruntster
Date: 2010-12-07 20:25:23 +0100 (Tue, 07 Dec 2010)
New Revision: 6810

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_vorbis/CMakeLists.txt
Log:
[vorbis] fix linking

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_vorbis/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_vorbis/CMakeLists.txt	2010-12-05 08:56:54 UTC (rev 6809)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_vorbis/CMakeLists.txt	2010-12-07 19:25:23 UTC (rev 6810)
@@ -9,9 +9,9 @@
 
         ADD_LIBRARY(ADM_ad_vorbis SHARED ${ADM_ad_vorbis_SRCS})
 
-        TARGET_LINK_LIBRARIES(ADM_ad_vorbis ${VORBIS_LIBRARY_DIR})
+        TARGET_LINK_LIBRARIES(ADM_ad_vorbis ${LIBVORBIS_LIBRARY_DIR})
 
-        include_directories(${VORBIS_INCLUDE_DIR})
+        include_directories(${LIBVORBIS_INCLUDE_DIR})
 
         INIT_AUDIO_PLUGIN(ADM_ad_vorbis)
         INSTALL_AUDIODECODER(ADM_ad_vorbis)



From gruntster at mail.berlios.de  Tue Dec  7 20:27:32 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue,  7 Dec 2010 20:27:32 +0100
Subject: [Avidemux-svn-commit] r6811 - in
	branches/avidemux_2.6_branch_mean/foreignBuilds/mswin: .
	avidemux avidemux/Tools faac faad fontconfig js lame libogg
	libvorbis libvpx nspr opencore-amr x264 xvid
Message-ID: <20101207192732.A49F7480D89@sheep.berlios.de>

Author: gruntster
Date: 2010-12-07 20:27:32 +0100 (Tue, 07 Dec 2010)
New Revision: 6811

Added:
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faac/
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faac/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faad/
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faad/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/libtool.patch
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/Makefile.ref.patch
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/WINNT6.1.mk
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/jsnum.c.patch
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/lame/
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/lame/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libogg/
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libogg/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvorbis/
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvorbis/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvorbis/libtool.patch
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/configure.patch
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/configure.sh.patch
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/nspr/
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/nspr/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/opencore-amr/
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/opencore-amr/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/opencore-amr/amrnb_Makefile.in
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/opencore-amr/amrwb_Makefile.in
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/Perform Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/configure.patch
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/nasm.inc.patch
Modified:
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/Set Common Environment Variables.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1c. Post-build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2. Create Packages.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2b. Package SDK.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2c. Package Build.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Set Avidemux Environment Variables.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Build Plugins.bat
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/gennotes.sh
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/gentouch.sh
   branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/x264/Perform Build.bat
Log:
[win] upgrade build scripts

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/Set Common Environment Variables.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/Set Common Environment Variables.bat	2010-12-07 19:25:23 UTC (rev 6810)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/Set Common Environment Variables.bat	2010-12-07 19:27:32 UTC (rev 6811)
@@ -3,26 +3,18 @@
 set nsisDir=%ProgramFiles32%\NSIS
 
 set devDir=E:\Dev
+set msysDir=E:/Dev/MSYS
 
-if "%BuildBits%" == "32" (
-	set msysDir=E:/Dev/MSYS
-	set qtDir=%devDir%\Qt32
-	set CFLAGS=-m32 
-	set CXXFLAGS=-m32
-	set LDFLAGS=-m32
-	goto :setVars )
+if "%BuildBits%" == "32" goto :setVars
+if "%BuildBits%" == "64" goto :setVars
 
-if "%BuildBits%" == "64" (
-	set msysDir=E:/Dev/MSYS-64
-	set qtDir=%devDir%\Qt64
-	goto :setVars )
-
 echo Error - BuildBits variable not set
 goto error
 
 :setVars
-set mingwDir=%devDir%\MinGW64
-set usrLocalDir=%msysDir%/local32
+set mingwDir=%devDir%\MinGW%BuildBits%
+set usrLocalDir=%msysDir%/local%BuildBits%
+set qtDir=%devDir%\Qt%BuildBits%
 set CMAKE_INCLUDE_PATH=%usrLocalDir%/include
 set CMAKE_LIBRARY_PATH=%usrLocalDir%/lib
 set PKG_CONFIG_PATH=%usrLocalDir%\lib\pkgconfig
@@ -30,6 +22,8 @@
 set CFLAGS=%CFLAGS% -I%CMAKE_INCLUDE_PATH% -L%CMAKE_LIBRARY_PATH%
 set CXXFLAGS=%CXXFLAGS% -I%CMAKE_INCLUDE_PATH% -L%CMAKE_LIBRARY_PATH%
 set LDFLAGS=%LDFLAGS% -shared-libgcc -lstdc++ -L%CMAKE_LIBRARY_PATH%
+set admBuildDir=%devDir%\avidemux_2.6_build%BuildBits%
+set admSdkBuildDir=%devDir%\avidemux_2.6_build%BuildBits%_sdk
 
 if exist "%qtDir%" (
 	for /f %%d in ('dir /b /ad /on %qtDir%') do set qtVer=%%d
@@ -73,7 +67,7 @@
 	goto error
 )
 
-set PATH=%cmakeDir%;%mingwDir%\bin;%usrLocalDir%\bin;%msysDir%\bin;%msysDir%\local32\bin;%qtDir%\bin;%PATH%
+set PATH=%cmakeDir%;%mingwDir%\bin;%usrLocalDir%\bin;%msysDir%\bin;%msysDir%\local-shared\bin;%qtDir%\bin;c:\strawberry\perl\bin;%PATH%
 
 goto end
 

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1c. Post-build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1c. Post-build.bat	2010-12-07 19:25:23 UTC (rev 6810)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/1c. Post-build.bat	2010-12-07 19:27:32 UTC (rev 6811)
@@ -1,98 +1,100 @@
-mkdir "%sdkBuildDir%\lib"
-move "%buildDir%\lib\*.a" "%sdkBuildDir%\lib"
+mkdir "%sdkBuildDir%\lib%BuildBits%"
+move "%buildDir%\lib\*.a" "%sdkBuildDir%\lib%BuildBits%"
 del /s "%buildDir%\*.a"
 
-mkdir "%sdkBuildDir%\plugin-examples"
-cd "%sdkBuildDir%\plugin-examples"
-copy "%curDir%\Tools\Build Plugins.bat" "%sdkBuildDir%\plugin-examples"
+if "%BuildBits%" == "32" (
+	mkdir "%sdkBuildDir%\plugin-examples"
+	cd "%sdkBuildDir%\plugin-examples"
+	copy "%curDir%\Tools\Build Plugins.bat" "%sdkBuildDir%\plugin-examples"
 
-mkdir "audioDecoders"
-mkdir "audioDecoders\ac3"
-xcopy /s "%sourceDir%\plugins\ADM_audioDecoders\ADM_ad_ac3" "audioDecoders\ac3"
+	mkdir "audioDecoders"
+	mkdir "audioDecoders\ac3"
+	xcopy /s "%sourceDir%\plugins\ADM_audioDecoders\ADM_ad_ac3" "audioDecoders\ac3"
 
-mkdir "audioDevices"
-mkdir "audioDevices\win32"
-xcopy /s "%sourceDir%\plugins\ADM_audioDevices\Win32" "audioDevices\win32"
+	mkdir "audioDevices"
+	mkdir "audioDevices\win32"
+	xcopy /s "%sourceDir%\plugins\ADM_audioDevices\Win32" "audioDevices\win32"
 
-mkdir "audioEncoders"
-mkdir "audioEncoders\pcm"
-xcopy /s "%sourceDir%\plugins\ADM_audioEncoders\pcm" "audioEncoders\pcm"
+	mkdir "audioEncoders"
+	mkdir "audioEncoders\pcm"
+	xcopy /s "%sourceDir%\plugins\ADM_audioEncoders\pcm" "audioEncoders\pcm"
 
-mkdir "videoEncoders"
-mkdir "videoEncoders\mpeg2enc"
-mkdir "videoEncoders\mpeg2enc\common"
-xcopy /s "%sourceDir%\plugins\ADM_videoEncoder\ADM_vidEnc_mpeg2enc" "videoEncoders\mpeg2enc"
-xcopy /s "%sourceDir%\plugins\ADM_videoEncoder\common" "videoEncoders\mpeg2enc\common"
-xcopy /s "%msysDir%\local\lib\libxml2.dll.a" "videoEncoders\mpeg2enc"
-xcopy /s "%msysDir%\local\include\libxml2" "videoEncoders\mpeg2enc"
-rmdir /s/q "videoEncoders\mpeg2enc\mpeg2enc\altivec"
+	mkdir "videoEncoders"
+	mkdir "videoEncoders\mpeg2enc"
+	mkdir "videoEncoders\mpeg2enc\common"
+	xcopy /s "%sourceDir%\plugins\ADM_videoEncoder\ADM_vidEnc_mpeg2enc" "videoEncoders\mpeg2enc"
+	xcopy /s "%sourceDir%\plugins\ADM_videoEncoder\common" "videoEncoders\mpeg2enc\common"
+	xcopy /s "%usrLocalDir%\lib\libxml2.dll.a" "videoEncoders\mpeg2enc"
+	xcopy /s "%usrLocalDir%\include\libxml2" "videoEncoders\mpeg2enc"
+	rmdir /s/q "videoEncoders\mpeg2enc\mpeg2enc\altivec"
 
-mkdir "videoFilters"
-mkdir "videoFilters\fade"
-xcopy /s "%sourceDir%\plugins\ADM_videoFilters\Fade" "videoFilters\fade"
+	mkdir "videoFilters"
+	mkdir "videoFilters\fade"
+	xcopy /s "%sourceDir%\plugins\ADM_videoFilters\Fade" "videoFilters\fade"
 
-del /s CMakeLists.txt
+	del /s CMakeLists.txt
 
-mkdir "%sdkBuildDir%\include"
-mkdir "%sdkBuildDir%\include\ADM_encoder"
-mkdir "%sdkBuildDir%\include\libavutil"
-cd "%sdkBuildDir%\include"
+	mkdir "%sdkBuildDir%\include"
+	mkdir "%sdkBuildDir%\include\ADM_encoder"
+	mkdir "%sdkBuildDir%\include\libavutil"
+	cd "%sdkBuildDir%\include"
 
-copy "%sourceDir%\%buildFolder%\config\ADM_coreConfig.h"
-copy "%sourceDir%\%buildFolder%\config\libavutil\avconfig.h" libavutil
-copy "%sourceDir%\avidemux\ADM_audiocodec\ADM_ad_plugin.h"
-copy "%sourceDir%\avidemux\ADM_audiocodec\ADM_audiocodec.h"
-copy "%sourceDir%\avidemux\ADM_audiodevice\ADM_audiodevice.h"
-copy "%sourceDir%\avidemux\ADM_audiodevice\ADM_audioDeviceInternal.h"
-copy "%sourceDir%\avidemux\ADM_core\include\ADM_assert.h"
-copy "%sourceDir%\avidemux\ADM_core\include\ADM_clock.h"
-copy "%sourceDir%\avidemux\ADM_core\include\ADM_cpucap.h"
-copy "%sourceDir%\avidemux\ADM_core\include\ADM_default.h"
-copy "%sourceDir%\avidemux\ADM_core\include\ADM_dynamicLoading.h"
-copy "%sourceDir%\avidemux\ADM_core\include\ADM_files.h"
-copy "%sourceDir%\avidemux\ADM_core\include\ADM_inttype.h"
-copy "%sourceDir%\avidemux\ADM_core\include\ADM_mangle.h"
-copy "%sourceDir%\avidemux\ADM_core\include\ADM_misc.h"
-copy "%sourceDir%\avidemux\ADM_coreAudio\include\ADM_audioCodecEnum.h"
-copy "%sourceDir%\avidemux\ADM_coreAudio\include\ADM_audiodef.h"
-copy "%sourceDir%\avidemux\ADM_coreAudio\include\ADM_audioFilter.h"
-copy "%sourceDir%\avidemux\ADM_coreAudio\include\ADM_coreAudio.h"
-copy "%sourceDir%\avidemux\ADM_coreAudio\include\audioencoder.h"
-copy "%sourceDir%\avidemux\ADM_coreAudio\include\audioencoderInternal.h"
-copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_confCouple.h"
-copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_image.h"
-copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_rgb.h"
-copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_videoFilter.h"
-copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_videoFilterCache.h"
-copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_videoFilterDynamic.h"
-copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_videoFilter_iface.h"
-copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_videoFilter_internal.h"
-copy "%sourceDir%\avidemux\ADM_coreUI\include\DIA_coreToolkit.h"
-copy "%sourceDir%\avidemux\ADM_coreUI\include\DIA_factory.h"
-copy "%sourceDir%\avidemux\ADM_coreUI\include\DIA_uiTypes.h"
-copy "%sourceDir%\avidemux\ADM_encoder\ADM_vidEncode.hxx" ADM_encoder
-copy "%sourceDir%\avidemux\ADM_libraries\ffmpeg\libavutil\pixfmt.h" libavutil
-copy "%sourceDir%\avidemux\ADM_plugin\ADM_vidEnc_plugin.h"
-copy "%sourceDir%\avidemux\ADM_plugin\ADM_plugin_translate.h"
+	copy "%sourceDir%\%buildFolder%\config\ADM_coreConfig.h"
+	copy "%sourceDir%\%buildFolder%\config\libavutil\avconfig.h" libavutil
+	copy "%sourceDir%\avidemux\ADM_audiocodec\ADM_ad_plugin.h"
+	copy "%sourceDir%\avidemux\ADM_audiocodec\ADM_audiocodec.h"
+	copy "%sourceDir%\avidemux\ADM_audiodevice\ADM_audiodevice.h"
+	copy "%sourceDir%\avidemux\ADM_audiodevice\ADM_audioDeviceInternal.h"
+	copy "%sourceDir%\avidemux\ADM_core\include\ADM_assert.h"
+	copy "%sourceDir%\avidemux\ADM_core\include\ADM_clock.h"
+	copy "%sourceDir%\avidemux\ADM_core\include\ADM_cpucap.h"
+	copy "%sourceDir%\avidemux\ADM_core\include\ADM_default.h"
+	copy "%sourceDir%\avidemux\ADM_core\include\ADM_dynamicLoading.h"
+	copy "%sourceDir%\avidemux\ADM_core\include\ADM_files.h"
+	copy "%sourceDir%\avidemux\ADM_core\include\ADM_inttype.h"
+	copy "%sourceDir%\avidemux\ADM_core\include\ADM_mangle.h"
+	copy "%sourceDir%\avidemux\ADM_core\include\ADM_misc.h"
+	copy "%sourceDir%\avidemux\ADM_coreAudio\include\ADM_audioCodecEnum.h"
+	copy "%sourceDir%\avidemux\ADM_coreAudio\include\ADM_audiodef.h"
+	copy "%sourceDir%\avidemux\ADM_coreAudio\include\ADM_audioFilter.h"
+	copy "%sourceDir%\avidemux\ADM_coreAudio\include\ADM_coreAudio.h"
+	copy "%sourceDir%\avidemux\ADM_coreAudio\include\audioencoder.h"
+	copy "%sourceDir%\avidemux\ADM_coreAudio\include\audioencoderInternal.h"
+	copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_confCouple.h"
+	copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_image.h"
+	copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_rgb.h"
+	copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_videoFilter.h"
+	copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_videoFilterCache.h"
+	copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_videoFilterDynamic.h"
+	copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_videoFilter_iface.h"
+	copy "%sourceDir%\avidemux\ADM_coreImage\include\ADM_videoFilter_internal.h"
+	copy "%sourceDir%\avidemux\ADM_coreUI\include\DIA_coreToolkit.h"
+	copy "%sourceDir%\avidemux\ADM_coreUI\include\DIA_factory.h"
+	copy "%sourceDir%\avidemux\ADM_coreUI\include\DIA_uiTypes.h"
+	copy "%sourceDir%\avidemux\ADM_encoder\ADM_vidEncode.hxx" ADM_encoder
+	copy "%sourceDir%\avidemux\ADM_libraries\ffmpeg\libavutil\pixfmt.h" libavutil
+	copy "%sourceDir%\avidemux\ADM_plugin\ADM_vidEnc_plugin.h"
+	copy "%sourceDir%\avidemux\ADM_plugin\ADM_plugin_translate.h"
 
-cd "%sourceDir%\po"
-svn revert -R .
-sh qt_update_pro.sh
-echo ./avidemux_blank.ts >> avidemux.pro
-lupdate avidemux.pro
+	cd "%sourceDir%\po"
+	svn revert -R .
+	sh qt_update_pro.sh
+	echo ./avidemux_blank.ts >> avidemux.pro
+	lupdate avidemux.pro
 
-mkdir "%sdkBuildDir%\i18n"
-mkdir "%sdkBuildDir%\i18n\qt4"
-mkdir "%sdkBuildDir%\i18n\gtk"
+	mkdir "%sdkBuildDir%\i18n"
+	mkdir "%sdkBuildDir%\i18n\qt4"
+	mkdir "%sdkBuildDir%\i18n\gtk"
 
-copy *.ts "%sdkBuildDir%\i18n\qt4"
-copy qt_filter_context.xslt "%sdkBuildDir%\i18n\qt4\qt_filter_context.xsl"
-copy "%curDir%\Tools\Build Qt Translations.bat" "%sdkBuildDir%\i18n\qt4\Build Translations.bat"
+	copy *.ts "%sdkBuildDir%\i18n\qt4"
+	copy qt_filter_context.xslt "%sdkBuildDir%\i18n\qt4\qt_filter_context.xsl"
+	copy "%curDir%\Tools\Build Qt Translations.bat" "%sdkBuildDir%\i18n\qt4\Build Translations.bat"
 
-del avidemux_blank.ts
+	del avidemux_blank.ts
 
-sh update_pot.bash
-copy avidemux.pot "%sdkBuildDir%\i18n\gtk"
-for %%A in (*.po) do msgmerge %%A avidemux.pot -o "%sdkBuildDir%\i18n\gtk\%%A"
+	sh update_pot.bash
+	copy avidemux.pot "%sdkBuildDir%\i18n\gtk"
+	for %%A in (*.po) do msgmerge %%A avidemux.pot -o "%sdkBuildDir%\i18n\gtk\%%A"
 
-svn revert -R .
\ No newline at end of file
+	svn revert -R .
+)
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2. Create Packages.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2. Create Packages.bat	2010-12-07 19:25:23 UTC (rev 6810)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2. Create Packages.bat	2010-12-07 19:27:32 UTC (rev 6811)
@@ -29,8 +29,8 @@
 call "Get Revision Number"
 cd ..
 
-set packageDir=%CD%\%revisionNo%
-mkdir %packageDir%
+set packageDir=%CD%\%revisionNo% [%BuildBits%-bit]
+mkdir "%packageDir%"
 
 cd "%curDir%"
 call "2b. Package SDK.bat"

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2b. Package SDK.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2b. Package SDK.bat	2010-12-07 19:25:23 UTC (rev 6810)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2b. Package SDK.bat	2010-12-07 19:27:32 UTC (rev 6811)
@@ -1,6 +1,19 @@
-set baseFile=avidemux_sdk_2.5_r%revisionNo%_win%BuildBits%
-set zipFile=%baseFile%.zip
+set zipFile=avidemux_sdk_2.5_r%revisionNo%_win.zip
 
-cd "%sdkBuildDir%"
+if "%BuildBits%" == "32" (
+	set sdk32BuildDir=%sdkBuildDir%
+	set sdk64BuildDir=%sdkBuildDir:build32=build64%
+)
+
+if "%BuildBits%" == "64" (
+	set sdk32BuildDir=%sdkBuildDir:build64=build32%
+	set sdk64BuildDir=%sdkBuildDir%
+)
+
+cd "%sdk32BuildDir%"
 zip -r "%packageDir%\%zipFile%" *
+
+cd "%sdk64BuildDir%"
+zip -r "%packageDir%\%zipFile%" *
+
 advzip -z -4 "%packageDir%\%zipFile%"
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2c. Package Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2c. Package Build.bat	2010-12-07 19:25:23 UTC (rev 6810)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/2c. Package Build.bat	2010-12-07 19:27:32 UTC (rev 6811)
@@ -2,11 +2,14 @@
 set zipFile=%baseFile%.zip
 
 copy "%buildDir%\Change Log.html" "%packageDir%"
-move "Tools\Package Notes.html" "%packageDir%"
+move "Tools\Package Notes [%BuildBits%].html" "%packageDir%\Package Notes.html"
 
 cd %buildDir%
-echo -- Generating GTK+ Installer --
-"%nsisDir%\makensis" /V2 /NOCD /DINST_GTK /DBUILD_BITS=%BuildBits% /DNSIDIR="%curDir%\..\..\installer" /DEXEDIR="%packageDir%" "%curDir%\..\..\installer\avidemux.nsi"
+if "%BuildBits%" == "32" (
+	echo -- Generating GTK+ Installer --
+	"%nsisDir%\makensis" /V2 /NOCD /DINST_GTK /DBUILD_BITS=%BuildBits% /DNSIDIR="%curDir%\..\..\installer" /DEXEDIR="%packageDir%" "%curDir%\..\..\installer\avidemux.nsi"
+)
+
 echo -- Generating Qt Installer --
 "%nsisDir%\makensis" /V2 /NOCD /DINST_QT /DBUILD_BITS=%BuildBits% /DNSIDIR="%curDir%\..\..\installer" /DEXEDIR="%packageDir%" "%curDir%\..\..\installer\avidemux.nsi"
 

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Set Avidemux Environment Variables.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Set Avidemux Environment Variables.bat	2010-12-07 19:25:23 UTC (rev 6810)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Set Avidemux Environment Variables.bat	2010-12-07 19:27:32 UTC (rev 6811)
@@ -40,8 +40,8 @@
 set buildQtFolder=%buildFolder%\qt
 set buildPluginFolder=%buildFolder%\plugins
 
-set buildDir=%devDir%\avidemux_2.6_build%BuildBits%
-set sdkBuildDir=%devDir%\avidemux_2.6_build%BuildBits%_sdk
+set buildDir=%admBuildDir%
+set sdkBuildDir=%admSdkBuildDir%
 
 set curDir=%CD%
 cd ..\..\..
@@ -53,9 +53,7 @@
 	goto error
 )
 
-if "%BuildBits%" == "32" (set jsFolder=js)
-if "%BuildBits%" == "64" (set jsFolder=js-64)
-
+set jsFolder=js-1.7.0-%BuildBits%
 set SpiderMonkeySourceDir=%devDir%\%jsFolder%\src
 set SpiderMonkeyLibDir=%devDir%\%jsFolder%\src\WINNT6.1_OPT.OBJ
 

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Build Plugins.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Build Plugins.bat	2010-12-07 19:25:23 UTC (rev 6810)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/Build Plugins.bat	2010-12-07 19:27:32 UTC (rev 6811)
@@ -1,17 +1,14 @@
 @echo off
 
-if "%1" == "" (
-	echo Usage: "Build Plugins.bat" [MinGW directory]
-	echo e.g. "Build Plugins.bat" C:\MinGW
-	goto :EOF
-)
+if "%1" == "" goto displayUsage
+if "%2" == "" goto displayUsage
 
 set curDir=%CD%
 set includeDir="%curDir%\..\include"
-set libDir="%curDir%\..\lib"
-set ar="%1\bin\ar"
-set gcc="%1\bin\gcc" -O3 -DNDEBUG
-set gxx="%1\bin\g++" -O3 -DNDEBUG -Wl,-enable-auto-import -Wl,-s
+set libDir="%curDir%\..\lib%1"
+set ar="%2\bin\ar"
+set gcc="%2\bin\gcc" -O3 -DNDEBUG
+set gxx="%2\bin\g++" -O3 -DNDEBUG -Wl,-enable-auto-import -Wl,-s
 
 echo ** AC-3 Audio Decoder **
 
@@ -52,4 +49,11 @@
 
 cd videoFilters\fade
 %gxx% -shared *.cpp -o libADM_vf_fade.dll -I%includeDir% -L%libDir% -lADM_coreImage.dll -lADM_core.dll -lADM_coreUI.dll
-cd %curDir%
\ No newline at end of file
+cd %curDir%
+
+goto :EOF
+
+:displayUsage
+	echo Usage: "Build Plugins.bat" [Bitness] [MinGW directory]
+	echo e.g. "Build Plugins.bat" 32 C:\MinGW
+	goto :EOF
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/gennotes.sh
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/gennotes.sh	2010-12-07 19:25:23 UTC (rev 6810)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/gennotes.sh	2010-12-07 19:27:32 UTC (rev 6811)
@@ -1 +1 @@
-xsltproc package_notes.xslt "../Package Notes.xml" > "Package Notes.html"
\ No newline at end of file
+xsltproc package_notes.xslt "../Package Notes.xml" > "Package Notes [$BUILDBITS].html"
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/gentouch.sh
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/gentouch.sh	2010-12-07 19:25:23 UTC (rev 6810)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/avidemux/Tools/gentouch.sh	2010-12-07 19:27:32 UTC (rev 6811)
@@ -1 +1 @@
-xsltproc touch_files.xslt "../Package Notes.xml" > "../Touch 2.5 Files.html"
\ No newline at end of file
+xsltproc touch_files.xslt "../Package Notes.xml" > "../Touch 2.5 Files [$BUILDBITS].html"
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faac/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faac/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faac/Perform Build.bat	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,62 @@
+ at echo off
+
+echo MSYS build for FAAC
+echo ===================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify >nul
+call "../Set Common Environment Variables"
+if errorlevel 1 goto end
+
+set package=faac-1.28.tar.gz
+set sourceFolder=faac-1.28-%BuildBits%
+set tarFolder=faac-1.28
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget http://downloads.sourceforge.net/faac/%package%
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+mkdir "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+tar xfz "%package%" -C "%devDir%/%sourceFolder%"
+if errorlevel 1 goto end
+
+cd "%devDir%\%sourceFolder%"
+
+for /f "delims=" %%a in ('dir /b %tarFolder%') do (
+  move "%CD%\%tarFolder%\%%a" "%CD%"
+)
+
+copy ".\include\*.h" "%usrLocalDir%\include"
+cd libfaac
+gcc -s -O3 -shared -I../include *.c -o"%usrLocalDir%/bin/libfaac.dll" -Wl,--out-implib,"%usrLocalDir%/lib/libfaac.a"
+if errorlevel 1 goto end
+
+copy "%usrLocalDir%\bin\libfaac.dll" "%admBuildDir%"
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faad/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faad/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/faad/Perform Build.bat	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,62 @@
+ at echo off
+
+echo MSYS build for FAAD
+echo ===================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify >nul
+call "../Set Common Environment Variables"
+if errorlevel 1 goto end
+
+set package=faad2-2.7.tar.gz
+set sourceFolder=faac-2.7-%BuildBits%
+set tarFolder=faad2-2.7
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget http://downloads.sourceforge.net/faac/%package%
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+mkdir "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+tar xfz "%package%" -C "%devDir%/%sourceFolder%"
+if errorlevel 1 goto end
+
+cd "%devDir%\%sourceFolder%"
+
+for /f "delims=" %%a in ('dir /b %tarFolder%') do (
+  move "%CD%\%tarFolder%\%%a" "%CD%"
+)
+
+copy ".\include\*.h" "%usrLocalDir%\include"
+cd libfaad
+gcc -s -O3 -DHAVE_MEMCPY=1 -DHAVE_STRING_H=1 -DHAVE_STDINT_H=1 -I../include -I"." *.c -shared -o "%usrLocalDir%/bin/libfaad2.dll" -Wl,--out-implib,"%usrLocalDir%/lib/libfaad.a"
+if errorlevel 1 goto end
+
+copy "%usrLocalDir%\bin\libfaad2.dll" "%admBuildDir%"
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/Perform Build.bat	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,77 @@
+ at echo off
+
+echo MSYS build for fontconfig
+echo =========================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify >nul
+call "../Set Common Environment Variables"
+if errorlevel 1 goto end
+
+set package=fontconfig-2.8.0.tar.gz
+set sourceFolder=fontconfig-2.8.0-%BuildBits%
+set tarFolder=fontconfig-2.8.0
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget http://fontconfig.org/release/%package%
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+mkdir "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+tar xfz "%package%" -C "%devDir%/%sourceFolder%"
+if errorlevel 1 goto end
+
+cd "%devDir%\%sourceFolder%"
+
+for /f "delims=" %%a in ('dir /b %tarFolder%') do (
+  move "%CD%\%tarFolder%\%%a" "%CD%"
+)
+
+echo.
+echo Configuring
+sh ./configure --prefix="%usrLocalDir%" --disable-static
+
+if "%BuildBits%" == "64" (
+	echo.
+	echo Patching
+	patch -p0 -i "%curDir%\libtool.patch"
+)
+
+if errorlevel 1 goto end
+echo.
+pause
+
+make install
+if errorlevel 1 goto end
+
+del "%usrLocalDir%\etc\fonts\fonts.conf.bak"
+copy "%usrLocalDir%\bin\libfontconfig-1.dll" "%admBuildDir%"
+xcopy /s/y "%usrLocalDir%\etc\fonts\*.*" "%admBuildDir%\etc\fonts\"
+
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/libtool.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/libtool.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/fontconfig/libtool.patch	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,11 @@
+--- libtool.orig	2010-11-27 22:40:35 +0000
++++ libtool	2010-11-27 22:52:21 +0000
+@@ -117,7 +117,7 @@
+ reload_cmds="\$LD\$reload_flag -o \$output\$reload_objs"
+ 
+ # Method to check whether dependent libraries are shared objects.
+-deplibs_check_method="file_magic file format pei*-i386(.*architecture: i386)?"
++deplibs_check_method="file_magic file format pei*-x86-64(.*architecture: i386)?"
+ 
+ # Command to use when deplibs_check_method == "file_magic".
+ file_magic_cmd="\$OBJDUMP -f"

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/Makefile.ref.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/Makefile.ref.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/Makefile.ref.patch	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,11 @@
+--- src/Makefile.ref.orig	2010-11-28 02:53:57 +0000
++++ src/Makefile.ref	2010-11-28 02:53:12 +0000
+@@ -94,7 +94,7 @@
+ ifeq ($(OS_ARCH),WINNT)
+ _MSC_VER = $(shell $(CC) 2>&1 | sed -n 's/.*Compiler Version \([0-9]*\)\.\([0-9]*\).*/\1\2/p')
+ ifeq (,$(filter-out 1200 1300 1310,$(_MSC_VER)))
+-CFLAGS += -Op
++#CFLAGS += -Op
+ else
+ CFLAGS += -fp:precise
+ endif

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/Perform Build.bat	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,76 @@
+ at echo off
+
+%~d0
+cd "%~dp0"
+
+echo MSYS build for SpiderMonkey
+echo ===========================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify >nul
+call "../Set Common Environment Variables"
+if errorlevel 1 goto end
+
+set package=js-1.7.0.tar.gz
+set sourceFolder=js-1.7.0-%BuildBits%
+set tarFolder=js
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget http://ftp.mozilla.org/pub/mozilla.org/js/%package%
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+mkdir "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+tar xfz "%package%" -C "%devDir%/%sourceFolder%"
+if errorlevel 1 goto end
+
+cd "%devDir%\%sourceFolder%"
+
+for /f "delims=" %%a in ('dir /b %tarFolder%') do (
+	move "%CD%\%tarFolder%\%%a" "%CD%"
+)
+
+echo.
+echo Patching
+copy "%curDir%\WINNT6.1.mk" .\src\config
+patch -p0 -i "%curDir%\Makefile.ref.patch"
+patch -p0 -i "%curDir%\jsnum.c.patch"
+
+echo.
+cd src
+windres -i js3240.rc -o jsres.o -O coff
+set CFLAGS=%CFLAGS% -I"%usrLocalDir%/include/nspr"
+make -f Makefile.ref JS_DIST="%usrLocalDir%" BUILD_OPT=1 JS_HAS_FILE_OBJECT=1 XLDFLAGS="%LDFLAGS% jsres.o -L%usrLocalDir%/lib -lnspr4"
+if errorlevel 1 goto end
+echo.
+
+copy "WINNT6.1_OPT.OBJ\libjs.dll" "%usrLocalDir%\bin"
+copy "%usrLocalDir%\bin\libjs.dll" "%admBuildDir%"
+
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/WINNT6.1.mk
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/WINNT6.1.mk	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/WINNT6.1.mk	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,26 @@
+CC = gcc
+CCC = g++
+LD = g++
+
+CFLAGS +=  -Wall -Wno-format
+OS_CFLAGS = -D_X86_=1 -DXP_WIN -DXP_WIN32 -DWIN32 -D_WINDOWS -D_WIN32 -DWINVER=0x500 -D_WIN32_WINNT=0x500 -D_MINGW -DEXPORT_JS_API
+
+XMKSHLIBOPTS += -Wl,--out-implib=$(OBJDIR)/libjs.dll.a
+RANLIB = ranlib
+MKSHLIB = $(LD) -shared $(XMKSHLIBOPTS)
+
+ifdef BUILD_OPT
+OS_CFLAGS += -s
+endif
+
+#.c.o:
+#      $(CC) -c -MD $*.d $(CFLAGS) $<
+
+CPU_ARCH = x86
+GFX_ARCH = win32
+
+JSDLL_CFLAGS = -DEXPORT_JS_API
+OS_LIBS = -lm -lc
+
+PREBUILT_CPUCFG = 1
+SO_SUFFIX=dll
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/jsnum.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/jsnum.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/js/jsnum.c.patch	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,11 @@
+--- src/jsnum.c.orig	2007-04-06 21:53:22 +0100
++++ src/jsnum.c	2010-11-28 03:00:05 +0000
+@@ -528,7 +528,7 @@
+  * to 53 bit mantissa.
+  * On Alpha platform this is handled via Compiler option.
+  */
+-#define FIX_FPU() _control87(MCW_EM | PC_53, MCW_EM | MCW_PC)
++#define FIX_FPU() _control87(_MCW_EM | _PC_53, _MCW_EM | _MCW_PC)
+ 
+ #else
+ 

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/lame/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/lame/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/lame/Perform Build.bat	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,72 @@
+ at echo off
+
+echo MSYS build for LAME
+echo ===================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify >nul
+call "../Set Common Environment Variables"
+if errorlevel 1 goto end
+
+set package=lame-3.98.4.tar.gz
+set sourceFolder=lame-3.98.4-%BuildBits%
+set tarFolder=lame-3.98.4
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget http://sourceforge.net/projects/lame/files/lame/3.98.4/%package%/download/
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+mkdir "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+tar xfz "%package%" -C "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+cd "%devDir%\%sourceFolder%"
+
+for /f "delims=" %%a in ('dir /b %tarFolder%') do (
+  move "%CD%\%tarFolder%\%%a" "%CD%"
+)
+
+echo.
+echo Configuring
+
+if "%BuildBits%" == "32" sh ./configure --prefix="%usrLocalDir%" --disable-static --enable-nasm
+if "%BuildBits%" == "64" sh ./configure --prefix="%usrLocalDir%" --disable-static
+
+if errorlevel 1 goto end
+echo.
+pause
+
+make install
+if errorlevel 1 goto end
+
+strip "%usrLocalDir%\bin\libmp3lame-0.dll"
+copy "%usrLocalDir%\bin\libmp3lame-0.dll" "%admBuildDir%"
+
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libogg/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libogg/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libogg/Perform Build.bat	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,70 @@
+ at echo off
+
+echo MSYS build for libogg
+echo =====================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify >nul
+call "../Set Common Environment Variables"
+if errorlevel 1 goto end
+
+set package=libogg-1.2.1.tar.gz
+set sourceFolder=libogg-1.2.1-%BuildBits%
+set tarFolder=libogg-1.2.1
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget http://downloads.xiph.org/releases/ogg/%package%
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+mkdir "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+tar xfz "%package%" -C "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+cd "%devDir%\%sourceFolder%"
+
+for /f "delims=" %%a in ('dir /b %tarFolder%') do (
+  move "%CD%\%tarFolder%\%%a" "%CD%"
+)
+
+echo.
+echo Configuring
+
+sh ./configure --prefix="%usrLocalDir%" --disable-static
+
+if errorlevel 1 goto end
+echo.
+pause
+
+make install-strip
+if errorlevel 1 goto end
+
+copy "%usrLocalDir%\bin\libogg-0.dll" "%admBuildDir%"
+
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvorbis/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvorbis/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvorbis/Perform Build.bat	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,75 @@
+ at echo off
+
+echo MSYS build for libvorbis
+echo ========================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify >nul
+call "../Set Common Environment Variables"
+if errorlevel 1 goto end
+
+set package=libvorbis-1.3.2.tar.gz
+set sourceFolder=libvorbis-1.3.2-%BuildBits%
+set tarFolder=libvorbis-1.3.2
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget http://downloads.xiph.org/releases/vorbis/%package%
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+mkdir "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+tar xfz "%package%" -C "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+cd "%devDir%\%sourceFolder%"
+
+for /f "delims=" %%a in ('dir /b %tarFolder%') do (
+	move "%CD%\%tarFolder%\%%a" "%CD%"
+)
+
+echo.
+echo Configuring
+
+sh ./configure --prefix="%usrLocalDir%" --disable-static --disable-examples --disable-docs
+
+echo.
+echo Patching
+patch -p0 -i "%curDir%\libtool.patch"
+
+if errorlevel 1 goto end
+echo.
+pause
+
+make install-strip
+if errorlevel 1 goto end
+
+copy "%usrLocalDir%\bin\libvorbis-0.dll" "%admBuildDir%"
+copy "%usrLocalDir%\bin\libvorbisenc-2.dll" "%admBuildDir%"
+
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvorbis/libtool.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvorbis/libtool.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvorbis/libtool.patch	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,24 @@
+--- libtool.orig	2010-11-27 19:32:53 +0000
++++ libtool	2010-11-27 19:33:08 +0000
+@@ -6446,8 +6446,8 @@
+ 		esac
+ 		else
+ 		  eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
+-		  test -z "$libdir" && \
+-		    func_fatal_error "\`$deplib' is not a valid libtool archive"
++		  #test -z "$libdir" && \
++		    #func_fatal_error "\`$deplib' is not a valid libtool archive"
+ 		  test "$absdir" != "$libdir" && \
+ 		    func_warning "\`$deplib' seems to be moved"
+ 
+@@ -8570,8 +8570,8 @@
+ 		func_basename "$deplib"
+ 		name="$func_basename_result"
+ 		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
+-		test -z "$libdir" && \
+-		  func_fatal_error "\`$deplib' is not a valid libtool archive"
++		#test -z "$libdir" && \
++		  #func_fatal_error "\`$deplib' is not a valid libtool archive"
+ 		newdependency_libs="$newdependency_libs $libdir/$name"
+ 		;;
+ 	      *) newdependency_libs="$newdependency_libs $deplib" ;;

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/Perform Build.bat	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,74 @@
+ at echo off
+
+echo MSYS build for libvpx
+echo =====================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify >nul
+call "../Set Common Environment Variables"
+if errorlevel 1 goto end
+
+set package=libvpx-v0.9.5.tar.bz2
+set sourceFolder=libvpx-0.9.5-%BuildBits%
+set tarFolder=libvpx-v0.9.5
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget http://webm.googlecode.com/files/%package%
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+mkdir "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+tar xfj "%package%" -C "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+cd "%devDir%\%sourceFolder%"
+
+for /f "delims=" %%a in ('dir /b %tarFolder%') do (
+  move "%CD%\%tarFolder%\%%a" "%CD%"
+)
+
+echo.
+echo Patching
+patch -p0 -i "%curDir%\configure.patch"
+patch -p0 -i "%curDir%\configure.sh.patch"
+
+echo.
+echo Configuring
+
+if "%BuildBits%" == "32" sh ./configure --prefix="%usrLocalDir%" --disable-vp8-encoder
+if "%BuildBits%" == "64" sh ./configure --prefix="%usrLocalDir%" --disable-vp8-encoder --target=x86_64-win64-gcc
+
+if errorlevel 1 goto end
+echo.
+pause
+
+make install
+if errorlevel 1 goto end
+
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/configure.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/configure.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/configure.patch	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,10 @@
+--- configure.orig	2010-11-27 11:16:30 +0000
++++ configure	2010-11-27 11:15:53 +0000
+@@ -117,6 +117,7 @@
+ all_platforms="${all_platforms} x86_64-linux-gcc"
+ all_platforms="${all_platforms} x86_64-linux-icc"
+ all_platforms="${all_platforms} x86_64-solaris-gcc"
++all_platforms="${all_platforms} x86_64-win64-gcc"
+ all_platforms="${all_platforms} x86_64-win64-vs8"
+ all_platforms="${all_platforms} x86_64-win64-vs9"
+ all_platforms="${all_platforms} universal-darwin8-gcc"

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/configure.sh.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/configure.sh.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/libvpx/configure.sh.patch	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,17 @@
+--- build/make/configure.sh.orig	2010-10-28 14:14:14 +0100
++++ build/make/configure.sh	2010-11-27 11:45:42 +0000
+@@ -877,8 +877,12 @@
+         [ "${AS##*/}" = nasm ] && add_asflags -Ox
+         AS_SFX=.asm
+         case  ${tgt_os} in
+-            win*)
+-                add_asflags -f win${bits}
++            win32)
++                add_asflags -f win32
++                enabled debug && add_asflags -g dwarf2
++            ;;
++			win64)
++                add_asflags -f x64
+                 enabled debug && add_asflags -g dwarf2
+             ;;
+             linux*|solaris*)

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/nspr/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/nspr/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/nspr/Perform Build.bat	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,80 @@
+ at echo off
+
+%~d0
+cd "%~dp0"
+
+echo MSYS build for nspr
+echo ===================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify >nul
+call "../Set Common Environment Variables"
+if errorlevel 1 goto end
+
+set package=nspr-4.8.6.tar.gz
+set sourceFolder=nspr-4.8.6-%BuildBits%
+set tarFolder=nspr-4.8.6
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget ftp://ftp.mozilla.org/pub/mozilla.org/nspr/releases/v4.8.6/src/%package%
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+mkdir "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+tar xfz "%package%" -C "%devDir%/%sourceFolder%"
+if errorlevel 1 goto end
+
+cd "%devDir%\%sourceFolder%"
+
+for /f "delims=" %%a in ('dir /b %tarFolder%') do (
+	move "%CD%\%tarFolder%\%%a" "%CD%"
+)
+
+echo.
+echo Configuring
+cd mozilla\nsprpub
+sh ./configure --prefix="%usrLocalDir%" --enable-strip --enable-win32-target=WIN95 --enable-optimize --disable-debug
+
+if errorlevel 1 goto end
+echo.
+pause
+
+make
+if errorlevel 1 goto end
+
+make install
+if errorlevel 1 goto end
+
+move "%usrLocalDir%\lib\nspr4.dll" "%usrLocalDir%\bin"
+copy "%usrLocalDir%\bin\nspr4.dll" "%admBuildDir%"
+
+pexports "%usrLocalDir%/bin/nspr4.dll" > nspr4.def
+dlltool -d nspr4.def -l "%usrLocalDir%/lib/nspr4.dll.a"
+
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/opencore-amr/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/opencore-amr/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/opencore-amr/Perform Build.bat	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,75 @@
+ at echo off
+
+echo MSYS build for opencore-amr
+echo ===========================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify >nul
+call "../Set Common Environment Variables"
+if errorlevel 1 goto end
+
+set package=opencore-amr-0.1.2.tar.gz
+set sourceFolder=opencore-amr-0.1.2-%BuildBits%
+set tarFolder=opencore-amr-0.1.2
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget http://sourceforge.net/projects/opencore-amr/files/opencore-amr/0.1.2/%package%/download
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+mkdir "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+tar xfz "%package%" -C "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+cd "%devDir%\%sourceFolder%"
+
+for /f "delims=" %%a in ('dir /b %tarFolder%') do (
+  move "%CD%\%tarFolder%\%%a" "%CD%"
+)
+
+echo.
+echo Patching
+patch -p0 -i "%curDir%\amrnb_Makefile.in"
+patch -p0 -i "%curDir%\amrwb_Makefile.in"
+
+echo.
+echo Configuring
+
+sh ./configure --prefix="%usrLocalDir%" --disable-static
+
+if errorlevel 1 goto end
+echo.
+pause
+
+make install-strip
+if errorlevel 1 goto end
+
+copy "%usrLocalDir%\bin\libopencore-amrnb-0.dll" "%admBuildDir%"
+copy "%usrLocalDir%\bin\libopencore-amrwb-0.dll" "%admBuildDir%"
+
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/opencore-amr/amrnb_Makefile.in
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/opencore-amr/amrnb_Makefile.in	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/opencore-amr/amrnb_Makefile.in	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,11 @@
+--- amrnb/Makefile.in.orig	2009-09-18 18:45:43 +0100
++++ amrnb/Makefile.in	2010-11-27 20:52:08 +0000
+@@ -274,7 +274,7 @@
+ pkgconfigdir = $(libdir)/pkgconfig
+ pkgconfig_DATA = opencore-amrnb.pc
+ lib_LTLIBRARIES = libopencore-amrnb.la
+-libopencore_amrnb_la_LDFLAGS = -version-info @OPENCORE_AMRNB_VERSION@
++libopencore_amrnb_la_LDFLAGS = -version-info @OPENCORE_AMRNB_VERSION@ -no-undefined
+ 
+ # Our sources to include. There are certain sources we exclude and they are
+ # $(DEC_SRC_DIR)/decoder_gsm_amr.cpp

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/opencore-amr/amrwb_Makefile.in
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/opencore-amr/amrwb_Makefile.in	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/opencore-amr/amrwb_Makefile.in	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,11 @@
+--- amrwb/Makefile.in.orig	2010-11-27 20:54:46 +0000
++++ amrwb/Makefile.in	2010-11-27 20:52:45 +0000
+@@ -250,7 +250,7 @@
+ pkgconfigdir = $(libdir)/pkgconfig
+ pkgconfig_DATA = opencore-amrwb.pc
+ lib_LTLIBRARIES = libopencore-amrwb.la
+-libopencore_amrwb_la_LDFLAGS = -version-info @OPENCORE_AMRWB_VERSION@
++libopencore_amrwb_la_LDFLAGS = -version-info @OPENCORE_AMRWB_VERSION@ -no-undefined
+ 
+ # Our sources to include. There are certain sources we exclude and they are
+ # $(DEC_SRC_DIR)/decoder_amr_wb.cpp

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/x264/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/x264/Perform Build.bat	2010-12-07 19:25:23 UTC (rev 6810)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/x264/Perform Build.bat	2010-12-07 19:27:32 UTC (rev 6811)
@@ -16,7 +16,7 @@
 verify >nul
 call "../Set Common Environment Variables"
 
-if errorlevel 1 goto error
+if errorlevel 1 goto end
 
 set PATH=%PATH%;%devDir%\Git\bin
 
@@ -24,32 +24,26 @@
 del "%usrLocalDir%\include\x264.h"
 cd "%devDir%"
 
-if "%BuildBits%" == "32" (
-	set sourceFolder=x264
-	set buildFolder=build
-)
-
-if "%BuildBits%" == "64" (
-	set sourceFolder=x264-64
-	set buildFolder=build64
-	set configFlags=--host=x86_64-pc-mingw32
-)
-
+set sourceFolder=x264-%BuildBits%
 rm -r -f %sourceFolder%
+if errorlevel 1 goto end
 
 echo Downloading from git
 git clone git://git.videolan.org/x264.git %sourceFolder%
 if errorlevel 1 goto end
 
 cd "%devDir%/%sourceFolder%"
-sh ./configure --prefix=/usr/local --enable-shared %configFlags%
+
+if "%BuildBits%" == "32" sh ./configure --prefix=%usrLocalDir% --enable-shared
+if "%BuildBits%" == "64" sh ./configure --prefix=%usrLocalDir% --enable-shared --host=x86_64-pc-mingw32
+
 if errorlevel 1 goto end
 
 make install
 if errorlevel 1 goto end
 
-del "%devDir%\avidemux_2.5_%buildFolder%\libx264-*.dll"
-copy "%usrLocalDir%/bin/libx264-*.dll" "%devDir%\avidemux_2.5_%buildFolder%"
+del "%admBuildDir%\libx264-*.dll"
+copy "%usrLocalDir%/bin/libx264-*.dll" "%admBuildDir%"
 
 :end
 pause
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/Perform Build.bat
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/Perform Build.bat	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/Perform Build.bat	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,79 @@
+ at echo off
+
+echo MSYS build for Xvid
+echo ===================
+echo 1. 32-bit build
+echo 2. 64-bit build
+echo X. Exit
+echo.
+
+choice /c 12x
+
+if errorlevel 1 set BuildBits=32
+if errorlevel 2 set BuildBits=64
+if errorlevel 3 goto :eof
+
+verify >nul
+call "../Set Common Environment Variables"
+if errorlevel 1 goto end
+
+set package=xvidcore-1.2.2.tar.gz
+set sourceFolder=xvidcore-1.2.2-%BuildBits%
+set curDir=%CD%
+
+if not exist %package% (
+	echo.
+	echo Downloading
+	wget http://downloads.xvid.org/downloads/%package%
+)
+
+if errorlevel 1 goto end
+
+echo.
+echo Preparing
+rm -r -f "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+mkdir "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+tar xfz "%package%" -C "%devDir%\%sourceFolder%"
+if errorlevel 1 goto end
+
+cd "%devDir%\%sourceFolder%"
+
+for /f "delims=" %%a in ('dir /b xvidcore') do (
+  move "%CD%\xvidcore\%%a" "%CD%"
+)
+
+echo.
+echo Patching
+patch -p0 -i "%curDir%\configure.patch"
+patch -p0 -i "%curDir%\nasm.inc.patch"
+
+echo.
+echo Configuring
+cd build\generic
+
+if "%BuildBits%" == "32" sh ./configure --prefix="%usrLocalDir%"
+if "%BuildBits%" == "64" sh ./configure --prefix="%usrLocalDir%" --build=x86_64-pc-mingw32
+if errorlevel 1 goto end
+echo.
+pause
+
+make LDFLAGS="%LDFLAGS% -Wl,-s"
+if errorlevel 1 goto end
+
+make install
+if errorlevel 1 goto end
+
+move "%usrLocalDir%\lib\xvidcore.dll" "%usrLocalDir%\bin"
+copy "%usrLocalDir%\bin\xvidcore.dll" "%admBuildDir%"
+copy ".\=build\xvidcore.dll.a" "%usrLocalDir%\lib"
+goto end
+
+:error
+echo Error
+
+:end
+pause
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/configure.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/configure.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/configure.patch	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,11 @@
+--- build/generic/configure.orig	2009-05-28 18:13:31 +0100
++++ build/generic/configure	2010-11-27 10:25:35 +0000
+@@ -1319,7 +1319,7 @@
+ API_MAJOR="4"
+ API_MINOR="2"
+ 
+-minimum_yasm_minor_version=8
++minimum_yasm_minor_version=1
+ minimum_nasm_minor_version=0
+ minimum_nasm_major_version=2
+ nasm_prog="nasm"

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/nasm.inc.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/nasm.inc.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/mswin/xvid/nasm.inc.patch	2010-12-07 19:27:32 UTC (rev 6811)
@@ -0,0 +1,16 @@
+--- src/nasm.inc.orig	2009-05-28 16:04:35 +0100
++++ src/nasm.inc	2010-11-27 10:51:04 +0000
+@@ -157,9 +157,10 @@
+ %define XVID_MOVSXD movsx
+ %endif
+ 
+-
+-%ifdef WINDOWS
+-      %define PREFIX
++%ifndef ARCH_IS_X86_64
++      %ifdef WINDOWS
++            %define PREFIX
++      %endif
+ %endif
+ 
+ %ifdef NO_PREFIX



From mean at mail.berlios.de  Wed Dec  8 17:40:35 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed,  8 Dec 2010 17:40:35 +0100
Subject: [Avidemux-svn-commit] r6812 - in branches/avidemux_2.6_branch_mean:
	. foreignBuilds
Message-ID: <20101208164035.9A048480D0F@sheep.berlios.de>

Author: mean
Date: 2010-12-08 17:40:35 +0100 (Wed, 08 Dec 2010)
New Revision: 6812

Added:
   branches/avidemux_2.6_branch_mean/bootStrapCrossMingw_w64.sh
   branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_cmake
   branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_core
   branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_plugins
   branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_qt4
Log:
[win64] Add new cross building scripts

Added: branches/avidemux_2.6_branch_mean/bootStrapCrossMingw_w64.sh
===================================================================
--- branches/avidemux_2.6_branch_mean/bootStrapCrossMingw_w64.sh	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/bootStrapCrossMingw_w64.sh	2010-12-08 16:40:35 UTC (rev 6812)
@@ -0,0 +1,49 @@
+#!/bin/bash
+# ** Put your config here **
+export PATH=$PATH:/mingw/bin
+export CROSS_PREFIX=x86_64-w64-mingw32
+export SDLDIR=/mingw
+export MINGW=/mingw
+export QT_HOME=/mingw/Qt/qt471win64
+export CFLAGS="-fpermissive"
+# ** Put your config here **
+
+fail()
+{
+        echo "** Failed at $1**"
+        exit 1
+}
+
+Process()
+{
+        export BUILDDIR=$1
+        export SCRIPT=$2
+        export EXTRA=$3
+        echo "Building $BUILDDIR from $SOURCEDIR (Extra=$EXTRA)"
+        rm -Rf ./$BUILDDIR
+        mkdir $BUILDDIR || fail mkdir
+        cd $BUILDDIR 
+        sh $TOP/foreignBuilds/$SCRIPT $EXTRA || fail cmake
+        make  VERBOSE=1 || fail make
+        make install || fail make_install
+}
+
+echo "**BootStrapping avidemux **"
+export TOP=$PWD
+echo "Top dir : $TOP"
+echo "** CORE **"
+cd $TOP
+Process buildMingwCore cross_mingw64_core
+echo "** QT4 **"
+cd $TOP
+Process buildMingwQt4 cross_mingw64_qt4 
+#echo "** GTK **"
+#cd $TOP
+#Process buildGtk ../avidemux/gtk
+echo "** Plugins **"
+cd $TOP
+Process buildMingwPluginsCommon cross_mingw64_plugins -DPLUGIN_UI=COMMON
+Process buildMingwPluginsQt4 cross_mingw64_plugins -DPLUGIN_UI=QT4
+echo "** All done **"
+cd $TOP
+echo "** ALL DONE **"

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_cmake	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_cmake	2010-12-08 16:40:35 UTC (rev 6812)
@@ -0,0 +1,20 @@
+# this one is important
+SET(CMAKE_SYSTEM_NAME Windows)
+#this one not so much
+SET(CMAKE_SYSTEM_VERSION 1)
+SET(CS "x86_64-w64-mingw32")
+# specify the cross compiler
+SET(CMAKE_C_COMPILER   ${CS}-gcc)
+SET(CMAKE_CXX_COMPILER ${CS}-g++)
+SET(CMAKE_LINKER ${CS}-ld)
+SET(CMAKE_AR ${CS}-ar)
+
+# where is the target environment 
+SET(CMAKE_FIND_ROOT_PATH  /mingw/)
+
+# search for programs in the build host directories
+SET(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER)
+# for libraries and headers in the target directories
+SET(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)
+SET(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)
+

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_core
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_core	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_core	2010-12-08 16:40:35 UTC (rev 6812)
@@ -0,0 +1,17 @@
+#!/bin/bash
+export PKG_CONFIG_PATH=$MINGW/lib/pkgconfig
+export PKG_CONFIG_LIBDIR=$MINGW/lib/pkgconfig
+export CXXFLAGS="-I$MINGW/include"
+export CFLAGS="-I$MINGW/include"
+export CPPFLAGS="-I$MINGW/include"
+export LDFLAGS="-L$MINGW/lib"
+export PATH=$MINGW/bin:$PATH
+pkg-config --list-all
+#export DEBUG="-DVERBOSE=1 -DDEBUG=1  -DCMAKE_BUILD_TYPE=Debug    "
+echo "<<<<<<<<<<<<Cross compiling core ($MINGW)>>>>>>>>>>>>>>>>"
+cmake   -DCROSS=$MINGW \
+        -DCMAKE_INSTALL_PREFIX=$MINGW/Release \
+	-DCMAKE_TOOLCHAIN_FILE=$TOP/foreignBuilds/cross_mingw64_cmake \
+        $DEBUG\
+        -DAVIDEMUX_TOP_SOURCE_DIR="$TOP"  \
+        $TOP/avidemux_core

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_plugins
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_plugins	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_plugins	2010-12-08 16:40:35 UTC (rev 6812)
@@ -0,0 +1,19 @@
+#!/bin/bash
+export PKG_CONFIG_PATH=$MINGW/lib/pkgconfig
+export PKG_CONFIG_LIBDIR=$MINGW/lib/pkgconfig
+export CXXFLAGS="-I$MINGW/include -I/usr/i586-mingw32msvc/include"
+export CFLAGS="-I$MINGW/include -I/usr/i586-mingw32msvc/include"
+export CPPFLAGS="-I$MINGW/include -I/usr/i586-mingw32msvc/include"
+export LDFLAGS="-L$MINGW/lib -L/usr/i586-mingw32msvc/lib"
+export PATH=$MINGW/bin:$PATH
+pkg-config --list-all
+#export DEBUG="-DVERBOSE=1   -DCMAKE_BUILD_TYPE=Debug -G \"CodeBlocks - Unix Makefiles\"   "
+echo "<<<<<<<<<<<<Cross compiling plugins>>>>>>>>>>>>>>>"
+cmake   -DCROSS=$MINGW \
+        -DCMAKE_INSTALL_PREFIX=$MINGW/Release \
+	-DCMAKE_TOOLCHAIN_FILE=$TOP/foreignBuilds/cross_mingw64_cmake \
+        -DQT_HOME:STRING=$QT_HOME \
+         $DEBUG \
+        -DAVIDEMUX_SOURCE_DIR="$TOP"  \
+        $@ \
+        $TOP/avidemux_plugins

Added: branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_qt4
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_qt4	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_qt4	2010-12-08 16:40:35 UTC (rev 6812)
@@ -0,0 +1,19 @@
+#!/bin/bash
+#
+export PKG_CONFIG_PATH=$MINGW/lib/pkgconfig
+export PKG_CONFIG_LIBDIR=$MINGW/lib/pkgconfig
+export CXXFLAGS="-I$MINGW/include"
+export CFLAGS="-I$MINGW/include"
+export CPPFLAGS="-I$MINGW/include"
+export LDFLAGS="-L$MINGW/lib"
+export PATH=$MINGW/bin:$PATH
+pkg-config --list-all
+#export DEBUG="-DVERBOSE=1   -DCMAKE_BUILD_TYPE=Debug -G \"CodeBlocks - Unix Makefiles\"   "
+echo "<<<<<<<<<<<<Cross compiling core>>>>>>>>>>>>>>>"
+cmake   -DCROSS=$MINGW \
+        -DCMAKE_INSTALL_PREFIX=$MINGW/Release \
+        -DQT_HOME:STRING=$QT_HOME \
+	-DCMAKE_TOOLCHAIN_FILE=$TOP/foreignBuilds/cross_mingw64_cmake \
+        $DEBUG \
+        -DAVIDEMUX_TOP_SOURCE_DIR="$TOP"  \
+        $TOP/avidemux/qt4



From mean at mail.berlios.de  Wed Dec  8 17:40:39 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed,  8 Dec 2010 17:40:39 +0100
Subject: [Avidemux-svn-commit] r6813 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include
Message-ID: <20101208164039.19013480D0F@sheep.berlios.de>

Author: mean
Date: 2010-12-08 17:40:38 +0100 (Wed, 08 Dec 2010)
New Revision: 6813

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_assert.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_cpp.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_default.h
Log:
[win64] Must include pthread to avoid define clash

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_assert.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_assert.h	2010-12-08 16:40:35 UTC (rev 6812)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_assert.h	2010-12-08 16:40:38 UTC (rev 6813)
@@ -15,6 +15,7 @@
  ***************************************************************************/
 #ifndef ADM_ASSERT_H
 #define ADM_ASSERT_H
+#include <pthread.h>
 #include <assert.h>
 #include "ADM_inttype.h"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_cpp.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_cpp.h	2010-12-08 16:40:35 UTC (rev 6812)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_cpp.h	2010-12-08 16:40:38 UTC (rev 6813)
@@ -1,4 +1,5 @@
 #include <string>
 #include <vector>
+#include <pthread.h>
 using std::vector;
 using std::string;

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_default.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_default.h	2010-12-08 16:40:35 UTC (rev 6812)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_default.h	2010-12-08 16:40:38 UTC (rev 6813)
@@ -22,6 +22,7 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
+#include <pthread.h>
 
 #include "ADM_coreConfig.h"
 #include "ADM_inttype.h"



From mean at mail.berlios.de  Wed Dec  8 17:40:40 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed,  8 Dec 2010 17:40:40 +0100
Subject: [Avidemux-svn-commit] r6814 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101208164040.28871480D0F@sheep.berlios.de>

Author: mean
Date: 2010-12-08 17:40:39 +0100 (Wed, 08 Dec 2010)
New Revision: 6814

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admCheckRequiredLibs.cmake
Log:
[win64] override pthread detection on cross compilation

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckRequiredLibs.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckRequiredLibs.cmake	2010-12-08 16:40:38 UTC (rev 6813)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckRequiredLibs.cmake	2010-12-08 16:40:39 UTC (rev 6814)
@@ -39,8 +39,14 @@
 
 FIND_PACKAGE(Threads)
 if(CROSS)
-                          MESSAGE(STATUS "Cross compile override")
-                          SET(PTHREAD_LIBRARIES "-lpthreadGC2")
+			  IF(X86_64_SUPPORTED)
+                          	SET(PTHREAD_LIBRARIES "-lpthreadGC2-w64")
+			  ELSE(X86_64_SUPPORTED)
+                          	SET(PTHREAD_LIBRARIES "-lpthreadGC2")
+			  ENDIF(X86_64_SUPPORTED)
+			  MESSAGE(STATUS "Cross compile override using ${PTHREAD_LIBRARIES} hardcoded")
+			  MESSAGE(STATUS "INCLUDE=<${PTHREAD_INCLUDE_DIR}>, LIB=<${PTHREAD_LIBRARIES}>")
+			  SET(PTHREAD_FOUND TRUE)
 endif(CROSS)
 
 PRINT_LIBRARY_INFO("pthreads" PTHREAD_FOUND "${PTHREAD_INCLUDE_DIR}" "${PTHREAD_LIBRARIES}" FATAL_ERROR)
@@ -56,4 +62,4 @@
 FIND_PACKAGE(ZLIB)
 PRINT_LIBRARY_INFO("zlib" ZLIB_FOUND "${ZLIB_INCLUDE_DIR}" "${ZLIB_LIBRARY}" FATAL_ERROR)
 
-MESSAGE("")
\ No newline at end of file
+MESSAGE("")



From mean at mail.berlios.de  Wed Dec  8 17:40:41 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed,  8 Dec 2010 17:40:41 +0100
Subject: [Avidemux-svn-commit] r6815 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src
Message-ID: <20101208164041.45363480D0F@sheep.berlios.de>

Author: mean
Date: 2010-12-08 17:40:41 +0100 (Wed, 08 Dec 2010)
New Revision: 6815

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs.cpp
Log:
[win64] Rename type UINT to ADM_UINT so that it does not clash with system header

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs.cpp	2010-12-08 16:40:39 UTC (rev 6814)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs.cpp	2010-12-08 16:40:41 UTC (rev 6815)
@@ -32,12 +32,12 @@
 class preferences *prefs;
 // <prefs_gen>
 typedef enum {
-	UINT,
-	INT,
-	ULONG,
-	LONG,
-	FLOAT,
-	STRING,
+	ADM_UADM_INT,
+	ADM_INT,
+	ADM_UADM_LONG,
+	ADM_LONG,
+	ADM_FLOAT,
+	ADM_STRING,
 	FILENAME
 } types;
 
@@ -51,89 +51,89 @@
 } opt_def;
 
 static opt_def opt_defs [] = {
-	{"codecs.svcd.enctype",		UINT,	"0",	NULL,	"0",	"99999"},
-	{"codecs.svcd.bitrate",		UINT,	"1500000",NULL,	"16000","2748000"},
-	{"codecs.svcd.quantizer",		UINT,	"4",	NULL,	"2",	"31"	},
-	{"codecs.svcd.finalsize",	UINT,	"700",	NULL,	"0",	"99999"},
-	{"codecs.svcd.interlaced",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"codecs.svcd.bff",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"codecs.svcd.widescreen",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"codecs.svcd.matrix",		UINT,	"0",	NULL,	"0",	"99999"},
-	{"codecs.svcd.gopsize",		UINT,	"12",	NULL,	"0",	"99999"},
-	{"codecs.svcd.maxbitrate",		UINT,	"2500",	NULL,	"0",	"2748"	},
-	{"codecs.dvd.enctype",		UINT,	"0",	NULL,	"0",	"99999"},
-	{"codecs.dvd.bitrate",		UINT,	"1500000",NULL,	"16000","9900000"},
-	{"codecs.dvd.quantizer",		UINT,	"4",	NULL,	"2",	"31"	},
-	{"codecs.dvd.finalsize",	UINT,	"700",	NULL,	"0",	"99999"},
-	{"codecs.dvd.interlaced",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"codecs.dvd.bff",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"codecs.dvd.widescreen",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"codecs.dvd.matrix",		UINT,	"0",	NULL,	"0",	"99999"},
-	{"codecs.dvd.gopsize",		UINT,	"12",	NULL,	"0",	"99999"},
-	{"codecs.dvd.maxbitrate",		UINT,	"9000",	NULL,	"0",	"9900"	},
-	{"codecs.xvid.enctype",		UINT,	"0",	NULL,	"0",	"99999"},
-	{"codecs.xvid.quantizer",		UINT,	"4",	NULL,	"2",	"32"	},
-	{"codecs.xvid.bitrate",		UINT,	"1500000",NULL,	"17",	"5900000"},
-	{"codecs.xvid.finalsize",	UINT,	"700",	NULL,	"0",	"3999"	},
-	{"codecs.preferredcodec",		STRING,"FFmpeg4",NULL, NULL, NULL },
+	{"codecs.svcd.enctype",		ADM_UADM_INT,	"0",	NULL,	"0",	"99999"},
+	{"codecs.svcd.bitrate",		ADM_UADM_INT,	"1500000",NULL,	"16000","2748000"},
+	{"codecs.svcd.quantizer",		ADM_UADM_INT,	"4",	NULL,	"2",	"31"	},
+	{"codecs.svcd.finalsize",	ADM_UADM_INT,	"700",	NULL,	"0",	"99999"},
+	{"codecs.svcd.interlaced",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
+	{"codecs.svcd.bff",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
+	{"codecs.svcd.widescreen",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
+	{"codecs.svcd.matrix",		ADM_UADM_INT,	"0",	NULL,	"0",	"99999"},
+	{"codecs.svcd.gopsize",		ADM_UADM_INT,	"12",	NULL,	"0",	"99999"},
+	{"codecs.svcd.maxbitrate",		ADM_UADM_INT,	"2500",	NULL,	"0",	"2748"	},
+	{"codecs.dvd.enctype",		ADM_UADM_INT,	"0",	NULL,	"0",	"99999"},
+	{"codecs.dvd.bitrate",		ADM_UADM_INT,	"1500000",NULL,	"16000","9900000"},
+	{"codecs.dvd.quantizer",		ADM_UADM_INT,	"4",	NULL,	"2",	"31"	},
+	{"codecs.dvd.finalsize",	ADM_UADM_INT,	"700",	NULL,	"0",	"99999"},
+	{"codecs.dvd.interlaced",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
+	{"codecs.dvd.bff",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
+	{"codecs.dvd.widescreen",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
+	{"codecs.dvd.matrix",		ADM_UADM_INT,	"0",	NULL,	"0",	"99999"},
+	{"codecs.dvd.gopsize",		ADM_UADM_INT,	"12",	NULL,	"0",	"99999"},
+	{"codecs.dvd.maxbitrate",		ADM_UADM_INT,	"9000",	NULL,	"0",	"9900"	},
+	{"codecs.xvid.enctype",		ADM_UADM_INT,	"0",	NULL,	"0",	"99999"},
+	{"codecs.xvid.quantizer",		ADM_UADM_INT,	"4",	NULL,	"2",	"32"	},
+	{"codecs.xvid.bitrate",		ADM_UADM_INT,	"1500000",NULL,	"17",	"5900000"},
+	{"codecs.xvid.finalsize",	ADM_UADM_INT,	"700",	NULL,	"0",	"3999"	},
+	{"codecs.preferredcodec",		ADM_STRING,"FFmpeg4",NULL, NULL, NULL },
 	{"filters.subtitle.fontname",		FILENAME,"/usr/share/fonts/truetype/DejaVuSans.ttf",NULL, NULL, NULL },
-	{"filters.subtitle.charset",		STRING,"ISO-8859-1",NULL, NULL, NULL },
-	{"filters.subtitle.fontsize",		UINT,	"24",	NULL,	"1",	"576"	},
-	{"filters.subtitle.ypercent",	INT,	"255",	NULL,	"0",	"255"	},
-	{"filters.subtitle.upercent",		INT,	"0",	NULL,	"0",	"255"	},
-	{"filters.subtitle.vpercent",		INT,	"0",	NULL,	"0",	"255"	},
-	{"filters.subtitle.selfadjustable",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"filters.subtitle.usebackgroundcolor",		UINT,	"0",	NULL,	"0",	"1"	},
+	{"filters.subtitle.charset",		ADM_STRING,"ISO-8859-1",NULL, NULL, NULL },
+	{"filters.subtitle.fontsize",		ADM_UADM_INT,	"24",	NULL,	"1",	"576"	},
+	{"filters.subtitle.ypercent",	ADM_INT,	"255",	NULL,	"0",	"255"	},
+	{"filters.subtitle.upercent",		ADM_INT,	"0",	NULL,	"0",	"255"	},
+	{"filters.subtitle.vpercent",		ADM_INT,	"0",	NULL,	"0",	"255"	},
+	{"filters.subtitle.selfadjustable",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
+	{"filters.subtitle.usebackgroundcolor",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
 	{"filters.avsfilter.avs_script",		FILENAME,"",	NULL, NULL, NULL },
 	{"filters.avsfilter.avs_loader",		FILENAME,"",	NULL, NULL, NULL },
-	{"filters.avsfilter.pipe_timeout",		UINT,	"10",	NULL,	"1",	"30"	},
-	{"filters.avsfilter.debug_msg",		UINT,	"1",	NULL,	"0",	"1"	},
-	{"settings.mpegsplit",	UINT,	"790",	NULL,	"400",	"5000"	},
-	{"device.audiodevice",		STRING,"ALSA",	NULL, NULL, NULL },
-	{"device.audio.alsa_device",		STRING,"dmix",	NULL, NULL, NULL },
-	{"device.videodevice",		UINT,	"0",	NULL,	"0",	"10"	},
-	{"default.postproc_type",		UINT,	"3",	NULL,	"0",	"7"	},
-	{"default.postproc_value",		UINT,	"3",	NULL,	"0",	"5"	},
+	{"filters.avsfilter.pipe_timeout",		ADM_UADM_INT,	"10",	NULL,	"1",	"30"	},
+	{"filters.avsfilter.debug_msg",		ADM_UADM_INT,	"1",	NULL,	"0",	"1"	},
+	{"settings.mpegsplit",	ADM_UADM_INT,	"790",	NULL,	"400",	"5000"	},
+	{"device.audiodevice",		ADM_STRING,"ALSA",	NULL, NULL, NULL },
+	{"device.audio.alsa_device",		ADM_STRING,"dmix",	NULL, NULL, NULL },
+	{"device.videodevice",		ADM_UADM_INT,	"0",	NULL,	"0",	"10"	},
+	{"default.postproc_type",		ADM_UADM_INT,	"3",	NULL,	"0",	"7"	},
+	{"default.postproc_value",		ADM_UADM_INT,	"3",	NULL,	"0",	"5"	},
 	{"lastfiles.file1",		FILENAME,"",	NULL, NULL, NULL },
 	{"lastfiles.file2",		FILENAME,"",	NULL, NULL, NULL },
 	{"lastfiles.file3",		FILENAME,"",	NULL, NULL, NULL },
 	{"lastfiles.file4",		FILENAME,"",	NULL, NULL, NULL },
 	{"lastdir_read",		FILENAME,"",	NULL, NULL, NULL },
 	{"lastdir_write",		FILENAME,"",	NULL, NULL, NULL },
-	{"lame_cli",		STRING,"",	NULL, NULL, NULL },
-	{"pipe_cmd",		STRING,"",	NULL, NULL, NULL },
-	{"pipe_param",		STRING,"",	NULL, NULL, NULL },
-	{"lame_path",		STRING,"",	NULL, NULL, NULL },
-	{"toolame_path",		STRING,"",	NULL, NULL, NULL },
-	{"lvemux_path",		STRING,"",	NULL, NULL, NULL },
-	{"requant_path",		STRING,"",	NULL, NULL, NULL },
-	{"message_level",		UINT,	"2",	NULL,	"0",	"2"	},
-	{"feature.swap_if_A_greater_than_B",		UINT,	"1",	NULL,	"0",	"1"	},
-	{"feature.svcdres.preferedsourceratio",		STRING,"1:1",	NULL, NULL, NULL },
-	{"feature.saveprefsonexit",		UINT,	"1",	NULL,	"0",	"1"	},
-	{"feature.ignoresavedmarkers",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"feature.disable_nuv_resync",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"feature.tryautoidx",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"feature.use_odml",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"feature.use_systray",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"feature.reuse_2pass_log",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"feature.audiobar_uses_master",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"feature.threading.lavc",		UINT,	"0",	NULL,	"0",	"32"	},
-	{"feature.cpu_caps",		UINT,	"4294967295",NULL,	"0",	"4294967295"},
-	{"feature.mpeg_no_limit",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"feature.auto_buildmap",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"feature.auto_rebuildindex",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"feature.auto_unpack",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"downmixing.prologic",		UINT,	"2",	NULL,	"0",	"2"	},
-	{"filters.autoload.path",		STRING,"/tmp/",NULL, NULL, NULL },
-	{"filters.autoload.active",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"feature.alternate_mp3_tag",		UINT,	"1",	NULL,	"0",	"1"	},
-	{"feature.vdpau",		UINT,	"0",	NULL,	"0",	"1"	},
-	{"feature.global_glyph.active",		UINT,	"1",	NULL,	"0",	"1"	},
-	{"feature.global_glyph.name",		STRING,"",	NULL, NULL, NULL },
-	{"priority.encoding",		UINT,	"3",	NULL,	"0",	"4"	},
-	{"priority.indexing",		UINT,	"3",	NULL,	"0",	"4"	},
-	{"priority.playback",		UINT,	"0",	NULL,	"0",	"4"	}
+	{"lame_cli",		ADM_STRING,"",	NULL, NULL, NULL },
+	{"pipe_cmd",		ADM_STRING,"",	NULL, NULL, NULL },
+	{"pipe_param",		ADM_STRING,"",	NULL, NULL, NULL },
+	{"lame_path",		ADM_STRING,"",	NULL, NULL, NULL },
+	{"toolame_path",		ADM_STRING,"",	NULL, NULL, NULL },
+	{"lvemux_path",		ADM_STRING,"",	NULL, NULL, NULL },
+	{"requant_path",		ADM_STRING,"",	NULL, NULL, NULL },
+	{"message_level",		ADM_UADM_INT,	"2",	NULL,	"0",	"2"	},
+	{"feature.swap_if_A_greater_than_B",		ADM_UADM_INT,	"1",	NULL,	"0",	"1"	},
+	{"feature.svcdres.preferedsourceratio",		ADM_STRING,"1:1",	NULL, NULL, NULL },
+	{"feature.saveprefsonexit",		ADM_UADM_INT,	"1",	NULL,	"0",	"1"	},
+	{"feature.ignoresavedmarkers",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
+	{"feature.disable_nuv_resync",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
+	{"feature.tryautoidx",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
+	{"feature.use_odml",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
+	{"feature.use_systray",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
+	{"feature.reuse_2pass_log",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
+	{"feature.audiobar_uses_master",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
+	{"feature.threading.lavc",		ADM_UADM_INT,	"0",	NULL,	"0",	"32"	},
+	{"feature.cpu_caps",		ADM_UADM_INT,	"4294967295",NULL,	"0",	"4294967295"},
+	{"feature.mpeg_no_limit",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
+	{"feature.auto_buildmap",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
+	{"feature.auto_rebuildindex",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
+	{"feature.auto_unpack",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
+	{"downmixing.prologic",		ADM_UADM_INT,	"2",	NULL,	"0",	"2"	},
+	{"filters.autoload.path",		ADM_STRING,"/tmp/",NULL, NULL, NULL },
+	{"filters.autoload.active",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
+	{"feature.alternate_mp3_tag",		ADM_UADM_INT,	"1",	NULL,	"0",	"1"	},
+	{"feature.vdpau",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
+	{"feature.global_glyph.active",		ADM_UADM_INT,	"1",	NULL,	"0",	"1"	},
+	{"feature.global_glyph.name",		ADM_STRING,"",	NULL, NULL, NULL },
+	{"priority.encoding",		ADM_UADM_INT,	"3",	NULL,	"0",	"4"	},
+	{"priority.indexing",		ADM_UADM_INT,	"3",	NULL,	"0",	"4"	},
+	{"priority.playback",		ADM_UADM_INT,	"0",	NULL,	"0",	"4"	}
 };
 
 int num_opts = 83;
@@ -478,7 +478,7 @@
    const char *p = opt_defs[option].current_val;
 	if( !p )
 		p = opt_defs[option].default_val;
-	if( opt_defs[option].type != UINT ){
+	if( opt_defs[option].type != ADM_UADM_INT ){
 		fprintf(stderr,"preferences::get(%s,uint) called for type %d\n",
 			opt_defs[option].name,opt_defs[option].type);
 		ADM_assert(0);
@@ -492,7 +492,7 @@
    const char *p = opt_defs[option].current_val;
 	if( !p )
 		p = opt_defs[option].default_val;
-	if( opt_defs[option].type != INT ){
+	if( opt_defs[option].type != ADM_INT ){
 		fprintf(stderr,"preferences::get(%s,int) called for type %d\n",
 			opt_defs[option].name,opt_defs[option].type);
 		ADM_assert(0);
@@ -506,7 +506,7 @@
    const char *p = opt_defs[option].current_val;
 	if( !p )
 		p = opt_defs[option].default_val;
-	if( opt_defs[option].type != ULONG ){
+	if( opt_defs[option].type != ADM_UADM_LONG ){
 		fprintf(stderr,"preferences::get(%s,ulong) called for type %d\n",
 			opt_defs[option].name,opt_defs[option].type);
 		ADM_assert(0);
@@ -520,7 +520,7 @@
    const char *p = opt_defs[option].current_val;
 	if( !p )
 		p = opt_defs[option].default_val;
-	if( opt_defs[option].type != LONG ){
+	if( opt_defs[option].type != ADM_LONG ){
 		fprintf(stderr,"preferences::get(%s,long) called for type %d\n",
 			opt_defs[option].name,opt_defs[option].type);
 		ADM_assert(0);
@@ -534,7 +534,7 @@
    const char *p = opt_defs[option].current_val;
 	if( !p )
 		p = opt_defs[option].default_val;
-	if( opt_defs[option].type != FLOAT ){
+	if( opt_defs[option].type != ADM_FLOAT ){
 		fprintf(stderr,"preferences::get(%s,float) called for type %d\n",
 			opt_defs[option].name,opt_defs[option].type);
 		ADM_assert(0);
@@ -570,7 +570,7 @@
    char buf[1024];
    unsigned int v = val;
 	// check type of option
-	if( opt_defs[option].type != UINT ){
+	if( opt_defs[option].type != ADM_UADM_INT ){
 		fprintf(stderr,"preferences::set(%s,uint) called for type %d\n",
 			opt_defs[option].name,opt_defs[option].type);
 		ADM_assert(0);
@@ -610,7 +610,7 @@
    char buf[1024];
    int v = val;
 	// check type of option
-	if( opt_defs[option].type != INT ){
+	if( opt_defs[option].type != ADM_INT ){
 		fprintf(stderr,"preferences::set(%s,int) called for type %d\n",
 			opt_defs[option].name,opt_defs[option].type);
 	}
@@ -649,7 +649,7 @@
    char buf[1024];
    unsigned long v = val;
 	// check type of option
-	if( opt_defs[option].type != ULONG ){
+	if( opt_defs[option].type != ADM_UADM_LONG ){
 		fprintf(stderr,"preferences::set(%s,ulong) called for type %d\n",
 			opt_defs[option].name,opt_defs[option].type);
 		ADM_assert(0);
@@ -689,7 +689,7 @@
    char buf[1024];
    long v = val;
 	// check type of option
-	if( opt_defs[option].type != LONG ){
+	if( opt_defs[option].type != ADM_LONG ){
 		fprintf(stderr,"preferences::set(%s,long) called for type %d\n",
 			opt_defs[option].name,opt_defs[option].type);
 		ADM_assert(0);
@@ -729,7 +729,7 @@
    char buf[1024];
    float v = val;
 	// check type of option
-	if( opt_defs[option].type != FLOAT ){
+	if( opt_defs[option].type != ADM_FLOAT ){
 		fprintf(stderr,"preferences::set(%s,float) called for type %d\n",
 			opt_defs[option].name,opt_defs[option].type);
 		ADM_assert(0);
@@ -766,7 +766,7 @@
 
 int preferences::set(options option, const char * val){
 	// check type of option
-	if( opt_defs[option].type != STRING ){
+	if( opt_defs[option].type != ADM_STRING ){
 		fprintf(stderr,"preferences::set(%s,string) called for type %d\n",
 			opt_defs[option].name,opt_defs[option].type);
 		ADM_assert(0);



From mean at mail.berlios.de  Wed Dec  8 17:40:42 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed,  8 Dec 2010 17:40:42 +0100
Subject: [Avidemux-svn-commit] r6816 -
	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters
Message-ID: <20101208164042.6AAAD480D0F@sheep.berlios.de>

Author: mean
Date: 2010-12-08 17:40:42 +0100 (Wed, 08 Dec 2010)
New Revision: 6816

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters/Q_seekablePreview.h
Log:
[win64] include to avoid memcpy clash

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters/Q_seekablePreview.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters/Q_seekablePreview.h	2010-12-08 16:40:41 UTC (rev 6815)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters/Q_seekablePreview.h	2010-12-08 16:40:42 UTC (rev 6816)
@@ -15,6 +15,7 @@
  *                                                                         *
  ***************************************************************************/
 
+#include "ADM_cpp.h"
 #include "ui_seekablePreview.h"
 
 #include "ADM_assert.h"



From mean at mail.berlios.de  Wed Dec  8 17:40:43 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed,  8 Dec 2010 17:40:43 +0100
Subject: [Avidemux-svn-commit] r6817 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include
Message-ID: <20101208164043.7BD33480D0F@sheep.berlios.de>

Author: mean
Date: 2010-12-08 17:40:43 +0100 (Wed, 08 Dec 2010)
New Revision: 6817

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_mangle.h
Log:
[win64] Mangling rule for win64

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_mangle.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_mangle.h	2010-12-08 16:40:42 UTC (rev 6816)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_mangle.h	2010-12-08 16:40:43 UTC (rev 6817)
@@ -18,9 +18,9 @@
 // Use rip-relative addressing if compiling PIC code on x86-64.
 #if defined(__MINGW32__) || defined(__CYGWIN__) || defined(__DJGPP__) || \
     defined(__OS2__) || (defined (__OpenBSD__) && !defined(__ELF__))
-#    if defined(ADM_CPU_X86_64) && defined(PIC) && !defined(__MINGW32__)
-#        define MANGLE(a) "_" #a"(%%rip)"
-#        define LOCAL_MANGLE(a) #a"(%%rip)"
+#    if defined(ADM_CPU_X86_64)
+#        define MANGLE(a)  #a
+#        define LOCAL_MANGLE(a) #a
 #        define FUNNY_MANGLE(x) x asm(MANGLE(x))
 #        define FUNNY_MANGLE_ARRAY(x, y) x[y] asm(MANGLE(x))
 #    else
@@ -101,3 +101,4 @@
 
 #define ASM_CONST attribute_used __attribute__ ((aligned(8)))
 #endif
+



From mean at mail.berlios.de  Wed Dec  8 17:58:33 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed,  8 Dec 2010 17:58:33 +0100
Subject: [Avidemux-svn-commit] r6818 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src
Message-ID: <20101208165834.3A15A480D0F@sheep.berlios.de>

Author: mean
Date: 2010-12-08 17:58:33 +0100 (Wed, 08 Dec 2010)
New Revision: 6818

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs_gen.pl
Log:
[pref] 2nd part of UINT->ADM_UINT

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs.cpp	2010-12-08 16:40:43 UTC (rev 6817)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs.cpp	2010-12-08 16:58:33 UTC (rev 6818)
@@ -32,13 +32,13 @@
 class preferences *prefs;
 // <prefs_gen>
 typedef enum {
-	ADM_UADM_INT,
+	ADM_UINT,
 	ADM_INT,
-	ADM_UADM_LONG,
+	ADM_ULONG,
 	ADM_LONG,
 	ADM_FLOAT,
 	ADM_STRING,
-	FILENAME
+	ADM_FILENAME
 } types;
 
 typedef struct {
@@ -51,55 +51,55 @@
 } opt_def;
 
 static opt_def opt_defs [] = {
-	{"codecs.svcd.enctype",		ADM_UADM_INT,	"0",	NULL,	"0",	"99999"},
-	{"codecs.svcd.bitrate",		ADM_UADM_INT,	"1500000",NULL,	"16000","2748000"},
-	{"codecs.svcd.quantizer",		ADM_UADM_INT,	"4",	NULL,	"2",	"31"	},
-	{"codecs.svcd.finalsize",	ADM_UADM_INT,	"700",	NULL,	"0",	"99999"},
-	{"codecs.svcd.interlaced",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"codecs.svcd.bff",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"codecs.svcd.widescreen",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"codecs.svcd.matrix",		ADM_UADM_INT,	"0",	NULL,	"0",	"99999"},
-	{"codecs.svcd.gopsize",		ADM_UADM_INT,	"12",	NULL,	"0",	"99999"},
-	{"codecs.svcd.maxbitrate",		ADM_UADM_INT,	"2500",	NULL,	"0",	"2748"	},
-	{"codecs.dvd.enctype",		ADM_UADM_INT,	"0",	NULL,	"0",	"99999"},
-	{"codecs.dvd.bitrate",		ADM_UADM_INT,	"1500000",NULL,	"16000","9900000"},
-	{"codecs.dvd.quantizer",		ADM_UADM_INT,	"4",	NULL,	"2",	"31"	},
-	{"codecs.dvd.finalsize",	ADM_UADM_INT,	"700",	NULL,	"0",	"99999"},
-	{"codecs.dvd.interlaced",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"codecs.dvd.bff",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"codecs.dvd.widescreen",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"codecs.dvd.matrix",		ADM_UADM_INT,	"0",	NULL,	"0",	"99999"},
-	{"codecs.dvd.gopsize",		ADM_UADM_INT,	"12",	NULL,	"0",	"99999"},
-	{"codecs.dvd.maxbitrate",		ADM_UADM_INT,	"9000",	NULL,	"0",	"9900"	},
-	{"codecs.xvid.enctype",		ADM_UADM_INT,	"0",	NULL,	"0",	"99999"},
-	{"codecs.xvid.quantizer",		ADM_UADM_INT,	"4",	NULL,	"2",	"32"	},
-	{"codecs.xvid.bitrate",		ADM_UADM_INT,	"1500000",NULL,	"17",	"5900000"},
-	{"codecs.xvid.finalsize",	ADM_UADM_INT,	"700",	NULL,	"0",	"3999"	},
+	{"codecs.svcd.enctype",		ADM_UINT,	"0",	NULL,	"0",	"99999"},
+	{"codecs.svcd.bitrate",		ADM_UINT,	"1500000",NULL,	"16000","2748000"},
+	{"codecs.svcd.quantizer",		ADM_UINT,	"4",	NULL,	"2",	"31"	},
+	{"codecs.svcd.finalsize",	ADM_UINT,	"700",	NULL,	"0",	"99999"},
+	{"codecs.svcd.interlaced",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"codecs.svcd.bff",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"codecs.svcd.widescreen",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"codecs.svcd.matrix",		ADM_UINT,	"0",	NULL,	"0",	"99999"},
+	{"codecs.svcd.gopsize",		ADM_UINT,	"12",	NULL,	"0",	"99999"},
+	{"codecs.svcd.maxbitrate",		ADM_UINT,	"2500",	NULL,	"0",	"2748"	},
+	{"codecs.dvd.enctype",		ADM_UINT,	"0",	NULL,	"0",	"99999"},
+	{"codecs.dvd.bitrate",		ADM_UINT,	"1500000",NULL,	"16000","9900000"},
+	{"codecs.dvd.quantizer",		ADM_UINT,	"4",	NULL,	"2",	"31"	},
+	{"codecs.dvd.finalsize",	ADM_UINT,	"700",	NULL,	"0",	"99999"},
+	{"codecs.dvd.interlaced",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"codecs.dvd.bff",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"codecs.dvd.widescreen",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"codecs.dvd.matrix",		ADM_UINT,	"0",	NULL,	"0",	"99999"},
+	{"codecs.dvd.gopsize",		ADM_UINT,	"12",	NULL,	"0",	"99999"},
+	{"codecs.dvd.maxbitrate",		ADM_UINT,	"9000",	NULL,	"0",	"9900"	},
+	{"codecs.xvid.enctype",		ADM_UINT,	"0",	NULL,	"0",	"99999"},
+	{"codecs.xvid.quantizer",		ADM_UINT,	"4",	NULL,	"2",	"32"	},
+	{"codecs.xvid.bitrate",		ADM_UINT,	"1500000",NULL,	"17",	"5900000"},
+	{"codecs.xvid.finalsize",	ADM_UINT,	"700",	NULL,	"0",	"3999"	},
 	{"codecs.preferredcodec",		ADM_STRING,"FFmpeg4",NULL, NULL, NULL },
-	{"filters.subtitle.fontname",		FILENAME,"/usr/share/fonts/truetype/DejaVuSans.ttf",NULL, NULL, NULL },
+	{"filters.subtitle.fontname",		ADM_FILENAME,"/usr/share/fonts/truetype/DejaVuSans.ttf",NULL, NULL, NULL },
 	{"filters.subtitle.charset",		ADM_STRING,"ISO-8859-1",NULL, NULL, NULL },
-	{"filters.subtitle.fontsize",		ADM_UADM_INT,	"24",	NULL,	"1",	"576"	},
+	{"filters.subtitle.fontsize",		ADM_UINT,	"24",	NULL,	"1",	"576"	},
 	{"filters.subtitle.ypercent",	ADM_INT,	"255",	NULL,	"0",	"255"	},
 	{"filters.subtitle.upercent",		ADM_INT,	"0",	NULL,	"0",	"255"	},
 	{"filters.subtitle.vpercent",		ADM_INT,	"0",	NULL,	"0",	"255"	},
-	{"filters.subtitle.selfadjustable",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"filters.subtitle.usebackgroundcolor",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"filters.avsfilter.avs_script",		FILENAME,"",	NULL, NULL, NULL },
-	{"filters.avsfilter.avs_loader",		FILENAME,"",	NULL, NULL, NULL },
-	{"filters.avsfilter.pipe_timeout",		ADM_UADM_INT,	"10",	NULL,	"1",	"30"	},
-	{"filters.avsfilter.debug_msg",		ADM_UADM_INT,	"1",	NULL,	"0",	"1"	},
-	{"settings.mpegsplit",	ADM_UADM_INT,	"790",	NULL,	"400",	"5000"	},
+	{"filters.subtitle.selfadjustable",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"filters.subtitle.usebackgroundcolor",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"filters.avsfilter.avs_script",		ADM_FILENAME,"",	NULL, NULL, NULL },
+	{"filters.avsfilter.avs_loader",		ADM_FILENAME,"",	NULL, NULL, NULL },
+	{"filters.avsfilter.pipe_timeout",		ADM_UINT,	"10",	NULL,	"1",	"30"	},
+	{"filters.avsfilter.debug_msg",		ADM_UINT,	"1",	NULL,	"0",	"1"	},
+	{"settings.mpegsplit",	ADM_UINT,	"790",	NULL,	"400",	"5000"	},
 	{"device.audiodevice",		ADM_STRING,"ALSA",	NULL, NULL, NULL },
 	{"device.audio.alsa_device",		ADM_STRING,"dmix",	NULL, NULL, NULL },
-	{"device.videodevice",		ADM_UADM_INT,	"0",	NULL,	"0",	"10"	},
-	{"default.postproc_type",		ADM_UADM_INT,	"3",	NULL,	"0",	"7"	},
-	{"default.postproc_value",		ADM_UADM_INT,	"3",	NULL,	"0",	"5"	},
-	{"lastfiles.file1",		FILENAME,"",	NULL, NULL, NULL },
-	{"lastfiles.file2",		FILENAME,"",	NULL, NULL, NULL },
-	{"lastfiles.file3",		FILENAME,"",	NULL, NULL, NULL },
-	{"lastfiles.file4",		FILENAME,"",	NULL, NULL, NULL },
-	{"lastdir_read",		FILENAME,"",	NULL, NULL, NULL },
-	{"lastdir_write",		FILENAME,"",	NULL, NULL, NULL },
+	{"device.videodevice",		ADM_UINT,	"0",	NULL,	"0",	"10"	},
+	{"default.postproc_type",		ADM_UINT,	"3",	NULL,	"0",	"7"	},
+	{"default.postproc_value",		ADM_UINT,	"3",	NULL,	"0",	"5"	},
+	{"lastfiles.file1",		ADM_FILENAME,"",	NULL, NULL, NULL },
+	{"lastfiles.file2",		ADM_FILENAME,"",	NULL, NULL, NULL },
+	{"lastfiles.file3",		ADM_FILENAME,"",	NULL, NULL, NULL },
+	{"lastfiles.file4",		ADM_FILENAME,"",	NULL, NULL, NULL },
+	{"lastdir_read",		ADM_FILENAME,"",	NULL, NULL, NULL },
+	{"lastdir_write",		ADM_FILENAME,"",	NULL, NULL, NULL },
 	{"lame_cli",		ADM_STRING,"",	NULL, NULL, NULL },
 	{"pipe_cmd",		ADM_STRING,"",	NULL, NULL, NULL },
 	{"pipe_param",		ADM_STRING,"",	NULL, NULL, NULL },
@@ -107,33 +107,33 @@
 	{"toolame_path",		ADM_STRING,"",	NULL, NULL, NULL },
 	{"lvemux_path",		ADM_STRING,"",	NULL, NULL, NULL },
 	{"requant_path",		ADM_STRING,"",	NULL, NULL, NULL },
-	{"message_level",		ADM_UADM_INT,	"2",	NULL,	"0",	"2"	},
-	{"feature.swap_if_A_greater_than_B",		ADM_UADM_INT,	"1",	NULL,	"0",	"1"	},
+	{"message_level",		ADM_UINT,	"2",	NULL,	"0",	"2"	},
+	{"feature.swap_if_A_greater_than_B",		ADM_UINT,	"1",	NULL,	"0",	"1"	},
 	{"feature.svcdres.preferedsourceratio",		ADM_STRING,"1:1",	NULL, NULL, NULL },
-	{"feature.saveprefsonexit",		ADM_UADM_INT,	"1",	NULL,	"0",	"1"	},
-	{"feature.ignoresavedmarkers",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"feature.disable_nuv_resync",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"feature.tryautoidx",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"feature.use_odml",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"feature.use_systray",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"feature.reuse_2pass_log",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"feature.audiobar_uses_master",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"feature.threading.lavc",		ADM_UADM_INT,	"0",	NULL,	"0",	"32"	},
-	{"feature.cpu_caps",		ADM_UADM_INT,	"4294967295",NULL,	"0",	"4294967295"},
-	{"feature.mpeg_no_limit",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"feature.auto_buildmap",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"feature.auto_rebuildindex",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"feature.auto_unpack",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"downmixing.prologic",		ADM_UADM_INT,	"2",	NULL,	"0",	"2"	},
+	{"feature.saveprefsonexit",		ADM_UINT,	"1",	NULL,	"0",	"1"	},
+	{"feature.ignoresavedmarkers",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"feature.disable_nuv_resync",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"feature.tryautoidx",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"feature.use_odml",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"feature.use_systray",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"feature.reuse_2pass_log",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"feature.audiobar_uses_master",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"feature.threading.lavc",		ADM_UINT,	"0",	NULL,	"0",	"32"	},
+	{"feature.cpu_caps",		ADM_UINT,	"4294967295",NULL,	"0",	"4294967295"},
+	{"feature.mpeg_no_limit",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"feature.auto_buildmap",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"feature.auto_rebuildindex",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"feature.auto_unpack",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"downmixing.prologic",		ADM_UINT,	"2",	NULL,	"0",	"2"	},
 	{"filters.autoload.path",		ADM_STRING,"/tmp/",NULL, NULL, NULL },
-	{"filters.autoload.active",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"feature.alternate_mp3_tag",		ADM_UADM_INT,	"1",	NULL,	"0",	"1"	},
-	{"feature.vdpau",		ADM_UADM_INT,	"0",	NULL,	"0",	"1"	},
-	{"feature.global_glyph.active",		ADM_UADM_INT,	"1",	NULL,	"0",	"1"	},
+	{"filters.autoload.active",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"feature.alternate_mp3_tag",		ADM_UINT,	"1",	NULL,	"0",	"1"	},
+	{"feature.vdpau",		ADM_UINT,	"0",	NULL,	"0",	"1"	},
+	{"feature.global_glyph.active",		ADM_UINT,	"1",	NULL,	"0",	"1"	},
 	{"feature.global_glyph.name",		ADM_STRING,"",	NULL, NULL, NULL },
-	{"priority.encoding",		ADM_UADM_INT,	"3",	NULL,	"0",	"4"	},
-	{"priority.indexing",		ADM_UADM_INT,	"3",	NULL,	"0",	"4"	},
-	{"priority.playback",		ADM_UADM_INT,	"0",	NULL,	"0",	"4"	}
+	{"priority.encoding",		ADM_UINT,	"3",	NULL,	"0",	"4"	},
+	{"priority.indexing",		ADM_UINT,	"3",	NULL,	"0",	"4"	},
+	{"priority.playback",		ADM_UINT,	"0",	NULL,	"0",	"4"	}
 };
 
 int num_opts = 83;
@@ -478,7 +478,7 @@
    const char *p = opt_defs[option].current_val;
 	if( !p )
 		p = opt_defs[option].default_val;
-	if( opt_defs[option].type != ADM_UADM_INT ){
+	if( opt_defs[option].type != ADM_UINT ){
 		fprintf(stderr,"preferences::get(%s,uint) called for type %d\n",
 			opt_defs[option].name,opt_defs[option].type);
 		ADM_assert(0);
@@ -506,7 +506,7 @@
    const char *p = opt_defs[option].current_val;
 	if( !p )
 		p = opt_defs[option].default_val;
-	if( opt_defs[option].type != ADM_UADM_LONG ){
+	if( opt_defs[option].type != ADM_ULONG ){
 		fprintf(stderr,"preferences::get(%s,ulong) called for type %d\n",
 			opt_defs[option].name,opt_defs[option].type);
 		ADM_assert(0);
@@ -570,7 +570,7 @@
    char buf[1024];
    unsigned int v = val;
 	// check type of option
-	if( opt_defs[option].type != ADM_UADM_INT ){
+	if( opt_defs[option].type != ADM_UINT ){
 		fprintf(stderr,"preferences::set(%s,uint) called for type %d\n",
 			opt_defs[option].name,opt_defs[option].type);
 		ADM_assert(0);
@@ -649,7 +649,7 @@
    char buf[1024];
    unsigned long v = val;
 	// check type of option
-	if( opt_defs[option].type != ADM_UADM_LONG ){
+	if( opt_defs[option].type != ADM_ULONG ){
 		fprintf(stderr,"preferences::set(%s,ulong) called for type %d\n",
 			opt_defs[option].name,opt_defs[option].type);
 		ADM_assert(0);
@@ -785,7 +785,7 @@
 #warning incorrect!
 int preferences::set(options option, const ADM_filename * val){
 	// check type of option
-	if( opt_defs[option].type != FILENAME ){
+	if( opt_defs[option].type != ADM_FILENAME ){
 		fprintf(stderr,"preferences::set(%s,string) called for type %d\n",
 			opt_defs[option].name,opt_defs[option].type);
 		ADM_assert(0);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs_gen.pl
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs_gen.pl	2010-12-08 16:40:43 UTC (rev 6817)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/prefs_gen.pl	2010-12-08 16:58:33 UTC (rev 6818)
@@ -10,13 +10,13 @@
 #print "In:$in\n";
 my $h_str = "typedef enum {\n";
 my $cpp_str = "typedef enum {\n".
-              "\tUINT,\n".
-              "\tINT,\n".
-              "\tULONG,\n".
-              "\tLONG,\n".
-              "\tFLOAT,\n".
-              "\tSTRING,\n".
-              "\tFILENAME\n".
+              "\tADM_UINT,\n".
+              "\tADM_INT,\n".
+              "\tADM_ULONG,\n".
+              "\tADM_LONG,\n".
+              "\tADM_FLOAT,\n".
+              "\tADM_STRING,\n".
+              "\tADM_FILENAME\n".
               "} types;\n".
               "\n".
               "typedef struct {\n".
@@ -47,7 +47,7 @@
 		$h_str   .= "\t$a,\n";
 		$cpp_str .= "\t{\"$N\",";
 		$cpp_str .= "\t" if( length($c)%8 != 3 );
-		$cpp_str .= "\t$b,";
+		$cpp_str .= "\tADM_".$b.",";
 		if(( $b eq "STRING" )||($b eq "FILENAME")){
 			$c =~ s/^"//;
 			$c =~ s/"$//;



From mean at mail.berlios.de  Wed Dec  8 18:14:20 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed,  8 Dec 2010 18:14:20 +0100
Subject: [Avidemux-svn-commit] r6819 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src
Message-ID: <20101208171420.81555480D0F@sheep.berlios.de>

Author: mean
Date: 2010-12-08 18:14:20 +0100 (Wed, 08 Dec 2010)
New Revision: 6819

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_cpuCap.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt
Log:
[win64] Build tweak, X86_64 all have cpuid

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_cpuCap.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_cpuCap.cpp	2010-12-08 16:58:33 UTC (rev 6818)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_cpuCap.cpp	2010-12-08 17:14:20 UTC (rev 6819)
@@ -66,6 +66,7 @@
  int max_std_level, max_ext_level, std_caps=0, ext_caps=0;
  long a, c;
 
+#if !defined(ADM_CPU_64BIT) // 64 bits CPU have all cpuid
  __asm__ __volatile__ (
                        /* See if CPUID instruction is supported ... */
                        /* ... Get copies of EFLAGS into eax and ecx */
@@ -89,7 +90,7 @@
 
  if (a == c)
      return ; /* CPUID not supported */
-
+#endif
  cpuid(0, max_std_level, ebx, ecx, edx);
 
  if(max_std_level >= 1)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt	2010-12-08 16:58:33 UTC (rev 6818)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt	2010-12-08 17:14:20 UTC (rev 6819)
@@ -11,6 +11,7 @@
 IF (MINGW)
 	TARGET_LINK_LIBRARIES(ADM_core6 "${PTHREAD_LIBRARIES}" imagehlp ws2_32)
 	ADD_TARGET_CFLAGS(ADM_core6 "-I${PTHREAD_INCLUDE_DIR}")
+	ADD_TARGET_CFLAGS(ADM_core6 "-fpermissive")
 ELSEIF (APPLE)
 	ADD_TARGET_LDFLAGS(ADM_core6 "-framework Carbon")
 ENDIF (MINGW)



From mean at mail.berlios.de  Wed Dec  8 19:09:22 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed,  8 Dec 2010 19:09:22 +0100
Subject: [Avidemux-svn-commit] r6820 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale
Message-ID: <20101208180922.438A6480D0F@sheep.berlios.de>

Author: mean
Date: 2010-12-08 19:09:21 +0100 (Wed, 08 Dec 2010)
New Revision: 6820

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/CMakeLists.txt
Log:
[Win64] Temporary hack so that libswscale compiles

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/CMakeLists.txt	2010-12-08 17:14:20 UTC (rev 6819)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/CMakeLists.txt	2010-12-08 18:09:21 UTC (rev 6820)
@@ -3,6 +3,7 @@
         swscale.c yuv2rgb.c rgb2rgb.c ADM_mp.cpp swscale_avoption.c utils.c
 )
 ADD_DEFINITIONS("-Dbswap_16=av_bswap16")
+
 IF(ADM_CPU_X86)
 SET(${ADM_LIB}_SRCS ${${ADM_LIB}_SRCS} x86/yuv2rgb_mmx.c)
 ENDIF(ADM_CPU_X86)
@@ -19,4 +20,14 @@
 
 TARGET_LINK_LIBRARIES(${ADM_LIB} ADM_core6 ADM_libavutil6)
 
+# Temporary hack to avoid error on cross compiling swscale
+IF(CROSS)
+  IF(WIN32)
+    IF(ADM_CPU_X86_64)
+	ADD_TARGET_CFLAGS(${ADM_LIB} -O0)
+    ENDIF(ADM_CPU_X86_64)
+  ENDIF(WIN32)
+ENDIF(CROSS)
+
+
 ADM_INSTALL_LIB(${ADM_LIB} )



From mean at mail.berlios.de  Fri Dec 10 09:06:31 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 10 Dec 2010 09:06:31 +0100
Subject: [Avidemux-svn-commit] r6824 - in
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg:
	libavcodec libavformat libavutil libpostproc
Message-ID: <20101210080631.2E2B7480E5F@sheep.berlios.de>

Author: mean
Date: 2010-12-10 09:06:30 +0100 (Fri, 10 Dec 2010)
New Revision: 6824

Added:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libpostproc/CMakeLists.txt
Log:
[ffmpeg] add cmakelist

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/CMakeLists.txt	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/CMakeLists.txt	2010-12-10 08:06:30 UTC (rev 6824)
@@ -0,0 +1,108 @@
+SET(ADM_LIB ADM_libavcodec6)
+
+SET(${ADM_LIB}_SRCS 
+	adpcm.c  allcodecs.c  cyuv.c  dsputil.c  dv.c  error_resilience.c  fft.c  h263.c
+	h263dec.c  huffyuv.c  imgconvert.c  jfdctfst.c  jfdctint.c  jrevdct.c  mace.c
+	mdct.c  mjpeg.c  motion_est.c  mpeg12.c  mpegaudio.c  mpegaudiodec.c  mpegvideo.c
+	msmpeg4.c  pcm.c  ratecontrol.c  raw.c  resample.c  rv10.c  simple_idct.c  svq1.c
+	utils.c  wmadec.c  indeo3.c  vp3.c  vp3dsp.c  h264.c  ffv1.c  ra144.c  ra288.c
+	golomb.c  4xm.c  cabac.c  asv1.c  vcr1.c  cljr.c  faandct.c  parser.c  roqvideo.c
+	xan.c  rpza.c  msrle.c  msrledec.c msvideo1.c  cinepak.c  vqavideo.c  idcinvideo.c  smc.c
+	flicvideo.c  interplayvideo.c  dpcm.c  8bps.c  vmdav.c  truemotion1.c  flac.c
+	g726.c  qtrle.c  
+        snow.c  rangecoder.c  bitstream.c  h264idct.c  h261.c
+        rdft.c
+        vc1dec.c vc1data.c vc1dsp.c vc1_parser.c
+        avpacket.c
+        flacdec.c
+        flacdata.c
+        vp6dsp.c
+        tscc.c  resample2.c    qdm2.c  bitstream_filter.c  eval.c  vc1.c
+	vp56.c  vp6.c  vp5.c  indeo2.c  smacker.c  opt.c  fraps.c  dnxhddec.c
+	mpeg12data.c  mpegaudiodata.c  msmpeg4data.c   vp56data.c  mjpegbdec.c
+	h263_parser.c  h264_parser.c  mpeg4video_parser.c  mpegvideo_enc.c  mpeg12enc.c
+	mpegaudioenc.c  
+        mjpegenc.c  mjpegdec.c  wma.c  
+        dca.c
+        ac3enc.c  ac3.c  ac3tab.c   ac3_parser.c
+        eac3dec.c ac3dec.c ac3dec_data.c eac3dec_data.c
+        aacenc.c aaccoder.c  aactab.c psymodel.c  iirfilter.c
+	dvbsub_parser.c  dvbsubdec.c  dvbsub.c  xiph.c  sp5xdec.c  
+        nellymoserdec.c nellymoser.c
+	ADM_lavcodec.cpp  pthread.c  huffman.c  wmv2dec.c  wmv2.c  h264pred.c  intrax8.c
+	intrax8dsp.c  dnxhddata.c  faanidct.c    aac_ac3_parser.c
+        celp_math.c options.c aandcttab.c audioconvert.c mpeg4audio.c svq1dec.c celp_filters.c
+	aac_parser.c  mpegaudiodecheader.c
+        flvenc.c indeo5.c mpegaudiodec_float.c mpeg4video.c mpeg4videoenc.c dwt.c  h264_refs.c
+        ivi_common.c dcadsp.c h264_direct.c ivi_dsp.c ituh263dec.c dvdata.c ituh263enc.c aacsbr.c
+        synth_filter.c    mpeg4videodec.c h264_cabac.c h264_cavlc.c vp56dsp.c h264_loopfilter.c
+        h264_sei.c h264_ps.c svq3.c h264dsp.c flvdec.c pngdec.c png.c
+        aacps.c  aacpsy.c aacadtsdec.c lpc.c vp8_parser.c vp8.c vp8dsp.c inverse.c dct.c aacdec.c
+        )
+
+if(USE_VDPAU)
+	SET(${ADM_LIB}_SRCS  ${${ADM_LIB}_SRCS} vdpau.c)
+endif(USE_VDPAU)
+
+IF(ADM_CPU_X86)
+	SET(${ADM_LIB}_SRCS  ${${ADM_LIB}_SRCS}
+		x86/cpuid.c  x86/mpegvideo_mmx.c  x86/vp3dsp_mmx.c  x86/dsputil_mmx.c
+		x86/fdct_mmx.c  x86/motion_est_mmx.c  x86/simple_idct_mmx.c  
+		x86/vp3dsp_sse2.c  x86/idct_mmx_xvid.c    x86/snowdsp_mmx.c
+                x86/idct_sse2_xvid.c 
+                x86/vp6dsp_mmx.c
+                x86/vp6dsp_sse2.c
+                x86/vp8dsp-init.c
+                x86/mpegaudiodec_mmx.c
+                x86/lpc_mmx.c
+                x86/fft.c
+                x86/dct32_sse.c
+                #x86/fft_sse.c
+                #x86/fft_3dn2.c
+		#x86/fft_3dn.c  
+                x86/dsputilenc_mmx.c  x86/vc1dsp_mmx.c  x86/idct_mmx.c)
+        IF(USE_YASM)
+                SET(YASM_SOURCE         
+                                x86/h264_intrapred.asm
+                                x86/vp8dsp.asm
+                                x86/vc1dsp_yasm.asm
+                                x86/dsputil_yasm.asm
+                                x86/fft_mmx.asm
+                                x86/h264_deblock_sse2.asm
+                                x86/h264_idct_sse2.asm)
+                SET(YASM_DEP x86/fft_3dn2.c  x86/fft_3dn.c   x86/fft_sse.c)
+                 FOREACH(yasm_files ${YASM_SOURCE})
+                        SET(tgt1 ${CMAKE_CURRENT_BINARY_DIR}/${yasm_files}.o)
+                        STRING(REGEX REPLACE "libavcodec/x86/" "libavcodec/x86_" tgt "${tgt1}")
+                        YASM_COMPILE(${CMAKE_CURRENT_SOURCE_DIR}/${yasm_files} ${tgt} ${CMAKE_CURRENT_SOURCE_DIR}/x86)
+                        SET(YASM_OBJ ${YASM_OBJ} ${tgt})
+                 ENDFOREACH(yasm_files)
+
+
+	        SET(${ADM_LIB}_SRCS  ${${ADM_LIB}_SRCS} ${YASM_OBJ} ${YASM_DEP})
+        ENDIF(USE_YASM)
+ENDIF(ADM_CPU_X86)
+
+IF (ADM_CPU_ALTIVEC)
+	SET(${ADM_LIB}_SRCS  ${${ADM_LIB}_SRCS}
+		ppc/dsputil_altivec.c  ppc/dsputil_ppc.c  ppc/fdct_altivec.c  ppc/fft_altivec.c
+		ppc/float_altivec.c  ppc/gmc_altivec.c  ppc/h264_altivec.c  ppc/idct_altivec.c
+		ppc/int_altivec.c  ppc/mpegvideo_altivec.c  ppc/mpegvideo_ppc.c
+		ppc/snow_altivec.c  ppc/vc1dsp_altivec.c  ppc/check_altivec.c)
+ENDIF (ADM_CPU_ALTIVEC)
+
+ADD_LIBRARY(${ADM_LIB} SHARED ${${ADM_LIB}_SRCS})
+ADD_DEFINITIONS(-std=c99)
+IF (ADM_DEBUG AND ADM_CPU_X86_32)
+	ADD_SOURCE_CFLAGS(cabac.c -O2)
+	ADD_SOURCE_CFLAGS(h264.c -O2)
+	ADD_SOURCE_CFLAGS(h264_parser.c -O2)
+	ADD_SOURCE_CFLAGS(x86/dsputil_mmx.c -O2)
+	ADD_SOURCE_CFLAGS(x86/snowdsp_mmx.c -O2)
+ENDIF (ADM_DEBUG AND ADM_CPU_X86_32)
+IF(USE_YASM)
+  ADD_DEPENDENCIES(${ADM_LIB} ${YASM_OBJ})
+ENDIF(USE_YASM)
+TARGET_LINK_LIBRARIES(${ADM_LIB} ADM_core6 ADM_libavutil6 ${ZLIB_LIBRARY})
+
+ADM_INSTALL_LIB(${ADM_LIB} )

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/CMakeLists.txt	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/CMakeLists.txt	2010-12-10 08:06:30 UTC (rev 6824)
@@ -0,0 +1,17 @@
+SET(ADM_LIB ADM_libavformat6)
+
+SET(${ADM_LIB}_SRCS 
+	mpeg.c  utils.c  avio.c  aviobuf.c  cutils.c  img2.c  file.c  mpegtsenc.c
+	movenc.c  avi.c avienc.c  wav.c  mov.c  matroska.c  isom.c  isom.h  
+	flvenc.c  matroskaenc.c metadata.c metadata_compat.c options.c
+	avc.c raw.c  riff.c
+        mpegenc.c
+        movenchint.c sdp.c adtsenc.c flacenc.c flacenc_header.c vorbiscomment.c
+)
+IF(WIN32)
+  ADD_DEFINITIONS(-DHAVE_DOS_PATHS=1)
+ENDIF(WIN32)
+ADD_LIBRARY(${ADM_LIB} SHARED ${${ADM_LIB}_SRCS})
+TARGET_LINK_LIBRARIES(${ADM_LIB} ADM_core6 ADM_libavutil6 ADM_libavcodec6)
+
+ADM_INSTALL_LIB(${ADM_LIB} )

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/CMakeLists.txt	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/CMakeLists.txt	2010-12-10 08:06:30 UTC (rev 6824)
@@ -0,0 +1,34 @@
+SET(ADM_LIB ADM_libavutil6)
+
+SET(${ADM_LIB}_SRCS 
+eval.c
+adler32.c
+aes.c
+base64.c
+crc.c
+des.c
+fifo.c
+integer.c
+intfloat_readwrite.c
+lls.c
+log.c
+lzo.c
+mathematics.c
+md5.c
+#random.c
+random_seed.c
+rational.c
+rc4.c
+#string.c
+avstring.c
+tree.c
+lfg.c
+mem.c
+pixdesc.c
+sha.c
+)
+
+ADD_LIBRARY(${ADM_LIB} SHARED ${${ADM_LIB}_SRCS})
+TARGET_LINK_LIBRARIES(${ADM_LIB} ADM_core6)
+
+ADM_INSTALL_LIB(${ADM_LIB} )

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libpostproc/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libpostproc/CMakeLists.txt	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libpostproc/CMakeLists.txt	2010-12-10 08:06:30 UTC (rev 6824)
@@ -0,0 +1,13 @@
+SET(ADM_LIB ADM_libpostproc6)
+
+SET(${ADM_LIB}_SRCS postprocess.c)
+
+ADD_LIBRARY(${ADM_LIB} SHARED ${${ADM_LIB}_SRCS})
+
+IF (ADM_DEBUG AND ADM_CPU_X86_32)
+	ADD_TARGET_CFLAGS(${ADM_LIB} -O2)
+ENDIF (ADM_DEBUG AND ADM_CPU_X86_32)
+
+TARGET_LINK_LIBRARIES(${ADM_LIB} ADM_core6 ADM_libavutil6)
+ADD_DEFINITIONS(-DADM_MINIMAL_INCLUDE)
+ADM_INSTALL_LIB(${ADM_LIB} )



From mean at mail.berlios.de  Fri Dec 10 09:06:32 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 10 Dec 2010 09:06:32 +0100
Subject: [Avidemux-svn-commit] r6825 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale
Message-ID: <20101210080632.7CA87480E5F@sheep.berlios.de>

Author: mean
Date: 2010-12-10 09:06:32 +0100 (Fri, 10 Dec 2010)
New Revision: 6825

Removed:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/CMakeLists.txt
Log:
[swscale] Import git from 9/12/2010

Deleted: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/CMakeLists.txt	2010-12-10 08:06:30 UTC (rev 6824)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/CMakeLists.txt	2010-12-10 08:06:32 UTC (rev 6825)
@@ -1,36 +0,0 @@
-INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR})
-
-ADD_DEFINITIONS(-DHAVE_AV_CONFIG_H -fomit-frame-pointer -fno-math-errno)
-# Compiler flags
-###########################""
-IF (UNIX)
-	# CMake automatically adds -fPIC so remove it
-	STRING(REPLACE "-fPIC" "" CMAKE_SHARED_LIBRARY_C_FLAGS ${CMAKE_SHARED_LIBRARY_C_FLAGS})
-	STRING(REPLACE "-fPIC" "" CMAKE_SHARED_LIBRARY_CXX_FLAGS ${CMAKE_SHARED_LIBRARY_CXX_FLAGS})
-ENDIF (UNIX)
-
-IF (ADM_CPU_X86_64 OR ADM_CPU_PPC)
-	ADD_DEFINITIONS(-fPIC -DPIC)
-ELSEIF (APPLE)
-	ADD_DEFINITIONS(-mdynamic-no-pic)
-ENDIF (ADM_CPU_X86_64 OR ADM_CPU_PPC)
-include_directories(ffmpeg_config)
-# Linker flags
-IF (APPLE)
-	SET(CMAKE_SHARED_LINKER_FLAGS "${CMAKE_SHARED_LINKER_FLAGS} -Wl,-single_module -Wl,-read_only_relocs,suppress")
-ENDIF (APPLE)
-
-IF (UNIX AND NOT APPLE)
-	SET(CMAKE_SHARED_LINKER_FLAGS "${CMAKE_SHARED_LINKER_FLAGS} -export-dynamic -Wl,-Bsymbolic")
-ENDIF (UNIX AND NOT APPLE)
-
-IF (WIN32)
-	SET(CMAKE_SHARED_LINKER_FLAGS "${CMAKE_SHARED_LINKER_FLAGS} -Wl,--enable-runtime-pseudo-reloc -Wl,--enable-auto-image-base")
-ENDIF (WIN32)
-#
-#
-ADD_SUBDIRECTORY(libavcodec)
-ADD_SUBDIRECTORY(libavformat)
-ADD_SUBDIRECTORY(libavutil)
-ADD_SUBDIRECTORY(libswscale)
-ADD_SUBDIRECTORY(libpostproc)



From mean at mail.berlios.de  Fri Dec 10 09:06:33 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 10 Dec 2010 09:06:33 +0100
Subject: [Avidemux-svn-commit] r6826 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale
Message-ID: <20101210080633.B0FB4480E5F@sheep.berlios.de>

Author: mean
Date: 2010-12-10 09:06:33 +0100 (Fri, 10 Dec 2010)
New Revision: 6826

Added:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/CMakeLists.txt
Log:
[swscale] CMake

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/CMakeLists.txt	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/CMakeLists.txt	2010-12-10 08:06:33 UTC (rev 6826)
@@ -0,0 +1,33 @@
+SET(ADM_LIB ADM_libswscale6)
+SET(${ADM_LIB}_SRCS 
+        swscale.c yuv2rgb.c rgb2rgb.c ADM_mp.cpp swscale_avoption.c utils.c
+)
+ADD_DEFINITIONS("-Dbswap_16=av_bswap16")
+
+IF(ADM_CPU_X86)
+SET(${ADM_LIB}_SRCS ${${ADM_LIB}_SRCS} x86/yuv2rgb_mmx.c)
+ENDIF(ADM_CPU_X86)
+
+IF (ADM_CPU_ALTIVEC)
+	SET(${ADM_LIB}_SRCS ${${ADM_LIB}_SRCS} yuv2rgb_altivec.c)
+ENDIF (ADM_CPU_ALTIVEC)
+
+ADD_LIBRARY(${ADM_LIB} SHARED ${${ADM_LIB}_SRCS})
+
+IF (APPLE AND ADM_DEBUG)
+	ADD_TARGET_CFLAGS(${ADM_LIB} -O2)
+ENDIF (APPLE AND ADM_DEBUG)
+
+TARGET_LINK_LIBRARIES(${ADM_LIB} ADM_core6 ADM_libavutil6)
+
+# Temporary hack to avoid error on cross compiling swscale
+IF(CROSS)
+  IF(WIN32)
+    IF(ADM_CPU_X86_64)
+	ADD_TARGET_CFLAGS(${ADM_LIB} -O0)
+    ENDIF(ADM_CPU_X86_64)
+  ENDIF(WIN32)
+ENDIF(CROSS)
+
+
+ADM_INSTALL_LIB(${ADM_LIB} )



From mean at mail.berlios.de  Fri Dec 10 09:06:34 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 10 Dec 2010 09:06:34 +0100
Subject: [Avidemux-svn-commit] r6827 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec
Message-ID: <20101210080634.DC5BB480E5F@sheep.berlios.de>

Author: mean
Date: 2010-12-10 09:06:34 +0100 (Fri, 10 Dec 2010)
New Revision: 6827

Added:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/ADM_lavcodec.cpp
Log:
[avcodec] add back ADM_lavcodec

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/ADM_lavcodec.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/ADM_lavcodec.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/ADM_lavcodec.cpp	2010-12-10 08:06:34 UTC (rev 6827)
@@ -0,0 +1,32 @@
+#include "ADM_coreConfig.h"
+#include "ADM_lavcodec.h"
+#include "ADM_default.h"
+/**
+ * 		\fn lavcodec_mm_support
+ * 		\brief Give lavcodec CPU supported ( FF_MM_MMX)
+ */
+extern "C"
+{
+int ADM_lavcodec_mm_support(void);
+}
+int ADM_lavcodec_mm_support(void)
+{
+int rval=0;
+
+#ifdef ADM_CPU_X86
+#undef MATCH
+#define MATCH(x,y) if(CpuCaps::myCpuCaps &  CpuCaps::myCpuMask & ADM_CPUCAP_##x) rval|=FF_MM_##x;
+
+	MATCH(MMX,MMX);
+	MATCH(MMXEXT,MMXEXT);
+	MATCH(SSE,SSE);
+	MATCH(SSE2,SSE2);
+	MATCH(SSE3,SSE3);
+	MATCH(SSSE3,SSSE3);
+	MATCH(3DNOW,3DNOW);
+	MATCH(3DNOWEXT,3DNOWEXT);
+#endif
+
+	return rval;
+}
+// EOF



From mean at mail.berlios.de  Fri Dec 10 09:06:36 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 10 Dec 2010 09:06:36 +0100
Subject: [Avidemux-svn-commit] r6828 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale
Message-ID: <20101210080636.20BB3480E5F@sheep.berlios.de>

Author: mean
Date: 2010-12-10 09:06:35 +0100 (Fri, 10 Dec 2010)
New Revision: 6828

Added:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/ADM_mp.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/ADM_mp.h
Log:
[swscale] Add back ADM_mp

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/ADM_mp.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/ADM_mp.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/ADM_mp.cpp	2010-12-10 08:06:35 UTC (rev 6828)
@@ -0,0 +1,103 @@
+/***************************************************************************
+
+    copyright            : (C) 2005 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <math.h>
+
+#include "ADM_lavcodec.h"
+#include "ADM_mangle.h"
+#include "fourcc.h"
+
+
+extern "C" {
+#include "ADM_ffmpeg/libavutil/avutil.h"
+#include "ADM_ffmpeg/libswscale/swscale.h"
+}
+
+
+#include "ADM_mp.h"
+
+
+#define Context ((SwsContext *)_context)
+
+ADM_MplayerResize::ADM_MplayerResize(uint32_t fromw, uint32_t fromh, uint32_t tow, uint32_t toh)
+{
+SwsFilter                  *srcFilter=NULL;
+SwsFilter                  *dstFilter=NULL;
+int                       flags=0;
+
+                           flags=SWS_BILINEAR;
+
+#ifdef ADM_CPU_X86
+                
+                #define ADD(x,y) if( CpuCaps::has##x()) flags|=SWS_CPU_CAPS_##y;
+                ADD(MMX,MMX);           
+                ADD(3DNOW,3DNOW);
+                ADD(MMXEXT,MMX2);
+#endif
+#ifdef ADM_CPU_ALTIVEC
+                flags|=SWS_CPU_CAPS_ALTIVEC;
+#endif
+
+                srcW=fromw;
+                srcH=fromh;
+                tgtW=tow;
+                tgtH=toh;
+
+                _context=(void *)sws_getContext(
+                                                srcW,srcH,
+                                                PIX_FMT_YUV420P,
+                                                tgtW,tgtH,
+                                                PIX_FMT_YUV420P,
+                                                flags, srcFilter, dstFilter,NULL);
+
+                if(!_context) ADM_assert(0);
+}
+ADM_MplayerResize::~ADM_MplayerResize()
+{
+        sws_freeContext(Context);
+        _context=NULL;
+}
+
+uint8_t ADM_MplayerResize::resize(uint8_t *datasrc, uint8_t *datadst)
+{
+uint8_t *src[3];
+uint8_t *dst[3];
+int ssrc[3];
+int ddst[3];
+
+uint32_t page;
+
+                        page=srcW*srcH;
+                        src[0]=datasrc;
+                        src[1]=datasrc+page;
+                        src[2]=datasrc+((page*5)/4);
+
+                        ssrc[0]=srcW;
+                        ssrc[1]=ssrc[2]=srcW>>1;
+
+                        page=tgtW*tgtH;
+                        dst[0]=datadst;
+                        dst[1]=datadst+page;
+                        dst[2]=datadst+(page*5)/4;
+                        ddst[0]=tgtW;
+                        ddst[1]=ddst[2]=tgtW>>1;
+
+                        sws_scale(Context,src,ssrc,0,srcH,dst,ddst);
+
+                        return 1;
+}

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/ADM_mp.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/ADM_mp.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/ADM_mp.h	2010-12-10 08:06:35 UTC (rev 6828)
@@ -0,0 +1,23 @@
+
+
+#ifndef ADM_MPLAYER_H
+#define ADM_MPLAYER_H
+
+class ADM_MplayerResize
+{
+protected:
+                void *_context;
+                uint32_t srcW,srcH;
+                uint32_t tgtW,tgtH;
+        
+public:
+                ADM_MplayerResize(uint32_t fromw, uint32_t fromh, uint32_t tow, uint32_t toh);
+                ~ADM_MplayerResize();
+                uint8_t resize(uint8_t *src, uint8_t *dst);
+
+
+};
+
+#endif
+
+



From mean at mail.berlios.de  Fri Dec 10 09:06:37 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 10 Dec 2010 09:06:37 +0100
Subject: [Avidemux-svn-commit] r6829 - in
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg: .
	libavcodec libavformat libswscale
Message-ID: <20101210080637.D7663480E5F@sheep.berlios.de>

Author: mean
Date: 2010-12-10 09:06:37 +0100 (Fri, 10 Dec 2010)
New Revision: 6829

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/dopatch.sh
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/CMakeLists.txt
Log:
[ffmpeg] Add back CMake*

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/dopatch.sh
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/dopatch.sh	2010-12-10 08:06:35 UTC (rev 6828)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/dopatch.sh	2010-12-10 08:06:37 UTC (rev 6829)
@@ -1,8 +1,16 @@
 #
+doPatch()
+{
+	src=$1
+	dts=$1
+	for i in patches/$src/*.patch ; do
+		echo $i
+       	 	git apply -p2   < $i
+	done
+	
+}
+doPatch avcodec
+doPatch avformat
+doPatch avutils
 
-for i in patches/*.patch ; do
-        echo $i
-        patch -p0  < $i
-done
 
-

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/CMakeLists.txt	2010-12-10 08:06:35 UTC (rev 6828)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/CMakeLists.txt	2010-12-10 08:06:37 UTC (rev 6829)
@@ -17,7 +17,7 @@
         flacdec.c
         flacdata.c
         vp6dsp.c
-        tscc.c  resample2.c    qdm2.c  bitstream_filter.c  eval.c  vc1.c
+        tscc.c  resample2.c    qdm2.c  bitstream_filter.c    vc1.c
 	vp56.c  vp6.c  vp5.c  indeo2.c  smacker.c  opt.c  fraps.c  dnxhddec.c
 	mpeg12data.c  mpegaudiodata.c  msmpeg4data.c   vp56data.c  mjpegbdec.c
 	h263_parser.c  h264_parser.c  mpeg4video_parser.c  mpegvideo_enc.c  mpeg12enc.c
@@ -46,12 +46,10 @@
 
 IF(ADM_CPU_X86)
 	SET(${ADM_LIB}_SRCS  ${${ADM_LIB}_SRCS}
-		x86/cpuid.c  x86/mpegvideo_mmx.c  x86/vp3dsp_mmx.c  x86/dsputil_mmx.c
+		  x86/mpegvideo_mmx.c   x86/dsputil_mmx.c
 		x86/fdct_mmx.c  x86/motion_est_mmx.c  x86/simple_idct_mmx.c  
-		x86/vp3dsp_sse2.c  x86/idct_mmx_xvid.c    x86/snowdsp_mmx.c
+		x86/idct_mmx_xvid.c    x86/snowdsp_mmx.c
                 x86/idct_sse2_xvid.c 
-                x86/vp6dsp_mmx.c
-                x86/vp6dsp_sse2.c
                 x86/vp8dsp-init.c
                 x86/mpegaudiodec_mmx.c
                 x86/lpc_mmx.c

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/CMakeLists.txt	2010-12-10 08:06:35 UTC (rev 6828)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/CMakeLists.txt	2010-12-10 08:06:37 UTC (rev 6829)
@@ -4,7 +4,7 @@
 	mpeg.c  utils.c  avio.c  aviobuf.c  cutils.c  img2.c  file.c  mpegtsenc.c
 	movenc.c  avi.c avienc.c  wav.c  mov.c  matroska.c  isom.c  isom.h  
 	flvenc.c  matroskaenc.c metadata.c metadata_compat.c options.c
-	avc.c raw.c  riff.c
+	avc.c   riff.c
         mpegenc.c
         movenchint.c sdp.c adtsenc.c flacenc.c flacenc_header.c vorbiscomment.c
 )

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/CMakeLists.txt	2010-12-10 08:06:35 UTC (rev 6828)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/CMakeLists.txt	2010-12-10 08:06:37 UTC (rev 6829)
@@ -1,6 +1,6 @@
 SET(ADM_LIB ADM_libswscale6)
 SET(${ADM_LIB}_SRCS 
-        swscale.c yuv2rgb.c rgb2rgb.c ADM_mp.cpp swscale_avoption.c utils.c
+        swscale.c yuv2rgb.c rgb2rgb.c ADM_mp.cpp  utils.c
 )
 ADD_DEFINITIONS("-Dbswap_16=av_bswap16")
 



From mean at mail.berlios.de  Fri Dec 10 09:06:40 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 10 Dec 2010 09:06:40 +0100
Subject: [Avidemux-svn-commit] r6830 - in
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg: .
	ffmpeg_config libavcodec libavcodec/x86 libavcore libavformat
	libavutil libswscale patches patches/avcodec patches/avformat
	patches/avutil patches/avutils patches/swscale
Message-ID: <20101210080640.E36B5480E5F@sheep.berlios.de>

Author: mean
Date: 2010-12-10 09:06:40 +0100 (Fri, 10 Dec 2010)
New Revision: 6830

Added:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/ff_spsinfo.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/ffpng.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcore/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/dsputil.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/x86_mathops.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/avutil.h.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/bswap.h.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/common.h.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/internal.h.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/intreadwrite.h.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/lfg.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/lfg.h.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/libm.h.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/mem.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/pixfmt.h.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/timer.h.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/swscale/
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/swscale/swscale_template.c.patch
Removed:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/png.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/x86_mathops.h.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/avutil.h.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/internal.h.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/lfg.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/lfg.h.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/libm.h.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/mem.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/timer.h.patch
Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/dopatch.sh
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/config.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/ffconf.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/avcodec.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/dsputil.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/fft.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/h263dec.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/h264_parser.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/h264dsp.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/mpeg12.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/mpeg12enc.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/mpegvideo.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/mpegvideo_enc.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/png.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/pngdec.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/pngenc.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/utils.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/x86/mathops.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/file.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/flvenc.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/isom.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/matroskaenc.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/movenc.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/mpegenc.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/mpegtsenc.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/utils.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/avutil.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/bswap.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/common.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/internal.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/intreadwrite.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/lfg.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/lfg.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/libm.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/mem.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/pixfmt.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/timer.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/swscale_template.c
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/avcodec.h.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/h263dec.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/h264_parser.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/mpeg12.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/mpegvideo.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/mpegvideo_enc.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/pngdec.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/utils.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/flvenc.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/isom.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/matroskaenc.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/movenc.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/mpegenc.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/mpegtsenc.c.patch
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/utils.c.patch
Log:
[core] update ffmpeg

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/CMakeLists.txt	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/CMakeLists.txt	2010-12-10 08:06:40 UTC (rev 6830)
@@ -15,6 +15,9 @@
 	ADD_DEFINITIONS(-mdynamic-no-pic)
 ENDIF (ADM_CPU_X86_64 OR ADM_CPU_PPC)
 include_directories(ffmpeg_config)
+#
+add_definitions(-DFFMPEG_CONFIGURATION="avidemux")
+add_definitions(-DFFMPEG_LICENSE="GPL")
 # Linker flags
 IF (APPLE)
 	SET(CMAKE_SHARED_LINKER_FLAGS "${CMAKE_SHARED_LINKER_FLAGS} -Wl,-single_module -Wl,-read_only_relocs,suppress")
@@ -32,5 +35,6 @@
 ADD_SUBDIRECTORY(libavcodec)
 ADD_SUBDIRECTORY(libavformat)
 ADD_SUBDIRECTORY(libavutil)
+ADD_SUBDIRECTORY(libavcore)
 ADD_SUBDIRECTORY(libswscale)
 ADD_SUBDIRECTORY(libpostproc)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/dopatch.sh
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/dopatch.sh	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/dopatch.sh	2010-12-10 08:06:40 UTC (rev 6830)
@@ -5,7 +5,7 @@
 	dts=$1
 	for i in patches/$src/*.patch ; do
 		echo $i
-       	 	git apply -p2   < $i
+       	 	patch -p3   <   $i
 	done
 	
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/config.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/config.h	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/config.h	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,599 +1,613 @@
-#include "ADM_coreConfig.h"
-#define CONFIG_H263_VAAPI_HWACCEL 0
-#define CONFIG_MPEG2_VAAPI_HWACCEL 0
-#define CONFIG_MPEG4_VAAPI_HWACCEL 0
-#define CONFIG_VC1_VAAPI_HWACCEL 0
-#define CONFIG_WMV3_VAAPI_HWACCEL 0
-#define CONFIG_H264_DXVA2_HWACCEL 0
-#define CONFIG_H264_VAAPI_HWACCEL 0
-#define CONFIG_VC1_DXVA2_HWACCEL 0
-#define CONFIG_VC1_DXVA2_HWACCEL 0
-#define CONFIG_WMV3_DXVA2_HWACCEL 0
-#define CONFIG_MPEG2_DXVA2_HWACCEL 0
-#ifdef USE_VDPAU
-#define CONFIG_H264_VDPAU_DECODER 1
-#define CONFIG_MPEG_VDPAU_DECODER 1
-#define CONFIG_MPEG1_VDPAU_DECODER 1
-#define CONFIG_VC1_VDPAU_DECODER 1
-#define CONFIG_WMV3_VDPAU_DECODER 1
-#else // USE_VDPAU
-#define CONFIG_H264_VDPAU_DECODER 0
-#define CONFIG_MPEG_VDPAU_DECODER 0
-#define CONFIG_MPEG1_VDPAU_DECODER 0
-#define CONFIG_VC1_VDPAU_DECODER 0
-#define CONFIG_WMV3_VDPAU_DECODER 0
-#endif // 
-#define CONFIG_MPEG4_VDPAU_DECODER 0
-#ifdef HAVE_MALLOC_H
-#undef HAVE_MALLOC_H 
-#define HAVE_MALLOC_H 1
-#else // HAVE_MALLOC_H
-#define HAVE_MALLOC_H 0
-#endif// HAVE_MALLOC_H
-#define CONFIG_SVQ1_DECODER 1
-#define CONFIG_AAC_DECODER 1
-#define CONFIG_MPEG4AAC_DECODER 1
-#define CONFIG_DCA_DECODER 1
-#define CONFIG_MP3_DECODER 1
-#define CONFIG_MP2_DECODER 1
-#define CONFIG_AC3_DECODER 1
-#define CONFIG_EAC3_DECODER 1
-#define CONFIG_NELLYMOSER_DECODER 1
-#define CONFIG_ADPCM_IMA_AMV_DECODER 1
-#define CONFIG_CINEPAK_DECODER 1
-#define CONFIG_DNXHD_DECODER 1
-#define CONFIG_FOURXM_DECODER 1
-#define CONFIG_FRAPS_DECODER 1
-#define CONFIG_H263_DECODER 1
-#define CONFIG_H264_DECODER 1
-#define CONFIG_INDEO2_DECODER 1
-#define CONFIG_INDEO3_DECODER 1
-#define CONFIG_INTERPLAY_VIDEO_DECODER 1
-#define CONFIG_MPEGVIDEO_DECODER 1
-#define CONFIG_MSVIDEO1_DECODER 1
-#define CONFIG_VC1_DECODER 1
-#define CONFIG_VCR1_DECODER 1
-#define CONFIG_VP5_DECODER 1
-#define CONFIG_VP6_DECODER 1
-#define CONFIG_VP6A_DECODER 1
-#define CONFIG_VP6F_DECODER 1
-#define CONFIG_WMV3_DECODER 1
-#define CONFIG_WMV1_DECODER 1
-#define CONFIG_WMV2_DECODER 1
-#define CONFIG_VP3_DECODER 1
-#define CONFIG_MPEG4_DECODER 1
-#define CONFIG_MSMPEG4V1_DECODER 1
-#define CONFIG_MSMPEG4V2_DECODER 1
-#define CONFIG_MSMPEG4V3_DECODER 1
-#define CONFIG_MJPEGB_DECODER 1
-#define CONFIG_MJPEG_DECODER 1
-#define CONFIG_WMAV2_DECODER 1
-#define CONFIG_DVVIDEO_DECODER 1
-#define CONFIG_HUFFYUV_DECODER 1
-#define CONFIG_FFVHUFF_DECODER 1
-#define CONFIG_SVQ3_DECODER 1
-#define CONFIG_TSCC_DECODER 1
-#define CONFIG_QDM2_DECODER 1
-#define CONFIG_FFV1_DECODER 1
-#define CONFIG_MPEG1VIDEO_DECODER 1
-#define CONFIG_MPEG2VIDEO_DECODER 1
-#define CONFIG_RV10_DECODER 1
-#define CONFIG_RV20_DECODER 1
-#define CONFIG_DVBSUB_DECODER 1
-#define CONFIG_FLV_DECODER 1
-#define CONFIG_SNOW_DECODER 1
-#define CONFIG_AMV_DECODER 1
-#define CONFIG_INDEO5_DECODER 1
-#define CONFIG_MP1FLOAT_DECODER 1
-#define CONFIG_MP2FLOAT_DECODER 1
-#define CONFIG_MP3FLOAT_DECODER 1
-#define CONFIG_INDEO5_DECODER 1
-#define CONFIG_INDEO5_DECODER 1
-#define CONFIG_VP8_DECODER 1
-#define CONFIG_PNG_DECODER 1
-#define CONFIG_LIBVPX_DECODER 0
-#define CONFIG_GSM_MS_DECODER 0
-#define CONFIG_GSM_DECODER 0
-#define CONFIG_ANSI_DECODER 0
-#define CONFIG_PICTOR_DECODER 0
-#define CONFIG_MP3ADUFLOAT_DECODER 0
-#define CONFIG_MP3ON4FLOAT_DECODER 0
-#define CONFIG_CDGRAPHICS_DECODER 0
-#define CONFIG_ANM_DECODER 0
-#define CONFIG_AURA_DECODER 0
-#define CONFIG_AURA2_DECODER 0
-#define CONFIG_BINK_DECODER 0
-#define CONFIG_FRWU_DECODER 0
-#define CONFIG_IFF_BYTERUN1_DECODER 0
-#define CONFIG_IFF_ILBM_DECODER 0
-#define CONFIG_KGV1_DECODER 0
-#define CONFIG_R210_DECODER 0
-#define CONFIG_YOP_DECODER 0
-#define CONFIG_KGV1_DECODER 0
-#define CONFIG_ALS_DECODER 0
-#define CONFIG_AMRNB_DECODER 0
-#define CONFIG_ATRAC1_DECODER 0
-#define CONFIG_BINKAUDIO_DCT_DECODER 0
-#define CONFIG_BINKAUDIO_RDFT_DECODER 0
-#define CONFIG_ATRAC1_DECODER 0
-#define CONFIG_SIPR_DECODER 0
-#define CONFIG_TWINVQ_DECODER 0
-#define CONFIG_WMAPRO_DECODER 0
-#define CONFIG_WMAVOICE_DECODER 0
-#define CONFIG_PCM_BLURAY_DECODER 0
-#define CONFIG_PGSSUB_DECODER 0
-#define CONFIG_DPX_DECODER 0
-#define CONFIG_EAMAD_DECODER 0
-#define CONFIG_TMV_DECODER 0
-#define CONFIG_V210_DECODER 0
-#define CONFIG_LIBOPENCORE_AMRNB_DECODER 0
-#define CONFIG_LIBOPENCORE_AMRWB_DECODER 0
-#define CONFIG_LIBSPEEX_DECODER 0
-#define CONFIG_LIBSCHROEDINGER_DECODER 0
-#define CONFIG_LIBOPENJPEG_DECODER 0
-#define CONFIG_LIBDIRAC_DECODER 0
-#define CONFIG_ADPCM_IMA_ISS_DECODER 0
-#define CONFIG_ADPCM_EA_MAXIS_XA_DECODER 0
-#define CONFIG_PCM_F64LE_DECODER 0
-#define CONFIG_PCM_F64BE_DECODER 0
-#define CONFIG_PCM_F32LE_DECODER 0
-#define CONFIG_PCM_F32BE_DECODER 0
-#define CONFIG_PCM_DVD_DECODER 0
-#define CONFIG_TRUEHD_DECODER 0
-#define CONFIG_QCELP_DECODER 0
-#define CONFIG_MP1_DECODER 0
-#define CONFIG_MLP_DECODER 0
-#define CONFIG_ALAC_DECODER 0
-#define CONFIG_PGMYUV_DECODER 0
-#define CONFIG_PPM_DECODER 0
-#define CONFIG_EATGV_DECODER 0
-#define CONFIG_EATQI_DECODER 0
-#define CONFIG_EIGHTSVX_EXP_DECODER 0
-#define CONFIG_EIGHTSVX_FIB_DECODER 0
-#define CONFIG_ESCAPE124_DECODER 0
-#define CONFIG_MIMIC_DECODER 0
-#define CONFIG_MOTIONPIXELS_DECODER 0
-#define CONFIG_PAM_DECODER 0
-#define CONFIG_PBM_DECODER 0
-#define CONFIG_PGM_DECODER 0
-#define CONFIG_RL2_DECODER 0
-#define CONFIG_RV30_DECODER 0
-#define CONFIG_RV40_DECODER 0
-#define CONFIG_V210X_DECODER 0
-#define CONFIG_BFI_DECODER 0
-#define CONFIG_EACMV_DECODER 0
-#define CONFIG_EATGQ_DECODER 0
-#define CONFIG_PCX_DECODER 0
-#define CONFIG_SUNRAST_DECODER 0
-#define CONFIG_VB_DECODER 0
-#define CONFIG_XSUB_DECODER 0
-#define CONFIG_APE_DECODER 0
-#define CONFIG_MPC8_DECODER 0
-#define CONFIG_PCM_S16LE_PLANAR_DECODER 0
-#define CONFIG_PCM_ZORK_DECODER 0
-#define CONFIG_ADPCM_EA_R1_DECODER 0
-#define CONFIG_ADPCM_EA_R2_DECODER 0
-#define CONFIG_ADPCM_EA_R3_DECODER 0
-#define CONFIG_ADPCM_EA_XAS_DECODER 0
-#define CONFIG_ADPCM_IMA_EA_EACS_DECODER 0
-#define CONFIG_ADPCM_IMA_EA_SEAD_DECODER 0
-#define CONFIG_AASC_DECODER 0
-#define CONFIG_AVS_DECODER 0
-#define CONFIG_BETHSOFTVID_DECODER 0
-#define CONFIG_C93_DECODER 0
-#define CONFIG_CAVS_DECODER 0
-#define CONFIG_CLJR_DECODER 0
-#define CONFIG_CSCD_DECODER 0
-#define CONFIG_CYUV_DECODER 0
-#define CONFIG_DSICINVIDEO_DECODER 0
-#define CONFIG_DXA_DECODER 0
-#define CONFIG_EIGHTBPS_DECODER 0
-#define CONFIG_FLIC_DECODER 0
-#define CONFIG_IDCIN_DECODER 0
-#define CONFIG_KMVC_DECODER 0
-#define CONFIG_LOCO_DECODER 0
-#define CONFIG_MDEC_DECODER 0
-#define CONFIG_MMVIDEO_DECODER 0
-#define CONFIG_MPEG_XVMC_DECODER 0
-#define CONFIG_MSRLE_DECODER 0
-#define CONFIG_MSZH_DECODER 0
-#define CONFIG_NUV_DECODER 0
-#define CONFIG_PTX_DECODER 0
-#define CONFIG_QDRAW_DECODER 0
-#define CONFIG_QPEG_DECODER 0
-#define CONFIG_RPZA_DECODER 0
-#define CONFIG_SMACKER_DECODER 0
-#define CONFIG_SMC_DECODER 0
-#define CONFIG_SP5X_DECODER 0
-#define CONFIG_THEORA_DECODER 0
-#define CONFIG_THP_DECODER 0
-#define CONFIG_TIERTEXSEQVIDEO_DECODER 0
-#define CONFIG_TRUEMOTION1_DECODER 0
-#define CONFIG_TRUEMOTION2_DECODER 0
-#define CONFIG_TXD_DECODER 0
-#define CONFIG_ULTI_DECODER 0
-#define CONFIG_VMDVIDEO_DECODER 0
-#define CONFIG_VMNC_DECODER 0
-#define CONFIG_VQA_DECODER 0
-#define CONFIG_WNV1_DECODER 0
-#define CONFIG_XAN_WC3_DECODER 0
-#define CONFIG_XL_DECODER 0
-#define CONFIG_ALAC_DECODER 0
-#define CONFIG_ATRAC3_DECODER 0
-#define CONFIG_COOK_DECODER 0
-#define CONFIG_DSICINAUDIO_DECODER 0
-#define CONFIG_IMC_DECODER 0
-#define CONFIG_LIBA52_DECODER 0
-#define CONFIG_LIBFAAD_DECODER 0
-#define CONFIG_MACE3_DECODER 0
-#define CONFIG_MACE6_DECODER 0
-#define CONFIG_MP3ADU_DECODER 0
-#define CONFIG_MP3ON4_DECODER 0
-#define CONFIG_MPC7_DECODER 0
-#define CONFIG_RA_144_DECODER 0
-#define CONFIG_RA_288_DECODER 0
-#define CONFIG_SHORTEN_DECODER 0
-#define CONFIG_SMACKAUD_DECODER 0
-#define CONFIG_TRUESPEECH_DECODER 0
-#define CONFIG_TTA_DECODER 0
-#define CONFIG_VMDAUDIO_DECODER 0
-#define CONFIG_WAVPACK_DECODER 0
-#define CONFIG_WS_SND1_DECODER 0
-#define CONFIG_INTERPLAY_DPCM_DECODER 0
-#define CONFIG_SOL_DPCM_DECODER 0
-#define CONFIG_XAN_DPCM_DECODER 0
-#define CONFIG_ADPCM_THP_DECODER 0
-#define CONFIG_ASV1_DECODER 0
-#define CONFIG_ASV2_DECODER 0
-#define CONFIG_BMP_DECODER 0
-#define CONFIG_FLASHSV_DECODER 0
-#define CONFIG_GIF_DECODER 0
-#define CONFIG_H261_DECODER 0
-#define CONFIG_H263I_DECODER 0
-#define CONFIG_JPEGLS_DECODER 0
-#define CONFIG_QTRLE_DECODER 0
-#define CONFIG_RAWVIDEO_DECODER 0
-#define CONFIG_ROQ_DECODER 0
-#define CONFIG_SGI_DECODER 0
-#define CONFIG_TARGA_DECODER 0
-#define CONFIG_TIFF_DECODER 0
-#define CONFIG_ZLIB_DECODER 0
-#define CONFIG_ZMBV_DECODER 0
-#define CONFIG_FLAC_DECODER 0
-#define CONFIG_LIBAMR_NB_DECODER 0
-#define CONFIG_LIBAMR_WB_DECODER 0
-#define CONFIG_LIBGSM_DECODER 0
-#define CONFIG_LIBGSM_MS_DECODER 0
-#define CONFIG_SONIC_DECODER 0
-#define CONFIG_VORBIS_DECODER 0
-#define CONFIG_WMAV1_DECODER 0
-#define CONFIG_PCM_ALAW_DECODER 0
-#define CONFIG_PCM_MULAW_DECODER 0
-#define CONFIG_PCM_S8_DECODER 0
-#define CONFIG_PCM_S16BE_DECODER 0
-#define CONFIG_PCM_S16LE_DECODER 0
-#define CONFIG_PCM_S24BE_DECODER 0
-#define CONFIG_PCM_S24DAUD_DECODER 0
-#define CONFIG_PCM_S24LE_DECODER 0
-#define CONFIG_PCM_S32BE_DECODER 0
-#define CONFIG_PCM_S32LE_DECODER 0
-#define CONFIG_PCM_U8_DECODER 0
-#define CONFIG_PCM_U16BE_DECODER 0
-#define CONFIG_PCM_U16LE_DECODER 0
-#define CONFIG_PCM_U24BE_DECODER 0
-#define CONFIG_PCM_U24LE_DECODER 0
-#define CONFIG_PCM_U32BE_DECODER 0
-#define CONFIG_PCM_U32LE_DECODER 0
-#define CONFIG_ROQ_DPCM_DECODER 0
-#define CONFIG_ADPCM_4XM_DECODER 0
-#define CONFIG_ADPCM_ADX_DECODER 0
-#define CONFIG_ADPCM_CT_DECODER 0
-#define CONFIG_ADPCM_EA_DECODER 0
-#define CONFIG_ADPCM_G726_DECODER 0
-#define CONFIG_ADPCM_IMA_DK3_DECODER 0
-#define CONFIG_ADPCM_IMA_DK4_DECODER 0
-#define CONFIG_ADPCM_IMA_QT_DECODER 0
-#define CONFIG_ADPCM_IMA_SMJPEG_DECODER 0
-#define CONFIG_ADPCM_IMA_WAV_DECODER 0
-#define CONFIG_ADPCM_IMA_WS_DECODER 0
-#define CONFIG_ADPCM_MS_DECODER 0
-#define CONFIG_ADPCM_SBPRO_2_DECODER 0
-#define CONFIG_ADPCM_SBPRO_3_DECODER 0
-#define CONFIG_ADPCM_SBPRO_4_DECODER 0
-#define CONFIG_ADPCM_SWF_DECODER 0
-#define CONFIG_ADPCM_XA_DECODER 0
-#define CONFIG_ADPCM_YAMAHA_DECODER 0
-#define CONFIG_DVDSUB_DECODER 0
-#define CONFIG_LIBVORBIS_DECODER 0
-#define CONFIG_VP8_PARSER 1
-#define CONFIG_AAC_PARSER 1
-#define CONFIG_H263_PARSER 1
-#define CONFIG_H264_PARSER 1
-#define CONFIG_MPEG4VIDEO_PARSER 1
-#define CONFIG_AC3_PARSER 0
-#define CONFIG_CAVSVIDEO_PARSER 0
-#define CONFIG_DCA_PARSER 0
-#define CONFIG_DVBSUB_PARSER 0
-#define CONFIG_DVDSUB_PARSER 0
-#define CONFIG_H261_PARSER 0
-#define CONFIG_MJPEG_PARSER 0
-#define CONFIG_MPEGAUDIO_PARSER 0
-#define CONFIG_MPEGVIDEO_PARSER 0
-#define CONFIG_PNM_PARSER 0
-#define CONFIG_VC1_PARSER 0
-#define CONFIG_VP3_PARSER 0
-#define CONFIG_DNXHD_PARSER 0
-#define CONFIG_DIRAC_PARSER 0
-#define CONFIG_AAC_ENCODER 1
-#define CONFIG_MJPEG_ENCODER 1
-#define CONFIG_MSMPEG4V3_ENCODER 1
-#define CONFIG_H263P_ENCODER 1
-#define CONFIG_AC3_ENCODER 1
-#define CONFIG_FFV1_ENCODER 1
-#define CONFIG_FLV1_ENCODER 1
-#define CONFIG_FFVHUFF_ENCODER 1
-#define CONFIG_H263_ENCODER 1
-#define CONFIG_MPEG1VIDEO_ENCODER 1
-#define CONFIG_MPEG2VIDEO_ENCODER 1
-#define CONFIG_MPEG4_ENCODER 1
-#define CONFIG_FLV_ENCODER 1
-#define CONFIG_MP2_ENCODER 1
-#define CONFIG_DVVIDEO_ENCODER 1
-#define CONFIG_HUFFYUV_ENCODER 1
-#define CONFIG_DVBSUB_ENCODER 1
-#define CONFIG_SNOW_ENCODER 1
-#define CONFIG_LIBVPX_ENCODER 0
-#define CONFIG_RA_144_ENCODER 0
-#define CONFIG_XSUB_ENCODER 0
-#define CONFIG_V210_ENCODER 0
-#define CONFIG_LIBOPENCORE_AMRNB_ENCODER 0
-#define CONFIG_LIBSCHROEDINGER_ENCODER 0
-#define CONFIG_LIBDIRAC_ENCODER 0
-#define CONFIG_PCM_F64LE_ENCODER 0
-#define CONFIG_PCM_F64BE_ENCODER 0
-#define CONFIG_PCM_F32BE_ENCODER 0
-#define CONFIG_PCM_F32LE_ENCODER 0
-#define CONFIG_NELLYMOSER_ENCODER 0
-#define CONFIG_ALAC_ENCODER 0
-#define CONFIG_PCX_ENCODER 0
-#define CONFIG_DNXHD_ENCODER 0
-#define CONFIG_PCM_ZORK_ENCODER 0
-#define CONFIG_ADPCM_IMA_AMV_ENCODER 0
-#define CONFIG_LIBX264_ENCODER 0
-#define CONFIG_LIBXVID_ENCODER 0
-#define CONFIG_LJPEG_ENCODER 0
-#define CONFIG_PAM_ENCODER 0
-#define CONFIG_PBM_ENCODER 0
-#define CONFIG_PGM_ENCODER 0
-#define CONFIG_PGMYUV_ENCODER 0
-#define CONFIG_PPM_ENCODER 0
-#define CONFIG_LIBFAAC_ENCODER 0
-#define CONFIG_LIBMP3LAME_ENCODER 0
-#define CONFIG_LIBTHEORA_ENCODER 0
-#define CONFIG_SONIC_LS_ENCODER 0
-#define CONFIG_ASV1_ENCODER 0
-#define CONFIG_ASV2_ENCODER 0
-#define CONFIG_BMP_ENCODER 0
-#define CONFIG_FLASHSV_ENCODER 0
-#define CONFIG_GIF_ENCODER 0
-#define CONFIG_H261_ENCODER 0
-#define CONFIG_JPEGLS_ENCODER 0
-#define CONFIG_MSMPEG4V1_ENCODER 0
-#define CONFIG_MSMPEG4V2_ENCODER 0
-#define CONFIG_PNG_ENCODER 0
-#define CONFIG_QTRLE_ENCODER 0
-#define CONFIG_RAWVIDEO_ENCODER 0
-#define CONFIG_ROQ_ENCODER 0
-#define CONFIG_RV10_ENCODER 0
-#define CONFIG_RV20_ENCODER 0
-#define CONFIG_SGI_ENCODER 0
-#define CONFIG_SVQ1_ENCODER 0
-#define CONFIG_TARGA_ENCODER 0
-#define CONFIG_TIFF_ENCODER 0
-#define CONFIG_WMV1_ENCODER 0
-#define CONFIG_WMV2_ENCODER 0
-#define CONFIG_ZLIB_ENCODER 0
-#define CONFIG_ZMBV_ENCODER 0
-#define CONFIG_FLAC_ENCODER 0
-#define CONFIG_LIBAMR_NB_ENCODER 0
-#define CONFIG_LIBAMR_WB_ENCODER 0
-#define CONFIG_LIBGSM_ENCODER 0
-#define CONFIG_LIBGSM_MS_ENCODER 0
-#define CONFIG_SONIC_ENCODER 0
-#define CONFIG_VORBIS_ENCODER 0
-#define CONFIG_WMAV1_ENCODER 0
-#define CONFIG_WMAV2_ENCODER 0
-#define CONFIG_PCM_ALAW_ENCODER 0
-#define CONFIG_PCM_MULAW_ENCODER 0
-#define CONFIG_PCM_S8_ENCODER 0
-#define CONFIG_PCM_S16BE_ENCODER 0
-#define CONFIG_PCM_S16LE_ENCODER 0
-#define CONFIG_PCM_S24BE_ENCODER 0
-#define CONFIG_PCM_S24DAUD_ENCODER 0
-#define CONFIG_PCM_S24LE_ENCODER 0
-#define CONFIG_PCM_S32BE_ENCODER 0
-#define CONFIG_PCM_S32LE_ENCODER 0
-#define CONFIG_PCM_U8_ENCODER 0
-#define CONFIG_PCM_U16BE_ENCODER 0
-#define CONFIG_PCM_U16LE_ENCODER 0
-#define CONFIG_PCM_U24BE_ENCODER 0
-#define CONFIG_PCM_U24LE_ENCODER 0
-#define CONFIG_PCM_U32BE_ENCODER 0
-#define CONFIG_PCM_U32LE_ENCODER 0
-#define CONFIG_ROQ_DPCM_ENCODER 0
-#define CONFIG_ADPCM_4XM_ENCODER 0
-#define CONFIG_ADPCM_ADX_ENCODER 0
-#define CONFIG_ADPCM_CT_ENCODER 0
-#define CONFIG_ADPCM_EA_ENCODER 0
-#define CONFIG_ADPCM_G726_ENCODER 0
-#define CONFIG_ADPCM_IMA_DK3_ENCODER 0
-#define CONFIG_ADPCM_IMA_DK4_ENCODER 0
-#define CONFIG_ADPCM_IMA_QT_ENCODER 0
-#define CONFIG_ADPCM_IMA_SMJPEG_ENCODER 0
-#define CONFIG_ADPCM_IMA_WAV_ENCODER 0
-#define CONFIG_ADPCM_IMA_WS_ENCODER 0
-#define CONFIG_ADPCM_MS_ENCODER 0
-#define CONFIG_ADPCM_SBPRO_2_ENCODER 0
-#define CONFIG_ADPCM_SBPRO_3_ENCODER 0
-#define CONFIG_ADPCM_SBPRO_4_ENCODER 0
-#define CONFIG_ADPCM_SWF_ENCODER 0
-#define CONFIG_ADPCM_XA_ENCODER 0
-#define CONFIG_ADPCM_YAMAHA_ENCODER 0
-#define CONFIG_DVDSUB_ENCODER 0
-#define CONFIG_LIBVORBIS_ENCODER 0
-#define CONFIG_CHOMP_BSF 0
-#define CONFIG_AAC_ADTSTOASC_BSF 0
-#define CONFIG_MP3_HEADER_COMPRESS_BSF 0
-#define CONFIG_IMX_DUMP_HEADER_BSF 0
-#define CONFIG_DUMP_EXTRADATA_BSF 0
-#define CONFIG_REMOVE_EXTRADATA_BSF 0
-#define CONFIG_NOISE_BSF 0
-#define CONFIG_MP3_HEADER_DECOMPRESS_BSF 0
-#define CONFIG_MJPEGA_DUMP_HEADER_BSF 0
-#define CONFIG_H264_MP4TOANNEXB_BSF 0
-#define CONFIG_MOV2TEXTSUB_BSF 0
-#define CONFIG_TEXT2MOVSUB_BSF 0
-#define CONFIG_MUXERS 1
-#define CONFIG_MATROSKA_MUXER 1
-#define CONFIG_WEBM_MUXER 1
-#define CONFIG_MOV_MUXER 1
-#define CONFIG_IPOD_MUXER 1
-#define CONFIG_MP4_MUXER 1
-#define CONFIG_PSP_MUXER 1
-#define CONFIG_TG2_MUXER 1
-#define CONFIG_TGP_MUXER 1
-#define CONFIG_MPEG1VCD_MUXER 1
-#define CONFIG_MPEG2SVCD_MUXER 1
-#define CONFIG_MPEG2DVD_MUXER 1
-#define CONFIG_MPEG2VOB_MUXER 1
-#define CONFIG_W64_DEMUXER 0
-#define CONFIG_ENCODERS 1
-#define CONFIG_DVVIDEO_ENCODER 1
-#define CONFIG_SNOW_ENCODER 1
-#define CONFIG_DECODERS 1
-#define CONFIG_DVVIDEO_DECODER 1
-#define CONFIG_H263_DECODER 1
-#define CONFIG_MPEG4_DECODER 1
-#define CONFIG_SNOW_DECODER 1
-#define CONFIG_VC1_DECODER 1
-#define CONFIG_WMV2_DECODER 1
-#define CONFIG_WMV3_DECODER 1
-#define CONFIG_SWSCALE_ALPHA 0
-#define CONFIG_MPEGAUDIO_HP 1
-#define CONFIG_ZLIB 1
-#define CONFIG_GPL 1
-#define CONFIG_ARMV4L 0
-#define CONFIG_MLIB 0
-#define CONFIG_SPARC 0
-#define CONFIG_ALPHA 0
-#define CONFIG_MMI 0
-#define CONFIG_SH4 0
-#define CONFIG_BFIN 0
-#define CONFIG_SMALL 0
-#define CONFIG_MLP_PARSER 0
-//****************** SYSTEM *******************
-#	define ARCH_ARM 0
-#	define ARCH_ALPHA 0
-#	define ARCH_PPC 0
-#	define ARCH_SH4 0
-#	define ARCH_BFIN 0
-#	define HAVE_MMI 0
-#	define HAVE_VIS 0
-#	define CONFIG_GRAY 0
-#	define HAVE_TRUNCF 1
-#ifdef __APPLE__
-#	define CONFIG_DARWIN 1
-#endif
-#if defined(ADM_CPU_X86_32)
-#	define ARCH_X86 1
-#	define ARCH_X86_32 1
-#	define ARCH_X86_64 0
-#	define HAVE_ALTIVEC 0
-#elif defined(ADM_CPU_X86_64)
-#	define ARCH_X86 1
-#	define ARCH_X86_64 1
-#	define HAVE_ALTIVEC 0
-#elif defined(ADM_CPU_PPC)
-#	define ARCH_POWERPC 1
-#ifdef ADM_CPU_ALTIVEC
-#	define HAVE_ALTIVEC 1
-#ifndef __APPLE__
-#	define HAVE_ALTIVEC_H 1
-#endif	// __APPLE__
-#endif	// ADM_CPU_ALTIVEC
-#ifdef ADM_CPU_DCBZL
-#	define HAVE_DCBZL 1
-#endif	// ADM_CPU_DCBZL
-#endif	// ADM_CPU_X86_32
-#ifndef ADM_MINIMAL_INCLUDE
-#if defined(ADM_CPU_X86_32) && defined(ADM_CPU_MMX2)
-#	define HAVE_MMX2 1
-#endif
-#ifdef ADM_CPU_SSSE3
-#	define HAVE_SSSE3 1
-#endif
-#endif //ADM_MINIMAL_INCLUDE
-#ifdef ARCH_POWERPC
-#	define ENABLE_POWERPC 1
-#else
-#	define ENABLE_POWERPC 0
-#endif
-#ifdef ARCH_X86
-#	define ENABLE_BSWAP 1
-#ifndef ADM_MINIMAL_INCLUDE
-#	define HAVE_MMX 1
-#	define HAVE_SSE 1
-#	define HAVE_AMD3DNOW 1
-#	define HAVE_AMD3DNOWEXT 1
-#	define ENABLE_MMX 1
-#endif //ADM_MINIMAL_INCLUDE
-#	define HAVE_FAST_UNALIGNED 1
-#	define HAVE_EBP_AVAILABLE 1
-#	define HAVE_EBX_AVAILABLE 1
-#else
-#	define ENABLE_MMX 0
-#	define HAVE_SSE 0
-#	define HAVE_AMD3DNOW 0
-#	define HAVE_AMD3DNOWEXT 0
-#endif
-#ifdef ARCH_X86_64
-#	define HAVE_FAST_64BIT 1
-#endif
-#ifdef ADM_BIG_ENDIAN
-#	define WORDS_BIGENDIAN 1
-#endif
-#ifdef USE_YASM
-#define ENABLE_YASM      1
-#define HAVE_YASM        1
-#else // USE_YASM
-#define ENABLE_YASM      0
-#define HAVE_YASM        0
-#endif // USE_YASM
-#define CONFIG_FILE_PROTOCOL  1
-#define CONFIG_MDCT     1
-#define CONFIG_DCT      1
-#define CONFIG_LPC      1
-#define CONFIG_H264DSP  1
-#define ENABLE_ARM      0
-#define ENABLE_PPC      0
-#define ENABLE_THREADS 1
-#define ENABLE_ENCODERS 1
-#define CONFIG_MUXERS 1
-#define CONFIG_DEMUXERS 1
-#define ENABLE_VIS 0
-#define ENABLE_GRAY 0
-#define HAVE_LRINTF 1
-#define HAVE_LLRINT 1
-#define HAVE_LRINT 1
-#define HAVE_LOG2 1
-#define HAVE_ROUND 1
-#define HAVE_ROUNDF 1
-#define HAVE_THREADS 1
-#define RUNTIME_CPUDETECT 1
-#define CONFIG_RUNTIME_CPUDETECT 1
-#if defined( __MINGW32__) || defined(__APPLE__)
-#define EXTERN_PREFIX "_"
-#else // __MINGW32__
-#define EXTERN_PREFIX
-#endif // __MINGW32__
-#define restrict __restrict__
+#include "ADM_coreConfig.h"
+#define CONFIG_H263_VAAPI_HWACCEL 0
+#define CONFIG_MPEG2_VAAPI_HWACCEL 0
+#define CONFIG_MPEG4_VAAPI_HWACCEL 0
+#define CONFIG_VC1_VAAPI_HWACCEL 0
+#define CONFIG_WMV3_VAAPI_HWACCEL 0
+#define CONFIG_H264_DXVA2_HWACCEL 0
+#define CONFIG_H264_VAAPI_HWACCEL 0
+#define CONFIG_VC1_DXVA2_HWACCEL 0
+#define CONFIG_VC1_DXVA2_HWACCEL 0
+#define CONFIG_WMV3_DXVA2_HWACCEL 0
+#define CONFIG_MPEG2_DXVA2_HWACCEL 0
+#ifdef USE_VDPAU
+#define CONFIG_H264_VDPAU_DECODER 1
+#define CONFIG_MPEG_VDPAU_DECODER 1
+#define CONFIG_MPEG1_VDPAU_DECODER 1
+#define CONFIG_VC1_VDPAU_DECODER 1
+#define CONFIG_WMV3_VDPAU_DECODER 1
+#else // USE_VDPAU
+#define CONFIG_H264_VDPAU_DECODER 0
+#define CONFIG_MPEG_VDPAU_DECODER 0
+#define CONFIG_MPEG1_VDPAU_DECODER 0
+#define CONFIG_VC1_VDPAU_DECODER 0
+#define CONFIG_WMV3_VDPAU_DECODER 0
+#endif // 
+#define CONFIG_MPEG4_VDPAU_DECODER 0
+#ifdef HAVE_MALLOC_H
+#undef HAVE_MALLOC_H 
+#define HAVE_MALLOC_H 1
+#else // HAVE_MALLOC_H
+#define HAVE_MALLOC_H 0
+#endif// HAVE_MALLOC_H
+#define CONFIG_R10K_DECODER 1
+#define CONFIG_AAC_LATM_DECODER 1
+#define CONFIG_PCM_LXF_DECODER 1
+#define CONFIG_ADPCM_G722_DECODER 1
+#define CONFIG_ASS_DECODER 1
+#define CONFIG_SVQ1_DECODER 1
+#define CONFIG_AAC_DECODER 1
+#define CONFIG_MPEG4AAC_DECODER 1
+#define CONFIG_DCA_DECODER 1
+#define CONFIG_MP3_DECODER 1
+#define CONFIG_MP2_DECODER 1
+#define CONFIG_AC3_DECODER 1
+#define CONFIG_EAC3_DECODER 1
+#define CONFIG_NELLYMOSER_DECODER 1
+#define CONFIG_ADPCM_IMA_AMV_DECODER 1
+#define CONFIG_CINEPAK_DECODER 1
+#define CONFIG_DNXHD_DECODER 1
+#define CONFIG_FOURXM_DECODER 1
+#define CONFIG_FRAPS_DECODER 1
+#define CONFIG_H263_DECODER 1
+#define CONFIG_H264_DECODER 1
+#define CONFIG_INDEO2_DECODER 1
+#define CONFIG_INDEO3_DECODER 1
+#define CONFIG_INTERPLAY_VIDEO_DECODER 1
+#define CONFIG_MPEGVIDEO_DECODER 1
+#define CONFIG_MSVIDEO1_DECODER 1
+#define CONFIG_VC1_DECODER 1
+#define CONFIG_VCR1_DECODER 1
+#define CONFIG_VP5_DECODER 1
+#define CONFIG_VP6_DECODER 1
+#define CONFIG_VP6A_DECODER 1
+#define CONFIG_VP6F_DECODER 1
+#define CONFIG_WMV3_DECODER 1
+#define CONFIG_WMV1_DECODER 1
+#define CONFIG_WMV2_DECODER 1
+#define CONFIG_VP3_DECODER 1
+#define CONFIG_MPEG4_DECODER 1
+#define CONFIG_MSMPEG4V1_DECODER 1
+#define CONFIG_MSMPEG4V2_DECODER 1
+#define CONFIG_MSMPEG4V3_DECODER 1
+#define CONFIG_MJPEGB_DECODER 1
+#define CONFIG_MJPEG_DECODER 1
+#define CONFIG_WMAV2_DECODER 1
+#define CONFIG_DVVIDEO_DECODER 1
+#define CONFIG_HUFFYUV_DECODER 1
+#define CONFIG_FFVHUFF_DECODER 1
+#define CONFIG_SVQ3_DECODER 1
+#define CONFIG_TSCC_DECODER 1
+#define CONFIG_QDM2_DECODER 1
+#define CONFIG_FFV1_DECODER 1
+#define CONFIG_MPEG1VIDEO_DECODER 1
+#define CONFIG_MPEG2VIDEO_DECODER 1
+#define CONFIG_RV10_DECODER 1
+#define CONFIG_RV20_DECODER 1
+#define CONFIG_DVBSUB_DECODER 1
+#define CONFIG_FLV_DECODER 1
+#define CONFIG_SNOW_DECODER 1
+#define CONFIG_AMV_DECODER 1
+#define CONFIG_INDEO5_DECODER 1
+#define CONFIG_MP1FLOAT_DECODER 1
+#define CONFIG_MP2FLOAT_DECODER 1
+#define CONFIG_MP3FLOAT_DECODER 1
+#define CONFIG_INDEO5_DECODER 1
+#define CONFIG_INDEO5_DECODER 1
+#define CONFIG_VP8_DECODER 1
+#define CONFIG_PNG_DECODER 1
+#define CONFIG_LIBVPX_DECODER 0
+#define CONFIG_GSM_MS_DECODER 0
+#define CONFIG_GSM_DECODER 0
+#define CONFIG_ANSI_DECODER 0
+#define CONFIG_PICTOR_DECODER 0
+#define CONFIG_MP3ADUFLOAT_DECODER 0
+#define CONFIG_MP3ON4FLOAT_DECODER 0
+#define CONFIG_CDGRAPHICS_DECODER 0
+#define CONFIG_ANM_DECODER 0
+#define CONFIG_AURA_DECODER 0
+#define CONFIG_AURA2_DECODER 0
+#define CONFIG_BINK_DECODER 0
+#define CONFIG_FRWU_DECODER 0
+#define CONFIG_IFF_BYTERUN1_DECODER 0
+#define CONFIG_IFF_ILBM_DECODER 0
+#define CONFIG_KGV1_DECODER 0
+#define CONFIG_R210_DECODER 0
+#define CONFIG_YOP_DECODER 0
+#define CONFIG_KGV1_DECODER 0
+#define CONFIG_ALS_DECODER 0
+#define CONFIG_AMRNB_DECODER 0
+#define CONFIG_ATRAC1_DECODER 0
+#define CONFIG_BINKAUDIO_DCT_DECODER 0
+#define CONFIG_BINKAUDIO_RDFT_DECODER 0
+#define CONFIG_ATRAC1_DECODER 0
+#define CONFIG_SIPR_DECODER 0
+#define CONFIG_TWINVQ_DECODER 0
+#define CONFIG_WMAPRO_DECODER 0
+#define CONFIG_WMAVOICE_DECODER 0
+#define CONFIG_PCM_BLURAY_DECODER 0
+#define CONFIG_PGSSUB_DECODER 0
+#define CONFIG_DPX_DECODER 0
+#define CONFIG_EAMAD_DECODER 0
+#define CONFIG_TMV_DECODER 0
+#define CONFIG_V210_DECODER 0
+#define CONFIG_LIBOPENCORE_AMRNB_DECODER 0
+#define CONFIG_LIBOPENCORE_AMRWB_DECODER 0
+#define CONFIG_LIBSPEEX_DECODER 0
+#define CONFIG_LIBSCHROEDINGER_DECODER 0
+#define CONFIG_LIBOPENJPEG_DECODER 0
+#define CONFIG_LIBDIRAC_DECODER 0
+#define CONFIG_ADPCM_IMA_ISS_DECODER 0
+#define CONFIG_ADPCM_EA_MAXIS_XA_DECODER 0
+#define CONFIG_PCM_F64LE_DECODER 0
+#define CONFIG_PCM_F64BE_DECODER 0
+#define CONFIG_PCM_F32LE_DECODER 0
+#define CONFIG_PCM_F32BE_DECODER 0
+#define CONFIG_PCM_DVD_DECODER 0
+#define CONFIG_TRUEHD_DECODER 0
+#define CONFIG_QCELP_DECODER 0
+#define CONFIG_MP1_DECODER 0
+#define CONFIG_MLP_DECODER 0
+#define CONFIG_ALAC_DECODER 0
+#define CONFIG_PGMYUV_DECODER 0
+#define CONFIG_PPM_DECODER 0
+#define CONFIG_EATGV_DECODER 0
+#define CONFIG_EATQI_DECODER 0
+#define CONFIG_EIGHTSVX_EXP_DECODER 0
+#define CONFIG_EIGHTSVX_FIB_DECODER 0
+#define CONFIG_ESCAPE124_DECODER 0
+#define CONFIG_MIMIC_DECODER 0
+#define CONFIG_MOTIONPIXELS_DECODER 0
+#define CONFIG_PAM_DECODER 0
+#define CONFIG_PBM_DECODER 0
+#define CONFIG_PGM_DECODER 0
+#define CONFIG_RL2_DECODER 0
+#define CONFIG_RV30_DECODER 0
+#define CONFIG_RV40_DECODER 0
+#define CONFIG_V210X_DECODER 0
+#define CONFIG_BFI_DECODER 0
+#define CONFIG_EACMV_DECODER 0
+#define CONFIG_EATGQ_DECODER 0
+#define CONFIG_PCX_DECODER 0
+#define CONFIG_SUNRAST_DECODER 0
+#define CONFIG_VB_DECODER 0
+#define CONFIG_XSUB_DECODER 0
+#define CONFIG_APE_DECODER 0
+#define CONFIG_MPC8_DECODER 0
+#define CONFIG_PCM_S16LE_PLANAR_DECODER 0
+#define CONFIG_PCM_ZORK_DECODER 0
+#define CONFIG_ADPCM_EA_R1_DECODER 0
+#define CONFIG_ADPCM_EA_R2_DECODER 0
+#define CONFIG_ADPCM_EA_R3_DECODER 0
+#define CONFIG_ADPCM_EA_XAS_DECODER 0
+#define CONFIG_ADPCM_IMA_EA_EACS_DECODER 0
+#define CONFIG_ADPCM_IMA_EA_SEAD_DECODER 0
+#define CONFIG_AASC_DECODER 0
+#define CONFIG_AVS_DECODER 0
+#define CONFIG_BETHSOFTVID_DECODER 0
+#define CONFIG_C93_DECODER 0
+#define CONFIG_CAVS_DECODER 0
+#define CONFIG_CLJR_DECODER 0
+#define CONFIG_CSCD_DECODER 0
+#define CONFIG_CYUV_DECODER 0
+#define CONFIG_DSICINVIDEO_DECODER 0
+#define CONFIG_DXA_DECODER 0
+#define CONFIG_EIGHTBPS_DECODER 0
+#define CONFIG_FLIC_DECODER 0
+#define CONFIG_IDCIN_DECODER 0
+#define CONFIG_KMVC_DECODER 0
+#define CONFIG_LOCO_DECODER 0
+#define CONFIG_MDEC_DECODER 0
+#define CONFIG_MMVIDEO_DECODER 0
+#define CONFIG_MPEG_XVMC_DECODER 0
+#define CONFIG_MSRLE_DECODER 0
+#define CONFIG_MSZH_DECODER 0
+#define CONFIG_NUV_DECODER 0
+#define CONFIG_PTX_DECODER 0
+#define CONFIG_QDRAW_DECODER 0
+#define CONFIG_QPEG_DECODER 0
+#define CONFIG_RPZA_DECODER 0
+#define CONFIG_SMACKER_DECODER 0
+#define CONFIG_SMC_DECODER 0
+#define CONFIG_SP5X_DECODER 0
+#define CONFIG_THEORA_DECODER 0
+#define CONFIG_THP_DECODER 0
+#define CONFIG_TIERTEXSEQVIDEO_DECODER 0
+#define CONFIG_TRUEMOTION1_DECODER 0
+#define CONFIG_TRUEMOTION2_DECODER 0
+#define CONFIG_TXD_DECODER 0
+#define CONFIG_ULTI_DECODER 0
+#define CONFIG_VMDVIDEO_DECODER 0
+#define CONFIG_VMNC_DECODER 0
+#define CONFIG_VQA_DECODER 0
+#define CONFIG_WNV1_DECODER 0
+#define CONFIG_XAN_WC3_DECODER 0
+#define CONFIG_XL_DECODER 0
+#define CONFIG_ALAC_DECODER 0
+#define CONFIG_ATRAC3_DECODER 0
+#define CONFIG_COOK_DECODER 0
+#define CONFIG_DSICINAUDIO_DECODER 0
+#define CONFIG_IMC_DECODER 0
+#define CONFIG_LIBA52_DECODER 0
+#define CONFIG_LIBFAAD_DECODER 0
+#define CONFIG_MACE3_DECODER 0
+#define CONFIG_MACE6_DECODER 0
+#define CONFIG_MP3ADU_DECODER 0
+#define CONFIG_MP3ON4_DECODER 0
+#define CONFIG_MPC7_DECODER 0
+#define CONFIG_RA_144_DECODER 0
+#define CONFIG_RA_288_DECODER 0
+#define CONFIG_SHORTEN_DECODER 0
+#define CONFIG_SMACKAUD_DECODER 0
+#define CONFIG_TRUESPEECH_DECODER 0
+#define CONFIG_TTA_DECODER 0
+#define CONFIG_VMDAUDIO_DECODER 0
+#define CONFIG_WAVPACK_DECODER 0
+#define CONFIG_WS_SND1_DECODER 0
+#define CONFIG_INTERPLAY_DPCM_DECODER 0
+#define CONFIG_SOL_DPCM_DECODER 0
+#define CONFIG_XAN_DPCM_DECODER 0
+#define CONFIG_ADPCM_THP_DECODER 0
+#define CONFIG_ASV1_DECODER 0
+#define CONFIG_ASV2_DECODER 0
+#define CONFIG_BMP_DECODER 0
+#define CONFIG_FLASHSV_DECODER 0
+#define CONFIG_GIF_DECODER 0
+#define CONFIG_H261_DECODER 0
+#define CONFIG_H263I_DECODER 0
+#define CONFIG_JPEGLS_DECODER 0
+#define CONFIG_QTRLE_DECODER 0
+#define CONFIG_RAWVIDEO_DECODER 0
+#define CONFIG_ROQ_DECODER 0
+#define CONFIG_SGI_DECODER 0
+#define CONFIG_TARGA_DECODER 0
+#define CONFIG_TIFF_DECODER 0
+#define CONFIG_ZLIB_DECODER 0
+#define CONFIG_ZMBV_DECODER 0
+#define CONFIG_FLAC_DECODER 0
+#define CONFIG_LIBAMR_NB_DECODER 0
+#define CONFIG_LIBAMR_WB_DECODER 0
+#define CONFIG_LIBGSM_DECODER 0
+#define CONFIG_LIBGSM_MS_DECODER 0
+#define CONFIG_SONIC_DECODER 0
+#define CONFIG_VORBIS_DECODER 0
+#define CONFIG_WMAV1_DECODER 0
+#define CONFIG_PCM_ALAW_DECODER 0
+#define CONFIG_PCM_MULAW_DECODER 0
+#define CONFIG_PCM_S8_DECODER 0
+#define CONFIG_PCM_S16BE_DECODER 0
+#define CONFIG_PCM_S16LE_DECODER 0
+#define CONFIG_PCM_S24BE_DECODER 0
+#define CONFIG_PCM_S24DAUD_DECODER 0
+#define CONFIG_PCM_S24LE_DECODER 0
+#define CONFIG_PCM_S32BE_DECODER 0
+#define CONFIG_PCM_S32LE_DECODER 0
+#define CONFIG_PCM_U8_DECODER 0
+#define CONFIG_PCM_U16BE_DECODER 0
+#define CONFIG_PCM_U16LE_DECODER 0
+#define CONFIG_PCM_U24BE_DECODER 0
+#define CONFIG_PCM_U24LE_DECODER 0
+#define CONFIG_PCM_U32BE_DECODER 0
+#define CONFIG_PCM_U32LE_DECODER 0
+#define CONFIG_ROQ_DPCM_DECODER 0
+#define CONFIG_ADPCM_4XM_DECODER 0
+#define CONFIG_ADPCM_ADX_DECODER 0
+#define CONFIG_ADPCM_CT_DECODER 0
+#define CONFIG_ADPCM_EA_DECODER 0
+#define CONFIG_ADPCM_G726_DECODER 0
+#define CONFIG_ADPCM_IMA_DK3_DECODER 0
+#define CONFIG_ADPCM_IMA_DK4_DECODER 0
+#define CONFIG_ADPCM_IMA_QT_DECODER 0
+#define CONFIG_ADPCM_IMA_SMJPEG_DECODER 0
+#define CONFIG_ADPCM_IMA_WAV_DECODER 0
+#define CONFIG_ADPCM_IMA_WS_DECODER 0
+#define CONFIG_ADPCM_MS_DECODER 0
+#define CONFIG_ADPCM_SBPRO_2_DECODER 0
+#define CONFIG_ADPCM_SBPRO_3_DECODER 0
+#define CONFIG_ADPCM_SBPRO_4_DECODER 0
+#define CONFIG_ADPCM_SWF_DECODER 0
+#define CONFIG_ADPCM_XA_DECODER 0
+#define CONFIG_ADPCM_YAMAHA_DECODER 0
+#define CONFIG_DVDSUB_DECODER 0
+#define CONFIG_LIBVORBIS_DECODER 0
+#define CONFIG_VP8_PARSER 1
+#define CONFIG_AAC_PARSER 1
+#define CONFIG_H263_PARSER 1
+#define CONFIG_H264_PARSER 1
+#define CONFIG_MPEG4VIDEO_PARSER 1
+#define CONFIG_AC3_PARSER 0
+#define CONFIG_CAVSVIDEO_PARSER 0
+#define CONFIG_DCA_PARSER 0
+#define CONFIG_DVBSUB_PARSER 0
+#define CONFIG_DVDSUB_PARSER 0
+#define CONFIG_H261_PARSER 0
+#define CONFIG_MJPEG_PARSER 0
+#define CONFIG_MPEGAUDIO_PARSER 0
+#define CONFIG_MPEGVIDEO_PARSER 0
+#define CONFIG_PNM_PARSER 0
+#define CONFIG_VC1_PARSER 0
+#define CONFIG_VP3_PARSER 0
+#define CONFIG_DNXHD_PARSER 0
+#define CONFIG_DIRAC_PARSER 0
+#define CONFIG_AAC_ENCODER 1
+#define CONFIG_MJPEG_ENCODER 1
+#define CONFIG_MSMPEG4V3_ENCODER 1
+#define CONFIG_H263P_ENCODER 1
+#define CONFIG_AC3_ENCODER 1
+#define CONFIG_FFV1_ENCODER 1
+#define CONFIG_FLV1_ENCODER 1
+#define CONFIG_FFVHUFF_ENCODER 1
+#define CONFIG_H263_ENCODER 1
+#define CONFIG_MPEG1VIDEO_ENCODER 1
+#define CONFIG_MPEG2VIDEO_ENCODER 1
+#define CONFIG_MPEG4_ENCODER 1
+#define CONFIG_FLV_ENCODER 1
+#define CONFIG_MP2_ENCODER 1
+#define CONFIG_DVVIDEO_ENCODER 1
+#define CONFIG_HUFFYUV_ENCODER 1
+#define CONFIG_DVBSUB_ENCODER 1
+#define CONFIG_SNOW_ENCODER 1
+#define CONFIG_A64MULTI_ENCODER 0
+#define CONFIG_A64MULTI5_ENCODER 0
+#define CONFIG_ADPCM_G722_ENCODER 0
+#define CONFIG_ASS_ENCODER 0
+#define CONFIG_LIBXAVS_ENCODER 0
+#define CONFIG_LIBVPX_ENCODER 0
+#define CONFIG_RA_144_ENCODER 0
+#define CONFIG_XSUB_ENCODER 0
+#define CONFIG_V210_ENCODER 0
+#define CONFIG_LIBOPENCORE_AMRNB_ENCODER 0
+#define CONFIG_LIBSCHROEDINGER_ENCODER 0
+#define CONFIG_LIBDIRAC_ENCODER 0
+#define CONFIG_PCM_F64LE_ENCODER 0
+#define CONFIG_PCM_F64BE_ENCODER 0
+#define CONFIG_PCM_F32BE_ENCODER 0
+#define CONFIG_PCM_F32LE_ENCODER 0
+#define CONFIG_NELLYMOSER_ENCODER 0
+#define CONFIG_ALAC_ENCODER 0
+#define CONFIG_PCX_ENCODER 0
+#define CONFIG_DNXHD_ENCODER 0
+#define CONFIG_PCM_ZORK_ENCODER 0
+#define CONFIG_ADPCM_IMA_AMV_ENCODER 0
+#define CONFIG_LIBX264_ENCODER 0
+#define CONFIG_LIBXVID_ENCODER 0
+#define CONFIG_LJPEG_ENCODER 0
+#define CONFIG_PAM_ENCODER 0
+#define CONFIG_PBM_ENCODER 0
+#define CONFIG_PGM_ENCODER 0
+#define CONFIG_PGMYUV_ENCODER 0
+#define CONFIG_PPM_ENCODER 0
+#define CONFIG_LIBFAAC_ENCODER 0
+#define CONFIG_LIBMP3LAME_ENCODER 0
+#define CONFIG_LIBTHEORA_ENCODER 0
+#define CONFIG_SONIC_LS_ENCODER 0
+#define CONFIG_ASV1_ENCODER 0
+#define CONFIG_ASV2_ENCODER 0
+#define CONFIG_BMP_ENCODER 0
+#define CONFIG_FLASHSV_ENCODER 0
+#define CONFIG_GIF_ENCODER 0
+#define CONFIG_H261_ENCODER 0
+#define CONFIG_JPEGLS_ENCODER 0
+#define CONFIG_MSMPEG4V1_ENCODER 0
+#define CONFIG_MSMPEG4V2_ENCODER 0
+#define CONFIG_PNG_ENCODER 0
+#define CONFIG_QTRLE_ENCODER 0
+#define CONFIG_RAWVIDEO_ENCODER 0
+#define CONFIG_ROQ_ENCODER 0
+#define CONFIG_RV10_ENCODER 0
+#define CONFIG_RV20_ENCODER 0
+#define CONFIG_SGI_ENCODER 0
+#define CONFIG_SVQ1_ENCODER 0
+#define CONFIG_TARGA_ENCODER 0
+#define CONFIG_TIFF_ENCODER 0
+#define CONFIG_WMV1_ENCODER 0
+#define CONFIG_WMV2_ENCODER 0
+#define CONFIG_ZLIB_ENCODER 0
+#define CONFIG_ZMBV_ENCODER 0
+#define CONFIG_FLAC_ENCODER 0
+#define CONFIG_LIBAMR_NB_ENCODER 0
+#define CONFIG_LIBAMR_WB_ENCODER 0
+#define CONFIG_LIBGSM_ENCODER 0
+#define CONFIG_LIBGSM_MS_ENCODER 0
+#define CONFIG_SONIC_ENCODER 0
+#define CONFIG_VORBIS_ENCODER 0
+#define CONFIG_WMAV1_ENCODER 0
+#define CONFIG_WMAV2_ENCODER 0
+#define CONFIG_PCM_ALAW_ENCODER 0
+#define CONFIG_PCM_MULAW_ENCODER 0
+#define CONFIG_PCM_S8_ENCODER 0
+#define CONFIG_PCM_S16BE_ENCODER 0
+#define CONFIG_PCM_S16LE_ENCODER 0
+#define CONFIG_PCM_S24BE_ENCODER 0
+#define CONFIG_PCM_S24DAUD_ENCODER 0
+#define CONFIG_PCM_S24LE_ENCODER 0
+#define CONFIG_PCM_S32BE_ENCODER 0
+#define CONFIG_PCM_S32LE_ENCODER 0
+#define CONFIG_PCM_U8_ENCODER 0
+#define CONFIG_PCM_U16BE_ENCODER 0
+#define CONFIG_PCM_U16LE_ENCODER 0
+#define CONFIG_PCM_U24BE_ENCODER 0
+#define CONFIG_PCM_U24LE_ENCODER 0
+#define CONFIG_PCM_U32BE_ENCODER 0
+#define CONFIG_PCM_U32LE_ENCODER 0
+#define CONFIG_ROQ_DPCM_ENCODER 0
+#define CONFIG_ADPCM_4XM_ENCODER 0
+#define CONFIG_ADPCM_ADX_ENCODER 0
+#define CONFIG_ADPCM_CT_ENCODER 0
+#define CONFIG_ADPCM_EA_ENCODER 0
+#define CONFIG_ADPCM_G726_ENCODER 0
+#define CONFIG_ADPCM_IMA_DK3_ENCODER 0
+#define CONFIG_ADPCM_IMA_DK4_ENCODER 0
+#define CONFIG_ADPCM_IMA_QT_ENCODER 0
+#define CONFIG_ADPCM_IMA_SMJPEG_ENCODER 0
+#define CONFIG_ADPCM_IMA_WAV_ENCODER 0
+#define CONFIG_ADPCM_IMA_WS_ENCODER 0
+#define CONFIG_ADPCM_MS_ENCODER 0
+#define CONFIG_ADPCM_SBPRO_2_ENCODER 0
+#define CONFIG_ADPCM_SBPRO_3_ENCODER 0
+#define CONFIG_ADPCM_SBPRO_4_ENCODER 0
+#define CONFIG_ADPCM_SWF_ENCODER 0
+#define CONFIG_ADPCM_XA_ENCODER 0
+#define CONFIG_ADPCM_YAMAHA_ENCODER 0
+#define CONFIG_DVDSUB_ENCODER 0
+#define CONFIG_LIBVORBIS_ENCODER 0
+#define CONFIG_MJPEG2JPEG_BSF 0
+#define CONFIG_CHOMP_BSF 0
+#define CONFIG_AAC_ADTSTOASC_BSF 0
+#define CONFIG_MP3_HEADER_COMPRESS_BSF 0
+#define CONFIG_IMX_DUMP_HEADER_BSF 0
+#define CONFIG_DUMP_EXTRADATA_BSF 0
+#define CONFIG_REMOVE_EXTRADATA_BSF 0
+#define CONFIG_NOISE_BSF 0
+#define CONFIG_MP3_HEADER_DECOMPRESS_BSF 0
+#define CONFIG_MJPEGA_DUMP_HEADER_BSF 0
+#define CONFIG_H264_MP4TOANNEXB_BSF 0
+#define CONFIG_MOV2TEXTSUB_BSF 0
+#define CONFIG_TEXT2MOVSUB_BSF 0
+#define CONFIG_MUXERS 1
+#define CONFIG_MATROSKA_MUXER 1
+#define CONFIG_WEBM_MUXER 1
+#define CONFIG_MOV_MUXER 1
+#define CONFIG_IPOD_MUXER 1
+#define CONFIG_MP4_MUXER 1
+#define CONFIG_PSP_MUXER 1
+#define CONFIG_TG2_MUXER 1
+#define CONFIG_TGP_MUXER 1
+#define CONFIG_MPEG1VCD_MUXER 1
+#define CONFIG_MPEG2SVCD_MUXER 1
+#define CONFIG_MPEG2DVD_MUXER 1
+#define CONFIG_MPEG2VOB_MUXER 1
+#define CONFIG_W64_DEMUXER 0
+#define CONFIG_ENCODERS 1
+#define CONFIG_DVVIDEO_ENCODER 1
+#define CONFIG_SNOW_ENCODER 1
+#define CONFIG_DECODERS 1
+#define CONFIG_DVVIDEO_DECODER 1
+#define CONFIG_H263_DECODER 1
+#define CONFIG_MPEG4_DECODER 1
+#define CONFIG_SNOW_DECODER 1
+#define CONFIG_VC1_DECODER 1
+#define CONFIG_WMV2_DECODER 1
+#define CONFIG_WMV3_DECODER 1
+#define CONFIG_SWSCALE_ALPHA 0
+#define CONFIG_MPEGAUDIO_HP 1
+#define CONFIG_ZLIB 1
+#define CONFIG_GPL 1
+#define CONFIG_ARMV4L 0
+#define CONFIG_MLIB 0
+#define CONFIG_SPARC 0
+#define CONFIG_ALPHA 0
+#define CONFIG_MMI 0
+#define CONFIG_SH4 0
+#define CONFIG_BFIN 0
+#define CONFIG_SMALL 0
+#define CONFIG_FLAC_PARSER 0
+#define CONFIG_AAC_LATM_PARSER 0
+#define CONFIG_MLP_PARSER 0
+//****************** SYSTEM *******************
+#	define ARCH_ARM 0
+#	define ARCH_ALPHA 0
+#	define ARCH_PPC 0
+#	define ARCH_SH4 0
+#	define ARCH_BFIN 0
+#	define HAVE_MMI 0
+#	define HAVE_VIS 0
+#	define CONFIG_GRAY 0
+#	define HAVE_TRUNCF 1
+#ifdef __APPLE__
+#	define CONFIG_DARWIN 1
+#endif
+#if defined(ADM_CPU_X86_32)
+#	define ARCH_X86 1
+#	define ARCH_X86_32 1
+#	define ARCH_X86_64 0
+#	define HAVE_ALTIVEC 0
+#elif defined(ADM_CPU_X86_64)
+#	define ARCH_X86 1
+#	define ARCH_X86_64 1
+#	define HAVE_ALTIVEC 0
+#elif defined(ADM_CPU_PPC)
+#	define ARCH_POWERPC 1
+#ifdef ADM_CPU_ALTIVEC
+#	define HAVE_ALTIVEC 1
+#ifndef __APPLE__
+#	define HAVE_ALTIVEC_H 1
+#endif	// __APPLE__
+#endif	// ADM_CPU_ALTIVEC
+#ifdef ADM_CPU_DCBZL
+#	define HAVE_DCBZL 1
+#endif	// ADM_CPU_DCBZL
+#endif	// ADM_CPU_X86_32
+#ifndef ADM_MINIMAL_INCLUDE
+#if defined(ADM_CPU_X86_32) && defined(ADM_CPU_MMX2)
+//#	define HAVE_MMX2 1
+#endif
+#ifdef ADM_CPU_SSSE3
+#	define HAVE_SSSE3 1
+#endif
+#endif //ADM_MINIMAL_INCLUDE
+#ifdef ARCH_POWERPC
+#	define ENABLE_POWERPC 1
+#else
+#	define ENABLE_POWERPC 0
+#endif
+#ifdef ARCH_X86
+#	define ENABLE_BSWAP 1
+#ifndef ADM_MINIMAL_INCLUDE
+#	define HAVE_MMX 1
+#	define HAVE_MMX2 1
+#	define HAVE_SSE 1
+#	define HAVE_AMD3DNOW 1
+#	define HAVE_AMD3DNOWEXT 1
+#	define ENABLE_MMX 1
+#endif //ADM_MINIMAL_INCLUDE
+#	define HAVE_FAST_UNALIGNED 1
+#	define HAVE_EBP_AVAILABLE 1
+#	define HAVE_EBX_AVAILABLE 1
+#else
+#	define ENABLE_MMX 0
+#	define HAVE_SSE 0
+#	define HAVE_AMD3DNOW 0
+#	define HAVE_AMD3DNOWEXT 0
+#endif
+#ifdef ARCH_X86_64
+#	define HAVE_FAST_64BIT 1
+#endif
+#ifdef ADM_BIG_ENDIAN
+#	define WORDS_BIGENDIAN 1
+#endif
+#ifdef USE_YASM
+#define ENABLE_YASM      1
+#define HAVE_YASM        1
+#else // USE_YASM
+#define ENABLE_YASM      0
+#define HAVE_YASM        0
+#endif // USE_YASM
+#define CONFIG_FILE_PROTOCOL  1
+#define CONFIG_MDCT     1
+#define CONFIG_DCT      1
+#define CONFIG_LPC      1
+#define CONFIG_H264DSP  1
+#define ENABLE_ARM      0
+#define ENABLE_PPC      0
+#define ENABLE_THREADS 1
+#define ENABLE_ENCODERS 1
+#define CONFIG_MUXERS 1
+#define CONFIG_DEMUXERS 1
+#define ENABLE_VIS 0
+#define ENABLE_GRAY 0
+#define HAVE_LRINTF 1
+#define HAVE_LLRINT 1
+#define HAVE_LRINT 1
+#define HAVE_LOG2 1
+#define HAVE_ROUND 1
+#define HAVE_ROUNDF 1
+#define HAVE_THREADS 1
+#define RUNTIME_CPUDETECT 1
+#define CONFIG_RUNTIME_CPUDETECT 1
+#if defined( __MINGW32__) || defined(__APPLE__)
+#define EXTERN_PREFIX "_"
+#else // __MINGW32__
+#define EXTERN_PREFIX
+#endif // __MINGW32__
+#define restrict __restrict__

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/ffconf.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/ffconf.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/ffconf.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -53,6 +53,12 @@
 
 #define DECLARE_DECODER(a,b); printf("#define CONFIG_"#a"_DECODER 1\n");
   
+    DECLARE_DECODER (R10K, svq1);
+    DECLARE_DECODER (AAC_LATM, svq1);
+    DECLARE_DECODER (PCM_LXF, svq1);
+    DECLARE_DECODER (ADPCM_G722, svq1);
+    DECLARE_DECODER (ASS, svq1);
+
     DECLARE_DECODER (SVQ1, svq1);
     DECLARE_DECODER(AAC, eatgq);
     DECLARE_DECODER(MPEG4AAC, mpeg4aac);
@@ -390,6 +396,12 @@
 
 #undef DECLARE_ENCODER
 #define DECLARE_ENCODER(a,b); printf("#define CONFIG_"#a"_ENCODER 0\n"); 
+    DECLARE_ENCODER(A64MULTI, amv);
+    DECLARE_ENCODER(A64MULTI5, amv);
+    DECLARE_ENCODER(ADPCM_G722, amv);
+    DECLARE_ENCODER(ASS, amv);
+    DECLARE_ENCODER(LIBXAVS, amv);
+
     DECLARE_ENCODER(LIBVPX, amv);
     DECLARE_ENCODER(RA_144, amv);
     DECLARE_ENCODER(XSUB, amv);
@@ -495,6 +507,7 @@
 
 #define DECLARE_BSF(a,b); printf("#define CONFIG_"#a"_BSF 0\n");
 
+	DECLARE_BSF(MJPEG2JPEG, mp3_header_compress);
 	DECLARE_BSF(CHOMP, mp3_header_compress);
 	DECLARE_BSF(AAC_ADTSTOASC, mp3_header_compress);
 	DECLARE_BSF(MP3_HEADER_COMPRESS, mp3_header_compress);
@@ -558,6 +571,8 @@
 	ENABLE(BFIN, bfin);
 	ENABLE(SMALL, small);
 #define DECLARE_ENABLE_PARSER(a,b); printf("#define CONFIG_"#a"_PARSER 0\n");
+	DECLARE_ENABLE_PARSER(FLAC, wmv3);
+	DECLARE_ENABLE_PARSER(AAC_LATM, wmv3);
 	DECLARE_ENABLE_PARSER(MLP, wmv3);
         printf("//****************** SYSTEM *******************\n");
 	printf("#	define ARCH_ARM 0\n");

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/CMakeLists.txt	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/CMakeLists.txt	2010-12-10 08:06:40 UTC (rev 6830)
@@ -38,6 +38,7 @@
         synth_filter.c    mpeg4videodec.c h264_cabac.c h264_cavlc.c vp56dsp.c h264_loopfilter.c
         h264_sei.c h264_ps.c svq3.c h264dsp.c flvdec.c pngdec.c png.c
         aacps.c  aacpsy.c aacadtsdec.c lpc.c vp8_parser.c vp8.c vp8dsp.c inverse.c dct.c aacdec.c
+	vp56rac.c r210dec.c assdec.c g722.c ass.c
         )
 
 if(USE_VDPAU)
@@ -46,28 +47,18 @@
 
 IF(ADM_CPU_X86)
 	SET(${ADM_LIB}_SRCS  ${${ADM_LIB}_SRCS}
-		  x86/mpegvideo_mmx.c   x86/dsputil_mmx.c
-		x86/fdct_mmx.c  x86/motion_est_mmx.c  x86/simple_idct_mmx.c  
-		x86/idct_mmx_xvid.c    x86/snowdsp_mmx.c
-                x86/idct_sse2_xvid.c 
-                x86/vp8dsp-init.c
-                x86/mpegaudiodec_mmx.c
-                x86/lpc_mmx.c
-                x86/fft.c
-                x86/dct32_sse.c
-                #x86/fft_sse.c
-                #x86/fft_3dn2.c
-		#x86/fft_3dn.c  
-                x86/dsputilenc_mmx.c  x86/vc1dsp_mmx.c  x86/idct_mmx.c)
+		x86/cavsdsp_mmx.c               x86/dsputil_mmx.c                  x86/mlpdsp.c                  x86/simple_idct_mmx.c
+		x86/dct32_sse.c                 x86/fft.c                  x86/idct_mmx.c        x86/motion_est_mmx.c          x86/snowdsp_mmx.c
+		x86/dnxhd_mmx.c                 x86/idct_mmx_xvid.c   x86/mpegaudiodec_mmx.c        x86/vc1dsp_mmx.c
+		x86/dsputilenc_mmx.c            x86/fdct_mmx.c                  x86/h264dsp_mmx.c          x86/idct_sse2_xvid.c  x86/mpegvideo_mmx.c           x86/vp56dsp_init.c
+		x86/h264_intrapred_init.c  x86/lpc_mmx.c           x86/vp8dsp-init.c
+		)
         IF(USE_YASM)
                 SET(YASM_SOURCE         
-                                x86/h264_intrapred.asm
-                                x86/vp8dsp.asm
-                                x86/vc1dsp_yasm.asm
-                                x86/dsputil_yasm.asm
-                                x86/fft_mmx.asm
-                                x86/h264_deblock_sse2.asm
-                                x86/h264_idct_sse2.asm)
+				x86/deinterlace.asm      x86/dsputil_yasm.asm  x86/h264_chromamc.asm  x86/h264_idct.asm       
+				x86/h264_weight.asm  x86/vp3dsp.asm   x86/vp8dsp.asm  x86/x86util.asm
+				x86/dsputilenc_yasm.asm  x86/fft_mmx.asm       x86/h264_deblock.asm   x86/h264_intrapred.asm  
+				x86/vc1dsp_yasm.asm  x86/vp56dsp.asm  x86/x86inc.asm)
                 SET(YASM_DEP x86/fft_3dn2.c  x86/fft_3dn.c   x86/fft_sse.c)
                  FOREACH(yasm_files ${YASM_SOURCE})
                         SET(tgt1 ${CMAKE_CURRENT_BINARY_DIR}/${yasm_files}.o)
@@ -101,6 +92,6 @@
 IF(USE_YASM)
   ADD_DEPENDENCIES(${ADM_LIB} ${YASM_OBJ})
 ENDIF(USE_YASM)
-TARGET_LINK_LIBRARIES(${ADM_LIB} ADM_core6 ADM_libavutil6 ${ZLIB_LIBRARY})
+TARGET_LINK_LIBRARIES(${ADM_LIB} ADM_core6 ADM_libavcore6 ADM_libavutil6 ${ZLIB_LIBRARY})
 
 ADM_INSTALL_LIB(${ADM_LIB} )

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/avcodec.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/avcodec.h	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/avcodec.h	2010-12-10 08:06:40 UTC (rev 6830)
@@ -669,6 +669,8 @@
 #define CODEC_FLAG2_PSY           0x00080000 ///< Use psycho visual optimizations.
 #define CODEC_FLAG2_SSIM          0x00100000 ///< Compute SSIM during encoding, error[] values are undefined.
 #define CODEC_FLAG2_INTRA_REFRESH 0x00200000 ///< Use periodic insertion of intra blocks instead of keyframes.
+//MEANX: NEVER EVER USE CLOSED GOP ?
+#define CODEC_FLAG2_32_PULLDOWN   0x80000000 
 
 /* Unsupported options :
  *              Syntax Arithmetic coding (SAC)
@@ -1563,6 +1565,7 @@
      * - decoding: unused
      */
     int rc_max_rate;
+    int rc_max_rate_header; /*< That one is set in the header MEANX */
 
     /**
      * minimum bitrate
@@ -1577,6 +1580,8 @@
      * - decoding: unused
      */
     int rc_buffer_size;
+    int rc_buffer_size_header;  /*< That one is set in the header MEANX*/
+
     float rc_buffer_aggressivity;
 
     /**

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/dsputil.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/dsputil.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/dsputil.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -39,7 +39,7 @@
 #include "lpc.h"
 #include "ac3dec.h"
 #include "vorbis.h"
-#include "png.h"
+#include "ffpng.h"
 #include "vp8dsp.h"
 
 uint8_t ff_cropTbl[256 + 2 * MAX_NEG_CROP] = {0, };

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/ff_spsinfo.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/ff_spsinfo.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/ff_spsinfo.h	2010-12-10 08:06:40 UTC (rev 6830)
@@ -0,0 +1,17 @@
+#ifndef FF_SPS_INFO_H
+#define FF_SPS_INFO_H
+
+typedef struct
+{
+	int width;
+	int height;
+	int fps1000;
+	int darNum;
+	int darDen;
+	int hasStructInfo;
+	int CpbDpbToSkip;
+}ffSpsInfo;
+
+
+#endif
+

Copied: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/ffpng.h (from rev 6829, branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/png.h)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/ffpng.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/ffpng.h	2010-12-10 08:06:40 UTC (rev 6830)
@@ -0,0 +1,78 @@
+/*
+ * PNG image format
+ * Copyright (c) 2003 Fabrice Bellard
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
+#ifndef AVCODEC_PNG_H
+#define AVCODEC_PNG_H
+
+#include <stdint.h>
+
+#define PNG_COLOR_MASK_PALETTE    1
+#define PNG_COLOR_MASK_COLOR      2
+#define PNG_COLOR_MASK_ALPHA      4
+
+#define PNG_COLOR_TYPE_GRAY 0
+#define PNG_COLOR_TYPE_PALETTE  (PNG_COLOR_MASK_COLOR | PNG_COLOR_MASK_PALETTE)
+#define PNG_COLOR_TYPE_RGB        (PNG_COLOR_MASK_COLOR)
+#define PNG_COLOR_TYPE_RGB_ALPHA  (PNG_COLOR_MASK_COLOR | PNG_COLOR_MASK_ALPHA)
+#define PNG_COLOR_TYPE_GRAY_ALPHA (PNG_COLOR_MASK_ALPHA)
+
+#define PNG_FILTER_TYPE_LOCO   64
+#define PNG_FILTER_VALUE_NONE  0
+#define PNG_FILTER_VALUE_SUB   1
+#define PNG_FILTER_VALUE_UP    2
+#define PNG_FILTER_VALUE_AVG   3
+#define PNG_FILTER_VALUE_PAETH 4
+#define PNG_FILTER_VALUE_MIXED 5
+
+#define PNG_IHDR      0x0001
+#define PNG_IDAT      0x0002
+#define PNG_ALLIMAGE  0x0004
+#define PNG_PLTE      0x0008
+
+#define NB_PASSES 7
+
+extern const uint8_t ff_pngsig[8];
+extern const uint8_t ff_mngsig[8];
+
+/* Mask to determine which y pixels are valid in a pass */
+extern const uint8_t ff_png_pass_ymask[NB_PASSES];
+
+/* minimum x value */
+extern const uint8_t ff_png_pass_xmin[NB_PASSES];
+
+/* x shift to get row width */
+extern const uint8_t ff_png_pass_xshift[NB_PASSES];
+
+/* Mask to determine which pixels are valid in a pass */
+extern const uint8_t ff_png_pass_mask[NB_PASSES];
+
+void *ff_png_zalloc(void *opaque, unsigned int items, unsigned int size);
+
+void ff_png_zfree(void *opaque, void *ptr);
+
+int ff_png_get_nb_channels(int color_type);
+
+/* compute the row size of an interleaved pass */
+int ff_png_pass_row_size(int pass, int bits_per_pixel, int width);
+
+void ff_add_png_paeth_prediction(uint8_t *dst, uint8_t *src, uint8_t *top, int w, int bpp);
+
+#endif /* AVCODEC_PNG_H */

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/fft.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/fft.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/fft.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -105,7 +105,7 @@
 
     if (ARCH_ARM)     ff_fft_init_arm(s);
     if (HAVE_ALTIVEC) ff_fft_init_altivec(s);
-    if (HAVE_MMX)     ff_fft_init_mmx(s);
+    // MEANX if (HAVE_MMX)     ff_fft_init_mmx(s);
 
     for(j=4; j<=nbits; j++) {
         ff_init_ff_cos_tabs(j);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/h263dec.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/h263dec.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/h263dec.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -120,7 +120,24 @@
 
     return 0;
 }
+/* MeanX : Ugly patch to detect vo ppacked stuff ... */
+int av_is_voppacked(AVCodecContext *avctx, int *vop_packed, int *gmc, int *qpel)
+{
+    MpegEncContext *s = avctx->priv_data;
+    // set sane default
+    *vop_packed=0;
+    *gmc=0;
+    *qpel=0;
+    if(avctx->codec->id!=CODEC_ID_MPEG4) return 0;
+    	
+  	*vop_packed=(s->divx_packed);
+	*qpel=s->quarter_sample;
+	*gmc=0;	// FIXME
+	return 1;
 
+  }
+  /* MeanX */
+
 av_cold int ff_h263_decode_end(AVCodecContext *avctx)
 {
     MpegEncContext *s = avctx->priv_data;
@@ -422,6 +439,12 @@
     } else {
         ret = h263_decode_picture_header(s);
     }
+	//MEANX we need to do it here also for quicktime file / ctts atom 
+        // we need the correct frame type, and qt file may contain 
+        // vop not coded frame.
+        pict->pict_type=s->current_picture.pict_type= s->pict_type;
+        pict->key_frame=s->current_picture.key_frame= s->pict_type == FF_I_TYPE;
+        //MEANX
 
     if(ret==FRAME_SKIPPED) return get_consumed_bytes(s, buf_size);
 
@@ -717,6 +740,14 @@
 
 assert(s->current_picture.pict_type == s->current_picture_ptr->pict_type);
 assert(s->current_picture.pict_type == s->pict_type);
+/* MEANX */
+  if(s->current_picture_ptr)
+      s->current_picture_ptr->opaque=pict->opaque;
+/* MEANX */
+
+
+
+
     if (s->pict_type == FF_B_TYPE || s->low_delay) {
         *pict= *(AVFrame*)s->current_picture_ptr;
     } else if (s->last_picture_ptr != NULL) {

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/h264_parser.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/h264_parser.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/h264_parser.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -29,10 +29,51 @@
 #include "h264_parser.h"
 #include "h264data.h"
 #include "golomb.h"
-
+#include "ff_spsinfo.h" // MEANX
 #include <assert.h>
+ // MEANX
+/**
+    \fn AVCodecParserContext
+*/
+int ff_h264_info(AVCodecParserContext *parser,ffSpsInfo *info)
+{
+    H264Context *ctx = parser->priv_data;
+    memset(info,0,sizeof(*info));
+    if(!ctx->sps.mb_width || !ctx->sps.mb_height)
+    {
+        return 0;
+    }
+    info->width=ctx->sps.mb_width  * 16;
+    info->height=(2-ctx->sps.frame_mbs_only_flag)*ctx->sps.mb_height * 16;
+    if(ctx->sps.timing_info_present_flag)
+    {
+            float scale=ctx->sps.time_scale ;
+            float ticks=ctx->sps.num_units_in_tick;
+            info->fps1000 =  (uint32_t) ((scale/ticks) *    1000.);
+#undef printf
+            printf("Scale : %d, tick=%d, fps=%d\n",(int)scale,(int)ticks,(int)info->fps1000);
+    }else
+    {
+            printf("[H264] No timing information\n");
+            info->fps1000=25000;
+    }
+    // D.2.2 SEI Timing present if CpbDbpDelayPresentFlag=1 or pictStructPresent=1
+    // CpbDbpDelayPresentFlag =1 if nal_hdr or vcl_hrd or ???
+    int f=ctx->sps.nal_hrd_parameters_present_flag | ctx->sps.vcl_hrd_parameters_present_flag;
+    info->hasStructInfo=f | ctx->sps.pic_struct_present_flag;;
+    // While decoding SEI, if CpbDpbDelaysPresentFlags is there we skip cpb_removal_delay + dpb_output_delay
 
-
+    info->CpbDpbToSkip=0;
+    if(f)
+    {
+        info->CpbDpbToSkip=ctx->sps.cpb_removal_delay_length+ctx->sps.dpb_output_delay_length;
+    }
+#warning fixme sar vs dar
+    info->darNum=ctx->sps.sar.num;
+    info->darDen=ctx->sps.sar.den;
+    return 1;
+}
+// /MEANX
 int ff_h264_find_frame_end(H264Context *h, const uint8_t *buf, int buf_size)
 {
     int i;

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/h264dsp.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/h264dsp.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/h264dsp.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -316,5 +316,7 @@
 
     if (ARCH_ARM) ff_h264dsp_init_arm(c);
     if (HAVE_ALTIVEC) ff_h264dsp_init_ppc(c);
+#if CONFIG_H264DSP //MEANX
     if (HAVE_MMX) ff_h264dsp_init_x86(c);
+#endif
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/mpeg12.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/mpeg12.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/mpeg12.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1948,7 +1948,12 @@
         ff_er_frame_end(s);
 
         MPV_frame_end(s);
+/* MEANX */
+  if(s->current_picture_ptr)
+      s->current_picture_ptr->opaque=pict->opaque;
+/* MEANX */
 
+
         if (s->pict_type == FF_B_TYPE || s->low_delay) {
             *pict= *(AVFrame*)s->current_picture_ptr;
             ff_print_debug_info(s, pict);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/mpeg12enc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/mpeg12enc.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/mpeg12enc.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -127,10 +127,19 @@
             s->frame_rate_index= i;
         }
     }
+ /* MEANX 
+
     if(dmin)
         return -1;
     else
         return 0;
+  */
+        if(dmin>4)
+   {
+        av_log(0,AV_LOG_ERROR,"We did a roundup ! Expect async!\n");
+   }
+        return 0; //MEANX
+
 }
 
 static av_cold int encode_init(AVCodecContext *avctx)
@@ -209,6 +218,7 @@
             put_sbits(&s->pb, 12, s->width );
             put_sbits(&s->pb, 12, s->height);
 
+#if 0 //MEANX
             for(i=1; i<15; i++){
                 float error= aspect_ratio;
                 if(s->codec_id == CODEC_ID_MPEG1VIDEO || i <=1)
@@ -223,20 +233,44 @@
                     s->aspect_ratio_info= i;
                 }
             }
+#endif // MEANX
+            //MEANX put_bits(&s->pb, 4, s->aspect_ratio_info);
+            //MEANX put_bits(&s->pb, 4, s->frame_rate_index);
+ // MEANX 4:3
+  if(s->avctx->sample_aspect_ratio.num==16 && s->avctx->sample_aspect_ratio.den==9)
+            {
+                //printf("FFmpeg : Wide\n");
+                put_bits(&s->pb,4,3); //16:9
+            }
+            else        //4:3
+            {
+              if(s->codec_id == CODEC_ID_MPEG2VIDEO)
+                put_bits(&s->pb, 4, 2);
+              else
+                put_bits(&s->pb, 4, 12); // MPEG1
+            }
+// /MEANX
 
-            put_bits(&s->pb, 4, s->aspect_ratio_info);
-            put_bits(&s->pb, 4, s->frame_rate_index);
+// //MEANX PULLDOWN            put_bits(&s->pb, 4, s->frame_rate_index);
+if((s->flags2 & CODEC_FLAG2_32_PULLDOWN) && (s->codec_id == CODEC_ID_MPEG2VIDEO))
+            {           
+                put_bits(&s->pb, 4,4);
+            }
+            else
+            {                                  
+                put_bits(&s->pb, 4, s->frame_rate_index);
+            } //MEANX pulldown
 
-            if(s->avctx->rc_max_rate){
-                v = (s->avctx->rc_max_rate + 399) / 400;
+            if(s->avctx->rc_max_rate_header){ //MEANX we use header
+                v = (s->avctx->rc_max_rate_header + 399) / 400;
                 if (v > 0x3ffff && s->codec_id == CODEC_ID_MPEG1VIDEO)
                     v = 0x3ffff;
             }else{
                 v= 0x3FFFF;
             }
 
-            if(s->avctx->rc_buffer_size)
-                vbv_buffer_size = s->avctx->rc_buffer_size;
+            if(s->avctx->rc_buffer_size_header) // MEANX we use header
+                vbv_buffer_size = s->avctx->rc_buffer_size_header;
             else
                 /* VBV calculation: Scaled so that a VCD has the proper VBV size of 40 kilobytes */
                 vbv_buffer_size = (( 20 * s->bit_rate) / (1151929 / 2)) * 8 * 1024;
@@ -269,8 +303,17 @@
 
                 put_bits(&s->pb, 3, s->avctx->profile); //profile
                 put_bits(&s->pb, 4, s->avctx->level); //level
+   // MEANX pulldown put_bits(&s->pb, 1, s->progressive_sequence);
+  // MEANX Pulldown
+ if(s->flags2 & CODEC_FLAG2_32_PULLDOWN) //MEANX
+                        put_bits(&s->pb, 1, 0);
+                else
+                        put_bits(&s->pb, 1, s->progressive_sequence);
 
-                put_bits(&s->pb, 1, s->progressive_sequence);
+
+// /MEANX
+
+
                 put_bits(&s->pb, 2, s->chroma_format);
                 put_bits(&s->pb, 2, s->width >>12);
                 put_bits(&s->pb, 2, s->height>>12);
@@ -339,6 +382,8 @@
 
 void mpeg1_encode_picture_header(MpegEncContext *s, int picture_number)
 {
+	int tff,rff; //MEANX
+
     mpeg1_encode_sequence_header(s);
 
     /* mpeg1 picture header */
@@ -375,6 +420,49 @@
 
     s->frame_pred_frame_dct = 1;
     if(s->codec_id == CODEC_ID_MPEG2VIDEO){
+ /* MEANX -- Pulldown */
+        if(s->flags2 & CODEC_FLAG2_32_PULLDOWN)
+        {
+        
+                switch((s->picture_number - 
+                          s->gop_picture_number)&3)
+                {
+                        case 0:
+                        default:
+                                rff=1;
+                                tff=1;
+                                break;
+                        case 1:
+                                rff=0;
+                                tff=0;
+                                break;
+                        case 2:
+                                rff=1;
+                                tff=0;
+                                break;
+                        case 3:
+                                rff=0;
+                                tff=1;
+                                break;
+                }               
+           }
+        else
+        {
+                if (s->progressive_sequence) 
+                {
+                        tff=0; /* no repeat */
+                } else 
+                {
+                        tff= s->current_picture_ptr->top_field_first;
+                }
+                rff=s->repeat_first_field;
+        
+        }
+
+//               /MEANX pulldown
+
+
+
         put_header(s, EXT_START_CODE);
         put_bits(&s->pb, 4, 8); //pic ext
         if (s->pict_type == FF_P_TYPE || s->pict_type == FF_B_TYPE) {
@@ -393,11 +481,16 @@
 
         assert(s->picture_structure == PICT_FRAME);
         put_bits(&s->pb, 2, s->picture_structure);
+#if 0 //MEANX
+
         if (s->progressive_sequence) {
             put_bits(&s->pb, 1, 0); /* no repeat */
         } else {
             put_bits(&s->pb, 1, s->current_picture_ptr->top_field_first);
         }
+#endif
+         put_bits(&s->pb, 1, tff);  //MEANX PULLDOWN
+
         /* XXX: optimize the generation of this flag with entropy
            measures */
         s->frame_pred_frame_dct = s->progressive_sequence;
@@ -407,7 +500,10 @@
         put_bits(&s->pb, 1, s->q_scale_type);
         put_bits(&s->pb, 1, s->intra_vlc_format);
         put_bits(&s->pb, 1, s->alternate_scan);
-        put_bits(&s->pb, 1, s->repeat_first_field);
+ // MEANX put_bits(&s->pb, 1, s->repeat_first_field);
+	put_bits(&s->pb, 1, rff);
+      // /MEANX
+
         s->progressive_frame = s->progressive_sequence;
         put_bits(&s->pb, 1, s->chroma_format == CHROMA_420 ? s->progressive_frame : 0); /* chroma_420_type */
         put_bits(&s->pb, 1, s->progressive_frame);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/mpegvideo.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/mpegvideo.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/mpegvideo.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -653,7 +653,11 @@
     FF_ALLOCZ_OR_GOTO(s->avctx, s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE, fail);
 
     s->parse_context.state= -1;
-    if((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
+ //MEANX: Allocate them always, as they may be free when we decode 1st image
+
+    // MEANXif((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
+if(1){ // MEANX
+
        s->visualization_buffer[0] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
        s->visualization_buffer[1] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
        s->visualization_buffer[2] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/mpegvideo_enc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/mpegvideo_enc.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/mpegvideo_enc.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -367,12 +367,14 @@
 
         av_log(avctx, AV_LOG_INFO, "Warning vbv_delay will be set to 0xFFFF (=VBR) as the specified vbv buffer is too large for the given bitrate!\n");
     }
+#if 0 //MEANX
 
     if((s->flags & CODEC_FLAG_4MV) && s->codec_id != CODEC_ID_MPEG4
        && s->codec_id != CODEC_ID_H263 && s->codec_id != CODEC_ID_H263P && s->codec_id != CODEC_ID_FLV1){
         av_log(avctx, AV_LOG_ERROR, "4MV not supported by codec\n");
         return -1;
     }
+#endif
 
     if(s->obmc && s->avctx->mb_decision != FF_MB_DECISION_SIMPLE){
         av_log(avctx, AV_LOG_ERROR, "OBMC is only supported with simple mb decision\n");
@@ -413,10 +415,12 @@
         return -1;
     }
 
+#if 0 //MEANX
     if(s->mpeg_quant && s->codec_id != CODEC_ID_MPEG4){ //FIXME mpeg2 uses that too
         av_log(avctx, AV_LOG_ERROR, "mpeg2 style quantization not supported by codec\n");
         return -1;
     }
+#endif
 
     if((s->flags & CODEC_FLAG_CBP_RD) && !avctx->trellis){
         av_log(avctx, AV_LOG_ERROR, "CBP RD needs trellis quant\n");

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/png.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/png.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/png.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -20,7 +20,7 @@
  */
 #include "avcodec.h"
 #include "bytestream.h"
-#include "png.h"
+#include "ffpng.h"
 
 const uint8_t ff_pngsig[8] = {137, 80, 78, 71, 13, 10, 26, 10};
 const uint8_t ff_mngsig[8] = {138, 77, 78, 71, 13, 10, 26, 10};

Deleted: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/png.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/png.h	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/png.h	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,78 +0,0 @@
-/*
- * PNG image format
- * Copyright (c) 2003 Fabrice Bellard
- *
- * This file is part of FFmpeg.
- *
- * FFmpeg is free software; you can redistribute it and/or
- * modify it under the terms of the GNU Lesser General Public
- * License as published by the Free Software Foundation; either
- * version 2.1 of the License, or (at your option) any later version.
- *
- * FFmpeg is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- * Lesser General Public License for more details.
- *
- * You should have received a copy of the GNU Lesser General Public
- * License along with FFmpeg; if not, write to the Free Software
- * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
- */
-
-#ifndef AVCODEC_PNG_H
-#define AVCODEC_PNG_H
-
-#include <stdint.h>
-
-#define PNG_COLOR_MASK_PALETTE    1
-#define PNG_COLOR_MASK_COLOR      2
-#define PNG_COLOR_MASK_ALPHA      4
-
-#define PNG_COLOR_TYPE_GRAY 0
-#define PNG_COLOR_TYPE_PALETTE  (PNG_COLOR_MASK_COLOR | PNG_COLOR_MASK_PALETTE)
-#define PNG_COLOR_TYPE_RGB        (PNG_COLOR_MASK_COLOR)
-#define PNG_COLOR_TYPE_RGB_ALPHA  (PNG_COLOR_MASK_COLOR | PNG_COLOR_MASK_ALPHA)
-#define PNG_COLOR_TYPE_GRAY_ALPHA (PNG_COLOR_MASK_ALPHA)
-
-#define PNG_FILTER_TYPE_LOCO   64
-#define PNG_FILTER_VALUE_NONE  0
-#define PNG_FILTER_VALUE_SUB   1
-#define PNG_FILTER_VALUE_UP    2
-#define PNG_FILTER_VALUE_AVG   3
-#define PNG_FILTER_VALUE_PAETH 4
-#define PNG_FILTER_VALUE_MIXED 5
-
-#define PNG_IHDR      0x0001
-#define PNG_IDAT      0x0002
-#define PNG_ALLIMAGE  0x0004
-#define PNG_PLTE      0x0008
-
-#define NB_PASSES 7
-
-extern const uint8_t ff_pngsig[8];
-extern const uint8_t ff_mngsig[8];
-
-/* Mask to determine which y pixels are valid in a pass */
-extern const uint8_t ff_png_pass_ymask[NB_PASSES];
-
-/* minimum x value */
-extern const uint8_t ff_png_pass_xmin[NB_PASSES];
-
-/* x shift to get row width */
-extern const uint8_t ff_png_pass_xshift[NB_PASSES];
-
-/* Mask to determine which pixels are valid in a pass */
-extern const uint8_t ff_png_pass_mask[NB_PASSES];
-
-void *ff_png_zalloc(void *opaque, unsigned int items, unsigned int size);
-
-void ff_png_zfree(void *opaque, void *ptr);
-
-int ff_png_get_nb_channels(int color_type);
-
-/* compute the row size of an interleaved pass */
-int ff_png_pass_row_size(int pass, int bits_per_pixel, int width);
-
-void ff_add_png_paeth_prediction(uint8_t *dst, uint8_t *src, uint8_t *top, int w, int bpp);
-
-#endif /* AVCODEC_PNG_H */

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/pngdec.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/pngdec.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/pngdec.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -21,7 +21,7 @@
 #include "libavcore/imgutils.h"
 #include "avcodec.h"
 #include "bytestream.h"
-#include "png.h"
+#include "ffpng.h"
 #include "dsputil.h"
 
 /* TODO:

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/pngenc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/pngenc.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/pngenc.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -21,7 +21,7 @@
 #include "avcodec.h"
 #include "bytestream.h"
 #include "dsputil.h"
-#include "png.h"
+#include "ffpng.h"
 
 /* TODO:
  * - add 2, 4 and 16 bit depth support

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/utils.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/utils.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/utils.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -658,10 +658,12 @@
 
     if((avctx->codec->capabilities & CODEC_CAP_DELAY) || avpkt->size){
         //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
+#if 0 // MEANX : Silence
         if(*frame_size_ptr < AVCODEC_MAX_AUDIO_FRAME_SIZE){
             av_log(avctx, AV_LOG_ERROR, "buffer smaller than AVCODEC_MAX_AUDIO_FRAME_SIZE\n");
             return -1;
         }
+#endif
         if(*frame_size_ptr < FF_MIN_BUFFER_SIZE ||
         *frame_size_ptr < avctx->channels * avctx->frame_size * sizeof(int16_t)){
             av_log(avctx, AV_LOG_ERROR, "buffer %d too small\n", *frame_size_ptr);
@@ -967,13 +969,13 @@
 
 const char *avcodec_configuration(void)
 {
-    return FFMPEG_CONFIGURATION;
+    return "avidemux"; //FFMPEG_CONFIGURATION;
 }
 
 const char *avcodec_license(void)
 {
 #define LICENSE_PREFIX "libavcodec license: "
-    return LICENSE_PREFIX FFMPEG_LICENSE + sizeof(LICENSE_PREFIX) - 1;
+    return LICENSE_PREFIX /*FFMPEG_LICENSE*/ "GPL" + sizeof(LICENSE_PREFIX) - 1;
 }
 
 void avcodec_init(void)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/x86/mathops.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/x86/mathops.h	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/x86/mathops.h	2010-12-10 08:06:40 UTC (rev 6830)
@@ -21,8 +21,12 @@
 
 #ifndef AVCODEC_X86_MATHOPS_H
 #define AVCODEC_X86_MATHOPS_H
+// MEANX
+#ifndef ADM_NO_CONFIG_H
+#include "config.h"
+#endif
+// /MEANX
 
-#include "config.h"
 #include "libavutil/common.h"
 
 #if ARCH_X86_32

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcore/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcore/CMakeLists.txt	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcore/CMakeLists.txt	2010-12-10 08:06:40 UTC (rev 6830)
@@ -0,0 +1,10 @@
+SET(ADM_LIB ADM_libavcore6)
+
+SET(${ADM_LIB}_SRCS 
+audioconvert.c  imgutils.c  parseutils.c  samplefmt.c  utils.c
+)
+
+ADD_LIBRARY(${ADM_LIB} SHARED ${${ADM_LIB}_SRCS})
+TARGET_LINK_LIBRARIES(${ADM_LIB} ADM_core6)
+
+ADM_INSTALL_LIB(${ADM_LIB} )

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/CMakeLists.txt	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/CMakeLists.txt	2010-12-10 08:06:40 UTC (rev 6830)
@@ -7,6 +7,7 @@
 	avc.c   riff.c
         mpegenc.c
         movenchint.c sdp.c adtsenc.c flacenc.c flacenc_header.c vorbiscomment.c
+	id3v2.c id3v1.c avlanguage.c
 )
 IF(WIN32)
   ADD_DEFINITIONS(-DHAVE_DOS_PATHS=1)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/file.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/file.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/file.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -30,7 +30,73 @@
 #include <stdlib.h>
 #include "os_support.h"
 
+// GRUNTSTER start
+#ifdef __WIN32
+#include <windows.h>
 
+int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString)
+{
+	int wideCharStringLength = MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, NULL, 0);
+
+	if (wideCharString)
+		MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, wideCharString, wideCharStringLength);
+
+	return wideCharStringLength;
+}
+
+int ADM_open(const char *path, int oflag, ...)
+{
+	int fileNameLength = utf8StringToWideChar(path, -1, NULL);
+	wchar_t wcFile[fileNameLength];
+	int creation = 0, access = 0;
+	HANDLE hFile;
+
+	utf8StringToWideChar(path, -1, wcFile);
+
+	if (oflag & O_WRONLY || oflag & O_RDWR)
+	{
+		access = GENERIC_WRITE;
+
+		if (oflag & O_RDWR)
+			access |= GENERIC_READ;
+
+		if (oflag & O_CREAT)
+		{
+			if (oflag & O_EXCL)
+				creation = CREATE_NEW;
+			else if (oflag & O_TRUNC)
+				creation = CREATE_ALWAYS;
+			else
+				creation = OPEN_ALWAYS;
+		}
+		else if (oflag & O_TRUNC)
+			creation = TRUNCATE_EXISTING;
+	}
+	else if (oflag & O_RDONLY)
+		creation = OPEN_EXISTING;
+
+	if (creation & GENERIC_WRITE)
+	{
+		hFile = CreateFileW(wcFile, access, 0, NULL, creation, 0, NULL);
+
+		if (hFile == INVALID_HANDLE_VALUE)
+			return -1;
+		else
+			CloseHandle(hFile);
+	}
+
+	hFile = CreateFileW(wcFile, access, FILE_SHARE_READ, NULL, creation, 0, NULL);
+
+	if (hFile == INVALID_HANDLE_VALUE)
+		return -1;
+	else
+		return _open_osfhandle((intptr_t)hFile, oflag);
+}
+
+#define open ADM_open
+#endif
+// GRUNTSTER end
+
 /* standard file protocol */
 
 static int file_read(URLContext *h, unsigned char *buf, int size)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/flvenc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/flvenc.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/flvenc.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -443,7 +443,8 @@
     "video/x-flv",
     "flv",
     sizeof(FLVContext),
-#if CONFIG_LIBMP3LAME
+//MEANX #if CONFIG_LIBMP3LAME
+#ifdef HAVE_LIBMP3LAME
     CODEC_ID_MP3,
 #else // CONFIG_LIBMP3LAME
     CODEC_ID_ADPCM_SWF,
@@ -455,3 +456,9 @@
     .codec_tag= (const AVCodecTag* const []){flv_video_codec_ids, flv_audio_codec_ids, 0},
     .flags= AVFMT_GLOBALHEADER | AVFMT_VARIABLE_FPS,
 };
+// MEANX
+int flvenc_init(void)
+{
+    av_register_output_format(&flv_muxer);
+    return 0;
+}
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/isom.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/isom.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/isom.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -222,7 +222,10 @@
     { CODEC_ID_MP1, MKTAG('.', 'm', 'p', '1') }, /* MPEG layer 1 */
     { CODEC_ID_MP2, MKTAG('.', 'm', 'p', '2') }, /* MPEG layer 2 */
 
-    { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at http://www.3ivx.com/showcase.html use this tag */
+    //MEANX { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at http://www.3ivx.com/showcase.html use this tag */
+     { CODEC_ID_MP3, MKTAG( 'm', 'p', '4','a') },
+     { CODEC_ID_MP2, MKTAG( 'm', 'p', '4', 'a') },
+    // /MEANX
     { CODEC_ID_MP3, 0x6D730055 }, /* MPEG layer 3 */
 
 /*  { CODEC_ID_OGG_VORBIS, MKTAG('O', 'g', 'g', 'S') }, *//* sample files at http://heroinewarrior.com/xmovie.php3 use this tag */

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/matroskaenc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/matroskaenc.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/matroskaenc.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -410,6 +410,7 @@
 
 static int put_xiph_codecpriv(AVFormatContext *s, ByteIOContext *pb, AVCodecContext *codec)
 {
+#if 0 // MEANX avidemux does thing differently
     uint8_t *header_start[3];
     int header_len[3];
     int first_header_size;
@@ -434,6 +435,28 @@
         put_buffer(pb, header_start[j], header_len[j]);
 
     return 0;
+#else
+   // Not endian safe....
+      uint32_t packetLen[3],*ptr=(uint32_t *)codec->extradata;
+      uint8_t *data[3],i,j;
+      if( 3*4+ptr[0]+ptr[1]+ptr[2]!=codec->extradata_size)
+      {
+        av_log(s, AV_LOG_ERROR, "Broken avidemux xiph header.\n");
+        return -1;
+      }
+      data[0]=codec->extradata+3*4;
+      data[1]=data[0]+ptr[0];
+      data[2]=data[1]+ptr[1];
+      put_byte(pb, 2);                    // number packets - 1
+      for (j = 0; j < 2; j++) 
+      {
+          put_xiph_size(pb, ptr[j]);
+      }
+      for (j = 0; j < 3; j++)
+        put_buffer(pb, data[j], ptr[j]);
+      
+      return 0; // /MEANX
+#endif
 }
 
 static void get_aac_sample_rates(AVFormatContext *s, AVCodecContext *codec, int *sample_rate, int *output_sample_rate)
@@ -551,6 +574,23 @@
         put_ebml_uint (pb, MATROSKA_ID_TRACKNUMBER     , i + 1);
         put_ebml_uint (pb, MATROSKA_ID_TRACKUID        , i + 1);
         put_ebml_uint (pb, MATROSKA_ID_TRACKFLAGLACING , 0);    // no lacing (yet)
+/**  MEANX : Add a default duration for video **/
+        if(codec->codec_type==CODEC_TYPE_VIDEO)
+        {
+          if(codec->time_base.den && codec->time_base.num)
+          {
+            int num=codec->time_base.num;
+            int den=codec->time_base.den;
+            unsigned int default_duration;
+            float period=num;
+                  period/=den;
+                  period*=1000*1000*1000; // in ns
+                  default_duration=(unsigned int)floor(period);
+                  put_ebml_uint (pb, MATROSKA_ID_TRACKDEFAULTDURATION ,default_duration);
+          }
+        }
+        
+/**  MEANX : Add a default duration for video **/
 
         if ((tag = av_metadata_get(st->metadata, "title", NULL, 0)))
             put_ebml_string(pb, MATROSKA_ID_TRACKNAME, tag->value);
@@ -1226,3 +1266,17 @@
     .codec_tag = (const AVCodecTag* const []){ff_codec_wav_tags, 0},
 };
 #endif
+
+ // MEANX
+ //
+ int matroskaenc_init(void)
+ {
+     av_register_output_format(&matroska_muxer);
+#if CONFIG_WEBM_MUXER
+     av_register_output_format(&webm_muxer);
+#endif
+     return 0;
+ }
+ // /MEANX
+
+

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/movenc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/movenc.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/movenc.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -2299,3 +2299,15 @@
     .codec_tag = (const AVCodecTag* const []){codec_ipod_tags, 0},
 };
 #endif
+/* MEANX */
+int movenc_init(void)
+{
+    av_register_output_format(&mov_muxer);
+    av_register_output_format(&tgp_muxer);
+    av_register_output_format(&mp4_muxer);
+    av_register_output_format(&psp_muxer);
+    av_register_output_format(&tg2_muxer);
+    av_register_output_format(&ipod_muxer);
+    return 0;
+}
+/* MEANX */

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/mpegenc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/mpegenc.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/mpegenc.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1306,3 +1306,13 @@
     mpeg_mux_end,
 };
 #endif
+// MEANX
+//
+int mpegenc_init(void)
+{
+    av_register_output_format(&mpeg2dvd_muxer);
+    av_register_output_format(&mpeg2svcd_muxer);
+    av_register_output_format(&mpeg2vob_muxer);
+    av_register_output_format(&mpeg1vcd_muxer);
+    return 0;
+}
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/mpegtsenc.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/mpegtsenc.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/mpegtsenc.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -958,3 +958,8 @@
     mpegts_write_packet,
     mpegts_write_end,
 };
+int mpegtsenc_init(void)
+{
+    av_register_output_format(&mpegts_muxer);
+    return 0;
+}
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/utils.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/utils.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavformat/utils.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -50,13 +50,14 @@
 
 const char *avformat_configuration(void)
 {
-    return FFMPEG_CONFIGURATION;
+    return "avidemux"; // MEANX FFMPEG_CONFIGURATION;
 }
 
 const char *avformat_license(void)
 {
 #define LICENSE_PREFIX "libavformat license: "
-    return LICENSE_PREFIX FFMPEG_LICENSE + sizeof(LICENSE_PREFIX) - 1;
+        return LICENSE_PREFIX "GPL";
+//MEANX    return LICENSE_PREFIX FFMPEG_LICENSE + sizeof(LICENSE_PREFIX) - 1;
 }
 
 /* fraction handling */

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/CMakeLists.txt	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/CMakeLists.txt	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,6 +1,8 @@
 SET(ADM_LIB ADM_libavutil6)
 
 SET(${ADM_LIB}_SRCS 
+opt.c
+cpu.c
 eval.c
 adler32.c
 aes.c
@@ -27,6 +29,11 @@
 pixdesc.c
 sha.c
 )
+IF(ADM_CPU_X86)
+	SET(${ADM_LIB}_SRCS  ${${ADM_LIB}_SRCS}
+			x86/cpu.c
+				)
+ENDIF(ADM_CPU_X86)
 
 ADD_LIBRARY(${ADM_LIB} SHARED ${${ADM_LIB}_SRCS})
 TARGET_LINK_LIBRARIES(${ADM_LIB} ADM_core6)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/avutil.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/avutil.h	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/avutil.h	2010-12-10 08:06:40 UTC (rev 6830)
@@ -26,7 +26,14 @@
  * external API header
  */
 
+/* MEANX
+ * - */
+#define ASMALIGN(ZEROBITS) ".p2align " #ZEROBITS "\n\t"
+/* /MEANX
+ */
 
+
+
 #define AV_STRINGIFY(s)         AV_TOSTRING(s)
 #define AV_TOSTRING(s) #s
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/bswap.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/bswap.h	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/bswap.h	2010-12-10 08:06:40 UTC (rev 6830)
@@ -27,7 +27,7 @@
 #define AVUTIL_BSWAP_H
 
 #include <stdint.h>
-#include "libavutil/avconfig.h"
+#include "ffmpeg_config/libavutil/avconfig.h" //MEANX
 #include "attributes.h"
 
 #ifdef HAVE_AV_CONFIG_H

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/common.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/common.h	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/common.h	2010-12-10 08:06:40 UTC (rev 6830)
@@ -35,7 +35,7 @@
 #include <stdlib.h>
 #include <string.h>
 #include "attributes.h"
-#include "libavutil/avconfig.h"
+#include "ffmpeg_config/libavutil/avconfig.h" //MEANX
 
 #if AV_HAVE_BIGENDIAN
 #   define AV_NE(be, le) (be)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/internal.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/internal.h	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/internal.h	2010-12-10 08:06:40 UTC (rev 6830)
@@ -34,7 +34,11 @@
 #include <stdint.h>
 #include <stddef.h>
 #include <assert.h>
+//MEANX
+#ifndef ADM_NO_CONFIG_H
 #include "config.h"
+#endif
+// /MEANX
 #include "attributes.h"
 #include "timer.h"
 
@@ -101,6 +105,8 @@
 #endif
 
 /* Use to export labels from asm. */
+#include "ADM_mangle.h"
+#if 0 // MEANX
 #define LABEL_MANGLE(a) EXTERN_PREFIX #a
 
 // Use rip-relative addressing if compiling PIC code on x86-64.
@@ -111,7 +117,7 @@
 #endif
 
 #define MANGLE(a) EXTERN_PREFIX LOCAL_MANGLE(a)
-
+#endif // MEANX
 /* debug stuff */
 
 /* dprintf macros */
@@ -140,12 +146,14 @@
 #endif
 
 /* avoid usage of dangerous/inappropriate system functions */
+#if 0 //MEANX
 #undef  malloc
 #define malloc please_use_av_malloc
 #undef  free
 #define free please_use_av_free
 #undef  realloc
 #define realloc please_use_av_realloc
+#endif
 #undef  time
 #define time time_is_forbidden_due_to_security_issues
 #undef  rand

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/intreadwrite.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/intreadwrite.h	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/intreadwrite.h	2010-12-10 08:06:40 UTC (rev 6830)
@@ -20,7 +20,7 @@
 #define AVUTIL_INTREADWRITE_H
 
 #include <stdint.h>
-#include "libavutil/avconfig.h"
+#include "ffmpeg_config/libavutil/avconfig.h" //MEANX
 #include "attributes.h"
 #include "bswap.h"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/lfg.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/lfg.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/lfg.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -39,7 +39,7 @@
         c->state[i+2]= AV_RL32(tmp+8);
         c->state[i+3]= AV_RL32(tmp+12);
     }
-    c->index=0;
+    c->xindex=0;
 }
 
 void av_bmg_get(AVLFG *lfg, double out[2])

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/lfg.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/lfg.h	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/lfg.h	2010-12-10 08:06:40 UTC (rev 6830)
@@ -24,7 +24,7 @@
 
 typedef struct {
     unsigned int state[64];
-    int index;
+    int xindex;
 } AVLFG;
 
 void av_lfg_init(AVLFG *c, unsigned int seed);
@@ -36,8 +36,8 @@
  * it may be good enough and faster for your specific use case.
  */
 static inline unsigned int av_lfg_get(AVLFG *c){
-    c->state[c->index & 63] = c->state[(c->index-24) & 63] + c->state[(c->index-55) & 63];
-    return c->state[c->index++ & 63];
+    c->state[c->xindex & 63] = c->state[(c->xindex-24) & 63] + c->state[(c->xindex-55) & 63];
+    return c->state[c->xindex++ & 63];
 }
 
 /**
@@ -46,9 +46,9 @@
  * Please also consider av_lfg_get() above, it is faster.
  */
 static inline unsigned int av_mlfg_get(AVLFG *c){
-    unsigned int a= c->state[(c->index-55) & 63];
-    unsigned int b= c->state[(c->index-24) & 63];
-    return c->state[c->index++ & 63] = 2*a*b+a+b;
+    unsigned int a= c->state[(c->xindex-55) & 63];
+    unsigned int b= c->state[(c->xindex-24) & 63];
+    return c->state[c->xindex++ & 63] = 2*a*b+a+b;
 }
 
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/libm.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/libm.h	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/libm.h	2010-12-10 08:06:40 UTC (rev 6830)
@@ -25,7 +25,11 @@
 #define AVUTIL_LIBM_H
 
 #include <math.h>
+//MEANX
+#ifndef ADM_NO_CONFIG_H
 #include "config.h"
+#endif
+///MEANX
 #include "attributes.h"
 
 #if !HAVE_EXP2

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/mem.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/mem.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/mem.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -63,88 +63,112 @@
 
 void *av_malloc(FF_INTERNAL_MEM_TYPE size)
 {
-    void *ptr = NULL;
-#if CONFIG_MEMALIGN_HACK
-    long diff;
-#endif
+#ifdef __APPLE__
+	return malloc(size);
+#else
+	char *c;
 
-    /* let's disallow possible ambiguous cases */
-    if(size > (INT_MAX-16) )
-        return NULL;
+	uint64_t l, lorg;
+	uint32_t *backdoor;
 
-#if CONFIG_MEMALIGN_HACK
-    ptr = malloc(size+16);
-    if(!ptr)
-        return ptr;
-    diff= ((-(long)ptr - 1)&15) + 1;
-    ptr = (char*)ptr + diff;
-    ((char*)ptr)[-1]= diff;
-#elif HAVE_POSIX_MEMALIGN
-    if (posix_memalign(&ptr,16,size))
-        ptr = NULL;
-#elif HAVE_MEMALIGN
-    ptr = memalign(16,size);
-    /* Why 64?
-       Indeed, we should align it:
-         on 4 for 386
-         on 16 for 486
-         on 32 for 586, PPro - K6-III
-         on 64 for K7 (maybe for P3 too).
-       Because L1 and L2 caches are aligned on those values.
-       But I don't want to code such logic here!
-     */
-     /* Why 16?
-        Because some CPUs need alignment, for example SSE2 on P4, & most RISC CPUs
-        it will just trigger an exception and the unaligned load will be done in the
-        exception handler or it will just segfault (SSE2 on P4).
-        Why not larger? Because I did not see a difference in benchmarks ...
-     */
-     /* benchmarks with P3
-        memalign(64)+1          3071,3051,3032
-        memalign(64)+2          3051,3032,3041
-        memalign(64)+4          2911,2896,2915
-        memalign(64)+8          2545,2554,2550
-        memalign(64)+16         2543,2572,2563
-        memalign(64)+32         2546,2545,2571
-        memalign(64)+64         2570,2533,2558
+	l = (uint64_t)malloc(size + 32);
 
-        BTW, malloc seems to do 8-byte alignment by default here.
-     */
-#else
-    ptr = malloc(size);
-#endif
-    return ptr;
+	// Get next boundary
+	lorg = l;
+	l = (l + 15) & 0xfffffffffffffff0LL;
+	l += 16;
+	c = (char*)l;
+	backdoor = (uint32_t*)(c - 8);
+	*backdoor = (0xdead << 16) + l - lorg;
+	backdoor[1] = size;
+
+	return c;
+ #endif
+
 }
 
-void *av_realloc(void *ptr, FF_INTERNAL_MEM_TYPE size)
+void *av_realloc(void *ptr, FF_INTERNAL_MEM_TYPE newsize)
 {
-#if CONFIG_MEMALIGN_HACK
-    int diff;
-#endif
+#ifdef __APPLE__
+	if (!ptr)
+		return av_malloc(newsize);
+	if (!newsize)
+	{
+		av_free(ptr);
+		return NULL;
+	}
+#else
+	void *nalloc;
 
-    /* let's disallow possible ambiguous cases */
-    if(size > (INT_MAX-16) )
-        return NULL;
+	if (!ptr)
+		return av_malloc(newsize);
 
-#if CONFIG_MEMALIGN_HACK
-    //FIXME this isn't aligned correctly, though it probably isn't needed
-    if(!ptr) return av_malloc(size);
-    diff= ((char*)ptr)[-1];
-    return (char*)realloc((char*)ptr - diff, size + diff) + diff;
-#else
-    return realloc(ptr, size);
-#endif
+	if (!newsize) 
+	{
+		av_free(ptr);
+		return NULL;
+	}
+
+	// now we either shrink them or expand them
+	// in case of shrink, we do nothing
+	// in case of expand we have to copy
+	// Do copy everytime (slower)
+	uint32_t *backdoor;
+	uint32_t size, offset;
+	char *c = (char*)ptr;
+
+	backdoor = (uint32_t*)ptr;
+	backdoor -= 2;
+
+	assert(((*backdoor) >> 16) == 0xdead);
+
+	offset = backdoor[0] & 0xffff;
+	size = backdoor[1];
+
+	if(size >= newsize) // do nothing
+		return ptr;
+
+	// Allocate a new one
+	nalloc = av_malloc(newsize);
+	memcpy(nalloc, ptr, size);
+	av_free(ptr);
+
+	return nalloc;
+ #endif
+
+
 }
 
 void av_free(void *ptr)
 {
-    /* XXX: this test should not be needed on most libcs */
-    if (ptr)
-#if CONFIG_MEMALIGN_HACK
-        free((char*)ptr - ((char*)ptr)[-1]);
-#else
-        free(ptr);
-#endif
+#ifdef __APPLE__
+	if (!ptr)
+		return;
+
+	free(ptr);
+ #else
+	uint32_t *backdoor;
+	uint32_t size, offset;
+	char *c = (char*)ptr;
+
+	if (!ptr)
+		return;
+
+	backdoor = (uint32_t*)ptr;
+	backdoor -= 2;
+
+	if (*backdoor == 0xbeefbeef)
+		assert(0);
+
+	assert(((*backdoor) >> 16) == 0xdead);
+
+	offset = backdoor[0] & 0xffff;
+	size = backdoor[1];
+	*backdoor = 0xbeefbeef; // Scratch sig
+
+	free(c - offset);
+ #endif
+	
 }
 
 void av_freep(void *arg)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/pixfmt.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/pixfmt.h	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/pixfmt.h	2010-12-10 08:06:40 UTC (rev 6830)
@@ -29,7 +29,7 @@
  * header, so it should not be directly included in your projects.
  */
 
-#include "libavutil/avconfig.h"
+#include "ffmpeg_config/libavutil/avconfig.h" // MEANX
 
 /**
  * Pixel format. Notes:

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/timer.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/timer.h	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/timer.h	2010-12-10 08:06:40 UTC (rev 6830)
@@ -26,8 +26,13 @@
 
 #include <stdlib.h>
 #include <stdint.h>
+// MEANX
+#ifndef ADM_NO_CONFIG_H
 #include "config.h"
+#endif
+// MEANX
 
+
 #if   ARCH_ARM
 #   include "arm/timer.h"
 #elif ARCH_BFIN

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/CMakeLists.txt	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/CMakeLists.txt	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,6 +1,6 @@
 SET(ADM_LIB ADM_libswscale6)
 SET(${ADM_LIB}_SRCS 
-        swscale.c yuv2rgb.c rgb2rgb.c ADM_mp.cpp  utils.c
+        rgb2rgb.c swscale.c utils.c yuv2rgb.c options.c
 )
 ADD_DEFINITIONS("-Dbswap_16=av_bswap16")
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/swscale_template.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/swscale_template.c	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libswscale/swscale_template.c	2010-12-10 08:06:40 UTC (rev 6830)
@@ -951,7 +951,7 @@
 #if COMPILE_TEMPLATE_MMX
     if(!(c->flags & SWS_BITEXACT)) {
         long p= 4;
-        const uint8_t *src[4]= {alpSrc + dstW, lumSrc + dstW, chrSrc + chrDstW, chrSrc + VOFW + chrDstW};
+        const uint8_t *src[4]= {alpSrc + dstW, (uint8_t *)lumSrc + dstW, (uint8_t *)chrSrc + chrDstW, (uint8_t *)chrSrc + VOFW + chrDstW}; // MEANX
         uint8_t *dst[4]= {aDest, dest, uDest, vDest};
         x86_reg counter[4]= {dstW, dstW, chrDstW, chrDstW};
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/avcodec.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/avcodec.h.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/avcodec.h.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,8 +1,8 @@
 diff --git a/avidemux_core/ADM_ffmpeg/libavcodec/avcodec.h b/avidemux_core/ADM_ffmpeg/libavcodec/avcodec.h
-index 14e049d..78e39a5 100644
+index 94ae9d3..c0268eb 100644
 --- a/avidemux_core/ADM_ffmpeg/libavcodec/avcodec.h
 +++ b/avidemux_core/ADM_ffmpeg/libavcodec/avcodec.h
-@@ -614,6 +614,8 @@ typedef struct RcOverride{
+@@ -669,6 +669,8 @@ typedef struct RcOverride{
  #define CODEC_FLAG2_PSY           0x00080000 ///< Use psycho visual optimizations.
  #define CODEC_FLAG2_SSIM          0x00100000 ///< Compute SSIM during encoding, error[] values are undefined.
  #define CODEC_FLAG2_INTRA_REFRESH 0x00200000 ///< Use periodic insertion of intra blocks instead of keyframes.
@@ -11,7 +11,7 @@
  
  /* Unsupported options :
   *              Syntax Arithmetic coding (SAC)
-@@ -1496,6 +1498,7 @@ typedef struct AVCodecContext {
+@@ -1563,6 +1565,7 @@ typedef struct AVCodecContext {
       * - decoding: unused
       */
      int rc_max_rate;
@@ -19,7 +19,7 @@
  
      /**
       * minimum bitrate
-@@ -1510,6 +1513,8 @@ typedef struct AVCodecContext {
+@@ -1577,6 +1580,8 @@ typedef struct AVCodecContext {
       * - decoding: unused
       */
      int rc_buffer_size;

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/dsputil.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/dsputil.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/dsputil.c.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -0,0 +1,13 @@
+diff --git a/avidemux_core/ADM_ffmpeg/libavcodec/dsputil.c b/avidemux_core/ADM_ffmpeg/libavcodec/dsputil.c
+index 29ddb4d..047bf5d 100644
+--- a/avidemux_core/ADM_ffmpeg/libavcodec/dsputil.c
++++ b/avidemux_core/ADM_ffmpeg/libavcodec/dsputil.c
+@@ -39,7 +39,7 @@
+ #include "lpc.h"
+ #include "ac3dec.h"
+ #include "vorbis.h"
+-#include "png.h"
++#include "ffpng.h"
+ #include "vp8dsp.h"
+ 
+ uint8_t ff_cropTbl[256 + 2 * MAX_NEG_CROP] = {0, };

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/h263dec.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/h263dec.c.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/h263dec.c.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,8 +1,8 @@
 diff --git a/avidemux_core/ADM_ffmpeg/libavcodec/h263dec.c b/avidemux_core/ADM_ffmpeg/libavcodec/h263dec.c
-index d9d6f7e..218959d 100644
+index 04417c2..1bd8168 100644
 --- a/avidemux_core/ADM_ffmpeg/libavcodec/h263dec.c
 +++ b/avidemux_core/ADM_ffmpeg/libavcodec/h263dec.c
-@@ -119,6 +119,23 @@ av_cold int ff_h263_decode_init(AVCodecContext *avctx)
+@@ -120,6 +120,23 @@ av_cold int ff_h263_decode_init(AVCodecContext *avctx)
  
      return 0;
  }
@@ -26,7 +26,7 @@
  
  av_cold int ff_h263_decode_end(AVCodecContext *avctx)
  {
-@@ -414,6 +431,12 @@ retry:
+@@ -422,6 +439,12 @@ retry:
      } else {
          ret = h263_decode_picture_header(s);
      }
@@ -39,7 +39,7 @@
  
      if(ret==FRAME_SKIPPED) return get_consumed_bytes(s, buf_size);
  
-@@ -709,6 +732,14 @@ intrax8_decoded:
+@@ -717,6 +740,14 @@ intrax8_decoded:
  
  assert(s->current_picture.pict_type == s->current_picture_ptr->pict_type);
  assert(s->current_picture.pict_type == s->pict_type);

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/h264_parser.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/h264_parser.c.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/h264_parser.c.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,5 +1,5 @@
 diff --git a/avidemux_core/ADM_ffmpeg/libavcodec/h264_parser.c b/avidemux_core/ADM_ffmpeg/libavcodec/h264_parser.c
-index 70d08f4..437f9d0 100644
+index 70d08f4..f2bed6c 100644
 --- a/avidemux_core/ADM_ffmpeg/libavcodec/h264_parser.c
 +++ b/avidemux_core/ADM_ffmpeg/libavcodec/h264_parser.c
 @@ -29,10 +29,51 @@
@@ -32,7 +32,7 @@
 +            printf("Scale : %d, tick=%d, fps=%d\n",(int)scale,(int)ticks,(int)info->fps1000);
 +    }else
 +    {
-+            ADM_warning("[H264] No timing information\n");
++            printf("[H264] No timing information\n");
 +            info->fps1000=25000;
 +    }
 +    // D.2.2 SEI Timing present if CpbDbpDelayPresentFlag=1 or pictStructPresent=1

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/mpeg12.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/mpeg12.c.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/mpeg12.c.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,5 +1,5 @@
 diff --git a/avidemux_core/ADM_ffmpeg/libavcodec/mpeg12.c b/avidemux_core/ADM_ffmpeg/libavcodec/mpeg12.c
-index 0af24ad..3ffea4c 100644
+index 6a331eb..abbae83 100644
 --- a/avidemux_core/ADM_ffmpeg/libavcodec/mpeg12.c
 +++ b/avidemux_core/ADM_ffmpeg/libavcodec/mpeg12.c
 @@ -1948,6 +1948,11 @@ static int slice_end(AVCodecContext *avctx, AVFrame *pict)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/mpegvideo.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/mpegvideo.c.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/mpegvideo.c.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,8 +1,8 @@
 diff --git a/avidemux_core/ADM_ffmpeg/libavcodec/mpegvideo.c b/avidemux_core/ADM_ffmpeg/libavcodec/mpegvideo.c
-index 684bdfe..2135c3d 100644
+index 9650066..e545931 100644
 --- a/avidemux_core/ADM_ffmpeg/libavcodec/mpegvideo.c
 +++ b/avidemux_core/ADM_ffmpeg/libavcodec/mpegvideo.c
-@@ -652,7 +652,11 @@ av_cold int MPV_common_init(MpegEncContext *s)
+@@ -653,7 +653,11 @@ av_cold int MPV_common_init(MpegEncContext *s)
      FF_ALLOCZ_OR_GOTO(s->avctx, s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE, fail);
  
      s->parse_context.state= -1;

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/mpegvideo_enc.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/mpegvideo_enc.c.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/mpegvideo_enc.c.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,5 +1,5 @@
 diff --git a/avidemux_core/ADM_ffmpeg/libavcodec/mpegvideo_enc.c b/avidemux_core/ADM_ffmpeg/libavcodec/mpegvideo_enc.c
-index 9f8682c..1f296a5 100644
+index 459ede7..97ffa0a 100644
 --- a/avidemux_core/ADM_ffmpeg/libavcodec/mpegvideo_enc.c
 +++ b/avidemux_core/ADM_ffmpeg/libavcodec/mpegvideo_enc.c
 @@ -367,12 +367,14 @@ av_cold int MPV_encode_init(AVCodecContext *avctx)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/pngdec.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/pngdec.c.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/pngdec.c.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,9 +1,9 @@
 diff --git a/avidemux_core/ADM_ffmpeg/libavcodec/pngdec.c b/avidemux_core/ADM_ffmpeg/libavcodec/pngdec.c
-index 037c5a0..6546567 100644
+index eb8989f..5ecdd56 100644
 --- a/avidemux_core/ADM_ffmpeg/libavcodec/pngdec.c
 +++ b/avidemux_core/ADM_ffmpeg/libavcodec/pngdec.c
-@@ -20,7 +20,7 @@
-  */
+@@ -21,7 +21,7 @@
+ #include "libavcore/imgutils.h"
  #include "avcodec.h"
  #include "bytestream.h"
 -#include "png.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/utils.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/utils.c.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/utils.c.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,8 +1,8 @@
 diff --git a/avidemux_core/ADM_ffmpeg/libavcodec/utils.c b/avidemux_core/ADM_ffmpeg/libavcodec/utils.c
-index f21e9ed..acd1078 100644
+index 69d333e..782a2ed 100644
 --- a/avidemux_core/ADM_ffmpeg/libavcodec/utils.c
 +++ b/avidemux_core/ADM_ffmpeg/libavcodec/utils.c
-@@ -643,10 +643,12 @@ int attribute_align_arg avcodec_decode_audio3(AVCodecContext *avctx, int16_t *sa
+@@ -658,10 +658,12 @@ int attribute_align_arg avcodec_decode_audio3(AVCodecContext *avctx, int16_t *sa
  
      if((avctx->codec->capabilities & CODEC_CAP_DELAY) || avpkt->size){
          //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
@@ -15,7 +15,7 @@
          if(*frame_size_ptr < FF_MIN_BUFFER_SIZE ||
          *frame_size_ptr < avctx->channels * avctx->frame_size * sizeof(int16_t)){
              av_log(avctx, AV_LOG_ERROR, "buffer %d too small\n", *frame_size_ptr);
-@@ -952,13 +954,13 @@ unsigned avcodec_version( void )
+@@ -967,13 +969,13 @@ unsigned avcodec_version( void )
  
  const char *avcodec_configuration(void)
  {

Copied: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/x86_mathops.h (from rev 6829, branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/x86_mathops.h.patch)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/x86_mathops.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/x86_mathops.h	2010-12-10 08:06:40 UTC (rev 6830)
@@ -0,0 +1,18 @@
+diff --git a/avidemux_core/ADM_ffmpeg/libavcodec/x86/mathops.h b/avidemux_core/ADM_ffmpeg/libavcodec/x86/mathops.h
+index 5949dfe..c30f9df 100644
+--- a/avidemux_core/ADM_ffmpeg/libavcodec/x86/mathops.h
++++ b/avidemux_core/ADM_ffmpeg/libavcodec/x86/mathops.h
+@@ -21,8 +21,12 @@
+ 
+ #ifndef AVCODEC_X86_MATHOPS_H
+ #define AVCODEC_X86_MATHOPS_H
+-
++// MEANX
++#ifndef ADM_NO_CONFIG_H
+ #include "config.h"
++#endif
++// /MEANX
++
+ #include "libavutil/common.h"
+ 
+ #if ARCH_X86_32

Deleted: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/x86_mathops.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/x86_mathops.h.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avcodec/x86_mathops.h.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,18 +0,0 @@
-diff --git a/avidemux_core/ADM_ffmpeg/libavcodec/x86/mathops.h b/avidemux_core/ADM_ffmpeg/libavcodec/x86/mathops.h
-index 5949dfe..c30f9df 100644
---- a/avidemux_core/ADM_ffmpeg/libavcodec/x86/mathops.h
-+++ b/avidemux_core/ADM_ffmpeg/libavcodec/x86/mathops.h
-@@ -21,8 +21,12 @@
- 
- #ifndef AVCODEC_X86_MATHOPS_H
- #define AVCODEC_X86_MATHOPS_H
--
-+// MEANX
-+#ifndef ADM_NO_CONFIG_H
- #include "config.h"
-+#endif
-+// /MEANX
-+
- #include "libavutil/common.h"
- 
- #if ARCH_X86_32

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/flvenc.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/flvenc.c.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/flvenc.c.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,8 +1,8 @@
 diff --git a/avidemux_core/ADM_ffmpeg/libavformat/flvenc.c b/avidemux_core/ADM_ffmpeg/libavformat/flvenc.c
-index 709ef07..a573c63 100644
+index e138292..8c08178 100644
 --- a/avidemux_core/ADM_ffmpeg/libavformat/flvenc.c
 +++ b/avidemux_core/ADM_ffmpeg/libavformat/flvenc.c
-@@ -406,7 +406,8 @@ AVOutputFormat flv_muxer = {
+@@ -443,7 +443,8 @@ AVOutputFormat flv_muxer = {
      "video/x-flv",
      "flv",
      sizeof(FLVContext),
@@ -12,7 +12,7 @@
      CODEC_ID_MP3,
  #else // CONFIG_LIBMP3LAME
      CODEC_ID_ADPCM_SWF,
-@@ -418,3 +419,9 @@ AVOutputFormat flv_muxer = {
+@@ -455,3 +456,9 @@ AVOutputFormat flv_muxer = {
      .codec_tag= (const AVCodecTag* const []){flv_video_codec_ids, flv_audio_codec_ids, 0},
      .flags= AVFMT_GLOBALHEADER | AVFMT_VARIABLE_FPS,
  };

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/isom.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/isom.c.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/isom.c.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,8 +1,8 @@
 diff --git a/avidemux_core/ADM_ffmpeg/libavformat/isom.c b/avidemux_core/ADM_ffmpeg/libavformat/isom.c
-index bf2d3b1..99c8069 100644
+index bf01401..1df1419 100644
 --- a/avidemux_core/ADM_ffmpeg/libavformat/isom.c
 +++ b/avidemux_core/ADM_ffmpeg/libavformat/isom.c
-@@ -215,7 +215,10 @@ const AVCodecTag codec_movaudio_tags[] = {
+@@ -222,7 +222,10 @@ const AVCodecTag codec_movaudio_tags[] = {
      { CODEC_ID_MP1, MKTAG('.', 'm', 'p', '1') }, /* MPEG layer 1 */
      { CODEC_ID_MP2, MKTAG('.', 'm', 'p', '2') }, /* MPEG layer 2 */
  

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/matroskaenc.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/matroskaenc.c.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/matroskaenc.c.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,8 +1,8 @@
 diff --git a/avidemux_core/ADM_ffmpeg/libavformat/matroskaenc.c b/avidemux_core/ADM_ffmpeg/libavformat/matroskaenc.c
-index f275d44..a7602a9 100644
+index dc08c18..c12bc45 100644
 --- a/avidemux_core/ADM_ffmpeg/libavformat/matroskaenc.c
 +++ b/avidemux_core/ADM_ffmpeg/libavformat/matroskaenc.c
-@@ -407,6 +407,7 @@ static int64_t mkv_write_cues(ByteIOContext *pb, mkv_cues *cues, int num_tracks)
+@@ -410,6 +410,7 @@ static int64_t mkv_write_cues(ByteIOContext *pb, mkv_cues *cues, int num_tracks)
  
  static int put_xiph_codecpriv(AVFormatContext *s, ByteIOContext *pb, AVCodecContext *codec)
  {
@@ -10,7 +10,7 @@
      uint8_t *header_start[3];
      int header_len[3];
      int first_header_size;
-@@ -431,6 +432,28 @@ static int put_xiph_codecpriv(AVFormatContext *s, ByteIOContext *pb, AVCodecCont
+@@ -434,6 +435,28 @@ static int put_xiph_codecpriv(AVFormatContext *s, ByteIOContext *pb, AVCodecCont
          put_buffer(pb, header_start[j], header_len[j]);
  
      return 0;
@@ -39,7 +39,7 @@
  }
  
  static void get_aac_sample_rates(AVFormatContext *s, AVCodecContext *codec, int *sample_rate, int *output_sample_rate)
-@@ -548,6 +571,23 @@ static int mkv_write_tracks(AVFormatContext *s)
+@@ -551,6 +574,23 @@ static int mkv_write_tracks(AVFormatContext *s)
          put_ebml_uint (pb, MATROSKA_ID_TRACKNUMBER     , i + 1);
          put_ebml_uint (pb, MATROSKA_ID_TRACKUID        , i + 1);
          put_ebml_uint (pb, MATROSKA_ID_TRACKFLAGLACING , 0);    // no lacing (yet)
@@ -63,7 +63,7 @@
  
          if ((tag = av_metadata_get(st->metadata, "title", NULL, 0)))
              put_ebml_string(pb, MATROSKA_ID_TRACKNAME, tag->value);
-@@ -1087,3 +1127,17 @@ AVOutputFormat matroska_audio_muxer = {
+@@ -1226,3 +1266,17 @@ AVOutputFormat matroska_audio_muxer = {
      .codec_tag = (const AVCodecTag* const []){ff_codec_wav_tags, 0},
  };
  #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/movenc.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/movenc.c.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/movenc.c.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,8 +1,8 @@
 diff --git a/avidemux_core/ADM_ffmpeg/libavformat/movenc.c b/avidemux_core/ADM_ffmpeg/libavformat/movenc.c
-index aed748b..ded5383 100644
+index b1ad714..daf70fd 100644
 --- a/avidemux_core/ADM_ffmpeg/libavformat/movenc.c
 +++ b/avidemux_core/ADM_ffmpeg/libavformat/movenc.c
-@@ -2298,3 +2298,15 @@ AVOutputFormat ipod_muxer = {
+@@ -2299,3 +2299,15 @@ AVOutputFormat ipod_muxer = {
      .codec_tag = (const AVCodecTag* const []){codec_ipod_tags, 0},
  };
  #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/mpegenc.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/mpegenc.c.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/mpegenc.c.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,8 +1,8 @@
 diff --git a/avidemux_core/ADM_ffmpeg/libavformat/mpegenc.c b/avidemux_core/ADM_ffmpeg/libavformat/mpegenc.c
-index b37a774..32ce21b 100644
+index 5c090f6..bad9030 100644
 --- a/avidemux_core/ADM_ffmpeg/libavformat/mpegenc.c
 +++ b/avidemux_core/ADM_ffmpeg/libavformat/mpegenc.c
-@@ -1300,3 +1300,13 @@ AVOutputFormat mpeg2dvd_muxer = {
+@@ -1306,3 +1306,13 @@ AVOutputFormat mpeg2dvd_muxer = {
      mpeg_mux_end,
  };
  #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/mpegtsenc.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/mpegtsenc.c.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/mpegtsenc.c.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,8 +1,8 @@
 diff --git a/avidemux_core/ADM_ffmpeg/libavformat/mpegtsenc.c b/avidemux_core/ADM_ffmpeg/libavformat/mpegtsenc.c
-index ac09ab9..fe32325 100644
+index bfd21db..85a6363 100644
 --- a/avidemux_core/ADM_ffmpeg/libavformat/mpegtsenc.c
 +++ b/avidemux_core/ADM_ffmpeg/libavformat/mpegtsenc.c
-@@ -947,3 +947,8 @@ AVOutputFormat mpegts_muxer = {
+@@ -958,3 +958,8 @@ AVOutputFormat mpegts_muxer = {
      mpegts_write_packet,
      mpegts_write_end,
  };

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/utils.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/utils.c.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avformat/utils.c.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,8 +1,8 @@
 diff --git a/avidemux_core/ADM_ffmpeg/libavformat/utils.c b/avidemux_core/ADM_ffmpeg/libavformat/utils.c
-index 6fa4dff..8646c6c 100644
+index c8e6d66..ac532d4 100644
 --- a/avidemux_core/ADM_ffmpeg/libavformat/utils.c
 +++ b/avidemux_core/ADM_ffmpeg/libavformat/utils.c
-@@ -49,13 +49,14 @@ unsigned avformat_version(void)
+@@ -50,13 +50,14 @@ unsigned avformat_version(void)
  
  const char *avformat_configuration(void)
  {

Copied: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/avutil.h.patch (from rev 6829, branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/avutil.h.patch)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/avutil.h.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/avutil.h.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -0,0 +1,18 @@
+diff --git a/avidemux_core/ADM_ffmpeg/libavutil/avutil.h b/avidemux_core/ADM_ffmpeg/libavutil/avutil.h
+index 0ed4c8b..f95b788 100644
+--- a/avidemux_core/ADM_ffmpeg/libavutil/avutil.h
++++ b/avidemux_core/ADM_ffmpeg/libavutil/avutil.h
+@@ -26,6 +26,13 @@
+  * external API header
+  */
+ 
++/* MEANX
++ * - */
++#define ASMALIGN(ZEROBITS) ".p2align " #ZEROBITS "\n\t"
++/* /MEANX
++ */
++
++
+ 
+ #define AV_STRINGIFY(s)         AV_TOSTRING(s)
+ #define AV_TOSTRING(s) #s

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/bswap.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/bswap.h.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/bswap.h.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -0,0 +1,13 @@
+diff --git a/avidemux_core/ADM_ffmpeg/libavutil/bswap.h b/avidemux_core/ADM_ffmpeg/libavutil/bswap.h
+index 303bcf3..6a129f3 100644
+--- a/avidemux_core/ADM_ffmpeg/libavutil/bswap.h
++++ b/avidemux_core/ADM_ffmpeg/libavutil/bswap.h
+@@ -27,7 +27,7 @@
+ #define AVUTIL_BSWAP_H
+ 
+ #include <stdint.h>
+-#include "libavutil/avconfig.h"
++#include "ffmpeg_config/libavutil/avconfig.h" //MEANX
+ #include "attributes.h"
+ 
+ #ifdef HAVE_AV_CONFIG_H

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/common.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/common.h.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/common.h.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -0,0 +1,13 @@
+diff --git a/avidemux_core/ADM_ffmpeg/libavutil/common.h b/avidemux_core/ADM_ffmpeg/libavutil/common.h
+index 6404076..3fde7df 100644
+--- a/avidemux_core/ADM_ffmpeg/libavutil/common.h
++++ b/avidemux_core/ADM_ffmpeg/libavutil/common.h
+@@ -35,7 +35,7 @@
+ #include <stdlib.h>
+ #include <string.h>
+ #include "attributes.h"
+-#include "libavutil/avconfig.h"
++#include "ffmpeg_config/libavutil/avconfig.h" //MEANX
+ 
+ #if AV_HAVE_BIGENDIAN
+ #   define AV_NE(be, le) (be)

Copied: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/internal.h.patch (from rev 6829, branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/internal.h.patch)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/internal.h.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/internal.h.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -0,0 +1,49 @@
+diff --git a/avidemux_core/ADM_ffmpeg/libavutil/internal.h b/avidemux_core/ADM_ffmpeg/libavutil/internal.h
+index 9c4ba7e..73f7d65 100644
+--- a/avidemux_core/ADM_ffmpeg/libavutil/internal.h
++++ b/avidemux_core/ADM_ffmpeg/libavutil/internal.h
+@@ -34,7 +34,11 @@
+ #include <stdint.h>
+ #include <stddef.h>
+ #include <assert.h>
++//MEANX
++#ifndef ADM_NO_CONFIG_H
+ #include "config.h"
++#endif
++// /MEANX
+ #include "attributes.h"
+ #include "timer.h"
+ 
+@@ -101,6 +105,8 @@
+ #endif
+ 
+ /* Use to export labels from asm. */
++#include "ADM_mangle.h"
++#if 0 // MEANX
+ #define LABEL_MANGLE(a) EXTERN_PREFIX #a
+ 
+ // Use rip-relative addressing if compiling PIC code on x86-64.
+@@ -111,7 +117,7 @@
+ #endif
+ 
+ #define MANGLE(a) EXTERN_PREFIX LOCAL_MANGLE(a)
+-
++#endif // MEANX
+ /* debug stuff */
+ 
+ /* dprintf macros */
+@@ -140,12 +146,14 @@
+ #endif
+ 
+ /* avoid usage of dangerous/inappropriate system functions */
++#if 0 //MEANX
+ #undef  malloc
+ #define malloc please_use_av_malloc
+ #undef  free
+ #define free please_use_av_free
+ #undef  realloc
+ #define realloc please_use_av_realloc
++#endif
+ #undef  time
+ #define time time_is_forbidden_due_to_security_issues
+ #undef  rand

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/intreadwrite.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/intreadwrite.h.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/intreadwrite.h.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -0,0 +1,13 @@
+diff --git a/avidemux_core/ADM_ffmpeg/libavutil/intreadwrite.h b/avidemux_core/ADM_ffmpeg/libavutil/intreadwrite.h
+index 1849a64..d6e2dcb 100644
+--- a/avidemux_core/ADM_ffmpeg/libavutil/intreadwrite.h
++++ b/avidemux_core/ADM_ffmpeg/libavutil/intreadwrite.h
+@@ -20,7 +20,7 @@
+ #define AVUTIL_INTREADWRITE_H
+ 
+ #include <stdint.h>
+-#include "libavutil/avconfig.h"
++#include "ffmpeg_config/libavutil/avconfig.h" //MEANX
+ #include "attributes.h"
+ #include "bswap.h"
+ 

Copied: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/lfg.c.patch (from rev 6829, branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/lfg.c.patch)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/lfg.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/lfg.c.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -0,0 +1,13 @@
+diff --git a/avidemux_core/ADM_ffmpeg/libavutil/lfg.c b/avidemux_core/ADM_ffmpeg/libavutil/lfg.c
+index b5db5a4..8256adc 100644
+--- a/avidemux_core/ADM_ffmpeg/libavutil/lfg.c
++++ b/avidemux_core/ADM_ffmpeg/libavutil/lfg.c
+@@ -39,7 +39,7 @@ void av_cold av_lfg_init(AVLFG *c, unsigned int seed){
+         c->state[i+2]= AV_RL32(tmp+8);
+         c->state[i+3]= AV_RL32(tmp+12);
+     }
+-    c->index=0;
++    c->xindex=0;
+ }
+ 
+ void av_bmg_get(AVLFG *lfg, double out[2])

Copied: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/lfg.h.patch (from rev 6829, branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/lfg.h.patch)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/lfg.h.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/lfg.h.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -0,0 +1,37 @@
+diff --git a/avidemux_core/ADM_ffmpeg/libavutil/lfg.h b/avidemux_core/ADM_ffmpeg/libavutil/lfg.h
+index 0e89ea3..e95b8c2 100644
+--- a/avidemux_core/ADM_ffmpeg/libavutil/lfg.h
++++ b/avidemux_core/ADM_ffmpeg/libavutil/lfg.h
+@@ -24,7 +24,7 @@
+ 
+ typedef struct {
+     unsigned int state[64];
+-    int index;
++    int xindex;
+ } AVLFG;
+ 
+ void av_lfg_init(AVLFG *c, unsigned int seed);
+@@ -36,8 +36,8 @@ void av_lfg_init(AVLFG *c, unsigned int seed);
+  * it may be good enough and faster for your specific use case.
+  */
+ static inline unsigned int av_lfg_get(AVLFG *c){
+-    c->state[c->index & 63] = c->state[(c->index-24) & 63] + c->state[(c->index-55) & 63];
+-    return c->state[c->index++ & 63];
++    c->state[c->xindex & 63] = c->state[(c->xindex-24) & 63] + c->state[(c->xindex-55) & 63];
++    return c->state[c->xindex++ & 63];
+ }
+ 
+ /**
+@@ -46,9 +46,9 @@ static inline unsigned int av_lfg_get(AVLFG *c){
+  * Please also consider av_lfg_get() above, it is faster.
+  */
+ static inline unsigned int av_mlfg_get(AVLFG *c){
+-    unsigned int a= c->state[(c->index-55) & 63];
+-    unsigned int b= c->state[(c->index-24) & 63];
+-    return c->state[c->index++ & 63] = 2*a*b+a+b;
++    unsigned int a= c->state[(c->xindex-55) & 63];
++    unsigned int b= c->state[(c->xindex-24) & 63];
++    return c->state[c->xindex++ & 63] = 2*a*b+a+b;
+ }
+ 
+ /**

Copied: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/libm.h.patch (from rev 6829, branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/libm.h.patch)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/libm.h.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/libm.h.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -0,0 +1,16 @@
+diff --git a/avidemux_core/ADM_ffmpeg/libavutil/libm.h b/avidemux_core/ADM_ffmpeg/libavutil/libm.h
+index c7c28ac..3f6ae07 100644
+--- a/avidemux_core/ADM_ffmpeg/libavutil/libm.h
++++ b/avidemux_core/ADM_ffmpeg/libavutil/libm.h
+@@ -25,7 +25,11 @@
+ #define AVUTIL_LIBM_H
+ 
+ #include <math.h>
++//MEANX
++#ifndef ADM_NO_CONFIG_H
+ #include "config.h"
++#endif
++///MEANX
+ #include "attributes.h"
+ 
+ #if !HAVE_EXP2

Copied: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/mem.c.patch (from rev 6829, branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/mem.c.patch)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/mem.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/mem.c.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -0,0 +1,189 @@
+diff --git a/avidemux_core/ADM_ffmpeg/libavutil/mem.c b/avidemux_core/ADM_ffmpeg/libavutil/mem.c
+index 18fe28b..ad225f2 100644
+--- a/avidemux_core/ADM_ffmpeg/libavutil/mem.c
++++ b/avidemux_core/ADM_ffmpeg/libavutil/mem.c
+@@ -63,88 +63,112 @@ void  free(void *ptr);
+ 
+ void *av_malloc(FF_INTERNAL_MEM_TYPE size)
+ {
+-    void *ptr = NULL;
+-#if CONFIG_MEMALIGN_HACK
+-    long diff;
+-#endif
+-
+-    /* let's disallow possible ambiguous cases */
+-    if(size > (INT_MAX-16) )
+-        return NULL;
+-
+-#if CONFIG_MEMALIGN_HACK
+-    ptr = malloc(size+16);
+-    if(!ptr)
+-        return ptr;
+-    diff= ((-(long)ptr - 1)&15) + 1;
+-    ptr = (char*)ptr + diff;
+-    ((char*)ptr)[-1]= diff;
+-#elif HAVE_POSIX_MEMALIGN
+-    if (posix_memalign(&ptr,16,size))
+-        ptr = NULL;
+-#elif HAVE_MEMALIGN
+-    ptr = memalign(16,size);
+-    /* Why 64?
+-       Indeed, we should align it:
+-         on 4 for 386
+-         on 16 for 486
+-         on 32 for 586, PPro - K6-III
+-         on 64 for K7 (maybe for P3 too).
+-       Because L1 and L2 caches are aligned on those values.
+-       But I don't want to code such logic here!
+-     */
+-     /* Why 16?
+-        Because some CPUs need alignment, for example SSE2 on P4, & most RISC CPUs
+-        it will just trigger an exception and the unaligned load will be done in the
+-        exception handler or it will just segfault (SSE2 on P4).
+-        Why not larger? Because I did not see a difference in benchmarks ...
+-     */
+-     /* benchmarks with P3
+-        memalign(64)+1          3071,3051,3032
+-        memalign(64)+2          3051,3032,3041
+-        memalign(64)+4          2911,2896,2915
+-        memalign(64)+8          2545,2554,2550
+-        memalign(64)+16         2543,2572,2563
+-        memalign(64)+32         2546,2545,2571
+-        memalign(64)+64         2570,2533,2558
+-
+-        BTW, malloc seems to do 8-byte alignment by default here.
+-     */
++#ifdef __APPLE__
++	return malloc(size);
+ #else
+-    ptr = malloc(size);
+-#endif
+-    return ptr;
++	char *c;
++
++	uint64_t l, lorg;
++	uint32_t *backdoor;
++
++	l = (uint64_t)malloc(size + 32);
++
++	// Get next boundary
++	lorg = l;
++	l = (l + 15) & 0xfffffffffffffff0LL;
++	l += 16;
++	c = (char*)l;
++	backdoor = (uint32_t*)(c - 8);
++	*backdoor = (0xdead << 16) + l - lorg;
++	backdoor[1] = size;
++
++	return c;
++ #endif
++
+ }
+ 
+-void *av_realloc(void *ptr, FF_INTERNAL_MEM_TYPE size)
++void *av_realloc(void *ptr, FF_INTERNAL_MEM_TYPE newsize)
+ {
+-#if CONFIG_MEMALIGN_HACK
+-    int diff;
+-#endif
++#ifdef __APPLE__
++	if (!ptr)
++		return av_malloc(newsize);
++	if (!newsize)
++	{
++		av_free(ptr);
++		return NULL;
++	}
++#else
++	void *nalloc;
++
++	if (!ptr)
++		return av_malloc(newsize);
++
++	if (!newsize) 
++	{
++		av_free(ptr);
++		return NULL;
++	}
++
++	// now we either shrink them or expand them
++	// in case of shrink, we do nothing
++	// in case of expand we have to copy
++	// Do copy everytime (slower)
++	uint32_t *backdoor;
++	uint32_t size, offset;
++	char *c = (char*)ptr;
++
++	backdoor = (uint32_t*)ptr;
++	backdoor -= 2;
++
++	assert(((*backdoor) >> 16) == 0xdead);
++
++	offset = backdoor[0] & 0xffff;
++	size = backdoor[1];
++
++	if(size >= newsize) // do nothing
++		return ptr;
++
++	// Allocate a new one
++	nalloc = av_malloc(newsize);
++	memcpy(nalloc, ptr, size);
++	av_free(ptr);
++
++	return nalloc;
++ #endif
+ 
+-    /* let's disallow possible ambiguous cases */
+-    if(size > (INT_MAX-16) )
+-        return NULL;
+ 
+-#if CONFIG_MEMALIGN_HACK
+-    //FIXME this isn't aligned correctly, though it probably isn't needed
+-    if(!ptr) return av_malloc(size);
+-    diff= ((char*)ptr)[-1];
+-    return (char*)realloc((char*)ptr - diff, size + diff) + diff;
+-#else
+-    return realloc(ptr, size);
+-#endif
+ }
+ 
+ void av_free(void *ptr)
+ {
+-    /* XXX: this test should not be needed on most libcs */
+-    if (ptr)
+-#if CONFIG_MEMALIGN_HACK
+-        free((char*)ptr - ((char*)ptr)[-1]);
+-#else
+-        free(ptr);
+-#endif
++#ifdef __APPLE__
++	if (!ptr)
++		return;
++
++	free(ptr);
++ #else
++	uint32_t *backdoor;
++	uint32_t size, offset;
++	char *c = (char*)ptr;
++
++	if (!ptr)
++		return;
++
++	backdoor = (uint32_t*)ptr;
++	backdoor -= 2;
++
++	if (*backdoor == 0xbeefbeef)
++		assert(0);
++
++	assert(((*backdoor) >> 16) == 0xdead);
++
++	offset = backdoor[0] & 0xffff;
++	size = backdoor[1];
++	*backdoor = 0xbeefbeef; // Scratch sig
++
++	free(c - offset);
++ #endif
++	
+ }
+ 
+ void av_freep(void *arg)

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/pixfmt.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/pixfmt.h.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/pixfmt.h.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -0,0 +1,13 @@
+diff --git a/avidemux_core/ADM_ffmpeg/libavutil/pixfmt.h b/avidemux_core/ADM_ffmpeg/libavutil/pixfmt.h
+index 8ec91c8..6882d41 100644
+--- a/avidemux_core/ADM_ffmpeg/libavutil/pixfmt.h
++++ b/avidemux_core/ADM_ffmpeg/libavutil/pixfmt.h
+@@ -29,7 +29,7 @@
+  * header, so it should not be directly included in your projects.
+  */
+ 
+-#include "libavutil/avconfig.h"
++#include "ffmpeg_config/libavutil/avconfig.h" // MEANX
+ 
+ /**
+  * Pixel format. Notes:

Copied: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/timer.h.patch (from rev 6829, branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/timer.h.patch)
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/timer.h.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutil/timer.h.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -0,0 +1,17 @@
+diff --git a/avidemux_core/ADM_ffmpeg/libavutil/timer.h b/avidemux_core/ADM_ffmpeg/libavutil/timer.h
+index cd8fba8..66be371 100644
+--- a/avidemux_core/ADM_ffmpeg/libavutil/timer.h
++++ b/avidemux_core/ADM_ffmpeg/libavutil/timer.h
+@@ -26,7 +26,12 @@
+ 
+ #include <stdlib.h>
+ #include <stdint.h>
++// MEANX
++#ifndef ADM_NO_CONFIG_H
+ #include "config.h"
++#endif
++// MEANX
++
+ 
+ #if   ARCH_ARM
+ #   include "arm/timer.h"

Deleted: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/avutil.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/avutil.h.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/avutil.h.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,18 +0,0 @@
-diff --git a/avidemux_core/ADM_ffmpeg/libavutil/avutil.h b/avidemux_core/ADM_ffmpeg/libavutil/avutil.h
-index 50b29fc..691c5cb 100644
---- a/avidemux_core/ADM_ffmpeg/libavutil/avutil.h
-+++ b/avidemux_core/ADM_ffmpeg/libavutil/avutil.h
-@@ -26,6 +26,13 @@
-  * external API header
-  */
- 
-+/* MEANX
-+ * - */
-+#define ASMALIGN(ZEROBITS) ".p2align " #ZEROBITS "\n\t"
-+/* /MEANX
-+ */
-+
-+
- 
- #define AV_STRINGIFY(s)         AV_TOSTRING(s)
- #define AV_TOSTRING(s) #s

Deleted: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/internal.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/internal.h.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/internal.h.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,49 +0,0 @@
-diff --git a/avidemux_core/ADM_ffmpeg/libavutil/internal.h b/avidemux_core/ADM_ffmpeg/libavutil/internal.h
-index 53d2b94..6cfbc6a 100644
---- a/avidemux_core/ADM_ffmpeg/libavutil/internal.h
-+++ b/avidemux_core/ADM_ffmpeg/libavutil/internal.h
-@@ -34,7 +34,11 @@
- #include <stdint.h>
- #include <stddef.h>
- #include <assert.h>
-+//MEANX
-+#ifndef ADM_NO_CONFIG_H
- #include "config.h"
-+#endif
-+// /MEANX
- #include "attributes.h"
- #include "timer.h"
- 
-@@ -101,6 +105,8 @@
- #endif
- 
- /* Use to export labels from asm. */
-+#include "ADM_mangle.h"
-+#if 0 // MEANX
- #define LABEL_MANGLE(a) EXTERN_PREFIX #a
- 
- // Use rip-relative addressing if compiling PIC code on x86-64.
-@@ -111,7 +117,7 @@
- #endif
- 
- #define MANGLE(a) EXTERN_PREFIX LOCAL_MANGLE(a)
--
-+#endif // MEANX
- /* debug stuff */
- 
- /* dprintf macros */
-@@ -140,12 +146,14 @@
- #endif
- 
- /* avoid usage of dangerous/inappropriate system functions */
-+#if 0 //MEANX
- #undef  malloc
- #define malloc please_use_av_malloc
- #undef  free
- #define free please_use_av_free
- #undef  realloc
- #define realloc please_use_av_realloc
-+#endif
- #undef  time
- #define time time_is_forbidden_due_to_security_issues
- #undef  rand

Deleted: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/lfg.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/lfg.c.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/lfg.c.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,13 +0,0 @@
-diff --git a/avidemux_core/ADM_ffmpeg/libavutil/lfg.c b/avidemux_core/ADM_ffmpeg/libavutil/lfg.c
-index b5db5a4..8256adc 100644
---- a/avidemux_core/ADM_ffmpeg/libavutil/lfg.c
-+++ b/avidemux_core/ADM_ffmpeg/libavutil/lfg.c
-@@ -39,7 +39,7 @@ void av_cold av_lfg_init(AVLFG *c, unsigned int seed){
-         c->state[i+2]= AV_RL32(tmp+8);
-         c->state[i+3]= AV_RL32(tmp+12);
-     }
--    c->index=0;
-+    c->xindex=0;
- }
- 
- void av_bmg_get(AVLFG *lfg, double out[2])

Deleted: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/lfg.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/lfg.h.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/lfg.h.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,37 +0,0 @@
-diff --git a/avidemux_core/ADM_ffmpeg/libavutil/lfg.h b/avidemux_core/ADM_ffmpeg/libavutil/lfg.h
-index 0e89ea3..e95b8c2 100644
---- a/avidemux_core/ADM_ffmpeg/libavutil/lfg.h
-+++ b/avidemux_core/ADM_ffmpeg/libavutil/lfg.h
-@@ -24,7 +24,7 @@
- 
- typedef struct {
-     unsigned int state[64];
--    int index;
-+    int xindex;
- } AVLFG;
- 
- void av_lfg_init(AVLFG *c, unsigned int seed);
-@@ -36,8 +36,8 @@ void av_lfg_init(AVLFG *c, unsigned int seed);
-  * it may be good enough and faster for your specific use case.
-  */
- static inline unsigned int av_lfg_get(AVLFG *c){
--    c->state[c->index & 63] = c->state[(c->index-24) & 63] + c->state[(c->index-55) & 63];
--    return c->state[c->index++ & 63];
-+    c->state[c->xindex & 63] = c->state[(c->xindex-24) & 63] + c->state[(c->xindex-55) & 63];
-+    return c->state[c->xindex++ & 63];
- }
- 
- /**
-@@ -46,9 +46,9 @@ static inline unsigned int av_lfg_get(AVLFG *c){
-  * Please also consider av_lfg_get() above, it is faster.
-  */
- static inline unsigned int av_mlfg_get(AVLFG *c){
--    unsigned int a= c->state[(c->index-55) & 63];
--    unsigned int b= c->state[(c->index-24) & 63];
--    return c->state[c->index++ & 63] = 2*a*b+a+b;
-+    unsigned int a= c->state[(c->xindex-55) & 63];
-+    unsigned int b= c->state[(c->xindex-24) & 63];
-+    return c->state[c->xindex++ & 63] = 2*a*b+a+b;
- }
- 
- /**

Deleted: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/libm.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/libm.h.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/libm.h.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,16 +0,0 @@
-diff --git a/avidemux_core/ADM_ffmpeg/libavutil/libm.h b/avidemux_core/ADM_ffmpeg/libavutil/libm.h
-index c7c28ac..3f6ae07 100644
---- a/avidemux_core/ADM_ffmpeg/libavutil/libm.h
-+++ b/avidemux_core/ADM_ffmpeg/libavutil/libm.h
-@@ -25,7 +25,11 @@
- #define AVUTIL_LIBM_H
- 
- #include <math.h>
-+//MEANX
-+#ifndef ADM_NO_CONFIG_H
- #include "config.h"
-+#endif
-+///MEANX
- #include "attributes.h"
- 
- #if !HAVE_EXP2

Deleted: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/mem.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/mem.c.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/mem.c.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,182 +0,0 @@
-diff --git a/avidemux_core/ADM_ffmpeg/libavutil/mem.c b/avidemux_core/ADM_ffmpeg/libavutil/mem.c
-index 8cad089..8e95a78 100644
---- a/avidemux_core/ADM_ffmpeg/libavutil/mem.c
-+++ b/avidemux_core/ADM_ffmpeg/libavutil/mem.c
-@@ -63,87 +63,110 @@ void  free(void *ptr);
- 
- void *av_malloc(unsigned int size)
- {
--    void *ptr = NULL;
--#if CONFIG_MEMALIGN_HACK
--    long diff;
--#endif
--
--    /* let's disallow possible ambiguous cases */
--    if(size > (INT_MAX-16) )
--        return NULL;
--
--#if CONFIG_MEMALIGN_HACK
--    ptr = malloc(size+16);
--    if(!ptr)
--        return ptr;
--    diff= ((-(long)ptr - 1)&15) + 1;
--    ptr = (char*)ptr + diff;
--    ((char*)ptr)[-1]= diff;
--#elif HAVE_POSIX_MEMALIGN
--    if (posix_memalign(&ptr,16,size))
--        ptr = NULL;
--#elif HAVE_MEMALIGN
--    ptr = memalign(16,size);
--    /* Why 64?
--       Indeed, we should align it:
--         on 4 for 386
--         on 16 for 486
--         on 32 for 586, PPro - K6-III
--         on 64 for K7 (maybe for P3 too).
--       Because L1 and L2 caches are aligned on those values.
--       But I don't want to code such logic here!
--     */
--     /* Why 16?
--        Because some CPUs need alignment, for example SSE2 on P4, & most RISC CPUs
--        it will just trigger an exception and the unaligned load will be done in the
--        exception handler or it will just segfault (SSE2 on P4).
--        Why not larger? Because I did not see a difference in benchmarks ...
--     */
--     /* benchmarks with P3
--        memalign(64)+1          3071,3051,3032
--        memalign(64)+2          3051,3032,3041
--        memalign(64)+4          2911,2896,2915
--        memalign(64)+8          2545,2554,2550
--        memalign(64)+16         2543,2572,2563
--        memalign(64)+32         2546,2545,2571
--        memalign(64)+64         2570,2533,2558
--
--        BTW, malloc seems to do 8-byte alignment by default here.
--     */
-+#ifdef __APPLE__
-+	return malloc(size);
- #else
--    ptr = malloc(size);
-+	char *c;
-+
-+	uint64_t l, lorg;
-+	uint32_t *backdoor;
-+
-+	l = (uint64_t)malloc(size + 32);
-+
-+	// Get next boundary
-+	lorg = l;
-+	l = (l + 15) & 0xfffffffffffffff0LL;
-+	l += 16;
-+	c = (char*)l;
-+	backdoor = (uint32_t*)(c - 8);
-+	*backdoor = (0xdead << 16) + l - lorg;
-+	backdoor[1] = size;
-+
-+	return c;
- #endif
--    return ptr;
- }
- 
--void *av_realloc(void *ptr, unsigned int size)
-+void *av_realloc(void *ptr, unsigned int newsize)
- {
--#if CONFIG_MEMALIGN_HACK
--    int diff;
--#endif
-+#ifdef __APPLE__
-+	if (!ptr)
-+		return av_malloc(newsize);
- 
--    /* let's disallow possible ambiguous cases */
--    if(size > (INT_MAX-16) )
--        return NULL;
-+	if (!newsize)
-+	{
-+		av_free(ptr);
-+		return NULL;
-+	}
- 
--#if CONFIG_MEMALIGN_HACK
--    //FIXME this isn't aligned correctly, though it probably isn't needed
--    if(!ptr) return av_malloc(size);
--    diff= ((char*)ptr)[-1];
--    return (char*)realloc((char*)ptr - diff, size + diff) + diff;
-+	return realloc(ptr, newsize);
- #else
--    return realloc(ptr, size);
-+	void *nalloc;
-+
-+	if (!ptr)
-+		return av_malloc(newsize);
-+
-+	if (!newsize) 
-+	{
-+		av_free(ptr);
-+		return NULL;
-+	}
-+
-+	// now we either shrink them or expand them
-+	// in case of shrink, we do nothing
-+	// in case of expand we have to copy
-+	// Do copy everytime (slower)
-+	uint32_t *backdoor;
-+	uint32_t size, offset;
-+	char *c = (char*)ptr;
-+
-+	backdoor = (uint32_t*)ptr;
-+	backdoor -= 2;
-+
-+	assert(((*backdoor) >> 16) == 0xdead);
-+
-+	offset = backdoor[0] & 0xffff;
-+	size = backdoor[1];
-+
-+	if(size >= newsize) // do nothing
-+		return ptr;
-+
-+	// Allocate a new one
-+	nalloc = av_malloc(newsize);
-+	memcpy(nalloc, ptr, size);
-+	av_free(ptr);
-+
-+	return nalloc;
- #endif
- }
- 
- void av_free(void *ptr)
- {
--    /* XXX: this test should not be needed on most libcs */
--    if (ptr)
--#if CONFIG_MEMALIGN_HACK
--        free((char*)ptr - ((char*)ptr)[-1]);
-+#ifdef __APPLE__
-+	if (!ptr)
-+		return;
-+
-+	free(ptr);
- #else
--        free(ptr);
-+	uint32_t *backdoor;
-+	uint32_t size, offset;
-+	char *c = (char*)ptr;
-+
-+	if (!ptr)
-+		return;
-+
-+	backdoor = (uint32_t*)ptr;
-+	backdoor -= 2;
-+
-+	if (*backdoor == 0xbeefbeef)
-+		assert(0);
-+
-+	assert(((*backdoor) >> 16) == 0xdead);
-+
-+	offset = backdoor[0] & 0xffff;
-+	size = backdoor[1];
-+	*backdoor = 0xbeefbeef; // Scratch sig
-+
-+	free(c - offset);
- #endif
- }
- 

Deleted: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/timer.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/timer.h.patch	2010-12-10 08:06:37 UTC (rev 6829)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/avutils/timer.h.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -1,17 +0,0 @@
-diff --git a/avidemux_core/ADM_ffmpeg/libavutil/timer.h b/avidemux_core/ADM_ffmpeg/libavutil/timer.h
-index cd8fba8..66be371 100644
---- a/avidemux_core/ADM_ffmpeg/libavutil/timer.h
-+++ b/avidemux_core/ADM_ffmpeg/libavutil/timer.h
-@@ -26,7 +26,12 @@
- 
- #include <stdlib.h>
- #include <stdint.h>
-+// MEANX
-+#ifndef ADM_NO_CONFIG_H
- #include "config.h"
-+#endif
-+// MEANX
-+
- 
- #if   ARCH_ARM
- #   include "arm/timer.h"

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/swscale/swscale_template.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/swscale/swscale_template.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/patches/swscale/swscale_template.c.patch	2010-12-10 08:06:40 UTC (rev 6830)
@@ -0,0 +1,13 @@
+diff --git a/avidemux_core/ADM_ffmpeg/libswscale/swscale_template.c b/avidemux_core/ADM_ffmpeg/libswscale/swscale_template.c
+index 34868ac..88575e6 100644
+--- a/avidemux_core/ADM_ffmpeg/libswscale/swscale_template.c
++++ b/avidemux_core/ADM_ffmpeg/libswscale/swscale_template.c
+@@ -951,7 +951,7 @@ static inline void RENAME(yuv2yuv1)(SwsContext *c, const int16_t *lumSrc, const
+ #if COMPILE_TEMPLATE_MMX
+     if(!(c->flags & SWS_BITEXACT)) {
+         long p= 4;
+-        const uint8_t *src[4]= {alpSrc + dstW, lumSrc + dstW, chrSrc + chrDstW, chrSrc + VOFW + chrDstW};
++        const uint8_t *src[4]= {alpSrc + dstW, (uint8_t *)lumSrc + dstW, (uint8_t *)chrSrc + chrDstW, (uint8_t *)chrSrc + VOFW + chrDstW}; // MEANX
+         uint8_t *dst[4]= {aDest, dest, uDest, vDest};
+         x86_reg counter[4]= {dstW, dstW, chrDstW, chrDstW};
+ 



From mean at mail.berlios.de  Fri Dec 10 09:06:44 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 10 Dec 2010 09:06:44 +0100
Subject: [Avidemux-svn-commit] r6831 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src
Message-ID: <20101210080644.93A38480E5F@sheep.berlios.de>

Author: mean
Date: 2010-12-10 09:06:44 +0100 (Fri, 10 Dec 2010)
New Revision: 6831

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt
Log:
[core] update ffmpeg

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt	2010-12-10 08:06:40 UTC (rev 6830)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt	2010-12-10 08:06:44 UTC (rev 6831)
@@ -4,7 +4,7 @@
         ADM_debug.cpp 
         ADM_queue.cpp
 )
-
+include_directories(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core/ADM_ffmpeg/)
 ADD_LIBRARY(ADM_core6 SHARED ${ADM_core_SRCS})
 ADD_TARGET_DEFINITIONS(ADM_core6 ADM_DEBUG FIND_LEAKS)
 



From mean at mail.berlios.de  Fri Dec 10 09:06:45 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 10 Dec 2010 09:06:45 +0100
Subject: [Avidemux-svn-commit] r6832 - in
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config:
	. libavutil
Message-ID: <20101210080645.E3F0F480E5F@sheep.berlios.de>

Author: mean
Date: 2010-12-10 09:06:45 +0100 (Fri, 10 Dec 2010)
New Revision: 6832

Added:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/libavutil/
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/libavutil/avconfig.h
Log:
[core] update ffmpeg

Added: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/libavutil/avconfig.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/libavutil/avconfig.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/ffmpeg_config/libavutil/avconfig.h	2010-12-10 08:06:45 UTC (rev 6832)
@@ -0,0 +1,11 @@
+#include "ADM_coreConfig.h"
+#ifndef AVCONFIG_H_ADM
+#define AVCONFIG_H_ADM
+#ifdef ADM_BIG_ENDIAN
+#define AV_HAVE_BIGENDIAN 1
+#else
+#define AV_HAVE_BIGENDIAN 0
+#endif
+
+#define AV_HAVE_FAST_UNALIGNED 1
+#endif



From mean at mail.berlios.de  Fri Dec 10 09:45:51 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 10 Dec 2010 09:45:51 +0100
Subject: [Avidemux-svn-commit] r6833 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcore
Message-ID: <20101210084551.E46BA480E5F@sheep.berlios.de>

Author: mean
Date: 2010-12-10 09:45:51 +0100 (Fri, 10 Dec 2010)
New Revision: 6833

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcore/CMakeLists.txt
Log:
[avcore] Need avutil (win32)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcore/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcore/CMakeLists.txt	2010-12-10 08:06:45 UTC (rev 6832)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcore/CMakeLists.txt	2010-12-10 08:45:51 UTC (rev 6833)
@@ -5,6 +5,6 @@
 )
 
 ADD_LIBRARY(${ADM_LIB} SHARED ${${ADM_LIB}_SRCS})
-TARGET_LINK_LIBRARIES(${ADM_LIB} ADM_core6)
+TARGET_LINK_LIBRARIES(${ADM_LIB} ADM_core6 ADM_libavutil6)
 
 ADM_INSTALL_LIB(${ADM_LIB} )



From mean at mail.berlios.de  Fri Dec 10 13:01:03 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 10 Dec 2010 13:01:03 +0100
Subject: [Avidemux-svn-commit] r6834 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101210120103.492AE480D2E@sheep.berlios.de>

Author: mean
Date: 2010-12-10 13:01:03 +0100 (Fri, 10 Dec 2010)
New Revision: 6834

Modified:
   branches/avidemux_2.6_branch_mean/cmake/FindYasm.cmake
Log:
[win64] correct yasm flags

Modified: branches/avidemux_2.6_branch_mean/cmake/FindYasm.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/FindYasm.cmake	2010-12-10 08:45:51 UTC (rev 6833)
+++ branches/avidemux_2.6_branch_mean/cmake/FindYasm.cmake	2010-12-10 12:01:03 UTC (rev 6834)
@@ -11,7 +11,11 @@
         MESSAGE(STATUS "Found yasm")
         SET(USE_YASM 1)
         IF(WIN32)
-                SET(YASM_FLAGS -f coff -DPREFIX)
+           IF(ADM_CPU_X86_64)
+                SET(YASM_FLAGS -f win64 -DPREFIX)
+           ELSE(ADM_CPU_X86_64)
+                SET(YASM_FLAGS -f win32 -DPREFIX)
+           ENDIF(ADM_CPU_X86_64)
         ELSE(WIN32)
                 IF(APPLE)
                         SET(YASM_FLAGS -f macho -DPREFIX -DPIC)



From mean at mail.berlios.de  Fri Dec 10 13:10:19 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 10 Dec 2010 13:10:19 +0100
Subject: [Avidemux-svn-commit] r6835 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101210121020.1F932480D2E@sheep.berlios.de>

Author: mean
Date: 2010-12-10 13:10:19 +0100 (Fri, 10 Dec 2010)
New Revision: 6835

Modified:
   branches/avidemux_2.6_branch_mean/cmake/FindYasm.cmake
Log:
[win64] correct yasm flags, try2

Modified: branches/avidemux_2.6_branch_mean/cmake/FindYasm.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/FindYasm.cmake	2010-12-10 12:01:03 UTC (rev 6834)
+++ branches/avidemux_2.6_branch_mean/cmake/FindYasm.cmake	2010-12-10 12:10:19 UTC (rev 6835)
@@ -12,7 +12,7 @@
         SET(USE_YASM 1)
         IF(WIN32)
            IF(ADM_CPU_X86_64)
-                SET(YASM_FLAGS -f win64 -DPREFIX)
+                SET(YASM_FLAGS -f win64 )
            ELSE(ADM_CPU_X86_64)
                 SET(YASM_FLAGS -f win32 -DPREFIX)
            ENDIF(ADM_CPU_X86_64)



From mean at mail.berlios.de  Sat Dec 11 18:04:56 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 11 Dec 2010 18:04:56 +0100
Subject: [Avidemux-svn-commit] r6836 - in branches/avidemux_2.6_branch_mean:
	avidemux/common avidemux_core/ADM_coreMuxer/include
	avidemux_plugins/ADM_muxers/muxerffTS
Message-ID: <20101211170456.ED1A7480EAC@sheep.berlios.de>

Author: mean
Date: 2010-12-11 18:04:56 +0100 (Sat, 11 Dec 2010)
New Revision: 6836

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/include/ADM_muxer.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTS.h
Log:
[muxer] If source is annexB and target is annexB, let it pass through

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp	2010-12-10 12:10:19 UTC (rev 6835)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gui_savenew.cpp	2010-12-11 17:04:56 UTC (rev 6836)
@@ -270,8 +270,16 @@
         video_body->getExtraHeaderData(&extraLen,&extra);
 #warning do something better
         ADM_videoStreamCopy *copy=NULL;
-        if(isH264Compatible(info.fcc) && !extraLen)
+        if(isH264Compatible(info.fcc))
         {
+            if(muxer->preferH264AnnexB())
+            {
+                ADM_info("The video stream is H264\n");
+                ADM_info("The muxer prefers AnnexB H264 bitstream\n");
+            }
+        }
+        if(isH264Compatible(info.fcc) && !extraLen && !muxer->preferH264AnnexB())
+        {
             ADM_info("Probably AnnexB bitstream\n");
             copy=new ADM_videoStreamCopyFromAnnexB(markerA,markerB);
         }else   

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/include/ADM_muxer.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/include/ADM_muxer.h	2010-12-10 12:10:19 UTC (rev 6835)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/include/ADM_muxer.h	2010-12-11 17:04:56 UTC (rev 6836)
@@ -71,6 +71,7 @@
         virtual  bool     updateUI(void);
         virtual  bool     closeUI(void);
         virtual  bool     useGlobalHeader(void) {return false;}
+        virtual  bool     preferH264AnnexB(void) {return false;};
 
 };
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTS.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTS.h	2010-12-10 12:10:19 UTC (rev 6835)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTS.h	2010-12-11 17:04:56 UTC (rev 6836)
@@ -38,6 +38,7 @@
         virtual bool open(const char *file, ADM_videoStream *s,uint32_t nbAudioTrack,ADM_audioStream **a);
         virtual bool save(void) ;
         virtual bool close(void) ;
+        virtual  bool     preferH264AnnexB(void) {return true;};
 
 };
 



From mean at mail.berlios.de  Sat Dec 11 18:04:58 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sat, 11 Dec 2010 18:04:58 +0100
Subject: [Avidemux-svn-commit] r6837 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264
Message-ID: <20101211170458.1C577480EAC@sheep.berlios.de>

Author: mean
Date: 2010-12-11 18:04:57 +0100 (Sat, 11 Dec 2010)
New Revision: 6837

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264/ADM_x264Setup.cpp
Log:
[x264] Double encoder delay to take into account the fact that the source can be field

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264/ADM_x264Setup.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264/ADM_x264Setup.cpp	2010-12-11 17:04:56 UTC (rev 6836)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264/ADM_x264Setup.cpp	2010-12-11 17:04:57 UTC (rev 6837)
@@ -73,9 +73,9 @@
     if(!x264Settings.MaxBFrame)  encoderDelay=0;
     else    
     {
-        if(2>=x264Settings.MaxRefFrames) encoderDelay=f*2;
+        if(2>=x264Settings.MaxRefFrames) encoderDelay=f*2*2;
         else
-                encoderDelay=f*(x264Settings.MaxRefFrames-1);
+                encoderDelay=2*f*(x264Settings.MaxRefFrames-1);
     }
 #define MKPARAM(x,y) {param.x = x264Settings.y;printf("[x264] "#x" = %d\n",param.x);}
 #define MKPARAMF(x,y) {param.x = (float)x264Settings.y / 100; printf("[x264] "#x" = %.2f\n",param.x);}



From mean at mail.berlios.de  Sun Dec 12 11:39:38 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sun, 12 Dec 2010 11:39:38 +0100
Subject: [Avidemux-svn-commit] r6838 - in
	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs: include src
Message-ID: <20101212103938.4590A480F94@sheep.berlios.de>

Author: mean
Date: 2010-12-12 11:39:37 +0100 (Sun, 12 Dec 2010)
New Revision: 6838

Added:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/include/T_progress.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobProgress.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/uiProgress.ui
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/include/T_jobs.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobControl.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt
Log:
[jobs] Skeleton for progress dialog when running jobs

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/include/T_jobs.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/include/T_jobs.h	2010-12-11 17:04:57 UTC (rev 6837)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/include/T_jobs.h	2010-12-12 10:39:37 UTC (rev 6838)
@@ -28,6 +28,7 @@
 }spawnData;
 
 class ADMJob;
+class jobProgress;
 /**
     \class jobWindow
 */
@@ -42,6 +43,7 @@
 protected:
     ADM_commandSocket  mySocket;
     uint32_t    localPort;
+    jobProgress *dialog;
 protected:
     int         getActiveIndex(void)	;
     bool        runOneJob(ADMJob &job)   ;

Added: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/include/T_progress.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/include/T_progress.h	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/include/T_progress.h	2010-12-12 10:39:37 UTC (rev 6838)
@@ -0,0 +1,34 @@
+#ifndef Q_jobProgress_h
+#define Q_jobProgress_h
+#include "string"
+#include <QtGui/QWidget>
+#include "ui_uiProgress.h"
+#include "ADM_default.h"
+using std::string;
+
+/**
+    \class jobProgress
+*/
+class jobProgress   : public QDialog 
+{
+	Q_OBJECT
+protected:
+            uint32_t numberOfJobs;
+            uint32_t currentJob;
+            string   currentOutputFile;
+            uint32_t percent;
+        
+            void     updateUi(void);
+            void     updatePercent(void);
+public:
+                jobProgress(uint32_t nbJobs);
+	virtual     ~jobProgress();
+            void  setCurrentJob(uint32_t job);
+            void  setCurrentOutputName(const string &name);
+            void  setPercent(uint32_t percent);
+protected:
+    Ui_DialogProgress ui;
+public slots:
+};
+#endif	// Q_gui2_h
+

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobControl.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobControl.cpp	2010-12-11 17:04:57 UTC (rev 6837)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobControl.cpp	2010-12-12 10:39:37 UTC (rev 6838)
@@ -12,6 +12,7 @@
  *                                                                         *
  ***************************************************************************/
 #include "T_jobs.h"
+#include "T_progress.h"
 #include "ADM_default.h"
 #include "ADM_coreJobs.h"
 #include "DIA_coreToolkit.h"
@@ -156,6 +157,7 @@
     ADM_info("Socket bound to %d\n",(int)localPort);
     //ADM_socket *n=mySocket.waitForConnect(5000);
     refreshList();
+    dialog=NULL;
 
 }
 /**
@@ -163,7 +165,8 @@
 */
 jobWindow::~jobWindow()
 {
-
+    if(dialog) delete dialog;
+    dialog=NULL;
 }
 /**
 */
@@ -224,7 +227,12 @@
                         break;
             case   JobAction_runNow:
                         {
+                            dialog=new jobProgress(1);
+                            dialog->setCurrentJob(1);
+                            dialog->setCurrentOutputName(j->outputFileName);
                             runOneJob(*j);
+                            delete dialog;
+                            dialog=NULL;
                         }
                         break;
                         
@@ -266,12 +274,21 @@
 void jobWindow::runAllJob(void)
 {
     int n=listOfJob.size();
+    dialog=new jobProgress(n);
+
     for(int i=0;i<n;i++)
     {
             ADMJob *j=&(listOfJob[i]);
+
             if(j->status==ADM_JOB_IDLE)
+            {
+                dialog->setCurrentJob(i);
+                dialog->setCurrentOutputName(j->outputFileName);
                 runOneJob(*j);
+            }
     }
+    delete dialog;
+    dialog=NULL;
     return ;
 }
 #if 0

Added: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobProgress.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobProgress.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobProgress.cpp	2010-12-12 10:39:37 UTC (rev 6838)
@@ -0,0 +1,79 @@
+/**
+    \file   ADM_jobProgress
+    \author mean fixounet at free.Fr (c) 2010
+
+*/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "T_progress.h"
+#include "ADM_default.h"
+
+/**
+    \fn ctor
+*/
+jobProgress::jobProgress(uint32_t nbJobs)
+{
+    numberOfJobs=nbJobs;
+    currentOutputFile=string("");
+    currentJob=0;
+    percent=0;
+    ui.setupUi(this);
+    ui.progressBar->setMinimum(0);
+    ui.progressBar->setMaximum(100);
+    ui.progressBar->setValue(0);
+    ADM_info("Starting progress dialog\n");
+    show();
+}
+/**
+    \fn dtor
+*/
+jobProgress::~jobProgress()
+{
+
+}
+/**
+
+*/
+void  jobProgress::setCurrentJob(uint32_t job)
+{
+    currentJob=job;
+    updateUi();
+}
+/**
+
+*/
+void  jobProgress::setCurrentOutputName(const string &name)
+{
+    currentOutputFile=name;
+    updateUi();
+
+}
+/**
+
+*/
+void  jobProgress::setPercent(uint32_t percent)
+{
+    this->percent=percent;
+    updatePercent();
+}
+/**
+
+*/
+void     jobProgress::updateUi(void)
+{
+    updatePercent();
+}
+/**
+
+*/
+void     jobProgress::updatePercent(void)
+{
+    ui.progressBar->setValue(percent);
+}
+// EOF
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt	2010-12-11 17:04:57 UTC (rev 6837)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/CMakeLists.txt	2010-12-12 10:39:37 UTC (rev 6838)
@@ -9,8 +9,8 @@
 # Executable
 ###########################################
 #
-SET(UI uiJobs.ui)
-SET(headers ../include/T_jobs.h)
+SET(UI uiJobs.ui uiProgress.ui)
+SET(headers ../include/T_jobs.h ../include/T_progress.h)
 QT4_WRAP_UI(ADM_JOBS_headers ${UI})
 QT4_WRAP_CPP(ADM_JOBS_source ${headers}
                 ADM_jobControl.cpp)
@@ -18,6 +18,7 @@
                 ADM_jobs.cpp
                 ADM_jobControl.cpp
                 ADM_runOneJob.cpp
+		ADM_jobProgress.cpp
                 ${ADM_JOBS_headers}
                 ${ADM_JOBS_source}
                 

Added: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/uiProgress.ui
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/uiProgress.ui	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/uiProgress.ui	2010-12-12 10:39:37 UTC (rev 6838)
@@ -0,0 +1,68 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<ui version="4.0">
+ <class>DialogProgress</class>
+ <widget class="QDialog" name="DialogProgress">
+  <property name="windowModality">
+   <enum>Qt::ApplicationModal</enum>
+  </property>
+  <property name="geometry">
+   <rect>
+    <x>0</x>
+    <y>0</y>
+    <width>286</width>
+    <height>110</height>
+   </rect>
+  </property>
+  <property name="windowTitle">
+   <string>Progress</string>
+  </property>
+  <layout class="QHBoxLayout" name="horizontalLayout">
+   <item>
+    <widget class="QSplitter" name="splitter">
+     <property name="orientation">
+      <enum>Qt::Vertical</enum>
+     </property>
+     <widget class="QWidget" name="">
+      <layout class="QGridLayout" name="gridLayout">
+       <item row="0" column="0">
+        <widget class="QLabel" name="label_2">
+         <property name="text">
+          <string>Current job</string>
+         </property>
+        </widget>
+       </item>
+       <item row="0" column="1">
+        <widget class="QLabel" name="labelJobCount">
+         <property name="text">
+          <string>1/1</string>
+         </property>
+        </widget>
+       </item>
+       <item row="1" column="0">
+        <widget class="QLabel" name="label">
+         <property name="text">
+          <string>File being written </string>
+         </property>
+        </widget>
+       </item>
+       <item row="1" column="1">
+        <widget class="QLabel" name="labelOutputFile_2">
+         <property name="text">
+          <string>...</string>
+         </property>
+        </widget>
+       </item>
+      </layout>
+     </widget>
+     <widget class="QProgressBar" name="progressBar">
+      <property name="value">
+       <number>24</number>
+      </property>
+     </widget>
+    </widget>
+   </item>
+  </layout>
+ </widget>
+ <resources/>
+ <connections/>
+</ui>



From mean at mail.berlios.de  Sun Dec 12 11:39:39 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sun, 12 Dec 2010 11:39:39 +0100
Subject: [Avidemux-svn-commit] r6839 - in
	branches/avidemux_2.6_branch_mean/avidemux:
	cli/ADM_userInterfaces/ADM_dialog qt4/ADM_userInterfaces/ADM_dialog
Message-ID: <20101212103939.B999C480F94@sheep.berlios.de>

Author: mean
Date: 2010-12-12 11:39:39 +0100 (Sun, 12 Dec 2010)
New Revision: 6839

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ADM_dialog/DIA_encoding.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.cpp
Log:
[avidemux] Reports progress to jobmanager if we are connected (cli/qt4)

Modified: branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ADM_dialog/DIA_encoding.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ADM_dialog/DIA_encoding.cpp	2010-12-12 10:39:37 UTC (rev 6838)
+++ branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ADM_dialog/DIA_encoding.cpp	2010-12-12 10:39:39 UTC (rev 6839)
@@ -17,7 +17,7 @@
 #include "avidemutils.h"
 #include "ADM_vidMisc.h"
 #include "DIA_encoding_none.h"
-
+extern bool ADM_slaveReportProgress(uint32_t p);
 DIA_encodingCli::DIA_encodingCli( uint64_t fps1000 ) : DIA_encodingBase(fps1000)
 {
 
@@ -55,7 +55,7 @@
     void DIA_encodingCli::setTotalSize(uint64_t size){}
     void DIA_encodingCli::setAudioSize(uint64_t size){}
     void DIA_encodingCli::setVideoSize(uint64_t size){}
-    void DIA_encodingCli::setPercent(uint32_t percent){}
+    void DIA_encodingCli::setPercent(uint32_t percent){ADM_slaveReportProgress(percent);}
     void DIA_encodingCli::setFps(uint32_t fps){}
     void DIA_encodingCli::setFrameCount(uint32_t nb){}
     void DIA_encodingCli::setElapsedTimeMs(uint32_t nb){}

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.cpp	2010-12-12 10:39:37 UTC (rev 6838)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.cpp	2010-12-12 10:39:39 UTC (rev 6839)
@@ -24,7 +24,7 @@
 
 extern void UI_purge(void);
 static int stopReq=0;
-
+extern bool ADM_slaveReportProgress(uint32_t percent);
 encodingWindow::encodingWindow() : QDialog()
  {
 	ui.setupUi(this);
@@ -194,6 +194,7 @@
           ADM_assert(window);
           printf("Percent:%u\n",p);
           WIDGET(progressBar)->setValue(p);
+          ADM_slaveReportProgress(p);
           UI_purge();
 }
 /**



From mean at mail.berlios.de  Sun Dec 12 11:39:40 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sun, 12 Dec 2010 11:39:40 +0100
Subject: [Avidemux-svn-commit] r6840 -
	branches/avidemux_2.6_branch_mean/avidemux/common
Message-ID: <20101212103940.CC033480F94@sheep.berlios.de>

Author: mean
Date: 2010-12-12 11:39:40 +0100 (Sun, 12 Dec 2010)
New Revision: 6840

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_slave.cpp
Log:
[avidemux] Reports progress to jobmanager if we are connected (cli/qt4)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_slave.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_slave.cpp	2010-12-12 10:39:39 UTC (rev 6839)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_slave.cpp	2010-12-12 10:39:40 UTC (rev 6840)
@@ -65,6 +65,10 @@
 {
     if(!mySocket)    return true;
     ADM_info("Report : %d %%\n",percent);
+    ADM_socketMessage msg;
+    msg.setPayloadAsUint32_t(percent);
+    msg.command=ADM_socketCommand_Progress;
+    mySocket->sendMessage(msg);
     return true;
 }
 /**



From mean at mail.berlios.de  Sun Dec 12 11:39:42 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sun, 12 Dec 2010 11:39:42 +0100
Subject: [Avidemux-svn-commit] r6841 - in
	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs: include src
Message-ID: <20101212103942.0EE42480F94@sheep.berlios.de>

Author: mean
Date: 2010-12-12 11:39:41 +0100 (Sun, 12 Dec 2010)
New Revision: 6841

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/include/T_progress.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobControl.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobProgress.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_runOneJob.cpp
Log:
[jobs] Display progress

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/include/T_progress.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/include/T_progress.h	2010-12-12 10:39:40 UTC (rev 6840)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/include/T_progress.h	2010-12-12 10:39:41 UTC (rev 6841)
@@ -19,13 +19,14 @@
             uint32_t percent;
         
             void     updateUi(void);
-            void     updatePercent(void);
+
 public:
                 jobProgress(uint32_t nbJobs);
 	virtual     ~jobProgress();
             void  setCurrentJob(uint32_t job);
             void  setCurrentOutputName(const string &name);
-            void  setPercent(uint32_t percent);
+            void  setPercent(uint32_t percent);
+            void  updatePercent(void);
 protected:
     Ui_DialogProgress ui;
 public slots:

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobControl.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobControl.cpp	2010-12-12 10:39:40 UTC (rev 6840)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobControl.cpp	2010-12-12 10:39:41 UTC (rev 6841)
@@ -228,7 +228,7 @@
             case   JobAction_runNow:
                         {
                             dialog=new jobProgress(1);
-                            dialog->setCurrentJob(1);
+                            dialog->setCurrentJob(0);
                             dialog->setCurrentOutputName(j->outputFileName);
                             runOneJob(*j);
                             delete dialog;

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobProgress.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobProgress.cpp	2010-12-12 10:39:40 UTC (rev 6840)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_jobProgress.cpp	2010-12-12 10:39:41 UTC (rev 6841)
@@ -28,14 +28,15 @@
     ui.progressBar->setMaximum(100);
     ui.progressBar->setValue(0);
     ADM_info("Starting progress dialog\n");
-    show();
+    open();
+    QApplication::processEvents();
 }
 /**
     \fn dtor
 */
 jobProgress::~jobProgress()
 {
-
+    ADM_info("Deleting progress..\n");
 }
 /**
 
@@ -67,6 +68,10 @@
 */
 void     jobProgress::updateUi(void)
 {
+    char buffer[128];
+    sprintf(buffer,"%d/%d",currentJob+1,numberOfJobs);
+    ui.labelJobCount->setText(buffer);
+    ui.labelOutputFile_2->setText(currentOutputFile.c_str());
     updatePercent();
 }
 /**
@@ -75,5 +80,6 @@
 void     jobProgress::updatePercent(void)
 {
     ui.progressBar->setValue(percent);
+    QApplication::processEvents();
 }
 // EOF
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_runOneJob.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_runOneJob.cpp	2010-12-12 10:39:40 UTC (rev 6840)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_jobs/src/ADM_runOneJob.cpp	2010-12-12 10:39:41 UTC (rev 6841)
@@ -12,6 +12,7 @@
  *                                                                         *
  ***************************************************************************/
 #include "T_jobs.h"
+#include "T_progress.h"
 #include "ADM_default.h"
 #include "ADM_coreJobs.h"
 #include "pthread.h"
@@ -57,7 +58,11 @@
     argv[1]=string(str);
     argv[2]=string("--runpy \"")+data->script+string("\" ");
     argv[3]=string("--save \"")+data->outputFile+string("\" ");
+#ifndef __WIN32
     argv[4]=string("--quit > /tmp/prout.log");
+#else
+    argv[4]=string("--quit ");
+#endif
     return spawnProcess(data->exeName,5,argv);
 }
 /**
@@ -81,6 +86,7 @@
             }
             // Everything is fine, give process 1 second to use the stack allocated data....
             ADM_usleep(1000*1000LL);
+            QApplication::processEvents();
             ADM_info("Spawning successfull\n");
             return true;
 }
@@ -162,6 +168,7 @@
                             if(msg.getPayloadAsUint32_t(&v))
                             {
                                     printf("Progress %d %%\n",(int)v);
+                                    dialog->setPercent(v);
                             }else
                             {
                                     ADM_error("Can read End payload   \n");
@@ -171,6 +178,8 @@
                                 break;
             }
         }
+        ADM_assert(dialog);
+        QApplication::processEvents();
         ADM_usleep(1000*1000); // Refresh once per sec
     }
     ADM_info("** End of slave process **\n");



From mean at mail.berlios.de  Tue Dec 14 08:05:30 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 14 Dec 2010 08:05:30 +0100
Subject: [Avidemux-svn-commit] r6842 -
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_mpegdemuxer
Message-ID: <20101214070530.EAE2D480BEA@sheep.berlios.de>

Author: mean
Date: 2010-12-14 08:05:30 +0100 (Tue, 14 Dec 2010)
New Revision: 6842

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer_h264.cpp
Log:
[H264/indexer] Read the whole SPS, not 60 bytes hardcoded. Fix decoding some M2TS

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer_h264.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer_h264.cpp	2010-12-12 10:39:41 UTC (rev 6841)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer_h264.cpp	2010-12-14 07:05:30 UTC (rev 6842)
@@ -143,12 +143,23 @@
               {
                     // Our first frame is here
                     // Important to initialize the mpeg decoder !
-                      uint8_t buffer[60] ; // should be enough
                       uint64_t xA,xR;
                       _run->demuxer->getPos(&xA,&xR);
-                      _run->demuxer->read(buffer,60);
+                      #define SPS_BUFFER_SIZE 512
+                      uint8_t sps[SPS_BUFFER_SIZE];
+                      uint32_t code=0xffff+0xffff0000;
+                      uint8_t *p=sps;
+                        while((code!=1) /*&& pkt->stillOk()*/)
+                        {
+                                uint8_t r=demuxer->read8i();
+                                code=(code<<8)+r;
+                                *p=r;p++;
+                        }
+                        //if(!pkt->stillOk()) break;;
+
+                      int dex=p-sps-3;
                       memset(&spsInfo,0,sizeof(spsInfo));
-                      if (extractSPSInfo(buffer, 60, &spsInfo))
+                      if (extractSPSInfo(sps, dex, &spsInfo))
                       {
 						  _run->imageW = spsInfo.width;
 						  _run->imageH = spsInfo.height;



From mean at mail.berlios.de  Tue Dec 14 08:05:31 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 14 Dec 2010 08:05:31 +0100
Subject: [Avidemux-svn-commit] r6843 -
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor
Message-ID: <20101214070531.D8710480BEA@sheep.berlios.de>

Author: mean
Date: 2010-12-14 08:05:31 +0100 (Tue, 14 Dec 2010)
New Revision: 6843

Added:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor_h264.cpp
Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/CMakeLists.txt
Log:
[H264/info extractor] Use lavcodec to decode SPS as in 2.6, it seems the internal decoder chokes on some SPS

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp	2010-12-14 07:05:30 UTC (rev 6842)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor.cpp	2010-12-14 07:05:31 UTC (rev 6843)
@@ -30,10 +30,9 @@
 #undef printf
 }
 
-#include "ADM_infoExtractor/ADM_h264_tag.h"
 #include "ADM_codecs/ADM_codec.h"
 
-static void refineH264FrameType(uint8_t *head,uint8_t *tail,uint32_t *flags);
+
 /*
     Extract width & height from vol header passed as arg
 
@@ -293,348 +292,6 @@
                  return 0;
 }
 /**
-    \fn unescapeH264
-    \brief Remove escape stuff
-
-*/
-static uint32_t unescapeH264(uint32_t len,uint8_t *in, uint8_t *out)
-{
-  uint32_t outlen=0;
-  uint8_t *tail=in+len;
-    if(len<3) return 0;
-    while(in<tail-3)
-    {
-      if(!in[0]  && !in[1] && in[2]==3)
-      {
-        out[0]=0;
-        out[1]=0;
-        out+=2;
-        outlen+=2;
-        in+=3; 
-      }
-      *out++=*in++;
-      outlen++;
-    }
-    // copy last bytes
-    uint32_t left=tail-in;
-    memcpy(out,in,left);
-    outlen+=left;
-    return outlen;
-    
-}
-
-static uint8_t extractVUIInfo(GetBitContext *s, int *fps1000, int *darNum, int *darDen)
-{
-	*fps1000 = *darNum = *darDen = 0;
-
-	if (get_bits1(s))
-	{
-		unsigned int aspect_ratio_information = get_bits(s, 8);
-
-		if (aspect_ratio_information == 255)
-		{
-			*darNum = get_bits_long(s, 16);
-			*darDen = get_bits_long(s, 16);
-		}
-		else if (aspect_ratio_information < sizeof(pixel_aspect) / sizeof(*pixel_aspect))
-		{
-			*darNum = pixel_aspect[aspect_ratio_information].num;
-			*darDen = pixel_aspect[aspect_ratio_information].den;
-		}
-	}
-
-	if (get_bits1(s))	// overscan
-		get_bits1(s);
-
-	if (get_bits1(s))	// vsp_color
-	{
-		get_bits(s, 4);
-
-		if (get_bits1(s))
-		{
-			get_bits(s, 8);
-			get_bits(s, 8);
-			get_bits(s, 8);
-		}
-	}
-
-	if (get_bits1(s))	// chroma
-	{
-		get_ue_golomb(s);
-		get_ue_golomb(s);
-	}
-
-	if (get_bits1(s))	// timing
-	{
-		uint32_t timeinc_unit = get_bits_long(s, 32);
-		uint32_t timeinc_resolution = get_bits_long(s, 32);
-		uint32_t fixed_fps = get_bits1(s);
-
-		if (timeinc_unit > 0 && timeinc_resolution > 0)
-			*fps1000 = (uint32_t)(((float)timeinc_resolution / (float)timeinc_unit) * 1000);
-
-		if (fixed_fps)
-			*fps1000 /= 2;
-	}
-
-	return 1;
-}
-
-/**
-    \fn extractSPSInfo
-    \brief Extract info from H264 SPS
-    See 7.3.2.1 of 14496-10
-*/
-uint8_t extractSPSInfo(uint8_t *data, uint32_t len, h264SpsInfo *info)
-{
-   GetBitContext s;
-   
-   uint32_t profile,constraint,level,pic_order_cnt_type,w,h, mbh;
-   uint8_t buf[len];
-   uint32_t outlen;
-   uint32_t id,dum;
-   
-           outlen=unescapeH264(len,data,buf);
-           init_get_bits( &s,buf, outlen*8);
-            
-           profile=get_bits(&s,8);
-           constraint=get_bits(&s,8)>>5;
-           level=get_bits(&s,8);
-           id=get_ue_golomb(&s); // Seq parameter set id           
-           printf("[H264]Profile : %u, Level :%u, SPSid:%u\n",profile,level,id);
-           if(profile>=100) // ?? Borrowed from H264.C/FFMPEG
-           {
-              printf("[H264]Warning : High profile\n");
-              if(get_ue_golomb(&s) == 3) //chroma_format_idc
-                get_bits1(&s);  //residual_color_transform_flag
-            get_ue_golomb(&s);  //bit_depth_luma_minus8
-            get_ue_golomb(&s);  //bit_depth_chroma_minus8
-            get_bits1(&s);
-			if (get_bits1(&s))
-				get_bits(&s, 8);
-           }
-           
-
-           info->log2MaxFrameNumber = get_ue_golomb(&s); // log2_max_frame_num_minus4
-           printf("[H264]Log2maxFrame-4:%u\n",info->log2MaxFrameNumber);
-           pic_order_cnt_type=get_ue_golomb(&s);
-           printf("[H264]Pic Order Cnt Type:%u\n",pic_order_cnt_type);
-           if(!pic_order_cnt_type) // pic_order_cnt_type
-           {
-              dum=get_ue_golomb(&s); //log2_max_pic_order_cnt_lsb_minus4
-              printf("[H264]Log2maxPix-4:%u\n",dum);
-           }else
-           {
-             if(pic_order_cnt_type==1)
-             {
-                 get_bits1(&s);   //delta_pic_order_always_zero_flag
-                 get_se_golomb(&s);   //offset_for_non_ref_pic
-                 get_se_golomb(&s);  // offset_for_top_to_bottom_field
-                 int i=get_ue_golomb(&s);  //num_ref_frames_in_pic_order_cnt_cycle
-
-                 for(int j=0;j<i;j++)
-                 {
-                      get_se_golomb(&s);
-                 }
-             }else if(pic_order_cnt_type!=2)
-             {
-               printf("Error in SPS\n");
-               return 0;
-             }
-           }
-           dum=get_ue_golomb(&s);     //num_ref_frames
-           printf("[H264] # of ref frames : %u\n",dum);
-           get_bits1(&s);         // gaps_in_frame_num_value_allowed_flag
-		   w = get_ue_golomb(&s) + 1;   //pic_width_in_mbs_minus1
-
-		   mbh = get_ue_golomb(&s) + 1;
-		   info->frameMbsOnlyFlag = get_bits1(&s);
-		   h = (2 - info->frameMbsOnlyFlag) * mbh;   //pic_height_in_mbs_minus1
-
-           printf("[H264] Width in mb -1  :%d\n",w); 
-           printf("[H264] Height in mb -1 :%d\n", h);
-
-		   info->width = w * 16;
-		   info->height = h * 16;
-           
-		   if (!info->frameMbsOnlyFlag)
-			   get_bits1(&s);
-
-		   get_bits1(&s);
-
-		   if(get_bits1(&s))
-		   {
-			   get_ue_golomb(&s);
-			   get_ue_golomb(&s);
-			   get_ue_golomb(&s);
-			   get_ue_golomb(&s);
-		   }
-
-		   if(get_bits1(&s))
-			   extractVUIInfo(&s, &(info->fps1000), &(info->darNum), &(info->darDen));
-
-           return 1;
-}
-/**
-      \fn extractH264FrameType
-      \brief return frametype in flags (KEY_FRAME or 0). To be used only with  mkv/mp4 nal type (i.e. no startcode)
-      
-*/
-uint8_t extractH264FrameType(uint32_t nalSize,uint8_t *buffer,uint32_t len,uint32_t *flags)
-{
-  uint8_t *head=buffer, *tail=buffer+len;
-  uint8_t stream;
-  
-  uint32_t val,hnt;  
-  
-// FIXME :  no startcode only !
-  
-  while(head+4<tail)
-  {
-    
-              uint32_t length=(head[0]<<24) + (head[1]<<16) +(head[2]<<8)+(head[3]);
-              if(length>len||length<6)
-              {
-                printf("Warning , incomplete nal (%u/%u),(%0x/%0x)\n",length,len,length,len);
-                *flags=0;
-                return 0;
-              }
-              head+=4; // Skip nal lenth
-              length-=4;
-              stream=*(head++)&0x1F;
-                switch(stream)
-                {
-                  case NAL_IDR: 
-                                  *flags=AVI_KEY_FRAME;
-                                  
-                                  return 1;
-                                  break; 
-                  case NAL_NON_IDR: 
-                                  refineH264FrameType(head,tail,flags);
-                                  return 1;
-                                  break;
-                  default:
-                          printf("??0x%x\n",stream);
-                          head+=length-5;
-                          continue;
-                }
-  }
-  printf("No stream\n");
-  return 0;
-}
-
-/**
-      \fn extractH264FrameType_startCode
-      \brief return frametype in flags (KEY_FRAME or 0). To be used only with  avi / mpeg TS nal type (i.e. with startcode)
-      
-*/
-uint8_t extractH264FrameType_startCode(uint32_t nalSize,uint8_t *buffer,uint32_t len,uint32_t *flags)
-{
-  uint8_t *head=buffer, *tail=buffer+len;
-  uint8_t stream;
-  uint32_t val,hnt;
-  
-  while(head+4<tail)
-  {
-          // Search startcode
-      
-                hnt=(head[0]<<24) + (head[1]<<16) +(head[2]<<8)+(head[3]);
-                head+=4;
-                while((hnt!=1) && head<tail)
-                {
-
-                        hnt<<=8;
-                        val=*head++;
-                        hnt+=val;
-                }
-                if(head>=tail) break;
-                stream=*(head++) &0x1f;
-                switch(stream)
-                {
-                  case NAL_IDR: 
-                                  *flags=AVI_KEY_FRAME;
-                                 // printf("IDR\n");
-                                  return 1;
-                                  break; 
-                  case NAL_NON_IDR: 
-                                  refineH264FrameType(head,tail,flags);
-                                  return 1;
-                                  break;
-                  default:
-                          printf("??0x%x\n",stream);
-                          continue;
-                }
-  }
-  printf("No stream\n");
-  return 0;
-}
-/**
-    \fn refineH264FrameType
-    \brief Try to detect B slice, warning the stream is not escaped!
-*/
-void refineH264FrameType(uint8_t *head,uint8_t *tail,uint32_t *flags)
-{
-GetBitContext s;
-uint32_t sliceType;
-            *flags=0;
-            init_get_bits(&s,head, (tail-head)*8);
-            get_ue_golomb(&s);
-            sliceType= get_ue_golomb(&s);
-            if(sliceType > 9) 
-            {
-              printf("Weird Slice %d\n",sliceType);
-              return ;
-            }
-            if(sliceType > 4)
-                sliceType -= 5;
-            if(sliceType==3) *flags=AVI_B_FRAME;  
-}
-
-int getH264SliceHeader(uint8_t *buffer, int length, h264SpsInfo *spsInfo, h264SliceHeader *sliceHeader)
-{
-	int sliceType;
-	GetBitContext bc;
-
-	init_get_bits(&bc, buffer, length * 8);
-	get_ue_golomb(&bc);	// pps_id
-
-	sliceType = get_ue_golomb(&bc);
-
-	if (sliceType > 9) 
-	{
-		printf("Slice type too large: %d\n", sliceType);
-		return -1;
-	}
-	else
-	{
-		if (sliceType == 0 || sliceType == 3 || sliceType == 5 || sliceType == 8)
-			sliceHeader->sliceType = AVI_P_FRAME;
-		else if (sliceType == 1 || sliceType == 6)
-			sliceHeader->sliceType = AVI_B_FRAME;
-		else
-			sliceHeader->sliceType = AVI_KEY_FRAME;
-	}
-
-	sliceHeader->frameNumber = get_bits(&bc, spsInfo->log2MaxFrameNumber);
-
-	if (spsInfo->frameMbsOnlyFlag)
-		sliceHeader->pictureType = FRAME;
-	else
-	{
-		if(get_bits1(&bc))	// field_pic_flag
-		{
-			if (get_bits1(&bc))
-				sliceHeader->pictureType = TOP_FIELD;
-			else
-				sliceHeader->pictureType = BOTTOM_FIELD;
-		}
-		else
-			sliceHeader->pictureType = FRAME;
-	}
-
-	return 1;
-}
-/**
     \fn ADM_searchVop
 
  Search a start vop in it

Added: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor_h264.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor_h264.cpp	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/ADM_infoextractor_h264.cpp	2010-12-14 07:05:31 UTC (rev 6843)
@@ -0,0 +1,483 @@
+/***************************************************************************
+                          ADM_infoextractor
+                             -------------------
+           - extract additionnal info from header (mp4/h263)                  
+**************************************************************************/
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "ADM_default.h"
+#include "ADM_editor/ADM_Video.h"
+
+#include "fourcc.h"
+#include "ADM_inputs/ADM_mp4/ADM_mp4.h"
+#include "ADM_video/ADM_videoInfoExtractor.h"
+
+#include "ADM_osSupport/ADM_debugID.h"
+#define MODULE_NAME MODULE_3GP
+#include "ADM_osSupport/ADM_debug.h"
+
+extern "C"
+{
+#include "ADM_libraries/ffmpeg/config.h"
+#include "libavcodec/get_bits.h"
+#include "libavcodec/golomb.h"
+#include "libavcodec/ff_spsinfo.h"
+#include "libavcodec/parser.h"
+#include "libavcodec/avcodec.h"
+extern int ff_h264_info(AVCodecParserContext *parser,ffSpsInfo *ndo);
+
+#undef printf
+}
+
+#include "ADM_infoExtractor/ADM_h264_tag.h"
+#include "ADM_codecs/ADM_codec.h"
+
+static void refineH264FrameType(uint8_t *head,uint8_t *tail,uint32_t *flags);
+
+/**
+    \fn unescapeH264
+    \brief Remove escape stuff
+
+*/
+static uint32_t unescapeH264(uint32_t len,uint8_t *in, uint8_t *out)
+{
+  uint32_t outlen=0;
+  uint8_t *tail=in+len;
+    if(len<3) return 0;
+    while(in<tail-3)
+    {
+      if(!in[0]  && !in[1] && in[2]==3)
+      {
+        out[0]=0;
+        out[1]=0;
+        out+=2;
+        outlen+=2;
+        in+=3; 
+      }
+      *out++=*in++;
+      outlen++;
+    }
+    // copy last bytes
+    uint32_t left=tail-in;
+    memcpy(out,in,left);
+    outlen+=left;
+    return outlen;
+    
+}
+
+static uint8_t extractVUIInfo(GetBitContext *s, int *fps1000, int *darNum, int *darDen)
+{
+	*fps1000 = *darNum = *darDen = 0;
+
+	if (get_bits1(s))
+	{
+		unsigned int aspect_ratio_information = get_bits(s, 8);
+
+		if (aspect_ratio_information == 255)
+		{
+			*darNum = get_bits_long(s, 16);
+			*darDen = get_bits_long(s, 16);
+		}
+		else if (aspect_ratio_information < sizeof(pixel_aspect) / sizeof(*pixel_aspect))
+		{
+			*darNum = pixel_aspect[aspect_ratio_information].num;
+			*darDen = pixel_aspect[aspect_ratio_information].den;
+		}
+	}
+
+	if (get_bits1(s))	// overscan
+		get_bits1(s);
+
+	if (get_bits1(s))	// vsp_color
+	{
+		get_bits(s, 4);
+
+		if (get_bits1(s))
+		{
+			get_bits(s, 8);
+			get_bits(s, 8);
+			get_bits(s, 8);
+		}
+	}
+
+	if (get_bits1(s))	// chroma
+	{
+		get_ue_golomb(s);
+		get_ue_golomb(s);
+	}
+
+	if (get_bits1(s))	// timing
+	{
+		uint32_t timeinc_unit = get_bits_long(s, 32);
+		uint32_t timeinc_resolution = get_bits_long(s, 32);
+		uint32_t fixed_fps = get_bits1(s);
+
+		if (timeinc_unit > 0 && timeinc_resolution > 0)
+			*fps1000 = (uint32_t)(((float)timeinc_resolution / (float)timeinc_unit) * 1000);
+
+		if (fixed_fps)
+			*fps1000 /= 2;
+	}
+
+	return 1;
+}
+
+/**
+    \fn extractSPSInfo
+    \brief Extract info from H264 SPS
+    See 7.3.2.1 of 14496-10
+*/
+uint8_t extractSPSInfo_internal(uint8_t *data, uint32_t len, h264SpsInfo *info)
+{
+   GetBitContext s;
+   
+   uint32_t profile,constraint,level,pic_order_cnt_type,w,h, mbh;
+   uint8_t buf[len];
+   uint32_t outlen;
+   uint32_t id,dum;
+   
+           outlen=unescapeH264(len,data,buf);
+           init_get_bits( &s,buf, outlen*8);
+            
+           profile=get_bits(&s,8);
+           constraint=get_bits(&s,8)>>5;
+           level=get_bits(&s,8);
+           id=get_ue_golomb(&s); // Seq parameter set id           
+           printf("[H264]Profile : %u, Level :%u, SPSid:%u\n",profile,level,id);
+           if(profile>=100) // ?? Borrowed from H264.C/FFMPEG
+           {
+              printf("[H264]Warning : High profile\n");
+              if(get_ue_golomb(&s) == 3) //chroma_format_idc
+                get_bits1(&s);  //residual_color_transform_flag
+            get_ue_golomb(&s);  //bit_depth_luma_minus8
+            get_ue_golomb(&s);  //bit_depth_chroma_minus8
+            get_bits1(&s);
+			if (get_bits1(&s))
+				get_bits(&s, 8);
+           }
+           
+
+           info->log2MaxFrameNumber = get_ue_golomb(&s); // log2_max_frame_num_minus4
+           printf("[H264]Log2maxFrame-4:%u\n",info->log2MaxFrameNumber);
+           pic_order_cnt_type=get_ue_golomb(&s);
+           printf("[H264]Pic Order Cnt Type:%u\n",pic_order_cnt_type);
+           if(!pic_order_cnt_type) // pic_order_cnt_type
+           {
+              dum=get_ue_golomb(&s); //log2_max_pic_order_cnt_lsb_minus4
+              printf("[H264]Log2maxPix-4:%u\n",dum);
+           }else
+           {
+             if(pic_order_cnt_type==1)
+             {
+                 get_bits1(&s);   //delta_pic_order_always_zero_flag
+                 get_se_golomb(&s);   //offset_for_non_ref_pic
+                 get_se_golomb(&s);  // offset_for_top_to_bottom_field
+                 int i=get_ue_golomb(&s);  //num_ref_frames_in_pic_order_cnt_cycle
+
+                 for(int j=0;j<i;j++)
+                 {
+                      get_se_golomb(&s);
+                 }
+             }else if(pic_order_cnt_type!=2)
+             {
+               printf("Error in SPS\n");
+               return 0;
+             }
+           }
+           dum=get_ue_golomb(&s);     //num_ref_frames
+           printf("[H264] # of ref frames : %u\n",dum);
+           get_bits1(&s);         // gaps_in_frame_num_value_allowed_flag
+		   w = get_ue_golomb(&s) + 1;   //pic_width_in_mbs_minus1
+
+		   mbh = get_ue_golomb(&s) + 1;
+		   info->frameMbsOnlyFlag = get_bits1(&s);
+		   h = (2 - info->frameMbsOnlyFlag) * mbh;   //pic_height_in_mbs_minus1
+
+           printf("[H264] Width in mb -1  :%d\n",w); 
+           printf("[H264] Height in mb -1 :%d\n", h);
+
+		   info->width = w * 16;
+		   info->height = h * 16;
+           
+		   if (!info->frameMbsOnlyFlag)
+			   get_bits1(&s);
+
+		   get_bits1(&s);
+
+		   if(get_bits1(&s))
+		   {
+			   get_ue_golomb(&s);
+			   get_ue_golomb(&s);
+			   get_ue_golomb(&s);
+			   get_ue_golomb(&s);
+		   }
+
+		   if(get_bits1(&s))
+			   extractVUIInfo(&s, &(info->fps1000), &(info->darNum), &(info->darDen));
+
+           return 1;
+}
+/**
+      \fn extractH264FrameType
+      \brief return frametype in flags (KEY_FRAME or 0). To be used only with  mkv/mp4 nal type (i.e. no startcode)
+      
+*/
+uint8_t extractH264FrameType(uint32_t nalSize,uint8_t *buffer,uint32_t len,uint32_t *flags)
+{
+  uint8_t *head=buffer, *tail=buffer+len;
+  uint8_t stream;
+  
+  uint32_t val,hnt;  
+  
+// FIXME :  no startcode only !
+  
+  while(head+4<tail)
+  {
+    
+              uint32_t length=(head[0]<<24) + (head[1]<<16) +(head[2]<<8)+(head[3]);
+              if(length>len||length<6)
+              {
+                printf("Warning , incomplete nal (%u/%u),(%0x/%0x)\n",length,len,length,len);
+                *flags=0;
+                return 0;
+              }
+              head+=4; // Skip nal lenth
+              length-=4;
+              stream=*(head++)&0x1F;
+                switch(stream)
+                {
+                  case NAL_IDR: 
+                                  *flags=AVI_KEY_FRAME;
+                                  
+                                  return 1;
+                                  break; 
+                  case NAL_NON_IDR: 
+                                  refineH264FrameType(head,tail,flags);
+                                  return 1;
+                                  break;
+                  default:
+                          printf("??0x%x\n",stream);
+                          head+=length-5;
+                          continue;
+                }
+  }
+  printf("No stream\n");
+  return 0;
+}
+
+/**
+      \fn extractH264FrameType_startCode
+      \brief return frametype in flags (KEY_FRAME or 0). To be used only with  avi / mpeg TS nal type (i.e. with startcode)
+      
+*/
+uint8_t extractH264FrameType_startCode(uint32_t nalSize,uint8_t *buffer,uint32_t len,uint32_t *flags)
+{
+  uint8_t *head=buffer, *tail=buffer+len;
+  uint8_t stream;
+  uint32_t val,hnt;
+  
+  while(head+4<tail)
+  {
+          // Search startcode
+      
+                hnt=(head[0]<<24) + (head[1]<<16) +(head[2]<<8)+(head[3]);
+                head+=4;
+                while((hnt!=1) && head<tail)
+                {
+
+                        hnt<<=8;
+                        val=*head++;
+                        hnt+=val;
+                }
+                if(head>=tail) break;
+                stream=*(head++) &0x1f;
+                switch(stream)
+                {
+                  case NAL_IDR: 
+                                  *flags=AVI_KEY_FRAME;
+                                 // printf("IDR\n");
+                                  return 1;
+                                  break; 
+                  case NAL_NON_IDR: 
+                                  refineH264FrameType(head,tail,flags);
+                                  return 1;
+                                  break;
+                  default:
+                          printf("??0x%x\n",stream);
+                          continue;
+                }
+  }
+  printf("No stream\n");
+  return 0;
+}
+/**
+    \fn refineH264FrameType
+    \brief Try to detect B slice, warning the stream is not escaped!
+*/
+void refineH264FrameType(uint8_t *head,uint8_t *tail,uint32_t *flags)
+{
+GetBitContext s;
+uint32_t sliceType;
+            *flags=0;
+            init_get_bits(&s,head, (tail-head)*8);
+            get_ue_golomb(&s);
+            sliceType= get_ue_golomb(&s);
+            if(sliceType > 9) 
+            {
+              printf("Weird Slice %d\n",sliceType);
+              return ;
+            }
+            if(sliceType > 4)
+                sliceType -= 5;
+            if(sliceType==3) *flags=AVI_B_FRAME;  
+}
+#if 0
+int getH264SliceHeader(uint8_t *buffer, int length, h264SpsInfo *spsInfo, h264SliceHeader *sliceHeader)
+{
+	int sliceType;
+	GetBitContext bc;
+
+	init_get_bits(&bc, buffer, length * 8);
+	get_ue_golomb(&bc);	// pps_id
+
+	sliceType = get_ue_golomb(&bc);
+
+	if (sliceType > 9) 
+	{
+		printf("Slice type too large: %d\n", sliceType);
+		return -1;
+	}
+	else
+	{
+		if (sliceType == 0 || sliceType == 3 || sliceType == 5 || sliceType == 8)
+			sliceHeader->sliceType = AVI_P_FRAME;
+		else if (sliceType == 1 || sliceType == 6)
+			sliceHeader->sliceType = AVI_B_FRAME;
+		else
+			sliceHeader->sliceType = AVI_KEY_FRAME;
+	}
+
+	sliceHeader->frameNumber = get_bits(&bc, spsInfo->log2MaxFrameNumber);
+
+	if (spsInfo->frameMbsOnlyFlag)
+		sliceHeader->pictureType = FRAME;
+	else
+	{
+		if(get_bits1(&bc))	// field_pic_flag
+		{
+			if (get_bits1(&bc))
+				sliceHeader->pictureType = TOP_FIELD;
+			else
+				sliceHeader->pictureType = BOTTOM_FIELD;
+		}
+		else
+			sliceHeader->pictureType = FRAME;
+	}
+
+	return 1;
+}
+#endif
+
+/**
+        \fn extractSPSInfo2
+        \brief Same as extractSPSInfo, but using libavcodec
+*/
+#define ADM_info printf
+#define ADM_warning printf
+#define ADM_error printf
+uint8_t extractSPSInfo_lavcodec (uint8_t * data, uint32_t len, h264SpsInfo *spsinfo)
+{
+    static const uint8_t sig[5]={0,0,0,1,0};
+    uint32_t myLen=len+5+5+FF_INPUT_BUFFER_PADDING_SIZE;
+    uint8_t myData[myLen];
+    bool r=false;
+
+    memset(myData,myLen,1);
+    mixDump(data,len);
+    // put dummy SPS tag + dummy filler at the end
+    // so that lavcodec can split it
+    memcpy(myData,sig,5);
+    memcpy(myData+5,data,len);
+    memcpy(myData+5+len,sig,5);
+    myData[4]=NAL_SPS;
+    myData[5+len+4]=NAL_FILLER;
+    
+    
+    // 1-Create parser
+    AVCodecParserContext *parser=av_parser_init(CODEC_ID_H264);
+    AVCodecContext *ctx=NULL; 
+    AVCodec *codec=NULL;
+    uint8_t *d=NULL;
+  
+    if(!parser)
+    {
+        ADM_error("cannot create h264 parser\n");
+        goto theEnd;
+    }
+    ADM_info("Parser created\n");
+    codec=avcodec_find_decoder(CODEC_ID_H264);
+    if(!codec)
+    {
+        ADM_error("cannot create h264 codec\n");
+        goto theEnd;
+    }
+    ADM_info("Codec created\n");
+    ctx=avcodec_alloc_context();
+   if (avcodec_open(ctx, codec) < 0)  
+   {
+        ADM_error("cannot create h264 context\n");
+        goto theEnd;
+    }
+    ADM_info("Context created\n");
+    //2- Parse, let's add SPS prefix + Filler postfix to make life easier for libavcodec parser
+    ctx->extradata=myData;
+    ctx->extradata_size=myLen;
+     {
+         uint8_t *outptr=NULL;
+         int outsize=0;
+         int consumed = av_parser_parse2(parser, ctx, 
+                                      &outptr, &outsize,
+                                      d, 0,
+                                      0, 0,0);
+    }
+    ADM_info("Width  : %d\n",ctx->width);
+    ADM_info("Height : %d\n",ctx->height);
+    {
+        ffSpsInfo nfo;
+        if(!ff_h264_info(parser,&nfo))
+        {
+            ADM_error("Cannot get sps info from lavcodec\n");
+            r=false;
+            goto theEnd;
+        }
+        ADM_info("Width2 : %d\n",nfo.width);
+        ADM_info("Height2: %d\n",nfo.height);
+        #define CPY(x) spsinfo->x=nfo.x
+        CPY(width);
+        CPY(height);
+        CPY(fps1000);
+//        CPY(hasStructInfo);
+//        CPY(CpbDpbToSkip);
+        CPY(darNum);
+        CPY(darDen);
+        r=true;
+     }
+    // cleanup
+theEnd:
+    if(ctx)
+        avcodec_close(ctx);
+    if(parser)
+        av_parser_close(parser);
+    return r;
+}
+uint8_t extractSPSInfo(uint8_t *data, uint32_t len, h264SpsInfo *info)
+{
+    return extractSPSInfo_lavcodec(data,len,info);
+    //return extractSPSInfo_internal(data,len,info);
+}

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/CMakeLists.txt
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/CMakeLists.txt	2010-12-14 07:05:30 UTC (rev 6842)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_infoExtractor/CMakeLists.txt	2010-12-14 07:05:31 UTC (rev 6843)
@@ -1,5 +1,7 @@
 SET(ADM_infoExtractor_SRCS 
-	ADM_infoextractor.cpp)
+	ADM_infoextractor.cpp
+	ADM_infoextractor_h264.cpp)
 
 ADD_ADM_LIB_ALL_TARGETS(ADM_infoExtractor ${ADM_infoExtractor_SRCS})
-ADD_SOURCE_CFLAGS(ADM_infoextractor.cpp "-I${CMAKE_BINARY_DIR}/avidemux -DHAVE_AV_CONFIG_H")
\ No newline at end of file
+ADD_SOURCE_CFLAGS(ADM_infoextractor.cpp "-I${CMAKE_BINARY_DIR}/avidemux -DHAVE_AV_CONFIG_H")
+ADD_SOURCE_CFLAGS(ADM_infoextractor_h264.cpp "-I${CMAKE_BINARY_DIR}/avidemux -DHAVE_AV_CONFIG_H")



From mean at mail.berlios.de  Tue Dec 14 08:05:32 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 14 Dec 2010 08:05:32 +0100
Subject: [Avidemux-svn-commit] r6844 -
	branches/avidemux_2.5_branch_gruntster/cmake/patches
Message-ID: <20101214070532.D65C2480BEA@sheep.berlios.de>

Author: mean
Date: 2010-12-14 08:05:32 +0100 (Tue, 14 Dec 2010)
New Revision: 6844

Added:
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ff_spsinfo.h.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264_parser.c.patch
Log:
[lavcodec] Export function to get internal info about SPS through h264_parser

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ff_spsinfo.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ff_spsinfo.h.patch	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ff_spsinfo.h.patch	2010-12-14 07:05:32 UTC (rev 6844)
@@ -0,0 +1,22 @@
+Index: libavcodec/ff_spsinfo.h
+===================================================================
+--- libavcodec/ff_spsinfo.h	(revision 0)
++++ libavcodec/ff_spsinfo.h	(revision 0)
+@@ -0,0 +1,17 @@
++#ifndef FF_SPS_INFO_H
++#define FF_SPS_INFO_H
++
++typedef struct
++{
++	int width;
++	int height;
++	int fps1000;
++	int darNum;
++	int darDen;
++	int hasStructInfo;
++	int CpbDpbToSkip;
++}ffSpsInfo;
++
++
++#endif
++

Added: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264_parser.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264_parser.c.patch	                        (rev 0)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264_parser.c.patch	2010-12-14 07:05:32 UTC (rev 6844)
@@ -0,0 +1,59 @@
+Index: libavcodec/h264_parser.c
+===================================================================
+--- libavcodec/h264_parser.c	(revision 25831)
++++ libavcodec/h264_parser.c	(working copy)
+@@ -30,9 +30,54 @@
+ #include "h264data.h"
+ #include "golomb.h"
+ 
++#include "ff_spsinfo.h" // MEANX
+ #include <assert.h>
++ // MEANX
++int ff_h264_info(AVCodecParserContext *parser,ffSpsInfo *info);
++/**
++    \fn AVCodecParserContext
++*/
++int ff_h264_info(AVCodecParserContext *parser,ffSpsInfo *info)
++{
++    H264Context *ctx = parser->priv_data;
++    memset(info,0,sizeof(*info));
++    if(!ctx->sps.mb_width || !ctx->sps.mb_height)
++    {
++        return 0;
++    }
++    info->width=ctx->sps.mb_width  * 16;
++    info->height=(2-ctx->sps.frame_mbs_only_flag)*ctx->sps.mb_height * 16;
++    if(ctx->sps.timing_info_present_flag)
++    {
++            float scale=ctx->sps.time_scale ;
++            float ticks=ctx->sps.num_units_in_tick;
++            info->fps1000 =  (uint32_t) ((scale/ticks) *    1000.);
++#undef printf
++            printf("Scale : %d, tick=%d, fps=%d\n",(int)scale,(int)ticks,(int)info->fps1000);
++    }else
++    {
++            printf("[H264] No timing information\n");
++            info->fps1000=25000;
++    }
++    // D.2.2 SEI Timing present if CpbDbpDelayPresentFlag=1 or pictStructPresent=1
++    // CpbDbpDelayPresentFlag =1 if nal_hdr or vcl_hrd or ???
++    int f=ctx->sps.nal_hrd_parameters_present_flag | ctx->sps.vcl_hrd_parameters_present_flag;
++    info->hasStructInfo=f | ctx->sps.pic_struct_present_flag;;
++    // While decoding SEI, if CpbDpbDelaysPresentFlags is there we skip cpb_removal_delay + dpb_output_delay
+ 
++    info->CpbDpbToSkip=0;
++    if(f)
++    {
++        info->CpbDpbToSkip=ctx->sps.cpb_removal_delay_length+ctx->sps.dpb_output_delay_length;
++    }
++#warning fixme sar vs dar
++    info->darNum=ctx->sps.sar.num;
++    info->darDen=ctx->sps.sar.den;
++    return 1;
++}
++// /MEANX
+ 
++
+ int ff_h264_find_frame_end(H264Context *h, const uint8_t *buf, int buf_size)
+ {
+     int i;



From mean at mail.berlios.de  Wed Dec 15 19:09:22 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 15 Dec 2010 19:09:22 +0100
Subject: [Avidemux-svn-commit] r6845 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS
Message-ID: <20101215180923.3C4D7480D3B@sheep.berlios.de>

Author: mean
Date: 2010-12-15 19:09:22 +0100 (Wed, 15 Dec 2010)
New Revision: 6845

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsIndexH264.cpp
Log:
[H264 Indexer] Fix SEI with short startcode (BR_dkn.m2ts)

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsIndexH264.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsIndexH264.cpp	2010-12-14 07:05:32 UTC (rev 6844)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/ADM_tsIndexH264.cpp	2010-12-15 18:09:22 UTC (rev 6845)
@@ -155,7 +155,7 @@
           {
             SEI_nal.empty();
             uint32_t code=0xffff+0xffff0000;
-            while((code!=1) && pkt->stillOk())
+            while(((code&0xffffff)!=1) && pkt->stillOk())
             {
                     uint8_t r=pkt->readi8();
                     code=(code<<8)+r;
@@ -227,7 +227,7 @@
                         // Load the whole NAL
                             SEI_nal.empty();
                             uint32_t code=0xffff+0xffff0000;
-                            while((code!=1) && pkt->stillOk())
+                            while(((0xffffff&code)!=1) && pkt->stillOk())
                             {
                                 uint8_t r=pkt->readi8();
                                 code=(code<<8)+r;



From mean at mail.berlios.de  Wed Dec 15 19:09:25 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 15 Dec 2010 19:09:25 +0100
Subject: [Avidemux-svn-commit] r6846 -
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_mpegdemuxer
Message-ID: <20101215180926.0C303480D3B@sheep.berlios.de>

Author: mean
Date: 2010-12-15 19:09:25 +0100 (Wed, 15 Dec 2010)
New Revision: 6846

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer_h264.cpp
Log:
[H264/indexer] Fix short startcode SEI

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer_h264.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer_h264.cpp	2010-12-15 18:09:22 UTC (rev 6845)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer_h264.cpp	2010-12-15 18:09:25 UTC (rev 6846)
@@ -149,7 +149,7 @@
                       uint8_t sps[SPS_BUFFER_SIZE];
                       uint32_t code=0xffff+0xffff0000;
                       uint8_t *p=sps;
-                        while((code!=1) /*&& pkt->stillOk()*/)
+                        while(((code&0xffffff)!=1) /*&& pkt->stillOk()*/)
                         {
                                 uint8_t r=demuxer->read8i();
                                 code=(code<<8)+r;
@@ -387,4 +387,4 @@
 /********************************************************************************************/
 /********************************************************************************************/
 
-//
\ No newline at end of file
+//



From mean at mail.berlios.de  Sun Dec 19 08:29:25 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sun, 19 Dec 2010 08:29:25 +0100
Subject: [Avidemux-svn-commit] r6847 - in
	branches/avidemux_2.6_branch_mean/avidemux/common: .
	ADM_editor ADM_script2/binding ADM_script2/include
	ADM_script2/py ADM_script2/src
Message-ID: <20101219072925.7C6F5481467@sheep.berlios.de>

Author: mean
Date: 2010-12-19 08:29:25 +0100 (Sun, 19 Dec 2010)
New Revision: 6847

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edLoadSave.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edPySave.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/binding/adm.admPyClass
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_scriptAudio.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm_gen.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAudio.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp
Log:
 [py] Add setAudioTrack function  + save current audio track in project

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edLoadSave.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edLoadSave.cpp	2010-12-15 18:09:25 UTC (rev 6846)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edLoadSave.cpp	2010-12-19 07:29:25 UTC (rev 6847)
@@ -199,6 +199,15 @@
                         
         }
 #endif
+        { // Maybe not the 1st track
+          int source;
+               source=video_body->getCurrentAudioStreamNumber(0);
+               ADM_info("Audio source %d\n",source);
+               if(source)
+                        qfprintf(fd,"adm.setAudioTrack(%d);\n", source); 
+                        
+        }
+
    couples=NULL;
    getAudioExtraConf(&bitrate,&couples);
     qfprintf(fd,"adm.audioCodec(\"%s\",%d",audioCodecGetName(),bitrate); 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edPySave.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edPySave.cpp	2010-12-15 18:09:25 UTC (rev 6846)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edPySave.cpp	2010-12-19 07:29:25 UTC (rev 6847)
@@ -190,6 +190,14 @@
                         
         }
 #endif
+ { // Maybe not the 1st track
+          int source;
+               source=video_body->getCurrentAudioStreamNumber(0);
+               ADM_info("Audio source %d\n",source);
+               if(source)
+                        qfprintf(fd,"adm.setAudioTrack(%d);\n", source); 
+                        
+        }
    couples=NULL;
    getAudioExtraConf(&bitrate,&couples);
     qfprintf(fd,"adm.audioCodec(\"%s\",%d",audioCodecGetName(),bitrate); 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/binding/adm.admPyClass
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/binding/adm.admPyClass	2010-12-15 18:09:25 UTC (rev 6846)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/binding/adm.admPyClass	2010-12-19 07:29:25 UTC (rev 6847)
@@ -15,6 +15,7 @@
 /* METHOD */ str scriptGetVideoCodec:getVideoCodec(void) 
 /* METHOD */ int scriptAudioReset:audioReset        (void) 
 /* METHOD */ int scriptAudioMixer:audioMixer        (str ) 
+/* METHOD */ int scriptAudioSetTrack:setAudioTrack  (int ) 
 /* METHOD */ int scriptClearVideoFilters:clearVideoFilters   (void) 
 #
 #

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_scriptAudio.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_scriptAudio.h	2010-12-15 18:09:25 UTC (rev 6846)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_scriptAudio.h	2010-12-19 07:29:25 UTC (rev 6847)
@@ -20,6 +20,7 @@
 extern "C" {
 #endif
 int     scriptSetAudioCodec(const char *codec,int bitrate,CONFcouple *c);
+int     scriptAudioSetTrack(int trackNo);
 #ifdef __cplusplus
 };
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm_gen.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm_gen.cpp	2010-12-15 18:09:25 UTC (rev 6846)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm_gen.cpp	2010-12-19 07:29:25 UTC (rev 6847)
@@ -184,6 +184,16 @@
   int r=  A_saveJpg(p0); 
   return tp_number(r);
 }
+// setAudioTrack -> int scriptAudioSetTrack (int  ) 
+static tp_obj zzpy_setAudioTrack(TP)
+ {
+  tp_obj self=tp_getraw( tp);
+  tinyParams pm(tp);
+  void *me=(void *)pm.asThis(&self,ADM_PYID_AVIDEMUX);
+  int p0= pm.asInt();
+  int r=  scriptAudioSetTrack(p0); 
+  return tp_number(r);
+}
 // setContainer -> int scriptSetContainer (str couples ) 
 static tp_obj zzpy_setContainer(TP)
  {
@@ -317,6 +327,10 @@
   {
      return tp_method(vm,self,zzpy_saveJpeg);
   }
+  if (!strcmp(key, "setAudioTrack"))
+  {
+     return tp_method(vm,self,zzpy_setAudioTrack);
+  }
   if (!strcmp(key, "setContainer"))
   {
      return tp_method(vm,self,zzpy_setContainer);
@@ -396,6 +410,7 @@
 	jsLog("addSegment(int ,double , double )\n");
 	jsLog("clearVideoFilters(void)\n");
 	jsLog("saveJpeg(str)\n");
+	jsLog("setAudioTrack(int )\n");
 	jsLog("setContainer(str,couples)\n");
 	jsLog("audioReset(void)\n");
 	jsLog("getVideoCodec(void)\n");

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAudio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAudio.cpp	2010-12-15 18:09:25 UTC (rev 6846)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAudio.cpp	2010-12-19 07:29:25 UTC (rev 6847)
@@ -26,6 +26,10 @@
 #include "audioEncoderApi.h"
 #include "ADM_scriptCommon.h"
 #include "ADM_scriptAudio.h"
+
+extern ADM_Composer *video_body;
+
+int A_setAudioTrack(int track);
 /**
     \fn int jsAudioReset(void);
 */
@@ -57,8 +61,19 @@
 
 }
 /**
+    \fn  scriptAudioSetTrack
+*/
+int scriptAudioSetTrack(int track)
+{
+        uint32_t nbAudioTracks,currentAudioTrack;
+        audioInfo *infos=NULL;
 
-*/
+        if(!video_body->getAudioStreamsInfo(0,&nbAudioTracks,&infos)) 
+            return false;
+        if(nbAudioTracks<=track) return false;
+        A_setAudioTrack(track);
+        return true;
+}
 /**
     \fn scriptSetAudioCodec
 */

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp	2010-12-15 18:09:25 UTC (rev 6846)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/gtk_gui.cpp	2010-12-19 07:29:25 UTC (rev 6847)
@@ -905,6 +905,15 @@
 }
 extern const char *getStrFromAudioCodec( uint32_t codec);
 /**
+
+*/
+int A_setAudioTrack(int track)
+{
+        video_body->changeAudioStream(0,track);
+        video_body->getAudioStream(&aviaudiostream);
+        return true;
+}
+/**
       \fn A_audioTrack
       \brief Allow to select audio track
 */
@@ -938,8 +947,7 @@
          {
             if(newTrack!=currentAudioTrack)
             {
-                    video_body->changeAudioStream(0,newTrack);
-                    video_body->getAudioStream(&aviaudiostream);
+                    A_setAudioTrack(newTrack);
             }
         }
       



From mean at mail.berlios.de  Sun Dec 19 08:29:27 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sun, 19 Dec 2010 08:29:27 +0100
Subject: [Avidemux-svn-commit] r6848 - in
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core:
	include src
Message-ID: <20101219072927.487AF481467@sheep.berlios.de>

Author: mean
Date: 2010-12-19 08:29:27 +0100 (Sun, 19 Dec 2010)
New Revision: 6848

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_assert.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_memsupport.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_win32.cpp
Log:
[win64] Merge some win64 malloc stuff from 2.5

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_assert.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_assert.h	2010-12-19 07:29:25 UTC (rev 6847)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_assert.h	2010-12-19 07:29:27 UTC (rev 6848)
@@ -19,6 +19,19 @@
 #include <assert.h>
 #include "ADM_inttype.h"
 
+#if defined(__MINGW32__)
+	#include <_mingw.h>
+
+	#if defined(__MINGW64_VERSION_STR)
+		#if defined (__WIN64)
+			#include <intrin.h>
+		#endif
+
+		#include <wchar.h>
+	#endif
+#endif
+
+
 #define ADM_assert(x) { if(!(x)) {ADM_backTrack("Assert failed :"#x,__LINE__,__FILE__);  }}
 
 /* Functions we want to override to have better os support / debug / error control */
@@ -72,7 +85,7 @@
 #define fopen   ADM_fopen
 #define fclose  ADM_fclose
 
-#ifndef __APPLE__
+#if !defined(__APPLE__) && !defined(__WIN64)
 #ifndef ADM_LEGACY_PROGGY
   #define malloc #error
   #define realloc #error

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_memsupport.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_memsupport.cpp	2010-12-19 07:29:25 UTC (rev 6847)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_memsupport.cpp	2010-12-19 07:29:27 UTC (rev 6848)
@@ -90,7 +90,7 @@
 
 void *ADM_alloc(size_t size)
 {
-#ifdef __APPLE__
+#if defined(__APPLE__) || defined(__WIN64)
 	return malloc(size);
 #else
 	char *c;
@@ -127,7 +127,7 @@
 
 void ADM_dezalloc(void *ptr)
 {
-#ifdef __APPLE__
+#if defined(__APPLE__) || defined(__WIN64)
 	if (!ptr)
 		return;
 
@@ -238,7 +238,7 @@
  */
 void *ADM_realloc(void *ptr, size_t newsize)
 {
-#ifdef __APPLE__
+#if defined(__APPLE__) || defined(__WIN64)
 	if(!ptr)
 		return ADM_alloc(newsize);
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_win32.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_win32.cpp	2010-12-19 07:29:25 UTC (rev 6847)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_win32.cpp	2010-12-19 07:29:27 UTC (rev 6848)
@@ -369,6 +369,9 @@
 	index += sprintf(version + index, " (%d.%d.%d", osvi.dwMajorVersion, osvi.dwMinorVersion, osvi.dwBuildNumber & 0xFFFF);
 
 // 64-bit Windows
+#ifdef __WIN64
+	index += sprintf(version + index, "; 64-bit");
+#else
 	bool isWow64 = false;
 	HMODULE hKernel = GetModuleHandle("kernel32.dll");
 
@@ -388,7 +391,7 @@
 		index += sprintf(version + index, "; 64-bit");
 	else
 		index += sprintf(version + index, "; 32-bit");
-
+#endif
 	index += sprintf(version + index, ")");
 	
 	return true;



From mean at mail.berlios.de  Sun Dec 19 08:29:28 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sun, 19 Dec 2010 08:29:28 +0100
Subject: [Avidemux-svn-commit] r6849 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil
Message-ID: <20101219072928.6FA1B481467@sheep.berlios.de>

Author: mean
Date: 2010-12-19 08:29:28 +0100 (Sun, 19 Dec 2010)
New Revision: 6849

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/CMakeLists.txt
Log:
[NetBsd] First part of netbsd patches

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/CMakeLists.txt	2010-12-19 07:29:27 UTC (rev 6848)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavutil/CMakeLists.txt	2010-12-19 07:29:28 UTC (rev 6849)
@@ -1,3 +1,4 @@
+INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR})
 SET(ADM_LIB ADM_libavutil6)
 
 SET(${ADM_LIB}_SRCS 



From mean at mail.berlios.de  Sun Dec 19 08:29:29 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sun, 19 Dec 2010 08:29:29 +0100
Subject: [Avidemux-svn-commit] r6850 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101219072929.6C04E481467@sheep.berlios.de>

Author: mean
Date: 2010-12-19 08:29:29 +0100 (Sun, 19 Dec 2010)
New Revision: 6850

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admMainChecks.cmake
Log:
[NetBsd] First part of netbsd patches

Modified: branches/avidemux_2.6_branch_mean/cmake/admMainChecks.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admMainChecks.cmake	2010-12-19 07:29:28 UTC (rev 6849)
+++ branches/avidemux_2.6_branch_mean/cmake/admMainChecks.cmake	2010-12-19 07:29:29 UTC (rev 6850)
@@ -60,10 +60,10 @@
 	SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${ADM_ALTIVEC_FLAGS}")
 ENDIF (ADM_CPU_ALTIVEC)
 
-IF (UNIX AND NOT APPLE)
+IF (CMAKE_SYSTEM_NAME MATCHES "Linux")
 	# jog shuttle is only available on Linux due to its interface
 	SET(USE_JOG 1)
-ENDIF (UNIX AND NOT APPLE)
+ENDIF (CMAKE_SYSTEM_NAME MATCHES "Linux")
 
 IF (WIN32)
 	SET(BIN_DIR .)



From mean at mail.berlios.de  Sun Dec 19 19:01:24 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Sun, 19 Dec 2010 19:01:24 +0100
Subject: [Avidemux-svn-commit] r6851 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/x86
Message-ID: <20101219180124.28F2F48146F@sheep.berlios.de>

Author: mean
Date: 2010-12-19 19:01:23 +0100 (Sun, 19 Dec 2010)
New Revision: 6851

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/x86/dsputil_mmx.c
Log:
[avcodec] Disable SSE on windows it crashes. The real problem is elsewhere, but i cant remember what it is

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/x86/dsputil_mmx.c
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/x86/dsputil_mmx.c	2010-12-19 07:29:29 UTC (rev 6850)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_ffmpeg/libavcodec/x86/dsputil_mmx.c	2010-12-19 18:01:23 UTC (rev 6851)
@@ -2891,6 +2891,7 @@
             c->scalarproduct_and_madd_int16 = ff_scalarproduct_and_madd_int16_mmx2;
 #endif
         }
+#ifndef __MINGW32__ // MEANX : Deactivate SSE crashes on windows
         if(mm_flags & AV_CPU_FLAG_SSE){
             c->vorbis_inverse_coupling = vorbis_inverse_coupling_sse;
             c->ac3_downmix = ac3_downmix_sse;
@@ -2906,6 +2907,7 @@
             c->scalarproduct_float = ff_scalarproduct_float_sse;
 #endif
         }
+#endif // MEANX
         if(mm_flags & AV_CPU_FLAG_3DNOW)
             c->vector_fmul_add = vector_fmul_add_3dnow; // faster than sse
         if(mm_flags & AV_CPU_FLAG_SSE2){



From gruntster at mail.berlios.de  Mon Dec 20 14:29:46 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 20 Dec 2010 14:29:46 +0100
Subject: [Avidemux-svn-commit] r6852 - in
	branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts:
	avidemux lame libogg x264
Message-ID: <20101220132946.7723F480B11@sheep.berlios.de>

Author: gruntster
Date: 2010-12-20 14:29:46 +0100 (Mon, 20 Dec 2010)
New Revision: 6852

Removed:
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/configure.patch
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/nasm.h.patch
Modified:
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Package Notes.xml
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libogg/Perform Build.bat
   branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/x264/Perform Build.bat
Log:
[win] update build scripts

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Package Notes.xml
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Package Notes.xml	2010-12-19 18:01:23 UTC (rev 6851)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/avidemux/Package Notes.xml	2010-12-20 13:29:46 UTC (rev 6852)
@@ -1,5 +1,30 @@
 <?xml version="1.0"?>
 <log>
+	<buildentry revision="6796" date="2010-11-28">
+		<comment>Updated aften to version git version (commit: c0bd512c93b1186c28b45cc66f6e4f70fd41191c).</comment>
+		<comment>Updated libogg to version 1.2.1.</comment>
+		<comment>Updated libvorbis to version 1.3.2.</comment>
+		<comment>Updated libvpx to version 0.9.5.</comment>
+		<comment>Updated Qt to version 4.7.1.</comment>
+		<comment>Updated x264 to r1804.</comment>
+	</buildentry>
+	<buildentry revision="6714 [2.5.4 Final]" date="2010-11-01">
+		<comment>Updated Avisynth Proxy GUI to version 2.20.</comment>
+	</buildentry>
+	<buildentry revision="6689" date="2010-09-29">
+		<comment>Updated ATK to version 1.32.0-1.</comment>
+		<comment>Updated GLib to version 2.26.0-2.</comment>
+		<comment>Updated GTK+ to version 2.20.1-3.</comment>
+		<comment>Updated Pango to version 1.28.1-2.</comment>
+		<comment>Updated Qt to version 4.7.0.</comment>
+		<comment>Updated x264 to r1732.</comment>
+	</buildentry>
+	<buildentry revision="6636" date="2010-09-21">
+		<comment>Updated Cairo to version 1.10.0-1.</comment>
+		<comment>Compiled with GCC 4.5.2 pre-release (20100917)</comment>
+		<comment>Updated Qt to version 4.6.3.</comment>
+		<comment>Updated x264 to r1724.</comment>
+	</buildentry>
 	<buildentry revision="6587" date="2010-09-05">
 		<comment>Compiled with GCC 4.5.1.</comment>
 		<comment>Updated Cairo to version 1.8.10-4.</comment>

Deleted: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/configure.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/configure.patch	2010-12-19 18:01:23 UTC (rev 6851)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/configure.patch	2010-12-20 13:29:46 UTC (rev 6852)
@@ -1,11 +0,0 @@
---- configure.orig	2010-03-22 20:40:17 +0000
-+++ configure	2010-11-27 20:28:19 +0000
-@@ -30152,7 +30152,7 @@
- case $host_os in
- 	*cygwin*|*mingw32*)
- 		CYGWIN=yes
--		NASM_FORMAT="-f win32 -DWIN32"
-+		NASM_FORMAT="-f win64 -DWIN32"
- 		;;
- 	*darwin*)
- 		NASM_FORMAT="-f macho"

Deleted: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/nasm.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/nasm.h.patch	2010-12-19 18:01:23 UTC (rev 6851)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/lame/nasm.h.patch	2010-12-20 13:29:46 UTC (rev 6852)
@@ -1,13 +0,0 @@
---- libmp3lame/i386/nasm.h.orig	2010-11-27 20:30:25 +0000
-+++ libmp3lame/i386/nasm.h	2010-11-27 20:28:15 +0000
-@@ -45,7 +45,9 @@
- %endif
- 
- %ifdef WIN32
--	%define _NAMING
-+	%ifnidn __OUTPUT_FORMAT__,win64
-+		%define _NAMING
-+	%endif
- %endif
- 
- %ifdef __tos__

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libogg/Perform Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libogg/Perform Build.bat	2010-12-19 18:01:23 UTC (rev 6851)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/libogg/Perform Build.bat	2010-12-20 13:29:46 UTC (rev 6852)
@@ -17,9 +17,9 @@
 call "../Set Common Environment Variables"
 if errorlevel 1 goto end
 
-set package=libogg-1.2.1.tar.gz
-set sourceFolder=libogg-1.2.1-%BuildBits%
-set tarFolder=libogg-1.2.1
+set package=libogg-1.2.2.tar.gz
+set sourceFolder=libogg-1.2.2-%BuildBits%
+set tarFolder=libogg-1.2.2
 set curDir=%CD%
 
 if not exist %package% (

Modified: branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/x264/Perform Build.bat
===================================================================
--- branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/x264/Perform Build.bat	2010-12-19 18:01:23 UTC (rev 6851)
+++ branches/avidemux_2.5_branch_gruntster/platforms/windows/build_scripts/x264/Perform Build.bat	2010-12-20 13:29:46 UTC (rev 6852)
@@ -34,8 +34,8 @@
 
 cd "%devDir%/%sourceFolder%"
 
-if "%BuildBits%" == "32" sh ./configure --prefix=%usrLocalDir% --enable-shared
-if "%BuildBits%" == "64" sh ./configure --prefix=%usrLocalDir% --enable-shared --host=x86_64-pc-mingw32
+if "%BuildBits%" == "32" sh ./configure --prefix=%usrLocalDir% --enable-shared --enable-win32thread
+if "%BuildBits%" == "64" sh ./configure --prefix=%usrLocalDir% --enable-shared --enable-win32thread --host=x86_64-pc-mingw32
 
 if errorlevel 1 goto end
 



From gruntster at mail.berlios.de  Mon Dec 20 14:36:10 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 20 Dec 2010 14:36:10 +0100
Subject: [Avidemux-svn-commit] r6853 - in
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264:
	. qt4
Message-ID: <20101220133610.E54FB480B11@sheep.berlios.de>

Author: gruntster
Date: 2010-12-20 14:36:10 +0100 (Mon, 20 Dec 2010)
New Revision: 6853

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Options.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Options.h
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Param.xsd
Log:
[x264] psy trellis and autovaq patch by lord mulder

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp	2010-12-20 13:29:46 UTC (rev 6852)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.cpp	2010-12-20 13:36:10 UTC (rev 6853)
@@ -785,6 +785,7 @@
 	ui.fastPSkipCheckBox->setChecked(options->getFastPSkip());
 	ui.dctDecimateCheckBox->setChecked(options->getDctDecimate());
 	ui.psychoRdoSpinBox->setValue(options->getPsychoRdo());
+	ui.psychoTrellisSpinBox->setValue(options->getPsychoTrellis());
 
 	ui.noiseReductionSpinBox->setValue(options->getNoiseReduction());
 	ui.interLumaSpinBox->setValue(options->getInterLumaDeadzone());
@@ -821,8 +822,9 @@
 	ui.quantiserCurveCompressSpinBox->setValue((int)floor(options->getQuantiserCurveCompression() * 100 + .5));
 	ui.quantiserBeforeCompressSpinBox->setValue(options->getReduceFluxBeforeCurveCompression());
 	ui.quantiserAfterCompressSpinBox->setValue(options->getReduceFluxAfterCurveCompression());
-	ui.aqVarianceCheckBox->setChecked(options->getAdaptiveQuantiserMode() == X264_AQ_VARIANCE);
+	ui.aqVarianceCheckBox->setChecked(options->getAdaptiveQuantiserMode() > X264_AQ_NONE);
 	ui.aqStrengthSpinBox->setValue(options->getAdaptiveQuantiserStrength());
+	ui.aqAlgoComboBox->setCurrentIndex(options->getAdaptiveQuantiserMode() == X264_AQ_AUTOVARIANCE);
 
 	// Advanced tab
 	ui.vbvMaxBitrateSpinBox->setValue(options->getVbvMaximumBitrate());
@@ -1017,6 +1019,7 @@
 	options->setFastPSkip(ui.fastPSkipCheckBox->isChecked());
 	options->setDctDecimate(ui.dctDecimateCheckBox->isChecked());
 	options->setPsychoRdo(ui.psychoRdoSpinBox->value());
+	options->setPsychoTrellis(ui.psychoTrellisSpinBox->value());
 	options->setNoiseReduction(ui.noiseReductionSpinBox->value());
 	options->setInterLumaDeadzone(ui.interLumaSpinBox->value());
 	options->setIntraLumaDeadzone(ui.intraLumaSpinBox->value());
@@ -1050,7 +1053,7 @@
 	options->setReduceFluxAfterCurveCompression(ui.quantiserAfterCompressSpinBox->value());
 
 	if (ui.aqVarianceCheckBox->isChecked())
-		options->setAdaptiveQuantiserMode(X264_AQ_VARIANCE);
+		options->setAdaptiveQuantiserMode((ui.aqAlgoComboBox->currentIndex() > 0) ? X264_AQ_AUTOVARIANCE : X264_AQ_VARIANCE);
 	else
 		options->setAdaptiveQuantiserMode(X264_AQ_NONE);
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui	2010-12-20 13:29:46 UTC (rev 6852)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui	2010-12-20 13:36:10 UTC (rev 6853)
@@ -8,7 +8,7 @@
     <x>0</x>
     <y>0</y>
     <width>529</width>
-    <height>592</height>
+    <height>599</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -862,7 +862,7 @@
                   <item>
                    <widget class="QLabel" name="label_37">
                     <property name="text">
-                     <string>9 (Best)</string>
+                     <string>10 (Best)</string>
                     </property>
                    </widget>
                   </item>
@@ -886,13 +886,13 @@
                    <number>1</number>
                   </property>
                   <property name="maximum">
-                   <number>9</number>
+                   <number>10</number>
                   </property>
                   <property name="pageStep">
                    <number>1</number>
                   </property>
                   <property name="value">
-                   <number>5</number>
+                   <number>7</number>
                   </property>
                   <property name="orientation">
                    <enum>Qt::Horizontal</enum>
@@ -910,10 +910,10 @@
                  <number>1</number>
                 </property>
                 <property name="maximum">
-                 <number>9</number>
+                 <number>10</number>
                 </property>
                 <property name="value">
-                 <number>5</number>
+                 <number>7</number>
                 </property>
                </widget>
               </item>
@@ -1953,13 +1953,7 @@
          <property name="title">
           <string>Analysis</string>
          </property>
-         <layout class="QVBoxLayout">
-          <property name="spacing">
-           <number>6</number>
-          </property>
-          <property name="margin">
-           <number>9</number>
-          </property>
+         <layout class="QVBoxLayout" name="verticalLayout_10">
           <item>
            <widget class="QCheckBox" name="mixedRefsCheckBox">
             <property name="text">
@@ -2036,13 +2030,7 @@
            </widget>
           </item>
           <item>
-           <layout class="QHBoxLayout">
-            <property name="spacing">
-             <number>6</number>
-            </property>
-            <property name="margin">
-             <number>0</number>
-            </property>
+           <layout class="QHBoxLayout" name="horizontalLayout_5">
             <item>
              <widget class="QLabel" name="lblPsychoRDO">
               <property name="text">
@@ -2067,8 +2055,8 @@
               </property>
               <property name="sizeHint" stdset="0">
                <size>
-                <width>0</width>
-                <height>0</height>
+                <width>13</width>
+                <height>13</height>
                </size>
               </property>
              </spacer>
@@ -2076,39 +2064,77 @@
            </layout>
           </item>
           <item>
-           <layout class="QHBoxLayout">
-            <property name="spacing">
-             <number>6</number>
-            </property>
-            <property name="margin">
-             <number>0</number>
-            </property>
-            <item>
-             <widget class="QLabel" name="label_42">
+           <layout class="QGridLayout" name="gridLayout_5">
+            <item row="0" column="0">
+             <widget class="QLabel" name="lblPsyTrellis">
+              <property name="enabled">
+               <bool>false</bool>
+              </property>
               <property name="text">
-               <string>Noise Reduction:</string>
+               <string>Psychovisual Trellis:</string>
               </property>
              </widget>
             </item>
-            <item>
-             <widget class="QSpinBox" name="noiseReductionSpinBox">
-              <property name="maximum">
-               <number>65536</number>
+            <item row="0" column="1">
+             <layout class="QHBoxLayout" name="horizontalLayout_8">
+              <item>
+               <widget class="QDoubleSpinBox" name="psychoTrellisSpinBox">
+                <property name="enabled">
+                 <bool>false</bool>
+                </property>
+                <property name="maximum">
+                 <double>20.000000000000000</double>
+                </property>
+                <property name="singleStep">
+                 <double>0.100000000000000</double>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer name="horizontalSpacer_6">
+                <property name="orientation">
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" stdset="0">
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
+            </item>
+            <item row="1" column="0">
+             <widget class="QLabel" name="label_42">
+              <property name="text">
+               <string>Noise Reduction:</string>
               </property>
              </widget>
             </item>
-            <item>
-             <spacer name="spacer_35">
-              <property name="orientation">
-               <enum>Qt::Horizontal</enum>
-              </property>
-              <property name="sizeHint" stdset="0">
-               <size>
-                <width>0</width>
-                <height>0</height>
-               </size>
-              </property>
-             </spacer>
+            <item row="1" column="1">
+             <layout class="QHBoxLayout" name="horizontalLayout_9">
+              <item>
+               <widget class="QSpinBox" name="noiseReductionSpinBox">
+                <property name="maximum">
+                 <number>65536</number>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer name="spacer_35">
+                <property name="orientation">
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" stdset="0">
+                 <size>
+                  <width>13</width>
+                  <height>13</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
             </item>
            </layout>
           </item>
@@ -2321,13 +2347,7 @@
       <attribute name="title">
        <string>Quantiser</string>
       </attribute>
-      <layout class="QVBoxLayout">
-       <property name="spacing">
-        <number>6</number>
-       </property>
-       <property name="margin">
-        <number>9</number>
-       </property>
+      <layout class="QVBoxLayout" name="verticalLayout_9">
        <item>
         <widget class="QGroupBox" name="groupBox_4">
          <property name="title">
@@ -2840,45 +2860,51 @@
          <property name="title">
           <string>Adaptive Quantisation</string>
          </property>
-         <layout class="QVBoxLayout">
-          <property name="spacing">
-           <number>6</number>
-          </property>
-          <property name="margin">
-           <number>9</number>
-          </property>
+         <layout class="QVBoxLayout" name="verticalLayout_8">
           <item>
-           <layout class="QHBoxLayout">
-            <property name="spacing">
-             <number>6</number>
-            </property>
-            <property name="margin">
-             <number>0</number>
-            </property>
-            <item>
+           <layout class="QGridLayout" name="gridLayout_4">
+            <item row="0" column="0">
              <widget class="QCheckBox" name="aqVarianceCheckBox">
               <property name="text">
-               <string>Variance AQ</string>
+               <string>Variance AQ:</string>
               </property>
              </widget>
             </item>
-            <item>
-             <spacer name="spacer_51">
-              <property name="orientation">
-               <enum>Qt::Horizontal</enum>
-              </property>
-              <property name="sizeType">
-               <enum>QSizePolicy::Fixed</enum>
-              </property>
-              <property name="sizeHint" stdset="0">
-               <size>
-                <width>20</width>
-                <height>0</height>
-               </size>
-              </property>
-             </spacer>
+            <item row="0" column="1">
+             <layout class="QHBoxLayout" name="horizontalLayout_6">
+              <item>
+               <widget class="QComboBox" name="aqAlgoComboBox">
+                <property name="enabled">
+                 <bool>false</bool>
+                </property>
+                <item>
+                 <property name="text">
+                  <string>Normal</string>
+                 </property>
+                </item>
+                <item>
+                 <property name="text">
+                  <string>Auto Variance AQ</string>
+                 </property>
+                </item>
+               </widget>
+              </item>
+              <item>
+               <spacer name="spacer_47">
+                <property name="orientation">
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" stdset="0">
+                 <size>
+                  <width>208</width>
+                  <height>13</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
             </item>
-            <item>
+            <item row="1" column="0">
              <widget class="QLabel" name="aqStrengthLabel">
               <property name="enabled">
                <bool>false</bool>
@@ -2888,38 +2914,45 @@
               </property>
              </widget>
             </item>
-            <item>
-             <widget class="QDoubleSpinBox" name="aqStrengthSpinBox">
-              <property name="enabled">
-               <bool>false</bool>
-              </property>
-              <property name="decimals">
-               <number>2</number>
-              </property>
-              <property name="minimum">
-               <double>0.500000000000000</double>
-              </property>
-              <property name="maximum">
-               <double>1.500000000000000</double>
-              </property>
-              <property name="singleStep">
-               <double>0.100000000000000</double>
-              </property>
-             </widget>
+            <item row="1" column="1">
+             <layout class="QHBoxLayout" name="horizontalLayout_7">
+              <item>
+               <widget class="QDoubleSpinBox" name="aqStrengthSpinBox">
+                <property name="enabled">
+                 <bool>false</bool>
+                </property>
+                <property name="decimals">
+                 <number>2</number>
+                </property>
+                <property name="minimum">
+                 <double>0.500000000000000</double>
+                </property>
+                <property name="maximum">
+                 <double>1.500000000000000</double>
+                </property>
+                <property name="singleStep">
+                 <double>0.100000000000000</double>
+                </property>
+                <property name="value">
+                 <double>1.000000000000000</double>
+                </property>
+               </widget>
+              </item>
+              <item>
+               <spacer name="horizontalSpacer_7">
+                <property name="orientation">
+                 <enum>Qt::Horizontal</enum>
+                </property>
+                <property name="sizeHint" stdset="0">
+                 <size>
+                  <width>40</width>
+                  <height>20</height>
+                 </size>
+                </property>
+               </spacer>
+              </item>
+             </layout>
             </item>
-            <item>
-             <spacer name="spacer_47">
-              <property name="orientation">
-               <enum>Qt::Horizontal</enum>
-              </property>
-              <property name="sizeHint" stdset="0">
-               <size>
-                <width>0</width>
-                <height>0</height>
-               </size>
-              </property>
-             </spacer>
-            </item>
            </layout>
           </item>
          </layout>
@@ -4432,6 +4465,10 @@
   <tabstop>targetRateControlSpinBox</tabstop>
   <tabstop>quantiserSlider</tabstop>
   <tabstop>quantiserSpinBox</tabstop>
+  <tabstop>maxCrfCheckBox</tabstop>
+  <tabstop>maxCrfSlider</tabstop>
+  <tabstop>maxCrfSpinBox</tabstop>
+  <tabstop>psychoTrellisSpinBox</tabstop>
   <tabstop>fastFirstPassCheckBox</tabstop>
   <tabstop>mbTreeCheckBox</tabstop>
   <tabstop>lookaheadSpinBox</tabstop>
@@ -4495,6 +4532,7 @@
   <tabstop>quantiserBeforeCompressSpinBox</tabstop>
   <tabstop>quantiserAfterCompressSpinBox</tabstop>
   <tabstop>aqVarianceCheckBox</tabstop>
+  <tabstop>aqAlgoComboBox</tabstop>
   <tabstop>aqStrengthSpinBox</tabstop>
   <tabstop>vbvMaxBitrateSpinBox</tabstop>
   <tabstop>vbvBufferSizeSpinBox</tabstop>
@@ -4532,9 +4570,6 @@
   <tabstop>chromaSampleSpinBox</tabstop>
   <tabstop>fullRangeSamplesCheckBox</tabstop>
   <tabstop>buttonBox</tabstop>
-  <tabstop>maxCrfCheckBox</tabstop>
-  <tabstop>maxCrfSlider</tabstop>
-  <tabstop>maxCrfSpinBox</tabstop>
  </tabstops>
  <resources/>
  <connections>
@@ -4954,5 +4989,53 @@
     </hint>
    </hints>
   </connection>
+  <connection>
+   <sender>aqVarianceCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>aqAlgoComboBox</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel">
+     <x>71</x>
+     <y>472</y>
+    </hint>
+    <hint type="destinationlabel">
+     <x>378</x>
+     <y>472</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>trellisCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>lblPsyTrellis</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel">
+     <x>89</x>
+     <y>166</y>
+    </hint>
+    <hint type="destinationlabel">
+     <x>149</x>
+     <y>268</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>trellisCheckBox</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>psychoTrellisSpinBox</receiver>
+   <slot>setEnabled(bool)</slot>
+   <hints>
+    <hint type="sourcelabel">
+     <x>89</x>
+     <y>166</y>
+    </hint>
+    <hint type="destinationlabel">
+     <x>298</x>
+     <y>268</y>
+    </hint>
+   </hints>
+  </connection>
  </connections>
 </ui>

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Options.cpp	2010-12-20 13:29:46 UTC (rev 6852)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Options.cpp	2010-12-20 13:36:10 UTC (rev 6853)
@@ -715,7 +715,7 @@
 
 void x264Options::setSubpixelRefinement(unsigned int subpixelRefinement)
 {
-	if (subpixelRefinement >= 1 && subpixelRefinement <= 9)
+	if (subpixelRefinement >= 1 && subpixelRefinement <= 10)
 		_param.analyse.i_subpel_refine = subpixelRefinement;
 }
 
@@ -777,10 +777,21 @@
 
 void x264Options::setPsychoRdo(float psychoRdo)
 {
-	if (psychoRdo >= 0 && psychoRdo <= 10)
+	if (psychoRdo >= 0.0f && psychoRdo <= 10.0f)
 		_param.analyse.f_psy_rd = psychoRdo;
 }
 
+float x264Options::getPsychoTrellis(void)
+{
+	return _param.analyse.f_psy_trellis;
+}
+
+void x264Options::setPsychoTrellis(float psychoTrellis)
+{
+	if (psychoTrellis >= 0.0f && psychoTrellis <= 10.0f)
+		_param.analyse.f_psy_trellis = psychoTrellis;
+}
+
 unsigned int x264Options::getNoiseReduction(void)
 {
 	return _param.analyse.i_noise_reduction;
@@ -933,7 +944,7 @@
 
 void x264Options::setAdaptiveQuantiserMode(unsigned int adaptiveQuantiserMode)
 {
-	if (adaptiveQuantiserMode <= 1)
+	if (adaptiveQuantiserMode <= X264_AQ_AUTOVARIANCE)
 		_param.rc.i_aq_mode = adaptiveQuantiserMode;
 }
 
@@ -1467,6 +1478,7 @@
 	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"fastPSkip", boolean2String(xmlBuffer, bufferSize, getFastPSkip()));
 	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"dctDecimate", boolean2String(xmlBuffer, bufferSize, getDctDecimate()));
 	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"psychoRdo", number2String(xmlBuffer, bufferSize, getPsychoRdo()));
+	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"psychoTrellis", number2String(xmlBuffer, bufferSize, getPsychoTrellis()));
 	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"noiseReduction", number2String(xmlBuffer, bufferSize, getNoiseReduction()));
 	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"interLumaDeadzone", number2String(xmlBuffer, bufferSize, getInterLumaDeadzone()));
 	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"intraLumaDeadzone", number2String(xmlBuffer, bufferSize, getIntraLumaDeadzone()));
@@ -1493,6 +1505,9 @@
 		case X264_AQ_VARIANCE:
 			strcpy((char*)xmlBuffer, "variance");
 			break;
+		case X264_AQ_AUTOVARIANCE:
+			strcpy((char*)xmlBuffer, "autoVariance");
+			break;
 	}
 
 	xmlNewChild(xmlNodeChild, NULL, (xmlChar*)"adaptiveQuantiserMode", xmlBuffer);
@@ -1980,6 +1995,8 @@
 				setDctDecimate(string2Boolean(content));
 			else if (strcmp((char*)xmlChild->name, "psychoRdo") == 0)
 				setPsychoRdo(string2Float(content));
+			else if (strcmp((char*)xmlChild->name, "psychoTrellis") == 0)
+				setPsychoTrellis(string2Float(content));
 			else if (strcmp((char*)xmlChild->name, "noiseReduction") == 0)
 				setNoiseReduction(atoi(content));
 			else if (strcmp((char*)xmlChild->name, "interLumaDeadzone") == 0)
@@ -2030,6 +2047,8 @@
 					adaptiveQuantiserMode = X264_AQ_NONE;
 				else if (strcmp(content, "variance") == 0)
 					adaptiveQuantiserMode = X264_AQ_VARIANCE;
+				else if (strcmp(content, "autoVariance") == 0)
+					adaptiveQuantiserMode = X264_AQ_AUTOVARIANCE;
 
 				setAdaptiveQuantiserMode(adaptiveQuantiserMode);
 			}

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Options.h
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Options.h	2010-12-20 13:29:46 UTC (rev 6852)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Options.h	2010-12-20 13:36:10 UTC (rev 6853)
@@ -244,6 +244,9 @@
 	float getPsychoRdo(void);
 	void setPsychoRdo(float psychoRdo);
 
+	float getPsychoTrellis(void);
+	void setPsychoTrellis(float psychoTrellis);
+	
 	unsigned int getNoiseReduction(void);
 	void setNoiseReduction(unsigned int noiseReduction);
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Param.xsd
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Param.xsd	2010-12-20 13:29:46 UTC (rev 6852)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Param.xsd	2010-12-20 13:36:10 UTC (rev 6853)
@@ -403,7 +403,7 @@
                       <xs:simpleType>
                         <xs:restriction base="xs:integer">
                           <xs:minInclusive value="1"/>
-                          <xs:maxInclusive value="9"/>
+                          <xs:maxInclusive value="10"/>
                         </xs:restriction>
                       </xs:simpleType>
                     </xs:element>
@@ -432,6 +432,14 @@
                         </xs:restriction>
                       </xs:simpleType>
                     </xs:element>
+					<xs:element name="psychoTrellis" minOccurs="0">
+						<xs:simpleType>
+							<xs:restriction base="xs:float">
+								<xs:minInclusive value="0"/>
+								<xs:maxInclusive value="10"/>
+							</xs:restriction>
+						</xs:simpleType>
+					</xs:element>
                     <xs:element name="noiseReduction" minOccurs="0">
                       <xs:simpleType>
                         <xs:restriction base="xs:integer">
@@ -547,6 +555,7 @@
                         <xs:restriction base="xs:string">
                           <xs:enumeration value="none"/>
                           <xs:enumeration value="variance"/>
+                          <xs:enumeration value="autoVariance"/>
                         </xs:restriction>
                       </xs:simpleType>
                     </xs:element>



From gruntster at mail.berlios.de  Mon Dec 20 15:57:57 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 20 Dec 2010 15:57:57 +0100
Subject: [Avidemux-svn-commit] r6854 - in
	branches/avidemux_2.5_branch_gruntster/cmake: . patches
Message-ID: <20101220145757.4775A480BCC@sheep.berlios.de>

Author: gruntster
Date: 2010-12-20 15:57:56 +0100 (Mon, 20 Dec 2010)
New Revision: 6854

Removed:
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_Makefile.patch
Modified:
   branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264_parser.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_vc1dec.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
   branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch
Log:
[ffmpeg] update FFmpeg to r26061 & libswscale to r32724

Modified: branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2010-12-20 13:36:10 UTC (rev 6853)
+++ branches/avidemux_2.5_branch_gruntster/cmake/admFFmpegBuild.cmake	2010-12-20 14:57:56 UTC (rev 6854)
@@ -1,7 +1,7 @@
 include(admFFmpegUtil)
 
-set(FFMPEG_VERSION 25831)	# http://git.ffmpeg.org/?p=ffmpeg;a=snapshot;h=95fe12b28a9c50f6c1ca2298fad7febfbbd20550;sf=tgz
-set(SWSCALE_VERSION 32647)	# http://git.ffmpeg.org/?p=libswscale;a=snapshot;h=e75b939d479ce8120d2d30d7275849e3377a990e;sf=tgz
+set(FFMPEG_VERSION 26061)	# http://git.ffmpeg.org/?p=ffmpeg;a=snapshot;h=2be4fa05c5528073bcfc472d1c23f2d77b679a9d;sf=tgz
+set(SWSCALE_VERSION 32724)	# http://git.ffmpeg.org/?p=libswscale;a=snapshot;h=d1a43021d9198868fa7a023a30e5ee9e09a907d3;sf=tgz
 
 set(LIBRARY_SOURCE_DIR "${CMAKE_SOURCE_DIR}/avidemux/ADM_libraries")
 set(FFMPEG_SOURCE_DIR "${LIBRARY_SOURCE_DIR}/ffmpeg")

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh	2010-12-20 13:36:10 UTC (rev 6853)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/createPatches.sh	2010-12-20 14:57:56 UTC (rev 6854)
@@ -11,7 +11,7 @@
 	unix2dos $1/$2.new
 	mv $1/$2 $1/$2.old
 	mv $1/$2.new $1/$2
-	diff -c $1/$2.old $1/$2 > $curDir/$1_$2.patch
+	diff -u $1/$2.old $1/$2 > $curDir/$1_$2.patch
 	rm $1/$2.old
 	cd $curDir
 	dos2unix $1_$2.patch
@@ -21,6 +21,7 @@
 updatePatch libavcodec ffv1.c
 updatePatch libavcodec h263dec.c
 updatePatch libavcodec h264.c
+updatePatch libavcodec h264_parser.c
 updatePatch libavcodec mpeg12.c
 updatePatch libavcodec mpeg12enc.c
 updatePatch libavcodec mpegvideo.c
@@ -30,6 +31,5 @@
 updatePatch libavformat file.c
 updatePatch libavformat isom.c
 updatePatch libavformat matroskaenc.c
-updatePatch libavformat Makefile
 updatePatch libavutil avutil.h
 

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2010-12-20 13:36:10 UTC (rev 6853)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_avcodec.h.patch	2010-12-20 14:57:56 UTC (rev 6854)
@@ -1,34 +1,28 @@
-*** libavcodec/avcodec.h.old	Fri Nov 26 17:53:30 2010
---- libavcodec/avcodec.h	Fri Nov 26 17:53:30 2010
-***************
-*** 663,668 ****
---- 663,670 ----
-  #define CODEC_FLAG2_PSY           0x00080000 ///< Use psycho visual optimizations.
-  #define CODEC_FLAG2_SSIM          0x00100000 ///< Compute SSIM during encoding, error[] values are undefined.
-  #define CODEC_FLAG2_INTRA_REFRESH 0x00200000 ///< Use periodic insertion of intra blocks instead of keyframes.
-+ //MEANX: NEVER EVER USE CLOSED GOP ?
-+ #define CODEC_FLAG2_32_PULLDOWN   0x80000000
-  
-  /* Unsupported options :
-   *              Syntax Arithmetic coding (SAC)
-***************
-*** 1550,1555 ****
---- 1552,1558 ----
-       * - decoding: unused
-       */
-      int rc_max_rate;
-+     int rc_max_rate_header; /*< That one is set in the header MEANX */
-  
-      /**
-       * minimum bitrate
-***************
-*** 1564,1569 ****
---- 1567,1574 ----
-       * - decoding: unused
-       */
-      int rc_buffer_size;
-+     int rc_buffer_size_header;  /*< That one is set in the header MEANX*/
-+ 
-      float rc_buffer_aggressivity;
-  
-      /**
+--- libavcodec/avcodec.h.old	2010-12-20 13:49:18 +0000
++++ libavcodec/avcodec.h	2010-12-20 13:49:18 +0000
+@@ -665,6 +665,8 @@
+ #define CODEC_FLAG2_PSY           0x00080000 ///< Use psycho visual optimizations.
+ #define CODEC_FLAG2_SSIM          0x00100000 ///< Compute SSIM during encoding, error[] values are undefined.
+ #define CODEC_FLAG2_INTRA_REFRESH 0x00200000 ///< Use periodic insertion of intra blocks instead of keyframes.
++//MEANX: NEVER EVER USE CLOSED GOP ?
++#define CODEC_FLAG2_32_PULLDOWN   0x80000000
+ 
+ /* Unsupported options :
+  *              Syntax Arithmetic coding (SAC)
+@@ -1559,6 +1561,7 @@
+      * - decoding: unused
+      */
+     int rc_max_rate;
++    int rc_max_rate_header; /*< That one is set in the header MEANX */
+ 
+     /**
+      * minimum bitrate
+@@ -1573,6 +1576,8 @@
+      * - decoding: unused
+      */
+     int rc_buffer_size;
++    int rc_buffer_size_header;  /*< That one is set in the header MEANX*/
++
+     float rc_buffer_aggressivity;
+ 
+     /**

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch	2010-12-20 13:36:10 UTC (rev 6853)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_ffv1.c.patch	2010-12-20 14:57:56 UTC (rev 6854)
@@ -1,13 +1,11 @@
-*** libavcodec/ffv1.c.old	Fri Nov 26 17:53:32 2010
---- libavcodec/ffv1.c	Fri Nov 26 17:53:32 2010
-***************
-*** 1734,1739 ****
---- 1734,1741 ----
-          clear_state(f);
-      }else{
-          p->key_frame= 0;
-+          p->pict_type= FF_P_TYPE; // MEANX : looks more like a P to me as user
-+ 
-      }
-      if(f->ac>1){
-          int i;
+--- libavcodec/ffv1.c.old	2010-12-20 13:49:20 +0000
++++ libavcodec/ffv1.c	2010-12-20 13:49:20 +0000
+@@ -1734,6 +1734,8 @@
+         clear_state(f);
+     }else{
+         p->key_frame= 0;
++         p->pict_type= FF_P_TYPE; // MEANX : looks more like a P to me as user
++
+     }
+     if(f->ac>1){
+         int i;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch	2010-12-20 13:36:10 UTC (rev 6853)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h263dec.c.patch	2010-12-20 14:57:56 UTC (rev 6854)
@@ -1,62 +1,56 @@
-*** libavcodec/h263dec.c.old	Fri Nov 26 17:53:32 2010
---- libavcodec/h263dec.c	Fri Nov 26 17:53:32 2010
-***************
-*** 120,125 ****
---- 120,144 ----
-  
-      return 0;
-  }
-+ /* MeanX : Ugly patch to detect vo ppacked stuff ... */
-+ int av_is_voppacked(AVCodecContext *avctx, int *vop_packed, int *gmc, int *qpel);
-+ 
-+ int av_is_voppacked(AVCodecContext *avctx, int *vop_packed, int *gmc, int *qpel)
-+ {
-+     MpegEncContext *s = avctx->priv_data;
-+     // set sane default
-+     *vop_packed=0;
-+     *gmc=0;
-+     *qpel=0;
-+     if(avctx->codec->id!=CODEC_ID_MPEG4) return 0;
-+     	
-+   	*vop_packed=(s->divx_packed);
-+ 	*qpel=s->quarter_sample;
-+ 	*gmc=0;	// FIXME
-+ 	return 1;
-+ 
-+   }
-+   /* MeanX */
-  
-  av_cold int ff_h263_decode_end(AVCodecContext *avctx)
-  {
-***************
-*** 415,420 ****
---- 434,445 ----
-      } else {
-          ret = h263_decode_picture_header(s);
-      }
-+ 	//MEANX we need to do it here also for quicktime file / ctts atom 
-+         // we need the correct frame type, and qt file may contain 
-+         // vop not coded frame.
-+         pict->pict_type=s->current_picture.pict_type= s->pict_type;
-+         pict->key_frame=s->current_picture.key_frame= s->pict_type == FF_I_TYPE;
-+         //MEANX
-  
-      if(ret==FRAME_SKIPPED) return get_consumed_bytes(s, buf_size);
-  
-***************
-*** 710,715 ****
---- 735,748 ----
-  
-  assert(s->current_picture.pict_type == s->current_picture_ptr->pict_type);
-  assert(s->current_picture.pict_type == s->pict_type);
-+ /* MEANX */
-+   if(s->current_picture_ptr)
-+       s->current_picture_ptr->opaque=pict->opaque;
-+ /* MEANX */
-+ 
-+ 
-+ 
-+ 
-      if (s->pict_type == FF_B_TYPE || s->low_delay) {
-          *pict= *(AVFrame*)s->current_picture_ptr;
-      } else if (s->last_picture_ptr != NULL) {
+--- libavcodec/h263dec.c.old	2010-12-20 13:49:21 +0000
++++ libavcodec/h263dec.c	2010-12-20 13:49:21 +0000
+@@ -120,6 +120,25 @@
+ 
+     return 0;
+ }
++/* MeanX : Ugly patch to detect vo ppacked stuff ... */
++int av_is_voppacked(AVCodecContext *avctx, int *vop_packed, int *gmc, int *qpel);
++
++int av_is_voppacked(AVCodecContext *avctx, int *vop_packed, int *gmc, int *qpel)
++{
++    MpegEncContext *s = avctx->priv_data;
++    // set sane default
++    *vop_packed=0;
++    *gmc=0;
++    *qpel=0;
++    if(avctx->codec->id!=CODEC_ID_MPEG4) return 0;
++    	
++  	*vop_packed=(s->divx_packed);
++	*qpel=s->quarter_sample;
++	*gmc=0;	// FIXME
++	return 1;
++
++  }
++  /* MeanX */
+ 
+ av_cold int ff_h263_decode_end(AVCodecContext *avctx)
+ {
+@@ -422,6 +441,12 @@
+     } else {
+         ret = h263_decode_picture_header(s);
+     }
++	//MEANX we need to do it here also for quicktime file / ctts atom 
++        // we need the correct frame type, and qt file may contain 
++        // vop not coded frame.
++        pict->pict_type=s->current_picture.pict_type= s->pict_type;
++        pict->key_frame=s->current_picture.key_frame= s->pict_type == FF_I_TYPE;
++        //MEANX
+ 
+     if(ret==FRAME_SKIPPED) return get_consumed_bytes(s, buf_size);
+ 
+@@ -717,6 +742,14 @@
+ 
+ assert(s->current_picture.pict_type == s->current_picture_ptr->pict_type);
+ assert(s->current_picture.pict_type == s->pict_type);
++/* MEANX */
++  if(s->current_picture_ptr)
++      s->current_picture_ptr->opaque=pict->opaque;
++/* MEANX */
++
++
++
++
+     if (s->pict_type == FF_B_TYPE || s->low_delay) {
+         *pict= *(AVFrame*)s->current_picture_ptr;
+     } else if (s->last_picture_ptr != NULL) {

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2010-12-20 13:36:10 UTC (rev 6853)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264.c.patch	2010-12-20 14:57:56 UTC (rev 6854)
@@ -1,24 +1,22 @@
-*** libavcodec/h264.c.old	Fri Nov 26 17:53:33 2010
---- libavcodec/h264.c	Fri Nov 26 17:53:33 2010
-***************
-*** 3395,3400 ****
---- 3395,3413 ----
-      return 0;
-  }
-  
-+ /* MEANX */
-+ int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc);
-+ 
-+ int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc)
-+ {
-+       H264Context *h = avctx->priv_data;
-+       assert(h);
-+       *nalSize=h->nal_length_size;
-+       *isAvc=h->is_avc;
-+ 	return 1;
-+ 
-+   }
-+ /* MeanX */
-  
-  AVCodec h264_decoder = {
-      "h264",
+--- libavcodec/h264.c.old	2010-12-20 13:49:22 +0000
++++ libavcodec/h264.c	2010-12-20 13:49:22 +0000
+@@ -3395,6 +3395,19 @@
+     return 0;
+ }
+ 
++/* MEANX */
++int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc);
++
++int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc)
++{
++      H264Context *h = avctx->priv_data;
++      assert(h);
++      *nalSize=h->nal_length_size;
++      *isAvc=h->is_avc;
++	return 1;
++
++  }
++/* MeanX */
+ 
+ AVCodec h264_decoder = {
+     "h264",

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264_parser.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264_parser.c.patch	2010-12-20 13:36:10 UTC (rev 6853)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_h264_parser.c.patch	2010-12-20 14:57:56 UTC (rev 6854)
@@ -1,8 +1,6 @@
-Index: libavcodec/h264_parser.c
-===================================================================
---- libavcodec/h264_parser.c	(revision 25831)
-+++ libavcodec/h264_parser.c	(working copy)
-@@ -30,9 +30,54 @@
+--- libavcodec/h264_parser.c.old	2010-12-20 13:49:23 +0000
++++ libavcodec/h264_parser.c	2010-12-20 13:49:23 +0000
+@@ -30,7 +30,52 @@
  #include "h264data.h"
  #include "golomb.h"
  
@@ -40,7 +38,7 @@
 +    int f=ctx->sps.nal_hrd_parameters_present_flag | ctx->sps.vcl_hrd_parameters_present_flag;
 +    info->hasStructInfo=f | ctx->sps.pic_struct_present_flag;;
 +    // While decoding SEI, if CpbDpbDelaysPresentFlags is there we skip cpb_removal_delay + dpb_output_delay
- 
++
 +    info->CpbDpbToSkip=0;
 +    if(f)
 +    {
@@ -53,7 +51,5 @@
 +}
 +// /MEANX
  
-+
+ 
  int ff_h264_find_frame_end(H264Context *h, const uint8_t *buf, int buf_size)
- {
-     int i;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2010-12-20 13:36:10 UTC (rev 6853)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12.c.patch	2010-12-20 14:57:56 UTC (rev 6854)
@@ -1,16 +1,14 @@
-*** libavcodec/mpeg12.c.old	Sat Mar 27 20:05:36 2010
---- libavcodec/mpeg12.c	Sat Mar 27 20:05:36 2010
-***************
-*** 1948,1953 ****
---- 1948,1958 ----
-          ff_er_frame_end(s);
-  
-          MPV_frame_end(s);
-+ /* MEANX */
-+   if(s->current_picture_ptr)
-+       s->current_picture_ptr->opaque=pict->opaque;
-+ /* MEANX */
-+ 
-  
-          if (s->pict_type == FF_B_TYPE || s->low_delay) {
-              *pict= *(AVFrame*)s->current_picture_ptr;
+--- libavcodec/mpeg12.c.old	2010-12-20 13:49:23 +0000
++++ libavcodec/mpeg12.c	2010-12-20 13:49:23 +0000
+@@ -1948,6 +1948,11 @@
+         ff_er_frame_end(s);
+ 
+         MPV_frame_end(s);
++/* MEANX */
++  if(s->current_picture_ptr)
++      s->current_picture_ptr->opaque=pict->opaque;
++/* MEANX */
++
+ 
+         if (s->pict_type == FF_B_TYPE || s->low_delay) {
+             *pict= *(AVFrame*)s->current_picture_ptr;

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch	2010-12-20 13:36:10 UTC (rev 6853)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpeg12enc.c.patch	2010-12-20 14:57:56 UTC (rev 6854)
@@ -1,231 +1,188 @@
-*** libavcodec/mpeg12enc.c.old	Sun Oct 18 17:15:07 2009
---- libavcodec/mpeg12enc.c	Sun Oct 18 17:15:07 2009
-***************
-*** 127,136 ****
---- 127,145 ----
-              s->frame_rate_index= i;
-          }
-      }
-+  /* MEANX 
-+ 
-      if(dmin)
-          return -1;
-      else
-          return 0;
-+   */
-+         if(dmin>4)
-+    {
-+         av_log(0,AV_LOG_ERROR,"We did a roundup ! Expect async!\n");
-+    }
-+         return 0; //MEANX
-+ 
-  }
-  
-  static av_cold int encode_init(AVCodecContext *avctx)
-***************
-*** 209,214 ****
---- 218,224 ----
-              put_sbits(&s->pb, 12, s->width );
-              put_sbits(&s->pb, 12, s->height);
-  
-+ #if 0 //MEANX
-              for(i=1; i<15; i++){
-                  float error= aspect_ratio;
-                  if(s->codec_id == CODEC_ID_MPEG1VIDEO || i <=1)
-***************
-*** 223,242 ****
-                      s->aspect_ratio_info= i;
-                  }
-              }
-  
-!             put_bits(&s->pb, 4, s->aspect_ratio_info);
-!             put_bits(&s->pb, 4, s->frame_rate_index);
-  
-!             if(s->avctx->rc_max_rate){
-!                 v = (s->avctx->rc_max_rate + 399) / 400;
-                  if (v > 0x3ffff && s->codec_id == CODEC_ID_MPEG1VIDEO)
-                      v = 0x3ffff;
-              }else{
-                  v= 0x3FFFF;
-              }
-  
-!             if(s->avctx->rc_buffer_size)
-!                 vbv_buffer_size = s->avctx->rc_buffer_size;
-              else
-                  /* VBV calculation: Scaled so that a VCD has the proper VBV size of 40 kilobytes */
-                  vbv_buffer_size = (( 20 * s->bit_rate) / (1151929 / 2)) * 8 * 1024;
---- 233,276 ----
-                      s->aspect_ratio_info= i;
-                  }
-              }
-+ #endif // MEANX
-+             //MEANX put_bits(&s->pb, 4, s->aspect_ratio_info);
-+             //MEANX put_bits(&s->pb, 4, s->frame_rate_index);
-+  // MEANX 4:3
-+   if(s->avctx->sample_aspect_ratio.num==16 && s->avctx->sample_aspect_ratio.den==9)
-+             {
-+                 //printf("FFmpeg : Wide\n");
-+                 put_bits(&s->pb,4,3); //16:9
-+             }
-+             else        //4:3
-+             {
-+               if(s->codec_id == CODEC_ID_MPEG2VIDEO)
-+                 put_bits(&s->pb, 4, 2);
-+               else
-+                 put_bits(&s->pb, 4, 12); // MPEG1
-+             }
-+ // /MEANX
-  
-! // //MEANX PULLDOWN            put_bits(&s->pb, 4, s->frame_rate_index);
-! if((s->flags2 & CODEC_FLAG2_32_PULLDOWN) && (s->codec_id == CODEC_ID_MPEG2VIDEO))
-!             {           
-!                 put_bits(&s->pb, 4,4);
-!             }
-!             else
-!             {                                  
-!                 put_bits(&s->pb, 4, s->frame_rate_index);
-!             } //MEANX pulldown
-  
-!             if(s->avctx->rc_max_rate_header){ //MEANX we use header
-!                 v = (s->avctx->rc_max_rate_header + 399) / 400;
-                  if (v > 0x3ffff && s->codec_id == CODEC_ID_MPEG1VIDEO)
-                      v = 0x3ffff;
-              }else{
-                  v= 0x3FFFF;
-              }
-  
-!             if(s->avctx->rc_buffer_size_header) // MEANX we use header
-!                 vbv_buffer_size = s->avctx->rc_buffer_size_header;
-              else
-                  /* VBV calculation: Scaled so that a VCD has the proper VBV size of 40 kilobytes */
-                  vbv_buffer_size = (( 20 * s->bit_rate) / (1151929 / 2)) * 8 * 1024;
-***************
-*** 269,276 ****
-  
-                  put_bits(&s->pb, 3, s->avctx->profile); //profile
-                  put_bits(&s->pb, 4, s->avctx->level); //level
-  
--                 put_bits(&s->pb, 1, s->progressive_sequence);
-                  put_bits(&s->pb, 2, s->chroma_format);
-                  put_bits(&s->pb, 2, s->width >>12);
-                  put_bits(&s->pb, 2, s->height>>12);
---- 303,319 ----
-  
-                  put_bits(&s->pb, 3, s->avctx->profile); //profile
-                  put_bits(&s->pb, 4, s->avctx->level); //level
-+    // MEANX pulldown put_bits(&s->pb, 1, s->progressive_sequence);
-+   // MEANX Pulldown
-+  if(s->flags2 & CODEC_FLAG2_32_PULLDOWN) //MEANX
-+                         put_bits(&s->pb, 1, 0);
-+                 else
-+                         put_bits(&s->pb, 1, s->progressive_sequence);
-+ 
-+ 
-+ // /MEANX
-+ 
-  
-                  put_bits(&s->pb, 2, s->chroma_format);
-                  put_bits(&s->pb, 2, s->width >>12);
-                  put_bits(&s->pb, 2, s->height>>12);
-***************
-*** 339,344 ****
---- 382,389 ----
-  
-  void mpeg1_encode_picture_header(MpegEncContext *s, int picture_number)
-  {
-+ 	int tff,rff; //MEANX
-+ 
-      mpeg1_encode_sequence_header(s);
-  
-      /* mpeg1 picture header */
-***************
-*** 375,380 ****
---- 420,468 ----
-  
-      s->frame_pred_frame_dct = 1;
-      if(s->codec_id == CODEC_ID_MPEG2VIDEO){
-+  /* MEANX -- Pulldown */
-+         if(s->flags2 & CODEC_FLAG2_32_PULLDOWN)
-+         {
-+         
-+                 switch((s->picture_number - 
-+                           s->gop_picture_number)&3)
-+                 {
-+                         case 0:
-+                         default:
-+                                 rff=1;
-+                                 tff=1;
-+                                 break;
-+                         case 1:
-+                                 rff=0;
-+                                 tff=0;
-+                                 break;
-+                         case 2:
-+                                 rff=1;
-+                                 tff=0;
-+                                 break;
-+                         case 3:
-+                                 rff=0;
-+                                 tff=1;
-+                                 break;
-+                 }               
+--- libavcodec/mpeg12enc.c.old	2010-12-20 13:49:24 +0000
++++ libavcodec/mpeg12enc.c	2010-12-20 13:49:24 +0000
+@@ -127,10 +127,19 @@
+             s->frame_rate_index= i;
+         }
+     }
++ /* MEANX 
++
+     if(dmin)
+         return -1;
+     else
+         return 0;
++  */
++        if(dmin>4)
++   {
++        av_log(0,AV_LOG_ERROR,"We did a roundup ! Expect async!\n");
++   }
++        return 0; //MEANX
++
+ }
+ 
+ static av_cold int encode_init(AVCodecContext *avctx)
+@@ -209,6 +218,7 @@
+             put_sbits(&s->pb, 12, s->width );
+             put_sbits(&s->pb, 12, s->height);
+ 
++#if 0 //MEANX
+             for(i=1; i<15; i++){
+                 float error= aspect_ratio;
+                 if(s->codec_id == CODEC_ID_MPEG1VIDEO || i <=1)
+@@ -223,20 +233,44 @@
+                     s->aspect_ratio_info= i;
+                 }
+             }
++#endif // MEANX
++            //MEANX put_bits(&s->pb, 4, s->aspect_ratio_info);
++            //MEANX put_bits(&s->pb, 4, s->frame_rate_index);
++ // MEANX 4:3
++  if(s->avctx->sample_aspect_ratio.num==16 && s->avctx->sample_aspect_ratio.den==9)
++            {
++                //printf("FFmpeg : Wide\n");
++                put_bits(&s->pb,4,3); //16:9
 +            }
-+         else
-+         {
-+                 if (s->progressive_sequence) 
-+                 {
-+                         tff=0; /* no repeat */
-+                 } else 
-+                 {
-+                         tff= s->current_picture_ptr->top_field_first;
-+                 }
-+                 rff=s->repeat_first_field;
-+         
-+         }
-+ 
-+ //               /MEANX pulldown
-+ 
-+ 
-+ 
-          put_header(s, EXT_START_CODE);
-          put_bits(&s->pb, 4, 8); //pic ext
-          if (s->pict_type == FF_P_TYPE || s->pict_type == FF_B_TYPE) {
-***************
-*** 393,403 ****
---- 481,496 ----
-  
-          assert(s->picture_structure == PICT_FRAME);
-          put_bits(&s->pb, 2, s->picture_structure);
-+ #if 0 //MEANX
-+ 
-          if (s->progressive_sequence) {
-              put_bits(&s->pb, 1, 0); /* no repeat */
-          } else {
-              put_bits(&s->pb, 1, s->current_picture_ptr->top_field_first);
-          }
-+ #endif
-+          put_bits(&s->pb, 1, tff);  //MEANX PULLDOWN
-+ 
-          /* XXX: optimize the generation of this flag with entropy
-             measures */
-          s->frame_pred_frame_dct = s->progressive_sequence;
-***************
-*** 407,413 ****
-          put_bits(&s->pb, 1, s->q_scale_type);
-          put_bits(&s->pb, 1, s->intra_vlc_format);
-          put_bits(&s->pb, 1, s->alternate_scan);
-!         put_bits(&s->pb, 1, s->repeat_first_field);
-          s->progressive_frame = s->progressive_sequence;
-          put_bits(&s->pb, 1, s->chroma_format == CHROMA_420 ? s->progressive_frame : 0); /* chroma_420_type */
-          put_bits(&s->pb, 1, s->progressive_frame);
---- 500,509 ----
-          put_bits(&s->pb, 1, s->q_scale_type);
-          put_bits(&s->pb, 1, s->intra_vlc_format);
-          put_bits(&s->pb, 1, s->alternate_scan);
-!  // MEANX put_bits(&s->pb, 1, s->repeat_first_field);
-! 	put_bits(&s->pb, 1, rff);
-!       // /MEANX
-! 
-          s->progressive_frame = s->progressive_sequence;
-          put_bits(&s->pb, 1, s->chroma_format == CHROMA_420 ? s->progressive_frame : 0); /* chroma_420_type */
-          put_bits(&s->pb, 1, s->progressive_frame);
++            else        //4:3
++            {
++              if(s->codec_id == CODEC_ID_MPEG2VIDEO)
++                put_bits(&s->pb, 4, 2);
++              else
++                put_bits(&s->pb, 4, 12); // MPEG1
++            }
++// /MEANX
+ 
+-            put_bits(&s->pb, 4, s->aspect_ratio_info);
+-            put_bits(&s->pb, 4, s->frame_rate_index);
++// //MEANX PULLDOWN            put_bits(&s->pb, 4, s->frame_rate_index);
++if((s->flags2 & CODEC_FLAG2_32_PULLDOWN) && (s->codec_id == CODEC_ID_MPEG2VIDEO))
++            {           
++                put_bits(&s->pb, 4,4);
++            }
++            else
++            {                                  
++                put_bits(&s->pb, 4, s->frame_rate_index);
++            } //MEANX pulldown
+ 
+-            if(s->avctx->rc_max_rate){
+-                v = (s->avctx->rc_max_rate + 399) / 400;
++            if(s->avctx->rc_max_rate_header){ //MEANX we use header
++                v = (s->avctx->rc_max_rate_header + 399) / 400;
+                 if (v > 0x3ffff && s->codec_id == CODEC_ID_MPEG1VIDEO)
+                     v = 0x3ffff;
+             }else{
+                 v= 0x3FFFF;
+             }
+ 
+-            if(s->avctx->rc_buffer_size)
+-                vbv_buffer_size = s->avctx->rc_buffer_size;
++            if(s->avctx->rc_buffer_size_header) // MEANX we use header
++                vbv_buffer_size = s->avctx->rc_buffer_size_header;
+             else
+                 /* VBV calculation: Scaled so that a VCD has the proper VBV size of 40 kilobytes */
+                 vbv_buffer_size = (( 20 * s->bit_rate) / (1151929 / 2)) * 8 * 1024;
+@@ -269,8 +303,17 @@
+ 
+                 put_bits(&s->pb, 3, s->avctx->profile); //profile
+                 put_bits(&s->pb, 4, s->avctx->level); //level
++   // MEANX pulldown put_bits(&s->pb, 1, s->progressive_sequence);
++  // MEANX Pulldown
++ if(s->flags2 & CODEC_FLAG2_32_PULLDOWN) //MEANX
++                        put_bits(&s->pb, 1, 0);
++                else
++                        put_bits(&s->pb, 1, s->progressive_sequence);
++
++
++// /MEANX
++
+ 
+-                put_bits(&s->pb, 1, s->progressive_sequence);
+                 put_bits(&s->pb, 2, s->chroma_format);
+                 put_bits(&s->pb, 2, s->width >>12);
+                 put_bits(&s->pb, 2, s->height>>12);
+@@ -339,6 +382,8 @@
+ 
+ void mpeg1_encode_picture_header(MpegEncContext *s, int picture_number)
+ {
++	int tff,rff; //MEANX
++
+     mpeg1_encode_sequence_header(s);
+ 
+     /* mpeg1 picture header */
+@@ -375,6 +420,49 @@
+ 
+     s->frame_pred_frame_dct = 1;
+     if(s->codec_id == CODEC_ID_MPEG2VIDEO){
++ /* MEANX -- Pulldown */
++        if(s->flags2 & CODEC_FLAG2_32_PULLDOWN)
++        {
++        
++                switch((s->picture_number - 
++                          s->gop_picture_number)&3)
++                {
++                        case 0:
++                        default:
++                                rff=1;
++                                tff=1;
++                                break;
++                        case 1:
++                                rff=0;
++                                tff=0;
++                                break;
++                        case 2:
++                                rff=1;
++                                tff=0;
++                                break;
++                        case 3:
++                                rff=0;
++                                tff=1;
++                                break;
++                }               
++           }
++        else
++        {
++                if (s->progressive_sequence) 
++                {
++                        tff=0; /* no repeat */
++                } else 
++                {
++                        tff= s->current_picture_ptr->top_field_first;
++                }
++                rff=s->repeat_first_field;
++        
++        }
++
++//               /MEANX pulldown
++
++
++
+         put_header(s, EXT_START_CODE);
+         put_bits(&s->pb, 4, 8); //pic ext
+         if (s->pict_type == FF_P_TYPE || s->pict_type == FF_B_TYPE) {
+@@ -393,11 +481,16 @@
+ 
+         assert(s->picture_structure == PICT_FRAME);
+         put_bits(&s->pb, 2, s->picture_structure);
++#if 0 //MEANX
++
+         if (s->progressive_sequence) {
+             put_bits(&s->pb, 1, 0); /* no repeat */
+         } else {
+             put_bits(&s->pb, 1, s->current_picture_ptr->top_field_first);
+         }
++#endif
++         put_bits(&s->pb, 1, tff);  //MEANX PULLDOWN
++
+         /* XXX: optimize the generation of this flag with entropy
+            measures */
+         s->frame_pred_frame_dct = s->progressive_sequence;
+@@ -407,7 +500,10 @@
+         put_bits(&s->pb, 1, s->q_scale_type);
+         put_bits(&s->pb, 1, s->intra_vlc_format);
+         put_bits(&s->pb, 1, s->alternate_scan);
+-        put_bits(&s->pb, 1, s->repeat_first_field);
++ // MEANX put_bits(&s->pb, 1, s->repeat_first_field);
++	put_bits(&s->pb, 1, rff);
++      // /MEANX
++
+         s->progressive_frame = s->progressive_sequence;
+         put_bits(&s->pb, 1, s->chroma_format == CHROMA_420 ? s->progressive_frame : 0); /* chroma_420_type */
+         put_bits(&s->pb, 1, s->progressive_frame);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2010-12-20 13:36:10 UTC (rev 6853)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo.c.patch	2010-12-20 14:57:56 UTC (rev 6854)
@@ -1,23 +1,15 @@
-*** libavcodec/mpegvideo.c.old	Sun Sep  5 02:05:37 2010
---- libavcodec/mpegvideo.c	Sun Sep  5 02:05:37 2010
-***************
-*** 653,659 ****
-      FF_ALLOCZ_OR_GOTO(s->avctx, s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE, fail);
-  
-      s->parse_context.state= -1;
-!     if((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
-         s->visualization_buffer[0] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
-         s->visualization_buffer[1] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
-         s->visualization_buffer[2] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
---- 653,663 ----
-      FF_ALLOCZ_OR_GOTO(s->avctx, s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE, fail);
-  
-      s->parse_context.state= -1;
-!  //MEANX: Allocate them always, as they may be free when we decode 1st image
-! 
-!     // MEANXif((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
-! if(1){ // MEANX
-! 
-         s->visualization_buffer[0] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
-         s->visualization_buffer[1] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
-         s->visualization_buffer[2] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
+--- libavcodec/mpegvideo.c.old	2010-12-20 13:49:25 +0000
++++ libavcodec/mpegvideo.c	2010-12-20 13:49:25 +0000
+@@ -653,7 +653,11 @@
+     FF_ALLOCZ_OR_GOTO(s->avctx, s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE, fail);
+ 
+     s->parse_context.state= -1;
+-    if((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
++ //MEANX: Allocate them always, as they may be free when we decode 1st image
++
++    // MEANXif((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
++if(1){ // MEANX
++
+        s->visualization_buffer[0] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
+        s->visualization_buffer[1] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
+        s->visualization_buffer[2] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch	2010-12-20 13:36:10 UTC (rev 6853)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_mpegvideo_enc.c.patch	2010-12-20 14:57:56 UTC (rev 6854)
@@ -1,34 +1,30 @@
-*** libavcodec/mpegvideo_enc.c.old	Sat Mar 27 20:05:40 2010
---- libavcodec/mpegvideo_enc.c	Sat Mar 27 20:05:40 2010
-***************
-*** 367,378 ****
---- 367,380 ----
-  
-          av_log(avctx, AV_LOG_INFO, "Warning vbv_delay will be set to 0xFFFF (=VBR) as the specified vbv buffer is too large for the given bitrate!\n");
-      }
-+ #if 0 //MEANX
-  
-      if((s->flags & CODEC_FLAG_4MV) && s->codec_id != CODEC_ID_MPEG4
-         && s->codec_id != CODEC_ID_H263 && s->codec_id != CODEC_ID_H263P && s->codec_id != CODEC_ID_FLV1){
-          av_log(avctx, AV_LOG_ERROR, "4MV not supported by codec\n");
-          return -1;
-      }
-+ #endif
-  
-      if(s->obmc && s->avctx->mb_decision != FF_MB_DECISION_SIMPLE){
-          av_log(avctx, AV_LOG_ERROR, "OBMC is only supported with simple mb decision\n");
-***************
-*** 413,422 ****
---- 415,426 ----
-          return -1;
-      }
-  
-+ #if 0 //MEANX
-      if(s->mpeg_quant && s->codec_id != CODEC_ID_MPEG4){ //FIXME mpeg2 uses that too
-          av_log(avctx, AV_LOG_ERROR, "mpeg2 style quantization not supported by codec\n");
-          return -1;
-      }
-+ #endif
-  
-      if((s->flags & CODEC_FLAG_CBP_RD) && !avctx->trellis){
-          av_log(avctx, AV_LOG_ERROR, "CBP RD needs trellis quant\n");
+--- libavcodec/mpegvideo_enc.c.old	2010-12-20 13:49:26 +0000
++++ libavcodec/mpegvideo_enc.c	2010-12-20 13:49:26 +0000
+@@ -367,12 +367,14 @@
+ 
+         av_log(avctx, AV_LOG_INFO, "Warning vbv_delay will be set to 0xFFFF (=VBR) as the specified vbv buffer is too large for the given bitrate!\n");
+     }
++#if 0 //MEANX
+ 
+     if((s->flags & CODEC_FLAG_4MV) && s->codec_id != CODEC_ID_MPEG4
+        && s->codec_id != CODEC_ID_H263 && s->codec_id != CODEC_ID_H263P && s->codec_id != CODEC_ID_FLV1){
+         av_log(avctx, AV_LOG_ERROR, "4MV not supported by codec\n");
+         return -1;
+     }
++#endif
+ 
+     if(s->obmc && s->avctx->mb_decision != FF_MB_DECISION_SIMPLE){
+         av_log(avctx, AV_LOG_ERROR, "OBMC is only supported with simple mb decision\n");
+@@ -413,10 +415,12 @@
+         return -1;
+     }
+ 
++#if 0 //MEANX
+     if(s->mpeg_quant && s->codec_id != CODEC_ID_MPEG4){ //FIXME mpeg2 uses that too
+         av_log(avctx, AV_LOG_ERROR, "mpeg2 style quantization not supported by codec\n");
+         return -1;
+     }
++#endif
+ 
+     if((s->flags & CODEC_FLAG_CBP_RD) && !avctx->trellis){
+         av_log(avctx, AV_LOG_ERROR, "CBP RD needs trellis quant\n");

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2010-12-20 13:36:10 UTC (rev 6853)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_utils.c.patch	2010-12-20 14:57:56 UTC (rev 6854)
@@ -1,17 +1,15 @@
-*** libavcodec/utils.c.old	Fri Nov 26 17:53:37 2010
---- libavcodec/utils.c	Fri Nov 26 17:53:37 2010
-***************
-*** 655,664 ****
---- 655,666 ----
-  
-      if((avctx->codec->capabilities & CODEC_CAP_DELAY) || avpkt->size){
-          //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
-+ #if 0 // MEANX : Silence
-          if(*frame_size_ptr < AVCODEC_MAX_AUDIO_FRAME_SIZE){
-              av_log(avctx, AV_LOG_ERROR, "buffer smaller than AVCODEC_MAX_AUDIO_FRAME_SIZE\n");
-              return -1;
-          }
-+ #endif
-          if(*frame_size_ptr < FF_MIN_BUFFER_SIZE ||
-          *frame_size_ptr < avctx->channels * avctx->frame_size * sizeof(int16_t)){
-              av_log(avctx, AV_LOG_ERROR, "buffer %d too small\n", *frame_size_ptr);
+--- libavcodec/utils.c.old	2010-12-20 13:49:27 +0000
++++ libavcodec/utils.c	2010-12-20 13:49:27 +0000
+@@ -659,10 +659,12 @@
+ 
+     if((avctx->codec->capabilities & CODEC_CAP_DELAY) || avpkt->size){
+         //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
++#if 0 // MEANX : Silence
+         if(*frame_size_ptr < AVCODEC_MAX_AUDIO_FRAME_SIZE){
+             av_log(avctx, AV_LOG_ERROR, "buffer smaller than AVCODEC_MAX_AUDIO_FRAME_SIZE\n");
+             return -1;
+         }
++#endif
+         if(*frame_size_ptr < FF_MIN_BUFFER_SIZE ||
+         *frame_size_ptr < avctx->channels * avctx->frame_size * sizeof(int16_t)){
+             av_log(avctx, AV_LOG_ERROR, "buffer %d too small\n", *frame_size_ptr);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_vc1dec.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_vc1dec.c.patch	2010-12-20 13:36:10 UTC (rev 6853)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavcodec_vc1dec.c.patch	2010-12-20 14:57:56 UTC (rev 6854)
@@ -1,22 +1,14 @@
-*** libavcodec/vc1dec.c.old	Mon Aug  2 20:19:57 2010
---- libavcodec/vc1dec.c	Mon Aug  2 20:19:57 2010
-***************
-*** 3146,3152 ****
-      AVFrame *pict = data;
-      uint8_t *buf2 = NULL;
-      const uint8_t *buf_start = buf;
-! 
-      /* no supplementary picture */
-      if (buf_size == 0) {
-          /* special case for last picture */
---- 3146,3155 ----
-      AVFrame *pict = data;
-      uint8_t *buf2 = NULL;
-      const uint8_t *buf_start = buf;
-! /** MEANX **/
-!     if(s->flags& CODEC_FLAG_LOW_DELAY)
-!         s->low_delay=1;
-! /** /MEANX **/
-      /* no supplementary picture */
-      if (buf_size == 0) {
-          /* special case for last picture */
+--- libavcodec/vc1dec.c.old	2010-12-20 13:49:28 +0000
++++ libavcodec/vc1dec.c	2010-12-20 13:49:28 +0000
+@@ -3146,7 +3146,10 @@
+     AVFrame *pict = data;
+     uint8_t *buf2 = NULL;
+     const uint8_t *buf_start = buf;
+-
++/** MEANX **/
++    if(s->flags& CODEC_FLAG_LOW_DELAY)
++        s->low_delay=1;
++/** /MEANX **/
+     /* no supplementary picture */
+     if (buf_size == 0) {
+         /* special case for last picture */

Deleted: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_Makefile.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_Makefile.patch	2010-12-20 13:36:10 UTC (rev 6853)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_Makefile.patch	2010-12-20 14:57:56 UTC (rev 6854)
@@ -1,19 +0,0 @@
-*** libavformat/Makefile.old	Sun Nov 28 09:30:28 2010
---- libavformat/Makefile	Sun Nov 28 09:30:28 2010
-***************
-*** 114,120 ****
-                                              riff.o isom.o rmdec.o rm.o
-  OBJS-$(CONFIG_MATROSKA_MUXER)            += matroskaenc.o matroska.o \
-                                              riff.o isom.o avc.o \
-!                                             flacenc_header.o
-  OBJS-$(CONFIG_MD5_MUXER)                 += md5enc.o
-  OBJS-$(CONFIG_MJPEG_DEMUXER)             += rawdec.o
-  OBJS-$(CONFIG_MJPEG_MUXER)               += rawenc.o
---- 114,120 ----
-                                              riff.o isom.o rmdec.o rm.o
-  OBJS-$(CONFIG_MATROSKA_MUXER)            += matroskaenc.o matroska.o \
-                                              riff.o isom.o avc.o \
-!                                             flacenc_header.o avlanguage.o
-  OBJS-$(CONFIG_MD5_MUXER)                 += md5enc.o
-  OBJS-$(CONFIG_MJPEG_DEMUXER)             += rawdec.o
-  OBJS-$(CONFIG_MJPEG_MUXER)               += rawenc.o

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch	2010-12-20 13:36:10 UTC (rev 6853)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_file.c.patch	2010-12-20 14:57:56 UTC (rev 6854)
@@ -1,80 +1,78 @@
-*** libavformat/file.c.old	Tue Jul  6 19:51:26 2010
---- libavformat/file.c	Tue Jul  6 19:51:26 2010
-***************
-*** 30,35 ****
---- 30,104 ----
-  #include <stdlib.h>
-  #include "os_support.h"
-  
-+ // GRUNTSTER start
-+ #ifdef __WIN32
-+ #include <windows.h>
-+ 
-+ int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString);
-+ int ADM_open(const char *path, int oflag, ...);
-+ 
-+ int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString)
-+ {
-+ 	int wideCharStringLength = MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, NULL, 0);
-+ 
-+ 	if (wideCharString)
-+ 		MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, wideCharString, wideCharStringLength);
-+ 
-+ 	return wideCharStringLength;
-+ }
-+ 
-+ int ADM_open(const char *path, int oflag, ...)
-+ {
-+ 	int fileNameLength = utf8StringToWideChar(path, -1, NULL);
-+ 	wchar_t wcFile[fileNameLength];
-+ 	int creation = 0, access = 0;
-+ 	HANDLE hFile;
-+ 
-+ 	utf8StringToWideChar(path, -1, wcFile);
-+ 
-+ 	if (oflag & O_WRONLY || oflag & O_RDWR)
-+ 	{
-+ 		access = GENERIC_WRITE;
-+ 
-+ 		if (oflag & O_RDWR)
-+ 			access |= GENERIC_READ;
-+ 
-+ 		if (oflag & O_CREAT)
-+ 		{
-+ 			if (oflag & O_EXCL)
-+ 				creation = CREATE_NEW;
-+ 			else if (oflag & O_TRUNC)
-+ 				creation = CREATE_ALWAYS;
-+ 			else
-+ 				creation = OPEN_ALWAYS;
-+ 		}
-+ 		else if (oflag & O_TRUNC)
-+ 			creation = TRUNCATE_EXISTING;
-+ 	}
-+ 	else if (oflag & O_RDONLY)
-+ 		creation = OPEN_EXISTING;
-+ 
-+ 	if (creation & GENERIC_WRITE)
-+ 	{
-+ 		hFile = CreateFileW(wcFile, access, 0, NULL, creation, 0, NULL);
-+ 
-+ 		if (hFile == INVALID_HANDLE_VALUE)
-+ 			return -1;
-+ 		else
-+ 			CloseHandle(hFile);
-+ 	}
-+ 
-+ 	hFile = CreateFileW(wcFile, access, FILE_SHARE_READ, NULL, creation, 0, NULL);
-+ 
-+ 	if (hFile == INVALID_HANDLE_VALUE)
-+ 		return -1;
-+ 	else
-+ 		return _open_osfhandle((intptr_t)hFile, oflag);
-+ }
-+ 
-+ #define open ADM_open
-+ #endif
-+ // GRUNTSTER end
-  
-  /* standard file protocol */
-  
+--- libavformat/file.c.old	2010-12-20 13:49:28 +0000
++++ libavformat/file.c	2010-12-20 13:49:29 +0000
+@@ -30,6 +30,75 @@
+ #include <stdlib.h>
+ #include "os_support.h"
+ 
++// GRUNTSTER start
++#ifdef __WIN32
++#include <windows.h>
++
++int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString);
++int ADM_open(const char *path, int oflag, ...);
++
++int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString)
++{
++	int wideCharStringLength = MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, NULL, 0);
++
++	if (wideCharString)
++		MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, wideCharString, wideCharStringLength);
++
++	return wideCharStringLength;
++}
++
++int ADM_open(const char *path, int oflag, ...)
++{
++	int fileNameLength = utf8StringToWideChar(path, -1, NULL);
++	wchar_t wcFile[fileNameLength];
++	int creation = 0, access = 0;
++	HANDLE hFile;
++
++	utf8StringToWideChar(path, -1, wcFile);
++
++	if (oflag & O_WRONLY || oflag & O_RDWR)
++	{
++		access = GENERIC_WRITE;
++
++		if (oflag & O_RDWR)
++			access |= GENERIC_READ;
++
++		if (oflag & O_CREAT)
++		{
++			if (oflag & O_EXCL)
++				creation = CREATE_NEW;
++			else if (oflag & O_TRUNC)
++				creation = CREATE_ALWAYS;
++			else
++				creation = OPEN_ALWAYS;
++		}
++		else if (oflag & O_TRUNC)
++			creation = TRUNCATE_EXISTING;
++	}
++	else if (oflag & O_RDONLY)
++		creation = OPEN_EXISTING;
++
++	if (creation & GENERIC_WRITE)
++	{
++		hFile = CreateFileW(wcFile, access, 0, NULL, creation, 0, NULL);
++
++		if (hFile == INVALID_HANDLE_VALUE)
++			return -1;
++		else
++			CloseHandle(hFile);
++	}
++
++	hFile = CreateFileW(wcFile, access, FILE_SHARE_READ, NULL, creation, 0, NULL);
++
++	if (hFile == INVALID_HANDLE_VALUE)
++		return -1;
++	else
++		return _open_osfhandle((intptr_t)hFile, oflag);
++}
++
++#define open ADM_open
++#endif
++// GRUNTSTER end
+ 
+ /* standard file protocol */
+ 

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2010-12-20 13:36:10 UTC (rev 6853)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_isom.c.patch	2010-12-20 14:57:56 UTC (rev 6854)
@@ -1,22 +1,14 @@
-*** libavformat/isom.c.old	Fri Nov 26 17:53:40 2010
---- libavformat/isom.c	Fri Nov 26 17:53:40 2010
-***************
-*** 222,228 ****
-      { CODEC_ID_MP1, MKTAG('.', 'm', 'p', '1') }, /* MPEG layer 1 */
-      { CODEC_ID_MP2, MKTAG('.', 'm', 'p', '2') }, /* MPEG layer 2 */
-  
-!     { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at http://www.3ivx.com/showcase.html use this tag */
-      { CODEC_ID_MP3, 0x6D730055 }, /* MPEG layer 3 */
-  
-  /*  { CODEC_ID_OGG_VORBIS, MKTAG('O', 'g', 'g', 'S') }, *//* sample files at http://heroinewarrior.com/xmovie.php3 use this tag */
---- 222,231 ----
-      { CODEC_ID_MP1, MKTAG('.', 'm', 'p', '1') }, /* MPEG layer 1 */
-      { CODEC_ID_MP2, MKTAG('.', 'm', 'p', '2') }, /* MPEG layer 2 */
-  
-!     //MEANX { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at http://www.3ivx.com/showcase.html use this tag */
-!      { CODEC_ID_MP3, MKTAG( 'm', 'p', '4','a') },
-!      { CODEC_ID_MP2, MKTAG( 'm', 'p', '4', 'a') },
-!     // /MEANX
-      { CODEC_ID_MP3, 0x6D730055 }, /* MPEG layer 3 */
-  
-  /*  { CODEC_ID_OGG_VORBIS, MKTAG('O', 'g', 'g', 'S') }, *//* sample files at http://heroinewarrior.com/xmovie.php3 use this tag */
+--- libavformat/isom.c.old	2010-12-20 13:49:29 +0000
++++ libavformat/isom.c	2010-12-20 13:49:29 +0000
+@@ -222,7 +222,10 @@
+     { CODEC_ID_MP1, MKTAG('.', 'm', 'p', '1') }, /* MPEG layer 1 */
+     { CODEC_ID_MP2, MKTAG('.', 'm', 'p', '2') }, /* MPEG layer 2 */
+ 
+-    { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at http://www.3ivx.com/showcase.html use this tag */
++    //MEANX { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at http://www.3ivx.com/showcase.html use this tag */
++     { CODEC_ID_MP3, MKTAG( 'm', 'p', '4','a') },
++     { CODEC_ID_MP2, MKTAG( 'm', 'p', '4', 'a') },
++    // /MEANX
+     { CODEC_ID_MP3, 0x6D730055 }, /* MPEG layer 3 */
+ 
+ /*  { CODEC_ID_OGG_VORBIS, MKTAG('O', 'g', 'g', 'S') }, *//* sample files at http://heroinewarrior.com/xmovie.php3 use this tag */

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2010-12-20 13:36:10 UTC (rev 6853)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavformat_matroskaenc.c.patch	2010-12-20 14:57:56 UTC (rev 6854)
@@ -1,70 +1,64 @@
-*** libavformat/matroskaenc.c.old	Fri Nov 26 17:53:41 2010
---- libavformat/matroskaenc.c	Fri Nov 26 17:53:41 2010
-***************
-*** 410,415 ****
---- 410,416 ----
-  
-  static int put_xiph_codecpriv(AVFormatContext *s, ByteIOContext *pb, AVCodecContext *codec)
-  {
-+ #if 0 // MEANX avidemux does thing differently
-      uint8_t *header_start[3];
-      int header_len[3];
-      int first_header_size;
-***************
-*** 434,439 ****
---- 435,462 ----
-          put_buffer(pb, header_start[j], header_len[j]);
-  
-      return 0;
-+ #else
-+    // Not endian safe....
-+       uint32_t packetLen[3],*ptr=(uint32_t *)codec->extradata;
-+       uint8_t *data[3],i,j;
-+       if( 3*4+ptr[0]+ptr[1]+ptr[2]!=codec->extradata_size)
-+       {
-+         av_log(s, AV_LOG_ERROR, "Broken avidemux xiph header.\n");
-+         return -1;
-+       }
-+       data[0]=codec->extradata+3*4;
-+       data[1]=data[0]+ptr[0];
-+       data[2]=data[1]+ptr[1];
-+       put_byte(pb, 2);                    // number packets - 1
-+       for (j = 0; j < 2; j++) 
-+       {
-+           put_xiph_size(pb, ptr[j]);
-+       }
-+       for (j = 0; j < 3; j++)
-+         put_buffer(pb, data[j], ptr[j]);
-+       
-+       return 0; // /MEANX
-+ #endif
-  }
-  
-  static void get_aac_sample_rates(AVFormatContext *s, AVCodecContext *codec, int *sample_rate, int *output_sample_rate)
-***************
-*** 552,557 ****
---- 575,598 ----
-          put_ebml_uint (pb, MATROSKA_ID_TRACKUID        , i + 1);
-          put_ebml_uint (pb, MATROSKA_ID_TRACKFLAGLACING , 0);    // no lacing (yet)
-  
-+  		/**  MEANX : Add a default duration for video **/
-+  		if(codec->codec_type==CODEC_TYPE_VIDEO)
-+  		{
-+  			if(codec->time_base.den && codec->time_base.num)
-+  			{
-+  				int num = codec->time_base.num;
-+  				int den = codec->time_base.den;
-+  				unsigned int default_duration;
-+  				float period = num;
-+  
-+  				period /= den;
-+  				period *= 1000*1000*1000; // in ns
-+  				default_duration = (unsigned int)floor(period);
-+  				put_ebml_uint(pb, MATROSKA_ID_TRACKDEFAULTDURATION, default_duration);
-+  			}
-+  		}
-+  		/**  MEANX : Add a default duration for video **/
+--- libavformat/matroskaenc.c.old	2010-12-20 13:49:30 +0000
++++ libavformat/matroskaenc.c	2010-12-20 13:49:30 +0000
+@@ -410,6 +410,7 @@
+ 
+ static int put_xiph_codecpriv(AVFormatContext *s, ByteIOContext *pb, AVCodecContext *codec)
+ {
++#if 0 // MEANX avidemux does thing differently
+     uint8_t *header_start[3];
+     int header_len[3];
+     int first_header_size;
+@@ -434,6 +435,28 @@
+         put_buffer(pb, header_start[j], header_len[j]);
+ 
+     return 0;
++#else
++   // Not endian safe....
++      uint32_t packetLen[3],*ptr=(uint32_t *)codec->extradata;
++      uint8_t *data[3],i,j;
++      if( 3*4+ptr[0]+ptr[1]+ptr[2]!=codec->extradata_size)
++      {
++        av_log(s, AV_LOG_ERROR, "Broken avidemux xiph header.\n");
++        return -1;
++      }
++      data[0]=codec->extradata+3*4;
++      data[1]=data[0]+ptr[0];
++      data[2]=data[1]+ptr[1];
++      put_byte(pb, 2);                    // number packets - 1
++      for (j = 0; j < 2; j++) 
++      {
++          put_xiph_size(pb, ptr[j]);
++      }
++      for (j = 0; j < 3; j++)
++        put_buffer(pb, data[j], ptr[j]);
++      
++      return 0; // /MEANX
++#endif
+ }
+ 
+ static void get_aac_sample_rates(AVFormatContext *s, AVCodecContext *codec, int *sample_rate, int *output_sample_rate)
+@@ -552,6 +575,24 @@
+         put_ebml_uint (pb, MATROSKA_ID_TRACKUID        , i + 1);
+         put_ebml_uint (pb, MATROSKA_ID_TRACKFLAGLACING , 0);    // no lacing (yet)
+ 
++ 		/**  MEANX : Add a default duration for video **/
++ 		if(codec->codec_type==CODEC_TYPE_VIDEO)
++ 		{
++ 			if(codec->time_base.den && codec->time_base.num)
++ 			{
++ 				int num = codec->time_base.num;
++ 				int den = codec->time_base.den;
++ 				unsigned int default_duration;
++ 				float period = num;
 + 
-          if ((tag = av_metadata_get(st->metadata, "title", NULL, 0)))
-              put_ebml_string(pb, MATROSKA_ID_TRACKNAME, tag->value);
-          tag = av_metadata_get(st->metadata, "language", NULL, 0);
++ 				period /= den;
++ 				period *= 1000*1000*1000; // in ns
++ 				default_duration = (unsigned int)floor(period);
++ 				put_ebml_uint(pb, MATROSKA_ID_TRACKDEFAULTDURATION, default_duration);
++ 			}
++ 		}
++ 		/**  MEANX : Add a default duration for video **/
++
+         if ((tag = av_metadata_get(st->metadata, "title", NULL, 0)))
+             put_ebml_string(pb, MATROSKA_ID_TRACKNAME, tag->value);
+         tag = av_metadata_get(st->metadata, "language", NULL, 0);

Modified: branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch
===================================================================
--- branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch	2010-12-20 13:36:10 UTC (rev 6853)
+++ branches/avidemux_2.5_branch_gruntster/cmake/patches/libavutil_avutil.h.patch	2010-12-20 14:57:56 UTC (rev 6854)
@@ -1,18 +1,16 @@
-*** libavutil/avutil.h.old	Sat Jan 24 22:57:50 2009
---- libavutil/avutil.h	Sat Jan 24 22:57:49 2009
-***************
-*** 26,31 ****
---- 26,38 ----
-   * external API header
-   */
-  
-+ /* MEANX
-+  * - */
-+ #define ASMALIGN(ZEROBITS) ".p2align " #ZEROBITS "\n\t"
-+ /* /MEANX
-+  */
-+ 
-+ 
-  
-  #define AV_STRINGIFY(s)         AV_TOSTRING(s)
-  #define AV_TOSTRING(s) #s
+--- libavutil/avutil.h.old	2010-12-20 13:49:31 +0000
++++ libavutil/avutil.h	2010-12-20 13:49:31 +0000
+@@ -26,6 +26,13 @@
+  * external API header
+  */
+ 
++/* MEANX
++ * - */
++#define ASMALIGN(ZEROBITS) ".p2align " #ZEROBITS "\n\t"
++/* /MEANX
++ */
++
++
+ 
+ #define AV_STRINGIFY(s)         AV_TOSTRING(s)
+ #define AV_TOSTRING(s) #s



From mean at mail.berlios.de  Tue Dec 21 07:20:50 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 21 Dec 2010 07:20:50 +0100
Subject: [Avidemux-svn-commit] r6855 -
	branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_matroska
Message-ID: <20101221062050.6E564480BF4@sheep.berlios.de>

Author: mean
Date: 2010-12-21 07:20:50 +0100 (Tue, 21 Dec 2010)
New Revision: 6855

Modified:
   branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp
Log:
[mkv] When no channels, default is mono not stereo, fix #115

Modified: branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp	2010-12-20 14:57:56 UTC (rev 6854)
+++ branches/avidemux_2.5_branch_gruntster/avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp	2010-12-21 06:20:50 UTC (rev 6855)
@@ -99,7 +99,7 @@
       memset(&entry,0,sizeof(entry));
       /* Set some defaults value */
 
-      entry.chan=2;
+      entry.chan=1;
 
       entryWalk(  (ADM_ebml_file *)head,headlen,&entry);
       entry.dump();



From mean at mail.berlios.de  Tue Dec 21 07:48:22 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 21 Dec 2010 07:48:22 +0100
Subject: [Avidemux-svn-commit] r6856 - in
	branches/avidemux_2.6_branch_mean/avidemux/common: ADM_editor
	ADM_script2/src
Message-ID: <20101221064822.E1BA8480BF4@sheep.berlios.de>

Author: mean
Date: 2010-12-21 07:48:22 +0100 (Tue, 21 Dec 2010)
New Revision: 6856

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edPySave.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAudio.cpp
Log:
[script] Save/load resample fq

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edPySave.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edPySave.cpp	2010-12-21 06:20:50 UTC (rev 6855)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edPySave.cpp	2010-12-21 06:48:22 UTC (rev 6856)
@@ -167,29 +167,6 @@
    
    qfprintf(fd,"\n#** Audio **\n");
    qfprintf(fd,"adm.audioReset()\n");
-#if 0
-   // External audio ?
-        char *audioName;
-        AudioSource  source;
-
-        source=getCurrentAudioSource(&audioName);
-        if(!audioName) audioName="";
-
-        if(source!=AudioAvi)
-        {
-                char *nm=ADM_cleanupPath(audioName);
-                qfprintf(fd,"app.audio.load(\"%s\",\"%s\")\n", audioSourceFromEnum(source),nm); 
-                ADM_dealloc(nm);
-        }
-        else 
-        { // Maybe not the 1st track
-          int source;
-               source=video_body->getCurrentAudioStreamNumber(0);
-               if(source)
-                        qfprintf(fd,"app.audio.setTrack(%d)\n", source); 
-                        
-        }
-#endif
  { // Maybe not the 1st track
           int source;
                source=video_body->getCurrentAudioStreamNumber(0);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAudio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAudio.cpp	2010-12-21 06:20:50 UTC (rev 6855)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAudio.cpp	2010-12-21 06:48:22 UTC (rev 6856)
@@ -51,14 +51,14 @@
 */
 int32_t scriptGetResample(void)
 {
-    return 0;
+    return audioFilterGetResample();;
 }
 /**
     \fn jsSetResample
 */
 void    scriptSetResample(int32_t fq)
 {
-
+    audioFilterSetResample(fq);
 }
 /**
     \fn  scriptAudioSetTrack



From mean at mail.berlios.de  Tue Dec 21 07:48:24 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 21 Dec 2010 07:48:24 +0100
Subject: [Avidemux-svn-commit] r6857 - in
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2:
	binding include py src
Message-ID: <20101221064824.2D02B480BF4@sheep.berlios.de>

Author: mean
Date: 2010-12-21 07:48:24 +0100 (Tue, 21 Dec 2010)
New Revision: 6857

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/binding/adm.admPyClass
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_scriptCommon.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm_gen.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAudio.cpp
Log:
[script/py] Add pal2film/film2pal binding

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/binding/adm.admPyClass
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/binding/adm.admPyClass	2010-12-21 06:48:22 UTC (rev 6856)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/binding/adm.admPyClass	2010-12-21 06:48:24 UTC (rev 6857)
@@ -42,3 +42,5 @@
 /* ATTRIBUTES */ double markerA:scriptSetMarkerA,scriptGetMarkerA
 /* ATTRIBUTES */ double markerB:scriptSetMarkerB,scriptGetMarkerB
 /* ATTRIBUTES */ int    audioResample:scriptSetResample,scriptGetResample
+/* ATTRIBUTES */ int    audioPal2film:scriptSetPal2film,scriptGetPal2film
+/* ATTRIBUTES */ int    audioFilm2pal:scriptSetFilm2pal,scriptGetFilm2pal

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_scriptCommon.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_scriptCommon.h	2010-12-21 06:48:22 UTC (rev 6856)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_scriptCommon.h	2010-12-21 06:48:24 UTC (rev 6857)
@@ -27,6 +27,11 @@
 // Fq
 int32_t scriptGetResample(void);
 void    scriptSetResample(int32_t fq);
+//  Frame rate converter
+int32_t scriptGetPal2film(void);
+void    scriptSetPal2film(int32_t rate);
+int32_t scriptGetFilm2pal(void);
+void    scriptSetFilm2pal(int32_t rate);
 // Markers
 double scriptGetMarkerA(void);
 double scriptGetMarkerB(void);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm_gen.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm_gen.cpp	2010-12-21 06:48:22 UTC (rev 6856)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm_gen.cpp	2010-12-21 06:48:24 UTC (rev 6857)
@@ -243,6 +243,10 @@
   tinyParams pm(vm);
   void *me=(void *)pm.asThis(&self,ADM_PYID_AVIDEMUX);
   char const *key = pm.asString();
+  if (!strcmp(key, "audioPal2film"))
+  {
+     return tp_number(scriptGetPal2film());
+  }
   if (!strcmp(key, "audioResample"))
   {
      return tp_number(scriptGetResample());
@@ -255,6 +259,10 @@
   {
      return tp_number(scriptGetMarkerB());
   }
+  if (!strcmp(key, "audioFilm2pal"))
+  {
+     return tp_number(scriptGetFilm2pal());
+  }
   if (!strcmp(key, "audioCodec"))
   {
      return tp_method(vm,self,zzpy_audioCodec);
@@ -355,6 +363,12 @@
   tinyParams pm(vm);
   void *me=(void *)pm.asThis(&self,ADM_PYID_AVIDEMUX);
   char const *key = pm.asString();
+  if (!strcmp(key, "audioPal2film"))
+  {
+     int val=pm.asInt();
+     scriptSetPal2film(val);
+     return tp_None;
+  }
   if (!strcmp(key, "audioResample"))
   {
      int val=pm.asInt();
@@ -373,6 +387,12 @@
      scriptSetMarkerB(val);
      return tp_None;
   }
+  if (!strcmp(key, "audioFilm2pal"))
+  {
+     int val=pm.asInt();
+     scriptSetFilm2pal(val);
+     return tp_None;
+  }
   return tp_None;
 }
 // Dctor

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAudio.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAudio.cpp	2010-12-21 06:48:22 UTC (rev 6856)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptAudio.cpp	2010-12-21 06:48:24 UTC (rev 6857)
@@ -61,6 +61,49 @@
     audioFilterSetResample(fq);
 }
 /**
+
+*/
+int32_t scriptGetPal2film(void)
+{
+    if(audioFilterGetFrameRate()==FILMCONV_PAL2FILM) return 1;
+    return 0;
+}
+/**
+
+*/
+int32_t scriptGetFilm2pal(void)
+{
+    if(audioFilterGetFrameRate()==FILMCONV_FILM2PAL) return 1;
+    return 0;
+}
+/**
+
+*/
+void    scriptSetPal2film(int32_t rate)
+{
+    if(rate)
+        audioFilterSetFrameRate(FILMCONV_PAL2FILM);
+    else
+    {
+        if(scriptGetPal2film())
+            audioFilterSetFrameRate(FILMCONV_NONE);
+    }
+}
+/**
+
+*/
+void    scriptSetFilm2pal(int32_t rate)
+{
+    if(rate)
+        audioFilterSetFrameRate(FILMCONV_FILM2PAL);
+    else
+    {
+        if(scriptGetFilm2pal())
+            audioFilterSetFrameRate(FILMCONV_NONE);
+    }
+}
+
+/**
     \fn  scriptAudioSetTrack
 */
 int scriptAudioSetTrack(int track)



From mean at mail.berlios.de  Tue Dec 21 07:48:25 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 21 Dec 2010 07:48:25 +0100
Subject: [Avidemux-svn-commit] r6858 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska
Message-ID: <20101221064825.61169480BF4@sheep.berlios.de>

Author: mean
Date: 2010-12-21 07:48:25 +0100 (Tue, 21 Dec 2010)
New Revision: 6858

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvEntries.cpp
Log:
[mkv/in] when no channels are specified, default is mono not stereo

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvEntries.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvEntries.cpp	2010-12-21 06:48:24 UTC (rev 6857)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvEntries.cpp	2010-12-21 06:48:25 UTC (rev 6858)
@@ -91,7 +91,7 @@
       memset(&entry,0,sizeof(entry));
       /* Set some defaults value */
 
-      entry.chan=2;
+      entry.chan=1;
 
       entryWalk(  (ADM_ebml_file *)head,headlen,&entry);
       entry.dump();



From mean at mail.berlios.de  Wed Dec 22 20:47:40 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 22 Dec 2010 20:47:40 +0100
Subject: [Avidemux-svn-commit] r6859 -
	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska
Message-ID: <20101222194740.E0EF54801D6@sheep.berlios.de>

Author: mean
Date: 2010-12-22 20:47:40 +0100 (Wed, 22 Dec 2010)
New Revision: 6859

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvEntries.cpp
Log:
[mkv] Set defaultDuration when none is provided

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvEntries.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvEntries.cpp	2010-12-21 06:48:25 UTC (rev 6858)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/ADM_mkvEntries.cpp	2010-12-22 19:47:40 UTC (rev 6859)
@@ -113,6 +113,7 @@
           printf("[MKV] No duration, assuming 25 fps\n");
           _videostream.dwScale=1000;
           _videostream.dwRate=25000;
+          _tracks[0]._defaultFrameDuration=25000;
 
         }
 



From mean at mail.berlios.de  Wed Dec 22 20:47:41 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 22 Dec 2010 20:47:41 +0100
Subject: [Avidemux-svn-commit] r6860 -
	branches/avidemux_2.6_branch_mean/cmake_compile_check
Message-ID: <20101222194741.B27EC4801D6@sheep.berlios.de>

Author: mean
Date: 2010-12-22 20:47:41 +0100 (Wed, 22 Dec 2010)
New Revision: 6860

Added:
   branches/avidemux_2.6_branch_mean/cmake_compile_check/execinfo.cpp
Log:
[bsd] Add exec info file

Added: branches/avidemux_2.6_branch_mean/cmake_compile_check/execinfo.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake_compile_check/execinfo.cpp	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake_compile_check/execinfo.cpp	2010-12-22 19:47:41 UTC (rev 6860)
@@ -0,0 +1,37 @@
+#include <execinfo.h>
+#include <stdio.h>
+#include <stdlib.h>
+     
+/* Obtain a backtrace and print it to stdout. */
+void
+print_trace (void)
+{
+   void *array[10];
+   size_t size;
+   char **strings;
+   size_t i;
+     
+   size = backtrace (array, 10);
+   strings = backtrace_symbols (array, size);
+ 
+   printf ("Obtained %zd stack frames.\n", size);
+     
+   for (i = 0; i < size; i++)
+   printf ("%s\n", strings[i]);
+     
+   free (strings);
+}
+     
+/* A dummy function to make the backtrace more interesting. */
+void
+dummy_function (void)
+{
+   print_trace ();
+}
+     
+int
+main (void)
+{
+   dummy_function ();
+   return 0;
+}



From mean at mail.berlios.de  Thu Dec 23 10:04:14 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 23 Dec 2010 10:04:14 +0100
Subject: [Avidemux-svn-commit] r6861 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101223090414.6709A48024D@sheep.berlios.de>

Author: mean
Date: 2010-12-23 10:04:13 +0100 (Thu, 23 Dec 2010)
New Revision: 6861

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admCheckMiscLibs.cmake
Log:
[bsd] Bsd patch,check if exec info is there

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckMiscLibs.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckMiscLibs.cmake	2010-12-22 19:47:41 UTC (rev 6860)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckMiscLibs.cmake	2010-12-23 09:04:13 UTC (rev 6861)
@@ -72,3 +72,41 @@
 ENDIF (USE_SYSTEM_SPIDERMONKEY)
 
 MESSAGE("")
+########################################
+# Execinfo
+########################################
+MESSAGE(STATUS "Checking for execinfo")
+MESSAGE(STATUS "*********************")
+
+FIND_PATH(LIBEXECINFO_H_DIR execinfo.h $ENV{CXXFLAGS})
+MESSAGE(STATUS "libexecinfo Header Path: ${LIBEXECINFO_H_DIR}")
+
+IF (NOT LIBEXECINFO_H_DIR STREQUAL "LIBEXECINFO_H-NOTFOUND")
+        FIND_LIBRARY(LIBEXECINFO_LIB_DIR execinfo $ENV{CXXFLAGS})
+        MESSAGE(STATUS "libexecinfo Library Path: ${LIBEXECINFO_LIB_DIR}")
+
+        # Try linking without -lexecinfo
+        ADM_COMPILE(execinfo.cpp "" ${LIBEXECINFO_H_DIR} "" WITHOUT_LIBEXECINFO outputWithoutLibexecinfo)
+
+        IF (WITHOUT_LIBEXECINFO)
+               SET(HAVE_EXECINFO 1)
+               MESSAGE(STATUS "OK, No lib needed (${ADM_EXECINFO_LIB})")
+        ELSE (WITHOUT_LIBEXECINFO)
+               ADM_COMPILE(execinfo.cpp "" ${LIBEXECINFO_H_DIR} ${LIBEXECINFO_LIB_DIR} WITH_LIBEXECINFO outputWithLibexecinfo)
+
+               IF (WITH_LIBEXECINFO)
+                           SET(HAVE_EXECINFO 1)
+                            MESSAGE(STATUS "OK, libexecinfo needed")
+               ELSE (WITH_LIBEXECINFO)
+                            MESSAGE(STATUS "Does not work, without ${outputWithoutLibexecinfo}")
+                            MESSAGE(STATUS "Does not work, with ${outputWithLibexecinfo}")
+                        ENDIF (WITH_LIBEXECINFO)
+                ENDIF (WITHOUT_LIBEXECINFO)
+        ENDIF (NOT LIBEXECINFO_H_DIR STREQUAL "LIBEXECINFO_H-NOTFOUND")
+
+        IF (HAVE_EXECINFO)
+                SET(CMAKE_CLINK_FLAGS "${CFLAGS} -lexecinfo")
+                SET(CMAKE_CXX_LINK_FLAGS "${CXXFLAGS} -lexecinfo")
+        ENDIF(HAVE_EXECINFO)
+
+MESSAGE("")



From gruntster at mail.berlios.de  Fri Dec 24 23:43:39 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri, 24 Dec 2010 23:43:39 +0100
Subject: [Avidemux-svn-commit] r6862 -
	branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui
Message-ID: <20101224224340.1996248027F@sheep.berlios.de>

Author: gruntster
Date: 2010-12-24 23:43:39 +0100 (Fri, 24 Dec 2010)
New Revision: 6862

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui
Log:
[qt] employ docking widgets so sections can be hidden

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2010-12-23 09:04:13 UTC (rev 6861)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2010-12-24 22:43:39 UTC (rev 6862)
@@ -1,1197 +1,1203 @@
-/***************************************************************************
-    copyright            : (C) 2001 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include "config.h"
-#include "ADM_inttype.h"
-#include <QtCore/QFileInfo>
-#include <QtCore/QUrl>
-#include <QtGui/QKeyEvent>
-#include <QtGui/QGraphicsView>
-
-#define MENU_DECLARE
-#include "Q_gui2.h"
-#include "ADM_default.h"
-
-#include "DIA_fileSel.h"
-#include "ADM_vidMisc.h"
-#include "prefs.h"
-#include "avi_vars.h"
-
-#include "ADM_render/GUI_renderInternal.h"
-#include "ADM_coreVideoEncoderInternal.h"
-#include "ADM_muxerProto.h"
-#include "T_vumeter.h"
-#include "DIA_coreToolkit.h"
-
-extern int global_argc;
-extern char **global_argv;
-
-extern uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w,uint32_t *h);
-extern int automation(void );
-extern void HandleAction(Action a);
-extern int encoderGetEncoderCount (void);
-extern const char *encoderGetIndexedName (uint32_t i);
-uint32_t audioEncoderGetNumberOfEncoders(void);
-const char  *audioEncoderGetDisplayName(uint32_t i);
-extern void checkCrashFile(void);
-extern void UI_QT4VideoWidget(QFrame *frame);
-extern void loadTranslator(void);
-extern void initTranslator(void);
-extern void destroyTranslator(void);
-extern ADM_RENDER_TYPE UI_getPreferredRender(void);
-extern int A_openAvi(const char *name);
-extern int A_appendAvi(const char *name);
-extern void FileSel_ReadWrite(SELFILE_CB *cb, int rw, const char *name, const char *actual_workbench_file);
-
-
-int SliderIsShifted=0;
-static void setupMenus(void);
-static int shiftKeyHeld=0;
-static ADM_QSlider *slider=NULL;
-static int _upd_in_progres=0;
-static int currentFps = 0;
-static int frameCount = 0;
-static int currentFrame = 0;
-bool     ADM_ve6_getEncoderInfo(int filter, const char **name, uint32_t *major,uint32_t *minor,uint32_t *patch);
-uint32_t ADM_ve6_getNbEncoders(void);
-void UI_refreshCustomMenu(void);
-QWidget *QuiMainWindows=NULL;
-QGraphicsView *drawWindow=NULL;
-uint8_t UI_updateRecentMenu( void );
-extern void saveCrashProject(void);
-extern uint8_t AVDM_setVolume(int volume);
-extern bool ADM_QPreviewCleanup(void);
-#define WIDGET(x)  (((MainWindow *)QuiMainWindows)->ui.x)
-
-#define CONNECT(object,zzz) connect( (ui.object),SIGNAL(triggered()),this,SLOT(buttonPressed()));
-#define CONNECT_TB(object,zzz) connect( (ui.object),SIGNAL(clicked(bool)),this,SLOT(toolButtonPressed(bool)));
-#define DECLARE_VAR(object,signal_name) {#object,signal_name},
-
-#include "translation_table.h"   
-
-/*
-    Declare the table converting widget name to our internal signal           
-*/
-typedef struct 
-{
-	const char *name;
-	Action     action; 
-}adm_qt4_translation;
-
-const adm_qt4_translation myTranslationTable[]=
-{
-#define PROCESS DECLARE_VAR
-	LIST_OF_BUTTONS
-#undef PROCESS
-};
-static Action searchTranslationTable(const char *name);
-#define SIZEOF_MY_TRANSLATION sizeof(myTranslationTable)/sizeof(adm_qt4_translation)
-
-int UI_readCurTime(uint16_t &hh, uint16_t &mm, uint16_t &ss, uint16_t &ms);
-void UI_updateFrameCount(uint32_t curFrame);
-void UI_updateTimeCount(uint32_t curFrame,uint32_t fps);
-extern void UI_purge(void);
-/*
-    Declare the class that will be our main window
-
-*/
-
-void MainWindow::comboChanged(int z)
-{
-	const char *source=qPrintable(sender()->objectName());
-
-	if(!strcmp(source,"comboBoxVideo"))  
-	{
-		bool b=FALSE;
-		if(ui.comboBoxVideo->currentIndex())
-		{
-			b=TRUE;
-		}
-		ui.pushButtonVideoConf->setEnabled(b);
-		ui.pushButtonVideoFilter->setEnabled(b);
-		HandleAction (ACT_VIDEO_CODEC_CHANGED) ;
-	}
-	else if(!strcmp(source,"comboBoxAudio"))  
-	{
-		bool b=FALSE;
-		if(ui.comboBoxAudio->currentIndex())
-		{
-			b=TRUE;
-		}
-		ui.pushButtonAudioConf->setEnabled(b);
-		ui.pushButtonAudioFilter->setEnabled(b);
-		HandleAction (ACT_AUDIO_CODEC_CHANGED) ;
-	}
-	else
-		printf("From +: %s\n",source);
-}
-
-void MainWindow::sliderValueChanged(int u) 
-{
-	if(!_upd_in_progres)
-		HandleAction(ACT_Scale);
-}
-
-void MainWindow::sliderMoved(int value)
-{
-	SliderIsShifted = shiftKeyHeld;
-}
-
-void MainWindow::sliderReleased(void)
-{
-	SliderIsShifted = 0;
-}
-
-void MainWindow::thumbSlider_valueEmitted(int value)
-{
-        if (value > 0)
-                nextIntraFrame();
-        else
-                previousIntraFrame();
-}
-
-void MainWindow::volumeChange( int u )
-{
-	if (_upd_in_progres || !ui.toolButtonAudioToggle->isChecked())
-		return;
-
-	_upd_in_progres++;
-
-	int vol = ui.horizontalSlider_2->value();
-
-	AVDM_setVolume(vol);
-	_upd_in_progres--;
-}
-
-void MainWindow::audioToggled(bool checked)
-{
-	if (checked)
-		AVDM_setVolume(ui.horizontalSlider_2->value());
-	else
-		AVDM_setVolume(0);
-}
-
-void MainWindow::previewModeChanged(QAction *action)
-{
-	HandleAction(ACT_PreviewChanged);
-}
-
-void MainWindow::timeChangeFinished(void)
-{
-	this->setFocus(Qt::OtherFocusReason);
-}
-
-void MainWindow::currentFrameChanged(void)
-{
-//	HandleAction(ACT_JumpToFrame);
-
-	this->setFocus(Qt::OtherFocusReason);
-}
-
-void MainWindow::currentTimeChanged(void)
-{
-	HandleAction(ACT_GotoTime);
-
-	this->setFocus(Qt::OtherFocusReason);
-}
-
-/**
-    \fn ctor
-*/
-MainWindow::MainWindow() : QMainWindow()
-{
-	ui.setupUi(this);
-
-	this->setStatusBar(0);
-	this->adjustSize();
-
-#if defined(__APPLE__) && defined(USE_SDL)
-	ui.actionAbout_avidemux->setMenuRole(QAction::NoRole);
-	ui.actionPreferences->setMenuRole(QAction::NoRole);
-	ui.actionQuit->setMenuRole(QAction::NoRole);
-#endif
-
-	// Preview modes
-	QActionGroup *groupPreviewModes = new QActionGroup(this);
-
-	groupPreviewModes->addAction(ui.actionPreviewInput);
-	groupPreviewModes->addAction(ui.actionPreviewOutput);
-	connect(groupPreviewModes, SIGNAL(triggered(QAction*)), this, SLOT(previewModeChanged(QAction*)));
-
-	/*
-	Connect our button to buttonPressed
-	*/
-#define PROCESS CONNECT_TB
-	LIST_OF_BUTTONS
-#undef PROCESS
-
-	connect(ui.actionPrevious_intra_frame, SIGNAL(triggered()), this, SLOT(previousIntraFrame()));
-	connect(ui.actionNext_intra_frame, SIGNAL(triggered()), this, SLOT(nextIntraFrame()));
-
-	//ACT_VideoCodecChanged
-	connect( ui.comboBoxVideo,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
-	connect( ui.comboBoxAudio,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
-
-	// Slider
-	slider=ui.horizontalSlider;
-	slider->setMinimum(0);
-	slider->setMaximum(1000000000);
-	connect( slider,SIGNAL(valueChanged(int)),this,SLOT(sliderValueChanged(int)));
-	connect( slider,SIGNAL(sliderMoved(int)),this,SLOT(sliderMoved(int)));
-	connect( slider,SIGNAL(sliderReleased()),this,SLOT(sliderReleased()));
-
-   // Thumb slider
-    ui.sliderPlaceHolder->installEventFilter(this);
-    thumbSlider = new ThumbSlider(ui.sliderPlaceHolder);
-    connect(thumbSlider, SIGNAL(valueEmitted(int)), this, SLOT(thumbSlider_valueEmitted(int)));
-
-	// Volume slider
-	QSlider *volSlider=ui.horizontalSlider_2;
-	volSlider->setMinimum(0);
-	volSlider->setMaximum(100);
-	connect(volSlider,SIGNAL(valueChanged(int)),this,SLOT(volumeChange(int)));
-	connect(ui.toolButtonAudioToggle,SIGNAL(clicked(bool)),this,SLOT(audioToggled(bool)));
-
-	// default state
-	bool b=0;
-	ui.pushButtonVideoConf->setEnabled(b);
-	ui.pushButtonVideoFilter->setEnabled(b);
-	ui.pushButtonAudioConf->setEnabled(b);
-	ui.pushButtonAudioFilter->setEnabled(b);
-
-	/* Time Shift */
-	connect(ui.checkBox_TimeShift,SIGNAL(stateChanged(int)),this,SLOT(timeChanged(int)));
-	connect(ui.spinBox_TimeValue,SIGNAL(valueChanged(int)),this,SLOT(timeChanged(int)));
-	connect(ui.spinBox_TimeValue, SIGNAL(editingFinished()), this, SLOT(timeChangeFinished()));
-
-	QRegExp timeRegExp("^[0-9]{2}:[0-5][0-9]:[0-5][0-9]\\.[0-9]{3}$");
-	QRegExpValidator *timeValidator = new QRegExpValidator(timeRegExp, this);
-	ui.currentTime->setValidator(timeValidator);
-	ui.currentTime->setInputMask("99:99:99.999");
-
-	//connect(ui.currentTime, SIGNAL(editingFinished()), this, SLOT(currentTimeChanged()));
-
-    // Build file,... menu
-    buildMyMenu();
-
-	/* Build the custom menu */
-    jsMenu=new QMenu("javaScript");
-    pyMenu=new QMenu("tinyPython");
-    ui.menuCustom->addMenu(jsMenu);
-    ui.menuCustom->addMenu(pyMenu);
-	buildCustomMenu();
-
-    recentFiles=new QMenu("Recent Files");
-    recentProjects=new QMenu("Recent Projects");
-    ui.menuRecent->addMenu(recentFiles);
-    ui.menuRecent->addMenu(recentProjects);
-    connect( ui.menuRecent,SIGNAL(triggered(QAction*)),this,SLOT(searchRecentFiles(QAction*)));
-
-	this->installEventFilter(this);
-	slider->installEventFilter(this);
-    
-	//ui.currentTime->installEventFilter(this);
-
-	this->setFocus(Qt::OtherFocusReason);
-
-	setAcceptDrops(true);
-    setWindowIcon(QIcon(":/new/prefix1/pics/avidemux_icon_small.png"));
-
-    // Hook also the toolbar
-    connect(ui.toolBar,  SIGNAL(actionTriggered ( QAction *)),this,SLOT(searchToolBar(QAction *)));
-    connect(ui.toolBar_2,SIGNAL(actionTriggered ( QAction *)),this,SLOT(searchToolBar(QAction *)));
-
-    
-}
-/**
-    \fn searchToolBar
-*/
-typedef struct 
-{
-    const char *name;
-    Action event;
-}toolBarTranslate;
-
-toolBarTranslate toolbar[]=
-{
-{"actionOpen",              ACT_OPEN_VIDEO},
-{"actionSave_video",        ACT_SAVE_VIDEO},
-{"actionProperties",        ACT_VIDEO_PROPERTIES},
-{"actionLoad_run_project",  ACT_RUN_PY_PROJECT},
-{"actionSave_project",      ACT_SAVE_PY_PROJECT},
-//{"actionPreviewInput",ACT_PreviewToggle},
-//{"actionPreviewOutput",ACT_PreviewToggle},
-
-{NULL,ACT_DUMMY}
-};
-void MainWindow::searchToolBar(QAction *action)
-{
-        toolBarTranslate *t=toolbar;
-        QString me(action->objectName());
-        const char *name=me.toUtf8().constData();
-        while(t->name)
-        {
-            if(!strcmp(name,t->name))
-            {
-                HandleAction(t->event);
-                return;
-            }
-            t++;
-        }
-        ADM_warning("Toolbar:Cannot handle %s\n",name);
-}
-/**
-    \fn buildFileMenu
-*/
-bool MainWindow::buildMenu(QMenu *root,MenuEntry *menu, int nb)
-{
-    QMenu *subMenu=NULL;
-    for(int i=0;i<nb;i++)
-    {
-        MenuEntry *m=menu+i;
-        switch(m->type)
-        {
-            case MENU_SEPARATOR:
-                root->addSeparator();
-                break;
-            case MENU_SUBMENU:
-                {
-                    subMenu=root->addMenu(m->text);
-                }
-                break;
-            case MENU_SUBACTION:
-            case MENU_ACTION:
-                {   
-                        QMenu *insert=root;
-                        if(m->type==MENU_SUBACTION) insert=subMenu;
-                        QAction *a=NULL;
-                        if(m->icon) 
-                        {
-                            QIcon icon(m->icon);
-                            a=insert->addAction(icon,m->text);
-                        }else
-                            a=insert->addAction(m->text);
-                        m->cookie=(void *)a;
-                        if(m->shortCut)
-                        {
-                            QKeySequence s(m->shortCut);
-                            a->setShortcut(s);
-                        }
-                        break;
-                }
-            default:
-                break;
-        }
-    }
-    return true;
-}
-/**
-    buildFileMenu
-*/
-bool MainWindow::buildMyMenu(void)
-{
-    connect( ui.menuFile,SIGNAL(triggered(QAction*)),this,SLOT(searchFileMenu(QAction*)));
-    buildMenu(ui.menuFile,myMenuFile, sizeof(myMenuFile)/sizeof(MenuEntry));
-
-    connect( ui.menuEdit,SIGNAL(triggered(QAction*)),this,SLOT(searchEditMenu(QAction*)));
-    buildMenu(ui.menuEdit,myMenuEdit, sizeof(myMenuEdit)/sizeof(MenuEntry));
-
-    connect( ui.menuVideo,SIGNAL(triggered(QAction*)),this,SLOT(searchVideoMenu(QAction*)));
-    buildMenu(ui.menuVideo,myMenuVideo, sizeof(myMenuVideo)/sizeof(MenuEntry));
-
-    connect( ui.menuAudio,SIGNAL(triggered(QAction*)),this,SLOT(searchAudioMenu(QAction*)));
-    buildMenu(ui.menuAudio,myMenuAudio, sizeof(myMenuAudio)/sizeof(MenuEntry));
-
-    connect( ui.menuHelp,SIGNAL(triggered(QAction*)),this,SLOT(searchHelpMenu(QAction*)));
-    buildMenu(ui.menuHelp,myMenuHelp, sizeof(myMenuHelp)/sizeof(MenuEntry));
-
-    connect( ui.menuTools,SIGNAL(triggered(QAction*)),this,SLOT(searchToolMenu(QAction*)));
-    buildMenu(ui.menuTools,myMenuTool, sizeof(myMenuTool)/sizeof(MenuEntry));
-
-    connect( ui.menuGo,SIGNAL(triggered(QAction*)),this,SLOT(searchGoMenu(QAction*)));
-    buildMenu(ui.menuGo,myMenuGo, sizeof(myMenuGo)/sizeof(MenuEntry));
-
-    connect( ui.menuView,SIGNAL(triggered(QAction*)),this,SLOT(searchViewMenu(QAction*)));
-    buildMenu(ui.menuView,myMenuView, sizeof(myMenuView)/sizeof(MenuEntry));
-
-    return true;
-}
-
-/**
-    \fn timeChanged
-    \brief Called whenever timeshift is on/off'ed or value changes
-*/
-void MainWindow::timeChanged(int)
-{
-	HandleAction (ACT_TimeShift) ;
-}
-/**
-    \fn searchMenu
-*/
-void MainWindow::searchMenu(QAction * action,MenuEntry *menu, int nb)
-{
-    for(int i=0;i<nb;i++)
-    {
-        MenuEntry *m=menu+i;
-        if(m->cookie==(void*)action)
-        {
-            HandleAction (m->event);
-        }
-    }
-}
-
-/**
-    \fn searchFileMenu
-*/
-#define MKMENU(name) void MainWindow::search##name##Menu(QAction * action) \
-    {searchMenu(action,myMenu##name,sizeof(myMenu##name)/sizeof(MenuEntry));}
-
-MKMENU(File)
-MKMENU(Edit)
-//MKMENU(Recent)
-MKMENU(View)
-MKMENU(Tool)
-MKMENU(Go)
-//MKMENU(Custom)
-MKMENU(Audio)
-MKMENU(Video)
-MKMENU(Help)
-
-
-
-/*
-      We receive a button press event
-*/
-void MainWindow::buttonPressed(void)
-{
-	// Receveid a key press Event, look into table..
-    QObject *obj=sender();
-    if(!obj) return;
-    QString me(obj->objectName());
-    
-	Action action=searchTranslationTable(qPrintable(me));
-    
-
-	if(action!=ACT_DUMMY)
-		HandleAction (action);
-
-}
-void MainWindow::toolButtonPressed(bool i)
-{
-	buttonPressed();
-}
-
-bool MainWindow::eventFilter(QObject* watched, QEvent* event)
-{
-	QKeyEvent *keyEvent;
-
-	switch (event->type())
-	{
-		case QEvent::KeyPress:
-			keyEvent = (QKeyEvent*)event;
-
-			if (watched == slider)
-			{
-				switch (keyEvent->key())
-				{
-					case Qt::Key_Left:
-						if (keyEvent->modifiers() == Qt::ShiftModifier)
-							HandleAction(ACT_Back25Frames);
-						else if (keyEvent->modifiers() == Qt::ControlModifier)
-							HandleAction(ACT_Back50Frames);
-						else
-							HandleAction(ACT_PreviousFrame);
-
-						return true;
-					case Qt::Key_Right:
-						if (keyEvent->modifiers() == Qt::ShiftModifier)
-							HandleAction(ACT_Forward25Frames);
-						else if (keyEvent->modifiers() == Qt::ControlModifier)
-							HandleAction(ACT_Forward50Frames);
-						else
-							HandleAction(ACT_NextFrame);
-
-						return true;
-					case Qt::Key_Up:
-						HandleAction(ACT_NextKFrame);
-						return true;
-					case Qt::Key_Down:
-						HandleAction(ACT_PreviousKFrame);
-						return true;
-					case Qt::Key_Shift:
-						shiftKeyHeld = 1;
-						break;
-				}
-			}
-			else if (keyEvent->key() == Qt::Key_Space)
-			{
-				HandleAction(ACT_PlayAvi);
-				return true;
-			}
-
-			break;
-        case QEvent::Resize:
-            if (watched == ui.sliderPlaceHolder)
-            {
-                    thumbSlider->resize(ui.sliderPlaceHolder->width(), 16);
-                    thumbSlider->move(0, (ui.sliderPlaceHolder->height() - thumbSlider->height()) / 2);
-            }
-            break;
-
-		case QEvent::KeyRelease:
-			keyEvent = (QKeyEvent*)event;
-
-			if (keyEvent->key() == Qt::Key_Shift)
-				shiftKeyHeld = 0;
-
-			break;
-		case QEvent::FocusOut:
-            break;
-        default:
-            break;
-	}
-
-	return QObject::eventFilter(watched, event);
-}
-/**
-    \fn buildRecentMenu
-*/
-bool MainWindow::buildRecentMenu(void)
-{
-    const char **names;
-	names=prefs->get_lastfiles();
-    // Purge entries...
-    recentFiles->clear();
-    for(int i=0;i<4;i++)
-    {
-        if(names[i])
-        {
-            recentFileAction[i]=recentFiles->addAction(QString('0'+i)+QString(":")+QString::fromUtf8(names[i]));
-        }else
-            recentFileAction[i]=NULL;
-    }
-	return true;
-}
-/**
-    \fn searchRecentFiles
-*/
-void MainWindow::searchRecentFiles(QAction * action)
-{
-    for(int i=0;i<4;i++)
-    {
-            QAction *a= recentFileAction[i];
-            if(!a) continue;
-
-            if(a==action) 
-            {
-                HandleAction((Action)(ACT_RECENT0+i));
-                return;
-            }
-    }
-}
-void MainWindow::mousePressEvent(QMouseEvent* event)
-{
-	this->setFocus(Qt::OtherFocusReason);
-}
-
-void MainWindow::dragEnterEvent(QDragEnterEvent *event)
-{
-	if (event->mimeData()->hasFormat("text/uri-list"))
-		event->acceptProposedAction();
-}
-
-void MainWindow::dropEvent(QDropEvent *event)
-{
-	QList<QUrl> urlList;
-	QString fileName;
-	QFileInfo info;
-
-	if (event->mimeData()->hasUrls())
-	{
-		urlList = event->mimeData()->urls();
-
-		for (int fileIndex = 0; fileIndex < urlList.size(); fileIndex++)
-		{
-			fileName = urlList[fileIndex].toLocalFile();
-			info.setFile(fileName);
-#warning FIXME
-#if 0
-			if (info.isFile())
-			{
-				if (avifileinfo)
-					FileSel_ReadWrite(reinterpret_cast <void (*)(const char *)> (A_appendAvi), 0, fileName.toUtf8().data(), actual_workbench_file);
-				else
-					FileSel_ReadWrite(reinterpret_cast <void (*)(const char *)> (A_openAvi), 0, fileName.toUtf8().data(), actual_workbench_file);
-			}
-#endif
-		}
-	}
-
-	event->acceptProposedAction();
-}
-
-void MainWindow::previousIntraFrame(void)
-{
-	if (ui.spinBox_TimeValue->hasFocus())
-		ui.spinBox_TimeValue->stepDown();
-	else
-		HandleAction(ACT_PreviousKFrame);
-}
-
-void MainWindow::nextIntraFrame(void)
-{
-	if (ui.spinBox_TimeValue->hasFocus())
-		ui.spinBox_TimeValue->stepUp();
-	else
-		HandleAction(ACT_NextKFrame);
-}
-
-MainWindow::~MainWindow()
-{
-	clearCustomMenu();
-    delete thumbSlider;
-    thumbSlider=NULL;
-}
-
-void MainWindow::closeEvent(QCloseEvent *event)
-{
-static bool first=true;
-    ADM_warning("Close event\n");
-    if(first)
-    {
-        first=false;
-        HandleAction(ACT_EXIT);
-    }
-    event->accept();
-//         event->ignore();
-
-}
-
-
-static const UI_FUNCTIONS_T UI_Hooks=
-    {
-        ADM_RENDER_API_VERSION_NUMBER,
-        UI_getWindowInfo,
-        UI_updateDrawWindowSize,
-        UI_rgbDraw,
-        UI_getDrawWidget,
-        UI_getPreferredRender
-        
-    };
-QApplication *myApplication=NULL;
-/**
-    \fn  UI_Init
-    \brief First part of UI initialization
-
-*/
-int UI_Init(int nargc,char **nargv)
-{
-    ADM_info("Starting QT4 GUI...\n");
-	initTranslator();
-
-	global_argc=nargc;
-	global_argv=nargv;
-	ADM_renderLibInit(&UI_Hooks);
-    Q_INIT_RESOURCE(avidemux);
-	Q_INIT_RESOURCE(filter);
-
-	myApplication=new QApplication (global_argc, global_argv);
-	myApplication->connect(myApplication, SIGNAL(lastWindowClosed()), myApplication, SLOT(quit()));
-
-	loadTranslator();
-
-	MainWindow *mw = new MainWindow();
-	mw->show();
-
-	QuiMainWindows = (QWidget*)mw;
-
-	uint32_t w, h;
-
-	UI_getPhysicalScreenSize(QuiMainWindows, &w,&h);
-	printf("The screen seems to be %u x %u px\n",w,h);
-
-	UI_QT4VideoWidget(mw->ui.frame_video);  // Add the widget that will handle video display
-	UI_updateRecentMenu();
-
-    // Init vumeter
-    UI_InitVUMeter(mw->ui.frameVU);
-	return 0;
-}
-/**
-
-*/
-bool UI_End(void)
-{
-    ADM_QPreviewCleanup();
-    return true;
-}
-void UI_refreshCustomMenu(void)
-{
-	((MainWindow*)QuiMainWindows)->buildCustomMenu();
-}
-
-/**
-    \fn UI_getCurrentPreview(void)
-    \brief Read previewmode from comboxbox 
-*/
-int UI_getCurrentPreview(void)
-{
-	int index;
-
-	if (WIDGET(actionPreviewOutput)->isChecked())
-		index = 1;
-	else if (WIDGET(actionPreviewSide)->isChecked())
-		index = 2;
-	else if (WIDGET(actionPreviewTop)->isChecked())
-		index = 3;
-	else if (WIDGET(actionPreviewSeparate)->isChecked())
-		index = 4;
-	else
-		index = 0;
-
-	return index;
-}
-
-/**
-    \fn UI_setCurrentPreview(int ne)
-    \brief Update comboxbox with previewmode
-*/
-void UI_setCurrentPreview(int ne)
-{
-	switch (ne)
-	{
-		case 1:
-			WIDGET(actionPreviewOutput)->setChecked(true);
-			break;
-		case 2:
-			WIDGET(actionPreviewSide)->setChecked(true);
-			break;
-		case 3:
-			WIDGET(actionPreviewTop)->setChecked(true);
-			break;
-		case 4:
-			WIDGET(actionPreviewSeparate)->setChecked(true);
-			break;
-		default:
-			WIDGET(actionPreviewInput)->setChecked(true);
-	}
-}
-/**
-        \fn FatalFunctionQt
-*/
-static void FatalFunctionQt(const char *title, const char *info)
-{
-	GUI_Info_HIG(ADM_LOG_IMPORTANT, title, info);
-}
-
-/**
-    \fn UI_RunApp(void)
-    \brief Main entry point for the GUI application
-*/
-int UI_RunApp(void)
-{
-	
-	setupMenus();
+/***************************************************************************
+    copyright            : (C) 2001 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include "config.h"
+#include "ADM_inttype.h"
+#include <QtCore/QFileInfo>
+#include <QtCore/QUrl>
+#include <QtGui/QKeyEvent>
+#include <QtGui/QGraphicsView>
+
+#define MENU_DECLARE
+#include "Q_gui2.h"
+#include "ADM_default.h"
+
+#include "DIA_fileSel.h"
+#include "ADM_vidMisc.h"
+#include "prefs.h"
+#include "avi_vars.h"
+
+#include "ADM_render/GUI_renderInternal.h"
+#include "ADM_coreVideoEncoderInternal.h"
+#include "ADM_muxerProto.h"
+#include "T_vumeter.h"
+#include "DIA_coreToolkit.h"
+
+extern int global_argc;
+extern char **global_argv;
+
+extern uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w,uint32_t *h);
+extern int automation(void );
+extern void HandleAction(Action a);
+extern int encoderGetEncoderCount (void);
+extern const char *encoderGetIndexedName (uint32_t i);
+uint32_t audioEncoderGetNumberOfEncoders(void);
+const char  *audioEncoderGetDisplayName(uint32_t i);
+extern void checkCrashFile(void);
+extern void UI_QT4VideoWidget(QFrame *frame);
+extern void loadTranslator(void);
+extern void initTranslator(void);
+extern void destroyTranslator(void);
+extern ADM_RENDER_TYPE UI_getPreferredRender(void);
+extern int A_openAvi(const char *name);
+extern int A_appendAvi(const char *name);
+extern void FileSel_ReadWrite(SELFILE_CB *cb, int rw, const char *name, const char *actual_workbench_file);
+
+
+int SliderIsShifted=0;
+static void setupMenus(void);
+static int shiftKeyHeld=0;
+static ADM_QSlider *slider=NULL;
+static int _upd_in_progres=0;
+static int currentFps = 0;
+static int frameCount = 0;
+static int currentFrame = 0;
+bool     ADM_ve6_getEncoderInfo(int filter, const char **name, uint32_t *major,uint32_t *minor,uint32_t *patch);
+uint32_t ADM_ve6_getNbEncoders(void);
+void UI_refreshCustomMenu(void);
+QWidget *QuiMainWindows=NULL;
+QGraphicsView *drawWindow=NULL;
+uint8_t UI_updateRecentMenu( void );
+extern void saveCrashProject(void);
+extern uint8_t AVDM_setVolume(int volume);
+extern bool ADM_QPreviewCleanup(void);
+#define WIDGET(x)  (((MainWindow *)QuiMainWindows)->ui.x)
+
+#define CONNECT(object,zzz) connect( (ui.object),SIGNAL(triggered()),this,SLOT(buttonPressed()));
+#define CONNECT_TB(object,zzz) connect( (ui.object),SIGNAL(clicked(bool)),this,SLOT(toolButtonPressed(bool)));
+#define DECLARE_VAR(object,signal_name) {#object,signal_name},
+
+#include "translation_table.h"   
+
+/*
+    Declare the table converting widget name to our internal signal           
+*/
+typedef struct 
+{
+	const char *name;
+	Action     action; 
+}adm_qt4_translation;
+
+const adm_qt4_translation myTranslationTable[]=
+{
+#define PROCESS DECLARE_VAR
+	LIST_OF_BUTTONS
+#undef PROCESS
+};
+static Action searchTranslationTable(const char *name);
+#define SIZEOF_MY_TRANSLATION sizeof(myTranslationTable)/sizeof(adm_qt4_translation)
+
+int UI_readCurTime(uint16_t &hh, uint16_t &mm, uint16_t &ss, uint16_t &ms);
+void UI_updateFrameCount(uint32_t curFrame);
+void UI_updateTimeCount(uint32_t curFrame,uint32_t fps);
+extern void UI_purge(void);
+/*
+    Declare the class that will be our main window
+
+*/
+
+void MainWindow::comboChanged(int z)
+{
+	const char *source=qPrintable(sender()->objectName());
+
+	if(!strcmp(source,"comboBoxVideo"))  
+	{
+		bool b=FALSE;
+		if(ui.comboBoxVideo->currentIndex())
+		{
+			b=TRUE;
+		}
+		ui.pushButtonVideoConf->setEnabled(b);
+		ui.pushButtonVideoFilter->setEnabled(b);
+		HandleAction (ACT_VIDEO_CODEC_CHANGED) ;
+	}
+	else if(!strcmp(source,"comboBoxAudio"))  
+	{
+		bool b=FALSE;
+		if(ui.comboBoxAudio->currentIndex())
+		{
+			b=TRUE;
+		}
+		ui.pushButtonAudioConf->setEnabled(b);
+		ui.pushButtonAudioFilter->setEnabled(b);
+		HandleAction (ACT_AUDIO_CODEC_CHANGED) ;
+	}
+	else
+		printf("From +: %s\n",source);
+}
+
+void MainWindow::sliderValueChanged(int u) 
+{
+	if(!_upd_in_progres)
+		HandleAction(ACT_Scale);
+}
+
+void MainWindow::sliderMoved(int value)
+{
+	SliderIsShifted = shiftKeyHeld;
+}
+
+void MainWindow::sliderReleased(void)
+{
+	SliderIsShifted = 0;
+}
+
+void MainWindow::thumbSlider_valueEmitted(int value)
+{
+        if (value > 0)
+                nextIntraFrame();
+        else
+                previousIntraFrame();
+}
+
+void MainWindow::volumeChange( int u )
+{
+	if (_upd_in_progres || !ui.toolButtonAudioToggle->isChecked())
+		return;
+
+	_upd_in_progres++;
+
+	int vol = ui.horizontalSlider_2->value();
+
+	AVDM_setVolume(vol);
+	_upd_in_progres--;
+}
+
+void MainWindow::audioToggled(bool checked)
+{
+	if (checked)
+		AVDM_setVolume(ui.horizontalSlider_2->value());
+	else
+		AVDM_setVolume(0);
+}
+
+void MainWindow::previewModeChanged(QAction *action)
+{
+	HandleAction(ACT_PreviewChanged);
+}
+
+void MainWindow::timeChangeFinished(void)
+{
+	this->setFocus(Qt::OtherFocusReason);
+}
+
+void MainWindow::currentFrameChanged(void)
+{
+//	HandleAction(ACT_JumpToFrame);
+
+	this->setFocus(Qt::OtherFocusReason);
+}
+
+void MainWindow::currentTimeChanged(void)
+{
+	HandleAction(ACT_GotoTime);
+
+	this->setFocus(Qt::OtherFocusReason);
+}
+
+/**
+    \fn ctor
+*/
+MainWindow::MainWindow() : QMainWindow()
+{
+	ui.setupUi(this);
+
+#if defined(__APPLE__) && defined(USE_SDL)
+	ui.actionAbout_avidemux->setMenuRole(QAction::NoRole);
+	ui.actionPreferences->setMenuRole(QAction::NoRole);
+	ui.actionQuit->setMenuRole(QAction::NoRole);
+#endif
+
+	// Preview modes
+	QActionGroup *groupPreviewModes = new QActionGroup(this);
+
+	groupPreviewModes->addAction(ui.actionPreviewInput);
+	groupPreviewModes->addAction(ui.actionPreviewOutput);
+	connect(groupPreviewModes, SIGNAL(triggered(QAction*)), this, SLOT(previewModeChanged(QAction*)));
+
+	/*
+	Connect our button to buttonPressed
+	*/
+#define PROCESS CONNECT_TB
+	LIST_OF_BUTTONS
+#undef PROCESS
+
+	//ACT_VideoCodecChanged
+	connect( ui.comboBoxVideo,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
+	connect( ui.comboBoxAudio,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
+
+	// Slider
+	slider=ui.horizontalSlider;
+	slider->setMinimum(0);
+	slider->setMaximum(1000000000);
+	connect( slider,SIGNAL(valueChanged(int)),this,SLOT(sliderValueChanged(int)));
+	connect( slider,SIGNAL(sliderMoved(int)),this,SLOT(sliderMoved(int)));
+	connect( slider,SIGNAL(sliderReleased()),this,SLOT(sliderReleased()));
+
+   // Thumb slider
+    ui.sliderPlaceHolder->installEventFilter(this);
+    thumbSlider = new ThumbSlider(ui.sliderPlaceHolder);
+    connect(thumbSlider, SIGNAL(valueEmitted(int)), this, SLOT(thumbSlider_valueEmitted(int)));
+
+	// Volume slider
+	QSlider *volSlider=ui.horizontalSlider_2;
+	volSlider->setMinimum(0);
+	volSlider->setMaximum(100);
+	connect(volSlider,SIGNAL(valueChanged(int)),this,SLOT(volumeChange(int)));
+	connect(ui.toolButtonAudioToggle,SIGNAL(clicked(bool)),this,SLOT(audioToggled(bool)));
+
+	// default state
+	bool b=0;
+	ui.pushButtonVideoConf->setEnabled(b);
+	ui.pushButtonVideoFilter->setEnabled(b);
+	ui.pushButtonAudioConf->setEnabled(b);
+	ui.pushButtonAudioFilter->setEnabled(b);
+
+	/* Time Shift */
+	connect(ui.checkBox_TimeShift,SIGNAL(stateChanged(int)),this,SLOT(timeChanged(int)));
+	connect(ui.spinBox_TimeValue,SIGNAL(valueChanged(int)),this,SLOT(timeChanged(int)));
+	connect(ui.spinBox_TimeValue, SIGNAL(editingFinished()), this, SLOT(timeChangeFinished()));
+
+	QRegExp timeRegExp("^[0-9]{2}:[0-5][0-9]:[0-5][0-9]\\.[0-9]{3}$");
+	QRegExpValidator *timeValidator = new QRegExpValidator(timeRegExp, this);
+	ui.currentTime->setValidator(timeValidator);
+	ui.currentTime->setInputMask("99:99:99.999");
+
+	//connect(ui.currentTime, SIGNAL(editingFinished()), this, SLOT(currentTimeChanged()));
+
+    // Build file,... menu
+    buildMyMenu();
+
+	/* Build the custom menu */
+    jsMenu=new QMenu("javaScript");
+    pyMenu=new QMenu("tinyPython");
+    ui.menuCustom->addMenu(jsMenu);
+    ui.menuCustom->addMenu(pyMenu);
+	buildCustomMenu();
+
+    recentFiles=new QMenu("Recent Files");
+    recentProjects=new QMenu("Recent Projects");
+    ui.menuRecent->addMenu(recentFiles);
+    ui.menuRecent->addMenu(recentProjects);
+    connect( ui.menuRecent,SIGNAL(triggered(QAction*)),this,SLOT(searchRecentFiles(QAction*)));
+
+	this->installEventFilter(this);
+	slider->installEventFilter(this);
+    
+	//ui.currentTime->installEventFilter(this);
+
+	this->setFocus(Qt::OtherFocusReason);
+
+	setAcceptDrops(true);
+    setWindowIcon(QIcon(":/new/prefix1/pics/avidemux_icon_small.png"));
+
+    // Hook also the toolbar
+    connect(ui.toolBar,  SIGNAL(actionTriggered ( QAction *)),this,SLOT(searchToolBar(QAction *)));
+    connect(ui.toolBar_2,SIGNAL(actionTriggered ( QAction *)),this,SLOT(searchToolBar(QAction *)));
+
+	QWidget* dummy0 = new QWidget();
+	QWidget* dummy1 = new QWidget();
+	QWidget* dummy2 = new QWidget();
+	QWidget* dummy3 = new QWidget();
+	QWidget* dummy4 = new QWidget();
+
+	ui.codecWidget->setTitleBarWidget(dummy0);
+	ui.navigationWidget->setTitleBarWidget(dummy1);
+	ui.selectionWidget->setTitleBarWidget(dummy2);
+	ui.volumeWidget->setTitleBarWidget(dummy3);
+	ui.audioMetreWidget->setTitleBarWidget(dummy4);
+
+	this->resize(1, 1);
+}
+/**
+    \fn searchToolBar
+*/
+typedef struct 
+{
+    const char *name;
+    Action event;
+}toolBarTranslate;
+
+toolBarTranslate toolbar[]=
+{
+{"actionOpen",              ACT_OPEN_VIDEO},
+{"actionSave_video",        ACT_SAVE_VIDEO},
+{"actionProperties",        ACT_VIDEO_PROPERTIES},
+{"actionLoad_run_project",  ACT_RUN_PY_PROJECT},
+{"actionSave_project",      ACT_SAVE_PY_PROJECT},
+//{"actionPreviewInput",ACT_PreviewToggle},
+//{"actionPreviewOutput",ACT_PreviewToggle},
+
+{NULL,ACT_DUMMY}
+};
+void MainWindow::searchToolBar(QAction *action)
+{
+        toolBarTranslate *t=toolbar;
+        QString me(action->objectName());
+        const char *name=me.toUtf8().constData();
+        while(t->name)
+        {
+            if(!strcmp(name,t->name))
+            {
+                HandleAction(t->event);
+                return;
+            }
+            t++;
+        }
+        ADM_warning("Toolbar:Cannot handle %s\n",name);
+}
+/**
+    \fn buildFileMenu
+*/
+bool MainWindow::buildMenu(QMenu *root,MenuEntry *menu, int nb)
+{
+    QMenu *subMenu=NULL;
+    for(int i=0;i<nb;i++)
+    {
+        MenuEntry *m=menu+i;
+        switch(m->type)
+        {
+            case MENU_SEPARATOR:
+                root->addSeparator();
+                break;
+            case MENU_SUBMENU:
+                {
+                    subMenu=root->addMenu(m->text);
+                }
+                break;
+            case MENU_SUBACTION:
+            case MENU_ACTION:
+                {   
+                        QMenu *insert=root;
+                        if(m->type==MENU_SUBACTION) insert=subMenu;
+                        QAction *a=NULL;
+                        if(m->icon) 
+                        {
+                            QIcon icon(m->icon);
+                            a=insert->addAction(icon,m->text);
+                        }else
+                            a=insert->addAction(m->text);
+                        m->cookie=(void *)a;
+                        if(m->shortCut)
+                        {
+                            QKeySequence s(m->shortCut);
+                            a->setShortcut(s);
+                        }
+                        break;
+                }
+            default:
+                break;
+        }
+    }
+    return true;
+}
+/**
+    buildFileMenu
+*/
+bool MainWindow::buildMyMenu(void)
+{
+    connect( ui.menuFile,SIGNAL(triggered(QAction*)),this,SLOT(searchFileMenu(QAction*)));
+    buildMenu(ui.menuFile,myMenuFile, sizeof(myMenuFile)/sizeof(MenuEntry));
+
+    connect( ui.menuEdit,SIGNAL(triggered(QAction*)),this,SLOT(searchEditMenu(QAction*)));
+    buildMenu(ui.menuEdit,myMenuEdit, sizeof(myMenuEdit)/sizeof(MenuEntry));
+
+    connect( ui.menuVideo,SIGNAL(triggered(QAction*)),this,SLOT(searchVideoMenu(QAction*)));
+    buildMenu(ui.menuVideo,myMenuVideo, sizeof(myMenuVideo)/sizeof(MenuEntry));
+
+    connect( ui.menuAudio,SIGNAL(triggered(QAction*)),this,SLOT(searchAudioMenu(QAction*)));
+    buildMenu(ui.menuAudio,myMenuAudio, sizeof(myMenuAudio)/sizeof(MenuEntry));
+
+    connect( ui.menuHelp,SIGNAL(triggered(QAction*)),this,SLOT(searchHelpMenu(QAction*)));
+    buildMenu(ui.menuHelp,myMenuHelp, sizeof(myMenuHelp)/sizeof(MenuEntry));
+
+    connect( ui.menuTools,SIGNAL(triggered(QAction*)),this,SLOT(searchToolMenu(QAction*)));
+    buildMenu(ui.menuTools,myMenuTool, sizeof(myMenuTool)/sizeof(MenuEntry));
+
+    connect( ui.menuGo,SIGNAL(triggered(QAction*)),this,SLOT(searchGoMenu(QAction*)));
+    buildMenu(ui.menuGo,myMenuGo, sizeof(myMenuGo)/sizeof(MenuEntry));
+
+    connect( ui.menuView,SIGNAL(triggered(QAction*)),this,SLOT(searchViewMenu(QAction*)));
+    buildMenu(ui.menuView,myMenuView, sizeof(myMenuView)/sizeof(MenuEntry));
+
+    return true;
+}
+
+/**
+    \fn timeChanged
+    \brief Called whenever timeshift is on/off'ed or value changes
+*/
+void MainWindow::timeChanged(int)
+{
+	HandleAction (ACT_TimeShift) ;
+}
+/**
+    \fn searchMenu
+*/
+void MainWindow::searchMenu(QAction * action,MenuEntry *menu, int nb)
+{
+    for(int i=0;i<nb;i++)
+    {
+        MenuEntry *m=menu+i;
+        if(m->cookie==(void*)action)
+        {
+            HandleAction (m->event);
+        }
+    }
+}
+
+/**
+    \fn searchFileMenu
+*/
+#define MKMENU(name) void MainWindow::search##name##Menu(QAction * action) \
+    {searchMenu(action,myMenu##name,sizeof(myMenu##name)/sizeof(MenuEntry));}
+
+MKMENU(File)
+MKMENU(Edit)
+//MKMENU(Recent)
+MKMENU(View)
+MKMENU(Tool)
+MKMENU(Go)
+//MKMENU(Custom)
+MKMENU(Audio)
+MKMENU(Video)
+MKMENU(Help)
+
+
+
+/*
+      We receive a button press event
+*/
+void MainWindow::buttonPressed(void)
+{
+	// Receveid a key press Event, look into table..
+    QObject *obj=sender();
+    if(!obj) return;
+    QString me(obj->objectName());
+    
+	Action action=searchTranslationTable(qPrintable(me));
+    
+
+	if(action!=ACT_DUMMY)
+		HandleAction (action);
+
+}
+void MainWindow::toolButtonPressed(bool i)
+{
+	buttonPressed();
+}
+
+bool MainWindow::eventFilter(QObject* watched, QEvent* event)
+{
+	QKeyEvent *keyEvent;
+
+	switch (event->type())
+	{
+		case QEvent::KeyPress:
+			keyEvent = (QKeyEvent*)event;
+
+			if (watched == slider)
+			{
+				switch (keyEvent->key())
+				{
+					case Qt::Key_Left:
+						if (keyEvent->modifiers() == Qt::ShiftModifier)
+							HandleAction(ACT_Back25Frames);
+						else if (keyEvent->modifiers() == Qt::ControlModifier)
+							HandleAction(ACT_Back50Frames);
+						else
+							HandleAction(ACT_PreviousFrame);
+
+						return true;
+					case Qt::Key_Right:
+						if (keyEvent->modifiers() == Qt::ShiftModifier)
+							HandleAction(ACT_Forward25Frames);
+						else if (keyEvent->modifiers() == Qt::ControlModifier)
+							HandleAction(ACT_Forward50Frames);
+						else
+							HandleAction(ACT_NextFrame);
+
+						return true;
+					case Qt::Key_Up:
+						HandleAction(ACT_NextKFrame);
+						return true;
+					case Qt::Key_Down:
+						HandleAction(ACT_PreviousKFrame);
+						return true;
+					case Qt::Key_Shift:
+						shiftKeyHeld = 1;
+						break;
+				}
+			}
+			else if (keyEvent->key() == Qt::Key_Space)
+			{
+				HandleAction(ACT_PlayAvi);
+				return true;
+			}
+
+			break;
+        case QEvent::Resize:
+            if (watched == ui.sliderPlaceHolder)
+            {
+                    thumbSlider->resize(ui.sliderPlaceHolder->width(), 16);
+                    thumbSlider->move(0, (ui.sliderPlaceHolder->height() - thumbSlider->height()) / 2);
+            }
+            break;
+
+		case QEvent::KeyRelease:
+			keyEvent = (QKeyEvent*)event;
+
+			if (keyEvent->key() == Qt::Key_Shift)
+				shiftKeyHeld = 0;
+
+			break;
+		case QEvent::FocusOut:
+            break;
+        default:
+            break;
+	}
+
+	return QObject::eventFilter(watched, event);
+}
+/**
+    \fn buildRecentMenu
+*/
+bool MainWindow::buildRecentMenu(void)
+{
+    const char **names;
+	names=prefs->get_lastfiles();
+    // Purge entries...
+    recentFiles->clear();
+    for(int i=0;i<4;i++)
+    {
+        if(names[i])
+        {
+            recentFileAction[i]=recentFiles->addAction(QString('0'+i)+QString(":")+QString::fromUtf8(names[i]));
+        }else
+            recentFileAction[i]=NULL;
+    }
+	return true;
+}
+/**
+    \fn searchRecentFiles
+*/
+void MainWindow::searchRecentFiles(QAction * action)
+{
+    for(int i=0;i<4;i++)
+    {
+            QAction *a= recentFileAction[i];
+            if(!a) continue;
+
+            if(a==action) 
+            {
+                HandleAction((Action)(ACT_RECENT0+i));
+                return;
+            }
+    }
+}
+void MainWindow::mousePressEvent(QMouseEvent* event)
+{
+	this->setFocus(Qt::OtherFocusReason);
+}
+
+void MainWindow::dragEnterEvent(QDragEnterEvent *event)
+{
+	if (event->mimeData()->hasFormat("text/uri-list"))
+		event->acceptProposedAction();
+}
+
+void MainWindow::dropEvent(QDropEvent *event)
+{
+	QList<QUrl> urlList;
+	QString fileName;
+	QFileInfo info;
+
+	if (event->mimeData()->hasUrls())
+	{
+		urlList = event->mimeData()->urls();
+
+		for (int fileIndex = 0; fileIndex < urlList.size(); fileIndex++)
+		{
+			fileName = urlList[fileIndex].toLocalFile();
+			info.setFile(fileName);
+#warning FIXME
+#if 0
+			if (info.isFile())
+			{
+				if (avifileinfo)
+					FileSel_ReadWrite(reinterpret_cast <void (*)(const char *)> (A_appendAvi), 0, fileName.toUtf8().data(), actual_workbench_file);
+				else
+					FileSel_ReadWrite(reinterpret_cast <void (*)(const char *)> (A_openAvi), 0, fileName.toUtf8().data(), actual_workbench_file);
+			}
+#endif
+		}
+	}
+
+	event->acceptProposedAction();
+}
+
+void MainWindow::previousIntraFrame(void)
+{
+	if (ui.spinBox_TimeValue->hasFocus())
+		ui.spinBox_TimeValue->stepDown();
+	else
+		HandleAction(ACT_PreviousKFrame);
+}
+
+void MainWindow::nextIntraFrame(void)
+{
+	if (ui.spinBox_TimeValue->hasFocus())
+		ui.spinBox_TimeValue->stepUp();
+	else
+		HandleAction(ACT_NextKFrame);
+}
+
+MainWindow::~MainWindow()
+{
+	clearCustomMenu();
+    delete thumbSlider;
+    thumbSlider=NULL;
+}
+
+void MainWindow::closeEvent(QCloseEvent *event)
+{
+static bool first=true;
+    ADM_warning("Close event\n");
+    if(first)
+    {
+        first=false;
+        HandleAction(ACT_EXIT);
+    }
+    event->accept();
+//         event->ignore();
+
+}
+
+
+static const UI_FUNCTIONS_T UI_Hooks=
+    {
+        ADM_RENDER_API_VERSION_NUMBER,
+        UI_getWindowInfo,
+        UI_updateDrawWindowSize,
+        UI_rgbDraw,
+        UI_getDrawWidget,
+        UI_getPreferredRender
+        
+    };
+QApplication *myApplication=NULL;
+/**
+    \fn  UI_Init
+    \brief First part of UI initialization
+
+*/
+int UI_Init(int nargc,char **nargv)
+{
+    ADM_info("Starting QT4 GUI...\n");
+	initTranslator();
+
+	global_argc=nargc;
+	global_argv=nargv;
+	ADM_renderLibInit(&UI_Hooks);
+    Q_INIT_RESOURCE(avidemux);
+	Q_INIT_RESOURCE(filter);
+
+	myApplication=new QApplication (global_argc, global_argv);
+	myApplication->connect(myApplication, SIGNAL(lastWindowClosed()), myApplication, SLOT(quit()));
+
+	loadTranslator();
+
+	MainWindow *mw = new MainWindow();
+	mw->show();
+
+	QuiMainWindows = (QWidget*)mw;
+
+	uint32_t w, h;
+
+	UI_getPhysicalScreenSize(QuiMainWindows, &w,&h);
+	printf("The screen seems to be %u x %u px\n",w,h);
+
+	UI_QT4VideoWidget(mw->ui.frame_video);  // Add the widget that will handle video display
+	UI_updateRecentMenu();
+
+    // Init vumeter
+    UI_InitVUMeter(mw->ui.frameVU);
+	return 0;
+}
+/**
+
+*/
+bool UI_End(void)
+{
+    ADM_QPreviewCleanup();
+    return true;
+}
+void UI_refreshCustomMenu(void)
+{
+	((MainWindow*)QuiMainWindows)->buildCustomMenu();
+}
+
+/**
+    \fn UI_getCurrentPreview(void)
+    \brief Read previewmode from comboxbox 
+*/
+int UI_getCurrentPreview(void)
+{
+	int index;
+
+	if (WIDGET(actionPreviewOutput)->isChecked())
+		index = 1;
+	else if (WIDGET(actionPreviewSide)->isChecked())
+		index = 2;
+	else if (WIDGET(actionPreviewTop)->isChecked())
+		index = 3;
+	else if (WIDGET(actionPreviewSeparate)->isChecked())
+		index = 4;
+	else
+		index = 0;
+
+	return index;
+}
+
+/**
+    \fn UI_setCurrentPreview(int ne)
+    \brief Update comboxbox with previewmode
+*/
+void UI_setCurrentPreview(int ne)
+{
+	switch (ne)
+	{
+		case 1:
+			WIDGET(actionPreviewOutput)->setChecked(true);
+			break;
+		case 2:
+			WIDGET(actionPreviewSide)->setChecked(true);
+			break;
+		case 3:
+			WIDGET(actionPreviewTop)->setChecked(true);
+			break;
+		case 4:
+			WIDGET(actionPreviewSeparate)->setChecked(true);
+			break;
+		default:
+			WIDGET(actionPreviewInput)->setChecked(true);
+	}
+}
+/**
+        \fn FatalFunctionQt
+*/
+static void FatalFunctionQt(const char *title, const char *info)
+{
+	GUI_Info_HIG(ADM_LOG_IMPORTANT, title, info);
+}
+
+/**
+    \fn UI_RunApp(void)
+    \brief Main entry point for the GUI application
+*/
+int UI_RunApp(void)
+{
+	
+	setupMenus();
     ADM_setCrashHook(&saveCrashProject, &FatalFunctionQt);
-	checkCrashFile();
-
-	if (global_argc >= 2)
-		automation();
-
-	myApplication->exec();
-
-	destroyTranslator();
-    delete myApplication;
-    myApplication=NULL;
-    return 1;
-}
-/**
-    \fn searchTranslationTable(const char *name))
-    \brief return the action corresponding to a give button. The translation table is in translation_table.h
-*/
-Action searchTranslationTable(const char *name)
-{
-	for(int i=0;i< SIZEOF_MY_TRANSLATION;i++)
-	{
-		if(!strcmp(name, myTranslationTable[i].name))
-		{
-			return  myTranslationTable[i].action;
-		}
-	}
-	printf("WARNING: Signal not found in translation table %s\n",name);
-	return ACT_DUMMY;
-}
-/**
-    \fn     UI_updateRecentMenu( void )
-    \brief  Update the recent submenu with the latest files loaded
-*/
-uint8_t UI_updateRecentMenu( void )
-{
-    return  ((MainWindow *)QuiMainWindows)->buildRecentMenu();
-}
-/** 
-  \fn    setupMenus(void)
-  \brief Fill in video & audio co
-*/
-void setupMenus(void)
-{
-	uint32_t nbVid;
-    uint32_t maj,mn,pa;
-	const char *name;
-
-	nbVid=ADM_ve6_getNbEncoders();
-	printf("Found %d video encoder(s)\n",nbVid);
-	for(uint32_t i=1;i<nbVid;i++)
-	{
-		ADM_ve6_getEncoderInfo(i,&name,&maj,&mn,&pa);
-		WIDGET(comboBoxVideo)->addItem(name);
-	}
-
-	// And A codec
-
-	uint32_t nbAud;
-
-    nbAud=audioEncoderGetNumberOfEncoders();
-	printf("Found %d audio encoder(s)\n",nbAud);		       
-	for(uint32_t i=1;i<nbAud;i++)
-	{
-		name=audioEncoderGetDisplayName(i);
-		WIDGET(comboBoxAudio)->addItem(name);
-	}
-
-	/*   Fill in output format window */
-	uint32_t nbFormat=ADM_mx_getNbMuxers();
-
-	printf("Found %d format(s)\n",nbFormat);
-	for(uint32_t i=0;i<nbFormat;i++)
-	{
-        const char *name=ADM_mx_getName(i);
-		WIDGET(comboBoxFormat)->addItem(name);	
-	}
-
-}
-/*
-    Return % of scale (between 0 and 1)
-*/
-double 	UI_readScale( void )
-{
-	double v;
-	if(!slider) v=0;
-	v= (double)(slider->value());
-	v/=10000000;
-	return v;
-}
-void UI_setScale( double val )
-{
-	if(_upd_in_progres) return;
-	_upd_in_progres++;
-	slider->setValue( (int)(val * 10000000));
-	_upd_in_progres--;
-}
-
-int UI_readCurFrame(void)
-{
-	return 0;
-}
-
-int UI_readCurTime(uint16_t &hh, uint16_t &mm, uint16_t &ss, uint16_t &ms)
-{
-	int success = 0;
-
-	QString timeText = WIDGET(currentTime)->text();
-	int pos;
-
-	if (WIDGET(currentTime)->validator()->validate(timeText, pos) == QValidator::Acceptable)
-	{
-		uint32_t frame;
-
-		hh = (uint16_t)timeText.left(2).toUInt();
-		mm = (uint16_t)timeText.mid(3, 2).toUInt();
-		ss = (uint16_t)timeText.mid(6, 2).toUInt();
-		ms = (uint16_t)timeText.right(3).toUInt();
-
-		time2frame(&frame, currentFps, hh, mm, ss, ms);
-
-		if (frame <= frameCount)
-			success = 1;
-	}
-
-	return success;
-}
-
-
-
-//*******************************************
-
-/**
-    \fn UI_setTitle(char *name)
-    \brief Set the main window title, usually name if the file being edited
-*/
-void UI_setTitle(const char *name)
-{
-	char *title;
-	const char* defaultTitle = "Avidemux";
-
-	if (name && (*name) )
-	{
-		title = new char[strlen(defaultTitle) + strlen(name) + 3 + 1];
-
-		strcpy(title, name);
-		strcat(title, " - ");
-		strcat(title, defaultTitle);
-	}
-	else
-	{
-		title = new char[strlen(defaultTitle) + 1];
-
-		strcpy(title, defaultTitle);
-	}
-
-	QuiMainWindows->setWindowTitle(QString::fromUtf8(title));
-	delete [] title;
-}
-
-/**
-    \fn     UI_setFrameType( uint32_t frametype,uint32_t qp)
-    \brief  Display frametype (I/P/B) and associated quantizer
-*/
-
-void UI_setFrameType( uint32_t frametype,uint32_t qp)
-{
-	char string[100];
-	char	c='?';
-    const char *f="???";
-	switch(frametype&AVI_FRAME_TYPE_MASK)
-	{
-	case AVI_KEY_FRAME: c='I';break;
-	case AVI_B_FRAME: c='B';break;
-	case 0: c='P';break;
-	default:c='?';break;
-
-	}
-    switch(frametype&AVI_STRUCTURE_TYPE_MASK)
-	{
-	case AVI_TOP_FIELD+AVI_FIELD_STRUCTURE: f="TFF";break;
-    case AVI_BOTTOM_FIELD+AVI_FIELD_STRUCTURE: f="BFF";break;
-    case AVI_FRAME_STRUCTURE: f="FRM";break;
-	default:f="???";
-
-                    break;
-	}
-	sprintf(string,QT_TR_NOOP("%c-%s (%02d)"),c,f,qp);
-	WIDGET(label_8)->setText(string);	
-
-}
-
-/**
-    \fn     UI_updateFrameCount(uint32_t curFrame)
-    \brief  Display the current displayed frame #
-*/
-void UI_updateFrameCount(uint32_t curFrame)
-{
-	
-}
-
-/**
-    \fn      UI_setFrameCount(uint32_t curFrame,uint32_t total)
-    \brief  Display the current displayed frame # and total frame #
-*/
-void UI_setFrameCount(uint32_t curFrame,uint32_t total)
-{
-	
-}
-
-/**
-    \fn     UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
-    \brief  Display the time corresponding to current frame according to fps (fps1000)
-*/
-void UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
-{
-	char text[80];   
-	uint32_t mm,hh,ss,ms;
-
-	frame2time(curFrame,fps, &hh, &mm, &ss, &ms);
-	sprintf(text, "%02d:%02d:%02d.%03d", hh, mm, ss, ms);
-	WIDGET(currentTime)->setText(text);
-}
-
-
-
-/**
-    \fn UI_setCurrentTime
-    \brief Set current PTS of displayed video
-*/
-void UI_setCurrentTime(uint64_t curTime)
-{
-  char text[80];
- uint32_t mm,hh,ss,ms;
- uint32_t shorty=(uint32_t)(curTime/1000);
-
-    ms2time(shorty,&hh,&mm,&ss,&ms);
-  	sprintf(text, "%02d:%02d:%02d.%03d", hh, mm, ss, ms);
-	WIDGET(currentTime)->setText(text);
-
-}
-
-/**
-    \fn UI_setTotalTime
-    \brief SEt the total duration of video
-*/
-void UI_setTotalTime(uint64_t curTime)
-{
-  char text[80];
- uint32_t mm,hh,ss,ms;
- uint32_t shorty=(uint32_t)(curTime/1000);
-
-    ms2time(shorty,&hh,&mm,&ss,&ms);
-  	sprintf(text, "/%02d:%02d:%02d.%03d", hh, mm, ss, ms);
-    WIDGET(totalTime)->setText(text);
-    slider->setTotalDuration(curTime);
-}
-/**
-    \fn     UI_setMarkers(uint64_t Ptsa, uint32_t Ptsb )
-    \brief  Display frame # for marker A & B
-*/
-void UI_setMarkers(uint64_t a, uint64_t b)
-{
-	char text[80];
-    uint64_t absoluteA=a,absoluteB=b;
-    uint32_t hh,mm,ss,ms;
-    uint32_t timems;
-    a/=1000;
-    b/=1000;
-
-    timems=(uint32_t)(a);
-    ms2time(timems,&hh,&mm,&ss,&ms);
-	snprintf(text,79,"%02"LU":%02"LU":%02"LU".%02"LU,hh,mm,ss,ms);
-	WIDGET(pushButtonJumpToMarkerA)->setText(text);
-
-	timems=(uint32_t)(b);
-    ms2time(timems,&hh,&mm,&ss,&ms);
-	snprintf(text,79,"%02"LU":%02"LU":%02"LU".%02"LU,hh,mm,ss,ms);
-	WIDGET(pushButtonJumpToMarkerB)->setText(text);
-
-	slider->setMarkers(absoluteA, absoluteB);
-}
-
-/**
-    \fn     UI_getCurrentVCodec(void)
-    \brief  Returns the current selected video code in menu, i.e its number (0 being the first)
-*/
-int 	UI_getCurrentVCodec(void)
-{
-	int i=WIDGET(comboBoxVideo)->currentIndex();
-	if(i<0) i=0;
-	return i; 
-}
-/**
-    \fn     UI_setVideoCodec( int i)
-    \brief  Select the video codec which is # x in pulldown menu (starts at zero :copy)
-*/
-
-void UI_setVideoCodec( int i)
-{
-	int b=!!i;
-	WIDGET(comboBoxVideo)->setCurrentIndex(i);
-
-	WIDGET(pushButtonVideoConf)->setEnabled(b);
-	WIDGET(pushButtonVideoFilter)->setEnabled(b);
-}
-/**
-    \fn     UI_getCurrentACodec(void)
-    \brief  Returns the current selected audio code in menu, i.e its number (0 being the first)
-*/
-
-int 	UI_getCurrentACodec(void)
-{
-	int i=WIDGET(comboBoxAudio)->currentIndex();
-	if(i<0) i=0;
-	return i; 
-}
-/**
-    \fn     UI_setAudioCodec( int i)
-    \brief  Select the audio codec which is # x in pulldown menu (starts at zero :copy)
-*/
-
-void UI_setAudioCodec( int i)
-{ int b=!!i;
-WIDGET(comboBoxAudio)->setCurrentIndex(i);
-WIDGET(pushButtonAudioConf)->setEnabled(b);
-WIDGET(pushButtonAudioFilter)->setEnabled(b);
-}
-/**
-    \fn     UI_GetCurrentFormat(void)
-    \brief  Returns the current selected output format
-*/
-
-int 	UI_GetCurrentFormat( void )
-{
-	int i=WIDGET(comboBoxFormat)->currentIndex();
-	if(i<0) i=0;
-	return (int)i; 
-}
-/**
-    \fn     UI_SetCurrentFormat( ADM_OUT_FORMAT fmt )
-    \brief  Select  output format
-*/
-uint8_t 	UI_SetCurrentFormat( uint32_t fmt )
-{
-	WIDGET(comboBoxFormat)->setCurrentIndex((int)fmt);
-    return 1;
-}
-
-/**
-      \fn UI_getTimeShift
-      \brief get state (on/off) and value for time Shift
-*/
-uint8_t UI_getTimeShift(int *onoff,int *value)
-{
-	if(WIDGET(checkBox_TimeShift)->checkState()==Qt::Checked)
-		*onoff=1;
-	else
-		*onoff=0;
-	*value=WIDGET(spinBox_TimeValue)->value();
-	return 1;
-}
-/**
-      \fn UI_setTimeShift
-      \brief get state (on/off) and value for time Shift
-*/
-
-uint8_t UI_setTimeShift(int onoff,int value)
-{
-	if (onoff && value)
-		WIDGET(checkBox_TimeShift)->setCheckState(Qt::Checked);
-	else
-		WIDGET(checkBox_TimeShift)->setCheckState(Qt::Unchecked);
-	WIDGET(spinBox_TimeValue)->setValue(value);
-	return 1;
-}
-/**
-    \fn UI_setVUMeter
-*/
-bool UI_setVUMeter( uint32_t volume[6])
-{
-    UI_vuUpdate( volume);
-    return true;
-}
-/**
-    \fn setDecodeName
-*/
-bool UI_setDecoderName(const char *name)
-{
-    WIDGET(labelVideoDecoder)->setText(name);	
-    return true;
-}
-//********************************************
-//EOF
+	checkCrashFile();
+
+	if (global_argc >= 2)
+		automation();
+
+	myApplication->exec();
+
+	destroyTranslator();
+    delete myApplication;
+    myApplication=NULL;
+    return 1;
+}
+/**
+    \fn searchTranslationTable(const char *name))
+    \brief return the action corresponding to a give button. The translation table is in translation_table.h
+*/
+Action searchTranslationTable(const char *name)
+{
+	for(int i=0;i< SIZEOF_MY_TRANSLATION;i++)
+	{
+		if(!strcmp(name, myTranslationTable[i].name))
+		{
+			return  myTranslationTable[i].action;
+		}
+	}
+	printf("WARNING: Signal not found in translation table %s\n",name);
+	return ACT_DUMMY;
+}
+/**
+    \fn     UI_updateRecentMenu( void )
+    \brief  Update the recent submenu with the latest files loaded
+*/
+uint8_t UI_updateRecentMenu( void )
+{
+    return  ((MainWindow *)QuiMainWindows)->buildRecentMenu();
+}
+/** 
+  \fn    setupMenus(void)
+  \brief Fill in video & audio co
+*/
+void setupMenus(void)
+{
+	uint32_t nbVid;
+    uint32_t maj,mn,pa;
+	const char *name;
+
+	nbVid=ADM_ve6_getNbEncoders();
+	printf("Found %d video encoder(s)\n",nbVid);
+	for(uint32_t i=1;i<nbVid;i++)
+	{
+		ADM_ve6_getEncoderInfo(i,&name,&maj,&mn,&pa);
+		WIDGET(comboBoxVideo)->addItem(name);
+	}
+
+	// And A codec
+
+	uint32_t nbAud;
+
+    nbAud=audioEncoderGetNumberOfEncoders();
+	printf("Found %d audio encoder(s)\n",nbAud);		       
+	for(uint32_t i=1;i<nbAud;i++)
+	{
+		name=audioEncoderGetDisplayName(i);
+		WIDGET(comboBoxAudio)->addItem(name);
+	}
+
+	/*   Fill in output format window */
+	uint32_t nbFormat=ADM_mx_getNbMuxers();
+
+	printf("Found %d format(s)\n",nbFormat);
+	for(uint32_t i=0;i<nbFormat;i++)
+	{
+        const char *name=ADM_mx_getName(i);
+		WIDGET(comboBoxFormat)->addItem(name);	
+	}
+
+}
+/*
+    Return % of scale (between 0 and 1)
+*/
+double 	UI_readScale( void )
+{
+	double v;
+	if(!slider) v=0;
+	v= (double)(slider->value());
+	v/=10000000;
+	return v;
+}
+void UI_setScale( double val )
+{
+	if(_upd_in_progres) return;
+	_upd_in_progres++;
+	slider->setValue( (int)(val * 10000000));
+	_upd_in_progres--;
+}
+
+int UI_readCurFrame(void)
+{
+	return 0;
+}
+
+int UI_readCurTime(uint16_t &hh, uint16_t &mm, uint16_t &ss, uint16_t &ms)
+{
+	int success = 0;
+
+	QString timeText = WIDGET(currentTime)->text();
+	int pos;
+
+	if (WIDGET(currentTime)->validator()->validate(timeText, pos) == QValidator::Acceptable)
+	{
+		uint32_t frame;
+
+		hh = (uint16_t)timeText.left(2).toUInt();
+		mm = (uint16_t)timeText.mid(3, 2).toUInt();
+		ss = (uint16_t)timeText.mid(6, 2).toUInt();
+		ms = (uint16_t)timeText.right(3).toUInt();
+
+		time2frame(&frame, currentFps, hh, mm, ss, ms);
+
+		if (frame <= frameCount)
+			success = 1;
+	}
+
+	return success;
+}
+
+
+
+//*******************************************
+
+/**
+    \fn UI_setTitle(char *name)
+    \brief Set the main window title, usually name if the file being edited
+*/
+void UI_setTitle(const char *name)
+{
+	char *title;
+	const char* defaultTitle = "Avidemux";
+
+	if (name && (*name) )
+	{
+		title = new char[strlen(defaultTitle) + strlen(name) + 3 + 1];
+
+		strcpy(title, name);
+		strcat(title, " - ");
+		strcat(title, defaultTitle);
+	}
+	else
+	{
+		title = new char[strlen(defaultTitle) + 1];
+
+		strcpy(title, defaultTitle);
+	}
+
+	QuiMainWindows->setWindowTitle(QString::fromUtf8(title));
+	delete [] title;
+}
+
+/**
+    \fn     UI_setFrameType( uint32_t frametype,uint32_t qp)
+    \brief  Display frametype (I/P/B) and associated quantizer
+*/
+
+void UI_setFrameType( uint32_t frametype,uint32_t qp)
+{
+	char string[100];
+	char	c='?';
+    const char *f="???";
+	switch(frametype&AVI_FRAME_TYPE_MASK)
+	{
+	case AVI_KEY_FRAME: c='I';break;
+	case AVI_B_FRAME: c='B';break;
+	case 0: c='P';break;
+	default:c='?';break;
+
+	}
+    switch(frametype&AVI_STRUCTURE_TYPE_MASK)
+	{
+	case AVI_TOP_FIELD+AVI_FIELD_STRUCTURE: f="TFF";break;
+    case AVI_BOTTOM_FIELD+AVI_FIELD_STRUCTURE: f="BFF";break;
+    case AVI_FRAME_STRUCTURE: f="FRM";break;
+	default:f="???";
+
+                    break;
+	}
+	sprintf(string,QT_TR_NOOP("%c-%s (%02d)"),c,f,qp);
+	WIDGET(label_8)->setText(string);	
+
+}
+
+/**
+    \fn     UI_updateFrameCount(uint32_t curFrame)
+    \brief  Display the current displayed frame #
+*/
+void UI_updateFrameCount(uint32_t curFrame)
+{
+	
+}
+
+/**
+    \fn      UI_setFrameCount(uint32_t curFrame,uint32_t total)
+    \brief  Display the current displayed frame # and total frame #
+*/
+void UI_setFrameCount(uint32_t curFrame,uint32_t total)
+{
+	
+}
+
+/**
+    \fn     UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
+    \brief  Display the time corresponding to current frame according to fps (fps1000)
+*/
+void UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
+{
+	char text[80];   
+	uint32_t mm,hh,ss,ms;
+
+	frame2time(curFrame,fps, &hh, &mm, &ss, &ms);
+	sprintf(text, "%02d:%02d:%02d.%03d", hh, mm, ss, ms);
+	WIDGET(currentTime)->setText(text);
+}
+
+
+
+/**
+    \fn UI_setCurrentTime
+    \brief Set current PTS of displayed video
+*/
+void UI_setCurrentTime(uint64_t curTime)
+{
+  char text[80];
+ uint32_t mm,hh,ss,ms;
+ uint32_t shorty=(uint32_t)(curTime/1000);
+
+    ms2time(shorty,&hh,&mm,&ss,&ms);
+  	sprintf(text, "%02d:%02d:%02d.%03d", hh, mm, ss, ms);
+	WIDGET(currentTime)->setText(text);
+
+}
+
+/**
+    \fn UI_setTotalTime
+    \brief SEt the total duration of video
+*/
+void UI_setTotalTime(uint64_t curTime)
+{
+  char text[80];
+ uint32_t mm,hh,ss,ms;
+ uint32_t shorty=(uint32_t)(curTime/1000);
+
+    ms2time(shorty,&hh,&mm,&ss,&ms);
+  	sprintf(text, "/%02d:%02d:%02d.%03d", hh, mm, ss, ms);
+    WIDGET(totalTime)->setText(text);
+    slider->setTotalDuration(curTime);
+}
+/**
+    \fn     UI_setMarkers(uint64_t Ptsa, uint32_t Ptsb )
+    \brief  Display frame # for marker A & B
+*/
+void UI_setMarkers(uint64_t a, uint64_t b)
+{
+	char text[80];
+    uint64_t absoluteA=a,absoluteB=b;
+    uint32_t hh,mm,ss,ms;
+    uint32_t timems;
+    a/=1000;
+    b/=1000;
+
+    timems=(uint32_t)(a);
+    ms2time(timems,&hh,&mm,&ss,&ms);
+	snprintf(text,79,"%02"LU":%02"LU":%02"LU".%02"LU,hh,mm,ss,ms);
+	WIDGET(pushButtonJumpToMarkerA)->setText(text);
+
+	timems=(uint32_t)(b);
+    ms2time(timems,&hh,&mm,&ss,&ms);
+	snprintf(text,79,"%02"LU":%02"LU":%02"LU".%02"LU,hh,mm,ss,ms);
+	WIDGET(pushButtonJumpToMarkerB)->setText(text);
+
+	slider->setMarkers(absoluteA, absoluteB);
+}
+
+/**
+    \fn     UI_getCurrentVCodec(void)
+    \brief  Returns the current selected video code in menu, i.e its number (0 being the first)
+*/
+int 	UI_getCurrentVCodec(void)
+{
+	int i=WIDGET(comboBoxVideo)->currentIndex();
+	if(i<0) i=0;
+	return i; 
+}
+/**
+    \fn     UI_setVideoCodec( int i)
+    \brief  Select the video codec which is # x in pulldown menu (starts at zero :copy)
+*/
+
+void UI_setVideoCodec( int i)
+{
+	int b=!!i;
+	WIDGET(comboBoxVideo)->setCurrentIndex(i);
+
+	WIDGET(pushButtonVideoConf)->setEnabled(b);
+	WIDGET(pushButtonVideoFilter)->setEnabled(b);
+}
+/**
+    \fn     UI_getCurrentACodec(void)
+    \brief  Returns the current selected audio code in menu, i.e its number (0 being the first)
+*/
+
+int 	UI_getCurrentACodec(void)
+{
+	int i=WIDGET(comboBoxAudio)->currentIndex();
+	if(i<0) i=0;
+	return i; 
+}
+/**
+    \fn     UI_setAudioCodec( int i)
+    \brief  Select the audio codec which is # x in pulldown menu (starts at zero :copy)
+*/
+
+void UI_setAudioCodec( int i)
+{ int b=!!i;
+WIDGET(comboBoxAudio)->setCurrentIndex(i);
+WIDGET(pushButtonAudioConf)->setEnabled(b);
+WIDGET(pushButtonAudioFilter)->setEnabled(b);
+}
+/**
+    \fn     UI_GetCurrentFormat(void)
+    \brief  Returns the current selected output format
+*/
+
+int 	UI_GetCurrentFormat( void )
+{
+	int i=WIDGET(comboBoxFormat)->currentIndex();
+	if(i<0) i=0;
+	return (int)i; 
+}
+/**
+    \fn     UI_SetCurrentFormat( ADM_OUT_FORMAT fmt )
+    \brief  Select  output format
+*/
+uint8_t 	UI_SetCurrentFormat( uint32_t fmt )
+{
+	WIDGET(comboBoxFormat)->setCurrentIndex((int)fmt);
+    return 1;
+}
+
+/**
+      \fn UI_getTimeShift
+      \brief get state (on/off) and value for time Shift
+*/
+uint8_t UI_getTimeShift(int *onoff,int *value)
+{
+	if(WIDGET(checkBox_TimeShift)->checkState()==Qt::Checked)
+		*onoff=1;
+	else
+		*onoff=0;
+	*value=WIDGET(spinBox_TimeValue)->value();
+	return 1;
+}
+/**
+      \fn UI_setTimeShift
+      \brief get state (on/off) and value for time Shift
+*/
+
+uint8_t UI_setTimeShift(int onoff,int value)
+{
+	if (onoff && value)
+		WIDGET(checkBox_TimeShift)->setCheckState(Qt::Checked);
+	else
+		WIDGET(checkBox_TimeShift)->setCheckState(Qt::Unchecked);
+	WIDGET(spinBox_TimeValue)->setValue(value);
+	return 1;
+}
+/**
+    \fn UI_setVUMeter
+*/
+bool UI_setVUMeter( uint32_t volume[6])
+{
+    UI_vuUpdate( volume);
+    return true;
+}
+/**
+    \fn setDecodeName
+*/
+bool UI_setDecoderName(const char *name)
+{
+    WIDGET(labelVideoDecoder)->setText(name);	
+    return true;
+}
+//********************************************
+//EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui	2010-12-23 09:04:13 UTC (rev 6861)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/gui2.ui	2010-12-24 22:43:39 UTC (rev 6862)
@@ -7,22 +7,10 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>640</width>
-    <height>640</height>
+    <width>659</width>
+    <height>642</height>
    </rect>
   </property>
-  <property name="sizePolicy">
-   <sizepolicy hsizetype="Minimum" vsizetype="Minimum">
-    <horstretch>0</horstretch>
-    <verstretch>0</verstretch>
-   </sizepolicy>
-  </property>
-  <property name="minimumSize">
-   <size>
-    <width>640</width>
-    <height>640</height>
-   </size>
-  </property>
   <property name="windowTitle">
    <string>Avidemux</string>
   </property>
@@ -49,1221 +37,58 @@
      <height>200</height>
     </size>
    </property>
-   <layout class="QVBoxLayout" name="verticalLayout_5">
+   <layout class="QHBoxLayout" name="horizontalLayout_3">
     <item>
-     <layout class="QHBoxLayout" name="horizontalLayout_2">
-      <item>
-       <layout class="QVBoxLayout" name="verticalLayout_3">
-        <property name="spacing">
-         <number>0</number>
-        </property>
-        <property name="sizeConstraint">
-         <enum>QLayout::SetDefaultConstraint</enum>
-        </property>
-        <item>
-         <widget class="QLabel" name="label_7">
-          <property name="text">
-           <string>&lt;b&gt;Video Decoder&lt;b&gt;</string>
-          </property>
-         </widget>
-        </item>
-        <item>
-         <spacer name="verticalSpacer_7">
-          <property name="orientation">
-           <enum>Qt::Vertical</enum>
-          </property>
-          <property name="sizeType">
-           <enum>QSizePolicy::Fixed</enum>
-          </property>
-          <property name="sizeHint" stdset="0">
-           <size>
-            <width>20</width>
-            <height>6</height>
-           </size>
-          </property>
-         </spacer>
-        </item>
-        <item>
-         <layout class="QHBoxLayout" name="videoLayout_2">
-          <property name="spacing">
-           <number>0</number>
-          </property>
-          <property name="margin">
-           <number>0</number>
-          </property>
-          <item>
-           <spacer>
-            <property name="orientation">
-             <enum>Qt::Horizontal</enum>
-            </property>
-            <property name="sizeType">
-             <enum>QSizePolicy::Fixed</enum>
-            </property>
-            <property name="sizeHint" stdset="0">
-             <size>
-              <width>12</width>
-              <height>0</height>
-             </size>
-            </property>
-           </spacer>
-          </item>
-          <item>
-           <layout class="QVBoxLayout" name="_6">
-            <property name="spacing">
-             <number>6</number>
-            </property>
-            <property name="margin">
-             <number>0</number>
-            </property>
-            <item>
-             <widget class="QLabel" name="labelVideoDecoder">
-              <property name="text">
-               <string>XXXX</string>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QPushButton" name="pushButtonDecoderConf">
-              <property name="enabled">
-               <bool>true</bool>
-              </property>
-              <property name="sizePolicy">
-               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
-              </property>
-              <property name="text">
-               <string>Configure</string>
-              </property>
-             </widget>
-            </item>
-           </layout>
-          </item>
-         </layout>
-        </item>
-        <item>
-         <spacer name="verticalSpacer_11">
-          <property name="orientation">
-           <enum>Qt::Vertical</enum>
-          </property>
-          <property name="sizeType">
-           <enum>QSizePolicy::Fixed</enum>
-          </property>
-          <property name="sizeHint" stdset="0">
-           <size>
-            <width>20</width>
-            <height>12</height>
-           </size>
-          </property>
-         </spacer>
-        </item>
-        <item>
-         <widget class="QLabel" name="label_3">
-          <property name="sizePolicy">
-           <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
-          </property>
-          <property name="maximumSize">
-           <size>
-            <width>180</width>
-            <height>16777215</height>
-           </size>
-          </property>
-          <property name="text">
-           <string>&lt;b&gt;Video Output&lt;/b&gt;</string>
-          </property>
-          <property name="textFormat">
-           <enum>Qt::AutoText</enum>
-          </property>
-         </widget>
-        </item>
-        <item>
-         <spacer name="verticalSpacer_8">
-          <property name="orientation">
-           <enum>Qt::Vertical</enum>
-          </property>
-          <property name="sizeType">
-           <enum>QSizePolicy::Fixed</enum>
-          </property>
-          <property name="sizeHint" stdset="0">
-           <size>
-            <width>20</width>
-            <height>6</height>
-           </size>
-          </property>
-         </spacer>
-        </item>
-        <item>
-         <layout class="QHBoxLayout" name="videoLayout">
-          <property name="spacing">
-           <number>0</number>
-          </property>
-          <property name="margin">
-           <number>0</number>
-          </property>
-          <item>
-           <spacer>
-            <property name="orientation">
-             <enum>Qt::Horizontal</enum>
-            </property>
-            <property name="sizeType">
-             <enum>QSizePolicy::Fixed</enum>
-            </property>
-            <property name="sizeHint" stdset="0">
-             <size>
-              <width>12</width>
-              <height>0</height>
-             </size>
-            </property>
-           </spacer>
-          </item>
-          <item>
-           <layout class="QVBoxLayout" name="_7" stretch="0,0,0">
-            <property name="spacing">
-             <number>6</number>
-            </property>
-            <property name="sizeConstraint">
-             <enum>QLayout::SetDefaultConstraint</enum>
-            </property>
-            <property name="margin">
-             <number>0</number>
-            </property>
-            <item>
-             <widget class="QComboBox" name="comboBoxVideo">
-              <property name="sizePolicy">
-               <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
-              </property>
-              <item>
-               <property name="text">
-                <string>Copy</string>
-               </property>
-              </item>
-             </widget>
-            </item>
-            <item>
-             <widget class="QPushButton" name="pushButtonVideoConf">
-              <property name="enabled">
-               <bool>true</bool>
-              </property>
-              <property name="sizePolicy">
-               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
-              </property>
-              <property name="text">
-               <string>Configure</string>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QPushButton" name="pushButtonVideoFilter">
-              <property name="enabled">
-               <bool>true</bool>
-              </property>
-              <property name="sizePolicy">
-               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
-              </property>
-              <property name="text">
-               <string>Filters</string>
-              </property>
-             </widget>
-            </item>
-           </layout>
-          </item>
-         </layout>
-        </item>
-        <item>
-         <spacer name="verticalSpacer_12">
-          <property name="orientation">
-           <enum>Qt::Vertical</enum>
-          </property>
-          <property name="sizeType">
-           <enum>QSizePolicy::Fixed</enum>
-          </property>
-          <property name="sizeHint" stdset="0">
-           <size>
-            <width>20</width>
-            <height>12</height>
-           </size>
-          </property>
-         </spacer>
-        </item>
-        <item>
-         <widget class="QLabel" name="label_5">
-          <property name="sizePolicy">
-           <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
-          </property>
-          <property name="maximumSize">
-           <size>
-            <width>180</width>
-            <height>16777215</height>
-           </size>
-          </property>
-          <property name="text">
-           <string>&lt;b&gt;Audio Output&lt;/b&gt;</string>
-          </property>
-          <property name="textFormat">
-           <enum>Qt::AutoText</enum>
-          </property>
-         </widget>
-        </item>
-        <item>
-         <spacer name="verticalSpacer_9">
-          <property name="orientation">
-           <enum>Qt::Vertical</enum>
-          </property>
-          <property name="sizeType">
-           <enum>QSizePolicy::Fixed</enum>
-          </property>
-          <property name="sizeHint" stdset="0">
-           <size>
-            <width>20</width>
-            <height>6</height>
-           </size>
-          </property>
-         </spacer>
-        </item>
-        <item>
-         <layout class="QHBoxLayout" name="AudioLayout">
-          <property name="spacing">
-           <number>0</number>
-          </property>
-          <property name="margin">
-           <number>0</number>
-          </property>
-          <item>
-           <spacer>
-            <property name="orientation">
-             <enum>Qt::Horizontal</enum>
-            </property>
-            <property name="sizeType">
-             <enum>QSizePolicy::Fixed</enum>
-            </property>
-            <property name="sizeHint" stdset="0">
-             <size>
-              <width>12</width>
-              <height>0</height>
-             </size>
-            </property>
-           </spacer>
-          </item>
-          <item>
-           <layout class="QVBoxLayout" name="_8">
-            <property name="spacing">
-             <number>6</number>
-            </property>
-            <property name="sizeConstraint">
-             <enum>QLayout::SetDefaultConstraint</enum>
-            </property>
-            <property name="margin">
-             <number>0</number>
-            </property>
-            <item>
-             <widget class="QComboBox" name="comboBoxAudio">
-              <property name="sizePolicy">
-               <sizepolicy hsizetype="Preferred" vsizetype="Minimum">
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
-              </property>
-              <item>
-               <property name="text">
-                <string>Copy</string>
-               </property>
-              </item>
-             </widget>
-            </item>
-            <item>
-             <widget class="QPushButton" name="pushButtonAudioConf">
-              <property name="enabled">
-               <bool>true</bool>
-              </property>
-              <property name="sizePolicy">
-               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
-              </property>
-              <property name="text">
-               <string>Configure</string>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QPushButton" name="pushButtonAudioFilter">
-              <property name="enabled">
-               <bool>true</bool>
-              </property>
-              <property name="sizePolicy">
-               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
-              </property>
-              <property name="text">
-               <string>Filters</string>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <layout class="QHBoxLayout" name="_9">
-              <property name="spacing">
-               <number>6</number>
-              </property>
-              <property name="sizeConstraint">
-               <enum>QLayout::SetDefaultConstraint</enum>
-              </property>
-              <property name="margin">
-               <number>0</number>
-              </property>
-              <item>
-               <widget class="QCheckBox" name="checkBox_TimeShift">
-                <property name="text">
-                 <string>&amp;Shift:</string>
-                </property>
-               </widget>
-              </item>
-              <item>
-               <widget class="QSpinBox" name="spinBox_TimeValue">
-                <property name="enabled">
-                 <bool>false</bool>
-                </property>
-                <property name="sizePolicy">
-                 <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                  <horstretch>0</horstretch>
-                  <verstretch>0</verstretch>
-                 </sizepolicy>
-                </property>
-                <property name="minimum">
-                 <number>-99999</number>
-                </property>
-                <property name="maximum">
-                 <number>99999</number>
-                </property>
-               </widget>
-              </item>
-              <item>
-               <widget class="QLabel" name="label_11">
-                <property name="sizePolicy">
-                 <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
-                  <horstretch>0</horstretch>
-                  <verstretch>0</verstretch>
-                 </sizepolicy>
-                </property>
-                <property name="text">
-                 <string>ms</string>
-                </property>
-               </widget>
-              </item>
-             </layout>
-            </item>
-           </layout>
-          </item>
-         </layout>
-        </item>
-        <item>
-         <spacer name="verticalSpacer_13">
-          <property name="orientation">
-           <enum>Qt::Vertical</enum>
-          </property>
-          <property name="sizeType">
-           <enum>QSizePolicy::Fixed</enum>
-          </property>
-          <property name="sizeHint" stdset="0">
-           <size>
-            <width>20</width>
-            <height>12</height>
-           </size>
-          </property>
-         </spacer>
-        </item>
-        <item>
-         <widget class="QLabel" name="label_4">
-          <property name="sizePolicy">
-           <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
-          </property>
-          <property name="text">
-           <string>&lt;b&gt;Output Format&lt;/b&gt;</string>
-          </property>
-          <property name="textFormat">
-           <enum>Qt::AutoText</enum>
-          </property>
-         </widget>
-        </item>
-        <item>
-         <spacer name="verticalSpacer_10">
-          <property name="orientation">
-           <enum>Qt::Vertical</enum>
-          </property>
-          <property name="sizeType">
-           <enum>QSizePolicy::Fixed</enum>
-          </property>
-          <property name="sizeHint" stdset="0">
-           <size>
-            <width>20</width>
-            <height>6</height>
-           </size>
-          </property>
-         </spacer>
-        </item>
-        <item>
-         <layout class="QHBoxLayout" name="horizontalLayout">
-          <property name="spacing">
-           <number>0</number>
-          </property>
-          <item>
-           <spacer>
-            <property name="orientation">
-             <enum>Qt::Horizontal</enum>
-            </property>
-            <property name="sizeType">
-             <enum>QSizePolicy::Fixed</enum>
-            </property>
-            <property name="sizeHint" stdset="0">
-             <size>
-              <width>12</width>
-              <height>0</height>
-             </size>
-            </property>
-           </spacer>
-          </item>
-          <item>
-           <layout class="QVBoxLayout" name="verticalLayout_2">
-            <property name="spacing">
-             <number>6</number>
-            </property>
-            <item>
-             <widget class="QComboBox" name="comboBoxFormat">
-              <property name="sizePolicy">
-               <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QPushButton" name="pushButtonFormatConfigure">
-              <property name="enabled">
-               <bool>true</bool>
-              </property>
-              <property name="sizePolicy">
-               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
-              </property>
-              <property name="text">
-               <string>Configure</string>
-              </property>
-             </widget>
-            </item>
-           </layout>
-          </item>
-         </layout>
-        </item>
-       </layout>
-      </item>
-      <item>
-       <layout class="QHBoxLayout" name="_10">
-        <property name="spacing">
-         <number>6</number>
-        </property>
-        <property name="margin">
-         <number>0</number>
-        </property>
-        <item>
-         <widget class="QFrame" name="frame_video">
-          <property name="sizePolicy">
-           <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
-          </property>
-          <property name="minimumSize">
-           <size>
-            <width>100</width>
-            <height>100</height>
-           </size>
-          </property>
-          <property name="autoFillBackground">
-           <bool>false</bool>
-          </property>
-          <property name="frameShape">
-           <enum>QFrame::NoFrame</enum>
-          </property>
-          <property name="frameShadow">
-           <enum>QFrame::Raised</enum>
-          </property>
-          <property name="lineWidth">
-           <number>0</number>
-          </property>
-         </widget>
-        </item>
-        <item>
-         <spacer>
-          <property name="orientation">
-           <enum>Qt::Horizontal</enum>
-          </property>
-          <property name="sizeType">
-           <enum>QSizePolicy::Expanding</enum>
-          </property>
-          <property name="sizeHint" stdset="0">
-           <size>
-            <width>13</width>
-            <height>13</height>
-           </size>
-          </property>
-         </spacer>
-        </item>
-       </layout>
-      </item>
-     </layout>
-    </item>
-    <item>
-     <spacer name="verticalSpacer_3">
-      <property name="orientation">
-       <enum>Qt::Vertical</enum>
+     <layout class="QHBoxLayout" name="_10">
+      <property name="spacing">
+       <number>6</number>
       </property>
-      <property name="sizeType">
-       <enum>QSizePolicy::Expanding</enum>
+      <property name="margin">
+       <number>0</number>
       </property>
-      <property name="sizeHint" stdset="0">
-       <size>
-        <width>619</width>
-        <height>0</height>
-       </size>
-      </property>
-     </spacer>
-    </item>
-    <item>
-     <layout class="QHBoxLayout" name="horizontalLayout_3">
       <item>
-       <layout class="QGridLayout" name="gridLayout_2">
-        <property name="horizontalSpacing">
-         <number>12</number>
-        </property>
-        <property name="verticalSpacing">
-         <number>0</number>
-        </property>
-        <item row="0" column="0">
-         <widget class="ADM_QSlider" name="horizontalSlider">
-          <property name="sizePolicy">
-           <sizepolicy hsizetype="Expanding" vsizetype="Fixed">
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
-          </property>
-          <property name="orientation">
-           <enum>Qt::Horizontal</enum>
-          </property>
-         </widget>
-        </item>
-        <item row="1" column="0">
-         <layout class="QVBoxLayout" name="verticalLayout">
-          <property name="spacing">
-           <number>0</number>
-          </property>
-          <property name="sizeConstraint">
-           <enum>QLayout::SetDefaultConstraint</enum>
-          </property>
-          <item>
-           <spacer name="verticalSpacer">
-            <property name="orientation">
-             <enum>Qt::Vertical</enum>
-            </property>
-            <property name="sizeType">
-             <enum>QSizePolicy::Preferred</enum>
-            </property>
-            <property name="sizeHint" stdset="0">
-             <size>
-              <width>20</width>
-              <height>12</height>
-             </size>
-            </property>
-           </spacer>
-          </item>
-          <item>
-           <layout class="QHBoxLayout" name="_3">
-            <property name="spacing">
-             <number>0</number>
-            </property>
-            <property name="margin">
-             <number>0</number>
-            </property>
-            <item>
-             <widget class="QToolButton" name="toolButtonPlay">
-              <property name="text">
-               <string>...</string>
-              </property>
-              <property name="icon">
-               <iconset resource="avidemux.qrc">
-                <normaloff>:/new/prefix1/pics/player_play.png</normaloff>:/new/prefix1/pics/player_play.png</iconset>
-              </property>
-              <property name="iconSize">
-               <size>
-                <width>24</width>
-                <height>24</height>
-               </size>
-              </property>
-              <property name="autoRaise">
-               <bool>true</bool>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QToolButton" name="toolButtonStop">
-              <property name="text">
-               <string>...</string>
-              </property>
-              <property name="icon">
-               <iconset resource="avidemux.qrc">
-                <normaloff>:/new/prefix1/pics/player_stop.png</normaloff>:/new/prefix1/pics/player_stop.png</iconset>
-              </property>
-              <property name="iconSize">
-               <size>
-                <width>24</width>
-                <height>24</height>
-               </size>
-              </property>
-              <property name="autoRaise">
-               <bool>true</bool>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QToolButton" name="toolButtonPreviousFrame">
-              <property name="text">
-               <string>...</string>
-              </property>
-              <property name="icon">
-               <iconset resource="avidemux.qrc">
-                <normaloff>:/new/prefix1/pics/back.png</normaloff>:/new/prefix1/pics/back.png</iconset>
-              </property>
-              <property name="iconSize">
-               <size>
-                <width>24</width>
-                <height>24</height>
-               </size>
-              </property>
-              <property name="autoRaise">
-               <bool>true</bool>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QToolButton" name="toolButtonNextFrame">
-              <property name="text">
-               <string>...</string>
-              </property>
-              <property name="icon">
-               <iconset resource="avidemux.qrc">
-                <normaloff>:/new/prefix1/pics/forward.png</normaloff>:/new/prefix1/pics/forward.png</iconset>
-              </property>
-              <property name="iconSize">
-               <size>
-                <width>24</width>
-                <height>24</height>
-               </size>
-              </property>
-              <property name="autoRaise">
-               <bool>true</bool>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QToolButton" name="toolButtonPreviousIntraFrame">
-              <property name="text">
-               <string>...</string>
-              </property>
-              <property name="icon">
-               <iconset resource="avidemux.qrc">
-                <normaloff>:/new/prefix1/pics/player_rew.png</normaloff>:/new/prefix1/pics/player_rew.png</iconset>
-              </property>
-              <property name="iconSize">
-               <size>
-                <width>24</width>
-                <height>24</height>
-               </size>
-              </property>
-              <property name="autoRaise">
-               <bool>true</bool>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QToolButton" name="toolButtonNextIntraFrame">
-              <property name="text">
-               <string>...</string>
-              </property>
-              <property name="icon">
-               <iconset resource="avidemux.qrc">
-                <normaloff>:/new/prefix1/pics/player_fwd.png</normaloff>:/new/prefix1/pics/player_fwd.png</iconset>
-              </property>
-              <property name="iconSize">
-               <size>
-                <width>24</width>
-                <height>24</height>
-               </size>
-              </property>
-              <property name="autoRaise">
-               <bool>true</bool>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QToolButton" name="toolButtonSetMarkerA">
-              <property name="text">
-               <string>...</string>
-              </property>
-              <property name="icon">
-               <iconset resource="avidemux.qrc">
-                <normaloff>:/new/prefix1/pics/markA.png</normaloff>:/new/prefix1/pics/markA.png</iconset>
-              </property>
-              <property name="iconSize">
-               <size>
-                <width>24</width>
-                <height>24</height>
-               </size>
-              </property>
-              <property name="autoRaise">
-               <bool>true</bool>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QToolButton" name="toolButtonSetMarkerB">
-              <property name="text">
-               <string>...</string>
-              </property>
-              <property name="icon">
-               <iconset resource="avidemux.qrc">
-                <normaloff>:/new/prefix1/pics/markB.png</normaloff>:/new/prefix1/pics/markB.png</iconset>
-              </property>
-              <property name="iconSize">
-               <size>
-                <width>24</width>
-                <height>24</height>
-               </size>
-              </property>
-              <property name="autoRaise">
-               <bool>true</bool>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QToolButton" name="toolButtonPreviousBlackFrame">
-              <property name="text">
-               <string>...</string>
-              </property>
-              <property name="icon">
-               <iconset resource="avidemux.qrc">
-                <normaloff>:/new/prefix1/pics/prev_black.png</normaloff>:/new/prefix1/pics/prev_black.png</iconset>
-              </property>
-              <property name="iconSize">
-               <size>
-                <width>24</width>
-                <height>24</height>
-               </size>
-              </property>
-              <property name="autoRaise">
-               <bool>true</bool>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QToolButton" name="toolButtonNextBlackFrame">
-              <property name="text">
-               <string>...</string>
-              </property>
-              <property name="icon">
-               <iconset resource="avidemux.qrc">
-                <normaloff>:/new/prefix1/pics/next_black.png</normaloff>:/new/prefix1/pics/next_black.png</iconset>
-              </property>
-              <property name="iconSize">
-               <size>
-                <width>24</width>
-                <height>24</height>
-               </size>
-              </property>
-              <property name="autoRaise">
-               <bool>true</bool>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QToolButton" name="toolButtonFirstFrame">
-              <property name="text">
-               <string>...</string>
-              </property>
-              <property name="icon">
-               <iconset resource="avidemux.qrc">
-                <normaloff>:/new/prefix1/pics/player_start.png</normaloff>:/new/prefix1/pics/player_start.png</iconset>
-              </property>
-              <property name="iconSize">
-               <size>
-                <width>24</width>
-                <height>24</height>
-               </size>
-              </property>
-              <property name="autoRaise">
-               <bool>true</bool>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QToolButton" name="toolButtonLastFrame">
-              <property name="text">
-               <string>...</string>
-              </property>
-              <property name="icon">
-               <iconset resource="avidemux.qrc">
-                <normaloff>:/new/prefix1/pics/player_end.png</normaloff>:/new/prefix1/pics/player_end.png</iconset>
-              </property>
-              <property name="iconSize">
-               <size>
-                <width>24</width>
-                <height>24</height>
-               </size>
-              </property>
-              <property name="autoRaise">
-               <bool>true</bool>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <spacer name="horizontalSpacer_3">
-              <property name="orientation">
-               <enum>Qt::Horizontal</enum>
-              </property>
-              <property name="sizeType">
-               <enum>QSizePolicy::Expanding</enum>
-              </property>
-              <property name="sizeHint" stdset="0">
-               <size>
-                <width>0</width>
-                <height>0</height>
-               </size>
-              </property>
-             </spacer>
-            </item>
-           </layout>
-          </item>
-          <item>
-           <spacer name="verticalSpacer_2">
-            <property name="orientation">
-             <enum>Qt::Vertical</enum>
-            </property>
-            <property name="sizeType">
-             <enum>QSizePolicy::Preferred</enum>
-            </property>
-            <property name="sizeHint" stdset="0">
-             <size>
-              <width>20</width>
-              <height>12</height>
-             </size>
-            </property>
-           </spacer>
-          </item>
-          <item>
-           <layout class="QHBoxLayout" name="_4">
-            <property name="spacing">
-             <number>6</number>
-            </property>
-            <property name="margin">
-             <number>0</number>
-            </property>
-            <item>
-             <widget class="QPushButton" name="pushButtonTime">
-              <property name="text">
-               <string>Time</string>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QLineEdit" name="currentTime">
-              <property name="sizePolicy">
-               <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
-              </property>
-              <property name="maximumSize">
-               <size>
-                <width>84</width>
-                <height>16777215</height>
-               </size>
-              </property>
-              <property name="text">
-               <string>00:00:00.000</string>
-              </property>
-              <property name="maxLength">
-               <number>12</number>
-              </property>
-              <property name="readOnly">
-               <bool>true</bool>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QLabel" name="totalTime">
-              <property name="sizePolicy">
-               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
-              </property>
-              <property name="text">
-               <string>/ 00:00:00.000</string>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <spacer>
-              <property name="orientation">
-               <enum>Qt::Horizontal</enum>
-              </property>
-              <property name="sizeType">
-               <enum>QSizePolicy::Fixed</enum>
-              </property>
-              <property name="sizeHint" stdset="0">
-               <size>
-                <width>24</width>
-                <height>0</height>
-               </size>
-              </property>
-             </spacer>
-            </item>
-            <item>
-             <widget class="QLabel" name="label_10">
-              <property name="sizePolicy">
-               <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
-              </property>
-              <property name="text">
-               <string>Frame type:</string>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QLabel" name="label_8">
-              <property name="sizePolicy">
-               <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
-              </property>
-              <property name="text">
-               <string>?</string>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <spacer>
-              <property name="orientation">
-               <enum>Qt::Horizontal</enum>
-              </property>
-              <property name="sizeType">
-               <enum>QSizePolicy::Expanding</enum>
-              </property>
-              <property name="sizeHint" stdset="0">
-               <size>
-                <width>0</width>
-                <height>0</height>
-               </size>
-              </property>
-             </spacer>
-            </item>
-           </layout>
-          </item>
-         </layout>
-        </item>
-        <item row="1" column="1">
-         <layout class="QVBoxLayout" name="verticalLayout_6">
-          <property name="spacing">
-           <number>6</number>
-          </property>
-          <property name="sizeConstraint">
-           <enum>QLayout::SetDefaultConstraint</enum>
-          </property>
-          <item>
-           <widget class="QLabel" name="label">
-            <property name="text">
-             <string>&lt;b&gt;Selection&lt;/b&gt;</string>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <layout class="QGridLayout" name="gridLayout">
-            <property name="spacing">
-             <number>6</number>
-            </property>
-            <item row="1" column="0">
-             <spacer name="horizontalSpacer">
-              <property name="orientation">
-               <enum>Qt::Horizontal</enum>
-              </property>
-              <property name="sizeType">
-               <enum>QSizePolicy::Fixed</enum>
-              </property>
-              <property name="sizeHint" stdset="0">
-               <size>
-                <width>12</width>
-                <height>0</height>
-               </size>
-              </property>
-             </spacer>
-            </item>
-            <item row="2" column="0">
-             <spacer name="horizontalSpacer_2">
-              <property name="orientation">
-               <enum>Qt::Horizontal</enum>
-              </property>
-              <property name="sizeType">
-               <enum>QSizePolicy::Fixed</enum>
-              </property>
-              <property name="sizeHint" stdset="0">
-               <size>
-                <width>12</width>
-                <height>0</height>
-               </size>
-              </property>
-             </spacer>
-            </item>
-            <item row="1" column="1">
-             <widget class="QLabel" name="label_2">
-              <property name="text">
-               <string>A:</string>
-              </property>
-             </widget>
-            </item>
-            <item row="2" column="1">
-             <widget class="QLabel" name="label_9">
-              <property name="text">
-               <string>B:</string>
-              </property>
-             </widget>
-            </item>
-            <item row="1" column="2">
-             <widget class="QPushButton" name="pushButtonJumpToMarkerA">
-              <property name="text">
-               <string>000000</string>
-              </property>
-             </widget>
-            </item>
-            <item row="2" column="2">
-             <widget class="QPushButton" name="pushButtonJumpToMarkerB">
-              <property name="text">
-               <string>000000</string>
-              </property>
-             </widget>
-            </item>
-           </layout>
-          </item>
-         </layout>
-        </item>
-        <item row="0" column="1">
-         <widget class="QWidget" name="sliderPlaceHolder" native="true"/>
-        </item>
-       </layout>
-      </item>
-      <item>
-       <widget class="QFrame" name="frameVU">
+       <widget class="QFrame" name="frame_video">
         <property name="sizePolicy">
-         <sizepolicy hsizetype="Fixed" vsizetype="Preferred">
+         <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
           <horstretch>0</horstretch>
           <verstretch>0</verstretch>
          </sizepolicy>
         </property>
         <property name="minimumSize">
          <size>
-          <width>64</width>
-          <height>64</height>
+          <width>100</width>
+          <height>100</height>
          </size>
         </property>
+        <property name="autoFillBackground">
+         <bool>false</bool>
+        </property>
         <property name="frameShape">
-         <enum>QFrame::StyledPanel</enum>
+         <enum>QFrame::NoFrame</enum>
         </property>
         <property name="frameShadow">
          <enum>QFrame::Raised</enum>
         </property>
+        <property name="lineWidth">
+         <number>0</number>
+        </property>
        </widget>
       </item>
       <item>
-       <layout class="QVBoxLayout" name="verticalLayout_4">
-        <property name="spacing">
-         <number>5</number>
+       <spacer>
+        <property name="orientation">
+         <enum>Qt::Horizontal</enum>
         </property>
-        <item>
-         <widget class="QToolButton" name="toolButtonAudioToggle">
-          <property name="enabled">
-           <bool>true</bool>
-          </property>
-          <property name="sizePolicy">
-           <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
-          </property>
-          <property name="text">
-           <string>...</string>
-          </property>
-          <property name="icon">
-           <iconset resource="avidemux.qrc">
-            <normaloff>:/new/prefix1/pics/arts.png</normaloff>:/new/prefix1/pics/arts.png</iconset>
-          </property>
-          <property name="checkable">
-           <bool>true</bool>
-          </property>
-          <property name="checked">
-           <bool>true</bool>
-          </property>
-         </widget>
-        </item>
-        <item>
-         <widget class="QSlider" name="horizontalSlider_2">
-          <property name="sizePolicy">
-           <sizepolicy hsizetype="Preferred" vsizetype="Expanding">
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
-          </property>
-          <property name="maximumSize">
-           <size>
-            <width>16777215</width>
-            <height>64</height>
-           </size>
-          </property>
-          <property name="maximum">
-           <number>100</number>
-          </property>
-          <property name="value">
-           <number>100</number>
-          </property>
-          <property name="orientation">
-           <enum>Qt::Vertical</enum>
-          </property>
-         </widget>
-        </item>
-       </layout>
+        <property name="sizeType">
+         <enum>QSizePolicy::Expanding</enum>
+        </property>
+        <property name="sizeHint" stdset="0">
+         <size>
+          <width>13</width>
+          <height>13</height>
+         </size>
+        </property>
+       </spacer>
       </item>
      </layout>
     </item>
@@ -1274,8 +99,8 @@
     <rect>
      <x>0</x>
      <y>0</y>
-     <width>640</width>
-     <height>21</height>
+     <width>659</width>
+     <height>22</height>
     </rect>
    </property>
    <widget class="QMenu" name="menuHelp">
@@ -1297,6 +122,17 @@
     <property name="title">
      <string>&amp;View</string>
     </property>
+    <widget class="QMenu" name="menuToolbars">
+     <property name="title">
+      <string>&amp;Toolbars</string>
+     </property>
+     <addaction name="actionViewAudioMetre"/>
+     <addaction name="actionViewCodecOptions"/>
+     <addaction name="actionViewNavigation"/>
+     <addaction name="actionViewSelection"/>
+     <addaction name="actionViewVolume"/>
+    </widget>
+    <addaction name="menuToolbars"/>
    </widget>
    <widget class="QMenu" name="menuCustom">
     <property name="title">
@@ -1339,7 +175,6 @@
    <addaction name="menuCustom"/>
    <addaction name="menuHelp"/>
   </widget>
-  <widget class="QStatusBar" name="statusbar"/>
   <widget class="QToolBar" name="toolBar">
    <property name="orientation">
     <enum>Qt::Horizontal</enum>
@@ -1373,104 +208,1361 @@
    <addaction name="actionPreviewInput"/>
    <addaction name="actionPreviewOutput"/>
   </widget>
-  <action name="actionOpen">
-   <property name="icon">
-    <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/fileopen.png</normaloff>:/new/prefix1/pics/fileopen.png</iconset>
+  <widget class="QDockWidget" name="codecWidget">
+   <property name="styleSheet">
+    <string notr="true"/>
    </property>
-   <property name="text">
-    <string>&amp;Open...</string>
+   <property name="features">
+    <set>QDockWidget::NoDockWidgetFeatures</set>
    </property>
-   <property name="shortcut">
-    <string>Ctrl+O</string>
+   <property name="allowedAreas">
+    <set>Qt::LeftDockWidgetArea|Qt::RightDockWidgetArea</set>
    </property>
-  </action>
-  <action name="actionAppend">
-   <property name="text">
-    <string>&amp;Append...</string>
+   <property name="windowTitle">
+    <string>Codec Options</string>
    </property>
-   <property name="shortcut">
-    <string>Ctrl+Alt+A</string>
+   <attribute name="dockWidgetArea">
+    <number>1</number>
+   </attribute>
+   <widget class="QWidget" name="dockWidgetContents">
+    <layout class="QVBoxLayout" name="verticalLayout_9">
+     <property name="spacing">
+      <number>0</number>
+     </property>
+     <property name="leftMargin">
+      <number>9</number>
+     </property>
+     <property name="topMargin">
+      <number>9</number>
+     </property>
+     <property name="rightMargin">
+      <number>0</number>
+     </property>
+     <property name="bottomMargin">
+      <number>9</number>
+     </property>
+     <item>
+      <layout class="QVBoxLayout" name="verticalLayout_3">
+       <property name="spacing">
+        <number>0</number>
+       </property>
+       <property name="sizeConstraint">
+        <enum>QLayout::SetDefaultConstraint</enum>
+       </property>
+       <item>
+        <widget class="QLabel" name="label_7">
+         <property name="text">
+          <string>&lt;b&gt;Video Decoder&lt;b&gt;</string>
+         </property>
+        </widget>
+       </item>
+       <item>
+        <spacer name="verticalSpacer_7">
+         <property name="orientation">
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeType">
+          <enum>QSizePolicy::Fixed</enum>
+         </property>
+         <property name="sizeHint" stdset="0">
+          <size>
+           <width>20</width>
+           <height>6</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+       <item>
+        <layout class="QHBoxLayout" name="videoLayout_2">
+         <property name="spacing">
+          <number>0</number>
+         </property>
+         <property name="margin">
+          <number>0</number>
+         </property>
+         <item>
+          <spacer>
+           <property name="orientation">
+            <enum>Qt::Horizontal</enum>
+           </property>
+           <property name="sizeType">
+            <enum>QSizePolicy::Fixed</enum>
+           </property>
+           <property name="sizeHint" stdset="0">
+            <size>
+             <width>12</width>
+             <height>0</height>
+            </size>
+           </property>
+          </spacer>
+         </item>
+         <item>
+          <layout class="QVBoxLayout" name="_6">
+           <property name="spacing">
+            <number>6</number>
+           </property>
+           <property name="margin">
+            <number>0</number>
+           </property>
+           <item>
+            <widget class="QLabel" name="labelVideoDecoder">
+             <property name="text">
+              <string>XXXX</string>
+             </property>
+            </widget>
+           </item>
+           <item>
+            <widget class="QPushButton" name="pushButtonDecoderConf">
+             <property name="enabled">
+              <bool>true</bool>
+             </property>
+             <property name="sizePolicy">
+              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+               <horstretch>0</horstretch>
+               <verstretch>0</verstretch>
+              </sizepolicy>
+             </property>
+             <property name="text">
+              <string>Configure</string>
+             </property>
+            </widget>
+           </item>
+          </layout>
+         </item>
+        </layout>
+       </item>
+       <item>
+        <spacer name="verticalSpacer_11">
+         <property name="orientation">
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeType">
+          <enum>QSizePolicy::Fixed</enum>
+         </property>
+         <property name="sizeHint" stdset="0">
+          <size>
+           <width>20</width>
+           <height>12</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+       <item>
+        <widget class="QLabel" name="label_3">
+         <property name="sizePolicy">
+          <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+           <horstretch>0</horstretch>
+           <verstretch>0</verstretch>
+          </sizepolicy>
+         </property>
+         <property name="maximumSize">
+          <size>
+           <width>180</width>
+           <height>16777215</height>
+          </size>
+         </property>
+         <property name="text">
+          <string>&lt;b&gt;Video Output&lt;/b&gt;</string>
+         </property>
+         <property name="textFormat">
+          <enum>Qt::AutoText</enum>
+         </property>
+        </widget>
+       </item>
+       <item>
+        <spacer name="verticalSpacer_8">
+         <property name="orientation">
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeType">
+          <enum>QSizePolicy::Fixed</enum>
+         </property>
+         <property name="sizeHint" stdset="0">
+          <size>
+           <width>20</width>
+           <height>6</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+       <item>
+        <layout class="QHBoxLayout" name="videoLayout">
+         <property name="spacing">
+          <number>0</number>
+         </property>
+         <property name="margin">
+          <number>0</number>
+         </property>
+         <item>
+          <spacer>
+           <property name="orientation">
+            <enum>Qt::Horizontal</enum>
+           </property>
+           <property name="sizeType">
+            <enum>QSizePolicy::Fixed</enum>
+           </property>
+           <property name="sizeHint" stdset="0">
+            <size>
+             <width>12</width>
+             <height>0</height>
+            </size>
+           </property>
+          </spacer>
+         </item>
+         <item>
+          <layout class="QVBoxLayout" name="_7" stretch="0,0,0">
+           <property name="spacing">
+            <number>6</number>
+           </property>
+           <property name="sizeConstraint">
+            <enum>QLayout::SetDefaultConstraint</enum>
+           </property>
+           <property name="margin">
+            <number>0</number>
+           </property>
+           <item>
+            <widget class="QComboBox" name="comboBoxVideo">
+             <property name="sizePolicy">
+              <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
+               <horstretch>0</horstretch>
+               <verstretch>0</verstretch>
+              </sizepolicy>
+             </property>
+             <item>
+              <property name="text">
+               <string>Copy</string>
+              </property>
+             </item>
+            </widget>
+           </item>
+           <item>
+            <widget class="QPushButton" name="pushButtonVideoConf">
+             <property name="enabled">
+              <bool>true</bool>
+             </property>
+             <property name="sizePolicy">
+              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+               <horstretch>0</horstretch>
+               <verstretch>0</verstretch>
+              </sizepolicy>
+             </property>
+             <property name="text">
+              <string>Configure</string>
+             </property>
+            </widget>
+           </item>
+           <item>
+            <widget class="QPushButton" name="pushButtonVideoFilter">
+             <property name="enabled">
+              <bool>true</bool>
+             </property>
+             <property name="sizePolicy">
+              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+               <horstretch>0</horstretch>
+               <verstretch>0</verstretch>
+              </sizepolicy>
+             </property>
+             <property name="text">
+              <string>Filters</string>
+             </property>
+            </widget>
+           </item>
+          </layout>
+         </item>
+        </layout>
+       </item>
+       <item>
+        <spacer name="verticalSpacer_12">
+         <property name="orientation">
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeType">
+          <enum>QSizePolicy::Fixed</enum>
+         </property>
+         <property name="sizeHint" stdset="0">
+          <size>
+           <width>20</width>
+           <height>12</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+       <item>
+        <widget class="QLabel" name="label_5">
+         <property name="sizePolicy">
+          <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+           <horstretch>0</horstretch>
+           <verstretch>0</verstretch>
+          </sizepolicy>
+         </property>
+         <property name="maximumSize">
+          <size>
+           <width>180</width>
+           <height>16777215</height>
+          </size>
+         </property>
+         <property name="text">
+          <string>&lt;b&gt;Audio Output&lt;/b&gt;</string>
+         </property>
+         <property name="textFormat">
+          <enum>Qt::AutoText</enum>
+         </property>
+        </widget>
+       </item>
+       <item>
+        <spacer name="verticalSpacer_9">
+         <property name="orientation">
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeType">
+          <enum>QSizePolicy::Fixed</enum>
+         </property>
+         <property name="sizeHint" stdset="0">
+          <size>
+           <width>20</width>
+           <height>6</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+       <item>
+        <layout class="QHBoxLayout" name="AudioLayout">
+         <property name="spacing">
+          <number>0</number>
+         </property>
+         <property name="margin">
+          <number>0</number>
+         </property>
+         <item>
+          <spacer>
+           <property name="orientation">
+            <enum>Qt::Horizontal</enum>
+           </property>
+           <property name="sizeType">
+            <enum>QSizePolicy::Fixed</enum>
+           </property>
+           <property name="sizeHint" stdset="0">
+            <size>
+             <width>12</width>
+             <height>0</height>
+            </size>
+           </property>
+          </spacer>
+         </item>
+         <item>
+          <layout class="QVBoxLayout" name="_8">
+           <property name="spacing">
+            <number>6</number>
+           </property>
+           <property name="sizeConstraint">
+            <enum>QLayout::SetDefaultConstraint</enum>
+           </property>
+           <property name="margin">
+            <number>0</number>
+           </property>
+           <item>
+            <widget class="QComboBox" name="comboBoxAudio">
+             <property name="sizePolicy">
+              <sizepolicy hsizetype="Preferred" vsizetype="Minimum">
+               <horstretch>0</horstretch>
+               <verstretch>0</verstretch>
+              </sizepolicy>
+             </property>
+             <item>
+              <property name="text">
+               <string>Copy</string>
+              </property>
+             </item>
+            </widget>
+           </item>
+           <item>
+            <widget class="QPushButton" name="pushButtonAudioConf">
+             <property name="enabled">
+              <bool>true</bool>
+             </property>
+             <property name="sizePolicy">
+              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+               <horstretch>0</horstretch>
+               <verstretch>0</verstretch>
+              </sizepolicy>
+             </property>
+             <property name="text">
+              <string>Configure</string>
+             </property>
+            </widget>
+           </item>
+           <item>
+            <widget class="QPushButton" name="pushButtonAudioFilter">
+             <property name="enabled">
+              <bool>true</bool>
+             </property>
+             <property name="sizePolicy">
+              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+               <horstretch>0</horstretch>
+               <verstretch>0</verstretch>
+              </sizepolicy>
+             </property>
+             <property name="text">
+              <string>Filters</string>
+             </property>
+            </widget>
+           </item>
+           <item>
+            <layout class="QHBoxLayout" name="_9">
+             <property name="spacing">
+              <number>6</number>
+             </property>
+             <property name="sizeConstraint">
+              <enum>QLayout::SetDefaultConstraint</enum>
+             </property>
+             <property name="margin">
+              <number>0</number>
+             </property>
+             <item>
+              <widget class="QCheckBox" name="checkBox_TimeShift">
+               <property name="text">
+                <string>&amp;Shift:</string>
+               </property>
+              </widget>
+             </item>
+             <item>
+              <widget class="QSpinBox" name="spinBox_TimeValue">
+               <property name="enabled">
+                <bool>false</bool>
+               </property>
+               <property name="sizePolicy">
+                <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                 <horstretch>0</horstretch>
+                 <verstretch>0</verstretch>
+                </sizepolicy>
+               </property>
+               <property name="minimum">
+                <number>-99999</number>
+               </property>
+               <property name="maximum">
+                <number>99999</number>
+               </property>
+              </widget>
+             </item>
+             <item>
+              <widget class="QLabel" name="label_11">
+               <property name="sizePolicy">
+                <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+                 <horstretch>0</horstretch>
+                 <verstretch>0</verstretch>
+                </sizepolicy>
+               </property>
+               <property name="text">
+                <string>ms</string>
+               </property>
+              </widget>
+             </item>
+            </layout>
+           </item>
+          </layout>
+         </item>
+        </layout>
+       </item>
+       <item>
+        <spacer name="verticalSpacer_13">
+         <property name="orientation">
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeType">
+          <enum>QSizePolicy::Fixed</enum>
+         </property>
+         <property name="sizeHint" stdset="0">
+          <size>
+           <width>20</width>
+           <height>12</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+       <item>
+        <widget class="QLabel" name="label_4">
+         <property name="sizePolicy">
+          <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+           <horstretch>0</horstretch>
+           <verstretch>0</verstretch>
+          </sizepolicy>
+         </property>
+         <property name="text">
+          <string>&lt;b&gt;Output Format&lt;/b&gt;</string>
+         </property>
+         <property name="textFormat">
+          <enum>Qt::AutoText</enum>
+         </property>
+        </widget>
+       </item>
+       <item>
+        <spacer name="verticalSpacer_10">
+         <property name="orientation">
+          <enum>Qt::Vertical</enum>
+         </property>
+         <property name="sizeType">
+          <enum>QSizePolicy::Fixed</enum>
+         </property>
+         <property name="sizeHint" stdset="0">
+          <size>
+           <width>20</width>
+           <height>6</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+       <item>
+        <layout class="QHBoxLayout" name="horizontalLayout">
+         <property name="spacing">
+          <number>0</number>
+         </property>
+         <item>
+          <spacer>
+           <property name="orientation">
+            <enum>Qt::Horizontal</enum>
+           </property>
+           <property name="sizeType">
+            <enum>QSizePolicy::Fixed</enum>
+           </property>
+           <property name="sizeHint" stdset="0">
+            <size>
+             <width>12</width>
+             <height>0</height>
+            </size>
+           </property>
+          </spacer>
+         </item>
+         <item>
+          <layout class="QVBoxLayout" name="verticalLayout_2">
+           <property name="spacing">
+            <number>6</number>
+           </property>
+           <item>
+            <widget class="QComboBox" name="comboBoxFormat">
+             <property name="sizePolicy">
+              <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
+               <horstretch>0</horstretch>
+               <verstretch>0</verstretch>
+              </sizepolicy>
+             </property>
+            </widget>
+           </item>
+           <item>
+            <widget class="QPushButton" name="pushButtonFormatConfigure">
+             <property name="enabled">
+              <bool>true</bool>
+             </property>
+             <property name="sizePolicy">
+              <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+               <horstretch>0</horstretch>
+               <verstretch>0</verstretch>
+              </sizepolicy>
+             </property>
+             <property name="text">
+              <string>Configure</string>
+             </property>
+            </widget>
+           </item>
+          </layout>
+         </item>
+        </layout>
+       </item>
+      </layout>
+     </item>
+     <item>
+      <spacer name="verticalSpacer_3">
+       <property name="orientation">
+        <enum>Qt::Vertical</enum>
+       </property>
+       <property name="sizeType">
+        <enum>QSizePolicy::Expanding</enum>
+       </property>
+       <property name="sizeHint" stdset="0">
+        <size>
+         <width>20</width>
+         <height>10</height>
+        </size>
+       </property>
+      </spacer>
+     </item>
+    </layout>
+   </widget>
+  </widget>
+  <widget class="QDockWidget" name="navigationWidget">
+   <property name="sizePolicy">
+    <sizepolicy hsizetype="Expanding" vsizetype="Preferred">
+     <horstretch>0</horstretch>
+     <verstretch>0</verstretch>
+    </sizepolicy>
    </property>
-  </action>
-  <action name="actionQuit">
-   <property name="text">
-    <string>&amp;Quit</string>
+   <property name="features">
+    <set>QDockWidget::NoDockWidgetFeatures</set>
    </property>
-  </action>
-  <action name="actionCut">
-   <property name="text">
-    <string>Cu&amp;t</string>
+   <property name="allowedAreas">
+    <set>Qt::BottomDockWidgetArea</set>
    </property>
-   <property name="shortcut">
-    <string>Ctrl+X</string>
+   <property name="windowTitle">
+    <string>Navigation</string>
    </property>
-  </action>
-  <action name="actionCopy">
-   <property name="text">
-    <string>&amp;Copy</string>
+   <attribute name="dockWidgetArea">
+    <number>8</number>
+   </attribute>
+   <widget class="QWidget" name="dockWidgetContents_2">
+    <property name="sizePolicy">
+     <sizepolicy hsizetype="Expanding" vsizetype="Preferred">
+      <horstretch>0</horstretch>
+      <verstretch>0</verstretch>
+     </sizepolicy>
+    </property>
+    <layout class="QVBoxLayout" name="verticalLayout_8">
+     <property name="spacing">
+      <number>0</number>
+     </property>
+     <property name="leftMargin">
+      <number>9</number>
+     </property>
+     <property name="topMargin">
+      <number>1</number>
+     </property>
+     <property name="rightMargin">
+      <number>9</number>
+     </property>
+     <property name="bottomMargin">
+      <number>9</number>
+     </property>
+     <item>
+      <widget class="ADM_QSlider" name="horizontalSlider">
+       <property name="sizePolicy">
+        <sizepolicy hsizetype="Expanding" vsizetype="Fixed">
+         <horstretch>0</horstretch>
+         <verstretch>0</verstretch>
+        </sizepolicy>
+       </property>
+       <property name="minimumSize">
+        <size>
+         <width>0</width>
+         <height>22</height>
+        </size>
+       </property>
+       <property name="orientation">
+        <enum>Qt::Horizontal</enum>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <spacer name="verticalSpacer_4">
+       <property name="orientation">
+        <enum>Qt::Vertical</enum>
+       </property>
+       <property name="sizeType">
+        <enum>QSizePolicy::MinimumExpanding</enum>
+       </property>
+       <property name="sizeHint" stdset="0">
+        <size>
+         <width>0</width>
+         <height>6</height>
+        </size>
+       </property>
+      </spacer>
+     </item>
+     <item>
+      <layout class="QVBoxLayout" name="verticalLayout">
+       <property name="spacing">
+        <number>12</number>
+       </property>
+       <property name="topMargin">
+        <number>0</number>
+       </property>
+       <item>
+        <layout class="QHBoxLayout" name="_3">
+         <property name="spacing">
+          <number>0</number>
+         </property>
+         <property name="margin">
+          <number>0</number>
+         </property>
+         <item>
+          <widget class="QToolButton" name="toolButtonPlay">
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/player_play.png</normaloff>:/new/prefix1/pics/player_play.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonStop">
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/player_stop.png</normaloff>:/new/prefix1/pics/player_stop.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonPreviousFrame">
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/back.png</normaloff>:/new/prefix1/pics/back.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonNextFrame">
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/forward.png</normaloff>:/new/prefix1/pics/forward.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonPreviousIntraFrame">
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/player_rew.png</normaloff>:/new/prefix1/pics/player_rew.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonNextIntraFrame">
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/player_fwd.png</normaloff>:/new/prefix1/pics/player_fwd.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonSetMarkerA">
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/markA.png</normaloff>:/new/prefix1/pics/markA.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonSetMarkerB">
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/markB.png</normaloff>:/new/prefix1/pics/markB.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonPreviousBlackFrame">
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/prev_black.png</normaloff>:/new/prefix1/pics/prev_black.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonNextBlackFrame">
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/next_black.png</normaloff>:/new/prefix1/pics/next_black.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonFirstFrame">
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/player_start.png</normaloff>:/new/prefix1/pics/player_start.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QToolButton" name="toolButtonLastFrame">
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="icon">
+            <iconset resource="avidemux.qrc">
+             <normaloff>:/new/prefix1/pics/player_end.png</normaloff>:/new/prefix1/pics/player_end.png</iconset>
+           </property>
+           <property name="iconSize">
+            <size>
+             <width>24</width>
+             <height>24</height>
+            </size>
+           </property>
+           <property name="autoRaise">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <spacer name="horizontalSpacer_3">
+           <property name="orientation">
+            <enum>Qt::Horizontal</enum>
+           </property>
+           <property name="sizeType">
+            <enum>QSizePolicy::Expanding</enum>
+           </property>
+           <property name="sizeHint" stdset="0">
+            <size>
+             <width>0</width>
+             <height>0</height>
+            </size>
+           </property>
+          </spacer>
+         </item>
+        </layout>
+       </item>
+       <item>
+        <layout class="QHBoxLayout" name="_4">
+         <property name="spacing">
+          <number>6</number>
+         </property>
+         <property name="margin">
+          <number>0</number>
+         </property>
+         <item>
+          <widget class="QPushButton" name="pushButtonTime">
+           <property name="text">
+            <string>Time:</string>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QLineEdit" name="currentTime">
+           <property name="sizePolicy">
+            <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
+             <horstretch>0</horstretch>
+             <verstretch>0</verstretch>
+            </sizepolicy>
+           </property>
+           <property name="maximumSize">
+            <size>
+             <width>84</width>
+             <height>16777215</height>
+            </size>
+           </property>
+           <property name="text">
+            <string>00:00:00.000</string>
+           </property>
+           <property name="maxLength">
+            <number>12</number>
+           </property>
+           <property name="readOnly">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QLabel" name="totalTime">
+           <property name="sizePolicy">
+            <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+             <horstretch>0</horstretch>
+             <verstretch>0</verstretch>
+            </sizepolicy>
+           </property>
+           <property name="text">
+            <string>/ 00:00:00.000</string>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <spacer>
+           <property name="orientation">
+            <enum>Qt::Horizontal</enum>
+           </property>
+           <property name="sizeType">
+            <enum>QSizePolicy::Fixed</enum>
+           </property>
+           <property name="sizeHint" stdset="0">
+            <size>
+             <width>24</width>
+             <height>0</height>
+            </size>
+           </property>
+          </spacer>
+         </item>
+         <item>
+          <widget class="QLabel" name="label_10">
+           <property name="sizePolicy">
+            <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
+             <horstretch>0</horstretch>
+             <verstretch>0</verstretch>
+            </sizepolicy>
+           </property>
+           <property name="text">
+            <string>Frame type:</string>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QLabel" name="label_8">
+           <property name="sizePolicy">
+            <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+             <horstretch>0</horstretch>
+             <verstretch>0</verstretch>
+            </sizepolicy>
+           </property>
+           <property name="text">
+            <string>?</string>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <spacer>
+           <property name="orientation">
+            <enum>Qt::Horizontal</enum>
+           </property>
+           <property name="sizeType">
+            <enum>QSizePolicy::Expanding</enum>
+           </property>
+           <property name="sizeHint" stdset="0">
+            <size>
+             <width>0</width>
+             <height>0</height>
+            </size>
+           </property>
+          </spacer>
+         </item>
+        </layout>
+       </item>
+      </layout>
+     </item>
+    </layout>
+   </widget>
+  </widget>
+  <widget class="QDockWidget" name="selectionWidget">
+   <property name="sizePolicy">
+    <sizepolicy hsizetype="Fixed" vsizetype="Preferred">
+     <horstretch>0</horstretch>
+     <verstretch>0</verstretch>
+    </sizepolicy>
    </property>
-   <property name="shortcut">
-    <string>Ctrl+C</string>
+   <property name="minimumSize">
+    <size>
+     <width>120</width>
+     <height>0</height>
+    </size>
    </property>
-  </action>
-  <action name="actionPaste">
-   <property name="text">
-    <string>&amp;Paste</string>
+   <property name="features">
+    <set>QDockWidget::NoDockWidgetFeatures</set>
    </property>
-   <property name="shortcut">
-    <string>Ctrl+V</string>
+   <property name="windowTitle">
+    <string>Selection</string>
    </property>
-  </action>
-  <action name="actionDelete">
-   <property name="text">
-    <string>&amp;Delete</string>
+   <attribute name="dockWidgetArea">
+    <number>8</number>
+   </attribute>
+   <widget class="QWidget" name="dockWidgetContents_7">
+    <property name="sizePolicy">
+     <sizepolicy hsizetype="Fixed" vsizetype="Preferred">
+      <horstretch>0</horstretch>
+      <verstretch>0</verstretch>
+     </sizepolicy>
+    </property>
+    <layout class="QVBoxLayout" name="verticalLayout_7">
+     <property name="spacing">
+      <number>0</number>
+     </property>
+     <property name="leftMargin">
+      <number>9</number>
+     </property>
+     <property name="topMargin">
+      <number>0</number>
+     </property>
+     <property name="rightMargin">
+      <number>9</number>
+     </property>
+     <property name="bottomMargin">
+      <number>9</number>
+     </property>
+     <item>
+      <widget class="QWidget" name="sliderPlaceHolder" native="true">
+       <property name="sizePolicy">
+        <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
+         <horstretch>0</horstretch>
+         <verstretch>0</verstretch>
+        </sizepolicy>
+       </property>
+       <property name="minimumSize">
+        <size>
+         <width>0</width>
+         <height>20</height>
+        </size>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <spacer name="verticalSpacer_2">
+       <property name="orientation">
+        <enum>Qt::Vertical</enum>
+       </property>
+       <property name="sizeType">
+        <enum>QSizePolicy::MinimumExpanding</enum>
+       </property>
+       <property name="sizeHint" stdset="0">
+        <size>
+         <width>0</width>
+         <height>6</height>
+        </size>
+       </property>
+      </spacer>
+     </item>
+     <item>
+      <layout class="QVBoxLayout" name="verticalLayout_6">
+       <property name="spacing">
+        <number>9</number>
+       </property>
+       <item>
+        <widget class="QLabel" name="label">
+         <property name="text">
+          <string>&lt;b&gt;Selection&lt;/b&gt;</string>
+         </property>
+        </widget>
+       </item>
+       <item>
+        <layout class="QGridLayout" name="gridLayout">
+         <property name="verticalSpacing">
+          <number>4</number>
+         </property>
+         <item row="1" column="0">
+          <spacer name="horizontalSpacer">
+           <property name="orientation">
+            <enum>Qt::Horizontal</enum>
+           </property>
+           <property name="sizeType">
+            <enum>QSizePolicy::Fixed</enum>
+           </property>
+           <property name="sizeHint" stdset="0">
+            <size>
+             <width>10</width>
+             <height>0</height>
+            </size>
+           </property>
+          </spacer>
+         </item>
+         <item row="1" column="1">
+          <widget class="QLabel" name="label_2">
+           <property name="text">
+            <string>A:</string>
+           </property>
+          </widget>
+         </item>
+         <item row="2" column="1">
+          <widget class="QLabel" name="label_9">
+           <property name="text">
+            <string>B:</string>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="2">
+          <widget class="QPushButton" name="pushButtonJumpToMarkerA">
+           <property name="text">
+            <string>000000</string>
+           </property>
+          </widget>
+         </item>
+         <item row="2" column="2">
+          <widget class="QPushButton" name="pushButtonJumpToMarkerB">
+           <property name="text">
+            <string>000000</string>
+           </property>
+          </widget>
+         </item>
+        </layout>
+       </item>
+      </layout>
+     </item>
+    </layout>
+   </widget>
+  </widget>
+  <widget class="QDockWidget" name="volumeWidget">
+   <property name="sizePolicy">
+    <sizepolicy hsizetype="Fixed" vsizetype="Preferred">
+     <horstretch>0</horstretch>
+     <verstretch>0</verstretch>
+    </sizepolicy>
    </property>
-   <property name="shortcut">
-    <string>Del</string>
+   <property name="features">
+    <set>QDockWidget::NoDockWidgetFeatures</set>
    </property>
-  </action>
-  <action name="actionSet_marker_A">
-   <property name="icon">
-    <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/markA.png</normaloff>:/new/prefix1/pics/markA.png</iconset>
+   <property name="allowedAreas">
+    <set>Qt::BottomDockWidgetArea</set>
    </property>
-   <property name="text">
-    <string>Set Marker A</string>
+   <property name="windowTitle">
+    <string>Volume</string>
    </property>
-   <property name="iconText">
-    <string>Set Marker A</string>
+   <attribute name="dockWidgetArea">
+    <number>8</number>
+   </attribute>
+   <widget class="QWidget" name="dockWidgetContents_5">
+    <layout class="QVBoxLayout" name="verticalLayout_4">
+     <property name="topMargin">
+      <number>0</number>
+     </property>
+     <item>
+      <widget class="QToolButton" name="toolButtonAudioToggle">
+       <property name="enabled">
+        <bool>true</bool>
+       </property>
+       <property name="sizePolicy">
+        <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
+         <horstretch>0</horstretch>
+         <verstretch>0</verstretch>
+        </sizepolicy>
+       </property>
+       <property name="minimumSize">
+        <size>
+         <width>0</width>
+         <height>22</height>
+        </size>
+       </property>
+       <property name="text">
+        <string>...</string>
+       </property>
+       <property name="icon">
+        <iconset resource="avidemux.qrc">
+         <normaloff>:/new/prefix1/pics/arts.png</normaloff>:/new/prefix1/pics/arts.png</iconset>
+       </property>
+       <property name="checkable">
+        <bool>true</bool>
+       </property>
+       <property name="checked">
+        <bool>true</bool>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <spacer name="verticalSpacer">
+       <property name="orientation">
+        <enum>Qt::Vertical</enum>
+       </property>
+       <property name="sizeType">
+        <enum>QSizePolicy::MinimumExpanding</enum>
+       </property>
+       <property name="sizeHint" stdset="0">
+        <size>
+         <width>0</width>
+         <height>0</height>
+        </size>
+       </property>
+      </spacer>
+     </item>
+     <item>
+      <widget class="QSlider" name="horizontalSlider_2">
+       <property name="sizePolicy">
+        <sizepolicy hsizetype="Fixed" vsizetype="Minimum">
+         <horstretch>0</horstretch>
+         <verstretch>0</verstretch>
+        </sizepolicy>
+       </property>
+       <property name="minimumSize">
+        <size>
+         <width>0</width>
+         <height>30</height>
+        </size>
+       </property>
+       <property name="maximum">
+        <number>100</number>
+       </property>
+       <property name="value">
+        <number>100</number>
+       </property>
+       <property name="orientation">
+        <enum>Qt::Vertical</enum>
+       </property>
+      </widget>
+     </item>
+    </layout>
+   </widget>
+  </widget>
+  <widget class="QDockWidget" name="audioMetreWidget">
+   <property name="sizePolicy">
+    <sizepolicy hsizetype="Fixed" vsizetype="Preferred">
+     <horstretch>0</horstretch>
+     <verstretch>0</verstretch>
+    </sizepolicy>
    </property>
-   <property name="toolTip">
-    <string>Set Marker A</string>
+   <property name="features">
+    <set>QDockWidget::NoDockWidgetFeatures</set>
    </property>
-   <property name="shortcut">
-    <string>[</string>
+   <property name="allowedAreas">
+    <set>Qt::BottomDockWidgetArea</set>
    </property>
-  </action>
-  <action name="actionSet_marker_B">
+   <property name="windowTitle">
+    <string>Audio Metre</string>
+   </property>
+   <attribute name="dockWidgetArea">
+    <number>8</number>
+   </attribute>
+   <widget class="QWidget" name="dockWidgetContents_3">
+    <property name="sizePolicy">
+     <sizepolicy hsizetype="Fixed" vsizetype="Preferred">
+      <horstretch>0</horstretch>
+      <verstretch>0</verstretch>
+     </sizepolicy>
+    </property>
+    <layout class="QVBoxLayout" name="verticalLayout_5">
+     <property name="spacing">
+      <number>0</number>
+     </property>
+     <item>
+      <widget class="QFrame" name="frameVU">
+       <property name="sizePolicy">
+        <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
+         <horstretch>0</horstretch>
+         <verstretch>0</verstretch>
+        </sizepolicy>
+       </property>
+       <property name="minimumSize">
+        <size>
+         <width>64</width>
+         <height>64</height>
+        </size>
+       </property>
+      </widget>
+     </item>
+    </layout>
+   </widget>
+  </widget>
+  <action name="actionOpen">
    <property name="icon">
     <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/markB.png</normaloff>:/new/prefix1/pics/markB.png</iconset>
+     <normaloff>:/new/prefix1/pics/fileopen.png</normaloff>:/new/prefix1/pics/fileopen.png</iconset>
    </property>
    <property name="text">
-    <string>Set Marker B</string>
+    <string>&amp;Open...</string>
    </property>
-   <property name="iconText">
-    <string>Set Marker B</string>
-   </property>
-   <property name="toolTip">
-    <string>Set Marker B</string>
-   </property>
    <property name="shortcut">
-    <string>]</string>
+    <string>Ctrl+O</string>
    </property>
   </action>
-  <action name="actionPreferences">
-   <property name="text">
-    <string>Pre&amp;ferences...</string>
-   </property>
-  </action>
   <action name="actionProperties">
    <property name="icon">
     <iconset resource="avidemux.qrc">
@@ -1501,28 +1593,6 @@
     <string>Ctrl+S</string>
    </property>
   </action>
-  <action name="actionSave_BMP">
-   <property name="text">
-    <string>Save &amp;BMP Image...</string>
-   </property>
-   <property name="iconText">
-    <string>Save BMP Image</string>
-   </property>
-   <property name="toolTip">
-    <string>Save BMP Image</string>
-   </property>
-  </action>
-  <action name="actionSave_jpeg">
-   <property name="text">
-    <string>Save &amp;JPEG Image...</string>
-   </property>
-   <property name="iconText">
-    <string>Save JPEG Image</string>
-   </property>
-   <property name="toolTip">
-    <string>Save JPEG Image</string>
-   </property>
-  </action>
   <action name="actionLoad_run_project">
    <property name="icon">
     <iconset resource="avidemux.qrc">
@@ -1553,580 +1623,125 @@
     <string>Save Project</string>
    </property>
   </action>
-  <action name="actionSave_project_as">
+  <action name="actionCalculator">
    <property name="icon">
     <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/filesaveas.png</normaloff>:/new/prefix1/pics/filesaveas.png</iconset>
+     <normaloff>:/new/prefix1/pics/calc.png</normaloff>:/new/prefix1/pics/calc.png</iconset>
    </property>
    <property name="text">
-    <string>Save P&amp;roject As...</string>
+    <string>&amp;Calculator...</string>
    </property>
-   <property name="iconText">
-    <string>Save Project As</string>
-   </property>
-   <property name="toolTip">
-    <string>Save Project As</string>
-   </property>
-  </action>
-  <action name="actionMain_toolbar">
-   <property name="text">
-    <string>Main toolbar</string>
-   </property>
-  </action>
-  <action name="actionA_V_toolbar">
-   <property name="text">
-    <string>A/V toolbar</string>
-   </property>
-  </action>
-  <action name="actionZoom_1_4">
-   <property name="checkable">
-    <bool>true</bool>
-   </property>
-   <property name="text">
-    <string>&amp;Zoom 1:4</string>
-   </property>
    <property name="shortcut">
-    <string>Ctrl+Shift+4</string>
+    <string>F7</string>
    </property>
   </action>
-  <action name="actionZoom_1_2">
+  <action name="actionPreviewInput">
    <property name="checkable">
     <bool>true</bool>
    </property>
-   <property name="text">
-    <string>Z&amp;oom 1:2</string>
-   </property>
-   <property name="shortcut">
-    <string>Ctrl+Shift+2</string>
-   </property>
-  </action>
-  <action name="actionZoom_1_1">
-   <property name="checkable">
-    <bool>true</bool>
-   </property>
    <property name="checked">
     <bool>true</bool>
    </property>
-   <property name="text">
-    <string>Zoom &amp;1:1</string>
-   </property>
-   <property name="shortcut">
-    <string>Ctrl+Alt+1</string>
-   </property>
-  </action>
-  <action name="actionZoom_2_1">
-   <property name="checkable">
-    <bool>true</bool>
-   </property>
-   <property name="text">
-    <string>Zoom &amp;2:1</string>
-   </property>
-   <property name="shortcut">
-    <string>Ctrl+Alt+2</string>
-   </property>
-  </action>
-  <action name="actionZoom_4_1">
-   <property name="text">
-    <string>Zoom 4:1</string>
-   </property>
-  </action>
-  <action name="actionDecoder_options">
-   <property name="text">
-    <string>&amp;Decoder Options...</string>
-   </property>
-   <property name="iconText">
-    <string>Decoder Options</string>
-   </property>
-   <property name="toolTip">
-    <string>Decoder Options</string>
-   </property>
-   <property name="shortcut">
-    <string>F3</string>
-   </property>
-  </action>
-  <action name="actionPostprocessing">
-   <property name="text">
-    <string>&amp;Postprocessing...</string>
-   </property>
-   <property name="shortcut">
-    <string>F4</string>
-   </property>
-  </action>
-  <action name="actionFrame_rate">
-   <property name="text">
-    <string>&amp;Frame Rate...</string>
-   </property>
-   <property name="iconText">
-    <string>Frame Rate</string>
-   </property>
-   <property name="toolTip">
-    <string>Frame Rate</string>
-   </property>
-  </action>
-  <action name="actionEncoder">
-   <property name="text">
-    <string>Encoder</string>
-   </property>
-  </action>
-  <action name="actionFilters">
-   <property name="text">
-    <string>Fil&amp;ters...</string>
-   </property>
-   <property name="shortcut">
-    <string>Ctrl+Alt+F</string>
-   </property>
-  </action>
-  <action name="actionMain_Track">
-   <property name="text">
-    <string>&amp;Main Track...</string>
-   </property>
-  </action>
-  <action name="actionSecondary_Track">
-   <property name="text">
-    <string>&amp;Secondary Track...</string>
-   </property>
-  </action>
-  <action name="actionBuild_VBR_time_map">
-   <property name="text">
-    <string>Build VBR Time Map</string>
-   </property>
-   <property name="iconText">
-    <string>Build VBR Time Map</string>
-   </property>
-   <property name="toolTip">
-    <string>Build VBR Time Map</string>
-   </property>
-  </action>
-  <action name="actionSave_2">
-   <property name="text">
-    <string>S&amp;ave...</string>
-   </property>
-   <property name="shortcut">
-    <string>Ctrl+Alt+S</string>
-   </property>
-  </action>
-  <action name="actionEncoder_2">
-   <property name="text">
-    <string>Encoder</string>
-   </property>
-  </action>
-  <action name="actionFilters_2">
-   <property name="text">
-    <string>&amp;Filters</string>
-   </property>
-   <property name="iconText">
-    <string>Filters</string>
-   </property>
-   <property name="toolTip">
-    <string>Filters</string>
-   </property>
-   <property name="shortcut">
-    <string/>
-   </property>
-  </action>
-  <action name="actionCalculator">
    <property name="icon">
     <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/calc.png</normaloff>:/new/prefix1/pics/calc.png</iconset>
+     <normaloff>:/new/prefix1/pics/preview_input.png</normaloff>:/new/prefix1/pics/preview_input.png</iconset>
    </property>
    <property name="text">
-    <string>&amp;Calculator...</string>
+    <string>&amp;Input</string>
    </property>
-   <property name="shortcut">
-    <string>F7</string>
-   </property>
   </action>
-  <action name="actionRebuild_I_B_Frames">
-   <property name="text">
-    <string>&amp;Rebuild I &amp;&amp; B Frames</string>
+  <action name="actionPreviewOutput">
+   <property name="checkable">
+    <bool>true</bool>
    </property>
-   <property name="iconText">
-    <string>Rebuild I &amp; B Frames</string>
-   </property>
-   <property name="toolTip">
-    <string>Rebuild I &amp; B Frames</string>
-   </property>
-  </action>
-  <action name="actionBitrate_histogram">
-   <property name="text">
-    <string>&amp;Bitrate Histogram...</string>
-   </property>
-   <property name="iconText">
-    <string>Bitrate Histogram</string>
-   </property>
-   <property name="toolTip">
-    <string>Bitrate Histogram</string>
-   </property>
-  </action>
-  <action name="actionScan_for_black_frames">
-   <property name="text">
-    <string>&amp;Scan for Black Frames...</string>
-   </property>
-   <property name="iconText">
-    <string>Scan for Black Frames</string>
-   </property>
-   <property name="toolTip">
-    <string>Scan for Black Frames</string>
-   </property>
-  </action>
-  <action name="actionPlay_Stop">
    <property name="icon">
     <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/player_stop.png</normaloff>:/new/prefix1/pics/player_stop.png</iconset>
+     <normaloff>:/new/prefix1/pics/preview_output.png</normaloff>:/new/prefix1/pics/preview_output.png</iconset>
    </property>
    <property name="text">
-    <string>Stop</string>
+    <string>&amp;Output</string>
    </property>
-   <property name="iconText">
-    <string>Stop</string>
-   </property>
-   <property name="toolTip">
-    <string>Stop</string>
-   </property>
-   <property name="shortcut">
-    <string>P</string>
-   </property>
   </action>
-  <action name="actionPrevious_Frame">
-   <property name="icon">
-    <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/back.png</normaloff>:/new/prefix1/pics/back.png</iconset>
+  <action name="actionViewCodecOptions">
+   <property name="checkable">
+    <bool>true</bool>
    </property>
-   <property name="text">
-    <string>P&amp;revious Frame</string>
+   <property name="checked">
+    <bool>true</bool>
    </property>
-   <property name="shortcut">
-    <string>Left</string>
-   </property>
-  </action>
-  <action name="actionNext_Frame">
-   <property name="icon">
-    <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/forward.png</normaloff>:/new/prefix1/pics/forward.png</iconset>
-   </property>
    <property name="text">
-    <string>&amp;Next Frame</string>
+    <string>&amp;Codec Options</string>
    </property>
    <property name="shortcut">
-    <string>Right</string>
+    <string>Ctrl+Alt+C</string>
    </property>
   </action>
-  <action name="actionPrevious_intra_frame">
-   <property name="icon">
-    <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/player_rew.png</normaloff>:/new/prefix1/pics/player_rew.png</iconset>
+  <action name="actionViewNavigation">
+   <property name="checkable">
+    <bool>true</bool>
    </property>
-   <property name="text">
-    <string>Pr&amp;evious Intra Frame</string>
+   <property name="checked">
+    <bool>true</bool>
    </property>
-   <property name="iconText">
-    <string>Previous Intra Frame</string>
-   </property>
-   <property name="toolTip">
-    <string>Previous Intra Frame</string>
-   </property>
-   <property name="shortcut">
-    <string>Down</string>
-   </property>
-  </action>
-  <action name="actionNext_intra_frame">
-   <property name="icon">
-    <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/player_fwd.png</normaloff>:/new/prefix1/pics/player_fwd.png</iconset>
-   </property>
    <property name="text">
-    <string>Next &amp;Intra Frame</string>
+    <string>&amp;Navigation</string>
    </property>
-   <property name="iconText">
-    <string>Next Intra Frame</string>
-   </property>
-   <property name="toolTip">
-    <string>Next Intra Frame</string>
-   </property>
    <property name="shortcut">
-    <string>Up</string>
+    <string>Ctrl+Alt+N</string>
    </property>
   </action>
-  <action name="actionPrevious_black_frame">
-   <property name="icon">
-    <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/prev_black.png</normaloff>:/new/prefix1/pics/prev_black.png</iconset>
+  <action name="actionViewSelection">
+   <property name="checkable">
+    <bool>true</bool>
    </property>
-   <property name="text">
-    <string>Previou&amp;s Black Frame</string>
+   <property name="checked">
+    <bool>true</bool>
    </property>
-   <property name="iconText">
-    <string>Previous Black Frame</string>
-   </property>
-   <property name="toolTip">
-    <string>Previous Black Frame</string>
-   </property>
-  </action>
-  <action name="actionNext_blak_frame">
-   <property name="icon">
-    <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/next_black.png</normaloff>:/new/prefix1/pics/next_black.png</iconset>
-   </property>
    <property name="text">
-    <string>Ne&amp;xt Black Frame</string>
+    <string>&amp;Selection</string>
    </property>
-   <property name="iconText">
-    <string>Next Black Frame</string>
-   </property>
-   <property name="toolTip">
-    <string>Next Black Frame</string>
-   </property>
-  </action>
-  <action name="actionFirst_Frame">
-   <property name="icon">
-    <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/player_start.png</normaloff>:/new/prefix1/pics/player_start.png</iconset>
-   </property>
-   <property name="text">
-    <string>&amp;First Frame</string>
-   </property>
    <property name="shortcut">
-    <string>Home</string>
+    <string>Ctrl+Alt+S</string>
    </property>
   </action>
-  <action name="actionLast_Frame">
-   <property name="icon">
-    <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/player_end.png</normaloff>:/new/prefix1/pics/player_end.png</iconset>
+  <action name="actionViewVolume">
+   <property name="checkable">
+    <bool>true</bool>
    </property>
-   <property name="text">
-    <string>&amp;Last Frame</string>
+   <property name="checked">
+    <bool>true</bool>
    </property>
-   <property name="shortcut">
-    <string>End</string>
-   </property>
-  </action>
-  <action name="actionGo_to_Marker_A">
-   <property name="icon">
-    <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/gotoA.png</normaloff>:/new/prefix1/pics/gotoA.png</iconset>
-   </property>
    <property name="text">
-    <string>Jump to Marker &amp;A</string>
+    <string>&amp;Volume</string>
    </property>
-   <property name="iconText">
-    <string>Jump to Marker A</string>
-   </property>
-   <property name="toolTip">
-    <string>Jump to Marker A</string>
-   </property>
    <property name="shortcut">
-    <string>Ctrl+[</string>
+    <string>Ctrl+Alt+V</string>
    </property>
   </action>
-  <action name="actionGo_to_Marker_B">
-   <property name="icon">
-    <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/gotoB.png</normaloff>:/new/prefix1/pics/gotoB.png</iconset>
-   </property>
-   <property name="text">
-    <string>Jump to Marker &amp;B</string>
-   </property>
-   <property name="iconText">
-    <string>Jump to Marker B</string>
-   </property>
-   <property name="toolTip">
-    <string>Jump to Marker B</string>
-   </property>
-   <property name="shortcut">
-    <string>Ctrl+]</string>
-   </property>
-  </action>
-  <action name="actionJump_to_Frame">
-   <property name="text">
-    <string>Jump to Fra&amp;me...</string>
-   </property>
-   <property name="shortcut">
-    <string>Ctrl+F</string>
-   </property>
-  </action>
-  <action name="actionJump_to_Time">
-   <property name="text">
-    <string>Jump to &amp;Time...</string>
-   </property>
-   <property name="shortcut">
-    <string>Ctrl+T</string>
-   </property>
-  </action>
-  <action name="actionShow_built_in_support">
-   <property name="text">
-    <string>&amp;Built-in Support...</string>
-   </property>
-   <property name="iconText">
-    <string>Built-in Support</string>
-   </property>
-   <property name="toolTip">
-    <string>Built-in Support</string>
-   </property>
-  </action>
-  <action name="actionAbout_avidemux">
-   <property name="text">
-    <string>&amp;About Avidemux...</string>
-   </property>
-   <property name="iconText">
-    <string>About Avidemux</string>
-   </property>
-   <property name="toolTip">
-    <string>About Avidemux</string>
-   </property>
-  </action>
-  <action name="actionPlay">
-   <property name="icon">
-    <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/player_play.png</normaloff>:/new/prefix1/pics/player_play.png</iconset>
-   </property>
-   <property name="text">
-    <string>&amp;Play/Stop</string>
-   </property>
-   <property name="iconText">
-    <string>Play/Stop</string>
-   </property>
-   <property name="toolTip">
-    <string>Play/Stop</string>
-   </property>
-   <property name="shortcut">
-    <string>P</string>
-   </property>
-  </action>
-  <action name="actionRecent0">
-   <property name="text">
-    <string>Recent0</string>
-   </property>
-  </action>
-  <action name="actionRecent1">
-   <property name="text">
-    <string>Recent1</string>
-   </property>
-  </action>
-  <action name="actionRecent2">
-   <property name="text">
-    <string>Recent2</string>
-   </property>
-  </action>
-  <action name="actionRecent3">
-   <property name="text">
-    <string>Recent3</string>
-   </property>
-  </action>
-  <action name="actionVCD">
-   <property name="text">
-    <string>&amp;VCD</string>
-   </property>
-  </action>
-  <action name="actionSVCD">
-   <property name="text">
-    <string>&amp;SVCD</string>
-   </property>
-  </action>
-  <action name="actionDVD">
-   <property name="text">
-    <string>&amp;DVD</string>
-   </property>
-  </action>
-  <action name="actionPSP">
-   <property name="text">
-    <string>&amp;PSP</string>
-   </property>
-  </action>
-  <action name="actionPSP_H264">
-   <property name="text">
-    <string>PSP (&amp;H.264)</string>
-   </property>
-   <property name="iconText">
-    <string>PSP (H.264)</string>
-   </property>
-   <property name="toolTip">
-    <string>PSP (H.264)</string>
-   </property>
-  </action>
-  <action name="actionAdd_to_joblist">
-   <property name="text">
-    <string>Add to &amp;Joblist...</string>
-   </property>
-   <property name="iconText">
-    <string>Add to Joblist</string>
-   </property>
-   <property name="toolTip">
-    <string>Add to Joblist</string>
-   </property>
-  </action>
-  <action name="actionShow_Joblist">
-   <property name="text">
-    <string>View &amp;Joblist...</string>
-   </property>
-   <property name="iconText">
-    <string>View Joblist</string>
-   </property>
-   <property name="toolTip">
-    <string>View Joblist</string>
-   </property>
-   <property name="shortcut">
-    <string>Ctrl+J</string>
-   </property>
-  </action>
-  <action name="actionConnect_to_AvsProxy">
-   <property name="text">
-    <string>Co&amp;nnect to avsproxy</string>
-   </property>
-   <property name="iconText">
-    <string>Connect to avsproxy</string>
-   </property>
-   <property name="toolTip">
-    <string>Connect to avsproxy</string>
-   </property>
-  </action>
-  <action name="actionReset_Edits">
-   <property name="text">
-    <string>&amp;Reset Edits</string>
-   </property>
-  </action>
-  <action name="actionSave">
-   <property name="text">
-    <string>Save</string>
-   </property>
-  </action>
-  <action name="actionPreviewInput">
+  <action name="actionViewAudioMetre">
    <property name="checkable">
     <bool>true</bool>
    </property>
    <property name="checked">
     <bool>true</bool>
    </property>
-   <property name="icon">
-    <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/preview_input.png</normaloff>:/new/prefix1/pics/preview_input.png</iconset>
-   </property>
    <property name="text">
-    <string>&amp;Input</string>
+    <string>&amp;Audio Metre</string>
    </property>
-  </action>
-  <action name="actionPreviewOutput">
-   <property name="checkable">
-    <bool>true</bool>
+   <property name="shortcut">
+    <string>Ctrl+Alt+M</string>
    </property>
-   <property name="icon">
-    <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/preview_output.png</normaloff>:/new/prefix1/pics/preview_output.png</iconset>
-   </property>
-   <property name="text">
-    <string>&amp;Output</string>
-   </property>
   </action>
-  <action name="actionPreviewSide">
+  <action name="actionPreviewSeparate">
    <property name="checkable">
     <bool>true</bool>
    </property>
    <property name="icon">
     <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/preview_side.png</normaloff>:/new/prefix1/pics/preview_side.png</iconset>
+     <normaloff>:/new/prefix1/pics/preview_separate.png</normaloff>:/new/prefix1/pics/preview_separate.png</iconset>
    </property>
    <property name="text">
-    <string>Si&amp;de</string>
+    <string>&amp;Separate</string>
    </property>
   </action>
   <action name="actionPreviewTop">
@@ -2141,131 +1756,18 @@
     <string>&amp;Top</string>
    </property>
   </action>
-  <action name="actionPreviewSeparate">
+  <action name="actionPreviewSide">
    <property name="checkable">
     <bool>true</bool>
    </property>
    <property name="icon">
     <iconset resource="avidemux.qrc">
-     <normaloff>:/new/prefix1/pics/preview_separate.png</normaloff>:/new/prefix1/pics/preview_separate.png</iconset>
+     <normaloff>:/new/prefix1/pics/preview_side.png</normaloff>:/new/prefix1/pics/preview_side.png</iconset>
    </property>
    <property name="text">
-    <string>&amp;Separate</string>
-   </property>
-  </action>
-  <action name="action_Input">
-   <property name="text">
-    <string>&amp;Input</string>
-   </property>
-  </action>
-  <action name="action_Output">
-   <property name="text">
-    <string>&amp;Output</string>
-   </property>
-  </action>
-  <action name="actionSi_de">
-   <property name="text">
     <string>Si&amp;de</string>
    </property>
   </action>
-  <action name="action_Top">
-   <property name="text">
-    <string>&amp;Top</string>
-   </property>
-  </action>
-  <action name="action_Separate">
-   <property name="text">
-    <string>&amp;Separate</string>
-   </property>
-  </action>
-  <action name="actionFLV">
-   <property name="text">
-    <string>FLV</string>
-   </property>
-  </action>
-  <action name="actionIPOD">
-   <property name="text">
-    <string>IPOD (mpeg4)</string>
-   </property>
-  </action>
-  <action name="actionClose">
-   <property name="text">
-    <string>&amp;Close</string>
-   </property>
-   <property name="shortcut">
-    <string>Ctrl+W</string>
-   </property>
-  </action>
-  <action name="actionPlugins">
-   <property name="text">
-    <string>Plugins</string>
-   </property>
-  </action>
-  <action name="actionJavaScript_shell">
-   <property name="text">
-    <string>JavaScript shell</string>
-   </property>
-  </action>
-  <action name="action1_1">
-   <property name="text">
-    <string>1:1</string>
-   </property>
-  </action>
-  <action name="actionAR_Auto">
-   <property name="checkable">
-    <bool>true</bool>
-   </property>
-   <property name="text">
-    <string>Auto</string>
-   </property>
-  </action>
-  <action name="actionAR_1_1">
-   <property name="checkable">
-    <bool>true</bool>
-   </property>
-   <property name="checked">
-    <bool>true</bool>
-   </property>
-   <property name="text">
-    <string>1:1</string>
-   </property>
-  </action>
-  <action name="actionAR_4_3">
-   <property name="checkable">
-    <bool>true</bool>
-   </property>
-   <property name="text">
-    <string>4:3</string>
-   </property>
-  </action>
-  <action name="actionAR_16_9">
-   <property name="checkable">
-    <bool>true</bool>
-   </property>
-   <property name="text">
-    <string>16:9</string>
-   </property>
-  </action>
-  <action name="actionSave_pyScript">
-   <property name="text">
-    <string>Save Project as pyScript</string>
-   </property>
-  </action>
-  <action name="actionPython_Shell">
-   <property name="text">
-    <string>Python Shell</string>
-   </property>
-  </action>
-  <action name="actionSave_python_project_as">
-   <property name="text">
-    <string>Save python project as..</string>
-   </property>
-  </action>
-  <action name="actionLoad_run_pyProject">
-   <property name="text">
-    <string>Load/run pyProject</string>
-   </property>
-  </action>
  </widget>
  <customwidgets>
   <customwidget>
@@ -2274,8 +1776,121 @@
    <header>ADM_qslider.h</header>
   </customwidget>
  </customwidgets>
+ <tabstops>
+  <tabstop>pushButtonDecoderConf</tabstop>
+  <tabstop>comboBoxVideo</tabstop>
+  <tabstop>pushButtonVideoConf</tabstop>
+  <tabstop>pushButtonVideoFilter</tabstop>
+  <tabstop>comboBoxAudio</tabstop>
+  <tabstop>pushButtonAudioConf</tabstop>
+  <tabstop>pushButtonAudioFilter</tabstop>
+  <tabstop>checkBox_TimeShift</tabstop>
+  <tabstop>spinBox_TimeValue</tabstop>
+  <tabstop>comboBoxFormat</tabstop>
+  <tabstop>pushButtonFormatConfigure</tabstop>
+  <tabstop>horizontalSlider</tabstop>
+  <tabstop>toolButtonPlay</tabstop>
+  <tabstop>toolButtonStop</tabstop>
+  <tabstop>toolButtonPreviousFrame</tabstop>
+  <tabstop>toolButtonNextFrame</tabstop>
+  <tabstop>toolButtonPreviousIntraFrame</tabstop>
+  <tabstop>toolButtonNextIntraFrame</tabstop>
+  <tabstop>toolButtonSetMarkerA</tabstop>
+  <tabstop>toolButtonSetMarkerB</tabstop>
+  <tabstop>toolButtonPreviousBlackFrame</tabstop>
+  <tabstop>toolButtonNextBlackFrame</tabstop>
+  <tabstop>toolButtonFirstFrame</tabstop>
+  <tabstop>toolButtonLastFrame</tabstop>
+  <tabstop>pushButtonTime</tabstop>
+  <tabstop>currentTime</tabstop>
+  <tabstop>pushButtonJumpToMarkerA</tabstop>
+  <tabstop>pushButtonJumpToMarkerB</tabstop>
+  <tabstop>toolButtonAudioToggle</tabstop>
+  <tabstop>horizontalSlider_2</tabstop>
+ </tabstops>
  <resources>
   <include location="avidemux.qrc"/>
  </resources>
- <connections/>
+ <connections>
+  <connection>
+   <sender>actionViewAudioMetre</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>audioMetreWidget</receiver>
+   <slot>setVisible(bool)</slot>
+   <hints>
+    <hint type="sourcelabel">
+     <x>-1</x>
+     <y>-1</y>
+    </hint>
+    <hint type="destinationlabel">
+     <x>672</x>
+     <y>569</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>actionViewCodecOptions</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>codecWidget</receiver>
+   <slot>setVisible(bool)</slot>
+   <hints>
+    <hint type="sourcelabel">
+     <x>-1</x>
+     <y>-1</y>
+    </hint>
+    <hint type="destinationlabel">
+     <x>79</x>
+     <y>274</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>actionViewNavigation</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>navigationWidget</receiver>
+   <slot>setVisible(bool)</slot>
+   <hints>
+    <hint type="sourcelabel">
+     <x>-1</x>
+     <y>-1</y>
+    </hint>
+    <hint type="destinationlabel">
+     <x>220</x>
+     <y>569</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>actionViewSelection</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>selectionWidget</receiver>
+   <slot>setVisible(bool)</slot>
+   <hints>
+    <hint type="sourcelabel">
+     <x>-1</x>
+     <y>-1</y>
+    </hint>
+    <hint type="destinationlabel">
+     <x>509</x>
+     <y>569</y>
+    </hint>
+   </hints>
+  </connection>
+  <connection>
+   <sender>actionViewVolume</sender>
+   <signal>toggled(bool)</signal>
+   <receiver>volumeWidget</receiver>
+   <slot>setVisible(bool)</slot>
+   <hints>
+    <hint type="sourcelabel">
+     <x>-1</x>
+     <y>-1</y>
+    </hint>
+    <hint type="destinationlabel">
+     <x>601</x>
+     <y>569</y>
+    </hint>
+   </hints>
+  </connection>
+ </connections>
 </ui>



From gruntster at mail.berlios.de  Sat Dec 25 14:34:03 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sat, 25 Dec 2010 14:34:03 +0100
Subject: [Avidemux-svn-commit] r6863 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101225133403.AA1D44802F2@sheep.berlios.de>

Author: gruntster
Date: 2010-12-25 14:34:03 +0100 (Sat, 25 Dec 2010)
New Revision: 6863

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admCheckMiscLibs.cmake
Log:
[cmake] stop execinfo detection if header isn't found

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckMiscLibs.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckMiscLibs.cmake	2010-12-24 22:43:39 UTC (rev 6862)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckMiscLibs.cmake	2010-12-25 13:34:03 UTC (rev 6863)
@@ -2,10 +2,11 @@
 # gettext
 ########################################
 INCLUDE(admCheckGettext)
-if(NOT CROSS)
-checkGettext()
-endif(NOT CROSS)
 
+if (NOT CROSS)
+	checkGettext()
+endif (NOT CROSS)
+
 SET(ADM_LOCALE "${CMAKE_INSTALL_PREFIX}/share/locale")
 
 ########################################
@@ -19,7 +20,7 @@
 IF (SDL)
 	FIND_PACKAGE(SDL)
 	PRINT_LIBRARY_INFO("SDL" SDL_FOUND "${SDL_INCLUDE_DIR}" "${SDL_LIBRARY}")
-	
+
 	MARK_AS_ADVANCED(SDLMAIN_LIBRARY)
 	MARK_AS_ADVANCED(SDL_INCLUDE_DIR)
 	MARK_AS_ADVANCED(SDL_LIBRARY)
@@ -72,6 +73,7 @@
 ENDIF (USE_SYSTEM_SPIDERMONKEY)
 
 MESSAGE("")
+
 ########################################
 # Execinfo
 ########################################
@@ -81,32 +83,32 @@
 FIND_PATH(LIBEXECINFO_H_DIR execinfo.h $ENV{CXXFLAGS})
 MESSAGE(STATUS "libexecinfo Header Path: ${LIBEXECINFO_H_DIR}")
 
-IF (NOT LIBEXECINFO_H_DIR STREQUAL "LIBEXECINFO_H-NOTFOUND")
-        FIND_LIBRARY(LIBEXECINFO_LIB_DIR execinfo $ENV{CXXFLAGS})
-        MESSAGE(STATUS "libexecinfo Library Path: ${LIBEXECINFO_LIB_DIR}")
+IF (LIBEXECINFO_H_DIR)
+	FIND_LIBRARY(LIBEXECINFO_LIB_DIR execinfo $ENV{CXXFLAGS})
+	MESSAGE(STATUS "libexecinfo Library Path: ${LIBEXECINFO_LIB_DIR}")
 
-        # Try linking without -lexecinfo
-        ADM_COMPILE(execinfo.cpp "" ${LIBEXECINFO_H_DIR} "" WITHOUT_LIBEXECINFO outputWithoutLibexecinfo)
+	# Try linking without -lexecinfo
+	ADM_COMPILE(execinfo.cpp "" ${LIBEXECINFO_H_DIR} "" WITHOUT_LIBEXECINFO outputWithoutLibexecinfo)
 
-        IF (WITHOUT_LIBEXECINFO)
-               SET(HAVE_EXECINFO 1)
-               MESSAGE(STATUS "OK, No lib needed (${ADM_EXECINFO_LIB})")
-        ELSE (WITHOUT_LIBEXECINFO)
-               ADM_COMPILE(execinfo.cpp "" ${LIBEXECINFO_H_DIR} ${LIBEXECINFO_LIB_DIR} WITH_LIBEXECINFO outputWithLibexecinfo)
+	IF (WITHOUT_LIBEXECINFO)
+		SET(HAVE_EXECINFO 1)
+		MESSAGE(STATUS "OK, No lib needed (${ADM_EXECINFO_LIB})")
+	ELSE (WITHOUT_LIBEXECINFO)
+		ADM_COMPILE(execinfo.cpp "" ${LIBEXECINFO_H_DIR} ${LIBEXECINFO_LIB_DIR} WITH_LIBEXECINFO outputWithLibexecinfo)
 
-               IF (WITH_LIBEXECINFO)
-                           SET(HAVE_EXECINFO 1)
-                            MESSAGE(STATUS "OK, libexecinfo needed")
-               ELSE (WITH_LIBEXECINFO)
-                            MESSAGE(STATUS "Does not work, without ${outputWithoutLibexecinfo}")
-                            MESSAGE(STATUS "Does not work, with ${outputWithLibexecinfo}")
-                        ENDIF (WITH_LIBEXECINFO)
-                ENDIF (WITHOUT_LIBEXECINFO)
-        ENDIF (NOT LIBEXECINFO_H_DIR STREQUAL "LIBEXECINFO_H-NOTFOUND")
+		IF (WITH_LIBEXECINFO)
+			SET(HAVE_EXECINFO 1)
+			MESSAGE(STATUS "OK, libexecinfo needed")
+		ELSE (WITH_LIBEXECINFO)
+			MESSAGE(STATUS "Does not work, without ${outputWithoutLibexecinfo}")
+			MESSAGE(STATUS "Does not work, with ${outputWithLibexecinfo}")
+		ENDIF (WITH_LIBEXECINFO)
+	ENDIF (WITHOUT_LIBEXECINFO)
+ENDIF (LIBEXECINFO_H_DIR)
 
-        IF (HAVE_EXECINFO)
-                SET(CMAKE_CLINK_FLAGS "${CFLAGS} -lexecinfo")
-                SET(CMAKE_CXX_LINK_FLAGS "${CXXFLAGS} -lexecinfo")
-        ENDIF(HAVE_EXECINFO)
+IF (HAVE_EXECINFO)
+	SET(CMAKE_CLINK_FLAGS "${CFLAGS} -lexecinfo")
+	SET(CMAKE_CXX_LINK_FLAGS "${CXXFLAGS} -lexecinfo")
+ENDIF(HAVE_EXECINFO)
 
 MESSAGE("")



From gruntster at mail.berlios.de  Sun Dec 26 11:39:42 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 26 Dec 2010 11:39:42 +0100
Subject: [Avidemux-svn-commit] r6864 - in branches/avidemux_2.6_branch_mean:
	avidemux_core/ADM_core/src cmake
Message-ID: <20101226103942.4FD48480580@sheep.berlios.de>

Author: gruntster
Date: 2010-12-26 11:39:41 +0100 (Sun, 26 Dec 2010)
New Revision: 6864

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/cmake/admCheckMiscLibs.cmake
Log:
[cmake] explicitly use the execinfo include and lib dir if found and only when required

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt	2010-12-25 13:34:03 UTC (rev 6863)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
@@ -16,6 +16,11 @@
 	ADD_TARGET_LDFLAGS(ADM_core6 "-framework Carbon")
 ENDIF (MINGW)
 
+if (HAVE_EXECINFO)
+	include_directories("${LIBEXECINFO_INCLUDE_DIR}")
+	target_link_libraries(ADM_core6 "${LIBEXECINFO_LIBRARY_DIR}")
+endif (HAVE_EXECINFO)
+
 REMOVE_DEFINITIONS(-DHAVE_CONFIG_H)
 
 # pthreads

Modified: branches/avidemux_2.6_branch_mean/cmake/admCheckMiscLibs.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCheckMiscLibs.cmake	2010-12-25 13:34:03 UTC (rev 6863)
+++ branches/avidemux_2.6_branch_mean/cmake/admCheckMiscLibs.cmake	2010-12-26 10:39:41 UTC (rev 6864)
@@ -80,35 +80,30 @@
 MESSAGE(STATUS "Checking for execinfo")
 MESSAGE(STATUS "*********************")
 
-FIND_PATH(LIBEXECINFO_H_DIR execinfo.h $ENV{CXXFLAGS})
-MESSAGE(STATUS "libexecinfo Header Path: ${LIBEXECINFO_H_DIR}")
+FIND_HEADER_AND_LIB(execinfo execinfo.h execinfo backtrace_symbols)
+PRINT_LIBRARY_INFO("execinfo" EXECINFO_FOUND "${LIBEXECINFO_INCLUDE_DIR}" "${LIBEXECINFO_LIBRARY_DIR}")
 
-IF (LIBEXECINFO_H_DIR)
-	FIND_LIBRARY(LIBEXECINFO_LIB_DIR execinfo $ENV{CXXFLAGS})
-	MESSAGE(STATUS "libexecinfo Library Path: ${LIBEXECINFO_LIB_DIR}")
-
+IF (LIBEXECINFO_INCLUDE_DIR)
 	# Try linking without -lexecinfo
-	ADM_COMPILE(execinfo.cpp "" ${LIBEXECINFO_H_DIR} "" WITHOUT_LIBEXECINFO outputWithoutLibexecinfo)
+	ADM_COMPILE(execinfo.cpp "" ${LIBEXECINFO_INCLUDE_DIR} "" WITHOUT_LIBEXECINFO outputWithoutLibexecinfo)
 
 	IF (WITHOUT_LIBEXECINFO)
+		SET(LIBEXECINFO_LIBRARY_DIR "")
 		SET(HAVE_EXECINFO 1)
-		MESSAGE(STATUS "OK, No lib needed (${ADM_EXECINFO_LIB})")
+
+		MESSAGE(STATUS "execinfo not required")
 	ELSE (WITHOUT_LIBEXECINFO)
-		ADM_COMPILE(execinfo.cpp "" ${LIBEXECINFO_H_DIR} ${LIBEXECINFO_LIB_DIR} WITH_LIBEXECINFO outputWithLibexecinfo)
+		ADM_COMPILE(execinfo.cpp "" ${LIBEXECINFO_INCLUDE_DIR} ${LIBEXECINFO_LIBRARY_DIR} WITH_LIBEXECINFO outputWithLibexecinfo)
 
 		IF (WITH_LIBEXECINFO)
 			SET(HAVE_EXECINFO 1)
-			MESSAGE(STATUS "OK, libexecinfo needed")
+
+			MESSAGE(STATUS "execinfo is required")
 		ELSE (WITH_LIBEXECINFO)
 			MESSAGE(STATUS "Does not work, without ${outputWithoutLibexecinfo}")
 			MESSAGE(STATUS "Does not work, with ${outputWithLibexecinfo}")
 		ENDIF (WITH_LIBEXECINFO)
 	ENDIF (WITHOUT_LIBEXECINFO)
-ENDIF (LIBEXECINFO_H_DIR)
+ENDIF (LIBEXECINFO_INCLUDE_DIR)
 
-IF (HAVE_EXECINFO)
-	SET(CMAKE_CLINK_FLAGS "${CFLAGS} -lexecinfo")
-	SET(CMAKE_CXX_LINK_FLAGS "${CXXFLAGS} -lexecinfo")
-ENDIF(HAVE_EXECINFO)
-
-MESSAGE("")
+MESSAGE("")
\ No newline at end of file



From gruntster at mail.berlios.de  Mon Dec 27 20:46:52 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 27 Dec 2010 20:46:52 +0100
Subject: [Avidemux-svn-commit] r6865 - in branches/avidemux_2.6_branch_mean:
 avidemux avidemux/cli avidemux/cli/ADM_userInterfaces/ADM_dialog
 avidemux/common/ADM_editor avidemux/common/ADM_videoCodec/src avidemux/gtk
 avidemux/gtk/ADM_userInterfaces/ADM_gui2 avidemux/qt4 avidemux_core
 avidemux_core/ADM_core/include avidemux_core/ADM_core/src
 avidemux_core/ADM_coreAudioParser/src avidemux_core/ADM_coreImage/src
 avidemux_core/ADM_coreMuxer/include avidemux_core/ADM_coreMuxer/src
 avidemux_core/ADM_coreUtils/include avidemux_core/ADM_coreUtils/src
 avidemux_core/ADM_coreVideoCodec/include
 avidemux_core/ADM_coreVideoCodec/src
 avidemux_core/ADM_coreVideoEncoder/include
 avidemux_core/ADM_coreVideoEncoder/src
 avidemux_core/ADM_coreVideoFilter/src avidemux_plugins
 avidemux_plugins/ADM_audioDecoders/ADM_ad_ima_adpcm
 avidemux_plugins/ADM_audioDecoders/ADM_ad_lav
 avidemux_plugins/ADM_audioDecoders/ADM_ad_ms_adpcm
 avidemux_plugins/ADM_audioEncoders/lavcodec
 avidemux_plugins/ADM_demuxers/Asf avidemux_plugins/ADM_ demuxers/Flv
 avidemux_plugins/ADM_demuxers/Matroska avidemux_plugins/ADM_demuxers/MpegTS
 avidemux_plugins/ADM_muxers/muxerDummy avidemux_plugins/ADM_muxers/muxerFlv
 avidemux_plugins/ADM_muxers/muxerMkv avidemux_plugins/ADM_muxers/muxerMp4
 avidemux_plugins/ADM_muxers/muxerffPS avidemux_plugins/ADM_muxers/muxerffTS
 avidemux_plugins/ADM_videoEncoder/ffFlv1
 avidemux_plugins/ADM_videoEncoder/ffMpeg2
 avidemux_plugins/ADM_videoEncoder/ffMpeg4
 avidemux_plugins/ADM_videoEncoder/ffMsMpeg4
 avidemux_plugins/ADM_videoEncoder/huff
 avidemux_plugins/ADM_videoEncoder/jpeg
 avidemux_plugins/ADM_videoFilters/Equalizer/gtk
 avidemux_plugins/ADM_videoFilters/ForcedPP
 avidemux_plugins/ADM_videoFilters/MPDelogo
 avidemux_plugins/ADM_videoFilters/MPDelogo/gtk
 avidemux_plugins/ADM_videoFilters/McDeint
 avidemux_plugins/ADM_videoFilters/Mosaic
 avidemux_plugins/ADM_videoFilters6/lavDeint
 avidemux_plugins/ADM_videoFilters6/resize cmake cmake/patches
 myOwnPlugins/demuxer
Message-ID: <20101227194652.A87AE480587@sheep.berlios.de>

Author: gruntster
Date: 2010-12-27 20:46:51 +0100 (Mon, 27 Dec 2010)
New Revision: 6865

Added:
   branches/avidemux_2.6_branch_mean/cmake/FindPatch.cmake
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegClean.cmake
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegMake.cmake
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareSvn.cmake
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareTar.cmake
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegUtil.cmake
   branches/avidemux_2.6_branch_mean/cmake/patches/
   branches/avidemux_2.6_branch_mean/cmake/patches/common.mak.diff
   branches/avidemux_2.6_branch_mean/cmake/patches/config.mak.diff
   branches/avidemux_2.6_branch_mean/cmake/patches/config_macosx.mak.diff
   branches/avidemux_2.6_branch_mean/cmake/patches/createPatches.sh
   branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_avcodec.h.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_ff_spsinfo.h.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_ffv1.c.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h263dec.c.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h264.c.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h264_parser.c.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_mpeg12.c.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_mpeg12enc.c.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_mpegvideo.c.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_mpegvideo_enc.c.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_utils.c.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_vc1dec.c.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavformat_file.c.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavformat_isom.c.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavformat_matroskaenc.c.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavutil_avutil.h.patch
Removed:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_includeFfmpeg.h
   branches/avidemux_2.6_branch_mean/cmake/FindYasm.cmake
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRenderInternal.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_videoCodec.cpp
   branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake
   branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_gui2/GUI_gtkRender.cpp
   branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_inttype.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_cpuCap.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_memcpy.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/ADM_eac3info.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageResizer.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageSave.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageUtils.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_pp.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/include/ADM_coreMuxerFfmpeg.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/ADM_coreMuxerFfmpeg.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/ADM_dynaMuxer.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/include/ADM_coreCodecMapping.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_coreCodecMapping.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_getbits.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_infoExtractorH264.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_paramList.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_codecFFsimple.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_ffmp43.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/ADM_codecSearch.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/ADM_ffmp43.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/include/ADM_coreVideoEncoderFFmpeg_param.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/ADM_coreVideoEncoder.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ima_adpcm/ADM_ad_ima_adpcm.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_lav/ADM_ad_lav.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_lav/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ms_adpcm/ADM_ad_ms_adpcm.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/lavcodec/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Asf/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Flv/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerDummy/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerFlv/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerFlv/muxerFlv.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerFlv/muxerFlvConfig.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerFlv/muxerFlvPlugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMkv/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMkv/muxerMkv.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMkv/muxerMkvConfig.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMkv/muxerMkvPlugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4/muxerMP4.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4/muxerMP4Config.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4/muxerMP4Plugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffPS/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffPS/muxerffPS.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffPS/muxerffPSConfig.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffPS/muxerffPSPlugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTS.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTSConfig.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTSPlugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffFlv1/ADM_ffFlv1.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffFlv1/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffFlv1/ffFlv1Plugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg2/ADM_ffMpeg2.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg2/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg2/ffMpeg2Plugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg4/ADM_ffMpeg4.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg4/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg4/ffMpeg4Plugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMsMpeg4/ADM_ffMsMp4.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMsMpeg4/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMsMpeg4/ffMsMp4Plugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/ADM_huffEncoder.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/huffPlugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/jpeg/ADM_jpegEncoder.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/jpeg/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/jpeg/jpegPlugin.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Equalizer/gtk/DIA_equalizer.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ForcedPP/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/MPDelogo/ADM_vidMPdelogo.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/MPDelogo/gtk/DIA_mpdelogo.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/McDeint/ADM_vidMcDeint.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Mosaic/ADM_vidMosaic.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/lavDeint/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/lavDeint/lavDeint.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/resize/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/resize/swScaleResize.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake
   branches/avidemux_2.6_branch_mean/cmake/admConfigSummary.cmake
   branches/avidemux_2.6_branch_mean/cmake/admCoreIncludes.cmake
   branches/avidemux_2.6_branch_mean/myOwnPlugins/demuxer/CMakeLists.txt
Log:
[ffmpeg] port FFmpeg build scripts from 2.5 branch

Modified: branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ADM_dialog/DIA_none.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux/cli/ADM_userInterfaces/ADM_dialog/DIA_none.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -13,7 +13,6 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
 #include "config.h"
 
 #include <string.h>
@@ -21,14 +20,9 @@
 #include <stdlib.h>
 
 #include "ADM_default.h"
-
-#include "ADM_assert.h"
 #include "audioencoder.h"
-#include "ADM_lavcodec.h"
 #include "ADM_render/GUI_render.cpp"
-//#include "ADM_codecs/ADM_ffmpegConfig.h"
 
-//#include "ADM_userInterfaces/ADM_render/GUI_renderInternal.h"
 extern int global_argc;
 extern char **global_argv;
 extern void initTranslator(void);
@@ -36,19 +30,6 @@
 
 int SliderIsShifted = 0;
 
-
-
-
-#ifdef USE_XX_XVID 
-#include "xvid.h"
-int  DIA_getXvidCompressParams(COMPRESSION_MODE * mode, uint32_t * qz,
-		      uint32_t * br,uint32_t *fsize,xvidEncParam *param) {return 0;}
-#endif
-
-
-
-
-
 //uint8_t DIA_getPartial(PARTIAL_CONFIG *param,AVDMGenericVideoStream *son,AVDMGenericVideoStream *previous) {return 0;}
 uint8_t DIA_pipe(char **cmd,char **param) {return 0;}
 //uint8_t DIA_vobsub(vobSubParam *param) {return 0;}
@@ -120,11 +101,11 @@
 	printf("End of program..\n");
 	printf("*********************************\n");
 	printf("*********************************\n");
-}
-bool UI_End(void)
-{
-    return true;
 }
-bool UI_setDecoderName(const char *name) {return true;}
+bool UI_End(void)
+{
+    return true;
+}
+bool UI_setDecoderName(const char *name) {return true;}
 int32_t UI_readJog(void) {return 0;};
 //EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux/cli/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -20,7 +20,7 @@
 CONFIGURE_FILE("${AVIDEMUX_TOP_SOURCE_DIR}/cmake/config.h.cmake" "${CMAKE_BINARY_DIR}/config/cli/config.h")
 MESSAGE(STATUS "CLI config.h generated")
 
-INCLUDE_DIRECTORIES("${CMAKE_BINARY_DIR}/config/cli/")
+INCLUDE_DIRECTORIES(BEFORE "${CMAKE_BINARY_DIR}/config/cli/")
 
 ###########################################
 # Executable

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRenderInternal.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRenderInternal.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_editor/ADM_edRenderInternal.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -16,7 +16,6 @@
  *                                                                         *
  ***************************************************************************/
 
-#include "ADM_includeFfmpeg.h"
 #include "ADM_cpp.h"
 #include <math.h>
 #include "ADM_default.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_ffmpeg_vdpau.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -21,13 +21,12 @@
  *                                                                         *
  ***************************************************************************/
 
-extern "C" {
-#include "ADM_lavcodec.h"
-}
 #include "ADM_default.h"
+
 #ifdef USE_VDPAU
 extern "C" {
- #include "ADM_ffmpeg/libavcodec/vdpau.h"
+#include "libavcodec/avcodec.h"
+#include "libavcodec/vdpau.h"
 }
 
 #include "ADM_codec.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_videoCodec.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_videoCodec.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoCodec/src/ADM_videoCodec.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -16,10 +16,6 @@
  *                                                                         *
  ***************************************************************************/
 
-extern "C"
-{
-#include "ADM_lavcodec.h"
-};
 #include "ADM_default.h"
 #include "ADM_codec.h"
 #include "ADM_ffmp43.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux/commonCmakeApplication.cmake	2010-12-27 19:46:51 UTC (rev 6865)
@@ -1,15 +1,18 @@
 ########################################
 # Definitions and Includes
 ########################################
-if(NOT PLUGINS)
-        SET(AVIDEMUX_TOP_SOURCE_DIR ${CMAKE_SOURCE_DIR}/../..)
-endif(NOT PLUGINS)
+if (NOT PLUGINS)
+	SET(AVIDEMUX_TOP_SOURCE_DIR ${CMAKE_SOURCE_DIR}/../..)
+endif (NOT PLUGINS)
+
 SET(CMAKE_MODULE_PATH "${AVIDEMUX_TOP_SOURCE_DIR}/cmake" "${CMAKE_MODULE_PATH}")
+
 ########################################
 # Shared cmake part
 ########################################
 ADD_DEFINITIONS(-D_FILE_OFFSET_BITS=64 -D_LARGE_FILES)
 include(admMainChecks)
+
 ########################################
 # Add include dirs
 ########################################
@@ -26,6 +29,7 @@
 IF (GETTEXT_FOUND)
 	INCLUDE_DIRECTORIES(${GETTEXT_INCLUDE_DIR})
 ENDIF (GETTEXT_FOUND)
+
 INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/../common/")
 INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/../common/ADM_audioFilter/include")
 INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/../common/ADM_commonUI")
@@ -51,6 +55,11 @@
 ../common/ADM_slave.cpp
 )
 
+########################################
+# FFmpeg
+########################################
+include_directories("${AVIDEMUX_TOP_SOURCE_DIR}/ffmpeg")
+
 #############################################
 # Add core libs
 #############################################
@@ -71,11 +80,6 @@
 ADM_coreVideoEncoder6
 ADM_coreVideoFilter6
 ADM_coreImageLoader6
-ADM_libavcodec6
-ADM_libavformat6
-ADM_libavutil6
-ADM_libswscale6
-ADM_libpostproc6
 ADM_coreTinyPy6
 )
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_gui2/GUI_gtkRender.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_gui2/GUI_gtkRender.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/ADM_userInterfaces/ADM_gui2/GUI_gtkRender.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -36,7 +36,6 @@
 #include "../ADM_render/GUI_accelRender.h"
 
 #include "ADM_colorspace.h"
-#include "ADM_ffmpeg/libswscale/ADM_mp.h"
 
 void GUI_gtk_grow_off(int onff);
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux/gtk/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -23,7 +23,7 @@
 CONFIGURE_FILE("${AVIDEMUX_TOP_SOURCE_DIR}/cmake/config.h.cmake" "${CMAKE_BINARY_DIR}/config/gtk/config.h")
 MESSAGE(STATUS "GTK config.h generated")
 
-INCLUDE_DIRECTORIES("${CMAKE_BINARY_DIR}/config/gtk/")
+INCLUDE_DIRECTORIES(BEFORE "${CMAKE_BINARY_DIR}/config/gtk/")
 
 ###########################################
 # Executable

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -30,7 +30,7 @@
 CONFIGURE_FILE("${AVIDEMUX_TOP_SOURCE_DIR}/cmake/config.h.cmake" "${CMAKE_BINARY_DIR}/config/qt4/config.h")
 MESSAGE(STATUS "QT4 config.h generated")
 
-INCLUDE_DIRECTORIES("${CMAKE_BINARY_DIR}/config/qt4/")
+INCLUDE_DIRECTORIES(BEFORE "${CMAKE_BINARY_DIR}/config/qt4/")
 
 
 ###########################################

Deleted: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_includeFfmpeg.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_includeFfmpeg.h	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_includeFfmpeg.h	2010-12-27 19:46:51 UTC (rev 6865)
@@ -1,4 +0,0 @@
-#define __STDC_CONSTANT_MACROS  1 // Lavcodec crap
-#define __STDC_LIMIT_MACROS 1
-#define ADM_NO_CONFIG_H
-

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_inttype.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_inttype.h	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/include/ADM_inttype.h	2010-12-27 19:46:51 UTC (rev 6865)
@@ -24,6 +24,8 @@
 typedef unsigned char ADM_filename;
 
 #ifdef HAVE_STDINT_H
+#define __STDC_CONSTANT_MACROS
+#define __STDC_LIMIT_MACROS
 #include <stdint.h>
 #define GOT_TYPES
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_cpuCap.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_cpuCap.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_cpuCap.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -10,9 +10,6 @@
 //
 //
 #include "ADM_coreConfig.h"
-#ifdef ADM_CPU_X86
-#include "ADM_lavcodec.h"
-#endif
 #include "ADM_default.h"
 
 #if defined(__MINGW32__)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_memcpy.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_memcpy.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/ADM_memcpy.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -34,9 +34,12 @@
 #include <stdlib.h>
 #include <string.h>
 #include "ADM_coreConfig.h"
-#include "ADM_lavcodec.h"
 #include "ADM_default.h"
 
+extern "C" {
+#include "libavcodec/avcodec.h"
+}
+
 adm_fast_memcpy myAdmMemcpy=NULL;
 /* Original comments from mplayer (file: aclib.c)
  This part of code was taken by me from Linux-2.4.3 and slightly modified

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_core/src/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -4,7 +4,7 @@
         ADM_debug.cpp 
         ADM_queue.cpp
 )
-include_directories(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core/ADM_ffmpeg/)
+
 ADD_LIBRARY(ADM_core6 SHARED ${ADM_core_SRCS})
 ADD_TARGET_DEFINITIONS(ADM_core6 ADM_DEBUG FIND_LEAKS)
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/ADM_eac3info.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/ADM_eac3info.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/ADM_eac3info.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -7,13 +7,11 @@
 
 */
 
-#include "ADM_includeFfmpeg.h"
 #include "ADM_default.h"
-
 #include "ADM_eac3info.h"
+
 extern "C"
 {
-#define ADM_NO_CONFIG_H
 #define sign_extend
 #include "libavcodec/internal.h"
 #include "libavcodec/ac3_parser.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -12,6 +12,6 @@
 ADD_DEFINITIONS(-DCPU_CLIPS_POSITIVE=0 -DCPU_CLIPS_NEGATIVE=0)
 #*************************************************
 ADD_LIBRARY(ADM_audioParser6 SHARED ${ADMaudioParser_SRCS})
-TARGET_LINK_LIBRARIES(ADM_audioParser6 ADM_core6 ADM_coreUtils6 ADM_coreUI6  ADM_libavcodec6 ADM_libavformat6 ADM_libavutil6)
+TARGET_LINK_LIBRARIES(ADM_audioParser6 ADM_core6 ADM_coreUtils6 ADM_coreUI6  ADM_libavcodec ADM_libavformat ADM_libavutil)
 
 ADM_INSTALL_LIB(ADM_audioParser6)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_colorspace.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -14,16 +14,14 @@
  *                                                                         *
  ***************************************************************************/
 
-
-#include "ADM_includeFfmpeg.h"
 #include "ADM_default.h"
 #include "ADM_colorspace.h"
 #include "ADM_image.h"
 
 extern "C" {
-#include "ADM_ffmpeg/libavcodec/avcodec.h"
-#include "ADM_ffmpeg/libavutil/avutil.h"
-#include "ADM_ffmpeg/libswscale/swscale.h"
+#include "libavcodec/avcodec.h"
+#include "libavutil/avutil.h"
+#include "libswscale/swscale.h"
 }
 
 #include "ADM_rgb.h" 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageResizer.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageResizer.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageResizer.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -11,14 +11,13 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
-#include "ADM_default.h"
 
+#include "ADM_default.h"
 #include "ADM_imageResizer.h"
 
 extern "C" {
-#include "ADM_ffmpeg/libavcodec/avcodec.h"
-#include "ADM_ffmpeg/libswscale/swscale.h"
+#include "libavcodec/avcodec.h"
+#include "libswscale/swscale.h"
 }
 
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageSave.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageSave.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageSave.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -1,17 +1,21 @@
-/**
-      \file A
-      \brief 2nd part of ADMImage, put here to avoid weird dependancies
-*/
-#include "ADM_includeFfmpeg.h"
-#include "ADM_default.h"
-#include "ADM_image.h"
-#include "ADM_bitmap.h"
-#include "DIA_coreToolkit.h"
-#include "ADM_colorspace.h"
-#include "ADM_lavcodec.h"
-/**
-    \fn SwapMe
-*/
+/**
+      \file A
+      \brief 2nd part of ADMImage, put here to avoid weird dependancies
+*/
+
+#include "ADM_default.h"
+#include "ADM_image.h"
+#include "ADM_bitmap.h"
+#include "DIA_coreToolkit.h"
+#include "ADM_colorspace.h"
+
+extern "C" {
+#include "libavcodec/avcodec.h"
+}
+
+/**
+    \fn SwapMe
+*/
 static inline void SwapMe(uint8_t *tgt,uint8_t *src,int nb);
 void SwapMe(uint8_t *tgt,uint8_t *src,int nb)
 {
@@ -30,60 +34,60 @@
    return;
     
 }
-
-/**
-    \fn saveAsBmp
-    \brief save current image into filename, into bmp format
-*/
-bool  ADMImage::saveAsBmp(const char *filename)
-{
-  ADM_BITMAPFILEHEADER bmfh;
-  ADM_BITMAPINFOHEADER bmph;
-  FILE *fd;
-  uint32_t sz;
-  uint16_t s16;
-  uint32_t s32;
-
-  sz = _width* _height * 3;
-
-  bmfh.bfReserved1 = bmfh.bfReserved2 = 0;
-  bmfh.bfOffBits = sizeof (bmfh) + sizeof (bmph);
-//_________________________________________
-  bmph.biSize = sizeof (bmph);
-  bmph.biWidth = _width;
-  bmph.biHeight = _height;
-  bmph.biPlanes = 1;
-  bmph.biBitCount = 24;
-  bmph.biCompression = 0;	// COMPRESSION NONE
-  bmph.biSizeImage = sz;
-  bmph.biXPelsPerMeter = 0;
-  bmph.biYPelsPerMeter = 0;
-  bmph.biClrUsed = 0;
-  bmph.biClrImportant = 0;
-/*
-	bmph.resolutionUnits=0;
-	bmph.origin=0;
-	bmph.colorEncoding=0;
-*/
-
-  ADMImageDefault image(_width,_height);
-
-
-  printf ("\n %u x %u=%u\n", bmph.biWidth, bmph.biHeight, sz);
-
-  uint8_t *out;
-
-        out=(uint8_t *)ADM_alloc(sz);
-        if(!out)
-        {
-            GUI_Error_HIG(QT_TR_NOOP("Memory error"), NULL);
-//            ADM_dealloc(out);
-            return 0;
-        }
-        ADMColorScalerSimple converter(bmph.biWidth, bmph.biHeight, ADM_COLOR_YV12,ADM_COLOR_RGB24);
-        converter.convertImage(this,out);
-        uint32_t ww=bmph.biWidth;
-        uint32_t hh=bmph.biHeight;
+
+/**
+    \fn saveAsBmp
+    \brief save current image into filename, into bmp format
+*/
+bool  ADMImage::saveAsBmp(const char *filename)
+{
+  ADM_BITMAPFILEHEADER bmfh;
+  ADM_BITMAPINFOHEADER bmph;
+  FILE *fd;
+  uint32_t sz;
+  uint16_t s16;
+  uint32_t s32;
+
+  sz = _width* _height * 3;
+
+  bmfh.bfReserved1 = bmfh.bfReserved2 = 0;
+  bmfh.bfOffBits = sizeof (bmfh) + sizeof (bmph);
+//_________________________________________
+  bmph.biSize = sizeof (bmph);
+  bmph.biWidth = _width;
+  bmph.biHeight = _height;
+  bmph.biPlanes = 1;
+  bmph.biBitCount = 24;
+  bmph.biCompression = 0;	// COMPRESSION NONE
+  bmph.biSizeImage = sz;
+  bmph.biXPelsPerMeter = 0;
+  bmph.biYPelsPerMeter = 0;
+  bmph.biClrUsed = 0;
+  bmph.biClrImportant = 0;
+/*
+	bmph.resolutionUnits=0;
+	bmph.origin=0;
+	bmph.colorEncoding=0;
+*/
+
+  ADMImageDefault image(_width,_height);
+
+
+  printf ("\n %u x %u=%u\n", bmph.biWidth, bmph.biHeight, sz);
+
+  uint8_t *out;
+
+        out=(uint8_t *)ADM_alloc(sz);
+        if(!out)
+        {
+            GUI_Error_HIG(QT_TR_NOOP("Memory error"), NULL);
+//            ADM_dealloc(out);
+            return 0;
+        }
+        ADMColorScalerSimple converter(bmph.biWidth, bmph.biHeight, ADM_COLOR_YV12,ADM_COLOR_RGB24);
+        converter.convertImage(this,out);
+        uint32_t ww=bmph.biWidth;
+        uint32_t hh=bmph.biHeight;
         uint8_t swap[ww*3];
         uint8_t *up=out;
         uint8_t *down=out+(hh-1)*ww*3;
@@ -95,128 +99,128 @@
             memcpy( down,swap,ww*3);
             down-=3*ww;
             up+=3*ww;
-        }
-
-        fd = ADM_fopen (filename, "wb");
-        if (!fd)
-        {
-                GUI_Error_HIG (QT_TR_NOOP("Something bad happened"), NULL);
-                ADM_dealloc(out);
-                return 0;
-        }
-
-	// Bitmpap file header, not using tructure due to gcc padding it
-#ifdef ADM_BIG_ENDIAN
-	s16 = 0x424D;
-#else
-  	s16 = 0x4D42;
-#endif
-  	s32 = 14 + sizeof (bmph) + sz;
-#ifdef ADM_BIG_ENDIAN
-	#define SWAP32(x) x=R32(x)
-#else
-	#define SWAP32(x) ;
-#endif
-        SWAP32(s32);
-        fwrite (&s16, 2, 1, fd);
-        fwrite (&s32, 4, 1, fd);
-        s32 = 0;
-        fwrite (&s32, 4, 1, fd);
-        s32 = 14 + sizeof (bmph);
-        SWAP32(s32);
-        fwrite (&s32, 4, 1, fd);
-#ifdef ADM_BIG_ENDIAN
-	Endian_BitMapInfo(&bmph);
-#endif
-        fwrite (&bmph, sizeof (bmph), 1, fd);
-        fwrite (out, sz, 1, fd);
-
-        fclose(fd);
-        ADM_dealloc(out);
-        return 1;
-}
-/**
-    \fn saveAsJpg
-    \brief save current image into filename, into jpg format
-*/
-bool  ADMImage::saveAsJpg(const char *filename)
-{
-
-AVCodecContext   *context=NULL;   
-AVFrame          frame;     
-bool             result=false;
-AVCodec          *codec=NULL;
-uint8_t          buffer[_width*_height*4];
-int              sz=0,r=0;
-
-    context=avcodec_alloc_context();
-    if(!context) 
-    {
-        printf("[saveAsJpg] Cannot allocate context\n");
-        return false;
-    }
-    codec=avcodec_find_encoder(CODEC_ID_MJPEG);
-    if(!codec)
-    {
-        printf("[saveAsJpg] Cannot allocate codec\n");
-        goto jpgCleanup;
-    }
-    context->pix_fmt =PIX_FMT_YUV420P;
-    context->strict_std_compliance = -1;
-    context->time_base.den=1;
-    context->time_base.num=1;
-    context->width=_width;
-    context->height=_height;
-    r=avcodec_open(context, codec); 
-    if(r<0)
-    {
-        printf("[saveAsJpg] Cannot mix codec and context\n");
-        ADM_dealloc (context);
-        return false;
-    }
-    // Setup our image & stuff....
-        
-
-        frame.linesize[0] = GetPitch(PLANAR_Y); 
-        frame.linesize[1] = GetPitch(PLANAR_U); 
-        frame.linesize[2] = GetPitch(PLANAR_V); 
-        
-        frame.data[0] = GetWritePtr(PLANAR_Y);
-        frame.data[2] = GetWritePtr(PLANAR_U);
-        frame.data[1] = GetWritePtr(PLANAR_V);
-    // Grab a temp buffer
-    
-    // Encode!
-      context->flags |= CODEC_FLAG_QSCALE;
-      frame.quality = (int) floor (FF_QP2LAMBDA * 2+ 0.5);
-        
-        if ((sz = avcodec_encode_video (context, buffer, _width*_height*4, &frame)) < 0)
-        {
-            printf("[jpeg] Error %d encoding video\n",sz);
-            goto  jpgCleanup;
-        }
-        // Ok now write our file...
-        {
-            FILE *f=ADM_fopen(filename,"wb");
-            if(f)
-            {
-                fwrite(buffer,sz,1,f);
-                fclose(f);
-                result=true;
-            }else
-            {
-                printf("[saveAsJpeg] Cannot open %s for writing!\n",filename);
-
-            }
-       }
-
-// Cleanup
-jpgCleanup:
-    if(context)
-    {
-        avcodec_close (context);
-        ADM_dealloc (context);
-    }
-    context=NULL;
-    return result;
-}
+        }
+
+        fd = ADM_fopen (filename, "wb");
+        if (!fd)
+        {
+                GUI_Error_HIG (QT_TR_NOOP("Something bad happened"), NULL);
+                ADM_dealloc(out);
+                return 0;
+        }
+
+	// Bitmpap file header, not using tructure due to gcc padding it
+#ifdef ADM_BIG_ENDIAN
+	s16 = 0x424D;
+#else
+  	s16 = 0x4D42;
+#endif
+  	s32 = 14 + sizeof (bmph) + sz;
+#ifdef ADM_BIG_ENDIAN
+	#define SWAP32(x) x=R32(x)
+#else
+	#define SWAP32(x) ;
+#endif
+        SWAP32(s32);
+        fwrite (&s16, 2, 1, fd);
+        fwrite (&s32, 4, 1, fd);
+        s32 = 0;
+        fwrite (&s32, 4, 1, fd);
+        s32 = 14 + sizeof (bmph);
+        SWAP32(s32);
+        fwrite (&s32, 4, 1, fd);
+#ifdef ADM_BIG_ENDIAN
+	Endian_BitMapInfo(&bmph);
+#endif
+        fwrite (&bmph, sizeof (bmph), 1, fd);
+        fwrite (out, sz, 1, fd);
+
+        fclose(fd);
+        ADM_dealloc(out);
+        return 1;
+}
+/**
+    \fn saveAsJpg
+    \brief save current image into filename, into jpg format
+*/
+bool  ADMImage::saveAsJpg(const char *filename)
+{
+
+AVCodecContext   *context=NULL;   
+AVFrame          frame;     
+bool             result=false;
+AVCodec          *codec=NULL;
+uint8_t          buffer[_width*_height*4];
+int              sz=0,r=0;
+
+    context=avcodec_alloc_context();
+    if(!context) 
+    {
+        printf("[saveAsJpg] Cannot allocate context\n");
+        return false;
+    }
+    codec=avcodec_find_encoder(CODEC_ID_MJPEG);
+    if(!codec)
+    {
+        printf("[saveAsJpg] Cannot allocate codec\n");
+        goto jpgCleanup;
+    }
+    context->pix_fmt =PIX_FMT_YUV420P;
+    context->strict_std_compliance = -1;
+    context->time_base.den=1;
+    context->time_base.num=1;
+    context->width=_width;
+    context->height=_height;
+    r=avcodec_open(context, codec); 
+    if(r<0)
+    {
+        printf("[saveAsJpg] Cannot mix codec and context\n");
+        ADM_dealloc (context);
+        return false;
+    }
+    // Setup our image & stuff....
+        
+
+        frame.linesize[0] = GetPitch(PLANAR_Y); 
+        frame.linesize[1] = GetPitch(PLANAR_U); 
+        frame.linesize[2] = GetPitch(PLANAR_V); 
+        
+        frame.data[0] = GetWritePtr(PLANAR_Y);
+        frame.data[2] = GetWritePtr(PLANAR_U);
+        frame.data[1] = GetWritePtr(PLANAR_V);
+    // Grab a temp buffer
+    
+    // Encode!
+      context->flags |= CODEC_FLAG_QSCALE;
+      frame.quality = (int) floor (FF_QP2LAMBDA * 2+ 0.5);
+        
+        if ((sz = avcodec_encode_video (context, buffer, _width*_height*4, &frame)) < 0)
+        {
+            printf("[jpeg] Error %d encoding video\n",sz);
+            goto  jpgCleanup;
+        }
+        // Ok now write our file...
+        {
+            FILE *f=ADM_fopen(filename,"wb");
+            if(f)
+            {
+                fwrite(buffer,sz,1,f);
+                fclose(f);
+                result=true;
+            }else
+            {
+                printf("[saveAsJpeg] Cannot open %s for writing!\n",filename);
+
+            }
+       }
+
+// Cleanup
+jpgCleanup:
+    if(context)
+    {
+        avcodec_close (context);
+        ADM_dealloc (context);
+    }
+    context=NULL;
+    return result;
+}

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageUtils.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageUtils.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_imageUtils.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -12,23 +12,14 @@
  *                                                                         *
  ***************************************************************************/
 
-
-
 #include "ADM_default.h"
 #include "ADM_image.h"
 #include "ADM_bitmap.h"
 #include "avifmt.h"
 #include "avifmt2.h"
 #include "ADM_bitstream.h"
-
 #include "DIA_coreToolkit.h"
 
-#if 0
-#include "ADM_encoderConf.h"
-#include "ADM_codecs/ADM_codec.h"
-#include "ADM_lavcodec.h"
-#include "ADM_codecs/ADM_ffmpeg.h"
-#endif
 #define QT_TR_NOOP(x) x // No translation in core*
 static uint8_t tinyAverage(uint8_t *dst, uint8_t *src1, uint8_t *src2,uint32_t l)
 {

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_pp.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_pp.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/ADM_pp.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -18,12 +18,12 @@
 //             4 Dering
 // strength between 0 and 5
 
-#include "ADM_includeFfmpeg.h"
-#include "ADM_lavcodec.h"
+#include "ADM_default.h"
+
 extern "C" {
-#include "ADM_ffmpeg/libpostproc/postprocess.h"
+#include "libpostproc/postprocess.h"
 }
-#include "ADM_default.h"
+
 #include "ADM_image.h"
 #include "ADM_imageFlags.h"
 #include "ADM_pp.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -25,6 +25,6 @@
 	TARGET_LINK_LIBRARIES(ADM_coreImage6 -Wl,-read_only_relocs,suppress)
 ENDIF (APPLE)
 
-TARGET_LINK_LIBRARIES(ADM_coreImage6 ADM_core6 ADM_coreUI6 ADM_libswscale6 ADM_libpostproc6 ADM_coreUtils6)
-TARGET_LINK_LIBRARIES(ADM_coreImage6 ADM_libavcodec6 ADM_libavutil6 )
+TARGET_LINK_LIBRARIES(ADM_coreImage6 ADM_core6 ADM_coreUI6 ADM_libswscale ADM_libpostproc ADM_coreUtils6)
+TARGET_LINK_LIBRARIES(ADM_coreImage6 ADM_libavcodec ADM_libavutil)
 ADM_INSTALL_LIB(ADM_coreImage6)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/include/ADM_coreMuxerFfmpeg.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/include/ADM_coreMuxerFfmpeg.h	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/include/ADM_coreMuxerFfmpeg.h	2010-12-27 19:46:51 UTC (rev 6865)
@@ -22,14 +22,12 @@
 #include "fourcc.h"
 #include "ADM_muxer.h"
 #include "ADM_muxerUtils.h"
-#include "ADM_lavcodec.h"
+
 extern "C"
 {
     #include "libavformat/avformat.h"
 };
-#ifndef INT64_C
-#define INT64_C(x) (uint64_t)(x##LL)
-#endif
+
 /**
     \class muxerFFmpeg
 */

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/ADM_coreMuxerFfmpeg.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/ADM_coreMuxerFfmpeg.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/ADM_coreMuxerFfmpeg.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -16,7 +16,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "fourcc.h"
 #include "ADM_coreMuxerFfmpeg.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/ADM_dynaMuxer.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/ADM_dynaMuxer.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/ADM_dynaMuxer.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -1,252 +1,255 @@
-/***************************************************************************
-                          ADM_coreMuxer.cpp  -  description
-                             -------------------
-    copyright            : (C) 2008 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
-#include <vector>
-#include "ADM_default.h"
-#include "ADM_muxerInternal.h"
-#include "ADM_muxerProto.h"
-void ADM_MuxersCleanup(void);
-
-ADM_muxer *ADM_muxerSpawn(uint32_t magic,const char *name);
-
-std::vector <ADM_dynMuxer *> ListOfMuxers;
-/**
-    \fn ADM_mux_configure
-    \brief 
-*/
-bool ADM_mux_configure(int index)
-{
-    ADM_assert(index<ListOfMuxers.size());
-    return ListOfMuxers[index]->configure();
-}
-
-/**
-        \fn ADM_mx_getNbMuxers
-        \brief Returns the number of muxers plugins except one
-*/
-uint32_t ADM_mx_getNbMuxers(void)
-{
-    return ListOfMuxers.size();
-}
-/**
-    \fn ADM_mx_getDisplayName
-    \brief Returns display name for muxer i
-*/
-const char *ADM_mx_getDisplayName(uint32_t i)
-{
-    ADM_assert(i<ListOfMuxers.size());
-    return ListOfMuxers[i]->displayName;
-}
-/**
-    \fn ADM_mx_getName
-    \brief Returns internal name for muxer i
-*/
-const char *ADM_mx_getName(uint32_t i)
-{
-    ADM_assert(i<ListOfMuxers.size());
-    return ListOfMuxers[i]->name;
-}
-
-/**
-    \fn     ADM_dm_getDemuxerInfo
-    \brief  Get Infos about the demuxer #th plugin
-*/
-bool     ADM_mx_getMuxerInfo(int filter, const char **name, uint32_t *major,uint32_t *minor,uint32_t *patch)
-{
-    ADM_assert(filter<ListOfMuxers.size());
-    ListOfMuxers[filter]->getVersion(major,minor,patch);
-    *name=ListOfMuxers[filter]->descriptor;
-    return true;
-}
-/**
-    \fn tryLoadingMuxerPlugin
-    \brief Try loading the file given as argument as a muxer
-
-*/
-#define Fail(x) {printf("%s:"#x"\n",file);goto er;}
-static bool tryLoadingMuxerPlugin(const char *file)
-{
-	ADM_dynMuxer *dll=new ADM_dynMuxer(file);
-    if(!dll->initialised) Fail(CannotLoad);
-    if(dll->apiVersion!=ADM_MUXER_API_VERSION) Fail(WrongApiVersion);
-
-    ListOfMuxers.push_back(dll); // Needed for cleanup. FIXME TODO Delete it.
-    printf("[Muxers] Registered filter %s as  %s\n",file,dll->descriptor);
-    return true;
-	// Fail!
-er:
-	delete dll;
-	return false;
-
-}
-/**
- * 	\fn ADM_mx_loadPlugins
- *  \brief load all audio device plugins
- */
-uint8_t ADM_mx_loadPlugins(const char *path)
-{
-#define MAX_EXTERNAL_FILTER 100
-// FIXME Factorize
-
-	char *files[MAX_EXTERNAL_FILTER];
-	uint32_t nbFile;
-
-	memset(files,0,sizeof(char *)*MAX_EXTERNAL_FILTER);
-	printf("[ADM_mx_plugin] Scanning directory %s\n",path);
-
-	if(!buildDirectoryContent(&nbFile, path, files, MAX_EXTERNAL_FILTER, SHARED_LIB_EXT))
-	{
-		printf("[ADM_av_plugin] Cannot parse plugin\n");
-		return 0;
-	}
-
-	for(int i=0;i<nbFile;i++)
-		tryLoadingMuxerPlugin(files[i]);
-
-	printf("[ADM_mx_plugin] Scanning done\n");
-
-	return 1;
-}
-/**
-    \fn ADM_mx_cleanup
-*/
-bool ADM_mx_cleanup(void) 
-{
-    ADM_MuxersCleanup();
-    return true;
-}
-/**
-    \fn ADM_mx_getExtraConf
-    \brief Retrieve extra configuration from current muxer
-*/
-bool ADM_mx_getExtraConf(int index,CONFcouple **c)
-{
-    *c=NULL;
-    if(index>=ListOfMuxers.size())
-    {
-        ADM_error("Given index exceeds muxer list\n",index);
-        return false;
-    }
-    ADM_dynMuxer *mux=ListOfMuxers[index];
-    return mux->getConfiguration(c);
-    
-}
-/**
-    \fn ADM_mx_setExtraConf
-    \brief Set extra configuration from current muxer
-*/
-bool ADM_mx_setExtraConf(int index,CONFcouple *c)
-{
-    if(!c) return true;
-    if(index>=ListOfMuxers.size())
-    {
-        ADM_error("Given index exceeds muxer list\n",index);
-        return false;
-    }
-    ADM_dynMuxer *mux=ListOfMuxers[index];
-    return mux->setConfiguration(c);
-    
-}
-/**
-        \fn ADM_MuxersCleanup
-        \brief Current device is no longer used, delete
-*/
-void ADM_MuxersCleanup(void)
-{
-        int nb=ListOfMuxers.size();
-        for(int i=0;i<nb;i++)
-                {
-                        if(ListOfMuxers[i]) delete ListOfMuxers[i];
-                        ListOfMuxers[i]=NULL;
-                }
-}
-
-/**
-    \fn ADM_muxerIndexFromName
-    \brief return muxer index from name, -1 if error
-*/
-int ADM_MuxerIndexFromName(const char *name)
-{
-    int n=ListOfMuxers.size();
-    for(int i=0;i<n;i++)
-    {
-        ADM_dynMuxer *mux=ListOfMuxers[i];
-        if(!strcasecmp(mux->name,name)) return i;
-    }
-    return -1;
-}
-/**
-    \fn ADM_MuxerSpawn
-    \brief Locate the correct demuxer and instantiate it
-
-*/
-ADM_muxer *ADM_MuxerSpawn(const char *name)
-{
-int found=-1;
-uint32_t score=0;
-uint32_t mark;
-    found=ADM_MuxerIndexFromName(name);
-    if(score && found!=-1)
-    {
-        return ListOfMuxers[found]->createmuxer();
-    }
-    return NULL;
-}
-
-/**
-    \fn ADM_MuxerSpawnFromIndex
-    \brief Locate the correct demuxer and instantiate it
-
-*/
-ADM_muxer *ADM_MuxerSpawnFromIndex(int index)
-{
-    ADM_assert(index<ListOfMuxers.size());
-    return ListOfMuxers[index]->createmuxer();
-}
-
-
-//___________________________________________
-extern "C"
-{
-    #include "ADM_ffmpeg/libavformat/avformat.h"
-    #include "ADM_ffmpeg/libavformat/avio.h" // to get regiter protocol
-};
-extern "C"
-{
-extern void movenc_init(void);
-extern void flvenc_init(void);
-extern void matroskaenc_init(void);
-extern void mpegenc_init(void);
-extern void mpegtsenc_init(void);
-}
-extern struct URLProtocol file_protocol ;
-/**
-
-
-*/
-void ADM_lavFormatInit(void)
-{
-    // Init lavformat
-
-        movenc_init();
-        flvenc_init();
-        matroskaenc_init();
-        mpegenc_init();
-        mpegtsenc_init();
-        av_register_protocol(&file_protocol);
-}
-// EOF
-
+/***************************************************************************
+                          ADM_coreMuxer.cpp  -  description
+                             -------------------
+    copyright            : (C) 2008 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include <vector>
+#include "ADM_default.h"
+#include "ADM_muxerInternal.h"
+#include "ADM_muxerProto.h"
+void ADM_MuxersCleanup(void);
+
+ADM_muxer *ADM_muxerSpawn(uint32_t magic,const char *name);
+
+std::vector <ADM_dynMuxer *> ListOfMuxers;
+/**
+    \fn ADM_mux_configure
+    \brief 
+*/
+bool ADM_mux_configure(int index)
+{
+    ADM_assert(index<ListOfMuxers.size());
+    return ListOfMuxers[index]->configure();
+}
+
+/**
+        \fn ADM_mx_getNbMuxers
+        \brief Returns the number of muxers plugins except one
+*/
+uint32_t ADM_mx_getNbMuxers(void)
+{
+    return ListOfMuxers.size();
+}
+/**
+    \fn ADM_mx_getDisplayName
+    \brief Returns display name for muxer i
+*/
+const char *ADM_mx_getDisplayName(uint32_t i)
+{
+    ADM_assert(i<ListOfMuxers.size());
+    return ListOfMuxers[i]->displayName;
+}
+/**
+    \fn ADM_mx_getName
+    \brief Returns internal name for muxer i
+*/
+const char *ADM_mx_getName(uint32_t i)
+{
+    ADM_assert(i<ListOfMuxers.size());
+    return ListOfMuxers[i]->name;
+}
+
+/**
+    \fn     ADM_dm_getDemuxerInfo
+    \brief  Get Infos about the demuxer #th plugin
+*/
+bool     ADM_mx_getMuxerInfo(int filter, const char **name, uint32_t *major,uint32_t *minor,uint32_t *patch)
+{
+    ADM_assert(filter<ListOfMuxers.size());
+    ListOfMuxers[filter]->getVersion(major,minor,patch);
+    *name=ListOfMuxers[filter]->descriptor;
+    return true;
+}
+/**
+    \fn tryLoadingMuxerPlugin
+    \brief Try loading the file given as argument as a muxer
+
+*/
+#define Fail(x) {printf("%s:"#x"\n",file);goto er;}
+static bool tryLoadingMuxerPlugin(const char *file)
+{
+	ADM_dynMuxer *dll=new ADM_dynMuxer(file);
+    if(!dll->initialised) Fail(CannotLoad);
+    if(dll->apiVersion!=ADM_MUXER_API_VERSION) Fail(WrongApiVersion);
+
+    ListOfMuxers.push_back(dll); // Needed for cleanup. FIXME TODO Delete it.
+    printf("[Muxers] Registered filter %s as  %s\n",file,dll->descriptor);
+    return true;
+	// Fail!
+er:
+	delete dll;
+	return false;
+
+}
+/**
+ * 	\fn ADM_mx_loadPlugins
+ *  \brief load all audio device plugins
+ */
+uint8_t ADM_mx_loadPlugins(const char *path)
+{
+#define MAX_EXTERNAL_FILTER 100
+// FIXME Factorize
+
+	char *files[MAX_EXTERNAL_FILTER];
+	uint32_t nbFile;
+
+	memset(files,0,sizeof(char *)*MAX_EXTERNAL_FILTER);
+	printf("[ADM_mx_plugin] Scanning directory %s\n",path);
+
+	if(!buildDirectoryContent(&nbFile, path, files, MAX_EXTERNAL_FILTER, SHARED_LIB_EXT))
+	{
+		printf("[ADM_av_plugin] Cannot parse plugin\n");
+		return 0;
+	}
+
+	for(int i=0;i<nbFile;i++)
+		tryLoadingMuxerPlugin(files[i]);
+
+	printf("[ADM_mx_plugin] Scanning done\n");
+
+	return 1;
+}
+/**
+    \fn ADM_mx_cleanup
+*/
+bool ADM_mx_cleanup(void) 
+{
+    ADM_MuxersCleanup();
+    return true;
+}
+/**
+    \fn ADM_mx_getExtraConf
+    \brief Retrieve extra configuration from current muxer
+*/
+bool ADM_mx_getExtraConf(int index,CONFcouple **c)
+{
+    *c=NULL;
+    if(index>=ListOfMuxers.size())
+    {
+        ADM_error("Given index exceeds muxer list\n",index);
+        return false;
+    }
+    ADM_dynMuxer *mux=ListOfMuxers[index];
+    return mux->getConfiguration(c);
+    
+}
+/**
+    \fn ADM_mx_setExtraConf
+    \brief Set extra configuration from current muxer
+*/
+bool ADM_mx_setExtraConf(int index,CONFcouple *c)
+{
+    if(!c) return true;
+    if(index>=ListOfMuxers.size())
+    {
+        ADM_error("Given index exceeds muxer list\n",index);
+        return false;
+    }
+    ADM_dynMuxer *mux=ListOfMuxers[index];
+    return mux->setConfiguration(c);
+    
+}
+/**
+        \fn ADM_MuxersCleanup
+        \brief Current device is no longer used, delete
+*/
+void ADM_MuxersCleanup(void)
+{
+        int nb=ListOfMuxers.size();
+        for(int i=0;i<nb;i++)
+                {
+                        if(ListOfMuxers[i]) delete ListOfMuxers[i];
+                        ListOfMuxers[i]=NULL;
+                }
+}
+
+/**
+    \fn ADM_muxerIndexFromName
+    \brief return muxer index from name, -1 if error
+*/
+int ADM_MuxerIndexFromName(const char *name)
+{
+    int n=ListOfMuxers.size();
+    for(int i=0;i<n;i++)
+    {
+        ADM_dynMuxer *mux=ListOfMuxers[i];
+        if(!strcasecmp(mux->name,name)) return i;
+    }
+    return -1;
+}
+/**
+    \fn ADM_MuxerSpawn
+    \brief Locate the correct demuxer and instantiate it
+
+*/
+ADM_muxer *ADM_MuxerSpawn(const char *name)
+{
+int found=-1;
+uint32_t score=0;
+uint32_t mark;
+    found=ADM_MuxerIndexFromName(name);
+    if(score && found!=-1)
+    {
+        return ListOfMuxers[found]->createmuxer();
+    }
+    return NULL;
+}
+
+/**
+    \fn ADM_MuxerSpawnFromIndex
+    \brief Locate the correct demuxer and instantiate it
+
+*/
+ADM_muxer *ADM_MuxerSpawnFromIndex(int index)
+{
+    ADM_assert(index<ListOfMuxers.size());
+    return ListOfMuxers[index]->createmuxer();
+}
+
+
+//___________________________________________
+extern "C"
+{
+    #include "libavformat/avformat.h"
+};
+
+void ADM_lavFormatInit(void)
+{
+	av_register_all();
+
+	// Make sure avformat is correctly configured
+	const char* formats[] = {"mpegts", "dvd", "vcd", "svcd", "mp4", "psp", "flv", "matroska"};
+	AVOutputFormat *avfmt;
+
+	for (int i = 0; i < 8; i++)
+	{
+		avfmt = av_guess_format(formats[i], NULL, NULL);
+
+		if (avfmt == NULL)
+		{
+			printf("Error: %s muxer isn't registered\n", formats[i]);
+			ADM_assert(0);
+		}
+	}
+
+	URLProtocol *up = av_protocol_next(NULL);
+
+	if (strcmp(up->name, "file") != 0)
+	{
+		printf("Error: file protocol isn't registered\n");
+		ADM_assert(0);
+	}
+}
+// EOF
+

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -8,7 +8,7 @@
 #*************************************************
 ADD_LIBRARY(ADM_coreMuxer6 SHARED ${ADMcoreMuxer_SRCS})
 INCLUDE_DIRECTORIES(${CMAKE_SOURCE_DIR}/avidemux/ADM_coreAudio/include)
-INCLUDE_DIRECTORIES(${CMAKE_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg)
-TARGET_LINK_LIBRARIES(ADM_coreMuxer6 ADM_coreImage6 ADM_coreAudio6 ADM_core6 ADM_libavcodec6 ADM_libavformat6 ADM_libavutil6 ADM_coreUtils6)
 
+TARGET_LINK_LIBRARIES(ADM_coreMuxer6 ADM_coreImage6 ADM_coreAudio6 ADM_core6 ADM_libavcodec ADM_libavformat ADM_libavutil ADM_coreUtils6)
+
 ADM_INSTALL_LIB(ADM_coreMuxer6)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/include/ADM_coreCodecMapping.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/include/ADM_coreCodecMapping.h	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/include/ADM_coreCodecMapping.h	2010-12-27 19:46:51 UTC (rev 6865)
@@ -18,7 +18,7 @@
 #ifndef ADM_CORE_CODEC_MAPPING_H
 #define ADM_CORE_CODEC_MAPPING_H
 extern "C" {
-#include "ADM_lavcodec.h"
+#include "libavcodec/avcodec.h"
 }
 
 typedef struct

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_coreCodecMapping.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_coreCodecMapping.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_coreCodecMapping.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -15,7 +15,6 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
 
 #include "ADM_default.h"
 #include "ADM_coreCodecMapping.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_getbits.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_getbits.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_getbits.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -12,7 +12,6 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
 
 #include "ADM_default.h"
 
@@ -20,16 +19,14 @@
 #define ADM_getbits_H
 extern "C"
 {
-#define ADM_NO_CONFIG_H
-#include "ADM_ffmpeg/libavutil/common.h"
-#include "ADM_ffmpeg/libavutil/bswap.h"
+#include "libavutil/common.h"
+#include "libavutil/bswap.h"
 #ifndef INT_MAX
 #define INT_MAX (0x7FFFFFFF)
 #endif
-#include "ADM_ffmpeg/ffmpeg_config/config.h"
-#include "ADM_ffmpeg/libavutil/internal.h"
-#include "ADM_ffmpeg/libavcodec/get_bits.h"
-#include "ADM_ffmpeg/libavcodec/golomb.h"
+#include "libavutil/avconfig.h"
+#include "libavcodec/get_bits.h"
+#include "libavcodec/golomb.h"
 }
 #undef printf
 #undef sprintf

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_infoExtractorH264.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_infoExtractorH264.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_infoExtractorH264.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -12,8 +12,8 @@
  *                                                                         *
  ***************************************************************************/
 
+#include "ADM_default.h"
 
-#include "ADM_includeFfmpeg.h"
 extern "C"
 {
 #include "libavcodec/parser.h"
@@ -21,7 +21,7 @@
 #include "libavcodec/ff_spsinfo.h"
 extern int ff_h264_info(AVCodecParserContext *parser,ffSpsInfo *ndo);
 }
-#include "ADM_default.h"
+
 #include "ADM_Video.h"
 
 #include "fourcc.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_paramList.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_paramList.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_paramList.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -17,7 +17,7 @@
  *   the Free Software Foundation; either version 2 of the License, or     *
  *   (at your option) any later version.                                   *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "ADM_paramList.h"
 #include <stddef.h>

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -18,7 +18,7 @@
 
 ADD_LIBRARY(ADM_coreUtils6 SHARED ${ADM_coreUtils_SRCS})
 
-TARGET_LINK_LIBRARIES(ADM_coreUtils6 ADM_core6 ADM_coreUI6 ADM_libavutil6 ADM_libavcodec6 ${LIBXML2_LIBRARIES})
+TARGET_LINK_LIBRARIES(ADM_coreUtils6 ADM_core6 ADM_coreUI6 ADM_libavutil ADM_libavcodec ${LIBXML2_LIBRARIES})
 
 
 ADD_SOURCE_CFLAGS(prefs.cpp -I${LIBXML2_INCLUDE_DIR} ${LIBXML2_DEFINITIONS})

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_codecFFsimple.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_codecFFsimple.h	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_codecFFsimple.h	2010-12-27 19:46:51 UTC (rev 6865)
@@ -19,10 +19,12 @@
  ***************************************************************************/
 #ifndef ADM_CODEC_FF_SIMPLE
 #define ADM_CODEC_FF_SIMPLE
+#include "ADM_default.h"
+
 extern "C" {
-#include "ADM_lavcodec.h"
+#include "libavcodec/avcodec.h"
 }
-#include "ADM_default.h"
+
 #include "ADM_codec.h"
 #include "ADM_ffmp43.h"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_ffmp43.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_ffmp43.h	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/include/ADM_ffmp43.h	2010-12-27 19:46:51 UTC (rev 6865)
@@ -1,144 +1,148 @@
-/***************************************************************************
-                          ADM_ffmp43.h  -  description
-                             -------------------
-                             
-	Mpeg4 ****decoder******** using ffmpeg
-	                              
-    begin                : Wed Sep 25 2002
-    copyright            : (C) 2002 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef ADM_FFMP43_H
-#define ADM_FFMP43_H
-
-#include "ADM_lavcodec.h"
-
-/**
-    \class decoderFF
-    \brief Base class for lavcodec based decoder
-*/
-class decoderFF:public decoders
-{
-protected:
-
-  int codecId;
-  uint8_t _refCopy;
-  AVCodecContext *_context;
-  AVFrame _frame;
-  uint8_t *_internalBuffer;
-  uint8_t _allowNull;
-  uint32_t _swapUV;
-  uint32_t frameType (void);
-  uint8_t clonePic (AVFrame * src, ADMImage * out);
-  void decoderMultiThread ();
-  uint32_t _showMv;
-  uint32_t _gmc;
-  uint32_t _usingMT;
-public:
-
-    decoderFF (uint32_t w, uint32_t h,uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData,uint32_t bpp);
-    virtual ~ decoderFF ();
-  virtual bool dontcopy (void)
-  {
-    return true;
-  }
-  virtual bool uncompress (ADMCompressedImage * in, ADMImage * out);
-  virtual bool setParam (void);
-  virtual bool bFramePossible (void)
-  {
-    return false;
-  }
-  virtual bool decodeHeaderOnly (void);
-  virtual bool decodeFull (void);
-//  virtual uint32_t getSpecificMpeg4Info (void);
-  virtual uint8_t getPARWidth (void);
-  virtual uint8_t getPARHeight (void);
-  virtual bool    flush(void);
-  virtual const char *getDecoderName(void) {return "Lavcodec";}
-};
-
-class decoderFFDiv3:public decoderFF
-{
-protected:
-public:
-  decoderFFDiv3 (uint32_t w, uint32_t h,uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData,uint32_t bpp);
-};
-
-class decoderFFMpeg4:public decoderFF
-{
-protected:
-public:
-        decoderFFMpeg4 (uint32_t w, uint32_t h,uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData,uint32_t bpp);
-  bool uncompress (ADMCompressedImage * in, ADMImage * out);
-  // mpeg4 can have B-frame
-  virtual bool bFramePossible (void)
-  {
-    return 1;
-  }
-};
-class decoderFFMpeg12:public decoderFF
-{
-protected:
-public:
-  decoderFFMpeg12 (uint32_t w, uint32_t h,uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData,uint32_t bpp);
-  // mpeg1/2 can have B-frame
-  virtual bool bFramePossible (void)
-  {
-    return 1;
-  }
-
-};
-
-class decoderFFDV:public decoderFF
-{
-protected:
-public:
-  decoderFFDV (uint32_t w, uint32_t h,uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData,uint32_t bpp);
-};
-
-class decoderFFH264:public decoderFF
-{
-protected:
-  uint32_t _lowDelay;
-public:
-  decoderFFH264 (uint32_t w, uint32_t h,uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData,uint32_t bpp);
-  virtual bool bFramePossible (void)
-  {
-      return true;
-  }
-  bool   uncompress (ADMCompressedImage * in, ADMImage * out);
-};
-
-class decoderFFhuff:public decoderFF
-{
-protected:
-public:
-  decoderFFhuff (uint32_t w, uint32_t h,uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData,uint32_t bpp);
-};
-
-class decoderFF_ffhuff:public decoderFF
-{
-protected:
-public:
-  decoderFF_ffhuff (uint32_t w, uint32_t h,uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData,uint32_t bpp);
-};
-
+/***************************************************************************
+                          ADM_ffmp43.h  -  description
+                             -------------------
+                             
+	Mpeg4 ****decoder******** using ffmpeg
+	                              
+    begin                : Wed Sep 25 2002
+    copyright            : (C) 2002 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#ifndef ADM_FFMP43_H
+#define ADM_FFMP43_H
+
+extern "C" {
+#include "libavcodec/avcodec.h"
+}
+
+#include "ADM_codec.h"
+
+/**
+    \class decoderFF
+    \brief Base class for lavcodec based decoder
+*/
+class decoderFF:public decoders
+{
+protected:
+
+  int codecId;
+  uint8_t _refCopy;
+  AVCodecContext *_context;
+  AVFrame _frame;
+  uint8_t *_internalBuffer;
+  uint8_t _allowNull;
+  uint32_t _swapUV;
+  uint32_t frameType (void);
+  uint8_t clonePic (AVFrame * src, ADMImage * out);
+  void decoderMultiThread ();
+  uint32_t _showMv;
+  uint32_t _gmc;
+  uint32_t _usingMT;
+public:
+
+    decoderFF (uint32_t w, uint32_t h,uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData,uint32_t bpp);
+    virtual ~ decoderFF ();
+  virtual bool dontcopy (void)
+  {
+    return true;
+  }
+  virtual bool uncompress (ADMCompressedImage * in, ADMImage * out);
+  virtual bool setParam (void);
+  virtual bool bFramePossible (void)
+  {
+    return false;
+  }
+  virtual bool decodeHeaderOnly (void);
+  virtual bool decodeFull (void);
+//  virtual uint32_t getSpecificMpeg4Info (void);
+  virtual uint8_t getPARWidth (void);
+  virtual uint8_t getPARHeight (void);
+  virtual bool    flush(void);
+  virtual const char *getDecoderName(void) {return "Lavcodec";}
+};
+
+class decoderFFDiv3:public decoderFF
+{
+protected:
+public:
+  decoderFFDiv3 (uint32_t w, uint32_t h,uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData,uint32_t bpp);
+};
+
+class decoderFFMpeg4:public decoderFF
+{
+protected:
+public:
+        decoderFFMpeg4 (uint32_t w, uint32_t h,uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData,uint32_t bpp);
+  bool uncompress (ADMCompressedImage * in, ADMImage * out);
+  // mpeg4 can have B-frame
+  virtual bool bFramePossible (void)
+  {
+    return 1;
+  }
+};
+class decoderFFMpeg12:public decoderFF
+{
+protected:
+public:
+  decoderFFMpeg12 (uint32_t w, uint32_t h,uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData,uint32_t bpp);
+  // mpeg1/2 can have B-frame
+  virtual bool bFramePossible (void)
+  {
+    return 1;
+  }
+
+};
+
+class decoderFFDV:public decoderFF
+{
+protected:
+public:
+  decoderFFDV (uint32_t w, uint32_t h,uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData,uint32_t bpp);
+};
+
+class decoderFFH264:public decoderFF
+{
+protected:
+  uint32_t _lowDelay;
+public:
+  decoderFFH264 (uint32_t w, uint32_t h,uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData,uint32_t bpp);
+  virtual bool bFramePossible (void)
+  {
+      return true;
+  }
+  bool   uncompress (ADMCompressedImage * in, ADMImage * out);
+};
+
+class decoderFFhuff:public decoderFF
+{
+protected:
+public:
+  decoderFFhuff (uint32_t w, uint32_t h,uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData,uint32_t bpp);
+};
+
+class decoderFF_ffhuff:public decoderFF
+{
+protected:
+public:
+  decoderFF_ffhuff (uint32_t w, uint32_t h,uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData,uint32_t bpp);
+};
+
 class decoderFFPng : public decoderFF
 {
 public:
 	decoderFFPng(uint32_t w, uint32_t h, uint32_t fcc, uint32_t extraDataLen, uint8_t *extraData, uint32_t bpp);
-};
-
-#endif
-
-// EOF
-
+};
+
+#endif
+
+// EOF
+

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/ADM_codecSearch.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/ADM_codecSearch.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/ADM_codecSearch.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -18,11 +18,12 @@
  *                                                                         *
  ***************************************************************************/
 
+#include "ADM_default.h"
+
 extern "C"
 {
-#include "ADM_lavcodec.h"
+#include "libavcodec/avcodec.h"
 };
-#include "ADM_default.h"
 
 #ifdef BIG_ENDIAN
 #undef BIG_ENDIAN

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/ADM_ffmp43.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/ADM_ffmp43.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -13,15 +13,9 @@
  *                                                                         *
  ***************************************************************************/
 
-extern "C" {
-#include "ADM_lavcodec.h"
-}
 #include "ADM_default.h"
-
-#include "ADM_codec.h"
 #include "ADM_ffmp43.h"
 #include "DIA_coreToolkit.h"
-//#include "ADM_videoInfoExtractor.h"
 
 extern int ADM_cpu_num_processors(void);
 extern "C"
@@ -583,7 +577,6 @@
 }
 
 //***************
-extern uint8_t  lavformat_init(void);
 extern void     avcodec_init(void );
 extern  void    avcodec_register_all(void );
 extern "C"
@@ -598,8 +591,8 @@
 {
     avcodec_init();
     avcodec_register_all();
-//BAZOOKA    lavformat_init();
     av_log_set_callback(adm_lavLogCallback);
+
 #ifdef ADM_DEBUG
   //  av_log_set_level(AV_LOG_DEBUG);
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -14,9 +14,9 @@
                                           ADM_coreImage6 
                                           ADM_coreUI6
                                           ADM_coreUtils6
-                                          ADM_libavcodec6
-                                          ADM_libavformat6
-                                          ADM_libavutil6)
+                                          ADM_libavcodec
+                                          ADM_libavformat
+                                          ADM_libavutil)
 ADM_INSTALL_LIB(ADM_coreVideoCodec6)
 
 REMOVE_DEFINITIONS(-DHAVE_CONFIG_H)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/include/ADM_coreVideoEncoderFFmpeg_param.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/include/ADM_coreVideoEncoderFFmpeg_param.h	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/include/ADM_coreVideoEncoderFFmpeg_param.h	2010-12-27 19:46:51 UTC (rev 6865)
@@ -22,7 +22,8 @@
 #define ADM_AVCODEC_SETTING_VERSION 2
 extern "C" 
 {
-#include "ADM_lavcodec.h"
+#include "libavcodec/avcodec.h"
 }
+
 #include "FFcodecContext.h"
 #endif

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/ADM_coreVideoEncoder.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/ADM_coreVideoEncoder.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/ADM_coreVideoEncoder.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -15,13 +15,15 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "ADM_coreVideoEncoder.h"
+
 extern "C" 
 {
-#include "ADM_lavcodec.h"
+#include "libavcodec/avcodec.h"
 }
+
 /**
     \fn ADM_coreVideoEncoder
 */                          

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -4,7 +4,7 @@
 )
 
 ADD_LIBRARY(ADM_coreVideoEncoder6 SHARED ${ADM_CoreVideoEncoder_SRCS})
-TARGET_LINK_LIBRARIES(ADM_coreVideoEncoder6 ADM_core6 ADM_coreUtils6 ADM_coreImage6 ADM_libavcodec6 ADM_libavutil6 )
+TARGET_LINK_LIBRARIES(ADM_coreVideoEncoder6 ADM_core6 ADM_coreUtils6 ADM_coreImage6 ADM_libavcodec ADM_libavutil)
 
 ADM_INSTALL_LIB(ADM_coreVideoEncoder6)
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoFilter/src/DIA_flyDialog.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -12,16 +12,14 @@
 *                                                                         *
 ***************************************************************************///
 
-#include "ADM_includeFfmpeg.h"
 #include "ADM_default.h"
-
 #include "ADM_coreVideoFilter.h"
 #define ADM_FLY_INTERNAL
 #include "DIA_flyDialog.h"
 #include "ADM_assert.h"
 
 extern "C" {
-#include "ADM_ffmpeg/libavcodec/avcodec.h"
+#include "libavcodec/avcodec.h"
 }
 /**
     \fn    ADM_flyDialog

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -23,12 +23,6 @@
 	checkVDPAU()
 ENDIF(NOT CROSS)
 
-########################################
-# YASM
-########################################
-include(FindYasm)
-admFindYasm()
-
 #########################################
 # Debug Summary
 ########################################
@@ -51,6 +45,11 @@
 include(admCoreIncludes)
 
 ########################################
+# Build FFmpeg
+########################################
+include(admFFmpegBuild)
+
+########################################
 # Directories to build
 ########################################
 ADD_SUBDIRECTORY(ADM_core)
@@ -69,7 +68,6 @@
 ADD_SUBDIRECTORY(ADM_coreUtils)
 ADD_SUBDIRECTORY(ADM_coreVideoEncoder)
 ADD_SUBDIRECTORY(ADM_coreVideoFilter)
-ADD_SUBDIRECTORY(ADM_ffmpeg)
 ADD_SUBDIRECTORY(ADM_coreJobs)
 ADD_SUBDIRECTORY(ADM_coreSocket)
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ima_adpcm/ADM_ad_ima_adpcm.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ima_adpcm/ADM_ad_ima_adpcm.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ima_adpcm/ADM_ad_ima_adpcm.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -32,8 +32,8 @@
  ***************************************************************************/
 #include "ADM_default.h"
 #include <math.h>
-#define ADM_NO_CONFIG_H
-#include "ADM_ffmpeg/libavutil/bswap.h"
+
+#include "libavutil/bswap.h"
 #include "ADM_ad_plugin.h"
 
 /**

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_lav/ADM_ad_lav.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_lav/ADM_ad_lav.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_lav/ADM_ad_lav.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -13,8 +13,13 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_lavcodec.h"
+
 #include "ADM_default.h"
+
+extern "C" {
+#include "libavcodec/avcodec.h"
+}
+
 #include "ADM_ad_plugin.h"
 #include "fourcc.h"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_lav/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_lav/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_lav/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -1,10 +1,9 @@
+INCLUDE(ad_plugin)
 
-	INCLUDE(ad_plugin)
-	
-	SET(ADM_ad_lav_SRCS ADM_ad_lav.cpp)
+SET(ADM_ad_lav_SRCS ADM_ad_lav.cpp)
 
-	ADD_LIBRARY(ADM_ad_lav SHARED ${ADM_ad_lav_SRCS})
-	TARGET_LINK_LIBRARIES(ADM_ad_lav ADM_coreUtils6 ADM_libavcodec6 ADM_libavutil6)
+ADD_LIBRARY(ADM_ad_lav SHARED ${ADM_ad_lav_SRCS})
+TARGET_LINK_LIBRARIES(ADM_ad_lav ADM_coreUtils6 ADM_libavcodec ADM_libavutil)
 
-	INIT_AUDIO_PLUGIN(ADM_ad_lav)
-	INSTALL_AUDIODECODER(ADM_ad_lav)
+INIT_AUDIO_PLUGIN(ADM_ad_lav)
+INSTALL_AUDIODECODER(ADM_ad_lav)
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ms_adpcm/ADM_ad_ms_adpcm.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ms_adpcm/ADM_ad_ms_adpcm.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ms_adpcm/ADM_ad_ms_adpcm.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -71,7 +71,6 @@
 
 
 #include "ADM_default.h"
-#define ADM_NO_CONFIG_H
 #include "ADM_coreAudio.h"
 #include "ADM_audiocodec.h"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/lavcodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/lavcodec/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/lavcodec/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -1,12 +1,11 @@
 	INCLUDE(ae_plugin)
-
-        include_directories(.)
+	include_directories(.)
 #====
 	SET(ADM_ae_lav_mp2_SRCS audioencoder_lavcodec.cpp)
 
 	ADD_LIBRARY(ADM_ae_lav_mp2 SHARED ${ADM_ae_lav_mp2_SRCS})
 	ADD_TARGET_CFLAGS(ADM_ae_lav_mp2 "-DADM_AE_SET='\"ADM_lav_mp2.h\"'")
-	TARGET_LINK_LIBRARIES(ADM_ae_lav_mp2  ADM_libavcodec6)
+	TARGET_LINK_LIBRARIES(ADM_ae_lav_mp2  ADM_libavcodec)
 
 	INIT_AUDIO_ENCODER(ADM_ae_lav_mp2)
 	INSTALL_AUDIOENCODER(ADM_ae_lav_mp2)
@@ -15,7 +14,7 @@
 
 	ADD_LIBRARY(ADM_ae_lav_ac3 SHARED ${ADM_ae_lav_ac3_SRCS})
 	ADD_TARGET_CFLAGS(ADM_ae_lav_ac3 "-DADM_AE_SET='\"ADM_lav_ac3.h\"'")
-	TARGET_LINK_LIBRARIES(ADM_ae_lav_ac3  ADM_libavcodec6)
+	TARGET_LINK_LIBRARIES(ADM_ae_lav_ac3  ADM_libavcodec)
 
 	INIT_AUDIO_ENCODER(ADM_ae_lav_ac3)
 	INSTALL_AUDIOENCODER(ADM_ae_lav_ac3)
@@ -24,9 +23,8 @@
 
 	ADD_LIBRARY(ADM_ae_lav_aac SHARED ${ADM_ae_lav_aac_SRCS})
 	ADD_TARGET_CFLAGS(ADM_ae_lav_aac "-DADM_AE_SET='\"ADM_lav_aac.h\"'")
-	TARGET_LINK_LIBRARIES(ADM_ae_lav_aac  ADM_libavcodec6)
+	TARGET_LINK_LIBRARIES(ADM_ae_lav_aac  ADM_libavcodec)
 
 	INIT_AUDIO_ENCODER(ADM_ae_lav_aac)
 	INSTALL_AUDIOENCODER(ADM_ae_lav_aac)
-#====
-
+#====
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioEncoders/lavcodec/audioencoder_lavcodec.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -16,17 +16,17 @@
  *                                                                         *
  ***************************************************************************/
 
-#include "ADM_includeFfmpeg.h"
 #include "ADM_default.h"
+
+extern "C" {
+#include "libavcodec/avcodec.h"
+}
+
 #include "DIA_factory.h"
 #include "DIA_coreToolkit.h"
 #include "audioencoder.h"
 #include "audioencoderInternal.h"
-//
 
-
-#include "ADM_lavcodec.h"
-
 #include ADM_AE_SET
 
 #include "audioencoder_lavcodec.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Asf/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Asf/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Asf/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -10,9 +10,5 @@
 
 ADD_LIBRARY(ADM_dm_asf SHARED ${ADM_asf_SRCS})
 
-#TARGET_LINK_LIBRARIES(ADM_dm_asf ADM_libavutil6)
-
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg")
-
 INIT_DEMUXER(ADM_dm_asf)
 INSTALL_DEMUXER(ADM_dm_asf)

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Flv/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Flv/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Flv/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -7,9 +7,7 @@
 
 ADD_LIBRARY(ADM_dm_flv SHARED ${ADM_flv_SRCS})
 
-TARGET_LINK_LIBRARIES(ADM_dm_flv ADM_libavutil6)
+TARGET_LINK_LIBRARIES(ADM_dm_flv ADM_libavutil)
 
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg")
-
 INIT_DEMUXER(ADM_dm_flv)
 INSTALL_DEMUXER(ADM_dm_flv)

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/Matroska/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -11,7 +11,7 @@
 )
 ADD_LIBRARY(ADM_dm_matroska SHARED ${ADM_matroska_SRCS})
 
-TARGET_LINK_LIBRARIES(ADM_dm_matroska ADM_libavutil6 ADM_audioParser6)
+TARGET_LINK_LIBRARIES(ADM_dm_matroska ADM_libavutil ADM_audioParser6)
 
 INIT_DEMUXER(ADM_dm_matroska)
 INSTALL_DEMUXER(ADM_dm_matroska)

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_demuxers/MpegTS/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -17,11 +17,11 @@
 )
 
 ADD_LIBRARY(ADM_dm_ts SHARED ${ADM_ts_SRCS})
-TARGET_LINK_LIBRARIES(ADM_dm_ts ADM_coreDemuxerMpeg6 ADM_audioParser6  ADM_libavutil6 ADM_libavcodec6 ADM_libavformat6)
+TARGET_LINK_LIBRARIES(ADM_dm_ts ADM_coreDemuxerMpeg6 ADM_audioParser6  ADM_libavutil ADM_libavcodec ADM_libavformat)
+
 # For ffmpeg includes
 INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/") 
 INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries") 
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg") 
 INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_coreDemuxerMpeg/include")
 
 INIT_DEMUXER(ADM_dm_ts)

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerDummy/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerDummy/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerDummy/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -6,9 +6,5 @@
 
 ADD_LIBRARY(ADM_mx_dummy SHARED ${ADM_dummy_SRCS})
 
-#TARGET_LINK_LIBRARIES(ADM_dm_flv ADM_libavutil)
-
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg")
-
 INIT_MUXER(ADM_mx_dummy)
 INSTALL_MUXER(ADM_mx_dummy)

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerFlv/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerFlv/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerFlv/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -6,8 +6,7 @@
 )
 
 ADD_LIBRARY(ADM_mx_flv SHARED ${ADM_flv_SRCS})
-TARGET_LINK_LIBRARIES(ADM_mx_flv  ADM_libavutil6 ADM_libavformat6 ADM_libavcodec6)
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg")
+TARGET_LINK_LIBRARIES(ADM_mx_flv  ADM_libavutil ADM_libavformat ADM_libavcodec)
 
 INIT_MUXER(ADM_mx_flv)
 INSTALL_MUXER(ADM_mx_flv)

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerFlv/muxerFlv.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerFlv/muxerFlv.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerFlv/muxerFlv.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -16,7 +16,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "fourcc.h"
 #include "muxerFlv.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerFlv/muxerFlvConfig.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerFlv/muxerFlvConfig.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerFlv/muxerFlvConfig.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -12,7 +12,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "ADM_muxerInternal.h"
 #include "muxerFlv.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerFlv/muxerFlvPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerFlv/muxerFlvPlugin.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerFlv/muxerFlvPlugin.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -13,7 +13,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "ADM_muxerInternal.h"
 #include "muxerFlv.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMkv/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMkv/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMkv/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -7,8 +7,7 @@
 
 ADD_LIBRARY(ADM_mx_Mkv SHARED ${ADM_Mkv_SRCS})
 
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg")
-TARGET_LINK_LIBRARIES(ADM_mx_Mkv  ADM_libavutil6 ADM_libavcodec6 ADM_libavformat6)
+TARGET_LINK_LIBRARIES(ADM_mx_Mkv  ADM_libavutil ADM_libavcodec ADM_libavformat)
 INIT_MUXER(ADM_mx_Mkv)
 INSTALL_MUXER(ADM_mx_Mkv)
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMkv/muxerMkv.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMkv/muxerMkv.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMkv/muxerMkv.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -16,7 +16,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "fourcc.h"
 #include "muxerMkv.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMkv/muxerMkvConfig.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMkv/muxerMkvConfig.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMkv/muxerMkvConfig.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -12,7 +12,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "ADM_muxerInternal.h"
 #include "muxerMkv.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMkv/muxerMkvPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMkv/muxerMkvPlugin.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMkv/muxerMkvPlugin.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -13,7 +13,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "ADM_muxerInternal.h"
 #include "muxerMkv.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -7,8 +7,6 @@
 
 ADD_LIBRARY(ADM_mx_mp4 SHARED ${ADM_mp4_SRCS})
 
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg")
-TARGET_LINK_LIBRARIES(ADM_mx_mp4  ADM_libavutil6 ADM_libavcodec6 ADM_libavformat6)
+TARGET_LINK_LIBRARIES(ADM_mx_mp4  ADM_libavutil ADM_libavcodec ADM_libavformat)
 INIT_MUXER(ADM_mx_mp4)
-INSTALL_MUXER(ADM_mx_mp4)
-
+INSTALL_MUXER(ADM_mx_mp4)
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4/muxerMP4.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4/muxerMP4.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4/muxerMP4.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -16,7 +16,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "fourcc.h"
 #include "muxerMP4.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4/muxerMP4Config.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4/muxerMP4Config.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4/muxerMP4Config.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -12,7 +12,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "ADM_muxerInternal.h"
 #include "muxerMP4.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4/muxerMP4Plugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4/muxerMP4Plugin.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4/muxerMP4Plugin.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -13,7 +13,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "ADM_muxerInternal.h"
 #include "muxerMP4.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffPS/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffPS/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffPS/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -7,8 +7,7 @@
 
 ADD_LIBRARY(ADM_mx_ffPS SHARED ${ADM_ffPS_SRCS})
 
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg")
-TARGET_LINK_LIBRARIES(ADM_mx_ffPS  ADM_libavutil6 ADM_libavcodec6 ADM_libavformat6)
+TARGET_LINK_LIBRARIES(ADM_mx_ffPS  ADM_libavutil ADM_libavcodec ADM_libavformat)
 INIT_MUXER(ADM_mx_ffPS)
 INSTALL_MUXER(ADM_mx_ffPS)
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffPS/muxerffPS.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffPS/muxerffPS.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffPS/muxerffPS.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -16,7 +16,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "fourcc.h"
 #include "muxerffPS.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffPS/muxerffPSConfig.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffPS/muxerffPSConfig.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffPS/muxerffPSConfig.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -12,7 +12,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "ADM_muxerInternal.h"
 #include "muxerffPS.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffPS/muxerffPSPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffPS/muxerffPSPlugin.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffPS/muxerffPSPlugin.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -13,7 +13,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "ADM_muxerInternal.h"
 #include "muxerffPS.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -7,8 +7,7 @@
 
 ADD_LIBRARY(ADM_mx_ffTS SHARED ${ADM_ffTS_SRCS})
 
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg")
-TARGET_LINK_LIBRARIES(ADM_mx_ffTS  ADM_libavutil6 ADM_libavcodec6 ADM_libavformat6)
+TARGET_LINK_LIBRARIES(ADM_mx_ffTS  ADM_libavutil ADM_libavcodec ADM_libavformat)
 INIT_MUXER(ADM_mx_ffTS)
 INSTALL_MUXER(ADM_mx_ffTS)
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTS.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTS.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTS.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -16,7 +16,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "fourcc.h"
 #include "muxerffTS.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTSConfig.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTSConfig.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTSConfig.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -12,7 +12,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "ADM_muxerInternal.h"
 #include "muxerffTS.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTSPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTSPlugin.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerffTS/muxerffTSPlugin.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -13,7 +13,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "ADM_muxerInternal.h"
 #include "muxerffTS.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffFlv1/ADM_ffFlv1.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffFlv1/ADM_ffFlv1.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffFlv1/ADM_ffFlv1.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -15,7 +15,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_lavcodec.h"
+
 #include "ADM_default.h"
 #include "ADM_ffFlv1.h"
 #undef ADM_MINIMAL_UI_INTERFACE // we need the full UI

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffFlv1/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffFlv1/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffFlv1/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -10,6 +10,5 @@
 
 INIT_VIDEO_ENCODER(ADM_ve_ffFlv1)
 INSTALL_VIDEO_ENCODER(ADM_ve_ffFlv1)
-TARGET_LINK_LIBRARIES(ADM_ve_ffFlv1 ADM_libavcodec6 ADM_libavutil6)
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/")
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg")
+TARGET_LINK_LIBRARIES(ADM_ve_ffFlv1 ADM_libavcodec ADM_libavutil)
+INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/")
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffFlv1/ffFlv1Plugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffFlv1/ffFlv1Plugin.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffFlv1/ffFlv1Plugin.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -15,7 +15,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "ADM_ffFlv1.h"
 #include "ADM_coreVideoEncoderInternal.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg2/ADM_ffMpeg2.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg2/ADM_ffMpeg2.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg2/ADM_ffMpeg2.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -15,7 +15,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_lavcodec.h"
+
 #include "ADM_default.h"
 #include "ADM_ffMpeg2.h"
 #undef ADM_MINIMAL_UI_INTERFACE // we need the full UI

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg2/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg2/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg2/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -10,6 +10,5 @@
 
 INIT_VIDEO_ENCODER(ADM_ve_ffMpeg2)
 INSTALL_VIDEO_ENCODER(ADM_ve_ffMpeg2)
-TARGET_LINK_LIBRARIES(ADM_ve_ffMpeg2 ADM_libavcodec6 ADM_libavutil6)
+TARGET_LINK_LIBRARIES(ADM_ve_ffMpeg2 ADM_libavcodec ADM_libavutil)
 INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/")
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg")

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg2/ffMpeg2Plugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg2/ffMpeg2Plugin.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg2/ffMpeg2Plugin.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -15,7 +15,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "ADM_ffMpeg2.h"
 #include "ADM_coreVideoEncoderInternal.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg4/ADM_ffMpeg4.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg4/ADM_ffMpeg4.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg4/ADM_ffMpeg4.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -15,7 +15,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_lavcodec.h"
+
 #include "ADM_default.h"
 #include "ADM_ffMpeg4.h"
 #undef ADM_MINIMAL_UI_INTERFACE // we need the full UI

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg4/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg4/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -10,6 +10,5 @@
 
 INIT_VIDEO_ENCODER(ADM_ve_ffMpeg4)
 INSTALL_VIDEO_ENCODER(ADM_ve_ffMpeg4)
-TARGET_LINK_LIBRARIES(ADM_ve_ffMpeg4 ADM_libavcodec6 ADM_libavutil6)
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/")
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg")
+TARGET_LINK_LIBRARIES(ADM_ve_ffMpeg4 ADM_libavcodec ADM_libavutil)
+INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/")
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg4/ffMpeg4Plugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg4/ffMpeg4Plugin.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMpeg4/ffMpeg4Plugin.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -15,7 +15,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "ADM_ffMpeg4.h"
 #include "ADM_coreVideoEncoderInternal.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMsMpeg4/ADM_ffMsMp4.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMsMpeg4/ADM_ffMsMp4.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMsMpeg4/ADM_ffMsMp4.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -15,7 +15,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_lavcodec.h"
+
 #include "ADM_default.h"
 #include "ADM_ffMsMp4.h"
 #undef ADM_MINIMAL_UI_INTERFACE // we need the full UI

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMsMpeg4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMsMpeg4/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMsMpeg4/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -10,6 +10,5 @@
 
 INIT_VIDEO_ENCODER(ADM_ve_ffMsMp4)
 INSTALL_VIDEO_ENCODER(ADM_ve_ffMsMp4)
-TARGET_LINK_LIBRARIES(ADM_ve_ffMsMp4 ADM_libavcodec6 ADM_libavutil6)
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/")
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg")
+TARGET_LINK_LIBRARIES(ADM_ve_ffMsMp4 ADM_libavcodec ADM_libavutil)
+INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/")
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMsMpeg4/ffMsMp4Plugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMsMpeg4/ffMsMp4Plugin.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/ffMsMpeg4/ffMsMp4Plugin.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -15,7 +15,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "ADM_ffMsMp4.h"
 #include "ADM_coreVideoEncoderInternal.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/ADM_huffEncoder.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/ADM_huffEncoder.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/ADM_huffEncoder.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -15,7 +15,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_lavcodec.h"
+
 #include "ADM_default.h"
 #include "ADM_huffEncoder.h"
 #include "DIA_factory.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -9,7 +9,6 @@
 ADD_LIBRARY(ADM_ve_huff SHARED ${huff_SRCS})
 
 INIT_VIDEO_ENCODER(ADM_ve_huff)
-INSTALL_VIDEO_ENCODER(ADM_ve_huff)
-TARGET_LINK_LIBRARIES(ADM_ve_huff ADM_libavcodec6 ADM_libavutil6)
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/")
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg")
+INSTALL_VIDEO_ENCODER(ADM_ve_huff)
+TARGET_LINK_LIBRARIES(ADM_ve_huff ADM_libavcodec ADM_libavutil)
+INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/")
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/huffPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/huffPlugin.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/huff/huffPlugin.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -15,7 +15,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "ADM_huffEncoder.h"
 #include "ADM_coreVideoEncoderInternal.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/jpeg/ADM_jpegEncoder.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/jpeg/ADM_jpegEncoder.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/jpeg/ADM_jpegEncoder.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -15,10 +15,11 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_lavcodec.h"
+
 #include "ADM_default.h"
 #include "ADM_jpegEncoder.h"
 #include "DIA_factory.h"
+
 jpeg_encoder jpegConf= {ADM_COLOR_YV12,2};
 /**
         \fn ADM_jpegEncoder

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/jpeg/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/jpeg/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/jpeg/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -9,7 +9,6 @@
 ADD_LIBRARY(ADM_ve_jpeg SHARED ${jpeg_SRCS})
 
 INIT_VIDEO_ENCODER(ADM_ve_jpeg)
-INSTALL_VIDEO_ENCODER(ADM_ve_jpeg)
-TARGET_LINK_LIBRARIES(ADM_ve_jpeg ADM_libavcodec6 ADM_libavutil6)
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/")
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg")
+INSTALL_VIDEO_ENCODER(ADM_ve_jpeg)
+TARGET_LINK_LIBRARIES(ADM_ve_jpeg ADM_libavcodec ADM_libavutil)
+INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/")
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/jpeg/jpegPlugin.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/jpeg/jpegPlugin.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/jpeg/jpegPlugin.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -15,7 +15,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "ADM_coreVideoEncoderInternal.h"
 #include "ADM_jpegEncoder.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Equalizer/gtk/DIA_equalizer.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Equalizer/gtk/DIA_equalizer.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Equalizer/gtk/DIA_equalizer.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -28,7 +28,7 @@
 #include "ADM_vidEqualizer.h"
 #include "ADM_colorspace.h"
 extern "C" {
-#include "../../../ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
+#include "libavcodec/avcodec.h"
 }
 
 static ColYuvRgb    *rgbConv=NULL;

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ForcedPP/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ForcedPP/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ForcedPP/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -1,5 +1,4 @@
 INCLUDE(vf_plugin)
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg/ADM_libpostproc")
 
 SET(ADM_vf_forcedPP_SRCS ADM_vidForcedPP.cpp)
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/MPDelogo/ADM_vidMPdelogo.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/MPDelogo/ADM_vidMPdelogo.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/MPDelogo/ADM_vidMPdelogo.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -8,15 +8,12 @@
  ***************************************************************************/
 
 #include "ADM_default.h"
-
-
 #include "ADM_videoFilterDynamic.h"
 
-
 extern "C" {
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavutil/avutil.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h"
+#include "libavcodec/avcodec.h"
+#include "libavutil/avutil.h"
+#include "libswscale/swscale.h"
 }
 
 #include "ADM_vidMPdelogo.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/MPDelogo/gtk/DIA_mpdelogo.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/MPDelogo/gtk/DIA_mpdelogo.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/MPDelogo/gtk/DIA_mpdelogo.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -24,14 +24,13 @@
 
 #include "ADM_toolkitGtk.h"
 
-
 #include "ADM_image.h"
 #include "ADM_videoFilter.h"
 #include "ADM_colorspace.h"
 #include "ADM_vidMPdelogo.h"
 
 extern "C" {
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
+#include "libavcodec/avcodec.h"
 }
 
 static GtkWidget	*create_dialog1 (void);

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/McDeint/ADM_vidMcDeint.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/McDeint/ADM_vidMcDeint.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/McDeint/ADM_vidMcDeint.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -22,7 +22,6 @@
 */
 
 #include "ADM_default.h"
-#include "ADM_lavcodec.h"
 #include "ADM_videoFilterDynamic.h"
 #include "ADM_vidMcDeint_param.h"
 #include "DIA_factory.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Mosaic/ADM_vidMosaic.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Mosaic/ADM_vidMosaic.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Mosaic/ADM_vidMosaic.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -16,15 +16,12 @@
  ***************************************************************************/
 #include "ADM_default.h"
 #include "ADM_videoFilterDynamic.h"
-
 #include "DIA_factory.h"
 
-
 extern "C" {
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavcodec/avcodec.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_lavutil/avutil.h"
-#include "ADM_libraries/ADM_ffmpeg/ADM_libswscale/swscale.h"
-
+#include "libavcodec/avcodec.h"
+#include "libavutil/avutil.h"
+#include "libswscale/swscale.h"
 }
 
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/lavDeint/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/lavDeint/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/lavDeint/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -5,7 +5,7 @@
 
 ADD_VIDEO_FILTER(ADM_vf_lavDeint ${ADM_vf_lavDeint_SRCS})
 IF(DO_COMMON)
-  TARGET_LINK_LIBRARIES(ADM_vf_lavDeint ADM_libpostproc6 )
+  TARGET_LINK_LIBRARIES(ADM_vf_lavDeint ADM_libpostproc)
 ENDIF(DO_COMMON)
 INIT_VIDEO_FILTER(ADM_vf_lavDeint)
 INSTALL_VIDEO_FILTER(ADM_vf_lavDeint)

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/lavDeint/lavDeint.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/lavDeint/lavDeint.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/lavDeint/lavDeint.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -15,13 +15,12 @@
  *                                                                         *
  ***************************************************************************/
 
-#include "ADM_includeFfmpeg.h"
-#include "ADM_lavcodec.h"
+#include "ADM_default.h"
+
 extern "C" {
-#include "ADM_ffmpeg/libpostproc/postprocess.h"
+#include "libpostproc/postprocess.h"
 }
 
-#include "ADM_default.h"
 #include "ADM_coreVideoFilterInternal.h"
 #include "DIA_factory.h"
 #include "lav.h"

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/resize/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/resize/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/resize/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -10,7 +10,7 @@
 SET(ADM_vf_swscaleResize_QT4_UI      qt4/resizing)
 INIT_VIDEO_FILTER_QT4(ADM_vf_swscaleResize_qt4 ${ADM_vf_swscaleResize_QT4_SRCS} ${ADM_vf_swscaleResize_QT4_Headers} ${ADM_vf_swscaleResize_QT4_UI} ${ADM_vf_swscaleResize_SRCS})
 IF(DO_QT4)
-    TARGET_LINK_LIBRARIES(ADM_vf_swscaleResize_qt4 ADM_libswscale6 )
+    TARGET_LINK_LIBRARIES(ADM_vf_swscaleResize_qt4 ADM_libswscale)
 ENDIF(DO_QT4)
 # /QT4
 
@@ -20,7 +20,7 @@
 SET(ADM_vf_swscaleResize_GTK_SRCS    gtk/gtk_resize.cpp)
 INIT_VIDEO_FILTER_GTK(ADM_vf_swscaleResize_gtk ${ADM_vf_swscaleResize_GTK_SRCS} ${ADM_vf_swscaleResize_SRCS})
 IF(DO_GTK)
-    TARGET_LINK_LIBRARIES(ADM_vf_swscaleResize_gtk ADM_libswscale6 )
+    TARGET_LINK_LIBRARIES(ADM_vf_swscaleResize_gtk ADM_libswscale)
 ENDIF(DO_GTK)
 
 # ----------------- CLI Version -----------------------
@@ -28,7 +28,7 @@
 SET(ADM_vf_swscaleResize_CLI_SRCS    cli/cli_resize.cpp)
 INIT_VIDEO_FILTER_CLI(ADM_vf_swscaleResize_cli ${ADM_vf_swscaleResize_SRCS} ${ADM_vf_swscaleResize_CLI_SRCS})
 IF(DO_CLI)
-    TARGET_LINK_LIBRARIES(ADM_vf_swscaleResize_cli ADM_libswscale6 )
+    TARGET_LINK_LIBRARIES(ADM_vf_swscaleResize_cli ADM_libswscale)
 ENDIF(DO_CLI)
 
 # /QT4

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/resize/swScaleResize.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/resize/swScaleResize.cpp	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/resize/swScaleResize.cpp	2010-12-27 19:46:51 UTC (rev 6865)
@@ -14,15 +14,17 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "ADM_includeFfmpeg.h"
+
 #include "ADM_default.h"
 #include "ADM_coreVideoFilterInternal.h"
 #include "DIA_factory.h"
+
 extern "C" {
-#include "ADM_ffmpeg/libavcodec/avcodec.h"
-#include "ADM_ffmpeg/libavutil/avutil.h"
-#include "ADM_ffmpeg/libswscale/swscale.h"
+#include "libavcodec/avcodec.h"
+#include "libavutil/avutil.h"
+#include "libswscale/swscale.h"
 }
+
 #include "swresize.h"
 #include "swresize_desc.cpp"
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -37,6 +37,9 @@
 LINK_DIRECTORIES("${AVIDEMUX_LIB_DIR}")
 INCLUDE_DIRECTORIES(${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/)
 
+include(admFFmpegUtil)
+registerFFmpeg("${CMAKE_SOURCE_DIR}/../ffmpeg" "${AVIDEMUX_LIB_DIR}" 1)
+
 IF (FRESH_BUILD)
 	MESSAGE("")
 ENDIF (FRESH_BUILD)

Modified: branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/cmake/ADM_coreConfig.h.cmake	2010-12-27 19:46:51 UTC (rev 6865)
@@ -21,8 +21,6 @@
 
 // use vdpau h264 hw decoding 
 #cmakedefine USE_VDPAU
-// use yasm
-#cmakedefine USE_YASM
 
 // 'gettimeofday' function is present
 #cmakedefine HAVE_GETTIMEOFDAY

Added: branches/avidemux_2.6_branch_mean/cmake/FindPatch.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/FindPatch.cmake	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/FindPatch.cmake	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,19 @@
+if (NOT PATCH_EXECUTABLE)
+	message(STATUS "Checking for patch")
+	message(STATUS "******************")
+
+	find_program(PATCH_EXECUTABLE patch)
+	set(PATCH_EXECUTABLE ${PATCH_EXECUTABLE} CACHE STRING "")
+
+	if (PATCH_EXECUTABLE)
+		message(STATUS "Found patch")
+		
+		if (VERBOSE)
+			message(STATUS "Path: ${PATCH_EXECUTABLE}")
+		endif (VERBOSE)
+	else (PATCH_EXECUTABLE)
+		message(FATAL_ERROR "patch not found")
+	endif (PATCH_EXECUTABLE)
+
+	message("")
+endif (NOT PATCH_EXECUTABLE)
\ No newline at end of file

Deleted: branches/avidemux_2.6_branch_mean/cmake/FindYasm.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/FindYasm.cmake	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/cmake/FindYasm.cmake	2010-12-27 19:46:51 UTC (rev 6865)
@@ -1,46 +0,0 @@
-# - Extract information from a subversion working copy
-MACRO(admFindYasm )
-
-FIND_PROGRAM(YASM_EXECUTABLE yasm
-  DOC "yasm command line assembler")
-MARK_AS_ADVANCED(YASM_EXECUTABLE)
-
-IF(YASM_EXECUTABLE)
-        
-        SET(EXE  "cd ${_dir}&& ${GIT_EXECUTABLE} svn log | head -2  | grep '^r' | sed 's/ .*$//g'" )
-        MESSAGE(STATUS "Found yasm")
-        SET(USE_YASM 1)
-        IF(WIN32)
-           IF(ADM_CPU_X86_64)
-                SET(YASM_FLAGS -f win64 )
-           ELSE(ADM_CPU_X86_64)
-                SET(YASM_FLAGS -f win32 -DPREFIX)
-           ENDIF(ADM_CPU_X86_64)
-        ELSE(WIN32)
-                IF(APPLE)
-                        SET(YASM_FLAGS -f macho -DPREFIX -DPIC)
-                ELSE(APPLE)
-                        SET(YASM_FLAGS -f elf -DPIC -g dwarf2)
-                ENDIF(APPLE)
-        ENDIF(WIN32)
-        IF(ADM_CPU_X86_64)
-                SET(YASM_FLAGS ${YASM_FLAGS} -DARCH_X86_64 -m amd64)
-        ELSE(ADM_CPU_X86_64)
-                SET(YASM_FLAGS ${YASM_FLAGS} -DARCH_X86_32)
-        ENDIF(ADM_CPU_X86_64)
-        MESSAGE(STATUS "Found yasm, flags ${YASM_FLAGS}")
-MACRO(YASM_COMPILE _in _out _inc)
-        ADD_CUSTOM_COMMAND(
-                OUTPUT ${_out}
-                COMMAND ${CMAKE_COMMAND} -E echo "Generating" ${_out} "from" ${_in}
-                COMMAND ${YASM_EXECUTABLE} -i ${_inc}  ${YASM_FLAGS} ${_in} -o ${_out}
-                DEPENDS ${_in}
-                VERBATIM
-                )
-ENDMACRO(YASM_COMPILE)
-
-ENDIF(YASM_EXECUTABLE)
-
-ENDMACRO(admFindYasm )
-
-# 

Modified: branches/avidemux_2.6_branch_mean/cmake/admConfigSummary.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admConfigSummary.cmake	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/cmake/admConfigSummary.cmake	2010-12-27 19:46:51 UTC (rev 6865)
@@ -26,7 +26,6 @@
 ADM_DISPLAY("SDL       " "${USE_SDL}")
 ADM_DISPLAY("XVideo    " "${USE_XV}" "${XVIDEO_CAPABLE}")
 ADM_DISPLAY("VDPAU     " "${USE_VDPAU}" )
-ADM_DISPLAY("YASM      " "${USE_YASM}" )
 
 MESSAGE("*********************")
 

Modified: branches/avidemux_2.6_branch_mean/cmake/admCoreIncludes.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCoreIncludes.cmake	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/cmake/admCoreIncludes.cmake	2010-12-27 19:46:51 UTC (rev 6865)
@@ -1,6 +1,5 @@
 INCLUDE_DIRECTORIES(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core)
 INCLUDE_DIRECTORIES(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core/ADM_core/include)
-INCLUDE_DIRECTORIES(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core/ADM_ffmpeg)
 INCLUDE_DIRECTORIES(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core/ADM_coreAudioFilter/include)
 INCLUDE_DIRECTORIES(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core/ADM_coreAudioParser/include)
 INCLUDE_DIRECTORIES(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core/ADM_coreAudio/include)
@@ -17,6 +16,4 @@
 INCLUDE_DIRECTORIES(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core/ADM_coreVideoCodec/include)
 INCLUDE_DIRECTORIES(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core/ADM_coreImageLoader/include)
 INCLUDE_DIRECTORIES(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core/ADM_coreJobs/include)
-INCLUDE_DIRECTORIES(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core/ADM_ffmpeg)
-INCLUDE_DIRECTORIES(${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/)
-
+INCLUDE_DIRECTORIES(${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/)
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,186 @@
+include(admFFmpegUtil)
+
+set(FFMPEG_VERSION 26061)	# http://git.ffmpeg.org/?p=ffmpeg;a=snapshot;h=2be4fa05c5528073bcfc472d1c23f2d77b679a9d;sf=tgz
+set(SWSCALE_VERSION 32676)	# http://git.ffmpeg.org/?p=libswscale;a=snapshot;h=d1a43021d9198868fa7a023a30e5ee9e09a907d3;sf=tgz
+
+set(FFMPEG_SOURCE_DIR "${CMAKE_SOURCE_DIR}/../ffmpeg")
+set(FFMPEG_BINARY_DIR "${CMAKE_BINARY_DIR}/ffmpeg")
+
+set(FFMPEG_DECODERS  adpcm_ima_amv  amv  bmp  cinepak  cyuv  dca  dvbsub  dvvideo  ffv1  ffvhuff  flv  fraps  h263  h264  huffyuv  mjpeg
+					 mjpegb  mpeg2video  mpeg4  msmpeg4v2  msmpeg4v3  msvideo1  nellymoser  png  qdm2  rawvideo  snow  svq3  theora  tscc
+					 vc1  vp3  vp6  vp6a  vp6f  wmav2  wmv1  wmv2  wmv3)
+set(FFMPEG_ENCODERS  ac3  dvvideo  ffv1  ffvhuff  flv  h263  huffyuv  mjpeg  mp2  mpeg1video  mpeg2video  mpeg4  snow)
+set(FFMPEG_MUXERS  flv  matroska  mpeg1vcd  mpeg2dvd  mpeg2svcd  mpegts  mov  mp4  psp)
+set(FFMPEG_PARSERS  ac3  h263  h264  mpeg4video)
+set(FFMPEG_PROTOCOLS  file)
+set(FFMPEG_FLAGS  --enable-shared --disable-static --disable-everything --enable-hwaccels --enable-postproc --enable-gpl 
+				  --enable-runtime-cpudetect --disable-network --disable-ffplay --disable-ffprobe --prefix=${CMAKE_INSTALL_PREFIX})
+
+include(admFFmpegPrepareTar)
+
+if (NOT FFMPEG_PREPARED)
+	include(admFFmpegPrepareSvn)
+endif (NOT FFMPEG_PREPARED)
+
+if (NOT VERBOSE)
+	set(ffmpegBuildOutput OUTPUT_VARIABLE FFMPEG_CONFIGURE_OUTPUT)
+endif (NOT VERBOSE)
+
+message("")
+
+if (FFMPEG_PERFORM_PATCH)
+	find_package(Patch)
+	file(GLOB patchFiles "${CMAKE_SOURCE_DIR}/../cmake/patches/*.patch")
+
+	foreach(patchFile ${patchFiles})
+		execute_process(COMMAND ${PATCH_EXECUTABLE} -p0 -i "${patchFile}"
+						WORKING_DIRECTORY "${FFMPEG_SOURCE_DIR}")
+	endforeach(patchFile)
+
+	if (UNIX)
+		patch_file("${FFMPEG_SOURCE_DIR}" "${CMAKE_MODULE_PATH}/patches/common.mak.diff")
+	endif (UNIX)
+
+	message("")
+endif (FFMPEG_PERFORM_PATCH)
+
+# Configure FFmpeg, if required
+foreach (decoder ${FFMPEG_DECODERS})
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-decoder=${decoder})
+endforeach (decoder)
+
+foreach (encoder ${FFMPEG_ENCODERS})
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-encoder=${encoder})
+endforeach (encoder)
+
+foreach (muxer ${FFMPEG_MUXERS})
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-muxer=${muxer})
+endforeach (muxer)
+
+foreach (parser ${FFMPEG_PARSERS})
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-parser=${parser})
+endforeach (parser)
+
+foreach (protocol ${FFMPEG_PROTOCOLS})
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-protocol=${protocol})
+endforeach (protocol)
+
+if (WIN32)
+	if (ADM_CPU_X86_32)
+		set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-memalign-hack)
+	endif (ADM_CPU_X86_32)
+
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-w32threads)
+else (WIN32)
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-pthreads)
+endif (WIN32)
+
+if (NOT ADM_DEBUG)
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --disable-debug)
+endif (NOT ADM_DEBUG)
+
+if (CMAKE_C_FLAGS)
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --extra-cflags=${CMAKE_C_FLAGS})
+endif (CMAKE_C_FLAGS)
+
+if (CMAKE_SHARED_LINKER_FLAGS)
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --extra-ldflags=${CMAKE_SHARED_LINKER_FLAGS})
+endif (CMAKE_SHARED_LINKER_FLAGS)
+
+if (CROSS_ARCH OR CROSS_OS)
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-cross-compile)
+endif (CROSS_ARCH OR CROSS_OS)
+
+if (CROSS_ARCH)
+	set(CROSS_ARCH "${CROSS_ARCH}" CACHE STRING "")
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --arch=${CROSS_ARCH})
+endif (CROSS_ARCH)
+
+if (CROSS_OS)
+	set(CROSS_OS "${CROSS_OS}" CACHE STRING "")
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --target-os=${CROSS_OS})
+endif (CROSS_OS)
+
+if (FF_FLAGS)
+	set(FF_FLAGS "${FF_FLAGS}" CACHE STRING "")
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} ${FF_FLAGS})
+endif (FF_FLAGS)
+
+if (NOT "${LAST_FFMPEG_FLAGS}" STREQUAL "${FFMPEG_FLAGS}")
+	set(FFMPEG_PERFORM_BUILD 1)
+endif (NOT "${LAST_FFMPEG_FLAGS}" STREQUAL "${FFMPEG_FLAGS}")
+
+if (NOT EXISTS "${FFMPEG_BINARY_DIR}/Makefile")
+	set(FFMPEG_PERFORM_BUILD 1)
+endif (NOT EXISTS "${FFMPEG_BINARY_DIR}/Makefile")
+
+if (FFMPEG_PERFORM_BUILD)
+	message(STATUS "Configuring FFmpeg")
+	set(LAST_FFMPEG_FLAGS "${FFMPEG_FLAGS}" CACHE STRING "" FORCE)
+
+	file(MAKE_DIRECTORY "${FFMPEG_BINARY_DIR}")
+	file(REMOVE "${FFMPEG_BINARY_DIR}/ffmpeg${CMAKE_EXECUTABLE_SUFFIX}")
+	file(REMOVE "${FFMPEG_BINARY_DIR}/ffmpeg_g${CMAKE_EXECUTABLE_SUFFIX}")
+
+	execute_process(COMMAND sh ${FFMPEG_SOURCE_DIR}/configure ${FFMPEG_FLAGS}
+					WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}"
+					${ffmpegBuildOutput})
+
+	if (ADM_CPU_X86)
+		file(READ ${FFMPEG_BINARY_DIR}/config.h FF_CONFIG_H)
+		string(REGEX MATCH "#define[ ]+HAVE_YASM[ ]+1" FF_YASM "${FF_CONFIG_H}")
+
+		if (NOT FF_YASM)
+			message(FATAL_ERROR "Yasm was not found.")
+		endif (NOT FF_YASM)
+
+		if (WIN32)
+			string(REGEX MATCH "#define[ ]+CONFIG_DXVA2[ ]+1" FF_DXVA2 "${FF_CONFIG_H}")
+			
+			if (NOT FF_DXVA2)
+				message(FATAL_ERROR "DXVA2 not detected.  Ensure the dxva2api.h system header exists (available from Microsoft or http://downloads.videolan.org/pub/videolan/testing/contrib/dxva2api.h).")
+			endif (NOT FF_DXVA2)
+		endif (WIN32)
+	endif (ADM_CPU_X86)
+
+	execute_process(COMMAND ${CMAKE_COMMAND} -E make_directory "libavutil"
+					WORKING_DIRECTORY "${CMAKE_BINARY_DIR}/config")
+
+	execute_process(COMMAND ${CMAKE_COMMAND} -E copy "./libavutil/avconfig.h" "${CMAKE_BINARY_DIR}/config/libavutil"
+					WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}")
+
+	if (APPLE)
+		find_patch()
+		patch_file("${FFMPEG_BINARY_DIR}" "${CMAKE_SOURCE_DIR}/cmake/patches/config_macosx.mak.diff")
+	elseif (UNIX)
+		find_patch()
+		patch_file("${FFMPEG_BINARY_DIR}" "${CMAKE_SOURCE_DIR}/cmake/patches/config.mak.diff")
+	endif (APPLE)
+
+	message("")
+endif (FFMPEG_PERFORM_BUILD)
+
+# Build FFmpeg
+add_custom_command(OUTPUT "${FFMPEG_BINARY_DIR}/ffmpeg${CMAKE_EXECUTABLE_SUFFIX}"
+				   COMMAND ${CMAKE_COMMAND} -DCMAKE_BUILD_TOOL=${CMAKE_BUILD_TOOL} -P "${CMAKE_SOURCE_DIR}/../cmake/admFFmpegMake.cmake"
+				   WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}")
+
+add_custom_target(ffmpeg ALL
+				  DEPENDS "${FFMPEG_BINARY_DIR}/ffmpeg${CMAKE_EXECUTABLE_SUFFIX}")
+
+# Add and install libraries
+registerFFmpeg("${FFMPEG_SOURCE_DIR}" "${FFMPEG_BINARY_DIR}" 0)
+
+install(FILES "${FFMPEG_BINARY_DIR}/libswscale/${LIBSWSCALE_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
+install(FILES "${FFMPEG_BINARY_DIR}/libpostproc/${LIBPOSTPROC_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
+install(FILES "${FFMPEG_BINARY_DIR}/libavutil/${LIBAVUTIL_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
+install(FILES "${FFMPEG_BINARY_DIR}/libavcodec/${LIBAVCODEC_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
+install(FILES "${FFMPEG_BINARY_DIR}/libavformat/${LIBAVFORMAT_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
+install(FILES "${FFMPEG_BINARY_DIR}/libavcore/${LIBAVCORE_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
+install(FILES "${FFMPEG_BINARY_DIR}/libavutil/avconfig.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libavutil") 
+
+# Clean FFmpeg
+add_custom_target(cleanffmpeg
+				  COMMAND ${CMAKE_COMMAND} -P "${CMAKE_SOURCE_DIR}/cmake/admFFmpegClean.cmake"
+				  WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}"
+				  COMMENT "Cleaning FFmpeg")

Added: branches/avidemux_2.6_branch_mean/cmake/admFFmpegClean.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegClean.cmake	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegClean.cmake	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,2 @@
+execute_process(COMMAND make clean
+				WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}")
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/cmake/admFFmpegMake.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegMake.cmake	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegMake.cmake	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1 @@
+execute_process(COMMAND ${CMAKE_BUILD_TOOL})
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareSvn.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareSvn.cmake	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareSvn.cmake	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,54 @@
+find_package(Subversion)
+
+if (NOT VERBOSE)
+	set(ffmpegSvnOutput OUTPUT_VARIABLE FFMPEG_SVN_OUTPUT)
+	set(swscaleSvnOutput OUTPUT_VARIABLE SWSCALE_SVN_OUTPUT)
+endif (NOT VERBOSE)
+
+# Checkout FFmpeg source and patch it
+if (NOT IS_DIRECTORY "${FFMPEG_SOURCE_DIR}/.svn")
+	message(STATUS "Checking out FFmpeg")
+	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} co svn://svn.ffmpeg.org/ffmpeg/trunk -r ${FFMPEG_VERSION} --ignore-externals "${FFMPEG_SOURCE_DIR}"
+					${ffmpegSvnOutput})
+
+	message(STATUS "Checking out libswscale")
+	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} co svn://svn.ffmpeg.org/mplayer/trunk/libswscale -r ${SWSCALE_VERSION} "${FFMPEG_SOURCE_DIR}/libswscale"
+					${swscaleSvnOutput})
+
+	message("")
+
+	set(FFMPEG_PERFORM_PATCH 1)
+endif (NOT IS_DIRECTORY "${FFMPEG_SOURCE_DIR}/.svn")
+
+# Check version
+Subversion_WC_INFO(${FFMPEG_SOURCE_DIR} ffmpeg)
+message(STATUS "FFmpeg revision: ${ffmpeg_WC_REVISION}")
+
+if (NOT ${ffmpeg_WC_REVISION} EQUAL ${FFMPEG_VERSION})
+	MESSAGE(STATUS "Updating to revision ${FFMPEG_VERSION}")
+	set(FFMPEG_PERFORM_BUILD 1)
+	set(FFMPEG_PERFORM_PATCH 1)
+
+	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} revert -R "${FFMPEG_SOURCE_DIR}"
+					${ffmpegSvnOutput})
+	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} up -r ${FFMPEG_VERSION} --ignore-externals "${FFMPEG_SOURCE_DIR}"
+					${ffmpegSvnOutput})	
+
+	message("")
+endif (NOT ${ffmpeg_WC_REVISION} EQUAL ${FFMPEG_VERSION})
+
+message("")
+
+Subversion_WC_INFO(${FFMPEG_SOURCE_DIR}/libswscale swscale)
+message(STATUS "libswscale revision: ${swscale_WC_REVISION}")
+
+if (NOT ${swscale_WC_REVISION} EQUAL ${SWSCALE_VERSION})
+	message(STATUS "Updating to revision ${SWSCALE_VERSION}")
+	set(FFMPEG_PERFORM_BUILD 1)
+	set(FFMPEG_PERFORM_PATCH 1)
+
+	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} revert -R "${FFMPEG_SOURCE_DIR}/libswscale"
+					${swscaleSvnOutput})
+	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} up -r ${SWSCALE_VERSION} "${FFMPEG_SOURCE_DIR}/libswscale"
+					${swscaleSvnOutput})
+endif (NOT ${swscale_WC_REVISION} EQUAL ${SWSCALE_VERSION})
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareTar.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareTar.cmake	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareTar.cmake	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,34 @@
+if (NOT VERBOSE)
+	set(ffmpegExtractOutput OUTPUT_VARIABLE FFMPEG_EXTRACT_OUTPUT)
+endif (NOT VERBOSE)
+
+set(FFMPEG_SOURCE_ARCHIVE "ffmpeg_r${FFMPEG_VERSION}.tar.gz")
+set(SWSCALE_SOURCE_ARCHIVE "libswscale_r${SWSCALE_VERSION}.tar.gz")
+
+if (EXISTS "${LIBRARY_SOURCE_DIR}/${FFMPEG_SOURCE_ARCHIVE}" AND EXISTS "${LIBRARY_SOURCE_DIR}/${SWSCALE_SOURCE_ARCHIVE}")
+	if (NOT EXISTS "${FFMPEG_SOURCE_DIR}/ffmpeg.c" OR NOT ${LAST_FFMPEG_VERSION} EQUAL ${FFMPEG_VERSION})
+		find_package(Tar)
+
+		execute_process(COMMAND ${TAR_EXECUTABLE} xvf ${FFMPEG_SOURCE_ARCHIVE}
+					WORKING_DIRECTORY "${LIBRARY_SOURCE_DIR}"
+					${ffmpegExtractOutput})
+
+		set(FFMPEG_PERFORM_PATCH 1)
+		set(FFMPEG_PERFORM_BUILD 1)
+	endif (NOT EXISTS "${FFMPEG_SOURCE_DIR}/ffmpeg.c" OR NOT ${LAST_FFMPEG_VERSION} EQUAL ${FFMPEG_VERSION})
+
+	if (NOT EXISTS "${FFMPEG_SOURCE_DIR}/libswscale/swscale.c" OR NOT ${LAST_SWSCALE_VERSION} EQUAL ${SWSCALE_VERSION})
+		find_package(Tar)
+
+		execute_process(COMMAND ${TAR_EXECUTABLE} xvf ../${SWSCALE_SOURCE_ARCHIVE}
+					WORKING_DIRECTORY "${FFMPEG_SOURCE_DIR}"
+					${ffmpegExtractOutput})
+
+		set(FFMPEG_PERFORM_PATCH 1)
+		set(FFMPEG_PERFORM_BUILD 1)
+	endif (NOT EXISTS "${FFMPEG_SOURCE_DIR}/libswscale/swscale.c" OR NOT ${LAST_SWSCALE_VERSION} EQUAL ${SWSCALE_VERSION})
+
+	set(FFMPEG_PREPARED 1)
+	set(LAST_FFMPEG_VERSION "${FFMPEG_VERSION}" CACHE STRING "" FORCE)
+	set(LAST_SWSCALE_VERSION "${SWSCALE_VERSION}" CACHE STRING "" FORCE)
+endif (EXISTS "${LIBRARY_SOURCE_DIR}/${FFMPEG_SOURCE_ARCHIVE}" AND EXISTS "${LIBRARY_SOURCE_DIR}/${SWSCALE_SOURCE_ARCHIVE}")
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/cmake/admFFmpegUtil.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegUtil.cmake	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegUtil.cmake	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,72 @@
+MACRO (getFfmpegVersionFromHeader description headerFile definition ffmpegVersion)
+	FILE(READ "${headerFile}" FFMPEG_H)
+	STRING(REGEX MATCH "#define[ ]+${definition}[ ]+([0-9]+)" FFMPEG_H "${FFMPEG_H}")
+	STRING(REGEX REPLACE ".*[ ]([0-9]+).*" "\\1" ${ffmpegVersion} "${FFMPEG_H}")
+ENDMACRO (getFfmpegVersionFromHeader)
+
+MACRO (getFfmpegLibNames sourceDir)
+	getFfmpegVersionFromHeader("libavcodec" "${sourceDir}/libavcodec/avcodec.h" LIBAVCODEC_VERSION_MAJOR LIBAVCODEC_VERSION)
+	getFfmpegVersionFromHeader("libavcore" "${sourceDir}/libavcore/avcore.h" LIBAVCORE_VERSION_MAJOR LIBAVCORE_VERSION)	
+	getFfmpegVersionFromHeader("libavformat" "${sourceDir}/libavformat/avformat.h" LIBAVFORMAT_VERSION_MAJOR LIBAVFORMAT_VERSION)
+	getFfmpegVersionFromHeader("libavutil" "${sourceDir}/libavutil/avutil.h" LIBAVUTIL_VERSION_MAJOR LIBAVUTIL_VERSION)
+	getFfmpegVersionFromHeader("libpostproc" "${sourceDir}/libpostproc/postprocess.h" LIBPOSTPROC_VERSION_MAJOR LIBPOSTPROC_VERSION)
+	getFfmpegVersionFromHeader("libswscale" "${sourceDir}/libswscale/swscale.h" LIBSWSCALE_VERSION_MAJOR LIBSWSCALE_VERSION)
+
+	if (UNIX)
+		set(LIBAVCODEC_ADM ADM5)
+	endif (UNIX)
+
+	if (APPLE)
+		set(LIBAVCODEC_LIB lib${LIBAVCODEC_ADM}avcodec.${LIBAVCODEC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBAVCORE_LIB lib${LIBAVCODEC_ADM}avcore.${LIBAVCORE_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBAVFORMAT_LIB lib${LIBAVCODEC_ADM}avformat.${LIBAVFORMAT_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBAVUTIL_LIB lib${LIBAVCODEC_ADM}avutil.${LIBAVUTIL_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBPOSTPROC_LIB lib${LIBAVCODEC_ADM}postproc.${LIBPOSTPROC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBSWSCALE_LIB lib${LIBAVCODEC_ADM}swscale.${LIBSWSCALE_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+	elseif (UNIX)
+		set(LIBAVCODEC_LIB lib${LIBAVCODEC_ADM}avcodec${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBAVCODEC_VERSION})
+		set(LIBAVCORE_LIB lib${LIBAVCODEC_ADM}avcore${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBAVCORE_VERSION})
+		set(LIBAVFORMAT_LIB lib${LIBAVCODEC_ADM}avformat${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBAVFORMAT_VERSION})
+		set(LIBAVUTIL_LIB lib${LIBAVCODEC_ADM}avutil${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBAVUTIL_VERSION})
+		set(LIBPOSTPROC_LIB lib${LIBAVCODEC_ADM}postproc${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBPOSTPROC_VERSION})
+		set(LIBSWSCALE_LIB lib${LIBAVCODEC_ADM}swscale${CMAKE_SHARED_LIBRARY_SUFFIX}.${LIBSWSCALE_VERSION})
+	else (APPLE)
+		set(LIBAVCODEC_LIB ${LIBAVCODEC_ADM}avcodec-${LIBAVCODEC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBAVCORE_LIB ${LIBAVCODEC_ADM}avcore-${LIBAVCORE_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBAVFORMAT_LIB ${LIBAVCODEC_ADM}avformat-${LIBAVFORMAT_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBAVUTIL_LIB ${LIBAVCODEC_ADM}avutil-${LIBAVUTIL_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBPOSTPROC_LIB ${LIBAVCODEC_ADM}postproc-${LIBPOSTPROC_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+		set(LIBSWSCALE_LIB ${LIBAVCODEC_ADM}swscale-${LIBSWSCALE_VERSION}${CMAKE_SHARED_LIBRARY_SUFFIX})
+	endif (APPLE)
+ENDMACRO (getFfmpegLibNames)
+
+MACRO (registerFFmpeg sourceDir binaryDir installed)
+	getFfmpegLibNames("${sourceDir}")
+
+	add_library(ADM_libswscale UNKNOWN IMPORTED)
+	add_library(ADM_libpostproc UNKNOWN IMPORTED)
+	add_library(ADM_libavutil UNKNOWN IMPORTED)
+	add_library(ADM_libavcodec UNKNOWN IMPORTED)
+	add_library(ADM_libavformat UNKNOWN IMPORTED)
+	add_library(ADM_libavcore UNKNOWN IMPORTED)
+
+	if (${installed})
+		set_property(TARGET ADM_libswscale PROPERTY IMPORTED_LOCATION "${binaryDir}/${LIBSWSCALE_LIB}")
+		set_property(TARGET ADM_libpostproc PROPERTY IMPORTED_LOCATION "${binaryDir}/${LIBPOSTPROC_LIB}")
+		set_property(TARGET ADM_libavutil PROPERTY IMPORTED_LOCATION "${binaryDir}/${LIBAVUTIL_LIB}")
+		set_property(TARGET ADM_libavcodec PROPERTY IMPORTED_LOCATION "${binaryDir}/${LIBAVCODEC_LIB}")
+		set_property(TARGET ADM_libavformat PROPERTY IMPORTED_LOCATION "${binaryDir}/${LIBAVFORMAT_LIB}")
+		set_property(TARGET ADM_libavcore PROPERTY IMPORTED_LOCATION "${binaryDir}/${LIBAVCORE_LIB}")
+	else (${installed})
+		set_property(TARGET ADM_libswscale PROPERTY IMPORTED_LOCATION "${binaryDir}/libswscale/${LIBSWSCALE_LIB}")
+		set_property(TARGET ADM_libpostproc PROPERTY IMPORTED_LOCATION "${binaryDir}/libpostproc/${LIBPOSTPROC_LIB}")
+		set_property(TARGET ADM_libavutil PROPERTY IMPORTED_LOCATION "${binaryDir}/libavutil/${LIBAVUTIL_LIB}")
+		set_property(TARGET ADM_libavcodec PROPERTY IMPORTED_LOCATION "${binaryDir}/libavcodec/${LIBAVCODEC_LIB}")
+		set_property(TARGET ADM_libavformat PROPERTY IMPORTED_LOCATION "${binaryDir}/libavformat/${LIBAVFORMAT_LIB}")
+		set_property(TARGET ADM_libavcore PROPERTY IMPORTED_LOCATION "${binaryDir}/libavcore/${LIBAVCORE_LIB}")
+	endif (${installed})
+
+	include_directories("${sourceDir}")
+	include_directories("${sourceDir}/libavutil")
+	include_directories("${sourceDir}/libpostproc")
+ENDMACRO (registerFFmpeg)
\ No newline at end of file

Added: branches/avidemux_2.6_branch_mean/cmake/patches/common.mak.diff
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/common.mak.diff	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/common.mak.diff	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,13 @@
+Index: common.mak
+===================================================================
+--- common.mak	(revision 18300)
++++ common.mak	(working copy)
+@@ -62,7 +62,7 @@
+ FFLIBS    := $(FFLIBS-yes) $(FFLIBS)
+ TESTPROGS += $(TESTPROGS-yes)
+ 
+-FFEXTRALIBS := $(addprefix -l,$(addsuffix $(BUILDSUF),$(FFLIBS))) $(EXTRALIBS)
++FFEXTRALIBS := $(addprefix -lADM5,$(addsuffix $(BUILDSUF),$(FFLIBS))) $(EXTRALIBS)
+ FFLDFLAGS   := $(addprefix -L$(BUILD_ROOT)/lib,$(ALLFFLIBS)) $(LDFLAGS)
+ 
+ EXAMPLES  := $(addprefix $(SUBDIR),$(addsuffix -example$(EXESUF),$(EXAMPLES)))

Added: branches/avidemux_2.6_branch_mean/cmake/patches/config.mak.diff
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/config.mak.diff	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/config.mak.diff	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,11 @@
+--- config.mak.old	2009-05-01 19:26:13.808782802 +0200
++++ config.mak	2009-05-01 18:10:25.000085291 +0200
+@@ -60,7 +60,7 @@
+ BUILD_SHARED=yes
+ PIC=-fPIC -DPIC
+ LIBTARGET=
+-SLIBNAME=$(SLIBPREF)$(FULLNAME)$(SLIBSUF)
++SLIBNAME=$(SLIBPREF)ADM6$(FULLNAME)$(SLIBSUF)
+ SLIBNAME_WITH_VERSION=$(SLIBNAME).$(LIBVERSION)
+ SLIBNAME_WITH_MAJOR=$(SLIBNAME).$(LIBMAJOR)
+ SLIB_CREATE_DEF_CMD=

Added: branches/avidemux_2.6_branch_mean/cmake/patches/config_macosx.mak.diff
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/config_macosx.mak.diff	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/config_macosx.mak.diff	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,13 @@
+--- config.mak.old	2009-05-01 19:26:13.808782802 +0200
++++ config.mak	2009-05-01 18:10:25.000085291 +0200
+@@ -60,7 +60,7 @@
+ INSTALL=install
+ LIBTARGET=
+-SLIBNAME=$(SLIBPREF)$(FULLNAME)$(SLIBSUF)
+-SLIBNAME_WITH_VERSION=$(SLIBPREF)$(FULLNAME).$(LIBVERSION)$(SLIBSUF)
+-SLIBNAME_WITH_MAJOR=$(SLIBPREF)$(FULLNAME).$(LIBMAJOR)$(SLIBSUF)
++SLIBNAME=$(SLIBPREF)ADM6$(FULLNAME)$(SLIBSUF)
++SLIBNAME_WITH_VERSION=$(SLIBPREF)ADM5$(FULLNAME).$(LIBVERSION)$(SLIBSUF)
++SLIBNAME_WITH_MAJOR=$(SLIBPREF)ADM5$(FULLNAME).$(LIBMAJOR)$(SLIBSUF)
+ SLIB_CREATE_DEF_CMD=
+ SLIB_EXTRA_CMD=

Added: branches/avidemux_2.6_branch_mean/cmake/patches/createPatches.sh
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/createPatches.sh	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/createPatches.sh	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,35 @@
+#!/bin/bash
+
+export curDir=$PWD
+export ffmpegPath=../../avidemux/ADM_libraries/ffmpeg
+
+function updatePatch {
+	cd $ffmpegPath
+	cp $1/$2 $1/$2.new
+	svn revert $1/$2
+	unix2dos $1/$2
+	unix2dos $1/$2.new
+	mv $1/$2 $1/$2.old
+	mv $1/$2.new $1/$2
+	diff -u $1/$2.old $1/$2 > $curDir/$1_$2.patch
+	rm $1/$2.old
+	cd $curDir
+	dos2unix $1_$2.patch
+}
+
+updatePatch libavcodec avcodec.h
+updatePatch libavcodec ffv1.c
+updatePatch libavcodec h263dec.c
+updatePatch libavcodec h264.c
+updatePatch libavcodec h264_parser.c
+updatePatch libavcodec mpeg12.c
+updatePatch libavcodec mpeg12enc.c
+updatePatch libavcodec mpegvideo.c
+updatePatch libavcodec mpegvideo_enc.c
+updatePatch libavcodec utils.c
+updatePatch libavcodec vc1dec.c
+updatePatch libavformat file.c
+updatePatch libavformat isom.c
+updatePatch libavformat matroskaenc.c
+updatePatch libavutil avutil.h
+

Added: branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_avcodec.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_avcodec.h.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_avcodec.h.patch	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,28 @@
+--- libavcodec/avcodec.h.old	2010-12-20 13:49:18 +0000
++++ libavcodec/avcodec.h	2010-12-20 13:49:18 +0000
+@@ -665,6 +665,8 @@
+ #define CODEC_FLAG2_PSY           0x00080000 ///< Use psycho visual optimizations.
+ #define CODEC_FLAG2_SSIM          0x00100000 ///< Compute SSIM during encoding, error[] values are undefined.
+ #define CODEC_FLAG2_INTRA_REFRESH 0x00200000 ///< Use periodic insertion of intra blocks instead of keyframes.
++//MEANX: NEVER EVER USE CLOSED GOP ?
++#define CODEC_FLAG2_32_PULLDOWN   0x80000000
+ 
+ /* Unsupported options :
+  *              Syntax Arithmetic coding (SAC)
+@@ -1559,6 +1561,7 @@
+      * - decoding: unused
+      */
+     int rc_max_rate;
++    int rc_max_rate_header; /*< That one is set in the header MEANX */
+ 
+     /**
+      * minimum bitrate
+@@ -1573,6 +1576,8 @@
+      * - decoding: unused
+      */
+     int rc_buffer_size;
++    int rc_buffer_size_header;  /*< That one is set in the header MEANX*/
++
+     float rc_buffer_aggressivity;
+ 
+     /**

Added: branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_ff_spsinfo.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_ff_spsinfo.h.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_ff_spsinfo.h.patch	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,22 @@
+Index: libavcodec/ff_spsinfo.h
+===================================================================
+--- libavcodec/ff_spsinfo.h	(revision 0)
++++ libavcodec/ff_spsinfo.h	(revision 0)
+@@ -0,0 +1,17 @@
++#ifndef FF_SPS_INFO_H
++#define FF_SPS_INFO_H
++
++typedef struct
++{
++	int width;
++	int height;
++	int fps1000;
++	int darNum;
++	int darDen;
++	int hasStructInfo;
++	int CpbDpbToSkip;
++}ffSpsInfo;
++
++
++#endif
++

Added: branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_ffv1.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_ffv1.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_ffv1.c.patch	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,11 @@
+--- libavcodec/ffv1.c.old	2010-12-20 13:49:20 +0000
++++ libavcodec/ffv1.c	2010-12-20 13:49:20 +0000
+@@ -1734,6 +1734,8 @@
+         clear_state(f);
+     }else{
+         p->key_frame= 0;
++         p->pict_type= FF_P_TYPE; // MEANX : looks more like a P to me as user
++
+     }
+     if(f->ac>1){
+         int i;

Added: branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h263dec.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h263dec.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h263dec.c.patch	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,56 @@
+--- libavcodec/h263dec.c.old	2010-12-20 13:49:21 +0000
++++ libavcodec/h263dec.c	2010-12-20 13:49:21 +0000
+@@ -120,6 +120,25 @@
+ 
+     return 0;
+ }
++/* MeanX : Ugly patch to detect vo ppacked stuff ... */
++int av_is_voppacked(AVCodecContext *avctx, int *vop_packed, int *gmc, int *qpel);
++
++int av_is_voppacked(AVCodecContext *avctx, int *vop_packed, int *gmc, int *qpel)
++{
++    MpegEncContext *s = avctx->priv_data;
++    // set sane default
++    *vop_packed=0;
++    *gmc=0;
++    *qpel=0;
++    if(avctx->codec->id!=CODEC_ID_MPEG4) return 0;
++    	
++  	*vop_packed=(s->divx_packed);
++	*qpel=s->quarter_sample;
++	*gmc=0;	// FIXME
++	return 1;
++
++  }
++  /* MeanX */
+ 
+ av_cold int ff_h263_decode_end(AVCodecContext *avctx)
+ {
+@@ -422,6 +441,12 @@
+     } else {
+         ret = h263_decode_picture_header(s);
+     }
++	//MEANX we need to do it here also for quicktime file / ctts atom 
++        // we need the correct frame type, and qt file may contain 
++        // vop not coded frame.
++        pict->pict_type=s->current_picture.pict_type= s->pict_type;
++        pict->key_frame=s->current_picture.key_frame= s->pict_type == FF_I_TYPE;
++        //MEANX
+ 
+     if(ret==FRAME_SKIPPED) return get_consumed_bytes(s, buf_size);
+ 
+@@ -717,6 +742,14 @@
+ 
+ assert(s->current_picture.pict_type == s->current_picture_ptr->pict_type);
+ assert(s->current_picture.pict_type == s->pict_type);
++/* MEANX */
++  if(s->current_picture_ptr)
++      s->current_picture_ptr->opaque=pict->opaque;
++/* MEANX */
++
++
++
++
+     if (s->pict_type == FF_B_TYPE || s->low_delay) {
+         *pict= *(AVFrame*)s->current_picture_ptr;
+     } else if (s->last_picture_ptr != NULL) {

Added: branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h264.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h264.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h264.c.patch	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,22 @@
+--- libavcodec/h264.c.old	2010-12-20 13:49:22 +0000
++++ libavcodec/h264.c	2010-12-20 13:49:22 +0000
+@@ -3395,6 +3395,19 @@
+     return 0;
+ }
+ 
++/* MEANX */
++int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc);
++
++int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc)
++{
++      H264Context *h = avctx->priv_data;
++      assert(h);
++      *nalSize=h->nal_length_size;
++      *isAvc=h->is_avc;
++	return 1;
++
++  }
++/* MeanX */
+ 
+ AVCodec h264_decoder = {
+     "h264",

Added: branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h264_parser.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h264_parser.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h264_parser.c.patch	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,55 @@
+--- libavcodec/h264_parser.c.old	2010-12-20 13:49:23 +0000
++++ libavcodec/h264_parser.c	2010-12-20 13:49:23 +0000
+@@ -30,7 +30,52 @@
+ #include "h264data.h"
+ #include "golomb.h"
+ 
++#include "ff_spsinfo.h" // MEANX
+ #include <assert.h>
++ // MEANX
++int ff_h264_info(AVCodecParserContext *parser,ffSpsInfo *info);
++/**
++    \fn AVCodecParserContext
++*/
++int ff_h264_info(AVCodecParserContext *parser,ffSpsInfo *info)
++{
++    H264Context *ctx = parser->priv_data;
++    memset(info,0,sizeof(*info));
++    if(!ctx->sps.mb_width || !ctx->sps.mb_height)
++    {
++        return 0;
++    }
++    info->width=ctx->sps.mb_width  * 16;
++    info->height=(2-ctx->sps.frame_mbs_only_flag)*ctx->sps.mb_height * 16;
++    if(ctx->sps.timing_info_present_flag)
++    {
++            float scale=ctx->sps.time_scale ;
++            float ticks=ctx->sps.num_units_in_tick;
++            info->fps1000 =  (uint32_t) ((scale/ticks) *    1000.);
++#undef printf
++            printf("Scale : %d, tick=%d, fps=%d\n",(int)scale,(int)ticks,(int)info->fps1000);
++    }else
++    {
++            printf("[H264] No timing information\n");
++            info->fps1000=25000;
++    }
++    // D.2.2 SEI Timing present if CpbDbpDelayPresentFlag=1 or pictStructPresent=1
++    // CpbDbpDelayPresentFlag =1 if nal_hdr or vcl_hrd or ???
++    int f=ctx->sps.nal_hrd_parameters_present_flag | ctx->sps.vcl_hrd_parameters_present_flag;
++    info->hasStructInfo=f | ctx->sps.pic_struct_present_flag;;
++    // While decoding SEI, if CpbDpbDelaysPresentFlags is there we skip cpb_removal_delay + dpb_output_delay
++
++    info->CpbDpbToSkip=0;
++    if(f)
++    {
++        info->CpbDpbToSkip=ctx->sps.cpb_removal_delay_length+ctx->sps.dpb_output_delay_length;
++    }
++#warning fixme sar vs dar
++    info->darNum=ctx->sps.sar.num;
++    info->darDen=ctx->sps.sar.den;
++    return 1;
++}
++// /MEANX
+ 
+ 
+ int ff_h264_find_frame_end(H264Context *h, const uint8_t *buf, int buf_size)

Added: branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_mpeg12.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_mpeg12.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_mpeg12.c.patch	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,14 @@
+--- libavcodec/mpeg12.c.old	2010-12-20 13:49:23 +0000
++++ libavcodec/mpeg12.c	2010-12-20 13:49:23 +0000
+@@ -1948,6 +1948,11 @@
+         ff_er_frame_end(s);
+ 
+         MPV_frame_end(s);
++/* MEANX */
++  if(s->current_picture_ptr)
++      s->current_picture_ptr->opaque=pict->opaque;
++/* MEANX */
++
+ 
+         if (s->pict_type == FF_B_TYPE || s->low_delay) {
+             *pict= *(AVFrame*)s->current_picture_ptr;

Added: branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_mpeg12enc.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_mpeg12enc.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_mpeg12enc.c.patch	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,188 @@
+--- libavcodec/mpeg12enc.c.old	2010-12-20 13:49:24 +0000
++++ libavcodec/mpeg12enc.c	2010-12-20 13:49:24 +0000
+@@ -127,10 +127,19 @@
+             s->frame_rate_index= i;
+         }
+     }
++ /* MEANX 
++
+     if(dmin)
+         return -1;
+     else
+         return 0;
++  */
++        if(dmin>4)
++   {
++        av_log(0,AV_LOG_ERROR,"We did a roundup ! Expect async!\n");
++   }
++        return 0; //MEANX
++
+ }
+ 
+ static av_cold int encode_init(AVCodecContext *avctx)
+@@ -209,6 +218,7 @@
+             put_sbits(&s->pb, 12, s->width );
+             put_sbits(&s->pb, 12, s->height);
+ 
++#if 0 //MEANX
+             for(i=1; i<15; i++){
+                 float error= aspect_ratio;
+                 if(s->codec_id == CODEC_ID_MPEG1VIDEO || i <=1)
+@@ -223,20 +233,44 @@
+                     s->aspect_ratio_info= i;
+                 }
+             }
++#endif // MEANX
++            //MEANX put_bits(&s->pb, 4, s->aspect_ratio_info);
++            //MEANX put_bits(&s->pb, 4, s->frame_rate_index);
++ // MEANX 4:3
++  if(s->avctx->sample_aspect_ratio.num==16 && s->avctx->sample_aspect_ratio.den==9)
++            {
++                //printf("FFmpeg : Wide\n");
++                put_bits(&s->pb,4,3); //16:9
++            }
++            else        //4:3
++            {
++              if(s->codec_id == CODEC_ID_MPEG2VIDEO)
++                put_bits(&s->pb, 4, 2);
++              else
++                put_bits(&s->pb, 4, 12); // MPEG1
++            }
++// /MEANX
+ 
+-            put_bits(&s->pb, 4, s->aspect_ratio_info);
+-            put_bits(&s->pb, 4, s->frame_rate_index);
++// //MEANX PULLDOWN            put_bits(&s->pb, 4, s->frame_rate_index);
++if((s->flags2 & CODEC_FLAG2_32_PULLDOWN) && (s->codec_id == CODEC_ID_MPEG2VIDEO))
++            {           
++                put_bits(&s->pb, 4,4);
++            }
++            else
++            {                                  
++                put_bits(&s->pb, 4, s->frame_rate_index);
++            } //MEANX pulldown
+ 
+-            if(s->avctx->rc_max_rate){
+-                v = (s->avctx->rc_max_rate + 399) / 400;
++            if(s->avctx->rc_max_rate_header){ //MEANX we use header
++                v = (s->avctx->rc_max_rate_header + 399) / 400;
+                 if (v > 0x3ffff && s->codec_id == CODEC_ID_MPEG1VIDEO)
+                     v = 0x3ffff;
+             }else{
+                 v= 0x3FFFF;
+             }
+ 
+-            if(s->avctx->rc_buffer_size)
+-                vbv_buffer_size = s->avctx->rc_buffer_size;
++            if(s->avctx->rc_buffer_size_header) // MEANX we use header
++                vbv_buffer_size = s->avctx->rc_buffer_size_header;
+             else
+                 /* VBV calculation: Scaled so that a VCD has the proper VBV size of 40 kilobytes */
+                 vbv_buffer_size = (( 20 * s->bit_rate) / (1151929 / 2)) * 8 * 1024;
+@@ -269,8 +303,17 @@
+ 
+                 put_bits(&s->pb, 3, s->avctx->profile); //profile
+                 put_bits(&s->pb, 4, s->avctx->level); //level
++   // MEANX pulldown put_bits(&s->pb, 1, s->progressive_sequence);
++  // MEANX Pulldown
++ if(s->flags2 & CODEC_FLAG2_32_PULLDOWN) //MEANX
++                        put_bits(&s->pb, 1, 0);
++                else
++                        put_bits(&s->pb, 1, s->progressive_sequence);
++
++
++// /MEANX
++
+ 
+-                put_bits(&s->pb, 1, s->progressive_sequence);
+                 put_bits(&s->pb, 2, s->chroma_format);
+                 put_bits(&s->pb, 2, s->width >>12);
+                 put_bits(&s->pb, 2, s->height>>12);
+@@ -339,6 +382,8 @@
+ 
+ void mpeg1_encode_picture_header(MpegEncContext *s, int picture_number)
+ {
++	int tff,rff; //MEANX
++
+     mpeg1_encode_sequence_header(s);
+ 
+     /* mpeg1 picture header */
+@@ -375,6 +420,49 @@
+ 
+     s->frame_pred_frame_dct = 1;
+     if(s->codec_id == CODEC_ID_MPEG2VIDEO){
++ /* MEANX -- Pulldown */
++        if(s->flags2 & CODEC_FLAG2_32_PULLDOWN)
++        {
++        
++                switch((s->picture_number - 
++                          s->gop_picture_number)&3)
++                {
++                        case 0:
++                        default:
++                                rff=1;
++                                tff=1;
++                                break;
++                        case 1:
++                                rff=0;
++                                tff=0;
++                                break;
++                        case 2:
++                                rff=1;
++                                tff=0;
++                                break;
++                        case 3:
++                                rff=0;
++                                tff=1;
++                                break;
++                }               
++           }
++        else
++        {
++                if (s->progressive_sequence) 
++                {
++                        tff=0; /* no repeat */
++                } else 
++                {
++                        tff= s->current_picture_ptr->top_field_first;
++                }
++                rff=s->repeat_first_field;
++        
++        }
++
++//               /MEANX pulldown
++
++
++
+         put_header(s, EXT_START_CODE);
+         put_bits(&s->pb, 4, 8); //pic ext
+         if (s->pict_type == FF_P_TYPE || s->pict_type == FF_B_TYPE) {
+@@ -393,11 +481,16 @@
+ 
+         assert(s->picture_structure == PICT_FRAME);
+         put_bits(&s->pb, 2, s->picture_structure);
++#if 0 //MEANX
++
+         if (s->progressive_sequence) {
+             put_bits(&s->pb, 1, 0); /* no repeat */
+         } else {
+             put_bits(&s->pb, 1, s->current_picture_ptr->top_field_first);
+         }
++#endif
++         put_bits(&s->pb, 1, tff);  //MEANX PULLDOWN
++
+         /* XXX: optimize the generation of this flag with entropy
+            measures */
+         s->frame_pred_frame_dct = s->progressive_sequence;
+@@ -407,7 +500,10 @@
+         put_bits(&s->pb, 1, s->q_scale_type);
+         put_bits(&s->pb, 1, s->intra_vlc_format);
+         put_bits(&s->pb, 1, s->alternate_scan);
+-        put_bits(&s->pb, 1, s->repeat_first_field);
++ // MEANX put_bits(&s->pb, 1, s->repeat_first_field);
++	put_bits(&s->pb, 1, rff);
++      // /MEANX
++
+         s->progressive_frame = s->progressive_sequence;
+         put_bits(&s->pb, 1, s->chroma_format == CHROMA_420 ? s->progressive_frame : 0); /* chroma_420_type */
+         put_bits(&s->pb, 1, s->progressive_frame);

Added: branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_mpegvideo.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_mpegvideo.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_mpegvideo.c.patch	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,15 @@
+--- libavcodec/mpegvideo.c.old	2010-12-20 13:49:25 +0000
++++ libavcodec/mpegvideo.c	2010-12-20 13:49:25 +0000
+@@ -653,7 +653,11 @@
+     FF_ALLOCZ_OR_GOTO(s->avctx, s->prev_pict_types, PREV_PICT_TYPES_BUFFER_SIZE, fail);
+ 
+     s->parse_context.state= -1;
+-    if((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
++ //MEANX: Allocate them always, as they may be free when we decode 1st image
++
++    // MEANXif((s->avctx->debug&(FF_DEBUG_VIS_QP|FF_DEBUG_VIS_MB_TYPE)) || (s->avctx->debug_mv)){
++if(1){ // MEANX
++
+        s->visualization_buffer[0] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
+        s->visualization_buffer[1] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);
+        s->visualization_buffer[2] = av_malloc((s->mb_width*16 + 2*EDGE_WIDTH) * s->mb_height*16 + 2*EDGE_WIDTH);

Added: branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_mpegvideo_enc.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_mpegvideo_enc.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_mpegvideo_enc.c.patch	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,30 @@
+--- libavcodec/mpegvideo_enc.c.old	2010-12-20 13:49:26 +0000
++++ libavcodec/mpegvideo_enc.c	2010-12-20 13:49:26 +0000
+@@ -367,12 +367,14 @@
+ 
+         av_log(avctx, AV_LOG_INFO, "Warning vbv_delay will be set to 0xFFFF (=VBR) as the specified vbv buffer is too large for the given bitrate!\n");
+     }
++#if 0 //MEANX
+ 
+     if((s->flags & CODEC_FLAG_4MV) && s->codec_id != CODEC_ID_MPEG4
+        && s->codec_id != CODEC_ID_H263 && s->codec_id != CODEC_ID_H263P && s->codec_id != CODEC_ID_FLV1){
+         av_log(avctx, AV_LOG_ERROR, "4MV not supported by codec\n");
+         return -1;
+     }
++#endif
+ 
+     if(s->obmc && s->avctx->mb_decision != FF_MB_DECISION_SIMPLE){
+         av_log(avctx, AV_LOG_ERROR, "OBMC is only supported with simple mb decision\n");
+@@ -413,10 +415,12 @@
+         return -1;
+     }
+ 
++#if 0 //MEANX
+     if(s->mpeg_quant && s->codec_id != CODEC_ID_MPEG4){ //FIXME mpeg2 uses that too
+         av_log(avctx, AV_LOG_ERROR, "mpeg2 style quantization not supported by codec\n");
+         return -1;
+     }
++#endif
+ 
+     if((s->flags & CODEC_FLAG_CBP_RD) && !avctx->trellis){
+         av_log(avctx, AV_LOG_ERROR, "CBP RD needs trellis quant\n");

Added: branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_utils.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_utils.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_utils.c.patch	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,15 @@
+--- libavcodec/utils.c.old	2010-12-20 13:49:27 +0000
++++ libavcodec/utils.c	2010-12-20 13:49:27 +0000
+@@ -659,10 +659,12 @@
+ 
+     if((avctx->codec->capabilities & CODEC_CAP_DELAY) || avpkt->size){
+         //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
++#if 0 // MEANX : Silence
+         if(*frame_size_ptr < AVCODEC_MAX_AUDIO_FRAME_SIZE){
+             av_log(avctx, AV_LOG_ERROR, "buffer smaller than AVCODEC_MAX_AUDIO_FRAME_SIZE\n");
+             return -1;
+         }
++#endif
+         if(*frame_size_ptr < FF_MIN_BUFFER_SIZE ||
+         *frame_size_ptr < avctx->channels * avctx->frame_size * sizeof(int16_t)){
+             av_log(avctx, AV_LOG_ERROR, "buffer %d too small\n", *frame_size_ptr);

Added: branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_vc1dec.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_vc1dec.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_vc1dec.c.patch	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,14 @@
+--- libavcodec/vc1dec.c.old	2010-12-20 13:49:28 +0000
++++ libavcodec/vc1dec.c	2010-12-20 13:49:28 +0000
+@@ -3146,7 +3146,10 @@
+     AVFrame *pict = data;
+     uint8_t *buf2 = NULL;
+     const uint8_t *buf_start = buf;
+-
++/** MEANX **/
++    if(s->flags& CODEC_FLAG_LOW_DELAY)
++        s->low_delay=1;
++/** /MEANX **/
+     /* no supplementary picture */
+     if (buf_size == 0) {
+         /* special case for last picture */

Added: branches/avidemux_2.6_branch_mean/cmake/patches/libavformat_file.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavformat_file.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavformat_file.c.patch	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,78 @@
+--- libavformat/file.c.old	2010-12-20 13:49:28 +0000
++++ libavformat/file.c	2010-12-20 13:49:29 +0000
+@@ -30,6 +30,75 @@
+ #include <stdlib.h>
+ #include "os_support.h"
+ 
++// GRUNTSTER start
++#ifdef __WIN32
++#include <windows.h>
++
++int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString);
++int ADM_open(const char *path, int oflag, ...);
++
++int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString)
++{
++	int wideCharStringLength = MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, NULL, 0);
++
++	if (wideCharString)
++		MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, wideCharString, wideCharStringLength);
++
++	return wideCharStringLength;
++}
++
++int ADM_open(const char *path, int oflag, ...)
++{
++	int fileNameLength = utf8StringToWideChar(path, -1, NULL);
++	wchar_t wcFile[fileNameLength];
++	int creation = 0, access = 0;
++	HANDLE hFile;
++
++	utf8StringToWideChar(path, -1, wcFile);
++
++	if (oflag & O_WRONLY || oflag & O_RDWR)
++	{
++		access = GENERIC_WRITE;
++
++		if (oflag & O_RDWR)
++			access |= GENERIC_READ;
++
++		if (oflag & O_CREAT)
++		{
++			if (oflag & O_EXCL)
++				creation = CREATE_NEW;
++			else if (oflag & O_TRUNC)
++				creation = CREATE_ALWAYS;
++			else
++				creation = OPEN_ALWAYS;
++		}
++		else if (oflag & O_TRUNC)
++			creation = TRUNCATE_EXISTING;
++	}
++	else if (oflag & O_RDONLY)
++		creation = OPEN_EXISTING;
++
++	if (creation & GENERIC_WRITE)
++	{
++		hFile = CreateFileW(wcFile, access, 0, NULL, creation, 0, NULL);
++
++		if (hFile == INVALID_HANDLE_VALUE)
++			return -1;
++		else
++			CloseHandle(hFile);
++	}
++
++	hFile = CreateFileW(wcFile, access, FILE_SHARE_READ, NULL, creation, 0, NULL);
++
++	if (hFile == INVALID_HANDLE_VALUE)
++		return -1;
++	else
++		return _open_osfhandle((intptr_t)hFile, oflag);
++}
++
++#define open ADM_open
++#endif
++// GRUNTSTER end
+ 
+ /* standard file protocol */
+ 

Added: branches/avidemux_2.6_branch_mean/cmake/patches/libavformat_isom.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavformat_isom.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavformat_isom.c.patch	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,14 @@
+--- libavformat/isom.c.old	2010-12-20 13:49:29 +0000
++++ libavformat/isom.c	2010-12-20 13:49:29 +0000
+@@ -222,7 +222,10 @@
+     { CODEC_ID_MP1, MKTAG('.', 'm', 'p', '1') }, /* MPEG layer 1 */
+     { CODEC_ID_MP2, MKTAG('.', 'm', 'p', '2') }, /* MPEG layer 2 */
+ 
+-    { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at http://www.3ivx.com/showcase.html use this tag */
++    //MEANX { CODEC_ID_MP3, MKTAG('.', 'm', 'p', '3') }, /* MPEG layer 3 */ /* sample files at http://www.3ivx.com/showcase.html use this tag */
++     { CODEC_ID_MP3, MKTAG( 'm', 'p', '4','a') },
++     { CODEC_ID_MP2, MKTAG( 'm', 'p', '4', 'a') },
++    // /MEANX
+     { CODEC_ID_MP3, 0x6D730055 }, /* MPEG layer 3 */
+ 
+ /*  { CODEC_ID_OGG_VORBIS, MKTAG('O', 'g', 'g', 'S') }, *//* sample files at http://heroinewarrior.com/xmovie.php3 use this tag */

Added: branches/avidemux_2.6_branch_mean/cmake/patches/libavformat_matroskaenc.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavformat_matroskaenc.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavformat_matroskaenc.c.patch	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,64 @@
+--- libavformat/matroskaenc.c.old	2010-12-20 13:49:30 +0000
++++ libavformat/matroskaenc.c	2010-12-20 13:49:30 +0000
+@@ -410,6 +410,7 @@
+ 
+ static int put_xiph_codecpriv(AVFormatContext *s, ByteIOContext *pb, AVCodecContext *codec)
+ {
++#if 0 // MEANX avidemux does thing differently
+     uint8_t *header_start[3];
+     int header_len[3];
+     int first_header_size;
+@@ -434,6 +435,28 @@
+         put_buffer(pb, header_start[j], header_len[j]);
+ 
+     return 0;
++#else
++   // Not endian safe....
++      uint32_t packetLen[3],*ptr=(uint32_t *)codec->extradata;
++      uint8_t *data[3],i,j;
++      if( 3*4+ptr[0]+ptr[1]+ptr[2]!=codec->extradata_size)
++      {
++        av_log(s, AV_LOG_ERROR, "Broken avidemux xiph header.\n");
++        return -1;
++      }
++      data[0]=codec->extradata+3*4;
++      data[1]=data[0]+ptr[0];
++      data[2]=data[1]+ptr[1];
++      put_byte(pb, 2);                    // number packets - 1
++      for (j = 0; j < 2; j++) 
++      {
++          put_xiph_size(pb, ptr[j]);
++      }
++      for (j = 0; j < 3; j++)
++        put_buffer(pb, data[j], ptr[j]);
++      
++      return 0; // /MEANX
++#endif
+ }
+ 
+ static void get_aac_sample_rates(AVFormatContext *s, AVCodecContext *codec, int *sample_rate, int *output_sample_rate)
+@@ -552,6 +575,24 @@
+         put_ebml_uint (pb, MATROSKA_ID_TRACKUID        , i + 1);
+         put_ebml_uint (pb, MATROSKA_ID_TRACKFLAGLACING , 0);    // no lacing (yet)
+ 
++ 		/**  MEANX : Add a default duration for video **/
++ 		if(codec->codec_type==CODEC_TYPE_VIDEO)
++ 		{
++ 			if(codec->time_base.den && codec->time_base.num)
++ 			{
++ 				int num = codec->time_base.num;
++ 				int den = codec->time_base.den;
++ 				unsigned int default_duration;
++ 				float period = num;
++ 
++ 				period /= den;
++ 				period *= 1000*1000*1000; // in ns
++ 				default_duration = (unsigned int)floor(period);
++ 				put_ebml_uint(pb, MATROSKA_ID_TRACKDEFAULTDURATION, default_duration);
++ 			}
++ 		}
++ 		/**  MEANX : Add a default duration for video **/
++
+         if ((tag = av_metadata_get(st->metadata, "title", NULL, 0)))
+             put_ebml_string(pb, MATROSKA_ID_TRACKNAME, tag->value);
+         tag = av_metadata_get(st->metadata, "language", NULL, 0);

Added: branches/avidemux_2.6_branch_mean/cmake/patches/libavutil_avutil.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavutil_avutil.h.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavutil_avutil.h.patch	2010-12-27 19:46:51 UTC (rev 6865)
@@ -0,0 +1,16 @@
+--- libavutil/avutil.h.old	2010-12-20 13:49:31 +0000
++++ libavutil/avutil.h	2010-12-20 13:49:31 +0000
+@@ -26,6 +26,13 @@
+  * external API header
+  */
+ 
++/* MEANX
++ * - */
++#define ASMALIGN(ZEROBITS) ".p2align " #ZEROBITS "\n\t"
++/* /MEANX
++ */
++
++
+ 
+ #define AV_STRINGIFY(s)         AV_TOSTRING(s)
+ #define AV_TOSTRING(s) #s

Modified: branches/avidemux_2.6_branch_mean/myOwnPlugins/demuxer/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/myOwnPlugins/demuxer/CMakeLists.txt	2010-12-26 10:39:41 UTC (rev 6864)
+++ branches/avidemux_2.6_branch_mean/myOwnPlugins/demuxer/CMakeLists.txt	2010-12-27 19:46:51 UTC (rev 6865)
@@ -1,7 +1,7 @@
-###################################################
-#
-#
-###################################################
+###################################################
+#
+#
+###################################################
 MESSAGE("#####################################")
 MESSAGE("Custom demuxer plugin template Started")
 MESSAGE("#####################################")
@@ -13,8 +13,8 @@
 ########################################
 # Where is the top dir ?
 ########################################
-
-MESSAGE(STATUS "Checking for AVIDEMUX_SOURCE_DIR, AVIDEMUX_LIB_DIR, AVIDEMUX_INCLUDE_DIR...")
+
+MESSAGE(STATUS "Checking for AVIDEMUX_SOURCE_DIR, AVIDEMUX_LIB_DIR, AVIDEMUX_INCLUDE_DIR...")
 IF (NOT AVIDEMUX_SOURCE_DIR)
 	MESSAGE(FATAL_ERROR "Please add -DAVIDEMUX_SOURCE_DIR=path_to_avidemux_source. You just need the source tree.")
 ELSE (NOT AVIDEMUX_TOP_SOURCE_DIR)
@@ -33,10 +33,10 @@
         ## We need AVIDEMUX_INCLUDE_DIR 
 	#SET(AVIDEMUX_INCLUDE_DIR "${AVIDEMUX_INCLUDE_DIR}" CACHE STRING "")
 #ENDIF (NOT AVIDEMUX_INCLUDE_DIR)
-
-
-
-
+
+
+
+
 # Common definitions...
 SET(CMAKE_MODULE_PATH "${AVIDEMUX_TOP_SOURCE_DIR}/cmake" "${CMAKE_MODULE_PATH}")
 include(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux/commonCmakeApplication.cmake)
@@ -61,20 +61,18 @@
 # Global options
 ########################################
 OPTION(VERBOSE "" OFF)
-################################################
-# Now really define our plugin...
-###############################################
+################################################
+# Now really define our plugin...
+###############################################
 
-include(dm_plugin)
-SET(ADM_wtv_SRCS 
-	ADM_wtvAudio.cpp
-        ADM_wtv.cpp  
-        ADM_wtvPlugin.cpp
-)
-
-ADD_LIBRARY(ADM_dm_wtv SHARED ${ADM_wtv_SRCS})
-
-INCLUDE_DIRECTORIES("${AVIDEMUX_SOURCE_DIR}/avidemux/ADM_libraries/ADM_ffmpeg")
-
-INIT_DEMUXER(ADM_dm_wtv)
-INSTALL_DEMUXER(ADM_dm_wtv)
+include(dm_plugin)
+SET(ADM_wtv_SRCS 
+	ADM_wtvAudio.cpp
+        ADM_wtv.cpp  
+        ADM_wtvPlugin.cpp
+)
+
+ADD_LIBRARY(ADM_dm_wtv SHARED ${ADM_wtv_SRCS})
+
+INIT_DEMUXER(ADM_dm_wtv)
+INSTALL_DEMUXER(ADM_dm_wtv)



From gruntster at mail.berlios.de  Mon Dec 27 21:19:20 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 27 Dec 2010 21:19:20 +0100
Subject: [Avidemux-svn-commit] r6866 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101227201920.CFF15480587@sheep.berlios.de>

Author: gruntster
Date: 2010-12-27 21:19:20 +0100 (Mon, 27 Dec 2010)
New Revision: 6866

Modified:
   branches/avidemux_2.6_branch_mean/cmake/FindPatch.cmake
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
Log:
[ffmpeg] cmake fix for unix/apple

Modified: branches/avidemux_2.6_branch_mean/cmake/FindPatch.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/FindPatch.cmake	2010-12-27 19:46:51 UTC (rev 6865)
+++ branches/avidemux_2.6_branch_mean/cmake/FindPatch.cmake	2010-12-27 20:19:20 UTC (rev 6866)
@@ -16,4 +16,9 @@
 	endif (PATCH_EXECUTABLE)
 
 	message("")
-endif (NOT PATCH_EXECUTABLE)
\ No newline at end of file
+endif (NOT PATCH_EXECUTABLE)
+
+macro(patch_file baseDir patchFile)
+	execute_process(COMMAND ${PATCH_EXECUTABLE} -p0 -i "${patchFile}"
+					WORKING_DIRECTORY "${baseDir}")
+endmacro(patch_file)
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-27 19:46:51 UTC (rev 6865)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-27 20:19:20 UTC (rev 6866)
@@ -33,8 +33,7 @@
 	file(GLOB patchFiles "${CMAKE_SOURCE_DIR}/../cmake/patches/*.patch")
 
 	foreach(patchFile ${patchFiles})
-		execute_process(COMMAND ${PATCH_EXECUTABLE} -p0 -i "${patchFile}"
-						WORKING_DIRECTORY "${FFMPEG_SOURCE_DIR}")
+		patch_file("${FFMPEG_SOURCE_DIR}" "${patchFile}")
 	endforeach(patchFile)
 
 	if (UNIX)
@@ -183,4 +182,4 @@
 add_custom_target(cleanffmpeg
 				  COMMAND ${CMAKE_COMMAND} -P "${CMAKE_SOURCE_DIR}/cmake/admFFmpegClean.cmake"
 				  WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}"
-				  COMMENT "Cleaning FFmpeg")
+				  COMMENT "Cleaning FFmpeg")
\ No newline at end of file



From gruntster at mail.berlios.de  Mon Dec 27 23:28:22 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 27 Dec 2010 23:28:22 +0100
Subject: [Avidemux-svn-commit] r6867 - in
	branches/avidemux_2.6_branch_mean/cmake: . patches
Message-ID: <20101227222823.39C33480587@sheep.berlios.de>

Author: gruntster
Date: 2010-12-27 23:28:22 +0100 (Mon, 27 Dec 2010)
New Revision: 6867

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.6_branch_mean/cmake/patches/common.mak.diff
   branches/avidemux_2.6_branch_mean/cmake/patches/config_macosx.mak.diff
Log:
[ffmpeg] cmake fix for unix/apple #2

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-27 20:19:20 UTC (rev 6866)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-27 22:28:22 UTC (rev 6867)
@@ -13,7 +13,7 @@
 set(FFMPEG_MUXERS  flv  matroska  mpeg1vcd  mpeg2dvd  mpeg2svcd  mpegts  mov  mp4  psp)
 set(FFMPEG_PARSERS  ac3  h263  h264  mpeg4video)
 set(FFMPEG_PROTOCOLS  file)
-set(FFMPEG_FLAGS  --enable-shared --disable-static --disable-everything --enable-hwaccels --enable-postproc --enable-gpl 
+set(FFMPEG_FLAGS  --enable-shared --disable-static --disable-everything --disable-avfilter --enable-hwaccels --enable-postproc --enable-gpl 
 				  --enable-runtime-cpudetect --disable-network --disable-ffplay --disable-ffprobe --prefix=${CMAKE_INSTALL_PREFIX})
 
 include(admFFmpegPrepareTar)
@@ -37,7 +37,7 @@
 	endforeach(patchFile)
 
 	if (UNIX)
-		patch_file("${FFMPEG_SOURCE_DIR}" "${CMAKE_MODULE_PATH}/patches/common.mak.diff")
+		patch_file("${FFMPEG_SOURCE_DIR}" "${CMAKE_SOURCE_DIR}/../cmake/patches/common.mak.diff")
 	endif (UNIX)
 
 	message("")
@@ -149,11 +149,11 @@
 					WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}")
 
 	if (APPLE)
-		find_patch()
-		patch_file("${FFMPEG_BINARY_DIR}" "${CMAKE_SOURCE_DIR}/cmake/patches/config_macosx.mak.diff")
+		find_package(Patch)
+		patch_file("${FFMPEG_BINARY_DIR}" "${CMAKE_SOURCE_DIR}/../cmake/patches/config_macosx.mak.diff")
 	elseif (UNIX)
-		find_patch()
-		patch_file("${FFMPEG_BINARY_DIR}" "${CMAKE_SOURCE_DIR}/cmake/patches/config.mak.diff")
+		find_package(Patch)
+		patch_file("${FFMPEG_BINARY_DIR}" "${CMAKE_SOURCE_DIR}/../cmake/patches/config.mak.diff")
 	endif (APPLE)
 
 	message("")

Modified: branches/avidemux_2.6_branch_mean/cmake/patches/common.mak.diff
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/common.mak.diff	2010-12-27 20:19:20 UTC (rev 6866)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/common.mak.diff	2010-12-27 22:28:22 UTC (rev 6867)
@@ -7,7 +7,7 @@
  TESTPROGS += $(TESTPROGS-yes)
  
 -FFEXTRALIBS := $(addprefix -l,$(addsuffix $(BUILDSUF),$(FFLIBS))) $(EXTRALIBS)
-+FFEXTRALIBS := $(addprefix -lADM5,$(addsuffix $(BUILDSUF),$(FFLIBS))) $(EXTRALIBS)
++FFEXTRALIBS := $(addprefix -lADM6,$(addsuffix $(BUILDSUF),$(FFLIBS))) $(EXTRALIBS)
  FFLDFLAGS   := $(addprefix -L$(BUILD_ROOT)/lib,$(ALLFFLIBS)) $(LDFLAGS)
  
  EXAMPLES  := $(addprefix $(SUBDIR),$(addsuffix -example$(EXESUF),$(EXAMPLES)))

Modified: branches/avidemux_2.6_branch_mean/cmake/patches/config_macosx.mak.diff
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/config_macosx.mak.diff	2010-12-27 20:19:20 UTC (rev 6866)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/config_macosx.mak.diff	2010-12-27 22:28:22 UTC (rev 6867)
@@ -7,7 +7,7 @@
 -SLIBNAME_WITH_VERSION=$(SLIBPREF)$(FULLNAME).$(LIBVERSION)$(SLIBSUF)
 -SLIBNAME_WITH_MAJOR=$(SLIBPREF)$(FULLNAME).$(LIBMAJOR)$(SLIBSUF)
 +SLIBNAME=$(SLIBPREF)ADM6$(FULLNAME)$(SLIBSUF)
-+SLIBNAME_WITH_VERSION=$(SLIBPREF)ADM5$(FULLNAME).$(LIBVERSION)$(SLIBSUF)
-+SLIBNAME_WITH_MAJOR=$(SLIBPREF)ADM5$(FULLNAME).$(LIBMAJOR)$(SLIBSUF)
++SLIBNAME_WITH_VERSION=$(SLIBPREF)ADM6$(FULLNAME).$(LIBVERSION)$(SLIBSUF)
++SLIBNAME_WITH_MAJOR=$(SLIBPREF)ADM6$(FULLNAME).$(LIBMAJOR)$(SLIBSUF)
  SLIB_CREATE_DEF_CMD=
  SLIB_EXTRA_CMD=



From gruntster at mail.berlios.de  Mon Dec 27 23:58:14 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Mon, 27 Dec 2010 23:58:14 +0100
Subject: [Avidemux-svn-commit] r6868 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101227225814.8F8C9480587@sheep.berlios.de>

Author: gruntster
Date: 2010-12-27 23:58:14 +0100 (Mon, 27 Dec 2010)
New Revision: 6868

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegUtil.cmake
Log:
[ffmpeg] cmake fix for unix/apple #3

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegUtil.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegUtil.cmake	2010-12-27 22:28:22 UTC (rev 6867)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegUtil.cmake	2010-12-27 22:58:14 UTC (rev 6868)
@@ -13,7 +13,7 @@
 	getFfmpegVersionFromHeader("libswscale" "${sourceDir}/libswscale/swscale.h" LIBSWSCALE_VERSION_MAJOR LIBSWSCALE_VERSION)
 
 	if (UNIX)
-		set(LIBAVCODEC_ADM ADM5)
+		set(LIBAVCODEC_ADM ADM6)
 	endif (UNIX)
 
 	if (APPLE)



From gruntster at mail.berlios.de  Tue Dec 28 14:52:18 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 28 Dec 2010 14:52:18 +0100
Subject: [Avidemux-svn-commit] r6869 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101228135218.9D73A48065D@sheep.berlios.de>

Author: gruntster
Date: 2010-12-28 14:52:18 +0100 (Tue, 28 Dec 2010)
New Revision: 6869

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegUtil.cmake
Log:
[ffmpeg] set ffmpeg build as a dependency for the av* libs (fixes using make with multiple jobs)

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-27 22:58:14 UTC (rev 6868)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-28 13:52:18 UTC (rev 6869)
@@ -160,13 +160,19 @@
 endif (FFMPEG_PERFORM_BUILD)
 
 # Build FFmpeg
-add_custom_command(OUTPUT "${FFMPEG_BINARY_DIR}/ffmpeg${CMAKE_EXECUTABLE_SUFFIX}"
+getFfmpegLibNames("${FFMPEG_SOURCE_DIR}")
+
+add_custom_command(OUTPUT
+						"${FFMPEG_BINARY_DIR}/libavcodec/${LIBAVCODEC_LIB}"
+						"${FFMPEG_BINARY_DIR}/libavcore/${LIBAVCORE_LIB}"
+						"${FFMPEG_BINARY_DIR}/libavformat/${LIBAVFORMAT_LIB}"
+						"${FFMPEG_BINARY_DIR}/libavutil/${LIBAVUTIL_LIB}"
+						"${FFMPEG_BINARY_DIR}/libpostproc/${LIBPOSTPROC_LIB}"
+						"${FFMPEG_BINARY_DIR}/libswscale/${LIBSWSCALE_LIB}"
+						"${FFMPEG_BINARY_DIR}/ffmpeg${CMAKE_EXECUTABLE_SUFFIX}"
 				   COMMAND ${CMAKE_COMMAND} -DCMAKE_BUILD_TOOL=${CMAKE_BUILD_TOOL} -P "${CMAKE_SOURCE_DIR}/../cmake/admFFmpegMake.cmake"
 				   WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}")
 
-add_custom_target(ffmpeg ALL
-				  DEPENDS "${FFMPEG_BINARY_DIR}/ffmpeg${CMAKE_EXECUTABLE_SUFFIX}")
-
 # Add and install libraries
 registerFFmpeg("${FFMPEG_SOURCE_DIR}" "${FFMPEG_BINARY_DIR}" 0)
 

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegUtil.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegUtil.cmake	2010-12-27 22:58:14 UTC (rev 6868)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegUtil.cmake	2010-12-28 13:52:18 UTC (rev 6869)
@@ -64,6 +64,20 @@
 		set_property(TARGET ADM_libavcodec PROPERTY IMPORTED_LOCATION "${binaryDir}/libavcodec/${LIBAVCODEC_LIB}")
 		set_property(TARGET ADM_libavformat PROPERTY IMPORTED_LOCATION "${binaryDir}/libavformat/${LIBAVFORMAT_LIB}")
 		set_property(TARGET ADM_libavcore PROPERTY IMPORTED_LOCATION "${binaryDir}/libavcore/${LIBAVCORE_LIB}")
+
+		add_custom_target(libavcodec DEPENDS "${binaryDir}/libavcodec/${LIBAVCODEC_LIB}")
+		add_custom_target(libavcore DEPENDS "${binaryDir}/libavcore/${LIBAVCORE_LIB}")
+		add_custom_target(libavformat DEPENDS "${binaryDir}/libavformat/${LIBAVFORMAT_LIB}")
+		add_custom_target(libavutil DEPENDS "${binaryDir}/libavutil/${LIBAVUTIL_LIB}")
+		add_custom_target(libpostproc DEPENDS "${binaryDir}/libpostproc/${LIBAVPOSTPROC_LIB}")
+		add_custom_target(libswscale DEPENDS "${binaryDir}/libswscale/${LIBSWSCALE_LIB}")
+
+		add_dependencies(ADM_libavcodec libavcodec)
+		add_dependencies(ADM_libavcore libavcore)
+		add_dependencies(ADM_libavformat libavformat)
+		add_dependencies(ADM_libavutil libavutil)
+		add_dependencies(ADM_libpostproc libpostproc)
+		add_dependencies(ADM_libswscale libswscale)
 	endif (${installed})
 
 	include_directories("${sourceDir}")



From gruntster at mail.berlios.de  Tue Dec 28 14:57:03 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 28 Dec 2010 14:57:03 +0100
Subject: [Avidemux-svn-commit] r6870 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101228135703.DB97C48065D@sheep.berlios.de>

Author: gruntster
Date: 2010-12-28 14:57:03 +0100 (Tue, 28 Dec 2010)
New Revision: 6870

Modified:
   branches/avidemux_2.6_branch_mean/cmake/FindSubversion.cmake
Log:
[cmake] subversion script from 2.5

Modified: branches/avidemux_2.6_branch_mean/cmake/FindSubversion.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/FindSubversion.cmake	2010-12-28 13:52:18 UTC (rev 6869)
+++ branches/avidemux_2.6_branch_mean/cmake/FindSubversion.cmake	2010-12-28 13:57:03 UTC (rev 6870)
@@ -67,58 +67,28 @@
       OUTPUT_STRIP_TRAILING_WHITESPACE)
     MESSAGE(STATUS "Getting svn version from ${dir}")
 
-# Old svn info call
-#    EXECUTE_PROCESS(COMMAND ${Subversion_SVN_EXECUTABLE} info . 
-#      WORKING_DIRECTORY ${dir}
-#      OUTPUT_VARIABLE ${prefix}_WC_INFO
-#      ERROR_VARIABLE Subversion_svn_info_error
-#      RESULT_VARIABLE Subversion_svn_info_result
-#      OUTPUT_STRIP_TRAILING_WHITESPACE)
+    EXECUTE_PROCESS(COMMAND ${Subversion_SVN_EXECUTABLE} info --xml . 
+      WORKING_DIRECTORY ${dir}
+      OUTPUT_VARIABLE ${prefix}_WC_INFO
+      ERROR_VARIABLE Subversion_svn_info_error
+      RESULT_VARIABLE Subversion_svn_info_result
+      OUTPUT_STRIP_TRAILING_WHITESPACE)
 
-# New svn info --xml call
-      EXECUTE_PROCESS(COMMAND ${Subversion_SVN_EXECUTABLE} info --xml . 
-        WORKING_DIRECTORY ${dir}
-        OUTPUT_VARIABLE ${prefix}_WC_INFO_XML
-        ERROR_VARIABLE Subversion_svn_info_error
-        RESULT_VARIABLE Subversion_svn_info_result
-        OUTPUT_STRIP_TRAILING_WHITESPACE)
-
     IF(NOT ${Subversion_svn_info_result} EQUAL 0)
       MESSAGE(SEND_ERROR "Command \"${Subversion_SVN_EXECUTABLE} info ${dir}\" failed with output:\n${Subversion_svn_info_error}")
     ELSE(NOT ${Subversion_svn_info_result} EQUAL 0)
-
-      STRING(REGEX REPLACE "^(.*\n)?svn, version ([.0-9]+).*"
-        "\\2" Subversion_VERSION_SVN "${Subversion_VERSION_SVN}")
-
-# Old REGEX REPLACE tests, working with non licalized versions of svn :
-#      STRING(REGEX REPLACE "^(.*\n)?URL: ([^\n]+).*"
-#        "\\2" ${prefix}_WC_URL "${${prefix}_WC_INFO}")
-#      STRING(REGEX REPLACE "^(.*\n)?Revision: ([^\n]+).*"
-#        "\\2" ${prefix}_WC_REVISION "${${prefix}_WC_INFO}")
-#      STRING(REGEX REPLACE "^(.*\n)?Last Changed Author: ([^\n]+).*"
-#        "\\2" ${prefix}_WC_LAST_CHANGED_AUTHOR "${${prefix}_WC_INFO}")
-#      STRING(REGEX REPLACE "^(.*\n)?Last Changed Rev: ([^\n]+).*"
-#        "\\2" ${prefix}_WC_LAST_CHANGED_REV "${${prefix}_WC_INFO}")
-#      STRING(REGEX REPLACE "^(.*\n)?Last Changed Date: ([^\n]+).*"
-#        "\\2" ${prefix}_WC_LAST_CHANGED_DATE "${${prefix}_WC_INFO}")
-
-# New REGEX REPLACE tests, working with the xml output on all versions :
-      STRING(REGEX REPLACE "(.*)<url>(.*)</url>(.*)"
-        "\\2" ${prefix}_WC_URL "${${prefix}_WC_INFO_XML}")
-      STRING(REGEX REPLACE "(.*)<entry(.*)revision=\"(.*)\">(.*)"
-        "\\3" ${prefix}_WC_REVISION "${${prefix}_WC_INFO_XML}")
-      STRING(REGEX REPLACE "(.*)<commit(.*)revision=\"(.*)\">(.*)<author>(.*)</author>(.*)<date>(.*)</date>(.*)</commit>(.*)"
-        "\\5" ${prefix}_WC_LAST_CHANGED_AUTHOR "${${prefix}_WC_INFO_XML}")
-      STRING(REGEX REPLACE "(.*)<commit(.*)revision=\"(.*)\">(.*)<author>(.*)</author>(.*)<date>(.*)</date>(.*)</commit>(.*)"
-        "\\3" ${prefix}_WC_LAST_CHANGED_REV "${${prefix}_WC_INFO_XML}")
-      STRING(REGEX REPLACE "(.*)<commit(.*)revision=\"(.*)\">(.*)<author>(.*)</author>(.*)<date>(.*)</date>(.*)</commit>(.*)"
-        "\\7" ${prefix}_WC_LAST_CHANGED_DATE "${${prefix}_WC_INFO_XML}")
-
+      STRING(REPLACE "\n" "" ${prefix}_WC_INFO "${${prefix}_WC_INFO}")
+      STRING(REGEX REPLACE "^(.*\n)?svn, version ([.0-9]+).*" "\\2" Subversion_VERSION_SVN "${Subversion_VERSION_SVN}")
+      STRING(REGEX REPLACE ".*<url>([^<]+)</url>.*" "\\1" ${prefix}_WC_URL "${${prefix}_WC_INFO}")
+      STRING(REGEX REPLACE ".*<entry[^>]+revision=\"([0-9]+)\">.*" "\\1" ${prefix}_WC_REVISION "${${prefix}_WC_INFO}")
+      STRING(REGEX REPLACE ".*<author>([^<]+)</author>.*" "\\1" ${prefix}_WC_LAST_CHANGED_AUTHOR "${${prefix}_WC_INFO}")
+      STRING(REGEX REPLACE ".*<commit +revision=\"([0-9]+)\".*" "\\1" ${prefix}_WC_LAST_CHANGED_REV "${${prefix}_WC_INFO}")
+      STRING(REGEX REPLACE ".*<date>([^<]+)</date>.*" "\\1" ${prefix}_WC_LAST_CHANGED_DATE "${${prefix}_WC_INFO}")
     ENDIF(NOT ${Subversion_svn_info_result} EQUAL 0)
 
     EXECUTE_PROCESS(COMMAND
-      ${Subversion_SVN_EXECUTABLE} log -r BASE .
-      WORKING_DIRECTORY ${PROJECT_SOURCE_DIR}
+      ${Subversion_SVN_EXECUTABLE} log -r BASE ${dir} 
+      WORKING_DIRECTORY ${dir}
       OUTPUT_VARIABLE Subversion_LAST_CHANGED_LOG
       ERROR_VARIABLE Subversion_svn_log_error
       RESULT_VARIABLE Subversion_svn_log_result



From gruntster at mail.berlios.de  Tue Dec 28 15:51:01 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 28 Dec 2010 15:51:01 +0100
Subject: [Avidemux-svn-commit] r6871 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101228145102.2422048065D@sheep.berlios.de>

Author: gruntster
Date: 2010-12-28 15:51:01 +0100 (Tue, 28 Dec 2010)
New Revision: 6871

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegUtil.cmake
Log:
[ffmpeg] it seems only CMake SVN supports adding build dependencies to imported libraries (therefore multiple make jobs will currently only work with CMake SVN)

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegUtil.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegUtil.cmake	2010-12-28 13:57:03 UTC (rev 6870)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegUtil.cmake	2010-12-28 14:51:01 UTC (rev 6871)
@@ -72,12 +72,14 @@
 		add_custom_target(libpostproc DEPENDS "${binaryDir}/libpostproc/${LIBAVPOSTPROC_LIB}")
 		add_custom_target(libswscale DEPENDS "${binaryDir}/libswscale/${LIBSWSCALE_LIB}")
 
-		add_dependencies(ADM_libavcodec libavcodec)
-		add_dependencies(ADM_libavcore libavcore)
-		add_dependencies(ADM_libavformat libavformat)
-		add_dependencies(ADM_libavutil libavutil)
-		add_dependencies(ADM_libpostproc libpostproc)
-		add_dependencies(ADM_libswscale libswscale)
+		if (${CMAKE_VERSION} VERSION_GREATER 2.8.3)
+			add_dependencies(ADM_libavcodec libavcodec)
+			add_dependencies(ADM_libavcore libavcore)
+			add_dependencies(ADM_libavformat libavformat)
+			add_dependencies(ADM_libavutil libavutil)
+			add_dependencies(ADM_libpostproc libpostproc)
+			add_dependencies(ADM_libswscale libswscale)
+		endif (${CMAKE_VERSION} VERSION_GREATER 2.8.3)
 	endif (${installed})
 
 	include_directories("${sourceDir}")



From mean at mail.berlios.de  Tue Dec 28 20:29:20 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Tue, 28 Dec 2010 20:29:20 +0100
Subject: [Avidemux-svn-commit] r6872 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101228192921.0BA49480691@sheep.berlios.de>

Author: mean
Date: 2010-12-28 20:29:20 +0100 (Tue, 28 Dec 2010)
New Revision: 6872

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareSvn.cmake
Log:
[ffmpeg] Use admGetRevision, in case it is not subversion that is used

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareSvn.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareSvn.cmake	2010-12-28 14:51:01 UTC (rev 6871)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareSvn.cmake	2010-12-28 19:29:20 UTC (rev 6872)
@@ -21,7 +21,8 @@
 endif (NOT IS_DIRECTORY "${FFMPEG_SOURCE_DIR}/.svn")
 
 # Check version
-Subversion_WC_INFO(${FFMPEG_SOURCE_DIR} ffmpeg)
+admGetRevision( ${FFMPEG_SOURCE_DIR} ffmpeg_WC_REVISION)
+#Subversion_WC_INFO(${FFMPEG_SOURCE_DIR} ffmpeg)
 message(STATUS "FFmpeg revision: ${ffmpeg_WC_REVISION}")
 
 if (NOT ${ffmpeg_WC_REVISION} EQUAL ${FFMPEG_VERSION})
@@ -38,8 +39,8 @@
 endif (NOT ${ffmpeg_WC_REVISION} EQUAL ${FFMPEG_VERSION})
 
 message("")
-
-Subversion_WC_INFO(${FFMPEG_SOURCE_DIR}/libswscale swscale)
+admGetRevision( ${FFMPEG_SOURCE_DIR}/libswscale swscale_WC_REVISION)
+#Subversion_WC_INFO(${FFMPEG_SOURCE_DIR}/libswscale swscale)
 message(STATUS "libswscale revision: ${swscale_WC_REVISION}")
 
 if (NOT ${swscale_WC_REVISION} EQUAL ${SWSCALE_VERSION})
@@ -51,4 +52,4 @@
 					${swscaleSvnOutput})
 	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} up -r ${SWSCALE_VERSION} "${FFMPEG_SOURCE_DIR}/libswscale"
 					${swscaleSvnOutput})
-endif (NOT ${swscale_WC_REVISION} EQUAL ${SWSCALE_VERSION})
\ No newline at end of file
+endif (NOT ${swscale_WC_REVISION} EQUAL ${SWSCALE_VERSION})



From mean at mail.berlios.de  Wed Dec 29 07:43:12 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 29 Dec 2010 07:43:12 +0100
Subject: [Avidemux-svn-commit] r6873 - branches/avidemux_2.6_branch_mean
Message-ID: <20101229064312.DD049480740@sheep.berlios.de>

Author: mean
Date: 2010-12-29 07:43:12 +0100 (Wed, 29 Dec 2010)
New Revision: 6873

Modified:
   branches/avidemux_2.6_branch_mean/bootStrap.bash
Log:
[build] Disable multiple compilation

Modified: branches/avidemux_2.6_branch_mean/bootStrap.bash
===================================================================
--- branches/avidemux_2.6_branch_mean/bootStrap.bash	2010-12-28 19:29:20 UTC (rev 6872)
+++ branches/avidemux_2.6_branch_mean/bootStrap.bash	2010-12-29 06:43:12 UTC (rev 6873)
@@ -33,7 +33,7 @@
         mkdir $BUILDDIR || fail mkdir
         cd $BUILDDIR 
         cmake $PKG -DCMAKE_EDIT_COMMAND=vim -DAVIDEMUX_SOURCE_DIR=$TOP -DCMAKE_INSTALL_PREFIX=/usr $EXTRA $DEBUG -G "$BUILDER" $SOURCEDIR || fail cmakeZ
-        make -j 2 >& /tmp/log$BUILDDIR || fail make
+        make  >& /tmp/log$BUILDDIR || fail make
 	if  [ "x$PKG" = "x" ] ; then
 	  echo "No packaging..."
         else



From mean at mail.berlios.de  Wed Dec 29 08:24:00 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 29 Dec 2010 08:24:00 +0100
Subject: [Avidemux-svn-commit] r6874 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101229072400.F2632480740@sheep.berlios.de>

Author: mean
Date: 2010-12-29 08:24:00 +0100 (Wed, 29 Dec 2010)
New Revision: 6874

Added:
   branches/avidemux_2.6_branch_mean/cmake/FindTar.cmake
Log:
[build] Add FindTar from 2.5

Added: branches/avidemux_2.6_branch_mean/cmake/FindTar.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/FindTar.cmake	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/FindTar.cmake	2010-12-29 07:24:00 UTC (rev 6874)
@@ -0,0 +1,19 @@
+if (NOT TAR_EXECUTABLE)
+	message(STATUS "Checking for tar")
+	message(STATUS "****************")
+
+	find_program(TAR_EXECUTABLE tar)
+	set(TAR_EXECUTABLE ${TAR_EXECUTABLE} CACHE STRING "")
+
+	if (TAR_EXECUTABLE)
+		message(STATUS "Found tar")
+
+		if (VERBOSE)
+			message(STATUS "Path: ${TAR_EXECUTABLE}")
+		endif (VERBOSE)
+	else (TAR_EXECUTABLE)
+		message(FATAL_ERROR "tar not found")
+	endif (TAR_EXECUTABLE)
+
+	message("")
+endif (NOT TAR_EXECUTABLE)
\ No newline at end of file



From mean at mail.berlios.de  Wed Dec 29 08:24:01 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 29 Dec 2010 08:24:01 +0100
Subject: [Avidemux-svn-commit] r6875 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101229072401.DFDDD480740@sheep.berlios.de>

Author: mean
Date: 2010-12-29 08:24:01 +0100 (Wed, 29 Dec 2010)
New Revision: 6875

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareSvn.cmake
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareTar.cmake
Log:
[Build] Fix some loose ends + automatically create ffmpeg.tgz and libswscale.tgz after a checkout. They are stored in cmake for the moment, before putting them in a nicer place

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-29 07:24:00 UTC (rev 6874)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-29 07:24:01 UTC (rev 6875)
@@ -1,9 +1,17 @@
-include(admFFmpegUtil)
-
 set(FFMPEG_VERSION 26061)	# http://git.ffmpeg.org/?p=ffmpeg;a=snapshot;h=2be4fa05c5528073bcfc472d1c23f2d77b679a9d;sf=tgz
 set(SWSCALE_VERSION 32676)	# http://git.ffmpeg.org/?p=libswscale;a=snapshot;h=d1a43021d9198868fa7a023a30e5ee9e09a907d3;sf=tgz
 
-set(FFMPEG_SOURCE_DIR "${CMAKE_SOURCE_DIR}/../ffmpeg")
+set(LIBRARY_SOURCE_DIR "${AVIDEMUX_TOP_SOURCE_DIR}/cmake")
+set(FFMPEG_SOURCE_ARCHIVE "ffmpeg_r${FFMPEG_VERSION}.tar.gz")
+set(SWSCALE_SOURCE_ARCHIVE "libswscale_r${SWSCALE_VERSION}.tar.gz")
+
+
+include(admFFmpegUtil)
+find_package(Tar)
+
+
+set(FFMPEG_EXTRACT_DIR "${AVIDEMUX_TOP_SOURCE_DIR}")
+set(FFMPEG_SOURCE_DIR "${FFMPEG_EXTRACT_DIR}/ffmpeg")
 set(FFMPEG_BINARY_DIR "${CMAKE_BINARY_DIR}/ffmpeg")
 
 set(FFMPEG_DECODERS  adpcm_ima_amv  amv  bmp  cinepak  cyuv  dca  dvbsub  dvvideo  ffv1  ffvhuff  flv  fraps  h263  h264  huffyuv  mjpeg
@@ -188,4 +196,4 @@
 add_custom_target(cleanffmpeg
 				  COMMAND ${CMAKE_COMMAND} -P "${CMAKE_SOURCE_DIR}/cmake/admFFmpegClean.cmake"
 				  WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}"
-				  COMMENT "Cleaning FFmpeg")
\ No newline at end of file
+				  COMMENT "Cleaning FFmpeg")

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareSvn.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareSvn.cmake	2010-12-29 07:24:00 UTC (rev 6874)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareSvn.cmake	2010-12-29 07:24:01 UTC (rev 6875)
@@ -10,13 +10,23 @@
 	message(STATUS "Checking out FFmpeg")
 	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} co svn://svn.ffmpeg.org/ffmpeg/trunk -r ${FFMPEG_VERSION} --ignore-externals "${FFMPEG_SOURCE_DIR}"
 					${ffmpegSvnOutput})
+	MESSAGE(STATUS "Archiving ffmpeg ${FFMPEG_VERSION}")
+	MESSAGE(STATUS "${TAR_EXECUTABLE} czf ${LIBRARY_SOURCE_DIR}/${FFMPEG_SOURCE_ARCHIVE} ffmpeg, DIR=${FFMPEG_SOURCE_DIR}/..")
+	execute_process(COMMAND ${TAR_EXECUTABLE} czf "${LIBRARY_SOURCE_DIR}/${FFMPEG_SOURCE_ARCHIVE}" ffmpeg
+				WORKING_DIRECTORY "${FFMPEG_SOURCE_DIR}/.."
+				)
 
 	message(STATUS "Checking out libswscale")
 	execute_process(COMMAND ${Subversion_SVN_EXECUTABLE} co svn://svn.ffmpeg.org/mplayer/trunk/libswscale -r ${SWSCALE_VERSION} "${FFMPEG_SOURCE_DIR}/libswscale"
 					${swscaleSvnOutput})
+	MESSAGE(STATUS "Archiving libswscale ${SWSCALE_VERSION}")
+	MESSAGE(STATUS " ${TAR_EXECUTABLE} czf ${LIBRARY_SOURCE_DIR}/${SWSCALE_SOURCE_ARCHIVE} libswscale,  DIR=${FFMPEG_SOURCE_DIR}/" )
+	execute_process(COMMAND ${TAR_EXECUTABLE} czf "${LIBRARY_SOURCE_DIR}/${SWSCALE_SOURCE_ARCHIVE}" libswscale
+				WORKING_DIRECTORY "${FFMPEG_SOURCE_DIR}/"
+				)
 
-	message("")
 
+
 	set(FFMPEG_PERFORM_PATCH 1)
 endif (NOT IS_DIRECTORY "${FFMPEG_SOURCE_DIR}/.svn")
 

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareTar.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareTar.cmake	2010-12-29 07:24:00 UTC (rev 6874)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareTar.cmake	2010-12-29 07:24:01 UTC (rev 6875)
@@ -2,15 +2,12 @@
 	set(ffmpegExtractOutput OUTPUT_VARIABLE FFMPEG_EXTRACT_OUTPUT)
 endif (NOT VERBOSE)
 
-set(FFMPEG_SOURCE_ARCHIVE "ffmpeg_r${FFMPEG_VERSION}.tar.gz")
-set(SWSCALE_SOURCE_ARCHIVE "libswscale_r${SWSCALE_VERSION}.tar.gz")
-
 if (EXISTS "${LIBRARY_SOURCE_DIR}/${FFMPEG_SOURCE_ARCHIVE}" AND EXISTS "${LIBRARY_SOURCE_DIR}/${SWSCALE_SOURCE_ARCHIVE}")
 	if (NOT EXISTS "${FFMPEG_SOURCE_DIR}/ffmpeg.c" OR NOT ${LAST_FFMPEG_VERSION} EQUAL ${FFMPEG_VERSION})
 		find_package(Tar)
-
-		execute_process(COMMAND ${TAR_EXECUTABLE} xvf ${FFMPEG_SOURCE_ARCHIVE}
-					WORKING_DIRECTORY "${LIBRARY_SOURCE_DIR}"
+		MESSAGE(STATUS "Unpacking ffmpeg from ${LIBRARY_SOURCE_DIR} to ${FFMPEG_EXTRACT_DIR}")
+		execute_process(COMMAND ${TAR_EXECUTABLE} xvf ${LIBRARY_SOURCE_DIR}/${FFMPEG_SOURCE_ARCHIVE}
+					WORKING_DIRECTORY "${FFMPEG_EXTRACT_DIR}"
 					${ffmpegExtractOutput})
 
 		set(FFMPEG_PERFORM_PATCH 1)
@@ -19,8 +16,9 @@
 
 	if (NOT EXISTS "${FFMPEG_SOURCE_DIR}/libswscale/swscale.c" OR NOT ${LAST_SWSCALE_VERSION} EQUAL ${SWSCALE_VERSION})
 		find_package(Tar)
+		MESSAGE(STATUS "Unpacking libswscale from ${LIBRARY_SOURCE_DIR} to ${FFMPEG_SOURCE_DIR}")
 
-		execute_process(COMMAND ${TAR_EXECUTABLE} xvf ../${SWSCALE_SOURCE_ARCHIVE}
+		execute_process(COMMAND ${TAR_EXECUTABLE} xvf ${LIBRARY_SOURCE_DIR}/${SWSCALE_SOURCE_ARCHIVE}
 					WORKING_DIRECTORY "${FFMPEG_SOURCE_DIR}"
 					${ffmpegExtractOutput})
 
@@ -31,4 +29,4 @@
 	set(FFMPEG_PREPARED 1)
 	set(LAST_FFMPEG_VERSION "${FFMPEG_VERSION}" CACHE STRING "" FORCE)
 	set(LAST_SWSCALE_VERSION "${SWSCALE_VERSION}" CACHE STRING "" FORCE)
-endif (EXISTS "${LIBRARY_SOURCE_DIR}/${FFMPEG_SOURCE_ARCHIVE}" AND EXISTS "${LIBRARY_SOURCE_DIR}/${SWSCALE_SOURCE_ARCHIVE}")
\ No newline at end of file
+endif (EXISTS "${LIBRARY_SOURCE_DIR}/${FFMPEG_SOURCE_ARCHIVE}" AND EXISTS "${LIBRARY_SOURCE_DIR}/${SWSCALE_SOURCE_ARCHIVE}")



From mean at mail.berlios.de  Wed Dec 29 19:16:03 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 29 Dec 2010 19:16:03 +0100
Subject: [Avidemux-svn-commit] r6876 - branches/avidemux_2.6_branch_mean
Message-ID: <20101229181603.B0463480781@sheep.berlios.de>

Author: mean
Date: 2010-12-29 19:16:03 +0100 (Wed, 29 Dec 2010)
New Revision: 6876

Modified:
   branches/avidemux_2.6_branch_mean/bootStrap.bash
Log:
[build] Tweak bootstrap to handle ffmpeg build quirks

Modified: branches/avidemux_2.6_branch_mean/bootStrap.bash
===================================================================
--- branches/avidemux_2.6_branch_mean/bootStrap.bash	2010-12-29 07:24:01 UTC (rev 6875)
+++ branches/avidemux_2.6_branch_mean/bootStrap.bash	2010-12-29 18:16:03 UTC (rev 6876)
@@ -15,6 +15,36 @@
         exit 1
 }
 
+Process2()
+{
+        export BUILDDIR=$1
+        export SOURCEDIR=$2
+        export EXTRA=$3
+        export DEBUG=""
+        BUILDER="Unix Makefiles"
+        if [ "x$debug" = "x1" ] ; then 
+                DEBUG="-DVERBOSE=1 -DCMAKE_BUILD_TYPE=Debug  "
+                BUILDDIR="${BUILDDIR}_debug"
+                BUILDER="CodeBlocks - Unix Makefiles"
+        fi
+        
+        echo "Building $BUILDDIR from $SOURCEDIR with EXTRA=<$EXTRA>, DEBUG=<$DEBUG>"
+        rm -Rf ./$BUILDDIR
+        mkdir $BUILDDIR || fail mkdir
+        cd $BUILDDIR 
+        cmake $PKG -DCMAKE_EDIT_COMMAND=vim -DAVIDEMUX_SOURCE_DIR=$TOP -DCMAKE_INSTALL_PREFIX=/usr $EXTRA $DEBUG -G "$BUILDER" $SOURCEDIR || fail cmakeZ
+	echo "Building ffmpeg"
+	cd ffmpeg && make >& /tmp/log$BUILDDIR || fail ffmpeg
+	cd ..
+	echo "Building core"
+        make   >> /tmp/log$BUILDDIR || fail make
+	if  [ "x$PKG" = "x" ] ; then
+	  echo "No packaging..."
+        else
+          fakeroot make package DESTDIR=debPack || fail package
+	fi
+}
+
 Process()
 {
         export BUILDDIR=$1
@@ -33,7 +63,7 @@
         mkdir $BUILDDIR || fail mkdir
         cd $BUILDDIR 
         cmake $PKG -DCMAKE_EDIT_COMMAND=vim -DAVIDEMUX_SOURCE_DIR=$TOP -DCMAKE_INSTALL_PREFIX=/usr $EXTRA $DEBUG -G "$BUILDER" $SOURCEDIR || fail cmakeZ
-        make  >& /tmp/log$BUILDDIR || fail make
+        make  -j 2 >& /tmp/log$BUILDDIR || fail make
 	if  [ "x$PKG" = "x" ] ; then
 	  echo "No packaging..."
         else
@@ -158,7 +188,7 @@
 if [ "x$do_core" = "x1" ] ; then 
         echo "** CORE **"
         cd $TOP
-        Process buildCore ../avidemux_core
+        Process2 buildCore ../avidemux_core
         echo " Core needs to be installed, installing through sudo make install ...."
         cd $TOP/buildCore${POSTFIX} && sudo make install
 fi



From mean at mail.berlios.de  Wed Dec 29 19:16:04 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 29 Dec 2010 19:16:04 +0100
Subject: [Avidemux-svn-commit] r6877 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101229181604.B5B7F480781@sheep.berlios.de>

Author: mean
Date: 2010-12-29 19:16:04 +0100 (Wed, 29 Dec 2010)
New Revision: 6877

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
Log:
[build] Try to install ffmpeg in the right folder, we should use ADM_INSTALL_LIB but it does not work there. As a result lib64 or lib32 are not handled, to be fixed

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-29 18:16:03 UTC (rev 6876)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-29 18:16:04 UTC (rev 6877)
@@ -183,13 +183,25 @@
 
 # Add and install libraries
 registerFFmpeg("${FFMPEG_SOURCE_DIR}" "${FFMPEG_BINARY_DIR}" 0)
-
-install(FILES "${FFMPEG_BINARY_DIR}/libswscale/${LIBSWSCALE_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
-install(FILES "${FFMPEG_BINARY_DIR}/libpostproc/${LIBPOSTPROC_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
-install(FILES "${FFMPEG_BINARY_DIR}/libavutil/${LIBAVUTIL_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
-install(FILES "${FFMPEG_BINARY_DIR}/libavcodec/${LIBAVCODEC_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
-install(FILES "${FFMPEG_BINARY_DIR}/libavformat/${LIBAVFORMAT_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
-install(FILES "${FFMPEG_BINARY_DIR}/libavcore/${LIBAVCORE_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
+#############################################################
+# We should use ADM_INSTALL_LIB here but it does not work
+# Temporary workaround.... Does not handle lib64 & friends
+#############################################################
+IF(WIN32)
+  install(FILES "${FFMPEG_BINARY_DIR}/libswscale/${LIBSWSCALE_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
+  install(FILES "${FFMPEG_BINARY_DIR}/libpostproc/${LIBPOSTPROC_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
+  install(FILES "${FFMPEG_BINARY_DIR}/libavutil/${LIBAVUTIL_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
+  install(FILES "${FFMPEG_BINARY_DIR}/libavcodec/${LIBAVCODEC_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
+  install(FILES "${FFMPEG_BINARY_DIR}/libavformat/${LIBAVFORMAT_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
+  install(FILES "${FFMPEG_BINARY_DIR}/libavcore/${LIBAVCORE_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
+ELSE(WIN32)
+  install(FILES "${FFMPEG_BINARY_DIR}/libswscale/${LIBSWSCALE_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}/lib")
+  install(FILES "${FFMPEG_BINARY_DIR}/libpostproc/${LIBPOSTPROC_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}/lib")
+  install(FILES "${FFMPEG_BINARY_DIR}/libavutil/${LIBAVUTIL_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}/lib")
+  install(FILES "${FFMPEG_BINARY_DIR}/libavcodec/${LIBAVCODEC_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}/lib")
+  install(FILES "${FFMPEG_BINARY_DIR}/libavformat/${LIBAVFORMAT_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}/lib")
+  install(FILES "${FFMPEG_BINARY_DIR}/libavcore/${LIBAVCORE_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}/lib")
+ENDIF(WIN32)
 install(FILES "${FFMPEG_BINARY_DIR}/libavutil/avconfig.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libavutil") 
 
 # Clean FFmpeg



From mean at mail.berlios.de  Wed Dec 29 20:02:53 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Wed, 29 Dec 2010 20:02:53 +0100
Subject: [Avidemux-svn-commit] r6878 -
	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_libraries
Message-ID: <20101229190254.2BD79480781@sheep.berlios.de>

Author: mean
Date: 2010-12-29 20:02:53 +0100 (Wed, 29 Dec 2010)
New Revision: 6878

Removed:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_libraries/ADM_lvemux/
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_libraries/ADM_mplex/
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_libraries/ADM_xvidratectl/
Log:
[cleanup] Remove empty folders



From gruntster at mail.berlios.de  Wed Dec 29 20:19:28 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 29 Dec 2010 20:19:28 +0100
Subject: [Avidemux-svn-commit] r6879 - in branches/avidemux_2.6_branch_mean:
	avidemux_core avidemux_core/ADM_coreMuxer/include
	avidemux_plugins cmake
Message-ID: <20101229191928.446E9480781@sheep.berlios.de>

Author: gruntster
Date: 2010-12-29 20:19:27 +0100 (Wed, 29 Dec 2010)
New Revision: 6879

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/include/ADM_coreMuxerFfmpeg.h
   branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_plugins/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/cmake/admCoreIncludes.cmake
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegUtil.cmake
Log:
[ffmpeg] check out and patch ffmpeg in build directory

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/include/ADM_coreMuxerFfmpeg.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/include/ADM_coreMuxerFfmpeg.h	2010-12-29 19:02:53 UTC (rev 6878)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/include/ADM_coreMuxerFfmpeg.h	2010-12-29 19:19:27 UTC (rev 6879)
@@ -25,6 +25,7 @@
 
 extern "C"
 {
+	#include "libavutil/avutil.h"
     #include "libavformat/avformat.h"
 };
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt	2010-12-29 19:02:53 UTC (rev 6878)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/CMakeLists.txt	2010-12-29 19:19:27 UTC (rev 6879)
@@ -42,6 +42,7 @@
 ########################################
 # Add include dirs
 ########################################
+set(EXCLUDE_ADM_INCLUDE TRUE)
 include(admCoreIncludes)
 
 ########################################

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/CMakeLists.txt	2010-12-29 19:02:53 UTC (rev 6878)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/CMakeLists.txt	2010-12-29 19:19:27 UTC (rev 6879)
@@ -35,10 +35,10 @@
 #########################################
 include(admCoreIncludes)
 LINK_DIRECTORIES("${AVIDEMUX_LIB_DIR}")
-INCLUDE_DIRECTORIES(${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/)
+INCLUDE_DIRECTORIES("${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6")
 
 include(admFFmpegUtil)
-registerFFmpeg("${CMAKE_SOURCE_DIR}/../ffmpeg" "${AVIDEMUX_LIB_DIR}" 1)
+registerFFmpeg("${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6" "${AVIDEMUX_LIB_DIR}" 1)
 
 IF (FRESH_BUILD)
 	MESSAGE("")

Modified: branches/avidemux_2.6_branch_mean/cmake/admCoreIncludes.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admCoreIncludes.cmake	2010-12-29 19:02:53 UTC (rev 6878)
+++ branches/avidemux_2.6_branch_mean/cmake/admCoreIncludes.cmake	2010-12-29 19:19:27 UTC (rev 6879)
@@ -16,4 +16,7 @@
 INCLUDE_DIRECTORIES(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core/ADM_coreVideoCodec/include)
 INCLUDE_DIRECTORIES(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core/ADM_coreImageLoader/include)
 INCLUDE_DIRECTORIES(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux_core/ADM_coreJobs/include)
-INCLUDE_DIRECTORIES(${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/)
\ No newline at end of file
+
+if (NOT EXCLUDE_ADM_INCLUDE)
+	INCLUDE_DIRECTORIES(${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6)
+endif (NOT EXCLUDE_ADM_INCLUDE)
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-29 19:02:53 UTC (rev 6878)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-29 19:19:27 UTC (rev 6879)
@@ -10,7 +10,7 @@
 find_package(Tar)
 
 
-set(FFMPEG_EXTRACT_DIR "${AVIDEMUX_TOP_SOURCE_DIR}")
+set(FFMPEG_EXTRACT_DIR "${CMAKE_BINARY_DIR}")
 set(FFMPEG_SOURCE_DIR "${FFMPEG_EXTRACT_DIR}/ffmpeg")
 set(FFMPEG_BINARY_DIR "${CMAKE_BINARY_DIR}/ffmpeg")
 
@@ -38,14 +38,14 @@
 
 if (FFMPEG_PERFORM_PATCH)
 	find_package(Patch)
-	file(GLOB patchFiles "${CMAKE_SOURCE_DIR}/../cmake/patches/*.patch")
+	file(GLOB patchFiles "${AVIDEMUX_TOP_SOURCE_DIR}/cmake/patches/*.patch")
 
 	foreach(patchFile ${patchFiles})
 		patch_file("${FFMPEG_SOURCE_DIR}" "${patchFile}")
 	endforeach(patchFile)
 
 	if (UNIX)
-		patch_file("${FFMPEG_SOURCE_DIR}" "${CMAKE_SOURCE_DIR}/../cmake/patches/common.mak.diff")
+		patch_file("${FFMPEG_SOURCE_DIR}" "${AVIDEMUX_TOP_SOURCE_DIR}/cmake/patches/common.mak.diff")
 	endif (UNIX)
 
 	message("")
@@ -158,10 +158,10 @@
 
 	if (APPLE)
 		find_package(Patch)
-		patch_file("${FFMPEG_BINARY_DIR}" "${CMAKE_SOURCE_DIR}/../cmake/patches/config_macosx.mak.diff")
+		patch_file("${FFMPEG_BINARY_DIR}" "${AVIDEMUX_TOP_SOURCE_DIR}/cmake/patches/config_macosx.mak.diff")
 	elseif (UNIX)
 		find_package(Patch)
-		patch_file("${FFMPEG_BINARY_DIR}" "${CMAKE_SOURCE_DIR}/../cmake/patches/config.mak.diff")
+		patch_file("${FFMPEG_BINARY_DIR}" "${AVIDEMUX_TOP_SOURCE_DIR}/cmake/patches/config.mak.diff")
 	endif (APPLE)
 
 	message("")
@@ -178,11 +178,12 @@
 						"${FFMPEG_BINARY_DIR}/libpostproc/${LIBPOSTPROC_LIB}"
 						"${FFMPEG_BINARY_DIR}/libswscale/${LIBSWSCALE_LIB}"
 						"${FFMPEG_BINARY_DIR}/ffmpeg${CMAKE_EXECUTABLE_SUFFIX}"
-				   COMMAND ${CMAKE_COMMAND} -DCMAKE_BUILD_TOOL=${CMAKE_BUILD_TOOL} -P "${CMAKE_SOURCE_DIR}/../cmake/admFFmpegMake.cmake"
+				   COMMAND ${CMAKE_COMMAND} -DCMAKE_BUILD_TOOL=${CMAKE_BUILD_TOOL} -P "${AVIDEMUX_TOP_SOURCE_DIR}/cmake/admFFmpegMake.cmake"
 				   WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}")
 
 # Add and install libraries
 registerFFmpeg("${FFMPEG_SOURCE_DIR}" "${FFMPEG_BINARY_DIR}" 0)
+
 #############################################################
 # We should use ADM_INSTALL_LIB here but it does not work
 # Temporary workaround.... Does not handle lib64 & friends
@@ -202,10 +203,25 @@
   install(FILES "${FFMPEG_BINARY_DIR}/libavformat/${LIBAVFORMAT_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}/lib")
   install(FILES "${FFMPEG_BINARY_DIR}/libavcore/${LIBAVCORE_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}/lib")
 ENDIF(WIN32)
+
 install(FILES "${FFMPEG_BINARY_DIR}/libavutil/avconfig.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libavutil") 
 
+install(FILES "${FFMPEG_SOURCE_DIR}/libavcodec/avcodec.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libavcodec")
+install(FILES "${FFMPEG_SOURCE_DIR}/libavcore/audioconvert.h" "${FFMPEG_SOURCE_DIR}/libavcore/avcore.h" 
+	"${FFMPEG_SOURCE_DIR}/libavcore/samplefmt.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libavcore")
+install(FILES "${FFMPEG_SOURCE_DIR}/libavformat/avformat.h" "${FFMPEG_SOURCE_DIR}/libavformat/avio.h" 
+	"${FFMPEG_SOURCE_DIR}/libavformat/flv.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libavformat")
+install(FILES "${FFMPEG_SOURCE_DIR}/libavutil/attributes.h" "${FFMPEG_SOURCE_DIR}/libavutil/avutil.h" 
+	"${FFMPEG_SOURCE_DIR}/libavutil/bswap.h" "${FFMPEG_SOURCE_DIR}/libavutil/common.h"
+	"${FFMPEG_SOURCE_DIR}/libavutil/cpu.h" "${FFMPEG_SOURCE_DIR}/libavutil/intfloat_readwrite.h"
+	"${FFMPEG_SOURCE_DIR}/libavutil/log.h" "${FFMPEG_SOURCE_DIR}/libavutil/mathematics.h"
+	"${FFMPEG_SOURCE_DIR}/libavutil/pixfmt.h" "${FFMPEG_SOURCE_DIR}/libavutil/rational.h"
+	DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libavutil")
+install(FILES "${FFMPEG_SOURCE_DIR}/libpostproc/postprocess.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libpostproc")
+install(FILES "${FFMPEG_SOURCE_DIR}/libswscale/swscale.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libswscale")
+
 # Clean FFmpeg
 add_custom_target(cleanffmpeg
-				  COMMAND ${CMAKE_COMMAND} -P "${CMAKE_SOURCE_DIR}/cmake/admFFmpegClean.cmake"
+				  COMMAND ${CMAKE_COMMAND} -P "${AVIDEMUX_TOP_SOURCE_DIR}/cmake/admFFmpegClean.cmake"
 				  WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}"
-				  COMMENT "Cleaning FFmpeg")
+				  COMMENT "Cleaning FFmpeg")
\ No newline at end of file

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegUtil.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegUtil.cmake	2010-12-29 19:02:53 UTC (rev 6878)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegUtil.cmake	2010-12-29 19:19:27 UTC (rev 6879)
@@ -71,6 +71,7 @@
 		add_custom_target(libavutil DEPENDS "${binaryDir}/libavutil/${LIBAVUTIL_LIB}")
 		add_custom_target(libpostproc DEPENDS "${binaryDir}/libpostproc/${LIBAVPOSTPROC_LIB}")
 		add_custom_target(libswscale DEPENDS "${binaryDir}/libswscale/${LIBSWSCALE_LIB}")
+		add_custom_target(ffmpeg DEPENDS "${binaryDir}/ffmpeg${CMAKE_EXECUTABLE_SUFFIX}")
 
 		if (${CMAKE_VERSION} VERSION_GREATER 2.8.3)
 			add_dependencies(ADM_libavcodec libavcodec)
@@ -81,8 +82,4 @@
 			add_dependencies(ADM_libswscale libswscale)
 		endif (${CMAKE_VERSION} VERSION_GREATER 2.8.3)
 	endif (${installed})
-
-	include_directories("${sourceDir}")
-	include_directories("${sourceDir}/libavutil")
-	include_directories("${sourceDir}/libpostproc")
 ENDMACRO (registerFFmpeg)
\ No newline at end of file



From gruntster at mail.berlios.de  Wed Dec 29 20:36:10 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 29 Dec 2010 20:36:10 +0100
Subject: [Avidemux-svn-commit] r6880 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101229193610.C8B24480781@sheep.berlios.de>

Author: gruntster
Date: 2010-12-29 20:36:10 +0100 (Wed, 29 Dec 2010)
New Revision: 6880

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
Log:
[ffmpeg] oops, lost a line when merging

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-29 19:19:27 UTC (rev 6879)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-29 19:36:10 UTC (rev 6880)
@@ -183,6 +183,7 @@
 
 # Add and install libraries
 registerFFmpeg("${FFMPEG_SOURCE_DIR}" "${FFMPEG_BINARY_DIR}" 0)
+include_directories("${FFMPEG_SOURCE_DIR}")
 
 #############################################################
 # We should use ADM_INSTALL_LIB here but it does not work



From gruntster at mail.berlios.de  Wed Dec 29 20:52:58 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 29 Dec 2010 20:52:58 +0100
Subject: [Avidemux-svn-commit] r6881 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101229195258.E4D22480781@sheep.berlios.de>

Author: gruntster
Date: 2010-12-29 20:52:58 +0100 (Wed, 29 Dec 2010)
New Revision: 6881

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
Log:
[ffmpeg] cmake fix for unix

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-29 19:36:10 UTC (rev 6880)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-29 19:52:58 UTC (rev 6881)
@@ -207,7 +207,8 @@
 
 install(FILES "${FFMPEG_BINARY_DIR}/libavutil/avconfig.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libavutil") 
 
-install(FILES "${FFMPEG_SOURCE_DIR}/libavcodec/avcodec.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libavcodec")
+install(FILES "${FFMPEG_SOURCE_DIR}/libavcodec/avcodec.h" "${FFMPEG_SOURCE_DIR}/libavcodec/vdpau.h"
+	DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libavcodec")
 install(FILES "${FFMPEG_SOURCE_DIR}/libavcore/audioconvert.h" "${FFMPEG_SOURCE_DIR}/libavcore/avcore.h" 
 	"${FFMPEG_SOURCE_DIR}/libavcore/samplefmt.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libavcore")
 install(FILES "${FFMPEG_SOURCE_DIR}/libavformat/avformat.h" "${FFMPEG_SOURCE_DIR}/libavformat/avio.h" 
@@ -216,8 +217,8 @@
 	"${FFMPEG_SOURCE_DIR}/libavutil/bswap.h" "${FFMPEG_SOURCE_DIR}/libavutil/common.h"
 	"${FFMPEG_SOURCE_DIR}/libavutil/cpu.h" "${FFMPEG_SOURCE_DIR}/libavutil/intfloat_readwrite.h"
 	"${FFMPEG_SOURCE_DIR}/libavutil/log.h" "${FFMPEG_SOURCE_DIR}/libavutil/mathematics.h"
-	"${FFMPEG_SOURCE_DIR}/libavutil/pixfmt.h" "${FFMPEG_SOURCE_DIR}/libavutil/rational.h"
-	DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libavutil")
+	"${FFMPEG_SOURCE_DIR}/libavutil/mem.h" "${FFMPEG_SOURCE_DIR}/libavutil/pixfmt.h"
+	"${FFMPEG_SOURCE_DIR}/libavutil/rational.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libavutil")
 install(FILES "${FFMPEG_SOURCE_DIR}/libpostproc/postprocess.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libpostproc")
 install(FILES "${FFMPEG_SOURCE_DIR}/libswscale/swscale.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libswscale")
 



From gruntster at mail.berlios.de  Wed Dec 29 21:12:52 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 29 Dec 2010 21:12:52 +0100
Subject: [Avidemux-svn-commit] r6882 - in
	branches/avidemux_2.6_branch_mean/avidemux_core:
	ADM_coreAudioParser/src ADM_coreImage/src ADM_coreMuxer/src
	ADM_coreUtils/src ADM_coreVideoCodec/src ADM_coreVideoEncoder/src
Message-ID: <20101229201252.4037E480781@sheep.berlios.de>

Author: gruntster
Date: 2010-12-29 21:12:51 +0100 (Wed, 29 Dec 2010)
New Revision: 6882

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/CMakeLists.txt
Log:
[ffmpeg] dependency support for CMake 2.8.3 and earlier

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/CMakeLists.txt	2010-12-29 19:52:58 UTC (rev 6881)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudioParser/src/CMakeLists.txt	2010-12-29 20:12:51 UTC (rev 6882)
@@ -14,4 +14,8 @@
 ADD_LIBRARY(ADM_audioParser6 SHARED ${ADMaudioParser_SRCS})
 TARGET_LINK_LIBRARIES(ADM_audioParser6 ADM_core6 ADM_coreUtils6 ADM_coreUI6  ADM_libavcodec ADM_libavformat ADM_libavutil)
 
+if (NOT ${CMAKE_VERSION} VERSION_GREATER 2.8.3)
+	add_dependencies(ADM_audioParser6 libavcodec libavutil libavformat)
+endif (NOT ${CMAKE_VERSION} VERSION_GREATER 2.8.3)
+
 ADM_INSTALL_LIB(ADM_audioParser6)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/CMakeLists.txt	2010-12-29 19:52:58 UTC (rev 6881)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreImage/src/CMakeLists.txt	2010-12-29 20:12:51 UTC (rev 6882)
@@ -27,4 +27,9 @@
 
 TARGET_LINK_LIBRARIES(ADM_coreImage6 ADM_core6 ADM_coreUI6 ADM_libswscale ADM_libpostproc ADM_coreUtils6)
 TARGET_LINK_LIBRARIES(ADM_coreImage6 ADM_libavcodec ADM_libavutil)
+
+if (NOT ${CMAKE_VERSION} VERSION_GREATER 2.8.3)
+	add_dependencies(ADM_coreImage6 libavcodec libavutil libpostproc libswscale)
+endif (NOT ${CMAKE_VERSION} VERSION_GREATER 2.8.3)
+
 ADM_INSTALL_LIB(ADM_coreImage6)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/CMakeLists.txt	2010-12-29 19:52:58 UTC (rev 6881)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreMuxer/src/CMakeLists.txt	2010-12-29 20:12:51 UTC (rev 6882)
@@ -11,4 +11,8 @@
 
 TARGET_LINK_LIBRARIES(ADM_coreMuxer6 ADM_coreImage6 ADM_coreAudio6 ADM_core6 ADM_libavcodec ADM_libavformat ADM_libavutil ADM_coreUtils6)
 
+if (NOT ${CMAKE_VERSION} VERSION_GREATER 2.8.3)
+	add_dependencies(ADM_coreMuxer6 libavcodec libavformat libavutil)
+endif (NOT ${CMAKE_VERSION} VERSION_GREATER 2.8.3)
+
 ADM_INSTALL_LIB(ADM_coreMuxer6)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/CMakeLists.txt	2010-12-29 19:52:58 UTC (rev 6881)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/CMakeLists.txt	2010-12-29 20:12:51 UTC (rev 6882)
@@ -17,9 +17,11 @@
 prefs.cpp)
 
 ADD_LIBRARY(ADM_coreUtils6 SHARED ${ADM_coreUtils_SRCS})
-
 TARGET_LINK_LIBRARIES(ADM_coreUtils6 ADM_core6 ADM_coreUI6 ADM_libavutil ADM_libavcodec ${LIBXML2_LIBRARIES})
 
+if (NOT ${CMAKE_VERSION} VERSION_GREATER 2.8.3)
+	add_dependencies(ADM_coreUtils6 libavcodec libavutil)
+endif (NOT ${CMAKE_VERSION} VERSION_GREATER 2.8.3)
 
 ADD_SOURCE_CFLAGS(prefs.cpp -I${LIBXML2_INCLUDE_DIR} ${LIBXML2_DEFINITIONS})
 ADD_SOURCE_CFLAGS(ADM_quota.cpp -I${LIBXML2_INCLUDE_DIR} ${LIBXML2_DEFINITIONS})

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/CMakeLists.txt	2010-12-29 19:52:58 UTC (rev 6881)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/CMakeLists.txt	2010-12-29 20:12:51 UTC (rev 6882)
@@ -17,6 +17,11 @@
                                           ADM_libavcodec
                                           ADM_libavformat
                                           ADM_libavutil)
+
+if (NOT ${CMAKE_VERSION} VERSION_GREATER 2.8.3)
+	add_dependencies(ADM_coreVideoCodec6 libavcodec libavformat libavutil)
+endif (NOT ${CMAKE_VERSION} VERSION_GREATER 2.8.3)
+
 ADM_INSTALL_LIB(ADM_coreVideoCodec6)
 
 REMOVE_DEFINITIONS(-DHAVE_CONFIG_H)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/CMakeLists.txt	2010-12-29 19:52:58 UTC (rev 6881)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/src/CMakeLists.txt	2010-12-29 20:12:51 UTC (rev 6882)
@@ -6,5 +6,8 @@
 ADD_LIBRARY(ADM_coreVideoEncoder6 SHARED ${ADM_CoreVideoEncoder_SRCS})
 TARGET_LINK_LIBRARIES(ADM_coreVideoEncoder6 ADM_core6 ADM_coreUtils6 ADM_coreImage6 ADM_libavcodec ADM_libavutil)
 
-ADM_INSTALL_LIB(ADM_coreVideoEncoder6)
+if (NOT ${CMAKE_VERSION} VERSION_GREATER 2.8.3)
+	add_dependencies(ADM_coreVideoEncoder6 libavcodec libavutil)
+endif (NOT ${CMAKE_VERSION} VERSION_GREATER 2.8.3)
 
+ADM_INSTALL_LIB(ADM_coreVideoEncoder6)
\ No newline at end of file



From gruntster at mail.berlios.de  Wed Dec 29 22:10:16 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 29 Dec 2010 22:10:16 +0100
Subject: [Avidemux-svn-commit] r6883 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101229211016.84333480781@sheep.berlios.de>

Author: gruntster
Date: 2010-12-29 22:10:16 +0100 (Wed, 29 Dec 2010)
New Revision: 6883

Removed:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegClean.cmake
Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
Log:
[ffmpeg] replace cleanffmpeg target with just wiping ffmpeg directories using make clean

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-29 20:12:51 UTC (rev 6882)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-29 21:10:16 UTC (rev 6883)
@@ -5,14 +5,10 @@
 set(FFMPEG_SOURCE_ARCHIVE "ffmpeg_r${FFMPEG_VERSION}.tar.gz")
 set(SWSCALE_SOURCE_ARCHIVE "libswscale_r${SWSCALE_VERSION}.tar.gz")
 
-
-include(admFFmpegUtil)
-find_package(Tar)
-
-
 set(FFMPEG_EXTRACT_DIR "${CMAKE_BINARY_DIR}")
-set(FFMPEG_SOURCE_DIR "${FFMPEG_EXTRACT_DIR}/ffmpeg")
-set(FFMPEG_BINARY_DIR "${CMAKE_BINARY_DIR}/ffmpeg")
+set(FFMPEG_BASE_DIR "${FFMPEG_EXTRACT_DIR}/ffmpeg")
+set(FFMPEG_SOURCE_DIR "${FFMPEG_BASE_DIR}/source")
+set(FFMPEG_BINARY_DIR "${FFMPEG_BASE_DIR}/build")
 
 set(FFMPEG_DECODERS  adpcm_ima_amv  amv  bmp  cinepak  cyuv  dca  dvbsub  dvvideo  ffv1  ffvhuff  flv  fraps  h263  h264  huffyuv  mjpeg
 					 mjpegb  mpeg2video  mpeg4  msmpeg4v2  msmpeg4v3  msvideo1  nellymoser  png  qdm2  rawvideo  snow  svq3  theora  tscc
@@ -24,6 +20,12 @@
 set(FFMPEG_FLAGS  --enable-shared --disable-static --disable-everything --disable-avfilter --enable-hwaccels --enable-postproc --enable-gpl 
 				  --enable-runtime-cpudetect --disable-network --disable-ffplay --disable-ffprobe --prefix=${CMAKE_INSTALL_PREFIX})
 
+# Clean FFmpeg
+set_directory_properties(${CMAKE_CURRENT_BINARY_DIR} ADDITIONAL_MAKE_CLEAN_FILES "${FFMPEG_BASE_DIR}")
+
+# Prepare FFmpeg source
+include(admFFmpegUtil)
+find_package(Tar)
 include(admFFmpegPrepareTar)
 
 if (NOT FFMPEG_PREPARED)
@@ -220,10 +222,4 @@
 	"${FFMPEG_SOURCE_DIR}/libavutil/mem.h" "${FFMPEG_SOURCE_DIR}/libavutil/pixfmt.h"
 	"${FFMPEG_SOURCE_DIR}/libavutil/rational.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libavutil")
 install(FILES "${FFMPEG_SOURCE_DIR}/libpostproc/postprocess.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libpostproc")
-install(FILES "${FFMPEG_SOURCE_DIR}/libswscale/swscale.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libswscale")
-
-# Clean FFmpeg
-add_custom_target(cleanffmpeg
-				  COMMAND ${CMAKE_COMMAND} -P "${AVIDEMUX_TOP_SOURCE_DIR}/cmake/admFFmpegClean.cmake"
-				  WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}"
-				  COMMENT "Cleaning FFmpeg")
\ No newline at end of file
+install(FILES "${FFMPEG_SOURCE_DIR}/libswscale/swscale.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libswscale")
\ No newline at end of file

Deleted: branches/avidemux_2.6_branch_mean/cmake/admFFmpegClean.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegClean.cmake	2010-12-29 20:12:51 UTC (rev 6882)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegClean.cmake	2010-12-29 21:10:16 UTC (rev 6883)
@@ -1,2 +0,0 @@
-execute_process(COMMAND make clean
-				WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}")
\ No newline at end of file



From gruntster at mail.berlios.de  Wed Dec 29 22:21:09 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 29 Dec 2010 22:21:09 +0100
Subject: [Avidemux-svn-commit] r6884 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101229212110.26E48480781@sheep.berlios.de>

Author: gruntster
Date: 2010-12-29 22:21:09 +0100 (Wed, 29 Dec 2010)
New Revision: 6884

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
Log:
[ffmpeg] temporarily disable tar support

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-29 21:10:16 UTC (rev 6883)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-29 21:21:09 UTC (rev 6884)
@@ -26,7 +26,7 @@
 # Prepare FFmpeg source
 include(admFFmpegUtil)
 find_package(Tar)
-include(admFFmpegPrepareTar)
+#include(admFFmpegPrepareTar)
 
 if (NOT FFMPEG_PREPARED)
 	include(admFFmpegPrepareSvn)



From gruntster at mail.berlios.de  Wed Dec 29 23:04:16 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 29 Dec 2010 23:04:16 +0100
Subject: [Avidemux-svn-commit] r6885 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101229220416.A7D41480781@sheep.berlios.de>

Author: gruntster
Date: 2010-12-29 23:04:16 +0100 (Wed, 29 Dec 2010)
New Revision: 6885

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.6_branch_mean/cmake/admInstallDir.cmake
Log:
[ffmpeg] install ffmpeg libs to derived lib directory

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-29 21:21:09 UTC (rev 6884)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-29 22:04:16 UTC (rev 6885)
@@ -187,25 +187,13 @@
 registerFFmpeg("${FFMPEG_SOURCE_DIR}" "${FFMPEG_BINARY_DIR}" 0)
 include_directories("${FFMPEG_SOURCE_DIR}")
 
-#############################################################
-# We should use ADM_INSTALL_LIB here but it does not work
-# Temporary workaround.... Does not handle lib64 & friends
-#############################################################
-IF(WIN32)
-  install(FILES "${FFMPEG_BINARY_DIR}/libswscale/${LIBSWSCALE_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
-  install(FILES "${FFMPEG_BINARY_DIR}/libpostproc/${LIBPOSTPROC_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
-  install(FILES "${FFMPEG_BINARY_DIR}/libavutil/${LIBAVUTIL_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
-  install(FILES "${FFMPEG_BINARY_DIR}/libavcodec/${LIBAVCODEC_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
-  install(FILES "${FFMPEG_BINARY_DIR}/libavformat/${LIBAVFORMAT_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
-  install(FILES "${FFMPEG_BINARY_DIR}/libavcore/${LIBAVCORE_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}")
-ELSE(WIN32)
-  install(FILES "${FFMPEG_BINARY_DIR}/libswscale/${LIBSWSCALE_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}/lib")
-  install(FILES "${FFMPEG_BINARY_DIR}/libpostproc/${LIBPOSTPROC_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}/lib")
-  install(FILES "${FFMPEG_BINARY_DIR}/libavutil/${LIBAVUTIL_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}/lib")
-  install(FILES "${FFMPEG_BINARY_DIR}/libavcodec/${LIBAVCODEC_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}/lib")
-  install(FILES "${FFMPEG_BINARY_DIR}/libavformat/${LIBAVFORMAT_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}/lib")
-  install(FILES "${FFMPEG_BINARY_DIR}/libavcore/${LIBAVCORE_LIB}" DESTINATION "${AVIDEMUX_INSTALL_DIR}/lib")
-ENDIF(WIN32)
+ADM_INSTALL_LIB_FILES(
+	"${FFMPEG_BINARY_DIR}/libswscale/${LIBSWSCALE_LIB}"
+	"${FFMPEG_BINARY_DIR}/libpostproc/${LIBPOSTPROC_LIB}"
+	"${FFMPEG_BINARY_DIR}/libavutil/${LIBAVUTIL_LIB}"
+	"${FFMPEG_BINARY_DIR}/libavcodec/${LIBAVCODEC_LIB}"
+	"${FFMPEG_BINARY_DIR}/libavformat/${LIBAVFORMAT_LIB}"
+	"${FFMPEG_BINARY_DIR}/libavcore/${LIBAVCORE_LIB}")
 
 install(FILES "${FFMPEG_BINARY_DIR}/libavutil/avconfig.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libavutil") 
 

Modified: branches/avidemux_2.6_branch_mean/cmake/admInstallDir.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admInstallDir.cmake	2010-12-29 21:21:09 UTC (rev 6884)
+++ branches/avidemux_2.6_branch_mean/cmake/admInstallDir.cmake	2010-12-29 22:04:16 UTC (rev 6885)
@@ -36,6 +36,11 @@
 MACRO(ADM_INSTALL_LIB lib)
         INSTALL(TARGETS ${lib} RUNTIME DESTINATION ${AVIDEMUX_BIN_DIR}  LIBRARY DESTINATION ${AVIDEMUX_LIB_DIR}  ARCHIVE DESTINATION ${AVIDEMUX_LIB_DIR})
 ENDMACRO(ADM_INSTALL_LIB )
+
+MACRO(ADM_INSTALL_LIB_FILES files)
+        INSTALL(FILES ${files} DESTINATION ${AVIDEMUX_LIB_DIR})
+ENDMACRO(ADM_INSTALL_LIB)
+
 #
 # MACRO TO INSTALL REGULAR BIN
 #



From gruntster at mail.berlios.de  Wed Dec 29 23:22:15 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 29 Dec 2010 23:22:15 +0100
Subject: [Avidemux-svn-commit] r6886 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101229222216.0F16F480781@sheep.berlios.de>

Author: gruntster
Date: 2010-12-29 23:22:15 +0100 (Wed, 29 Dec 2010)
New Revision: 6886

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admInstallDir.cmake
Log:
[ffmpeg] cosmetics

Modified: branches/avidemux_2.6_branch_mean/cmake/admInstallDir.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admInstallDir.cmake	2010-12-29 22:04:16 UTC (rev 6885)
+++ branches/avidemux_2.6_branch_mean/cmake/admInstallDir.cmake	2010-12-29 22:22:15 UTC (rev 6886)
@@ -37,9 +37,9 @@
         INSTALL(TARGETS ${lib} RUNTIME DESTINATION ${AVIDEMUX_BIN_DIR}  LIBRARY DESTINATION ${AVIDEMUX_LIB_DIR}  ARCHIVE DESTINATION ${AVIDEMUX_LIB_DIR})
 ENDMACRO(ADM_INSTALL_LIB )
 
-MACRO(ADM_INSTALL_LIB_FILES files)
+MACRO (ADM_INSTALL_LIB_FILES files)
         INSTALL(FILES ${files} DESTINATION ${AVIDEMUX_LIB_DIR})
-ENDMACRO(ADM_INSTALL_LIB)
+ENDMACRO (ADM_INSTALL_LIB_FILES)
 
 #
 # MACRO TO INSTALL REGULAR BIN



From mean at mail.berlios.de  Thu Dec 30 07:39:32 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 30 Dec 2010 07:39:32 +0100
Subject: [Avidemux-svn-commit] r6887 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101230063932.3DBB1480781@sheep.berlios.de>

Author: mean
Date: 2010-12-30 07:39:31 +0100 (Thu, 30 Dec 2010)
New Revision: 6887

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
Log:
[build] Re-enable tarball management for non win32 target

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-29 22:22:15 UTC (rev 6886)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-30 06:39:31 UTC (rev 6887)
@@ -25,8 +25,10 @@
 
 # Prepare FFmpeg source
 include(admFFmpegUtil)
-find_package(Tar)
-#include(admFFmpegPrepareTar)
+IF(NOT WIN32)
+  find_package(Tar)
+  include(admFFmpegPrepareTar)
+ENDIF(NOT WIN32)
 
 if (NOT FFMPEG_PREPARED)
 	include(admFFmpegPrepareSvn)
@@ -210,4 +212,4 @@
 	"${FFMPEG_SOURCE_DIR}/libavutil/mem.h" "${FFMPEG_SOURCE_DIR}/libavutil/pixfmt.h"
 	"${FFMPEG_SOURCE_DIR}/libavutil/rational.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libavutil")
 install(FILES "${FFMPEG_SOURCE_DIR}/libpostproc/postprocess.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libpostproc")
-install(FILES "${FFMPEG_SOURCE_DIR}/libswscale/swscale.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libswscale")
\ No newline at end of file
+install(FILES "${FFMPEG_SOURCE_DIR}/libswscale/swscale.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libswscale")



From mean at mail.berlios.de  Thu Dec 30 07:39:32 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 30 Dec 2010 07:39:32 +0100
Subject: [Avidemux-svn-commit] r6888 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101230063933.0D3F2480785@sheep.berlios.de>

Author: mean
Date: 2010-12-30 07:39:32 +0100 (Thu, 30 Dec 2010)
New Revision: 6888

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareSvn.cmake
Log:
[build] Update layout for new ffmpeg source/build scheme

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareSvn.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareSvn.cmake	2010-12-30 06:39:31 UTC (rev 6887)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareSvn.cmake	2010-12-30 06:39:32 UTC (rev 6888)
@@ -12,8 +12,8 @@
 					${ffmpegSvnOutput})
 	MESSAGE(STATUS "Archiving ffmpeg ${FFMPEG_VERSION}")
 	MESSAGE(STATUS "${TAR_EXECUTABLE} czf ${LIBRARY_SOURCE_DIR}/${FFMPEG_SOURCE_ARCHIVE} ffmpeg, DIR=${FFMPEG_SOURCE_DIR}/..")
-	execute_process(COMMAND ${TAR_EXECUTABLE} czf "${LIBRARY_SOURCE_DIR}/${FFMPEG_SOURCE_ARCHIVE}" ffmpeg
-				WORKING_DIRECTORY "${FFMPEG_SOURCE_DIR}/.."
+	execute_process(COMMAND ${TAR_EXECUTABLE} czf "${LIBRARY_SOURCE_DIR}/${FFMPEG_SOURCE_ARCHIVE}" source
+				WORKING_DIRECTORY "${FFMPEG_BASE_DIR}"
 				)
 
 	message(STATUS "Checking out libswscale")



From mean at mail.berlios.de  Thu Dec 30 07:39:33 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 30 Dec 2010 07:39:33 +0100
Subject: [Avidemux-svn-commit] r6889 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101230063933.F2262480781@sheep.berlios.de>

Author: mean
Date: 2010-12-30 07:39:33 +0100 (Thu, 30 Dec 2010)
New Revision: 6889

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareTar.cmake
Log:
[build] Update layout for new ffmpeg source/build scheme

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareTar.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareTar.cmake	2010-12-30 06:39:32 UTC (rev 6888)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareTar.cmake	2010-12-30 06:39:33 UTC (rev 6889)
@@ -5,9 +5,8 @@
 if (EXISTS "${LIBRARY_SOURCE_DIR}/${FFMPEG_SOURCE_ARCHIVE}" AND EXISTS "${LIBRARY_SOURCE_DIR}/${SWSCALE_SOURCE_ARCHIVE}")
 	if (NOT EXISTS "${FFMPEG_SOURCE_DIR}/ffmpeg.c" OR NOT ${LAST_FFMPEG_VERSION} EQUAL ${FFMPEG_VERSION})
 		find_package(Tar)
-		MESSAGE(STATUS "Unpacking ffmpeg from ${LIBRARY_SOURCE_DIR} to ${FFMPEG_EXTRACT_DIR}")
-		execute_process(COMMAND ${TAR_EXECUTABLE} xvf ${LIBRARY_SOURCE_DIR}/${FFMPEG_SOURCE_ARCHIVE}
-					WORKING_DIRECTORY "${FFMPEG_EXTRACT_DIR}"
+		MESSAGE(STATUS "Unpacking ffmpeg from ${LIBRARY_SOURCE_DIR} to ${FFMPEG_BASE_DIR}")
+		execute_process(COMMAND ${TAR_EXECUTABLE} xvf ${LIBRARY_SOURCE_DIR}/${FFMPEG_SOURCE_ARCHIVE -C ${FFMPEG_BASE_DIR}
 					${ffmpegExtractOutput})
 
 		set(FFMPEG_PERFORM_PATCH 1)
@@ -18,8 +17,7 @@
 		find_package(Tar)
 		MESSAGE(STATUS "Unpacking libswscale from ${LIBRARY_SOURCE_DIR} to ${FFMPEG_SOURCE_DIR}")
 
-		execute_process(COMMAND ${TAR_EXECUTABLE} xvf ${LIBRARY_SOURCE_DIR}/${SWSCALE_SOURCE_ARCHIVE}
-					WORKING_DIRECTORY "${FFMPEG_SOURCE_DIR}"
+		execute_process(COMMAND ${TAR_EXECUTABLE} xvf ${LIBRARY_SOURCE_DIR}/${SWSCALE_SOURCE_ARCHIVE} -C ${FFMPEG_SOURCE_DIR}
 					${ffmpegExtractOutput})
 
 		set(FFMPEG_PERFORM_PATCH 1)



From mean at mail.berlios.de  Thu Dec 30 07:41:20 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 30 Dec 2010 07:41:20 +0100
Subject: [Avidemux-svn-commit] r6891 - branches/avidemux_2.6_branch_mean
Message-ID: <20101230064120.F1D78480781@sheep.berlios.de>

Author: mean
Date: 2010-12-30 07:41:20 +0100 (Thu, 30 Dec 2010)
New Revision: 6891

Modified:
   branches/avidemux_2.6_branch_mean/bootStrap.bash
Log:
[build] Bootstrap : revert tweaks as it now works without it

Modified: branches/avidemux_2.6_branch_mean/bootStrap.bash
===================================================================
--- branches/avidemux_2.6_branch_mean/bootStrap.bash	2010-12-30 06:41:06 UTC (rev 6890)
+++ branches/avidemux_2.6_branch_mean/bootStrap.bash	2010-12-30 06:41:20 UTC (rev 6891)
@@ -15,35 +15,6 @@
         exit 1
 }
 
-Process2()
-{
-        export BUILDDIR=$1
-        export SOURCEDIR=$2
-        export EXTRA=$3
-        export DEBUG=""
-        BUILDER="Unix Makefiles"
-        if [ "x$debug" = "x1" ] ; then 
-                DEBUG="-DVERBOSE=1 -DCMAKE_BUILD_TYPE=Debug  "
-                BUILDDIR="${BUILDDIR}_debug"
-                BUILDER="CodeBlocks - Unix Makefiles"
-        fi
-        
-        echo "Building $BUILDDIR from $SOURCEDIR with EXTRA=<$EXTRA>, DEBUG=<$DEBUG>"
-        rm -Rf ./$BUILDDIR
-        mkdir $BUILDDIR || fail mkdir
-        cd $BUILDDIR 
-        cmake $PKG -DCMAKE_EDIT_COMMAND=vim -DAVIDEMUX_SOURCE_DIR=$TOP -DCMAKE_INSTALL_PREFIX=/usr $EXTRA $DEBUG -G "$BUILDER" $SOURCEDIR || fail cmakeZ
-	echo "Building ffmpeg"
-	cd ffmpeg && make >& /tmp/log$BUILDDIR || fail ffmpeg
-	cd ..
-	echo "Building core"
-        make   >> /tmp/log$BUILDDIR || fail make
-	if  [ "x$PKG" = "x" ] ; then
-	  echo "No packaging..."
-        else
-          fakeroot make package DESTDIR=debPack || fail package
-	fi
-}
 
 Process()
 {
@@ -188,7 +159,7 @@
 if [ "x$do_core" = "x1" ] ; then 
         echo "** CORE **"
         cd $TOP
-        Process2 buildCore ../avidemux_core
+        Process buildCore ../avidemux_core
         echo " Core needs to be installed, installing through sudo make install ...."
         cd $TOP/buildCore${POSTFIX} && sudo make install
 fi



From mean at mail.berlios.de  Thu Dec 30 07:56:23 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 30 Dec 2010 07:56:23 +0100
Subject: [Avidemux-svn-commit] r6892 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101230065623.E3E4F480781@sheep.berlios.de>

Author: mean
Date: 2010-12-30 07:56:23 +0100 (Thu, 30 Dec 2010)
New Revision: 6892

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareTar.cmake
Log:
[build] Fix typo

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareTar.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareTar.cmake	2010-12-30 06:41:20 UTC (rev 6891)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareTar.cmake	2010-12-30 06:56:23 UTC (rev 6892)
@@ -6,7 +6,7 @@
 	if (NOT EXISTS "${FFMPEG_SOURCE_DIR}/ffmpeg.c" OR NOT ${LAST_FFMPEG_VERSION} EQUAL ${FFMPEG_VERSION})
 		find_package(Tar)
 		MESSAGE(STATUS "Unpacking ffmpeg from ${LIBRARY_SOURCE_DIR} to ${FFMPEG_BASE_DIR}")
-		execute_process(COMMAND ${TAR_EXECUTABLE} xvf ${LIBRARY_SOURCE_DIR}/${FFMPEG_SOURCE_ARCHIVE -C ${FFMPEG_BASE_DIR}
+		execute_process(COMMAND ${TAR_EXECUTABLE} xvf ${LIBRARY_SOURCE_DIR}/${FFMPEG_SOURCE_ARCHIVE} -C ${FFMPEG_BASE_DIR}
 					${ffmpegExtractOutput})
 
 		set(FFMPEG_PERFORM_PATCH 1)



From mean at mail.berlios.de  Thu Dec 30 08:10:55 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 30 Dec 2010 08:10:55 +0100
Subject: [Avidemux-svn-commit] r6893 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101230071056.2AD9E480781@sheep.berlios.de>

Author: mean
Date: 2010-12-30 08:10:55 +0100 (Thu, 30 Dec 2010)
New Revision: 6893

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareTar.cmake
Log:
[build] When using tarball, create the directory containing ffmpeg else tar cannot use it

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareTar.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareTar.cmake	2010-12-30 06:56:23 UTC (rev 6892)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareTar.cmake	2010-12-30 07:10:55 UTC (rev 6893)
@@ -3,6 +3,8 @@
 endif (NOT VERBOSE)
 
 if (EXISTS "${LIBRARY_SOURCE_DIR}/${FFMPEG_SOURCE_ARCHIVE}" AND EXISTS "${LIBRARY_SOURCE_DIR}/${SWSCALE_SOURCE_ARCHIVE}")
+	MESSAGE(STATUS "Creating ${FFMPEG_BASE_DIR}")
+	file(MAKE_DIRECTORY "${FFMPEG_BASE_DIR}")
 	if (NOT EXISTS "${FFMPEG_SOURCE_DIR}/ffmpeg.c" OR NOT ${LAST_FFMPEG_VERSION} EQUAL ${FFMPEG_VERSION})
 		find_package(Tar)
 		MESSAGE(STATUS "Unpacking ffmpeg from ${LIBRARY_SOURCE_DIR} to ${FFMPEG_BASE_DIR}")



From mean at mail.berlios.de  Thu Dec 30 20:08:20 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 30 Dec 2010 20:08:20 +0100
Subject: [Avidemux-svn-commit] r6894 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101230190820.47E3148078C@sheep.berlios.de>

Author: mean
Date: 2010-12-30 20:08:19 +0100 (Thu, 30 Dec 2010)
New Revision: 6894

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
Log:
[build] Preliminary support for Xmingw, incomplete

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-30 07:10:55 UTC (rev 6893)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-30 19:08:19 UTC (rev 6894)
@@ -18,17 +18,26 @@
 set(FFMPEG_PARSERS  ac3  h263  h264  mpeg4video)
 set(FFMPEG_PROTOCOLS  file)
 set(FFMPEG_FLAGS  --enable-shared --disable-static --disable-everything --disable-avfilter --enable-hwaccels --enable-postproc --enable-gpl 
-				  --enable-runtime-cpudetect --disable-network --disable-ffplay --disable-ffprobe --prefix=${CMAKE_INSTALL_PREFIX})
+				  --enable-runtime-cpudetect --disable-network --disable-ffplay --disable-ffprobe)
+MACRO(XADD opt)
+	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} ${opt})
+ENDMACRO(XADD opt)
+#
+#
+IF(NOT CROSS)
+ XADD(--prefix=${CMAKE_INSTALL_PREFIX})
+ENDIF(NOT CROSS)
 
 # Clean FFmpeg
 set_directory_properties(${CMAKE_CURRENT_BINARY_DIR} ADDITIONAL_MAKE_CLEAN_FILES "${FFMPEG_BASE_DIR}")
 
 # Prepare FFmpeg source
 include(admFFmpegUtil)
-IF(NOT WIN32)
+
+IF((NOT WIN32) OR CROSS)
   find_package(Tar)
   include(admFFmpegPrepareTar)
-ENDIF(NOT WIN32)
+ENDIF((NOT WIN32) OR CROSS)
 
 if (NOT FFMPEG_PREPARED)
 	include(admFFmpegPrepareSvn)
@@ -116,7 +125,35 @@
 	set(FF_FLAGS "${FF_FLAGS}" CACHE STRING "")
 	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} ${FF_FLAGS})
 endif (FF_FLAGS)
+#
+#   CROSS COMPILER OVERRIDE (win32 & win64)
+#
+	IF(CROSS)
+		XADD(--enable-cross-compile )
+		XADD(--prefix=/mingw)
+		XADD(--host-cc=gcc)
+		XADD(--cc=${CMAKE_CROSS_PREFIX}-gcc )
+		XADD(--ld=${CMAKE_CROSS_PREFIX}-gcc ) # Not an error !
+		XADD(--ar=${CMAKE_CROSS_PREFIX}-ar ) 
+		XADD(--nm=${CMAKE_CROSS_PREFIX}-nm ) 
+		XADD(--sysroot=/mingw/include)
+		XADD(--target-os=mingw32)
+		#--extra-cflags=-I${CROSS}/include --extra-ldflags=-L${CROSS}/lib")
 
+		IF(ADM_CPU_64BIT)	
+			XADD(--arch=X86_64)
+		ELSE(ADM_CPU_64BIT)	
+			XADD(--arch=i386)
+		ENDIF(ADM_CPU_64BIT)	
+		MESSAGE(STATUS "Using cross compilation flag : ${FFMPEG_FLAGS}")
+	ENDIF(CROSS)
+#
+
+#   /CROSS COMPILER OVERRIDE (win32 & win64)
+
+#
+
+
 if (NOT "${LAST_FFMPEG_FLAGS}" STREQUAL "${FFMPEG_FLAGS}")
 	set(FFMPEG_PERFORM_BUILD 1)
 endif (NOT "${LAST_FFMPEG_FLAGS}" STREQUAL "${FFMPEG_FLAGS}")
@@ -133,9 +170,11 @@
 	file(REMOVE "${FFMPEG_BINARY_DIR}/ffmpeg${CMAKE_EXECUTABLE_SUFFIX}")
 	file(REMOVE "${FFMPEG_BINARY_DIR}/ffmpeg_g${CMAKE_EXECUTABLE_SUFFIX}")
 
+	#MESSAGE(STATUS "-> sh ${FFMPEG_SOURCE_DIR}/configure ${FFMPEG_FLAGS}")
 	execute_process(COMMAND sh ${FFMPEG_SOURCE_DIR}/configure ${FFMPEG_FLAGS}
 					WORKING_DIRECTORY "${FFMPEG_BINARY_DIR}"
 					${ffmpegBuildOutput})
+	MESSAGE(STATUS "Configuring done, processing")
 
 	if (ADM_CPU_X86)
 		file(READ ${FFMPEG_BINARY_DIR}/config.h FF_CONFIG_H)
@@ -144,7 +183,7 @@
 		if (NOT FF_YASM)
 			message(FATAL_ERROR "Yasm was not found.")
 		endif (NOT FF_YASM)
-
+		IF(NOT CROSS)
 		if (WIN32)
 			string(REGEX MATCH "#define[ ]+CONFIG_DXVA2[ ]+1" FF_DXVA2 "${FF_CONFIG_H}")
 			
@@ -152,6 +191,7 @@
 				message(FATAL_ERROR "DXVA2 not detected.  Ensure the dxva2api.h system header exists (available from Microsoft or http://downloads.videolan.org/pub/videolan/testing/contrib/dxva2api.h).")
 			endif (NOT FF_DXVA2)
 		endif (WIN32)
+		ENDIF(NOT CROSS)
 	endif (ADM_CPU_X86)
 
 	execute_process(COMMAND ${CMAKE_COMMAND} -E make_directory "libavutil"



From mean at mail.berlios.de  Thu Dec 30 21:37:21 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Thu, 30 Dec 2010 21:37:21 +0100
Subject: [Avidemux-svn-commit] r6895 -
	branches/avidemux_2.6_branch_mean/foreignBuilds
Message-ID: <20101230203721.779FC48078C@sheep.berlios.de>

Author: mean
Date: 2010-12-30 21:37:21 +0100 (Thu, 30 Dec 2010)
New Revision: 6895

Modified:
   branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw_core
Log:
[build] Committed missing file

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw_core
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw_core	2010-12-30 19:08:19 UTC (rev 6894)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw_core	2010-12-30 20:37:21 UTC (rev 6895)
@@ -12,6 +12,7 @@
 cmake   -DCROSS=$MINGW \
         -DCMAKE_INCLUDE_PATH=$MINGW/include -DCMAKE_LIBRARY_PATH=$MINGW/lib \
         -DCMAKE_INSTALL_PREFIX=$MINGW/Release \
+        -DCMAKE_CROSS_PREFIX=$CROSS_PREFIX \
         -DCMAKE_C_COMPILER:STRING=$CROSS_PREFIX-gcc \
         -DCMAKE_CXX_COMPILER:STRING=$CROSS_PREFIX-g++ \
         -DCMAKE_LINKER:STRING=$CROSS_PREFIX-ld \



From mean at mail.berlios.de  Fri Dec 31 09:22:59 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 31 Dec 2010 09:22:59 +0100
Subject: [Avidemux-svn-commit] r6896 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101231082300.0FEEF4803D7@sheep.berlios.de>

Author: mean
Date: 2010-12-31 09:22:59 +0100 (Fri, 31 Dec 2010)
New Revision: 6896

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
Log:
[build] Install lib one per one, Xcompiler does not like a list

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-30 20:37:21 UTC (rev 6895)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-31 08:22:59 UTC (rev 6896)
@@ -229,13 +229,12 @@
 registerFFmpeg("${FFMPEG_SOURCE_DIR}" "${FFMPEG_BINARY_DIR}" 0)
 include_directories("${FFMPEG_SOURCE_DIR}")
 
-ADM_INSTALL_LIB_FILES(
-	"${FFMPEG_BINARY_DIR}/libswscale/${LIBSWSCALE_LIB}"
-	"${FFMPEG_BINARY_DIR}/libpostproc/${LIBPOSTPROC_LIB}"
-	"${FFMPEG_BINARY_DIR}/libavutil/${LIBAVUTIL_LIB}"
-	"${FFMPEG_BINARY_DIR}/libavcodec/${LIBAVCODEC_LIB}"
-	"${FFMPEG_BINARY_DIR}/libavformat/${LIBAVFORMAT_LIB}"
-	"${FFMPEG_BINARY_DIR}/libavcore/${LIBAVCORE_LIB}")
+ADM_INSTALL_LIB_FILES( "${FFMPEG_BINARY_DIR}/libswscale/${LIBSWSCALE_LIB}")
+ADM_INSTALL_LIB_FILES( "${FFMPEG_BINARY_DIR}/libpostproc/${LIBPOSTPROC_LIB}")
+ADM_INSTALL_LIB_FILES( "${FFMPEG_BINARY_DIR}/libavutil/${LIBAVUTIL_LIB}")
+ADM_INSTALL_LIB_FILES( "${FFMPEG_BINARY_DIR}/libavcodec/${LIBAVCODEC_LIB}")
+ADM_INSTALL_LIB_FILES( "${FFMPEG_BINARY_DIR}/libavformat/${LIBAVFORMAT_LIB}")
+ADM_INSTALL_LIB_FILES( "${FFMPEG_BINARY_DIR}/libavcore/${LIBAVCORE_LIB}")
 
 install(FILES "${FFMPEG_BINARY_DIR}/libavutil/avconfig.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libavutil") 
 



From mean at mail.berlios.de  Fri Dec 31 10:27:15 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 31 Dec 2010 10:27:15 +0100
Subject: [Avidemux-svn-commit] r6897 - branches/avidemux_2.6_branch_mean
Message-ID: <20101231092715.A1CF34803D7@sheep.berlios.de>

Author: mean
Date: 2010-12-31 10:27:15 +0100 (Fri, 31 Dec 2010)
New Revision: 6897

Modified:
   branches/avidemux_2.6_branch_mean/bootStrap.bash
Log:
[build] Do release build by default

Modified: branches/avidemux_2.6_branch_mean/bootStrap.bash
===================================================================
--- branches/avidemux_2.6_branch_mean/bootStrap.bash	2010-12-31 08:22:59 UTC (rev 6896)
+++ branches/avidemux_2.6_branch_mean/bootStrap.bash	2010-12-31 09:27:15 UTC (rev 6897)
@@ -8,7 +8,7 @@
 do_gtk=0
 do_qt4=1
 do_plugins=1
-debug=1
+debug=0
 fail()
 {
         echo "** Failed at $1**"



From mean at mail.berlios.de  Fri Dec 31 10:27:16 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 31 Dec 2010 10:27:16 +0100
Subject: [Avidemux-svn-commit] r6898 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101231092716.72EA84803D7@sheep.berlios.de>

Author: mean
Date: 2010-12-31 10:27:16 +0100 (Fri, 31 Dec 2010)
New Revision: 6898

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
Log:
[build] win64 is x86_64 not X86_64

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-31 09:27:15 UTC (rev 6897)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-31 09:27:16 UTC (rev 6898)
@@ -141,7 +141,7 @@
 		#--extra-cflags=-I${CROSS}/include --extra-ldflags=-L${CROSS}/lib")
 
 		IF(ADM_CPU_64BIT)	
-			XADD(--arch=X86_64)
+			XADD(--arch=x86_64)
 		ELSE(ADM_CPU_64BIT)	
 			XADD(--arch=i386)
 		ENDIF(ADM_CPU_64BIT)	



From mean at mail.berlios.de  Fri Dec 31 10:27:17 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 31 Dec 2010 10:27:17 +0100
Subject: [Avidemux-svn-commit] r6899 -
	branches/avidemux_2.6_branch_mean/foreignBuilds
Message-ID: <20101231092717.6813C4803D7@sheep.berlios.de>

Author: mean
Date: 2010-12-31 10:27:17 +0100 (Fri, 31 Dec 2010)
New Revision: 6899

Modified:
   branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_core
Log:
[build] Toolchain file does not work any longer

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_core
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_core	2010-12-31 09:27:16 UTC (rev 6898)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_core	2010-12-31 09:27:17 UTC (rev 6899)
@@ -11,7 +11,12 @@
 echo "<<<<<<<<<<<<Cross compiling core ($MINGW)>>>>>>>>>>>>>>>>"
 cmake   -DCROSS=$MINGW \
         -DCMAKE_INSTALL_PREFIX=$MINGW/Release \
-	-DCMAKE_TOOLCHAIN_FILE=$TOP/foreignBuilds/cross_mingw64_cmake \
+	-DCMAKE_CROSS_PREFIX=$CROSS_PREFIX \
+        -DCMAKE_C_COMPILER:STRING=$CROSS_PREFIX-gcc \
+        -DCMAKE_CXX_COMPILER:STRING=$CROSS_PREFIX-g++ \
+        -DCMAKE_LINKER:STRING=$CROSS_PREFIX-ld \
+        -DCMAKE_AR:STRING=$CROSS_PREFIX-ar \
+        -DCMAKE_SYSTEM_NAME:STRING=Windows \
         $DEBUG\
         -DAVIDEMUX_TOP_SOURCE_DIR="$TOP"  \
         $TOP/avidemux_core



From mean at mail.berlios.de  Fri Dec 31 10:27:18 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 31 Dec 2010 10:27:18 +0100
Subject: [Avidemux-svn-commit] r6900 -
	branches/avidemux_2.6_branch_mean/foreignBuilds
Message-ID: <20101231092718.62DC54803D7@sheep.berlios.de>

Author: mean
Date: 2010-12-31 10:27:18 +0100 (Fri, 31 Dec 2010)
New Revision: 6900

Modified:
   branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_plugins
   branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_qt4
Log:
[build] CMAKE_TOOLCHAIN_FILE does not work on Xmingw64

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_plugins
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_plugins	2010-12-31 09:27:17 UTC (rev 6899)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_plugins	2010-12-31 09:27:18 UTC (rev 6900)
@@ -11,7 +11,12 @@
 echo "<<<<<<<<<<<<Cross compiling plugins>>>>>>>>>>>>>>>"
 cmake   -DCROSS=$MINGW \
         -DCMAKE_INSTALL_PREFIX=$MINGW/Release \
-	-DCMAKE_TOOLCHAIN_FILE=$TOP/foreignBuilds/cross_mingw64_cmake \
+	-DCMAKE_CROSS_PREFIX=$CROSS_PREFIX \
+        -DCMAKE_C_COMPILER:STRING=$CROSS_PREFIX-gcc \
+        -DCMAKE_CXX_COMPILER:STRING=$CROSS_PREFIX-g++ \
+        -DCMAKE_LINKER:STRING=$CROSS_PREFIX-ld \
+        -DCMAKE_AR:STRING=$CROSS_PREFIX-ar \
+        -DCMAKE_SYSTEM_NAME:STRING=Windows \
         -DQT_HOME:STRING=$QT_HOME \
          $DEBUG \
         -DAVIDEMUX_SOURCE_DIR="$TOP"  \

Modified: branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_qt4
===================================================================
--- branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_qt4	2010-12-31 09:27:17 UTC (rev 6899)
+++ branches/avidemux_2.6_branch_mean/foreignBuilds/cross_mingw64_qt4	2010-12-31 09:27:18 UTC (rev 6900)
@@ -13,7 +13,12 @@
 cmake   -DCROSS=$MINGW \
         -DCMAKE_INSTALL_PREFIX=$MINGW/Release \
         -DQT_HOME:STRING=$QT_HOME \
-	-DCMAKE_TOOLCHAIN_FILE=$TOP/foreignBuilds/cross_mingw64_cmake \
+	-DCMAKE_CROSS_PREFIX=$CROSS_PREFIX \
+        -DCMAKE_C_COMPILER:STRING=$CROSS_PREFIX-gcc \
+        -DCMAKE_CXX_COMPILER:STRING=$CROSS_PREFIX-g++ \
+        -DCMAKE_LINKER:STRING=$CROSS_PREFIX-ld \
+        -DCMAKE_AR:STRING=$CROSS_PREFIX-ar \
+        -DCMAKE_SYSTEM_NAME:STRING=Windows \
         $DEBUG \
         -DAVIDEMUX_TOP_SOURCE_DIR="$TOP"  \
         $TOP/avidemux/qt4



From mean at mail.berlios.de  Fri Dec 31 14:30:16 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 31 Dec 2010 14:30:16 +0100
Subject: [Avidemux-svn-commit] r6901 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101231133017.06E9E480772@sheep.berlios.de>

Author: mean
Date: 2010-12-31 14:30:16 +0100 (Fri, 31 Dec 2010)
New Revision: 6901

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
Log:
[ff/build] Enable ac3/eac3 and vdpau

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-31 09:27:18 UTC (rev 6900)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-31 13:30:16 UTC (rev 6901)
@@ -10,8 +10,9 @@
 set(FFMPEG_SOURCE_DIR "${FFMPEG_BASE_DIR}/source")
 set(FFMPEG_BINARY_DIR "${FFMPEG_BASE_DIR}/build")
 
-set(FFMPEG_DECODERS  adpcm_ima_amv  amv  bmp  cinepak  cyuv  dca  dvbsub  dvvideo  ffv1  ffvhuff  flv  fraps  h263  h264  huffyuv  mjpeg
-					 mjpegb  mpeg2video  mpeg4  msmpeg4v2  msmpeg4v3  msvideo1  nellymoser  png  qdm2  rawvideo  snow  svq3  theora  tscc
+set(FFMPEG_DECODERS  ac3 eac3 adpcm_ima_amv  amv  bmp  cinepak  cyuv  dca  dvbsub  dvvideo  ffv1  ffvhuff  flv  fraps  h263  h264  huffyuv  mjpeg
+					 mjpegb  mpeg2video  mpeg4  msmpeg4v2  msmpeg4v3  msvideo1  nellymoser  png  qdm2  rawvideo  snow
+					 svq3  theora  tscc 
 					 vc1  vp3  vp6  vp6a  vp6f  wmav2  wmv1  wmv2  wmv3)
 set(FFMPEG_ENCODERS  ac3  dvvideo  ffv1  ffvhuff  flv  h263  huffyuv  mjpeg  mp2  mpeg1video  mpeg2video  mpeg4  snow)
 set(FFMPEG_MUXERS  flv  matroska  mpeg1vcd  mpeg2dvd  mpeg2svcd  mpegts  mov  mp4  psp)
@@ -63,6 +64,9 @@
 
 	message("")
 endif (FFMPEG_PERFORM_PATCH)
+IF(USE_VDPAU)
+	set(FFMPEG_DECODERS  ${FFMPEG_DECODERS} h264_vdpau vc1_vdpau mpeg1_vdpau mpeg2_vdpau wmv3_vdpau)
+ENDIF(USE_VDPAU)
 
 # Configure FFmpeg, if required
 foreach (decoder ${FFMPEG_DECODERS})
@@ -95,6 +99,10 @@
 	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-pthreads)
 endif (WIN32)
 
+IF(USE_VDPAU)
+	XADD(--enable-vdpau)
+ENDIF(USE_VDPAU)
+
 if (NOT ADM_DEBUG)
 	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --disable-debug)
 endif (NOT ADM_DEBUG)



From mean at mail.berlios.de  Fri Dec 31 14:35:04 2010
From: mean at mail.berlios.de (mean at mail.berlios.de)
Date: Fri, 31 Dec 2010 14:35:04 +0100
Subject: [Avidemux-svn-commit] r6902 -
	branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src
Message-ID: <20101231133504.BEA55480772@sheep.berlios.de>

Author: mean
Date: 2010-12-31 14:35:04 +0100 (Fri, 31 Dec 2010)
New Revision: 6902

Modified:
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/ADM_ffmp43.cpp
Log:
[codec] Free the same way the context was allocated, prevent crash

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/ADM_ffmp43.cpp	2010-12-31 13:30:16 UTC (rev 6901)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoCodec/src/ADM_ffmp43.cpp	2010-12-31 13:35:04 UTC (rev 6902)
@@ -205,7 +205,12 @@
     }
 
   avcodec_close (_context);
-  ADM_dealloc (_context);
+#if LIBAVCODEC_BUILD >= 4624
+	av_free(_context);
+#else
+  delete _context;
+#endif
+ _context=NULL;
   delete[]_internalBuffer;
   printf ("[lavc] Destroyed\n");
 }



From gruntster at mail.berlios.de  Fri Dec 31 19:25:10 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri, 31 Dec 2010 19:25:10 +0100
Subject: [Avidemux-svn-commit] r6903 -
	branches/avidemux_2.6_branch_mean/cmake/patches
Message-ID: <20101231182510.A8315480794@sheep.berlios.de>

Author: gruntster
Date: 2010-12-31 19:25:10 +0100 (Fri, 31 Dec 2010)
New Revision: 6903

Added:
   branches/avidemux_2.6_branch_mean/cmake/patches/libavutil_lfg.c.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavutil_lfg.h.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libswscale_swscale_template.c.patch
Removed:
   branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_ffv1.c.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h264.c.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_vc1dec.c.patch
Modified:
   branches/avidemux_2.6_branch_mean/cmake/patches/createPatches.sh
   branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h263dec.c.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h264_parser.c.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavformat_file.c.patch
Log:
[ffmpeg] update 2.5 patches to match 2.6 - still one missing

Modified: branches/avidemux_2.6_branch_mean/cmake/patches/createPatches.sh
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/createPatches.sh	2010-12-31 13:35:04 UTC (rev 6902)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/createPatches.sh	2010-12-31 18:25:10 UTC (rev 6903)
@@ -1,8 +1,10 @@
 #!/bin/bash
 
 export curDir=$PWD
-export ffmpegPath=../../avidemux/ADM_libraries/ffmpeg
+export ffmpegPath=$1/core/ffmpeg/source
 
+echo Updating patches in $ffmpegPath
+
 function updatePatch {
 	cd $ffmpegPath
 	cp $1/$2 $1/$2.new
@@ -18,18 +20,17 @@
 }
 
 updatePatch libavcodec avcodec.h
-updatePatch libavcodec ffv1.c
 updatePatch libavcodec h263dec.c
-updatePatch libavcodec h264.c
 updatePatch libavcodec h264_parser.c
 updatePatch libavcodec mpeg12.c
 updatePatch libavcodec mpeg12enc.c
 updatePatch libavcodec mpegvideo.c
 updatePatch libavcodec mpegvideo_enc.c
 updatePatch libavcodec utils.c
-updatePatch libavcodec vc1dec.c
 updatePatch libavformat file.c
 updatePatch libavformat isom.c
 updatePatch libavformat matroskaenc.c
 updatePatch libavutil avutil.h
-
+updatePatch libavutil lfg.c
+updatePatch libavutil lfg.h
+updatePatch libswscale swscale_template.c
\ No newline at end of file

Deleted: branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_ffv1.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_ffv1.c.patch	2010-12-31 13:35:04 UTC (rev 6902)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_ffv1.c.patch	2010-12-31 18:25:10 UTC (rev 6903)
@@ -1,11 +0,0 @@
---- libavcodec/ffv1.c.old	2010-12-20 13:49:20 +0000
-+++ libavcodec/ffv1.c	2010-12-20 13:49:20 +0000
-@@ -1734,6 +1734,8 @@
-         clear_state(f);
-     }else{
-         p->key_frame= 0;
-+         p->pict_type= FF_P_TYPE; // MEANX : looks more like a P to me as user
-+
-     }
-     if(f->ac>1){
-         int i;

Modified: branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h263dec.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h263dec.c.patch	2010-12-31 13:35:04 UTC (rev 6902)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h263dec.c.patch	2010-12-31 18:25:10 UTC (rev 6903)
@@ -1,12 +1,10 @@
---- libavcodec/h263dec.c.old	2010-12-20 13:49:21 +0000
-+++ libavcodec/h263dec.c	2010-12-20 13:49:21 +0000
-@@ -120,6 +120,25 @@
+--- libavcodec/h263dec.c.old	2010-12-31 18:21:47 +0000
++++ libavcodec/h263dec.c	2010-12-31 18:21:47 +0000
+@@ -120,6 +120,23 @@
  
      return 0;
  }
 +/* MeanX : Ugly patch to detect vo ppacked stuff ... */
-+int av_is_voppacked(AVCodecContext *avctx, int *vop_packed, int *gmc, int *qpel);
-+
 +int av_is_voppacked(AVCodecContext *avctx, int *vop_packed, int *gmc, int *qpel)
 +{
 +    MpegEncContext *s = avctx->priv_data;
@@ -26,7 +24,7 @@
  
  av_cold int ff_h263_decode_end(AVCodecContext *avctx)
  {
-@@ -422,6 +441,12 @@
+@@ -422,6 +439,12 @@
      } else {
          ret = h263_decode_picture_header(s);
      }
@@ -39,7 +37,7 @@
  
      if(ret==FRAME_SKIPPED) return get_consumed_bytes(s, buf_size);
  
-@@ -717,6 +742,14 @@
+@@ -717,6 +740,14 @@
  
  assert(s->current_picture.pict_type == s->current_picture_ptr->pict_type);
  assert(s->current_picture.pict_type == s->pict_type);

Deleted: branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h264.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h264.c.patch	2010-12-31 13:35:04 UTC (rev 6902)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h264.c.patch	2010-12-31 18:25:10 UTC (rev 6903)
@@ -1,22 +0,0 @@
---- libavcodec/h264.c.old	2010-12-20 13:49:22 +0000
-+++ libavcodec/h264.c	2010-12-20 13:49:22 +0000
-@@ -3395,6 +3395,19 @@
-     return 0;
- }
- 
-+/* MEANX */
-+int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc);
-+
-+int av_getAVCStreamInfo(AVCodecContext *avctx, uint32_t  *nalSize, uint32_t *isAvc)
-+{
-+      H264Context *h = avctx->priv_data;
-+      assert(h);
-+      *nalSize=h->nal_length_size;
-+      *isAvc=h->is_avc;
-+	return 1;
-+
-+  }
-+/* MeanX */
- 
- AVCodec h264_decoder = {
-     "h264",

Modified: branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h264_parser.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h264_parser.c.patch	2010-12-31 13:35:04 UTC (rev 6902)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h264_parser.c.patch	2010-12-31 18:25:10 UTC (rev 6903)
@@ -1,13 +1,12 @@
---- libavcodec/h264_parser.c.old	2010-12-20 13:49:23 +0000
-+++ libavcodec/h264_parser.c	2010-12-20 13:49:23 +0000
-@@ -30,7 +30,52 @@
+--- libavcodec/h264_parser.c.old	2010-12-31 18:21:50 +0000
++++ libavcodec/h264_parser.c	2010-12-31 18:21:50 +0000
+@@ -30,7 +30,51 @@
  #include "h264data.h"
  #include "golomb.h"
  
 +#include "ff_spsinfo.h" // MEANX
  #include <assert.h>
 + // MEANX
-+int ff_h264_info(AVCodecParserContext *parser,ffSpsInfo *info);
 +/**
 +    \fn AVCodecParserContext
 +*/

Deleted: branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_vc1dec.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_vc1dec.c.patch	2010-12-31 13:35:04 UTC (rev 6902)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_vc1dec.c.patch	2010-12-31 18:25:10 UTC (rev 6903)
@@ -1,14 +0,0 @@
---- libavcodec/vc1dec.c.old	2010-12-20 13:49:28 +0000
-+++ libavcodec/vc1dec.c	2010-12-20 13:49:28 +0000
-@@ -3146,7 +3146,10 @@
-     AVFrame *pict = data;
-     uint8_t *buf2 = NULL;
-     const uint8_t *buf_start = buf;
--
-+/** MEANX **/
-+    if(s->flags& CODEC_FLAG_LOW_DELAY)
-+        s->low_delay=1;
-+/** /MEANX **/
-     /* no supplementary picture */
-     if (buf_size == 0) {
-         /* special case for last picture */

Modified: branches/avidemux_2.6_branch_mean/cmake/patches/libavformat_file.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavformat_file.c.patch	2010-12-31 13:35:04 UTC (rev 6902)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavformat_file.c.patch	2010-12-31 18:25:10 UTC (rev 6903)
@@ -1,6 +1,6 @@
---- libavformat/file.c.old	2010-12-20 13:49:28 +0000
-+++ libavformat/file.c	2010-12-20 13:49:29 +0000
-@@ -30,6 +30,75 @@
+--- libavformat/file.c.old	2010-12-31 18:22:03 +0000
++++ libavformat/file.c	2010-12-31 18:22:03 +0000
+@@ -30,6 +30,72 @@
  #include <stdlib.h>
  #include "os_support.h"
  
@@ -8,9 +8,6 @@
 +#ifdef __WIN32
 +#include <windows.h>
 +
-+int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString);
-+int ADM_open(const char *path, int oflag, ...);
-+
 +int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString)
 +{
 +	int wideCharStringLength = MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, NULL, 0);

Added: branches/avidemux_2.6_branch_mean/cmake/patches/libavutil_lfg.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavutil_lfg.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavutil_lfg.c.patch	2010-12-31 18:25:10 UTC (rev 6903)
@@ -0,0 +1,11 @@
+--- libavutil/lfg.c.old	2010-12-31 18:22:11 +0000
++++ libavutil/lfg.c	2010-12-31 18:22:11 +0000
+@@ -39,7 +39,7 @@
+         c->state[i+2]= AV_RL32(tmp+8);
+         c->state[i+3]= AV_RL32(tmp+12);
+     }
+-    c->index=0;
++    c->xindex=0;
+ }
+ 
+ void av_bmg_get(AVLFG *lfg, double out[2])

Added: branches/avidemux_2.6_branch_mean/cmake/patches/libavutil_lfg.h.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavutil_lfg.h.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavutil_lfg.h.patch	2010-12-31 18:25:10 UTC (rev 6903)
@@ -0,0 +1,35 @@
+--- libavutil/lfg.h.old	2010-12-31 18:22:13 +0000
++++ libavutil/lfg.h	2010-12-31 18:22:13 +0000
+@@ -24,7 +24,7 @@
+ 
+ typedef struct {
+     unsigned int state[64];
+-    int index;
++    int xindex;
+ } AVLFG;
+ 
+ void av_lfg_init(AVLFG *c, unsigned int seed);
+@@ -36,8 +36,8 @@
+  * it may be good enough and faster for your specific use case.
+  */
+ static inline unsigned int av_lfg_get(AVLFG *c){
+-    c->state[c->index & 63] = c->state[(c->index-24) & 63] + c->state[(c->index-55) & 63];
+-    return c->state[c->index++ & 63];
++    c->state[c->xindex & 63] = c->state[(c->xindex-24) & 63] + c->state[(c->xindex-55) & 63];
++    return c->state[c->xindex++ & 63];
+ }
+ 
+ /**
+@@ -46,9 +46,9 @@
+  * Please also consider av_lfg_get() above, it is faster.
+  */
+ static inline unsigned int av_mlfg_get(AVLFG *c){
+-    unsigned int a= c->state[(c->index-55) & 63];
+-    unsigned int b= c->state[(c->index-24) & 63];
+-    return c->state[c->index++ & 63] = 2*a*b+a+b;
++    unsigned int a= c->state[(c->xindex-55) & 63];
++    unsigned int b= c->state[(c->xindex-24) & 63];
++    return c->state[c->xindex++ & 63] = 2*a*b+a+b;
+ }
+ 
+ /**

Added: branches/avidemux_2.6_branch_mean/cmake/patches/libswscale_swscale_template.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libswscale_swscale_template.c.patch	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libswscale_swscale_template.c.patch	2010-12-31 18:25:10 UTC (rev 6903)
@@ -0,0 +1,11 @@
+--- libswscale/swscale_template.c.old	2010-12-31 18:22:15 +0000
++++ libswscale/swscale_template.c	2010-12-31 18:22:15 +0000
+@@ -951,7 +951,7 @@
+ #if COMPILE_TEMPLATE_MMX
+     if(!(c->flags & SWS_BITEXACT)) {
+         long p= 4;
+-        const uint8_t *src[4]= {alpSrc + dstW, lumSrc + dstW, chrSrc + chrDstW, chrSrc + VOFW + chrDstW};
++        const uint8_t *src[4]= {alpSrc + dstW, (uint8_t *)lumSrc + dstW, (uint8_t *)chrSrc + chrDstW, (uint8_t *)chrSrc + VOFW + chrDstW}; // MEANX
+         uint8_t *dst[4]= {aDest, dest, uDest, vDest};
+         x86_reg counter[4]= {dstW, dstW, chrDstW, chrDstW};
+ 



From gruntster at mail.berlios.de  Fri Dec 31 20:12:13 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri, 31 Dec 2010 20:12:13 +0100
Subject: [Avidemux-svn-commit] r6904 -
	branches/avidemux_2.6_branch_mean/cmake
Message-ID: <20101231191213.59C5F480794@sheep.berlios.de>

Author: gruntster
Date: 2010-12-31 20:12:12 +0100 (Fri, 31 Dec 2010)
New Revision: 6904

Modified:
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
   branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareSvn.cmake
Log:
[ffmpeg] cosmetics

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-31 18:25:10 UTC (rev 6903)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegBuild.cmake	2010-12-31 19:12:12 UTC (rev 6904)
@@ -20,25 +20,25 @@
 set(FFMPEG_PROTOCOLS  file)
 set(FFMPEG_FLAGS  --enable-shared --disable-static --disable-everything --disable-avfilter --enable-hwaccels --enable-postproc --enable-gpl 
 				  --enable-runtime-cpudetect --disable-network --disable-ffplay --disable-ffprobe)
-MACRO(XADD opt)
+
+MACRO (xadd opt)
 	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} ${opt})
-ENDMACRO(XADD opt)
-#
-#
-IF(NOT CROSS)
- XADD(--prefix=${CMAKE_INSTALL_PREFIX})
-ENDIF(NOT CROSS)
+ENDMACRO (xadd opt)
 
+if (NOT CROSS)
+	xadd(--prefix=${CMAKE_INSTALL_PREFIX})
+endif (NOT CROSS)
+
 # Clean FFmpeg
 set_directory_properties(${CMAKE_CURRENT_BINARY_DIR} ADDITIONAL_MAKE_CLEAN_FILES "${FFMPEG_BASE_DIR}")
 
 # Prepare FFmpeg source
 include(admFFmpegUtil)
 
-IF((NOT WIN32) OR CROSS)
-  find_package(Tar)
-  include(admFFmpegPrepareTar)
-ENDIF((NOT WIN32) OR CROSS)
+if ((NOT WIN32) OR CROSS)
+	find_package(Tar)
+	include(admFFmpegPrepareTar)
+endif ((NOT WIN32) OR CROSS)
 
 if (NOT FFMPEG_PREPARED)
 	include(admFFmpegPrepareSvn)
@@ -64,10 +64,12 @@
 
 	message("")
 endif (FFMPEG_PERFORM_PATCH)
-IF(USE_VDPAU)
-	set(FFMPEG_DECODERS  ${FFMPEG_DECODERS} h264_vdpau vc1_vdpau mpeg1_vdpau mpeg2_vdpau wmv3_vdpau)
-ENDIF(USE_VDPAU)
 
+if (USE_VDPAU)
+	xadd(--enable-vdpau)
+	set(FFMPEG_DECODERS ${FFMPEG_DECODERS} h264_vdpau  vc1_vdpau  mpeg1_vdpau  mpeg2_vdpau  wmv3_vdpau)
+endif (USE_VDPAU)
+
 # Configure FFmpeg, if required
 foreach (decoder ${FFMPEG_DECODERS})
 	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-decoder=${decoder})
@@ -99,10 +101,6 @@
 	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-pthreads)
 endif (WIN32)
 
-IF(USE_VDPAU)
-	XADD(--enable-vdpau)
-ENDIF(USE_VDPAU)
-
 if (NOT ADM_DEBUG)
 	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --disable-debug)
 endif (NOT ADM_DEBUG)
@@ -115,6 +113,27 @@
 	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --extra-ldflags=${CMAKE_SHARED_LINKER_FLAGS})
 endif (CMAKE_SHARED_LINKER_FLAGS)
 
+#  Cross compiler override (win32 & win64)
+if (CROSS)
+	xadd(--prefix=/mingw)
+	xadd(--host-cc=gcc)
+	xadd(--cc=${CMAKE_CROSS_PREFIX}-gcc)
+	xadd(--ld=${CMAKE_CROSS_PREFIX}-gcc) # Not an error !
+	xadd(--ar=${CMAKE_CROSS_PREFIX}-ar) 
+	xadd(--nm=${CMAKE_CROSS_PREFIX}-nm) 
+	xadd(--sysroot=/mingw/include)
+
+	set(CROSS_OS mingw32)	
+
+	if (ADM_CPU_64BIT)
+		set(CROSS_ARCH x86_64)
+	else (ADM_CPU_64BIT)
+		set(CROSS_ARCH i386)
+	endif (ADM_CPU_64BIT)
+
+	message(STATUS "Using cross compilation flag: ${FFMPEG_FLAGS}")
+endif (CROSS)
+
 if (CROSS_ARCH OR CROSS_OS)
 	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} --enable-cross-compile)
 endif (CROSS_ARCH OR CROSS_OS)
@@ -133,35 +152,7 @@
 	set(FF_FLAGS "${FF_FLAGS}" CACHE STRING "")
 	set(FFMPEG_FLAGS ${FFMPEG_FLAGS} ${FF_FLAGS})
 endif (FF_FLAGS)
-#
-#   CROSS COMPILER OVERRIDE (win32 & win64)
-#
-	IF(CROSS)
-		XADD(--enable-cross-compile )
-		XADD(--prefix=/mingw)
-		XADD(--host-cc=gcc)
-		XADD(--cc=${CMAKE_CROSS_PREFIX}-gcc )
-		XADD(--ld=${CMAKE_CROSS_PREFIX}-gcc ) # Not an error !
-		XADD(--ar=${CMAKE_CROSS_PREFIX}-ar ) 
-		XADD(--nm=${CMAKE_CROSS_PREFIX}-nm ) 
-		XADD(--sysroot=/mingw/include)
-		XADD(--target-os=mingw32)
-		#--extra-cflags=-I${CROSS}/include --extra-ldflags=-L${CROSS}/lib")
 
-		IF(ADM_CPU_64BIT)	
-			XADD(--arch=x86_64)
-		ELSE(ADM_CPU_64BIT)	
-			XADD(--arch=i386)
-		ENDIF(ADM_CPU_64BIT)	
-		MESSAGE(STATUS "Using cross compilation flag : ${FFMPEG_FLAGS}")
-	ENDIF(CROSS)
-#
-
-#   /CROSS COMPILER OVERRIDE (win32 & win64)
-
-#
-
-
 if (NOT "${LAST_FFMPEG_FLAGS}" STREQUAL "${FFMPEG_FLAGS}")
 	set(FFMPEG_PERFORM_BUILD 1)
 endif (NOT "${LAST_FFMPEG_FLAGS}" STREQUAL "${FFMPEG_FLAGS}")
@@ -191,15 +182,14 @@
 		if (NOT FF_YASM)
 			message(FATAL_ERROR "Yasm was not found.")
 		endif (NOT FF_YASM)
-		IF(NOT CROSS)
-		if (WIN32)
+
+		if (WIN32 AND (NOT CROSS))
 			string(REGEX MATCH "#define[ ]+CONFIG_DXVA2[ ]+1" FF_DXVA2 "${FF_CONFIG_H}")
 			
 			if (NOT FF_DXVA2)
 				message(FATAL_ERROR "DXVA2 not detected.  Ensure the dxva2api.h system header exists (available from Microsoft or http://downloads.videolan.org/pub/videolan/testing/contrib/dxva2api.h).")
 			endif (NOT FF_DXVA2)
-		endif (WIN32)
-		ENDIF(NOT CROSS)
+		endif (WIN32 AND (NOT CROSS))
 	endif (ADM_CPU_X86)
 
 	execute_process(COMMAND ${CMAKE_COMMAND} -E make_directory "libavutil"
@@ -237,12 +227,12 @@
 registerFFmpeg("${FFMPEG_SOURCE_DIR}" "${FFMPEG_BINARY_DIR}" 0)
 include_directories("${FFMPEG_SOURCE_DIR}")
 
-ADM_INSTALL_LIB_FILES( "${FFMPEG_BINARY_DIR}/libswscale/${LIBSWSCALE_LIB}")
-ADM_INSTALL_LIB_FILES( "${FFMPEG_BINARY_DIR}/libpostproc/${LIBPOSTPROC_LIB}")
-ADM_INSTALL_LIB_FILES( "${FFMPEG_BINARY_DIR}/libavutil/${LIBAVUTIL_LIB}")
-ADM_INSTALL_LIB_FILES( "${FFMPEG_BINARY_DIR}/libavcodec/${LIBAVCODEC_LIB}")
-ADM_INSTALL_LIB_FILES( "${FFMPEG_BINARY_DIR}/libavformat/${LIBAVFORMAT_LIB}")
-ADM_INSTALL_LIB_FILES( "${FFMPEG_BINARY_DIR}/libavcore/${LIBAVCORE_LIB}")
+ADM_INSTALL_LIB_FILES("${FFMPEG_BINARY_DIR}/libswscale/${LIBSWSCALE_LIB}")
+ADM_INSTALL_LIB_FILES("${FFMPEG_BINARY_DIR}/libpostproc/${LIBPOSTPROC_LIB}")
+ADM_INSTALL_LIB_FILES("${FFMPEG_BINARY_DIR}/libavutil/${LIBAVUTIL_LIB}")
+ADM_INSTALL_LIB_FILES("${FFMPEG_BINARY_DIR}/libavcodec/${LIBAVCODEC_LIB}")
+ADM_INSTALL_LIB_FILES("${FFMPEG_BINARY_DIR}/libavformat/${LIBAVFORMAT_LIB}")
+ADM_INSTALL_LIB_FILES("${FFMPEG_BINARY_DIR}/libavcore/${LIBAVCORE_LIB}")
 
 install(FILES "${FFMPEG_BINARY_DIR}/libavutil/avconfig.h" DESTINATION "${AVIDEMUX_INCLUDE_DIR}/avidemux/2.6/libavutil") 
 

Modified: branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareSvn.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareSvn.cmake	2010-12-31 18:25:10 UTC (rev 6903)
+++ branches/avidemux_2.6_branch_mean/cmake/admFFmpegPrepareSvn.cmake	2010-12-31 19:12:12 UTC (rev 6904)
@@ -25,14 +25,11 @@
 				WORKING_DIRECTORY "${FFMPEG_SOURCE_DIR}/"
 				)
 
-
-
 	set(FFMPEG_PERFORM_PATCH 1)
 endif (NOT IS_DIRECTORY "${FFMPEG_SOURCE_DIR}/.svn")
 
 # Check version
 admGetRevision( ${FFMPEG_SOURCE_DIR} ffmpeg_WC_REVISION)
-#Subversion_WC_INFO(${FFMPEG_SOURCE_DIR} ffmpeg)
 message(STATUS "FFmpeg revision: ${ffmpeg_WC_REVISION}")
 
 if (NOT ${ffmpeg_WC_REVISION} EQUAL ${FFMPEG_VERSION})
@@ -50,7 +47,6 @@
 
 message("")
 admGetRevision( ${FFMPEG_SOURCE_DIR}/libswscale swscale_WC_REVISION)
-#Subversion_WC_INFO(${FFMPEG_SOURCE_DIR}/libswscale swscale)
 message(STATUS "libswscale revision: ${swscale_WC_REVISION}")
 
 if (NOT ${swscale_WC_REVISION} EQUAL ${SWSCALE_VERSION})



From gruntster at mail.berlios.de  Fri Dec 31 21:25:09 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri, 31 Dec 2010 21:25:09 +0100
Subject: [Avidemux-svn-commit] r6905 -
	branches/avidemux_2.6_branch_mean/cmake/patches
Message-ID: <20101231202509.94E09480794@sheep.berlios.de>

Author: gruntster
Date: 2010-12-31 21:25:09 +0100 (Fri, 31 Dec 2010)
New Revision: 6905

Modified:
   branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h263dec.c.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h264_parser.c.patch
   branches/avidemux_2.6_branch_mean/cmake/patches/libavformat_file.c.patch
Log:
[ffmpeg] revert some patches back to 2.5 so they play nice

Modified: branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h263dec.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h263dec.c.patch	2010-12-31 19:12:12 UTC (rev 6904)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h263dec.c.patch	2010-12-31 20:25:09 UTC (rev 6905)
@@ -1,10 +1,12 @@
---- libavcodec/h263dec.c.old	2010-12-31 18:21:47 +0000
-+++ libavcodec/h263dec.c	2010-12-31 18:21:47 +0000
-@@ -120,6 +120,23 @@
+--- libavcodec/h263dec.c.old	2010-12-20 13:49:21 +0000
++++ libavcodec/h263dec.c	2010-12-20 13:49:21 +0000
+@@ -120,6 +120,25 @@
  
      return 0;
  }
 +/* MeanX : Ugly patch to detect vo ppacked stuff ... */
++int av_is_voppacked(AVCodecContext *avctx, int *vop_packed, int *gmc, int *qpel);
++
 +int av_is_voppacked(AVCodecContext *avctx, int *vop_packed, int *gmc, int *qpel)
 +{
 +    MpegEncContext *s = avctx->priv_data;
@@ -24,7 +26,7 @@
  
  av_cold int ff_h263_decode_end(AVCodecContext *avctx)
  {
-@@ -422,6 +439,12 @@
+@@ -422,6 +441,12 @@
      } else {
          ret = h263_decode_picture_header(s);
      }
@@ -37,7 +39,7 @@
  
      if(ret==FRAME_SKIPPED) return get_consumed_bytes(s, buf_size);
  
-@@ -717,6 +740,14 @@
+@@ -717,6 +742,14 @@
  
  assert(s->current_picture.pict_type == s->current_picture_ptr->pict_type);
  assert(s->current_picture.pict_type == s->pict_type);

Modified: branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h264_parser.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h264_parser.c.patch	2010-12-31 19:12:12 UTC (rev 6904)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavcodec_h264_parser.c.patch	2010-12-31 20:25:09 UTC (rev 6905)
@@ -1,12 +1,13 @@
---- libavcodec/h264_parser.c.old	2010-12-31 18:21:50 +0000
-+++ libavcodec/h264_parser.c	2010-12-31 18:21:50 +0000
-@@ -30,7 +30,51 @@
+--- libavcodec/h264_parser.c.old	2010-12-20 13:49:23 +0000
++++ libavcodec/h264_parser.c	2010-12-20 13:49:23 +0000
+@@ -30,7 +30,52 @@
  #include "h264data.h"
  #include "golomb.h"
  
 +#include "ff_spsinfo.h" // MEANX
  #include <assert.h>
 + // MEANX
++int ff_h264_info(AVCodecParserContext *parser,ffSpsInfo *info);
 +/**
 +    \fn AVCodecParserContext
 +*/

Modified: branches/avidemux_2.6_branch_mean/cmake/patches/libavformat_file.c.patch
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/patches/libavformat_file.c.patch	2010-12-31 19:12:12 UTC (rev 6904)
+++ branches/avidemux_2.6_branch_mean/cmake/patches/libavformat_file.c.patch	2010-12-31 20:25:09 UTC (rev 6905)
@@ -1,6 +1,6 @@
---- libavformat/file.c.old	2010-12-31 18:22:03 +0000
-+++ libavformat/file.c	2010-12-31 18:22:03 +0000
-@@ -30,6 +30,72 @@
+--- libavformat/file.c.old	2010-12-20 13:49:28 +0000
++++ libavformat/file.c	2010-12-20 13:49:29 +0000
+@@ -30,6 +30,75 @@
  #include <stdlib.h>
  #include "os_support.h"
  
@@ -8,6 +8,9 @@
 +#ifdef __WIN32
 +#include <windows.h>
 +
++int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString);
++int ADM_open(const char *path, int oflag, ...);
++
 +int utf8StringToWideChar(const char *utf8String, int utf8StringLength, wchar_t *wideCharString)
 +{
 +	int wideCharStringLength = MultiByteToWideChar(CP_UTF8, 0, utf8String, utf8StringLength, NULL, 0);



From gruntster at mail.berlios.de  Fri Dec 31 22:23:09 2010
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Fri, 31 Dec 2010 22:23:09 +0100
Subject: [Avidemux-svn-commit] r6906 - in
	branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264:
	. qt4
Message-ID: <20101231212309.97B08480794@sheep.berlios.de>

Author: gruntster
Date: 2010-12-31 22:23:09 +0100 (Fri, 31 Dec 2010)
New Revision: 6906

Modified:
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Options.cpp
   branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Param.xsd
Log:
[x264] support min and max quantiser > 10

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui	2010-12-31 20:25:09 UTC (rev 6905)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/qt4/x264ConfigDialog.ui	2010-12-31 21:23:09 UTC (rev 6906)
@@ -2604,9 +2604,6 @@
               </property>
               <item>
                <widget class="QSpinBox" name="quantiserMaxSpinBox">
-                <property name="minimum">
-                 <number>10</number>
-                </property>
                 <property name="maximum">
                  <number>51</number>
                 </property>

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Options.cpp
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Options.cpp	2010-12-31 20:25:09 UTC (rev 6905)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Options.cpp	2010-12-31 21:23:09 UTC (rev 6906)
@@ -832,7 +832,7 @@
 
 void x264Options::setQuantiserMinimum(unsigned int quantiserMinimum)
 {
-	if (quantiserMinimum >= 10 && quantiserMinimum <= 51)
+	if (quantiserMinimum <= 51)
 		_param.rc.i_qp_min = quantiserMinimum;
 }
 
@@ -843,7 +843,7 @@
 
 void x264Options::setQuantiserMaximum(unsigned int quantiserMaximum)
 {
-	if (quantiserMaximum >= 10 && quantiserMaximum <= 51)
+	if (quantiserMaximum <= 51)
 		_param.rc.i_qp_max = quantiserMaximum;
 }
 

Modified: branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Param.xsd
===================================================================
--- branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Param.xsd	2010-12-31 20:25:09 UTC (rev 6905)
+++ branches/avidemux_2.5_branch_gruntster/plugins/ADM_videoEncoder/ADM_vidEnc_x264/x264Param.xsd	2010-12-31 21:23:09 UTC (rev 6906)
@@ -473,7 +473,7 @@
                     <xs:element name="quantiserMinimum" minOccurs="0">
                       <xs:simpleType>
                         <xs:restriction base="xs:integer">
-                          <xs:minInclusive value="10"/>
+                          <xs:minInclusive value="0"/>
                           <xs:maxInclusive value="51"/>
                         </xs:restriction>
                       </xs:simpleType>
@@ -481,7 +481,7 @@
                     <xs:element name="quantiserMaximum" minOccurs="0">
                       <xs:simpleType>
                         <xs:restriction base="xs:integer">
-                          <xs:minInclusive value="10"/>
+                          <xs:minInclusive value="0"/>
                           <xs:maxInclusive value="51"/>
                         </xs:restriction>
                       </xs:simpleType>



