<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r6919 - in branches/avidemux_2.6_branch_mean:	autononreg/py/avidemux avidemux/common/ADM_script2/binding	avidemux/common/ADM_script2/include avidemux/common/ADM_script2/py	avidemux/common/ADM_script2/src	avidemux/common/ADM_videoEncoder/include	avidemux/common/ADM_videoEncoder/src	avidemux_core/ADM_coreUtils/include avidemux_core/ADM_coreUtils/src	avidemux_core/ADM_coreVideoEncoder/include
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2011-January/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r6919%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09autononreg/py/avidemux%20avidemux/common/ADM_script2/binding%0A%09avidemux/common/ADM_script2/include%20avidemux/common/ADM_script2/py%0A%09avidemux/common/ADM_script2/src%0A%09avidemux/common/ADM_videoEncoder/include%0A%09avidemux/common/ADM_videoEncoder/src%0A%09avidemux_core/ADM_coreUtils/include%20avidemux_core/ADM_coreUtils/src%0A%09avidemux_core/ADM_coreVideoEncoder/include&In-Reply-To=%3C20110110185231.A8217480510%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004093.html">
   <LINK REL="Next"  HREF="004095.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r6919 - in branches/avidemux_2.6_branch_mean:	autononreg/py/avidemux avidemux/common/ADM_script2/binding	avidemux/common/ADM_script2/include avidemux/common/ADM_script2/py	avidemux/common/ADM_script2/src	avidemux/common/ADM_videoEncoder/include	avidemux/common/ADM_videoEncoder/src	avidemux_core/ADM_coreUtils/include avidemux_core/ADM_coreUtils/src	avidemux_core/ADM_coreVideoEncoder/include</H1>
    <B>mean at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r6919%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09autononreg/py/avidemux%20avidemux/common/ADM_script2/binding%0A%09avidemux/common/ADM_script2/include%20avidemux/common/ADM_script2/py%0A%09avidemux/common/ADM_script2/src%0A%09avidemux/common/ADM_videoEncoder/include%0A%09avidemux/common/ADM_videoEncoder/src%0A%09avidemux_core/ADM_coreUtils/include%20avidemux_core/ADM_coreUtils/src%0A%09avidemux_core/ADM_coreVideoEncoder/include&In-Reply-To=%3C20110110185231.A8217480510%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r6919 - in branches/avidemux_2.6_branch_mean:	autononreg/py/avidemux avidemux/common/ADM_script2/binding	avidemux/common/ADM_script2/include avidemux/common/ADM_script2/py	avidemux/common/ADM_script2/src	avidemux/common/ADM_videoEncoder/include	avidemux/common/ADM_videoEncoder/src	avidemux_core/ADM_coreUtils/include avidemux_core/ADM_coreUtils/src	avidemux_core/ADM_coreVideoEncoder/include">mean at mail.berlios.de
       </A><BR>
    <I>Mon Jan 10 19:52:31 CET 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004093.html">[Avidemux-svn-commit] r6918 -	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src
</A></li>
        <LI>Next message: <A HREF="004095.html">[Avidemux-svn-commit] r6921 - in	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4v2/libmp4v2:	. doc doc/man doc/man/man1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4094">[ date ]</a>
              <a href="thread.html#4094">[ thread ]</a>
              <a href="subject.html#4094">[ subject ]</a>
              <a href="author.html#4094">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2011-01-10 19:52:31 +0100 (Mon, 10 Jan 2011)
New Revision: 6919

Added:
   branches/avidemux_2.6_branch_mean/autononreg/py/avidemux/pySetCodec.py
   branches/avidemux_2.6_branch_mean/autononreg/py/avidemux/pyVideoCodecChangeParam.py
Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/binding/adm.admPyClass
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_scriptVideo.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm_gen.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptVideo.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/include/ADM_videoEncoderApi.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_dynVideoEncoder.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/include/ADM_paramList.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_paramList.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/include/ADM_coreVideoEncoderInternal.h
Log:
[videoCodec] Add python binding videoCodecChangeParam() to alter a video codec configuration without submitting everything

Added: branches/avidemux_2.6_branch_mean/autononreg/py/avidemux/pySetCodec.py
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/py/avidemux/pySetCodec.py	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/autononreg/py/avidemux/pySetCodec.py	2011-01-10 18:52:31 UTC (rev 6919)
@@ -0,0 +1,14 @@
+#PY  &lt;- Needed to identify#
+#--automatically built--
+#--Project: /home/fx/earl.py
+
+adm=Avidemux()
+#** Video **
+# 01 videos source 
+adm.loadVideo(&quot;/work/samples/avi/2mn.avi&quot;)
+#** Video Codec conf **
+adm.videoCodec(&quot;x264&quot;,&quot;params=AQ=20&quot;,&quot;MaxRefFrames=2&quot;,&quot;MinIdr=10&quot;,&quot;MaxIdr=150&quot;,&quot;threads=99&quot;,&quot;_8x8=True&quot;,&quot;_8x8P=True&quot;,&quot;_8x8B=True&quot;,&quot;_4x4=True&quot;,&quot;_8x8I=True&quot;,&quot;_4x4I=True&quot;,&quot;MaxBFrame=2&quot;,&quot;profile=30&quot;,&quot;CABAC=True&quot;,&quot;Trellis=True&quot;)
+
+adm.setContainer(&quot;MKV&quot;,&quot;forceDisplayWidth=False&quot;,&quot;displayWidth=1280&quot;)
+
+#End of script

Added: branches/avidemux_2.6_branch_mean/autononreg/py/avidemux/pyVideoCodecChangeParam.py
===================================================================
--- branches/avidemux_2.6_branch_mean/autononreg/py/avidemux/pyVideoCodecChangeParam.py	                        (rev 0)
+++ branches/avidemux_2.6_branch_mean/autononreg/py/avidemux/pyVideoCodecChangeParam.py	2011-01-10 18:52:31 UTC (rev 6919)
@@ -0,0 +1,16 @@
+#PY  &lt;- Needed to identify#
+#--automatically built--
+#--Project: /home/fx/earl.py
+
+gui=Gui()
+adm=Avidemux()
+#** Video **
+# 01 videos source 
+adm.loadVideo(&quot;/work/samples/avi/2mn.avi&quot;)
+#** Video Codec conf **
+adm.videoCodec(&quot;x264&quot;,&quot;params=AQ=20&quot;,&quot;MaxRefFrames=5&quot;,&quot;MinIdr=10&quot;,&quot;MaxIdr=150&quot;,&quot;threads=99&quot;,&quot;_8x8=True&quot;,&quot;_8x8P=True&quot;,&quot;_8x8B=True&quot;,&quot;_4x4=True&quot;,&quot;_8x8I=True&quot;,&quot;_4x4I=True&quot;,&quot;MaxBFrame=5&quot;,&quot;profile=30&quot;,&quot;CABAC=True&quot;,&quot;Trellis=True&quot;)
+adm.videoCodecChangeParam(&quot;x264&quot;,&quot;MaxBFrame=3&quot;,&quot;CABAC=False&quot;,&quot;Trellis=False&quot;)
+
+gui.displayInfo(&quot;Hey&quot;,&quot;Verify CABAC and TRELLIS are both false and MaxBFrame=3 &quot;)
+
+#End of script

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/binding/adm.admPyClass
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/binding/adm.admPyClass	2011-01-07 07:30:45 UTC (rev 6918)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/binding/adm.admPyClass	2011-01-10 18:52:31 UTC (rev 6919)
@@ -22,6 +22,7 @@
 #              cname:pyname
 #  Codec, container
 /* METHOD */ int scriptSetVideoCodec:videoCodec(str,couples) 
+/* METHOD */ int scriptSetVideoCodecParam:videoCodecChangeParam(str,couples) 
 /* METHOD */ int scriptSetAudioCodec:audioCodec(str,int,couples) 
 /* METHOD */ int scriptSetContainer:setContainer(str,couples) 
 /* METHOD */ int scriptAddVideoFilter:addVideoFilter(str,couples) 

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_scriptVideo.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_scriptVideo.h	2011-01-07 07:30:45 UTC (rev 6918)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/include/ADM_scriptVideo.h	2011-01-10 18:52:31 UTC (rev 6919)
@@ -22,8 +22,10 @@
 
 int     scriptSetPostProc (int a,int b, int c);
 #ifdef __cplusplus
-int     scriptSetVideoCodec(const char *codec,CONFcouple *c);
+int     scriptSetVideoCodec(const char *codec,CONFcouple *c); // Only take the full param list
 int     scriptAddVideoFilter(const char *filter,CONFcouple *c);
+int     scriptSetVideoCodecParam(const char *codec,CONFcouple *c); // same as setVideoCodec, but accepts partial list
+
 #endif
 #ifdef __cplusplus
 };

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm_gen.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm_gen.cpp	2011-01-07 07:30:45 UTC (rev 6918)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/py/adm_gen.cpp	2011-01-10 18:52:31 UTC (rev 6919)
@@ -93,6 +93,18 @@
   int r=  A_Save(p0); 
   return tp_number(r);
 }
+// videoCodecChangeParam -&gt; int scriptSetVideoCodecParam (str couples ) 
+static tp_obj zzpy_videoCodecChangeParam(TP)
+ {
+  tp_obj self=tp_getraw( tp);
+  tinyParams pm(tp);
+  void *me=(void *)pm.asThis(&amp;self,ADM_PYID_AVIDEMUX);
+  const char *p0= pm.asString();
+  CONFcouple *p1=NULL;
+  pm.makeCouples(&amp;p1);
+  int r=  scriptSetVideoCodecParam(p0,p1); 
+  return tp_number(r);
+}
 // appendVideo -&gt; int scriptAppendVideo (str  ) 
 static tp_obj zzpy_appendVideo(TP)
  {
@@ -307,6 +319,10 @@
   {
      return tp_method(vm,self,zzpy_save);
   }
+  if (!strcmp(key, &quot;videoCodecChangeParam&quot;))
+  {
+     return tp_method(vm,self,zzpy_videoCodecChangeParam);
+  }
   if (!strcmp(key, &quot;appendVideo&quot;))
   {
      return tp_method(vm,self,zzpy_appendVideo);
@@ -441,6 +457,7 @@
 	jsLog(&quot;getHeight(void)\n&quot;);
 	jsLog(&quot;setPostProc(int ,int , int )\n&quot;);
 	jsLog(&quot;save(str)\n&quot;);
+	jsLog(&quot;videoCodecChangeParam(str,couples)\n&quot;);
 	jsLog(&quot;appendVideo(str )\n&quot;);
 	jsLog(&quot;audioMixer(str )\n&quot;);
 	jsLog(&quot;getFps1000(void)\n&quot;);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptVideo.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptVideo.cpp	2011-01-07 07:30:45 UTC (rev 6918)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_script2/src/ADM_scriptVideo.cpp	2011-01-10 18:52:31 UTC (rev 6919)
@@ -46,6 +46,30 @@
     return true;
 }
 /**
+    \fn scriptSetVideoCodecParam
+    \brief Same as scriptSetVideoCodec, but accept partial settings
+*/
+int     scriptSetVideoCodecParam(const char *codec,CONFcouple *c)
+{       
+        bool r=true;
+        if(A_setVideoCodec(codec)==false)
+        {
+            jsLog(&quot;Could not select codec %s\n&quot;,codec);
+            r=false;
+        }else
+        {        
+            if(c)
+            {
+                r=videoEncoder6_SetConfiguration(c,false);
+            }
+        }
+        if(c)
+            delete c;
+        return r;
+}
+
+
+/**
     \fn scriptSetVideoCodec
 */
 int     scriptSetVideoCodec(const char *codec,CONFcouple *c)
@@ -59,7 +83,7 @@
         {        
             if(c)
             {
-                r=videoEncoder6_SetConfiguration(c);
+                r=videoEncoder6_SetConfiguration(c,true);
             }
         }
         if(c)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/include/ADM_videoEncoderApi.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/include/ADM_videoEncoderApi.h	2011-01-07 07:30:45 UTC (rev 6918)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/include/ADM_videoEncoderApi.h	2011-01-10 18:52:31 UTC (rev 6919)
@@ -32,7 +32,7 @@
 
 const char            *videoEncoder6_GetCurrentEncoderName(void);
 
-bool                  videoEncoder6_SetConfiguration(CONFcouple *c);
+bool                  videoEncoder6_SetConfiguration(CONFcouple *ci,bool full=true);
 bool                  videoEncoder6_GetConfiguration(CONFcouple **c);
 
 ADM_coreVideoEncoder *createVideoEncoderFromIndex(ADM_coreVideoFilter *chain,int index,bool globalHeader);

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_dynVideoEncoder.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_dynVideoEncoder.cpp	2011-01-07 07:30:45 UTC (rev 6918)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_videoEncoder/src/ADM_dynVideoEncoder.cpp	2011-01-10 18:52:31 UTC (rev 6919)
@@ -243,16 +243,16 @@
     return e-&gt;desc-&gt;encoderName;
 }
 /**
-    \fn videoEncoder6_GetCurrentEncoderName
+    \fn videoEncoder6_SetPartialConfiguration
 */
-
-bool                  videoEncoder6_SetConfiguration(CONFcouple *c)
+bool                  videoEncoder6_SetConfiguration(CONFcouple *c,bool full)
 {
     if(!c) return true;
     ADM_assert(currentVideoCodec&lt;ListOfEncoders.size());
     ADM_videoEncoder6 *e=ListOfEncoders[currentVideoCodec];
-    return e-&gt;desc-&gt;setConfigurationData(c);
+    return e-&gt;desc-&gt;setConfigurationData(c,full);
 }
+
 /**
     \fn videoEncoder6_GetConfiguration
 */

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/include/ADM_paramList.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/include/ADM_paramList.h	2011-01-07 07:30:45 UTC (rev 6918)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/include/ADM_paramList.h	2011-01-10 18:52:31 UTC (rev 6919)
@@ -49,6 +49,8 @@
 
 /// Couple -&gt; structure
 bool ADM_paramLoad(CONFcouple *couples, const ADM_paramList *params,void *s);
+bool ADM_paramLoadPartial(CONFcouple *couples, const ADM_paramList *params,void *s);
+
 /// Structure -&gt; couples
 bool ADM_paramSave(CONFcouple **couples, const ADM_paramList *params,void *s);
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_paramList.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_paramList.cpp	2011-01-07 07:30:45 UTC (rev 6918)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreUtils/src/ADM_paramList.cpp	2011-01-10 18:52:31 UTC (rev 6919)
@@ -188,13 +188,10 @@
     return true;
 }
 /**
-    \fn ADM_paramValidate
-    \brief Check the confcouples match the param list
+    \fn getParamSize
 */
-bool ADM_paramValidate(CONFcouple *couples, const    ADM_paramList *params)
+static int XgetParamSize( const ADM_paramList *params)
 {
-    int n=couples-&gt;getSize();
-    int found=0;
     int p=0;
     const ADM_paramList *l=params;
     while(l-&gt;paramName)
@@ -202,6 +199,17 @@
         p++;
         l++;
     };
+    return p;
+}
+/**
+    \fn ADM_paramValidate
+    \brief Check the confcouples match the param list
+*/
+bool ADM_paramValidate(CONFcouple *couples, const    ADM_paramList *params)
+{
+    int n=couples-&gt;getSize();
+    int found=0;
+    int p=XgetParamSize(params);
     if(n!=p)
     {
         ADM_warning(&quot;Number of parameter mistmatch :%d vs %d\n&quot;,n,p);
@@ -220,24 +228,60 @@
     return true;
 }
 /**
-    \fn ADM_paramLoad
+    \fn ADM_paramValidatePartialList
+    \brief In that case couples is a sublist of params
+*/
+bool ADM_paramValidatePartialList(CONFcouple *couples, const    ADM_paramList *params)
+{
+    int n=couples-&gt;getSize();
+    int p=XgetParamSize(params);
+    if(n&gt;p)
+    {
+        ADM_warning(&quot;Too many parameters in partial list&quot;);
+        return false;
+    }
+    int found=0;
+    for(int i=0;i&lt;p;i++)
+    {
+        const char *name=params[i].paramName;
+        if(true==couples-&gt;exist(name))
+        {
+            found++;
+        }
+    }
+    if(found==n) return true;
+    ADM_warning(&quot;Some parameters are not in the parameter list, typo ?\n&quot;);
+    return false;;
+}
+
+/**
+    \fn ADM_paramLoadInternal
     \brief Load a structure from a list of confCouple
 */
-bool ADM_paramLoad(CONFcouple *couples, const ADM_paramList *params,void *s)
+static bool ADM_paramLoadInternal(bool partial,CONFcouple *couples, const ADM_paramList *params,void *s)
 {
     uint8_t *address=(uint8_t *)s;
-    if(false==ADM_paramValidate(couples,params)) return false;
+    
     int n=couples-&gt;getSize();
-    for(int i=0;i&lt;n;i++)
+    int p=XgetParamSize(params);
+    for(int i=0;i&lt;p;i++)
     {
         const char *name=params[i].paramName;
         int index=couples-&gt;lookupName(name);
-        ADM_assert(index!=-1);
+        if(index==-1) // not found ?
+            if(false==partial)
+            {
+                ADM_assert(index!=-1); // Should be replaced later by a return false
+            }else       
+            {
+               // ADM_info(&quot;%s not found\n&quot;,name);
+                continue; // this parameter is not in the param list and we are doing a partial update
+            }
         switch(params[i].type)
         {
 #define SWAL(entry,type,var,access) case  entry: {type   var;\
                         couples-&gt;readAs##access(name,&amp;var); \
-                        *(type *)(address+params[i].offset)=var;}break;
+                        *(type *)(address+params[i].offset)=var;};break;
            SWAL(ADM_param_uint32_t,uint32_t,u32,Uint32)
            SWAL(ADM_param_int32_t, int32_t, i32,Int32)
            SWAL(ADM_param_float,   float ,  f,Float)
@@ -284,12 +328,35 @@
                         *(char  **)(address+params[i].offset)=var;
                     }
                     break;
+            default:
+                    ADM_error(&quot;Type no handled %d\n&quot;,params[i].type);
+                    break;
         }
     }
     return true;
 }
 /**
     \fn ADM_paramLoad
+    \brief Load a structure from a list of confCouple, validate that all fields are there
+*/
+bool ADM_paramLoad(CONFcouple *couples, const ADM_paramList *params,void *s)
+{
+    if(false==ADM_paramValidate(couples,params)) return false;
+    return ADM_paramLoadInternal(false,couples,params,s);
+
+}
+/**
+    \fn ADM_paramLoad
+    \brief Load a structure from a list of confCouple, accept partial fields
+*/
+
+bool ADM_paramLoadPartial(CONFcouple *couples, const ADM_paramList *params,void *s)
+{
+   if(false==ADM_paramValidatePartialList(couples,params)) return false;
+   return ADM_paramLoadInternal(true,couples,params,s);
+}
+/**
+    \fn ADM_paramLoad
     \brief Save a structure to a list of confCouple
 */
 bool ADM_paramSave(CONFcouple **couples, const ADM_paramList *params,void *s)

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/include/ADM_coreVideoEncoderInternal.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/include/ADM_coreVideoEncoderInternal.h	2011-01-07 07:30:45 UTC (rev 6918)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreVideoEncoder/include/ADM_coreVideoEncoderInternal.h	2011-01-10 18:52:31 UTC (rev 6919)
@@ -15,7 +15,7 @@
 #ifndef VIDEOENCODERINTERNAL_H
 #define VIDEOENCODERINTERNAL_H
 
-#define ADM_VIDEO_ENCODER_API_VERSION 4
+#define ADM_VIDEO_ENCODER_API_VERSION 5
 #include &quot;ADM_coreVideoEncoder.h&quot;
 #include &quot;DIA_uiTypes.h&quot;
 #include &quot;ADM_paramList.h&quot;
@@ -38,7 +38,7 @@
     void         (*destroy)(ADM_coreVideoEncoder *codec);
     bool         (*configure)(void);                                // Call UI to set it up
     bool         (*getConfigurationData)(CONFcouple **c); // Get the encoder private conf
-    bool         (*setConfigurationData)(CONFcouple *c);   // Set the encoder private conf
+    bool         (*setConfigurationData)(CONFcouple *c,bool full);   // Set the encoder private conf
 
     ADM_UI_TYPE  UIType;                // Type of UI
     uint32_t     major,minor,patch;     // Version of the plugin
@@ -50,7 +50,7 @@
 /**************************************************************************/
 #define ADM_DECLARE_VIDEO_ENCODER_PREAMBLE(Class) \
 static bool getConfigurationData (CONFcouple **c); \
-static bool setConfigurationData (CONFcouple *c);\
+static bool setConfigurationData (CONFcouple *c,bool full=true);\
 \
 static ADM_coreVideoEncoder * create (ADM_coreVideoFilter * head,bool globalHeader) \
 { \
@@ -83,9 +83,10 @@
          if(confTemplate==NULL) {*c=NULL;return true;} \
          return ADM_paramSave(c,confTemplate,confVar); \
 }\
-bool setConfigurationData (CONFcouple *c)\
+bool setConfigurationData (CONFcouple *c,bool full)\
 {\
-        return ADM_paramLoad(c,confTemplate,confVar); \
+	if(full) return ADM_paramLoad(c,confTemplate,confVar); \
+	return ADM_paramLoadPartial(c,confTemplate,confVar); \
 } \
 extern &quot;C&quot; ADM_videoEncoderDesc *getInfo (void) \
 { \


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004093.html">[Avidemux-svn-commit] r6918 -	branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audioFilter/src
</A></li>
	<LI>Next message: <A HREF="004095.html">[Avidemux-svn-commit] r6921 - in	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_muxers/muxerMp4v2/libmp4v2:	. doc doc/man doc/man/man1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4094">[ date ]</a>
              <a href="thread.html#4094">[ thread ]</a>
              <a href="subject.html#4094">[ subject ]</a>
              <a href="author.html#4094">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
