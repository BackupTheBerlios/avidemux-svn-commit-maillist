From mean at mail.berlios.de  Mon Sep  3 20:33:43 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Mon, 3 Sep 2007 20:33:43 +0200
Subject: [Avidemux-svn-commit] r3577 -
	branches/avidemux_2.4_branch/avidemux/ADM_script
Message-ID: <200709031833.l83IXhbS030563@sheep.berlios.de>

Author: mean
Date: 2007-09-03 20:33:42 +0200 (Mon, 03 Sep 2007)
New Revision: 3577

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_container.h
Log:
[Container] Fix javascript dummy container save/load

Modified: branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_container.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_container.h	2007-08-31 16:35:21 UTC (rev 3576)
+++ branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_container.h	2007-09-03 18:33:42 UTC (rev 3577)
@@ -28,7 +28,7 @@
   MK_CONT(MP4),
   MK_CONT(PSP),
   MK_CONT(FLV),
-  MK_CONT(FMT_DUMMY)  
+  MK_CONT(DUMMY)  
 };
 #define NB_CONT (sizeof(container)/sizeof(ADM_CONTAINER))
 #endif



From mean at mail.berlios.de  Tue Sep  4 19:25:50 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 4 Sep 2007 19:25:50 +0200
Subject: [Avidemux-svn-commit] r3578 - in
	branches/avidemux_2.4_branch/avidemux:
	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory
	ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk
	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory
	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory
	ADM_userInterfaces/ADM_commonUI ADM_videoFilter
Message-ID: <200709041725.l84HPoS3021287@sheep.berlios.de>

Author: mean
Date: 2007-09-04 19:25:48 +0200 (Tue, 04 Sep 2007)
New Revision: 3578

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_integer.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_integer.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.h
Log:
[DialogFactory+Fileselector] Chris Mac Gregor : Fix for default suffix + fix for slider

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp	2007-09-03 18:33:42 UTC (rev 3577)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp	2007-09-04 17:25:48 UTC (rev 3578)
@@ -30,9 +30,13 @@
 static void fileRead(void *w,void *p);
 static void dirSel(void *w,void *p);
 
+#include "prefs.h"
 
-diaElemFile::diaElemFile(uint32_t writemode,char **filename,const char *toggleTitle,const char *tip)
-  : diaElem(ELEM_FILE_READ)
+diaElemFile::diaElemFile(uint32_t writemode,char **filename,const char *toggleTitle,
+                         const char * defaultSuffix,const char *tip)
+  : diaElem(ELEM_FILE_READ),
+    defaultSuffix (defaultSuffix)
+
 {
   param=(void *)filename;
   paramTitle=toggleTitle;
@@ -128,8 +132,37 @@
   const char *txt;
   txt =gtk_entry_get_text (GTK_ENTRY (widget));
   
-  if(_write) t=FileSel_SelectWrite(paramTitle,buffer,MAX_SEL,txt);
-      else t= t=FileSel_SelectRead(paramTitle,buffer,MAX_SEL,txt);
+  if(_write)
+  {
+      char newname [1024];
+      if (!*txt && defaultSuffix)
+      {
+          const char * lastfilename;
+          if (prefs->get(LASTFILES_FILE1,(ADM_filename **)&lastfilename))
+          {
+              strcpy (newname, lastfilename);
+              char * cptr = newname + strlen (newname);
+              while (cptr > newname)
+              {
+                  if (*cptr == '.')
+                  {
+                      strcpy (cptr + 1, defaultSuffix);
+                      txt = newname;
+                      printf ("Default output filename is %s based on "
+                              "%s + %s\n",
+                              txt, lastfilename, defaultSuffix);
+                      break;
+                  }
+                  --cptr;
+              }
+          }
+      }
+      t = FileSel_SelectWrite(paramTitle,buffer,MAX_SEL,txt);
+  }
+  else
+  {
+      t = FileSel_SelectRead(paramTitle,buffer,MAX_SEL,txt);
+  }
   if(t)
   {
     char **name=(char **)param;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_integer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_integer.cpp	2007-09-03 18:33:42 UTC (rev 3577)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_integer.cpp	2007-09-04 17:25:48 UTC (rev 3578)
@@ -1,6 +1,6 @@
 /***************************************************************************
-  FAC_toggle.cpp
-  Handle dialog factory element : Toggle
+  FAC_integer.cpp
+  Handle dialog factory elements : Integer, Slider, and variations thereupon
   (C) 2006 Mean Fixounet at free.fr 
 ***************************************************************************/
 
@@ -170,12 +170,37 @@
 }
 
 //****************************************************
-template <class T>
+
+template <typename T>
+static
+uint32_t diaElemSliderDigitsDefault (T incr)
+{
+    return 0; // used for int types; a specialization overrides this for float
+}
+
+template <>  // specialization of above...
+uint32_t diaElemSliderDigitsDefault (ELEM_TYPE_FLOAT incr) // ...for float
+{
+    char tmp [32];
+    uint32_t digits = 3;
+    sprintf (tmp, "%.*f", digits, incr);
+    const char * cptr = tmp + strlen (tmp);
+    while (*--cptr == '0')
+        --digits;
+
+    if (digits < 1)
+        return 1;
+    else
+        return digits;
+}
+
+template <typename T>
 diaElemGenericSlider<T>::diaElemGenericSlider(T *value,const char *toggleTitle, T min,T max,T incr,const char *tip)
     : diaElem(ELEM_SLIDER),
       min (min),
       max (max),
-      incr (incr)
+      incr (incr),
+      digits (diaElemSliderDigitsDefault (incr))
 {
     param = (void *)value;
     paramTitle = toggleTitle;
@@ -183,12 +208,12 @@
     size = 2;
 }
 
-template <class T>
+template <typename T>
 diaElemGenericSlider<T>::~diaElemGenericSlider()
 {
 }
 
-template <class T>
+template <typename T>
 void diaElemGenericSlider<T>::setMe(void *dialog, void *opaque,uint32_t line)
 {
   GtkWidget *label = gtk_label_new_with_mnemonic (paramTitle);
@@ -200,30 +225,45 @@
                     (GtkAttachOptions) (0), 0, 0);
   
   T val=*(T *)param;
-  GtkWidget *widget
-      = gtk_hscale_new (GTK_ADJUSTMENT (gtk_adjustment_new (val, min, max, incr, incr, 0)));
-  gtk_scale_set_value_pos (GTK_SCALE (widget), GTK_POS_LEFT);
-  gtk_scale_set_digits (GTK_SCALE (widget), 0);
+
+  GtkAdjustment * adj = (GtkAdjustment *) gtk_adjustment_new (val, min, max, incr, incr, 0);
+
+  GtkWidget *spinner = gtk_spin_button_new (adj, 1, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON(spinner), TRUE);
+  gtk_spin_button_set_digits  (GTK_SPIN_BUTTON(spinner), digits);
   
-  gtk_widget_show (widget);
+  GtkWidget *slider = gtk_hscale_new (adj);
+  gtk_scale_set_draw_value (GTK_SCALE (slider), FALSE);
+  gtk_scale_set_digits (GTK_SCALE (slider), digits);
   
-  gtk_table_attach (GTK_TABLE (opaque), widget, 0, 2, line+1, line+2,
+  GtkWidget *hbox = gtk_hbox_new (FALSE, 5);
+  gtk_box_pack_start (GTK_BOX (hbox), slider, TRUE, TRUE, 0);
+  gtk_box_pack_start (GTK_BOX (hbox), spinner, FALSE, FALSE, 0);
+
+  gtk_table_attach (GTK_TABLE (opaque), hbox, 0, 2, line+1, line+2,
                     (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
                     (GtkAttachOptions) (0), 0, 0);
   
-  gtk_label_set_mnemonic_widget (GTK_LABEL(label), widget);
+  gtk_label_set_mnemonic_widget (GTK_LABEL(label), hbox);
+  gtk_widget_show (hbox);
+  gtk_widget_show (spinner);
+  gtk_widget_show (slider);
   
-  myWidget=(void *)widget;
+  myWidget=(void *)slider;
   if(readOnly)
-    gtk_widget_set_sensitive(widget,0);
-   if(tip)
-   {
-     GtkTooltips *tooltips= gtk_tooltips_new ();
-      gtk_tooltips_set_tip (tooltips, widget, tip, NULL);
-   }
+  {
+    gtk_widget_set_sensitive(spinner,0);
+    gtk_widget_set_sensitive(slider,0);
+  }
+  if(tip)
+  {
+      GtkTooltips *tooltips= gtk_tooltips_new ();
+      gtk_tooltips_set_tip (tooltips, spinner, tip, NULL);
+      gtk_tooltips_set_tip (tooltips, slider, tip, NULL);
+  }
 }
 
-template <class T>
+template <typename T>
 void diaElemGenericSlider<T>::getMe(void)
 {
   GtkWidget *widget=(GtkWidget *)myWidget;
@@ -235,7 +275,7 @@
   if(*val>max) *val=max;
 }
 
-template <class T>
+template <typename T>
 void diaElemGenericSlider<T>::enable(uint32_t onoff)
 {
   GtkWidget *widget=(GtkWidget *)myWidget;
@@ -244,5 +284,6 @@
 
 template class diaElemGenericSlider <int32_t>;
 template class diaElemGenericSlider <uint32_t>;
+template class diaElemGenericSlider <ELEM_TYPE_FLOAT>;
 
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp	2007-09-03 18:33:42 UTC (rev 3577)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp	2007-09-04 17:25:48 UTC (rev 3578)
@@ -81,33 +81,15 @@
         setFilter(dialog);
         gtk_register_dialog(dialog);
 //	gtk_transient(dialog);
-	if(source)
+	if (source && *source)
 	{
-		dupe=PathCanonize(source);
-		PathStripName(dupe);
-		if( (dir=opendir(dupe)) )
-			{
-				closedir(dir);
-				gtk_file_chooser_set_filename(GTK_FILE_CHOOSER(dialog),(gchar *)source);
-			}
-		delete [] dupe;
-	
+		gtk_file_chooser_set_filename(GTK_FILE_CHOOSER(dialog),(gchar *)source);
 	}
 	else	//use pref
 	{
 		if( prefs->get(LASTDIR_READ,(ADM_filename **)&tmpname))
 		{
-			
-	
-			dupe=PathCanonize(tmpname);
-			PathStripName(dupe);
-
-			if( (dir=opendir(dupe)) )
-			{
-				closedir(dir);
-				gtk_file_chooser_set_filename(GTK_FILE_CHOOSER(dialog),(gchar *)dupe);
-			}
-			delete [] dupe;
+			gtk_file_chooser_set_current_folder(GTK_FILE_CHOOSER(dialog),(gchar *)tmpname);
 		}
 	}
 	if(gtk_dialog_run(GTK_DIALOG(dialog))==GTK_RESPONSE_ACCEPT)
@@ -160,7 +142,7 @@
 char *dupe=NULL,*tmpname=NULL;
 DIR *dir=NULL;
 	
-	dialog = gtk_file_chooser_dialog_new ("Open File",
+	dialog = gtk_file_chooser_dialog_new ("Write to File",
                                       NULL,
                                       GTK_FILE_CHOOSER_ACTION_SAVE,
                                       GTK_STOCK_CANCEL, GTK_RESPONSE_CANCEL,
@@ -171,16 +153,29 @@
         setFilter(dialog);
         gtk_register_dialog(dialog);
 //	gtk_transient(dialog);
-	if(source)
+	if (source && *source)
 	{
-		dupe=PathCanonize(source);
-		PathStripName(dupe);
-		if( (dir=opendir(dupe)) )
-			{
-				closedir(dir);
-				gtk_file_chooser_set_filename(GTK_FILE_CHOOSER(dialog),(gchar *)source);
-			}
-		delete [] dupe;
+#if 0
+// well, this is what they say to do, but then you can't easily edit the
+// name...
+
+                // the following sequence is per GTK docs for gtk_file_chooser_set_filename()
+                if (access (source, W_OK) == 0) // if file exists
+                {
+                    gtk_file_chooser_set_filename(GTK_FILE_CHOOSER(dialog),(gchar *)source);
+                    // printf ("FileSel_SelectWrite: existing %s\n", source);
+                }
+                else // new file
+#endif
+                {
+                    dupe=PathCanonize(source);
+                    PathStripName(dupe);
+                    gtk_file_chooser_set_current_folder(GTK_FILE_CHOOSER(dialog),(gchar *)dupe);
+                    gtk_file_chooser_set_current_name(GTK_FILE_CHOOSER(dialog),
+                                                      (gchar *)(source + strlen(dupe)));
+                    // printf ("FileSel_SelectWrite: folder %s, name %s\n", dupe, source + strlen(dupe));
+                    delete [] dupe;
+                }
 	
 	}
 	else	//use pref
@@ -188,14 +183,12 @@
 		if( prefs->get(LASTDIR_WRITE,(ADM_filename **)&tmpname))
 		{
 			
-	
 			dupe=PathCanonize(tmpname);
-			PathStripName(dupe);
 
 			if( (dir=opendir(dupe)) )
 			{
 				closedir(dir);
-				gtk_file_chooser_set_filename(GTK_FILE_CHOOSER(dialog),(gchar *)dupe);
+				gtk_file_chooser_set_current_folder(GTK_FILE_CHOOSER(dialog),(gchar *)tmpname);
 			}
 			delete [] dupe;
 		}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-09-03 18:33:42 UTC (rev 3577)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-09-04 17:25:48 UTC (rev 3578)
@@ -164,7 +164,8 @@
 { 
 }
 //*****************
-diaElemFile::diaElemFile(uint32_t write,char **filename,const char *toggleTitle,const char *tip)
+diaElemFile::diaElemFile(uint32_t write,char **filename,const char *toggleTitle,
+                         const char *defaultSuffix, const char *tip)
   : diaElem(ELEM_FILE_READ)
 {
  
@@ -393,37 +394,35 @@
 }
 //***
  
- template <class T>
+ template <typename T>
  diaElemGenericSlider<T>::diaElemGenericSlider(T *value,const char *toggleTitle, T min,T max,T incr,const char *tip)
-     : diaElem(ELEM_SLIDER),
-       min (min),
-       max (max),
-       incr (incr)
+     : diaElem(ELEM_SLIDER)
   {
  }
   
- template <class T>
+ template <typename T>
  diaElemGenericSlider<T>::~diaElemGenericSlider()
   {
   }
  
- template <class T>
+ template <typename T>
  void diaElemGenericSlider<T>::setMe(void *dialog, void *opaque,uint32_t line)
   {
   }
  
- template <class T>
+ template <typename T>
  void diaElemGenericSlider<T>::getMe(void)
   {
   }
   
- template <class T>
+ template <typename T>
  void diaElemGenericSlider<T>::enable(uint32_t onoff) 
   {
   }
   
  template class diaElemGenericSlider <int32_t>;
  template class diaElemGenericSlider <uint32_t>;
+ template class diaElemGenericSlider <ELEM_TYPE_FLOAT>;
 //****
 
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/CMakeLists.txt	2007-09-03 18:33:42 UTC (rev 3577)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/CMakeLists.txt	2007-09-04 17:25:48 UTC (rev 3578)
@@ -12,6 +12,7 @@
 menu
 toggle
 threadCount
+slider
 )
 
 SET(${ADM_LIB}_SRCS

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_integer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_integer.cpp	2007-09-03 18:33:42 UTC (rev 3577)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_integer.cpp	2007-09-04 17:25:48 UTC (rev 3578)
@@ -144,76 +144,6 @@
     box->setDisabled(1);
 }
 //********************************************
-#define MYSLIDERTYPE  QSlider
 
-
-template <class T>
-diaElemGenericSlider<T>::diaElemGenericSlider(T *value,const char *toggleTitle, T min,T max,T incr,const char *tip)
-  : diaElem(ELEM_SLIDER)
-{
-  param=(void *)value;
-  paramTitle=shortkey(toggleTitle);
-  this->min=min;
-  this->max=max;
-  this->incr=incr;
-  this->tip=tip;
-  
- }
- 
-
-template <class T>
-diaElemGenericSlider<T>::~diaElemGenericSlider()
-{ 
-  if(paramTitle)
-    delete paramTitle;
-}
-template <class T>
-void diaElemGenericSlider<T>::setMe(void *dialog, void *opaque,uint32_t line)
-{
-  MYSLIDERTYPE *box=new MYSLIDERTYPE((QWidget *)dialog);
-  box->setOrientation ( Qt::Horizontal );
-  
-  QGridLayout *layout=(QGridLayout*) opaque;
- myWidget=(void *)box; 
-   
- box->setMinimum(min);
- box->setMaximum(max);
- box->setValue(*(T *)param);
-#ifdef ADM_TEST_ADM_SLIDER
-  box->setNbFrames(max); 
-  box->setA(max/3);
-  box->setB((max*2)/3);
-#endif
- box->show();
- 
- QLabel *text=new QLabel( this->paramTitle,(QWidget *)dialog);
- text->setBuddy(box);
- layout->addWidget(text,line,0);
- layout->addWidget(box,line,1);
-}
-template <class T>
-void diaElemGenericSlider<T>::getMe(void)
-{
- MYSLIDERTYPE *box=(MYSLIDERTYPE *)myWidget;
- T val=box->value();
- if(val<min) val=min;
- if(val>max) val=max;
- *(T *)param=val;
-}
-
-template <class T>
-void diaElemGenericSlider<T>::enable(uint32_t onoff) 
-{
-  MYSLIDERTYPE *box=(MYSLIDERTYPE *)myWidget;
-  ADM_assert(box);
-  if(onoff)
-    box->setEnabled(1);
-  else
-    box->setDisabled(1);
-}
-
-template class diaElemGenericSlider <int32_t>;
-template class diaElemGenericSlider <uint32_t>;
-
 //EOF
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am	2007-09-03 18:33:42 UTC (rev 3577)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am	2007-09-04 17:25:48 UTC (rev 3578)
@@ -6,6 +6,7 @@
 libADM_dialogFactory_a_SOURCES = AT_dialogFactory.cpp AT_toggle.cpp FAC_integer.cpp AT_menu.cpp FAC_float.cpp \
 AT_filesel.cpp AT_bitrate.cpp AT_threadCount.cpp \
 AT_button.cpp \
+AT_slider.cpp \
 FAC_bar.cpp FAC_readOnlyText.cpp FAC_notch.cpp FAC_frame.cpp FAC_hex.cpp FAC_matrix.cpp
 
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp	2007-09-03 18:33:42 UTC (rev 3577)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp	2007-09-04 17:25:48 UTC (rev 3578)
@@ -1,6 +1,6 @@
 /***************************************************************************
-  FAC_toggle.cpp
-  Handle dialog factory element : Toggle
+  FAC_filesel.cpp
+  Handle dialog factory element : Filesel
   (C) 2006 Mean Fixounet at free.fr 
 ***************************************************************************/
 
@@ -29,6 +29,7 @@
 #include <QDialogButtonBox>
 
 #include "default.h"
+#include "prefs.h"
 #include "ADM_commonUI/DIA_factory.h"
 #include "ADM_assert.h"
 #include "ADM_toolkit/filesel.h"
@@ -62,6 +63,28 @@
                 r=FileSel_SelectRead(_("Select File to Read"),buffer,MAX_SEL,txt);
                 break;
             case ADM_FILEMODE_WRITE:
+                if (defaultSuffix)
+                {
+                    const char * lastfilename;
+                    if (prefs->get(LASTFILES_FILE1,(ADM_filename **)&lastfilename))
+                    {
+                        strcpy (buffer, lastfilename);
+                        char * cptr = buffer + strlen (buffer);
+                        while (cptr > buffer)
+                        {
+                            if (*cptr == '.')
+                            {
+                                strcpy (cptr + 1, defaultSuffix);
+                                txt = buffer;
+                                printf ("Default output filename is %s based on "
+                                        "%s + %s\n",
+                                        txt, lastfilename, defaultSuffix);
+                                break;
+                            }
+                            --cptr;
+                        }
+                    }
+                }
                 r=FileSel_SelectWrite(_("Select File to Write"),buffer,MAX_SEL,txt);
                 break;
 
@@ -80,8 +103,11 @@
         QDialogButtonBox *button;
         QLabel *text;
         ADM_fileMode fileMode;
+        const char * defaultSuffix;
             
-        ADM_Qfilesel(QWidget *z,const char *title,char *entry,QGridLayout *layout,int line, ADM_fileMode mode) : QWidget(z) 
+        ADM_Qfilesel(QWidget *z,const char *title,char *entry,QGridLayout *layout,int line, ADM_fileMode mode, const char * defaultSuffix)
+            : QWidget(z),
+              defaultSuffix (defaultSuffix)
         {
           
           fileMode=mode;
@@ -113,8 +139,10 @@
 };
 
 
-diaElemFile::diaElemFile(uint32_t writemode,char **filename,const char *toggleTitle,const char *tip)
-  : diaElem(ELEM_FILE_READ)
+diaElemFile::diaElemFile(uint32_t writemode,char **filename,const char *toggleTitle,
+                         const char *defaultSuffix,const char *tip)
+  : diaElem(ELEM_FILE_READ),
+    defaultSuffix (defaultSuffix)
 {
   param=(void *)filename;
   paramTitle=shortkey(toggleTitle);
@@ -132,9 +160,9 @@
  QGridLayout *layout=(QGridLayout*) opaque;
  ADM_Qfilesel *fs;
   if(_write)
-      fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle,*(char **)param,layout, line,ADM_FILEMODE_WRITE);
+      fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle,*(char **)param,layout, line,ADM_FILEMODE_WRITE, defaultSuffix);
   else
-      fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle,*(char **)param,layout, line,ADM_FILEMODE_READ);
+      fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle,*(char **)param,layout, line,ADM_FILEMODE_READ, 0);
   myWidget=(void *)fs; 
 }
 void diaElemFile::getMe(void)
@@ -168,7 +196,7 @@
 {
  QGridLayout *layout=(QGridLayout*) opaque;
   
-  ADM_Qfilesel *fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle,*(char **)param,layout, line,ADM_FILEMODE_DIR);
+  ADM_Qfilesel *fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle,*(char **)param,layout, line,ADM_FILEMODE_DIR, 0);
   myWidget=(void *)fs; 
 }
 void diaElemDirSelect::getMe(void) 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-09-03 18:33:42 UTC (rev 3577)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-09-04 17:25:48 UTC (rev 3578)
@@ -44,6 +44,9 @@
   ELEM_MAX=ELEM_COUNT-1
 }elemEnum;
 typedef void ADM_FAC_CALLBACK(void *cookie);
+
+#define ELEM_TYPE_FLOAT float
+
 /*********************************************/
 class diaElem
 {
@@ -107,22 +110,26 @@
   void      enable(uint32_t onoff) ;
 };
 /************************************/
-template <class T>
+template <typename T>
 class diaElemGenericSlider : public diaElem
 {
   protected:
     
     T min,max,incr;
+    uint32_t digits;
 public:
     diaElemGenericSlider(T *value,const char *toggleTitle, T min,T max,T incr = 1, const char *tip=NULL);
   virtual   ~diaElemGenericSlider() ;
   void      setMe(void *dialog, void *opaque,uint32_t line);
   void      getMe(void);
   void      enable(uint32_t onoff) ;
+  void      setDigits(uint32_t digits) { this->digits = digits; }
 };
 typedef diaElemGenericSlider <int32_t> diaElemSlider;
 /* Same but unsigned */
 typedef diaElemGenericSlider <uint32_t> diaElemUSlider;
+/* Same but float */
+typedef diaElemGenericSlider <ELEM_TYPE_FLOAT> diaElemFSlider;
 
 /*********************************************/
 class diaElemToggle : public diaElem
@@ -208,7 +215,6 @@
 };
 
 /*********************************************/
-#define ELEM_TYPE_FLOAT float
 class diaElemFloat : public diaElem
 {
 
@@ -322,9 +328,12 @@
 class diaElemFile : public diaElem
 {
 
+protected:
+    const char * defaultSuffix;
 public:
   
-  diaElemFile(uint32_t writeMode,char **filename,const char *toggleTitle,const char *tip=NULL);
+  diaElemFile(uint32_t writeMode,char **filename,const char *toggleTitle,
+              const char *defaultSuffix = 0,const char *tip=NULL);
   virtual ~diaElemFile() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp	2007-09-03 18:33:42 UTC (rev 3577)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp	2007-09-04 17:25:48 UTC (rev 3578)
@@ -191,7 +191,8 @@
          _("_End Frame (last frame # to include), -1 = last:"),
          -1000000, 0x7fffffff);
     diaElemFile output_file
-        (1, const_cast<char **>(&(_param->output_file)), _("_Output File:"));
+        (1, const_cast<char **>(&(_param->output_file)),
+         _("_Output File:"), "avg");
     diaElemSlider bias
         (&(_param->bias),
          _("_Bias (only for display; use 0 for "

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.cpp	2007-09-03 18:33:42 UTC (rev 3577)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.cpp	2007-09-04 17:25:48 UTC (rev 3578)
@@ -156,7 +156,8 @@
          sizeof (tOutputFmt) / sizeof (diaMenuEntry), tOutputFmt);
 
     diaElemFile output_file
-        (1, const_cast<char **>(&(_param->output_file)), _("_Output File:"));
+        (1, const_cast<char **>(&(_param->output_file)),
+         _("_Output File:"), "pts");
 
     diaElemUInteger camera_number
         (&(_param->camera_number), _("_Camera number:"), 1, 0x7fffffff);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.cpp	2007-09-03 18:33:42 UTC (rev 3577)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.cpp	2007-09-04 17:25:48 UTC (rev 3578)
@@ -40,7 +40,7 @@
 
 // #define THRESHOLD_HISTO 1
 
-static FILTER_PARAM thresholdParam={3,{"min", "max", "debug"}};
+static FILTER_PARAM thresholdParam={4,{"min", "max", "in_range_is_white", "debug"}};
 
 SCRIPT_CREATE(threshold_script,ADMVideoThreshold,thresholdParam);
 
@@ -60,25 +60,67 @@
     {
         GET(min);
         GET(max);
+        GET(in_range_is_white);
         GET(debug);
     }
     else
     {
         _param->min = 100;
         _param->max = 200;
+        _param->in_range_is_white = 1;
         _param->debug = 0;
     }
+
+    computeLookupTable();
 }
 
+void ADMVideoThreshold::computeLookupTable ()
+{
+    if (_param->min > _param->max)
+    {
+        uint32_t tmp = _param->min;
+        _param->min = _param->max;
+        _param->max = tmp;
+        _param->in_range_is_white = !_param->in_range_is_white;
+    }
+
+    uint32_t min = _param->min;
+    uint32_t max = _param->max;
+    ADM_assert (min <= max);
+
+    uint8_t in_range_value;
+    uint8_t out_of_range_value;
+
+    if (_param->in_range_is_white)
+    {
+        in_range_value = 255;
+        out_of_range_value = 0;
+    }
+    else
+    {
+        in_range_value = 0;
+        out_of_range_value = 255;
+    }
+
+    for (uint32_t i = 0; i <= 255; i++)
+    {
+        if (i < min || i > max)
+            lookup_table [i] = out_of_range_value;
+        else
+            lookup_table [i] = in_range_value;
+    }
+}
+
 uint8_t	ADMVideoThreshold::getCoupledConf( CONFcouple **couples)
 {
 
     ADM_assert(_param);
-    *couples=new CONFcouple(3);
+    *couples = new CONFcouple(thresholdParam.nb);
 
 #define CSET(x)  (*couples)->setCouple((char *)#x,(_param->x))
     CSET(min);
     CSET(max);
+    CSET(in_range_is_white);
     CSET(debug);
 
     return 1;
@@ -89,13 +131,30 @@
 {
     UNUSED_ARG(in);
 
-    diaElemUSlider minslide(&(_param->min), _("Mi_nimum value to be non-zero in output:"), 0, 255);
-    diaElemUSlider maxslide(&(_param->max), _("Ma_ximum value to be non-zero in output:"), 0, 255);
+    diaElemUSlider minslide(&(_param->min), _("Mi_nimum value to be in-range:"), 0, 255);
+    diaElemUSlider maxslide(&(_param->max), _("Ma_ximum value to be in-range:"), 0, 255);
+
+    diaMenuEntry tInRangeIsWhite [] = {
+        { 1, _("In-range values go white, out-of-range go black"), NULL },
+        { 0, _("In-range values go black, out-of-range go white"), NULL },
+    };
+
+    diaElemMenu in_range_is_white
+        (&(_param->in_range_is_white),
+         _("Output values:"),
+         sizeof (tInRangeIsWhite) / sizeof (diaMenuEntry), tInRangeIsWhite);
+
     diaElemUInteger debug(&(_param->debug), _("_Debugging settings (bits):"),
                           0, 0x7fffffff);
-    diaElem * elems[] = { &minslide, &maxslide, &debug };
+    diaElem * elems[] = { &minslide, &maxslide, &in_range_is_white, &debug };
 
     uint8_t ret = diaFactoryRun("Threshold", sizeof (elems) / sizeof (diaElem *), elems);
+
+    if (ret) // 0 = cancel
+    {
+        computeLookupTable();
+    }
+
     return ret;
 }
 
@@ -107,15 +166,22 @@
     _uncompressed=NULL;
 }
 
-char	*ADMVideoThreshold::printConf( void) 
+char *ADMVideoThreshold::printConf (void) 
 {
-    static char conf[100];
+    const int CONF_LEN = 100;
+    static char conf[CONF_LEN];
+    char * cptr = conf;
+    cptr += snprintf (conf, CONF_LEN, "Threshold: In-range values (%u - %u) "
+                      "go %s, others %s",
+                      _param->min, _param->max,
+                      _param->in_range_is_white ? "white" : "black",
+                      _param->in_range_is_white ? "black" : "white");
+    if (_param->debug)
+        snprintf (cptr, CONF_LEN - (cptr - conf), "; debug=0x%x", _param->debug);
 
-    sprintf(conf,"Threshold: Min = %3u  Max = %3u  Debug=0x%06x",
-            _param->min, _param->max, _param->debug);
     return conf;
-	
 }
+
 uint8_t ADMVideoThreshold::getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
           			ADMImage *data,uint32_t *flags)
 {
@@ -152,25 +218,6 @@
     memset (histo_after, 0, 256 * sizeof (uint32_t));
 #endif
 
-    uint32_t min = _param->min;
-    uint32_t max = _param->max;
-
-    uint8_t in_range_value;
-    uint8_t out_of_range_value;
-    if (min <= max)
-    {
-        in_range_value = 255;
-        out_of_range_value = 0;
-    }
-    else
-    {
-        in_range_value = 0;
-        out_of_range_value = 255;
-        uint32_t tmp = min;
-        min = max;
-        max = tmp;
-    }
-
 #ifdef DUMP_FRAME_DATA
     FILE * fp = fopen ("/tmp/framedump.new.out", "a");
     ADM_assert(fp);
@@ -188,10 +235,7 @@
         fprintf (fp, "%x\n", curr);
 #endif
 
-        if (curr < min || curr > max)
-            *--destp = out_of_range_value;
-        else
-            *--destp = in_range_value;
+        *--destp = lookup_table [curr];
 
 #ifdef THRESHOLD_HISTO
         histo_after [*destp]++;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.h	2007-09-03 18:33:42 UTC (rev 3577)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.h	2007-09-04 17:25:48 UTC (rev 3578)
@@ -22,6 +22,7 @@
 
     uint32_t min;
     uint32_t max;
+    uint32_t in_range_is_white;
     uint32_t debug;
 
 } THRESHOLD_PARAM;
@@ -32,6 +33,7 @@
  protected:
     	
      THRESHOLD_PARAM *  _param;
+     uint8_t lookup_table [256];
 
  public:
  		
@@ -46,6 +48,6 @@
      virtual uint8_t 	configure( AVDMGenericVideoStream *instream);
      virtual char 		   *printConf(void);
      virtual uint8_t 	getCoupledConf( CONFcouple **couples);
-							
+     void computeLookupTable();
  };
 #endif



From mean at mail.berlios.de  Tue Sep  4 20:13:49 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 4 Sep 2007 20:13:49 +0200
Subject: [Avidemux-svn-commit] r3579 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory
Message-ID: <200709041813.l84IDndW024836@sheep.berlios.de>

Author: mean
Date: 2007-09-04 20:13:49 +0200 (Tue, 04 Sep 2007)
New Revision: 3579

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_slider.cpp
Log:
[QT4] Chris Mac Gregor : new file for sliders

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_slider.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_slider.cpp	2007-09-04 17:25:48 UTC (rev 3578)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_slider.cpp	2007-09-04 18:13:49 UTC (rev 3579)
@@ -0,0 +1,170 @@
+/***************************************************************************
+  FAC_integer.cpp
+  Handle dialog factory element : Integer
+  (C) 2006 Mean Fixounet at free.fr 
+***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include <config.h>
+
+
+#include <string.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <math.h>
+
+#include <QDialog>
+#include <QSpinBox>
+#include <QGridLayout>
+#include <QLabel>
+#include <QSlider>
+
+#include "default.h"
+#include "ADM_commonUI/DIA_factory.h"
+#include "ADM_assert.h"
+
+
+extern const char *shortkey(const char *);
+
+
+
+//********************************************************************
+
+class SpinSlider : public QWidget
+{
+    Q_OBJECT
+
+public:
+    SpinSlider (QWidget * parent = 0);
+    int value() const { return spinner->value(); }
+
+signals:
+    void valueChanged (int value);
+
+public slots:
+    void setValue (int value);
+    void setMinimum (int value);
+    void setMaximum (int value);
+
+private:
+    QSlider * slider;
+    QSpinBox * spinner;
+};
+
+SpinSlider::SpinSlider (QWidget * parent)
+    : QWidget (parent)
+{
+    slider = new QSlider (Qt::Horizontal);
+    spinner = new QSpinBox;
+
+    QWidget::connect (slider, SIGNAL(valueChanged(int)), spinner, SLOT(setValue(int)));
+    QWidget::connect (spinner, SIGNAL(valueChanged(int)), slider, SLOT(setValue(int)));
+    QWidget::connect (spinner, SIGNAL(valueChanged(int)), this, SIGNAL(valueChanged(int)));
+
+    QHBoxLayout * hbox = new QHBoxLayout;
+    hbox->addWidget (slider);
+    hbox->addWidget (spinner);
+
+    setLayout (hbox);
+}
+
+void SpinSlider::setValue (int value)
+{
+    spinner->setValue (value);
+}
+
+void SpinSlider::setMinimum (int value)
+{
+    spinner->setMinimum (value);
+    slider->setMinimum (value);
+}
+
+void SpinSlider::setMaximum (int value)
+{
+    spinner->setMaximum (value);
+    slider->setMaximum (value);
+}
+
+//----------------------------------------------------------------------
+
+template <typename T>
+diaElemGenericSlider<T>::diaElemGenericSlider(T *value,const char *toggleTitle, T min,T max,T incr,const char *tip)
+  : diaElem(ELEM_SLIDER)
+{
+  param=(void *)value;
+  paramTitle=shortkey(toggleTitle);
+  this->min=min;
+  this->max=max;
+  this->incr=incr;
+  this->tip=tip;
+  size = 2;
+}
+
+template <typename T>
+diaElemGenericSlider<T>::~diaElemGenericSlider()
+{ 
+  if(paramTitle)
+    delete paramTitle;
+}
+
+template <typename T>
+void diaElemGenericSlider<T>::setMe(void *dialog, void *opaque,uint32_t line)
+{
+  SpinSlider *slider = new SpinSlider ((QWidget *)dialog);
+  slider->setMinimum(min);
+  slider->setMaximum(max);
+  slider->setValue(*(T *)param);
+  slider->show();
+ 
+  myWidget = (void *)slider;
+
+  QLabel *text = new QLabel (paramTitle, (QWidget *)dialog);
+  text->setBuddy (slider);
+
+  QGridLayout *layout = (QGridLayout*) opaque;
+  layout->addWidget(text,line,0,1,2);
+  layout->addWidget(slider,line + 1,0,1,2);
+}
+
+template <typename T>
+void diaElemGenericSlider<T>::getMe(void)
+{
+  SpinSlider *box=(SpinSlider *)myWidget;
+  T val=box->value();
+  if(val<min) val=min;
+  if(val>max) val=max;
+  *(T *)param=val;
+}
+
+template <typename T>
+void diaElemGenericSlider<T>::enable(uint32_t onoff) 
+{
+  SpinSlider *box=(SpinSlider *)myWidget;
+  ADM_assert(box);
+  if(onoff)
+    box->setEnabled(1);
+  else
+    box->setDisabled(1);
+}
+
+template class diaElemGenericSlider <int32_t>;
+template class diaElemGenericSlider <uint32_t>;
+template class diaElemGenericSlider <ELEM_TYPE_FLOAT>;
+
+// float doesn't really work right.  If anyone ever uses it, we can fix it by
+// providing a template specialization here that uses QDoubleSpinBox and
+// intercepts the signals to convert between an integer used by the slider and
+// the actual value (a double) used by the spinbox.  I don't have time to do
+// that right now (already spent too long on this) and no one is using a
+// diaElemFSlider yet anyway.
+
+//EOF
+



From mean at mail.berlios.de  Wed Sep  5 19:56:54 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 5 Sep 2007 19:56:54 +0200
Subject: [Avidemux-svn-commit] r3580 -
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI
Message-ID: <200709051756.l85HusYC004973@sheep.berlios.de>

Author: mean
Date: 2007-09-05 19:56:53 +0200 (Wed, 05 Sep 2007)
New Revision: 3580

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.h
Log:
[SDL] Hackish SDL HW zoom

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp	2007-09-04 18:13:49 UTC (rev 3579)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp	2007-09-05 17:56:53 UTC (rev 3580)
@@ -66,7 +66,7 @@
         }
         if(sdl_display)
         {
-        SDL_UnlockSurface(sdl_display);
+        		SDL_UnlockSurface(sdl_display);
                 SDL_FreeSurface(sdl_display);
         }
         if(sdl_running)
@@ -75,8 +75,8 @@
         }
         if(decoded)
         {
-        delete [] decoded;
-        decoded=NULL;	
+		        delete [] decoded;
+		        decoded=NULL;	
         }
         sdl_running=0;
         sdl_overlay=NULL;
@@ -134,7 +134,7 @@
 	putenv(origin);
 #endif
 
-    sdl_display= SDL_SetVideoMode( w, h,  bpp, flags );
+    sdl_display= SDL_SetVideoMode( w*2, h*2,  bpp, flags );
 
     if (!sdl_display)
     {
@@ -251,38 +251,48 @@
 //	printf("SDL: new pitch :%d\n",pitch);
         if(useYV12)
         {
-        if(pitch==w)
-            memcpy(sdl_overlay->pixels[0],ptr,w*h);
-        else
-            interleave(sdl_overlay->pixels[0],ptr,w,pitch,h);
-            
-        pitch=sdl_overlay->pitches[1];
-        if(pitch==(w>>1))
-            memcpy(sdl_overlay->pixels[1],ptr+page,(w*h)>>2);
-        else
-            interleave(sdl_overlay->pixels[1],ptr+page,w>>1,pitch,h>>1);
-      
-        pitch=sdl_overlay->pitches[2];
-        if(pitch==(w>>1))
-            memcpy(sdl_overlay->pixels[2],ptr+(page*5)/4,(w*h)>>2);
-        else
-            interleave(sdl_overlay->pixels[2],ptr+(page*5)/4,w>>1,pitch,h>>1);  	
+	        if(pitch==w)
+	            memcpy(sdl_overlay->pixels[0],ptr,w*h);
+	        else
+	            interleave(sdl_overlay->pixels[0],ptr,w,pitch,h);
+	            
+	        pitch=sdl_overlay->pitches[1];
+	        if(pitch==(w>>1))
+	            memcpy(sdl_overlay->pixels[1],ptr+page,(w*h)>>2);
+	        else
+	            interleave(sdl_overlay->pixels[1],ptr+page,w>>1,pitch,h>>1);
+	      
+	        pitch=sdl_overlay->pitches[2];
+	        if(pitch==(w>>1))
+	            memcpy(sdl_overlay->pixels[2],ptr+(page*5)/4,(w*h)>>2);
+	        else
+	            interleave(sdl_overlay->pixels[2],ptr+(page*5)/4,w>>1,pitch,h>>1);  	
         }else
         {
-        color->reset(w,h);
-        if(pitch==2*w)
-        {
-            color->scale(ptr,sdl_overlay->pixels[0]);
-        }
-        else
-        {
-            color->scale(ptr,decoded);
-            interleave(sdl_overlay->pixels[0],decoded,2*w,pitch,h);
-        }
-    }	
-        
-        disp.w=w;
-        disp.h=h;
+	        color->reset(w,h);
+	        if(pitch==2*w)
+	        {
+	            color->scale(ptr,sdl_overlay->pixels[0]);
+	        }
+	        else
+	        {
+	            color->scale(ptr,decoded);
+	            interleave(sdl_overlay->pixels[0],decoded,2*w,pitch,h);
+	        }
+        }	
+        uint32_t factor=4;
+               switch(zoom)
+               {
+                   case ZOOM_1_4: factor=1;break;
+                   case ZOOM_1_2: factor=2;break;
+                   case ZOOM_1_1: factor=4;break;
+                   case ZOOM_2:   factor=8;break;
+                   case ZOOM_4:   factor=16;break;
+                   default : ADM_assert(0);
+                 
+               }
+        disp.w=(w*factor)/4;
+        disp.h=(h*factor)/4;
         disp.x=0;
         disp.y=0;
         

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.h	2007-09-04 18:13:49 UTC (rev 3579)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.h	2007-09-05 17:56:53 UTC (rev 3580)
@@ -28,6 +28,7 @@
               virtual	uint8_t init( GUI_WindowInfo * window, uint32_t w, uint32_t h);
               virtual	uint8_t end(void);
               virtual   uint8_t display(uint8_t *ptr, uint32_t w, uint32_t h,renderZoom zoom);
+              			uint8_t hasHwZoom(void) {return 1;}
 };
 
 void initSdl(void);



From mean at mail.berlios.de  Sat Sep  8 12:53:58 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 8 Sep 2007 12:53:58 +0200
Subject: [Avidemux-svn-commit] r3581 -
	branches/avidemux_2.4_branch/avidemux/ADM_video
Message-ID: <200709081053.l88Arw8N006725@sheep.berlios.de>

Author: mean
Date: 2007-09-08 12:53:53 +0200 (Sat, 08 Sep 2007)
New Revision: 3581

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidPartial.cpp
Log:
[Filers] oops , forgot one file for partial in script 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidPartial.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidPartial.cpp	2007-09-05 17:56:53 UTC (rev 3580)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidPartial.cpp	2007-09-08 10:53:53 UTC (rev 3581)
@@ -41,7 +41,13 @@
 
 extern AVDMGenericVideoStream *filterCreateFromTag(VF_FILTERS tag,CONFcouple *couple, AVDMGenericVideoStream *in);
 
+
+static FILTER_PARAM partialParam={VARIABLE_PARAMS+3,{"_start","_end","_tag"}};
+
+
+SCRIPT_CREATE(partial_script,ADMVideoPartial,partialParam);
 BUILD_CREATE(partial_create,ADMVideoPartial);
+
 //___________________________________________________
 char 						*ADMVideoPartial::printConf(void)
 {



From mean at mail.berlios.de  Sat Sep  8 12:54:37 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 8 Sep 2007 12:54:37 +0200
Subject: [Avidemux-svn-commit] r3582 - in branches/avidemux_2.4_branch: .
	avidemux avidemux/ADM_editor avidemux/ADM_filter
	avidemux/ADM_libraries/ADM_lavcodec
	avidemux/ADM_libraries/ADM_lavformat
	avidemux/ADM_libraries/ADM_lavutil
	avidemux/ADM_outputs/oplug_mp4 avidemux/ADM_script
	avidemux/ADM_video
Message-ID: <200709081054.l88AsbpI007433@sheep.berlios.de>

Author: mean
Date: 2007-09-08 12:54:35 +0200 (Sat, 08 Sep 2007)
New Revision: 3582

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/xiph.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/matroskaenc.c
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_outputfmt.h
   branches/avidemux_2.4_branch/avidemux/ADM_filter/filter.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/utils.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/matroska.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/matroska.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/crc.h
   branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_container.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_genvideo.hxx
   branches/avidemux_2.4_branch/avidemux/gui_savenew.cpp
   branches/avidemux_2.4_branch/config.h.cmake
   branches/avidemux_2.4_branch/configure.in.in
Log:
[Output Format] Matroska output, VERY incomplete

Modified: branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_outputfmt.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_outputfmt.h	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_outputfmt.h	2007-09-08 10:54:35 UTC (rev 3582)
@@ -24,9 +24,9 @@
 	ADM_OGM,
 	ADM_PSP,
 	ADM_FLV,
+        ADM_MATROSKA,
 	ADM_DUMMY,
 	ADM_FORMAT_MAX,
-	ADM_FMT_DUMMY=ADM_FORMAT_MAX
 }ADM_OUT_FORMAT;
 
 typedef struct 
@@ -50,6 +50,7 @@
   {ADM_OGM,_("OGM")},
   {ADM_PSP,_("PSP")},
   {ADM_FLV,_("FLV")},
+  {ADM_MATROSKA,_("MKV")},
   {ADM_DUMMY,_("DUMMY")}
 };
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/filter.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/filter.cpp	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/filter.cpp	2007-09-08 10:54:35 UTC (rev 3582)
@@ -100,7 +100,7 @@
 	for(uint32_t i=0;i<allfilters.size();i++)
 	{
 		name=allfilters[ i].filtername;
-		if(allfilters[ i].viewable)
+		if(allfilters[ i].viewable || allfilters[i].tag==VF_PARTIAL)
 		{
 			if(name)
 			{
@@ -323,55 +323,106 @@
 {
 int found,l;
 int trans[MAXPARAM];
-	if(nb!=param->nb)
+	if(param->nb>VARIABLE_PARAMS)
 	{
-		printf("# of parameters mismatch\n");
-		return NULL;
+		// Variable # of parameters
+		// We check we have at least what is required by the template
+		for(int i=0;i<(param->nb-VARIABLE_PARAMS);i++)
+				{
+					l=strlen(param->param[i]);
+					ADM_assert(l);
+					found=-1;
+					for(int j=0;j<nb;j++)
+					{
+						if(!strncasecmp(param->param[i],args[j].arg.string,l))
+						{
+							if(strlen(args[j].arg.string)>l && args[j].arg.string[l]=='=')
+							{
+								found=j;
+								break;
+							}
+						}
+					}
+					if(found==-1)
+					{	
+						printf("Param : %s not found or incorrect\n",param->param[i]);
+						 return NULL;
+					}
+				}
+				// if we get here, it means we found each param, time to build the couples
+				CONFcouple *couple;
+				couple=new CONFcouple(nb);
+				for(int i=0;i<nb;i++)
+				{
+					char *copy=ADM_strdup(args[i].arg.string);
+					// Search "="
+					char *where=strstr(copy,"=");
+					if(!where) ADM_assert(0);
+					*where=0;
+					if(!couple->setCouple(copy,where+1))
+						{
+							printf("Set couple failed\n");
+							delete couple;
+							return NULL;
+						}
+					ADM_dealloc(copy);
+				}
+				return couple;
 	}
-	// For each param check we are ok
-	// the generic form is name=value
-	// name should be the same as in the param array
-	for(int i=0;i<nb;i++)
+	//********************* Constant # of parameters #################
+	else
 	{
-		l=strlen(param->param[i]);
-		ADM_assert(l);
-		found=-1;
-		for(int j=0;j<nb;j++)
+		if(nb!=param->nb )
 		{
-			if(!strncasecmp(param->param[i],args[j].arg.string,l))
+			printf("# of parameters mismatch: expected %d, got %d\n",nb,param->nb);
+			return NULL;
+		}
+		// For each param check we are ok
+		// the generic form is name=value
+		// name should be the same as in the param array
+		for(int i=0;i<nb;i++)
+		{
+			l=strlen(param->param[i]);
+			ADM_assert(l);
+			found=-1;
+			for(int j=0;j<nb;j++)
 			{
-				if(strlen(args[j].arg.string)>l && args[j].arg.string[l]=='=')
+				if(!strncasecmp(param->param[i],args[j].arg.string,l))
 				{
-					found=j;
-					trans[i]=j;
-					break;
+					if(strlen(args[j].arg.string)>l && args[j].arg.string[l]=='=')
+					{
+						found=j;
+						trans[i]=j;
+						break;
+					}
 				}
 			}
+			if(found==-1)
+			{	
+				printf("Param : %s not found or incorrect\n",param->param[i]);
+				 return NULL;
+			}
 		}
-		if(found==-1)
-		{	
-			printf("Param : %s not found or incorrect\n",param->param[i]);
-			 return NULL;
+		// if we get here, it means we found each param, time to build the couples
+		CONFcouple *couple;
+		couple=new CONFcouple(nb);
+		for(int i=0;i<nb;i++)
+		{
+			l=strlen(param->param[i]);
+			if(!couple->setCouple(param->param[i],args[ trans[i]].arg.string+l+1))
+				{
+					printf("Set couple failed\n");
+					delete couple;
+					return NULL;
+				}
 		}
+		return couple;
 	}
-	// if we get here, it means we found each param, time to build the couples
-	CONFcouple *couple;
-	couple=new CONFcouple(nb);
-	for(int i=0;i<nb;i++)
-	{
-		l=strlen(param->param[i]);
-		if(!couple->setCouple(param->param[i],args[ trans[i]].arg.string+l+1))
-			{
-				printf("Set couple failed\n");
-				delete couple;
-				return NULL;
-			}
-	}
-	return couple;
+	
 }
 uint8_t 	filterAddScript(VF_FILTERS tag,uint32_t n,Arg *args)
 {
-	// 1- searc filter
+	// 1- search filter
 	int found=-1;
 	aviInfo info;
 
@@ -403,7 +454,7 @@
 			return 1;
 		}
 	}
-	printf("Tag not found\n");
+	printf("Tag not found:%d\n",tag);
 	return 0;
 }
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/avidemux/ADM_filter/filter_declaration.cpp	2007-09-08 10:54:35 UTC (rev 3582)
@@ -177,7 +177,7 @@
 // Does not work
 //        REGISTERX("unblend","Unblend by Bach",VF_UNBLEND,1,unblend_create,unblend_script);
         
-        REGISTER("","Partial","",VF_PARTIAL,0,partial_create);
+        REGISTERX("partial","Partial","",VF_PARTIAL,0,partial_create,partial_script);
 //	REGISTER("","Remove Salt",VF_SALT,0,salt_create);
  printf("\n");
 }		

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/CMakeLists.txt	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/CMakeLists.txt	2007-09-08 10:54:35 UTC (rev 3582)
@@ -30,7 +30,7 @@
                 wma.c
                 dvbsub_parser.c
                 dvbsubdec.c
-                dvbsub.c
+                dvbsub.c xiph.c
 )
 # ADD x86 ones
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/Makefile.am	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/Makefile.am	2007-09-08 10:54:35 UTC (rev 3582)
@@ -69,7 +69,7 @@
                 wma.c \
                 dvbsub_parser.c \
                 dvbsubdec.c \
-                dvbsub.c
+                dvbsub.c xiph.c
 
 	
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/utils.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/utils.c	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/utils.c	2007-09-08 10:54:35 UTC (rev 3582)
@@ -147,6 +147,8 @@
     uint8_t *base[4];
     uint8_t *data[4];
     int linesize[4];
+    int width, height;
+    enum PixelFormat pix_fmt;
 }InternalBuffer;
 
 #define INTERNAL_BUFFER_SIZE 32
@@ -251,6 +253,13 @@
     picture_number= &(((InternalBuffer*)s->internal_buffer)[INTERNAL_BUFFER_SIZE-1]).last_pic_num; //FIXME ugly hack
     (*picture_number)++;
 
+    if(buf->base[0] && (buf->width != w || buf->height != h || buf->pix_fmt != s->pix_fmt)){
+        for(i=0; i<4; i++){
+            av_freep(&buf->base[i]);
+            buf->data[i]= NULL;
+        }
+    }
+
     if(buf->base[0]){
         pic->age= *picture_number - buf->last_pic_num;
         buf->last_pic_num= *picture_number;
@@ -306,6 +315,9 @@
             else
                 buf->data[i] = buf->base[i] + ALIGN((buf->linesize[i]*EDGE_WIDTH>>v_shift) + (EDGE_WIDTH>>h_shift), STRIDE_ALIGN);
         }
+        buf->width  = s->width;
+        buf->height = s->height;
+        buf->pix_fmt= s->pix_fmt;
         pic->age= 256*256*256*64;
     }
     pic->type= FF_BUFFER_TYPE_INTERNAL;
@@ -741,6 +753,7 @@
 {"timecode_frame_start", "GOP timecode frame start number, in non drop frame format", OFFSET(timecode_frame_start), FF_OPT_TYPE_INT, 0, 0, INT_MAX, V|E},
 {"drop_frame_timecode", NULL, 0, FF_OPT_TYPE_CONST, CODEC_FLAG2_DROP_FRAME_TIMECODE, INT_MIN, INT_MAX, V|E, "flags2"},
 {"non_linear_q", "use non linear quantizer", 0, FF_OPT_TYPE_CONST, CODEC_FLAG2_NON_LINEAR_QUANT, INT_MIN, INT_MAX, V|E, "flags2"},
+// MEANX {"request_channels", "set desired number of audio channels", OFFSET(request_channels), FF_OPT_TYPE_INT, DEFAULT, 0, INT_MAX, A|D},
 {NULL},
 };
 
@@ -759,6 +772,7 @@
 
     s->av_class= &av_codec_context_class;
 
+    s->codec_type = codec_type;
     if(codec_type == CODEC_TYPE_AUDIO)
         flags= AV_OPT_FLAG_AUDIO_PARAM;
     else if(codec_type == CODEC_TYPE_VIDEO)
@@ -831,8 +845,10 @@
 
     if (codec->priv_data_size > 0) {
         avctx->priv_data = av_mallocz(codec->priv_data_size);
-        if (!avctx->priv_data)
+        if (!avctx->priv_data) {
+            ret = AVERROR(ENOMEM);
             goto end;
+        }
     } else {
         avctx->priv_data = NULL;
     }
@@ -844,6 +860,7 @@
 
     if((avctx->coded_width||avctx->coded_height) && avcodec_check_dimensions(avctx,avctx->coded_width,avctx->coded_height)){
         av_freep(&avctx->priv_data);
+        ret = AVERROR(EINVAL);
         goto end;
     }
 
@@ -938,7 +955,7 @@
 
     if((avctx->codec->capabilities & CODEC_CAP_DELAY) || buf_size){
         //FIXME remove the check below _after_ ensuring that all audio check that the available space is enough
-#if 0 // MEANX SILENCE!
+#if 0 // MEANX : Silence
         if(*frame_size_ptr < AVCODEC_MAX_AUDIO_FRAME_SIZE){
             av_log(avctx, AV_LOG_ERROR, "buffer smaller than AVCODEC_MAX_AUDIO_FRAME_SIZE\n");
             return -1;
@@ -1221,9 +1238,9 @@
     av_crc8005    = av_mallocz_static(sizeof(AVCRC) * 257);
     av_crc07      = av_mallocz_static(sizeof(AVCRC) * 257);
 #endif
-    av_crc_init(av_crc04C11DB7, 0, 32, 0x04c11db7, sizeof(AVCRC)*257);
-    av_crc_init(av_crc8005    , 0, 16, 0x8005    , sizeof(AVCRC)*257);
-    av_crc_init(av_crc07      , 0,  8, 0x07      , sizeof(AVCRC)*257);
+    av_crc_init(av_crc04C11DB7, 0, 32, AV_CRC_32_IEEE, sizeof(AVCRC)*257);
+    av_crc_init(av_crc8005    , 0, 16, AV_CRC_16     , sizeof(AVCRC)*257);
+    av_crc_init(av_crc07      , 0,  8, AV_CRC_8_ATM  , sizeof(AVCRC)*257);
 }
 
 void avcodec_init(void)
@@ -1308,6 +1325,22 @@
     }
 }
 
+int av_get_bits_per_sample_format(enum SampleFormat sample_fmt) {
+    switch (sample_fmt) {
+    case SAMPLE_FMT_U8:
+        return 8;
+    case SAMPLE_FMT_S16:
+        return 16;
+    case SAMPLE_FMT_S24:
+        return 24;
+    case SAMPLE_FMT_S32:
+    case SAMPLE_FMT_FLT:
+        return 32;
+    default:
+        return 0;
+    }
+}
+
 #if !defined(HAVE_THREADS)
 int avcodec_thread_init(AVCodecContext *s, int thread_count){
     return -1;
@@ -1347,7 +1380,7 @@
         return -1;
     }
 #if !defined(HAVE_MKSTEMP)
-    fd = open(*filename, O_RDWR | /* MEANX ??O_BINARY |*/ O_CREAT, 0444);
+    fd = open(*filename, O_RDWR /* MEANX | O_BINARY*/ | O_CREAT, 0444);
 #else
     snprintf(*filename, len, "/tmp/%sXXXXXX", prefix);
     fd = mkstemp(*filename);

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/xiph.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/xiph.c	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/xiph.c	2007-09-08 10:54:35 UTC (rev 3582)
@@ -0,0 +1,56 @@
+/*
+ * Copyright (C) 2007  FFmpeg Project
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
+#include "xiph.h"
+
+int ff_split_xiph_headers(uint8_t *extradata, int extradata_size,
+                          int first_header_size, uint8_t *header_start[3],
+                          int header_len[3])
+{
+    int i, j;
+
+    if (AV_RB16(extradata) == first_header_size) {
+        for (i=0; i<3; i++) {
+            header_len[i] = AV_RB16(extradata);
+            extradata += 2;
+            header_start[i] = extradata;
+            extradata += header_len[i];
+        }
+    } else if (extradata[0] == 2) {
+        for (i=0,j=1; i<2; i++,j++) {
+            header_len[i] = 0;
+            for (; j<extradata_size && extradata[j]==0xff; j++) {
+                header_len[i] += 0xff;
+            }
+            if (j >= extradata_size)
+                return -1;
+
+            header_len[i] += extradata[j];
+        }
+        header_len[2] = extradata_size - header_len[0] - header_len[1] - j;
+        extradata += j;
+        header_start[0] = extradata;
+        header_start[1] = header_start[0] + header_len[0];
+        header_start[2] = header_start[1] + header_len[1];
+    } else {
+        return -1;
+    }
+    return 0;
+}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp	2007-09-08 10:54:35 UTC (rev 3582)
@@ -130,12 +130,17 @@
 	case MUXER_FLV:
 		fmt = guess_format("flv", NULL, NULL);
 		break;          
+	case MUXER_MATROSKA:
+		fmt = guess_format("matroska", NULL, NULL);
+		break;          
+
 	default:
 		fmt=NULL;
 	}
 	if (!fmt) 
 	{
         	printf("Lav:Cannot guess format\n");
+                ADM_assert(0);
 		return 0;
 	}
 	oc = av_alloc_format_context();
@@ -179,6 +184,32 @@
 					 }
 					 
 					 break;
+                case MUXER_MATROSKA:
+                        strcpy(oc->title,"Avidemux");
+                        strcpy(oc->author,"Avidemux");
+                        c->sample_aspect_ratio.num=1;
+                        c->sample_aspect_ratio.den=1;
+                        if(isMpeg4Compatible(info->fcc))
+                        {
+                                c->codec_id = CODEC_ID_MPEG4;
+                                c->has_b_frames=1; // in doubt...
+                        }else
+                        {
+                                if(isH264Compatible(info->fcc))
+                                {
+                                        c->has_b_frames=1; // in doubt...
+                                        c->codec_id = CODEC_ID_H264;
+                                        c->codec=new AVCodec;
+                                        memset(c->codec,0,sizeof(AVCodec));
+                                        c->codec->name=ADM_strdup("H264");
+                                }
+                        }
+                        if(videoExtraDataSize)
+                        {
+                                c->extradata=videoExtraData;
+                                c->extradata_size= videoExtraDataSize;
+                        }
+                        break;
                 case MUXER_MP4:
                 case MUXER_PSP:
                         strcpy(oc->title,"Avidemux");
@@ -321,7 +352,7 @@
 			break;
 		default:
                       {
-                            if(_type==MUXER_MP4 || _type==MUXER_PSP || _type==MUXER_FLV)
+                            if(_type==MUXER_MP4 || _type==MUXER_PSP || _type==MUXER_FLV || _type==MUXER_MATROSKA)
                             {
                                     c->time_base=fpsfree;// (AVRational){1000,_fps1000};
                                     break;
@@ -407,6 +438,7 @@
 				case MUXER_FLV:
                 case MUXER_PSP:
                 case MUXER_MP4:
+                case MUXER_MATROSKA:
                         oc->mux_rate=10080*1000; // Needed ?
                         break;
 
@@ -473,7 +505,7 @@
 
             timeInUs=(int64_t)sample2time_us(sample);
             /* Rescale to ?? */
-            if(_type==MUXER_FLV) /* The FLV muxer expects packets dated in ms, there is something i did not get... WTF */
+            if(_type==MUXER_FLV || _type==MUXER_MATROSKA) /* The FLV muxer expects packets dated in ms, there is something i did not get... WTF */
             {
             			f=timeInUs/1000;
             			f=floor(f+0.4);
@@ -567,7 +599,7 @@
         d=bitstream->dtsFrame;
         RESCALE(d);
         
-        if(_type==MUXER_FLV) /* The FLV muxer expects packets dated in ms, there is something i did not get... WTF */
+        if(_type==MUXER_FLV || _type==MUXER_MATROSKA) /* The FLV muxer expects packets dated in ms, there is something i did not get... WTF */
         {
         			p=p*1000/_fps1000;
         			d=d*1000/_fps1000;
@@ -646,12 +678,14 @@
      extern  int        mpegps_init(void );
      extern  int        movenc_init(void );
      extern  int        flvenc_init(void );
+     extern  int        matroskaenc_init(void );
 };
 extern URLProtocol file_protocol ;
 uint8_t lavformat_init(void)
 {
                 movenc_init();
                 flvenc_init();
+                matroskaenc_init();
                 register_protocol(&file_protocol);
 }
 extern "C"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.h	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.h	2007-09-08 10:54:35 UTC (rev 3582)
@@ -24,6 +24,7 @@
         MUXER_MP4,
         MUXER_PSP,
         MUXER_FLV,
+        MUXER_MATROSKA,
         MUXER_DUMMY
 }ADM_MUXER_TYPE;
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/CMakeLists.txt	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/CMakeLists.txt	2007-09-08 10:54:35 UTC (rev 3582)
@@ -8,7 +8,7 @@
  mpeg.c utils.c avio.c ADM_lavformat.cpp 
 aviobuf.c cutils.c img2.c file.c mpegtsenc.c ADM_muxts.cpp movenc.c 
 avienc.c wav.c mov.c matroska.c isom.c isom.h riff.c
-flvenc.c
+flvenc.c matroskaenc.c
 )
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
 ADD_ADM_LIB(${ADM_LIB} ADM_libraries)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/Makefile.am	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/Makefile.am	2007-09-08 10:54:35 UTC (rev 3582)
@@ -6,7 +6,8 @@
 
 libADM_lavformat_a_SOURCES =  mpeg.c utils.c avio.c ADM_lavformat.cpp \
 aviobuf.c cutils.c img2.c file.c mpegtsenc.c ADM_muxts.cpp movenc.c \
-avienc.c wav.c mov.c matroska.c isom.c isom.h riff.c flvenc.c
+avienc.c wav.c mov.c matroska.c isom.c isom.h riff.c flvenc.c \
+matroskaenc.c
 
 
 EXTRA_DIST = ADM_lavformat.cpp  ADM_muxts.cpp  avformat.h  avio.h   \

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/matroska.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/matroska.c	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/matroska.c	2007-09-08 10:54:35 UTC (rev 3582)
@@ -24,8 +24,8 @@
 CodecTags ff_mkv_codec_tags[]={
 //    {"V_MS/VFW/FOURCC"  , CODEC_ID_NONE},
     {"V_UNCOMPRESSED"   , CODEC_ID_RAWVIDEO},
+    {"V_MPEG4/ISO/ASP"  , CODEC_ID_MPEG4},
     {"V_MPEG4/ISO/SP"   , CODEC_ID_MPEG4},
-    {"V_MPEG4/ISO/ASP"  , CODEC_ID_MPEG4},
     {"V_MPEG4/ISO/AP"   , CODEC_ID_MPEG4},
     {"V_MPEG4/ISO/AVC"  , CODEC_ID_H264},
     {"V_MPEG4/MS/V3"    , CODEC_ID_MSMPEG4V3},
@@ -37,12 +37,13 @@
     {"V_REAL/RV30"      , CODEC_ID_RV30},
     {"V_REAL/RV40"      , CODEC_ID_RV40},
     {"V_THEORA"         , CODEC_ID_THEORA},
+    {"V_SNOW"           , CODEC_ID_SNOW},
 /* TODO: Real/Quicktime */
 
 //    {"A_MS/ACM"         , CODEC_ID_NONE},
-    {"A_MPEG/L1"        , CODEC_ID_MP3},
-    {"A_MPEG/L2"        , CODEC_ID_MP3},
     {"A_MPEG/L3"        , CODEC_ID_MP3},
+    {"A_MPEG/L2"        , CODEC_ID_MP2},
+    {"A_MPEG/L1"        , CODEC_ID_MP2},
     {"A_PCM/INT/BIG"    , CODEC_ID_PCM_U16BE},
     {"A_PCM/INT/LIT"    , CODEC_ID_PCM_U16LE},
 //    {"A_PCM/FLOAT/IEEE" , CODEC_ID_NONE},
@@ -59,10 +60,12 @@
     {"A_REAL/COOK"      , CODEC_ID_COOK},
 //    {"A_REAL/SIPR"      , CODEC_ID_SIPRO},
 
+    {"S_TEXT/UTF8"      , CODEC_ID_TEXT},
     {"S_TEXT/ASCII"     , CODEC_ID_TEXT},
-    {"S_TEXT/UTF8"      , CODEC_ID_TEXT},
     {"S_TEXT/ASS"       , CODEC_ID_TEXT},
     {"S_TEXT/SSA"       , CODEC_ID_TEXT},
+    {"S_ASS"            , CODEC_ID_TEXT},
+    {"S_SSA"            , CODEC_ID_TEXT},
     {"S_VOBSUB"         , CODEC_ID_DVD_SUBTITLE},
 
     {NULL               , CODEC_ID_NONE}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/matroska.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/matroska.h	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/matroska.h	2007-09-08 10:54:35 UTC (rev 3582)
@@ -64,6 +64,7 @@
 #define MATROSKA_ID_WRITINGAPP 0x5741
 #define MATROSKA_ID_MUXINGAPP  0x4D80
 #define MATROSKA_ID_DATEUTC    0x4461
+#define MATROSKA_ID_SEGMENTUID 0x73A4
 
 /* ID in the tracks master */
 #define MATROSKA_ID_TRACKENTRY 0xAE

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/matroskaenc.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/matroskaenc.c	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/matroskaenc.c	2007-09-08 10:54:35 UTC (rev 3582)
@@ -0,0 +1,836 @@
+/*
+ * Matroska muxer
+ * Copyright (c) 2007 David Conrad
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
+#include "avformat.h"
+#include "md5.h"
+#include "riff.h"
+#include "xiph.h"
+#include "matroska.h"
+
+typedef struct ebml_master {
+    offset_t        pos;                ///< absolute offset in the file where the master's elements start
+    int             sizebytes;          ///< how many bytes were reserved for the size
+} ebml_master;
+
+typedef struct mkv_seekhead_entry {
+    unsigned int    elementid;
+    uint64_t        segmentpos;
+} mkv_seekhead_entry;
+
+typedef struct mkv_seekhead {
+    offset_t                filepos;
+    offset_t                segment_offset;     ///< the file offset to the beginning of the segment
+    int                     reserved_size;      ///< -1 if appending to file
+    int                     max_entries;
+    mkv_seekhead_entry      *entries;
+    int                     num_entries;
+} mkv_seekhead;
+
+typedef struct {
+    uint64_t        pts;
+    int             tracknum;
+    offset_t        cluster_pos;        ///< file offset of the cluster containing the block
+} mkv_cuepoint;
+
+typedef struct {
+    offset_t        segment_offset;
+    mkv_cuepoint    *entries;
+    int             num_entries;
+} mkv_cues;
+
+typedef struct MatroskaMuxContext {
+    ebml_master     segment;
+    offset_t        segment_offset;
+    offset_t        segment_uid;
+    ebml_master     cluster;
+    offset_t        cluster_pos;        ///< file offset of the current cluster
+    uint64_t        cluster_pts;
+    offset_t        duration_offset;
+    uint64_t        duration;
+    mkv_seekhead    *main_seekhead;
+    mkv_seekhead    *cluster_seekhead;
+    mkv_cues        *cues;
+
+    struct AVMD5    *md5_ctx;
+} MatroskaMuxContext;
+
+
+/** 2 bytes * 3 for EBML IDs, 3 1-byte EBML lengths, 8 bytes for 64 bit
+ * offset, 4 bytes for target EBML ID */
+#define MAX_SEEKENTRY_SIZE 21
+
+/** per-cuepoint-track - 3 1-byte EBML IDs, 3 1-byte EBML sizes, 2
+ * 8-byte uint max */
+#define MAX_CUETRACKPOS_SIZE 22
+
+/** per-cuepoint - 2 1-byte EBML IDs, 2 1-byte EBML sizes, 8-byte uint max */
+#define MAX_CUEPOINT_SIZE(num_tracks) 12 + MAX_CUETRACKPOS_SIZE*num_tracks
+
+
+static int ebml_id_size(unsigned int id)
+{
+    return (av_log2(id+1)-1)/7+1;
+}
+
+static void put_ebml_id(ByteIOContext *pb, unsigned int id)
+{
+    int i = ebml_id_size(id);
+    while (i--)
+        put_byte(pb, id >> (i*8));
+}
+
+/**
+ * Write an EBML size meaning "unknown size".
+ *
+ * @param bytes The number of bytes the size should occupy (maximum: 8).
+ */
+static void put_ebml_size_unknown(ByteIOContext *pb, int bytes)
+{
+    assert(bytes <= 8);
+    put_byte(pb, 0x1ff >> bytes);
+    while (--bytes)
+        put_byte(pb, 0xff);
+}
+
+/**
+ * Calculate how many bytes are needed to represent a given number in EBML.
+ */
+static int ebml_num_size(uint64_t num)
+{
+    int bytes = 1;
+    while ((num+1) >> bytes*7) bytes++;
+    return bytes;
+}
+
+/**
+ * Write a number in EBML variable length format.
+ *
+ * @param bytes The number of bytes that need to be used to write the number.
+ *              If zero, any number of bytes can be used.
+ */
+static void put_ebml_num(ByteIOContext *pb, uint64_t num, int bytes)
+{
+    int i, needed_bytes = ebml_num_size(num);
+
+    // sizes larger than this are currently undefined in EBML
+    assert(num < (1ULL<<56)-1);
+
+    if (bytes == 0)
+        // don't care how many bytes are used, so use the min
+        bytes = needed_bytes;
+    // the bytes needed to write the given size would exceed the bytes
+    // that we need to use, so write unknown size. This shouldn't happen.
+    assert(bytes >= needed_bytes);
+
+    num |= 1ULL << bytes*7;
+    for (i = bytes - 1; i >= 0; i--)
+        put_byte(pb, num >> i*8);
+}
+
+static void put_ebml_uint(ByteIOContext *pb, unsigned int elementid, uint64_t val)
+{
+    int i, bytes = 1;
+    while (val >> bytes*8) bytes++;
+
+    put_ebml_id(pb, elementid);
+    put_ebml_num(pb, bytes, 0);
+    for (i = bytes - 1; i >= 0; i--)
+        put_byte(pb, val >> i*8);
+}
+
+static void put_ebml_float(ByteIOContext *pb, unsigned int elementid, double val)
+{
+    put_ebml_id(pb, elementid);
+    put_ebml_num(pb, 8, 0);
+    put_be64(pb, av_dbl2int(val));
+}
+
+static void put_ebml_binary(ByteIOContext *pb, unsigned int elementid,
+                            const uint8_t *buf, int size)
+{
+    put_ebml_id(pb, elementid);
+    put_ebml_num(pb, size, 0);
+    put_buffer(pb, buf, size);
+}
+
+static void put_ebml_string(ByteIOContext *pb, unsigned int elementid, const char *str)
+{
+    put_ebml_binary(pb, elementid, str, strlen(str));
+}
+
+/**
+ * Writes a void element of a given size. Useful for reserving space in
+ * the file to be written to later.
+ *
+ * @param size The number of bytes to reserve, which must be at least 2.
+ */
+static void put_ebml_void(ByteIOContext *pb, uint64_t size)
+{
+    offset_t currentpos = url_ftell(pb);
+
+    assert(size >= 2);
+
+    put_ebml_id(pb, EBML_ID_VOID);
+    // we need to subtract the length needed to store the size from the
+    // size we need to reserve so 2 cases, we use 8 bytes to store the
+    // size if possible, 1 byte otherwise
+    if (size < 10)
+        put_ebml_num(pb, size-1, 0);
+    else
+        put_ebml_num(pb, size-9, 8);
+    url_fseek(pb, currentpos + size, SEEK_SET);
+}
+
+static ebml_master start_ebml_master(ByteIOContext *pb, unsigned int elementid, uint64_t expectedsize)
+{
+    int bytes = expectedsize ? ebml_num_size(expectedsize) : 8;
+    put_ebml_id(pb, elementid);
+    put_ebml_size_unknown(pb, bytes);
+    return (ebml_master){ url_ftell(pb), bytes };
+}
+
+static void end_ebml_master(ByteIOContext *pb, ebml_master master)
+{
+    offset_t pos = url_ftell(pb);
+
+    // leave the unknown size for masters when streaming
+    if (url_is_streamed(pb))
+        return;
+
+    url_fseek(pb, master.pos - master.sizebytes, SEEK_SET);
+    put_ebml_num(pb, pos - master.pos, master.sizebytes);
+    url_fseek(pb, pos, SEEK_SET);
+}
+
+static void put_xiph_size(ByteIOContext *pb, int size)
+{
+    int i;
+    for (i = 0; i < size / 255; i++)
+        put_byte(pb, 255);
+    put_byte(pb, size % 255);
+}
+
+/**
+ * Initialize a mkv_seekhead element to be ready to index level 1 Matroska
+ * elements. If a maximum number of elements is specified, enough space
+ * will be reserved at the current file location to write a seek head of
+ * that size.
+ *
+ * @param segment_offset The absolute offset to the position in the file
+ *                       where the segment begins.
+ * @param numelements The maximum number of elements that will be indexed
+ *                    by this seek head, 0 if unlimited.
+ */
+static mkv_seekhead * mkv_start_seekhead(ByteIOContext *pb, offset_t segment_offset, int numelements)
+{
+    mkv_seekhead *new_seekhead = av_mallocz(sizeof(mkv_seekhead));
+    if (new_seekhead == NULL)
+        return NULL;
+
+    new_seekhead->segment_offset = segment_offset;
+
+    if (numelements > 0) {
+        new_seekhead->filepos = url_ftell(pb);
+        // 21 bytes max for a seek entry, 10 bytes max for the SeekHead ID
+        // and size, and 3 bytes to guarantee that an EBML void element
+        // will fit afterwards
+        new_seekhead->reserved_size = numelements * MAX_SEEKENTRY_SIZE + 13;
+        new_seekhead->max_entries = numelements;
+        put_ebml_void(pb, new_seekhead->reserved_size);
+    }
+    return new_seekhead;
+}
+
+static int mkv_add_seekhead_entry(mkv_seekhead *seekhead, unsigned int elementid, uint64_t filepos)
+{
+    mkv_seekhead_entry *entries = seekhead->entries;
+
+    // don't store more elements than we reserved space for
+    if (seekhead->max_entries > 0 && seekhead->max_entries <= seekhead->num_entries)
+        return -1;
+
+    entries = av_realloc(entries, (seekhead->num_entries + 1) * sizeof(mkv_seekhead_entry));
+    if (entries == NULL)
+        return AVERROR(ENOMEM);
+
+    entries[seekhead->num_entries  ].elementid = elementid;
+    entries[seekhead->num_entries++].segmentpos = filepos - seekhead->segment_offset;
+
+    seekhead->entries = entries;
+    return 0;
+}
+
+/**
+ * Write the seek head to the file and free it. If a maximum number of
+ * elements was specified to mkv_start_seekhead(), the seek head will
+ * be written at the location reserved for it. Otherwise, it is written
+ * at the current location in the file.
+ *
+ * @return The file offset where the seekhead was written.
+ */
+static offset_t mkv_write_seekhead(ByteIOContext *pb, mkv_seekhead *seekhead)
+{
+    ebml_master metaseek, seekentry;
+    offset_t currentpos;
+    int i;
+
+    currentpos = url_ftell(pb);
+
+    if (seekhead->reserved_size > 0)
+        url_fseek(pb, seekhead->filepos, SEEK_SET);
+
+    metaseek = start_ebml_master(pb, MATROSKA_ID_SEEKHEAD, seekhead->reserved_size);
+    for (i = 0; i < seekhead->num_entries; i++) {
+        mkv_seekhead_entry *entry = &seekhead->entries[i];
+
+        seekentry = start_ebml_master(pb, MATROSKA_ID_SEEKENTRY, MAX_SEEKENTRY_SIZE);
+
+        put_ebml_id(pb, MATROSKA_ID_SEEKID);
+        put_ebml_num(pb, ebml_id_size(entry->elementid), 0);
+        put_ebml_id(pb, entry->elementid);
+
+        put_ebml_uint(pb, MATROSKA_ID_SEEKPOSITION, entry->segmentpos);
+        end_ebml_master(pb, seekentry);
+    }
+    end_ebml_master(pb, metaseek);
+
+    if (seekhead->reserved_size > 0) {
+        uint64_t remaining = seekhead->filepos + seekhead->reserved_size - url_ftell(pb);
+        put_ebml_void(pb, remaining);
+        url_fseek(pb, currentpos, SEEK_SET);
+
+        currentpos = seekhead->filepos;
+    }
+    av_free(seekhead->entries);
+    av_free(seekhead);
+
+    return currentpos;
+}
+
+static mkv_cues * mkv_start_cues(offset_t segment_offset)
+{
+    mkv_cues *cues = av_mallocz(sizeof(mkv_cues));
+    if (cues == NULL)
+        return NULL;
+
+    cues->segment_offset = segment_offset;
+    return cues;
+}
+
+static int mkv_add_cuepoint(mkv_cues *cues, AVPacket *pkt, offset_t cluster_pos)
+{
+    mkv_cuepoint *entries = cues->entries;
+
+    entries = av_realloc(entries, (cues->num_entries + 1) * sizeof(mkv_cuepoint));
+    if (entries == NULL)
+        return AVERROR(ENOMEM);
+
+    entries[cues->num_entries  ].pts = pkt->pts;
+    entries[cues->num_entries  ].tracknum = pkt->stream_index + 1;
+    entries[cues->num_entries++].cluster_pos = cluster_pos - cues->segment_offset;
+
+    cues->entries = entries;
+    return 0;
+}
+
+static offset_t mkv_write_cues(ByteIOContext *pb, mkv_cues *cues, int num_tracks)
+{
+    ebml_master cues_element;
+    offset_t currentpos;
+    int i, j;
+
+    currentpos = url_ftell(pb);
+    cues_element = start_ebml_master(pb, MATROSKA_ID_CUES, 0);
+
+    for (i = 0; i < cues->num_entries; i++) {
+        ebml_master cuepoint, track_positions;
+        mkv_cuepoint *entry = &cues->entries[i];
+        uint64_t pts = entry->pts;
+
+        cuepoint = start_ebml_master(pb, MATROSKA_ID_POINTENTRY, MAX_CUEPOINT_SIZE(num_tracks));
+        put_ebml_uint(pb, MATROSKA_ID_CUETIME, pts);
+
+        // put all the entries from different tracks that have the exact same
+        // timestamp into the same CuePoint
+        for (j = 0; j < cues->num_entries - i && entry[j].pts == pts; j++) {
+            track_positions = start_ebml_master(pb, MATROSKA_ID_CUETRACKPOSITION, MAX_CUETRACKPOS_SIZE);
+            put_ebml_uint(pb, MATROSKA_ID_CUETRACK          , entry[j].tracknum   );
+            put_ebml_uint(pb, MATROSKA_ID_CUECLUSTERPOSITION, entry[j].cluster_pos);
+            end_ebml_master(pb, track_positions);
+        }
+        i += j - 1;
+        end_ebml_master(pb, cuepoint);
+    }
+    end_ebml_master(pb, cues_element);
+
+    av_free(cues->entries);
+    av_free(cues);
+    return currentpos;
+}
+
+static int put_xiph_codecpriv(AVFormatContext *s, ByteIOContext *pb, AVCodecContext *codec)
+{
+    uint8_t *header_start[3];
+    int header_len[3];
+    int first_header_size;
+    int j;
+
+    if (codec->codec_id == CODEC_ID_VORBIS)
+        first_header_size = 30;
+    else
+        first_header_size = 42;
+
+    if (ff_split_xiph_headers(codec->extradata, codec->extradata_size,
+                              first_header_size, header_start, header_len) < 0) {
+        av_log(s, AV_LOG_ERROR, "Extradata corrupt.\n");
+        return -1;
+    }
+
+    put_byte(pb, 2);                    // number packets - 1
+    for (j = 0; j < 2; j++) {
+        put_xiph_size(pb, header_len[j]);
+    }
+    for (j = 0; j < 3; j++)
+        put_buffer(pb, header_start[j], header_len[j]);
+
+    return 0;
+}
+
+#define FLAC_STREAMINFO_SIZE 34
+
+static int put_flac_codecpriv(AVFormatContext *s, ByteIOContext *pb, AVCodecContext *codec)
+{
+    // if the extradata_size is greater than FLAC_STREAMINFO_SIZE,
+    // assume that it's in Matroska's format already
+    if (codec->extradata_size < FLAC_STREAMINFO_SIZE) {
+        av_log(s, AV_LOG_ERROR, "Invalid FLAC extradata\n");
+        return -1;
+    } else if (codec->extradata_size == FLAC_STREAMINFO_SIZE) {
+        // only the streaminfo packet
+        put_byte(pb, 0);
+        put_xiph_size(pb, codec->extradata_size);
+        av_log(s, AV_LOG_ERROR, "Only one packet\n");
+    }
+    put_buffer(pb, codec->extradata, codec->extradata_size);
+    return 0;
+}
+
+static void get_aac_sample_rates(AVFormatContext *s, AVCodecContext *codec, int *sample_rate, int *output_sample_rate)
+{
+    static const int aac_sample_rates[] = {
+        96000, 88200, 64000, 48000, 44100, 32000,
+        24000, 22050, 16000, 12000, 11025,  8000,
+    };
+    int sri;
+
+    if (codec->extradata_size < 2) {
+        av_log(s, AV_LOG_WARNING, "No AAC extradata, unable to determine samplerate.\n");
+        return;
+    }
+
+    sri = ((codec->extradata[0] << 1) & 0xE) | (codec->extradata[1] >> 7);
+    if (sri > 12) {
+        av_log(s, AV_LOG_WARNING, "AAC samplerate index out of bounds\n");
+        return;
+    }
+    *sample_rate = aac_sample_rates[sri];
+
+    // if sbr, get output sample rate as well
+    if (codec->extradata_size == 5) {
+        sri = (codec->extradata[4] >> 3) & 0xF;
+        if (sri > 12) {
+            av_log(s, AV_LOG_WARNING, "AAC output samplerate index out of bounds\n");
+            return;
+        }
+        *output_sample_rate = aac_sample_rates[sri];
+    }
+}
+
+static int mkv_write_codecprivate(AVFormatContext *s, ByteIOContext *pb, AVCodecContext *codec, int native_id)
+{
+    ByteIOContext dyn_cp;
+    uint8_t *codecpriv;
+    int ret = 0, codecpriv_size;
+
+    url_open_dyn_buf(&dyn_cp);
+
+    if (native_id) {
+        if (codec->codec_id == CODEC_ID_VORBIS || codec->codec_id == CODEC_ID_THEORA)
+            ret = put_xiph_codecpriv(s, &dyn_cp, codec);
+        else if (codec->codec_id == CODEC_ID_FLAC)
+            ret = put_flac_codecpriv(s, &dyn_cp, codec);
+        else if (codec->extradata_size)
+            put_buffer(&dyn_cp, codec->extradata, codec->extradata_size);
+    } else if (codec->codec_type == CODEC_TYPE_VIDEO) {
+        if (!codec->codec_tag)
+            codec->codec_tag = codec_get_tag(codec_bmp_tags, codec->codec_id);
+        if (!codec->codec_tag) {
+            av_log(s, AV_LOG_ERROR, "No bmp codec ID found.");
+            ret = -1;
+        }
+
+        put_bmp_header(&dyn_cp, codec, codec_bmp_tags, 0);
+
+    } else if (codec->codec_type == CODEC_TYPE_AUDIO) {
+        if (!codec->codec_tag)
+            codec->codec_tag = codec_get_tag(codec_wav_tags, codec->codec_id);
+        if (!codec->codec_tag) {
+            av_log(s, AV_LOG_ERROR, "No wav codec ID found.");
+            ret = -1;
+        }
+
+        put_wav_header(&dyn_cp, codec);
+    }
+
+    codecpriv_size = url_close_dyn_buf(&dyn_cp, &codecpriv);
+    if (codecpriv_size)
+        put_ebml_binary(pb, MATROSKA_ID_CODECPRIVATE, codecpriv, codecpriv_size);
+    av_free(codecpriv);
+    return ret;
+}
+
+static int mkv_write_tracks(AVFormatContext *s)
+{
+    MatroskaMuxContext *mkv = s->priv_data;
+    ByteIOContext *pb = &s->pb;
+    ebml_master tracks;
+    int i, j, ret;
+
+    ret = mkv_add_seekhead_entry(mkv->main_seekhead, MATROSKA_ID_TRACKS, url_ftell(pb));
+    if (ret < 0) return ret;
+
+    tracks = start_ebml_master(pb, MATROSKA_ID_TRACKS, 0);
+    for (i = 0; i < s->nb_streams; i++) {
+        AVStream *st = s->streams[i];
+        AVCodecContext *codec = st->codec;
+        ebml_master subinfo, track;
+        int native_id = 0;
+        int bit_depth = av_get_bits_per_sample(codec->codec_id);
+        int sample_rate = codec->sample_rate;
+        int output_sample_rate = 0;
+
+        if (!bit_depth)
+            bit_depth = av_get_bits_per_sample_format(codec->sample_fmt);
+
+        if (codec->codec_id == CODEC_ID_AAC)
+            get_aac_sample_rates(s, codec, &sample_rate, &output_sample_rate);
+
+        track = start_ebml_master(pb, MATROSKA_ID_TRACKENTRY, 0);
+        put_ebml_uint (pb, MATROSKA_ID_TRACKNUMBER     , i + 1);
+        put_ebml_uint (pb, MATROSKA_ID_TRACKUID        , i + 1);
+        put_ebml_uint (pb, MATROSKA_ID_TRACKFLAGLACING , 0);    // no lacing (yet)
+
+        if (st->language[0])
+            put_ebml_string(pb, MATROSKA_ID_TRACKLANGUAGE, st->language);
+        else
+            put_ebml_string(pb, MATROSKA_ID_TRACKLANGUAGE, "und");
+
+        // look for a codec ID string specific to mkv to use,
+        // if none are found, use AVI codes
+        for (j = 0; ff_mkv_codec_tags[j].id != CODEC_ID_NONE; j++) {
+            if (ff_mkv_codec_tags[j].id == codec->codec_id) {
+                put_ebml_string(pb, MATROSKA_ID_CODECID, ff_mkv_codec_tags[j].str);
+                native_id = 1;
+                break;
+            }
+        }
+
+        switch (codec->codec_type) {
+            case CODEC_TYPE_VIDEO:
+                put_ebml_uint(pb, MATROSKA_ID_TRACKTYPE, MATROSKA_TRACK_TYPE_VIDEO);
+
+                if (!native_id)
+                    // if there is no mkv-specific codec ID, use VFW mode
+                    put_ebml_string(pb, MATROSKA_ID_CODECID, MATROSKA_CODEC_ID_VIDEO_VFW_FOURCC);
+
+                subinfo = start_ebml_master(pb, MATROSKA_ID_TRACKVIDEO, 0);
+                // XXX: interlace flag?
+                put_ebml_uint (pb, MATROSKA_ID_VIDEOPIXELWIDTH , codec->width);
+                put_ebml_uint (pb, MATROSKA_ID_VIDEOPIXELHEIGHT, codec->height);
+                if (codec->sample_aspect_ratio.num) {
+                    AVRational dar = av_mul_q(codec->sample_aspect_ratio,
+                                    (AVRational){codec->width, codec->height});
+                    put_ebml_uint(pb, MATROSKA_ID_VIDEODISPLAYWIDTH , dar.num);
+                    put_ebml_uint(pb, MATROSKA_ID_VIDEODISPLAYHEIGHT, dar.den);
+                }
+                end_ebml_master(pb, subinfo);
+                break;
+
+            case CODEC_TYPE_AUDIO:
+                put_ebml_uint(pb, MATROSKA_ID_TRACKTYPE, MATROSKA_TRACK_TYPE_AUDIO);
+
+                if (!native_id)
+                    // no mkv-specific ID, use ACM mode
+                    put_ebml_string(pb, MATROSKA_ID_CODECID, MATROSKA_CODEC_ID_AUDIO_ACM);
+
+                subinfo = start_ebml_master(pb, MATROSKA_ID_TRACKAUDIO, 0);
+                put_ebml_uint  (pb, MATROSKA_ID_AUDIOCHANNELS    , codec->channels);
+                put_ebml_float (pb, MATROSKA_ID_AUDIOSAMPLINGFREQ, sample_rate);
+                if (output_sample_rate)
+                    put_ebml_float(pb, MATROSKA_ID_AUDIOOUTSAMPLINGFREQ, output_sample_rate);
+                if (bit_depth)
+                    put_ebml_uint(pb, MATROSKA_ID_AUDIOBITDEPTH, bit_depth);
+                end_ebml_master(pb, subinfo);
+                break;
+
+            case CODEC_TYPE_SUBTITLE:
+                put_ebml_uint(pb, MATROSKA_ID_TRACKTYPE, MATROSKA_TRACK_TYPE_SUBTITLE);
+                break;
+            default:
+                av_log(s, AV_LOG_ERROR, "Only audio, video, and subtitles are supported for Matroska.");
+                break;
+        }
+        ret = mkv_write_codecprivate(s, pb, codec, native_id);
+        if (ret < 0) return ret;
+
+        end_ebml_master(pb, track);
+
+        // ms precision is the de-facto standard timescale for mkv files
+        av_set_pts_info(st, 64, 1, 1000);
+    }
+    end_ebml_master(pb, tracks);
+    return 0;
+}
+
+static int mkv_write_header(AVFormatContext *s)
+{
+    MatroskaMuxContext *mkv = s->priv_data;
+    ByteIOContext *pb = &s->pb;
+    ebml_master ebml_header, segment_info;
+    int ret;
+
+    mkv->md5_ctx = av_mallocz(av_md5_size);
+    av_md5_init(mkv->md5_ctx);
+
+    ebml_header = start_ebml_master(pb, EBML_ID_HEADER, 0);
+    put_ebml_uint   (pb, EBML_ID_EBMLVERSION        ,           1);
+    put_ebml_uint   (pb, EBML_ID_EBMLREADVERSION    ,           1);
+    put_ebml_uint   (pb, EBML_ID_EBMLMAXIDLENGTH    ,           4);
+    put_ebml_uint   (pb, EBML_ID_EBMLMAXSIZELENGTH  ,           8);
+    put_ebml_string (pb, EBML_ID_DOCTYPE            ,  "matroska");
+    put_ebml_uint   (pb, EBML_ID_DOCTYPEVERSION     ,           2);
+    put_ebml_uint   (pb, EBML_ID_DOCTYPEREADVERSION ,           2);
+    end_ebml_master(pb, ebml_header);
+
+    mkv->segment = start_ebml_master(pb, MATROSKA_ID_SEGMENT, 0);
+    mkv->segment_offset = url_ftell(pb);
+
+    // we write 2 seek heads - one at the end of the file to point to each
+    // cluster, and one at the beginning to point to all other level one
+    // elements (including the seek head at the end of the file), which
+    // isn't more than 10 elements if we only write one of each other
+    // currently defined level 1 element
+    mkv->main_seekhead    = mkv_start_seekhead(pb, mkv->segment_offset, 10);
+    mkv->cluster_seekhead = mkv_start_seekhead(pb, mkv->segment_offset, 0);
+    if (mkv->main_seekhead == NULL || mkv->cluster_seekhead == NULL)
+        return AVERROR(ENOMEM);
+
+    ret = mkv_add_seekhead_entry(mkv->main_seekhead, MATROSKA_ID_INFO, url_ftell(pb));
+    if (ret < 0) return ret;
+
+    segment_info = start_ebml_master(pb, MATROSKA_ID_INFO, 0);
+    put_ebml_uint(pb, MATROSKA_ID_TIMECODESCALE, 1000000);
+    if (strlen(s->title))
+        put_ebml_string(pb, MATROSKA_ID_TITLE, s->title);
+    if (!(s->streams[0]->codec->flags & CODEC_FLAG_BITEXACT)) {
+        put_ebml_string(pb, MATROSKA_ID_MUXINGAPP , LIBAVFORMAT_IDENT);
+        put_ebml_string(pb, MATROSKA_ID_WRITINGAPP, LIBAVFORMAT_IDENT);
+
+        // reserve space to write the segment UID later
+        mkv->segment_uid = url_ftell(pb);
+        put_ebml_void(pb, 19);
+    }
+
+    // reserve space for the duration
+    mkv->duration = 0;
+    mkv->duration_offset = url_ftell(pb);
+    put_ebml_void(pb, 11);                  // assumes double-precision float to be written
+    end_ebml_master(pb, segment_info);
+
+    ret = mkv_write_tracks(s);
+    if (ret < 0) return ret;
+
+    ret = mkv_add_seekhead_entry(mkv->cluster_seekhead, MATROSKA_ID_CLUSTER, url_ftell(pb));
+    if (ret < 0) return ret;
+
+    mkv->cluster_pos = url_ftell(pb);
+    mkv->cluster = start_ebml_master(pb, MATROSKA_ID_CLUSTER, 0);
+    put_ebml_uint(pb, MATROSKA_ID_CLUSTERTIMECODE, 0);
+    mkv->cluster_pts = 0;
+
+    mkv->cues = mkv_start_cues(mkv->segment_offset);
+    if (mkv->cues == NULL)
+        return AVERROR(ENOMEM);
+
+    return 0;
+}
+
+static int mkv_block_size(AVPacket *pkt)
+{
+    int size = 4;           // track num + timecode + flags
+    return size + pkt->size;
+}
+
+static int mkv_blockgroup_size(AVPacket *pkt)
+{
+    int size = mkv_block_size(pkt);
+    size += ebml_num_size(size);
+    size += 2;              // EBML ID for block and block duration
+    size += 8;              // max size of block duration
+    size += ebml_num_size(size);
+    size += 1;              // blockgroup EBML ID
+    return size;
+}
+
+static void mkv_write_block(AVFormatContext *s, unsigned int blockid, AVPacket *pkt, int flags)
+{
+    MatroskaMuxContext *mkv = s->priv_data;
+    ByteIOContext *pb = &s->pb;
+
+    av_log(s, AV_LOG_DEBUG, "Writing block at offset %" PRIu64 ", size %d, "
+           "pts %" PRId64 ", dts %" PRId64 ", duration %d, flags %d\n",
+           url_ftell(pb), pkt->size, pkt->pts, pkt->dts, pkt->duration, flags);
+    put_ebml_id(pb, blockid);
+    put_ebml_num(pb, mkv_block_size(pkt), 0);
+    put_byte(pb, 0x80 | (pkt->stream_index + 1));     // this assumes stream_index is less than 126
+    put_be16(pb, pkt->pts - mkv->cluster_pts);
+    put_byte(pb, flags);
+    put_buffer(pb, pkt->data, pkt->size);
+}
+
+static int mkv_write_packet(AVFormatContext *s, AVPacket *pkt)
+{
+    MatroskaMuxContext *mkv = s->priv_data;
+    ByteIOContext *pb = &s->pb;
+    AVCodecContext *codec = s->streams[pkt->stream_index]->codec;
+    int keyframe = !!(pkt->flags & PKT_FLAG_KEY);
+    int ret;
+
+    // start a new cluster every 5 MB or 5 sec
+    if (url_ftell(pb) > mkv->cluster_pos + 5*1024*1024 || pkt->pts > mkv->cluster_pts + 5000) {
+        av_log(s, AV_LOG_DEBUG, "Starting new cluster at offset %" PRIu64
+               " bytes, pts %" PRIu64 "\n", url_ftell(pb), pkt->pts);
+        end_ebml_master(pb, mkv->cluster);
+
+        ret = mkv_add_seekhead_entry(mkv->cluster_seekhead, MATROSKA_ID_CLUSTER, url_ftell(pb));
+        if (ret < 0) return ret;
+
+        mkv->cluster_pos = url_ftell(pb);
+        mkv->cluster = start_ebml_master(pb, MATROSKA_ID_CLUSTER, 0);
+        put_ebml_uint(pb, MATROSKA_ID_CLUSTERTIMECODE, pkt->pts);
+        mkv->cluster_pts = pkt->pts;
+        av_md5_update(mkv->md5_ctx, pkt->data, FFMIN(200, pkt->size));
+    }
+
+    if (codec->codec_type != CODEC_TYPE_SUBTITLE) {
+        mkv_write_block(s, MATROSKA_ID_SIMPLEBLOCK, pkt, keyframe << 7);
+    } else {
+        ebml_master blockgroup = start_ebml_master(pb, MATROSKA_ID_BLOCKGROUP, mkv_blockgroup_size(pkt));
+        mkv_write_block(s, MATROSKA_ID_BLOCK, pkt, 0);
+        put_ebml_uint(pb, MATROSKA_ID_DURATION, pkt->duration);
+        end_ebml_master(pb, blockgroup);
+    }
+
+    if (codec->codec_type == CODEC_TYPE_VIDEO && keyframe) {
+        ret = mkv_add_cuepoint(mkv->cues, pkt, mkv->cluster_pos);
+        if (ret < 0) return ret;
+    }
+
+    mkv->duration = FFMAX(mkv->duration, pkt->pts + pkt->duration);
+    return 0;
+}
+
+static int mkv_write_trailer(AVFormatContext *s)
+{
+    MatroskaMuxContext *mkv = s->priv_data;
+    ByteIOContext *pb = &s->pb;
+    offset_t currentpos, second_seekhead, cuespos;
+    int ret;
+
+    end_ebml_master(pb, mkv->cluster);
+
+    if (!url_is_streamed(pb)) {
+        cuespos = mkv_write_cues(pb, mkv->cues, s->nb_streams);
+        second_seekhead = mkv_write_seekhead(pb, mkv->cluster_seekhead);
+
+        ret = mkv_add_seekhead_entry(mkv->main_seekhead, MATROSKA_ID_CUES    , cuespos);
+        if (ret < 0) return ret;
+        ret = mkv_add_seekhead_entry(mkv->main_seekhead, MATROSKA_ID_SEEKHEAD, second_seekhead);
+        if (ret < 0) return ret;
+        mkv_write_seekhead(pb, mkv->main_seekhead);
+
+        // update the duration
+        av_log(s, AV_LOG_DEBUG, "end duration = %" PRIu64 "\n", mkv->duration);
+        currentpos = url_ftell(pb);
+        url_fseek(pb, mkv->duration_offset, SEEK_SET);
+        put_ebml_float(pb, MATROSKA_ID_DURATION, mkv->duration);
+
+        // write the md5sum of some frames as the segment UID
+        if (!(s->streams[0]->codec->flags & CODEC_FLAG_BITEXACT)) {
+            uint8_t segment_uid[16];
+            av_md5_final(mkv->md5_ctx, segment_uid);
+            url_fseek(pb, mkv->segment_uid, SEEK_SET);
+            put_ebml_binary(pb, MATROSKA_ID_SEGMENTUID, segment_uid, 16);
+        }
+        url_fseek(pb, currentpos, SEEK_SET);
+    }
+
+    end_ebml_master(pb, mkv->segment);
+    av_free(mkv->md5_ctx);
+    return 0;
+}
+
+AVOutputFormat matroska_muxer = {
+    "matroska",
+    "Matroska File Format",
+    "video/x-matroska",
+    "mkv",
+    sizeof(MatroskaMuxContext),
+    CODEC_ID_MP2,
+    CODEC_ID_MPEG4,
+    mkv_write_header,
+    mkv_write_packet,
+    mkv_write_trailer,
+    .codec_tag = (const AVCodecTag*[]){codec_bmp_tags, codec_wav_tags, 0},
+    // MEANX .subtitle_codec = CODEC_ID_TEXT,
+};
+
+AVOutputFormat matroska_audio_muxer = {
+    "matroska",
+    "Matroska File Format",
+    "audio/x-matroska",
+    "mka",
+    sizeof(MatroskaMuxContext),
+    CODEC_ID_MP2,
+    CODEC_ID_NONE,
+    mkv_write_header,
+    mkv_write_packet,
+    mkv_write_trailer,
+    .codec_tag = (const AVCodecTag*[]){codec_wav_tags, 0},
+};
+// MEANX
+//
+int matroskaenc_init(void)
+{
+    av_register_output_format(&matroska_muxer);
+    return 0;
+}
+

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/crc.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/crc.h	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/crc.h	2007-09-08 10:54:35 UTC (rev 3582)
@@ -26,6 +26,13 @@
 
 typedef uint32_t AVCRC;
 
+#define AV_CRC_8_ATM      0x07
+#define AV_CRC_16         0x8005
+#define AV_CRC_16_CCITT   0x1021
+#define AV_CRC_32_IEEE    0x04C11DB7L
+//! reversed bitorder version of AV_CRC_32_IEEE
+#define AV_CRC_32_IEEE_LE 0xEDB88320L
+
 #if LIBAVUTIL_VERSION_INT  < (50<<16)
 extern AVCRC *av_crcEDB88320;
 extern AVCRC *av_crc04C11DB7;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp	2007-09-08 10:54:35 UTC (rev 3582)
@@ -125,10 +125,14 @@
 uint32_t    totalAudioSize=0;
 uint32_t sent=0;
 
-           if(type==ADM_PSP)
-               muxerType=MUXER_PSP;
-           else
-               muxerType=MUXER_MP4;
+           switch(type)
+           {
+             case ADM_PSP:muxerType=MUXER_PSP;break;
+             case ADM_MP4:muxerType=MUXER_MP4;break;
+             case ADM_MATROSKA:muxerType=MUXER_MATROSKA;break;
+             default:
+                ADM_assert(0);
+           }
         // Setup video
         
         if(videoProcessMode())

Modified: branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_container.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_container.h	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_container.h	2007-09-08 10:54:35 UTC (rev 3582)
@@ -28,7 +28,8 @@
   MK_CONT(MP4),
   MK_CONT(PSP),
   MK_CONT(FLV),
-  MK_CONT(DUMMY)  
+  MK_CONT(DUMMY),
+  MK_CONT(MATROSKA)  
 };
 #define NB_CONT (sizeof(container)/sizeof(ADM_CONTAINER))
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_genvideo.hxx
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_genvideo.hxx	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_genvideo.hxx	2007-09-08 10:54:35 UTC (rev 3582)
@@ -150,7 +150,7 @@
 #define CREATOR(x,clss)  return new clss(in,x);
 #define BUILD_CREATE(name,clss) AVDMGenericVideoStream *name(AVDMGenericVideoStream *in, CONFcouple *conf) \
 {		CREATOR(conf,clss); }
-
+#define VARIABLE_PARAMS 0xff
 #define SCRIPT_CREATE(name,clss,tmplate) \
 AVDMGenericVideoStream *name (AVDMGenericVideoStream *in, int n,Arg *args); \
 AVDMGenericVideoStream *name (AVDMGenericVideoStream *in, int n,Arg *args) \

Modified: branches/avidemux_2.4_branch/avidemux/gui_savenew.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gui_savenew.cpp	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/avidemux/gui_savenew.cpp	2007-09-08 10:54:35 UTC (rev 3582)
@@ -180,6 +180,7 @@
                             			break;
                         case ADM_MP4:
                         case ADM_PSP:
+                        case ADM_MATROSKA:
                         
                                                     ret=oplug_mp4(name,UI_GetCurrentFormat());
                                                     break;

Modified: branches/avidemux_2.4_branch/config.h.cmake
===================================================================
--- branches/avidemux_2.4_branch/config.h.cmake	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/config.h.cmake	2007-09-08 10:54:35 UTC (rev 3582)
@@ -77,6 +77,7 @@
 #cmakedefine CONFIG_MJPEG_DECODER
 #cmakedefine CONFIG_MJPEG_ENCODER
 #cmakedefine CONFIG_MOV_MUXER
+#cmakedefine CONFIG_MATROSKA_MUXER
 #cmakedefine CONFIG_MP2_ENCODER
 #cmakedefine CONFIG_MP4_MUXER
 #cmakedefine CONFIG_MPEG1VIDEO_DECODER

Modified: branches/avidemux_2.4_branch/configure.in.in
===================================================================
--- branches/avidemux_2.4_branch/configure.in.in	2007-09-08 10:53:53 UTC (rev 3581)
+++ branches/avidemux_2.4_branch/configure.in.in	2007-09-08 10:54:35 UTC (rev 3582)
@@ -1414,6 +1414,7 @@
 AC_DEFINE(CONFIG_PSP_MUXER,1,[CONFIG_MUXERS])
 AC_DEFINE(CONFIG_MP4_MUXER,1,[CONFIG_MUXERS])
 AC_DEFINE(CONFIG_MOV_MUXER,1,[CONFIG_MUXERS])
+AC_DEFINE(CONFIG_MATROSKA_MUXER,1,[CONFIG_MATROSKA_MUXERS])
 AC_DEFINE(HAVE_THREADS,1,[HAVE_THREADS])
 AC_DEFINE(ENABLE_THREADS,1,[ENABLE_THREADS])
 



From mean at mail.berlios.de  Sat Sep  8 15:19:17 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 8 Sep 2007 15:19:17 +0200
Subject: [Avidemux-svn-commit] r3583 - in
	branches/avidemux_2.4_branch/avidemux: ADM_editor
	ADM_inputs/ADM_matroska
Message-ID: <200709081319.l88DJHit000662@sheep.berlios.de>

Author: mean
Date: 2007-09-08 15:19:16 +0200 (Sat, 08 Sep 2007)
New Revision: 3583

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edIdentify.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp
Log:
[Mkv] Read the mkv generated by lavformat

Modified: branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edIdentify.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edIdentify.cpp	2007-09-08 10:54:35 UTC (rev 3582)
+++ branches/avidemux_2.4_branch/avidemux/ADM_editor/ADM_edIdentify.cpp	2007-09-08 13:19:16 UTC (rev 3583)
@@ -251,8 +251,7 @@
       		return 1;
 
     }
-    if(fourCC::check(R32(magic[2]),(uint8_t *)"matr") &&
-       fourCC::check(R32(magic[3]),(uint8_t *)"oska") )
+    if(magic[0]==R32(0xA3DF451A)) //x1a45DFA3 ))
     {
       printf (" \n Matroska file detected..\n");
       *type = Matroska_FileType;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp	2007-09-08 10:54:35 UTC (rev 3582)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp	2007-09-08 13:19:16 UTC (rev 3583)
@@ -52,8 +52,7 @@
   // Video
   {"V_MPEG4/ISO/AVC",1,0,"AVC1"}, //H264
   {"V_MS/VFW/FOURCC",1,0,"VFWX"}, // Divx 2.
-  
-  
+  {"V_MPEG4/ISO/ASP",1,0,"DIVX"},
   // Filler
   {"AVIDEMUX_RULES",1,0,"DIV2"} // DUMMY
 };



From mean at mail.berlios.de  Sat Sep  8 15:35:54 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 8 Sep 2007 15:35:54 +0200
Subject: [Avidemux-svn-commit] r3584 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat
Message-ID: <200709081335.l88DZsT5001419@sheep.berlios.de>

Author: mean
Date: 2007-09-08 15:35:54 +0200 (Sat, 08 Sep 2007)
New Revision: 3584

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp
Log:
[MKV out] Set proper fps, still incomplete

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp	2007-09-08 13:19:16 UTC (rev 3583)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp	2007-09-08 13:35:54 UTC (rev 3584)
@@ -340,7 +340,7 @@
 			c->frame_rate_base = 1001;	
 			break;
 */
-                        if(_type==MUXER_MP4 || _type==MUXER_PSP || _type==MUXER_FLV)
+                        if(_type==MUXER_MP4 || _type==MUXER_PSP || _type==MUXER_FLV || _type==MUXER_MATROSKA)
                         {
                                  c->time_base= fps24; //(AVRational){1001,24000};
                                 break;



From mean at mail.berlios.de  Sat Sep  8 15:39:13 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 8 Sep 2007 15:39:13 +0200
Subject: [Avidemux-svn-commit] r3585 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec
Message-ID: <200709081339.l88DdDwJ001575@sheep.berlios.de>

Author: mean
Date: 2007-09-08 15:39:12 +0200 (Sat, 08 Sep 2007)
New Revision: 3585

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/huffyuv.c
Log:
[Codec] Allow non standard YV12-HuffYUV

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/huffyuv.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/huffyuv.c	2007-09-08 13:35:54 UTC (rev 3584)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/huffyuv.c	2007-09-08 13:39:12 UTC (rev 3585)
@@ -639,10 +639,12 @@
     }else s->context= 0;
 
     if(avctx->codec->id==CODEC_ID_HUFFYUV){
+#if 0 // MEANX     
         if(avctx->pix_fmt==PIX_FMT_YUV420P){
             av_log(avctx, AV_LOG_ERROR, "Error: YV12 is not supported by huffyuv; use vcodec=ffvhuff or format=422p\n");
             return -1;
         }
+#endif
         if(avctx->context_model){
             av_log(avctx, AV_LOG_ERROR, "Error: per-frame huffman tables are not supported by huffyuv; use vcodec=ffvhuff\n");
             return -1;



From mean at mail.berlios.de  Sun Sep  9 17:06:41 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 9 Sep 2007 17:06:41 +0200
Subject: [Avidemux-svn-commit] r3586 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska
Message-ID: <200709091506.l89F6fJr028656@sheep.berlios.de>

Author: mean
Date: 2007-09-09 17:06:41 +0200 (Sun, 09 Sep 2007)
New Revision: 3586

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h
Log:
[Matroska Read] Fix display width/height tag, identify alternate tag for div3

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp	2007-09-08 13:39:12 UTC (rev 3585)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp	2007-09-09 15:06:41 UTC (rev 3586)
@@ -50,6 +50,7 @@
   {"A_VORBIS",0,WAV_OGG,""},
   
   // Video
+  {"V_MPEG4/MS/V3",1,0,"DIV3"}, // MS MPEG4 (Divx3)
   {"V_MPEG4/ISO/AVC",1,0,"AVC1"}, //H264
   {"V_MS/VFW/FOURCC",1,0,"VFWX"}, // Divx 2.
   {"V_MPEG4/ISO/ASP",1,0,"DIVX"},

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h	2007-09-08 13:39:12 UTC (rev 3585)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h	2007-09-09 15:06:41 UTC (rev 3586)
@@ -119,10 +119,11 @@
    MKTAG(MKV_CODEC_DECODE_ALL,0xAA,ADM_MKV_TYPE_UINTEGER),
    MKTAG(MKV_LANGUAGE,0x22B59C,ADM_MKV_TYPE_STRING),
    
-   MKTAG(MKV_DISPLAY_WIDTH,0x55B0,ADM_MKV_TYPE_UINTEGER),
-   MKTAG(MKV_DISPLAY_HEIGHT,0x55BA,ADM_MKV_TYPE_UINTEGER),
+   MKTAG(MKV_DISPLAY_WIDTH,0x54B0,ADM_MKV_TYPE_UINTEGER),
+   MKTAG(MKV_DISPLAY_HEIGHT,0x54BA,ADM_MKV_TYPE_UINTEGER),
    MKTAG(MKV_FLAG_INTERLACED,0x9A,ADM_MKV_TYPE_UINTEGER),
    
+   
          //*************************
    MKTAG(MKV_MAX,0xFFFF,ADM_MKV_TYPE_UNKNOWN)    
        



From mean at mail.berlios.de  Sun Sep  9 17:07:23 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 9 Sep 2007 17:07:23 +0200
Subject: [Avidemux-svn-commit] r3587 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat
Message-ID: <200709091507.l89F7Ncf028768@sheep.berlios.de>

Author: mean
Date: 2007-09-09 17:07:22 +0200 (Sun, 09 Sep 2007)
New Revision: 3587

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/matroskaenc.c
Log:
[Matroska write] Patch lavformat to add defaultduration atom, very useful for fixed rate video

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp	2007-09-09 15:06:41 UTC (rev 3586)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp	2007-09-09 15:07:22 UTC (rev 3587)
@@ -61,6 +61,8 @@
 static uint32_t one;
 uint64_t  _curDTS;
 
+static uint8_t ADM_4cc_to_lavcodec(const char *fcc, CodecID *outlavid);
+static uint8_t ADM_WaveTag_to_lavcodec(uint32_t tag, CodecID *outlavid);
 // convert in in us to out in 90Khz tick
 int64_t adm_90k( double in)
 {
@@ -203,6 +205,15 @@
                                         memset(c->codec,0,sizeof(AVCodec));
                                         c->codec->name=ADM_strdup("H264");
                                 }
+                                else
+                                {
+                                   if(!ADM_4cc_to_lavcodec((const char *)&(info->fcc),&(c->codec_id)))
+                                   {
+                                      printf("[lavFormat] Cannot map  this\n");
+                                      return 0;
+                                   }
+                                  
+                                }
                         }
                         if(videoExtraDataSize)
                         {
@@ -359,7 +370,7 @@
                             }
                             else
                             {
-                              GUI_Error_HIG(_("Incompatible frame rate"), NULL);
+                                GUI_Error_HIG(_("Incompatible frame rate"), NULL);
                                 return 0;
                             }
                             }
@@ -414,6 +425,12 @@
                                   c->codec_id = CODEC_ID_AAC;
                                   break;
                   default:
+                          if(_type==MUXER_MATROSKA)
+                          {
+                           if(ADM_WaveTag_to_lavcodec(audioheader->encoding, &(c->codec_id)))
+                             break;
+                          }
+                            
                           printf("Cant mux that ! audio\n"); 
                           printf("Cant mux that ! audio\n");
                           c->codec_id = CODEC_ID_MP2;
@@ -701,6 +718,77 @@
   return v;
 } 
 }
+
+typedef struct
+{
+  const char *name;
+  int    id;
+}lavFCC_t;
+
+lavFCC_t lavFCC[]=
+{
+  {"DIV3",CODEC_ID_MSMPEG4V3},
+  {"FLV1",CODEC_ID_FLV1},
+  {"MPEG",CODEC_ID_MPEG2VIDEO},
+  {"DUMMY",0Xffff}
+};
+/**
+    \fn ADM_4cc_to_lavcodec
+    \brief Convert avi fourcc to lavcodec id (video)
+
+*/
+uint8_t ADM_4cc_to_lavcodec(const char *fcc, CodecID *outlavid)
+{
+    uint32_t nb=sizeof( lavFCC)/sizeof(lavFCC_t);
+    nb--;
+    for(int i=0;i<nb;i++)
+    {
+      if(!strncmp(lavFCC[i].name,fcc,4))
+      {
+        *outlavid=(CodecID)lavFCC[i].id;
+        return 1; 
+      }
+      
+    }
+    return 0;
+  
+}
+//*****************
+typedef struct
+{
+  uint32_t tag;
+  int    id;
+}lavWaveTag_t;
+
+lavWaveTag_t lavWaveTag[]=
+{
+  {WAV_AC3,CODEC_ID_AC3},
+  {WAV_OGG,CODEC_ID_VORBIS},
+  {WAV_AAC,CODEC_ID_AAC},
+  {0xdead,0Xffff} // DUMMY
+};
+/**
+    \fn ADM_WaveTag_to_lavcodec
+    \brief Convert ADM audio codec id to lavcodec id (video)
+
+*/
+uint8_t ADM_WaveTag_to_lavcodec(uint32_t tag, CodecID *outlavid)
+{
+    uint32_t nb=sizeof( lavWaveTag)/sizeof(lavWaveTag_t);
+    nb--;
+    for(int i=0;i<nb;i++)
+    {
+      if(lavWaveTag[i].tag==tag)
+      {
+        *outlavid=(CodecID)lavFCC[i].id;
+        return 1; 
+      }
+      
+    }
+    return 0;
+  
+}
+
 //___________________________________________________________________________
 //EOF
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/matroskaenc.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/matroskaenc.c	2007-09-09 15:06:41 UTC (rev 3586)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/matroskaenc.c	2007-09-09 15:07:22 UTC (rev 3587)
@@ -537,7 +537,23 @@
         put_ebml_uint (pb, MATROSKA_ID_TRACKNUMBER     , i + 1);
         put_ebml_uint (pb, MATROSKA_ID_TRACKUID        , i + 1);
         put_ebml_uint (pb, MATROSKA_ID_TRACKFLAGLACING , 0);    // no lacing (yet)
-
+/**  MEANX : Add a default duration for video **/
+        if(codec->codec_type==CODEC_TYPE_VIDEO)
+        {
+          if(codec->time_base.den && codec->time_base.num)
+          {
+            int num=codec->time_base.num;
+            int den=codec->time_base.den;
+            unsigned int default_duration;
+            float period=num;
+                  period/=den;
+                  period*=1000*1000*1000; // in ns
+                  default_duration=(unsigned int)floor(period);
+                  put_ebml_uint (pb, MATROSKA_ID_TRACKDEFAULTDURATION ,default_duration);
+          }
+        }
+        
+/**  MEANX : Add a default duration for video **/
         if (st->language[0])
             put_ebml_string(pb, MATROSKA_ID_TRACKLANGUAGE, st->language);
         else



From mean at mail.berlios.de  Wed Sep 12 20:00:23 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 12 Sep 2007 20:00:23 +0200
Subject: [Avidemux-svn-commit] r3588 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer
Message-ID: <200709121800.l8CI0N13014081@sheep.berlios.de>

Author: mean
Date: 2007-09-12 20:00:23 +0200 (Wed, 12 Sep 2007)
New Revision: 3588

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probeTS.cpp
Log:
[TS read] Dont put stuff in debug only part. Fix could_not_open.ts

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probeTS.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probeTS.cpp	2007-09-09 15:07:22 UTC (rev 3587)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probeTS.cpp	2007-09-12 18:00:23 UTC (rev 3588)
@@ -51,6 +51,8 @@
 #define MIN_DETECT (10*1024) // Need this to say the stream is present
 #define MAX_NB_PMT 50
 
+//#define PROBE_TS_VERBOSE
+
 //****************************************************************************************
 typedef struct MPEG_PMT
 {
@@ -541,7 +543,7 @@
   
   fileParser *parser;
   uint32_t curSection,maxSection;
-  uint32_t left,toScan,programInfo;
+  uint32_t left=0,toScan,programInfo=0;
   
       printf("Searching for PMT, pid=0x%x\n",pmtId);
       demuxer->changePid(pmtId,pmtId); // change pid as setPos will seek for them
@@ -549,7 +551,9 @@
       parser=demuxer->getParser();
       if(dmx_searchAndSkipHeader(pmtId,demuxer,&curSection, &maxSection,&left,&toScan))
       {
-               aprintf("[PMT]PCR for it    :x%x\n",parser->read16i()&0x1FFF);
+          uint16_t alpha;
+               alpha=parser->read16i();
+               aprintf("[PMT]PCR for it    :x%x\n",alpha&0x1FFF);
                programInfo=parser->read16i() & 0x0FFF;
                aprintf("[PMT]Program Info  :%d\n",programInfo);
                if( (programInfo+2 > left) || (programInfo+2>toScan))



From mean at mail.berlios.de  Tue Sep 18 20:20:42 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Tue, 18 Sep 2007 20:20:42 +0200
Subject: [Avidemux-svn-commit] r3589 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat
Message-ID: <200709181820.l8IIKgZ5016510@sheep.berlios.de>

Author: mean
Date: 2007-09-18 20:20:41 +0200 (Tue, 18 Sep 2007)
New Revision: 3589

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp
Log:
[MKV output] Use correct table for mkv tag + set a dummy time increment for audio

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp	2007-09-12 18:00:23 UTC (rev 3588)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp	2007-09-18 18:20:41 UTC (rev 3589)
@@ -428,7 +428,16 @@
                           if(_type==MUXER_MATROSKA)
                           {
                            if(ADM_WaveTag_to_lavcodec(audioheader->encoding, &(c->codec_id)))
+                           {
+                             if(audioextraData)
+                             {
+                                  c->extradata=audioextraData;
+                                  c->extradata_size= audioextraSize;
+                             }
+                             // Put a dummy time increment
+                              c->time_base= fps25;
                              break;
+                           }
                           }
                             
                           printf("Cant mux that ! audio\n"); 
@@ -780,7 +789,7 @@
     {
       if(lavWaveTag[i].tag==tag)
       {
-        *outlavid=(CodecID)lavFCC[i].id;
+        *outlavid=(CodecID)lavWaveTag[i].id;
         return 1; 
       }
       



From mean at mail.berlios.de  Wed Sep 19 19:45:23 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 19 Sep 2007 19:45:23 +0200
Subject: [Avidemux-svn-commit] r3590 - branches/avidemux_2.4_branch/po
Message-ID: <200709191745.l8JHjN09029541@sheep.berlios.de>

Author: mean
Date: 2007-09-19 19:45:21 +0200 (Wed, 19 Sep 2007)
New Revision: 3590

Modified:
   branches/avidemux_2.4_branch/po/it.po
Log:
[i18n] Translation update by zoppo

Modified: branches/avidemux_2.4_branch/po/it.po
===================================================================
--- branches/avidemux_2.4_branch/po/it.po	2007-09-18 18:20:41 UTC (rev 3589)
+++ branches/avidemux_2.4_branch/po/it.po	2007-09-19 17:45:21 UTC (rev 3590)
@@ -1,13 +1,9 @@
-# translation of klingon.po to 
-# This file is distributed under the same license as the PACKAGE package.
-# Copyright (C) YEAR THE PACKAGE'S COPYRIGHT HOLDER, 2003
-#
 msgid ""
 msgstr ""
 "Project-Id-Version: avidemux\n"
 "Report-Msgid-Bugs-To: \n"
 "POT-Creation-Date: 2006-10-04 22:09+0300\n"
-"PO-Revision-Date: 2007-07-21 12:17+0100\n"
+"PO-Revision-Date: 2007-09-16 12:56+0100\n"
 "Last-Translator: \n"
 "Language-Team: it\n"
 "MIME-Version: 1.0\n"
@@ -15,8 +11,8 @@
 "Content-Transfer-Encoding: 8bit\n"
 "X-Generator: KBabel 1.0.1\n"
 
-#: avidemux/ADM_audio/audiotimeline.cpp:83
-#: avidemux/ADM_audio/audiotimeline.cpp:94
+#: avidemux/ADM_audio/audiotimeline.cpp:85
+#: avidemux/ADM_audio/audiotimeline.cpp:96
 msgid "Building VBR map"
 msgstr "Creazione mappa VBR"
 
@@ -43,7 +39,7 @@
 
 #: avidemux/ADM_audiofilter/audioencoder_lame.cpp:215
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp:104
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:236
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:284
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:110
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:101
 #, c-format
@@ -83,27 +79,27 @@
 msgstr "Modalit? bit_rate:"
 
 #: avidemux/ADM_audiofilter/audioencoder_lame.cpp:241
-#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:285
+#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:288
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioconfig.cpp:59
 msgid "_Bitrate:"
 msgstr "_Bitrate:"
 
 #: avidemux/ADM_audiofilter/audioencoder_lame.cpp:246
-#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:287
+#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:290
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_mjpeg.cpp:40
 #: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:204
 msgid "_Quality:"
 msgstr "_Qualit?:"
 
-#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:268
+#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:271
 msgid "VBR"
 msgstr "VBR"
 
-#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:269
+#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:272
 msgid "Quality based"
 msgstr "Basato sulla qualit?"
 
-#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:271
+#: avidemux/ADM_audiofilter/audioencoder_vorbis.cpp:274
 #: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:203
 #: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:91
 #: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:113
@@ -112,8 +108,10 @@
 msgstr "_Modalit?:"
 
 #: avidemux/ADM_audiofilter/audiofilter_buildchain.cpp:322
-#: avidemux/gui_autodrive.cpp:82
-#: avidemux/gui_autodrive.cpp:116
+#: avidemux/gui_autodrive.cpp:77
+#: avidemux/gui_autodrive.cpp:92
+#: avidemux/gui_autodrive.cpp:119
+#: avidemux/gui_autodrive.cpp:153
 msgid "Codec Error"
 msgstr "Errore codec"
 
@@ -125,19 +123,19 @@
 "Il numero di canali ? maggiore di quello supportato dal codec audio selezionato.\n"
 "Cambia il codec o usa il filtro mixer per ridurre i canali."
 
-#: avidemux/ADM_codecs/ADM_ffmp43.cpp:52
+#: avidemux/ADM_codecs/ADM_ffmp43.cpp:45
 msgid "Internal error finding codec"
 msgstr "Errore interno nel cercare i codec"
 
-#: avidemux/ADM_codecs/ADM_ffmpeg.cpp:51
+#: avidemux/ADM_codecs/ADM_ffmpeg.cpp:48
 msgid "Internal error opening codec"
 msgstr "Errore interno nell'aprire i codec"
 
-#: avidemux/ADM_codecs/ADM_ffmpeg.cpp:53
+#: avidemux/ADM_codecs/ADM_ffmpeg.cpp:50
 msgid "Internal error with context for  codec"
 msgstr "Errore interno con il contesto per codec"
 
-#: avidemux/ADM_codecs/ADM_ffmpeg.cpp:53
+#: avidemux/ADM_codecs/ADM_ffmpeg.cpp:50
 msgid ""
 ".\n"
 " Did you use too low / too high target for 2 pass ?"
@@ -165,20 +163,20 @@
 msgid "Aborted"
 msgstr "Annullato"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:404
+#: avidemux/ADM_editor/ADM_edit.cpp:407
 msgid "File type identified but no loader support detected..."
 msgstr "Formato file identificato ma non supportato..."
 
-#: avidemux/ADM_editor/ADM_edit.cpp:405
+#: avidemux/ADM_editor/ADM_edit.cpp:408
 msgid "May be related to an old index file."
 msgstr "Potrebbe essere relativo a un vecchio file di indice."
 
-#: avidemux/ADM_editor/ADM_edit.cpp:412
+#: avidemux/ADM_editor/ADM_edit.cpp:415
 #, c-format
 msgid "Attempt to open %s failed!"
 msgstr "Tentativo di aprire %s fallito!"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:436
+#: avidemux/ADM_editor/ADM_edit.cpp:439
 msgid ""
 "You cannot mix different video dimensions yet. Using the partial video filter later, will not work around this problem. The workaround is:\n"
 "1.) \"resize\" / \"add border\" / \"crop\" each stream to the same resolution\n"
@@ -188,23 +186,23 @@
 "1.) \"ridimensiona\" / \"aggiungi bordi\" / \"ritaglia\" ogni flusso alla stessa risoluzione\n"
 "2.) concatenali insieme"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:548
+#: avidemux/ADM_editor/ADM_edit.cpp:551
 msgid "Build Time Map"
 msgstr "Crea time map"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:548
+#: avidemux/ADM_editor/ADM_edit.cpp:551
 msgid "Build VBR time map?"
 msgstr "Creare la time map VBR?"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:582
+#: avidemux/ADM_editor/ADM_edit.cpp:585
 msgid "Use that mode"
 msgstr "Utilizza questa modalit?"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:582
+#: avidemux/ADM_editor/ADM_edit.cpp:585
 msgid "H264 detected"
 msgstr "H264 rilevato"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:582
+#: avidemux/ADM_editor/ADM_edit.cpp:585
 msgid ""
 "If the file is using bframe as reference, it can lead to crash or stutteting.\n"
 "Avidemux can use another mode which is safed but <b>YOU WILL LOOSE FRAME ACCURACY</b>.\n"
@@ -214,47 +212,47 @@
 "Avidemux pu? utilizzare un'altra modalit? pi? sicura ma <b>PERDERAI LA PRECISIONE DEI FOTOGRAMMI</b>.\n"
 "Vuoi usare quella modalit??"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:709
+#: avidemux/ADM_editor/ADM_edit.cpp:712
 msgid "Packed Bitstream detected"
 msgstr "Flusso di bit compresso rilevato"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:710
+#: avidemux/ADM_editor/ADM_edit.cpp:713
 msgid "Do you want me to unpack it ?"
 msgstr "Vuoi decomprimerlo?"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:730
+#: avidemux/ADM_editor/ADM_edit.cpp:733
 msgid "Could not unpack the video"
 msgstr "Impossibile decomprimere il video"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:730
+#: avidemux/ADM_editor/ADM_edit.cpp:733
 msgid "Using backup decoder - not frame accurate."
 msgstr "Utilizzo decodificatore backup - non preciso sui fotogrammi."
 
-#: avidemux/ADM_editor/ADM_edit.cpp:735
+#: avidemux/ADM_editor/ADM_edit.cpp:738
 msgid "Weird"
 msgstr "Strano"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:735
+#: avidemux/ADM_editor/ADM_edit.cpp:738
 msgid "The unpacking succeedeed but the index is still not up to date."
 msgstr "La decompressione ? riuscita ma l'indice non ? ancora aggiornato."
 
-#: avidemux/ADM_editor/ADM_edit.cpp:741
+#: avidemux/ADM_editor/ADM_edit.cpp:744
 msgid "Troubles ahead"
 msgstr "Problemi avanti"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:741
+#: avidemux/ADM_editor/ADM_edit.cpp:744
 msgid "This a VOP packed AVI."
 msgstr "Questo ? un AVI compresso con VOP."
 
-#: avidemux/ADM_editor/ADM_edit.cpp:752
+#: avidemux/ADM_editor/ADM_edit.cpp:755
 msgid "Index is not up to date"
 msgstr "L'indice non ? aggiornato"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:752
+#: avidemux/ADM_editor/ADM_edit.cpp:755
 msgid "You should use Tool->Rebuild frame. Do it now ?"
 msgstr "Dovresti usare Strumenti -> Ricostruisci fotogrammi. Vuoi farlo ora?"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:1507
+#: avidemux/ADM_editor/ADM_edit.cpp:1510
 msgid ""
 "This looks like mpeg\n"
 " Do you want to index it?"
@@ -262,7 +260,7 @@
 "Questo sembra un file mpeg\n"
 "Vuoi indicizzarlo?"
 
-#: avidemux/ADM_editor/ADM_edit.cpp:1559
+#: avidemux/ADM_editor/ADM_edit.cpp:1562
 msgid "Indexing failed"
 msgstr "Indicizzazione fallita"
 
@@ -278,48 +276,60 @@
 msgid "No more supported."
 msgstr "Non pi? supportato."
 
-#: avidemux/ADM_editor/ADM_outputfmt.h:38
+#: avidemux/ADM_editor/ADM_outputfmt.h:42
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:511
 msgid "AVI"
 msgstr "AVI"
 
-#: avidemux/ADM_editor/ADM_outputfmt.h:39
+#: avidemux/ADM_editor/ADM_outputfmt.h:43
 msgid "AVI, dual audio"
 msgstr "AVI, doppio audio"
 
-#: avidemux/ADM_editor/ADM_outputfmt.h:40
+#: avidemux/ADM_editor/ADM_outputfmt.h:44
 msgid "AVI, pack VOP"
 msgstr "AVI, compr. VOP"
 
-#: avidemux/ADM_editor/ADM_outputfmt.h:41
+#: avidemux/ADM_editor/ADM_outputfmt.h:45
 msgid "AVI, unpack VOP"
 msgstr "AVI, decompr. VOP"
 
-#: avidemux/ADM_editor/ADM_outputfmt.h:42
+#: avidemux/ADM_editor/ADM_outputfmt.h:46
 msgid "MPEG-PS (A+V)"
 msgstr "MPEG-PS (A+V)"
 
-#: avidemux/ADM_editor/ADM_outputfmt.h:43
+#: avidemux/ADM_editor/ADM_outputfmt.h:47
 msgid "MPEG-TS (A+V)"
 msgstr "MPEG-TS (A+V)"
 
-#: avidemux/ADM_editor/ADM_outputfmt.h:44
+#: avidemux/ADM_editor/ADM_outputfmt.h:48
 msgid "MPEG video"
 msgstr "MPEG video"
 
-#: avidemux/ADM_editor/ADM_outputfmt.h:45
+#: avidemux/ADM_editor/ADM_outputfmt.h:49
 msgid "MP4"
 msgstr "MP4"
 
-#: avidemux/ADM_editor/ADM_outputfmt.h:46
+#: avidemux/ADM_editor/ADM_outputfmt.h:50
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:515
 msgid "OGM"
 msgstr "OGM"
 
-#: avidemux/ADM_editor/ADM_outputfmt.h:47
+#: avidemux/ADM_editor/ADM_outputfmt.h:51
 msgid "PSP"
 msgstr "PSP"
 
+#: avidemux/ADM_editor/ADM_outputfmt.h:52
+msgid "FLV"
+msgstr "FLV"
+
+#: avidemux/ADM_editor/ADM_outputfmt.h:53
+msgid "MKV"
+msgstr "MKV"
+
+#: avidemux/ADM_editor/ADM_outputfmt.h:54
+msgid "DUMMY"
+msgstr ""
+
 #: avidemux/ADM_encoder/adm_encConfig.cpp:192
 msgid "Wrong output format"
 msgstr "Formato in uscita errato"
@@ -336,11 +346,11 @@
 msgid "Select DVD as the video codec for MPEG TS output."
 msgstr "Seleziona DVD come codec video per l'output MPEG TS."
 
-#: avidemux/ADM_encoder/adm_encConfig.cpp:715
+#: avidemux/ADM_encoder/adm_encConfig.cpp:718
 msgid "Only QCIF and subQCIF are allowed for H.263"
 msgstr "Solo QCIF e subQCIF sono consentiti per H.263"
 
-#: avidemux/ADM_encoder/adm_encConfig.cpp:907
+#: avidemux/ADM_encoder/adm_encConfig.cpp:910
 msgid "Fatal error"
 msgstr "Errore fatale"
 
@@ -352,23 +362,23 @@
 msgid "At the moment, the DV codec only accepts 720*576 at 25"
 msgstr "Al momento, il codec DV accetta solo 720*576 at 25"
 
-#: avidemux/ADM_filter/filter_saveload.cpp:157
+#: avidemux/ADM_filter/filter_saveload.cpp:155
 msgid "Problem reading XML filters"
 msgstr "Problema di lettura dei filtri XML"
 
-#: avidemux/ADM_filter/filter_saveload.cpp:165
+#: avidemux/ADM_filter/filter_saveload.cpp:163
 msgid "No filter found"
 msgstr "Nessun filtro trovato"
 
-#: avidemux/ADM_filter/filter_saveload.cpp:201
+#: avidemux/ADM_filter/filter_saveload.cpp:199
 msgid "Could not find a filter"
 msgstr "Impossibile trovare un filtro"
 
-#: avidemux/ADM_filter/filter_saveload.cpp:209
+#: avidemux/ADM_filter/filter_saveload.cpp:207
 msgid "No tag found"
 msgstr "Nessuna etichetta trovata"
 
-#: avidemux/ADM_filter/filter_saveload.cpp:289
+#: avidemux/ADM_filter/filter_saveload.cpp:287
 msgid "Node not found"
 msgstr "Nodo non trovato"
 
@@ -376,7 +386,7 @@
 msgid "Size is not (s)QCIF"
 msgstr "La dimensione non ? (s)QCIF"
 
-#: avidemux/ADM_inputs/ADM_mp4/ADM_mp4Analyzer.cpp:570
+#: avidemux/ADM_inputs/ADM_mp4/ADM_mp4Analyzer.cpp:583
 msgid "Problem reading SVQ3 headers"
 msgstr "Problema di lettura delle intestazioni SVQ3"
 
@@ -434,8 +444,8 @@
 msgstr "Analisi OGM"
 
 #: avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp:281
-#: avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp:366
-#: avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp:501
+#: avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp:363
+#: avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp:498
 msgid "Malformed header"
 msgstr "Intestazione errata"
 
@@ -447,13 +457,13 @@
 msgid "Indexing"
 msgstr "Indicizzazione"
 
-#: avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp:308
+#: avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp:373
 msgid "Incompatible frame rate"
 msgstr "Frame rate incompatibile"
 
 #: avidemux/ADM_libraries/ADM_lvemux/ADM_muxer.cpp:85
 #: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:153
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:196
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:193
 msgid "Incompatible audio"
 msgstr "Audio incompatibile"
 
@@ -465,6 +475,14 @@
 msgid "lvemux init failed"
 msgstr "Avvio Ivemux fallito"
 
+#: avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp:191
+msgid "Wrong Colorspace"
+msgstr "Spazio di colore errato"
+
+#: avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp:191
+msgid "Only YV12/I420 or YUY2/I422 JPegs are supported"
+msgstr "Sono supportate solo le immagini JPeg YV12/I420 o YUY2/I422"
+
 #: avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp:403
 msgid "Memory error"
 msgstr "Errore memoria"
@@ -474,7 +492,7 @@
 msgstr "Errore conversione in BMP"
 
 #: avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp:417
-#: avidemux/gtk_gui.cpp:1922
+#: avidemux/gtk_gui.cpp:1920
 msgid "Something bad happened"
 msgstr "C'? stato qualche errore"
 
@@ -484,22 +502,26 @@
 
 #: avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp:481
 #: avidemux/ADM_ocr/adm_glyph.cpp:221
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:380
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:366
 #: avidemux/ADM_outputs/oplug_ogm/op_ogsave.cpp:112
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:105
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:110
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:117
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:126
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:335
-#: avidemux/gtk_gui.cpp:895
-#: avidemux/gtk_gui.cpp:1527
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:115
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:120
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:127
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:136
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:233
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:239
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:246
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:255
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:328
+#: avidemux/gtk_gui.cpp:896
+#: avidemux/gtk_gui.cpp:1498
 msgid "File error"
 msgstr "Errore file"
 
 #: avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp:481
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:380
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:366
 #: avidemux/ADM_outputs/oplug_ogm/op_ogsave.cpp:112
-#: avidemux/gtk_gui.cpp:1527
+#: avidemux/gtk_gui.cpp:1498
 #, c-format
 msgid "Cannot open \"%s\" for writing."
 msgstr "Impossibile aprire \"%s\" per la scrittura."
@@ -542,6 +564,19 @@
 msgid "Could not read \"%s\"."
 msgstr "Impossibile leggere \"%s\"."
 
+#: avidemux/ADM_ocr/ADM_ocrEngine.cpp:87
+msgid "Output file error"
+msgstr "Errore file di uscita"
+
+#: avidemux/ADM_ocr/ADM_ocrEngine.cpp:87
+#, c-format
+msgid "Could not open \"%s\" for writing."
+msgstr "Impossibile aprire \"%s\" per la scrittura."
+
+#: avidemux/ADM_ocr/ADM_ocrEngine.cpp:105
+msgid "Problem loading sub"
+msgstr "Problema di caricamento sottotitoli"
+
 #: avidemux/ADM_ocr/ADM_vob2vobsub.cpp:254
 msgid "Ifo error"
 msgstr "Errore file ifo"
@@ -566,13 +601,13 @@
 msgid "Generating VobSub file"
 msgstr "Creazione file VobSub"
 
-#: avidemux/ADM_osSupport/ADM_crashdump.cpp:200
-#: avidemux/ADM_osSupport/ADM_crashdump.cpp:224
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:210
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:236
 msgid "Fatal Error"
 msgstr "Errore fatale"
 
-#: avidemux/ADM_osSupport/ADM_crashdump.cpp:200
-#: avidemux/ADM_osSupport/ADM_crashdump.cpp:224
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:210
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:236
 msgid ""
 "A fatal error has occurred.\n"
 "\n"
@@ -582,15 +617,15 @@
 "\n"
 "Clicca OK per visualizzare le informazioni di debug. Potrebbe richiedere alcuni minuti."
 
-#: avidemux/ADM_osSupport/ADM_crashdump.cpp:423
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:437
 msgid "Load it"
 msgstr "Carica"
 
-#: avidemux/ADM_osSupport/ADM_crashdump.cpp:423
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:437
 msgid "Crash file"
 msgstr "Crash file"
 
-#: avidemux/ADM_osSupport/ADM_crashdump.cpp:424
+#: avidemux/ADM_osSupport/ADM_crashdump.cpp:438
 msgid ""
 "I have detected a crash file. \n"
 "Do you want to load it  ?\n"
@@ -652,7 +687,7 @@
 msgstr "%lu secondi"
 
 #: avidemux/ADM_outputs/oplug_avi/op_avisave.cpp:74
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:188
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:231
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:845
 msgid "Normal"
 msgstr "Normale"
@@ -709,13 +744,15 @@
 " continuare comunque?"
 
 #: avidemux/ADM_outputs/oplug_avi/op_saveprocess.cpp:93
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:170
+#: avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp:149
+#: avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp:203
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:174
 #: avidemux/ADM_outputs/oplug_ogm/op_ogsaveprocess.cpp:76
 msgid "Filter init failed"
 msgstr "Inizializzazione filtro fallita"
 
 #: avidemux/ADM_outputs/oplug_avi/op_saveprocess.cpp:127
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:395
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:399
 #: avidemux/ADM_outputs/oplug_ogm/op_ogsaveprocess.cpp:100
 msgid ""
 "\n"
@@ -725,26 +762,36 @@
 " Riutilizzare il file log esistente?"
 
 #: avidemux/ADM_outputs/oplug_avi/op_saveprocess.cpp:152
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:431
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:435
 msgid "Aborting"
 msgstr "Annullamento in corso"
 
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:152
+#: avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp:135
+#: avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp:189
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:156
 msgid "Cannot initialize the video stream"
 msgstr "Impossibile inizializzare il flusso video"
 
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:208
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:331
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:415
+#: avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp:179
+#: avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp:215
+#: avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp:233
+#: avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp:332
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:212
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:335
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:419
 #: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:352
 msgid "Error while encoding"
 msgstr "Errore durante la codifica"
 
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:220
+#: avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp:190
+#: avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp:244
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:224
 msgid "KeyFrame error"
 msgstr "Errore fotogramma chiave"
 
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:220
+#: avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp:190
+#: avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp:244
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:224
 msgid ""
 "The beginning frame is not a key frame.\n"
 "Please move the A marker."
@@ -752,7 +799,29 @@
 "Il fotogramma iniziale non ? un fotogramma chiave.\n"
 "Spostare il segnalibro A."
 
-#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:247
+#: avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp:151
+msgid "Unsupported video"
+msgstr "Video non supportato"
+
+#: avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp:151
+msgid "Only FLV1 and VP6 video are supported"
+msgstr "Sono supportati solo i video FLV1 e VP6"
+
+#: avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp:173
+#: avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp:178
+msgid "Unsupported audio"
+msgstr "Audio non supportato"
+
+#: avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp:173
+msgid "Audio must be mp3 for flv output."
+msgstr "L'audio di un video flv deve essere mp3."
+
+#: avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp:178
+msgid "Frequency must be 44100, 22050 or 11025 Hz."
+msgstr "La frequenza deve essere 44100, 22050 o 11025 Hz."
+
+#: avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp:254
+#: avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp:251
 msgid "Cannot initialize the audio stream"
 msgstr "Impossibile inizializzare il flusso audio"
 
@@ -765,8 +834,8 @@
 msgstr "Non puoi usare il codec Copia."
 
 #: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:94
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:143
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:154
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:142
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:153
 msgid "There is no audio track"
 msgstr "Non ci sono tracce audio"
 
@@ -779,12 +848,12 @@
 msgstr "Usa i pulsanti &lt;&lt; e &gt;&gt; per spostare usando fotogrammi chiave."
 
 #: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:113
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:164
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:163
 msgid "Audio track is not suitable"
 msgstr "La traccia audio non ? adatta"
 
 #: avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp:153
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:174
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:173
 msgid "For VCD, audio must be 44.1 kHz MP2."
 msgstr "Per VCD, l'audio deve essere 44.1 kHz MP2."
 
@@ -792,19 +861,19 @@
 msgid "For DVD, audio must be 48 kHz MP2(stereo), AC3, DTS or LPCM (stereo)."
 msgstr "Per DVD, l'audio deve essere 48 kHz MP2 (stereo), AC3, DTS o LPCM (stereo)."
 
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:196
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:193
 msgid "For DVD, audio must be 48 kHz MP2, AC3 or LPCM."
 msgstr "Per DVD, l'audio deve essere 48 kHz MP2, AC3 o LPCM."
 
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:313
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:305
 msgid "Reuse log file ?"
 msgstr "Riutilizzare il file log?"
 
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:328
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:320
 msgid "Error in pass 1"
 msgstr "Errore nella passata 1"
 
-#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:478
+#: avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp:463
 msgid "Error in pass 2"
 msgstr "Errore nella passata 2"
 
@@ -816,40 +885,40 @@
 msgid "Could not initialize audio"
 msgstr "Impossibile avviare l'audio"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:236
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:238
 msgid "Select a directory"
 msgstr "Seleziona una cartella"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:502
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:504
 msgid "Uinteger"
 msgstr "Uinteger"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:517
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:519
 msgid "Float"
 msgstr "Float"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:535
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:537
 msgid "Toggle"
 msgstr "Toggle"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:556
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:558
 msgid "No Strategy"
 msgstr "Nessuna strategia"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:557
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:559
 msgid "3:2 Pulldown"
 msgstr "3:2 Pulldown"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:558
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:560
 msgid "Pal/Secam"
 msgstr "Pal/Secam"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:559
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:561
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:86
 msgid "NTSC converted from PAL"
 msgstr "NTSC convertito da PAL"
 
-#: avidemux/ADM_script/ADM_JSFunctions.cpp:561
+#: avidemux/ADM_script/ADM_JSFunctions.cpp:563
 msgid "menu"
 msgstr "Menu"
 
@@ -912,8 +981,8 @@
 #: avidemux/ADM_videoFilter/ADM_lavpp_deint.cpp:105
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:101
 #: avidemux/ADM_videoFilter/ADM_vidRotate.cpp:264
-#: avidemux/gtk_gui.cpp:2000
-#: avidemux/gtk_gui.cpp:2099
+#: avidemux/gtk_gui.cpp:1998
+#: avidemux/gtk_gui.cpp:2097
 msgid "None"
 msgstr "Nessuno"
 
@@ -1116,6 +1185,7 @@
 msgstr "Librerie"
 
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp:178
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:394
 msgid "CPU"
 msgstr "CPU"
 
@@ -1200,6 +1270,7 @@
 msgstr "_Matrici:"
 
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp:82
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flv1.cpp:45
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp:59
 msgid "_GOP size:"
 msgstr "Dimensione _GOP:"
@@ -1209,6 +1280,12 @@
 msgid "_Interlacing:"
 msgstr "_Interlacciamento:"
 
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flv1.cpp:44
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:109
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:268
+msgid "_Bitrate (kb/s):"
+msgstr "_Bitrate (kb/s):"
+
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_gototime.cpp:27
 msgid "_Hours:"
 msgstr "_Ore:"
@@ -1321,6 +1398,7 @@
 msgstr "_Sfuocatura quantizzatore:"
 
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp:98
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:362
 msgid "User Interface"
 msgstr "Interfaccia utente"
 
@@ -1369,56 +1447,76 @@
 msgid "_Swap U&V:"
 msgstr "_Inverti U e V"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:82
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:92
 msgid "Select idx file:"
 msgstr "Seleziona un file idx:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:83
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:93
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:210
 msgid "Use glyphset (optional):"
 msgstr "Usa set di glifi (opzionale):"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:84
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:94
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:211
 msgid "Output SRT file"
 msgstr "File SRT in uscita"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:95
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:105
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:222
 msgid "Select input and ouput files"
 msgstr "Seleziona file di ingresso e di uscita"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:105
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:117
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:115
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:127
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:246
 msgid "The idx/sub file does not exist."
 msgstr "Il file idx/sub non esiste."
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:110
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:120
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:239
 msgid "Please Select a valid output SRT file."
 msgstr "Seleziona un file SRT in uscita valido."
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:126
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:136
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:255
 msgid "Cannot load the glyphset file."
 msgstr "Impossibile caricare il set di glifi."
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:144
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:156
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:276
 msgid "Glyphset filename"
 msgstr "Nome file del set di glifi"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:146
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:158
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:278
 msgid "Save Glyph"
 msgstr "Salva glifo"
 
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:208
+msgid "Input TS:"
+msgstr "TS in ingresso:"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:209
+msgid "Subtitle PID:"
+msgstr "PID sottotitolo:"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp:233
+msgid "Please Select a valid TS file."
+msgstr "Seleziona un file TS valido."
+
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp:40
 #: avidemux/ADM_videoFilter/ADM_vidForcedPP.cpp:60
 msgid "_Filter strength:"
 msgstr "Intensit? _filtro:"
 
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp:51
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:285
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:334
 #: avidemux/ADM_videoFilter/ADM_vidForcedPP.cpp:72
 msgid "_Horizontal deblocking"
 msgstr "Deblocking _orizzontale"
 
 #: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp:52
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:286
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:335
 #: avidemux/ADM_videoFilter/ADM_vidForcedPP.cpp:73
 msgid "_Vertical deblocking"
 msgstr "Deblocking _verticale"
@@ -1428,55 +1526,75 @@
 msgid "_Deringing"
 msgstr "_Deringing"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:170
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:188
 msgid "_Use systray while encoding"
 msgstr "_Usa systray durante la codifica"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:171
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:189
 msgid "_Accept non-standard audio frequency for DVD"
 msgstr "_Accetta frequenze audio non standard per DVD"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:172
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:190
 msgid "_Use libavcodec MPEG-2 decoder"
 msgstr "_Usa decodificatore libavcodec MPEG-2"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:173
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:191
 msgid "Create _OpenDML files"
 msgstr "Crea file _OpenDML"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:174
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:192
 msgid "Automatically _index MPEG files"
 msgstr "Indicizza automaticamente i file MPEG"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:175
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:193
 msgid "Automatically _swap A and B if A>B"
 msgstr "Inverti automaticamente A e B se A>B"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:176
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:194
 msgid "_Disable NUV audio sync"
 msgstr "_Disattiva sincronizzazione audio NUV"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:177
-msgid "_Load external filters"
-msgstr "_Carica filtri esterni"
-
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:179
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:196
 msgid "Automatically _build VBR map"
 msgstr "_Crea automaticamente la mappa VBR"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:180
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:197
 msgid "Automatically _rebuild index"
 msgstr "_Ricostrusci automaticamente l'indice"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:181
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:198
 msgid "Automatically remove _packed bitstream"
 msgstr "Rimuovi automaticamente il _flusso di bit compresso"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:183
-msgid "_Number of threads:"
-msgstr "_Numero di thread:"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:202
+msgid "Enable all SIMD"
+msgstr "Attiva tutti"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:186
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:203
+msgid "SIMD"
+msgstr "SIMD"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:206
+msgid "Enable "
+msgstr "Attiva"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:219
+msgid "_lavc threads:"
+msgstr "Thread _lavc:"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:220
+msgid "_x264 threads:"
+msgstr "Thread _x264:"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:221
+msgid "X_vid threads:"
+msgstr "Thread X_vid:"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:223
+msgid "Multi-threading"
+msgstr "Multi-threading"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:229
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:843
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:108
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:105
@@ -1484,15 +1602,15 @@
 msgid "High"
 msgstr "Alta"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:187
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:230
 msgid "Above normal"
 msgstr "Al di sopra del normale"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:189
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:232
 msgid "Below normal"
 msgstr "Al di sotto del normale"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:190
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:233
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:847
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp:107
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp:104
@@ -1500,148 +1618,173 @@
 msgid "Low"
 msgstr "Bassa"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:192
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:235
 msgid "_Encoding priority:"
 msgstr "_Priorit? di codifica:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:193
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:236
 msgid "_Indexing/unpacking priority:"
 msgstr "Priorit? di _indicizzazione/decompressione:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:194
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:237
 msgid "_Playback priority:"
 msgstr "Priorit? playback:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:196
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:239
+msgid "Prioritisation"
+msgstr "Prioritizzazione"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:244
 msgid "_Split MPEG files every (MB):"
 msgstr "_Dividi i file MPEG ogni (MB):"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:198
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:246
 msgid "_Use alternative tag for MP3 in .mp4"
 msgstr "_Usa etichette alternative per gli MP3 in file .mp4"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:201
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:249
 msgid "GTK+ (slow)"
 msgstr "GTK+ (lento)"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:203
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:251
 msgid "XVideo (best)"
 msgstr "XVideo (migliore)"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:207
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:255
 msgid "SDL (GDI)"
 msgstr "SDL (GDI)"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:208
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:256
 msgid "SDL (DirectX)"
 msgstr "SDL (DirectX)"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:210
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:258
 msgid "SDL (good)"
 msgstr "SDL (buono)"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:214
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:262
 msgid "Video _display:"
 msgstr "_Visualizzazione video:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:219
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:267
 msgid "No alerts"
 msgstr "Nessun avviso"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:220
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:268
 msgid "Display only error alerts"
 msgstr "Visualizza solo gli avvisi di errore"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:221
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:269
 msgid "Display all alerts"
 msgstr "Visualizza tutti gli avvisi"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:223
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:271
 msgid "_Message level:"
 msgstr "Livello _messaggio:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:228
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:276
 msgid "PCM"
 msgstr "PCM"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:229
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:277
 msgid "Master"
 msgstr "Master"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:230
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:278
 msgid "_Volume control:"
 msgstr "Controllo _volume:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:235
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:283
 msgid "No downmixing"
 msgstr "No downmixing"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:237
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:285
 msgid "Pro Logic"
 msgstr "Pro Logic"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:238
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:286
 msgid "Pro Logic II"
 msgstr "Pro Logic II"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:240
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:288
 msgid "_Local playback downmixing:"
 msgstr "_Local playback downmixing:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:272
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:320
 msgid "_Audio output:"
 msgstr "Output _audio"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:274
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:323
 msgid "ALSA _device:"
 msgstr "_Dispositivo ALSA:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:287
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:336
 msgid "De_ringing"
 msgstr "De_ringing"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:288
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:337
 #: avidemux/ADM_videoFilter/ADM_vidMSharpen.cpp:167
 msgid "_Strength:"
 msgstr "_Forza:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:289
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:338
 msgid "Default Postprocessing"
 msgstr "Postprocessing predefinito"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:303
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:352
 msgid "_Filter directory:"
 msgstr "Cartella _filtri:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:306
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:47
-#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:26
-msgid "No"
-msgstr "No"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:353
+msgid "_Load external filters"
+msgstr "_Carica filtri esterni"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:307
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:47
-#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:26
-msgid "Yes"
-msgstr "S?"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:356
+msgid "Use _Global GlyphSet"
+msgstr "Usa set di glifi _globale"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:308
-msgid "Use _Global GlyphSet:"
-msgstr "Usa set di glifi _globale:"
-
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:309
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:357
 msgid "Gl_yphSet:"
-msgstr "Set di gl_ifi:"
+msgstr "Set di glifi:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:343
-msgid "Global Glyphset"
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:366
+msgid "Automation"
+msgstr "Automazione"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:370
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:430
+msgid "Input"
+msgstr "Input"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:374
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:431
+msgid "Output"
+msgstr "Output"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:379
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:382
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:385
+msgid "Audio"
+msgstr "Audio"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:390
+#: avidemux/gtk_gui.cpp:1997
+msgid "Video"
+msgstr "Video"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:398
+msgid "Threading"
+msgstr "Threading"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:402
+msgid "Global GlyphSet"
 msgstr "Set di glifi globale"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:348
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:406
 msgid "External Filters"
 msgstr "Filtri esterni"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:352
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp:410
 msgid "Preferences"
 msgstr "Preferenze"
 
@@ -1775,11 +1918,11 @@
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:788
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:166
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:206
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:89
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:96
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:79
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:93
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:419
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_resize.cpp:433
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1429
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1431
 msgid "0"
 msgstr "0"
 
@@ -1861,7 +2004,11 @@
 msgid "Artefact _protection threshold:"
 msgstr "Soglia di protezione artefatto:"
 
-#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:120
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:112
+msgid "Debug:"
+msgstr "Debug:"
+
+#: avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp:121
 msgid "TDeint"
 msgstr "TDeint"
 
@@ -1895,7 +2042,7 @@
 msgstr "Matteo 'Maff' Angelino"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_about.cpp:69
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:272
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:273
 msgid "Avidemux"
 msgstr "Avidemux"
 
@@ -2611,34 +2758,34 @@
 msgid "Configure codec"
 msgstr "Configura codec"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:73
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:68
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:74
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:71
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:67
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:72
 msgid "ASHARP"
 msgstr "ASHARP"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:199
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:183
 msgid "ASharp by MarcFD"
 msgstr "ASharp di MarcFD"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:212
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:196
 msgid "Threshold :"
 msgstr "Soglia:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:220
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:204
 msgid "Strength :"
 msgstr "Forza:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:228
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:212
 msgid "Block Adaptative :"
 msgstr "Blocco adattativo:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:236
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:220
 msgid "Unknown flag :"
 msgstr "Flag sconosciuta:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:268
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:145
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp:252
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:161
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:262
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:283
 msgid " "
@@ -2649,7 +2796,7 @@
 msgstr "Occupato"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:401
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:992
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:994
 msgid "Calculator"
 msgstr "Calcola bitrate"
 
@@ -2714,6 +2861,7 @@
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_calculator.cpp:559
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_x264.cpp:808
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_threadCount.cpp:87
 msgid "Custom"
 msgstr "Personalizzata"
 
@@ -2765,19 +2913,19 @@
 msgid "<b>Result</b>"
 msgstr "<b>Risultato</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:199
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:184
 msgid "ChromaShift"
 msgstr "ChromaShift"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:213
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:198
 msgid "U Shift :"
 msgstr "U Shift :"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:220
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:205
 msgid "V Shift :"
 msgstr "V Shift :"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:262
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_chromaShift.cpp:247
 msgid "<b>Preview</b>"
 msgstr "<b>Anteprima</b>"
 
@@ -2830,13 +2978,13 @@
 msgstr "ColorYuv (da Avisynth)"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:179
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:210
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:228
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:194
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:212
 msgid "Contrast"
 msgstr "Contrasto"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:186
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:237
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:221
 msgid "Brightness"
 msgstr "Luminosit?"
 
@@ -2849,7 +2997,7 @@
 msgstr "Luma Y"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_coloryuv.cpp:214
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:255
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:239
 msgid "Chroma U"
 msgstr "Croma U"
 
@@ -2917,39 +3065,39 @@
 msgid "<b>frame2</b>"
 msgstr "<b>fotogramma2</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:251
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:235
 msgid "Luma"
 msgstr "Luma"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:259
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp:243
 msgid "Chroma v"
 msgstr "Croma V"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:273
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:258
 msgid "Crop Settings"
 msgstr "Impostazioni ritaglio"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:307
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:292
 msgid "AutoCrop"
 msgstr "AutoCrop"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:329
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:314
 msgid "Reset"
 msgstr "Ripristina"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:338
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:323
 msgid "Crop Left :"
 msgstr "Taglia a sinistra:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:346
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:331
 msgid "Crop Top:"
 msgstr "Taglia in alto:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:354
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:339
 msgid "Crop Right:"
 msgstr "Taglia a destra:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:362
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp:347
 msgid "Crop Bottom:"
 msgstr "Taglia in basso:"
 
@@ -3074,49 +3222,49 @@
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_encoding.cpp:884
 msgid "Pause / Abort"
-msgstr "Pausa / Annulla"
+msgstr "Pausa / Annulla "
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:343
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:205
 msgid "MPlayer eq2"
 msgstr "MPlayer eq2"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:369
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:231
 msgid "Brigh_tness:"
 msgstr "Luminosi_t?:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:377
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:239
 msgid "_Saturation:"
 msgstr "_Saturazione:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:412
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:274
 msgid "_Contrast:"
 msgstr "_Contrasto:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:438
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:300
 msgid "_Initial:"
 msgstr "_Iniziale:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:464
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:326
 msgid "_Red:"
 msgstr "_Rosso:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:481
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:343
 msgid "_Green:"
 msgstr "_Verde:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:489
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:351
 msgid "_Blue:"
 msgstr "_Blu:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:497
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:359
 msgid "_Weight:"
 msgstr "_Peso:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:523
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp:385
 msgid "<b>Gamma</b>"
 msgstr "<b>Gamma</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_equalizer.cpp:449
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_equalizer.cpp:450
 msgid "Equalizer"
 msgstr "Equalizzatore"
 
@@ -3128,19 +3276,19 @@
 msgid "Enter parameters (i.e. -b 192 -m s ...)"
 msgstr "Immetti parametri (es. -b 192 -ms ...)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:76
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:74
 msgid "Hue"
 msgstr "Tonalit?"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:186
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:171
 msgid "Hue/Saturation"
 msgstr "Tonalit?/Saturazione"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:200
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:185
 msgid "<b>Hue:</b>"
 msgstr "<b>Tonalit?:</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:208
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_hue.cpp:193
 msgid "<b>Saturation:</b>"
 msgstr "<b>Saturazione:</b>"
 
@@ -3169,11 +3317,11 @@
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:182
 msgid "Timecode :"
-msgstr "Timecode :"
+msgstr "Timecode:"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:190
 msgid "Nb pictures seen :"
-msgstr "Numero di immagini trovate:"
+msgstr "Numero di immagini trovate: "
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_idx_pg.cpp:214
 msgid "Indexing :"
@@ -3195,7 +3343,7 @@
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_jobs.cpp:25
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp:26
-#: avidemux/gtk_gui.cpp:2277
+#: avidemux/gtk_gui.cpp:2275
 msgid "Failed"
 msgstr "Fallito"
 
@@ -3319,75 +3467,99 @@
 msgid "Output _file:"
 msgstr "_File in uscita:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:378
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:379
 msgid "Mplayer Delogo"
 msgstr "Mplayer Delogo"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:396
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:397
 msgid "X"
 msgstr "X"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:403
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:404
 msgid "Y"
 msgstr "Y"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:410
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:411
 msgid "W"
 msgstr "W"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:417
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:418
 msgid "H"
 msgstr "H"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:424
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_mpdelogo.cpp:425
 msgid "Band"
 msgstr "Band"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:57
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:61
 msgid "Mini OCR"
 msgstr "Mini OCR"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:75
-msgid "# of Glyphs :"
-msgstr "Numero di glifi :"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:86
+msgid "0:0:0"
+msgstr "0:0:0"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:82
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:100
 msgid "# of lines"
 msgstr "Numero di linee"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:103
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:108
+msgid "TimeCode:"
+msgstr "Timecode:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:116
+msgid "# of Glyphs :"
+msgstr "Numero di glifi :"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:124
 msgid "<b>Stats</b>"
 msgstr "<b>Statistiche</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:125
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:141
 msgid "Current Glyph"
 msgstr "Glifo corrente"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:138
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:154
 msgid " Text:"
 msgstr "Testo:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:160
-msgid "Calibrate"
-msgstr "Calibra"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:176
+msgid "_Calibrate"
+msgstr "_Calibra"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:165
-msgid "Skip all"
-msgstr "Salta tutti"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:180
+msgid "If the glyphs are too thin, enter a lower value here"
+msgstr "Se i glifi sono troppo sottili, inserisci qui un valore pi? basso"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:170
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:182
+msgid "S_kip all"
+msgstr "Salta _tutti"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:186
+msgid "Skip the whole image"
+msgstr "Salta l'intera immagine"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:188
 msgid "Skip Glyph"
 msgstr "Salta glifo"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:175
-msgid "Ignore glyph"
-msgstr "Ignora glifo"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:192
+msgid "Skip the current letter/glyph"
+msgstr "Salta il glifo corrente"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:180
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:194
+msgid "_Ignore glyph"
+msgstr "_Ignora glifo"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:198
+msgid "This glyph will be ignored from now on"
+msgstr "Questo glifo sar? ignorato da ora in poi"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:200
 msgid "Ok"
 msgstr "Ok"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:189
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_ocr.cpp:214
 msgid "<b>Bitmap</b>"
 msgstr "<b>Bitmap</b>"
 
@@ -3442,15 +3614,22 @@
 msgid "Full parameter line"
 msgstr "Linea parametri completa"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_preview.cpp:280
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_preview.cpp:180
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:336
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtersub.cpp:150
 msgid "Preview"
 msgstr "Anteprima"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_preview.cpp:316
-msgid "Stack Field"
-msgstr "Impila campi"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:47
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:26
+msgid "No"
+msgstr "No"
 
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:47
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:26
+msgid "Yes"
+msgstr "S?"
+
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:67
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp:69
 #, c-format
@@ -3531,7 +3710,7 @@
 msgstr "Proporzioni:"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:318
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1056
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1058
 msgid "<b>Video</b>"
 msgstr "<b>Video</b>"
 
@@ -3576,7 +3755,7 @@
 msgstr "Bitrate variabile:"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp:496
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1096
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1098
 msgid "<b>Audio</b>"
 msgstr "<b>Audio</b>"
 
@@ -3640,12 +3819,12 @@
 msgid "Lanczos3"
 msgstr "Lanczos3"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:92
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:237
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:91
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:222
 msgid "Subtitle Size and Position"
 msgstr "Dimensione e posizione sottotitoli"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:251
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_srt.cpp:236
 msgid "Font Size:"
 msgstr "Dimensione carattere:"
 
@@ -3654,8 +3833,8 @@
 msgstr "Codificatore video"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_vcodec.cpp:118
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1076
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1116
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1078
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1118
 msgid "Configure"
 msgstr "Configura"
 
@@ -4495,6 +4674,7 @@
 msgstr "Seleziona codifica a 1 o a 2 passate"
 
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_xvid4.cpp:760
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:123
 msgid "Single pass - bitrate"
 msgstr "Passata singola - bitrate"
 
@@ -4882,10 +5062,51 @@
 msgid "Select Color"
 msgstr "Seleziona colore"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:73
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:99
 msgid "_Encoding mode:"
 msgstr "Modalit? di _codifica:"
 
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:125
+msgid "Single pass - constant quality"
+msgstr "Passata singola - qualit? costante"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:127
+msgid "Single pass - same qz as input"
+msgstr "Passata singola - stessa qz dell'input"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:129
+msgid "Single pass - Average quantizer"
+msgstr "Passata singola - quantizzatore variabile"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:132
+msgid "Two pass - video size"
+msgstr "Due passate - dimensione video"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:134
+msgid "Two pass - average bitrate"
+msgstr "Due passate - bitrate variabile"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:273
+#: avidemux/ADM_videoFilter/ADM_vidForcedPP.cpp:61
+msgid "_Quantizer:"
+msgstr "_Quantizzatore:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:278
+msgid "A_vg Quantizer:"
+msgstr "Quantizzatore a_vg:"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:283
+msgid "_Video size (MB):"
+msgstr "Dimensione _video (MB):"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:288
+msgid "_Average bitrate (kb/s):"
+msgstr "Bitrate _medio (kb/s):"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp:293
+msgid "-"
+msgstr "-"
+
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_hex.cpp:100
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_hex.cpp:134
 msgid "_Previous"
@@ -4896,31 +5117,14 @@
 msgid "_Next"
 msgstr "_Successivo"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filter.cpp:327
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:242
-#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp:413
-msgid "The filter is already partial"
-msgstr "Il filtro ? gi? parziale"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_threadCount.cpp:75
+msgid "Disable"
+msgstr "Disattiva"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filter.cpp:455
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filter.cpp:457
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:348
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:350
-msgid "Load set of filters"
-msgstr "Carica gruppo di filtri"
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_threadCount.cpp:79
+msgid "Auto-detect"
+msgstr "Rilevamento automatico"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filter.cpp:464
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:363
-msgid "Nothing to save"
-msgstr "Niente da salvare"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filter.cpp:468
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filter.cpp:470
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:367
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:369
-msgid "Save set of filters"
-msgstr "Salva gruppo di filtri"
-
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filterlist.cpp:64
 msgid "Add Video Filter"
 msgstr "Aggiungi filtro video"
@@ -4956,6 +5160,25 @@
 msgid "Miscellaneous"
 msgstr "Varie"
 
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:244
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp:413
+msgid "The filter is already partial"
+msgstr "Il filtro ? gi? parziale"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:342
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:344
+msgid "Load set of filters"
+msgstr "Carica gruppo di filtri"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:357
+msgid "Nothing to save"
+msgstr "Niente da salvare"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:361
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager.cpp:363
+msgid "Save set of filters"
+msgstr "Salva gruppo di filtri"
+
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters/gui_filtermanager_dialog.cpp:123
 msgid "Video Filter Manager"
 msgstr "Gestore filtri video"
@@ -5102,19 +5325,11 @@
 msgid "Save as script"
 msgstr "Salva come script"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:431
-msgid "Input"
-msgstr "Input"
-
 #: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:432
-msgid "Output"
-msgstr "Output"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:433
 msgid "Side"
 msgstr "Laterale"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:434
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:433
 #: avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp:90
 #: avidemux/ADM_videoFilter/ADM_vidDGbob.cpp:81
 #: avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp:87
@@ -5122,510 +5337,513 @@
 msgid "Top"
 msgstr "Alto"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:435
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:434
 msgid "Separate"
 msgstr "Separati"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:609
-#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp:499
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp:608
 #, c-format
 msgid "Frame:%c(%02d)"
 msgstr "Fotogramma: %c(%02d)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:289
-#: avidemux/main.cpp:202
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:290
+#: avidemux/main.cpp:209
 msgid "_File"
 msgstr "_File"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:296
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:297
 msgid "_Open..."
 msgstr "_Apri..."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:307
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:308
 msgid "_Append..."
 msgstr "A_ggiungi"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:318
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:319
 msgid "_Save"
 msgstr "_Salva"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:329
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:330
 msgid "Save _Video..."
 msgstr "Salva _video..."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:341
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:342
 msgid "Save _BMP Image..."
 msgstr "Salva immagine _BMP..."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:345
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:346
 msgid "Save _JPEG Image..."
 msgstr "Salva immagine _JPEG..."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:349
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:350
 msgid "Save _Selection as JPEG Images..."
 msgstr "Salva _selezione in immagini JPEG..."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:362
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:363
 msgid "Save _Project"
 msgstr "Salva _progetto"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:370
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:371
 msgid "Save P_roject As..."
 msgstr "Salva p_rogetto come..."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:378
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:379
 msgid "_Load/Run Project..."
 msgstr "Car_ica/esegui progetto..."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:386
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:387
 msgid "A_dd to Joblist..."
 msgstr "Aggi_ungi alla lista attivit?"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:390
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:391
 msgid "Show _Joblist"
 msgstr "Mostra _lista attivit?"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:402
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:403
 msgid "Co_nnect to avsproxy"
 msgstr "Co_nnetti a avsproxy"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:411
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:412
 msgid "Proper_ties"
 msgstr "Proprie_t?"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:422
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:423
 msgid "AVI _Muxer Options"
 msgstr "Opzioni _Muxer AVI"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:431
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:432
 msgid "_Quit"
 msgstr "_Esci"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:442
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:443
 msgid "_Edit"
 msgstr "_Modifica"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:449
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:450
 msgid "_Reset Edits"
 msgstr "A_nnulla"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:462
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:463
 msgid "Cu_t"
 msgstr "_Taglia"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:473
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:474
 msgid "_Copy"
 msgstr "_Copia"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:484
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:485
 msgid "_Paste"
 msgstr "_Incolla"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:495
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:496
 msgid "_Delete"
 msgstr "_Elimina"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:511
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:512
 msgid "Set Marker _A"
 msgstr "Imposta segnalibro _A"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:518
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:519
 msgid "Set Marker _B"
 msgstr "Imposta segnalibro _B"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:530
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:531
 msgid "Pre_ferences"
 msgstr "_Preferenze"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:538
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:539
 msgid "_View"
 msgstr "_Visualizza"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:545
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:546
 msgid "_Main Toolbar"
 msgstr "_Barra degli strumenti"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:550
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:551
 msgid "_A/V Sidebar"
 msgstr "Barra laterale _A/V"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:560
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:561
 msgid "_Zoom 1:4"
 msgstr "_Zoom 1:4"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:567
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:568
 msgid "Z_oom 1:2"
 msgstr "Z_oom 1:2"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:574
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:575
 msgid "Zoom _1:1"
 msgstr "Zoom _1:1"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:581
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:582
 msgid "Zoom _2:1"
 msgstr "Zoom _2:1"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:588
-msgid "Zoom _4:1"
-msgstr "Zoom _4:1"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:595
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:589
 msgid "Vi_deo"
 msgstr "Vi_deo"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:602
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:596
 msgid "_Decoder Options"
 msgstr "_Opzioni codifica"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:609
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:603
 msgid "_Postprocessing"
 msgstr "_Postprocessing"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:612
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:606
 msgid "Select postprocessing level"
 msgstr "Seleziona livello di postprocessing"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:622
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:616
 msgid "P_review"
 msgstr "_Anteprima"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:629
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:623
 msgid "Display _Output"
 msgstr "_Esegui video in uscita"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:641
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:635
 msgid "_Frame Rate"
 msgstr "_Frame rate"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:645
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:694
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:639
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:688
 msgid "_Encoder"
 msgstr "_Decodificatore"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:652
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:646
 msgid "Fil_ters"
 msgstr "Fil_tri"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:659
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:653
 msgid "_Audio"
 msgstr "_Audio"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:666
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:660
 msgid "_Main Track"
 msgstr "_Traccia principale"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:670
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:664
 msgid "_Second Track"
 msgstr "T_raccia secondaria"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:674
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:668
 msgid "_Build VBR Time Map"
 msgstr "_Crea VBR Time Map"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:683
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:677
 msgid "S_ave..."
 msgstr "_Salva..."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:701
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:695
 msgid "_Filters"
 msgstr "_Filtri"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:705
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:699
 msgid "_Tools"
 msgstr "_Strumenti"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:712
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:706
 msgid "_Calculator"
 msgstr "_Calcola bitrate"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:728
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:722
 msgid "_Rebuild Frames (I & B)"
 msgstr "_Ricostruisci fotogrammi (I & B)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:732
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:726
 msgid "C_heck Frames (slow)"
 msgstr "V_erifica fotogrammi (lento)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:736
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:730
 msgid "_Bitrate Histogram"
 msgstr "Istogramma _bitrate"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:740
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:734
 msgid "_Scan for Black Frames..."
 msgstr "Cerca fotogrammi _neri..."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:749
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:743
 msgid "_VOB -> VobSub"
 msgstr "_VOB -> VobSub"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:753
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:747
 msgid "_OCR (VobSub -> srt)"
 msgstr "_OCR (VobSub -> srt)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:757
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:751
+msgid "OCR (TS->srt)"
+msgstr "OCR (TS -> srt)"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:755
 msgid "_Edit Glyph"
 msgstr "_Modifica glifo"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:766
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:764
 msgid "_Frame Hex Dump"
 msgstr "Hex Dump _fotogramma"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:770
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:768
 msgid "A_uto"
 msgstr "A_uto"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:777
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:775
 msgid "_VCD"
 msgstr "_VCD"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:781
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:779
 msgid "_SVCD"
 msgstr "_SVCD"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:785
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:783
 msgid "_DVD"
 msgstr "_DVD"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:789
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:787
 msgid "_PSP"
 msgstr "_PSP"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:793
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:791
 msgid "PSP (_H.264)"
 msgstr "PSP (_H.264)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:797
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:795
+msgid "F_LV"
+msgstr "F_LV"
+
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:799
 msgid "_Go"
 msgstr "_Vai"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:804
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:806
 msgid "_Play/Stop"
 msgstr "_Play/Stop"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:815
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:817
 msgid "P_revious Frame"
 msgstr "Fotogramma p_recedente"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:826
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:828
 msgid "_Next Frame"
 msgstr "Fotogramma _successivo"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:837
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:839
 msgid "Pr_evious Intra Frame"
 msgstr "Fotogramma chiave pr_ecedente"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:848
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:850
 msgid "Next _Intra Frame"
 msgstr "Fotogramma ch_iave successivo"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:859
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:861
 msgid "Previou_s Black Frame"
 msgstr "Fotogramma nero pre_cedente"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:863
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:865
 msgid "Ne_xt Black Frame"
 msgstr "Fotogramma nero successi_vo"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:867
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:869
 msgid "_First Frame"
 msgstr "Primo _fotogramma"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:878
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:880
 msgid "_Last Frame"
 msgstr "_Ultimo fotogramma"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:894
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:896
 msgid "Go to Marker _A"
 msgstr "Vai al segnalibro _A"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:901
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:903
 msgid "Go to Marker _B"
 msgstr "Vai al segnalibro _B"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:913
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:915
 msgid "Go to Fra_me..."
 msgstr "Vai al fotogra_mma..."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:924
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:926
 msgid "Go to _Time..."
 msgstr "Vai al _tempo..."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:935
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:937
 msgid "_Custom"
 msgstr "_Preferiti"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:939
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:941
 msgid "_Help"
 msgstr "A_iuto"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:946
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:948
 msgid "_Built-in Support"
 msgstr "_Supporto incorporato"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:950
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:952
 msgid "_About"
 msgstr "_Informazioni"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:968
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:970
 msgid "Open a file"
 msgstr "Apri un file"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:978
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:980
 msgid "Save the file"
 msgstr "Salva il file"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:984
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:986
 msgid "Audio/video file information"
 msgstr "Informazioni audio/video del file"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:995
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:997
 msgid "Bitrate/size calculator"
 msgstr "Calcola bitrate/dimensione"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1074
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1114
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1076
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1116
 msgid "Copy"
 msgstr "Copia"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1079
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1081
 msgid "Configure video encoder"
 msgstr "Configura codificatore video"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1084
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1140
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1086
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1142
 msgid "Filters"
 msgstr "Filtri"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1087
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1089
 msgid "Video filters"
 msgstr "Filtri video"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1119
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1121
 msgid "Configure audio encoder"
 msgstr "Configura codificatore audio"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1127
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1129
 msgid "Audio filters"
 msgstr "Filtri audio"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1148
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1150
 msgid "Shift:"
 msgstr "Ritardo:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1151
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1153
 msgid "Enable time shift"
 msgstr "Attiva ritardo audio"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1157
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1159
 msgid "Audio/video time shift (ms)"
 msgstr "Ritardo audio/video (ms)"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1164
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1166
 msgid "<b>Format</b>"
 msgstr "<b>Formato</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1197
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1199
 msgid "<b>Selection</b>"
 msgstr "<b>Seleziona</b>"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1214
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1222
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1216
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1224
 msgid " 0000000"
 msgstr " 0000000"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1230
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1232
 msgid "A:"
 msgstr "A:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1237
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1239
 msgid "Go to marker A"
 msgstr "Vai al segnalibro A"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1239
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1241
 msgid "B:"
 msgstr "B:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1246
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1248
 msgid "Go to marker B"
 msgstr "Vai al segnalibro B"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1258
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1260
 msgid "Play"
 msgstr "Play"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1272
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1274
 msgid "Stop"
 msgstr "Stop"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1284
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1286
 msgid "Previous frame"
 msgstr "Fotogramma precedente"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1299
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1301
 msgid "Next frame"
 msgstr "Fotogramma successivo"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1314
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1316
 msgid "Previous keyframe"
 msgstr "Fotogramma chiave precedente"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1329
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1331
 msgid "Next keyframe"
 msgstr "Fotogramma chiave successivo"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1343
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1345
 msgid "Selection: start"
 msgstr "Selezione: inizio"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1354
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1356
 msgid "Selection: end"
 msgstr "Selezione: fine"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1365
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1367
 msgid "Previous black frame"
 msgstr "Fotogramma nero precedente"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1376
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1378
 msgid "Next black frame"
 msgstr "Fotogramma nero successivo"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1387
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1389
 msgid "First frame"
 msgstr "Primo fotogramma"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1398
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1400
 msgid "Last frame"
 msgstr "Ultimo fotogramma"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1420
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1422
 msgid "Frame: "
 msgstr "Fotogramma:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1427
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1429
 msgid "Current frame"
 msgstr "Fotogramma attuale:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1432
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1434
 msgid "/ 0000000"
 msgstr "/ 0000000"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1439
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1441
 msgid "Time: "
 msgstr "Tempo:"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1446
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1448
 msgid "Current time"
 msgstr "Tempo attuale"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1447
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1449
 msgid "00:00:00.000"
 msgstr "00:00:00.000"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1450
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1452
 msgid "/ 00:00:00,000"
-msgstr "/ 00:00:00,000"
+msgstr "/ 00:00:00.000"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1457
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_main2.cpp:1459
 msgid "Frame: ?"
 msgstr "Fotogramma: ?"
 
@@ -5668,24 +5886,7 @@
 msgid "Next Empty"
 msgstr "Vuoto successivo"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp:180
-msgid "Output file error"
-msgstr "Errore file di uscita"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp:180
-#, c-format
-msgid "Could not open \"%s\" for writing."
-msgstr "Impossibile aprire \"%s\" per la scrittura."
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp:189
-msgid "Problem loading sub"
-msgstr "Problema di caricamento sottotitoli"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp:295
-msgid "Select Glyphfile to save to"
-msgstr "Seleziona il file glifo in cui salvare"
-
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp:362
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_ocr/adm_ocr.cpp:181
 msgid "Sure ?"
 msgstr "Sicuro?"
 
@@ -5695,41 +5896,41 @@
 msgid "Couldn't find pixmap file: %s"
 msgstr "Impossibile trovare il file pixmap: %s"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:121
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:211
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:474
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:103
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:204
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:467
 msgid "Cannot open directory as a file"
 msgstr "Impossibile aprire la cartella come un file"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:335
-#: avidemux/gtk_gui.cpp:892
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:328
+#: avidemux/gtk_gui.cpp:893
 #, c-format
 msgid "Cannot open \"%s\"."
 msgstr "Impossibile aprire \"%s\"."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:345
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:338
 msgid "Overwrite file ?"
 msgstr "Sovrascivere il file?"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:370
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:384
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:363
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:377
 msgid "It could be possible that you try to overwrite an input file!"
 msgstr "? possibile che tu stia provando a sovrascrivere un file di ingresso!"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:395
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:388
 msgid "Cannot write the file"
 msgstr "Impossibile scrivere il file"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:395
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:388
 #, c-format
 msgid "No write access to \"%s\"."
 msgstr "Nessun accesso di scrittura per \"%s\"."
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:528
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:522
 msgid "Images"
 msgstr "Immagini"
 
-#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:540
+#: avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp:534
 msgid "All"
 msgstr "Tutti i file"
 
@@ -5971,6 +6172,10 @@
 msgid "This script has already been successfully executed."
 msgstr "Lo script ? gi? stato eseguito con successo."
 
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_vobsub.cpp:123
+msgid "Select Idx File"
+msgstr "Seleziona un file idx"
+
 #: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_index_pg.cpp:198
 #, c-format
 msgid "# Images :%0lu"
@@ -5981,15 +6186,15 @@
 msgid "Time Left :%02d:%02d:%02d"
 msgstr "Tempo rimanente: %02d:%02d:%02d"
 
-#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp:62
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp:63
 msgid "Select File to Read"
 msgstr "Seleziona il file da leggere"
 
-#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp:65
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp:88
 msgid "Select File to Write"
 msgstr "Seleziona il file da scrivere"
 
-#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp:69
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp:92
 msgid "Select Directory"
 msgstr "Seleziona cartella"
 
@@ -6009,6 +6214,11 @@
 msgid "Partial Video Filter"
 msgstr "Filtro video parziale"
 
+#: avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp:808
+#, c-format
+msgid "%c (%02d)"
+msgstr "%c (%02d)"
+
 #: avidemux/ADM_video/ADM_vidFieldUnblend.cpp:81
 msgid "Metrics"
 msgstr "Misure"
@@ -6017,14 +6227,6 @@
 msgid "Do you want to print metrics on screen ?"
 msgstr "Vuoi mostrare le misure sullo schermo?"
 
-#: avidemux/ADM_video/ADM_vidSRT.cpp:215
-msgid "Could not open subtitle file"
-msgstr "Impossibile aprire il file sottotitoli"
-
-#: avidemux/ADM_video/ADM_vidSRT.cpp:235
-msgid "Cannot identify subtitle format"
-msgstr "Impossibile identificare il formato sottotitoli"
-
 #: avidemux/ADM_videoFilter/ADM_guiResize.cpp:96
 #: avidemux/ADM_videoFilter/ADM_vidMPLResize.cpp:143
 msgid "Width and height cannot be 0"
@@ -6124,6 +6326,39 @@
 msgid "Show metric in image (debug)"
 msgstr "Mostra misure nell'immagine (debug)"
 
+#: avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp:187
+msgid "_Start Frame (first frame # to include in average):"
+msgstr "Fotogramma _iniziale (primo numero di fotogramma da includere in media):"
+
+#: avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp:191
+msgid "_End Frame (last frame # to include), -1 = last:"
+msgstr "Fotogramma _finale (ultimo numero di fotogramma da includere), -1 = ultimo:"
+
+#: avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp:195
+#: avidemux/ADM_videoFilter/ADM_vidParticle.cpp:160
+msgid "_Output File:"
+msgstr "File in _uscita:"
+
+#: avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp:198
+msgid "_Bias (only for display; use 0 for average, 128 for frame minus average):"
+msgstr "_Bias (solo per la visualizzazione; usa 0 per una media, 128 per un fotogramma meno la media):"
+
+#: avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp:202
+msgid "Current frame minus average so far"
+msgstr "Fotogramma corrente meno la media fino a questo punto"
+
+#: avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp:203
+msgid "Average so far"
+msgstr "Media fino a questo punto"
+
+#: avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp:205
+msgid "Display nothing (fast for batch processing)"
+msgstr "Nessuna visualizzazione (veloce per elaborazioni batch)"
+
+#: avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp:209
+msgid "Display _Mode:"
+msgstr "_Modali? visualizzazione:"
+
 #: avidemux/ADM_videoFilter/ADM_vidDecDec.cpp:190
 msgid "Discard closer"
 msgstr "Scarta il pi? vicino"
@@ -6343,10 +6578,6 @@
 msgid "Start must be before end, and both within video # of frames."
 msgstr "L'inizio deve essere prima della fine, e entrami nel numero di fotogrammi."
 
-#: avidemux/ADM_videoFilter/ADM_vidForcedPP.cpp:61
-msgid "_Quantizer:"
-msgstr "_Quantizzatore:"
-
 #: avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp:88
 msgid "If value is smaller than threshold it is considered valid. Smaller value might mean more false positive"
 msgstr "Se il valore ? pi? piccolo della soglia ? considerato valido. Valori pi? piccoli potrebbero produrre pi? falsi positivi."
@@ -6379,6 +6610,22 @@
 msgid "Show interlaced areas (for test!)"
 msgstr "Mostra aree interlacciate (per test!)"
 
+#: avidemux/ADM_videoFilter/ADM_vidLogo.cpp:88
+msgid "_Logo (jpg file):"
+msgstr "_Logo (file jpg):"
+
+#: avidemux/ADM_videoFilter/ADM_vidLogo.cpp:89
+msgid "_X Position:"
+msgstr "Posizione _X:"
+
+#: avidemux/ADM_videoFilter/ADM_vidLogo.cpp:90
+msgid "_Y Position:"
+msgstr "Posizione _Y:"
+
+#: avidemux/ADM_videoFilter/ADM_vidLogo.cpp:91
+msgid "_Alpha:"
+msgstr "_Alpha:"
+
 #: avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp:104
 msgid "Fast"
 msgstr "Veloce"
@@ -6442,6 +6689,52 @@
 msgid "_Try reverse"
 msgstr "_Prova contrario"
 
+#: avidemux/ADM_videoFilter/ADM_vidParticle.cpp:129
+msgid "Mi_nimum area for a particle to be detected:"
+msgstr "Arema mi_nima per l'individuazione di una particella:"
+
+#: avidemux/ADM_videoFilter/ADM_vidParticle.cpp:132
+msgid "Ma_ximum area for a particle to be detected:"
+msgstr "Arema ma_ssima per l'individuazione di una particella:"
+
+#: avidemux/ADM_videoFilter/ADM_vidParticle.cpp:136
+msgid "_Left side crop (ignore particles in):"
+msgstr "Crop laterale _sinistro (ignora particelle all'interno):"
+
+#: avidemux/ADM_videoFilter/ADM_vidParticle.cpp:139
+msgid "_Right side crop (ignore particles in):"
+msgstr "Crop laterale _destro (ignora particelle all'interno):"
+
+#: avidemux/ADM_videoFilter/ADM_vidParticle.cpp:142
+msgid "_Top crop (ignore particles in):"
+msgstr "Crop s_uperiore (ignora particelle all'interno):"
+
+#: avidemux/ADM_videoFilter/ADM_vidParticle.cpp:145
+msgid "_Bottom crop (ignore particles in):"
+msgstr "Crop inferiore (ignora particelle all'interno):"
+
+#: avidemux/ADM_videoFilter/ADM_vidParticle.cpp:149
+msgid "New format, preferred, good for Tracker3D"
+msgstr "Nuovo formato, preferito, buono per Tracker3D"
+
+#: avidemux/ADM_videoFilter/ADM_vidParticle.cpp:151
+msgid "Old format that Tracker3D can't read directly"
+msgstr "Vecchio formato che Tracker3D non pu? leggere direttamente"
+
+#: avidemux/ADM_videoFilter/ADM_vidParticle.cpp:155
+msgid "_Output Format:"
+msgstr "Formato in _uscita:"
+
+#: avidemux/ADM_videoFilter/ADM_vidParticle.cpp:163
+msgid "_Camera number:"
+msgstr "Numero _telecamera:"
+
+#: avidemux/ADM_videoFilter/ADM_vidParticle.cpp:165
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:343
+#: avidemux/ADM_videoFilter/ADM_vidThreshold.cpp:147
+msgid "_Debugging settings (bits):"
+msgstr "Impostazioni di _debug (bits):"
+
 #: avidemux/ADM_videoFilter/ADM_vidResampleFPS.cpp:85
 msgid "_New frame rate:"
 msgstr "_Nuovo frame rate:"
@@ -6494,10 +6787,166 @@
 msgid "_Radius:"
 msgstr "_Raggio:"
 
+#: avidemux/ADM_videoFilter/ADM_vidSRT.cpp:214
+msgid "Could not open subtitle file"
+msgstr "Impossibile aprire il file sottotitoli"
+
+#: avidemux/ADM_videoFilter/ADM_vidSRT.cpp:234
+msgid "Cannot identify subtitle format"
+msgstr "Impossibile identificare il formato sottotitoli"
+
 #: avidemux/ADM_videoFilter/ADM_vidStabilize.cpp:63
 msgid "Stabilize Threshold"
 msgstr "Stabilizza soglia"
 
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:260
+msgid "P' = A"
+msgstr "P' = A"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:261
+msgid "P' = P"
+msgstr "P' = P"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:262
+msgid "P' = P - A"
+msgstr "P' = P - A"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:263
+msgid "P' = A - P"
+msgstr "P' = A - P"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:264
+msgid "P' = P + A"
+msgstr "P' = P + A"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:265
+msgid "P' = P * A"
+msgstr "P' = P * A"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:266
+msgid "P' = P / A"
+msgstr "P' = P / A"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:267
+msgid "P' = A / P"
+msgstr "P' = A / P"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:268
+msgid "P' = min (P, A)"
+msgstr "P' = min (P, A)"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:269
+msgid "P' = max (P, A)"
+msgstr "P' = max (P, A)"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:274
+msgid "A = convolve(P); Load convolution kernel from file"
+msgstr "A = avvolgi(P); Carica nucleo di avvolgimento da file"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:276
+msgid "A = pixel from image file as float; Load image from file"
+msgstr "A = pixel dal file immagine come float; Carica immagine da file"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:278
+msgid "A = pixel from image file as integer; Load image from file"
+msgstr "A = pixel dal file immagine come integer; Carica immagine da file"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:280
+msgid "A = floating point constant value"
+msgstr "A = valore costante virgola mobile"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:282
+msgid "A = rolling average of pixel: A = A*(1-alpha)+(P*alpha)"
+msgstr "A = media mobile di pixel: A = A*(1-alpha)+(P*alpha)"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:287
+msgid "Select _Operation on each pixel P and input A:"
+msgstr "Seleziona _opeazione per ogni pixel P e input A:"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:291
+msgid "Input _Type:"
+msgstr "_Tipo in ingresso:"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:296
+msgid "Input _File (image or convolution kernel):"
+msgstr "_File di ingresso (immagine o nucleo di avvolgimento):"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:299
+msgid ""
+"_Load Bias (added to each pixel\n"
+"in file image when loaded):"
+msgstr ""
+"_Carica Bias (aggiunto a ogni pixel\n"
+"nell'immagine al caricamento):"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:304
+msgid ""
+"Load _Multiplier (each pixel in\n"
+"file image mult. by this when loaded):"
+msgstr ""
+"Carica _Moltiplicatore (ogni pixel\n"
+"nell'immagine moltiplicato per questo valore al caricamento):"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:310
+msgid "Input _Constant:"
+msgstr "_Costante in ingresso:"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:314
+msgid ""
+"Denominator of memory constant _alpha\n"
+"(where A = (1-alpha)*A + alpha*curr_frame):"
+msgstr ""
+"Denominatore della costante di memoria _alpha\n"
+"(dove A = (1-alpha)*A + alpha*_fotogrammacorrente):"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:319
+msgid "Init _Start Frame (first frame # to use for head start):"
+msgstr "Inizializza fotogramma _iniziale (primo numero di fotogramma da usare per la partenza facilitata):"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:323
+msgid "Init _End Frame (last frame # to use for head start):"
+msgstr "Inizializza fotogramma _finale (ultimo numero di fotogramma da usare per la partenza facilitata):"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:327
+msgid "Init By _Rolling (compute head start using a rolling average rather than a straight average)"
+msgstr "Inizializza con media mobile (elabora partenza facilitata usando una media mobile invece di una media diretta)"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:332
+msgid "_Bias (will be added to result):"
+msgstr "_Bias (sar? aggiunto al risultato):"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:335
+msgid "Mi_nimum value (will be scaled to 0):"
+msgstr "Valore mi_nimo (sar? regolato a 0):"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:338
+msgid "Ma_ximum value (will be scaled to 255):"
+msgstr "Valore ma_ssimo (sar? regolato a 255):"
+
+#: avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp:341
+msgid "_Histogram every N frames (0 to disable):"
+msgstr "_Istogramma ogni N fotogrammi (0 per disattivare):"
+
+#: avidemux/ADM_videoFilter/ADM_vidThreshold.cpp:134
+msgid "Mi_nimum value to be in-range:"
+msgstr "Valore mi_nimo per rientrare nell'intervallo:"
+
+#: avidemux/ADM_videoFilter/ADM_vidThreshold.cpp:135
+msgid "Ma_ximum value to be in-range:"
+msgstr "Valore ma_ssimo per rientrare nell'intervallo:"
+
+#: avidemux/ADM_videoFilter/ADM_vidThreshold.cpp:138
+msgid "In-range values go white, out-of-range go black"
+msgstr "I valori interni all'intervallo sono bianchi, quelli esterni neri"
+
+#: avidemux/ADM_videoFilter/ADM_vidThreshold.cpp:139
+msgid "In-range values go black, out-of-range go white"
+msgstr "I valori interni all'intervallo sono neri, quelli esterni bianchi"
+
+#: avidemux/ADM_videoFilter/ADM_vidThreshold.cpp:144
+msgid "Output values:"
+msgstr "Valori in uscita:"
+
 #: avidemux/ADM_videoFilter/ADM_vidVlad.cpp:101
 msgid "_Luma temporal threshold:"
 msgstr "Soglia temporale _luma:"
@@ -6526,27 +6975,27 @@
 msgid "_Order:"
 msgstr "_Ordine:"
 
-#: avidemux/gtk_gui.cpp:253
+#: avidemux/gtk_gui.cpp:251
 msgid "Select ECMAScript to Run"
 msgstr "Seleziona un ECMAScript da eseguire"
 
-#: avidemux/gtk_gui.cpp:300
-#: avidemux/gtk_gui.cpp:339
+#: avidemux/gtk_gui.cpp:298
+#: avidemux/gtk_gui.cpp:337
 msgid "Obsolete"
 msgstr "Obsoleto"
 
-#: avidemux/gtk_gui.cpp:367
+#: avidemux/gtk_gui.cpp:365
 msgid "Not coded in this version"
 msgstr "Non codificato in questa versione"
 
-#: avidemux/gtk_gui.cpp:382
-#: avidemux/gtk_gui.cpp:387
-#: avidemux/gtk_gui.cpp:506
-#: avidemux/gtk_gui.cpp:509
+#: avidemux/gtk_gui.cpp:380
+#: avidemux/gtk_gui.cpp:385
+#: avidemux/gtk_gui.cpp:507
+#: avidemux/gtk_gui.cpp:510
 msgid "Select AVI File..."
 msgstr "Seleziona un file AVI..."
 
-#: avidemux/gtk_gui.cpp:442
+#: avidemux/gtk_gui.cpp:441
 msgid ""
 "This is to be used to undo packed VOP on MPEG-4.\n"
 "Continue ?"
@@ -6554,127 +7003,127 @@
 "Questo deve essere usato per decomprimere il VOP su MPEG-4.\n"
 "Continuare?"
 
-#: avidemux/gtk_gui.cpp:444
+#: avidemux/gtk_gui.cpp:443
 msgid "Select AVI File to Write"
 msgstr "Seleziona il file AVI da scrivere"
 
-#: avidemux/gtk_gui.cpp:450
+#: avidemux/gtk_gui.cpp:449
 msgid "Select OGM File to Write"
 msgstr "Seleziona il file OGM da scrivere"
 
-#: avidemux/gtk_gui.cpp:461
-#: avidemux/gtk_gui.cpp:472
+#: avidemux/gtk_gui.cpp:453
+#: avidemux/gtk_gui.cpp:465
 msgid "Select Workbench to Save"
 msgstr "Seleziona il Tavolo da lavoro da salvare"
 
-#: avidemux/gtk_gui.cpp:496
+#: avidemux/gtk_gui.cpp:497
 msgid "Select Raw File to Save"
 msgstr "Seleziona il file grezzo da salvare"
 
-#: avidemux/gtk_gui.cpp:512
+#: avidemux/gtk_gui.cpp:513
 msgid "Select AVI File to Append..."
 msgstr "Seleziona il file AVI da aggiungere..."
 
-#: avidemux/gtk_gui.cpp:516
+#: avidemux/gtk_gui.cpp:517
 msgid "Select File to Save Audio"
 msgstr "Seleziona il file audio da salvare"
 
-#: avidemux/gtk_gui.cpp:550
+#: avidemux/gtk_gui.cpp:551
 msgid "Select JPEG Sequence to Save"
 msgstr "Seleziona la sequenza JPEG da salvare"
 
-#: avidemux/gtk_gui.cpp:553
+#: avidemux/gtk_gui.cpp:554
 msgid "Select BMP to Save"
 msgstr "Seleziona il file BMP da salvare"
 
-#: avidemux/gtk_gui.cpp:557
+#: avidemux/gtk_gui.cpp:558
 msgid "Select JPEG to Save"
 msgstr "Seleziona il file JPEG da salvare"
 
-#: avidemux/gtk_gui.cpp:610
-#: avidemux/gtk_gui.cpp:714
+#: avidemux/gtk_gui.cpp:611
+#: avidemux/gtk_gui.cpp:715
 msgid "Select File to Save"
 msgstr "Seleziona il file da salvare"
 
-#: avidemux/gtk_gui.cpp:654
+#: avidemux/gtk_gui.cpp:655
 msgid "Select MP3 to Load"
 msgstr "Seleziona il file MP3 da caricare"
 
-#: avidemux/gtk_gui.cpp:657
+#: avidemux/gtk_gui.cpp:658
 msgid "Select AC3 to Load"
 msgstr "Seleziona il file AC3 da caricare"
 
-#: avidemux/gtk_gui.cpp:660
+#: avidemux/gtk_gui.cpp:661
 msgid "Select WAV to Load"
 msgstr "Seleziona il file WAV da caricare"
 
-#: avidemux/gtk_gui.cpp:708
+#: avidemux/gtk_gui.cpp:709
 msgid "Out of bounds"
 msgstr "Oltre i limiti"
 
-#: avidemux/gtk_gui.cpp:719
-#: avidemux/gtk_gui.cpp:1910
+#: avidemux/gtk_gui.cpp:720
+#: avidemux/gtk_gui.cpp:1908
 msgid "Marker A > B"
 msgstr "Segnalibro A > B"
 
-#: avidemux/gtk_gui.cpp:719
+#: avidemux/gtk_gui.cpp:720
 msgid "Cannot copy."
 msgstr "Impossibile copiare."
 
-#: avidemux/gtk_gui.cpp:731
+#: avidemux/gtk_gui.cpp:732
 msgid "Something bad happened (II))"
 msgstr "C'? stato qualche errore (II)"
 
-#: avidemux/gtk_gui.cpp:745
+#: avidemux/gtk_gui.cpp:746
 msgid "Are you sure?"
 msgstr "Sei sicuro?"
 
-#: avidemux/gtk_gui.cpp:800
+#: avidemux/gtk_gui.cpp:801
 msgid "Frame Rate"
 msgstr "Frame rate"
 
-#: avidemux/gtk_gui.cpp:800
+#: avidemux/gtk_gui.cpp:801
 msgid "_Frames per second:"
 msgstr "_Fotogrammi al secondo:"
 
-#: avidemux/gtk_gui.cpp:823
+#: avidemux/gtk_gui.cpp:824
 msgid "Width is not a multiple of 8"
 msgstr "La larghezza non ? un multiplo di 8"
 
-#: avidemux/gtk_gui.cpp:824
+#: avidemux/gtk_gui.cpp:825
 msgid "This will make trouble for AVI files."
 msgstr "Questo causer? un problema per i file AVI."
 
-#: avidemux/gtk_gui.cpp:834
+#: avidemux/gtk_gui.cpp:835
 msgid "Rebuild all Keyframes?"
 msgstr "Ricostruire tutti i fotogrammi chiave?"
 
-#: avidemux/gtk_gui.cpp:892
+#: avidemux/gtk_gui.cpp:893
 msgid "Permission error"
 msgstr "Errore di permesso"
 
-#: avidemux/gtk_gui.cpp:895
+#: avidemux/gtk_gui.cpp:896
 #, c-format
 msgid "\"%s\" does not exist."
 msgstr "\"%s\" non esiste."
 
-#: avidemux/gtk_gui.cpp:937
+#: avidemux/gtk_gui.cpp:938
 msgid "Cannot open project using the video loader."
 msgstr "Impossibile aprire il progetto usando il caricatore video."
 
-#: avidemux/gtk_gui.cpp:938
+#: avidemux/gtk_gui.cpp:939
 msgid "Try 'File' -> 'Load/Run Project...'"
 msgstr "Prova 'File' -> 'Carica/esegui progetto...'"
 
-#: avidemux/gtk_gui.cpp:940
+#: avidemux/gtk_gui.cpp:941
 msgid "Could not open the file"
 msgstr "Impossibile aprire il file"
 
-#: avidemux/gtk_gui.cpp:975
+#: avidemux/gtk_gui.cpp:976
 msgid "Multiple Audio Tracks"
 msgstr "Tracce audio multiple"
 
-#: avidemux/gtk_gui.cpp:975
+#: avidemux/gtk_gui.cpp:976
 msgid ""
 "The file you just loaded contains several audio tracks.\n"
 "Go to Audio->MainTrack to select the active one."
@@ -6682,281 +7131,277 @@
 "Il file appena caricato contiene diverse tracce audio.\n"
 "Vai a 'Audio' -> 'Traccia principale' per selezionare la traccia attiva."
 
-#: avidemux/gtk_gui.cpp:1065
+#: avidemux/gtk_gui.cpp:1039
 msgid "No audio decoder found for this file"
 msgstr "Nessun decodificatore trovato per questo file"
 
-#: avidemux/gtk_gui.cpp:1066
+#: avidemux/gtk_gui.cpp:1040
 msgid "Save (A+V) will generate bad AVI. Save audio will work."
 msgstr "Salvare (A+V) generer? un file AVI difettoso. Salvare l'audio funzioner?."
 
-#: avidemux/gtk_gui.cpp:1122
+#: avidemux/gtk_gui.cpp:1099
 msgid "Something failed when appending"
 msgstr "Qualcosa ? fallito nell'esecuzione"
 
-#: avidemux/gtk_gui.cpp:1131
-#: avidemux/gtk_gui.cpp:1929
+#: avidemux/gtk_gui.cpp:1108
+#: avidemux/gtk_gui.cpp:1927
 msgid "Something bad happened (II)"
 msgstr "C'? stato qualche errore (II)"
 
-#: avidemux/gtk_gui.cpp:1195
+#: avidemux/gtk_gui.cpp:1172
 msgid "Cannot save the audio in copy mode"
 msgstr "Impossibile salvare l'audio in modalit? copia"
 
-#: avidemux/gtk_gui.cpp:1195
+#: avidemux/gtk_gui.cpp:1172
 msgid "Select WAV PCM as the audio codec, otherwise the audio file would be raw PCM."
 msgstr "Seleziona il codec audio WAV PCM, altrimenti il file audio sar? PCM grezzo."
 
-#: avidemux/gtk_gui.cpp:1203
-#: avidemux/gtk_gui.cpp:1559
+#: avidemux/gtk_gui.cpp:1180
+#: avidemux/gtk_gui.cpp:1537
 msgid "Saving audio"
 msgstr "Salvataggio audio in corso"
 
-#: avidemux/gtk_gui.cpp:1280
+#: avidemux/gtk_gui.cpp:1257
 msgid "Get Frame"
 msgstr "Prendi fotogramma"
 
-#: avidemux/gtk_gui.cpp:1280
+#: avidemux/gtk_gui.cpp:1257
 msgid "Cannot get this frame to save"
 msgstr "Impossibile salvare questo fotogramma"
 
-#: avidemux/gtk_gui.cpp:1317
+#: avidemux/gtk_gui.cpp:1294
 msgid "Mark A > B"
 msgstr "Segnalibro A > B"
 
-#: avidemux/gtk_gui.cpp:1317
+#: avidemux/gtk_gui.cpp:1294
 msgid "Set your markers correctly."
 msgstr "Imposta i tuoi segnalibri correttamente."
 
-#: avidemux/gtk_gui.cpp:1326
+#: avidemux/gtk_gui.cpp:1303
 msgid "Saving as set of jpegs"
 msgstr "Salvataggio come gruppo di jpeg in corso"
 
-#: avidemux/gtk_gui.cpp:1332
+#: avidemux/gtk_gui.cpp:1309
 msgid "Cannot decode frame"
 msgstr "Impossibile decodificare il fotogramma"
 
-#: avidemux/gtk_gui.cpp:1332
+#: avidemux/gtk_gui.cpp:1309
 msgid "Aborting."
 msgstr "Annullamento in corso."
 
-#: avidemux/gtk_gui.cpp:1343
-#: avidemux/gtk_gui.cpp:1362
-#: avidemux/gtk_gui.cpp:2273
+#: avidemux/gtk_gui.cpp:1320
+#: avidemux/gtk_gui.cpp:1339
+#: avidemux/gtk_gui.cpp:2271
 msgid "Done"
 msgstr "Fatto"
 
-#: avidemux/gtk_gui.cpp:1343
+#: avidemux/gtk_gui.cpp:1320
 #, c-format
 msgid "Saved %d images."
 msgstr "%d immagini salvate."
 
-#: avidemux/gtk_gui.cpp:1345
+#: avidemux/gtk_gui.cpp:1322
 msgid "Error"
 msgstr "Errore"
 
-#: avidemux/gtk_gui.cpp:1345
+#: avidemux/gtk_gui.cpp:1322
 msgid "Could not save all images."
 msgstr "Impossibile salvare tutte le immagini."
 
-#: avidemux/gtk_gui.cpp:1362
+#: avidemux/gtk_gui.cpp:1339
 #, c-format
 msgid "Saved \"%s\"."
 msgstr "\"%s\" salvato."
 
-#: avidemux/gtk_gui.cpp:1364
+#: avidemux/gtk_gui.cpp:1341
 msgid "BMP op failed"
 msgstr "Op. BMP fallita"
 
-#: avidemux/gtk_gui.cpp:1364
+#: avidemux/gtk_gui.cpp:1341
 #, c-format
 msgid "Saving %s as a BMP file failed."
 msgstr "Salvataggio di %s come file BMP fallito."
 
-#: avidemux/gtk_gui.cpp:1384
-#: avidemux/gtk_gui.cpp:1450
+#: avidemux/gtk_gui.cpp:1361
+#: avidemux/gtk_gui.cpp:1427
 msgid "Failed to open the file"
 msgstr "L'apertura del file ? fallita"
 
-#: avidemux/gtk_gui.cpp:1384
-#: avidemux/gtk_gui.cpp:1450
+#: avidemux/gtk_gui.cpp:1361
+#: avidemux/gtk_gui.cpp:1427
 msgid "Not a WAV file?"
 msgstr "Non ? un file WAV?"
 
-#: avidemux/gtk_gui.cpp:1385
+#: avidemux/gtk_gui.cpp:1362
 #, c-format
 msgid "WAV open file failed..."
 msgstr "L'apertura del file WAV ? fallita"
 
-#: avidemux/gtk_gui.cpp:1520
+#: avidemux/gtk_gui.cpp:1491
 msgid "Cannot decompress audio frame"
 msgstr "Impossibile decomprimere il segmento audio"
 
-#: avidemux/gtk_gui.cpp:1534
+#: avidemux/gtk_gui.cpp:1505
 msgid "Memory Error"
 msgstr "Errore di memoria"
 
-#: avidemux/gtk_gui.cpp:1580
+#: avidemux/gtk_gui.cpp:1558
 msgid "No frames to encode"
 msgstr "Nessun fotogramma da codificare"
 
-#: avidemux/gtk_gui.cpp:1580
+#: avidemux/gtk_gui.cpp:1558
 msgid "Please check markers. Is \"A>\" == \">B\"?"
 msgstr "Controlla i segnalibri. ? \"A>\" == \">B\"?"
 
-#: avidemux/gtk_gui.cpp:1699
+#: avidemux/gtk_gui.cpp:1697
 msgid "Saving raw video stream"
 msgstr "Salvataggio flusso video grezzo in corso"
 
-#: avidemux/gtk_gui.cpp:1845
+#: avidemux/gtk_gui.cpp:1843
 msgid "Checking video"
 msgstr "Verifica video in corso"
 
-#: avidemux/gtk_gui.cpp:1861
+#: avidemux/gtk_gui.cpp:1859
 msgid "No error found"
 msgstr "Nessun errore trovato"
 
-#: avidemux/gtk_gui.cpp:1865
+#: avidemux/gtk_gui.cpp:1863
 #, c-format
 msgid "Errors found in %u frames"
 msgstr "Errore trovato nel fotogramma %u"
 
-#: avidemux/gtk_gui.cpp:1883
+#: avidemux/gtk_gui.cpp:1881
 msgid "Cannot decompress the audio stream"
 msgstr "Impossibile decomprimere il flusso audio"
 
-#: avidemux/gtk_gui.cpp:1883
+#: avidemux/gtk_gui.cpp:1881
 msgid "Switch audio codec to Copy."
 msgstr "Sposta la codifica audio su Copia."
 
-#: avidemux/gtk_gui.cpp:1910
+#: avidemux/gtk_gui.cpp:1908
 msgid "Cannot delete the selection."
 msgstr "Impossibile eliminare la selezione."
 
-#: avidemux/gtk_gui.cpp:1915
+#: avidemux/gtk_gui.cpp:1913
 msgid "You can't remove all frames"
 msgstr "Non puoi rimuovere tutti i fotogrammi."
 
-#: avidemux/gtk_gui.cpp:1991
+#: avidemux/gtk_gui.cpp:1989
 msgid "Could not get tracks info"
 msgstr "Impossibile ottenere informazioni sulla traccia"
 
-#: avidemux/gtk_gui.cpp:1999
-msgid "Video"
-msgstr "Video"
-
-#: avidemux/gtk_gui.cpp:1999
+#: avidemux/gtk_gui.cpp:1997
 msgid "Take audio from video file"
 msgstr "Recupera audio dal file video"
 
-#: avidemux/gtk_gui.cpp:2000
-#: avidemux/gtk_gui.cpp:2099
+#: avidemux/gtk_gui.cpp:1998
+#: avidemux/gtk_gui.cpp:2097
 msgid "No audio"
 msgstr "Nessuna traccia audio"
 
-#: avidemux/gtk_gui.cpp:2001
-#: avidemux/gtk_gui.cpp:2100
+#: avidemux/gtk_gui.cpp:1999
+#: avidemux/gtk_gui.cpp:2098
 msgid "External AC3"
 msgstr "AC3 esterno"
 
-#: avidemux/gtk_gui.cpp:2001
-#: avidemux/gtk_gui.cpp:2100
+#: avidemux/gtk_gui.cpp:1999
+#: avidemux/gtk_gui.cpp:2098
 msgid "Take audio from external AC3 file"
 msgstr "Prendi l'audio da un file AC3 esterno"
 
-#: avidemux/gtk_gui.cpp:2002
-#: avidemux/gtk_gui.cpp:2101
+#: avidemux/gtk_gui.cpp:2000
+#: avidemux/gtk_gui.cpp:2099
 msgid "External MP3"
 msgstr "MP3 esterno"
 
-#: avidemux/gtk_gui.cpp:2002
-#: avidemux/gtk_gui.cpp:2101
+#: avidemux/gtk_gui.cpp:2000
+#: avidemux/gtk_gui.cpp:2099
 msgid "Take audio from external MP3 file"
 msgstr "Prendi l'audio da un file MP3 esterno"
 
-#: avidemux/gtk_gui.cpp:2003
-#: avidemux/gtk_gui.cpp:2102
+#: avidemux/gtk_gui.cpp:2001
+#: avidemux/gtk_gui.cpp:2100
 msgid "External WAV"
 msgstr "WAV esterno"
 
-#: avidemux/gtk_gui.cpp:2003
-#: avidemux/gtk_gui.cpp:2102
+#: avidemux/gtk_gui.cpp:2001
+#: avidemux/gtk_gui.cpp:2100
 msgid "Take audio from external WAV file"
 msgstr "Prendi l'audio da un file WAV esterno"
 
-#: avidemux/gtk_gui.cpp:2007
-#: avidemux/gtk_gui.cpp:2107
+#: avidemux/gtk_gui.cpp:2005
+#: avidemux/gtk_gui.cpp:2105
 msgid "_Audio source:"
 msgstr "Sorgente _audio:"
 
-#: avidemux/gtk_gui.cpp:2011
-#: avidemux/gtk_gui.cpp:2108
+#: avidemux/gtk_gui.cpp:2009
+#: avidemux/gtk_gui.cpp:2106
 msgid "_External file:"
 msgstr "File _esterno:"
 
-#: avidemux/gtk_gui.cpp:2026
+#: avidemux/gtk_gui.cpp:2024
 msgid "_Track from video:"
 msgstr "_Traccia dal video:"
 
-#: avidemux/gtk_gui.cpp:2036
+#: avidemux/gtk_gui.cpp:2034
 msgid "Main Audio Track"
 msgstr "Traccia audio principale"
 
-#: avidemux/gtk_gui.cpp:2042
-#: avidemux/gtk_gui.cpp:2120
+#: avidemux/gtk_gui.cpp:2040
+#: avidemux/gtk_gui.cpp:2118
 msgid "Cannot load"
 msgstr "Impossibile caricare"
 
-#: avidemux/gtk_gui.cpp:2042
-#: avidemux/gtk_gui.cpp:2120
+#: avidemux/gtk_gui.cpp:2040
+#: avidemux/gtk_gui.cpp:2118
 msgid "The selected audio file does not exist."
 msgstr "Il file audio selezionato non esiste."
 
-#: avidemux/gtk_gui.cpp:2117
+#: avidemux/gtk_gui.cpp:2115
 msgid "Second Audio Track"
 msgstr "Traccia audio secondaria"
 
-#: avidemux/gtk_gui.cpp:2149
+#: avidemux/gtk_gui.cpp:2147
 msgid "Error loading the MP3 file"
 msgstr "Errore nel caricamento del file MP3"
 
-#: avidemux/gtk_gui.cpp:2158
-#: avidemux/gtk_gui.cpp:2180
-#: avidemux/gtk_gui.cpp:2202
+#: avidemux/gtk_gui.cpp:2156
+#: avidemux/gtk_gui.cpp:2178
+#: avidemux/gtk_gui.cpp:2200
 msgid "Second track loaded"
 msgstr "Seconda traccia caricata"
 
-#: avidemux/gtk_gui.cpp:2172
+#: avidemux/gtk_gui.cpp:2170
 msgid "Error loading the AC3 file"
 msgstr "Errore nel caricamento del file AC3"
 
-#: avidemux/gtk_gui.cpp:2194
+#: avidemux/gtk_gui.cpp:2192
 msgid "Error loading the WAV file"
 msgstr "Errore nel caricamento del file WAV"
 
-#: avidemux/gtk_gui.cpp:2261
+#: avidemux/gtk_gui.cpp:2259
 msgid "Saving failed"
 msgstr "Salvataggio fallito"
 
-#: avidemux/gtk_gui.cpp:2261
+#: avidemux/gtk_gui.cpp:2259
 msgid "Saving the job failed. Maybe you have permission issue with ~/.avidemux"
 msgstr "Il salvataggio dell'attivit? ? fallito. Forse c'? un problema di permesso con ~/.avidemux"
 
-#: avidemux/gtk_gui.cpp:2273
+#: avidemux/gtk_gui.cpp:2271
 #, c-format
 msgid "File %s has been successfully saved."
 msgstr "Il file %s ? stato salvato con successo."
 
-#: avidemux/gtk_gui.cpp:2277
+#: avidemux/gtk_gui.cpp:2275
 #, c-format
 msgid "File %s was NOT saved correctly."
 msgstr "Il file %s non ? stato salvato correttamente."
 
-#: avidemux/gtk_gui.cpp:2431
+#: avidemux/gtk_gui.cpp:2438
 msgid "AvsProxy"
 msgstr "AvsProxy"
 
-#: avidemux/gtk_gui.cpp:2431
+#: avidemux/gtk_gui.cpp:2438
 msgid ""
 "Failed to connect to avsproxy.\n"
 "Is it running ?"
@@ -6964,23 +7409,23 @@
 "Connessione a avsproxy fallita.\n"
 "? in esecuzione?"
 
-#: avidemux/gtk_gui.cpp:2436
+#: avidemux/gtk_gui.cpp:2443
 msgid "avsproxy"
 msgstr "avsproxy"
 
-#: avidemux/gtk_gui.cpp:2464
+#: avidemux/gtk_gui.cpp:2471
 msgid "Frame type:"
 msgstr "Tipo di fotogramma:"
 
-#: avidemux/gtk_gui.cpp:2465
+#: avidemux/gtk_gui.cpp:2472
 msgid "Frame size:"
 msgstr "Dimensione fotogramma:"
 
-#: avidemux/gtk_gui.cpp:2467
+#: avidemux/gtk_gui.cpp:2474
 msgid "Frame Hex Dump"
 msgstr "Hex Dump fotogramma"
 
-#: avidemux/guiplay.cpp:365
+#: avidemux/guiplay.cpp:361
 msgid "Trouble initializing audio device"
 msgstr "Problema nell'inizializzare il dispositivo audio"
 
@@ -6992,11 +7437,23 @@
 msgid "An audio track is necessary to create such file"
 msgstr "? necessaria una traccia audio per creare questo tipo di file"
 
-#: avidemux/gui_autodrive.cpp:82
+#: avidemux/gui_autodrive.cpp:78
+msgid ""
+"You don't have LAME!.\n"
+"It is needed to create FLV  video."
+msgstr ""
+"Non disponi di LAME!\n"
+"? necessario per creare video FLV."
+
+#: avidemux/gui_autodrive.cpp:92
+msgid "Cannot select FLV1  codec."
+msgstr "Impossibile selezionare il codec FLV1."
+
+#: avidemux/gui_autodrive.cpp:119
 msgid "Cannot select mpeg4 sp codec."
 msgstr "Impossibile selezionare il codec mpeg4 sp."
 
-#: avidemux/gui_autodrive.cpp:117
+#: avidemux/gui_autodrive.cpp:154
 msgid ""
 "You don't have FAAC!.\n"
 "It is needed to create PSP compatible video."
@@ -7040,43 +7497,43 @@
 msgid "Cannot decode the frame."
 msgstr "Impossibile decodificare il fotogramma."
 
-#: avidemux/gui_savenew.cpp:87
+#: avidemux/gui_savenew.cpp:89
 msgid "Dual audio can only be used in copy mode"
 msgstr "Il doppio audio pu? essere usato solo in modalit? copia"
 
-#: avidemux/gui_savenew.cpp:87
+#: avidemux/gui_savenew.cpp:89
 msgid "Select Copy as the video codec."
 msgstr "Seleziona Copia come codec video."
 
-#: avidemux/gui_savenew.cpp:197
-#: avidemux/gui_savenew.cpp:213
-#: avidemux/gui_savenew.cpp:226
+#: avidemux/gui_savenew.cpp:207
+#: avidemux/gui_savenew.cpp:223
+#: avidemux/gui_savenew.cpp:236
 msgid "Incompatible output format"
 msgstr "Formato in uscita incompatibile"
 
-#: avidemux/gui_savenew.cpp:244
+#: avidemux/gui_savenew.cpp:254
 msgid "There is no second track"
 msgstr "Non c'? una seconda traccia"
 
-#: avidemux/gui_savenew.cpp:244
+#: avidemux/gui_savenew.cpp:254
 msgid "Select a second audio track in the Audio menu."
 msgstr "Seleziona una seconda traccia nel menu Audio."
 
-#: avidemux/gui_savenew.cpp:248
+#: avidemux/gui_savenew.cpp:258
 msgid "Select dual audio AVI to write"
 msgstr "Seleziona il file AVI con doppio audio da scrivere"
 
-#: avidemux/gui_savenew.cpp:270
-#: avidemux/gui_savenew.cpp:288
+#: avidemux/gui_savenew.cpp:280
+#: avidemux/gui_savenew.cpp:298
 msgid "This cannot have packed VOP"
 msgstr "Non pu? avere VOP compressi"
 
-#: avidemux/gui_savenew.cpp:270
-#: avidemux/gui_savenew.cpp:288
+#: avidemux/gui_savenew.cpp:280
+#: avidemux/gui_savenew.cpp:298
 msgid "It is not MPEG-4 video. File will not be saved."
 msgstr "Non ? un video MPEG-4. Il file non verr? salvato."
 
-#: avidemux/gui_savenew.cpp:334
+#: avidemux/gui_savenew.cpp:344
 msgid ""
 "You may need smart copy.\n"
 " Enable it ?"



From mean at mail.berlios.de  Wed Sep 19 20:40:48 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Wed, 19 Sep 2007 20:40:48 +0200
Subject: [Avidemux-svn-commit] r3591 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat
Message-ID: <200709191840.l8JIemwG002982@sheep.berlios.de>

Author: mean
Date: 2007-09-19 20:40:48 +0200 (Wed, 19 Sep 2007)
New Revision: 3591

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/matroskaenc.c
Log:
[MKV out] Fix vorbis header writting, asserts when av_write_header fails

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp	2007-09-19 17:45:21 UTC (rev 3590)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp	2007-09-19 18:40:48 UTC (rev 3591)
@@ -503,7 +503,7 @@
 		return 0;
         }
 
-	av_write_header(oc);
+	ADM_assert(av_write_header(oc)>=0);
 	dump_format(oc, 0, filename, 1);
 
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/matroskaenc.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/matroskaenc.c	2007-09-19 17:45:21 UTC (rev 3590)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/matroskaenc.c	2007-09-19 18:40:48 UTC (rev 3591)
@@ -388,6 +388,7 @@
 
 static int put_xiph_codecpriv(AVFormatContext *s, ByteIOContext *pb, AVCodecContext *codec)
 {
+#if 0 // MEANX avidemux does thing differently
     uint8_t *header_start[3];
     int header_len[3];
     int first_header_size;
@@ -412,6 +413,28 @@
         put_buffer(pb, header_start[j], header_len[j]);
 
     return 0;
+#else
+      // Not endian safe....
+      uint32_t packetLen[3],*ptr=(uint32_t *)codec->extradata;
+      uint8_t *data[3],i,j;
+      if( 3*4+ptr[0]+ptr[1]+ptr[2]!=codec->extradata_size)
+      {
+        av_log(s, AV_LOG_ERROR, "Broken avidemux xiph header.\n");
+        return -1;
+      }
+      data[0]=codec->extradata+3*4;
+      data[1]=data[0]+ptr[0];
+      data[2]=data[1]+ptr[1];
+      put_byte(pb, 2);                    // number packets - 1
+      for (j = 0; j < 2; j++) 
+      {
+          put_xiph_size(pb, ptr[j]);
+      }
+      for (j = 0; j < 3; j++)
+        put_buffer(pb, data[j], ptr[j]);
+      
+      return 0; // /MEANX
+#endif
 }
 
 #define FLAC_STREAMINFO_SIZE 34



From mean at mail.berlios.de  Sun Sep 23 12:02:52 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 23 Sep 2007 12:02:52 +0200
Subject: [Avidemux-svn-commit] r3592 - in
	branches/avidemux_2.4_branch/avidemux: . ADM_audiofilter
	ADM_libraries/ADM_lavformat
Message-ID: <200709231002.l8NA2qPt005545@sheep.berlios.de>

Author: mean
Date: 2007-09-23 12:02:52 +0200 (Sun, 23 Sep 2007)
New Revision: 3592

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioencoder_config.h
   branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioencoder_lame.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioencoder_lame_param.h
   branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioeng_buildfilters.h
   branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiofilter_buildchain.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp
   branches/avidemux_2.4_branch/avidemux/gui_autodrive.cpp
Log:
[Lame out] Set disableReservoir bit to easily make FLV files

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp	2007-09-19 18:40:48 UTC (rev 3591)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp	2007-09-23 10:02:52 UTC (rev 3592)
@@ -405,7 +405,6 @@
 	audioPrintCurrentCodec();
 
 }
-
 void audioCodecSelect( void )
 {
 	DIA_audioCodec( &activeAudioEncoder );

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioencoder_config.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioencoder_config.h	2007-09-19 18:40:48 UTC (rev 3591)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioencoder_config.h	2007-09-23 10:02:52 UTC (rev 3592)
@@ -41,7 +41,8 @@
 {
   ADM_LAME_PRESET_CBR,
   ADM_STEREO,
-  2
+  2,
+  0 /* Reservoir enable by default */
 };
 #ifdef HAVE_LIBMP3LAME
 extern int DIA_getLameSettings(ADM_audioEncoderDescriptor *descriptor);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioencoder_lame.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioencoder_lame.cpp	2007-09-19 18:40:48 UTC (rev 3591)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioencoder_lame.cpp	2007-09-23 10:02:52 UTC (rev 3592)
@@ -91,6 +91,7 @@
     ret = lame_set_out_samplerate(MYFLAGS, frequence);
 
     ret = lame_set_quality(MYFLAGS, 2);
+    
     if (_wavheader->channels == 2)
       {
         switch (lameConf->mode)
@@ -116,26 +117,28 @@
         ret = lame_set_brate(MYFLAGS, config->bitrate);
         ret = lame_set_mode(MYFLAGS, mmode);	// 0 stereo 1 jstero
         ret = lame_set_quality(MYFLAGS, lameConf->quality);	// 0 stereo 1 jstero
+        ret = lame_set_disable_reservoir(MYFLAGS,lameConf->disableReservoir);
         printf("[Lame]Using quality of %d\n",lame_get_quality(MYFLAGS));
         ret = lame_init_params(MYFLAGS);
     if (ret == -1)
 	return 0;
     // update bitrate in header
     _wavheader->byterate = (config->bitrate >> 3) * 1000;
-   
+#define BLOCK_SIZE 1152
     // configure CBR/ABR/...
     _preset=lameConf->preset;
     switch(_preset)
     {
     	default:
-    	case ADM_LAME_PRESET_CBR: break;
+    	case ADM_LAME_PRESET_CBR: 
+          break;
 	case ADM_LAME_PRESET_ABR:
 	  
           lame_set_preset( MYFLAGS, config->bitrate);
-	  _wavheader->blockalign=1152;
+	  _wavheader->blockalign=BLOCK_SIZE;
 	 break;
 	case ADM_LAME_PRESET_EXTREME: 
-	  _wavheader->blockalign=1152;
+	  _wavheader->blockalign=BLOCK_SIZE;
           lame_set_preset( MYFLAGS, EXTREME);	
 	break;
     
@@ -144,7 +147,7 @@
 
     lame_print_config(MYFLAGS);
     lame_print_internals(MYFLAGS);
-    _chunk=1152*_wavheader->channels;
+    _chunk=BLOCK_SIZE*_wavheader->channels;
     return 1;
 }
 uint8_t	AUDMEncoder_Lame::isVBR(void )
@@ -158,7 +161,7 @@
 {
   int32_t nbout;
   
-        *samples = 1152; //FIXME
+        *samples = BLOCK_SIZE; //FIXME
         *len = 0;
 
         if(!refillBuffer(_chunk ))
@@ -187,6 +190,8 @@
           return 0;
         }
         *len=nbout;
+        if(!*len) *samples=0;
+        //printf("Audio packet : size %u, sample %u\n",*len,*samples);
         return 1;
 }
 /**
@@ -244,10 +249,11 @@
     
     
     diaElemUInteger quality(PX(quality),_("_Quality:"),0,9);
+    diaElemToggle reservoir(PX(disableReservoir),_("_Disable reservoir:"));
   
-      diaElem *elems[]={&menuMode,&Mode,&quality,&bitrate};
+      diaElem *elems[]={&menuMode,&Mode,&quality,&bitrate,&reservoir};
     
-  if( diaFactoryRun("LAME Configuration",4,elems))
+  if( diaFactoryRun("LAME Configuration",5,elems))
   {
     lameParam->mode=(ADM_mode)mmode; 
     lameParam->preset=(ADM_LAME_PRESET)ppreset;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioencoder_lame_param.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioencoder_lame_param.h	2007-09-19 18:40:48 UTC (rev 3591)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioencoder_lame_param.h	2007-09-23 10:02:52 UTC (rev 3592)
@@ -25,6 +25,7 @@
   ADM_LAME_PRESET preset;
   ADM_mode        mode;
   uint32_t        quality;
+  uint32_t        disableReservoir; // usefull for strict CBR (FLV)
 }LAME_encoderParam;
 
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioeng_buildfilters.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioeng_buildfilters.h	2007-09-19 18:40:48 UTC (rev 3591)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioeng_buildfilters.h	2007-09-23 10:02:52 UTC (rev 3592)
@@ -34,6 +34,7 @@
 
 void audioCodecConfigure( void );
 void audioCodecSelect( void );
+void audioFilter_MP3DisableReservoir(int onoff);
 uint32_t audioFilter_getOuputCodec(void);
 uint32_t audioFilter_getOuputFrequency(uint32_t inputFrequency);
 typedef enum 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiofilter_buildchain.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiofilter_buildchain.cpp	2007-09-19 18:40:48 UTC (rev 3591)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audiofilter_buildchain.cpp	2007-09-23 10:02:52 UTC (rev 3592)
@@ -443,6 +443,22 @@
     currentaudiostream->endDecompress();
 
 }
+/**
+    \fn     audioFilter_MP3DisableReservoir
+    \brief  Set/unset the disable reservoir bit, usefull for strict mp3 frame boundaries(FLV)
+
+*/
+void audioFilter_MP3DisableReservoir(int onoff)
+{
+      if(activeAudioEncoder!=AUDIOENC_MP3) return;
+      ADM_audioEncoderDescriptor *desc=getAudioDescriptor( activeAudioEncoder);
+      ADM_assert(desc);
+      LAME_encoderParam *param=(LAME_encoderParam *)desc->param;
+      ADM_assert(param);
+      param->disableReservoir=onoff;
+  
+}
+
 /**********************************************/
 ADM_audioEncoderDescriptor *getAudioDescriptor( AUDIOENCODER encoder)
 {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp	2007-09-19 18:40:48 UTC (rev 3591)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp	2007-09-23 10:02:52 UTC (rev 3592)
@@ -525,6 +525,8 @@
         double f;
         int64_t timeInUs;
 
+            //printf("Audio paclet : size %u, sample %u\n",len,sample);
+        
            if(!audio_st) return 0;
            if(!len) return 1;
             av_init_packet(&pkt);

Modified: branches/avidemux_2.4_branch/avidemux/gui_autodrive.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gui_autodrive.cpp	2007-09-19 18:40:48 UTC (rev 3591)
+++ branches/avidemux_2.4_branch/avidemux/gui_autodrive.cpp	2007-09-23 10:02:52 UTC (rev 3592)
@@ -71,6 +71,7 @@
 #ifdef HAVE_LIBMP3LAME
         					audioCodecSetcodec(AUDIOENC_MP3);
         					audioFilter_SetBitrate(128);
+                                                audioFilter_MP3DisableReservoir(1);
         					// set fq
         					
 #else



From gruntster at mail.berlios.de  Sun Sep 23 17:51:45 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 23 Sep 2007 17:51:45 +0200
Subject: [Avidemux-svn-commit] r3593 -
	branches/avidemux_2.4_branch/avidemux/winInstaller
Message-ID: <200709231551.l8NFpjcL010313@sheep.berlios.de>

Author: gruntster
Date: 2007-09-23 17:51:36 +0200 (Sun, 23 Sep 2007)
New Revision: 3593

Modified:
   branches/avidemux_2.4_branch/avidemux/winInstaller/avidemux.nsi
Log:
[Win32] update installer with GTK 2.12

Modified: branches/avidemux_2.4_branch/avidemux/winInstaller/avidemux.nsi
===================================================================
--- branches/avidemux_2.4_branch/avidemux/winInstaller/avidemux.nsi	2007-09-23 10:02:52 UTC (rev 3592)
+++ branches/avidemux_2.4_branch/avidemux/winInstaller/avidemux.nsi	2007-09-23 15:51:36 UTC (rev 3593)
@@ -152,6 +152,8 @@
         File ..\..\..\avidemux_2.4_build\libpango-1.0-0.dll
         File ..\..\..\avidemux_2.4_build\libpangocairo-1.0-0.dll
         File ..\..\..\avidemux_2.4_build\libpangowin32-1.0-0.dll
+        File ..\..\..\avidemux_2.4_build\jpeg62.dll
+        File ..\..\..\avidemux_2.4_build\libtiff3.dll
         WriteRegStr HKLM "${REGKEY}\Components" GTK+ 1
     SectionEnd
     
@@ -560,6 +562,8 @@
 SectionEnd
 
 Section /o un.GTK+ UnSecUiGtk
+    Delete /REBOOTOK $INSTDIR\jpeg62.dll
+    Delete /REBOOTOK $INSTDIR\libtiff3.dll
     Delete /REBOOTOK $INSTDIR\libpangowin32-1.0-0.dll
     Delete /REBOOTOK $INSTDIR\libpangocairo-1.0-0.dll
     Delete /REBOOTOK $INSTDIR\libpango-1.0-0.dll



From gruntster at mail.berlios.de  Sun Sep 23 20:36:57 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 23 Sep 2007 20:36:57 +0200
Subject: [Avidemux-svn-commit] r3594 - in branches/avidemux_2.4_branch: .
	avidemux/ADM_audiofilter
Message-ID: <200709231836.l8NIavGD002981@sheep.berlios.de>

Author: gruntster
Date: 2007-09-23 20:36:44 +0200 (Sun, 23 Sep 2007)
New Revision: 3594

Modified:
   branches/avidemux_2.4_branch/ConfigureChecks.cmake
   branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioencoder_aften.cpp
   branches/avidemux_2.4_branch/config.h.cmake
Log:
[Aften] add support for Aften 0.08 (CMake only)

Modified: branches/avidemux_2.4_branch/ConfigureChecks.cmake
===================================================================
--- branches/avidemux_2.4_branch/ConfigureChecks.cmake	2007-09-23 15:51:36 UTC (rev 3593)
+++ branches/avidemux_2.4_branch/ConfigureChecks.cmake	2007-09-23 18:36:44 UTC (rev 3594)
@@ -217,21 +217,38 @@
 # Aften
 ########################################
 if(WIN32)
-SET(CMAKE_REQUIRED_FLAGS "-lm -lpthreadGC2")
+	SET(CMAKE_REQUIRED_FLAGS "-lm -lpthreadGC2")
 else(WIN32)
-SET(CMAKE_REQUIRED_FLAGS "-lm -lpthread")
+	SET(CMAKE_REQUIRED_FLAGS "-lm -lpthread")
 endif(WIN32)
 
 ADM_CHECK_HL(Aften aften/aften.h  aften aften_encode_init USE_AFTEN)
+
 if(USE_AFTEN)
-# TODO! Check aften version 5/6/7!
-SET(USE_AFTEN_07 1)
+	TRY_RUN(AFTEN_TEST_RUN_RESULT
+		AFTEN_TEST_COMPILE_RESULT
+		${CMAKE_BINARY_DIR}
+		"${CMAKE_SOURCE_DIR}/cmake_compile_check/aften_check.cpp"
+		CMAKE_FLAGS
+		-DLINK_LIBRARIES:STRING=-laften
+		OUTPUT_VARIABLE AFTEN_OUTPUT)
+
+	if(AFTEN_TEST_RUN_RESULT EQUAL 8)
+		MESSAGE(STATUS "Aften Version: 0.0.8")
+		SET(USE_AFTEN_08 1)
+	elseif(AFTEN_TEST_RUN_RESULT EQUAL 7)
+		MESSAGE(STATUS "Aften Version: 0.07")
+		SET(USE_AFTEN_07 1)
+	endif(AFTEN_TEST_RUN_RESULT EQUAL 8)
 endif(USE_AFTEN)
+
 SET(CMAKE_REQUIRED_FLAGS "")
+
 ########################################
 # SRC
 ########################################
 ADM_CHECK_HL(libsamplerate samplerate.h samplerate src_get_version USE_SRC)
+
 ########################################
 # ICONV
 ########################################

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioencoder_aften.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioencoder_aften.cpp	2007-09-23 15:51:36 UTC (rev 3593)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiofilter/audioencoder_aften.cpp	2007-09-23 18:36:44 UTC (rev 3594)
@@ -35,7 +35,7 @@
 {
 #if defined(USE_AFTEN_06)
 	#include "aften.h"
-#else	// Aften 0.05 & 0.07
+#else	// Aften 0.05 & 0.07 onwards
 	#include "aften/aften.h"
 #endif
 };
@@ -51,8 +51,11 @@
   memset(_handle,0,sizeof(AftenContext));
   aften_set_defaults(_HANDLE);
   _wavheader->encoding=WAV_AC3;
-#ifdef USE_AFTEN_07
+#if defined(USE_AFTEN_05) || defined(USE_AFTEN_06)
+#elif defined(USE_AFTEN_07)
   _HANDLE->params.n_threads=1; // MThread collides with avidemux multithreading
+#else
+  _HANDLE->system.n_threads=1;
 #endif
 };
 
@@ -142,9 +145,9 @@
         ADM_assert(tmptail>=tmphead);
 
 #ifdef USE_AFTEN_05
-		aften_remap_wav_to_a52(ptr, 256*6, _wavheader->channels, A52_SAMPLE_FMT_FLT, (_HANDLE->acmod), (_HANDLE->lfe));
+		aften_remap_wav_to_a52(ptr, 256*6, _wavheader->channels, A52_SAMPLE_FMT_FLT, _HANDLE->acmod, _HANDLE->lfe);
 #else
-		aften_remap_wav_to_a52(ptr, 256*6, _wavheader->channels, A52_SAMPLE_FMT_FLT, (_HANDLE->acmod));
+		aften_remap_wav_to_a52(ptr, 256*6, _wavheader->channels, A52_SAMPLE_FMT_FLT, _HANDLE->acmod);
 #endif
 
         r=aften_encode_frame(_HANDLE, dest,(void *)ptr);

Modified: branches/avidemux_2.4_branch/config.h.cmake
===================================================================
--- branches/avidemux_2.4_branch/config.h.cmake	2007-09-23 15:51:36 UTC (rev 3593)
+++ branches/avidemux_2.4_branch/config.h.cmake	2007-09-23 18:36:44 UTC (rev 3594)
@@ -219,14 +219,12 @@
 /* use Aften AC3 encoder */
 #cmakedefine USE_AFTEN
 
-/* Use Aften 0.05 or earlier */
-#cmakedefine USE_AFTEN_05
-
-/* Use Aften 0.06 */
-#cmakedefine USE_AFTEN_06
-/*               */
+/* Use Aften 0.07 */
 #cmakedefine USE_AFTEN_07
 
+/* Use Aften 0.08 */
+#cmakedefine USE_AFTEN_08
+
 /* AltiVec for mpeg2enc */
 #cmakedefine USE_ALTIVEC
 



From gruntster at mail.berlios.de  Sun Sep 23 20:40:19 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Sun, 23 Sep 2007 20:40:19 +0200
Subject: [Avidemux-svn-commit] r3595 -
	branches/avidemux_2.4_branch/cmake_compile_check
Message-ID: <200709231840.l8NIeJ8k003197@sheep.berlios.de>

Author: gruntster
Date: 2007-09-23 20:40:07 +0200 (Sun, 23 Sep 2007)
New Revision: 3595

Added:
   branches/avidemux_2.4_branch/cmake_compile_check/aften_check.cpp
Log:
[Aften] Aften 0.08 support, part 2

Added: branches/avidemux_2.4_branch/cmake_compile_check/aften_check.cpp
===================================================================
--- branches/avidemux_2.4_branch/cmake_compile_check/aften_check.cpp	2007-09-23 18:36:44 UTC (rev 3594)
+++ branches/avidemux_2.4_branch/cmake_compile_check/aften_check.cpp	2007-09-23 18:40:07 UTC (rev 3595)
@@ -0,0 +1,14 @@
+#include <string.h>
+#include <aften/aften.h>
+
+int main(int argc, char **argv)
+{
+	const char* aftenVersion = aften_get_version();
+
+	if (strcmp(aftenVersion, "0.07") == 0)
+		return 7;
+	else if (strcmp(aftenVersion, "0.0.8") == 0)
+		return 8;
+
+	return 0;
+}



From gruntster at mail.berlios.de  Tue Sep 25 14:01:50 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 25 Sep 2007 14:01:50 +0200
Subject: [Avidemux-svn-commit] r3596 -
	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_smjs
Message-ID: <200709251201.l8PC1ojq006833@sheep.berlios.de>

Author: gruntster
Date: 2007-09-25 14:01:43 +0200 (Tue, 25 Sep 2007)
New Revision: 3596

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_smjs/CMakeLists.txt
Log:
[CMake] drop unnecessary main function as it causes conflict on Windows and Mac

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_smjs/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_smjs/CMakeLists.txt	2007-09-23 18:40:07 UTC (rev 3595)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_smjs/CMakeLists.txt	2007-09-25 12:01:43 UTC (rev 3596)
@@ -6,7 +6,7 @@
 #
 SET(${ADM_LIB}_SRCS 
 jsapi.c    jsatom.c  jscntxt.c   jsdbgapi.c  jsemit.c  jsfun.c   jsinterp.c  jslong.c  jsobj.c     jsprf.c     jsscope.c   jsutil.c    prmjtime.c
-jsarena.c  jsbool.c  jscpucfg.c  jsdhash.c   jsexn.c   jsgc.c    jslock.c    jsmath.c  jsopcode.c  jsregexp.c  jsscript.c  jsxdrapi.c
+jsarena.c  jsbool.c  jsdhash.c   jsexn.c   jsgc.c    jslock.c    jsmath.c  jsopcode.c  jsregexp.c  jsscript.c  jsxdrapi.c
 jsarray.c  jsdate.c    jsdtoa.c    jsfile.c  jshash.c  jslog2.c    jsnum.c   jsparse.c   jsscan.c    jsstr.c     jsxml.c
 )
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})



From gruntster at mail.berlios.de  Tue Sep 25 20:09:58 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Tue, 25 Sep 2007 20:09:58 +0200
Subject: [Avidemux-svn-commit] r3597 - in branches/avidemux_2.4_branch:
	avidemux avidemux/ADM_audiodevice
	avidemux/ADM_libraries/ADM_utilities
	avidemux/ADM_userInterfaces/ADM_GTK
	avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog
	avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2
	avidemux/ADM_userInterfaces/ADM_NONE
	avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog
	avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2
	avidemux/ADM_userInterfaces/ADM_QT4
	avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog
	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui
	avidemux/ADM_userInterfaces/ADM_commonUI avidemux/ADM_video po
Message-ID: <200709251809.l8PI9wxJ016722@sheep.berlios.de>

Author: gruntster
Date: 2007-09-25 20:08:12 +0200 (Tue, 25 Sep 2007)
New Revision: 3597

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_gettext.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ui_support.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ui_support.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp
   branches/avidemux_2.4_branch/po/avidemux.pro
   branches/avidemux_2.4_branch/po/qt_update_pro.sh
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_audiodevice/ADM_audiodevice.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/default.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_about.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_preview.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/preview_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_genvideo.hxx
   branches/avidemux_2.4_branch/avidemux/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/Makefile.am
   branches/avidemux_2.4_branch/avidemux/main.cpp
   branches/avidemux_2.4_branch/po/update_pot.bash
Log:
[I18N] use Qt4's Translator instead of gettext for Qt4 UI (part I)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiodevice/ADM_audiodevice.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiodevice/ADM_audiodevice.cpp	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiodevice/ADM_audiodevice.cpp	2007-09-25 18:08:12 UTC (rev 3597)
@@ -79,7 +79,6 @@
 static AUDIO_DEVICE  currentDevice=DEVICE_DUMMY;
 static AUDIO_DEVICE ADM_audioByName(const char *name);
 static const char *ADM_audioById(AUDIO_DEVICE id);
-extern void DIA_getAudioDevice(AUDIO_DEVICE *id);
 
 void AVDM_audioSave( void )
 {

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_gettext.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_gettext.cpp	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/ADM_gettext.cpp	2007-09-25 18:08:12 UTC (rev 3597)
@@ -0,0 +1,37 @@
+#include "config.h"
+
+#ifdef HAVE_GETTEXT
+#include <libintl.h>
+
+void initGetText(void)
+{
+	char *local = setlocale(LC_ALL, "");
+
+#ifdef ADM_WIN32
+	bindtextdomain("avidemux", "./share/locale");
+#else
+	bindtextdomain("avidemux", ADMLOCALE);
+#endif
+
+	bind_textdomain_codeset("avidemux", "UTF-8");
+  
+	if(local)
+		printf("\n[Locale] setlocale %s\n", local);
+
+	local = textdomain(NULL);
+	textdomain("avidemux");
+
+	if(local)
+	    printf("[Locale] Textdomain was %s\n", local);
+
+	local = textdomain(NULL);
+
+	if(local)
+		printf("[Locale] Textdomain is now %s\n", local);
+
+#ifndef ADM_WIN32
+	printf("[Locale] Files for %s appear to be in %s\n","avidemux", ADMLOCALE);
+#endif
+	printf("[Locale] Test: %s\n\n", dgettext("avidemux", "_File"));
+};
+#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/CMakeLists.txt	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/CMakeLists.txt	2007-09-25 18:08:12 UTC (rev 3597)
@@ -7,7 +7,7 @@
 SET(${ADM_LIB}_SRCS 
 ADM_bitstream.cpp  ADM_image.cpp         ADM_imageUtils.cpp  ADM_print.cpp    aviframe.cpp    aviio.cpp   fourcc.cpp  subchunk.cpp
 ADM_fileio.cpp     ADM_imageResizer.cpp  ADM_pp.cpp          avidemutils.cpp  aviindexer.cpp  broken.cpp  prefs.cpp
-ADM_imageLoader.cpp
+ADM_imageLoader.cpp  ADM_gettext.cpp
 )
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
 ADD_ADM_LIB(${ADM_LIB} ADM_libraries)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/Makefile.am	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/Makefile.am	2007-09-25 18:08:12 UTC (rev 3597)
@@ -8,7 +8,7 @@
 libADM_library_a_SOURCES = subchunk.cpp  fourcc.cpp broken.cpp \
 		aviio.cpp aviindexer.cpp aviframe.cpp avidemutils.cpp ADM_image.cpp \
 	ADM_fileio.cpp ADM_print.cpp ADM_imageUtils.cpp ADM_bitstream.cpp \
-	ADM_imageResizer.cpp ADM_pp.cpp prefs.cpp ADM_imageLoader.cpp
+	ADM_imageResizer.cpp ADM_pp.cpp prefs.cpp ADM_imageLoader.cpp ADM_gettext.cpp
 
 
 EXTRA_DIST =  ADM_bitstream.cpp  ADM_image.cpp     \

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/default.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/default.h	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/default.h	2007-09-25 18:08:12 UTC (rev 3597)
@@ -69,33 +69,29 @@
 #define ADM_OK 	1
 #define ADM_IGN 2
 
-// For win32, useless else
-#ifdef __cplusplus
-uint64_t ftello_adm(FILE *f);
-int fseeko_adm(FILE *f,fpos_t off,int whence);
-#endif
 /*
  * Standard gettext macros.
  */
 #ifdef HAVE_GETTEXT
 #  include <libintl.h>
 #  undef _
-#  define _(String) dgettext (PACKAGE, String)
-#  ifdef gettext_noop
-#    define N_(String) gettext_noop (String)
-#  else
-#    define N_(String) (String)
-#  endif
 #else
 #  define textdomain(String) (String)
 #  define gettext(String) (String)
 #  define dgettext(Domain,Message) (Message)
 #  define dcgettext(Domain,Message,Type) (Message)
 #  define bindtextdomain(Domain,Directory) (Domain)
-#  define _(String) (String)
-#  define N_(String) (String)
 #endif
 
+extern const char* translate(const char *__domainname, const char *__msgid);
+#define _(String) translate (PACKAGE, String)
+
+#ifdef QT_TR_NOOP
+#undef QT_TR_NOOP
+#endif
+
+#define QT_TR_NOOP(String) translate (PACKAGE, String)
+
 #if (defined( HAVE_LIBESD) && defined(HAVE_ESD_H)) || \
  defined(OSS_SUPPORT) || defined (USE_ARTS) || \
   defined(USE_SDL) || defined(CONFIG_DARWIN) || \

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_about.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_about.cpp	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_about.cpp	2007-09-25 18:08:12 UTC (rev 3597)
@@ -50,31 +50,28 @@
     "Muddy",
     NULL
   };
-  /* TRANSLATORS: Replace this string with your names, one name per line. */
-  gchar *translators = _("translator-credits");
+
   GdkPixbuf *aboutdialog1_logo_pixbuf;
   // MEANX : PATCH SVN VERSION
   char subversion[1024];
-  	if(!ADM_SUBVERSION)
-		{
-			strcpy(subversion,VERSION);
-		}
-		else
-		{
-			sprintf(subversion,"%s (r%04u):",VERSION,ADM_SUBVERSION);
-		}
+
+  if(!ADM_SUBVERSION)
+	strcpy(subversion,VERSION);
+  else
+	sprintf(subversion,"%s (r%04u):",VERSION,ADM_SUBVERSION);
+
   aboutdialog1 = gtk_about_dialog_new ();
   gtk_about_dialog_set_version (GTK_ABOUT_DIALOG (aboutdialog1), subversion);
 // /MEANX
   gtk_about_dialog_set_name (GTK_ABOUT_DIALOG (aboutdialog1), _("Avidemux"));
-  gtk_about_dialog_set_copyright (GTK_ABOUT_DIALOG (aboutdialog1), _("\302\251 2001-2006 Mean"));
+  gtk_about_dialog_set_copyright (GTK_ABOUT_DIALOG (aboutdialog1), _("\302\251 2001-2007 Mean"));
   gtk_about_dialog_set_comments (GTK_ABOUT_DIALOG (aboutdialog1), _("Multiplatform video editor"));
-  gtk_about_dialog_set_license (GTK_ABOUT_DIALOG (aboutdialog1), _("Avidemux is free software; you can redistribute it and/or modify it \nunder the terms of the GNU General Public License version 2 \nas published by the Free Software Foundation.\n\n\t\t    GNU GENERAL PUBLIC LICENSE\n\t\t       Version 2, June 1991\n\n Copyright (C) 1989, 1991 Free Software Foundation, Inc.\n                       51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA\n Everyone is permitted to copy and distribute verbatim copies\n of this license document, but changing it is not allowed.\n\n\t\t\t    Preamble\n\n  The licenses for most software are designed to take away your\nfreedom to share and change it.  By contrast, the GNU General Public\nLicense is intended to guarantee your freedom to share and change free\nsoftware--to make sure the software is free for all its users.  This\nGeneral Public License applies to most of the Free Software\nFoundation's software and to any other progr!
 am whose authors commit to\nusing it.  (Some other Free Software Foundation software is covered by\nthe GNU Library General Public License instead.)  You can apply it to\nyour programs, too.\n\n  When we speak of free software, we are referring to freedom, not\nprice.  Our General Public Licenses are designed to make sure that you\nhave the freedom to distribute copies of free software (and charge for\nthis service if you wish), that you receive source code or can get it\nif you want it, that you can change the software or use pieces of it\nin new free programs; and that you know you can do these things.\n\n  To protect your rights, we need to make restrictions that forbid\nanyone to deny you these rights or to ask you to surrender the rights.\nThese restrictions translate to certain responsibilities for you if you\ndistribute copies of the software, or if you modify it.\n\n  For example, if you distribute copies of such a program, whether\ngratis or for a fee, you must giv!
 e the recipients all the rights that\nyou have.  You must make!
  sure th
at they, too, receive or can get the\nsource code.  And you must show them these terms so they know their\nrights.\n\n  We protect your rights with two steps: (1) copyright the software, and\n(2) offer you this license which gives you legal permission to copy,\ndistribute and/or modify the software.\n\n  Also, for each author's protection and ours, we want to make certain\nthat everyone understands that there is no warranty for this free\nsoftware.  If the software is modified by someone else and passed on, we\nwant its recipients to know that what they have is not the original, so\nthat any problems introduced by others will not reflect on the original\nauthors' reputations.\n\n  Finally, any free program is threatened constantly by software\npatents.  We wish to avoid the danger that redistributors of a free\nprogram will individually obtain patent licenses, in effect making the\nprogram proprietary.  To prevent this, we have made it clear that any\npatent must be licensed!
  for everyone's free use or not licensed at all.\n\n  The precise terms and conditions for copying, distribution and\nmodification follow.\n\n\t\t    GNU GENERAL PUBLIC LICENSE\n   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION\n\n  0. This License applies to any program or other work which contains\na notice placed by the copyright holder saying it may be distributed\nunder the terms of this General Public License.  The \"Program\", below,\nrefers to any such program or work, and a \"work based on the Program\"\nmeans either the Program or any derivative work under copyright law:\nthat is to say, a work containing the Program or a portion of it,\neither verbatim or with modifications and/or translated into another\nlanguage.  (Hereinafter, translation is included without limitation in\nthe term \"modification\".)  Each licensee is addressed as \"you\".\n\nActivities other than copying, distribution and modification are not\ncovered by this License; they ar!
 e outside its scope.  The act of\nrunning the Program is not r!
 estricte
d, and the output from the Program\nis covered only if its contents constitute a work based on the\nProgram (independent of having been made by running the Program).\nWhether that is true depends on what the Program does.\n\n  1. You may copy and distribute verbatim copies of the Program's\nsource code as you receive it, in any medium, provided that you\nconspicuously and appropriately publish on each copy an appropriate\ncopyright notice and disclaimer of warranty; keep intact all the\nnotices that refer to this License and to the absence of any warranty;\nand give any other recipients of the Program a copy of this License\nalong with the Program.\n\nYou may charge a fee for the physical act of transferring a copy, and\nyou may at your option offer warranty protection in exchange for a fee.\n\n  2. You may modify your copy or copies of the Program or any portion\nof it, thus forming a work based on the Program, and copy and\ndistribute such modifications or work under the t!
 erms of Section 1\nabove, provided that you also meet all of these conditions:\n\n    a) You must cause the modified files to carry prominent notices\n    stating that you changed the files and the date of any change.\n\n    b) You must cause any work that you distribute or publish, that in\n    whole or in part contains or is derived from the Program or any\n    part thereof, to be licensed as a whole at no charge to all third\n    parties under the terms of this License.\n\n    c) If the modified program normally reads commands interactively\n    when run, you must cause it, when started running for such\n    interactive use in the most ordinary way, to print or display an\n    announcement including an appropriate copyright notice and a\n    notice that there is no warranty (or else, saying that you provide\n    a warranty) and that users may redistribute the program under\n    these conditions, and telling the user how to view a copy of this\n    License.  (Exception: i!
 f the Program itself is interactive but\n    does not normally!
  print s
uch an announcement, your work based on\n    the Program is not required to print an announcement.)\n\nThese requirements apply to the modified work as a whole.  If\nidentifiable sections of that work are not derived from the Program,\nand can be reasonably considered independent and separate works in\nthemselves, then this License, and its terms, do not apply to those\nsections when you distribute them as separate works.  But when you\ndistribute the same sections as part of a whole which is a work based\non the Program, the distribution of the whole must be on the terms of\nthis License, whose permissions for other licensees extend to the\nentire whole, and thus to each and every part regardless of who wrote it.\n\nThus, it is not the intent of this section to claim rights or contest\nyour rights to work written entirely by you; rather, the intent is to\nexercise the right to control the distribution of derivative or\ncollective works based on the Program.\n\nIn addition, !
 mere aggregation of another work not based on the Program\nwith the Program (or with a work based on the Program) on a volume of\na storage or distribution medium does not bring the other work under\nthe scope of this License.\n\n  3. You may copy and distribute the Program (or a work based on it,\nunder Section 2) in object code or executable form under the terms of\nSections 1 and 2 above provided that you also do one of the following:\n\n    a) Accompany it with the complete corresponding machine-readable\n    source code, which must be distributed under the terms of Sections\n    1 and 2 above on a medium customarily used for software interchange; or,\n\n    b) Accompany it with a written offer, valid for at least three\n    years, to give any third party, for a charge no more than your\n    cost of physically performing source distribution, a complete\n    machine-readable copy of the corresponding source code, to be\n    distributed under the terms of Sections 1 and 2!
  above on a medium\n    customarily used for software intercha!
 nge; or,
\n\n    c) Accompany it with the information you received as to the offer\n    to distribute corresponding source code.  (This alternative is\n    allowed only for noncommercial distribution and only if you\n    received the program in object code or executable form with such\n    an offer, in accord with Subsection b above.)\n\nThe source code for a work means the preferred form of the work for\nmaking modifications to it.  For an executable work, complete source\ncode means all the source code for all modules it contains, plus any\nassociated interface definition files, plus the scripts used to\ncontrol compilation and installation of the executable.  However, as a\nspecial exception, the source code distributed need not include\nanything that is normally distributed (in either source or binary\nform) with the major components (compiler, kernel, and so on) of the\noperating system on which the executable runs, unless that component\nitself accompanies the executable.\n\nIf!
  distribution of executable or object code is made by offering\naccess to copy from a designated place, then offering equivalent\naccess to copy the source code from the same place counts as\ndistribution of the source code, even though third parties are not\ncompelled to copy the source along with the object code.\n\n  4. You may not copy, modify, sublicense, or distribute the Program\nexcept as expressly provided under this License.  Any attempt\notherwise to copy, modify, sublicense or distribute the Program is\nvoid, and will automatically terminate your rights under this License.\nHowever, parties who have received copies, or rights, from you under\nthis License will not have their licenses terminated so long as such\nparties remain in full compliance.\n\n  5. You are not required to accept this License, since you have not\nsigned it.  However, nothing else grants you permission to modify or\ndistribute the Program or its derivative works.  These actions are\nprohibite!
 d by law if you do not accept this License.  Therefore, by\nmo!
 difying 
or distributing the Program (or any work based on the\nProgram), you indicate your acceptance of this License to do so, and\nall its terms and conditions for copying, distributing or modifying\nthe Program or works based on it.\n\n  6. Each time you redistribute the Program (or any work based on the\nProgram), the recipient automatically receives a license from the\noriginal licensor to copy, distribute or modify the Program subject to\nthese terms and conditions.  You may not impose any further\nrestrictions on the recipients' exercise of the rights granted herein.\nYou are not responsible for enforcing compliance by third parties to\nthis License.\n\n  7. If, as a consequence of a court judgment or allegation of patent\ninfringement or for any other reason (not limited to patent issues),\nconditions are imposed on you (whether by court order, agreement or\notherwise) that contradict the conditions of this License, they do not\nexcuse you from the conditions of this License!
 .  If you cannot\ndistribute so as to satisfy simultaneously your obligations under this\nLicense and any other pertinent obligations, then as a consequence you\nmay not distribute the Program at all.  For example, if a patent\nlicense would not permit royalty-free redistribution of the Program by\nall those who receive copies directly or indirectly through you, then\nthe only way you could satisfy both it and this License would be to\nrefrain entirely from distribution of the Program.\n\nIf any portion of this section is held invalid or unenforceable under\nany particular circumstance, the balance of the section is intended to\napply and the section as a whole is intended to apply in other\ncircumstances.\n\nIt is not the purpose of this section to induce you to infringe any\npatents or other property right claims or to contest validity of any\nsuch claims; this section has the sole purpose of protecting the\nintegrity of the free software distribution system, which is\nim!
 plemented by public license practices.  Many people have made\!
 ngenerou
s contributions to the wide range of software distributed\nthrough that system in reliance on consistent application of that\nsystem; it is up to the author/donor to decide if he or she is willing\nto distribute software through any other system and a licensee cannot\nimpose that choice.\n\nThis section is intended to make thoroughly clear what is believed to\nbe a consequence of the rest of this License.\n\n  8. If the distribution and/or use of the Program is restricted in\ncertain countries either by patents or by copyrighted interfaces, the\noriginal copyright holder who places the Program under this License\nmay add an explicit geographical distribution limitation excluding\nthose countries, so that distribution is permitted only in or among\ncountries not thus excluded.  In such case, this License incorporates\nthe limitation as if written in the body of this License.\n\n  9. The Free Software Foundation may publish revised and/or new versions\nof the General Public Li!
 cense from time to time.  Such new versions will\nbe similar in spirit to the present version, but may differ in detail to\naddress new problems or concerns.\n\nEach version is given a distinguishing version number.  If the Program\nspecifies a version number of this License which applies to it and \"any\nlater version\", you have the option of following the terms and conditions\neither of that version or of any later version published by the Free\nSoftware Foundation.  If the Program does not specify a version number of\nthis License, you may choose any version ever published by the Free Software\nFoundation.\n\n  10. If you wish to incorporate parts of the Program into other free\nprograms whose distribution conditions are different, write to the author\nto ask for permission.  For software which is copyrighted by the Free\nSoftware Foundation, write to the Free Software Foundation; we sometimes\nmake exceptions for this.  Our decision will be guided by the two goals\nof !
 preserving the free status of all derivatives of our free soft!
 ware and
\nof promoting the sharing and reuse of software generally.\n\n\t\t\t    NO WARRANTY\n\n  11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY\nFOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN\nOTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES\nPROVIDE THE PROGRAM \"AS IS\" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED\nOR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF\nMERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS\nTO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE\nPROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,\nREPAIR OR CORRECTION.\n\n  12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING\nWILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR\nREDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,\nINCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAM!
 AGES ARISING\nOUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED\nTO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY\nYOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER\nPROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE\nPOSSIBILITY OF SUCH DAMAGES.\n\n\t\t     END OF TERMS AND CONDITIONS\n\n\t    How to Apply These Terms to Your New Programs\n\n  If you develop a new program, and you want it to be of the greatest\npossible use to the public, the best way to achieve this is to make it\nfree software which everyone can redistribute and change under these terms.\n\n  To do so, attach the following notices to the program.  It is safest\nto attach them to the start of each source file to most effectively\nconvey the exclusion of warranty; and each file should have at least\nthe \"copyright\" line and a pointer to where the full notice is found.\n\n    <one line to give the program's name an!
 d a brief idea of what it does.>\n    Copyright (C) <year>  <n!
 ame of a
uthor>\n\n    This program is free software; you can redistribute it and/or modify\n    it under the terms of the GNU General Public License as published by\n    the Free Software Foundation; either version 2 of the License, or\n    (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU General Public License for more details.\n\n    You should have received a copy of the GNU General Public License\n    along with this program; if not, write to the Free Software\n    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA\n\n\nAlso add information on how to contact you by electronic and paper mail.\n\nIf the program is interactive, make it output a short notice like this\nwhen it starts in an interactive mode:\n\n    Gnomovision version 69, Copyright (C) year name!
  of author\n    Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.\n    This is free software, and you are welcome to redistribute it\n    under certain conditions; type `show c' for details.\n\nThe hypothetical commands `show w' and `show c' should show the appropriate\nparts of the General Public License.  Of course, the commands you use may\nbe called something other than `show w' and `show c'; they could even be\nmouse-clicks or menu items--whatever suits your program.\n\nYou should also get your employer (if you work as a programmer) or your\nschool, if any, to sign a \"copyright disclaimer\" for the program, if\nnecessary.  Here is a sample; alter the names:\n\n  Yoyodyne, Inc., hereby disclaims all copyright interest in the program\n  `Gnomovision' (which makes passes at compilers) written by James Hacker.\n\n  <signature of Ty Coon>, 1 April 1989\n  Ty Coon, President of Vice\n\nThis General Public License does not permit incorporating your pr!
 ogram into\nproprietary programs.  If your program is a subrou!
 tine lib
rary, you may\nconsider it more useful to permit linking proprietary applications with the\nlibrary.  If this is what you want to do, use the GNU Library General\nPublic License instead of this License."));
+  gtk_about_dialog_set_license (GTK_ABOUT_DIALOG (aboutdialog1), _("Avidemux is free software; you can redistribute it and/or modify it\nunder the terms of the GNU General Public License version 2\nas published by the Free Software Foundation.\n\n\t\t    GNU GENERAL PUBLIC LICENSE\n\t\t       Version 2, June 1991\n\n Copyright (C) 1989, 1991 Free Software Foundation, Inc.\n                       51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA\n Everyone is permitted to copy and distribute verbatim copies\n of this license document, but changing it is not allowed.\n\n\t\t\t    Preamble\n\n  The licenses for most software are designed to take away your\nfreedom to share and change it.  By contrast, the GNU General Public\nLicense is intended to guarantee your freedom to share and change free\nsoftware--to make sure the software is free for all its users.  This\nGeneral Public License applies to most of the Free Software\nFoundation's software and to any other program!
  whose authors commit to\nusing it.  (Some other Free Software Foundation software is covered by\nthe GNU Library General Public License instead.)  You can apply it to\nyour programs, too.\n\n  When we speak of free software, we are referring to freedom, not\nprice.  Our General Public Licenses are designed to make sure that you\nhave the freedom to distribute copies of free software (and charge for\nthis service if you wish), that you receive source code or can get it\nif you want it, that you can change the software or use pieces of it\nin new free programs; and that you know you can do these things.\n\n  To protect your rights, we need to make restrictions that forbid\nanyone to deny you these rights or to ask you to surrender the rights.\nThese restrictions translate to certain responsibilities for you if you\ndistribute copies of the software, or if you modify it.\n\n  For example, if you distribute copies of such a program, whether\ngratis or for a fee, you must give !
 the recipients all the rights that\nyou have.  You must make s!
 ure that
 they, too, receive or can get the\nsource code.  And you must show them these terms so they know their\nrights.\n\n  We protect your rights with two steps: (1) copyright the software, and\n(2) offer you this license which gives you legal permission to copy,\ndistribute and/or modify the software.\n\n  Also, for each author's protection and ours, we want to make certain\nthat everyone understands that there is no warranty for this free\nsoftware.  If the software is modified by someone else and passed on, we\nwant its recipients to know that what they have is not the original, so\nthat any problems introduced by others will not reflect on the original\nauthors' reputations.\n\n  Finally, any free program is threatened constantly by software\npatents.  We wish to avoid the danger that redistributors of a free\nprogram will individually obtain patent licenses, in effect making the\nprogram proprietary.  To prevent this, we have made it clear that any\npatent must be licensed f!
 or everyone's free use or not licensed at all.\n\n  The precise terms and conditions for copying, distribution and\nmodification follow.\n\n\t\t    GNU GENERAL PUBLIC LICENSE\n   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION\n\n  0. This License applies to any program or other work which contains\na notice placed by the copyright holder saying it may be distributed\nunder the terms of this General Public License.  The \"Program\", below,\nrefers to any such program or work, and a \"work based on the Program\"\nmeans either the Program or any derivative work under copyright law:\nthat is to say, a work containing the Program or a portion of it,\neither verbatim or with modifications and/or translated into another\nlanguage.  (Hereinafter, translation is included without limitation in\nthe term \"modification\".)  Each licensee is addressed as \"you\".\n\nActivities other than copying, distribution and modification are not\ncovered by this License; they are !
 outside its scope.  The act of\nrunning the Program is not res!
 tricted,
 and the output from the Program\nis covered only if its contents constitute a work based on the\nProgram (independent of having been made by running the Program).\nWhether that is true depends on what the Program does.\n\n  1. You may copy and distribute verbatim copies of the Program's\nsource code as you receive it, in any medium, provided that you\nconspicuously and appropriately publish on each copy an appropriate\ncopyright notice and disclaimer of warranty; keep intact all the\nnotices that refer to this License and to the absence of any warranty;\nand give any other recipients of the Program a copy of this License\nalong with the Program.\n\nYou may charge a fee for the physical act of transferring a copy, and\nyou may at your option offer warranty protection in exchange for a fee.\n\n  2. You may modify your copy or copies of the Program or any portion\nof it, thus forming a work based on the Program, and copy and\ndistribute such modifications or work under the ter!
 ms of Section 1\nabove, provided that you also meet all of these conditions:\n\n    a) You must cause the modified files to carry prominent notices\n    stating that you changed the files and the date of any change.\n\n    b) You must cause any work that you distribute or publish, that in\n    whole or in part contains or is derived from the Program or any\n    part thereof, to be licensed as a whole at no charge to all third\n    parties under the terms of this License.\n\n    c) If the modified program normally reads commands interactively\n    when run, you must cause it, when started running for such\n    interactive use in the most ordinary way, to print or display an\n    announcement including an appropriate copyright notice and a\n    notice that there is no warranty (or else, saying that you provide\n    a warranty) and that users may redistribute the program under\n    these conditions, and telling the user how to view a copy of this\n    License.  (Exception: if !
 the Program itself is interactive but\n    does not normally p!
 rint suc
h an announcement, your work based on\n    the Program is not required to print an announcement.)\n\nThese requirements apply to the modified work as a whole.  If\nidentifiable sections of that work are not derived from the Program,\nand can be reasonably considered independent and separate works in\nthemselves, then this License, and its terms, do not apply to those\nsections when you distribute them as separate works.  But when you\ndistribute the same sections as part of a whole which is a work based\non the Program, the distribution of the whole must be on the terms of\nthis License, whose permissions for other licensees extend to the\nentire whole, and thus to each and every part regardless of who wrote it.\n\nThus, it is not the intent of this section to claim rights or contest\nyour rights to work written entirely by you; rather, the intent is to\nexercise the right to control the distribution of derivative or\ncollective works based on the Program.\n\nIn addition, me!
 re aggregation of another work not based on the Program\nwith the Program (or with a work based on the Program) on a volume of\na storage or distribution medium does not bring the other work under\nthe scope of this License.\n\n  3. You may copy and distribute the Program (or a work based on it,\nunder Section 2) in object code or executable form under the terms of\nSections 1 and 2 above provided that you also do one of the following:\n\n    a) Accompany it with the complete corresponding machine-readable\n    source code, which must be distributed under the terms of Sections\n    1 and 2 above on a medium customarily used for software interchange; or,\n\n    b) Accompany it with a written offer, valid for at least three\n    years, to give any third party, for a charge no more than your\n    cost of physically performing source distribution, a complete\n    machine-readable copy of the corresponding source code, to be\n    distributed under the terms of Sections 1 and 2 a!
 bove on a medium\n    customarily used for software interchang!
 e; or,\n
\n    c) Accompany it with the information you received as to the offer\n    to distribute corresponding source code.  (This alternative is\n    allowed only for noncommercial distribution and only if you\n    received the program in object code or executable form with such\n    an offer, in accord with Subsection b above.)\n\nThe source code for a work means the preferred form of the work for\nmaking modifications to it.  For an executable work, complete source\ncode means all the source code for all modules it contains, plus any\nassociated interface definition files, plus the scripts used to\ncontrol compilation and installation of the executable.  However, as a\nspecial exception, the source code distributed need not include\nanything that is normally distributed (in either source or binary\nform) with the major components (compiler, kernel, and so on) of the\noperating system on which the executable runs, unless that component\nitself accompanies the executable.\n\nIf d!
 istribution of executable or object code is made by offering\naccess to copy from a designated place, then offering equivalent\naccess to copy the source code from the same place counts as\ndistribution of the source code, even though third parties are not\ncompelled to copy the source along with the object code.\n\n  4. You may not copy, modify, sublicense, or distribute the Program\nexcept as expressly provided under this License.  Any attempt\notherwise to copy, modify, sublicense or distribute the Program is\nvoid, and will automatically terminate your rights under this License.\nHowever, parties who have received copies, or rights, from you under\nthis License will not have their licenses terminated so long as such\nparties remain in full compliance.\n\n  5. You are not required to accept this License, since you have not\nsigned it.  However, nothing else grants you permission to modify or\ndistribute the Program or its derivative works.  These actions are\nprohibited !
 by law if you do not accept this License.  Therefore, by\nmodi!
 fying or
 distributing the Program (or any work based on the\nProgram), you indicate your acceptance of this License to do so, and\nall its terms and conditions for copying, distributing or modifying\nthe Program or works based on it.\n\n  6. Each time you redistribute the Program (or any work based on the\nProgram), the recipient automatically receives a license from the\noriginal licensor to copy, distribute or modify the Program subject to\nthese terms and conditions.  You may not impose any further\nrestrictions on the recipients' exercise of the rights granted herein.\nYou are not responsible for enforcing compliance by third parties to\nthis License.\n\n  7. If, as a consequence of a court judgment or allegation of patent\ninfringement or for any other reason (not limited to patent issues),\nconditions are imposed on you (whether by court order, agreement or\notherwise) that contradict the conditions of this License, they do not\nexcuse you from the conditions of this License. !
  If you cannot\ndistribute so as to satisfy simultaneously your obligations under this\nLicense and any other pertinent obligations, then as a consequence you\nmay not distribute the Program at all.  For example, if a patent\nlicense would not permit royalty-free redistribution of the Program by\nall those who receive copies directly or indirectly through you, then\nthe only way you could satisfy both it and this License would be to\nrefrain entirely from distribution of the Program.\n\nIf any portion of this section is held invalid or unenforceable under\nany particular circumstance, the balance of the section is intended to\napply and the section as a whole is intended to apply in other\ncircumstances.\n\nIt is not the purpose of this section to induce you to infringe any\npatents or other property right claims or to contest validity of any\nsuch claims; this section has the sole purpose of protecting the\nintegrity of the free software distribution system, which is\nimpl!
 emented by public license practices.  Many people have made\ng!
 enerous 
contributions to the wide range of software distributed\nthrough that system in reliance on consistent application of that\nsystem; it is up to the author/donor to decide if he or she is willing\nto distribute software through any other system and a licensee cannot\nimpose that choice.\n\nThis section is intended to make thoroughly clear what is believed to\nbe a consequence of the rest of this License.\n\n  8. If the distribution and/or use of the Program is restricted in\ncertain countries either by patents or by copyrighted interfaces, the\noriginal copyright holder who places the Program under this License\nmay add an explicit geographical distribution limitation excluding\nthose countries, so that distribution is permitted only in or among\ncountries not thus excluded.  In such case, this License incorporates\nthe limitation as if written in the body of this License.\n\n  9. The Free Software Foundation may publish revised and/or new versions\nof the General Public Lice!
 nse from time to time.  Such new versions will\nbe similar in spirit to the present version, but may differ in detail to\naddress new problems or concerns.\n\nEach version is given a distinguishing version number.  If the Program\nspecifies a version number of this License which applies to it and \"any\nlater version\", you have the option of following the terms and conditions\neither of that version or of any later version published by the Free\nSoftware Foundation.  If the Program does not specify a version number of\nthis License, you may choose any version ever published by the Free Software\nFoundation.\n\n  10. If you wish to incorporate parts of the Program into other free\nprograms whose distribution conditions are different, write to the author\nto ask for permission.  For software which is copyrighted by the Free\nSoftware Foundation, write to the Free Software Foundation; we sometimes\nmake exceptions for this.  Our decision will be guided by the two goals\nof pr!
 eserving the free status of all derivatives of our free softwa!
 re and\n
of promoting the sharing and reuse of software generally.\n\n\t\t\t    NO WARRANTY\n\n  11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY\nFOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN\nOTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES\nPROVIDE THE PROGRAM \"AS IS\" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED\nOR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF\nMERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS\nTO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE\nPROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,\nREPAIR OR CORRECTION.\n\n  12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING\nWILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR\nREDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,\nINCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAG!
 ES ARISING\nOUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED\nTO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY\nYOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER\nPROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE\nPOSSIBILITY OF SUCH DAMAGES.\n\n\t\t     END OF TERMS AND CONDITIONS\n\n\t    How to Apply These Terms to Your New Programs\n\n  If you develop a new program, and you want it to be of the greatest\npossible use to the public, the best way to achieve this is to make it\nfree software which everyone can redistribute and change under these terms.\n\n  To do so, attach the following notices to the program.  It is safest\nto attach them to the start of each source file to most effectively\nconvey the exclusion of warranty; and each file should have at least\nthe \"copyright\" line and a pointer to where the full notice is found.\n\n    <one line to give the program's name and !
 a brief idea of what it does.>\n    Copyright (C) <year>  <nam!
 e of aut
hor>\n\n    This program is free software; you can redistribute it and/or modify\n    it under the terms of the GNU General Public License as published by\n    the Free Software Foundation; either version 2 of the License, or\n    (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU General Public License for more details.\n\n    You should have received a copy of the GNU General Public License\n    along with this program; if not, write to the Free Software\n    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA\n\n\nAlso add information on how to contact you by electronic and paper mail.\n\nIf the program is interactive, make it output a short notice like this\nwhen it starts in an interactive mode:\n\n    Gnomovision version 69, Copyright (C) year name o!
 f author\n    Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.\n    This is free software, and you are welcome to redistribute it\n    under certain conditions; type `show c' for details.\n\nThe hypothetical commands `show w' and `show c' should show the appropriate\nparts of the General Public License.  Of course, the commands you use may\nbe called something other than `show w' and `show c'; they could even be\nmouse-clicks or menu items--whatever suits your program.\n\nYou should also get your employer (if you work as a programmer) or your\nschool, if any, to sign a \"copyright disclaimer\" for the program, if\nnecessary.  Here is a sample; alter the names:\n\n  Yoyodyne, Inc., hereby disclaims all copyright interest in the program\n  `Gnomovision' (which makes passes at compilers) written by James Hacker.\n\n  <signature of Ty Coon>, 1 April 1989\n  Ty Coon, President of Vice\n\nThis General Public License does not permit incorporating your prog!
 ram into\nproprietary programs.  If your program is a subrouti!
 ne libra
ry, you may\nconsider it more useful to permit linking proprietary applications with the\nlibrary.  If this is what you want to do, use the GNU Library General\nPublic License instead of this License."));
   gtk_about_dialog_set_website (GTK_ABOUT_DIALOG (aboutdialog1), "http://www.avidemux.org");
   gtk_about_dialog_set_website_label (GTK_ABOUT_DIALOG (aboutdialog1), _("http://www.avidemux.org"));
   gtk_about_dialog_set_authors (GTK_ABOUT_DIALOG (aboutdialog1), authors);
   gtk_about_dialog_set_artists (GTK_ABOUT_DIALOG (aboutdialog1), artists);
-  gtk_about_dialog_set_translator_credits (GTK_ABOUT_DIALOG (aboutdialog1), translators);
+  gtk_about_dialog_set_translator_credits (GTK_ABOUT_DIALOG (aboutdialog1), _("translator-credits"));
   aboutdialog1_logo_pixbuf = create_pixbuf ("avidemux_icon.xpm");
   gtk_about_dialog_set_logo (GTK_ABOUT_DIALOG (aboutdialog1), aboutdialog1_logo_pixbuf);
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_preview.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_preview.cpp	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_preview.cpp	2007-09-25 18:08:12 UTC (rev 3597)
@@ -42,7 +42,7 @@
 /* =================================
             Filter Preview
    ================================= */
-uint8_t DIA_filterPreview(char *captionText, AVDMGenericVideoStream *videoStream, uint32_t frame)
+uint8_t DIA_filterPreview(const char *captionText, AVDMGenericVideoStream *videoStream, uint32_t frame)
 {
 	ADM_assert(frame <= videoStream->getInfo()->nb_frames);
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp	2007-09-25 18:08:12 UTC (rev 3597)
@@ -44,7 +44,7 @@
  GtkWidget *dialog;
  uint8_t gmc, qpel,vop;
  uint32_t info=0;
- char *yesno[2]={_("No"),_("Yes")};
+ const char *yesno[2]={_("No"),_("Yes")};
  uint32_t war,har;
 
     if (playing)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-09-25 18:08:12 UTC (rev 3597)
@@ -580,7 +580,7 @@
         
 }
 
-void UI_setTitle(char *name)
+void UI_setTitle(const char *name)
 {
         char title[1024];
 
@@ -1144,8 +1144,12 @@
 typedef gboolean GCALL       (void *);
 extern int automation(void );
 extern uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h);
+extern void initTranslator(void);
+
 int UI_Init(int argc, char **argv)
 {
+	initTranslator();
+
   uint32_t w,h;
     if(!g_thread_supported())
         g_thread_init(NULL);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/CMakeLists.txt	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/CMakeLists.txt	2007-09-25 18:08:12 UTC (rev 3597)
@@ -1,7 +1,11 @@
-subdirs(PREORDER ADM_dialog)
-subdirs(PREORDER ADM_dialogFactory)
-subdirs(PREORDER ADM_filters)
-subdirs(PREORDER ADM_gui2)
-subdirs(PREORDER ADM_toolkit_gtk)
-subdirs(PREORDER ADM_ocr)
-include_directories(../ADM_commonUI)
+SET(ADM_LIB ADM_UI_GTK)
+SET(${ADM_LIB}_SRCS ui_support.cpp)
+ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
+
+add_subdirectory(ADM_dialog)
+add_subdirectory(ADM_dialogFactory)
+add_subdirectory(ADM_filters)
+add_subdirectory(ADM_gui2)
+add_subdirectory(ADM_toolkit_gtk)
+add_subdirectory(ADM_ocr)
+include_directories(../ADM_commonUI)
\ No newline at end of file

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/Makefile.am	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/Makefile.am	2007-09-25 18:08:12 UTC (rev 3597)
@@ -1,10 +1,5 @@
 SUBDIRS= ADM_dialog  ADM_gui2 ADM_toolkit_gtk ADM_filters ADM_dialogFactory ADM_ocr
 
-noinst_LIBRARIES = libADM_GTK.a 
-libADM_GTK_a_METASOURCES = AUTO
-libADM_GTK_a_SOURCES = 
-
-INCLUDES = $(all_includes) $(GTK_CFLAGS) $(XML_CFLAGS)  $(FREETYPE_CFLAGS) -DADM_SUBVERSION=@ADM_SUBVERSION@ \
-		-I./../../ADM_libraries/ADM_utilities \
-		-I./../ADM_commonUI -I../.... -I../..../ADM_libraries/ADM_lavutil \
-		-I./../../ADM_inputs -I../..../ADM_outputs -I../../ADM_ocr
+noinst_LIBRARIES = libADM_UI_GTK.a 
+libADM_UI_GTK_a_METASOURCES = AUTO
+libADM_UI_GTK_a_SOURCES = ui_support.cpp
\ No newline at end of file

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ui_support.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ui_support.cpp	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ui_support.cpp	2007-09-25 18:08:12 UTC (rev 3597)
@@ -0,0 +1,24 @@
+#include "config.h"
+
+#ifdef HAVE_GETTEXT
+#include <libintl.h>
+
+extern void initGetText(void);
+
+void initTranslator(void)
+{
+	initGetText();
+}
+
+const char* translate(const char *__domainname, const char *__msgid)
+{
+	return (const char*)dgettext(PACKAGE, __msgid);
+}
+#else
+void initTranslator(void) {}
+
+const char* translate(const char *__domainname, const char *__msgid)
+{
+	return __msgid;
+}
+#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-09-25 18:08:12 UTC (rev 3597)
@@ -1,208 +1,139 @@
-
-/***************************************************************************
-                          DIA_animated
-    copyright            : (C) 2006 by mean
-    email                : fixounet at free.fr
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-
-
-#include <config.h>
-
-
-#include <string.h>
-#include <stdio.h>
-#include <stdlib.h>
-#include "default.h"
-
-# include <math.h>
-
-
-#include "ADM_image.h"
-#include "ADM_editor/ADM_edit.hxx"
-#include "ADM_video/ADM_genvideo.hxx"
-#include "ADM_toolkit/filesel.h"
-
-
-#include "ADM_videoFilter/ADM_vidAnimated_param.h"
-#include "ADM_videoFilter/ADM_vidASharp_param.h"
-#include "ADM_audiofilter/audiofilter_normalize_param.h"
-#include "ADM_video/ADM_vidCNR2_param.h"
-#include "ADM_video/ADM_vidColorYuv_param.h"
-#include "ADM_audiofilter/audioencoder_lame_param.h"
-#include "ADM_audiofilter/audioencoder_lame_param.h"
-#include "ADM_encoder/adm_encmjpeg_param.h"
-#include "ADM_video/ADM_vidPartial_param.h"
-#include "ADM_video/ADM_vidEqualizer.h"
-#include "ADM_videoFilter/ADM_vidHue.h"
-#include "ADM_videoFilter/ADM_vobsubinfo.h"
-#include "ADM_videoFilter/ADM_vidVobSub.h"
-#include "ADM_videoFilter/ADM_vidChromaShift_param.h"
-#include "ADM_video/ADM_vidMPdelogo.h"
-#include "ADM_videoFilter/ADM_vidEq2.h"
-#include "ADM_videoFilter/ADM_vidContrast.h"
-//#include "ADM_video/ADM_vidFont.h"
-class ADMfont;
-#include "ADM_videoFilter/ADM_vidSRT.h"
-#include "ADM_audiofilter/audioencoder_vorbis_param.h"    
-    
-#include "ADM_audiofilter/audioeng_buildfilters.h"
-    
-#include "ADM_encoder/ADM_vidEncode.hxx"
-#include "ADM_audiofilter/audioencoder.h"
-#include "ADM_lavcodec.h"
-#include "ADM_codecs/ADM_ffmpegConfig.h"
-
-#include "DIA_resizeWiz.h"
-#include "ADM_ocr/ADM_ocr.h"
-#include "ADM_assert.h"
-int SliderIsShifted=0;
-
-//******************************
-int DIA_coloryuv(COLOR_YUV_PARAM *param){return 0;}
-
-int DIA_getCropParams(  char *name,CROP_PARAMS *param,AVDMGenericVideoStream *in){return 0;}
-#ifdef USE_XX_XVID 
-#include "xvid.h"
-int  DIA_getXvidCompressParams(COMPRESSION_MODE * mode, uint32_t * qz,
-		      uint32_t * br,uint32_t *fsize,xvidEncParam *param){return 0;}
-#endif
-uint8_t DIA_animated(ANIMATED_PARAM *param){return 0;}
-uint8_t DIA_cnr2(CNR2Param *param){return 0;}
-//uint8_t DIA_DVDffParam(COMPRES_PARAMS *incoming){return 0;}
-uint8_t DIA_getASharp(ASHARP_PARAM *param, AVDMGenericVideoStream *in){return 0;}
-uint8_t DIA_getEQ2Param(Eq2_Param *param, AVDMGenericVideoStream *in){return 0;}
-uint8_t DIA_getEqualizer(EqualizerParam *param, ADMImage *image){return 0;}
-uint8_t DIA_getEqualizer(EqualizerParam *param, AVDMGenericVideoStream *in){return 0;}
-uint8_t DIA_getHue(Hue_Param *param, AVDMGenericVideoStream *in){return 0;}
-uint8_t DIA_getMPdelogo(MPDELOGO_PARAM *param,AVDMGenericVideoStream *in){return 0;}
-uint8_t DIA_getPartial(PARTIAL_CONFIG *param,AVDMGenericVideoStream *son,AVDMGenericVideoStream *previous){return 0;}
-uint8_t DIA_pipe(char **cmd,char **param){return 0;}
-//uint8_t  DIA_setUserMuxParam( int *mode, int *param, int *muxsize){return 0;}
-//uint8_t DIA_SVCDParam(COMPRES_PARAMS *incoming){return 0;}
-//uint8_t  DIA_tdeint(TDEINT_PARAM *param){return 0;}
-uint8_t DIA_vobsub(vobSubParam *param){return 0;}
-uint8_t DIA_x264(COMPRES_PARAMS *config){return 0;}
-uint8_t DIA_XVCDParam(char *title,COMPRESSION_MODE * mode, uint32_t * qz,
-		   				   uint32_t * br,uint32_t *fsize,FFcodecSetting *conf	){return 0;}
-uint8_t DIA_xvid4(COMPRES_PARAMS *incoming){return 0;}
-
-//******************************
-uint8_t DIA_quota(char *) {return 0;}
-
-uint8_t  DIA_job_select(char **jobname, char **filename) {return 0;}
-//uint8_t DIA_audioTrack(AudioSource *source, uint32_t *track,uint32_t nbTrack, audioInfo *infos){return 0;}
-const char * GUI_getCustomScript(uint32_t nb) {return 0;}
-//uint8_t DIA_builtin(void){return 0;}
-//uint8_t  DIA_v2v(char **vobname, char **ifoname,char **vobsubname) {return 0;}
-uint8_t DIA_RecentFiles( char **name ){return 0;}
-
-uint8_t DIA_about( void ){return 0;}
-//uint8_t DIA_Preferences(void){return 0;}
-void DIA_Calculator(uint32_t *sizeInMeg, uint32_t *avgBitrate ){return ;}
-//uint8_t DIA_gotoTime(uint16_t *hh, uint16_t *mm, uint16_t *ss){return 0;}
-void DIA_properties( void){return ;}
-int GUI_handleVFilter (void){return 0;}
-uint8_t  initFileSelector(void){return 0;}
-uint8_t initGUI( void ){return 1;}
-void destroyGUI(void) {}
-
-uint8_t DIA_job(uint32_t nb,char **name){return 0;}
-//uint8_t DIA_lavDecoder(uint32_t *swapUv, uint32_t *showU){return 0;}
-uint8_t DIA_resize(uint32_t *width,uint32_t *height,uint32_t *algo,uint32_t originalw, 
-                        uint32_t originalh,uint32_t fps) {return 0;}
-uint8_t DIA_d3d(double *luma,double *chroma,double *temporal){return 0;}
-uint8_t DIA_kerneldeint(uint32_t *order, uint32_t *threshold, uint32_t *sharp, 
-                          uint32_t *twoway, uint32_t *map){return 0;}
-uint8_t DIA_4entries(char *title,uint32_t *left,uint32_t *right,uint32_t *top,uint32_t *bottom) {return 0;}
-uint8_t DIA_videoCodec (SelectCodecType * codec){return 0;}
-uint8_t DIA_getChromaShift( AVDMGenericVideoStream *instream,CHROMASHIFT_PARAM    *param ){ return 0;}
-uint8_t DIA_contrast(AVDMGenericVideoStream *astream,CONTRAST_PARAM *param)  { return 0;}
-uint8_t DIA_audioCodec( AUDIOENCODER *codec ) {return 0;}
-uint8_t DIA_dnr(uint32_t *llock,uint32_t *lthresh, uint32_t *clock,
-			uint32_t *cthresh, uint32_t *scene) {return 0;}
-			
-int DIA_srtPos(AVDMGenericVideoStream *source,uint32_t *size,uint32_t *position)
-{
-  return 0; 
-}
-
-int DIA_colorSel(uint8_t *r, uint8_t *g, uint8_t *b) {return 0;}			
-			
-extern int global_argc;
-extern char **global_argv;
-int UI_Init(int nargc,char **nargv)
-{
-  global_argc=nargc;
-  global_argv=nargv;
-  return 0;
-}
-extern int automation(void );
-int UI_RunApp(void)
-{
- if (global_argc >= 2)
-    {
-     automation();
-    }
-    printf("*********************************\n");
-    printf("*********************************\n");
-    printf("End of program..\n");
-    printf("*********************************\n");
-    printf("*********************************\n");
-}
-// OCR Stubs
-#include "ADM_ocr/ADM_ocr.h"
-#include "ADM_ocr/ADM_ocrInternal.h"
-
-uint8_t DIA_glyphEdit(void) {return 0;};
-
-uint8_t ADM_ocrUpdateNbLines(void *ui,uint32_t cur,uint32_t total)
-{
-	return 0;
-}
-uint8_t ADM_ocrUpdateNbGlyphs(void *ui,uint32_t nbGlyphs)
-{
-	return 0;
-}
-;
-uint8_t ADM_ocrUpdateTextAndTime(void *ui,char *decodedString,char *timeCode)
-{
-	return 0;
-}
-;
-uint8_t ADM_ocrDrawFull(void *d,uint8_t *data)
-{
-	return 0;
-}
-;
-uint8_t ADM_ocrUiEnd(void *d)
-{
-	return 0;
-}
-;
-void 	*ADM_ocrUiSetup(void)
-{
-	return 0;
-}
-;
-uint8_t ADM_ocrSetRedrawSize(void *ui,uint32_t w,uint32_t h)
-{
-	return 0;
-}
-;
-
-ReplyType glyphToText(admGlyph *glyph,admGlyph *head,char *decodedString)
-{
-	return ReplyOk;
-}
-
-//EOF
+
+/***************************************************************************
+                          DIA_none
+    copyright            : (C) 2006 by mean
+    email                : fixounet at free.fr
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include "config.h"
+
+#include <string.h>
+#include <stdio.h>
+#include <stdlib.h>
+
+#include "default.h"
+#include "ADM_assert.h"
+
+#include "ADM_video/ADM_genvideo.hxx"
+#include "ADM_video/ADM_vidCNR2_param.h"
+#include "ADM_video/ADM_vidColorYuv_param.h"
+#include "ADM_video/ADM_vidPartial_param.h"
+#include "ADM_video/ADM_vidEqualizer.h"
+#include "ADM_video/ADM_vidMPdelogo.h"
+
+#include "ADM_videoFilter/ADM_vidAnimated_param.h"
+#include "ADM_videoFilter/ADM_vidASharp_param.h"
+#include "ADM_videoFilter/ADM_vidChromaShift_param.h"
+#include "ADM_videoFilter/ADM_vidContrast.h"
+#include "ADM_videoFilter/ADM_vidEq2.h"
+#include "ADM_videoFilter/ADM_vidHue.h"
+#include "ADM_videoFilter/ADM_vobsubinfo.h"
+#include "ADM_videoFilter/ADM_vidVobSub.h"
+
+#include "ADM_encoder/ADM_vidEncode.hxx"
+#include "ADM_audiofilter/audioencoder.h"
+#include "ADM_lavcodec.h"
+#include "ADM_codecs/ADM_ffmpegConfig.h"
+
+#include "ADM_ocr/ADM_ocr.h"
+#include "ADM_ocr/ADM_ocrInternal.h"
+
+extern int global_argc;
+extern char **global_argv;
+extern void initTranslator(void);
+extern int automation(void);
+
+int SliderIsShifted = 0;
+
+int DIA_coloryuv(COLOR_YUV_PARAM *param) {return 0;}
+int DIA_getCropParams(  char *name,CROP_PARAMS *param,AVDMGenericVideoStream *in) {return 0;}
+
+#ifdef USE_XX_XVID 
+#include "xvid.h"
+int  DIA_getXvidCompressParams(COMPRESSION_MODE * mode, uint32_t * qz,
+		      uint32_t * br,uint32_t *fsize,xvidEncParam *param) {return 0;}
+#endif
+
+uint8_t DIA_animated(ANIMATED_PARAM *param) {return 0;}
+uint8_t DIA_cnr2(CNR2Param *param) {return 0;}
+uint8_t DIA_getASharp(ASHARP_PARAM *param, AVDMGenericVideoStream *in) {return 0;}
+uint8_t DIA_getEQ2Param(Eq2_Param *param, AVDMGenericVideoStream *in) {return 0;}
+uint8_t DIA_getEqualizer(EqualizerParam *param, ADMImage *image) {return 0;}
+uint8_t DIA_getEqualizer(EqualizerParam *param, AVDMGenericVideoStream *in) {return 0;}
+uint8_t DIA_getHue(Hue_Param *param, AVDMGenericVideoStream *in) {return 0;}
+uint8_t DIA_getMPdelogo(MPDELOGO_PARAM *param,AVDMGenericVideoStream *in) {return 0;}
+uint8_t DIA_getPartial(PARTIAL_CONFIG *param,AVDMGenericVideoStream *son,AVDMGenericVideoStream *previous) {return 0;}
+uint8_t DIA_pipe(char **cmd,char **param) {return 0;}
+uint8_t DIA_vobsub(vobSubParam *param) {return 0;}
+uint8_t DIA_x264(COMPRES_PARAMS *config) {return 0;}
+uint8_t DIA_XVCDParam(char *title,COMPRESSION_MODE * mode, uint32_t * qz,
+		   				   uint32_t * br,uint32_t *fsize,FFcodecSetting *conf) {return 0;}
+uint8_t DIA_xvid4(COMPRES_PARAMS *incoming) {return 0;}
+uint8_t DIA_quota(char *) {return 0;}
+uint8_t  DIA_job_select(char **jobname, char **filename) {return 0;}
+const char * GUI_getCustomScript(uint32_t nb) {return 0;}
+uint8_t DIA_RecentFiles( char **name ) {return 0;}
+uint8_t DIA_about( void ) {return 0;}
+void DIA_Calculator(uint32_t *sizeInMeg, uint32_t *avgBitrate ) {}
+void DIA_properties(void) {}
+int GUI_handleVFilter (void) {return 0;}
+uint8_t initFileSelector(void) {return 0;}
+uint8_t initGUI(void) {return 1;}
+void destroyGUI(void) {}
+uint8_t DIA_job(uint32_t nb,char **name) {return 0;}
+uint8_t DIA_resize(uint32_t *width,uint32_t *height,uint32_t *algo,uint32_t originalw, 
+                        uint32_t originalh,uint32_t fps) {return 0;}
+uint8_t DIA_d3d(double *luma,double *chroma,double *temporal) {return 0;}
+uint8_t DIA_kerneldeint(uint32_t *order, uint32_t *threshold, uint32_t *sharp, 
+                          uint32_t *twoway, uint32_t *map) {return 0;}
+uint8_t DIA_4entries(char *title,uint32_t *left,uint32_t *right,uint32_t *top,uint32_t *bottom) {return 0;}
+uint8_t DIA_videoCodec (SelectCodecType * codec) {return 0;}
+uint8_t DIA_getChromaShift( AVDMGenericVideoStream *instream,CHROMASHIFT_PARAM *param ) {return 0;}
+uint8_t DIA_contrast(AVDMGenericVideoStream *astream,CONTRAST_PARAM *param) {return 0;}
+uint8_t DIA_audioCodec( AUDIOENCODER *codec ) {return 0;}
+uint8_t DIA_dnr(uint32_t *llock,uint32_t *lthresh, uint32_t *clock,
+			uint32_t *cthresh, uint32_t *scene) {return 0;}
+int DIA_srtPos(AVDMGenericVideoStream *source,uint32_t *size,uint32_t *position) {return 0;}
+int DIA_colorSel(uint8_t *r, uint8_t *g, uint8_t *b) {return 0;}			
+uint8_t DIA_glyphEdit(void) {return 0;}
+uint8_t ADM_ocrUpdateNbLines(void *ui,uint32_t cur,uint32_t total) {return 0;}
+uint8_t ADM_ocrUpdateNbGlyphs(void *ui,uint32_t nbGlyphs) {return 0;}
+uint8_t ADM_ocrUpdateTextAndTime(void *ui,char *decodedString,char *timeCode) {	return 0;}
+uint8_t ADM_ocrDrawFull(void *d,uint8_t *data) {return 0;}
+uint8_t ADM_ocrUiEnd(void *d) {	return 0;}
+void *ADM_ocrUiSetup(void) {return 0;}
+uint8_t ADM_ocrSetRedrawSize(void *ui,uint32_t w,uint32_t h) {return 0;}
+ReplyType glyphToText(admGlyph *glyph,admGlyph *head,char *decodedString) {return ReplyOk;}
+
+int UI_Init(int nargc, char **nargv)
+{
+	initTranslator();
+
+	global_argc = nargc;
+	global_argv = nargv;
+
+	return 0;
+}
+
+int UI_RunApp(void)
+{
+	if (global_argc >= 2)
+		automation();
+
+	printf("*********************************\n");
+	printf("*********************************\n");
+	printf("End of program..\n");
+	printf("*********************************\n");
+	printf("*********************************\n");
+}
+
+//EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp	2007-09-25 18:08:12 UTC (rev 3597)
@@ -86,7 +86,7 @@
 {}
 void 	UI_setMarkers(uint32_t a, uint32_t b )
 {}
-void 	UI_setTitle(char *name)
+void 	UI_setTitle(const char *name)
 {}
 
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/preview_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/preview_none.cpp	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/preview_none.cpp	2007-09-25 18:08:12 UTC (rev 3597)
@@ -24,4 +24,4 @@
 uint8_t DIA_previewUpdate(uint8_t *buffer) {return 1;}
 void DIA_previewEnd(void) {}
 uint8_t DIA_previewStillAlive(void) {return 1;}
-uint8_t DIA_filterPreview(char *captionText, AVDMGenericVideoStream *videoStream, uint32_t frame) {}
+uint8_t DIA_filterPreview(const char *captionText, AVDMGenericVideoStream *videoStream, uint32_t frame) {}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/CMakeLists.txt	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/CMakeLists.txt	2007-09-25 18:08:12 UTC (rev 3597)
@@ -1,5 +1,6 @@
+ADD_LIBRARY(ADM_UI_None STATIC ui_support.cpp)
+
 add_subdirectory(ADM_dialog)
 add_subdirectory(ADM_dialogFactory)
 add_subdirectory(ADM_filters)
-add_subdirectory(ADM_gui2)
-include_directories(../ADM_commonUI)
+add_subdirectory(ADM_gui2)
\ No newline at end of file

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/Makefile.am	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/Makefile.am	2007-09-25 18:08:12 UTC (rev 3597)
@@ -1,2 +1,6 @@
-SUBDIRS= ADM_dialog  ADM_gui2  ADM_filters ADM_dialogFactory
+noinst_LIBRARIES = libADM_UI_None.a
 
+libADM_UI_None_a_METASOURCES = AUTO
+libADM_UI_None_a_SOURCES = ui_support.cpp
+
+SUBDIRS = ADM_dialog  ADM_gui2  ADM_filters ADM_dialogFactory

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ui_support.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ui_support.cpp	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ui_support.cpp	2007-09-25 18:08:12 UTC (rev 3597)
@@ -0,0 +1,24 @@
+#include "config.h"
+
+#ifdef HAVE_GETTEXT
+#include <libintl.h>
+
+extern void initGetText(void);
+
+void initTranslator(void)
+{
+	initGetText();
+}
+
+const char* translate(const char *__domainname, const char *__msgid)
+{
+	return (const char*)dgettext(PACKAGE, __msgid);
+}
+#else
+void initTranslator(void) {}
+
+const char* translate(const char *__domainname, const char *__msgid)
+{
+	return __msgid;
+}
+#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-09-25 18:08:12 UTC (rev 3597)
@@ -13,59 +13,24 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
+#include "config.h"
 
-
-
-#include <config.h>
-
-
 #include <string.h>
 #include <stdio.h>
 #include <stdlib.h>
+
 #include "default.h"
+#include "ADM_assert.h"
 
-# include <math.h>
-
-
-#include "ADM_image.h"
-#include "ADM_editor/ADM_edit.hxx"
 #include "ADM_video/ADM_genvideo.hxx"
-#include "ADM_toolkit/filesel.h"
-
-
-#include "ADM_videoFilter/ADM_vidAnimated_param.h"
-#include "ADM_videoFilter/ADM_vidASharp_param.h"
-#include "ADM_audiofilter/audiofilter_normalize_param.h"
 #include "ADM_video/ADM_vidCNR2_param.h"
 #include "ADM_video/ADM_vidColorYuv_param.h"
-#include "ADM_audiofilter/audioencoder_lame_param.h"
-#include "ADM_audiofilter/audioencoder_lame_param.h"
-#include "ADM_encoder/adm_encmjpeg_param.h"
-#include "ADM_video/ADM_vidPartial_param.h"
 #include "ADM_video/ADM_vidEqualizer.h"
-#include "ADM_videoFilter/ADM_vidHue.h"
-#include "ADM_videoFilter/ADM_vobsubinfo.h"
-#include "ADM_videoFilter/ADM_vidVobSub.h"
-#include "ADM_videoFilter/ADM_vidChromaShift_param.h"
 #include "ADM_video/ADM_vidMPdelogo.h"
-#include "ADM_videoFilter/ADM_vidContrast.h"
-//#include "ADM_video/ADM_vidFont.h"
-class ADMfont;
-#include "ADM_videoFilter/ADM_vidSRT.h"
-#include "ADM_audiofilter/audioencoder_vorbis_param.h"    
     
-#include "ADM_audiofilter/audioeng_buildfilters.h"
-    
 #include "ADM_encoder/ADM_vidEncode.hxx"
 #include "ADM_audiofilter/audioencoder.h"
-#include "ADM_lavcodec.h"
-#include "ADM_codecs/ADM_ffmpegConfig.h"
-#include "DIA_resizeWiz.h"
-#include "ADM_assert.h"
 
-//******************************
-
-
 #ifdef USE_XX_XVID 
 #include "xvid.h"
 int  DIA_getXvidCompressParams(COMPRESSION_MODE * mode, uint32_t * qz,
@@ -76,31 +41,18 @@
 uint8_t DIA_getEqualizer(EqualizerParam *param, ADMImage *image){return 0;}
 uint8_t DIA_getEqualizer(EqualizerParam *param, AVDMGenericVideoStream *in){return 0;}
 uint8_t DIA_getMPdelogo(MPDELOGO_PARAM *param,AVDMGenericVideoStream *in){return 0;}
-//uint8_t DIA_getPartial(PARTIAL_CONFIG *param,AVDMGenericVideoStream *son,AVDMGenericVideoStream *previous){return 0;}
-//uint8_t DIA_vobsub(vobSubParam *param){return 0;}
-//uint8_t DIA_x264(COMPRES_PARAMS *config){return 0;}
-//uint8_t DIA_job(uint32_t nb,char **name){return 0;}
 uint8_t DIA_videoCodec (SelectCodecType * codec){return 0;}
 uint8_t DIA_audioCodec( AUDIOENCODER *codec ) {return 0;}
-//uint8_t DIA_srt(ADMImage *source, SUBCONF *param) {return 0;}			
 uint8_t DIA_quota(char *) {return 0;}
 uint8_t  DIA_job_select(char **jobname, char **filename) {return 0;}
-//const char * GUI_getCustomScript(uint32_t nb) {return 0;}
 uint8_t DIA_RecentFiles( char **name ){return 0;}
 uint8_t DIA_about( void ){return 0;}
-void    DIA_Calculator(uint32_t *sizeInMeg, uint32_t *avgBitrate ){return ;}
+void    DIA_Calculator(uint32_t *sizeInMeg, uint32_t *avgBitrate ){}
 uint8_t initFileSelector(void){return 0;}
-uint8_t initGUI( void ){return 1;}
+uint8_t initGUI( void ) {return 1;}
 void destroyGUI(void) {}
 int DIA_colorSel(uint8_t *r, uint8_t *g, uint8_t *b) {return 0;}
 uint8_t DIA_glyphEdit(void){ return 0;};
+int32_t UI_readJog(void) {return 0;}
 
-int32_t UI_readJog(void)
-{
-  return 0; 
-}
-
-
-
 //EOF
-

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp	2007-09-25 18:08:12 UTC (rev 3597)
@@ -23,7 +23,7 @@
 #include "avidemutils.h"
 #include "avi_vars.h"
 #include "ADM_osSupport/ADM_misc.h"
-static char *yesno[2]={_("No"),_("Yes")};
+static const char *yesno[2]={_("No"),_("Yes")};
 extern const char *getStrFromAudioCodec( uint32_t codec);
  class propWindow : public QDialog
  {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-09-25 18:08:12 UTC (rev 3597)
@@ -38,6 +38,9 @@
 #include "ADM_toolkit/filesel.h"
 #include "prefs.h"
 
+extern int global_argc;
+extern char **global_argv;
+
 extern uint8_t UI_getPhysicalScreenSize(uint32_t *w,uint32_t *h);
 extern int automation(void );
 extern void HandleAction(Action a);
@@ -46,9 +49,13 @@
 extern uint32_t audioFilterGetNbEncoder(void);
 extern const char* audioFilterGetIndexedName(uint32_t i);
 extern void checkCrashFile(void);
-static void setupMenus(void);
+extern void UI_QT4VideoWidget(QFrame *frame);
+extern void loadTranslator(void);
+extern void initTranslator(void);
+extern void destroyTranslator(void);
 
 int SliderIsShifted=0;
+static void setupMenus(void);
 static int shiftKeyHeld=0;
 static ADM_QSlider *slider=NULL;
 static int _upd_in_progres=0;
@@ -529,17 +536,13 @@
 	clearCustomMenu();
 }
 
-//*********************************************
-//***** Hook to core                ***********
-//*********************************************
-extern int global_argc;
-extern char **global_argv;
-extern void UI_QT4VideoWidget(QFrame *frame);
-
 int UI_Init(int nargc,char **nargv)
 {
+	initTranslator();
+
 	global_argc=nargc;
 	global_argv=nargv;
+
 	return 0;
 }
 QWidget *QuiMainWindows=NULL;
@@ -606,29 +609,33 @@
 {
 	Q_INIT_RESOURCE(avidemux);
 	Q_INIT_RESOURCE(filter);
-	QApplication a( global_argc, global_argv );
-	MainWindow * mw = new MainWindow();
 
-	a.connect( &a, SIGNAL(lastWindowClosed()), &a, SLOT(quit()) );
+	QApplication a(global_argc, global_argv);
+	a.connect(&a, SIGNAL(lastWindowClosed()), &a, SLOT(quit()));
 
+	loadTranslator();
+
 	uint32_t w, h;
 
 	UI_getPhysicalScreenSize(&w,&h);
 	printf("The screen seems to be %u x %u px\n",w,h);
 
+	MainWindow *mw = new MainWindow();
 	mw->show();
 
-	QuiMainWindows=(QWidget*)mw;
+	QuiMainWindows = (QWidget*)mw;
 
 	UI_QT4VideoWidget(mw->ui.frame_video);  // Add the widget that will handle video display
-	UI_updateRecentMenu(  );
+	UI_updateRecentMenu();
 	setupMenus();
 	checkCrashFile();
 
 	if (global_argc >= 2)
 		automation();
 
-	return a.exec();
+	a.exec();
+
+	destroyTranslator();
 }
 /**
     \fn searchTranslationTable(const char *name))
@@ -779,7 +786,7 @@
     \fn UI_setTitle(char *name)
     \brief Set the main window title, usually name if the file being edited
 */
-void UI_setTitle(char *name)
+void UI_setTitle(const char *name)
 {
     char title[300];
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp	2007-09-25 18:08:12 UTC (rev 3597)
@@ -59,7 +59,7 @@
 uint8_t DIA_previewUpdate(uint8_t *data) {return 1;}
 void DIA_previewEnd(void) {}
 uint8_t DIA_previewStillAlive(void) {return 1;}
-uint8_t	DIA_filterPreview(char *captionText, AVDMGenericVideoStream *videoStream, uint32_t frame) {}
+uint8_t	DIA_filterPreview(const char *captionText, AVDMGenericVideoStream *videoStream, uint32_t frame) {}
 
 //****************************************************************************************************
 /*

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/CMakeLists.txt	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/CMakeLists.txt	2007-09-25 18:08:12 UTC (rev 3597)
@@ -1,6 +1,11 @@
-subdirs(PREORDER ADM_dialog)
-subdirs(PREORDER ADM_dialogFactory)
-subdirs(PREORDER ADM_filters)
-subdirs(PREORDER ADM_gui)
-subdirs(PREORDER ADM_ocr)
-include_directories(../ADM_commonUI)
+SET(ADM_LIB ADM_UI_QT4)
+SET(${ADM_LIB}_SRCS ui_support.cpp)
+ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
+include_directories(${QT_INCLUDES})
+
+add_subdirectory(ADM_dialog)
+add_subdirectory(ADM_dialogFactory)
+add_subdirectory(ADM_filters)
+add_subdirectory(ADM_gui)
+add_subdirectory(ADM_ocr)
+include_directories(../ADM_commonUI)
\ No newline at end of file

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/Makefile.am	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/Makefile.am	2007-09-25 18:08:12 UTC (rev 3597)
@@ -1,6 +1,13 @@
-SUBDIRS= ADM_dialog  ADM_gui  ADM_filters ADM_dialogFactory ADM_ocr
-#SUBDIRS= ADM_gui  
+noinst_LIBRARIES = libADM_UI_QT4.a
 
+libADM_UI_QT4_a_METASOURCES = AUTO
+libADM_UI_QT4_a_SOURCES = ui_support.cpp
+
+INCLUDES = @ADM_QTINCLUDES@
+SUBDIRS = ADM_dialog  ADM_gui  ADM_filters ADM_dialogFactory ADM_ocr
+
+
+
 qclean:
 	rm -f ui_*.h AT_*.cpp AQ_*.cpp  *.moc
 	rm -f */ui_*.h */AT_*.cpp */AQ_*.cpp  */*.moc

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp	2007-09-25 18:08:12 UTC (rev 3597)
@@ -0,0 +1,71 @@
+#include <string.h>
+
+#include <QApplication>
+#include <QLocale>
+#include <QTranslator>
+
+static const int MAX_MESSAGE_COUNT = 300;
+static char* translatedMessage[MAX_MESSAGE_COUNT];
+static QTranslator qtTranslator;
+static QTranslator avidemuxTranslator;
+
+static void loadTranslation(QTranslator *qTranslator, QString translation)
+{
+	printf("[Locale] Loading language file %s ", translation.toAscii().data());	
+
+	if (qTranslator->load(translation))
+	{
+		QApplication::installTranslator(qTranslator);
+		printf("succeeded\n");
+	}
+	else
+		printf("FAILED\n");		
+}
+
+void initTranslator(void)
+{
+	memset(translatedMessage, 0, MAX_MESSAGE_COUNT * sizeof(char*));
+}
+
+const char* translate(const char *__domainname, const char *__msgid)
+{
+	static int counter = 0;
+	QString messageString = QApplication::translate(__domainname,  __msgid);
+
+	counter++;
+
+	if (counter >= MAX_MESSAGE_COUNT)
+		counter = 0;
+
+	if (translatedMessage[counter])
+		delete[] translatedMessage[counter];
+
+	translatedMessage[counter] = new char[messageString.toUtf8().length() + 1];
+	strcpy(translatedMessage[counter], messageString.toUtf8().data());
+
+	return translatedMessage[counter];
+}
+
+void loadTranslator(void)
+{
+	printf("\n[Locale] Locale: %s\n", QLocale::system().name().toAscii().data());
+
+	//loadTranslation("qt_" + QLocale::system().name());
+	//loadTranslation("avidemux_" + QLocale::system().name());
+
+	loadTranslation(&qtTranslator, "qt_fr");
+	loadTranslation(&avidemuxTranslator, "avidemux_fr");
+
+	printf("[Locale] Test: &File -> %s\n\n", translate("MainWindow", "&File"));
+}
+
+void destroyTranslator(void)
+{
+	for (int counter = 0; counter < MAX_MESSAGE_COUNT; counter++)
+	{
+		if (translatedMessage[counter])
+			delete[] translatedMessage[counter];
+	}
+
+	memset(translatedMessage, 0, MAX_MESSAGE_COUNT * sizeof(char*));
+}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h	2007-09-25 18:08:12 UTC (rev 3597)
@@ -13,7 +13,7 @@
 void 	UI_setScale( double  val );
 void 	UI_setFrameType( uint32_t frametype,uint32_t qp);
 void 	UI_setMarkers(uint32_t a, uint32_t b );
-void 	UI_setTitle(char *name);
+void 	UI_setTitle(const char *name);
 int32_t UI_readJog(void);
 
 void UI_setAProcessToggleStatus( uint8_t status );

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_genvideo.hxx
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_genvideo.hxx	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_genvideo.hxx	2007-09-25 18:08:12 UTC (rev 3597)
@@ -124,7 +124,7 @@
 uint8_t  DIA_previewUpdate(uint8_t *data);
 void 	 DIA_previewEnd(void);
 uint8_t  DIA_previewStillAlive(void);
-uint8_t	 DIA_filterPreview(char *captionText, AVDMGenericVideoStream *videoStream, uint32_t frame);
+uint8_t	 DIA_filterPreview(const char *captionText, AVDMGenericVideoStream *videoStream, uint32_t frame);
 
  // Pseudo class used to register filters automagically
  // Does not work atm

Modified: branches/avidemux_2.4_branch/avidemux/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/CMakeLists.txt	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/CMakeLists.txt	2007-09-25 18:08:12 UTC (rev 3597)
@@ -6,34 +6,37 @@
 ##########################################################
 
 INCLUDE(Po)
-
-SET(adm_EXE_SRCS ADM_preview.cpp  gtk_gui.cpp  gui_autodrive.cpp  GUI_jobs.cpp  gui_navigate.cpp  guiplay.cpp  gui_savenew.cpp  main.cpp )
-
+SET(adm_EXE_SRCS ADM_preview.cpp  gtk_gui.cpp  gui_autodrive.cpp  GUI_jobs.cpp  gui_navigate.cpp  guiplay.cpp  gui_savenew.cpp  main.cpp)
 COMPILE_PO_FILES(${CMAKE_SOURCE_DIR}/po adm_EXE_SRCS)
 
 include_directories(ADM_userInterfaces/ADM_commonUI ADM_outputs)
+add_definitions(${GLIB_CFLAGS})
 
-# Small macro...
+########################################################
+# Macros
+########################################################
 MACRO (add_libs_all_targets _libName)
-  TARGET_LINK_LIBRARIES(avidemux2_cli ${_libName})
-  if(GTK_FOUND)
-  TARGET_LINK_LIBRARIES(avidemux2_gtk ${_libName})
-  endif(GTK_FOUND)
-  if(QT4_FOUND)
-  TARGET_LINK_LIBRARIES(avidemux2_qt4 ${_libName})
-  endif(QT4_FOUND)
+	TARGET_LINK_LIBRARIES(avidemux2_cli ${_libName})
+  
+	if(GTK_FOUND)
+		TARGET_LINK_LIBRARIES(avidemux2_gtk ${_libName})
+	endif(GTK_FOUND)
+	
+	if(QT4_FOUND)
+		TARGET_LINK_LIBRARIES(avidemux2_qt4 ${_libName})
+	endif(QT4_FOUND)
 ENDMACRO (add_libs_all_targets _libName)
 
 MACRO (add_link_flags _target _flg)
-   GET_TARGET_PROPERTY(_flags ${_target} LINK_FLAGS)
+	GET_TARGET_PROPERTY(_flags ${_target} LINK_FLAGS)
 
-   if (_flags)
-      set(_flags "${_flags} ${_flg}")
-   else (_flags)
-      set(_flags "${_flg}")
-   endif (_flags)
+	if (_flags)
+		set(_flags "${_flags} ${_flg}")
+	else (_flags)
+		set(_flags "${_flg}")
+	endif (_flags)
 
-   SET_TARGET_PROPERTIES(${_target} PROPERTIES LINK_FLAGS "${_flags}")
+	SET_TARGET_PROPERTIES(${_target} PROPERTIES LINK_FLAGS "${_flags}")
 ENDMACRO (add_link_flags)
 
 MACRO (add_ldflags_all_targets _libName)
@@ -47,23 +50,35 @@
 		add_link_flags(avidemux2_qt4 ${_libName})
 	endif(QT4_FOUND)
 ENDMACRO (add_ldflags_all_targets _libName)
-##/ Small macro...
 
 MACRO (add_compile_flags _target _flg)
-   GET_SOURCE_FILE_PROPERTY(_flags ${_target} COMPILE_FLAGS)
+	GET_SOURCE_FILE_PROPERTY(_flags ${_target} COMPILE_FLAGS)
 
-   if (_flags)
-      set(_flags "${_flags} ${_flg}")
-   else (_flags)
-      set(_flags "${_flg}")
-   endif (_flags)
+	if (_flags)
+		set(_flags "${_flags} ${_flg}")
+	else (_flags)
+		set(_flags "${_flg}")
+	endif (_flags)
    
-   SET_SOURCE_FILES_PROPERTIES(${_target} PROPERTIES COMPILE_FLAGS "${_flags}")   
+	SET_SOURCE_FILES_PROPERTIES(${_target} PROPERTIES COMPILE_FLAGS "${_flags}")   
 ENDMACRO (add_compile_flags)
 
-#
+########################################################
+# Our exectuables
+########################################################
+ADD_EXECUTABLE(avidemux2_cli ${adm_EXE_SRCS})
+
+if(GTK_FOUND)
+	ADD_EXECUTABLE(avidemux2_gtk ${adm_EXE_SRCS})
+endif(GTK_FOUND)
+
+if(QT4_FOUND)
+	ADD_EXECUTABLE(avidemux2_qt4 ${adm_EXE_SRCS})
+endif(QT4_FOUND)
+
+########################################################
 # Normal subdirs, compile and link what is inside....
-#
+########################################################
 SET(ADM_SUBDIR 
 ADM_filter
 ADM_audiofilter 
@@ -79,39 +94,26 @@
 ADM_colorspace 
 )
 
+FOREACH(_current ${ADM_SUBDIR})
+	ADD_SUBDIRECTORY(${_current})
+	add_libs_all_targets(${_current})
+ENDFOREACH(_current ${ADM_SUBDIR})
 
-########################################################
-# Our exectuables
-########################################################
-ADD_EXECUTABLE(avidemux2_cli ${adm_EXE_SRCS} )
-if(GTK_FOUND)
-ADD_EXECUTABLE(avidemux2_gtk ${adm_EXE_SRCS} )
-endif(GTK_FOUND)
-if(QT4_FOUND)
-ADD_EXECUTABLE(avidemux2_qt4 ${adm_EXE_SRCS} )
-endif(QT4_FOUND)
-
-
-add_definitions(${GLIB_CFLAGS})
 ###########################################
 # Build Regular Subdirs
 ###########################################
-FOREACH(_current ${ADM_SUBDIR})
-subdirs (PREORDER ${_current})
-add_libs_all_targets(${_current})
-ENDFOREACH(_current ${ADM_SUBDIR})
-# build trail
-subdirs (PREORDER ADM_osSupport)
-subdirs (PREORDER ADM_encoder)
-subdirs (PREORDER ADM_toolkit)
-subdirs (PREORDER ADM_codecs)
-subdirs (PREORDER ADM_requant)
-subdirs (PREORDER ADM_infoExtractor)
+ADD_SUBDIRECTORY(ADM_osSupport)
+ADD_SUBDIRECTORY(ADM_encoder)
+ADD_SUBDIRECTORY(ADM_toolkit)
+ADD_SUBDIRECTORY(ADM_codecs)
+ADD_SUBDIRECTORY(ADM_requant)
+ADD_SUBDIRECTORY(ADM_infoExtractor)
+
 ###########################################
 # Construct ADM_outputs
 ###########################################
-subdirs (PREORDER ADM_outputs)
-LINK_DIRECTORIES(ADM_outputs)
+ADD_SUBDIRECTORY(ADM_outputs)
+
 SET(ADM_outputs
 oplug_avi
 oplug_mp4
@@ -123,13 +125,14 @@
 )
 
 FOREACH(_current ${ADM_outputs})
-add_libs_all_targets(${_current})
+	add_libs_all_targets(${_current})
 ENDFOREACH(_current ${ADM_outputs})
+
 ###########################################
 # Construct ADM_inputs
 ###########################################
-subdirs (PREORDER ADM_inputs)
-LINK_DIRECTORIES(ADM_inputs)
+ADD_SUBDIRECTORY(ADM_inputs)
+
 SET(ADM_inputs
 ADM_asf
 ADM_avsproxy
@@ -146,14 +149,12 @@
 )
 
 FOREACH(_current ${ADM_inputs})
-add_libs_all_targets(${_current})
+	add_libs_all_targets(${_current})
 ENDFOREACH(_current ${ADM_inputs})
 
 #########################################
 # Tails
 #########################################
-
-
 add_libs_all_targets(ADM_toolkit)
 add_libs_all_targets(ADM_osSupport)
 add_libs_all_targets(ADM_encoder)
@@ -164,10 +165,9 @@
 ###########################################
 # Construct ADM_libraries
 ###########################################
-subdirs (PREORDER ADM_libraries)
-LINK_DIRECTORIES(ADM_libraries)
+ADD_SUBDIRECTORY(ADM_libraries)
+
 SET(ADM_LIBRARIES
-
 ADM_lavformat
 ADM_lavcodec
 ADM_lavutil
@@ -182,70 +182,69 @@
 ADM_lvemux
 ADM_smjs
 ADM_utilities
-ADM_colorspace 
 ADM_xvidratectl
 ADM_libpostproc
+ADM_colorspace
 )
+
 if(USE_FREETYPE)
-SET(ADM_LIBRARIES ${ADM_LIBRARIES}  ADM_libass)
+	SET(ADM_LIBRARIES ${ADM_LIBRARIES} ADM_libass)
 ENDIF(USE_FREETYPE)
 
 if (ADM_DEBUG AND FIND_LEAKS)
-SET(ADM_LIBRARIES ${ADM_LIBRARIES} ADM_nvwa)
+	SET(ADM_LIBRARIES ${ADM_LIBRARIES} ADM_nvwa)
 ENDIF (ADM_DEBUG AND FIND_LEAKS)
 
 FOREACH(_current ${ADM_LIBRARIES})
-add_libs_all_targets(${_current})
+	add_libs_all_targets(${_current})
 ENDFOREACH(_current ${ADM_SUBDIR})
 
 ###########################################
 # Construct ADM_userInterface
 ###########################################
-subdirs (PREORDER ADM_userInterfaces)
+ADD_SUBDIRECTORY(ADM_userInterfaces)
 
-LINK_DIRECTORIES(ADM_userInterfaces)
-LINK_DIRECTORIES(ADM_userInterfaces/ADM_NONE)
+TARGET_LINK_LIBRARIES(avidemux2_cli ADM_UI_None)
+TARGET_LINK_LIBRARIES(avidemux2_cli ADM_commonUI)
+TARGET_LINK_LIBRARIES(avidemux2_cli ADM_ocr)
+TARGET_LINK_LIBRARIES(avidemux2_cli ADM_dialogNone)
+TARGET_LINK_LIBRARIES(avidemux2_cli ADM_dialogFactoryNone)
+TARGET_LINK_LIBRARIES(avidemux2_cli ADM_dialogFiltersNone)
+TARGET_LINK_LIBRARIES(avidemux2_cli ADM_dialogGuiNone)
 
-
-TARGET_LINK_LIBRARIES(avidemux2_cli ADM_commonUI )
-TARGET_LINK_LIBRARIES(avidemux2_cli ADM_ocr )
-TARGET_LINK_LIBRARIES(avidemux2_cli ADM_dialogNone )
-TARGET_LINK_LIBRARIES(avidemux2_cli ADM_dialogFactoryNone )
-TARGET_LINK_LIBRARIES(avidemux2_cli ADM_dialogFiltersNone )
-TARGET_LINK_LIBRARIES(avidemux2_cli ADM_dialogGuiNone )
-
 if(GTK_FOUND)
-TARGET_LINK_LIBRARIES(avidemux2_gtk ADM_commonUI )
-TARGET_LINK_LIBRARIES(avidemux2_gtk ADM_ocr )
-TARGET_LINK_LIBRARIES(avidemux2_gtk ADM_ocrGtk )
-TARGET_LINK_LIBRARIES(avidemux2_gtk ADM_dialogGtk )
-TARGET_LINK_LIBRARIES(avidemux2_gtk ADM_filtersGtk )
-TARGET_LINK_LIBRARIES(avidemux2_gtk ADM_dialogFactoryGtk )
-TARGET_LINK_LIBRARIES(avidemux2_gtk ADM_gui2Gtk )
-TARGET_LINK_LIBRARIES(avidemux2_gtk ADM_toolkitGtk )
-TARGET_LINK_LIBRARIES(avidemux2_gtk ADM_commonUI )
+	TARGET_LINK_LIBRARIES(avidemux2_gtk ADM_UI_GTK)
+	TARGET_LINK_LIBRARIES(avidemux2_gtk ADM_commonUI)
+	TARGET_LINK_LIBRARIES(avidemux2_gtk ADM_ocr)
+	TARGET_LINK_LIBRARIES(avidemux2_gtk ADM_ocrGtk)
+	TARGET_LINK_LIBRARIES(avidemux2_gtk ADM_dialogGtk)
+	TARGET_LINK_LIBRARIES(avidemux2_gtk ADM_filtersGtk)
+	TARGET_LINK_LIBRARIES(avidemux2_gtk ADM_dialogFactoryGtk)
+	TARGET_LINK_LIBRARIES(avidemux2_gtk ADM_gui2Gtk)
+	TARGET_LINK_LIBRARIES(avidemux2_gtk ADM_toolkitGtk)
+	TARGET_LINK_LIBRARIES(avidemux2_gtk ADM_commonUI)
 endif(GTK_FOUND)
 
 if(QT4_FOUND)
-TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_commonUI )
-TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_ocr )
-TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_ocrQt4 )
-TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_dialogQt4 )
-TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_dialogFactoryQt4 )
-TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_guiQt4 )
-TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_filtersQt4 )
-TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_commonUI )
+	TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_UI_QT4)
+	TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_commonUI)
+	TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_ocr)
+	TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_ocrQt4)
+	TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_dialogQt4)
+	TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_dialogFactoryQt4)
+	TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_guiQt4)
+	TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_filtersQt4)
+	TARGET_LINK_LIBRARIES(avidemux2_qt4 ADM_commonUI)
 endif(QT4_FOUND)
 
+add_libs_all_targets(ADM_utilities)
+
 ###########################################
 # Add external libs
 ###########################################
-TARGET_LINK_LIBRARIES(avidemux2_cli ${GLIB_LDFLAGS} )
-LINK_DIRECTORIES(avidemux2_cli ${GLIB_LIB}  )
-
 # ARTS
 if(USE_ARTS)
-add_libs_all_targets( ${ARTS_LDFLAGS})
+	add_libs_all_targets(${ARTS_LDFLAGS})
 endif(USE_ARTS)
 
 # libAMRNB
@@ -260,183 +259,192 @@
 
 # xvid
 if(USE_XVID_4)
-add_libs_all_targets(xvidcore)
+	add_libs_all_targets(xvidcore)
 endif(USE_XVID_4)
 
 #alsa
 if(ALSA_FOUND)
-add_libs_all_targets( ${ASOUND_LIBRARY} )
+	add_libs_all_targets(${ASOUND_LIBRARY})
 endif(ALSA_FOUND)
+
 #fontconfig
 if(USE_FONTCONFIG)
-add_libs_all_targets(fontconfig)
+	add_libs_all_targets(fontconfig)
 endif(USE_FONTCONFIG)
-##########################
-# XVideo 
-##########################
+
+#XVideo 
 if(USE_XV)
-       TARGET_LINK_LIBRARIES(avidemux2_cli Xext)
-       TARGET_LINK_LIBRARIES(avidemux2_cli X11)
-       TARGET_LINK_LIBRARIES(avidemux2_cli Xv)
-       TARGET_LINK_LIBRARIES(avidemux2_cli m)
-       if(GTK_FOUND)
-               TARGET_LINK_LIBRARIES(avidemux2_gtk Xext)
-               TARGET_LINK_LIBRARIES(avidemux2_gtk X11)
-               TARGET_LINK_LIBRARIES(avidemux2_gtk Xv)
-               TARGET_LINK_LIBRARIES(avidemux2_gtk m)
-       endif(GTK_FOUND)
-       if(QT4_FOUND AND NOT CMAKE_OSX_SYSROOT)
-               TARGET_LINK_LIBRARIES(avidemux2_qt4 Xext)
-               TARGET_LINK_LIBRARIES(avidemux2_qt4 X11 )
-               TARGET_LINK_LIBRARIES(avidemux2_qt4 Xv )
-               TARGET_LINK_LIBRARIES(avidemux2_qt4 m)
-       endif(QT4_FOUND AND NOT CMAKE_OSX_SYSROOT)
+	TARGET_LINK_LIBRARIES(avidemux2_cli Xext)
+	TARGET_LINK_LIBRARIES(avidemux2_cli X11)
+	TARGET_LINK_LIBRARIES(avidemux2_cli Xv)
+	TARGET_LINK_LIBRARIES(avidemux2_cli m)
+	
+	if(GTK_FOUND)
+		TARGET_LINK_LIBRARIES(avidemux2_gtk Xext)
+		TARGET_LINK_LIBRARIES(avidemux2_gtk X11)
+		TARGET_LINK_LIBRARIES(avidemux2_gtk Xv)
+		TARGET_LINK_LIBRARIES(avidemux2_gtk m)
+	endif(GTK_FOUND)
+	
+	if(QT4_FOUND AND NOT CMAKE_OSX_SYSROOT)
+		TARGET_LINK_LIBRARIES(avidemux2_qt4 Xext)
+		TARGET_LINK_LIBRARIES(avidemux2_qt4 X11)
+		TARGET_LINK_LIBRARIES(avidemux2_qt4 Xv)
+		TARGET_LINK_LIBRARIES(avidemux2_qt4 m)
+	endif(QT4_FOUND AND NOT CMAKE_OSX_SYSROOT)
 endif(USE_XV)
 
 # Lame
 if(HAVE_LIBMP3LAME)
-add_libs_all_targets(mp3lame )
+	add_libs_all_targets(mp3lame)
 endif(HAVE_LIBMP3LAME)
 
 # SDL
 if(USE_SDL)
-add_libs_all_targets(${SDL_LDFLAGS} )
+	add_libs_all_targets(${SDL_LDFLAGS})
 endif(USE_SDL)
 
 # ESD
 if(USE_ESD)
-add_libs_all_targets(esd )
+	add_libs_all_targets(esd)
 endif(USE_ESD)
 
 # JACK
 if(USE_JACK)
-add_libs_all_targets(jack )
+	add_libs_all_targets(jack)
 endif(USE_JACK)
 
-
 # x264
 if(USE_X264)
-add_libs_all_targets(x264 )
+	add_libs_all_targets(x264)
 endif(USE_X264)
 
 # png
 if(USE_PNG)
-add_libs_all_targets(png )
+	add_libs_all_targets(png)
 endif(USE_PNG)
 
 # Vorbis
 if(USE_VORBIS)
-add_libs_all_targets(vorbis )
-add_libs_all_targets(vorbisenc )
+	add_libs_all_targets(vorbis)
+	add_libs_all_targets(vorbisenc)
 endif(USE_VORBIS)
 
 #faac
 if(USE_FAAC)
-add_libs_all_targets(faac)
+	add_libs_all_targets(faac)
 endif(USE_FAAC)
 
 #aften
 if(USE_AFTEN)
-add_libs_all_targets(aften)
+	add_libs_all_targets(aften)
 endif(USE_AFTEN)
 
-
 #faad
 if(USE_FAAD)
-add_libs_all_targets(faad)
+	add_libs_all_targets(faad)
 endif(USE_FAAD)
 
 #freetype
 if(USE_FREETYPE)
-add_libs_all_targets(${FT_LDFLAGS})
+	add_libs_all_targets(${FT_LDFLAGS})
 endif(USE_FREETYPE)
 
 #gettext
 if(ADM_GETTEXT_LIB)
-add_libs_all_targets(${ADM_GETTEXT_LIB})
+	TARGET_LINK_LIBRARIES(avidemux2_cli ${ADM_GETTEXT_LIB})
+
+	if(GTK_FOUND)
+		TARGET_LINK_LIBRARIES(avidemux2_gtk ${ADM_GETTEXT_LIB})
+	endif(GTK_FOUND)
 endif(ADM_GETTEXT_LIB)
 
 #iconv
 if(NEEED_LIBICONV)
-add_libs_all_targets(iconv)
+	add_libs_all_targets(iconv)
 endif(NEEED_LIBICONV)
 
 #libsamplerate
 if(USE_SRC)
-add_libs_all_targets(samplerate)
+	add_libs_all_targets(samplerate)
 endif(USE_SRC)
 
 # Xml2
-add_libs_all_targets(xml2 )
+add_libs_all_targets(xml2)
+
 ###########################################
 # Specific
 ###########################################
+TARGET_LINK_LIBRARIES(avidemux2_cli ${GLIB_LDFLAGS})
+LINK_DIRECTORIES(avidemux2_cli ${GLIB_LIB})
+
 if(GTK_FOUND)
-TARGET_LINK_LIBRARIES(avidemux2_gtk ${GLIB_LDFLAGS} )
-LINK_DIRECTORIES(avidemux2_gtk ${GLIB_LIB}  )
-TARGET_LINK_LIBRARIES(avidemux2_gtk ${GTK_LDFLAGS} )
-TARGET_LINK_LIBRARIES(avidemux2_gtk ${GTHREAD_LDFLAGS} ) # FIXME
+	TARGET_LINK_LIBRARIES(avidemux2_gtk ${GLIB_LDFLAGS})
+	LINK_DIRECTORIES(avidemux2_gtk ${GLIB_LIB})
+	TARGET_LINK_LIBRARIES(avidemux2_gtk ${GTK_LDFLAGS})
+	TARGET_LINK_LIBRARIES(avidemux2_gtk ${GTHREAD_LDFLAGS}) # FIXME
 endif(GTK_FOUND)
 
 if(QT4_FOUND)
-TARGET_LINK_LIBRARIES(avidemux2_qt4 ${GLIB_LDFLAGS} )
-LINK_DIRECTORIES(avidemux2_qt4 ${GLIB_LIB}  )
-TARGET_LINK_LIBRARIES(avidemux2_qt4 ${QT_QTGUI_LIBRARY} ) # FIXME
-TARGET_LINK_LIBRARIES(avidemux2_qt4 ${QT_QTCORE_LIBRARY} ) # FIXME
+	TARGET_LINK_LIBRARIES(avidemux2_qt4 ${GLIB_LDFLAGS})
+	LINK_DIRECTORIES(avidemux2_qt4 ${GLIB_LIB})
+	TARGET_LINK_LIBRARIES(avidemux2_qt4 ${QT_QTGUI_LIBRARY}) # FIXME
+	TARGET_LINK_LIBRARIES(avidemux2_qt4 ${QT_QTCORE_LIBRARY}) # FIXME
 endif(QT4_FOUND)
 
-
 ########################
 # Win32
 ########################
 IF(WIN32)
-add_libs_all_targets(z)
-add_libs_all_targets(ADM_osSupport)
-add_libs_all_targets(pthreadGC2)
-add_libs_all_targets(winmm)
-add_libs_all_targets(wsock32)
-add_libs_all_targets(imagehlp)
+	add_libs_all_targets(z)
+	add_libs_all_targets(ADM_osSupport)
+	add_libs_all_targets(pthreadGC2)
+	add_libs_all_targets(winmm)
+	add_libs_all_targets(wsock32)
+	add_libs_all_targets(imagehlp)
 
-add_ldflags_all_targets( "-mms-bitfield -mno-cygwin -mwinmm -mwindows ${CMAKE_SOURCE_DIR}/avidemux/xpm/adm.o -Wl,--export-all-symbols")
+	add_ldflags_all_targets("-mms-bitfield -mno-cygwin -mwinmm -mwindows ${CMAKE_SOURCE_DIR}/avidemux/xpm/adm.o -Wl,--export-all-symbols")
 
-if(CMAKE_BUILD_TYPE STREQUAL "Release")
-add_ldflags_all_targets("-Wl,-s")
-endif(CMAKE_BUILD_TYPE STREQUAL "Release")
+	if(CMAKE_BUILD_TYPE STREQUAL "Release")
+		add_ldflags_all_targets("-Wl,-s")
+	endif(CMAKE_BUILD_TYPE STREQUAL "Release")
 
-if(USE_SDL)
-add_definitions(${SDL_CFLAGS})
-endif(USE_SDL)
+	if(USE_SDL)
+		add_definitions(${SDL_CFLAGS})
+	endif(USE_SDL)
 ENDIF(WIN32)
+
 ########################
 # MacOsX
 ########################
 if(CMAKE_OSX_SYSROOT)
-add_libs_all_targets(z)
-add_libs_all_targets( "-framework CoreServices  -framework CoreAudio   -framework AudioUnit")
-if(GTK_FOUND)
-LINK_DIRECTORIES(avidemux2_gtk /usr/X11R6/lib )
-endif(GTK_FOUND)
+	add_libs_all_targets(z)
+	add_libs_all_targets("-framework CoreServices -framework CoreAudio -framework AudioUnit")
+	
+	if(GTK_FOUND)
+		LINK_DIRECTORIES(avidemux2_gtk /usr/X11R6/lib)
+	endif(GTK_FOUND)
+endif(CMAKE_OSX_SYSROOT)
 
-endif(CMAKE_OSX_SYSROOT)
 ########################
 # all
 ########################
-SDLify(main.cpp )
+SDLify(main.cpp)
 add_compile_flags(main.cpp "-DADM_SUBVERSION=${ADM_SUBVERSION}")
+
 ###############
 # INSTALL
 ###############
 SET(ADM_EXES avidemux2_cli)
+
 if(GTK_FOUND)
-  SET(ADM_EXES ${ADM_EXES} avidemux2_gtk)
+	SET(ADM_EXES ${ADM_EXES} avidemux2_gtk)
 endif(GTK_FOUND)
+
 if(QT4_FOUND)
-  SET(ADM_EXES ${ADM_EXES} avidemux2_qt4)
+	SET(ADM_EXES ${ADM_EXES} avidemux2_qt4)
 endif(QT4_FOUND)
 
-INSTALL(TARGETS ${ADM_EXES}
-            RUNTIME DESTINATION bin
-            LIBRARY DESTINATION lib)
-# /EOF
+INSTALL(TARGETS ${ADM_EXES} RUNTIME DESTINATION bin LIBRARY DESTINATION lib)
 
-
+# EOF

Modified: branches/avidemux_2.4_branch/avidemux/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/Makefile.am	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/Makefile.am	2007-09-25 18:08:12 UTC (rev 3597)
@@ -25,6 +25,7 @@
 		./ADM_toolkit/libADM_toolkit.a				\
 		./ADM_ocr/libADM_ocr.a	\
 		./ADM_userInterfaces/ADM_commonUI/libmergedCommonUI.o  \
+		./ADM_userInterfaces/ADM_GTK/libADM_UI_GTK.a    \
 		./ADM_userInterfaces/ADM_GTK/ADM_ocr/libADM_ocrGtk.a	\
 		./ADM_userInterfaces/ADM_GTK/ADM_filters/libADM_filtersGtk.a \
 		./ADM_userInterfaces/ADM_GTK/ADM_dialog/libADM_dialogGtk.a	\
@@ -34,6 +35,7 @@
 		
 user_interface_cli = \
 		./ADM_toolkit/libADM_toolkit.a				\
+		./ADM_userInterfaces/ADM_NONE/libADM_UI_None.a    \
 		./ADM_userInterfaces/ADM_NONE/ADM_gui2/libADM_gui2.a	\
 		./ADM_userInterfaces/ADM_NONE/ADM_dialog/libADM_dialog.a	\
 		./ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/libADM_dialogFactory.a	\
@@ -44,16 +46,18 @@
 		
 		
 user_interface_qt4 = \
-			./ADM_ocr/libADM_ocr.a	\
+			./ADM_ocr/libADM_ocr.a	\			
+			./ADM_userInterfaces/ADM_QT4/libADM_UI_QT4.a   \
 			./ADM_userInterfaces/ADM_QT4/ADM_gui/libADM_gui2.a	\
 			./ADM_userInterfaces/ADM_QT4/ADM_dialog/libADM_dialog.a	\
 			./ADM_userInterfaces/ADM_QT4/ADM_dialog/AQ_srt.o	\
 			./ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/libADM_dialogFactory.a	\
 			./ADM_userInterfaces/ADM_commonUI/libADM_CommonUI.a	\
+			./ADM_userInterfaces/ADM_QT4/ADM_ocr/libADM_ocrQt4.a   \
 			./ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/libADM_dialogFactory.a	\
 			./ADM_userInterfaces/ADM_QT4/ADM_gui/libADM_gui2.a	\
 			./ADM_userInterfaces/ADM_QT4/ADM_filters/libADM_filters.a \
-			./ADM_toolkit/libADM_toolkit.a				
+			./ADM_toolkit/libADM_toolkit.a
 
 adm_src =   guiplay.cpp  \
 	gui_savenew.cpp  gui_navigate.cpp gtk_gui.cpp   \

Modified: branches/avidemux_2.4_branch/avidemux/main.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/main.cpp	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/avidemux/main.cpp	2007-09-25 18:08:12 UTC (rev 3597)
@@ -22,10 +22,6 @@
 #include <stdlib.h>
 #include <glib.h>
 
-#ifdef HAVE_GETTEXT
-#include <libintl.h>
-#include <locale.h>
-#endif
 #include "default.h"
 
 #ifdef ADM_WIN32
@@ -178,37 +174,6 @@
 	printf("\nLarge file available: %d offset\n", __USE_FILE_OFFSET64);
 #endif
 
-#ifdef HAVE_GETTEXT
-	char *local=setlocale (LC_ALL, "");
-
-#ifndef ADM_WIN32
-	bindtextdomain ("avidemux", ADMLOCALE);
-#else
-	bindtextdomain ("avidemux", "./share/locale");
-#endif
-
-	bind_textdomain_codeset ("avidemux", "UTF-8");
-  
-	if(local)
-		printf("\n[Locale] setlocale %s\n",local);
-
-	local=textdomain(NULL);
-	textdomain ("avidemux");
-
-	if(local)
-	    printf("[Locale] Textdomain was %s\n",local);
-
-	local=textdomain(NULL);
-
-	if(local)
-		printf("[Locale] Textdomain is now %s\n",local);
-
-#ifndef ADM_WIN32
-	printf("[Locale] Files for %s appear to be in %s\n","avidemux", ADMLOCALE);
-#endif
-	printf("[Locale] Test: %s\n\n",dgettext("avidemux","_File"));
-#endif
-
    // Start counting memory
 	ADM_memStatInit();
 	ADM_intFloatInit();

Added: branches/avidemux_2.4_branch/po/avidemux.pro
===================================================================
--- branches/avidemux_2.4_branch/po/avidemux.pro	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/po/avidemux.pro	2007-09-25 18:08:12 UTC (rev 3597)
@@ -0,0 +1,1087 @@
+HEADERS = \
+../avidemux/ADM_assert.h \ 
+../avidemux/ADM_audio/ADM_a52info.h \ 
+../avidemux/ADM_audio/ADM_aacinfo.h \ 
+../avidemux/ADM_audio/ADM_audiodef.h \ 
+../avidemux/ADM_audio/ADM_dcainfo.h \ 
+../avidemux/ADM_audio/ADM_mp3info.h \ 
+../avidemux/ADM_audio/audioex.h \ 
+../avidemux/ADM_audio/audiosource_ext.h \ 
+../avidemux/ADM_audiocodec/ADM_audiocodec.h \ 
+../avidemux/ADM_audiocodec/ADM_audiocodeclist.h \ 
+../avidemux/ADM_audiocodec/adm_ogg.h \ 
+../avidemux/ADM_audiocodec/ADM_vorbis.h \ 
+../avidemux/ADM_audiodevice/ADM_audiodevice.h \ 
+../avidemux/ADM_audiodevice/ADM_deviceALSA.h \ 
+../avidemux/ADM_audiodevice/ADM_deviceArts.h \ 
+../avidemux/ADM_audiodevice/ADM_deviceAudioCore.h \ 
+../avidemux/ADM_audiodevice/ADM_deviceEsd.h \ 
+../avidemux/ADM_audiodevice/ADM_deviceJack.h \ 
+../avidemux/ADM_audiodevice/ADM_deviceoss.h \ 
+../avidemux/ADM_audiodevice/ADM_deviceSDL.h \ 
+../avidemux/ADM_audiodevice/ADM_deviceWin32.h \ 
+../avidemux/ADM_audiodevice/audio_out.h \ 
+../avidemux/ADM_audiofilter/audioencoder.h \ 
+../avidemux/ADM_audiofilter/audioencoder_aften.h \ 
+../avidemux/ADM_audiofilter/audioencoder_aften_param.h \ 
+../avidemux/ADM_audiofilter/audioencoder_config.h \ 
+../avidemux/ADM_audiofilter/audioencoder_faac.h \ 
+../avidemux/ADM_audiofilter/audioencoder_faac_param.h \ 
+../avidemux/ADM_audiofilter/audioencoder_lame.h \ 
+../avidemux/ADM_audiofilter/audioencoder_lame_param.h \ 
+../avidemux/ADM_audiofilter/audioencoder_lavcodec.h \ 
+../avidemux/ADM_audiofilter/audioencoder_pcm.h \ 
+../avidemux/ADM_audiofilter/audioencoder_twolame.h \ 
+../avidemux/ADM_audiofilter/audioencoder_twolame_param.h \ 
+../avidemux/ADM_audiofilter/audioencoder_vorbis.h \ 
+../avidemux/ADM_audiofilter/audioencoder_vorbis_param.h \ 
+../avidemux/ADM_audiofilter/audioeng_buildfilters.h \ 
+../avidemux/ADM_audiofilter/audioeng_process.h \ 
+../avidemux/ADM_audiofilter/audiofilter_bridge.h \ 
+../avidemux/ADM_audiofilter/audiofilter_channel_route.h \ 
+../avidemux/ADM_audiofilter/audiofilter_dolby.h \ 
+../avidemux/ADM_audiofilter/audiofilter_film2pal.h \ 
+../avidemux/ADM_audiofilter/audiofilter_limiter.h \ 
+../avidemux/ADM_audiofilter/audiofilter_limiter_param.h \ 
+../avidemux/ADM_audiofilter/audiofilter_mixer.h \ 
+../avidemux/ADM_audiofilter/audiofilter_normalize.h \ 
+../avidemux/ADM_audiofilter/audiofilter_normalize_param.h \ 
+../avidemux/ADM_audiofilter/audiofilter_sox.h \ 
+../avidemux/ADM_audiofilter/audiolib_sox.h \ 
+../avidemux/ADM_audiofilter/audio_raw.h \ 
+../avidemux/ADM_audiofilter/resampl.h \ 
+../avidemux/ADM_codecs/ADM_codec.h \ 
+../avidemux/ADM_codecs/ADM_codecNull.h \ 
+../avidemux/ADM_codecs/ADM_ffmp43.h \ 
+../avidemux/ADM_codecs/ADM_ffmpeg.h \ 
+../avidemux/ADM_codecs/ADM_ffmpegConfig.h \ 
+../avidemux/ADM_codecs/ADM_mjpeg.h \ 
+../avidemux/ADM_codecs/ADM_mjpegEncode.h \ 
+../avidemux/ADM_codecs/ADM_mpeg.h \ 
+../avidemux/ADM_codecs/ADM_png.h \ 
+../avidemux/ADM_codecs/ADM_rgb16.h \ 
+../avidemux/ADM_codecs/ADM_theora_dec.h \ 
+../avidemux/ADM_codecs/ADM_theora_enc.h \ 
+../avidemux/ADM_codecs/ADM_uyvy.h \ 
+../avidemux/ADM_codecs/ADM_x264.h \ 
+../avidemux/ADM_codecs/ADM_x264param.h \ 
+../avidemux/ADM_codecs/ADM_xvid.h \ 
+../avidemux/ADM_codecs/ADM_xvid4.h \ 
+../avidemux/ADM_codecs/ADM_xvid4param.h \ 
+../avidemux/ADM_codecs/ADM_xvideco.h \ 
+../avidemux/ADM_colorspace/ADM_rgb.h \ 
+../avidemux/ADM_colorspace/colorspace.h \ 
+../avidemux/ADM_editor/ADM_edCache.h \ 
+../avidemux/ADM_editor/ADM_outputfmt.h \ 
+../avidemux/ADM_editor/ADM_Video.h \ 
+../avidemux/ADM_encoder/ADM_encCodecDesc.h \ 
+../avidemux/ADM_encoder/adm_encConfig.h \ 
+../avidemux/ADM_encoder/adm_encCopy.h \ 
+../avidemux/ADM_encoder/adm_encdivx.h \ 
+../avidemux/ADM_encoder/adm_encffmatrix.h \ 
+../avidemux/ADM_encoder/adm_encffmpeg.h \ 
+../avidemux/ADM_encoder/adm_encmjpeg.h \ 
+../avidemux/ADM_encoder/adm_encmjpeg_param.h \ 
+../avidemux/ADM_encoder/adm_encmpeg2enc.h \ 
+../avidemux/ADM_encoder/adm_encoder.h \ 
+../avidemux/ADM_encoder/adm_encRequant.h \ 
+../avidemux/ADM_encoder/adm_encx264.h \ 
+../avidemux/ADM_encoder/adm_encxvid.h \ 
+../avidemux/ADM_encoder/adm_encXvid4.h \ 
+../avidemux/ADM_encoder/adm_encyv12.h \ 
+../avidemux/ADM_encoder/ADM_videocodeclist.h \ 
+../avidemux/ADM_encoder/xvid_vbr.h \ 
+../avidemux/ADM_filter/video_filters.h \ 
+../avidemux/ADM_filter/vidVCD.h \ 
+../avidemux/ADM_infoExtractor/ADM_h264_tag.h \ 
+../avidemux/ADM_inputs/ADM_amv/ADM_amv.h \ 
+../avidemux/ADM_inputs/ADM_asf/ADM_asf.h \ 
+../avidemux/ADM_inputs/ADM_asf/ADM_asfIo.h \ 
+../avidemux/ADM_inputs/ADM_asf/ADM_asfPacket.h \ 
+../avidemux/ADM_inputs/ADM_avsproxy/ADM_avsproxy.h \ 
+../avidemux/ADM_inputs/ADM_avsproxy/ADM_avsproxy_internal.h \ 
+../avidemux/ADM_inputs/ADM_flv/ADM_flv.h \ 
+../avidemux/ADM_inputs/ADM_h263/ADM_h263.h \ 
+../avidemux/ADM_inputs/ADM_h263/bitsRead.h \ 
+../avidemux/ADM_inputs/ADM_inpics/ADM_pics.h \ 
+../avidemux/ADM_inputs/ADM_inpics/bitmap.h \ 
+../avidemux/ADM_inputs/ADM_matroska/ADM_ebml.h \ 
+../avidemux/ADM_inputs/ADM_matroska/ADM_mkv.h \ 
+../avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h \ 
+../avidemux/ADM_inputs/ADM_matroska/mkv_tags.h \ 
+../avidemux/ADM_inputs/ADM_mp4/ADM_atom.h \ 
+../avidemux/ADM_inputs/ADM_mp4/ADM_mp4.h \ 
+../avidemux/ADM_inputs/ADM_mp4/ADM_mp4Leaf.h \ 
+../avidemux/ADM_inputs/ADM_mp4/ADM_mp4Tree.h \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_audio.h \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxer.h \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxerEs.h \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxerMSDVR.h \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxerPS.h \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxerTS.h \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_identify.h \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer.h \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer_internal.h \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_io.h \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_mpegstartcode.h \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probe.h \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.h \ 
+../avidemux/ADM_inputs/ADM_nuv/ADM_nuv.h \ 
+../avidemux/ADM_inputs/ADM_nuv/ADM_rtGlob.h \ 
+../avidemux/ADM_inputs/ADM_nuv/lzoconf.h \ 
+../avidemux/ADM_inputs/ADM_nuv/minilzo.h \ 
+../avidemux/ADM_inputs/ADM_nuv/mmx.h \ 
+../avidemux/ADM_inputs/ADM_nuv/nuppel.h \ 
+../avidemux/ADM_inputs/ADM_nuv/RTjpeg.h \ 
+../avidemux/ADM_inputs/ADM_nuv/RTjpegN.h \ 
+../avidemux/ADM_inputs/ADM_ogm/ADM_oghead.h \ 
+../avidemux/ADM_inputs/ADM_ogm/ADM_ogm.h \ 
+../avidemux/ADM_inputs/ADM_ogm/ADM_ogmpages.h \ 
+../avidemux/ADM_inputs/ADM_openDML/ADM_odml_audio.h \ 
+../avidemux/ADM_inputs/ADM_openDML/ADM_openDML.h \ 
+../avidemux/ADM_inputs/ADM_openDML/ADM_riff.h \ 
+../avidemux/ADM_lavcodec.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/ac3.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/ac3tab.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/allcodecs.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/avcodec.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/bitstream.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/bytestream.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/cabac.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/dnxhddata.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/dsputil.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/dsputil_cpu.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/dvdata.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/eval.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/faandct.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/fastmemcpy.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/ffconf.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/golomb.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/h261.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/h261data.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/h263.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/h263data.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/h263_parser.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/h264.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/h264data.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/h264_parser.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/i386/dsputil_mmx_avg.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/i386/dsputil_mmx_qns.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/i386/dsputil_mmx_rnd.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/i386/mathops.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/i386/mmx.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/i386/vp3dsp_mmx.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/i386/vp3dsp_sse2.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/imgconvert_template.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/indeo2data.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/indeo3data.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/jpeglsdec.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/mathops.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/mjpeg.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/mjpegdec.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/mjpegenc.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/mpeg12.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/mpeg12data.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/mpeg12decdata.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/mpeg4data.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/mpeg4video_parser.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/mpegaudio.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/mpegaudiodata.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/mpegaudiodecheader.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/mpegaudiodectab.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/mpegaudiotab.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/mpegvideo.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/mpegvideo_common.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/msmpeg4.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/msmpeg4data.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/msmpeg4tab.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/oggvorbis.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/opt.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/os_support.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/parser.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/ppc/dsputil_altivec.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/ppc/dsputil_ppc.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/ppc/gcc_fixes.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/qdm2data.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/ra144.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/ra288.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/rangecoder.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/ratecontrol.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/raw.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/rl.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/roqvideo.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/simple_idct.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/snow.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/sp5x.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/svq1.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/svq1_cb.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/svq1_vlc.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/truemotion1data.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/vc1.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/vc1acdata.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/vc1data.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/vp3data.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/vp56.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/vp56data.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/vp5data.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/vp6data.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/wma.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/wmadata.h \ 
+../avidemux/ADM_libraries/ADM_lavcodec/xiph.h \ 
+../avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.h \ 
+../avidemux/ADM_libraries/ADM_lavformat/ADM_tscrc.h \ 
+../avidemux/ADM_libraries/ADM_lavformat/allformats.h \ 
+../avidemux/ADM_libraries/ADM_lavformat/avformat.h \ 
+../avidemux/ADM_libraries/ADM_lavformat/avi.h \ 
+../avidemux/ADM_libraries/ADM_lavformat/avio.h \ 
+../avidemux/ADM_libraries/ADM_lavformat/dv.h \ 
+../avidemux/ADM_libraries/ADM_lavformat/flv.h \ 
+../avidemux/ADM_libraries/ADM_lavformat/isom.h \ 
+../avidemux/ADM_libraries/ADM_lavformat/matroska.h \ 
+../avidemux/ADM_libraries/ADM_lavformat/mov.h \ 
+../avidemux/ADM_libraries/ADM_lavformat/mpeg.h \ 
+../avidemux/ADM_libraries/ADM_lavformat/mpegts.h \ 
+../avidemux/ADM_libraries/ADM_lavformat/qtpalette.h \ 
+../avidemux/ADM_libraries/ADM_lavformat/riff.h \ 
+../avidemux/ADM_libraries/ADM_lavformat/rtp.h \ 
+../avidemux/ADM_libraries/ADM_lavformat/rtsp.h \ 
+../avidemux/ADM_libraries/ADM_lavformat/rtspcodes.h \ 
+../avidemux/ADM_libraries/ADM_lavutil/adler32.h \ 
+../avidemux/ADM_libraries/ADM_lavutil/avstring.h \ 
+../avidemux/ADM_libraries/ADM_lavutil/avutil.h \ 
+../avidemux/ADM_libraries/ADM_lavutil/bswap.h \ 
+../avidemux/ADM_libraries/ADM_lavutil/common.h \ 
+../avidemux/ADM_libraries/ADM_lavutil/crc.h \ 
+../avidemux/ADM_libraries/ADM_lavutil/fifo.h \ 
+../avidemux/ADM_libraries/ADM_lavutil/integer.h \ 
+../avidemux/ADM_libraries/ADM_lavutil/internal.h \ 
+../avidemux/ADM_libraries/ADM_lavutil/intfloat_readwrite.h \ 
+../avidemux/ADM_libraries/ADM_lavutil/intreadwrite.h \ 
+../avidemux/ADM_libraries/ADM_lavutil/lls.h \ 
+../avidemux/ADM_libraries/ADM_lavutil/log.h \ 
+../avidemux/ADM_libraries/ADM_lavutil/mathematics.h \ 
+../avidemux/ADM_libraries/ADM_lavutil/md5.h \ 
+../avidemux/ADM_libraries/ADM_lavutil/mem.h \ 
+../avidemux/ADM_libraries/ADM_lavutil/random.h \ 
+../avidemux/ADM_libraries/ADM_lavutil/rational.h \ 
+../avidemux/ADM_libraries/ADM_lavutil/x86_cpu.h \ 
+../avidemux/ADM_libraries/ADM_liba52/a52.h \ 
+../avidemux/ADM_libraries/ADM_liba52/a52_internal.h \ 
+../avidemux/ADM_libraries/ADM_liba52/attributes.h \ 
+../avidemux/ADM_libraries/ADM_liba52/bitstream.h \ 
+../avidemux/ADM_libraries/ADM_liba52/mm_accel.h \ 
+../avidemux/ADM_libraries/ADM_liba52/tables.h \ 
+../avidemux/ADM_libraries/ADM_libass/ass.h \ 
+../avidemux/ADM_libraries/ADM_libass/ass_bitmap.h \ 
+../avidemux/ADM_libraries/ADM_libass/ass_cache.h \ 
+../avidemux/ADM_libraries/ADM_libass/ass_font.h \ 
+../avidemux/ADM_libraries/ADM_libass/ass_fontconfig.h \ 
+../avidemux/ADM_libraries/ADM_libass/ass_library.h \ 
+../avidemux/ADM_libraries/ADM_libass/ass_types.h \ 
+../avidemux/ADM_libraries/ADM_libass/ass_utils.h \ 
+../avidemux/ADM_libraries/ADM_libass/help_mp.h \ 
+../avidemux/ADM_libraries/ADM_libass/mputils.h \ 
+../avidemux/ADM_libraries/ADM_libMad/bit.h \ 
+../avidemux/ADM_libraries/ADM_libMad/decoder.h \ 
+../avidemux/ADM_libraries/ADM_libMad/fixed.h \ 
+../avidemux/ADM_libraries/ADM_libMad/frame.h \ 
+../avidemux/ADM_libraries/ADM_libMad/global.h \ 
+../avidemux/ADM_libraries/ADM_libMad/huffman.h \ 
+../avidemux/ADM_libraries/ADM_libMad/layer12.h \ 
+../avidemux/ADM_libraries/ADM_libMad/layer3.h \ 
+../avidemux/ADM_libraries/ADM_libMad/mad.h \ 
+../avidemux/ADM_libraries/ADM_libMad/madmem.h \ 
+../avidemux/ADM_libraries/ADM_libMad/stream.h \ 
+../avidemux/ADM_libraries/ADM_libMad/synth.h \ 
+../avidemux/ADM_libraries/ADM_libMad/timer.h \ 
+../avidemux/ADM_libraries/ADM_libMad/version.h \ 
+../avidemux/ADM_libraries/ADM_libMpeg2Dec/attributes.h \ 
+../avidemux/ADM_libraries/ADM_libMpeg2Dec/convert.h \ 
+../avidemux/ADM_libraries/ADM_libMpeg2Dec/mmx.h \ 
+../avidemux/ADM_libraries/ADM_libMpeg2Dec/mpeg2.h \ 
+../avidemux/ADM_libraries/ADM_libMpeg2Dec/mpeg2_cpu.h \ 
+../avidemux/ADM_libraries/ADM_libMpeg2Dec/mpeg2_internal.h \ 
+../avidemux/ADM_libraries/ADM_libMpeg2Dec/video_out.h \ 
+../avidemux/ADM_libraries/ADM_libMpeg2Dec/vlc.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/ADM_mpeg2enc.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/ADM_mpeg2Param.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/altivec/altivec_conf.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/altivec/altivec_motion.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/altivec/altivec_predict.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/altivec/altivec_quantize.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/altivec/altivec_transform.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/altivec/amber.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/altivec/benchmark.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/altivec/mjpeg_logging.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/altivec/mjpeg_types.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/altivec/quantize_precomp.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/altivec/quantize_ref.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/altivec/syntaxconsts.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/altivec/vectorize.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/altivec/verify.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/attributes.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/cpu_accel.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/fastintfns.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/format_codes.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/global.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/mblock_sub44_sads_x86.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/mjpeg_logging.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/mjpeg_types.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/mmx.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/mmxsse_motion.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/motionsearch.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2enc.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/mpeg2parm.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/mpegconsts.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/predict_ref.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/quantize_ref.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/simd.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/synchrolib.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/syntaxparams.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/tables.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/transfrm_ref.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/vlc.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/yuv4mpeg.h \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/yuv4mpeg_intern.h \ 
+../avidemux/ADM_libraries/ADM_libpostproc/mangle.h \ 
+../avidemux/ADM_libraries/ADM_libpostproc/postprocess.h \ 
+../avidemux/ADM_libraries/ADM_libpostproc/postprocess_internal.h \ 
+../avidemux/ADM_libraries/ADM_libswscale/ADM_mp.h \ 
+../avidemux/ADM_libraries/ADM_libswscale/rgb2rgb.h \ 
+../avidemux/ADM_libraries/ADM_libswscale/swscale.h \ 
+../avidemux/ADM_libraries/ADM_libswscale/swscale_internal.h \ 
+../avidemux/ADM_libraries/ADM_libswscale/wrapper.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/absthr.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/ath.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/availbits.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/bitbuffer.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/common.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/crc.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/critband.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/dab.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/encode.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/encoder.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/encode_new.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/energy.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/enwindow.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/fft.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/freqtable.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/mem.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/musicin.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/psycho_0.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/psycho_1.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/psycho_1_critband.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/psycho_1_freqtable.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/psycho_2.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/psycho_2_absthr.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/psycho_3.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/psycho_4.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/psycho_n1.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/subband.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/tables.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/twolame.h \ 
+../avidemux/ADM_libraries/ADM_libtwolame/util.h \ 
+../avidemux/ADM_libraries/ADM_libwrapper/libwrapper.h \ 
+../avidemux/ADM_libraries/ADM_libwrapper/libwrapper_amrnb.h \ 
+../avidemux/ADM_libraries/ADM_libwrapper/libwrapper_dca.h \ 
+../avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.h \ 
+../avidemux/ADM_libraries/ADM_lvemux/ADM_muxer.h \ 
+../avidemux/ADM_libraries/ADM_lvemux/mux_out.h \ 
+../avidemux/ADM_libraries/ADM_mplex/ADM_inout.h \ 
+../avidemux/ADM_libraries/ADM_mplex/ADM_mthread.h \ 
+../avidemux/ADM_libraries/ADM_mplex/ADM_transfert.h \ 
+../avidemux/ADM_libraries/ADM_mplex/cpu_accel.h \ 
+../avidemux/ADM_libraries/ADM_mplex/format_codes.h \ 
+../avidemux/ADM_libraries/ADM_mplex/mjpeg_logging.h \ 
+../avidemux/ADM_libraries/ADM_mplex/mjpeg_types.h \ 
+../avidemux/ADM_libraries/ADM_mplex/mpegconsts.h \ 
+../avidemux/ADM_libraries/ADM_mplex/streamType.h \ 
+../avidemux/ADM_libraries/ADM_mplex/yuv4mpeg.h \ 
+../avidemux/ADM_libraries/ADM_mplex/yuv4mpeg_intern.h \ 
+../avidemux/ADM_libraries/ADM_nvwa/debug_new.h \ 
+../avidemux/ADM_libraries/ADM_nvwa/fast_mutex.h \ 
+../avidemux/ADM_libraries/ADM_nvwa/static_assert.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsapi.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsarena.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsarray.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsatom.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsautocfg.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsbit.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsbool.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsclist.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jscntxt.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jscompat.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsconfig.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jscpucfg.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsdate.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsdbgapi.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsdhash.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsdtoa.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsemit.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsexn.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsfile.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsfun.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsgc.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jshash.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsinterp.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jslibmath.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jslock.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jslong.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsmath.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsnum.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsobj.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsopcode.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsosdep.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsotypes.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsparse.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsprf.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsprvtd.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jspubtd.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsregexp.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsscan.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsscope.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsscript.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsstddef.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsstr.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jstypes.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsutil.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsxdrapi.h \ 
+../avidemux/ADM_libraries/ADM_smjs/jsxml.h \ 
+../avidemux/ADM_libraries/ADM_smjs/prmjtime.h \ 
+../avidemux/ADM_libraries/ADM_smjs/resource.h \ 
+../avidemux/ADM_libraries/ADM_utilities/admmangle.h \ 
+../avidemux/ADM_libraries/ADM_utilities/ADM_bitstream.h \ 
+../avidemux/ADM_libraries/ADM_utilities/ADM_compressedImage.h \ 
+../avidemux/ADM_libraries/ADM_utilities/ADM_fileio.h \ 
+../avidemux/ADM_libraries/ADM_utilities/ADM_image.h \ 
+../avidemux/ADM_libraries/ADM_utilities/ADM_pp.h \ 
+../avidemux/ADM_libraries/ADM_utilities/ADM_print_priv.h \ 
+../avidemux/ADM_libraries/ADM_utilities/avidemutils.h \ 
+../avidemux/ADM_libraries/ADM_utilities/avifmt.h \ 
+../avidemux/ADM_libraries/ADM_utilities/avifmt2.h \ 
+../avidemux/ADM_libraries/ADM_utilities/default.h \ 
+../avidemux/ADM_libraries/ADM_utilities/fourcc.h \ 
+../avidemux/ADM_libraries/ADM_utilities/subchunk.h \ 
+../avidemux/ADM_libraries/ADM_xvidratectl/ADM_ratecontrol.h \ 
+../avidemux/ADM_libraries/ADM_xvidratectl/ADM_xvidr_internal.h \ 
+../avidemux/ADM_ocr/adm_glyph.h \ 
+../avidemux/ADM_ocr/ADM_leftturn.h \ 
+../avidemux/ADM_ocr/ADM_ocr.h \ 
+../avidemux/ADM_ocr/ADM_ocrInternal.h \ 
+../avidemux/ADM_osSupport/ADM_cpuCap.h \ 
+../avidemux/ADM_osSupport/ADM_debug.h \ 
+../avidemux/ADM_osSupport/ADM_debugID.h \ 
+../avidemux/ADM_osSupport/ADM_misc.h \ 
+../avidemux/ADM_osSupport/ADM_queue.h \ 
+../avidemux/ADM_osSupport/ADM_quota.h \ 
+../avidemux/ADM_osSupport/ADM_threads.h \ 
+../avidemux/ADM_osSupport/TLK_clock.h \ 
+../avidemux/ADM_outputs/oplug_avi/avilist.h \ 
+../avidemux/ADM_outputs/oplug_avi/GUI_mux.h \ 
+../avidemux/ADM_outputs/oplug_avi/op_avisave.h \ 
+../avidemux/ADM_outputs/oplug_avi/op_savecopy.h \ 
+../avidemux/ADM_outputs/oplug_avi/op_saveprocess.h \ 
+../avidemux/ADM_outputs/oplug_flv/oplug_flv.h \ 
+../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.h \ 
+../avidemux/ADM_outputs/oplug_mpegFF/oplug_encodervcd.h \ 
+../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.h \ 
+../avidemux/ADM_outputs/oplug_ogm/op_ogpage.h \ 
+../avidemux/ADM_outputs/oplug_ogm/op_ogsave.h \ 
+../avidemux/ADM_requant/getvlc.h \ 
+../avidemux/ADM_requant/putvlc.h \ 
+../avidemux/ADM_requant/tcrequant.h \ 
+../avidemux/ADM_script/ADM_Avidemux.h \ 
+../avidemux/ADM_script/ADM_AvidemuxAudio.h \ 
+../avidemux/ADM_script/ADM_AvidemuxVideo.h \ 
+../avidemux/ADM_script/ADM_container.h \ 
+../avidemux/ADM_script/ADM_JSAvidemux.h \ 
+../avidemux/ADM_script/ADM_JSAvidemuxAudio.h \ 
+../avidemux/ADM_script/ADM_JSAvidemuxVideo.h \ 
+../avidemux/ADM_script/ADM_JSDirectorySearch.h \ 
+../avidemux/ADM_script/ADM_JSGlobal.h \ 
+../avidemux/ADM_script/adm_scanner.h \ 
+../avidemux/ADM_script/DirectorySearch.h \ 
+../avidemux/ADM_script/StdFile.h \ 
+../avidemux/ADM_toolkit/ADM_audioQueue.h \ 
+../avidemux/ADM_toolkit/ADM_intfloat.h \ 
+../avidemux/ADM_toolkit/ADM_packetQueue.h \ 
+../avidemux/ADM_toolkit/bitmap.h \ 
+../avidemux/ADM_toolkit/filesel.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/ADM_tray.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_busy.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_encoding.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_enter.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyAsharp.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyChromaShift.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyContrast.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyCrop.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyDialog.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyHue.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyPreview.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flySrtPos.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_idx_pg.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_working.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/GUI_accelRender.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.h \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/systray.h \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/ADM_flyTemplate.h \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_flyDialogQt4.h \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/ADM_qslider.h \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/translation_table.h \ 
+../avidemux/ADM_video/ADM_cache.h \ 
+../avidemux/ADM_video/ADM_confCouple.h \ 
+../avidemux/ADM_video/ADM_interlaced.h \ 
+../avidemux/ADM_video/ADM_vidCached.h \ 
+../avidemux/ADM_video/ADM_vidClean.h \ 
+../avidemux/ADM_video/ADM_vidCNR2_param.h \ 
+../avidemux/ADM_video/ADM_vidColorYuv.h \ 
+../avidemux/ADM_video/ADM_vidColorYuv_param.h \ 
+../avidemux/ADM_video/ADM_vidCommonFilter.h \ 
+../avidemux/ADM_video/ADM_videoInfoExtractor.h \ 
+../avidemux/ADM_video/ADM_videoNull.h \ 
+../avidemux/ADM_video/ADM_vidEqualizer.h \ 
+../avidemux/ADM_video/ADM_vidFieldUtil.h \ 
+../avidemux/ADM_video/ADM_vidFont.h \ 
+../avidemux/ADM_video/ADM_vidMPdelogo.h \ 
+../avidemux/ADM_video/ADM_vidPartial.h \ 
+../avidemux/ADM_video/ADM_vidPartial_param.h \ 
+../avidemux/ADM_video/mmx_macros.h \ 
+../avidemux/ADM_videoFilter/ADM_lavpp_deintparam.h \ 
+../avidemux/ADM_videoFilter/ADM_mpdetc.h \ 
+../avidemux/ADM_videoFilter/ADM_vidAddBorder.h \ 
+../avidemux/ADM_videoFilter/ADM_vidAnimated.h \ 
+../avidemux/ADM_videoFilter/ADM_vidAnimated_param.h \ 
+../avidemux/ADM_videoFilter/ADM_vidASharp_param.h \ 
+../avidemux/ADM_videoFilter/ADM_vidASS.h \ 
+../avidemux/ADM_videoFilter/ADM_vidAss_Params.h \ 
+../avidemux/ADM_videoFilter/ADM_vidBlendRemoval_param.h \ 
+../avidemux/ADM_videoFilter/ADM_vidChroma.h \ 
+../avidemux/ADM_videoFilter/ADM_vidChromaShift.h \ 
+../avidemux/ADM_videoFilter/ADM_vidChromaShift_param.h \ 
+../avidemux/ADM_videoFilter/ADM_vidComputeAverage.h \ 
+../avidemux/ADM_videoFilter/ADM_vidContrast.h \ 
+../avidemux/ADM_videoFilter/ADM_vidDecDec_param.h \ 
+../avidemux/ADM_videoFilter/ADM_vidDecTelecide.h \ 
+../avidemux/ADM_videoFilter/ADM_vidDecTel_param.h \ 
+../avidemux/ADM_videoFilter/ADM_vidDeinterlace.h \ 
+../avidemux/ADM_videoFilter/ADM_vidDenoise.h \ 
+../avidemux/ADM_videoFilter/ADM_vidDGbob_param.h \ 
+../avidemux/ADM_videoFilter/ADM_vidDropOut.h \ 
+../avidemux/ADM_videoFilter/ADM_vidDvbSub.h \ 
+../avidemux/ADM_videoFilter/ADM_vidEq2.h \ 
+../avidemux/ADM_videoFilter/ADM_vidFade_param.h \ 
+../avidemux/ADM_videoFilter/ADM_vidField.h \ 
+../avidemux/ADM_videoFilter/ADM_vidFlipV.h \ 
+../avidemux/ADM_videoFilter/ADM_vidFlux.h \ 
+../avidemux/ADM_videoFilter/ADM_vidForcedPP.h \ 
+../avidemux/ADM_videoFilter/ADM_vidHue.h \ 
+../avidemux/ADM_videoFilter/ADM_vidKernelDeint.h \ 
+../avidemux/ADM_videoFilter/ADM_vidLargeMedian.h \ 
+../avidemux/ADM_videoFilter/ADM_vidLuma.h \ 
+../avidemux/ADM_videoFilter/ADM_vidMcDeint_param.h \ 
+../avidemux/ADM_videoFilter/ADM_vidMosaic_param.h \ 
+../avidemux/ADM_videoFilter/ADM_vidMPLD3D.h \ 
+../avidemux/ADM_videoFilter/ADM_vidMPLD3Dlow.h \ 
+../avidemux/ADM_videoFilter/ADM_vidMSharpen_param.h \ 
+../avidemux/ADM_videoFilter/ADM_vidMSmooth_param.h \ 
+../avidemux/ADM_videoFilter/ADM_vidPalShift.h \ 
+../avidemux/ADM_videoFilter/ADM_vidPalSmart.h \ 
+../avidemux/ADM_videoFilter/ADM_vidParticle.h \ 
+../avidemux/ADM_videoFilter/ADM_vidPulldown.h \ 
+../avidemux/ADM_videoFilter/ADM_vidSeparateField.h \ 
+../avidemux/ADM_videoFilter/ADM_vidSoften.h \ 
+../avidemux/ADM_videoFilter/ADM_vidSRT.h \ 
+../avidemux/ADM_videoFilter/ADM_vidStabilize.h \ 
+../avidemux/ADM_videoFilter/ADM_vidSwapFields.h \ 
+../avidemux/ADM_videoFilter/ADM_vidSwapSmart.h \ 
+../avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.h \ 
+../avidemux/ADM_videoFilter/ADM_vidTDeint_param.h \ 
+../avidemux/ADM_videoFilter/ADM_vidThreshold.h \ 
+../avidemux/ADM_videoFilter/ADM_vidUnblend_param.h \ 
+../avidemux/ADM_videoFilter/ADM_vidUVSwap.h \ 
+../avidemux/ADM_videoFilter/ADM_vidVlad.h \ 
+../avidemux/ADM_videoFilter/ADM_vidVobSub.h \ 
+../avidemux/ADM_videoFilter/ADM_vidVobSubBitmap.h \ 
+../avidemux/ADM_videoFilter/ADM_vobsubinfo.h \ 
+../avidemux/avi_vars.h \ 
+../avidemux/gtkgui.h \ 
+../avidemux/prefs.h \ 
+../avidemux/prototype.h \ 
+
+SOURCES = \
+../avidemux/ADM_audio/ADM_a52info.cpp \ 
+../avidemux/ADM_audio/ADM_aacinfo.cpp \ 
+../avidemux/ADM_audio/ADM_dcainfo.cpp \ 
+../avidemux/ADM_audio/ADM_mp3info.cpp \ 
+../avidemux/ADM_audio/audioac3ex.cpp \ 
+../avidemux/ADM_audio/audiogen.cpp \ 
+../avidemux/ADM_audio/audiomp3ex.cpp \ 
+../avidemux/ADM_audio/audiosource_ext.cpp \ 
+../avidemux/ADM_audio/audiotimeline.cpp \ 
+../avidemux/ADM_audio/audiowavex.cpp \ 
+../avidemux/ADM_audio/audio_mpegidentify.cpp \ 
+../avidemux/ADM_audio/audio_packetizer.cpp \ 
+../avidemux/ADM_audiocodec/ADM_8bits.cpp \ 
+../avidemux/ADM_audiocodec/ADM_audiocodec.cpp \ 
+../avidemux/ADM_audiocodec/ADM_codecac3.cpp \ 
+../avidemux/ADM_audiocodec/ADM_codecfaad.cpp \ 
+../avidemux/ADM_audiocodec/ADM_codecimaadpcm.cpp \ 
+../avidemux/ADM_audiocodec/ADM_codecmp3.cpp \ 
+../avidemux/ADM_audiocodec/ADM_codecmsadpcm.cpp \ 
+../avidemux/ADM_audiocodec/ADM_codeculaw.cpp \ 
+../avidemux/ADM_audiocodec/ADM_codecwav.cpp \ 
+../avidemux/ADM_audiocodec/ADM_codecwma.cpp \ 
+../avidemux/ADM_audiocodec/ADM_dca.cpp \ 
+../avidemux/ADM_audiocodec/ADM_lpcm.cpp \ 
+../avidemux/ADM_audiocodec/audiocodec_ogg.cpp \ 
+../avidemux/ADM_audiodevice/ADM_audiodevice.cpp \ 
+../avidemux/ADM_audiodevice/ADM_deviceALSA.cpp \ 
+../avidemux/ADM_audiodevice/ADM_deviceArts.cpp \ 
+../avidemux/ADM_audiodevice/ADM_deviceAudioCore.cpp \ 
+../avidemux/ADM_audiodevice/ADM_deviceEsd.cpp \ 
+../avidemux/ADM_audiodevice/ADM_deviceJack.cpp \ 
+../avidemux/ADM_audiodevice/ADM_deviceoss.cpp \ 
+../avidemux/ADM_audiodevice/ADM_deviceSDL.cpp \ 
+../avidemux/ADM_audiodevice/ADM_deviceWin32.cpp \ 
+../avidemux/ADM_audiodevice/oss_out.cpp \ 
+../avidemux/ADM_audiofilter/audiodeng_buildfilters.cpp \ 
+../avidemux/ADM_audiofilter/audioencoder.cpp \ 
+../avidemux/ADM_audiofilter/audioencoder_aften.cpp \ 
+../avidemux/ADM_audiofilter/audioencoder_faac.cpp \ 
+../avidemux/ADM_audiofilter/audioencoder_lame.cpp \ 
+../avidemux/ADM_audiofilter/audioencoder_lavcodec.cpp \ 
+../avidemux/ADM_audiofilter/audioencoder_pcm.cpp \ 
+../avidemux/ADM_audiofilter/audioencoder_twolame.cpp \ 
+../avidemux/ADM_audiofilter/audioencoder_vorbis.cpp \ 
+../avidemux/ADM_audiofilter/audioeng_buff.cpp \ 
+../avidemux/ADM_audiofilter/audioeng_process.cpp \ 
+../avidemux/ADM_audiofilter/audiofilter_bridge.cpp \ 
+../avidemux/ADM_audiofilter/audiofilter_buildchain.cpp \ 
+../avidemux/ADM_audiofilter/audiofilter_channel_route.cpp \ 
+../avidemux/ADM_audiofilter/audiofilter_dolby.cpp \ 
+../avidemux/ADM_audiofilter/audiofilter_film2pal.cpp \ 
+../avidemux/ADM_audiofilter/audiofilter_limiter.cpp \ 
+../avidemux/ADM_audiofilter/audiofilter_mixer.cpp \ 
+../avidemux/ADM_audiofilter/audiofilter_normalize.cpp \ 
+../avidemux/ADM_audiofilter/audiofilter_sox.cpp \ 
+../avidemux/ADM_audiofilter/audiolib_sox.cpp \ 
+../avidemux/ADM_audiofilter/audio_raw.cpp \ 
+../avidemux/ADM_codecs/ADM_codecs.cpp \ 
+../avidemux/ADM_codecs/ADM_ffmp43.cpp \ 
+../avidemux/ADM_codecs/ADM_ffmpeg.cpp \ 
+../avidemux/ADM_codecs/ADM_mjpeg.cpp \ 
+../avidemux/ADM_codecs/ADM_mjpegEncode.cpp \ 
+../avidemux/ADM_codecs/ADM_mpeg.cpp \ 
+../avidemux/ADM_codecs/ADM_png.cpp \ 
+../avidemux/ADM_codecs/ADM_rgb16.cpp \ 
+../avidemux/ADM_codecs/ADM_theora_dec.cpp \ 
+../avidemux/ADM_codecs/ADM_uyvy.cpp \ 
+../avidemux/ADM_codecs/ADM_x264.cpp \ 
+../avidemux/ADM_codecs/ADM_xvid.cpp \ 
+../avidemux/ADM_codecs/ADM_xvid4.cpp \ 
+../avidemux/ADM_codecs/ADM_xvidcvs.cpp \ 
+../avidemux/ADM_codecs/ADM_xvideco.cpp \ 
+../avidemux/ADM_colorspace/ADM_rgb.cpp \ 
+../avidemux/ADM_colorspace/rgb2yuv.cpp \ 
+../avidemux/ADM_colorspace/yuv.cpp \ 
+../avidemux/ADM_editor/ADMedAVIAUD.cpp \ 
+../avidemux/ADM_editor/ADM_edAudio.cpp \ 
+../avidemux/ADM_editor/ADM_edCache.cpp \ 
+../avidemux/ADM_editor/ADM_edFrameType.cpp \ 
+../avidemux/ADM_editor/ADM_edIdentify.cpp \ 
+../avidemux/ADM_editor/ADM_edit.cpp \ 
+../avidemux/ADM_editor/ADM_edLoadSave.cpp \ 
+../avidemux/ADM_editor/ADM_edRender.cpp \ 
+../avidemux/ADM_editor/ADM_edSearch.cpp \ 
+../avidemux/ADM_editor/ADM_edStub.cpp \ 
+../avidemux/ADM_editor/ADM_Video.cpp \ 
+../avidemux/ADM_encoder/adm_encConfig.cpp \ 
+../avidemux/ADM_encoder/adm_encCopy.cpp \ 
+../avidemux/ADM_encoder/adm_encdivx.cpp \ 
+../avidemux/ADM_encoder/adm_encdivx2p.cpp \ 
+../avidemux/ADM_encoder/adm_encffmpeg.cpp \ 
+../avidemux/ADM_encoder/adm_encffmpeg1.cpp \ 
+../avidemux/ADM_encoder/adm_encmjpeg.cpp \ 
+../avidemux/ADM_encoder/adm_encmpeg2enc.cpp \ 
+../avidemux/ADM_encoder/adm_encoder.cpp \ 
+../avidemux/ADM_encoder/adm_encRequant.cpp \ 
+../avidemux/ADM_encoder/adm_encx264.cpp \ 
+../avidemux/ADM_encoder/adm_encxvid.cpp \ 
+../avidemux/ADM_encoder/adm_encXvid4.cpp \ 
+../avidemux/ADM_encoder/adm_encyv12.cpp \ 
+../avidemux/ADM_filter/ADM_vidDummyFilter.cpp \ 
+../avidemux/ADM_filter/filter.cpp \ 
+../avidemux/ADM_filter/filter_declaration.cpp \ 
+../avidemux/ADM_filter/filter_dylib.cpp \ 
+../avidemux/ADM_filter/filter_saveload.cpp \ 
+../avidemux/ADM_filter/vidVCD.cpp \ 
+../avidemux/ADM_infoExtractor/ADM_infoextractor.cpp \ 
+../avidemux/ADM_inputs/ADM_amv/ADM_amv.cpp \ 
+../avidemux/ADM_inputs/ADM_amv/ADM_amvAudio.cpp \ 
+../avidemux/ADM_inputs/ADM_asf/ADM_asf.cpp \ 
+../avidemux/ADM_inputs/ADM_asf/ADM_asfChunk.cpp \ 
+../avidemux/ADM_inputs/ADM_asf/ADM_asfPacket.cpp \ 
+../avidemux/ADM_inputs/ADM_asf/ADM_asf_audio.cpp \ 
+../avidemux/ADM_inputs/ADM_avsproxy/ADM_avsproxy.cpp \ 
+../avidemux/ADM_inputs/ADM_avsproxy/ADM_avsproxy_net.cpp \ 
+../avidemux/ADM_inputs/ADM_flv/ADM_flv.cpp \ 
+../avidemux/ADM_inputs/ADM_flv/ADM_flvAudio.cpp \ 
+../avidemux/ADM_inputs/ADM_flv/ADM_flvIndex.cpp \ 
+../avidemux/ADM_inputs/ADM_h263/ADM_h263.cpp \ 
+../avidemux/ADM_inputs/ADM_h263/ADM_mp4.cpp \ 
+../avidemux/ADM_inputs/ADM_h263/bitsRead.cpp \ 
+../avidemux/ADM_inputs/ADM_inpics/ADM_pics.cpp \ 
+../avidemux/ADM_inputs/ADM_matroska/ADM_mkv.cpp \ 
+../avidemux/ADM_inputs/ADM_matroska/ADM_mkvEntries.cpp \ 
+../avidemux/ADM_inputs/ADM_matroska/ADM_mkvIndexer.cpp \ 
+../avidemux/ADM_inputs/ADM_matroska/ADM_mkvTrackType.cpp \ 
+../avidemux/ADM_inputs/ADM_matroska/ADM_mkv_audio.cpp \ 
+../avidemux/ADM_inputs/ADM_matroska/ebml.cpp \ 
+../avidemux/ADM_inputs/ADM_matroska/mkv_tags.cpp \ 
+../avidemux/ADM_inputs/ADM_mp4/ADM_atom.cpp \ 
+../avidemux/ADM_inputs/ADM_mp4/ADM_mp4.cpp \ 
+../avidemux/ADM_inputs/ADM_mp4/ADM_mp4Analyzer.cpp \ 
+../avidemux/ADM_inputs/ADM_mp4/ADM_mp4audio.cpp \ 
+../avidemux/ADM_inputs/ADM_mp4/ADM_mp4Indexer.cpp \ 
+../avidemux/ADM_inputs/ADM_mp4/ADM_mp4Leaf.cpp \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_audio.cpp \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxer.cpp \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxerES.cpp \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxerMSDVR.cpp \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxerPS.cpp \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_demuxerTS.cpp \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_identify.cpp \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer.cpp \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer_h264.cpp \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_indexer_mpeg2.cpp \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_io.cpp \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probe.cpp \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_probeTS.cpp \ 
+../avidemux/ADM_inputs/ADM_mpegdemuxer/dmx_video.cpp \ 
+../avidemux/ADM_inputs/ADM_nuv/ADM_nuv.cpp \ 
+../avidemux/ADM_inputs/ADM_nuv/ADM_nuvAudio.cpp \ 
+../avidemux/ADM_inputs/ADM_nuv/RTjpegN.cpp \ 
+../avidemux/ADM_inputs/ADM_nuv/RToldformat.cpp \ 
+../avidemux/ADM_inputs/ADM_ogm/ADM_ogm.cpp \ 
+../avidemux/ADM_inputs/ADM_ogm/ADM_ogmAudio.cpp \ 
+../avidemux/ADM_inputs/ADM_ogm/ADM_ogmpages.cpp \ 
+../avidemux/ADM_inputs/ADM_ogm/ADM_ogmreorder.cpp \ 
+../avidemux/ADM_inputs/ADM_openDML/ADM_odml_audio.cpp \ 
+../avidemux/ADM_inputs/ADM_openDML/ADM_odml_odml.cpp \ 
+../avidemux/ADM_inputs/ADM_openDML/ADM_odml_regular.cpp \ 
+../avidemux/ADM_inputs/ADM_openDML/ADM_openDML.cpp \ 
+../avidemux/ADM_inputs/ADM_openDML/ADM_openDMLDepack.cpp \ 
+../avidemux/ADM_inputs/ADM_openDML/ADM_opendml_reindex.cpp \ 
+../avidemux/ADM_inputs/ADM_openDML/ADM_opendml_reorder.cpp \ 
+../avidemux/ADM_inputs/ADM_openDML/ADM_riff.cpp \ 
+../avidemux/ADM_libraries/ADM_lavformat/ADM_lavformat.cpp \ 
+../avidemux/ADM_libraries/ADM_lavformat/ADM_muxts.cpp \ 
+../avidemux/ADM_libraries/ADM_libmpeg2enc/ADM_mpe2enc.cpp \ 
+../avidemux/ADM_libraries/ADM_libswscale/ADM_mp.cpp \ 
+../avidemux/ADM_libraries/ADM_libwrapper/libwrapper.cpp \ 
+../avidemux/ADM_libraries/ADM_libwrapper/libwrapper_amrnb.cpp \ 
+../avidemux/ADM_libraries/ADM_libwrapper/libwrapper_dca.cpp \ 
+../avidemux/ADM_libraries/ADM_libwrapper/libwrapper_global.cpp \ 
+../avidemux/ADM_libraries/ADM_lvemux/ADM_muxer.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/ac3strm_in.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/ADM_mplexin.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/ADM_mplexmuxer.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/ADM_mplexout.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/ADM_mthread.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/ADM_transfert.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/audiostrm_out.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/bits.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/decodebufmodel.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/dtsstrm_in.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/inputstrm.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/interact.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/lpcmstrm_in.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/mpastrm_in.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/multiplexor.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/padstrm.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/stillsstream.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/stream_params.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/systems.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/videostrm_in.cpp \ 
+../avidemux/ADM_libraries/ADM_mplex/videostrm_out.cpp \ 
+../avidemux/ADM_libraries/ADM_nvwa/debug_new.cpp \ 
+../avidemux/ADM_libraries/ADM_utilities/ADM_bitstream.cpp \ 
+../avidemux/ADM_libraries/ADM_utilities/ADM_fileio.cpp \ 
+../avidemux/ADM_libraries/ADM_utilities/ADM_gettext.cpp \ 
+../avidemux/ADM_libraries/ADM_utilities/ADM_image.cpp \ 
+../avidemux/ADM_libraries/ADM_utilities/ADM_imageLoader.cpp \ 
+../avidemux/ADM_libraries/ADM_utilities/ADM_imageResizer.cpp \ 
+../avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp \ 
+../avidemux/ADM_libraries/ADM_utilities/ADM_pp.cpp \ 
+../avidemux/ADM_libraries/ADM_utilities/ADM_print.cpp \ 
+../avidemux/ADM_libraries/ADM_utilities/avidemutils.cpp \ 
+../avidemux/ADM_libraries/ADM_utilities/aviframe.cpp \ 
+../avidemux/ADM_libraries/ADM_utilities/aviindexer.cpp \ 
+../avidemux/ADM_libraries/ADM_utilities/aviio.cpp \ 
+../avidemux/ADM_libraries/ADM_utilities/broken.cpp \ 
+../avidemux/ADM_libraries/ADM_utilities/fourcc.cpp \ 
+../avidemux/ADM_libraries/ADM_utilities/prefs.cpp \ 
+../avidemux/ADM_libraries/ADM_utilities/subchunk.cpp \ 
+../avidemux/ADM_libraries/ADM_xvidratectl/ADM_oldxvid.cpp \ 
+../avidemux/ADM_libraries/ADM_xvidratectl/ADM_xvidratectl.cpp \ 
+../avidemux/ADM_libraries/ADM_xvidratectl/ADM_xvidratectlVBV.cpp \ 
+../avidemux/ADM_ocr/ADM_bitmapSource.cpp \ 
+../avidemux/ADM_ocr/adm_glyph.cpp \ 
+../avidemux/ADM_ocr/adm_leftturn.cpp \ 
+../avidemux/ADM_ocr/ADM_ocr.cpp \ 
+../avidemux/ADM_ocr/ADM_ocrEngine.cpp \ 
+../avidemux/ADM_ocr/ADM_vob2vobsub.cpp \ 
+../avidemux/ADM_osSupport/ADM_cpuCap.cpp \ 
+../avidemux/ADM_osSupport/ADM_crashdump.cpp \ 
+../avidemux/ADM_osSupport/ADM_debug.cpp \ 
+../avidemux/ADM_osSupport/ADM_fileio.cpp \ 
+../avidemux/ADM_osSupport/ADM_memcpy.cpp \ 
+../avidemux/ADM_osSupport/ADM_memory.cpp \ 
+../avidemux/ADM_osSupport/ADM_memsupport.cpp \ 
+../avidemux/ADM_osSupport/ADM_misc.cpp \ 
+../avidemux/ADM_osSupport/ADM_queue.cpp \ 
+../avidemux/ADM_osSupport/ADM_quota.cpp \ 
+../avidemux/ADM_osSupport/ADM_threads.cpp \ 
+../avidemux/ADM_osSupport/TLK_clock.cpp \ 
+../avidemux/ADM_osSupport/win32.cpp \ 
+../avidemux/ADM_outputs/oplug_avi/avilist.cpp \ 
+../avidemux/ADM_outputs/oplug_avi/op_avisave.cpp \ 
+../avidemux/ADM_outputs/oplug_avi/op_avisavecopy.cpp \ 
+../avidemux/ADM_outputs/oplug_avi/op_avisavecopy_pack.cpp \ 
+../avidemux/ADM_outputs/oplug_avi/op_avisavecopy_unpack.cpp \ 
+../avidemux/ADM_outputs/oplug_avi/op_avisavedual.cpp \ 
+../avidemux/ADM_outputs/oplug_avi/op_aviwrite.cpp \ 
+../avidemux/ADM_outputs/oplug_avi/op_saveprocess.cpp \ 
+../avidemux/ADM_outputs/oplug_avi/op_savesmart.cpp \ 
+../avidemux/ADM_outputs/oplug_dummy/oplug_dummy.cpp \ 
+../avidemux/ADM_outputs/oplug_flv/oplug_flv.cpp \ 
+../avidemux/ADM_outputs/oplug_mp4/oplug_mp4.cpp \ 
+../avidemux/ADM_outputs/oplug_mpeg/op_mpegpass.cpp \ 
+../avidemux/ADM_outputs/oplug_mpegFF/oplug_vcdff.cpp \ 
+../avidemux/ADM_outputs/oplug_ogm/op_ogaudio.cpp \ 
+../avidemux/ADM_outputs/oplug_ogm/op_ogpage.cpp \ 
+../avidemux/ADM_outputs/oplug_ogm/op_ogsave.cpp \ 
+../avidemux/ADM_outputs/oplug_ogm/op_ogsavecopy.cpp \ 
+../avidemux/ADM_outputs/oplug_ogm/op_ogsaveprocess.cpp \ 
+../avidemux/ADM_preview.cpp \ 
+../avidemux/ADM_script/ADM_Avidemux.cpp \ 
+../avidemux/ADM_script/ADM_AvidemuxAudio.cpp \ 
+../avidemux/ADM_script/ADM_AvidemuxVideo.cpp \ 
+../avidemux/ADM_script/ADM_JSAvidemux.cpp \ 
+../avidemux/ADM_script/ADM_JSAvidemuxAudio.cpp \ 
+../avidemux/ADM_script/ADM_JSAvidemuxVideo.cpp \ 
+../avidemux/ADM_script/ADM_JSDirectorySearch.cpp \ 
+../avidemux/ADM_script/ADM_JSFunctions.cpp \ 
+../avidemux/ADM_script/ADM_JSGlobal.cpp \ 
+../avidemux/ADM_script/DirectorySearch.cpp \ 
+../avidemux/ADM_toolkit/ADM_audioQueue.cpp \ 
+../avidemux/ADM_toolkit/ADM_intfloat.cpp \ 
+../avidemux/ADM_toolkit/ADM_packetQueue.cpp \ 
+../avidemux/ADM_toolkit/automation.cpp \ 
+../avidemux/ADM_toolkit/filesel.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_animated.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioconfig.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioFilter.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_bitrateHisto.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_builtin.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_enter.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flv1.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyAsharp.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyChromaShift.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyContrast.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyCrop.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyDialog.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyHue.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flySrtPos.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_gototime.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavcodec.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavDecoder.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_mjpeg.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_ocr.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_postproc.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_requant.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_srt.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_SVCD.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tdeint.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_tsSub.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_commonUI/GUI_xvRender.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/alert_qt4.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_busy.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_srt.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_x264.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_xvid4.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/OCR_none.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_asharp.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_chromashift.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_contrast.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_crop.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_encoding.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_eq2.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_hue.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_jobs.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_props.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_resizing.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_srt.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_vobsub.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_working.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_flyDialog.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_index_pg.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/T_QCanvas.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_bar.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_float.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_frame.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_hex.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_integer.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_matrix.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_notch.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_readOnlyText.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_bitrate.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_button.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_dialogFactory.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_menu.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_slider.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_threadCount.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_toggle.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/filter_none.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/ADM_qslider.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/file_qt4.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui_none.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/T_preview.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/Q_ocr.cpp \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp \ 
+../avidemux/ADM_video/ADM_cache.cpp \ 
+../avidemux/ADM_video/ADM_confCouples.cpp \ 
+../avidemux/ADM_video/ADM_genvideo.cpp \ 
+../avidemux/ADM_video/ADM_interlaced.cpp \ 
+../avidemux/ADM_video/ADM_reorderTemplate.cpp \ 
+../avidemux/ADM_video/ADM_vidCached.cpp \ 
+../avidemux/ADM_video/ADM_vidClean.cpp \ 
+../avidemux/ADM_video/ADM_vidCNR2.cpp \ 
+../avidemux/ADM_video/ADM_vidColorYuv.cpp \ 
+../avidemux/ADM_video/ADM_vidEqualizer.cpp \ 
+../avidemux/ADM_video/ADM_vidFieldUnblend.cpp \ 
+../avidemux/ADM_video/ADM_vidFieldUtil.cpp \ 
+../avidemux/ADM_video/ADM_vidFont.cpp \ 
+../avidemux/ADM_video/ADM_vidMPdelogo.cpp \ 
+../avidemux/ADM_video/ADM_vidNull.cpp \ 
+../avidemux/ADM_video/ADM_vidPartial.cpp \ 
+../avidemux/ADM_video/ADM_vidRaw.cpp \ 
+../avidemux/ADM_videoFilter/ADMmpdetc.cpp \ 
+../avidemux/ADM_videoFilter/ADM_guiResize.cpp \ 
+../avidemux/ADM_videoFilter/ADM_lavpp_deint.cpp \ 
+../avidemux/ADM_videoFilter/ADM_resizebis.cpp \ 
+../avidemux/ADM_videoFilter/ADM_resizeter.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidAddBorder.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidAnimated.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidAsharp.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidASS.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidBlend.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidBlendRemoval.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidBSmear.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidChroma.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidChromaShift.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidContrast.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidCrop.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidDecDec.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidDecTelecide.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidDeintASM.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidDeinterlace.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidDelta.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidDenoise.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidDGbob.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidDropOut.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidDvbSub.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidEq2.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidFade.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidFastConvolution.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidFields.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidFlipV.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidFlux.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidForcedPP.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidHardIvtcRemoval.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidHue.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidKernelDeint.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidLargeMedian.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidLogo.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidLuma.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidMcDeint.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidMosaic.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidMPLD3D.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidMPLD3Dlow.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidMPLResize.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidMSharpen.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidMsmooth.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidPalShift.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidPalSmart.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidParticle.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidPulldown.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidResampleFPS.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidResize.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidResize25.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidReverse.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidRotate.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidSeparateField.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidSoften.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidSRT.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidSRTload.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidSRTRender.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidStabilize.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidSwapFields.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidSwapSmart.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidTdeint.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidThreshold.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidUnblend.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidUVSwap.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidVlad.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidVobsub.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidVobSubRender.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidWhirl.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vidYadif.cpp \ 
+../avidemux/ADM_videoFilter/ADM_vobsubinfo.cpp \ 
+../avidemux/gtk_gui.cpp \ 
+../avidemux/guiplay.cpp \ 
+../avidemux/gui_autodrive.cpp \ 
+../avidemux/GUI_jobs.cpp \ 
+../avidemux/gui_navigate.cpp \ 
+../avidemux/gui_savenew.cpp \ 
+../avidemux/main.cpp \ 
+
+FORMS = \
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/asharp.ui \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/chromashift.ui \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/contrast.ui \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/crop.ui \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/encoding.ui \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/eq2.ui \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/hue.ui \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/jobs.ui \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/props.ui \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/resizing.ui \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/srt.ui \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/vobsub.ui \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/working.ui \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/mainfilter.ui \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/gui2.ui \ 
+../avidemux/ADM_userInterfaces/ADM_QT4/ADM_ocr/ocr.ui \ 
+
+TRANSLATIONS = \
+

Added: branches/avidemux_2.4_branch/po/qt_update_pro.sh
===================================================================
--- branches/avidemux_2.4_branch/po/qt_update_pro.sh	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/po/qt_update_pro.sh	2007-09-25 18:08:12 UTC (rev 3597)
@@ -0,0 +1,26 @@
+#!/bin/bash
+
+# Manually generate project file so GTK sources can be excluded.
+# Otherwise use: qmake -project -o avidemux.pro ..
+
+echo "Finding HEADERS..."
+echo "HEADERS = \\" > avidemux.pro
+find ../avidemux -iname '*.h' -not -iwholename '*ADM_GTK*' -not -iwholename '*ADM_NONE*' -printf "%p \\\ \n" >> avidemux.pro
+echo "" >> avidemux.pro
+
+echo "Finding SOURCES..."
+echo "SOURCES = \\" >> avidemux.pro
+find ../avidemux -iname '*.cpp' -not -iwholename '*ADM_GTK*' -not -iwholename '*ADM_NONE*' -printf "%p \\\ \n" >> avidemux.pro
+echo "" >> avidemux.pro
+
+echo "Finding FORMS..."
+echo "FORMS = \\" >> avidemux.pro
+find ../avidemux -iname '*.ui' -not -iwholename '*ADM_GTK*' -not -iwholename '*ADM_NONE*' -printf "%p \\\ \n" >> avidemux.pro
+echo "" >> avidemux.pro
+
+echo "Finding TRANSLATIONS..."
+echo "TRANSLATIONS = \\" >> avidemux.pro
+find . -iname '*.ts' -printf "%p \\\ \n" >> avidemux.pro
+echo "" >> avidemux.pro
+
+echo "DONE."

Modified: branches/avidemux_2.4_branch/po/update_pot.bash
===================================================================
--- branches/avidemux_2.4_branch/po/update_pot.bash	2007-09-25 12:01:43 UTC (rev 3596)
+++ branches/avidemux_2.4_branch/po/update_pot.bash	2007-09-25 18:08:12 UTC (rev 3597)
@@ -1,6 +1,12 @@
 #!/bin/bash
 cd .. 
-find ./avidemux -iname '*.cpp' -o -iname '*.h' > po/POTFILES.in
+echo "Finding HEADERS..."
+find ./avidemux -iname '*.h' -not -iwholename '*ADM_QT4*' > po/POTFILES.in
+
+echo "Finding SOURCES..."
+find ./avidemux -iname '*.cpp' -not -iwholename '*ADM_QT4*' >> po/POTFILES.in
+
 cd po
-xgettext --keyword=_ --debug --from-code=utf-8 -C -D .. -p . -f POTFILES.in -o avidemux.pot
+echo "Generating pot file..."
+xgettext --keyword=QT_TR_NOOP --debug --from-code=utf-8 -C -D .. -p . -f POTFILES.in -o avidemux.pot
 echo "DONE."



From gruntster at mail.berlios.de  Wed Sep 26 00:05:02 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 26 Sep 2007 00:05:02 +0200
Subject: [Avidemux-svn-commit] r3599 - in
	branches/avidemux_2.4_branch/avidemux: .
	ADM_userInterfaces/ADM_GTK ADM_userInterfaces/ADM_NONE
	ADM_userInterfaces/ADM_QT4
Message-ID: <200709252205.l8PM52qx000824@sheep.berlios.de>

Author: gruntster
Date: 2007-09-26 00:04:53 +0200 (Wed, 26 Sep 2007)
New Revision: 3599

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ui_support.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ui_support.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp
   branches/avidemux_2.4_branch/avidemux/main.cpp
Log:
[Debug] print UI info to stdout

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/CMakeLists.txt	2007-09-25 19:01:54 UTC (rev 3598)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/CMakeLists.txt	2007-09-25 22:04:53 UTC (rev 3599)
@@ -1,6 +1,7 @@
 SET(ADM_LIB ADM_UI_GTK)
 SET(${ADM_LIB}_SRCS ui_support.cpp)
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
+ADD_definitions(${GTK_CFLAGS})
 
 add_subdirectory(ADM_dialog)
 add_subdirectory(ADM_dialogFactory)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/Makefile.am	2007-09-25 19:01:54 UTC (rev 3598)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/Makefile.am	2007-09-25 22:04:53 UTC (rev 3599)
@@ -2,4 +2,6 @@
 
 noinst_LIBRARIES = libADM_UI_GTK.a 
 libADM_UI_GTK_a_METASOURCES = AUTO
-libADM_UI_GTK_a_SOURCES = ui_support.cpp
\ No newline at end of file
+libADM_UI_GTK_a_SOURCES = ui_support.cpp
+
+INCLUDES = $(all_includes) $(GTK_CFLAGS)
\ No newline at end of file

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ui_support.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ui_support.cpp	2007-09-25 19:01:54 UTC (rev 3598)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ui_support.cpp	2007-09-25 22:04:53 UTC (rev 3599)
@@ -1,3 +1,6 @@
+#include <stdio.h>
+#include <gtk/gtk.h>
+
 #include "config.h"
 
 #ifdef HAVE_GETTEXT
@@ -22,3 +25,8 @@
 	return __msgid;
 }
 #endif
+
+void getUIDescription(char* desc)
+{
+	sprintf(desc, "GTK+ (%i.%i.%i)", gtk_major_version, gtk_minor_version, gtk_micro_version);
+}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ui_support.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ui_support.cpp	2007-09-25 19:01:54 UTC (rev 3598)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ui_support.cpp	2007-09-25 22:04:53 UTC (rev 3599)
@@ -1,3 +1,4 @@
+#include <stdio.h>
 #include "config.h"
 
 #ifdef HAVE_GETTEXT
@@ -22,3 +23,8 @@
 	return __msgid;
 }
 #endif
+
+void getUIDescription(char* desc)
+{
+	sprintf(desc, "CLI");
+}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp	2007-09-25 19:01:54 UTC (rev 3598)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ui_support.cpp	2007-09-25 22:04:53 UTC (rev 3599)
@@ -1,3 +1,4 @@
+#include <stdio.h>
 #include <string.h>
 
 #include <QApplication>
@@ -66,3 +67,8 @@
 
 	memset(translatedMessage, 0, MAX_MESSAGE_COUNT * sizeof(char*));
 }
+
+void getUIDescription(char* desc)
+{
+	sprintf(desc, "Qt4 (%s)", qVersion());
+}

Modified: branches/avidemux_2.4_branch/avidemux/main.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/main.cpp	2007-09-25 19:01:54 UTC (rev 3598)
+++ branches/avidemux_2.4_branch/avidemux/main.cpp	2007-09-25 22:04:53 UTC (rev 3599)
@@ -80,6 +80,7 @@
 extern void ADM_memStat( void );
 extern void ADM_memStatInit( void );
 extern void ADM_memStatEnd( void );
+extern void getUIDescription(char*);
 
 #ifdef ADM_WIN32
 extern EXCEPTION_DISPOSITION exceptionHandler(struct _EXCEPTION_RECORD* pExceptionRec, void* pEstablisherFrame, struct _CONTEXT* pContextRecord, void* pDispatcherContext);
@@ -159,15 +160,17 @@
 	printf(" (PowerPC)");
 #endif
 
-printf("\n");
+	printf("\n");
 
+	char uiDesc[15];
+	getUIDescription(uiDesc);
+	printf("User Interface: %s\n", uiDesc);
+
 #ifdef ADM_WIN32
 	char version[250];
 
 	if (getWindowsVersion(version))
-	{
 		printf("Operating System: %s\n", version);
-	}
 #endif
 
 #if defined(__USE_LARGEFILE) && defined(__USE_LARGEFILE64)
@@ -178,7 +181,7 @@
 	ADM_memStatInit();
 	ADM_intFloatInit();
 
-	printf("Initialising prefs\n");
+	printf("\nInitialising prefs\n");
 	initPrefs();
 	prefs->load();
     CpuCaps::init();



From gruntster at mail.berlios.de  Wed Sep 26 01:25:59 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 26 Sep 2007 01:25:59 +0200
Subject: [Avidemux-svn-commit] r3600 - branches/avidemux_2.4_branch
Message-ID: <200709252325.l8PNPxTQ021237@sheep.berlios.de>

Author: gruntster
Date: 2007-09-26 01:25:53 +0200 (Wed, 26 Sep 2007)
New Revision: 3600

Modified:
   branches/avidemux_2.4_branch/ConfigureChecks.cmake
Log:
[Aften] fix CMake detection on Linux

Modified: branches/avidemux_2.4_branch/ConfigureChecks.cmake
===================================================================
--- branches/avidemux_2.4_branch/ConfigureChecks.cmake	2007-09-25 22:04:53 UTC (rev 3599)
+++ branches/avidemux_2.4_branch/ConfigureChecks.cmake	2007-09-25 23:25:53 UTC (rev 3600)
@@ -224,22 +224,24 @@
 
 ADM_CHECK_HL(Aften aften/aften.h  aften aften_encode_init USE_AFTEN)
 
-if(USE_AFTEN)
-	TRY_RUN(AFTEN_TEST_RUN_RESULT
-		AFTEN_TEST_COMPILE_RESULT
-		${CMAKE_BINARY_DIR}
-		"${CMAKE_SOURCE_DIR}/cmake_compile_check/aften_check.cpp"
-		CMAKE_FLAGS
-		-DLINK_LIBRARIES:STRING=-laften
-		OUTPUT_VARIABLE AFTEN_OUTPUT)
-
-	if(AFTEN_TEST_RUN_RESULT EQUAL 8)
-		MESSAGE(STATUS "Aften Version: 0.0.8")
-		SET(USE_AFTEN_08 1)
-	elseif(AFTEN_TEST_RUN_RESULT EQUAL 7)
-		MESSAGE(STATUS "Aften Version: 0.07")
-		SET(USE_AFTEN_07 1)
-	endif(AFTEN_TEST_RUN_RESULT EQUAL 8)
+if(USE_AFTEN)
+	FIND_LIBRARY(AFTEN_LIB_PATH NAMES aften)
+
+	TRY_RUN(AFTEN_TEST_RUN_RESULT
+		AFTEN_TEST_COMPILE_RESULT
+		${CMAKE_BINARY_DIR}
+		"${CMAKE_SOURCE_DIR}/cmake_compile_check/aften_check.cpp"
+		CMAKE_FLAGS -DLINK_LIBRARIES=${AFTEN_LIB_PATH})
+
+	if(AFTEN_TEST_RUN_RESULT EQUAL 8)
+		MESSAGE(STATUS "Aften Version: 0.0.8")
+		SET(USE_AFTEN_08 1)
+	elseif(AFTEN_TEST_RUN_RESULT EQUAL 7)
+		MESSAGE(STATUS "Aften Version: 0.07")
+		SET(USE_AFTEN_07 1)
+	else(AFTEN_TEST_RUN_RESULT EQUAL 8)
+		SET(USE_AFTEN 0)
+	endif(AFTEN_TEST_RUN_RESULT EQUAL 8)
 endif(USE_AFTEN)
 
 SET(CMAKE_REQUIRED_FLAGS "")



From gruntster at mail.berlios.de  Wed Sep 26 15:50:22 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 26 Sep 2007 15:50:22 +0200
Subject: [Avidemux-svn-commit] r3601 - in
	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces:
	ADM_GTK/ADM_dialogFactory ADM_commonUI
Message-ID: <200709261350.l8QDoMde004887@sheep.berlios.de>

Author: gruntster
Date: 2007-09-26 15:50:09 +0200 (Wed, 26 Sep 2007)
New Revision: 3601

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
Log:
[I18N] make strings translatable

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp	2007-09-25 23:25:53 UTC (rev 3600)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp	2007-09-26 13:50:09 UTC (rev 3601)
@@ -90,7 +90,7 @@
   
   /*  add button */
   
-  button = gtk_button_new_with_mnemonic ("_Browse...");
+  button = gtk_button_new_with_mnemonic (QT_TR_NOOP("_Browse..."));
   gtk_widget_show (button);
   gtk_box_pack_start (GTK_BOX (hbox1), button, FALSE, FALSE, 0);
 
@@ -242,7 +242,7 @@
   
   /*  add button */
   
-  button = gtk_button_new_with_mnemonic ("_Browse...");
+  button = gtk_button_new_with_mnemonic (QT_TR_NOOP("_Browse..."));
   gtk_widget_show (button);
   gtk_box_pack_start (GTK_BOX (hbox1), button, FALSE, FALSE, 0);
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-09-25 23:25:53 UTC (rev 3600)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-09-26 13:50:09 UTC (rev 3601)
@@ -197,25 +197,37 @@
         diaElemToggle togAutoIndex(&autoindex,QT_TR_NOOP("Automatically _rebuild index"));
         diaElemToggle togAutoUnpack(&autounpack,QT_TR_NOOP("Automatically remove _packed bitstream"));
 
+        diaElemFrame frameSimd(QT_TR_NOOP("SIMD"));
 
-        
-        diaElemToggle capsToggleAll(&capsAll,QT_TR_NOOP("Enable all SIMD"));
-        diaElemFrame      frameSimd(QT_TR_NOOP("SIMD"));
-        frameSimd.swallow(&capsToggleAll);
-        
-#define CAPS_TOGGLE(x) diaElemToggle       capsToggle##x(&(caps##x),QT_TR_NOOP("Enable "#x));\
-						capsToggleAll.link(0,&(capsToggle##x));  frameSimd.swallow(   &(capsToggle##x));      
-						  
+		diaElemToggle capsToggleAll(&capsAll,QT_TR_NOOP("Enable all SIMD"));
+        diaElemToggle capsToggleMMX(&capsMMX, QT_TR_NOOP("Enable MMX"));
+		diaElemToggle capsToggleMMXEXT(&capsMMXEXT, QT_TR_NOOP("Enable MMXEXT"));
+		diaElemToggle capsToggle3DNOW(&caps3DNOW, QT_TR_NOOP("Enable 3DNOW"));
+		diaElemToggle capsToggle3DNOWEXT(&caps3DNOWEXT, QT_TR_NOOP("Enable 3DNOWEXT"));
+		diaElemToggle capsToggleSSE(&capsSSE, QT_TR_NOOP("Enable SSE"));
+		diaElemToggle capsToggleSSE2(&capsSSE2, QT_TR_NOOP("Enable SSE2"));
+		diaElemToggle capsToggleSSE3(&capsSSE3, QT_TR_NOOP("Enable SSE3"));
+		diaElemToggle capsToggleSSSE3(&capsSSSE3, QT_TR_NOOP("Enable SSSE3"));
 
-        CAPS_TOGGLE(MMX);
-        CAPS_TOGGLE(MMXEXT);
-        CAPS_TOGGLE(3DNOW);
-        CAPS_TOGGLE(3DNOWEXT);
-        CAPS_TOGGLE(SSE);
-        CAPS_TOGGLE(SSE2);
-        CAPS_TOGGLE(SSE3);
-        CAPS_TOGGLE(SSSE3);        
-      
+		capsToggleAll.link(0, &capsToggleMMX);
+		capsToggleAll.link(0, &capsToggleMMXEXT);
+		capsToggleAll.link(0, &capsToggle3DNOW);
+		capsToggleAll.link(0, &capsToggle3DNOWEXT);
+		capsToggleAll.link(0, &capsToggleSSE);
+		capsToggleAll.link(0, &capsToggleSSE2);
+		capsToggleAll.link(0, &capsToggleSSE3);
+		capsToggleAll.link(0, &capsToggleSSSE3);
+
+		frameSimd.swallow(&capsToggleAll);
+		frameSimd.swallow(&capsToggleMMX);
+		frameSimd.swallow(&capsToggleMMXEXT);
+		frameSimd.swallow(&capsToggle3DNOW);
+		frameSimd.swallow(&capsToggle3DNOWEXT);
+		frameSimd.swallow(&capsToggleSSE);
+		frameSimd.swallow(&capsToggleSSE2);
+		frameSimd.swallow(&capsToggleSSE3);
+		frameSimd.swallow(&capsToggleSSSE3);
+
 		diaElemThreadCount lavcThreadCount(&lavcThreads, QT_TR_NOOP("_lavc threads:"));
 		diaElemThreadCount x264ThreadCount(&x264Threads, QT_TR_NOOP("_x264 threads:"));
 		diaElemThreadCount xvidThreadCount(&xvidThreads, QT_TR_NOOP("X_vid threads:"));



From gruntster at mail.berlios.de  Wed Sep 26 17:44:00 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 26 Sep 2007 17:44:00 +0200
Subject: [Avidemux-svn-commit] r3603 - in
	branches/avidemux_2.4_branch/avidemux: . ADM_libraries/ADM_utilities
Message-ID: <200709261544.l8QFi07g014660@sheep.berlios.de>

Author: gruntster
Date: 2007-09-26 17:43:52 +0200 (Wed, 26 Sep 2007)
New Revision: 3603

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/Makefile.am
   branches/avidemux_2.4_branch/avidemux/Makefile.am
Log:
[I18N] fix automake for Linux

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/Makefile.am	2007-09-26 13:58:18 UTC (rev 3602)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/Makefile.am	2007-09-26 15:43:52 UTC (rev 3603)
@@ -1,7 +1,7 @@
 ####### kdevelop will overwrite this part!!! (begin)##########
 noinst_LIBRARIES = libADM_library.a
 
-INCLUDES = $(all_includes)
+INCLUDES = $(all_includes) -DADMLOCALE='"'$(ADM_LOCALEDIR)'"'
 
 libADM_library_a_METASOURCES = AUTO
 

Modified: branches/avidemux_2.4_branch/avidemux/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/Makefile.am	2007-09-26 13:58:18 UTC (rev 3602)
+++ branches/avidemux_2.4_branch/avidemux/Makefile.am	2007-09-26 15:43:52 UTC (rev 3603)
@@ -46,7 +46,7 @@
 		
 		
 user_interface_qt4 = \
-			./ADM_ocr/libADM_ocr.a	\			
+			./ADM_ocr/libADM_ocr.a	\
 			./ADM_userInterfaces/ADM_QT4/libADM_UI_QT4.a   \
 			./ADM_userInterfaces/ADM_QT4/ADM_gui/libADM_gui2.a	\
 			./ADM_userInterfaces/ADM_QT4/ADM_dialog/libADM_dialog.a	\
@@ -166,7 +166,6 @@
 
 INCLUDES = $(all_includes) $(GTK_CFLAGS) $(XML_CFLAGS) \
 	$(SMONKEY_CFLAGS) \
-	-DADMLOCALE='"'$(ADM_LOCALEDIR)'"' \
 	-IADM_inputs -IADM_outputs \
 	-IADM_lavutil  -IADM_libraries -IADM_libraries/ADM_utilities -IADM_libraries/ADM_lavutil \
 	-IADM_userInterfaces/ADM_commonUI \



From gruntster at mail.berlios.de  Wed Sep 26 17:56:40 2007
From: gruntster at mail.berlios.de (gruntster at mail.berlios.de)
Date: Wed, 26 Sep 2007 17:56:40 +0200
Subject: [Avidemux-svn-commit] r3604 - branches/avidemux_2.4_branch/cmake
Message-ID: <200709261556.l8QFueVE015497@sheep.berlios.de>

Author: gruntster
Date: 2007-09-26 17:56:32 +0200 (Wed, 26 Sep 2007)
New Revision: 3604

Modified:
   branches/avidemux_2.4_branch/cmake/FindSubversion.cmake
Log:
[CMake] force Subversion to English output when extracting info

Modified: branches/avidemux_2.4_branch/cmake/FindSubversion.cmake
===================================================================
--- branches/avidemux_2.4_branch/cmake/FindSubversion.cmake	2007-09-26 15:43:52 UTC (rev 3603)
+++ branches/avidemux_2.4_branch/cmake/FindSubversion.cmake	2007-09-26 15:56:32 UTC (rev 3604)
@@ -61,6 +61,9 @@
   SET(Subversion_FOUND TRUE)
 
   MACRO(Subversion_WC_INFO dir prefix)
+    SET(LANG_ENV_VAR $ENV{LANG})
+    SET(ENV{LANG} "en")
+
     EXECUTE_PROCESS(COMMAND ${Subversion_SVN_EXECUTABLE} --version
       WORKING_DIRECTORY ${PROJECT_SOURCE_DIR}
       OUTPUT_VARIABLE Subversion_VERSION_SVN
@@ -103,6 +106,8 @@
     IF(NOT ${Subversion_svn_log_result} EQUAL 0)
       MESSAGE(SEND_ERROR "Command \"${Subversion_SVN_EXECUTABLE} log -r BASE ${dir}\" failed with output:\n${Subversion_svn_log_error}")
     ENDIF(NOT ${Subversion_svn_log_result} EQUAL 0)
+
+    SET($ENV{LANG} LANG_ENV_VAR)
   ENDMACRO(Subversion_WC_INFO)
 
 ENDIF(Subversion_SVN_EXECUTABLE)



From mean at mail.berlios.de  Sat Sep 29 12:56:32 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 29 Sep 2007 12:56:32 +0200
Subject: [Avidemux-svn-commit] r3605 -
	branches/avidemux_2.4_branch/avidemux/ADM_audio
Message-ID: <200709291056.l8TAuWL7009125@sheep.berlios.de>

Author: mean
Date: 2007-09-29 12:56:31 +0200 (Sat, 29 Sep 2007)
New Revision: 3605

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_audio/audio_packetizer.cpp
Log:
[Mp3 packet] Patch from yhjvgskxwizgr, try to handle better borked mp2/mp3 packet

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audio/audio_packetizer.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audio/audio_packetizer.cpp	2007-09-26 15:56:32 UTC (rev 3604)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audio/audio_packetizer.cpp	2007-09-29 10:56:31 UTC (rev 3605)
@@ -422,7 +422,15 @@
 					mpegInfo.size);
 			*len=mpegInfo.size;
 			*samples=mpegInfo.samples;
-			packetHead+=startOffset+mpegInfo.size;
+			//packetHead+=startOffset+mpegInfo.size;
+                        // Patch from yhjvgskxwizgr (forum)
+                       if(startOffset < mpegInfo.size/2)  // we probably have our correct frame, so set head to the next
+                               packetHead+=startOffset+mpegInfo.size;
+                       else if(startOffset < mpegInfo.size)  // we probably have the next frame, so duplicate it to keep a/v synced
+                               packetHead+=startOffset;
+                       else  // we have next or later frame, so next time continue searching one frame later to keep a/v synced
+                               packetHead+=mpegInfo.size;
+                        // /Patch
 			return 1;
 }		
 //---



From mean at mail.berlios.de  Sat Sep 29 13:08:19 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sat, 29 Sep 2007 13:08:19 +0200
Subject: [Avidemux-svn-commit] r3606 - in
	branches/avidemux_2.4_branch/avidemux: ADM_codecs
	ADM_libraries/ADM_lavcodec
Message-ID: <200709291108.l8TB8JSD021746@sheep.berlios.de>

Author: mean
Date: 2007-09-29 13:08:18 +0200 (Sat, 29 Sep 2007)
New Revision: 3606

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/h263dec.c
Log:
[Lavcodec] Workaround slice end not reached when FF_BUG_AUTODETECT is set

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp	2007-09-29 10:56:31 UTC (rev 3605)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp	2007-09-29 11:08:18 UTC (rev 3606)
@@ -44,7 +44,7 @@
 AVCodec *codec=avcodec_find_decoder(x);\
 if(!codec) {GUI_Alert(QT_TR_NOOP("Internal error finding codec"#x));ADM_assert(0);} \
   codecId=x; \
-  _context->workaround_bugs=FF_BUG_AUTODETECT; \
+  _context->workaround_bugs=1*FF_BUG_AUTODETECT+1*FF_BUG_NO_PADDING; \
   _context->error_concealment=3; \
   if (avcodec_open(_context, codec) < 0)  \
                       { \
@@ -220,6 +220,7 @@
   printf ("[lavc] Build: %d\n", LIBAVCODEC_BUILD);
   _context->debug_mv |= FF_SHOW;
   _context->debug |= FF_DEBUG_VIS_MB_TYPE + FF_DEBUG_VIS_QP;
+  
 }
 
 //_____________________________________________________

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/h263dec.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/h263dec.c	2007-09-29 10:56:31 UTC (rev 3605)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/h263dec.c	2007-09-29 11:08:18 UTC (rev 3606)
@@ -271,7 +271,8 @@
 
     /* try to detect the padding bug */
     if(      s->codec_id==CODEC_ID_MPEG4
-       &&   (s->workaround_bugs&FF_BUG_AUTODETECT)
+       &&   (s->workaround_bugs&FF_BUG_AUTODETECT) 
+       &&  !(s->workaround_bugs&FF_BUG_NO_PADDING) // MEANX
        &&    s->gb.size_in_bits - get_bits_count(&s->gb) >=0
        &&    s->gb.size_in_bits - get_bits_count(&s->gb) < 48
 //       &&   !s->resync_marker
@@ -294,8 +295,10 @@
                 s->padding_bug_score++;
         }
     }
-
-    if(s->workaround_bugs&FF_BUG_AUTODETECT){
+ // MEANX : slice end not reached when autodetect is set
+      if( !(s->workaround_bugs&FF_BUG_NO_PADDING) &&
+            s->workaround_bugs&FF_BUG_AUTODETECT ){
+    //if(s->workaround_bugs&FF_BUG_AUTODETECT ){
         if(s->padding_bug_score > -2 && !s->data_partitioning /*&& (s->divx_version || !s->resync_marker)*/)
             s->workaround_bugs |=  FF_BUG_NO_PADDING;
         else



From mean at mail.berlios.de  Sun Sep 30 18:29:30 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 30 Sep 2007 18:29:30 +0200
Subject: [Avidemux-svn-commit] r3607 -
	branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska
Message-ID: <200709301629.l8UGTUUF016596@sheep.berlios.de>

Author: mean
Date: 2007-09-30 18:29:29 +0200 (Sun, 30 Sep 2007)
New Revision: 3607

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h
Log:
[MKV read] add a new tag, just for completeness

Modified: branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h	2007-09-29 11:08:18 UTC (rev 3606)
+++ branches/avidemux_2.4_branch/avidemux/ADM_inputs/ADM_matroska/mkv_tagenum.h	2007-09-30 16:29:29 UTC (rev 3607)
@@ -107,6 +107,7 @@
    MKTAG(MKV_FLAG_FORCED,0x55AA,ADM_MKV_TYPE_UINTEGER),
    
    MKTAG(MKV_BLOCK_DURATION,0x9B,ADM_MKV_TYPE_UINTEGER),
+   MKTAG(MKV_REFERENCE_PRIORITY,0xfA,ADM_MKV_TYPE_INTEGER),
    MKTAG(MKV_REFERENCE_BLOCK,0xfB,ADM_MKV_TYPE_INTEGER),
 //*********** TAGS ****************  
    MKTAG(MKV_TAGS,0x1254c367,ADM_MKV_TYPE_CONTAINER),



From mean at mail.berlios.de  Sun Sep 30 18:49:45 2007
From: mean at mail.berlios.de (mean at BerliOS)
Date: Sun, 30 Sep 2007 18:49:45 +0200
Subject: [Avidemux-svn-commit] r3608 - in
	branches/avidemux_2.4_branch/avidemux: . ADM_audiodevice
	ADM_libraries/ADM_lavcodec ADM_libraries/ADM_libass
	ADM_libraries/ADM_utilities ADM_userInterfaces/ADM_GTK/ADM_dialog
	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory
	ADM_userInterfaces/ADM_GTK/ADM_gui2
	ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk
	ADM_userInterfaces/ADM_GTK/glade
	ADM_userInterfaces/ADM_NONE/ADM_dialog
	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory
	ADM_userInterfaces/ADM_QT4/ADM_dialog
	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory
	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter
Message-ID: <200709301649.l8UGnjnV022748@sheep.berlios.de>

Author: mean
Date: 2007-09-30 18:49:31 +0200 (Sun, 30 Sep 2007)
New Revision: 3608

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_SwissArmyKnife.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_particle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_threshold.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade/particle.glade
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade/swissarmyknife.glade
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade/threshold.glade
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyParticle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyParticle.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flySwissArmyKnife.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flySwissArmyKnife.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyThreshold.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyThreshold.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_assert.h
   branches/avidemux_2.4_branch/avidemux/ADM_audiodevice/ADM_deviceArts.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/avcodec.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_cache.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_font.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_fontconfig.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_render.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/default.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_flyDialog.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioconfig.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_enter.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyAsharp.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyContrast.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyCrop.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyDialog.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyDialog.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_mjpeg.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_confCouple.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_confCouples.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidFont.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidFont.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRT.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRTRender.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRTload.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.h
Log:
[Misc] Chris McGregor : plenty of fixes, warning fixes, and more mysterious filters

Modified: branches/avidemux_2.4_branch/avidemux/ADM_assert.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_assert.h	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_assert.h	2007-09-30 16:49:31 UTC (rev 3608)
@@ -44,6 +44,7 @@
   #define realloc #error
   #define memalign #error
   #define free  #error
+  #undef strdup
   #define strdup #error
   #define calloc #error
 #else
@@ -51,6 +52,7 @@
   #define realloc ADM_realloc
   #define memalign(x,y) ADM_alloc(y)
   #define free  ADM_dealloc
+  #undef strdup
   #define strdup ADM_strdup
   #define calloc ADM_calloc
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiodevice/ADM_deviceArts.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiodevice/ADM_deviceArts.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiodevice/ADM_deviceArts.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -14,21 +14,14 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
+
+#include "default.h"
+
 #ifndef ADM_WIN32 
 #ifdef USE_ARTS
 #include <artsc.h>
 
-#include <stdio.h>
-#include <stdlib.h>
-#include <unistd.h>
-#include <errno.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <fcntl.h>
-#include <sys/ioctl.h>
 #include <ADM_assert.h>  
-#include "default.h"
 #include "ADM_audiodevice.h"
 #include  "ADM_audiodevice/ADM_deviceoss.h"
 #include  "ADM_audiodevice/ADM_deviceArts.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/avcodec.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/avcodec.h	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec/avcodec.h	2007-09-30 16:49:31 UTC (rev 3608)
@@ -2230,7 +2230,8 @@
 /**
  * @deprecated Use the software scaler (swscale) instead.
  */
-typedef struct ImgReSampleContext ImgReSampleContext attribute_deprecated;
+//typedef struct ImgReSampleContext ImgReSampleContext attribute_deprecated;
+typedef struct ImgReSampleContext ImgReSampleContext;
 
 /**
  * @deprecated Use the software scaler (swscale) instead.

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_cache.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_cache.c	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_cache.c	2007-09-30 16:49:31 UTC (rev 3608)
@@ -21,9 +21,18 @@
 #include "config.h"
 
 #include <inttypes.h>
+#ifdef HAVE_UNISTD_H
+// avoid warnings due to different definition of this in freetype headers
+#define WE_DO_HAVE_UNISTD_H
+#undef HAVE_UNISTD_H
+#endif
 #include <ft2build.h>
 #include FT_FREETYPE_H
 #include FT_GLYPH_H
+#ifdef WE_DO_HAVE_UNISTD_H
+#undef HAVE_UNISTD_H
+#define HAVE_UNISTD_H
+#endif
 
 #include <assert.h>
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_font.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_font.c	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_font.c	2007-09-30 16:49:31 UTC (rev 3608)
@@ -21,11 +21,21 @@
 #include "config.h"
 
 #include <inttypes.h>
+#ifdef HAVE_UNISTD_H
+// avoid warnings due to different definition of this in freetype headers
+#define WE_DO_HAVE_UNISTD_H
+#undef HAVE_UNISTD_H
+#endif
 #include <ft2build.h>
 #include FT_FREETYPE_H
 #include FT_SYNTHESIS_H
 #include FT_GLYPH_H
 #include FT_TRUETYPE_TABLES_H
+#ifdef HAVE_UNISTD_H
+// avoid warnings due to different definition of this in freetype headers
+#define WE_DO_HAVE_UNISTD_H
+#undef HAVE_UNISTD_H
+#endif
 
 #include "ass.h"
 #include "ass_library.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_fontconfig.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_fontconfig.c	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_fontconfig.c	2007-09-30 16:49:31 UTC (rev 3608)
@@ -27,8 +27,17 @@
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <inttypes.h>
+#ifdef HAVE_UNISTD_H
+// avoid warnings due to different definition of this in freetype headers
+#define WE_DO_HAVE_UNISTD_H
+#undef HAVE_UNISTD_H
+#endif
 #include <ft2build.h>
 #include FT_FREETYPE_H
+#ifdef WE_DO_HAVE_UNISTD_H
+#undef HAVE_UNISTD_H
+#define HAVE_UNISTD_H
+#endif
 
 #include "mputils.h"
 #include "ass.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_render.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_render.c	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_libass/ass_render.c	2007-09-30 16:49:31 UTC (rev 3608)
@@ -23,11 +23,20 @@
 #include <assert.h>
 #include <math.h>
 #include <inttypes.h>
+#ifdef HAVE_UNISTD_H
+// avoid warnings due to different definition of this in freetype headers
+#define WE_DO_HAVE_UNISTD_H
+#undef HAVE_UNISTD_H
+#endif
 #include <ft2build.h>
 #include FT_FREETYPE_H
 #include FT_STROKER_H
 #include FT_GLYPH_H
 #include FT_SYNTHESIS_H
+#ifdef WE_DO_HAVE_UNISTD_H
+#undef HAVE_UNISTD_H
+#define HAVE_UNISTD_H
+#endif
 
 #include "mputils.h"
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/default.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/default.h	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/default.h	2007-09-30 16:49:31 UTC (rev 3608)
@@ -16,12 +16,21 @@
  ***************************************************************************/
 #ifndef __ZDEFAULT
 #define __ZDEFAULT
+
+#include "config.h"
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#ifdef HAVE_UNISTD_H
+#include <unistd.h>
+#endif
+
 /*
    	The maximum width/height is MAXIMUM_SIZE 768*768 for now
 */
 #define MAXIMUM_SIZE 2048
 
-
 typedef unsigned char ADM_filename ;
 
 #ifdef HAVE_STDINT_H

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/CMakeLists.txt	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/CMakeLists.txt	2007-09-30 16:49:31 UTC (rev 3608)
@@ -10,6 +10,7 @@
 DIA_cnr2.cpp         DIA_eq2.cpp        DIA_idx_pg.cpp     DIA_partial.cpp   DIA_quota.cpp       DIA_vobsub.cpp
 DIA_asharp.cpp    DIA_coloryuv.cpp     DIA_equalizer.cpp  DIA_jobs.cpp       DIA_pause.cpp     DIA_recent.cpp      DIA_working.cpp
 DIA_busy.cpp      DIA_contrast.cpp     DIA_exLame.cpp     DIA_jobs_save.cpp  DIA_pipe.cpp      DIA_resize.cpp      DIA_x264.cpp
+DIA_threshold.cpp DIA_SwissArmyKnife.cpp DIA_particle.cpp
 )
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
 ADD_ADM_LIB(${ADM_LIB} ADM_libraries)

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_SwissArmyKnife.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_SwissArmyKnife.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_SwissArmyKnife.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -0,0 +1,1535 @@
+/***************************************************************************
+                          DIA_SwissArmyKnife.cpp  -  configuration dialog for
+						Swiss Army Knife filter
+                              -------------------
+                         Chris MacGregor, September 2007
+                         chris-avidemux at bouncingdog.com
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include "default.h"
+
+#include <gtk/gtk.h>
+#include <cmath>
+
+#include "fourcc.h"
+#include "avio.hxx"
+
+#include "avi_vars.h"
+
+#ifdef HAVE_ENCODER
+
+#include "ADM_editor/ADM_edit.hxx"
+#include "ADM_video/ADM_genvideo.hxx"
+#include "ADM_videoFilter/ADM_vidSwissArmyKnife.h"
+#include "ADM_toolkit/toolkit.hxx"
+#include "ADM_toolkit_gtk/ADM_gladeSupport.h"
+#include "ADM_toolkit_gtk/toolkit_gtk.h"
+#include "ADM_toolkit_gtk/toolkit_gtk_include.h"
+#include "ADM_assert.h"
+#include "DIA_flyDialog.h"
+#include "DIA_flySwissArmyKnife.h"
+#include "ADM_userInterfaces/ADM_commonUI/DIA_factory.h" // for diaElemMenu etc.
+
+/********************************************************************/
+static GtkWidget *create_swiss_army_knife_dialog (void);
+static GtkWidget *dialog = 0;
+
+static gboolean gui_draw (GtkWidget * widget,
+			  GdkEventExpose * event, gpointer user_data);
+static void gui_update (GtkObject * button, gpointer user_data);
+static void frame_changed (GtkRange *, gpointer user_data);
+
+static volatile int lock = 0;
+
+/********************************************************************/
+
+static gboolean previewButtonEvent (GtkWidget *,
+                                    GdkEventButton * event,
+                                    gpointer data)
+{
+    if (event->type != GDK_BUTTON_PRESS)
+        return FALSE;
+
+    uint32_t x = static_cast <uint32_t> (event->x);
+    uint32_t y = static_cast <uint32_t> (event->y);
+
+    flySwissArmyKnife * myFly = static_cast <flySwissArmyKnife *> (data);
+    ADMImage * image = event->button == 1
+        ? myFly->getInputImage() : myFly->getOutputImage();
+
+    uint32_t width = image->_width;
+    uint32_t height = image->_height;
+
+    if (x >= width || y >= height)
+        return FALSE;
+
+    uint8_t range = 3;
+    if (event->state & GDK_SHIFT_MASK)
+        range += 2;
+    if (event->state & GDK_CONTROL_MASK)
+        range += 4;
+    if (event->state & GDK_MOD1_MASK)
+        range += 6;
+
+    uint8_t halfrange = range / 2;
+
+    uint32_t xmin = (x > halfrange) ? x - halfrange : 0;
+    uint32_t ymin = (y > halfrange) ? y - halfrange : 0;
+
+    uint32_t xmax = x + halfrange;
+    uint32_t ymax = y + halfrange;
+
+    if (xmax >= width)
+        xmax = width - 1;
+    if (ymax >= height)
+        ymax = height - 1;
+
+    uint8_t * imagepix = YPLANE (image);
+
+    printf ("\n  x|");
+    for (x = xmin; x <= xmax; x++)
+        printf (" %3d", x);
+    printf ("\ny: +");
+    for (x = xmin; x <= xmax; x++)
+        printf (" ---", x);
+    printf ("\n");
+
+    for (y = ymin; y <= ymax; y++)
+    {
+        uint8_t * pixp = imagepix + (y * width) + xmin;
+        printf ("%3d|", y);
+        for (x = xmin; x <= xmax; x++)
+            printf (" %3d", *pixp++);
+        printf ("\n");
+    }
+
+    return TRUE;
+}
+
+/********************************************************************/
+
+void alphaRecalcOther (GtkSpinButton * spinbutton, gpointer user_data)
+{
+    static int alpha_lock = 0;
+
+    // avoid double screen updates (can be slow if the settings involve a lot
+    // of calculation, such as recalculating the head start) due to recursive
+    // calls to this function (e.g., it gets invoked on the denominator to a
+    // change made by this function in response to the user changing the float
+    // field).
+
+    if (alpha_lock++)
+    {
+        --alpha_lock;
+        return;
+    }
+
+    GtkSpinButton * targetspinbutton = GTK_SPIN_BUTTON (user_data);
+    gtk_spin_button_set_value (targetspinbutton,
+                               1 / gtk_spin_button_get_value (spinbutton));
+
+    --alpha_lock;
+}
+
+struct PixelValueScalingInfo
+{
+    GtkAdjustment * addAdjustment;
+    GtkAdjustment * multAdjustment;
+    GtkAdjustment * minAdjustment;
+    GtkAdjustment * maxAdjustment;
+    flySwissArmyKnife * myFly;
+    double addValue;
+    double multValue;
+    double minValue;
+    double maxValue;
+    bool valuesSet;
+    PixelValueScalingInfo (GtkAdjustment * add,
+                           GtkAdjustment * mult,
+                           GtkAdjustment * min,
+                           GtkAdjustment * max,
+                           flySwissArmyKnife * myFly)
+        : addAdjustment (add),
+          multAdjustment (mult),
+          minAdjustment (min),
+          maxAdjustment (max),
+          myFly (myFly),
+          valuesSet (false)
+
+    {
+    }
+};
+
+void updateScalingStuff (GtkAdjustment * adj, gpointer user_data)
+{
+    static int scaling_lock = 0;
+
+    // avoid screwy behavior due to recursive calls to this function (e.g., if
+    // it gets invoked due to a change that it initiated, just exit - no good
+    // will come of trying to redo the calculations midstream).
+
+    if (scaling_lock++)
+    {
+        // printf ("skipping recursive updateScalingStuff(%p)\n", adj);
+        --scaling_lock;
+        return;
+    }
+
+    PixelValueScalingInfo * info
+        = static_cast <PixelValueScalingInfo *> (user_data);
+
+    bool valueChanged = false;
+    if (!info->valuesSet)
+    {
+        info->addValue = gtk_adjustment_get_value (info->addAdjustment);
+        info->multValue = gtk_adjustment_get_value (info->multAdjustment);
+        info->minValue = gtk_adjustment_get_value (info->minAdjustment);
+        info->maxValue = gtk_adjustment_get_value (info->maxAdjustment);
+        info->valuesSet = true;
+        valueChanged = true; // force update - we have to assume it did change
+    }
+
+    // No matter who sent the signal, we will want the value from it.
+
+    gdouble value = gtk_adjustment_get_value (adj);
+
+    // We need to know which thing sent the signal so we propagate values in
+    // the right directions.
+
+    // Here's how we got the calculations below:
+    //     P' = (P + add) * mult
+    // (solve for each of mult, add, and P:)
+    //     mult = P' / (P + add)
+    //     add = (P' / mult) - P
+    //     P = (P' / mult) - add
+    // Thus:
+    //     for min, where P' = 0, P = -add
+    //     for max, where P' = 255, P = (255 / mult) - add
+    // And so:
+    //     add = -min
+    //     mult = 255 / (max - min)
+    //     min = -add
+    //     max = (255 / mult) - add
+
+    if (adj == info->addAdjustment)
+    {
+        // printf ("updateScalingStuff(%p) - add is now %.12f (was %.12f)\n",
+        //         adj, value, info->addValue);
+        if (valueChanged || fabs (value - info->addValue) >= 0.00001)
+        {
+            gtk_adjustment_set_value (info->minAdjustment, -value);
+            gdouble mult_value
+                = gtk_adjustment_get_value (info->multAdjustment);
+            gtk_adjustment_set_value (info->maxAdjustment,
+                                      (255 / mult_value) - value);
+            info->addValue = value;
+            valueChanged = true;
+        }
+    }
+    else if (adj == info->multAdjustment)
+    {
+        // printf ("updateScalingStuff(%p) - mult is now %.12f (was %.12f)\n",
+        //         adj, value, info->multValue);
+        if (valueChanged || fabs (value - info->multValue) >= 0.00001)
+        {
+            gdouble add_value
+                = gtk_adjustment_get_value (info->addAdjustment);
+            gtk_adjustment_set_value (info->maxAdjustment,
+                                      (255 / value) - add_value);
+            info->multValue = value;
+            valueChanged = true;
+        }
+    }
+    else if (adj == info->minAdjustment)
+    {
+        // printf ("updateScalingStuff(%p) - min is now %.12f (was %.12f)\n",
+        //         adj, value, info->minValue);
+        if (valueChanged || fabs (value - info->minValue) >= 0.1)
+        {
+            gdouble max_value
+                = gtk_adjustment_get_value (info->maxAdjustment);
+            gtk_adjustment_set_value (info->addAdjustment, -value);
+            gtk_adjustment_set_value (info->multAdjustment,
+                                      255 / (max_value - value));
+            info->minValue = value;
+            valueChanged = true;
+        }
+    }
+    else if (adj == info->maxAdjustment)
+    {
+        // printf ("updateScalingStuff(%p) - max is now %.12f (was %.12f)\n",
+        //         adj, value, info->maxValue);
+        if (valueChanged || fabs (value - info->maxValue) >= 0.1)
+        {
+            gdouble min_value
+                = gtk_adjustment_get_value (info->minAdjustment);
+            gtk_adjustment_set_value (info->multAdjustment,
+                                      255 / (value - min_value));
+            info->maxValue = value;
+            valueChanged = true;
+        }
+    }
+    else
+    {
+        // uh oh!
+        fprintf (stderr, "updateScalingStuff() called with unknown adj\n");
+        ADM_assert(0);
+    }
+
+    if (valueChanged)
+    {
+        // printf ("updateScalingStuff(%p) - about to gui_update()\n", adj);
+        gui_update (GTK_OBJECT (adj), gpointer (info->myFly));
+    }
+    // printf ("updateScalingStuff(%p) - done\n", adj);
+
+    --scaling_lock;
+}
+
+void inputTypeChange (GtkComboBox * combo, gpointer user_data)
+{
+    flySwissArmyKnife * myFly = static_cast <flySwissArmyKnife *> (user_data);
+    const MenuMapping * mm = myFly->lookupMenu ("inputTypeMenu");
+    uint32_t inputType = myFly->getMenuValue (mm);
+
+    GtkWidget * convolutionSettingsVbox = WID (convolutionSettingsVbox);
+    GtkWidget * imageFileSettingsVbox = WID (imageFileSettingsVbox);
+    GtkWidget * constantSettingsVbox = WID (constantSettingsVbox);
+    GtkWidget * rollingAvgSettingsVbox = WID (rollingAvgSettingsVbox);
+
+    gtk_widget_hide (convolutionSettingsVbox);
+    gtk_widget_hide (imageFileSettingsVbox);
+    gtk_widget_hide (constantSettingsVbox);
+    gtk_widget_hide (rollingAvgSettingsVbox);
+
+    switch (inputType)
+    {
+    case ADMVideoSwissArmyKnife::INPUT_CUSTOM_CONVOLUTION:
+        gtk_widget_show (convolutionSettingsVbox);
+        break;
+    case ADMVideoSwissArmyKnife::INPUT_FILE_IMAGE_FLOAT:
+    case ADMVideoSwissArmyKnife::INPUT_FILE_IMAGE_INTEGER:
+        gtk_widget_show (imageFileSettingsVbox);
+        break;
+    case ADMVideoSwissArmyKnife::INPUT_CONSTANT_VALUE:
+        gtk_widget_show (constantSettingsVbox);
+        break;
+    case ADMVideoSwissArmyKnife::INPUT_ROLLING_AVERAGE:
+        gtk_widget_show (rollingAvgSettingsVbox);
+        break;
+    default:
+        fprintf (stderr, "unknown input type %d!!!\n", inputType);
+        ADM_assert(0);
+    }
+
+    myFly->updateConfigDescription (true);
+
+    // If the preview window is enabled, then draw on it and clear the output
+    // buffer so there isn't a leftover image (in the case where the config we
+    // switched to can't output right now, e.g., invalid params - missing
+    // filename, for instance).
+
+    myFly->wipeOutputBuffer();
+
+    if (myFly->param.enable_preview)
+    {
+        GtkWidget * previewVideo = WID(previewVideo);
+        int max_x = previewVideo->allocation.width;
+        int max_y = previewVideo->allocation.height;
+        gdk_draw_rectangle
+            (previewVideo->window,
+             previewVideo->style->fg_gc[GTK_WIDGET_STATE (previewVideo)],
+             TRUE, 0, 0, max_x, max_y);
+    }
+
+    myFly->sliderChanged();
+}
+
+void previewEnableButton (GtkToggleButton * button, gpointer user_data)
+{
+    flySwissArmyKnife * myFly = static_cast <flySwissArmyKnife *> (user_data);
+    bool isActive = gtk_toggle_button_get_active (button);
+    myFly->param.enable_preview = isActive;
+
+    GtkWidget * previewVideo = WID(previewVideo);
+    GtkWidget * previewDisabled = WID(previewDisabled);
+
+    if (isActive)
+    {
+        gtk_widget_hide (previewDisabled);
+        gtk_widget_show (previewVideo);
+        myFly->sliderChanged();
+    }
+    else
+    {
+        gtk_widget_hide (previewVideo);
+        gtk_widget_show (previewDisabled);
+    }
+}
+
+void flySwissArmyKnife::updateConfigDescription (bool do_download)
+{
+    if (do_download)
+        download();
+    gtk_label_set_text (GTK_LABEL(WID(currentConfigDescription)),
+                        ADMVideoSwissArmyKnife::getConf (&param, true));
+}
+
+void updateConfigDescription (GtkSpinButton * button, gpointer user_data)
+{
+    flySwissArmyKnife * myFly = static_cast <flySwissArmyKnife *> (user_data);
+    myFly->updateConfigDescription (true);
+}
+
+uint8_t DIA_SwissArmyKnife (AVDMGenericVideoStream * in,
+                            ADMVideoSwissArmyKnife * sakp,
+                            SWISSARMYKNIFE_PARAM * param,
+                            const MenuMapping * menu_mapping,
+                            uint32_t menu_mapping_count)
+{
+    // Allocate space for preview video
+    uint32_t width = in->getInfo()->width;
+    uint32_t height = in->getInfo()->height;
+
+    dialog = create_swiss_army_knife_dialog();
+    gtk_register_dialog (dialog);
+    gtk_window_set_title (GTK_WINDOW (dialog),
+                          QT_TR_NOOP("Swiss Army Knife Configuration"));
+    gtk_widget_set_size_request (WID(previewDisabled), width, height);
+
+    // Fix up a bunch of things that Glade can't do.  This is less efficient
+    // than just editing the Glade output, but it's not that big a deal and
+    // doing it this way makes it MUCH easier to use Glade to tweak the layout
+    // later.
+
+    // 1. Connect the slider/spinner pairs by making them share a
+    //    GtkAdjustment.
+
+#define JOIN_SPINPAIR(_basename) \
+    gtk_range_set_adjustment \
+        (GTK_RANGE(WID(_basename ## Slider)), \
+         gtk_spin_button_get_adjustment (GTK_SPIN_BUTTON(WID(_basename ## Spinner))))
+
+    JOIN_SPINPAIR (imageFileScalingMin);
+    JOIN_SPINPAIR (imageFileScalingMax);
+    JOIN_SPINPAIR (bias);
+    JOIN_SPINPAIR (resultScalingMin);
+    JOIN_SPINPAIR (resultScalingMax);
+
+    // 2. Connect the alpha spin buttons.  Conveniently, they are reciprocals
+    //    of each other, so we can use the same function for updates in both
+    //    directions.
+
+#define ONVALCHG(_from_widg, _func, _to_widg) \
+    g_signal_connect (GTK_OBJECT(WID(_from_widg)), "value_changed", \
+                      GTK_SIGNAL_FUNC(_func),                       \
+                      gpointer (GTK_OBJECT(WID(_to_widg))))
+
+    ONVALCHG (rollingAvgAlphaSpinButton, alphaRecalcOther,
+              rollingAvgAlphaDenomSpinButton);
+    ONVALCHG (rollingAvgAlphaDenomSpinButton, alphaRecalcOther,
+              rollingAvgAlphaSpinButton);
+
+    // 3. Create the flyDialog.
+
+    gtk_widget_show(dialog);
+
+    flySwissArmyKnife * myDialog
+        = new flySwissArmyKnife (width, height, in,
+                                 WID(previewVideo), WID(previewSlider),
+                                 GTK_DIALOG(dialog), sakp, param,
+                                 menu_mapping, menu_mapping_count);
+    myDialog->upload();
+    myDialog->sliderChanged();
+
+    // 4. Connect up all the other signals and stuff.
+
+#define CNX(_widg,_signame) \
+    g_signal_connect (GTK_OBJECT(WID(_widg)), _signame,                \
+                      GTK_SIGNAL_FUNC(gui_update), gpointer(myDialog));
+
+    CNX (operationMenu, "changed");
+    CNX (inputTypeMenu, "changed");
+
+    CNX (convolutionInputFileChooser, "selection_changed");
+    CNX (imageInputFileChooser, "selection_changed");
+
+    CNX (constantValueSpinButton, "value_changed");
+    CNX (rollingAvgAlphaDenomSpinButton, "value_changed");
+    CNX (rollingAvgInitTypeMenu, "changed");
+    CNX (rollingAvgInitStartSpinButton, "value_changed");
+    CNX (rollingAvgInitEndSpinButton, "value_changed");
+
+    CNX (biasSpinner, "value_changed");
+
+#define GETSPINADJ(_spinwidg) \
+    gtk_spin_button_get_adjustment (GTK_SPIN_BUTTON (WID (_spinwidg)))
+
+#define MK_PVSI(_basename) \
+    new PixelValueScalingInfo                                \
+        (GETSPINADJ(_basename ## ScalingAddSpinButton),      \
+         GETSPINADJ(_basename ## ScalingMultSpinButton),     \
+         GETSPINADJ(_basename ## ScalingMinSpinner),         \
+         GETSPINADJ(_basename ## ScalingMaxSpinner),         \
+         myDialog)
+
+    PixelValueScalingInfo * ifsi = MK_PVSI (imageFile);
+    PixelValueScalingInfo * ressi = MK_PVSI (result);
+
+#define SCALSIG(_widg, _scalinfo) \
+    g_signal_connect (GTK_OBJECT (GETSPINADJ (_widg)),             \
+                      "value_changed",                             \
+                      GTK_SIGNAL_FUNC(updateScalingStuff),         \
+                      gpointer (_scalinfo))
+
+#define SCALSIGS(_basename, _scalinfo) \
+    do { \
+        SCALSIG(_basename ## ScalingAddSpinButton, _scalinfo);        \
+        SCALSIG(_basename ## ScalingMultSpinButton, _scalinfo);       \
+        SCALSIG(_basename ## ScalingMinSpinner, _scalinfo);           \
+        SCALSIG(_basename ## ScalingMaxSpinner, _scalinfo);           \
+        updateScalingStuff                                            \
+            (GETSPINADJ(_basename ## ScalingAddSpinButton),           \
+             gpointer (_scalinfo));                                   \
+    } while (0)
+
+    SCALSIGS (imageFile, ifsi);
+    SCALSIGS (result, ressi);
+
+#if 0
+// we now do this one manually (called from updateScalingStuff()) to avoid
+// multiple screen updates (can be slow), such as for adjustments to min which
+// causes propagation to some of the other fields).
+#define SCALCNX(_basename) \
+    do { \
+        CNX (_basename ## ScalingAddSpinButton, "value_changed"); \
+        CNX (_basename ## ScalingMultSpinButton, "value_changed"); \
+        /* CNX (_basename ## ScalingMinSpinner, "value_changed"); */    \
+        /* CNX (_basename ## ScalingMaxSpinner, "value_changed"); */    \
+    } while (0)
+
+    SCALCNX (imageFile);
+    SCALCNX (result);
+#endif
+
+    // Also histogram and debugging settings, but these don't affect the
+    // preview output.  However, we should update the config description when
+    // they change.
+
+    g_signal_connect (GTK_OBJECT(WID(histogramSpinButton)), "value_changed",
+                      GTK_SIGNAL_FUNC(updateConfigDescription),
+                      gpointer(myDialog));
+    g_signal_connect (GTK_OBJECT(WID(debugSpinButton)), "value_changed",
+                      GTK_SIGNAL_FUNC(updateConfigDescription),
+                      gpointer(myDialog));
+
+    // Reshuffle what is and isn't displayed when the user selects a different
+    // input.
+
+    g_signal_connect(GTK_OBJECT(WID(inputTypeMenu)), "changed",
+                     GTK_SIGNAL_FUNC(inputTypeChange), gpointer(myDialog));
+    inputTypeChange (GTK_COMBO_BOX(WID(inputTypeMenu)), gpointer(myDialog));
+
+    // preview stuff:
+
+    g_signal_connect (GTK_OBJECT(WID(previewSlider)), "value_changed",
+                      GTK_SIGNAL_FUNC(frame_changed), gpointer(myDialog));
+    g_signal_connect (GTK_OBJECT(WID(previewVideo)), "expose_event",
+                      GTK_SIGNAL_FUNC(gui_draw), gpointer(myDialog));
+
+    g_signal_connect (GTK_OBJECT(WID(previewEnableButton)), "toggled",
+                      GTK_SIGNAL_FUNC(previewEnableButton),
+                      gpointer(myDialog));
+   
+    previewEnableButton (GTK_TOGGLE_BUTTON(WID(previewEnableButton)),
+                         gpointer(myDialog));
+
+    g_signal_connect (GTK_OBJECT(WID(previewVideo)), "button_press_event",
+                      GTK_SIGNAL_FUNC(previewButtonEvent),
+                      gpointer(myDialog));
+#if 0
+    g_signal_connect (GTK_OBJECT(WID(previewVideo)), "motion_notify_event",
+                      GTK_SIGNAL_FUNC(previewMotionEvent),
+                      gpointer(myDialog));
+#endif
+
+    uint8_t ret = 0;
+    int response = gtk_dialog_run(GTK_DIALOG(dialog));
+
+    if (response == GTK_RESPONSE_OK)
+    {
+        myDialog->download();
+        myDialog->getParam (param);
+        ret = 1;
+    }
+
+    gtk_unregister_dialog(dialog);
+    gtk_widget_destroy(dialog);
+
+    delete ressi;
+    delete ifsi;
+    delete myDialog;
+
+    return ret;
+}
+
+void frame_changed (GtkRange *, gpointer user_data)
+{
+    flySwissArmyKnife * myDialog
+        = static_cast <flySwissArmyKnife *> (user_data);
+
+    myDialog->sliderChanged();
+}
+
+void gui_update (GtkObject *, gpointer user_data)
+{
+    if (lock)
+        return;
+
+    flySwissArmyKnife * myDialog
+        = static_cast <flySwissArmyKnife *> (user_data);
+    myDialog->updateConfigDescription (true);
+    myDialog->update();
+}
+
+gboolean gui_draw (GtkWidget * widget, GdkEventExpose * event, gpointer user_data)
+{
+    flySwissArmyKnife * myDialog
+        = static_cast <flySwissArmyKnife *> (user_data);
+    myDialog->display();
+    return TRUE;
+}
+
+/**************************************/
+
+uint8_t flySwissArmyKnife::upload (void)
+{
+    lock++;
+
+    gtk_file_chooser_set_filename
+        (GTK_FILE_CHOOSER(WID(convolutionInputFileChooser)),
+         param.input_file.c_str());
+
+    gtk_file_chooser_set_filename
+        (GTK_FILE_CHOOSER(WID(imageInputFileChooser)),
+         param.input_file.c_str());
+    gtk_spin_button_set_value
+        (GTK_SPIN_BUTTON(WID(imageFileScalingAddSpinButton)),
+         param.load_bias);
+    gtk_spin_button_set_value
+        (GTK_SPIN_BUTTON(WID(imageFileScalingMultSpinButton)),
+         param.load_multiplier);
+
+    gtk_spin_button_set_value
+        (GTK_SPIN_BUTTON(WID(constantValueSpinButton)), param.input_constant);
+
+    gtk_spin_button_set_value
+        (GTK_SPIN_BUTTON(WID(rollingAvgAlphaSpinButton)),
+         param.memory_constant_alpha);
+    gtk_combo_box_set_active
+        (GTK_COMBO_BOX(WID(rollingAvgInitTypeMenu)), param.init_by_rolling);
+    gtk_spin_button_set_value
+        (GTK_SPIN_BUTTON(WID(rollingAvgInitStartSpinButton)),
+         param.init_start_frame);
+    gtk_spin_button_set_value
+        (GTK_SPIN_BUTTON(WID(rollingAvgInitEndSpinButton)),
+         param.init_end_frame);
+
+    gtk_spin_button_set_value
+        (GTK_SPIN_BUTTON(WID(biasSpinner)), param.bias);
+
+    gtk_spin_button_set_value
+        (GTK_SPIN_BUTTON(WID(resultScalingAddSpinButton)),
+         param.result_bias);
+    gtk_spin_button_set_value
+        (GTK_SPIN_BUTTON(WID(resultScalingMultSpinButton)),
+         param.result_multiplier);
+
+    gtk_spin_button_set_value
+        (GTK_SPIN_BUTTON(WID(histogramSpinButton)),
+         param.histogram_frame_interval);
+    gtk_spin_button_set_value
+        (GTK_SPIN_BUTTON(WID(debugSpinButton)), param.debug);
+
+    gtk_toggle_button_set_active
+        (GTK_TOGGLE_BUTTON(WID(previewEnableButton)), param.enable_preview);
+
+    updateConfigDescription (false);
+
+    lock--;
+    return 1;
+}
+
+uint8_t flySwissArmyKnife::download (void)
+{
+    getMenuValues();
+
+    const char * filename =
+        gtk_file_chooser_get_filename
+        (GTK_FILE_CHOOSER((param.input_type ==
+                           ADMVideoSwissArmyKnife::INPUT_CUSTOM_CONVOLUTION)
+                          ? WID(convolutionInputFileChooser)
+                          : WID(imageInputFileChooser)));
+    if (filename)
+    {
+        // gtk has its own allocator, and allocations from it should not be
+        // intermixed with allocations from adm, lest heap corruption result!
+        param.input_file = filename;
+        g_free (const_cast <char *> (filename));
+    }
+    else
+        param.input_file = "";
+
+    param.load_bias
+        = gtk_spin_button_get_value
+        (GTK_SPIN_BUTTON(WID(imageFileScalingAddSpinButton)));
+    param.load_multiplier
+        = gtk_spin_button_get_value
+        (GTK_SPIN_BUTTON(WID(imageFileScalingMultSpinButton)));
+
+    param.input_constant
+        = gtk_spin_button_get_value
+        (GTK_SPIN_BUTTON(WID(constantValueSpinButton)));
+
+    param.memory_constant_alpha
+        = gtk_spin_button_get_value
+        (GTK_SPIN_BUTTON(WID(rollingAvgAlphaSpinButton)));
+    param.init_by_rolling
+        = gtk_combo_box_get_active
+        (GTK_COMBO_BOX(WID(rollingAvgInitTypeMenu)));
+    param.init_start_frame
+        = gtk_spin_button_get_value_as_int
+        (GTK_SPIN_BUTTON(WID(rollingAvgInitStartSpinButton)));
+    param.init_end_frame
+        = gtk_spin_button_get_value_as_int
+        (GTK_SPIN_BUTTON(WID(rollingAvgInitEndSpinButton)));
+
+    param.bias
+        = gtk_spin_button_get_value_as_int
+        (GTK_SPIN_BUTTON(WID(biasSpinner)));
+
+    param.result_bias
+        = gtk_spin_button_get_value
+        (GTK_SPIN_BUTTON(WID(resultScalingAddSpinButton)));
+    param.result_multiplier
+        = gtk_spin_button_get_value
+        (GTK_SPIN_BUTTON(WID(resultScalingMultSpinButton)));
+
+    param.histogram_frame_interval
+        = gtk_spin_button_get_value_as_int
+        (GTK_SPIN_BUTTON(WID(histogramSpinButton)));
+    param.debug
+        = gtk_spin_button_get_value_as_int
+        (GTK_SPIN_BUTTON(WID(debugSpinButton)));
+
+    param.enable_preview
+        = gtk_toggle_button_get_active
+        (GTK_TOGGLE_BUTTON(WID(previewEnableButton)));
+
+    return 1;
+}
+
+void flySwissArmyKnife::wipeOutputBuffer ()
+{
+    // printf ("wiping output buffer\n");
+    uint32_t pixelcount = _w * _h;
+    uint32_t * outp = reinterpret_cast <uint32_t *>
+                      (YPLANE (_yuvBufferOut) + pixelcount);
+    uint32_t intcount = pixelcount / 4 + 1;
+    uint32_t value = 0x60;
+    while (--intcount)
+    {
+        *--outp = value;
+        value = value >> 8 | ((value & 0xff) << 24);
+    }
+
+    memset (UPLANE (_yuvBufferOut), 128, pixelcount >> 2);
+    memset (VPLANE (_yuvBufferOut), 128, pixelcount >> 2);
+}
+
+#define _(_str) QT_TR_NOOP(_str)
+
+// The following was generated by glade from swissarmyknife.glade once upon a
+// time (in fact, many times, since it took quite a few tries to get it right!
+// :-).  Thus far, I've avoided editing it, so regenerating the code from
+// Glade (I used 2.12.1) and swapping it in here should not lose anything.
+// All the tweaking and adjusting and signal-connecting is done in code above,
+// which is maintained by hand, and which has much knowledge of the names and
+// layout of the widgets (so be cautious about renaming things!).
+
+GtkWidget*
+create_swiss_army_knife_dialog (void)
+{
+  GtkWidget *swiss_army_knife_dialog;
+  GtkWidget *dialogVbox;
+  GtkWidget *dialogHbox;
+  GtkWidget *allSettingsVbox;
+  GtkWidget *settingsOuterHbox;
+  GtkWidget *settingsOuterVbox;
+  GtkWidget *operationHbox;
+  GtkWidget *operationLabel;
+  GtkWidget *operationMenu;
+  GtkWidget *inputTypeHbox;
+  GtkWidget *inputTypeLabel;
+  GtkWidget *inputTypeMenu;
+  GtkWidget *topSeparator;
+  GtkWidget *convolutionSettingsVbox;
+  GtkWidget *convolutionInputFileHbox;
+  GtkWidget *convolutionInputFileLabel;
+  GtkWidget *convolutionInputFileChooser;
+  GtkWidget *imageFileSettingsVbox;
+  GtkWidget *imageInputFileHbox;
+  GtkWidget *imageInputFileLabel;
+  GtkWidget *imageInputFileChooser;
+  GtkWidget *imageFileScalingFrame;
+  GtkWidget *imageFileScalingAlignment;
+  GtkWidget *imageFileScalingVbox;
+  GtkWidget *imageFileScalingAddHbox;
+  GtkWidget *imageFileScalingAddLabel;
+  GtkObject *imageFileScalingAddSpinButton_adj;
+  GtkWidget *imageFileScalingAddSpinButton;
+  GtkWidget *imageFileScalingMultHbox;
+  GtkWidget *imageFileScalingMultLabel;
+  GtkObject *imageFileScalingMultSpinButton_adj;
+  GtkWidget *imageFileScalingMultSpinButton;
+  GtkWidget *imageFileScalingMinVbox;
+  GtkWidget *imageFileScalingMinLabel;
+  GtkWidget *imageFileScalingMinHbox;
+  GtkWidget *imageFileScalingMinSlider;
+  GtkObject *imageFileScalingMinSpinner_adj;
+  GtkWidget *imageFileScalingMinSpinner;
+  GtkWidget *imageFileScalingMaxVbox;
+  GtkWidget *imageFileScalingMaxLabel;
+  GtkWidget *imageFileScalingMaxHbox;
+  GtkWidget *imageFileScalingMaxSlider;
+  GtkObject *imageFileScalingMaxSpinner_adj;
+  GtkWidget *imageFileScalingMaxSpinner;
+  GtkWidget *imageFileScalingFrameLabel;
+  GtkWidget *constantSettingsVbox;
+  GtkWidget *constantValueHbox;
+  GtkWidget *constantValueLabel;
+  GtkObject *constantValueSpinButton_adj;
+  GtkWidget *constantValueSpinButton;
+  GtkWidget *rollingAvgSettingsVbox;
+  GtkWidget *rollingAvgAlphaHbox;
+  GtkWidget *rollingAvgAlphaLabel;
+  GtkObject *rollingAvgAlphaSpinButton_adj;
+  GtkWidget *rollingAvgAlphaSpinButton;
+  GtkWidget *rollingAvgAlphaEqualsLabel;
+  GtkObject *rollingAvgAlphaDenomSpinButton_adj;
+  GtkWidget *rollingAvgAlphaDenomSpinButton;
+  GtkWidget *rollingAvgInitVbox;
+  GtkWidget *rollingAvgInitHbox1;
+  GtkWidget *rollingAvgInitLabel1;
+  GtkWidget *rollingAvgInitTypeMenu;
+  GtkWidget *rollingAvgInitLabel2;
+  GtkWidget *rollingAvgInitHbox2;
+  GtkWidget *rollingAvgInitLabel3;
+  GtkObject *rollingAvgInitStartSpinButton_adj;
+  GtkWidget *rollingAvgInitStartSpinButton;
+  GtkWidget *rollingAvgInitLabel4;
+  GtkObject *rollingAvgInitEndSpinButton_adj;
+  GtkWidget *rollingAvgInitEndSpinButton;
+  GtkWidget *bottomSeparator;
+  GtkWidget *biasVbox;
+  GtkWidget *biasLabel;
+  GtkWidget *biasHbox;
+  GtkWidget *biasSlider;
+  GtkObject *biasSpinner_adj;
+  GtkWidget *biasSpinner;
+  GtkWidget *resultScalingFrame;
+  GtkWidget *resultScalingAlignment;
+  GtkWidget *resultScalingVbox;
+  GtkWidget *resultScalingAddHbox;
+  GtkWidget *resultScalingAddLabel;
+  GtkObject *resultScalingAddSpinButton_adj;
+  GtkWidget *resultScalingAddSpinButton;
+  GtkWidget *resultScalingMultHbox;
+  GtkWidget *resultScalingMultLabel;
+  GtkObject *resultScalingMultSpinButton_adj;
+  GtkWidget *resultScalingMultSpinButton;
+  GtkWidget *resultScalingMinVbox;
+  GtkWidget *resultScalingMinLabel;
+  GtkWidget *resultScalingMinHbox;
+  GtkWidget *resultScalingMinSlider;
+  GtkObject *resultScalingMinSpinner_adj;
+  GtkWidget *resultScalingMinSpinner;
+  GtkWidget *resultScalingMaxVbox;
+  GtkWidget *resultScalingMaxLabel;
+  GtkWidget *resultScalingMaxHbox;
+  GtkWidget *resultScalingMaxSlider;
+  GtkObject *resultScalingMaxSpinner_adj;
+  GtkWidget *resultScalingMaxSpinner;
+  GtkWidget *resultScalingFrameLabel;
+  GtkWidget *hseparator2;
+  GtkWidget *currentConfigDescription;
+  GtkWidget *hseparator1;
+  GtkWidget *histogramHbox;
+  GtkWidget *histogramLabel;
+  GtkObject *histogramSpinButton_adj;
+  GtkWidget *histogramSpinButton;
+  GtkWidget *debugHbox;
+  GtkWidget *debugLabel;
+  GtkObject *debugSpinButton_adj;
+  GtkWidget *debugSpinButton;
+  GtkWidget *previewVboxOuter;
+  GtkWidget *previewFrame;
+  GtkWidget *previewAlignment;
+  GtkWidget *previewVbox;
+  GtkWidget *previewControlHbox;
+  GtkWidget *previewOutputMenu;
+  GtkWidget *previewSlider;
+  GtkWidget *previewVideo;
+  GtkWidget *previewDisabled;
+  GtkWidget *previewLabel;
+  GtkWidget *previewEnableButtonHbox;
+  GtkWidget *previewEnableButton;
+  GtkWidget *dialogButtonBox;
+  GtkWidget *cancelButton;
+  GtkWidget *okButton;
+
+  swiss_army_knife_dialog = gtk_dialog_new ();
+  gtk_window_set_title (GTK_WINDOW (swiss_army_knife_dialog), _("Swiss Army Knife"));
+  gtk_window_set_type_hint (GTK_WINDOW (swiss_army_knife_dialog), GDK_WINDOW_TYPE_HINT_DIALOG);
+
+  dialogVbox = GTK_DIALOG (swiss_army_knife_dialog)->vbox;
+  gtk_widget_show (dialogVbox);
+
+  dialogHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (dialogHbox);
+  gtk_box_pack_start (GTK_BOX (dialogVbox), dialogHbox, TRUE, TRUE, 0);
+
+  allSettingsVbox = gtk_vbox_new (FALSE, 12);
+  gtk_widget_show (allSettingsVbox);
+  gtk_box_pack_start (GTK_BOX (dialogHbox), allSettingsVbox, TRUE, TRUE, 0);
+  gtk_container_set_border_width (GTK_CONTAINER (allSettingsVbox), 8);
+
+  settingsOuterHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (settingsOuterHbox);
+  gtk_box_pack_start (GTK_BOX (allSettingsVbox), settingsOuterHbox, FALSE, TRUE, 0);
+
+  settingsOuterVbox = gtk_vbox_new (FALSE, 12);
+  gtk_widget_show (settingsOuterVbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterHbox), settingsOuterVbox, TRUE, TRUE, 0);
+
+  operationHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (operationHbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), operationHbox, TRUE, TRUE, 0);
+
+  operationLabel = gtk_label_new_with_mnemonic (_("Select _Operation on each pixel P and input A:   "));
+  gtk_widget_show (operationLabel);
+  gtk_box_pack_start (GTK_BOX (operationHbox), operationLabel, FALSE, FALSE, 0);
+
+  operationMenu = gtk_combo_box_new_text ();
+  gtk_widget_show (operationMenu);
+  gtk_box_pack_start (GTK_BOX (operationHbox), operationMenu, TRUE, TRUE, 0);
+
+  inputTypeHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (inputTypeHbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), inputTypeHbox, TRUE, TRUE, 0);
+
+  inputTypeLabel = gtk_label_new_with_mnemonic (_("Input _Type:   "));
+  gtk_widget_show (inputTypeLabel);
+  gtk_box_pack_start (GTK_BOX (inputTypeHbox), inputTypeLabel, FALSE, FALSE, 0);
+
+  inputTypeMenu = gtk_combo_box_new_text ();
+  gtk_widget_show (inputTypeMenu);
+  gtk_box_pack_start (GTK_BOX (inputTypeHbox), inputTypeMenu, TRUE, TRUE, 0);
+
+  topSeparator = gtk_hseparator_new ();
+  gtk_widget_show (topSeparator);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), topSeparator, TRUE, TRUE, 0);
+
+  convolutionSettingsVbox = gtk_vbox_new (FALSE, 6);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), convolutionSettingsVbox, TRUE, TRUE, 0);
+
+  convolutionInputFileHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (convolutionInputFileHbox);
+  gtk_box_pack_start (GTK_BOX (convolutionSettingsVbox), convolutionInputFileHbox, TRUE, TRUE, 0);
+
+  convolutionInputFileLabel = gtk_label_new_with_mnemonic (_("Input _File (convolution kernel):   "));
+  gtk_widget_show (convolutionInputFileLabel);
+  gtk_box_pack_start (GTK_BOX (convolutionInputFileHbox), convolutionInputFileLabel, FALSE, FALSE, 0);
+
+  convolutionInputFileChooser = gtk_file_chooser_button_new (_("Select Convolution Kernel File"), GTK_FILE_CHOOSER_ACTION_OPEN);
+  gtk_widget_show (convolutionInputFileChooser);
+  gtk_box_pack_start (GTK_BOX (convolutionInputFileHbox), convolutionInputFileChooser, TRUE, TRUE, 0);
+
+  imageFileSettingsVbox = gtk_vbox_new (FALSE, 6);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), imageFileSettingsVbox, TRUE, TRUE, 0);
+
+  imageInputFileHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (imageInputFileHbox);
+  gtk_box_pack_start (GTK_BOX (imageFileSettingsVbox), imageInputFileHbox, TRUE, TRUE, 0);
+
+  imageInputFileLabel = gtk_label_new_with_mnemonic (_("Input _File (image file):   "));
+  gtk_widget_show (imageInputFileLabel);
+  gtk_box_pack_start (GTK_BOX (imageInputFileHbox), imageInputFileLabel, FALSE, FALSE, 0);
+
+  imageInputFileChooser = gtk_file_chooser_button_new (_("Select Convolution Kernel File"), GTK_FILE_CHOOSER_ACTION_OPEN);
+  gtk_widget_show (imageInputFileChooser);
+  gtk_box_pack_start (GTK_BOX (imageInputFileHbox), imageInputFileChooser, TRUE, TRUE, 0);
+
+  imageFileScalingFrame = gtk_frame_new (NULL);
+  gtk_widget_show (imageFileScalingFrame);
+  gtk_box_pack_start (GTK_BOX (imageFileSettingsVbox), imageFileScalingFrame, TRUE, TRUE, 0);
+  gtk_frame_set_shadow_type (GTK_FRAME (imageFileScalingFrame), GTK_SHADOW_IN);
+
+  imageFileScalingAlignment = gtk_alignment_new (0.5, 0.5, 1, 1);
+  gtk_widget_show (imageFileScalingAlignment);
+  gtk_container_add (GTK_CONTAINER (imageFileScalingFrame), imageFileScalingAlignment);
+  gtk_alignment_set_padding (GTK_ALIGNMENT (imageFileScalingAlignment), 2, 6, 6, 6);
+
+  imageFileScalingVbox = gtk_vbox_new (FALSE, 6);
+  gtk_widget_show (imageFileScalingVbox);
+  gtk_container_add (GTK_CONTAINER (imageFileScalingAlignment), imageFileScalingVbox);
+
+  imageFileScalingAddHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (imageFileScalingAddHbox);
+  gtk_box_pack_start (GTK_BOX (imageFileScalingVbox), imageFileScalingAddHbox, TRUE, TRUE, 0);
+
+  imageFileScalingAddLabel = gtk_label_new_with_mnemonic (_("First, _add to each float pixel value:   "));
+  gtk_widget_show (imageFileScalingAddLabel);
+  gtk_box_pack_start (GTK_BOX (imageFileScalingAddHbox), imageFileScalingAddLabel, FALSE, FALSE, 0);
+
+  imageFileScalingAddSpinButton_adj = gtk_adjustment_new (0, -99999, 99999, 0.10000000149, 1, 0);
+  imageFileScalingAddSpinButton = gtk_spin_button_new (GTK_ADJUSTMENT (imageFileScalingAddSpinButton_adj), 1, 5);
+  gtk_widget_show (imageFileScalingAddSpinButton);
+  gtk_box_pack_start (GTK_BOX (imageFileScalingAddHbox), imageFileScalingAddSpinButton, TRUE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (imageFileScalingAddSpinButton), TRUE);
+
+  imageFileScalingMultHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (imageFileScalingMultHbox);
+  gtk_box_pack_start (GTK_BOX (imageFileScalingVbox), imageFileScalingMultHbox, TRUE, TRUE, 0);
+
+  imageFileScalingMultLabel = gtk_label_new_with_mnemonic (_("Then, _multiply each float pixel value by:   "));
+  gtk_widget_show (imageFileScalingMultLabel);
+  gtk_box_pack_start (GTK_BOX (imageFileScalingMultHbox), imageFileScalingMultLabel, FALSE, FALSE, 0);
+
+  imageFileScalingMultSpinButton_adj = gtk_adjustment_new (1, -99999, 99999, 0.0010000000475, 0.0010000000475, 0);
+  imageFileScalingMultSpinButton = gtk_spin_button_new (GTK_ADJUSTMENT (imageFileScalingMultSpinButton_adj), 1, 5);
+  gtk_widget_show (imageFileScalingMultSpinButton);
+  gtk_box_pack_start (GTK_BOX (imageFileScalingMultHbox), imageFileScalingMultSpinButton, TRUE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (imageFileScalingMultSpinButton), TRUE);
+
+  imageFileScalingMinVbox = gtk_vbox_new (FALSE, 0);
+  gtk_widget_show (imageFileScalingMinVbox);
+  gtk_box_pack_start (GTK_BOX (imageFileScalingVbox), imageFileScalingMinVbox, TRUE, TRUE, 0);
+
+  imageFileScalingMinLabel = gtk_label_new_with_mnemonic (_("Mi_nimum loaded pixel value (will be scaled to 0):"));
+  gtk_widget_show (imageFileScalingMinLabel);
+  gtk_box_pack_start (GTK_BOX (imageFileScalingMinVbox), imageFileScalingMinLabel, FALSE, FALSE, 0);
+  gtk_misc_set_alignment (GTK_MISC (imageFileScalingMinLabel), 0, 0.5);
+
+  imageFileScalingMinHbox = gtk_hbox_new (FALSE, 5);
+  gtk_widget_show (imageFileScalingMinHbox);
+  gtk_box_pack_start (GTK_BOX (imageFileScalingMinVbox), imageFileScalingMinHbox, TRUE, TRUE, 0);
+
+  imageFileScalingMinSlider = gtk_hscale_new (GTK_ADJUSTMENT (gtk_adjustment_new (0, -1024, 1024, 1, 1, 0)));
+  gtk_widget_show (imageFileScalingMinSlider);
+  gtk_box_pack_start (GTK_BOX (imageFileScalingMinHbox), imageFileScalingMinSlider, TRUE, TRUE, 0);
+  gtk_scale_set_draw_value (GTK_SCALE (imageFileScalingMinSlider), FALSE);
+  gtk_scale_set_value_pos (GTK_SCALE (imageFileScalingMinSlider), GTK_POS_LEFT);
+  gtk_scale_set_digits (GTK_SCALE (imageFileScalingMinSlider), 0);
+
+  imageFileScalingMinSpinner_adj = gtk_adjustment_new (0, -1024, 1024, 1, 2, 0);
+  imageFileScalingMinSpinner = gtk_spin_button_new (GTK_ADJUSTMENT (imageFileScalingMinSpinner_adj), 1, 1);
+  gtk_widget_show (imageFileScalingMinSpinner);
+  gtk_box_pack_start (GTK_BOX (imageFileScalingMinHbox), imageFileScalingMinSpinner, FALSE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (imageFileScalingMinSpinner), TRUE);
+
+  imageFileScalingMaxVbox = gtk_vbox_new (FALSE, 0);
+  gtk_widget_show (imageFileScalingMaxVbox);
+  gtk_box_pack_start (GTK_BOX (imageFileScalingVbox), imageFileScalingMaxVbox, TRUE, TRUE, 0);
+
+  imageFileScalingMaxLabel = gtk_label_new_with_mnemonic (_("Ma_ximum loaded pixel value (will be scaled to 255):"));
+  gtk_widget_show (imageFileScalingMaxLabel);
+  gtk_box_pack_start (GTK_BOX (imageFileScalingMaxVbox), imageFileScalingMaxLabel, FALSE, FALSE, 0);
+  gtk_misc_set_alignment (GTK_MISC (imageFileScalingMaxLabel), 0, 0.5);
+
+  imageFileScalingMaxHbox = gtk_hbox_new (FALSE, 5);
+  gtk_widget_show (imageFileScalingMaxHbox);
+  gtk_box_pack_start (GTK_BOX (imageFileScalingMaxVbox), imageFileScalingMaxHbox, TRUE, TRUE, 0);
+
+  imageFileScalingMaxSlider = gtk_hscale_new (GTK_ADJUSTMENT (gtk_adjustment_new (255, -1024, 1024, 1, 1, 0)));
+  gtk_widget_show (imageFileScalingMaxSlider);
+  gtk_box_pack_start (GTK_BOX (imageFileScalingMaxHbox), imageFileScalingMaxSlider, TRUE, TRUE, 0);
+  gtk_scale_set_draw_value (GTK_SCALE (imageFileScalingMaxSlider), FALSE);
+  gtk_scale_set_value_pos (GTK_SCALE (imageFileScalingMaxSlider), GTK_POS_LEFT);
+  gtk_scale_set_digits (GTK_SCALE (imageFileScalingMaxSlider), 0);
+
+  imageFileScalingMaxSpinner_adj = gtk_adjustment_new (255, -1024, 1024, 1, 2, 0);
+  imageFileScalingMaxSpinner = gtk_spin_button_new (GTK_ADJUSTMENT (imageFileScalingMaxSpinner_adj), 1, 1);
+  gtk_widget_show (imageFileScalingMaxSpinner);
+  gtk_box_pack_start (GTK_BOX (imageFileScalingMaxHbox), imageFileScalingMaxSpinner, FALSE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (imageFileScalingMaxSpinner), TRUE);
+
+  imageFileScalingFrameLabel = gtk_label_new (_("Pixel Value Scaling as Image File is Loaded"));
+  gtk_widget_show (imageFileScalingFrameLabel);
+  gtk_frame_set_label_widget (GTK_FRAME (imageFileScalingFrame), imageFileScalingFrameLabel);
+  gtk_label_set_use_markup (GTK_LABEL (imageFileScalingFrameLabel), TRUE);
+
+  constantSettingsVbox = gtk_vbox_new (FALSE, 6);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), constantSettingsVbox, TRUE, TRUE, 0);
+
+  constantValueHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (constantValueHbox);
+  gtk_box_pack_start (GTK_BOX (constantSettingsVbox), constantValueHbox, TRUE, TRUE, 0);
+
+  constantValueLabel = gtk_label_new_with_mnemonic (_("Input _Constant:      "));
+  gtk_widget_show (constantValueLabel);
+  gtk_box_pack_start (GTK_BOX (constantValueHbox), constantValueLabel, FALSE, FALSE, 0);
+
+  constantValueSpinButton_adj = gtk_adjustment_new (0, -99999, 99999, 0.10000000149, 1, 0);
+  constantValueSpinButton = gtk_spin_button_new (GTK_ADJUSTMENT (constantValueSpinButton_adj), 1, 3);
+  gtk_widget_show (constantValueSpinButton);
+  gtk_box_pack_start (GTK_BOX (constantValueHbox), constantValueSpinButton, TRUE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (constantValueSpinButton), TRUE);
+
+  rollingAvgSettingsVbox = gtk_vbox_new (FALSE, 6);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), rollingAvgSettingsVbox, TRUE, TRUE, 0);
+
+  rollingAvgAlphaHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (rollingAvgAlphaHbox);
+  gtk_box_pack_start (GTK_BOX (rollingAvgSettingsVbox), rollingAvgAlphaHbox, TRUE, TRUE, 0);
+
+  rollingAvgAlphaLabel = gtk_label_new_with_mnemonic (_("Memory constant _alpha:   "));
+  gtk_widget_show (rollingAvgAlphaLabel);
+  gtk_box_pack_start (GTK_BOX (rollingAvgAlphaHbox), rollingAvgAlphaLabel, FALSE, TRUE, 0);
+
+  rollingAvgAlphaSpinButton_adj = gtk_adjustment_new (0.00999999977648, 9.99999996004e-12, 999, 0.0010000000475, 0.0010000000475, 0);
+  rollingAvgAlphaSpinButton = gtk_spin_button_new (GTK_ADJUSTMENT (rollingAvgAlphaSpinButton_adj), 1, 5);
+  gtk_widget_show (rollingAvgAlphaSpinButton);
+  gtk_box_pack_start (GTK_BOX (rollingAvgAlphaHbox), rollingAvgAlphaSpinButton, FALSE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (rollingAvgAlphaSpinButton), TRUE);
+
+  rollingAvgAlphaEqualsLabel = gtk_label_new (_(" = 1 / "));
+  gtk_widget_show (rollingAvgAlphaEqualsLabel);
+  gtk_box_pack_start (GTK_BOX (rollingAvgAlphaHbox), rollingAvgAlphaEqualsLabel, FALSE, FALSE, 0);
+
+  rollingAvgAlphaDenomSpinButton_adj = gtk_adjustment_new (100, 0.0010000000475, 99999, 1, 1, 0);
+  rollingAvgAlphaDenomSpinButton = gtk_spin_button_new (GTK_ADJUSTMENT (rollingAvgAlphaDenomSpinButton_adj), 1, 4);
+  gtk_widget_show (rollingAvgAlphaDenomSpinButton);
+  gtk_box_pack_start (GTK_BOX (rollingAvgAlphaHbox), rollingAvgAlphaDenomSpinButton, FALSE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (rollingAvgAlphaDenomSpinButton), TRUE);
+
+  rollingAvgInitVbox = gtk_vbox_new (FALSE, 0);
+  gtk_widget_show (rollingAvgInitVbox);
+  gtk_box_pack_start (GTK_BOX (rollingAvgSettingsVbox), rollingAvgInitVbox, TRUE, TRUE, 0);
+
+  rollingAvgInitHbox1 = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (rollingAvgInitHbox1);
+  gtk_box_pack_start (GTK_BOX (rollingAvgInitVbox), rollingAvgInitHbox1, TRUE, TRUE, 0);
+
+  rollingAvgInitLabel1 = gtk_label_new_with_mnemonic (_("_Initial average (\"head start\") is "));
+  gtk_widget_show (rollingAvgInitLabel1);
+  gtk_box_pack_start (GTK_BOX (rollingAvgInitHbox1), rollingAvgInitLabel1, FALSE, FALSE, 0);
+
+  rollingAvgInitTypeMenu = gtk_combo_box_new_text ();
+  gtk_widget_show (rollingAvgInitTypeMenu);
+  gtk_box_pack_start (GTK_BOX (rollingAvgInitHbox1), rollingAvgInitTypeMenu, FALSE, TRUE, 0);
+  gtk_combo_box_append_text (GTK_COMBO_BOX (rollingAvgInitTypeMenu), _("straight"));
+  gtk_combo_box_append_text (GTK_COMBO_BOX (rollingAvgInitTypeMenu), _("rolling"));
+
+  rollingAvgInitLabel2 = gtk_label_new (_(" average"));
+  gtk_widget_show (rollingAvgInitLabel2);
+  gtk_box_pack_start (GTK_BOX (rollingAvgInitHbox1), rollingAvgInitLabel2, FALSE, FALSE, 0);
+
+  rollingAvgInitHbox2 = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (rollingAvgInitHbox2);
+  gtk_box_pack_start (GTK_BOX (rollingAvgInitVbox), rollingAvgInitHbox2, TRUE, TRUE, 0);
+
+  rollingAvgInitLabel3 = gtk_label_new (_("      of frames "));
+  gtk_widget_show (rollingAvgInitLabel3);
+  gtk_box_pack_start (GTK_BOX (rollingAvgInitHbox2), rollingAvgInitLabel3, FALSE, FALSE, 0);
+
+  rollingAvgInitStartSpinButton_adj = gtk_adjustment_new (1, 1, 99999, 1, 1, 0);
+  rollingAvgInitStartSpinButton = gtk_spin_button_new (GTK_ADJUSTMENT (rollingAvgInitStartSpinButton_adj), 1, 0);
+  gtk_widget_show (rollingAvgInitStartSpinButton);
+  gtk_box_pack_start (GTK_BOX (rollingAvgInitHbox2), rollingAvgInitStartSpinButton, FALSE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (rollingAvgInitStartSpinButton), TRUE);
+
+  rollingAvgInitLabel4 = gtk_label_new (_(" through "));
+  gtk_widget_show (rollingAvgInitLabel4);
+  gtk_box_pack_start (GTK_BOX (rollingAvgInitHbox2), rollingAvgInitLabel4, FALSE, FALSE, 0);
+
+  rollingAvgInitEndSpinButton_adj = gtk_adjustment_new (100, 1, 99999, 1, 1, 0);
+  rollingAvgInitEndSpinButton = gtk_spin_button_new (GTK_ADJUSTMENT (rollingAvgInitEndSpinButton_adj), 1, 0);
+  gtk_widget_show (rollingAvgInitEndSpinButton);
+  gtk_box_pack_start (GTK_BOX (rollingAvgInitHbox2), rollingAvgInitEndSpinButton, FALSE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (rollingAvgInitEndSpinButton), TRUE);
+
+  bottomSeparator = gtk_hseparator_new ();
+  gtk_widget_show (bottomSeparator);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), bottomSeparator, TRUE, TRUE, 0);
+
+  biasVbox = gtk_vbox_new (FALSE, 0);
+  gtk_widget_show (biasVbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), biasVbox, TRUE, TRUE, 0);
+
+  biasLabel = gtk_label_new_with_mnemonic (_("Integer _Bias (will be added to result of selected operation):"));
+  gtk_widget_show (biasLabel);
+  gtk_box_pack_start (GTK_BOX (biasVbox), biasLabel, FALSE, FALSE, 0);
+  gtk_misc_set_alignment (GTK_MISC (biasLabel), 0, 0.5);
+
+  biasHbox = gtk_hbox_new (FALSE, 5);
+  gtk_widget_show (biasHbox);
+  gtk_box_pack_start (GTK_BOX (biasVbox), biasHbox, TRUE, TRUE, 0);
+
+  biasSlider = gtk_hscale_new (GTK_ADJUSTMENT (gtk_adjustment_new (128, -256, 256, 1, 1, 0)));
+  gtk_widget_show (biasSlider);
+  gtk_box_pack_start (GTK_BOX (biasHbox), biasSlider, TRUE, TRUE, 0);
+  gtk_scale_set_draw_value (GTK_SCALE (biasSlider), FALSE);
+  gtk_scale_set_value_pos (GTK_SCALE (biasSlider), GTK_POS_LEFT);
+  gtk_scale_set_digits (GTK_SCALE (biasSlider), 0);
+
+  biasSpinner_adj = gtk_adjustment_new (128, -256, 256, 1, 1, 0);
+  biasSpinner = gtk_spin_button_new (GTK_ADJUSTMENT (biasSpinner_adj), 1, 0);
+  gtk_widget_show (biasSpinner);
+  gtk_box_pack_start (GTK_BOX (biasHbox), biasSpinner, FALSE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (biasSpinner), TRUE);
+
+  resultScalingFrame = gtk_frame_new (NULL);
+  gtk_widget_show (resultScalingFrame);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), resultScalingFrame, TRUE, TRUE, 0);
+  gtk_frame_set_shadow_type (GTK_FRAME (resultScalingFrame), GTK_SHADOW_IN);
+
+  resultScalingAlignment = gtk_alignment_new (0.5, 0.5, 1, 1);
+  gtk_widget_show (resultScalingAlignment);
+  gtk_container_add (GTK_CONTAINER (resultScalingFrame), resultScalingAlignment);
+  gtk_alignment_set_padding (GTK_ALIGNMENT (resultScalingAlignment), 2, 6, 6, 6);
+
+  resultScalingVbox = gtk_vbox_new (FALSE, 6);
+  gtk_widget_show (resultScalingVbox);
+  gtk_container_add (GTK_CONTAINER (resultScalingAlignment), resultScalingVbox);
+
+  resultScalingAddHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (resultScalingAddHbox);
+  gtk_box_pack_start (GTK_BOX (resultScalingVbox), resultScalingAddHbox, TRUE, TRUE, 0);
+
+  resultScalingAddLabel = gtk_label_new_with_mnemonic (_("First, _add to each pixel result value:   "));
+  gtk_widget_show (resultScalingAddLabel);
+  gtk_box_pack_start (GTK_BOX (resultScalingAddHbox), resultScalingAddLabel, FALSE, FALSE, 0);
+
+  resultScalingAddSpinButton_adj = gtk_adjustment_new (0, -99999, 99999, 0.10000000149, 1, 0);
+  resultScalingAddSpinButton = gtk_spin_button_new (GTK_ADJUSTMENT (resultScalingAddSpinButton_adj), 1, 5);
+  gtk_widget_show (resultScalingAddSpinButton);
+  gtk_box_pack_start (GTK_BOX (resultScalingAddHbox), resultScalingAddSpinButton, TRUE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (resultScalingAddSpinButton), TRUE);
+
+  resultScalingMultHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (resultScalingMultHbox);
+  gtk_box_pack_start (GTK_BOX (resultScalingVbox), resultScalingMultHbox, TRUE, TRUE, 0);
+
+  resultScalingMultLabel = gtk_label_new_with_mnemonic (_("Then, _multiply each pixel result value by:   "));
+  gtk_widget_show (resultScalingMultLabel);
+  gtk_box_pack_start (GTK_BOX (resultScalingMultHbox), resultScalingMultLabel, FALSE, FALSE, 0);
+
+  resultScalingMultSpinButton_adj = gtk_adjustment_new (1, -99999, 99999, 0.0010000000475, 0.0010000000475, 0);
+  resultScalingMultSpinButton = gtk_spin_button_new (GTK_ADJUSTMENT (resultScalingMultSpinButton_adj), 1, 5);
+  gtk_widget_show (resultScalingMultSpinButton);
+  gtk_box_pack_start (GTK_BOX (resultScalingMultHbox), resultScalingMultSpinButton, TRUE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (resultScalingMultSpinButton), TRUE);
+
+  resultScalingMinVbox = gtk_vbox_new (FALSE, 0);
+  gtk_widget_show (resultScalingMinVbox);
+  gtk_box_pack_start (GTK_BOX (resultScalingVbox), resultScalingMinVbox, TRUE, TRUE, 0);
+
+  resultScalingMinLabel = gtk_label_new_with_mnemonic (_("Mi_nimum result value (will be scaled to 0):"));
+  gtk_widget_show (resultScalingMinLabel);
+  gtk_box_pack_start (GTK_BOX (resultScalingMinVbox), resultScalingMinLabel, FALSE, FALSE, 0);
+  gtk_misc_set_alignment (GTK_MISC (resultScalingMinLabel), 0, 0.5);
+
+  resultScalingMinHbox = gtk_hbox_new (FALSE, 5);
+  gtk_widget_show (resultScalingMinHbox);
+  gtk_box_pack_start (GTK_BOX (resultScalingMinVbox), resultScalingMinHbox, TRUE, TRUE, 0);
+
+  resultScalingMinSlider = gtk_hscale_new (GTK_ADJUSTMENT (gtk_adjustment_new (0, -1024, 1024, 1, 1, 0)));
+  gtk_widget_show (resultScalingMinSlider);
+  gtk_box_pack_start (GTK_BOX (resultScalingMinHbox), resultScalingMinSlider, TRUE, TRUE, 0);
+  gtk_scale_set_draw_value (GTK_SCALE (resultScalingMinSlider), FALSE);
+  gtk_scale_set_value_pos (GTK_SCALE (resultScalingMinSlider), GTK_POS_LEFT);
+  gtk_scale_set_digits (GTK_SCALE (resultScalingMinSlider), 0);
+
+  resultScalingMinSpinner_adj = gtk_adjustment_new (0, -1024, 1024, 1, 2, 0);
+  resultScalingMinSpinner = gtk_spin_button_new (GTK_ADJUSTMENT (resultScalingMinSpinner_adj), 1, 1);
+  gtk_widget_show (resultScalingMinSpinner);
+  gtk_box_pack_start (GTK_BOX (resultScalingMinHbox), resultScalingMinSpinner, FALSE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (resultScalingMinSpinner), TRUE);
+
+  resultScalingMaxVbox = gtk_vbox_new (FALSE, 0);
+  gtk_widget_show (resultScalingMaxVbox);
+  gtk_box_pack_start (GTK_BOX (resultScalingVbox), resultScalingMaxVbox, TRUE, TRUE, 0);
+
+  resultScalingMaxLabel = gtk_label_new_with_mnemonic (_("Ma_ximum result value (will be scaled to 255):"));
+  gtk_widget_show (resultScalingMaxLabel);
+  gtk_box_pack_start (GTK_BOX (resultScalingMaxVbox), resultScalingMaxLabel, FALSE, FALSE, 0);
+  gtk_misc_set_alignment (GTK_MISC (resultScalingMaxLabel), 0, 0.5);
+
+  resultScalingMaxHbox = gtk_hbox_new (FALSE, 5);
+  gtk_widget_show (resultScalingMaxHbox);
+  gtk_box_pack_start (GTK_BOX (resultScalingMaxVbox), resultScalingMaxHbox, TRUE, TRUE, 0);
+
+  resultScalingMaxSlider = gtk_hscale_new (GTK_ADJUSTMENT (gtk_adjustment_new (255, -1024, 1024, 1, 1, 0)));
+  gtk_widget_show (resultScalingMaxSlider);
+  gtk_box_pack_start (GTK_BOX (resultScalingMaxHbox), resultScalingMaxSlider, TRUE, TRUE, 0);
+  gtk_scale_set_draw_value (GTK_SCALE (resultScalingMaxSlider), FALSE);
+  gtk_scale_set_value_pos (GTK_SCALE (resultScalingMaxSlider), GTK_POS_LEFT);
+  gtk_scale_set_digits (GTK_SCALE (resultScalingMaxSlider), 0);
+
+  resultScalingMaxSpinner_adj = gtk_adjustment_new (255, -1024, 1024, 1, 2, 0);
+  resultScalingMaxSpinner = gtk_spin_button_new (GTK_ADJUSTMENT (resultScalingMaxSpinner_adj), 1, 1);
+  gtk_widget_show (resultScalingMaxSpinner);
+  gtk_box_pack_start (GTK_BOX (resultScalingMaxHbox), resultScalingMaxSpinner, FALSE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (resultScalingMaxSpinner), TRUE);
+
+  resultScalingFrameLabel = gtk_label_new (_("Pixel Value Scaling on Result of Selected Operation"));
+  gtk_widget_show (resultScalingFrameLabel);
+  gtk_frame_set_label_widget (GTK_FRAME (resultScalingFrame), resultScalingFrameLabel);
+  gtk_label_set_use_markup (GTK_LABEL (resultScalingFrameLabel), TRUE);
+
+  hseparator2 = gtk_hseparator_new ();
+  gtk_widget_show (hseparator2);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), hseparator2, TRUE, TRUE, 0);
+
+  currentConfigDescription = gtk_label_new (_("(description of current config will go here)"));
+  gtk_widget_show (currentConfigDescription);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), currentConfigDescription, FALSE, FALSE, 0);
+  GTK_WIDGET_SET_FLAGS (currentConfigDescription, GTK_CAN_FOCUS);
+  gtk_label_set_use_markup (GTK_LABEL (currentConfigDescription), TRUE);
+  gtk_label_set_line_wrap (GTK_LABEL (currentConfigDescription), TRUE);
+  gtk_label_set_selectable (GTK_LABEL (currentConfigDescription), TRUE);
+  gtk_misc_set_alignment (GTK_MISC (currentConfigDescription), 0, 0.5);
+
+  hseparator1 = gtk_hseparator_new ();
+  gtk_widget_show (hseparator1);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), hseparator1, TRUE, TRUE, 0);
+
+  histogramHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (histogramHbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), histogramHbox, TRUE, TRUE, 0);
+
+  histogramLabel = gtk_label_new_with_mnemonic (_("_Histogram every N frames (0 to disable):   "));
+  gtk_widget_show (histogramLabel);
+  gtk_box_pack_start (GTK_BOX (histogramHbox), histogramLabel, FALSE, FALSE, 0);
+
+  histogramSpinButton_adj = gtk_adjustment_new (0, 0, 16777215, 1, 10, 0);
+  histogramSpinButton = gtk_spin_button_new (GTK_ADJUSTMENT (histogramSpinButton_adj), 1, 0);
+  gtk_widget_show (histogramSpinButton);
+  gtk_box_pack_start (GTK_BOX (histogramHbox), histogramSpinButton, TRUE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (histogramSpinButton), TRUE);
+
+  debugHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (debugHbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), debugHbox, TRUE, TRUE, 0);
+
+  debugLabel = gtk_label_new_with_mnemonic (_("_Debugging settings (bits):   "));
+  gtk_widget_show (debugLabel);
+  gtk_box_pack_start (GTK_BOX (debugHbox), debugLabel, FALSE, FALSE, 0);
+
+  debugSpinButton_adj = gtk_adjustment_new (0, 0, 16777215, 1, 10, 0);
+  debugSpinButton = gtk_spin_button_new (GTK_ADJUSTMENT (debugSpinButton_adj), 1, 0);
+  gtk_widget_show (debugSpinButton);
+  gtk_box_pack_start (GTK_BOX (debugHbox), debugSpinButton, TRUE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (debugSpinButton), TRUE);
+
+  previewVboxOuter = gtk_vbox_new (FALSE, 0);
+  gtk_widget_show (previewVboxOuter);
+  gtk_box_pack_start (GTK_BOX (dialogHbox), previewVboxOuter, FALSE, TRUE, 0);
+
+  previewFrame = gtk_frame_new (NULL);
+  gtk_widget_show (previewFrame);
+  gtk_box_pack_start (GTK_BOX (previewVboxOuter), previewFrame, FALSE, TRUE, 0);
+
+  previewAlignment = gtk_alignment_new (0.5, 0.5, 1, 1);
+  gtk_widget_show (previewAlignment);
+  gtk_container_add (GTK_CONTAINER (previewFrame), previewAlignment);
+  gtk_alignment_set_padding (GTK_ALIGNMENT (previewAlignment), 0, 8, 6, 8);
+
+  previewVbox = gtk_vbox_new (FALSE, 5);
+  gtk_widget_show (previewVbox);
+  gtk_container_add (GTK_CONTAINER (previewAlignment), previewVbox);
+
+  previewControlHbox = gtk_hbox_new (FALSE, 5);
+  gtk_widget_show (previewControlHbox);
+  gtk_box_pack_start (GTK_BOX (previewVbox), previewControlHbox, TRUE, TRUE, 0);
+
+  previewOutputMenu = gtk_combo_box_new_text ();
+  gtk_box_pack_start (GTK_BOX (previewControlHbox), previewOutputMenu, FALSE, TRUE, 0);
+  gtk_combo_box_append_text (GTK_COMBO_BOX (previewOutputMenu), _("Swiss Army Knife output"));
+  gtk_combo_box_append_text (GTK_COMBO_BOX (previewOutputMenu), _("Final output"));
+
+  previewSlider = gtk_hscale_new (GTK_ADJUSTMENT (gtk_adjustment_new (0, 0, 99, 1, 1, 0)));
+  gtk_widget_show (previewSlider);
+  gtk_box_pack_start (GTK_BOX (previewControlHbox), previewSlider, TRUE, TRUE, 0);
+  gtk_scale_set_digits (GTK_SCALE (previewSlider), 0);
+
+  previewVideo = gtk_drawing_area_new ();
+  gtk_widget_show (previewVideo);
+  gtk_box_pack_start (GTK_BOX (previewVbox), previewVideo, TRUE, TRUE, 0);
+  gtk_widget_set_size_request (previewVideo, -1, 300);
+  gtk_widget_set_events (previewVideo, GDK_BUTTON1_MOTION_MASK | GDK_BUTTON_PRESS_MASK);
+
+  previewDisabled = gtk_drawing_area_new ();
+  gtk_box_pack_start (GTK_BOX (previewVbox), previewDisabled, TRUE, TRUE, 0);
+
+  previewLabel = gtk_label_new (_("Preview"));
+  gtk_widget_show (previewLabel);
+  gtk_frame_set_label_widget (GTK_FRAME (previewFrame), previewLabel);
+
+  previewEnableButtonHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (previewEnableButtonHbox);
+  gtk_box_pack_start (GTK_BOX (previewVboxOuter), previewEnableButtonHbox, FALSE, TRUE, 5);
+
+  previewEnableButton = gtk_toggle_button_new_with_mnemonic (_("Enable Preview"));
+  gtk_widget_show (previewEnableButton);
+  gtk_box_pack_end (GTK_BOX (previewEnableButtonHbox), previewEnableButton, FALSE, FALSE, 0);
+
+  dialogButtonBox = GTK_DIALOG (swiss_army_knife_dialog)->action_area;
+  gtk_widget_show (dialogButtonBox);
+  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialogButtonBox), GTK_BUTTONBOX_END);
+
+  cancelButton = gtk_button_new_from_stock ("gtk-cancel");
+  gtk_widget_show (cancelButton);
+  gtk_dialog_add_action_widget (GTK_DIALOG (swiss_army_knife_dialog), cancelButton, GTK_RESPONSE_CANCEL);
+  GTK_WIDGET_SET_FLAGS (cancelButton, GTK_CAN_DEFAULT);
+
+  okButton = gtk_button_new_from_stock ("gtk-ok");
+  gtk_widget_show (okButton);
+  gtk_dialog_add_action_widget (GTK_DIALOG (swiss_army_knife_dialog), okButton, GTK_RESPONSE_OK);
+  GTK_WIDGET_SET_FLAGS (okButton, GTK_CAN_DEFAULT);
+
+  gtk_label_set_mnemonic_widget (GTK_LABEL (imageFileScalingAddLabel), imageFileScalingAddSpinButton);
+  gtk_label_set_mnemonic_widget (GTK_LABEL (imageFileScalingMultLabel), imageFileScalingMultSpinButton);
+  gtk_label_set_mnemonic_widget (GTK_LABEL (constantValueLabel), constantValueSpinButton);
+  gtk_label_set_mnemonic_widget (GTK_LABEL (rollingAvgAlphaLabel), rollingAvgAlphaSpinButton);
+  gtk_label_set_mnemonic_widget (GTK_LABEL (resultScalingAddLabel), resultScalingAddSpinButton);
+  gtk_label_set_mnemonic_widget (GTK_LABEL (resultScalingMultLabel), resultScalingMultSpinButton);
+  gtk_label_set_mnemonic_widget (GTK_LABEL (histogramLabel), histogramSpinButton);
+  gtk_label_set_mnemonic_widget (GTK_LABEL (debugLabel), debugSpinButton);
+
+  /* Store pointers to all widgets, for use by lookup_widget(). */
+  GLADE_HOOKUP_OBJECT_NO_REF (swiss_army_knife_dialog, swiss_army_knife_dialog, "swiss_army_knife_dialog");
+  GLADE_HOOKUP_OBJECT_NO_REF (swiss_army_knife_dialog, dialogVbox, "dialogVbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, dialogHbox, "dialogHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, allSettingsVbox, "allSettingsVbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, settingsOuterHbox, "settingsOuterHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, settingsOuterVbox, "settingsOuterVbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, operationHbox, "operationHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, operationLabel, "operationLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, operationMenu, "operationMenu");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, inputTypeHbox, "inputTypeHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, inputTypeLabel, "inputTypeLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, inputTypeMenu, "inputTypeMenu");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, topSeparator, "topSeparator");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, convolutionSettingsVbox, "convolutionSettingsVbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, convolutionInputFileHbox, "convolutionInputFileHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, convolutionInputFileLabel, "convolutionInputFileLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, convolutionInputFileChooser, "convolutionInputFileChooser");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileSettingsVbox, "imageFileSettingsVbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageInputFileHbox, "imageInputFileHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageInputFileLabel, "imageInputFileLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageInputFileChooser, "imageInputFileChooser");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileScalingFrame, "imageFileScalingFrame");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileScalingAlignment, "imageFileScalingAlignment");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileScalingVbox, "imageFileScalingVbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileScalingAddHbox, "imageFileScalingAddHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileScalingAddLabel, "imageFileScalingAddLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileScalingAddSpinButton, "imageFileScalingAddSpinButton");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileScalingMultHbox, "imageFileScalingMultHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileScalingMultLabel, "imageFileScalingMultLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileScalingMultSpinButton, "imageFileScalingMultSpinButton");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileScalingMinVbox, "imageFileScalingMinVbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileScalingMinLabel, "imageFileScalingMinLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileScalingMinHbox, "imageFileScalingMinHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileScalingMinSlider, "imageFileScalingMinSlider");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileScalingMinSpinner, "imageFileScalingMinSpinner");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileScalingMaxVbox, "imageFileScalingMaxVbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileScalingMaxLabel, "imageFileScalingMaxLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileScalingMaxHbox, "imageFileScalingMaxHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileScalingMaxSlider, "imageFileScalingMaxSlider");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileScalingMaxSpinner, "imageFileScalingMaxSpinner");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, imageFileScalingFrameLabel, "imageFileScalingFrameLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, constantSettingsVbox, "constantSettingsVbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, constantValueHbox, "constantValueHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, constantValueLabel, "constantValueLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, constantValueSpinButton, "constantValueSpinButton");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, rollingAvgSettingsVbox, "rollingAvgSettingsVbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, rollingAvgAlphaHbox, "rollingAvgAlphaHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, rollingAvgAlphaLabel, "rollingAvgAlphaLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, rollingAvgAlphaSpinButton, "rollingAvgAlphaSpinButton");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, rollingAvgAlphaEqualsLabel, "rollingAvgAlphaEqualsLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, rollingAvgAlphaDenomSpinButton, "rollingAvgAlphaDenomSpinButton");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, rollingAvgInitVbox, "rollingAvgInitVbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, rollingAvgInitHbox1, "rollingAvgInitHbox1");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, rollingAvgInitLabel1, "rollingAvgInitLabel1");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, rollingAvgInitTypeMenu, "rollingAvgInitTypeMenu");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, rollingAvgInitLabel2, "rollingAvgInitLabel2");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, rollingAvgInitHbox2, "rollingAvgInitHbox2");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, rollingAvgInitLabel3, "rollingAvgInitLabel3");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, rollingAvgInitStartSpinButton, "rollingAvgInitStartSpinButton");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, rollingAvgInitLabel4, "rollingAvgInitLabel4");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, rollingAvgInitEndSpinButton, "rollingAvgInitEndSpinButton");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, bottomSeparator, "bottomSeparator");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, biasVbox, "biasVbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, biasLabel, "biasLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, biasHbox, "biasHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, biasSlider, "biasSlider");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, biasSpinner, "biasSpinner");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, resultScalingFrame, "resultScalingFrame");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, resultScalingAlignment, "resultScalingAlignment");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, resultScalingVbox, "resultScalingVbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, resultScalingAddHbox, "resultScalingAddHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, resultScalingAddLabel, "resultScalingAddLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, resultScalingAddSpinButton, "resultScalingAddSpinButton");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, resultScalingMultHbox, "resultScalingMultHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, resultScalingMultLabel, "resultScalingMultLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, resultScalingMultSpinButton, "resultScalingMultSpinButton");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, resultScalingMinVbox, "resultScalingMinVbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, resultScalingMinLabel, "resultScalingMinLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, resultScalingMinHbox, "resultScalingMinHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, resultScalingMinSlider, "resultScalingMinSlider");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, resultScalingMinSpinner, "resultScalingMinSpinner");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, resultScalingMaxVbox, "resultScalingMaxVbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, resultScalingMaxLabel, "resultScalingMaxLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, resultScalingMaxHbox, "resultScalingMaxHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, resultScalingMaxSlider, "resultScalingMaxSlider");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, resultScalingMaxSpinner, "resultScalingMaxSpinner");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, resultScalingFrameLabel, "resultScalingFrameLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, hseparator2, "hseparator2");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, currentConfigDescription, "currentConfigDescription");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, hseparator1, "hseparator1");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, histogramHbox, "histogramHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, histogramLabel, "histogramLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, histogramSpinButton, "histogramSpinButton");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, debugHbox, "debugHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, debugLabel, "debugLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, debugSpinButton, "debugSpinButton");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, previewVboxOuter, "previewVboxOuter");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, previewFrame, "previewFrame");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, previewAlignment, "previewAlignment");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, previewVbox, "previewVbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, previewControlHbox, "previewControlHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, previewOutputMenu, "previewOutputMenu");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, previewSlider, "previewSlider");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, previewVideo, "previewVideo");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, previewDisabled, "previewDisabled");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, previewLabel, "previewLabel");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, previewEnableButtonHbox, "previewEnableButtonHbox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, previewEnableButton, "previewEnableButton");
+  GLADE_HOOKUP_OBJECT_NO_REF (swiss_army_knife_dialog, dialogButtonBox, "dialogButtonBox");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, cancelButton, "cancelButton");
+  GLADE_HOOKUP_OBJECT (swiss_army_knife_dialog, okButton, "okButton");
+
+  return swiss_army_knife_dialog;
+}
+
+#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -1,5 +1,5 @@
 /***************************************************************************
-                          ADM_guiContrast.cpp  -  description
+                          DIA_contrast.cpp  -  description
                              -------------------
     begin                : Mon Sep 23 2002
     copyright            : (C) 2002 by mean
@@ -69,7 +69,7 @@
 
         dialog=create_dialog1();
         gtk_register_dialog(dialog);
-        gtk_window_set_title (GTK_WINDOW (dialog), QT_TR_NOOP("ASHARP"));
+        gtk_window_set_title (GTK_WINDOW (dialog), QT_TR_NOOP("Contrast"));
         gtk_widget_show(dialog);	
         
           // and value changed

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_crop.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -20,14 +20,11 @@
  *                                                                         *
  ***************************************************************************/
 
-#include <config.h>
-#include <string.h>
-#include <stdio.h>
+#include "default.h"
+
 #include <gdk/gdkkeysyms.h>
 #include <gtk/gtk.h>
-#include <math.h>
 
-#include "default.h"
 #include "ADM_toolkit_gtk/toolkit_gtk.h"
 #include "ADM_toolkit_gtk/toolkit_gtk_include.h"
 #include "ADM_toolkit/toolkit.hxx"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_flyDialog.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_flyDialog.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_flyDialog.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -12,15 +12,15 @@
 *                                                                         *
 ***************************************************************************///
 
-#include "config.h"
+#include "default.h"
 
 #include <gtk/gtk.h>
 
-#include "default.h"
 #include "ADM_toolkit_gtk/toolkit_gtk.h"
 #include "ADM_toolkit_gtk/toolkit_gtk_include.h"
 #include "ADM_video/ADM_genvideo.hxx"
 #include "DIA_flyDialog.h"
+#include "DIA_factory.h"
 #include "ADM_assert.h"
 
 extern void GUI_RGBDisplay(uint8_t * dis, uint32_t w, uint32_t h, void *widg);
@@ -84,4 +84,82 @@
 	return 0; 
 }
 
+void ADM_flyDialog::setupMenus (const void * params, 
+                                const MenuMapping * menu_mapping,
+                                uint32_t menu_mapping_count)
+{
+    // Fill in menus
+
+    ADM_assert (_cookie); // should be the dialog pointer
+    GtkDialog * dialog = static_cast <GtkDialog *> (_cookie);
+
+    for (int menu_index = 0; menu_index < menu_mapping_count; menu_index++)
+    {
+        const MenuMapping & mm = menu_mapping [menu_index];
+        const uint32_t * theParam
+            = (reinterpret_cast <const uint32_t *>
+               (mm.paramOffset + reinterpret_cast <const char *> (params)));
+        // printf ("setupMenus: %s: params %p + offset 0x%x = %p\n",
+        //         mm.widgetName, params, mm.paramOffset, theParam);
+
+        GtkComboBox * combo
+            = GTK_COMBO_BOX (lookup_widget (GTK_WIDGET(dialog),
+                                            mm.widgetName));
+        int found = -1;
+        for (int item_index = 0; item_index < mm.count; item_index++)
+        {
+            gtk_combo_box_append_text (combo, mm.menu [item_index].text);
+            if (mm.menu [item_index].val == *theParam)
+            {
+                gtk_combo_box_set_active (combo, item_index);
+                found = item_index;
+            }
+        }
+
+        // printf ("setupMenus: %s: current is %d (%d)\n",
+        //         mm.widgetName, found, *theParam);
+    }
+}
+
+uint32_t ADM_flyDialog::getMenuValue (const MenuMapping * mm)
+{
+    ADM_assert (_cookie); // should be the dialog pointer
+    GtkDialog * dialog = static_cast <GtkDialog *> (_cookie);
+    GtkComboBox * combo
+        = GTK_COMBO_BOX (lookup_widget (GTK_WIDGET(dialog), mm->widgetName));
+    uint32_t currValue = gtk_combo_box_get_active (combo);
+    ADM_assert (currValue < mm->count);
+
+    return (mm->menu [currValue].val);
+}
+
+void ADM_flyDialog::getMenuValues (void * params,
+                                   const MenuMapping * menu_mapping,
+                                   uint32_t menu_mapping_count)
+{
+    for (int menu_index = 0; menu_index < menu_mapping_count; menu_index++)
+    {
+        const MenuMapping & mm = menu_mapping [menu_index];
+        uint32_t * theParam = reinterpret_cast <uint32_t *>
+                              (mm.paramOffset
+                               + reinterpret_cast <char *> (params));
+        *theParam = getMenuValue (&mm);
+    }
+}
+
+const MenuMapping *
+ADM_flyDialog::lookupMenu (const char * widgetName,
+                           const MenuMapping * menu_mapping,
+                           uint32_t menu_mapping_count)
+{
+    for (int menu_index = 0; menu_index < menu_mapping_count; menu_index++)
+    {
+        const MenuMapping * mm = menu_mapping + menu_index;
+        if (strcmp (mm->widgetName, widgetName) == 0)
+            return mm;
+    }
+
+    return 0;
+}
+
 //EOF

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_particle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_particle.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_particle.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -0,0 +1,704 @@
+/***************************************************************************
+                          DIA_particle.cpp  -  configuration dialog for
+						particle filter
+                              -------------------
+                         Chris MacGregor, September 2007
+                         chris-avidemux at bouncingdog.com
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include "default.h"
+
+#include <gtk/gtk.h>
+
+#include "fourcc.h"
+#include "avio.hxx"
+#include "prefs.h"
+
+#include "avi_vars.h"
+
+#ifdef HAVE_ENCODER
+
+#include "ADM_editor/ADM_edit.hxx"
+#include "ADM_video/ADM_genvideo.hxx"
+#include "ADM_videoFilter/ADM_vidParticle.h"
+#include "ADM_toolkit/toolkit.hxx"
+#include "ADM_toolkit_gtk/ADM_gladeSupport.h"
+#include "ADM_toolkit_gtk/toolkit_gtk.h"
+#include "ADM_toolkit_gtk/toolkit_gtk_include.h"
+#include "ADM_toolkit/filesel.h"
+#include "ADM_assert.h"
+#include "DIA_flyDialog.h"
+#include "DIA_flyParticle.h"
+#include "ADM_userInterfaces/ADM_commonUI/DIA_factory.h" // for diaElemMenu etc.
+
+/********************************************************************/
+static GtkWidget *create_particle_dialog (void);
+static GtkWidget *dialog = 0;
+
+static volatile int lock = 0;
+
+/********************************************************************/
+
+static gboolean previewButtonEvent (GtkWidget *,
+                                    GdkEventButton * event,
+                                    gpointer data)
+{
+    if (event->type != GDK_BUTTON_PRESS)
+        return FALSE;
+
+    uint32_t x = static_cast <uint32_t> (event->x);
+    uint32_t y = static_cast <uint32_t> (event->y);
+
+    flyParticle * myFly = static_cast <flyParticle *> (data);
+    ADMImage * image = event->button == 1
+        ? myFly->getInputImage() : myFly->getOutputImage();
+
+    uint32_t width = image->_width;
+    uint32_t height = image->_height;
+
+    if (x >= width || y >= height)
+        return FALSE;
+
+    uint8_t range = 3;
+    if (event->state & GDK_SHIFT_MASK)
+        range += 2;
+    if (event->state & GDK_CONTROL_MASK)
+        range += 4;
+    if (event->state & GDK_MOD1_MASK)
+        range += 6;
+
+    uint8_t halfrange = range / 2;
+
+    uint32_t xmin = (x > halfrange) ? x - halfrange : 0;
+    uint32_t ymin = (y > halfrange) ? y - halfrange : 0;
+
+    uint32_t xmax = x + halfrange;
+    uint32_t ymax = y + halfrange;
+
+    if (xmax >= width)
+        xmax = width - 1;
+    if (ymax >= height)
+        ymax = height - 1;
+
+    uint8_t * imagepix = YPLANE (image);
+
+    printf ("\n  x|");
+    for (x = xmin; x <= xmax; x++)
+        printf (" %3d", x);
+    printf ("\ny: +");
+    for (x = xmin; x <= xmax; x++)
+        printf (" ---", x);
+    printf ("\n");
+
+    for (y = ymin; y <= ymax; y++)
+    {
+        uint8_t * pixp = imagepix + (y * width) + xmin;
+        printf ("%3d|", y);
+        for (x = xmin; x <= xmax; x++)
+            printf (" %3d", *pixp++);
+        printf ("\n");
+    }
+
+    return TRUE;
+}
+
+static void frame_changed (GtkRange *, gpointer user_data)
+{
+    flyParticle * myDialog = static_cast <flyParticle *> (user_data);
+    myDialog->sliderChanged();
+}
+
+static void gui_update (GtkObject *, gpointer user_data)
+{
+    if (lock)
+        return;
+
+    flyParticle * myDialog = static_cast <flyParticle *> (user_data);
+    myDialog->getInputImage(); // refresh the input data
+    myDialog->update();
+}
+
+static gboolean gui_draw (GtkWidget * widget, GdkEventExpose * event,
+                          gpointer user_data)
+{
+    flyParticle * myDialog = static_cast <flyParticle *> (user_data);
+    myDialog->display();
+    return TRUE;
+}
+
+static void browse_button_clicked (GtkButton *, gpointer user_data)
+{
+    flyParticle * myDialog = static_cast <flyParticle *> (user_data);
+
+    // First, determine a default output file if we don't already have an
+    // output file.
+
+    const char * filename
+        = gtk_entry_get_text (GTK_ENTRY(WID(outputFileEntry)));
+    const int MAX_SEL = 2048;
+    char buffer [MAX_SEL + 1];
+    const char * lastfilename;
+    const char * defaultSuffix = "pts";
+    if ((!filename || !*filename)
+        && prefs->get (LASTFILES_FILE1, (ADM_filename **)&lastfilename))
+    {
+        strcpy (buffer, lastfilename);
+        char * cptr = buffer + strlen (buffer);
+        while (cptr > buffer)
+        {
+            if (*cptr == '.')
+            {
+                strcpy (cptr + 1, defaultSuffix);
+                filename = buffer;
+                printf ("Default output filename is %s based on %s + %s\n",
+                        filename, lastfilename, defaultSuffix);
+                break;
+            }
+            --cptr;
+        }
+    }
+    else if (!filename)
+        filename = "";
+
+    if (FileSel_SelectWrite ("Write Particle List to File",
+                             buffer, MAX_SEL, filename))
+    {
+        gtk_entry_set_text (GTK_ENTRY(WID(outputFileEntry)), buffer);
+    }
+}
+
+/********************************************************************/
+
+uint8_t DIA_particle (AVDMGenericVideoStream *in,
+                      PARTICLE_PARAM * param,
+                      const MenuMapping * menu_mapping,
+                      uint32_t menu_mapping_count)
+{
+    // Allocate space for preview video
+    uint32_t width = in->getInfo()->width;
+    uint32_t height = in->getInfo()->height;
+
+    dialog = create_particle_dialog();
+    gtk_register_dialog (dialog);
+    gtk_window_set_title (GTK_WINDOW (dialog),
+                          QT_TR_NOOP("Particle Analysis Configuration"));
+    gtk_widget_show (dialog);	
+
+    // Fix up a bunch of things that Glade can't do.  This is less efficient
+    // than just editing the Glade output, but it's not that big a deal and
+    // doing it this way makes it MUCH easier to use Glade to tweak the layout
+    // later.
+
+    // actually, nothing to fix up in this one.  But if there ever is, this is
+    // the place to do it...
+
+    flyParticle * myDialog
+        = new flyParticle (width, height, in,
+                           WID(previewVideo), WID(previewSlider),
+                           GTK_DIALOG(dialog), param,
+                           menu_mapping, menu_mapping_count);
+    myDialog->upload();
+    myDialog->sliderChanged();
+
+    g_signal_connect (GTK_OBJECT(WID(outputFileBrowseButton)), "clicked",
+                      GTK_SIGNAL_FUNC(browse_button_clicked),
+                      gpointer(myDialog));
+
+    // update things when settings are changed
+#define CNX(_widg,_signame) \
+    g_signal_connect (GTK_OBJECT(WID(_widg)), _signame,                \
+                      GTK_SIGNAL_FUNC(gui_update), gpointer(myDialog));
+
+    CNX (minAreaSpinButton, "value_changed");
+    CNX (maxAreaSpinButton, "value_changed");
+    CNX (leftCropSpinButton, "value_changed");
+    CNX (rightCropSpinButton, "value_changed");
+    CNX (topCropSpinButton, "value_changed");
+    CNX (bottomCropSpinButton, "value_changed");
+
+    g_signal_connect (GTK_OBJECT(WID(previewSlider)), "value_changed",
+                      GTK_SIGNAL_FUNC(frame_changed), gpointer(myDialog));
+    g_signal_connect (GTK_OBJECT(WID(previewVideo)), "expose_event",
+                      GTK_SIGNAL_FUNC(gui_draw), gpointer(myDialog));
+
+    g_signal_connect (GTK_OBJECT(WID(previewVideo)), "button_press_event",
+                      GTK_SIGNAL_FUNC(previewButtonEvent),
+                      gpointer(myDialog));
+#if 0
+    g_signal_connect (GTK_OBJECT(WID(previewVideo)), "motion_notify_event",
+                      GTK_SIGNAL_FUNC(previewMotionEvent),
+                      gpointer(myDialog));
+#endif
+
+    uint8_t ret = 0;
+    int response = gtk_dialog_run(GTK_DIALOG(dialog));
+
+    if (response == GTK_RESPONSE_OK)
+    {
+        myDialog->download();
+        myDialog->getParam (param);
+        ret = 1;
+    }
+
+    gtk_unregister_dialog(dialog);
+    gtk_widget_destroy(dialog);
+
+    delete myDialog;
+
+    return ret;
+}
+
+/**************************************/
+
+uint8_t flyParticle::upload (void)
+{
+    lock++;
+
+    gtk_entry_set_text (GTK_ENTRY(WID(outputFileEntry)),
+                        param.output_file.c_str());
+
+    gtk_spin_button_set_value
+        (GTK_SPIN_BUTTON(WID(minAreaSpinButton)), param.min_area);
+    gtk_spin_button_set_value
+        (GTK_SPIN_BUTTON(WID(maxAreaSpinButton)), param.max_area);
+    gtk_spin_button_set_value
+        (GTK_SPIN_BUTTON(WID(leftCropSpinButton)), param.left_crop);
+    gtk_spin_button_set_value
+        (GTK_SPIN_BUTTON(WID(rightCropSpinButton)), param.right_crop);
+    gtk_spin_button_set_value
+        (GTK_SPIN_BUTTON(WID(topCropSpinButton)), param.top_crop);
+    gtk_spin_button_set_value
+        (GTK_SPIN_BUTTON(WID(bottomCropSpinButton)), param.bottom_crop);
+
+    lock--;
+    return 1;
+}
+
+uint8_t flyParticle::download (void)
+{
+    getMenuValues();
+
+    const char * filename =
+        gtk_entry_get_text (GTK_ENTRY(WID(outputFileEntry)));
+
+    // Note that the documentation states clearly that the result of
+    // gtk_entry_get_text() must NOT be freed, modified, or stored.  This is
+    // different than gtk_file_chooser_get_filename(), which returns a pointer
+    // which must eventually be passed to g_free().
+
+    if (filename)
+        param.output_file = filename;
+    else
+        param.output_file = "";
+
+    param.min_area
+        = gtk_spin_button_get_value_as_int
+        (GTK_SPIN_BUTTON(WID(minAreaSpinButton)));
+    param.max_area
+        = gtk_spin_button_get_value_as_int
+        (GTK_SPIN_BUTTON(WID(maxAreaSpinButton)));
+    param.left_crop
+        = gtk_spin_button_get_value_as_int
+        (GTK_SPIN_BUTTON(WID(leftCropSpinButton)));
+    param.right_crop
+        = gtk_spin_button_get_value_as_int
+        (GTK_SPIN_BUTTON(WID(rightCropSpinButton)));
+    param.top_crop
+        = gtk_spin_button_get_value_as_int
+        (GTK_SPIN_BUTTON(WID(topCropSpinButton)));
+    param.bottom_crop
+        = gtk_spin_button_get_value_as_int
+        (GTK_SPIN_BUTTON(WID(bottomCropSpinButton)));
+    param.camera_number
+        = gtk_spin_button_get_value_as_int
+        (GTK_SPIN_BUTTON(WID(cameraNumberSpinButton)));
+    param.debug
+        = gtk_spin_button_get_value_as_int
+        (GTK_SPIN_BUTTON(WID(debugSpinButton)));
+
+    return 1;
+}
+
+#define _(_str) QT_TR_NOOP(_str)
+
+// The following was generated by glade from particle.glade once upon a time
+// (in fact, several times, since it took a few tries to get it right!  :-).
+// Thus far, I've avoided editing it, so regenerating the code from Glade (I
+// used 2.12.1) and swapping it in here should not lose anything.  All the
+// tweaking and adjusting and signal-connecting is done in code above, which
+// is maintained by hand, and which has some knowledge of the names and layout
+// of the widgets (so be cautious about renaming things!).
+
+GtkWidget*
+create_particle_dialog (void)
+{
+  GtkWidget *particle_dialog;
+  GtkWidget *dialogVbox;
+  GtkWidget *dialogHbox;
+  GtkWidget *allButButtonsVbox;
+  GtkWidget *settingsOuterHbox;
+  GtkWidget *settingsOuterVbox;
+  GtkWidget *minAreaHbox;
+  GtkWidget *minAreaLabel;
+  GtkObject *minAreaSpinButton_adj;
+  GtkWidget *minAreaSpinButton;
+  GtkWidget *maxAreaHbox;
+  GtkWidget *maxAreaLabel;
+  GtkObject *maxAreaSpinButton_adj;
+  GtkWidget *maxAreaSpinButton;
+  GtkWidget *aboveCropSeparator;
+  GtkWidget *leftCropHbox;
+  GtkWidget *leftCropLabel;
+  GtkObject *leftCropSpinButton_adj;
+  GtkWidget *leftCropSpinButton;
+  GtkWidget *rightCropHbox;
+  GtkWidget *rightCropLabel;
+  GtkObject *rightCropSpinButton_adj;
+  GtkWidget *rightCropSpinButton;
+  GtkWidget *topCropHbox;
+  GtkWidget *topCropLabel;
+  GtkObject *topCropSpinButton_adj;
+  GtkWidget *topCropSpinButton;
+  GtkWidget *bottomCropHbox;
+  GtkWidget *bottomCropLabel;
+  GtkObject *bottomCropSpinButton_adj;
+  GtkWidget *bottomCropSpinButton;
+  GtkWidget *belowCropSeparator;
+  GtkWidget *outputFormatHbox;
+  GtkWidget *outputFormatLabel;
+  GtkWidget *outputFormatMenu;
+  GtkWidget *outputFileHbox;
+  GtkWidget *outputFileLabel;
+  GtkWidget *outputFileEntry;
+  GtkWidget *outputFileBrowseButton;
+  GtkWidget *cameraNumberHbox;
+  GtkWidget *cameraNumberLabel;
+  GtkObject *cameraNumberSpinButton_adj;
+  GtkWidget *cameraNumberSpinButton;
+  GtkWidget *debugHbox;
+  GtkWidget *debugLabel;
+  GtkObject *debugSpinButton_adj;
+  GtkWidget *debugSpinButton;
+  GtkWidget *previewVboxOuter;
+  GtkWidget *previewFrame;
+  GtkWidget *previewAlignment;
+  GtkWidget *previewVbox;
+  GtkWidget *previewControlHbox;
+  GtkWidget *previewOutputMenu;
+  GtkWidget *previewSlider;
+  GtkWidget *previewVideo;
+  GtkWidget *previewDisabled;
+  GtkWidget *previewLabel;
+  GtkWidget *dialogButtonBox;
+  GtkWidget *cancelButton;
+  GtkWidget *okButton;
+
+  particle_dialog = gtk_dialog_new ();
+  gtk_window_set_title (GTK_WINDOW (particle_dialog), _("Particle Detection"));
+  gtk_window_set_type_hint (GTK_WINDOW (particle_dialog), GDK_WINDOW_TYPE_HINT_DIALOG);
+
+  dialogVbox = GTK_DIALOG (particle_dialog)->vbox;
+  gtk_widget_show (dialogVbox);
+
+  dialogHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (dialogHbox);
+  gtk_box_pack_start (GTK_BOX (dialogVbox), dialogHbox, TRUE, TRUE, 0);
+
+  allButButtonsVbox = gtk_vbox_new (FALSE, 12);
+  gtk_widget_show (allButButtonsVbox);
+  gtk_box_pack_start (GTK_BOX (dialogHbox), allButButtonsVbox, TRUE, TRUE, 0);
+  gtk_container_set_border_width (GTK_CONTAINER (allButButtonsVbox), 8);
+
+  settingsOuterHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (settingsOuterHbox);
+  gtk_box_pack_start (GTK_BOX (allButButtonsVbox), settingsOuterHbox, FALSE, TRUE, 0);
+
+  settingsOuterVbox = gtk_vbox_new (FALSE, 12);
+  gtk_widget_show (settingsOuterVbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterHbox), settingsOuterVbox, TRUE, TRUE, 0);
+
+  minAreaHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (minAreaHbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), minAreaHbox, TRUE, TRUE, 0);
+
+  minAreaLabel = gtk_label_new_with_mnemonic (_("Mi_nimum area for a particle to be detected:    "));
+  gtk_widget_show (minAreaLabel);
+  gtk_box_pack_start (GTK_BOX (minAreaHbox), minAreaLabel, FALSE, FALSE, 0);
+
+  minAreaSpinButton_adj = gtk_adjustment_new (5, 1, 999999, 1, 1, 0);
+  minAreaSpinButton = gtk_spin_button_new (GTK_ADJUSTMENT (minAreaSpinButton_adj), 1, 0);
+  gtk_widget_show (minAreaSpinButton);
+  gtk_box_pack_start (GTK_BOX (minAreaHbox), minAreaSpinButton, TRUE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (minAreaSpinButton), TRUE);
+
+  maxAreaHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (maxAreaHbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), maxAreaHbox, TRUE, TRUE, 0);
+
+  maxAreaLabel = gtk_label_new_with_mnemonic (_("Ma_ximum area for a particle to be detected:   "));
+  gtk_widget_show (maxAreaLabel);
+  gtk_box_pack_start (GTK_BOX (maxAreaHbox), maxAreaLabel, FALSE, FALSE, 0);
+
+  maxAreaSpinButton_adj = gtk_adjustment_new (50000, 1, 999999, 1, 1, 0);
+  maxAreaSpinButton = gtk_spin_button_new (GTK_ADJUSTMENT (maxAreaSpinButton_adj), 1, 0);
+  gtk_widget_show (maxAreaSpinButton);
+  gtk_box_pack_start (GTK_BOX (maxAreaHbox), maxAreaSpinButton, TRUE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (maxAreaSpinButton), TRUE);
+
+  aboveCropSeparator = gtk_hseparator_new ();
+  gtk_widget_show (aboveCropSeparator);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), aboveCropSeparator, TRUE, TRUE, 0);
+
+  leftCropHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (leftCropHbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), leftCropHbox, TRUE, TRUE, 0);
+
+  leftCropLabel = gtk_label_new_with_mnemonic (_("_Left side crop (ignore this many pixels on the left):        "));
+  gtk_widget_show (leftCropLabel);
+  gtk_box_pack_start (GTK_BOX (leftCropHbox), leftCropLabel, FALSE, FALSE, 0);
+
+  leftCropSpinButton_adj = gtk_adjustment_new (0, 0, 2048, 1, 1, 0);
+  leftCropSpinButton = gtk_spin_button_new (GTK_ADJUSTMENT (leftCropSpinButton_adj), 1, 0);
+  gtk_widget_show (leftCropSpinButton);
+  gtk_box_pack_start (GTK_BOX (leftCropHbox), leftCropSpinButton, TRUE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (leftCropSpinButton), TRUE);
+
+  rightCropHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (rightCropHbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), rightCropHbox, TRUE, TRUE, 0);
+
+  rightCropLabel = gtk_label_new_with_mnemonic (_("_Right side crop (ignore this many pixels on the right):     "));
+  gtk_widget_show (rightCropLabel);
+  gtk_box_pack_start (GTK_BOX (rightCropHbox), rightCropLabel, FALSE, FALSE, 0);
+
+  rightCropSpinButton_adj = gtk_adjustment_new (0, 0, 2048, 1, 1, 0);
+  rightCropSpinButton = gtk_spin_button_new (GTK_ADJUSTMENT (rightCropSpinButton_adj), 1, 0);
+  gtk_widget_show (rightCropSpinButton);
+  gtk_box_pack_start (GTK_BOX (rightCropHbox), rightCropSpinButton, TRUE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (rightCropSpinButton), TRUE);
+
+  topCropHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (topCropHbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), topCropHbox, TRUE, TRUE, 0);
+
+  topCropLabel = gtk_label_new_with_mnemonic (_("_Top crop (ignore this many pixels on the top):                  "));
+  gtk_widget_show (topCropLabel);
+  gtk_box_pack_start (GTK_BOX (topCropHbox), topCropLabel, FALSE, FALSE, 0);
+
+  topCropSpinButton_adj = gtk_adjustment_new (0, 0, 2048, 1, 1, 0);
+  topCropSpinButton = gtk_spin_button_new (GTK_ADJUSTMENT (topCropSpinButton_adj), 1, 0);
+  gtk_widget_show (topCropSpinButton);
+  gtk_box_pack_start (GTK_BOX (topCropHbox), topCropSpinButton, TRUE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (topCropSpinButton), TRUE);
+
+  bottomCropHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (bottomCropHbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), bottomCropHbox, TRUE, TRUE, 0);
+
+  bottomCropLabel = gtk_label_new_with_mnemonic (_("_Bottom crop (ignore this many pixels on the bottom):   "));
+  gtk_widget_show (bottomCropLabel);
+  gtk_box_pack_start (GTK_BOX (bottomCropHbox), bottomCropLabel, FALSE, FALSE, 0);
+
+  bottomCropSpinButton_adj = gtk_adjustment_new (0, 0, 2048, 1, 1, 0);
+  bottomCropSpinButton = gtk_spin_button_new (GTK_ADJUSTMENT (bottomCropSpinButton_adj), 1, 0);
+  gtk_widget_show (bottomCropSpinButton);
+  gtk_box_pack_start (GTK_BOX (bottomCropHbox), bottomCropSpinButton, TRUE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (bottomCropSpinButton), TRUE);
+
+  belowCropSeparator = gtk_hseparator_new ();
+  gtk_widget_show (belowCropSeparator);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), belowCropSeparator, TRUE, TRUE, 0);
+
+  outputFormatHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (outputFormatHbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), outputFormatHbox, TRUE, TRUE, 0);
+
+  outputFormatLabel = gtk_label_new_with_mnemonic (_("Output _Format:   "));
+  gtk_widget_show (outputFormatLabel);
+  gtk_box_pack_start (GTK_BOX (outputFormatHbox), outputFormatLabel, FALSE, FALSE, 0);
+
+  outputFormatMenu = gtk_combo_box_new_text ();
+  gtk_widget_show (outputFormatMenu);
+  gtk_box_pack_start (GTK_BOX (outputFormatHbox), outputFormatMenu, TRUE, TRUE, 0);
+
+  outputFileHbox = gtk_hbox_new (FALSE, 5);
+  gtk_widget_show (outputFileHbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), outputFileHbox, TRUE, TRUE, 0);
+
+  outputFileLabel = gtk_label_new_with_mnemonic (_("_Output File:"));
+  gtk_widget_show (outputFileLabel);
+  gtk_box_pack_start (GTK_BOX (outputFileHbox), outputFileLabel, FALSE, FALSE, 0);
+
+  outputFileEntry = gtk_entry_new ();
+  gtk_widget_show (outputFileEntry);
+  gtk_box_pack_start (GTK_BOX (outputFileHbox), outputFileEntry, TRUE, TRUE, 0);
+  gtk_entry_set_invisible_char (GTK_ENTRY (outputFileEntry), 8226);
+  gtk_entry_set_width_chars (GTK_ENTRY (outputFileEntry), 40);
+
+  outputFileBrowseButton = gtk_button_new_with_mnemonic (_("_Browse..."));
+  gtk_widget_show (outputFileBrowseButton);
+  gtk_box_pack_start (GTK_BOX (outputFileHbox), outputFileBrowseButton, FALSE, FALSE, 0);
+
+  cameraNumberHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (cameraNumberHbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), cameraNumberHbox, TRUE, TRUE, 0);
+
+  cameraNumberLabel = gtk_label_new_with_mnemonic (_("_Camera Number for output file:      "));
+  gtk_widget_show (cameraNumberLabel);
+  gtk_box_pack_start (GTK_BOX (cameraNumberHbox), cameraNumberLabel, FALSE, FALSE, 0);
+
+  cameraNumberSpinButton_adj = gtk_adjustment_new (1, 0, 99999, 1, 1, 0);
+  cameraNumberSpinButton = gtk_spin_button_new (GTK_ADJUSTMENT (cameraNumberSpinButton_adj), 1, 0);
+  gtk_widget_show (cameraNumberSpinButton);
+  gtk_box_pack_start (GTK_BOX (cameraNumberHbox), cameraNumberSpinButton, TRUE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (cameraNumberSpinButton), TRUE);
+
+  debugHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (debugHbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), debugHbox, TRUE, TRUE, 0);
+
+  debugLabel = gtk_label_new_with_mnemonic (_("_Debugging settings (bits):   "));
+  gtk_widget_show (debugLabel);
+  gtk_box_pack_start (GTK_BOX (debugHbox), debugLabel, FALSE, FALSE, 0);
+
+  debugSpinButton_adj = gtk_adjustment_new (0, 0, 16777215, 1, 10, 0);
+  debugSpinButton = gtk_spin_button_new (GTK_ADJUSTMENT (debugSpinButton_adj), 1, 0);
+  gtk_widget_show (debugSpinButton);
+  gtk_box_pack_start (GTK_BOX (debugHbox), debugSpinButton, TRUE, TRUE, 0);
+  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (debugSpinButton), TRUE);
+
+  previewVboxOuter = gtk_vbox_new (FALSE, 0);
+  gtk_widget_show (previewVboxOuter);
+  gtk_box_pack_start (GTK_BOX (allButButtonsVbox), previewVboxOuter, TRUE, TRUE, 0);
+
+  previewFrame = gtk_frame_new (NULL);
+  gtk_widget_show (previewFrame);
+  gtk_box_pack_start (GTK_BOX (previewVboxOuter), previewFrame, FALSE, TRUE, 0);
+
+  previewAlignment = gtk_alignment_new (0.5, 0.5, 1, 1);
+  gtk_widget_show (previewAlignment);
+  gtk_container_add (GTK_CONTAINER (previewFrame), previewAlignment);
+  gtk_alignment_set_padding (GTK_ALIGNMENT (previewAlignment), 0, 8, 6, 8);
+
+  previewVbox = gtk_vbox_new (FALSE, 5);
+  gtk_widget_show (previewVbox);
+  gtk_container_add (GTK_CONTAINER (previewAlignment), previewVbox);
+
+  previewControlHbox = gtk_hbox_new (FALSE, 5);
+  gtk_widget_show (previewControlHbox);
+  gtk_box_pack_start (GTK_BOX (previewVbox), previewControlHbox, TRUE, TRUE, 0);
+
+  previewOutputMenu = gtk_combo_box_new_text ();
+  gtk_box_pack_start (GTK_BOX (previewControlHbox), previewOutputMenu, FALSE, TRUE, 0);
+  gtk_combo_box_append_text (GTK_COMBO_BOX (previewOutputMenu), _("Swiss Army Knife output"));
+  gtk_combo_box_append_text (GTK_COMBO_BOX (previewOutputMenu), _("Final output"));
+
+  previewSlider = gtk_hscale_new (GTK_ADJUSTMENT (gtk_adjustment_new (0, 0, 99, 1, 1, 0)));
+  gtk_widget_show (previewSlider);
+  gtk_box_pack_start (GTK_BOX (previewControlHbox), previewSlider, TRUE, TRUE, 0);
+  gtk_scale_set_digits (GTK_SCALE (previewSlider), 0);
+
+  previewVideo = gtk_drawing_area_new ();
+  gtk_widget_show (previewVideo);
+  gtk_box_pack_start (GTK_BOX (previewVbox), previewVideo, TRUE, TRUE, 0);
+  gtk_widget_set_size_request (previewVideo, -1, 300);
+  gtk_widget_set_events (previewVideo, GDK_BUTTON1_MOTION_MASK | GDK_BUTTON_PRESS_MASK);
+
+  previewDisabled = gtk_drawing_area_new ();
+  gtk_box_pack_start (GTK_BOX (previewVbox), previewDisabled, TRUE, TRUE, 0);
+
+  previewLabel = gtk_label_new (_("Preview"));
+  gtk_widget_show (previewLabel);
+  gtk_frame_set_label_widget (GTK_FRAME (previewFrame), previewLabel);
+
+  dialogButtonBox = GTK_DIALOG (particle_dialog)->action_area;
+  gtk_widget_show (dialogButtonBox);
+  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialogButtonBox), GTK_BUTTONBOX_END);
+
+  cancelButton = gtk_button_new_from_stock ("gtk-cancel");
+  gtk_widget_show (cancelButton);
+  gtk_dialog_add_action_widget (GTK_DIALOG (particle_dialog), cancelButton, GTK_RESPONSE_CANCEL);
+  GTK_WIDGET_SET_FLAGS (cancelButton, GTK_CAN_DEFAULT);
+
+  okButton = gtk_button_new_from_stock ("gtk-ok");
+  gtk_widget_show (okButton);
+  gtk_dialog_add_action_widget (GTK_DIALOG (particle_dialog), okButton, GTK_RESPONSE_OK);
+  GTK_WIDGET_SET_FLAGS (okButton, GTK_CAN_DEFAULT);
+
+  gtk_label_set_mnemonic_widget (GTK_LABEL (minAreaLabel), minAreaSpinButton);
+  gtk_label_set_mnemonic_widget (GTK_LABEL (maxAreaLabel), maxAreaSpinButton);
+  gtk_label_set_mnemonic_widget (GTK_LABEL (leftCropLabel), leftCropSpinButton);
+  gtk_label_set_mnemonic_widget (GTK_LABEL (rightCropLabel), rightCropSpinButton);
+  gtk_label_set_mnemonic_widget (GTK_LABEL (topCropLabel), topCropSpinButton);
+  gtk_label_set_mnemonic_widget (GTK_LABEL (bottomCropLabel), bottomCropSpinButton);
+  gtk_label_set_mnemonic_widget (GTK_LABEL (outputFileLabel), outputFileEntry);
+  gtk_label_set_mnemonic_widget (GTK_LABEL (cameraNumberLabel), cameraNumberSpinButton);
+  gtk_label_set_mnemonic_widget (GTK_LABEL (debugLabel), debugSpinButton);
+
+  /* Store pointers to all widgets, for use by lookup_widget(). */
+  GLADE_HOOKUP_OBJECT_NO_REF (particle_dialog, particle_dialog, "particle_dialog");
+  GLADE_HOOKUP_OBJECT_NO_REF (particle_dialog, dialogVbox, "dialogVbox");
+  GLADE_HOOKUP_OBJECT (particle_dialog, dialogHbox, "dialogHbox");
+  GLADE_HOOKUP_OBJECT (particle_dialog, allButButtonsVbox, "allButButtonsVbox");
+  GLADE_HOOKUP_OBJECT (particle_dialog, settingsOuterHbox, "settingsOuterHbox");
+  GLADE_HOOKUP_OBJECT (particle_dialog, settingsOuterVbox, "settingsOuterVbox");
+  GLADE_HOOKUP_OBJECT (particle_dialog, minAreaHbox, "minAreaHbox");
+  GLADE_HOOKUP_OBJECT (particle_dialog, minAreaLabel, "minAreaLabel");
+  GLADE_HOOKUP_OBJECT (particle_dialog, minAreaSpinButton, "minAreaSpinButton");
+  GLADE_HOOKUP_OBJECT (particle_dialog, maxAreaHbox, "maxAreaHbox");
+  GLADE_HOOKUP_OBJECT (particle_dialog, maxAreaLabel, "maxAreaLabel");
+  GLADE_HOOKUP_OBJECT (particle_dialog, maxAreaSpinButton, "maxAreaSpinButton");
+  GLADE_HOOKUP_OBJECT (particle_dialog, aboveCropSeparator, "aboveCropSeparator");
+  GLADE_HOOKUP_OBJECT (particle_dialog, leftCropHbox, "leftCropHbox");
+  GLADE_HOOKUP_OBJECT (particle_dialog, leftCropLabel, "leftCropLabel");
+  GLADE_HOOKUP_OBJECT (particle_dialog, leftCropSpinButton, "leftCropSpinButton");
+  GLADE_HOOKUP_OBJECT (particle_dialog, rightCropHbox, "rightCropHbox");
+  GLADE_HOOKUP_OBJECT (particle_dialog, rightCropLabel, "rightCropLabel");
+  GLADE_HOOKUP_OBJECT (particle_dialog, rightCropSpinButton, "rightCropSpinButton");
+  GLADE_HOOKUP_OBJECT (particle_dialog, topCropHbox, "topCropHbox");
+  GLADE_HOOKUP_OBJECT (particle_dialog, topCropLabel, "topCropLabel");
+  GLADE_HOOKUP_OBJECT (particle_dialog, topCropSpinButton, "topCropSpinButton");
+  GLADE_HOOKUP_OBJECT (particle_dialog, bottomCropHbox, "bottomCropHbox");
+  GLADE_HOOKUP_OBJECT (particle_dialog, bottomCropLabel, "bottomCropLabel");
+  GLADE_HOOKUP_OBJECT (particle_dialog, bottomCropSpinButton, "bottomCropSpinButton");
+  GLADE_HOOKUP_OBJECT (particle_dialog, belowCropSeparator, "belowCropSeparator");
+  GLADE_HOOKUP_OBJECT (particle_dialog, outputFormatHbox, "outputFormatHbox");
+  GLADE_HOOKUP_OBJECT (particle_dialog, outputFormatLabel, "outputFormatLabel");
+  GLADE_HOOKUP_OBJECT (particle_dialog, outputFormatMenu, "outputFormatMenu");
+  GLADE_HOOKUP_OBJECT (particle_dialog, outputFileHbox, "outputFileHbox");
+  GLADE_HOOKUP_OBJECT (particle_dialog, outputFileLabel, "outputFileLabel");
+  GLADE_HOOKUP_OBJECT (particle_dialog, outputFileEntry, "outputFileEntry");
+  GLADE_HOOKUP_OBJECT (particle_dialog, outputFileBrowseButton, "outputFileBrowseButton");
+  GLADE_HOOKUP_OBJECT (particle_dialog, cameraNumberHbox, "cameraNumberHbox");
+  GLADE_HOOKUP_OBJECT (particle_dialog, cameraNumberLabel, "cameraNumberLabel");
+  GLADE_HOOKUP_OBJECT (particle_dialog, cameraNumberSpinButton, "cameraNumberSpinButton");
+  GLADE_HOOKUP_OBJECT (particle_dialog, debugHbox, "debugHbox");
+  GLADE_HOOKUP_OBJECT (particle_dialog, debugLabel, "debugLabel");
+  GLADE_HOOKUP_OBJECT (particle_dialog, debugSpinButton, "debugSpinButton");
+  GLADE_HOOKUP_OBJECT (particle_dialog, previewVboxOuter, "previewVboxOuter");
+  GLADE_HOOKUP_OBJECT (particle_dialog, previewFrame, "previewFrame");
+  GLADE_HOOKUP_OBJECT (particle_dialog, previewAlignment, "previewAlignment");
+  GLADE_HOOKUP_OBJECT (particle_dialog, previewVbox, "previewVbox");
+  GLADE_HOOKUP_OBJECT (particle_dialog, previewControlHbox, "previewControlHbox");
+  GLADE_HOOKUP_OBJECT (particle_dialog, previewOutputMenu, "previewOutputMenu");
+  GLADE_HOOKUP_OBJECT (particle_dialog, previewSlider, "previewSlider");
+  GLADE_HOOKUP_OBJECT (particle_dialog, previewVideo, "previewVideo");
+  GLADE_HOOKUP_OBJECT (particle_dialog, previewDisabled, "previewDisabled");
+  GLADE_HOOKUP_OBJECT (particle_dialog, previewLabel, "previewLabel");
+  GLADE_HOOKUP_OBJECT_NO_REF (particle_dialog, dialogButtonBox, "dialogButtonBox");
+  GLADE_HOOKUP_OBJECT (particle_dialog, cancelButton, "cancelButton");
+  GLADE_HOOKUP_OBJECT (particle_dialog, okButton, "okButton");
+
+  return particle_dialog;
+}
+
+#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_properties.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -1,20 +1,13 @@
 /*
- * DO NOT EDIT THIS FILE - it is generated by Glade.
+ * This file was generated by Glade, once upon a time.
  */
 
+#include "default.h"
 
-
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <unistd.h>
-#include <string.h>
-#include <stdio.h>
 #include <math.h>
 
 #include <gdk/gdkkeysyms.h>
 #include <gtk/gtk.h>
-#include "config.h"
-#include "default.h"
 
 #include "ADM_toolkit_gtk/ADM_gladeSupport.h"
 #include "ADM_toolkit/toolkit.hxx"

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_threshold.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_threshold.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_threshold.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -0,0 +1,475 @@
+/***************************************************************************
+                          DIA_threshold.cpp  -  configuration dialog for
+						threshold filter
+                              -------------------
+                         Chris MacGregor, September 2007
+                         chris-avidemux at bouncingdog.com
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include "default.h"
+
+#include <gtk/gtk.h>
+
+#include "fourcc.h"
+#include "avio.hxx"
+
+#include "avi_vars.h"
+
+#ifdef HAVE_ENCODER
+
+#include "ADM_editor/ADM_edit.hxx"
+#include "ADM_video/ADM_genvideo.hxx"
+#include "ADM_videoFilter/ADM_vidThreshold.h"
+#include "ADM_toolkit/toolkit.hxx"
+#include "ADM_toolkit_gtk/ADM_gladeSupport.h"
+#include "ADM_toolkit_gtk/toolkit_gtk.h"
+#include "ADM_toolkit_gtk/toolkit_gtk_include.h"
+#include "ADM_assert.h"
+#include "DIA_flyDialog.h"
+#include "DIA_flyThreshold.h"
+
+/********************************************************************/
+static GtkWidget *create_threshold_dialog (void);
+static GtkWidget *dialog = 0;
+
+static gboolean gui_draw (GtkWidget * widget,
+			  GdkEventExpose * event, gpointer user_data);
+static void gui_update (GtkButton * button, gpointer user_data);
+static void frame_changed (void);
+
+static volatile int lock = 0;
+static flyThreshold * myDialog = 0;
+
+/********************************************************************/
+
+static gboolean previewButtonEvent (GtkWidget * widget,
+                                    GdkEventButton * event,
+                                    gpointer data)
+{
+    if (event->type != GDK_BUTTON_PRESS)
+        return FALSE;
+
+    uint32_t x = static_cast <uint32_t> (event->x);
+    uint32_t y = static_cast <uint32_t> (event->y);
+
+    flyThreshold * myFly = static_cast <flyThreshold *> (data);
+    ADMImage * image = event->button == 1
+        ? myFly->getInputImage() : myFly->getOutputImage();
+
+    uint32_t width = image->_width;
+    uint32_t height = image->_height;
+
+    if (x >= width || y >= height)
+        return FALSE;
+
+    uint8_t range = 3;
+    if (event->state & GDK_SHIFT_MASK)
+        range += 2;
+    if (event->state & GDK_CONTROL_MASK)
+        range += 4;
+    if (event->state & GDK_MOD1_MASK)
+        range += 6;
+
+    uint8_t halfrange = range / 2;
+
+    uint32_t xmin = (x > halfrange) ? x - halfrange : 0;
+    uint32_t ymin = (y > halfrange) ? y - halfrange : 0;
+
+    uint32_t xmax = x + halfrange;
+    uint32_t ymax = y + halfrange;
+
+    if (xmax >= width)
+        xmax = width - 1;
+    if (ymax >= height)
+        ymax = height - 1;
+
+    uint8_t * imagepix = YPLANE (image);
+
+    printf ("\n  x|");
+    for (x = xmin; x <= xmax; x++)
+        printf (" %3d", x);
+    printf ("\ny: +");
+    for (x = xmin; x <= xmax; x++)
+        printf (" ---", x);
+    printf ("\n");
+
+    for (y = ymin; y <= ymax; y++)
+    {
+        uint8_t * pixp = imagepix + (y * width) + xmin;
+        printf ("%3d|", y);
+        for (x = xmin; x <= xmax; x++)
+            printf (" %3d", *pixp++);
+        printf ("\n");
+    }
+
+    return TRUE;
+}
+
+/********************************************************************/
+
+uint8_t DIA_threshold (AVDMGenericVideoStream *in, THRESHOLD_PARAM * param)
+{
+    // Allocate space for preview video
+    uint32_t width = in->getInfo()->width;
+    uint32_t height = in->getInfo()->height;
+
+    dialog = create_threshold_dialog();
+    gtk_register_dialog(dialog);
+    gtk_window_set_title (GTK_WINDOW (dialog),
+                          QT_TR_NOOP("Threshold Configuration"));
+    gtk_widget_show(dialog);
+
+    myDialog = new flyThreshold (width, height, in,
+                                 WID(previewVideo), WID(previewSlider),
+                                 param);
+    myDialog->upload();
+    myDialog->sliderChanged();
+
+    // update things when settings are changed
+#define CNX(_widg,_signame) \
+    g_signal_connect(GTK_OBJECT(WID(_widg)), _signame,                \
+                     GTK_SIGNAL_FUNC(gui_update), (void *) (1));
+
+//    CNX (minValueSlider, "drag_data_received");
+    CNX (minValueSpinner, "value_changed");
+
+//    CNX (maxValueSlider, "drag_data_received");
+    CNX (maxValueSpinner, "value_changed");
+      
+    CNX (outputValuesMenu, "changed");
+
+    g_signal_connect(GTK_OBJECT(WID(previewSlider)), "value_changed",
+                     GTK_SIGNAL_FUNC(frame_changed), 0);
+    g_signal_connect(GTK_OBJECT(WID(previewVideo)), "expose_event",
+                     GTK_SIGNAL_FUNC(gui_draw), 0);
+
+    g_signal_connect(GTK_OBJECT(WID(previewVideo)), "button_press_event",
+                     GTK_SIGNAL_FUNC(previewButtonEvent),
+                     gpointer(myDialog));
+#if 0
+    g_signal_connect(GTK_OBJECT(WID(previewVideo)), "motion_notify_event",
+                     GTK_SIGNAL_FUNC(previewMotionEvent),
+                     gpointer(myDialog));
+#endif
+
+    uint8_t ret = 0;
+    int response = gtk_dialog_run(GTK_DIALOG(dialog));
+
+    if (response == GTK_RESPONSE_OK)
+    {
+        myDialog->download();
+        myDialog->getParam (param);
+        ret = 1;
+    }
+
+    gtk_unregister_dialog(dialog);
+    gtk_widget_destroy(dialog);
+
+    delete myDialog;
+
+    return ret;
+}
+
+void frame_changed (void)
+{
+    myDialog->sliderChanged();
+}
+
+void gui_update (GtkButton * button, gpointer user_data)
+{
+    if (lock)
+        return;
+
+    myDialog->update();
+}
+
+gboolean gui_draw (GtkWidget * widget, GdkEventExpose * event, gpointer user_data)
+{
+    myDialog->display();
+    return TRUE;
+}
+
+/**************************************/
+
+uint8_t flyThreshold::upload (void)
+{
+    lock++;
+
+    gtk_spin_button_set_value (GTK_SPIN_BUTTON(WID(minValueSpinner)), param.min);
+    gtk_spin_button_set_value (GTK_SPIN_BUTTON(WID(maxValueSpinner)), param.max);
+    gtk_spin_button_set_value (GTK_SPIN_BUTTON(WID(debugSpinButton)), param.debug);
+    gtk_combo_box_set_active (GTK_COMBO_BOX(WID(outputValuesMenu)),
+                              param.in_range_is_white);
+
+    lock--;
+    return 1;
+}
+
+uint8_t flyThreshold::download (void)
+{
+    param.min = gtk_spin_button_get_value_as_int (GTK_SPIN_BUTTON (WID(minValueSpinner)));
+    param.max = gtk_spin_button_get_value_as_int (GTK_SPIN_BUTTON (WID(maxValueSpinner)));
+    param.debug = gtk_spin_button_get_value_as_int (GTK_SPIN_BUTTON (WID(debugSpinButton)));
+    param.in_range_is_white
+        = gtk_combo_box_get_active (GTK_COMBO_BOX(WID(outputValuesMenu)));
+
+    return 1;
+}
+
+#define _(_str) QT_TR_NOOP(_str)
+
+// The following was generated by glade once upon a time.  It has since been
+// tweaked by hand (to share the GtkAdjustment objects between the spinbutton
+// and hscale, for instance), so beware...
+
+GtkWidget*
+create_threshold_dialog (void)
+{
+  GtkWidget *threshold_dialog;
+  GtkWidget *dialogVbox;
+  GtkWidget *allButButtonsVbox;
+  GtkWidget *settingsOuterHbox;
+  GtkWidget *settingsOuterVbox;
+  GtkWidget *minValueVbox;
+  GtkWidget *minValueLabel;
+  GtkWidget *minValueHbox;
+  GtkWidget *minValueSlider;
+  GtkObject *minValueSpinner_adj;
+  GtkWidget *minValueSpinner;
+  GtkWidget *maxValueVbox;
+  GtkWidget *maxValueLabel;
+  GtkWidget *maxValueHbox;
+  GtkWidget *maxValueSlider;
+  GtkObject *maxValueSpinner_adj;
+  GtkWidget *maxValueSpinner;
+  GtkWidget *outputValuesHbox;
+  GtkWidget *outputValuesLabel;
+  GtkWidget *outputValuesMenu;
+  GtkWidget *debugHbox;
+  GtkWidget *debugLabel;
+  GtkObject *debugSpinButton_adj;
+  GtkWidget *debugSpinButton;
+  GtkWidget *previewFrame;
+  GtkWidget *previewAlignment;
+  GtkWidget *previewVbox;
+  GtkWidget *previewControlHbox;
+  GtkWidget *previewOutputMenu;
+  GtkWidget *previewSlider;
+  GtkWidget *previewVideo;
+  GtkWidget *previewLabel;
+  GtkWidget *dialogButtonBox;
+  GtkWidget *cancelButton;
+  GtkWidget *okButton;
+
+  threshold_dialog = gtk_dialog_new ();
+  gtk_window_set_title (GTK_WINDOW (threshold_dialog), _("Threshold"));
+  gtk_window_set_type_hint (GTK_WINDOW (threshold_dialog), GDK_WINDOW_TYPE_HINT_DIALOG);
+
+  dialogVbox = GTK_DIALOG (threshold_dialog)->vbox;
+  gtk_widget_show (dialogVbox);
+
+  allButButtonsVbox = gtk_vbox_new (FALSE, 12);
+  gtk_widget_show (allButButtonsVbox);
+  gtk_box_pack_start (GTK_BOX (dialogVbox), allButButtonsVbox, TRUE, TRUE, 0);
+
+  settingsOuterHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (settingsOuterHbox);
+  gtk_box_pack_start (GTK_BOX (allButButtonsVbox), settingsOuterHbox, FALSE, TRUE, 0);
+
+  settingsOuterVbox = gtk_vbox_new (FALSE, 12);
+  gtk_widget_show (settingsOuterVbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterHbox), settingsOuterVbox, TRUE, TRUE, 0);
+
+  minValueVbox = gtk_vbox_new (FALSE, 0);
+  gtk_widget_show (minValueVbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), minValueVbox, FALSE, FALSE, 0);
+
+  minValueLabel = gtk_label_new (_("Minimum value to be in-range:"));
+  gtk_widget_show (minValueLabel);
+  gtk_box_pack_start (GTK_BOX (minValueVbox), minValueLabel, FALSE, FALSE, 0);
+  gtk_misc_set_alignment (GTK_MISC (minValueLabel), 0.5, 1);
+  gtk_misc_set_padding (GTK_MISC (minValueLabel), 0, 8);
+
+  minValueHbox = gtk_hbox_new (FALSE, 5);
+  gtk_widget_show (minValueHbox);
+  gtk_box_pack_start (GTK_BOX (minValueVbox), minValueHbox, TRUE, TRUE, 0);
+
+#ifdef ORIGINAL_CODE_GENERATED_BY_GLADE
+  minValueSlider = gtk_hscale_new (GTK_ADJUSTMENT (gtk_adjustment_new (0, 0, 255, 1, 1, 0)));
+#else
+  minValueSpinner_adj = gtk_adjustment_new (0, 0, 255, 1, 1, 0);
+  minValueSlider = gtk_hscale_new (GTK_ADJUSTMENT (minValueSpinner_adj));
+#endif
+  gtk_widget_show (minValueSlider);
+  gtk_box_pack_start (GTK_BOX (minValueHbox), minValueSlider, TRUE, TRUE, 0);
+  gtk_scale_set_draw_value (GTK_SCALE (minValueSlider), FALSE);
+  gtk_scale_set_value_pos (GTK_SCALE (minValueSlider), GTK_POS_LEFT);
+  gtk_scale_set_digits (GTK_SCALE (minValueSlider), 0);
+
+#ifdef ORIGINAL_CODE_GENERATED_BY_GLADE
+  minValueSpinner_adj = gtk_adjustment_new (0, 0, 255, 1, 10, 10);
+#endif
+  minValueSpinner = gtk_spin_button_new (GTK_ADJUSTMENT (minValueSpinner_adj), 1, 0);
+  gtk_widget_show (minValueSpinner);
+  gtk_box_pack_start (GTK_BOX (minValueHbox), minValueSpinner, FALSE, TRUE, 0);
+
+  maxValueVbox = gtk_vbox_new (FALSE, 0);
+  gtk_widget_show (maxValueVbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), maxValueVbox, FALSE, FALSE, 0);
+
+  maxValueLabel = gtk_label_new (_("Maximum value to be in-range:"));
+  gtk_widget_show (maxValueLabel);
+  gtk_box_pack_start (GTK_BOX (maxValueVbox), maxValueLabel, FALSE, FALSE, 0);
+
+  maxValueHbox = gtk_hbox_new (FALSE, 5);
+  gtk_widget_show (maxValueHbox);
+  gtk_box_pack_start (GTK_BOX (maxValueVbox), maxValueHbox, TRUE, TRUE, 0);
+
+#ifdef ORIGINAL_CODE_GENERATED_BY_GLADE
+  maxValueSlider = gtk_hscale_new (GTK_ADJUSTMENT (gtk_adjustment_new (255, 0, 255, 1, 1, 0)));
+#else
+  maxValueSpinner_adj = gtk_adjustment_new (255, 0, 255, 1, 1, 0);
+  maxValueSlider = gtk_hscale_new (GTK_ADJUSTMENT (maxValueSpinner_adj));
+#endif
+  gtk_widget_show (maxValueSlider);
+  gtk_box_pack_start (GTK_BOX (maxValueHbox), maxValueSlider, TRUE, TRUE, 0);
+  gtk_scale_set_draw_value (GTK_SCALE (maxValueSlider), FALSE);
+  gtk_scale_set_value_pos (GTK_SCALE (maxValueSlider), GTK_POS_LEFT);
+  gtk_scale_set_digits (GTK_SCALE (maxValueSlider), 0);
+
+#ifdef ORIGINAL_CODE_GENERATED_BY_GLADE
+  maxValueSpinner_adj = gtk_adjustment_new (255, 0, 255, 1, 10, 10);
+#endif
+  maxValueSpinner = gtk_spin_button_new (GTK_ADJUSTMENT (maxValueSpinner_adj), 1, 0);
+  gtk_widget_show (maxValueSpinner);
+  gtk_box_pack_start (GTK_BOX (maxValueHbox), maxValueSpinner, FALSE, TRUE, 0);
+
+  outputValuesHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (outputValuesHbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), outputValuesHbox, TRUE, TRUE, 0);
+
+  outputValuesLabel = gtk_label_new (_("Output values:   "));
+  gtk_widget_show (outputValuesLabel);
+  gtk_box_pack_start (GTK_BOX (outputValuesHbox), outputValuesLabel, FALSE, FALSE, 0);
+
+  outputValuesMenu = gtk_combo_box_new_text ();
+  gtk_widget_show (outputValuesMenu);
+  gtk_box_pack_start (GTK_BOX (outputValuesHbox), outputValuesMenu, TRUE, TRUE, 0);
+  gtk_combo_box_append_text (GTK_COMBO_BOX (outputValuesMenu), _("In-range values go black, out-of-range values go white"));
+  gtk_combo_box_append_text (GTK_COMBO_BOX (outputValuesMenu), _("In-range values go white, out-of-range values go black"));
+
+  debugHbox = gtk_hbox_new (FALSE, 0);
+  gtk_widget_show (debugHbox);
+  gtk_box_pack_start (GTK_BOX (settingsOuterVbox), debugHbox, TRUE, TRUE, 0);
+
+  debugLabel = gtk_label_new (_("Debugging settings (bits):   "));
+  gtk_widget_show (debugLabel);
+  gtk_box_pack_start (GTK_BOX (debugHbox), debugLabel, FALSE, FALSE, 0);
+
+  debugSpinButton_adj = gtk_adjustment_new (0, 0, 16777215, 1, 10, 10);
+  debugSpinButton = gtk_spin_button_new (GTK_ADJUSTMENT (debugSpinButton_adj), 1, 0);
+  gtk_widget_show (debugSpinButton);
+  gtk_box_pack_start (GTK_BOX (debugHbox), debugSpinButton, TRUE, TRUE, 0);
+
+  previewFrame = gtk_frame_new (NULL);
+  gtk_widget_show (previewFrame);
+  gtk_box_pack_start (GTK_BOX (allButButtonsVbox), previewFrame, TRUE, TRUE, 0);
+
+  previewAlignment = gtk_alignment_new (0.5, 0.5, 1, 1);
+  gtk_widget_show (previewAlignment);
+  gtk_container_add (GTK_CONTAINER (previewFrame), previewAlignment);
+  gtk_alignment_set_padding (GTK_ALIGNMENT (previewAlignment), 0, 8, 6, 8);
+
+  previewVbox = gtk_vbox_new (FALSE, 5);
+  gtk_widget_show (previewVbox);
+  gtk_container_add (GTK_CONTAINER (previewAlignment), previewVbox);
+
+  previewControlHbox = gtk_hbox_new (FALSE, 5);
+  gtk_widget_show (previewControlHbox);
+  gtk_box_pack_start (GTK_BOX (previewVbox), previewControlHbox, TRUE, TRUE, 0);
+
+  previewOutputMenu = gtk_combo_box_new_text ();
+#ifdef ORIGINAL_CODE_GENERATED_BY_GLADE
+  // temporarily (?) disable this until it's actually implemented
+  gtk_widget_show (previewOutputMenu);
+#endif
+  gtk_box_pack_start (GTK_BOX (previewControlHbox), previewOutputMenu, FALSE, TRUE, 0);
+  gtk_combo_box_append_text (GTK_COMBO_BOX (previewOutputMenu), _("Threshold output"));
+  gtk_combo_box_append_text (GTK_COMBO_BOX (previewOutputMenu), _("Final output"));
+
+  previewSlider = gtk_hscale_new (GTK_ADJUSTMENT (gtk_adjustment_new (0, 0, 99, 1, 1, 1)));
+  gtk_widget_show (previewSlider);
+  gtk_box_pack_start (GTK_BOX (previewControlHbox), previewSlider, TRUE, TRUE, 0);
+  gtk_scale_set_digits (GTK_SCALE (previewSlider), 0);
+
+  previewVideo = gtk_drawing_area_new ();
+  gtk_widget_show (previewVideo);
+  gtk_box_pack_start (GTK_BOX (previewVbox), previewVideo, TRUE, TRUE, 0);
+  gtk_widget_set_size_request (previewVideo, -1, 300);
+  gtk_widget_set_events (previewVideo, GDK_BUTTON1_MOTION_MASK | GDK_BUTTON_PRESS_MASK);
+
+  previewLabel = gtk_label_new (_("Preview"));
+  gtk_widget_show (previewLabel);
+  gtk_frame_set_label_widget (GTK_FRAME (previewFrame), previewLabel);
+
+  dialogButtonBox = GTK_DIALOG (threshold_dialog)->action_area;
+  gtk_widget_show (dialogButtonBox);
+  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialogButtonBox), GTK_BUTTONBOX_END);
+
+  cancelButton = gtk_button_new_from_stock ("gtk-cancel");
+  gtk_widget_show (cancelButton);
+  gtk_dialog_add_action_widget (GTK_DIALOG (threshold_dialog), cancelButton, GTK_RESPONSE_CANCEL);
+  GTK_WIDGET_SET_FLAGS (cancelButton, GTK_CAN_DEFAULT);
+
+  okButton = gtk_button_new_from_stock ("gtk-ok");
+  gtk_widget_show (okButton);
+  gtk_dialog_add_action_widget (GTK_DIALOG (threshold_dialog), okButton, GTK_RESPONSE_OK);
+  GTK_WIDGET_SET_FLAGS (okButton, GTK_CAN_DEFAULT);
+
+  /* Store pointers to all widgets, for use by lookup_widget(). */
+  GLADE_HOOKUP_OBJECT_NO_REF (threshold_dialog, threshold_dialog, "threshold_dialog");
+  GLADE_HOOKUP_OBJECT_NO_REF (threshold_dialog, dialogVbox, "dialogVbox");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, allButButtonsVbox, "allButButtonsVbox");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, settingsOuterHbox, "settingsOuterHbox");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, settingsOuterVbox, "settingsOuterVbox");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, minValueVbox, "minValueVbox");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, minValueLabel, "minValueLabel");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, minValueHbox, "minValueHbox");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, minValueSlider, "minValueSlider");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, minValueSpinner, "minValueSpinner");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, maxValueVbox, "maxValueVbox");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, maxValueLabel, "maxValueLabel");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, maxValueHbox, "maxValueHbox");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, maxValueSlider, "maxValueSlider");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, maxValueSpinner, "maxValueSpinner");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, outputValuesHbox, "outputValuesHbox");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, outputValuesLabel, "outputValuesLabel");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, outputValuesMenu, "outputValuesMenu");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, debugHbox, "debugHbox");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, debugLabel, "debugLabel");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, debugSpinButton, "debugSpinButton");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, previewFrame, "previewFrame");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, previewAlignment, "previewAlignment");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, previewVbox, "previewVbox");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, previewControlHbox, "previewControlHbox");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, previewOutputMenu, "previewOutputMenu");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, previewSlider, "previewSlider");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, previewVideo, "previewVideo");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, previewLabel, "previewLabel");
+  GLADE_HOOKUP_OBJECT_NO_REF (threshold_dialog, dialogButtonBox, "dialogButtonBox");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, cancelButton, "cancelButton");
+  GLADE_HOOKUP_OBJECT (threshold_dialog, okButton, "okButton");
+
+  return threshold_dialog;
+}
+
+#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am	2007-09-30 16:49:31 UTC (rev 3608)
@@ -28,6 +28,9 @@
 	DIA_coloryuv.cpp \
 	DIA_quota.cpp \
 	DIA_partial.cpp  \
+	DIA_threshold.cpp \
+	DIA_SwissArmyKnife.cpp \
+	DIA_particle.cpp \
 	DIA_flyDialog.cpp
 
 
@@ -51,6 +54,6 @@
 DIA_busy.cpp         DIA_properties.cpp  DIA_xvid.cpp \
 DIA_busy.h            DIA_quota.cpp       DIA_xvid4.cpp \
 DIA_calculator.cpp   DIA_encoding.cpp      DIA_recent.cpp \
-DIA_chromaShift.cpp  DIA_encoding.h        DIA_lavpp_deint.cpp   
+DIA_chromaShift.cpp  DIA_encoding.h        DIA_lavpp_deint.cpp \
+DIA_threshold.cpp    DIA_SwissArmyKnife.cpp DIA_particle.cpp
 
-

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/DIA_filesel.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -13,14 +13,8 @@
  *                                                                         *
  ***************************************************************************/
 
-#include <config.h>
+#include "default.h"
 
-
-#include <string.h>
-#include <stdio.h>
-#include <math.h>
-
-#include "default.h"
 #include "ADM_toolkit_gtk/ADM_gladeSupport.h"
 #include "ADM_toolkit_gtk/toolkit_gtk.h"
 #include "ADM_toolkit_gtk/toolkit_gtk_include.h"
@@ -35,8 +29,20 @@
 diaElemFile::diaElemFile(uint32_t writemode,char **filename,const char *toggleTitle,
                          const char * defaultSuffix,const char *tip)
   : diaElem(ELEM_FILE_READ),
-    defaultSuffix (defaultSuffix)
+    defaultSuffix (defaultSuffix),
+    paramIsStdString (false)
+{
+  param=(void *)filename;
+  paramTitle=toggleTitle;
+  this->tip=tip;
+  _write=writemode;
+}
 
+diaElemFile::diaElemFile(uint32_t writemode,std::string *filename,const char *toggleTitle,
+                         const char * defaultSuffix,const char *tip)
+  : diaElem(ELEM_FILE_READ),
+    defaultSuffix (defaultSuffix),
+    paramIsStdString (true)
 {
   param=(void *)filename;
   paramTitle=toggleTitle;
@@ -80,8 +86,12 @@
   gtk_widget_show (entry);
   if(param)
   {
-      char **val=(char **)param;
-      gtk_entry_set_text (GTK_ENTRY (entry), *val);
+      const char * val;
+      if (paramIsStdString)
+          val = ((std::string *)param)->c_str();
+      else
+          val = *((char **)param);
+      gtk_entry_set_text (GTK_ENTRY (entry), val);
   }
   gtk_label_set_mnemonic_widget (GTK_LABEL(label), entry);
   
@@ -116,10 +126,17 @@
 void diaElemFile::getMe(void)
 {
   GtkWidget **widget=(GtkWidget **)myWidget;
-  char **name=(char **)param;
-  if(*name) delete *name;
-  *name=NULL;
-  *name =ADM_strdup(gtk_entry_get_text (GTK_ENTRY (widget[0])));
+  const char * val = gtk_entry_get_text (GTK_ENTRY (widget[0]));
+  if (paramIsStdString)
+  {
+      *((std::string *)param) = val;
+  }
+  else
+  {
+      char **name=(char **)param;
+      if(*name) delete [] *name;
+      *name = ADM_strdup(val);
+  }
 }
 
 void diaElemFile::changeFile(void)
@@ -165,11 +182,17 @@
   }
   if(t)
   {
-    char **name=(char **)param;
-    if(*name) delete [] *name;
-    *name=NULL;
-    *name =ADM_strdup(buffer);
-     gtk_entry_set_text (GTK_ENTRY (widget), *name);
+    if (paramIsStdString)
+    {
+        *((std::string *)param) = buffer;
+    }
+    else
+    {
+        char **name=(char **)param;
+        if(*name) delete [] *name;
+        *name = ADM_strdup(buffer);
+    }
+    gtk_entry_set_text (GTK_ENTRY (widget), buffer);
   }
   
 }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_gtkRender.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -14,11 +14,8 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
 
-#include <stdio.h>         
-#include <stdlib.h>
-#include <unistd.h>
+#include "default.h"
 
 #include <gtk/gtk.h>
 #ifdef ADM_WIN32
@@ -29,7 +26,6 @@
 #endif
 
 #include "../ADM_assert.h"
-#include "default.h"
 #include "../ADM_osSupport/ADM_misc.h"
 
 #include "ADM_commonUI/GUI_render.h"
@@ -64,7 +60,9 @@
 
     if(lastW>w || lastH>h)
     {
-      printf("[GTK] Warning window bigger than display %u x %u vs %u x %u\n",w,h,lastW,lastH);
+// This makes a lot of noise if you use the Crop filter...  perhaps it should
+// be output only once?  Or maybe there is a real bug - I'm not sure.  [Chris MacGregor]
+//      printf("[GTK] Warning window bigger than display %u x %u vs %u x %u\n",w,h,lastW,lastH);
     }
 
     gdk_draw_rgb_32_image(widget->window, widget->style->fg_gc[GTK_STATE_NORMAL], 0,    // X

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -16,22 +16,19 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
 
-#include <stdlib.h>
-#include <stdio.h>
+#include "default.h"
+
 #include <gtk/gtk.h>
 
-#include <dirent.h>
 #include <errno.h>
+#include <sys/types.h>
 #include <sys/stat.h>
-#ifndef ADM_WIN32
-	#include <unistd.h>
-#endif
+#include <dirent.h>
 
 #include "avi_vars.h"
 #include "ADM_misc.h"
-#include <ADM_assert.h>
+#include "ADM_assert.h"
 
 #include "ADM_toolkit/filesel.h"
 #include "ADM_toolkit/toolkit.hxx"

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade/particle.glade
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade/particle.glade	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade/particle.glade	2007-09-30 16:49:31 UTC (rev 3608)
@@ -0,0 +1,877 @@
+<?xml version="1.0" standalone="no"?> <!--*- mode: xml -*-->
+<!DOCTYPE glade-interface SYSTEM "http://glade.gnome.org/glade-2.0.dtd">
+
+<glade-interface>
+
+<widget class="GtkDialog" id="particle_dialog">
+  <property name="visible">True</property>
+  <property name="title" translatable="yes">Particle Detection</property>
+  <property name="type">GTK_WINDOW_TOPLEVEL</property>
+  <property name="window_position">GTK_WIN_POS_NONE</property>
+  <property name="modal">False</property>
+  <property name="resizable">True</property>
+  <property name="destroy_with_parent">False</property>
+  <property name="decorated">True</property>
+  <property name="skip_taskbar_hint">False</property>
+  <property name="skip_pager_hint">False</property>
+  <property name="type_hint">GDK_WINDOW_TYPE_HINT_DIALOG</property>
+  <property name="gravity">GDK_GRAVITY_NORTH_WEST</property>
+  <property name="focus_on_map">True</property>
+  <property name="urgency_hint">False</property>
+  <property name="has_separator">True</property>
+
+  <child internal-child="vbox">
+    <widget class="GtkVBox" id="dialogVbox">
+      <property name="visible">True</property>
+      <property name="homogeneous">False</property>
+      <property name="spacing">0</property>
+
+      <child internal-child="action_area">
+	<widget class="GtkHButtonBox" id="dialogButtonBox">
+	  <property name="visible">True</property>
+	  <property name="layout_style">GTK_BUTTONBOX_END</property>
+
+	  <child>
+	    <widget class="GtkButton" id="cancelButton">
+	      <property name="visible">True</property>
+	      <property name="can_default">True</property>
+	      <property name="can_focus">True</property>
+	      <property name="label">gtk-cancel</property>
+	      <property name="use_stock">True</property>
+	      <property name="relief">GTK_RELIEF_NORMAL</property>
+	      <property name="focus_on_click">True</property>
+	      <property name="response_id">-6</property>
+	    </widget>
+	  </child>
+
+	  <child>
+	    <widget class="GtkButton" id="okButton">
+	      <property name="visible">True</property>
+	      <property name="can_default">True</property>
+	      <property name="can_focus">True</property>
+	      <property name="label">gtk-ok</property>
+	      <property name="use_stock">True</property>
+	      <property name="relief">GTK_RELIEF_NORMAL</property>
+	      <property name="focus_on_click">True</property>
+	      <property name="response_id">-5</property>
+	    </widget>
+	  </child>
+	</widget>
+	<packing>
+	  <property name="padding">0</property>
+	  <property name="expand">False</property>
+	  <property name="fill">True</property>
+	  <property name="pack_type">GTK_PACK_END</property>
+	</packing>
+      </child>
+
+      <child>
+	<widget class="GtkHBox" id="dialogHbox">
+	  <property name="visible">True</property>
+	  <property name="homogeneous">False</property>
+	  <property name="spacing">0</property>
+
+	  <child>
+	    <widget class="GtkVBox" id="allButButtonsVbox">
+	      <property name="border_width">8</property>
+	      <property name="visible">True</property>
+	      <property name="homogeneous">False</property>
+	      <property name="spacing">12</property>
+
+	      <child>
+		<widget class="GtkHBox" id="settingsOuterHbox">
+		  <property name="visible">True</property>
+		  <property name="homogeneous">False</property>
+		  <property name="spacing">0</property>
+
+		  <child>
+		    <widget class="GtkVBox" id="settingsOuterVbox">
+		      <property name="visible">True</property>
+		      <property name="homogeneous">False</property>
+		      <property name="spacing">12</property>
+
+		      <child>
+			<widget class="GtkHBox" id="minAreaHbox">
+			  <property name="visible">True</property>
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">0</property>
+
+			  <child>
+			    <widget class="GtkLabel" id="minAreaLabel">
+			      <property name="visible">True</property>
+			      <property name="label" translatable="yes">Mi_nimum area for a particle to be detected:    </property>
+			      <property name="use_underline">True</property>
+			      <property name="use_markup">False</property>
+			      <property name="justify">GTK_JUSTIFY_LEFT</property>
+			      <property name="wrap">False</property>
+			      <property name="selectable">False</property>
+			      <property name="xalign">0.5</property>
+			      <property name="yalign">0.5</property>
+			      <property name="xpad">0</property>
+			      <property name="ypad">0</property>
+			      <property name="mnemonic_widget">minAreaSpinButton</property>
+			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			      <property name="width_chars">-1</property>
+			      <property name="single_line_mode">False</property>
+			      <property name="angle">0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">False</property>
+			      <property name="fill">False</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkSpinButton" id="minAreaSpinButton">
+			      <property name="visible">True</property>
+			      <property name="can_focus">True</property>
+			      <property name="climb_rate">1</property>
+			      <property name="digits">0</property>
+			      <property name="numeric">True</property>
+			      <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+			      <property name="snap_to_ticks">False</property>
+			      <property name="wrap">False</property>
+			      <property name="adjustment">5 1 999999 1 1 0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkHBox" id="maxAreaHbox">
+			  <property name="visible">True</property>
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">0</property>
+
+			  <child>
+			    <widget class="GtkLabel" id="maxAreaLabel">
+			      <property name="visible">True</property>
+			      <property name="label" translatable="yes">Ma_ximum area for a particle to be detected:   </property>
+			      <property name="use_underline">True</property>
+			      <property name="use_markup">False</property>
+			      <property name="justify">GTK_JUSTIFY_LEFT</property>
+			      <property name="wrap">False</property>
+			      <property name="selectable">False</property>
+			      <property name="xalign">0.5</property>
+			      <property name="yalign">0.5</property>
+			      <property name="xpad">0</property>
+			      <property name="ypad">0</property>
+			      <property name="mnemonic_widget">maxAreaSpinButton</property>
+			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			      <property name="width_chars">-1</property>
+			      <property name="single_line_mode">False</property>
+			      <property name="angle">0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">False</property>
+			      <property name="fill">False</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkSpinButton" id="maxAreaSpinButton">
+			      <property name="visible">True</property>
+			      <property name="can_focus">True</property>
+			      <property name="climb_rate">1</property>
+			      <property name="digits">0</property>
+			      <property name="numeric">True</property>
+			      <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+			      <property name="snap_to_ticks">False</property>
+			      <property name="wrap">False</property>
+			      <property name="adjustment">50000 1 999999 1 1 0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkHSeparator" id="aboveCropSeparator">
+			  <property name="visible">True</property>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkHBox" id="leftCropHbox">
+			  <property name="visible">True</property>
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">0</property>
+
+			  <child>
+			    <widget class="GtkLabel" id="leftCropLabel">
+			      <property name="visible">True</property>
+			      <property name="label" translatable="yes">_Left side crop (ignore this many pixels on the left):        </property>
+			      <property name="use_underline">True</property>
+			      <property name="use_markup">False</property>
+			      <property name="justify">GTK_JUSTIFY_LEFT</property>
+			      <property name="wrap">False</property>
+			      <property name="selectable">False</property>
+			      <property name="xalign">0.5</property>
+			      <property name="yalign">0.5</property>
+			      <property name="xpad">0</property>
+			      <property name="ypad">0</property>
+			      <property name="mnemonic_widget">leftCropSpinButton</property>
+			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			      <property name="width_chars">-1</property>
+			      <property name="single_line_mode">False</property>
+			      <property name="angle">0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">False</property>
+			      <property name="fill">False</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkSpinButton" id="leftCropSpinButton">
+			      <property name="visible">True</property>
+			      <property name="can_focus">True</property>
+			      <property name="climb_rate">1</property>
+			      <property name="digits">0</property>
+			      <property name="numeric">True</property>
+			      <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+			      <property name="snap_to_ticks">False</property>
+			      <property name="wrap">False</property>
+			      <property name="adjustment">0 0 2048 1 1 0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkHBox" id="rightCropHbox">
+			  <property name="visible">True</property>
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">0</property>
+
+			  <child>
+			    <widget class="GtkLabel" id="rightCropLabel">
+			      <property name="visible">True</property>
+			      <property name="label" translatable="yes">_Right side crop (ignore this many pixels on the right):     </property>
+			      <property name="use_underline">True</property>
+			      <property name="use_markup">False</property>
+			      <property name="justify">GTK_JUSTIFY_LEFT</property>
+			      <property name="wrap">False</property>
+			      <property name="selectable">False</property>
+			      <property name="xalign">0.5</property>
+			      <property name="yalign">0.5</property>
+			      <property name="xpad">0</property>
+			      <property name="ypad">0</property>
+			      <property name="mnemonic_widget">rightCropSpinButton</property>
+			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			      <property name="width_chars">-1</property>
+			      <property name="single_line_mode">False</property>
+			      <property name="angle">0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">False</property>
+			      <property name="fill">False</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkSpinButton" id="rightCropSpinButton">
+			      <property name="visible">True</property>
+			      <property name="can_focus">True</property>
+			      <property name="climb_rate">1</property>
+			      <property name="digits">0</property>
+			      <property name="numeric">True</property>
+			      <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+			      <property name="snap_to_ticks">False</property>
+			      <property name="wrap">False</property>
+			      <property name="adjustment">0 0 2048 1 1 0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkHBox" id="topCropHbox">
+			  <property name="visible">True</property>
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">0</property>
+
+			  <child>
+			    <widget class="GtkLabel" id="topCropLabel">
+			      <property name="visible">True</property>
+			      <property name="label" translatable="yes">_Top crop (ignore this many pixels on the top):                  </property>
+			      <property name="use_underline">True</property>
+			      <property name="use_markup">False</property>
+			      <property name="justify">GTK_JUSTIFY_LEFT</property>
+			      <property name="wrap">False</property>
+			      <property name="selectable">False</property>
+			      <property name="xalign">0.5</property>
+			      <property name="yalign">0.5</property>
+			      <property name="xpad">0</property>
+			      <property name="ypad">0</property>
+			      <property name="mnemonic_widget">topCropSpinButton</property>
+			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			      <property name="width_chars">-1</property>
+			      <property name="single_line_mode">False</property>
+			      <property name="angle">0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">False</property>
+			      <property name="fill">False</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkSpinButton" id="topCropSpinButton">
+			      <property name="visible">True</property>
+			      <property name="can_focus">True</property>
+			      <property name="climb_rate">1</property>
+			      <property name="digits">0</property>
+			      <property name="numeric">True</property>
+			      <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+			      <property name="snap_to_ticks">False</property>
+			      <property name="wrap">False</property>
+			      <property name="adjustment">0 0 2048 1 1 0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkHBox" id="bottomCropHbox">
+			  <property name="visible">True</property>
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">0</property>
+
+			  <child>
+			    <widget class="GtkLabel" id="bottomCropLabel">
+			      <property name="visible">True</property>
+			      <property name="label" translatable="yes">_Bottom crop (ignore this many pixels on the bottom):   </property>
+			      <property name="use_underline">True</property>
+			      <property name="use_markup">False</property>
+			      <property name="justify">GTK_JUSTIFY_LEFT</property>
+			      <property name="wrap">False</property>
+			      <property name="selectable">False</property>
+			      <property name="xalign">0.5</property>
+			      <property name="yalign">0.5</property>
+			      <property name="xpad">0</property>
+			      <property name="ypad">0</property>
+			      <property name="mnemonic_widget">bottomCropSpinButton</property>
+			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			      <property name="width_chars">-1</property>
+			      <property name="single_line_mode">False</property>
+			      <property name="angle">0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">False</property>
+			      <property name="fill">False</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkSpinButton" id="bottomCropSpinButton">
+			      <property name="visible">True</property>
+			      <property name="can_focus">True</property>
+			      <property name="climb_rate">1</property>
+			      <property name="digits">0</property>
+			      <property name="numeric">True</property>
+			      <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+			      <property name="snap_to_ticks">False</property>
+			      <property name="wrap">False</property>
+			      <property name="adjustment">0 0 2048 1 1 0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkHSeparator" id="belowCropSeparator">
+			  <property name="visible">True</property>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkHBox" id="outputFormatHbox">
+			  <property name="visible">True</property>
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">0</property>
+
+			  <child>
+			    <widget class="GtkLabel" id="outputFormatLabel">
+			      <property name="visible">True</property>
+			      <property name="label" translatable="yes">Output _Format:   </property>
+			      <property name="use_underline">True</property>
+			      <property name="use_markup">False</property>
+			      <property name="justify">GTK_JUSTIFY_LEFT</property>
+			      <property name="wrap">False</property>
+			      <property name="selectable">False</property>
+			      <property name="xalign">0.5</property>
+			      <property name="yalign">0.5</property>
+			      <property name="xpad">0</property>
+			      <property name="ypad">0</property>
+			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			      <property name="width_chars">-1</property>
+			      <property name="single_line_mode">False</property>
+			      <property name="angle">0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">False</property>
+			      <property name="fill">False</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkComboBox" id="outputFormatMenu">
+			      <property name="visible">True</property>
+			      <property name="items" translatable="yes"></property>
+			      <property name="add_tearoffs">False</property>
+			      <property name="focus_on_click">True</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkHBox" id="outputFileHbox">
+			  <property name="visible">True</property>
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">5</property>
+
+			  <child>
+			    <widget class="GtkLabel" id="outputFileLabel">
+			      <property name="visible">True</property>
+			      <property name="label" translatable="yes">_Output File:</property>
+			      <property name="use_underline">True</property>
+			      <property name="use_markup">False</property>
+			      <property name="justify">GTK_JUSTIFY_LEFT</property>
+			      <property name="wrap">False</property>
+			      <property name="selectable">False</property>
+			      <property name="xalign">0.5</property>
+			      <property name="yalign">0.5</property>
+			      <property name="xpad">0</property>
+			      <property name="ypad">0</property>
+			      <property name="mnemonic_widget">outputFileEntry</property>
+			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			      <property name="width_chars">-1</property>
+			      <property name="single_line_mode">False</property>
+			      <property name="angle">0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">False</property>
+			      <property name="fill">False</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkEntry" id="outputFileEntry">
+			      <property name="visible">True</property>
+			      <property name="can_focus">True</property>
+			      <property name="editable">True</property>
+			      <property name="visibility">True</property>
+			      <property name="max_length">0</property>
+			      <property name="text" translatable="yes"></property>
+			      <property name="has_frame">True</property>
+			      <property name="invisible_char">?</property>
+			      <property name="activates_default">False</property>
+			      <property name="width_chars">40</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkButton" id="outputFileBrowseButton">
+			      <property name="visible">True</property>
+			      <property name="can_focus">True</property>
+			      <property name="label" translatable="yes">_Browse...</property>
+			      <property name="use_underline">True</property>
+			      <property name="relief">GTK_RELIEF_NORMAL</property>
+			      <property name="focus_on_click">True</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">False</property>
+			      <property name="fill">False</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkHBox" id="cameraNumberHbox">
+			  <property name="visible">True</property>
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">0</property>
+
+			  <child>
+			    <widget class="GtkLabel" id="cameraNumberLabel">
+			      <property name="visible">True</property>
+			      <property name="label" translatable="yes">_Camera Number for output file:      </property>
+			      <property name="use_underline">True</property>
+			      <property name="use_markup">False</property>
+			      <property name="justify">GTK_JUSTIFY_LEFT</property>
+			      <property name="wrap">False</property>
+			      <property name="selectable">False</property>
+			      <property name="xalign">0.5</property>
+			      <property name="yalign">0.5</property>
+			      <property name="xpad">0</property>
+			      <property name="ypad">0</property>
+			      <property name="mnemonic_widget">cameraNumberSpinButton</property>
+			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			      <property name="width_chars">-1</property>
+			      <property name="single_line_mode">False</property>
+			      <property name="angle">0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">False</property>
+			      <property name="fill">False</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkSpinButton" id="cameraNumberSpinButton">
+			      <property name="visible">True</property>
+			      <property name="can_focus">True</property>
+			      <property name="climb_rate">1</property>
+			      <property name="digits">0</property>
+			      <property name="numeric">True</property>
+			      <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+			      <property name="snap_to_ticks">False</property>
+			      <property name="wrap">False</property>
+			      <property name="adjustment">1 0 99999 1 1 0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkHBox" id="debugHbox">
+			  <property name="visible">True</property>
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">0</property>
+
+			  <child>
+			    <widget class="GtkLabel" id="debugLabel">
+			      <property name="visible">True</property>
+			      <property name="label" translatable="yes">_Debugging settings (bits):   </property>
+			      <property name="use_underline">True</property>
+			      <property name="use_markup">False</property>
+			      <property name="justify">GTK_JUSTIFY_LEFT</property>
+			      <property name="wrap">False</property>
+			      <property name="selectable">False</property>
+			      <property name="xalign">0.5</property>
+			      <property name="yalign">0.5</property>
+			      <property name="xpad">0</property>
+			      <property name="ypad">0</property>
+			      <property name="mnemonic_widget">debugSpinButton</property>
+			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			      <property name="width_chars">-1</property>
+			      <property name="single_line_mode">False</property>
+			      <property name="angle">0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">False</property>
+			      <property name="fill">False</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkSpinButton" id="debugSpinButton">
+			      <property name="visible">True</property>
+			      <property name="can_focus">True</property>
+			      <property name="climb_rate">1</property>
+			      <property name="digits">0</property>
+			      <property name="numeric">True</property>
+			      <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+			      <property name="snap_to_ticks">False</property>
+			      <property name="wrap">False</property>
+			      <property name="adjustment">0 0 16777215 1 10 0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+		    </widget>
+		    <packing>
+		      <property name="padding">0</property>
+		      <property name="expand">True</property>
+		      <property name="fill">True</property>
+		    </packing>
+		  </child>
+		</widget>
+		<packing>
+		  <property name="padding">0</property>
+		  <property name="expand">False</property>
+		  <property name="fill">True</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkVBox" id="previewVboxOuter">
+		  <property name="visible">True</property>
+		  <property name="homogeneous">False</property>
+		  <property name="spacing">0</property>
+
+		  <child>
+		    <widget class="GtkFrame" id="previewFrame">
+		      <property name="visible">True</property>
+		      <property name="label_xalign">0</property>
+		      <property name="label_yalign">0.5</property>
+		      <property name="shadow_type">GTK_SHADOW_ETCHED_IN</property>
+
+		      <child>
+			<widget class="GtkAlignment" id="previewAlignment">
+			  <property name="visible">True</property>
+			  <property name="xalign">0.5</property>
+			  <property name="yalign">0.5</property>
+			  <property name="xscale">1</property>
+			  <property name="yscale">1</property>
+			  <property name="top_padding">0</property>
+			  <property name="bottom_padding">8</property>
+			  <property name="left_padding">6</property>
+			  <property name="right_padding">8</property>
+
+			  <child>
+			    <widget class="GtkVBox" id="previewVbox">
+			      <property name="visible">True</property>
+			      <property name="homogeneous">False</property>
+			      <property name="spacing">5</property>
+
+			      <child>
+				<widget class="GtkHBox" id="previewControlHbox">
+				  <property name="visible">True</property>
+				  <property name="homogeneous">False</property>
+				  <property name="spacing">5</property>
+
+				  <child>
+				    <widget class="GtkComboBox" id="previewOutputMenu">
+				      <property name="items" translatable="yes">Swiss Army Knife output
+Final output</property>
+				      <property name="add_tearoffs">False</property>
+				      <property name="focus_on_click">True</property>
+				    </widget>
+				    <packing>
+				      <property name="padding">0</property>
+				      <property name="expand">False</property>
+				      <property name="fill">True</property>
+				    </packing>
+				  </child>
+
+				  <child>
+				    <widget class="GtkHScale" id="previewSlider">
+				      <property name="visible">True</property>
+				      <property name="can_focus">True</property>
+				      <property name="draw_value">True</property>
+				      <property name="value_pos">GTK_POS_TOP</property>
+				      <property name="digits">0</property>
+				      <property name="update_policy">GTK_UPDATE_CONTINUOUS</property>
+				      <property name="inverted">False</property>
+				      <property name="adjustment">0 0 99 1 1 0</property>
+				    </widget>
+				    <packing>
+				      <property name="padding">0</property>
+				      <property name="expand">True</property>
+				      <property name="fill">True</property>
+				    </packing>
+				  </child>
+				</widget>
+				<packing>
+				  <property name="padding">0</property>
+				  <property name="expand">True</property>
+				  <property name="fill">True</property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkDrawingArea" id="previewVideo">
+				  <property name="height_request">300</property>
+				  <property name="visible">True</property>
+				  <property name="events">GDK_BUTTON1_MOTION_MASK | GDK_BUTTON_PRESS_MASK</property>
+				</widget>
+				<packing>
+				  <property name="padding">0</property>
+				  <property name="expand">True</property>
+				  <property name="fill">True</property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkDrawingArea" id="previewDisabled">
+				</widget>
+				<packing>
+				  <property name="padding">0</property>
+				  <property name="expand">True</property>
+				  <property name="fill">True</property>
+				</packing>
+			      </child>
+			    </widget>
+			  </child>
+			</widget>
+		      </child>
+
+		      <child>
+			<widget class="GtkLabel" id="previewLabel">
+			  <property name="visible">True</property>
+			  <property name="label" translatable="yes">Preview</property>
+			  <property name="use_underline">False</property>
+			  <property name="use_markup">False</property>
+			  <property name="justify">GTK_JUSTIFY_LEFT</property>
+			  <property name="wrap">False</property>
+			  <property name="selectable">False</property>
+			  <property name="xalign">0.5</property>
+			  <property name="yalign">0.5</property>
+			  <property name="xpad">0</property>
+			  <property name="ypad">0</property>
+			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			  <property name="width_chars">-1</property>
+			  <property name="single_line_mode">False</property>
+			  <property name="angle">0</property>
+			</widget>
+			<packing>
+			  <property name="type">label_item</property>
+			</packing>
+		      </child>
+		    </widget>
+		    <packing>
+		      <property name="padding">0</property>
+		      <property name="expand">False</property>
+		      <property name="fill">True</property>
+		    </packing>
+		  </child>
+		</widget>
+		<packing>
+		  <property name="padding">0</property>
+		  <property name="expand">True</property>
+		  <property name="fill">True</property>
+		</packing>
+	      </child>
+	    </widget>
+	    <packing>
+	      <property name="padding">0</property>
+	      <property name="expand">True</property>
+	      <property name="fill">True</property>
+	    </packing>
+	  </child>
+	</widget>
+	<packing>
+	  <property name="padding">0</property>
+	  <property name="expand">True</property>
+	  <property name="fill">True</property>
+	</packing>
+      </child>
+    </widget>
+  </child>
+</widget>
+
+</glade-interface>

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade/swissarmyknife.glade
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade/swissarmyknife.glade	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade/swissarmyknife.glade	2007-09-30 16:49:31 UTC (rev 3608)
@@ -0,0 +1,1886 @@
+<?xml version="1.0" standalone="no"?> <!--*- mode: xml -*-->
+<!DOCTYPE glade-interface SYSTEM "http://glade.gnome.org/glade-2.0.dtd">
+
+<glade-interface>
+
+<widget class="GtkDialog" id="swiss_army_knife_dialog">
+  <property name="visible">True</property>
+  <property name="title" translatable="yes">Swiss Army Knife</property>
+  <property name="type">GTK_WINDOW_TOPLEVEL</property>
+  <property name="window_position">GTK_WIN_POS_NONE</property>
+  <property name="modal">False</property>
+  <property name="resizable">True</property>
+  <property name="destroy_with_parent">False</property>
+  <property name="decorated">True</property>
+  <property name="skip_taskbar_hint">False</property>
+  <property name="skip_pager_hint">False</property>
+  <property name="type_hint">GDK_WINDOW_TYPE_HINT_DIALOG</property>
+  <property name="gravity">GDK_GRAVITY_NORTH_WEST</property>
+  <property name="focus_on_map">True</property>
+  <property name="urgency_hint">False</property>
+  <property name="has_separator">True</property>
+
+  <child internal-child="vbox">
+    <widget class="GtkVBox" id="dialogVbox">
+      <property name="visible">True</property>
+      <property name="homogeneous">False</property>
+      <property name="spacing">0</property>
+
+      <child internal-child="action_area">
+	<widget class="GtkHButtonBox" id="dialogButtonBox">
+	  <property name="visible">True</property>
+	  <property name="layout_style">GTK_BUTTONBOX_END</property>
+
+	  <child>
+	    <widget class="GtkButton" id="cancelButton">
+	      <property name="visible">True</property>
+	      <property name="can_default">True</property>
+	      <property name="can_focus">True</property>
+	      <property name="label">gtk-cancel</property>
+	      <property name="use_stock">True</property>
+	      <property name="relief">GTK_RELIEF_NORMAL</property>
+	      <property name="focus_on_click">True</property>
+	      <property name="response_id">-6</property>
+	    </widget>
+	  </child>
+
+	  <child>
+	    <widget class="GtkButton" id="okButton">
+	      <property name="visible">True</property>
+	      <property name="can_default">True</property>
+	      <property name="can_focus">True</property>
+	      <property name="label">gtk-ok</property>
+	      <property name="use_stock">True</property>
+	      <property name="relief">GTK_RELIEF_NORMAL</property>
+	      <property name="focus_on_click">True</property>
+	      <property name="response_id">-5</property>
+	    </widget>
+	  </child>
+	</widget>
+	<packing>
+	  <property name="padding">0</property>
+	  <property name="expand">False</property>
+	  <property name="fill">True</property>
+	  <property name="pack_type">GTK_PACK_END</property>
+	</packing>
+      </child>
+
+      <child>
+	<widget class="GtkHBox" id="dialogHbox">
+	  <property name="visible">True</property>
+	  <property name="homogeneous">False</property>
+	  <property name="spacing">0</property>
+
+	  <child>
+	    <widget class="GtkVBox" id="allSettingsVbox">
+	      <property name="border_width">8</property>
+	      <property name="visible">True</property>
+	      <property name="homogeneous">False</property>
+	      <property name="spacing">12</property>
+
+	      <child>
+		<widget class="GtkHBox" id="settingsOuterHbox">
+		  <property name="visible">True</property>
+		  <property name="homogeneous">False</property>
+		  <property name="spacing">0</property>
+
+		  <child>
+		    <widget class="GtkVBox" id="settingsOuterVbox">
+		      <property name="visible">True</property>
+		      <property name="homogeneous">False</property>
+		      <property name="spacing">12</property>
+
+		      <child>
+			<widget class="GtkHBox" id="operationHbox">
+			  <property name="visible">True</property>
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">0</property>
+
+			  <child>
+			    <widget class="GtkLabel" id="operationLabel">
+			      <property name="visible">True</property>
+			      <property name="label" translatable="yes">Select _Operation on each pixel P and input A:   </property>
+			      <property name="use_underline">True</property>
+			      <property name="use_markup">False</property>
+			      <property name="justify">GTK_JUSTIFY_LEFT</property>
+			      <property name="wrap">False</property>
+			      <property name="selectable">False</property>
+			      <property name="xalign">0.5</property>
+			      <property name="yalign">0.5</property>
+			      <property name="xpad">0</property>
+			      <property name="ypad">0</property>
+			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			      <property name="width_chars">-1</property>
+			      <property name="single_line_mode">False</property>
+			      <property name="angle">0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">False</property>
+			      <property name="fill">False</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkComboBox" id="operationMenu">
+			      <property name="visible">True</property>
+			      <property name="items" translatable="yes"></property>
+			      <property name="add_tearoffs">False</property>
+			      <property name="focus_on_click">True</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkHBox" id="inputTypeHbox">
+			  <property name="visible">True</property>
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">0</property>
+
+			  <child>
+			    <widget class="GtkLabel" id="inputTypeLabel">
+			      <property name="visible">True</property>
+			      <property name="label" translatable="yes">Input _Type:   </property>
+			      <property name="use_underline">True</property>
+			      <property name="use_markup">False</property>
+			      <property name="justify">GTK_JUSTIFY_LEFT</property>
+			      <property name="wrap">False</property>
+			      <property name="selectable">False</property>
+			      <property name="xalign">0.5</property>
+			      <property name="yalign">0.5</property>
+			      <property name="xpad">0</property>
+			      <property name="ypad">0</property>
+			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			      <property name="width_chars">-1</property>
+			      <property name="single_line_mode">False</property>
+			      <property name="angle">0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">False</property>
+			      <property name="fill">False</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkComboBox" id="inputTypeMenu">
+			      <property name="visible">True</property>
+			      <property name="items" translatable="yes"></property>
+			      <property name="add_tearoffs">False</property>
+			      <property name="focus_on_click">True</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkHSeparator" id="topSeparator">
+			  <property name="visible">True</property>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkVBox" id="convolutionSettingsVbox">
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">6</property>
+
+			  <child>
+			    <widget class="GtkHBox" id="convolutionInputFileHbox">
+			      <property name="visible">True</property>
+			      <property name="homogeneous">False</property>
+			      <property name="spacing">0</property>
+
+			      <child>
+				<widget class="GtkLabel" id="convolutionInputFileLabel">
+				  <property name="visible">True</property>
+				  <property name="label" translatable="yes">Input _File (convolution kernel):   </property>
+				  <property name="use_underline">True</property>
+				  <property name="use_markup">False</property>
+				  <property name="justify">GTK_JUSTIFY_LEFT</property>
+				  <property name="wrap">False</property>
+				  <property name="selectable">False</property>
+				  <property name="xalign">0.5</property>
+				  <property name="yalign">0.5</property>
+				  <property name="xpad">0</property>
+				  <property name="ypad">0</property>
+				  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+				  <property name="width_chars">-1</property>
+				  <property name="single_line_mode">False</property>
+				  <property name="angle">0</property>
+				</widget>
+				<packing>
+				  <property name="padding">0</property>
+				  <property name="expand">False</property>
+				  <property name="fill">False</property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkFileChooserButton" id="convolutionInputFileChooser">
+				  <property name="visible">True</property>
+				  <property name="title" translatable="yes">Select Convolution Kernel File</property>
+				  <property name="action">GTK_FILE_CHOOSER_ACTION_OPEN</property>
+				  <property name="local_only">True</property>
+				  <property name="show_hidden">False</property>
+				  <property name="do_overwrite_confirmation">False</property>
+				  <property name="width_chars">-1</property>
+				</widget>
+				<packing>
+				  <property name="padding">0</property>
+				  <property name="expand">True</property>
+				  <property name="fill">True</property>
+				</packing>
+			      </child>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkVBox" id="imageFileSettingsVbox">
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">6</property>
+
+			  <child>
+			    <widget class="GtkHBox" id="imageInputFileHbox">
+			      <property name="visible">True</property>
+			      <property name="homogeneous">False</property>
+			      <property name="spacing">0</property>
+
+			      <child>
+				<widget class="GtkLabel" id="imageInputFileLabel">
+				  <property name="visible">True</property>
+				  <property name="label" translatable="yes">Input _File (image file):   </property>
+				  <property name="use_underline">True</property>
+				  <property name="use_markup">False</property>
+				  <property name="justify">GTK_JUSTIFY_LEFT</property>
+				  <property name="wrap">False</property>
+				  <property name="selectable">False</property>
+				  <property name="xalign">0.5</property>
+				  <property name="yalign">0.5</property>
+				  <property name="xpad">0</property>
+				  <property name="ypad">0</property>
+				  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+				  <property name="width_chars">-1</property>
+				  <property name="single_line_mode">False</property>
+				  <property name="angle">0</property>
+				</widget>
+				<packing>
+				  <property name="padding">0</property>
+				  <property name="expand">False</property>
+				  <property name="fill">False</property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkFileChooserButton" id="imageInputFileChooser">
+				  <property name="visible">True</property>
+				  <property name="title" translatable="yes">Select Convolution Kernel File</property>
+				  <property name="action">GTK_FILE_CHOOSER_ACTION_OPEN</property>
+				  <property name="local_only">True</property>
+				  <property name="show_hidden">False</property>
+				  <property name="do_overwrite_confirmation">False</property>
+				  <property name="width_chars">-1</property>
+				</widget>
+				<packing>
+				  <property name="padding">0</property>
+				  <property name="expand">True</property>
+				  <property name="fill">True</property>
+				</packing>
+			      </child>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkFrame" id="imageFileScalingFrame">
+			      <property name="visible">True</property>
+			      <property name="label_xalign">0</property>
+			      <property name="label_yalign">0.5</property>
+			      <property name="shadow_type">GTK_SHADOW_IN</property>
+
+			      <child>
+				<widget class="GtkAlignment" id="imageFileScalingAlignment">
+				  <property name="visible">True</property>
+				  <property name="xalign">0.5</property>
+				  <property name="yalign">0.5</property>
+				  <property name="xscale">1</property>
+				  <property name="yscale">1</property>
+				  <property name="top_padding">2</property>
+				  <property name="bottom_padding">6</property>
+				  <property name="left_padding">6</property>
+				  <property name="right_padding">6</property>
+
+				  <child>
+				    <widget class="GtkVBox" id="imageFileScalingVbox">
+				      <property name="visible">True</property>
+				      <property name="homogeneous">False</property>
+				      <property name="spacing">6</property>
+
+				      <child>
+					<widget class="GtkHBox" id="imageFileScalingAddHbox">
+					  <property name="visible">True</property>
+					  <property name="homogeneous">False</property>
+					  <property name="spacing">0</property>
+
+					  <child>
+					    <widget class="GtkLabel" id="imageFileScalingAddLabel">
+					      <property name="visible">True</property>
+					      <property name="label" translatable="yes">First, _add to each float pixel value:   </property>
+					      <property name="use_underline">True</property>
+					      <property name="use_markup">False</property>
+					      <property name="justify">GTK_JUSTIFY_LEFT</property>
+					      <property name="wrap">False</property>
+					      <property name="selectable">False</property>
+					      <property name="xalign">0.5</property>
+					      <property name="yalign">0.5</property>
+					      <property name="xpad">0</property>
+					      <property name="ypad">0</property>
+					      <property name="mnemonic_widget">imageFileScalingAddSpinButton</property>
+					      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+					      <property name="width_chars">-1</property>
+					      <property name="single_line_mode">False</property>
+					      <property name="angle">0</property>
+					    </widget>
+					    <packing>
+					      <property name="padding">0</property>
+					      <property name="expand">False</property>
+					      <property name="fill">False</property>
+					    </packing>
+					  </child>
+
+					  <child>
+					    <widget class="GtkSpinButton" id="imageFileScalingAddSpinButton">
+					      <property name="visible">True</property>
+					      <property name="can_focus">True</property>
+					      <property name="climb_rate">1</property>
+					      <property name="digits">5</property>
+					      <property name="numeric">True</property>
+					      <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+					      <property name="snap_to_ticks">False</property>
+					      <property name="wrap">False</property>
+					      <property name="adjustment">0 -99999 99999 0.10000000149 1 0</property>
+					    </widget>
+					    <packing>
+					      <property name="padding">0</property>
+					      <property name="expand">True</property>
+					      <property name="fill">True</property>
+					    </packing>
+					  </child>
+					</widget>
+					<packing>
+					  <property name="padding">0</property>
+					  <property name="expand">True</property>
+					  <property name="fill">True</property>
+					</packing>
+				      </child>
+
+				      <child>
+					<widget class="GtkHBox" id="imageFileScalingMultHbox">
+					  <property name="visible">True</property>
+					  <property name="homogeneous">False</property>
+					  <property name="spacing">0</property>
+
+					  <child>
+					    <widget class="GtkLabel" id="imageFileScalingMultLabel">
+					      <property name="visible">True</property>
+					      <property name="label" translatable="yes">Then, _multiply each float pixel value by:   </property>
+					      <property name="use_underline">True</property>
+					      <property name="use_markup">False</property>
+					      <property name="justify">GTK_JUSTIFY_LEFT</property>
+					      <property name="wrap">False</property>
+					      <property name="selectable">False</property>
+					      <property name="xalign">0.5</property>
+					      <property name="yalign">0.5</property>
+					      <property name="xpad">0</property>
+					      <property name="ypad">0</property>
+					      <property name="mnemonic_widget">imageFileScalingMultSpinButton</property>
+					      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+					      <property name="width_chars">-1</property>
+					      <property name="single_line_mode">False</property>
+					      <property name="angle">0</property>
+					    </widget>
+					    <packing>
+					      <property name="padding">0</property>
+					      <property name="expand">False</property>
+					      <property name="fill">False</property>
+					    </packing>
+					  </child>
+
+					  <child>
+					    <widget class="GtkSpinButton" id="imageFileScalingMultSpinButton">
+					      <property name="visible">True</property>
+					      <property name="can_focus">True</property>
+					      <property name="climb_rate">1</property>
+					      <property name="digits">5</property>
+					      <property name="numeric">True</property>
+					      <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+					      <property name="snap_to_ticks">False</property>
+					      <property name="wrap">False</property>
+					      <property name="adjustment">1 -99999 99999 0.0010000000475 0.0010000000475 0</property>
+					    </widget>
+					    <packing>
+					      <property name="padding">0</property>
+					      <property name="expand">True</property>
+					      <property name="fill">True</property>
+					    </packing>
+					  </child>
+					</widget>
+					<packing>
+					  <property name="padding">0</property>
+					  <property name="expand">True</property>
+					  <property name="fill">True</property>
+					</packing>
+				      </child>
+
+				      <child>
+					<widget class="GtkVBox" id="imageFileScalingMinVbox">
+					  <property name="visible">True</property>
+					  <property name="homogeneous">False</property>
+					  <property name="spacing">0</property>
+
+					  <child>
+					    <widget class="GtkLabel" id="imageFileScalingMinLabel">
+					      <property name="visible">True</property>
+					      <property name="label" translatable="yes">Mi_nimum loaded pixel value (will be scaled to 0):</property>
+					      <property name="use_underline">True</property>
+					      <property name="use_markup">False</property>
+					      <property name="justify">GTK_JUSTIFY_LEFT</property>
+					      <property name="wrap">False</property>
+					      <property name="selectable">False</property>
+					      <property name="xalign">0</property>
+					      <property name="yalign">0.5</property>
+					      <property name="xpad">0</property>
+					      <property name="ypad">0</property>
+					      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+					      <property name="width_chars">-1</property>
+					      <property name="single_line_mode">False</property>
+					      <property name="angle">0</property>
+					    </widget>
+					    <packing>
+					      <property name="padding">0</property>
+					      <property name="expand">False</property>
+					      <property name="fill">False</property>
+					    </packing>
+					  </child>
+
+					  <child>
+					    <widget class="GtkHBox" id="imageFileScalingMinHbox">
+					      <property name="visible">True</property>
+					      <property name="homogeneous">False</property>
+					      <property name="spacing">5</property>
+
+					      <child>
+						<widget class="GtkHScale" id="imageFileScalingMinSlider">
+						  <property name="visible">True</property>
+						  <property name="can_focus">True</property>
+						  <property name="draw_value">False</property>
+						  <property name="value_pos">GTK_POS_LEFT</property>
+						  <property name="digits">0</property>
+						  <property name="update_policy">GTK_UPDATE_CONTINUOUS</property>
+						  <property name="inverted">False</property>
+						  <property name="adjustment">0 -1024 1024 1 1 0</property>
+						</widget>
+						<packing>
+						  <property name="padding">0</property>
+						  <property name="expand">True</property>
+						  <property name="fill">True</property>
+						</packing>
+					      </child>
+
+					      <child>
+						<widget class="GtkSpinButton" id="imageFileScalingMinSpinner">
+						  <property name="visible">True</property>
+						  <property name="can_focus">True</property>
+						  <property name="climb_rate">1</property>
+						  <property name="digits">1</property>
+						  <property name="numeric">True</property>
+						  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+						  <property name="snap_to_ticks">False</property>
+						  <property name="wrap">False</property>
+						  <property name="adjustment">0 -1024 1024 1 2 0</property>
+						</widget>
+						<packing>
+						  <property name="padding">0</property>
+						  <property name="expand">False</property>
+						  <property name="fill">True</property>
+						</packing>
+					      </child>
+					    </widget>
+					    <packing>
+					      <property name="padding">0</property>
+					      <property name="expand">True</property>
+					      <property name="fill">True</property>
+					    </packing>
+					  </child>
+					</widget>
+					<packing>
+					  <property name="padding">0</property>
+					  <property name="expand">True</property>
+					  <property name="fill">True</property>
+					</packing>
+				      </child>
+
+				      <child>
+					<widget class="GtkVBox" id="imageFileScalingMaxVbox">
+					  <property name="visible">True</property>
+					  <property name="homogeneous">False</property>
+					  <property name="spacing">0</property>
+
+					  <child>
+					    <widget class="GtkLabel" id="imageFileScalingMaxLabel">
+					      <property name="visible">True</property>
+					      <property name="label" translatable="yes">Ma_ximum loaded pixel value (will be scaled to 255):</property>
+					      <property name="use_underline">True</property>
+					      <property name="use_markup">False</property>
+					      <property name="justify">GTK_JUSTIFY_LEFT</property>
+					      <property name="wrap">False</property>
+					      <property name="selectable">False</property>
+					      <property name="xalign">0</property>
+					      <property name="yalign">0.5</property>
+					      <property name="xpad">0</property>
+					      <property name="ypad">0</property>
+					      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+					      <property name="width_chars">-1</property>
+					      <property name="single_line_mode">False</property>
+					      <property name="angle">0</property>
+					    </widget>
+					    <packing>
+					      <property name="padding">0</property>
+					      <property name="expand">False</property>
+					      <property name="fill">False</property>
+					    </packing>
+					  </child>
+
+					  <child>
+					    <widget class="GtkHBox" id="imageFileScalingMaxHbox">
+					      <property name="visible">True</property>
+					      <property name="homogeneous">False</property>
+					      <property name="spacing">5</property>
+
+					      <child>
+						<widget class="GtkHScale" id="imageFileScalingMaxSlider">
+						  <property name="visible">True</property>
+						  <property name="can_focus">True</property>
+						  <property name="draw_value">False</property>
+						  <property name="value_pos">GTK_POS_LEFT</property>
+						  <property name="digits">0</property>
+						  <property name="update_policy">GTK_UPDATE_CONTINUOUS</property>
+						  <property name="inverted">False</property>
+						  <property name="adjustment">255 -1024 1024 1 1 0</property>
+						</widget>
+						<packing>
+						  <property name="padding">0</property>
+						  <property name="expand">True</property>
+						  <property name="fill">True</property>
+						</packing>
+					      </child>
+
+					      <child>
+						<widget class="GtkSpinButton" id="imageFileScalingMaxSpinner">
+						  <property name="visible">True</property>
+						  <property name="can_focus">True</property>
+						  <property name="climb_rate">1</property>
+						  <property name="digits">1</property>
+						  <property name="numeric">True</property>
+						  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+						  <property name="snap_to_ticks">False</property>
+						  <property name="wrap">False</property>
+						  <property name="adjustment">255 -1024 1024 1 2 0</property>
+						</widget>
+						<packing>
+						  <property name="padding">0</property>
+						  <property name="expand">False</property>
+						  <property name="fill">True</property>
+						</packing>
+					      </child>
+					    </widget>
+					    <packing>
+					      <property name="padding">0</property>
+					      <property name="expand">True</property>
+					      <property name="fill">True</property>
+					    </packing>
+					  </child>
+					</widget>
+					<packing>
+					  <property name="padding">0</property>
+					  <property name="expand">True</property>
+					  <property name="fill">True</property>
+					</packing>
+				      </child>
+				    </widget>
+				  </child>
+				</widget>
+			      </child>
+
+			      <child>
+				<widget class="GtkLabel" id="imageFileScalingFrameLabel">
+				  <property name="visible">True</property>
+				  <property name="label" translatable="yes">Pixel Value Scaling as Image File is Loaded</property>
+				  <property name="use_underline">False</property>
+				  <property name="use_markup">True</property>
+				  <property name="justify">GTK_JUSTIFY_LEFT</property>
+				  <property name="wrap">False</property>
+				  <property name="selectable">False</property>
+				  <property name="xalign">0.5</property>
+				  <property name="yalign">0.5</property>
+				  <property name="xpad">0</property>
+				  <property name="ypad">0</property>
+				  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+				  <property name="width_chars">-1</property>
+				  <property name="single_line_mode">False</property>
+				  <property name="angle">0</property>
+				</widget>
+				<packing>
+				  <property name="type">label_item</property>
+				</packing>
+			      </child>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkVBox" id="constantSettingsVbox">
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">6</property>
+
+			  <child>
+			    <widget class="GtkHBox" id="constantValueHbox">
+			      <property name="visible">True</property>
+			      <property name="homogeneous">False</property>
+			      <property name="spacing">0</property>
+
+			      <child>
+				<widget class="GtkLabel" id="constantValueLabel">
+				  <property name="visible">True</property>
+				  <property name="label" translatable="yes">Input _Constant:      </property>
+				  <property name="use_underline">True</property>
+				  <property name="use_markup">False</property>
+				  <property name="justify">GTK_JUSTIFY_LEFT</property>
+				  <property name="wrap">False</property>
+				  <property name="selectable">False</property>
+				  <property name="xalign">0.5</property>
+				  <property name="yalign">0.5</property>
+				  <property name="xpad">0</property>
+				  <property name="ypad">0</property>
+				  <property name="mnemonic_widget">constantValueSpinButton</property>
+				  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+				  <property name="width_chars">-1</property>
+				  <property name="single_line_mode">False</property>
+				  <property name="angle">0</property>
+				</widget>
+				<packing>
+				  <property name="padding">0</property>
+				  <property name="expand">False</property>
+				  <property name="fill">False</property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkSpinButton" id="constantValueSpinButton">
+				  <property name="visible">True</property>
+				  <property name="can_focus">True</property>
+				  <property name="climb_rate">1</property>
+				  <property name="digits">3</property>
+				  <property name="numeric">True</property>
+				  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+				  <property name="snap_to_ticks">False</property>
+				  <property name="wrap">False</property>
+				  <property name="adjustment">0 -99999 99999 0.10000000149 1 0</property>
+				</widget>
+				<packing>
+				  <property name="padding">0</property>
+				  <property name="expand">True</property>
+				  <property name="fill">True</property>
+				</packing>
+			      </child>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkVBox" id="rollingAvgSettingsVbox">
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">6</property>
+
+			  <child>
+			    <widget class="GtkHBox" id="rollingAvgAlphaHbox">
+			      <property name="visible">True</property>
+			      <property name="homogeneous">False</property>
+			      <property name="spacing">0</property>
+
+			      <child>
+				<widget class="GtkLabel" id="rollingAvgAlphaLabel">
+				  <property name="visible">True</property>
+				  <property name="label" translatable="yes">Memory constant _alpha:   </property>
+				  <property name="use_underline">True</property>
+				  <property name="use_markup">False</property>
+				  <property name="justify">GTK_JUSTIFY_LEFT</property>
+				  <property name="wrap">False</property>
+				  <property name="selectable">False</property>
+				  <property name="xalign">0.5</property>
+				  <property name="yalign">0.5</property>
+				  <property name="xpad">0</property>
+				  <property name="ypad">0</property>
+				  <property name="mnemonic_widget">rollingAvgAlphaSpinButton</property>
+				  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+				  <property name="width_chars">-1</property>
+				  <property name="single_line_mode">False</property>
+				  <property name="angle">0</property>
+				</widget>
+				<packing>
+				  <property name="padding">0</property>
+				  <property name="expand">False</property>
+				  <property name="fill">True</property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkSpinButton" id="rollingAvgAlphaSpinButton">
+				  <property name="visible">True</property>
+				  <property name="can_focus">True</property>
+				  <property name="climb_rate">1</property>
+				  <property name="digits">5</property>
+				  <property name="numeric">True</property>
+				  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+				  <property name="snap_to_ticks">False</property>
+				  <property name="wrap">False</property>
+				  <property name="adjustment">0.00999999977648 9.99999996004e-12 999 0.0010000000475 0.0010000000475 0</property>
+				</widget>
+				<packing>
+				  <property name="padding">0</property>
+				  <property name="expand">False</property>
+				  <property name="fill">True</property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkLabel" id="rollingAvgAlphaEqualsLabel">
+				  <property name="visible">True</property>
+				  <property name="label" translatable="yes"> = 1 / </property>
+				  <property name="use_underline">False</property>
+				  <property name="use_markup">False</property>
+				  <property name="justify">GTK_JUSTIFY_LEFT</property>
+				  <property name="wrap">False</property>
+				  <property name="selectable">False</property>
+				  <property name="xalign">0.5</property>
+				  <property name="yalign">0.5</property>
+				  <property name="xpad">0</property>
+				  <property name="ypad">0</property>
+				  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+				  <property name="width_chars">-1</property>
+				  <property name="single_line_mode">False</property>
+				  <property name="angle">0</property>
+				</widget>
+				<packing>
+				  <property name="padding">0</property>
+				  <property name="expand">False</property>
+				  <property name="fill">False</property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkSpinButton" id="rollingAvgAlphaDenomSpinButton">
+				  <property name="visible">True</property>
+				  <property name="can_focus">True</property>
+				  <property name="climb_rate">1</property>
+				  <property name="digits">4</property>
+				  <property name="numeric">True</property>
+				  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+				  <property name="snap_to_ticks">False</property>
+				  <property name="wrap">False</property>
+				  <property name="adjustment">100 0.0010000000475 99999 1 1 0</property>
+				</widget>
+				<packing>
+				  <property name="padding">0</property>
+				  <property name="expand">False</property>
+				  <property name="fill">True</property>
+				</packing>
+			      </child>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkVBox" id="rollingAvgInitVbox">
+			      <property name="visible">True</property>
+			      <property name="homogeneous">False</property>
+			      <property name="spacing">0</property>
+
+			      <child>
+				<widget class="GtkHBox" id="rollingAvgInitHbox1">
+				  <property name="visible">True</property>
+				  <property name="homogeneous">False</property>
+				  <property name="spacing">0</property>
+
+				  <child>
+				    <widget class="GtkLabel" id="rollingAvgInitLabel1">
+				      <property name="visible">True</property>
+				      <property name="label" translatable="yes">_Initial average (&quot;head start&quot;) is </property>
+				      <property name="use_underline">True</property>
+				      <property name="use_markup">False</property>
+				      <property name="justify">GTK_JUSTIFY_LEFT</property>
+				      <property name="wrap">False</property>
+				      <property name="selectable">False</property>
+				      <property name="xalign">0.5</property>
+				      <property name="yalign">0.5</property>
+				      <property name="xpad">0</property>
+				      <property name="ypad">0</property>
+				      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+				      <property name="width_chars">-1</property>
+				      <property name="single_line_mode">False</property>
+				      <property name="angle">0</property>
+				    </widget>
+				    <packing>
+				      <property name="padding">0</property>
+				      <property name="expand">False</property>
+				      <property name="fill">False</property>
+				    </packing>
+				  </child>
+
+				  <child>
+				    <widget class="GtkComboBox" id="rollingAvgInitTypeMenu">
+				      <property name="visible">True</property>
+				      <property name="items" translatable="yes">straight
+rolling</property>
+				      <property name="add_tearoffs">False</property>
+				      <property name="focus_on_click">True</property>
+				    </widget>
+				    <packing>
+				      <property name="padding">0</property>
+				      <property name="expand">False</property>
+				      <property name="fill">True</property>
+				    </packing>
+				  </child>
+
+				  <child>
+				    <widget class="GtkLabel" id="rollingAvgInitLabel2">
+				      <property name="visible">True</property>
+				      <property name="label" translatable="yes"> average</property>
+				      <property name="use_underline">False</property>
+				      <property name="use_markup">False</property>
+				      <property name="justify">GTK_JUSTIFY_LEFT</property>
+				      <property name="wrap">False</property>
+				      <property name="selectable">False</property>
+				      <property name="xalign">0.5</property>
+				      <property name="yalign">0.5</property>
+				      <property name="xpad">0</property>
+				      <property name="ypad">0</property>
+				      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+				      <property name="width_chars">-1</property>
+				      <property name="single_line_mode">False</property>
+				      <property name="angle">0</property>
+				    </widget>
+				    <packing>
+				      <property name="padding">0</property>
+				      <property name="expand">False</property>
+				      <property name="fill">False</property>
+				    </packing>
+				  </child>
+				</widget>
+				<packing>
+				  <property name="padding">0</property>
+				  <property name="expand">True</property>
+				  <property name="fill">True</property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkHBox" id="rollingAvgInitHbox2">
+				  <property name="visible">True</property>
+				  <property name="homogeneous">False</property>
+				  <property name="spacing">0</property>
+
+				  <child>
+				    <widget class="GtkLabel" id="rollingAvgInitLabel3">
+				      <property name="visible">True</property>
+				      <property name="label" translatable="yes">      of frames </property>
+				      <property name="use_underline">False</property>
+				      <property name="use_markup">False</property>
+				      <property name="justify">GTK_JUSTIFY_LEFT</property>
+				      <property name="wrap">False</property>
+				      <property name="selectable">False</property>
+				      <property name="xalign">0.5</property>
+				      <property name="yalign">0.5</property>
+				      <property name="xpad">0</property>
+				      <property name="ypad">0</property>
+				      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+				      <property name="width_chars">-1</property>
+				      <property name="single_line_mode">False</property>
+				      <property name="angle">0</property>
+				    </widget>
+				    <packing>
+				      <property name="padding">0</property>
+				      <property name="expand">False</property>
+				      <property name="fill">False</property>
+				    </packing>
+				  </child>
+
+				  <child>
+				    <widget class="GtkSpinButton" id="rollingAvgInitStartSpinButton">
+				      <property name="visible">True</property>
+				      <property name="can_focus">True</property>
+				      <property name="climb_rate">1</property>
+				      <property name="digits">0</property>
+				      <property name="numeric">True</property>
+				      <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+				      <property name="snap_to_ticks">False</property>
+				      <property name="wrap">False</property>
+				      <property name="adjustment">1 1 99999 1 1 0</property>
+				    </widget>
+				    <packing>
+				      <property name="padding">0</property>
+				      <property name="expand">False</property>
+				      <property name="fill">True</property>
+				    </packing>
+				  </child>
+
+				  <child>
+				    <widget class="GtkLabel" id="rollingAvgInitLabel4">
+				      <property name="visible">True</property>
+				      <property name="label" translatable="yes"> through </property>
+				      <property name="use_underline">False</property>
+				      <property name="use_markup">False</property>
+				      <property name="justify">GTK_JUSTIFY_LEFT</property>
+				      <property name="wrap">False</property>
+				      <property name="selectable">False</property>
+				      <property name="xalign">0.5</property>
+				      <property name="yalign">0.5</property>
+				      <property name="xpad">0</property>
+				      <property name="ypad">0</property>
+				      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+				      <property name="width_chars">-1</property>
+				      <property name="single_line_mode">False</property>
+				      <property name="angle">0</property>
+				    </widget>
+				    <packing>
+				      <property name="padding">0</property>
+				      <property name="expand">False</property>
+				      <property name="fill">False</property>
+				    </packing>
+				  </child>
+
+				  <child>
+				    <widget class="GtkSpinButton" id="rollingAvgInitEndSpinButton">
+				      <property name="visible">True</property>
+				      <property name="can_focus">True</property>
+				      <property name="climb_rate">1</property>
+				      <property name="digits">0</property>
+				      <property name="numeric">True</property>
+				      <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+				      <property name="snap_to_ticks">False</property>
+				      <property name="wrap">False</property>
+				      <property name="adjustment">100 1 99999 1 1 0</property>
+				    </widget>
+				    <packing>
+				      <property name="padding">0</property>
+				      <property name="expand">False</property>
+				      <property name="fill">True</property>
+				    </packing>
+				  </child>
+				</widget>
+				<packing>
+				  <property name="padding">0</property>
+				  <property name="expand">True</property>
+				  <property name="fill">True</property>
+				</packing>
+			      </child>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkHSeparator" id="bottomSeparator">
+			  <property name="visible">True</property>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkVBox" id="biasVbox">
+			  <property name="visible">True</property>
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">0</property>
+
+			  <child>
+			    <widget class="GtkLabel" id="biasLabel">
+			      <property name="visible">True</property>
+			      <property name="label" translatable="yes">Integer _Bias (will be added to result of selected operation):</property>
+			      <property name="use_underline">True</property>
+			      <property name="use_markup">False</property>
+			      <property name="justify">GTK_JUSTIFY_LEFT</property>
+			      <property name="wrap">False</property>
+			      <property name="selectable">False</property>
+			      <property name="xalign">0</property>
+			      <property name="yalign">0.5</property>
+			      <property name="xpad">0</property>
+			      <property name="ypad">0</property>
+			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			      <property name="width_chars">-1</property>
+			      <property name="single_line_mode">False</property>
+			      <property name="angle">0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">False</property>
+			      <property name="fill">False</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkHBox" id="biasHbox">
+			      <property name="visible">True</property>
+			      <property name="homogeneous">False</property>
+			      <property name="spacing">5</property>
+
+			      <child>
+				<widget class="GtkHScale" id="biasSlider">
+				  <property name="visible">True</property>
+				  <property name="can_focus">True</property>
+				  <property name="draw_value">False</property>
+				  <property name="value_pos">GTK_POS_LEFT</property>
+				  <property name="digits">0</property>
+				  <property name="update_policy">GTK_UPDATE_CONTINUOUS</property>
+				  <property name="inverted">False</property>
+				  <property name="adjustment">128 -256 256 1 1 0</property>
+				</widget>
+				<packing>
+				  <property name="padding">0</property>
+				  <property name="expand">True</property>
+				  <property name="fill">True</property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkSpinButton" id="biasSpinner">
+				  <property name="visible">True</property>
+				  <property name="can_focus">True</property>
+				  <property name="climb_rate">1</property>
+				  <property name="digits">0</property>
+				  <property name="numeric">True</property>
+				  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+				  <property name="snap_to_ticks">False</property>
+				  <property name="wrap">False</property>
+				  <property name="adjustment">128 -256 256 1 1 0</property>
+				</widget>
+				<packing>
+				  <property name="padding">0</property>
+				  <property name="expand">False</property>
+				  <property name="fill">True</property>
+				</packing>
+			      </child>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkFrame" id="resultScalingFrame">
+			  <property name="visible">True</property>
+			  <property name="label_xalign">0</property>
+			  <property name="label_yalign">0.5</property>
+			  <property name="shadow_type">GTK_SHADOW_IN</property>
+
+			  <child>
+			    <widget class="GtkAlignment" id="resultScalingAlignment">
+			      <property name="visible">True</property>
+			      <property name="xalign">0.5</property>
+			      <property name="yalign">0.5</property>
+			      <property name="xscale">1</property>
+			      <property name="yscale">1</property>
+			      <property name="top_padding">2</property>
+			      <property name="bottom_padding">6</property>
+			      <property name="left_padding">6</property>
+			      <property name="right_padding">6</property>
+
+			      <child>
+				<widget class="GtkVBox" id="resultScalingVbox">
+				  <property name="visible">True</property>
+				  <property name="homogeneous">False</property>
+				  <property name="spacing">6</property>
+
+				  <child>
+				    <widget class="GtkHBox" id="resultScalingAddHbox">
+				      <property name="visible">True</property>
+				      <property name="homogeneous">False</property>
+				      <property name="spacing">0</property>
+
+				      <child>
+					<widget class="GtkLabel" id="resultScalingAddLabel">
+					  <property name="visible">True</property>
+					  <property name="label" translatable="yes">First, _add to each pixel result value:   </property>
+					  <property name="use_underline">True</property>
+					  <property name="use_markup">False</property>
+					  <property name="justify">GTK_JUSTIFY_LEFT</property>
+					  <property name="wrap">False</property>
+					  <property name="selectable">False</property>
+					  <property name="xalign">0.5</property>
+					  <property name="yalign">0.5</property>
+					  <property name="xpad">0</property>
+					  <property name="ypad">0</property>
+					  <property name="mnemonic_widget">resultScalingAddSpinButton</property>
+					  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+					  <property name="width_chars">-1</property>
+					  <property name="single_line_mode">False</property>
+					  <property name="angle">0</property>
+					</widget>
+					<packing>
+					  <property name="padding">0</property>
+					  <property name="expand">False</property>
+					  <property name="fill">False</property>
+					</packing>
+				      </child>
+
+				      <child>
+					<widget class="GtkSpinButton" id="resultScalingAddSpinButton">
+					  <property name="visible">True</property>
+					  <property name="can_focus">True</property>
+					  <property name="climb_rate">1</property>
+					  <property name="digits">5</property>
+					  <property name="numeric">True</property>
+					  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+					  <property name="snap_to_ticks">False</property>
+					  <property name="wrap">False</property>
+					  <property name="adjustment">0 -99999 99999 0.10000000149 1 0</property>
+					</widget>
+					<packing>
+					  <property name="padding">0</property>
+					  <property name="expand">True</property>
+					  <property name="fill">True</property>
+					</packing>
+				      </child>
+				    </widget>
+				    <packing>
+				      <property name="padding">0</property>
+				      <property name="expand">True</property>
+				      <property name="fill">True</property>
+				    </packing>
+				  </child>
+
+				  <child>
+				    <widget class="GtkHBox" id="resultScalingMultHbox">
+				      <property name="visible">True</property>
+				      <property name="homogeneous">False</property>
+				      <property name="spacing">0</property>
+
+				      <child>
+					<widget class="GtkLabel" id="resultScalingMultLabel">
+					  <property name="visible">True</property>
+					  <property name="label" translatable="yes">Then, _multiply each pixel result value by:   </property>
+					  <property name="use_underline">True</property>
+					  <property name="use_markup">False</property>
+					  <property name="justify">GTK_JUSTIFY_LEFT</property>
+					  <property name="wrap">False</property>
+					  <property name="selectable">False</property>
+					  <property name="xalign">0.5</property>
+					  <property name="yalign">0.5</property>
+					  <property name="xpad">0</property>
+					  <property name="ypad">0</property>
+					  <property name="mnemonic_widget">resultScalingMultSpinButton</property>
+					  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+					  <property name="width_chars">-1</property>
+					  <property name="single_line_mode">False</property>
+					  <property name="angle">0</property>
+					</widget>
+					<packing>
+					  <property name="padding">0</property>
+					  <property name="expand">False</property>
+					  <property name="fill">False</property>
+					</packing>
+				      </child>
+
+				      <child>
+					<widget class="GtkSpinButton" id="resultScalingMultSpinButton">
+					  <property name="visible">True</property>
+					  <property name="can_focus">True</property>
+					  <property name="climb_rate">1</property>
+					  <property name="digits">5</property>
+					  <property name="numeric">True</property>
+					  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+					  <property name="snap_to_ticks">False</property>
+					  <property name="wrap">False</property>
+					  <property name="adjustment">1 -99999 99999 0.0010000000475 0.0010000000475 0</property>
+					</widget>
+					<packing>
+					  <property name="padding">0</property>
+					  <property name="expand">True</property>
+					  <property name="fill">True</property>
+					</packing>
+				      </child>
+				    </widget>
+				    <packing>
+				      <property name="padding">0</property>
+				      <property name="expand">True</property>
+				      <property name="fill">True</property>
+				    </packing>
+				  </child>
+
+				  <child>
+				    <widget class="GtkVBox" id="resultScalingMinVbox">
+				      <property name="visible">True</property>
+				      <property name="homogeneous">False</property>
+				      <property name="spacing">0</property>
+
+				      <child>
+					<widget class="GtkLabel" id="resultScalingMinLabel">
+					  <property name="visible">True</property>
+					  <property name="label" translatable="yes">Mi_nimum result value (will be scaled to 0):</property>
+					  <property name="use_underline">True</property>
+					  <property name="use_markup">False</property>
+					  <property name="justify">GTK_JUSTIFY_LEFT</property>
+					  <property name="wrap">False</property>
+					  <property name="selectable">False</property>
+					  <property name="xalign">0</property>
+					  <property name="yalign">0.5</property>
+					  <property name="xpad">0</property>
+					  <property name="ypad">0</property>
+					  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+					  <property name="width_chars">-1</property>
+					  <property name="single_line_mode">False</property>
+					  <property name="angle">0</property>
+					</widget>
+					<packing>
+					  <property name="padding">0</property>
+					  <property name="expand">False</property>
+					  <property name="fill">False</property>
+					</packing>
+				      </child>
+
+				      <child>
+					<widget class="GtkHBox" id="resultScalingMinHbox">
+					  <property name="visible">True</property>
+					  <property name="homogeneous">False</property>
+					  <property name="spacing">5</property>
+
+					  <child>
+					    <widget class="GtkHScale" id="resultScalingMinSlider">
+					      <property name="visible">True</property>
+					      <property name="can_focus">True</property>
+					      <property name="draw_value">False</property>
+					      <property name="value_pos">GTK_POS_LEFT</property>
+					      <property name="digits">0</property>
+					      <property name="update_policy">GTK_UPDATE_CONTINUOUS</property>
+					      <property name="inverted">False</property>
+					      <property name="adjustment">0 -1024 1024 1 1 0</property>
+					    </widget>
+					    <packing>
+					      <property name="padding">0</property>
+					      <property name="expand">True</property>
+					      <property name="fill">True</property>
+					    </packing>
+					  </child>
+
+					  <child>
+					    <widget class="GtkSpinButton" id="resultScalingMinSpinner">
+					      <property name="visible">True</property>
+					      <property name="can_focus">True</property>
+					      <property name="climb_rate">1</property>
+					      <property name="digits">1</property>
+					      <property name="numeric">True</property>
+					      <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+					      <property name="snap_to_ticks">False</property>
+					      <property name="wrap">False</property>
+					      <property name="adjustment">0 -1024 1024 1 2 0</property>
+					    </widget>
+					    <packing>
+					      <property name="padding">0</property>
+					      <property name="expand">False</property>
+					      <property name="fill">True</property>
+					    </packing>
+					  </child>
+					</widget>
+					<packing>
+					  <property name="padding">0</property>
+					  <property name="expand">True</property>
+					  <property name="fill">True</property>
+					</packing>
+				      </child>
+				    </widget>
+				    <packing>
+				      <property name="padding">0</property>
+				      <property name="expand">True</property>
+				      <property name="fill">True</property>
+				    </packing>
+				  </child>
+
+				  <child>
+				    <widget class="GtkVBox" id="resultScalingMaxVbox">
+				      <property name="visible">True</property>
+				      <property name="homogeneous">False</property>
+				      <property name="spacing">0</property>
+
+				      <child>
+					<widget class="GtkLabel" id="resultScalingMaxLabel">
+					  <property name="visible">True</property>
+					  <property name="label" translatable="yes">Ma_ximum result value (will be scaled to 255):</property>
+					  <property name="use_underline">True</property>
+					  <property name="use_markup">False</property>
+					  <property name="justify">GTK_JUSTIFY_LEFT</property>
+					  <property name="wrap">False</property>
+					  <property name="selectable">False</property>
+					  <property name="xalign">0</property>
+					  <property name="yalign">0.5</property>
+					  <property name="xpad">0</property>
+					  <property name="ypad">0</property>
+					  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+					  <property name="width_chars">-1</property>
+					  <property name="single_line_mode">False</property>
+					  <property name="angle">0</property>
+					</widget>
+					<packing>
+					  <property name="padding">0</property>
+					  <property name="expand">False</property>
+					  <property name="fill">False</property>
+					</packing>
+				      </child>
+
+				      <child>
+					<widget class="GtkHBox" id="resultScalingMaxHbox">
+					  <property name="visible">True</property>
+					  <property name="homogeneous">False</property>
+					  <property name="spacing">5</property>
+
+					  <child>
+					    <widget class="GtkHScale" id="resultScalingMaxSlider">
+					      <property name="visible">True</property>
+					      <property name="can_focus">True</property>
+					      <property name="draw_value">False</property>
+					      <property name="value_pos">GTK_POS_LEFT</property>
+					      <property name="digits">0</property>
+					      <property name="update_policy">GTK_UPDATE_CONTINUOUS</property>
+					      <property name="inverted">False</property>
+					      <property name="adjustment">255 -1024 1024 1 1 0</property>
+					    </widget>
+					    <packing>
+					      <property name="padding">0</property>
+					      <property name="expand">True</property>
+					      <property name="fill">True</property>
+					    </packing>
+					  </child>
+
+					  <child>
+					    <widget class="GtkSpinButton" id="resultScalingMaxSpinner">
+					      <property name="visible">True</property>
+					      <property name="can_focus">True</property>
+					      <property name="climb_rate">1</property>
+					      <property name="digits">1</property>
+					      <property name="numeric">True</property>
+					      <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+					      <property name="snap_to_ticks">False</property>
+					      <property name="wrap">False</property>
+					      <property name="adjustment">255 -1024 1024 1 2 0</property>
+					    </widget>
+					    <packing>
+					      <property name="padding">0</property>
+					      <property name="expand">False</property>
+					      <property name="fill">True</property>
+					    </packing>
+					  </child>
+					</widget>
+					<packing>
+					  <property name="padding">0</property>
+					  <property name="expand">True</property>
+					  <property name="fill">True</property>
+					</packing>
+				      </child>
+				    </widget>
+				    <packing>
+				      <property name="padding">0</property>
+				      <property name="expand">True</property>
+				      <property name="fill">True</property>
+				    </packing>
+				  </child>
+				</widget>
+			      </child>
+			    </widget>
+			  </child>
+
+			  <child>
+			    <widget class="GtkLabel" id="resultScalingFrameLabel">
+			      <property name="visible">True</property>
+			      <property name="label" translatable="yes">Pixel Value Scaling on Result of Selected Operation</property>
+			      <property name="use_underline">False</property>
+			      <property name="use_markup">True</property>
+			      <property name="justify">GTK_JUSTIFY_LEFT</property>
+			      <property name="wrap">False</property>
+			      <property name="selectable">False</property>
+			      <property name="xalign">0.5</property>
+			      <property name="yalign">0.5</property>
+			      <property name="xpad">0</property>
+			      <property name="ypad">0</property>
+			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			      <property name="width_chars">-1</property>
+			      <property name="single_line_mode">False</property>
+			      <property name="angle">0</property>
+			    </widget>
+			    <packing>
+			      <property name="type">label_item</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkHSeparator" id="hseparator2">
+			  <property name="visible">True</property>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkLabel" id="currentConfigDescription">
+			  <property name="visible">True</property>
+			  <property name="can_focus">True</property>
+			  <property name="label" translatable="yes">(description of current config will go here)</property>
+			  <property name="use_underline">False</property>
+			  <property name="use_markup">True</property>
+			  <property name="justify">GTK_JUSTIFY_LEFT</property>
+			  <property name="wrap">True</property>
+			  <property name="selectable">True</property>
+			  <property name="xalign">0</property>
+			  <property name="yalign">0.5</property>
+			  <property name="xpad">0</property>
+			  <property name="ypad">0</property>
+			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			  <property name="width_chars">-1</property>
+			  <property name="single_line_mode">False</property>
+			  <property name="angle">0</property>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">False</property>
+			  <property name="fill">False</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkHSeparator" id="hseparator1">
+			  <property name="visible">True</property>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkHBox" id="histogramHbox">
+			  <property name="visible">True</property>
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">0</property>
+
+			  <child>
+			    <widget class="GtkLabel" id="histogramLabel">
+			      <property name="visible">True</property>
+			      <property name="label" translatable="yes">_Histogram every N frames (0 to disable):   </property>
+			      <property name="use_underline">True</property>
+			      <property name="use_markup">False</property>
+			      <property name="justify">GTK_JUSTIFY_LEFT</property>
+			      <property name="wrap">False</property>
+			      <property name="selectable">False</property>
+			      <property name="xalign">0.5</property>
+			      <property name="yalign">0.5</property>
+			      <property name="xpad">0</property>
+			      <property name="ypad">0</property>
+			      <property name="mnemonic_widget">histogramSpinButton</property>
+			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			      <property name="width_chars">-1</property>
+			      <property name="single_line_mode">False</property>
+			      <property name="angle">0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">False</property>
+			      <property name="fill">False</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkSpinButton" id="histogramSpinButton">
+			      <property name="visible">True</property>
+			      <property name="can_focus">True</property>
+			      <property name="climb_rate">1</property>
+			      <property name="digits">0</property>
+			      <property name="numeric">True</property>
+			      <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+			      <property name="snap_to_ticks">False</property>
+			      <property name="wrap">False</property>
+			      <property name="adjustment">0 0 16777215 1 10 0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkHBox" id="debugHbox">
+			  <property name="visible">True</property>
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">0</property>
+
+			  <child>
+			    <widget class="GtkLabel" id="debugLabel">
+			      <property name="visible">True</property>
+			      <property name="label" translatable="yes">_Debugging settings (bits):   </property>
+			      <property name="use_underline">True</property>
+			      <property name="use_markup">False</property>
+			      <property name="justify">GTK_JUSTIFY_LEFT</property>
+			      <property name="wrap">False</property>
+			      <property name="selectable">False</property>
+			      <property name="xalign">0.5</property>
+			      <property name="yalign">0.5</property>
+			      <property name="xpad">0</property>
+			      <property name="ypad">0</property>
+			      <property name="mnemonic_widget">debugSpinButton</property>
+			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			      <property name="width_chars">-1</property>
+			      <property name="single_line_mode">False</property>
+			      <property name="angle">0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">False</property>
+			      <property name="fill">False</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkSpinButton" id="debugSpinButton">
+			      <property name="visible">True</property>
+			      <property name="can_focus">True</property>
+			      <property name="climb_rate">1</property>
+			      <property name="digits">0</property>
+			      <property name="numeric">True</property>
+			      <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+			      <property name="snap_to_ticks">False</property>
+			      <property name="wrap">False</property>
+			      <property name="adjustment">0 0 16777215 1 10 0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+		    </widget>
+		    <packing>
+		      <property name="padding">0</property>
+		      <property name="expand">True</property>
+		      <property name="fill">True</property>
+		    </packing>
+		  </child>
+		</widget>
+		<packing>
+		  <property name="padding">0</property>
+		  <property name="expand">False</property>
+		  <property name="fill">True</property>
+		</packing>
+	      </child>
+	    </widget>
+	    <packing>
+	      <property name="padding">0</property>
+	      <property name="expand">True</property>
+	      <property name="fill">True</property>
+	    </packing>
+	  </child>
+
+	  <child>
+	    <widget class="GtkVBox" id="previewVboxOuter">
+	      <property name="visible">True</property>
+	      <property name="homogeneous">False</property>
+	      <property name="spacing">0</property>
+
+	      <child>
+		<widget class="GtkFrame" id="previewFrame">
+		  <property name="visible">True</property>
+		  <property name="label_xalign">0</property>
+		  <property name="label_yalign">0.5</property>
+		  <property name="shadow_type">GTK_SHADOW_ETCHED_IN</property>
+
+		  <child>
+		    <widget class="GtkAlignment" id="previewAlignment">
+		      <property name="visible">True</property>
+		      <property name="xalign">0.5</property>
+		      <property name="yalign">0.5</property>
+		      <property name="xscale">1</property>
+		      <property name="yscale">1</property>
+		      <property name="top_padding">0</property>
+		      <property name="bottom_padding">8</property>
+		      <property name="left_padding">6</property>
+		      <property name="right_padding">8</property>
+
+		      <child>
+			<widget class="GtkVBox" id="previewVbox">
+			  <property name="visible">True</property>
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">5</property>
+
+			  <child>
+			    <widget class="GtkHBox" id="previewControlHbox">
+			      <property name="visible">True</property>
+			      <property name="homogeneous">False</property>
+			      <property name="spacing">5</property>
+
+			      <child>
+				<widget class="GtkComboBox" id="previewOutputMenu">
+				  <property name="items" translatable="yes">Swiss Army Knife output
+Final output</property>
+				  <property name="add_tearoffs">False</property>
+				  <property name="focus_on_click">True</property>
+				</widget>
+				<packing>
+				  <property name="padding">0</property>
+				  <property name="expand">False</property>
+				  <property name="fill">True</property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkHScale" id="previewSlider">
+				  <property name="visible">True</property>
+				  <property name="can_focus">True</property>
+				  <property name="draw_value">True</property>
+				  <property name="value_pos">GTK_POS_TOP</property>
+				  <property name="digits">0</property>
+				  <property name="update_policy">GTK_UPDATE_CONTINUOUS</property>
+				  <property name="inverted">False</property>
+				  <property name="adjustment">0 0 99 1 1 0</property>
+				</widget>
+				<packing>
+				  <property name="padding">0</property>
+				  <property name="expand">True</property>
+				  <property name="fill">True</property>
+				</packing>
+			      </child>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkDrawingArea" id="previewVideo">
+			      <property name="height_request">300</property>
+			      <property name="visible">True</property>
+			      <property name="events">GDK_BUTTON1_MOTION_MASK | GDK_BUTTON_PRESS_MASK</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkDrawingArea" id="previewDisabled">
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+		      </child>
+		    </widget>
+		  </child>
+
+		  <child>
+		    <widget class="GtkLabel" id="previewLabel">
+		      <property name="visible">True</property>
+		      <property name="label" translatable="yes">Preview</property>
+		      <property name="use_underline">False</property>
+		      <property name="use_markup">False</property>
+		      <property name="justify">GTK_JUSTIFY_LEFT</property>
+		      <property name="wrap">False</property>
+		      <property name="selectable">False</property>
+		      <property name="xalign">0.5</property>
+		      <property name="yalign">0.5</property>
+		      <property name="xpad">0</property>
+		      <property name="ypad">0</property>
+		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+		      <property name="width_chars">-1</property>
+		      <property name="single_line_mode">False</property>
+		      <property name="angle">0</property>
+		    </widget>
+		    <packing>
+		      <property name="type">label_item</property>
+		    </packing>
+		  </child>
+		</widget>
+		<packing>
+		  <property name="padding">0</property>
+		  <property name="expand">False</property>
+		  <property name="fill">True</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkHBox" id="previewEnableButtonHbox">
+		  <property name="visible">True</property>
+		  <property name="homogeneous">False</property>
+		  <property name="spacing">0</property>
+
+		  <child>
+		    <widget class="GtkToggleButton" id="previewEnableButton">
+		      <property name="visible">True</property>
+		      <property name="can_focus">True</property>
+		      <property name="label" translatable="yes">Enable Preview</property>
+		      <property name="use_underline">True</property>
+		      <property name="relief">GTK_RELIEF_NORMAL</property>
+		      <property name="focus_on_click">True</property>
+		      <property name="active">False</property>
+		      <property name="inconsistent">False</property>
+		    </widget>
+		    <packing>
+		      <property name="padding">0</property>
+		      <property name="expand">False</property>
+		      <property name="fill">False</property>
+		      <property name="pack_type">GTK_PACK_END</property>
+		    </packing>
+		  </child>
+		</widget>
+		<packing>
+		  <property name="padding">5</property>
+		  <property name="expand">False</property>
+		  <property name="fill">True</property>
+		</packing>
+	      </child>
+	    </widget>
+	    <packing>
+	      <property name="padding">0</property>
+	      <property name="expand">False</property>
+	      <property name="fill">True</property>
+	    </packing>
+	  </child>
+	</widget>
+	<packing>
+	  <property name="padding">0</property>
+	  <property name="expand">True</property>
+	  <property name="fill">True</property>
+	</packing>
+      </child>
+    </widget>
+  </child>
+</widget>
+
+</glade-interface>

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade/threshold.glade
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade/threshold.glade	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade/threshold.glade	2007-09-30 16:49:31 UTC (rev 3608)
@@ -0,0 +1,513 @@
+<?xml version="1.0" standalone="no"?> <!--*- mode: xml -*-->
+<!DOCTYPE glade-interface SYSTEM "http://glade.gnome.org/glade-2.0.dtd">
+
+<glade-interface>
+
+<widget class="GtkDialog" id="threshold_dialog">
+  <property name="visible">True</property>
+  <property name="title" translatable="yes">Threshold</property>
+  <property name="type">GTK_WINDOW_TOPLEVEL</property>
+  <property name="window_position">GTK_WIN_POS_NONE</property>
+  <property name="modal">False</property>
+  <property name="resizable">True</property>
+  <property name="destroy_with_parent">False</property>
+  <property name="decorated">True</property>
+  <property name="skip_taskbar_hint">False</property>
+  <property name="skip_pager_hint">False</property>
+  <property name="type_hint">GDK_WINDOW_TYPE_HINT_DIALOG</property>
+  <property name="gravity">GDK_GRAVITY_NORTH_WEST</property>
+  <property name="focus_on_map">True</property>
+  <property name="urgency_hint">False</property>
+  <property name="has_separator">True</property>
+
+  <child internal-child="vbox">
+    <widget class="GtkVBox" id="dialogVbox">
+      <property name="visible">True</property>
+      <property name="homogeneous">False</property>
+      <property name="spacing">0</property>
+
+      <child internal-child="action_area">
+	<widget class="GtkHButtonBox" id="dialogButtonBox">
+	  <property name="visible">True</property>
+	  <property name="layout_style">GTK_BUTTONBOX_END</property>
+
+	  <child>
+	    <widget class="GtkButton" id="cancelButton">
+	      <property name="visible">True</property>
+	      <property name="can_default">True</property>
+	      <property name="can_focus">True</property>
+	      <property name="label">gtk-cancel</property>
+	      <property name="use_stock">True</property>
+	      <property name="relief">GTK_RELIEF_NORMAL</property>
+	      <property name="focus_on_click">True</property>
+	      <property name="response_id">-6</property>
+	    </widget>
+	  </child>
+
+	  <child>
+	    <widget class="GtkButton" id="okButton">
+	      <property name="visible">True</property>
+	      <property name="can_default">True</property>
+	      <property name="can_focus">True</property>
+	      <property name="label">gtk-ok</property>
+	      <property name="use_stock">True</property>
+	      <property name="relief">GTK_RELIEF_NORMAL</property>
+	      <property name="focus_on_click">True</property>
+	      <property name="response_id">-5</property>
+	    </widget>
+	  </child>
+	</widget>
+	<packing>
+	  <property name="padding">0</property>
+	  <property name="expand">False</property>
+	  <property name="fill">True</property>
+	  <property name="pack_type">GTK_PACK_END</property>
+	</packing>
+      </child>
+
+      <child>
+	<widget class="GtkVBox" id="allButButtonsVbox">
+	  <property name="visible">True</property>
+	  <property name="homogeneous">False</property>
+	  <property name="spacing">12</property>
+
+	  <child>
+	    <widget class="GtkHBox" id="settingsOuterHbox">
+	      <property name="visible">True</property>
+	      <property name="homogeneous">False</property>
+	      <property name="spacing">0</property>
+
+	      <child>
+		<widget class="GtkVBox" id="settingsOuterVbox">
+		  <property name="visible">True</property>
+		  <property name="homogeneous">False</property>
+		  <property name="spacing">12</property>
+
+		  <child>
+		    <widget class="GtkVBox" id="minValueVbox">
+		      <property name="visible">True</property>
+		      <property name="homogeneous">False</property>
+		      <property name="spacing">0</property>
+
+		      <child>
+			<widget class="GtkLabel" id="minValueLabel">
+			  <property name="visible">True</property>
+			  <property name="label" translatable="yes">Minimum value to be in-range:</property>
+			  <property name="use_underline">False</property>
+			  <property name="use_markup">False</property>
+			  <property name="justify">GTK_JUSTIFY_LEFT</property>
+			  <property name="wrap">False</property>
+			  <property name="selectable">False</property>
+			  <property name="xalign">0.5</property>
+			  <property name="yalign">1</property>
+			  <property name="xpad">0</property>
+			  <property name="ypad">8</property>
+			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			  <property name="width_chars">-1</property>
+			  <property name="single_line_mode">False</property>
+			  <property name="angle">0</property>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">False</property>
+			  <property name="fill">False</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkHBox" id="minValueHbox">
+			  <property name="visible">True</property>
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">5</property>
+
+			  <child>
+			    <widget class="GtkHScale" id="minValueSlider">
+			      <property name="visible">True</property>
+			      <property name="can_focus">True</property>
+			      <property name="draw_value">False</property>
+			      <property name="value_pos">GTK_POS_LEFT</property>
+			      <property name="digits">0</property>
+			      <property name="update_policy">GTK_UPDATE_CONTINUOUS</property>
+			      <property name="inverted">False</property>
+			      <property name="adjustment">0 0 255 1 1 0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkSpinButton" id="minValueSpinner">
+			      <property name="visible">True</property>
+			      <property name="can_focus">True</property>
+			      <property name="climb_rate">1</property>
+			      <property name="digits">0</property>
+			      <property name="numeric">False</property>
+			      <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+			      <property name="snap_to_ticks">False</property>
+			      <property name="wrap">False</property>
+			      <property name="adjustment">0 0 255 1 10 10</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">False</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+		    </widget>
+		    <packing>
+		      <property name="padding">0</property>
+		      <property name="expand">False</property>
+		      <property name="fill">False</property>
+		    </packing>
+		  </child>
+
+		  <child>
+		    <widget class="GtkVBox" id="maxValueVbox">
+		      <property name="visible">True</property>
+		      <property name="homogeneous">False</property>
+		      <property name="spacing">0</property>
+
+		      <child>
+			<widget class="GtkLabel" id="maxValueLabel">
+			  <property name="visible">True</property>
+			  <property name="label" translatable="yes">Maximum value to be in-range:</property>
+			  <property name="use_underline">False</property>
+			  <property name="use_markup">False</property>
+			  <property name="justify">GTK_JUSTIFY_LEFT</property>
+			  <property name="wrap">False</property>
+			  <property name="selectable">False</property>
+			  <property name="xalign">0.5</property>
+			  <property name="yalign">0.5</property>
+			  <property name="xpad">0</property>
+			  <property name="ypad">0</property>
+			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			  <property name="width_chars">-1</property>
+			  <property name="single_line_mode">False</property>
+			  <property name="angle">0</property>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">False</property>
+			  <property name="fill">False</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkHBox" id="maxValueHbox">
+			  <property name="visible">True</property>
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">5</property>
+
+			  <child>
+			    <widget class="GtkHScale" id="maxValueSlider">
+			      <property name="visible">True</property>
+			      <property name="can_focus">True</property>
+			      <property name="draw_value">False</property>
+			      <property name="value_pos">GTK_POS_LEFT</property>
+			      <property name="digits">0</property>
+			      <property name="update_policy">GTK_UPDATE_CONTINUOUS</property>
+			      <property name="inverted">False</property>
+			      <property name="adjustment">255 0 255 1 1 0</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkSpinButton" id="maxValueSpinner">
+			      <property name="visible">True</property>
+			      <property name="can_focus">True</property>
+			      <property name="climb_rate">1</property>
+			      <property name="digits">0</property>
+			      <property name="numeric">False</property>
+			      <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+			      <property name="snap_to_ticks">False</property>
+			      <property name="wrap">False</property>
+			      <property name="adjustment">255 0 255 1 10 10</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">False</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+		    </widget>
+		    <packing>
+		      <property name="padding">0</property>
+		      <property name="expand">False</property>
+		      <property name="fill">False</property>
+		    </packing>
+		  </child>
+
+		  <child>
+		    <widget class="GtkHBox" id="outputValuesHbox">
+		      <property name="visible">True</property>
+		      <property name="homogeneous">False</property>
+		      <property name="spacing">0</property>
+
+		      <child>
+			<widget class="GtkLabel" id="outputValuesLabel">
+			  <property name="visible">True</property>
+			  <property name="label" translatable="yes">Output values:   </property>
+			  <property name="use_underline">False</property>
+			  <property name="use_markup">False</property>
+			  <property name="justify">GTK_JUSTIFY_LEFT</property>
+			  <property name="wrap">False</property>
+			  <property name="selectable">False</property>
+			  <property name="xalign">0.5</property>
+			  <property name="yalign">0.5</property>
+			  <property name="xpad">0</property>
+			  <property name="ypad">0</property>
+			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			  <property name="width_chars">-1</property>
+			  <property name="single_line_mode">False</property>
+			  <property name="angle">0</property>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">False</property>
+			  <property name="fill">False</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkComboBox" id="outputValuesMenu">
+			  <property name="visible">True</property>
+			  <property name="items" translatable="yes">In-range values go black, out-of-range values go white
+In-range values go white, out-of-range values go black</property>
+			  <property name="add_tearoffs">False</property>
+			  <property name="focus_on_click">True</property>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+		    </widget>
+		    <packing>
+		      <property name="padding">0</property>
+		      <property name="expand">True</property>
+		      <property name="fill">True</property>
+		    </packing>
+		  </child>
+
+		  <child>
+		    <widget class="GtkHBox" id="debugHbox">
+		      <property name="visible">True</property>
+		      <property name="homogeneous">False</property>
+		      <property name="spacing">0</property>
+
+		      <child>
+			<widget class="GtkLabel" id="debugLabel">
+			  <property name="visible">True</property>
+			  <property name="label" translatable="yes">Debugging settings (bits):   </property>
+			  <property name="use_underline">False</property>
+			  <property name="use_markup">False</property>
+			  <property name="justify">GTK_JUSTIFY_LEFT</property>
+			  <property name="wrap">False</property>
+			  <property name="selectable">False</property>
+			  <property name="xalign">0.5</property>
+			  <property name="yalign">0.5</property>
+			  <property name="xpad">0</property>
+			  <property name="ypad">0</property>
+			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			  <property name="width_chars">-1</property>
+			  <property name="single_line_mode">False</property>
+			  <property name="angle">0</property>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">False</property>
+			  <property name="fill">False</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkSpinButton" id="debugSpinButton">
+			  <property name="visible">True</property>
+			  <property name="can_focus">True</property>
+			  <property name="climb_rate">1</property>
+			  <property name="digits">0</property>
+			  <property name="numeric">False</property>
+			  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+			  <property name="snap_to_ticks">False</property>
+			  <property name="wrap">False</property>
+			  <property name="adjustment">0 0 16777215 1 10 10</property>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+		    </widget>
+		    <packing>
+		      <property name="padding">0</property>
+		      <property name="expand">True</property>
+		      <property name="fill">True</property>
+		    </packing>
+		  </child>
+		</widget>
+		<packing>
+		  <property name="padding">0</property>
+		  <property name="expand">True</property>
+		  <property name="fill">True</property>
+		</packing>
+	      </child>
+	    </widget>
+	    <packing>
+	      <property name="padding">0</property>
+	      <property name="expand">False</property>
+	      <property name="fill">True</property>
+	    </packing>
+	  </child>
+
+	  <child>
+	    <widget class="GtkFrame" id="previewFrame">
+	      <property name="visible">True</property>
+	      <property name="label_xalign">0</property>
+	      <property name="label_yalign">0.5</property>
+	      <property name="shadow_type">GTK_SHADOW_ETCHED_IN</property>
+
+	      <child>
+		<widget class="GtkAlignment" id="previewAlignment">
+		  <property name="visible">True</property>
+		  <property name="xalign">0.5</property>
+		  <property name="yalign">0.5</property>
+		  <property name="xscale">1</property>
+		  <property name="yscale">1</property>
+		  <property name="top_padding">0</property>
+		  <property name="bottom_padding">8</property>
+		  <property name="left_padding">6</property>
+		  <property name="right_padding">8</property>
+
+		  <child>
+		    <widget class="GtkVBox" id="previewVbox">
+		      <property name="visible">True</property>
+		      <property name="homogeneous">False</property>
+		      <property name="spacing">5</property>
+
+		      <child>
+			<widget class="GtkHBox" id="previewControlHbox">
+			  <property name="visible">True</property>
+			  <property name="homogeneous">False</property>
+			  <property name="spacing">5</property>
+
+			  <child>
+			    <widget class="GtkComboBox" id="previewOutputMenu">
+			      <property name="items" translatable="yes">Threshold output
+Final output</property>
+			      <property name="add_tearoffs">False</property>
+			      <property name="focus_on_click">True</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">False</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkHScale" id="previewSlider">
+			      <property name="visible">True</property>
+			      <property name="can_focus">True</property>
+			      <property name="draw_value">True</property>
+			      <property name="value_pos">GTK_POS_TOP</property>
+			      <property name="digits">0</property>
+			      <property name="update_policy">GTK_UPDATE_CONTINUOUS</property>
+			      <property name="inverted">False</property>
+			      <property name="adjustment">0 0 99 1 1 1</property>
+			    </widget>
+			    <packing>
+			      <property name="padding">0</property>
+			      <property name="expand">True</property>
+			      <property name="fill">True</property>
+			    </packing>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkDrawingArea" id="previewVideo">
+			  <property name="height_request">300</property>
+			  <property name="visible">True</property>
+			  <property name="events">GDK_BUTTON1_MOTION_MASK | GDK_BUTTON_PRESS_MASK</property>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+		    </widget>
+		  </child>
+		</widget>
+	      </child>
+
+	      <child>
+		<widget class="GtkLabel" id="previewLabel">
+		  <property name="visible">True</property>
+		  <property name="label" translatable="yes">Preview</property>
+		  <property name="use_underline">False</property>
+		  <property name="use_markup">False</property>
+		  <property name="justify">GTK_JUSTIFY_LEFT</property>
+		  <property name="wrap">False</property>
+		  <property name="selectable">False</property>
+		  <property name="xalign">0.5</property>
+		  <property name="yalign">0.5</property>
+		  <property name="xpad">0</property>
+		  <property name="ypad">0</property>
+		  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+		  <property name="width_chars">-1</property>
+		  <property name="single_line_mode">False</property>
+		  <property name="angle">0</property>
+		</widget>
+		<packing>
+		  <property name="type">label_item</property>
+		</packing>
+	      </child>
+	    </widget>
+	    <packing>
+	      <property name="padding">0</property>
+	      <property name="expand">True</property>
+	      <property name="fill">True</property>
+	    </packing>
+	  </child>
+	</widget>
+	<packing>
+	  <property name="padding">0</property>
+	  <property name="expand">True</property>
+	  <property name="fill">True</property>
+	</packing>
+      </child>
+    </widget>
+  </child>
+</widget>
+
+</glade-interface>

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -105,6 +105,22 @@
 int DIA_srtPos(AVDMGenericVideoStream *source,uint32_t *size,uint32_t *position) {return 0;}
 int DIA_colorSel(uint8_t *r, uint8_t *g, uint8_t *b) {return 0;}			
 uint8_t DIA_glyphEdit(void) {return 0;}
+struct THRESHOLD_PARAM;
+uint8_t DIA_threshold(AVDMGenericVideoStream *in,
+                      THRESHOLD_PARAM * param) { return 255; }
+struct SWISSARMYKNIFE_PARAM;
+struct ADMVideoSwissArmyKnife;
+struct MenuMapping;
+uint8_t DIA_SwissArmyKnife (AVDMGenericVideoStream * in,
+                            ADMVideoSwissArmyKnife * sakp,
+                            SWISSARMYKNIFE_PARAM * param,
+                            const MenuMapping * menu_mapping,
+                            uint32_t menu_mapping_count) { return 255; }
+struct PARTICLE_PARAM;
+uint8_t DIA_particle (AVDMGenericVideoStream *in,
+                      PARTICLE_PARAM * param,
+                      const MenuMapping * menu_mapping,
+                      uint32_t menu_mapping_count) { return 255; }
 uint8_t ADM_ocrUpdateNbLines(void *ui,uint32_t cur,uint32_t total) {return 0;}
 uint8_t ADM_ocrUpdateNbGlyphs(void *ui,uint32_t nbGlyphs) {return 0;}
 uint8_t ADM_ocrUpdateTextAndTime(void *ui,char *decodedString,char *timeCode) {	return 0;}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -171,6 +171,13 @@
  
 }
 
+diaElemFile::diaElemFile(uint32_t write,std::string * filename,const char *toggleTitle,
+                         const char *defaultSuffix, const char *tip)
+  : diaElem(ELEM_FILE_READ)
+{
+ 
+}
+
 diaElemFile::~diaElemFile()
 {
   

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -1,6 +1,6 @@
 
 /***************************************************************************
-                          DIA_animated
+                          DIA_none
     copyright            : (C) 2006 by mean
     email                : fixounet at free.fr
  ***************************************************************************/
@@ -54,5 +54,21 @@
 int DIA_colorSel(uint8_t *r, uint8_t *g, uint8_t *b) {return 0;}
 uint8_t DIA_glyphEdit(void){ return 0;};
 int32_t UI_readJog(void) {return 0;}
+struct THRESHOLD_PARAM;
+uint8_t DIA_threshold(AVDMGenericVideoStream *in,
+                      THRESHOLD_PARAM * param) { return 255; }
+struct SWISSARMYKNIFE_PARAM;
+struct ADMVideoSwissArmyKnife;
+struct MenuMapping;
+uint8_t DIA_SwissArmyKnife (AVDMGenericVideoStream * in,
+                            ADMVideoSwissArmyKnife * sakp,
+                            SWISSARMYKNIFE_PARAM * param,
+                            const MenuMapping * menu_mapping,
+                            uint32_t menu_mapping_count) { return 255; }
+struct PARTICLE_PARAM;
+uint8_t DIA_particle (AVDMGenericVideoStream *in,
+                      PARTICLE_PARAM * param,
+                      const MenuMapping * menu_mapping,
+                      uint32_t menu_mapping_count) { return 255; }
 
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_filesel.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -105,7 +105,7 @@
         ADM_fileMode fileMode;
         const char * defaultSuffix;
             
-        ADM_Qfilesel(QWidget *z,const char *title,char *entry,QGridLayout *layout,int line, ADM_fileMode mode, const char * defaultSuffix)
+        ADM_Qfilesel(QWidget *z,const char *title,const char *entry,QGridLayout *layout,int line, ADM_fileMode mode, const char * defaultSuffix)
             : QWidget(z),
               defaultSuffix (defaultSuffix)
         {
@@ -142,7 +142,8 @@
 diaElemFile::diaElemFile(uint32_t writemode,char **filename,const char *toggleTitle,
                          const char *defaultSuffix,const char *tip)
   : diaElem(ELEM_FILE_READ),
-    defaultSuffix (defaultSuffix)
+    defaultSuffix (defaultSuffix),
+    paramIsStdString (false)
 {
   param=(void *)filename;
   paramTitle=shortkey(toggleTitle);
@@ -150,6 +151,18 @@
   _write=writemode;
 }
 
+diaElemFile::diaElemFile(uint32_t writemode,std::string *filename,const char *toggleTitle,
+                         const char * defaultSuffix,const char *tip)
+  : diaElem(ELEM_FILE_READ),
+    defaultSuffix (defaultSuffix),
+    paramIsStdString (true)
+{
+  param=(void *)filename;
+  paramTitle=shortkey(toggleTitle);
+  this->tip=tip;
+  _write=writemode;
+}
+
 diaElemFile::~diaElemFile()
 {
   if(paramTitle)
@@ -159,21 +172,32 @@
 {
  QGridLayout *layout=(QGridLayout*) opaque;
  ADM_Qfilesel *fs;
+ const char * val;
+ if (paramIsStdString)
+     val = ((std::string *)param)->c_str();
+ else
+     val = *((const char **)param);
   if(_write)
-      fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle,*(char **)param,layout, line,ADM_FILEMODE_WRITE, defaultSuffix);
+      fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle, val, layout, line,ADM_FILEMODE_WRITE, defaultSuffix);
   else
-      fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle,*(char **)param,layout, line,ADM_FILEMODE_READ, 0);
+      fs=new ADM_Qfilesel((QWidget *)dialog,paramTitle, val, layout, line,ADM_FILEMODE_READ, 0);
   myWidget=(void *)fs; 
 }
 void diaElemFile::getMe(void)
 {
-  
-  char **n=(char **)param;
-  if(*n) ADM_dealloc(*n);
-  
   ADM_Qfilesel *fs=(ADM_Qfilesel *)myWidget;
   QString s=(fs->edit)->text();
-  *n=ADM_strdup( s.toLatin1() );
+  const char * val = s.toLatin1();
+  if (paramIsStdString)
+  {
+      *((std::string *)param) = val;
+  }
+  else
+  {
+      char **n=(char **)param;
+      if(*n) ADM_dealloc(*n);
+      *n=ADM_strdup(val);
+  }
 }
 void diaElemFile::enable(uint32_t onoff)
 {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/CMakeLists.txt	2007-09-30 16:49:31 UTC (rev 3608)
@@ -10,7 +10,7 @@
 DIA_bitrateHisto.cpp  DIA_flyAsharp.cpp       DIA_flyDialog.cpp    DIA_lavcodec.cpp    DIA_prefs.cpp     DIA_SVCD.cpp       GUI_sdlRender.cpp
 DIA_builtin.cpp       DIA_flyChromaShift.cpp  DIA_flyHue.cpp       DIA_lavDecoder.cpp  DIA_requant.cpp   DIA_tdeint.cpp     GUI_xvRender.cpp
 DIA_animated.cpp      DIA_ocr.cpp DIA_tsSub.cpp
-DIA_flyEq2.cpp          DIA_flv1.cpp
+DIA_flyEq2.cpp          DIA_flv1.cpp          DIA_flyThreshold.cpp DIA_flySwissArmyKnife.cpp DIA_flyParticle.cpp
 )
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
 ADD_ADM_LIB(${ADM_LIB} ADM_userInterfaces)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_DVDff.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -3,15 +3,11 @@
 
 
 */
-#include <config.h>
 
-#include <stdio.h>
-#include <stdlib.h>
+#include "default.h"
 
-
 #include "ADM_lavcodec.h"
 
-#include "default.h"
 #include "ADM_toolkit/toolkit.hxx"
 #include "ADM_codecs/ADM_codec.h"
 #include "ADM_encoder/ADM_vidEncode.hxx"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioconfig.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioconfig.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_audioconfig.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -13,14 +13,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <unistd.h>
-#include <string.h>
-#include <stdio.h>
-# include <math.h>
-# include "config.h"
+
 #include "default.h"
 
 #include "ADM_assert.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_enter.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_enter.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_enter.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -13,14 +13,7 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <unistd.h>
-#include <string.h>
-#include <stdio.h>
-# include <math.h>
-# include "config.h"
+
 #include "default.h"
 
 #include "ADM_assert.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-09-30 16:49:31 UTC (rev 3608)
@@ -17,6 +17,7 @@
 #define DIA_FACTORY_H
 
 #include "ADM_assert.h"
+#include <string>
 
 typedef enum 
 {
@@ -330,10 +331,13 @@
 
 protected:
     const char * defaultSuffix;
+    bool paramIsStdString;
 public:
   
   diaElemFile(uint32_t writeMode,char **filename,const char *toggleTitle,
               const char *defaultSuffix = 0,const char *tip=NULL);
+  diaElemFile(uint32_t writeMode,std::string *filename,const char *toggleTitle,
+              const char *defaultSuffix = 0,const char *tip=NULL);
   virtual ~diaElemFile() ;
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyAsharp.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyAsharp.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyAsharp.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -1,9 +1,9 @@
 /**/
 /***************************************************************************
-                          DIA_hue
+                          DIA_Asharp
                              -------------------
 
-                           Ui for hue & sat
+                           Ui for Asharp
 
     begin                : 08 Apr 2005
     copyright            : (C) 2004/5 by mean
@@ -19,15 +19,8 @@
  *                                                                         *
  ***************************************************************************/
 
-
-
-#include <config.h>
-
-
-#include <string.h>
-#include <stdio.h>
-#include <math.h>
 #include "default.h"
+
 #include "ADM_colorspace/ADM_rgb.h"
 
 #include "ADM_image.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyContrast.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyContrast.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyContrast.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -14,11 +14,9 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
-#include <string.h>
-#include <stdio.h>
-#include <math.h>
+
 #include "default.h"
+
 #include "ADM_colorspace/ADM_rgb.h"
 
 #include "ADM_image.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyCrop.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyCrop.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyCrop.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -17,11 +17,6 @@
  *                                                                         *
  ***************************************************************************/
 
-#include <config.h>
-#include <string.h>
-#include <stdio.h>
-# include <math.h>
-
 #include "default.h"
 
 #include "ADM_image.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyDialog.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyDialog.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyDialog.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -12,11 +12,6 @@
 *                                                                         *
 ***************************************************************************///
 
-#include "config.h"
-
-#include <stdio.h>
-#include <stdlib.h>
-
 #include "default.h"
 
 #include "ADM_colorspace/ADM_rgb.h"
@@ -76,8 +71,8 @@
 			_resizeMethod = RESIZE_NONE;
 		else
 		{
-			_zoomW = _w * zoom;
-			_zoomH = _h * zoom;
+			_zoomW = uint32_t (_w * zoom);
+			_zoomH = uint32_t (_h * zoom);
 		}
 	}
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyDialog.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyDialog.h	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyDialog.h	2007-09-30 16:49:31 UTC (rev 3608)
@@ -30,6 +30,16 @@
 	RESIZE_LAST = 2		// Resize image after filter has been applied (slower for RGB)
 };
 
+class diaMenuEntry;  // defined in DIA_factory.h; only need pointer here
+
+struct MenuMapping
+{
+    const char * widgetName; // name of the combo box widget or equivalent
+    uint32_t paramOffset;   // offsetof(FOO_PARAM, menu_option_member)
+    uint32_t count;
+    const diaMenuEntry * menu;
+};
+
 class ADM_flyDialog
 {
   protected:
@@ -50,8 +60,18 @@
           void copyYuvFinalToRgb(void);
           void copyYuvScratchToRgb(void);
 		  void copyRgbFinalToDisplay(void);
-
+          void setupMenus (const void * params,
+                           const MenuMapping * menu_mapping,
+                           uint32_t menu_mapping_count);
+          void getMenuValues (void * params,
+                              const MenuMapping * menu_mapping,
+                              uint32_t menu_mapping_count);
   public:
+          uint32_t getMenuValue (const MenuMapping * mm);
+          const MenuMapping * lookupMenu (const char * widgetName,
+                                          const MenuMapping * menu_mapping,
+                                          uint32_t menu_mapping_count);
+  public:
           void    *_cookie; // whatever
           void    *_slider; // widget
           void    *_canvas; // Drawing zone
@@ -60,7 +80,7 @@
   virtual uint8_t    process(void)=0;
   virtual uint8_t    download(void)=0;
   virtual uint8_t    upload(void)=0;
-          /* /filte dependant */
+          /* /filter dependant */
   
   virtual uint8_t    sliderChanged(void);
         /* This is GTK/QT/whatever dependant */
@@ -75,6 +95,7 @@
           ADM_flyDialog(uint32_t width, uint32_t height, AVDMGenericVideoStream *in,
                              void *canvas, void *slider, int yuv, ResizeMethod resizeMethod);
   virtual ~ADM_flyDialog(void);
+
 };
 
 #endif

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyParticle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyParticle.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyParticle.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -0,0 +1,73 @@
+/***************************************************************************
+                          DIA_flyParticle.cpp  -  configuration dialog for
+						   particle filter
+                              -------------------
+                         Chris MacGregor, September 2007
+                         chris-avidemux at bouncingdog.com
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include "default.h"
+
+#include "ADM_colorspace/ADM_rgb.h"
+
+#include "ADM_image.h"
+#include "ADM_video/ADM_genvideo.hxx"
+#include "ADM_videoFilter/ADM_vidParticle.h"
+#include "DIA_flyDialog.h"
+#include "DIA_flyParticle.h"
+
+/************* COMMON PART *********************/
+
+uint8_t flyParticle::update ()
+{
+    download();
+    process();
+    copyYuvFinalToRgb();
+    display();
+    return 1;
+}
+
+static inline void draw_hline (uint8_t * fb, uint32_t width, uint32_t height,
+                               uint32_t y)
+{
+    for (uint8_t * pixp = fb + width * y; width--; pixp++)
+        *pixp ^= 0xff;
+}
+
+static inline void draw_vline (uint8_t * fb, uint32_t width, uint32_t height,
+                               uint32_t x)
+{
+    for (uint8_t * pixp = fb + x; height--; pixp += width)
+        *pixp ^= 0xff;
+}
+
+uint8_t flyParticle::process ()
+{
+    uint8_t ret = ADMVideoParticle::doParticle (_yuvBuffer, _yuvBufferOut,
+                                                _in, 0, 0, &param, _w, _h);
+    input_buffer_valid = false;
+
+    uint8_t * fb = YPLANE(_yuvBufferOut);
+
+    if (param.left_crop)
+        draw_vline (fb, _w, _h, param.left_crop - 1);
+    if (param.right_crop)
+        draw_vline (fb, _w, _h, _w - param.right_crop);
+    if (param.top_crop)
+        draw_hline (fb, _w, _h, param.top_crop - 1);
+    if (param.bottom_crop)
+        draw_hline (fb, _w, _h, _h - param.bottom_crop);
+
+    return ret;
+}
+
+/************* COMMON PART *********************/

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyParticle.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyParticle.h	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyParticle.h	2007-09-30 16:49:31 UTC (rev 3608)
@@ -0,0 +1,94 @@
+/***************************************************************************
+                          DIA_flyParticle.cpp  -  configuration dialog for
+						   particle filter
+                              -------------------
+                         Chris MacGregor, September 2007
+                         chris-avidemux at bouncingdog.com
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef FLY_PARTICLE_H
+#define FLY_PARTICLE_H
+
+class flyParticle : public ADM_flyDialog
+{
+  
+  private:
+    PARTICLE_PARAM param;
+    const MenuMapping * menu_mapping;
+    uint32_t menu_mapping_count;
+    bool input_buffer_valid;
+
+  public:
+    uint8_t    process(void);
+    uint8_t    download(void);
+    uint8_t    upload(void);
+    uint8_t    update(void);
+
+    flyParticle (uint32_t width, uint32_t height,
+                 AVDMGenericVideoStream * in,
+                 void * canvas, void * slider, void * dialog,
+                 const PARTICLE_PARAM * in_param,
+                 const MenuMapping * menu_mapping,
+                 uint32_t menu_mapping_count)
+        : ADM_flyDialog (width, height, in, canvas, slider, 1, RESIZE_AUTO),
+          param (*in_param),
+          menu_mapping (menu_mapping),
+          menu_mapping_count (menu_mapping_count),
+          input_buffer_valid (false)
+    {
+        _cookie = dialog;
+        setupMenus (in_param, menu_mapping, menu_mapping_count);
+    };
+
+    void getParam (PARTICLE_PARAM * outputParam)
+    {
+        *outputParam = param;
+    }
+
+    ADMImage * getInputImage ()
+    {
+        if (!input_buffer_valid)
+        {
+            uint32_t len, flags;
+            uint32_t frameNum = sliderGet();
+            if (!_in->getFrameNumberNoAlloc(frameNum, &len,
+                                            _yuvBuffer, &flags))
+            {
+                printf ("flyParticle::getInputImage(): Cannot get frame %u\n",
+                        frameNum);
+                return 0;
+            }
+            input_buffer_valid = true;
+        }
+
+        return _yuvBuffer;
+    }
+
+    ADMImage * getOutputImage ()
+    {
+        return _yuvBufferOut;
+    }
+
+    const MenuMapping * lookupMenu (const char * widgetName)
+    {
+        return ADM_flyDialog::lookupMenu (widgetName, menu_mapping,
+                                          menu_mapping_count);
+    }
+
+    void getMenuValues ()
+    {
+        ADM_flyDialog::getMenuValues (&param, menu_mapping,
+                                      menu_mapping_count);
+    }
+};
+
+#endif

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flySwissArmyKnife.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flySwissArmyKnife.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flySwissArmyKnife.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -0,0 +1,61 @@
+/***************************************************************************
+                          DIA_flySwissArmyKnife.cpp  -  configuration dialog for
+						   Swiss Army Knife filter
+                              -------------------
+                         Chris MacGregor, September 2007
+                         chris-avidemux at bouncingdog.com
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include "default.h"
+
+#include "ADM_colorspace/ADM_rgb.h"
+
+#include "ADM_image.h"
+#include "ADM_video/ADM_genvideo.hxx"
+#include "ADM_videoFilter/ADM_vidSwissArmyKnife.h"
+#include "DIA_flyDialog.h"
+#include "DIA_flySwissArmyKnife.h"
+
+/************* COMMON PART *********************/
+
+uint8_t flySwissArmyKnife::sliderChanged ()
+{
+    if (!param.enable_preview)
+        return 0;
+
+    return ADM_flyDialog::sliderChanged();
+}
+
+uint8_t  flySwissArmyKnife::update ()
+{
+    download();
+    if (!param.enable_preview)
+        return 0;
+
+    process();
+    copyYuvFinalToRgb();
+    display();
+    return 1;
+}
+
+uint8_t flySwissArmyKnife::process ()
+{
+    if (!param.enable_preview)
+        return 0;
+
+    uint8_t ret =
+        ADMVideoSwissArmyKnife::doSwissArmyKnife (_yuvBuffer, _yuvBufferOut,
+                                                  _in, sakp, &param, _w, _h);
+    return ret;
+}
+
+/************* COMMON PART *********************/

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flySwissArmyKnife.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flySwissArmyKnife.h	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flySwissArmyKnife.h	2007-09-30 16:49:31 UTC (rev 3608)
@@ -0,0 +1,89 @@
+/***************************************************************************
+                          DIA_flySwissArmyKnife.cpp  -  configuration dialog for
+						   Swiss Army Knife filter
+                              -------------------
+                         Chris MacGregor, September 2007
+                         chris-avidemux at bouncingdog.com
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef FLY_SWISSARMYKNIFE_H
+#define FLY_SWISSARMYKNIFE_H
+
+class flySwissArmyKnife : public ADM_flyDialog
+{
+  
+  private:
+    ADMVideoSwissArmyKnife * sakp;
+    const MenuMapping * menu_mapping;
+    uint32_t menu_mapping_count;
+
+  public:
+    SWISSARMYKNIFE_PARAM param;
+
+    uint8_t    process(void);
+    uint8_t    download(void);
+    uint8_t    upload(void);
+    uint8_t    update(void);
+
+    flySwissArmyKnife (uint32_t width, uint32_t height,
+                       AVDMGenericVideoStream * in,
+                       void * canvas, void * slider, void * dialog,
+                       ADMVideoSwissArmyKnife * sakp,
+                       const SWISSARMYKNIFE_PARAM * in_param,
+                       const MenuMapping * menu_mapping,
+                       uint32_t menu_mapping_count)
+        : ADM_flyDialog (width, height, in, canvas, slider, 1, RESIZE_AUTO),
+          sakp (sakp),
+          param (*in_param),
+          menu_mapping (menu_mapping),
+          menu_mapping_count (menu_mapping_count)
+    {
+        _cookie = dialog;
+        setupMenus (in_param, menu_mapping, menu_mapping_count);
+        // printf ("flySwissArmyKnife::flySwissArmyKnife: "
+        //         "in_param %p, &param %p\n", in_param, &param);
+    };
+
+    uint8_t sliderChanged (void);
+
+    void getParam (SWISSARMYKNIFE_PARAM * outputParam)
+    {
+        *outputParam = param;
+    }
+
+    ADMImage * getInputImage ()
+    {
+        return _yuvBuffer;
+    }
+
+    ADMImage * getOutputImage ()
+    {
+        return _yuvBufferOut;
+    }
+
+    const MenuMapping * lookupMenu (const char * widgetName)
+    {
+        return ADM_flyDialog::lookupMenu (widgetName, menu_mapping,
+                                          menu_mapping_count);
+    }
+
+    void getMenuValues ()
+    {
+        ADM_flyDialog::getMenuValues (&param, menu_mapping,
+                                      menu_mapping_count);
+    }
+
+    void updateConfigDescription (bool do_download);
+    void wipeOutputBuffer ();
+};
+
+#endif

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyThreshold.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyThreshold.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyThreshold.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -0,0 +1,53 @@
+/***************************************************************************
+                          DIA_flyThreshold.cpp  -  configuration dialog for
+						   threshold filter
+                              -------------------
+                         Chris MacGregor, September 2007
+                         chris-avidemux at bouncingdog.com
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include "config.h"
+#include <string.h>
+#include <stdio.h>
+#include <math.h>
+#include "default.h"
+#include "ADM_colorspace/ADM_rgb.h"
+
+#include "ADM_image.h"
+#include "ADM_video/ADM_genvideo.hxx"
+#include "ADM_videoFilter/ADM_vidThreshold.h"
+#include "DIA_flyDialog.h"
+#include "DIA_flyThreshold.h"
+
+/************* COMMON PART *********************/
+
+uint8_t  flyThreshold::update ()
+{
+    download();
+    process();
+    copyYuvFinalToRgb();
+    display();
+    return 1;
+}
+
+uint8_t flyThreshold::process ()
+{
+    uint8_t lookup_table [256];
+    if (ADMVideoThreshold::computeLookupTable (&param, lookup_table))
+        upload();
+
+    ADMVideoThreshold::doThreshold (_yuvBuffer, _yuvBufferOut,
+                                    lookup_table, (_h * _w * 3) >> 1);
+    return 1;
+}
+
+/************* COMMON PART *********************/

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyThreshold.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyThreshold.h	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyThreshold.h	2007-09-30 16:49:31 UTC (rev 3608)
@@ -0,0 +1,58 @@
+/***************************************************************************
+                          DIA_flyThreshold.cpp  -  configuration dialog for
+						   threshold filter
+                              -------------------
+                         Chris MacGregor, September 2007
+                         chris-avidemux at bouncingdog.com
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef FLY_THRESHOLD_H
+#define FLY_THRESHOLD_H
+
+class flyThreshold : public ADM_flyDialog
+{
+  
+  private:
+    THRESHOLD_PARAM param;
+
+  public:
+    uint8_t    process(void);
+    uint8_t    download(void);
+    uint8_t    upload(void);
+    uint8_t    update(void);
+
+    flyThreshold (uint32_t width, uint32_t height,
+                  AVDMGenericVideoStream * in,
+                  void * canvas, void * slider,
+                  const THRESHOLD_PARAM * in_param)
+        : ADM_flyDialog (width, height, in, canvas, slider, 1, RESIZE_AUTO),
+          param (*in_param)
+    {
+    };
+
+    void getParam (THRESHOLD_PARAM * outputParam)
+    {
+        *outputParam = param;
+    }
+
+    ADMImage * getInputImage ()
+    {
+        return _yuvBuffer;
+    }
+
+    ADMImage * getOutputImage ()
+    {
+        return _yuvBufferOut;
+    }
+};
+
+#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_mjpeg.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_mjpeg.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_mjpeg.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -3,15 +3,11 @@
 
 
 */
-#include <config.h>
 
-#include <stdio.h>
-#include <stdlib.h>
+#include "default.h"
 
-
 #include "ADM_lavcodec.h"
 
-#include "default.h"
 #include "ADM_toolkit/toolkit.hxx"
 #include "ADM_codecs/ADM_codec.h"
 #include "ADM_encoder/ADM_vidEncode.hxx"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_resizeWiz.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -17,13 +17,6 @@
  *                                                                         *
  ***************************************************************************/
 
-
-
-#include <config.h>
-#include <math.h>
-#include <string.h>
-#include <stdio.h>
-
 #include "default.h"
 
 #include "ADM_assert.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_v2v.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -14,16 +14,9 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-# include "config.h"
 
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <unistd.h>
-#include <string.h>
-#include <stdio.h>
-
-# include <math.h>
 #include "default.h"
+
 #include "ADM_toolkit/toolkit.hxx"
 #include "ADM_toolkit/filesel.h"
 #include "DIA_factory.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_render.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -17,19 +17,11 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
 
-#include <stdio.h>         
-#include <stdlib.h>
-#include <math.h>
-#include <unistd.h>
-#include <string.h>
-#include <sys/time.h>
-
-#include <../ADM_assert.h>
-
 #include "default.h"
 
+#include "ADM_assert.h"
+
 #include "ADM_commonUI/GUI_render.h"
 
 #include "ADM_commonUI/GUI_accelRender.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_sdlRender.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -14,7 +14,9 @@
 //  The pitch stride has to be changed as there could be some padding depending on the OS
 //
 //
-#include "config.h"
+
+#include "default.h"
+
 #if defined(USE_SDL)
 
 #include <stdio.h>
@@ -25,12 +27,17 @@
 #include <sys/time.h>
 
 extern "C" {
+// get rid of warnings due to different definitions
+#undef HAVE_INTTYPES_H
+#undef HAVE_MALLOC_H
+#undef HAVE_STDINT_H
+#undef HAVE_STDLIB_H
+#undef HAVE_STRING_H
+#undef HAVE_SYS_TYPES_H
 #include "SDL/SDL.h"
 #include "SDL/SDL_syswm.h"
 }
 
-#include "default.h"
-
 #include "ADM_colorspace/colorspace.h"
 #include "ADM_colorspace/ADM_rgb.h"
 #include "ADM_commonUI/GUI_render.h"

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/Makefile.am	2007-09-30 16:49:31 UTC (rev 3608)
@@ -15,6 +15,9 @@
 DIA_ocr.cpp \
 DIA_tsSub.cpp \
 DIA_flyEq2.cpp \
+DIA_flyThreshold.cpp \
+DIA_flySwissArmyKnife.cpp \
+DIA_flyParticle.cpp \
 DIA_flv1.cpp
 
 commonObjs:=$(subst .cpp,.o,$(libADM_CommonUI_a_SOURCES))

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_confCouple.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_confCouple.h	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_confCouple.h	2007-09-30 16:49:31 UTC (rev 3608)
@@ -20,7 +20,7 @@
  #ifndef __CONFCOUPLE__
  #define __CONFCOUPLE__
 
-//#include <string.h>
+#include <string>
 
 
 class CONFcouple
@@ -39,6 +39,7 @@
 			uint8_t setCouple(const char *name,int32_t value);
 			uint8_t setCouple(const char *name,const char *value);
 			uint8_t setCouple(const char *name,const ADM_filename *value);
+			uint8_t setCouple(const char *name,const std::string & value);
 			uint8_t setCouple(const char *name,double value);
 			uint8_t setCouple(const char *name,float value);
 
@@ -46,6 +47,7 @@
 			uint8_t getCouple(const char *name,uint32_t *value);
 			uint8_t getCouple(const char *name,char **value);
 			uint8_t getCouple(const char *name,ADM_filename **value);
+			uint8_t getCouple(const char *name,std::string *value);
 			uint8_t getCouple(const char *name,double *value);
 			uint8_t getCouple(const char *name,float *value);
 			uint32_t getNumber(void) { return nb;};

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_confCouples.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_confCouples.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_confCouples.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -14,17 +14,9 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
- 
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
 
-#include <time.h>
-#include <sys/time.h>
+#include "default.h"
 
-
-
 #include "fourcc.h"
 #include "avio.hxx"
 #include <ADM_assert.h>
@@ -117,8 +109,17 @@
 	cur++;
 	return 1;
 }
+uint8_t CONFcouple::setCouple(const char *myname,const std::string & val)
+{
+	ADM_assert(cur<nb);
 
+	name[cur]=ADM_strdup(myname);
+	value[cur]=ADM_strdup(val.c_str());
+	cur++;
+	return 1;
+}
 
+
 uint8_t CONFcouple::getCouple(const char *myname,uint32_t *val)
 {
 	int32_t index=lookupName(myname);
@@ -155,9 +156,18 @@
 	*val=(ADM_filename *)ADM_strdup(value[index]);
 	return 1;
 }
+uint8_t CONFcouple::getCouple(const char *myname,std::string *val)
+{
+	int32_t index=lookupName(myname);
+
+	ADM_assert(index!=-1);
+	ADM_assert(index<(int)nb);
+	*val=value[index];
+	return 1;
+}
 uint8_t CONFcouple::getCouple(const char *myname,float *val)
 {
-int32_t index=lookupName(myname);
+	int32_t index=lookupName(myname);
 
 	ADM_assert(index!=-1);
 	ADM_assert(index<(int)nb);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidFont.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidFont.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidFont.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -14,13 +14,10 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include <stdio.h>
-#include <stdlib.h>
+
+#include "default.h"
+
 #include <iconv.h>
-#include <string.h> // thanks !
-#include "config.h"
-#include <errno.h>
-#include "ADM_utilities/default.h"
 
  #ifdef USE_FREETYPE
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidFont.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidFont.h	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidFont.h	2007-09-30 16:49:31 UTC (rev 3608)
@@ -18,8 +18,17 @@
 #undef free
 #undef alloc
 #undef realloc
+#ifdef HAVE_UNISTD_H
+// avoid warnings due to different definition of this in freetype headers
+#define WE_DO_HAVE_UNISTD_H
+#undef HAVE_UNISTD_H
+#endif
  #include <ft2build.h>
  #include FT_FREETYPE_H
+#ifdef WE_DO_HAVE_UNISTD_H
+#undef HAVE_UNISTD_H
+#define HAVE_UNISTD_H
+#endif
 
  class ADMfont
  {

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidComputeAverage.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -18,20 +18,13 @@
  *                                                                         *
  ***************************************************************************/
  
- 
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <ADM_assert.h>
-#include <math.h>
+#include "default.h"
 
-#include "config.h"
+#include "ADM_assert.h"
 #include "fourcc.h"
 #include "avio.hxx"
-#include "config.h"
 #include "avi_vars.h"
 
-
 #include "ADM_toolkit/toolkit.hxx"
 #include "ADM_editor/ADM_edit.hxx"
 #include "ADM_video/ADM_genvideo.hxx"
@@ -67,12 +60,13 @@
 ADMVideoComputeAverage::ADMVideoComputeAverage(AVDMGenericVideoStream *in,CONFcouple *couples)
 			
 {
-    _in=in;
-    memcpy(&_info,in->getInfo(),sizeof(_info));
+    _in = in;
+    memcpy (&_info, in->getInfo(), sizeof(_info));
     _info.encoding = 1;	
-    _uncompressed = new ADMImage (_in->getInfo()->width,_in->getInfo()->height);
+    _uncompressed = new ADMImage (_in->getInfo()->width, _in->getInfo()->height);
     ADM_assert(_uncompressed);
-    _param=NEW (COMPUTEAVERAGE_PARAM);
+    _param = new COMPUTEAVERAGE_PARAM;
+
     if (couples)
     {
         GET(start_frame);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -15,20 +15,15 @@
  *                                                                         *
  ***************************************************************************/
  
- 
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <ADM_assert.h>
+#include "default.h"
+
 #include <math.h>
 
-#include "config.h"
+#include "ADM_assert.h"
 #include "fourcc.h"
 #include "avio.hxx"
-#include "config.h"
 #include "avi_vars.h"
 
-
 #include "ADM_toolkit/toolkit.hxx"
 #include "ADM_editor/ADM_edit.hxx"
 #include "ADM_video/ADM_genvideo.hxx"
@@ -41,6 +36,7 @@
 #include "ADM_userInterfaces/ADM_commonUI/DIA_factory.h"
 
 #include "ADM_vidParticle.h"
+#include "DIA_flyDialog.h" // for MenuMapping
 
 FILE * ADMVideoParticle::outfp = 0;
 uint32_t ADMVideoParticle::last_frame_written = 0xffffffff;
@@ -66,7 +62,7 @@
     _info.encoding = 1;
     _uncompressed = new ADMImage(_in->getInfo()->width, _in->getInfo()->height);
     ADM_assert(_uncompressed);
-    _param = NEW(PARTICLE_PARAM);
+    _param = new PARTICLE_PARAM;
 
     if (couples)
     {
@@ -78,8 +74,7 @@
         GET(bottom_crop);
         GET(output_format);
 
-        char * tmp;
-        GET2(output_file, tmp);
+        GET(output_file);
         GET(camera_number);
         GET(debug);
     }
@@ -92,7 +87,7 @@
         _param->top_crop = 0;
         _param->bottom_crop = 0;
         _param->output_format = OUTPUTFMT_FORMAT_NEW;
-        _param->output_file = ADM_strdup ("");
+        // _param->output_file = ""; // implicit
         _param->camera_number = 1;
         _param->debug = 0;
     }
@@ -122,8 +117,37 @@
 
 uint8_t ADMVideoParticle::configure(AVDMGenericVideoStream *in)
 {
-    UNUSED_ARG(in);
+    diaMenuEntry tOutputFmt [] = {
+        { OUTPUTFMT_FORMAT_NEW,
+          QT_TR_NOOP("New format, preferred, good for Tracker3D"), NULL },
+        { OUTPUTFMT_FORMAT_OLD,
+          QT_TR_NOOP("Old format that Tracker3D can't read directly"), NULL },
+    };
 
+    diaElemMenu output_format
+        (&(_param->output_format), QT_TR_NOOP("Output _Format:"),
+         sizeof (tOutputFmt) / sizeof (diaMenuEntry), tOutputFmt);
+
+    MenuMapping menu_mapping [] = {
+        { "outputFormatMenu", my_offsetof (PARTICLE_PARAM, output_format),
+          sizeof (tOutputFmt) / sizeof (diaMenuEntry), tOutputFmt },
+    };
+
+    uint8_t ret = DIA_particle (_in, _param, menu_mapping,
+                                sizeof (menu_mapping) / sizeof (MenuMapping));
+    if (ret == 1)
+    {
+        return ret;
+    }
+    else if (ret == 0) // 0 = cancel
+    {
+        return ret;
+    }
+    else
+    {
+        ADM_assert (ret == 255); // 255 = whizzy dialog not implemented
+    }
+
     diaElemUInteger min_area
         (&(_param->min_area),
          QT_TR_NOOP("Mi_nimum area for a particle to be detected:"), 1, 0x7fffffff);
@@ -144,20 +168,8 @@
         (&(_param->bottom_crop),
          QT_TR_NOOP("_Bottom crop (ignore particles in):"), 0, 0x7fffffff);
 
-    diaMenuEntry tOutputFmt [] = {
-        { OUTPUTFMT_FORMAT_NEW,
-          QT_TR_NOOP("New format, preferred, good for Tracker3D"), NULL },
-        { OUTPUTFMT_FORMAT_OLD,
-          QT_TR_NOOP("Old format that Tracker3D can't read directly"), NULL },
-    };
-
-    diaElemMenu output_format
-        (&(_param->output_format), QT_TR_NOOP("_Output Format:"),
-         sizeof (tOutputFmt) / sizeof (diaMenuEntry), tOutputFmt);
-
     diaElemFile output_file
-        (1, const_cast<char **>(&(_param->output_file)),
-         QT_TR_NOOP("_Output File:"), "pts");
+        (1, &(_param->output_file), QT_TR_NOOP("_Output File:"), "pts");
 
     diaElemUInteger camera_number
         (&(_param->camera_number), QT_TR_NOOP("_Camera number:"), 1, 0x7fffffff);
@@ -169,9 +181,9 @@
                           &top_crop, &bottom_crop, &output_format,
                           &output_file, &camera_number, &debug };
 
-    uint8_t ret = diaFactoryRun("Particle", sizeof (elems) / sizeof (diaElem *), elems);
+    ret = diaFactoryRun ("Particle Detection Configuration",
+                         sizeof (elems) / sizeof (diaElem *), elems);
     return ret;
-	
 }
 
 ADMVideoParticle::~ADMVideoParticle()
@@ -201,11 +213,11 @@
                           _param->top_crop, _param->bottom_crop);
     }
 
-    if (_param->output_file && _param->output_file[0])
+    if (!_param->output_file.empty())
     {
         cptr += snprintf (cptr, CONF_LEN - (cptr - conf), ", %s Output to %s",
                           _param->output_format == OUTPUTFMT_FORMAT_OLD
-                          ? "Old" : "New", _param->output_file);
+                          ? "Old" : "New", _param->output_file.c_str());
     }
 
     cptr += snprintf (cptr, CONF_LEN - (cptr - conf), ", Camera # %u",
@@ -224,51 +236,28 @@
     if (frame >= _info.nb_frames)
         return 0;
 
-    uint32_t real_frame = frame + _info.orgFrame;
-
-    uint32_t debug = _param->debug;
-
-    if (debug & 1)
+    if (_param->debug & 1)
         printf ("in ADMVideoParticle::getFrameNumberNoAlloc(%d, ...)\n", frame);
 
-    uint32_t w = _info.width;
-    uint32_t h = _info.height;
-    uint32_t planesize = w * h;
-    uint32_t uvplanesize = planesize >> 2;
-    uint32_t size = planesize + (uvplanesize * 2);
-    *len = size;
-			
     if (!_in->getFrameNumberNoAlloc (frame, len, _uncompressed, flags))
         return 0;
-    ADMImage * image = _uncompressed;
 
-    memset (UPLANE (data), 128, uvplanesize);
-    memset (VPLANE (data), 128, uvplanesize);
-    memset (YPLANE (data), 0, planesize);
+    uint32_t planesize = _info.width * _info.height;
+    uint32_t size = (planesize * 3) >> 1;
+    *len = size;
 
-    // HERE: we should erase anything outside the ROI (region of interest),
-    // unless we decide to handle that some other way and/or place...
-
-    uint8_t * imagePixels = YPLANE (image);
-    ImageTool imtool (imagePixels, w, h, data);
-    imtool.setDebug (debug);
-    imtool.setMinArea (_param->min_area);
-    imtool.setMaxArea (_param->max_area);
-    static uint32_t particleNum = 0;
-
+    uint32_t real_frame = frame + _info.orgFrame;
     OutputFmt outfmt = static_cast <OutputFmt> (_param->output_format);
-    uint32_t camera_number = _param->camera_number;
 
-    if (!outfp && real_frame == 0
-        && _param->output_file && _param->output_file[0])
+    if (!outfp && real_frame == 0 && !_param->output_file.empty())
     {
         printf ("Preparing to write particle list to %s\n",
-                _param->output_file);
+                _param->output_file.c_str());
 
-        outfp = fopen (_param->output_file, "w");
+        outfp = fopen (_param->output_file.c_str(), "w");
         if (!outfp)
         {
-            perror (_param->output_file);
+            perror (_param->output_file.c_str());
         }
         else if (real_frame == 0) // ick
         {
@@ -279,10 +268,59 @@
         }
     }
 
-    for (uint32_t y = 0; y < h; y++)
+    uint8_t ret = doParticle (_uncompressed, data, _in, real_frame,
+                              (last_frame_written == real_frame) ? 0 : outfp,
+                              _param, _info.width, _info.height);
+
+    last_frame_written = real_frame;
+
+    if (outfp && real_frame >= _info.nb_frames + _info.orgFrame - 1)
     {
-        uint8_t * pixelrow = imagePixels + (y * w);
-        for (uint32_t x = 0; x < w; x++)
+        fclose (outfp);
+        outfp = 0;
+        printf ("Finished writing particle list to %s\n",
+                _param->output_file.c_str());
+    }
+
+    return ret;
+}
+
+uint8_t
+ADMVideoParticle::doParticle (ADMImage * image, ADMImage * data,
+                              AVDMGenericVideoStream * in,
+                              uint32_t real_frame,
+                              FILE * do_outfp, PARTICLE_PARAM * param,
+                              uint32_t width, uint32_t height)
+{
+    uint32_t debug = param->debug;
+
+    uint32_t planesize = width * height;
+    uint32_t uvplanesize = planesize >> 2;
+    uint32_t size = planesize + (uvplanesize * 2);
+			
+    memset (UPLANE (data), 128, uvplanesize);
+    memset (VPLANE (data), 128, uvplanesize);
+    memset (YPLANE (data), 0, planesize);
+
+    // HERE: we should erase anything outside the ROI (region of interest),
+    // unless we decide to handle that some other way and/or place...
+
+    uint8_t * imagePixels = YPLANE (image);
+    ImageTool imtool (imagePixels, width, height, data);
+    imtool.setDebug (debug);
+    imtool.setMinArea (param->min_area);
+    imtool.setMaxArea (param->max_area);
+    imtool.setCropping (param->left_crop, param->right_crop,
+                        param->top_crop, param->bottom_crop);
+    static uint32_t particleNum = 0;
+
+    OutputFmt outfmt = static_cast <OutputFmt> (param->output_format);
+    uint32_t camera_number = param->camera_number;
+
+    for (uint32_t y = param->top_crop; y < height - param->bottom_crop; y++)
+    {
+        uint8_t * pixelrow = imagePixels + (y * width);
+        for (uint32_t x = param->left_crop; x < width - param->right_crop; x++)
         {
             if (imtool.goodPixel (pixelrow [x]))
             {
@@ -292,23 +330,24 @@
                 uint32_t area = imtool.particleArea();
                 float centroid_x = imtool.particleCentroidX();
                 float centroid_y = imtool.particleCentroidY();
+
                 if (debug & 0x01)
                     printf ("%d %d %.6f %.6f %d\n",
                             ++particleNum, area, centroid_x, centroid_y,
                             real_frame + 1);
 
-                if (!outfp || last_frame_written == real_frame)
+                if (!do_outfp)
                     continue;
 
                 if (outfmt == OUTPUTFMT_FORMAT_NEW)
                 {
-                    fprintf (outfp, "%d %d %.6f %.6f %d %d\n",
+                    fprintf (do_outfp, "%d %d %.6f %.6f %d %d\n",
                              real_frame + 1, camera_number, centroid_x, centroid_y,
                              area, ++particleNum);
                 }
                 else
                 {
-                    fprintf (outfp, "%d %d %.6f %.6f %d\n",
+                    fprintf (do_outfp, "%d %d %.6f %.6f %d\n",
                              ++particleNum, area, centroid_x, centroid_y,
                              real_frame + 1);
                 }
@@ -316,16 +355,6 @@
         }
     }
 
-    last_frame_written = real_frame;
-
-    if (outfp && real_frame >= _info.nb_frames + _info.orgFrame - 1)
-    {
-        fclose (outfp);
-        outfp = 0;
-        printf ("Finished writing particle list to %s\n",
-                _param->output_file);
-    }
-
     data->copyInfo(image);
     return 1;
 }	                           

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.h	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidParticle.h	2007-09-30 16:49:31 UTC (rev 3608)
@@ -16,10 +16,13 @@
  
 #ifndef __PARTICLE__
 #define __PARTICLE__   
+
+#include <string>
+
 #include "ADM_video/ADM_cache.h"
+
 struct PARTICLE_PARAM
 {
-
     uint32_t min_area;
     uint32_t max_area;
     uint32_t left_crop;
@@ -27,12 +30,21 @@
     uint32_t top_crop;
     uint32_t bottom_crop;
     uint32_t output_format;
-    const char * output_file;
+    std::string output_file;
     uint32_t camera_number;
     uint32_t debug;
-
 };
 
+// Alas, because offsetof() is only supposed to work on POD (plain old data)
+// structs, and our PARTICLE_PARAM includes a std::string (which has a
+// constructor, and which causes PARTICLE_PARAM to therefore have an implicit
+// constructor), we need to define our own offsetof() to use for the dialog
+// menus.  See
+// http://www.cplusplus.com/reference/clibrary/cstddef/offsetof.html for more
+// on offsetof().
+
+#define my_offsetof(_type, _memb) (size_t (&(((_type *)1)->_memb)) - 1)
+
 class ADMVideoParticle : public AVDMGenericVideoStream
 {
 
@@ -56,17 +68,22 @@
      };
 
 
-     ADMVideoParticle(  AVDMGenericVideoStream *in,CONFcouple *setup);
+     ADMVideoParticle (AVDMGenericVideoStream *in, CONFcouple *setup);
 
      ~ADMVideoParticle();
 
-     virtual uint8_t 	getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-                                              ADMImage *data,uint32_t *flags);
+     virtual uint8_t getFrameNumberNoAlloc (uint32_t frame, uint32_t *len,
+                                            ADMImage *data,uint32_t *flags);
 
-     virtual uint8_t 	configure( AVDMGenericVideoStream *instream);
-     virtual char 		   *printConf(void);
-     virtual uint8_t 	getCoupledConf( CONFcouple **couples);
+     virtual uint8_t configure (AVDMGenericVideoStream *instream);
+     virtual char * printConf (void);
+     virtual uint8_t getCoupledConf (CONFcouple **couples);
 							
+     static uint8_t doParticle (ADMImage * image, ADMImage * data,
+                                AVDMGenericVideoStream * in,
+                                uint32_t real_frame,
+                                FILE * do_outfp, PARTICLE_PARAM * param,
+                                uint32_t width, uint32_t height);
 };
 
 //////////////////////////////////////////////////////////////////////////////
@@ -139,6 +156,10 @@
     uint8_t * my_pixels;
     uint32_t my_w;
     uint32_t my_h;
+    uint32_t my_left_margin;
+    uint32_t my_right_margin;
+    uint32_t my_top_margin;
+    uint32_t my_bottom_margin;
     ADMImage * my_outImage;
     uint32_t my_minArea;
     uint32_t my_maxArea;
@@ -177,6 +198,10 @@
         : my_pixels (pixels),
           my_w (w),
           my_h (h),
+          my_left_margin (0),
+          my_right_margin (w),
+          my_top_margin (0),
+          my_bottom_margin (h),
           my_outImage (outImage),
           my_particleArea (0),
           my_particleCentroidX (0),
@@ -185,6 +210,15 @@
     {
     }
 
+    void setCropping (uint32_t left_crop, uint32_t right_crop,
+                      uint32_t top_crop, uint32_t bottom_crop)
+    {
+        my_left_margin = left_crop;
+        my_right_margin = my_w - right_crop;
+        my_top_margin = top_crop;
+        my_bottom_margin = my_h - bottom_crop;
+    }
+
     // Return true if the pixel is part of a particle.
 
     bool goodPixel (uint8_t pixel) const
@@ -207,7 +241,9 @@
     }
 
     // This one does bounds checking, and forces references "off the edge" to
-    // the nearest valid pixel - it's useful for convolutions.
+    // the nearest valid pixel - it's useful for convolutions.  It does not
+    // currently respect the crop settings, only because we know that this
+    // function is used only when those aren't set.
 
     uint8_t & getPixelSafely (int32_t x, int32_t y) const
     {
@@ -247,7 +283,9 @@
 
     bool validPixel (uint32_t x, uint32_t y) const
     {
-        return (x < my_w && y < my_h);
+        // return (x < my_w && y < my_h);
+        return (x >= my_left_margin && x < my_right_margin
+                && y >= my_top_margin && y < my_bottom_margin);
     }
 
     bool goodPixel (uint32_t x, uint32_t y) const
@@ -310,4 +348,11 @@
         my_maxArea = newMaxArea;
     }
 };
+
+struct MenuMapping;
+uint8_t DIA_particle (AVDMGenericVideoStream *in,
+                      PARTICLE_PARAM * param,
+                      const MenuMapping * menu_mapping,
+                      uint32_t menu_mapping_count);
+
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRT.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRT.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRT.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -14,19 +14,15 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
 
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
+#include "default.h"
+
 #include <math.h>
-#include <math.h>
 #include <iconv.h>
 
 
 #ifdef USE_FREETYPE
 
-#include "default.h"
 #include "ADM_osSupport/ADM_misc.h"
 
 #include "ADM_toolkit/toolkit.hxx"
@@ -39,14 +35,14 @@
 #include "ADM_video/ADM_vidFont.h"
 #include "ADM_videoFilter/ADM_vidSRT.h"
 
-#include <ADM_assert.h>
+#include "ADM_assert.h"
 
 #include "ADM_osSupport/ADM_debugID.h"
 #define MODULE_NAME MODULE_FILTER
 #include "ADM_osSupport/ADM_debug.h"
 #include "ADM_filter/video_filters.h"
 
-#include <prefs.h>
+#include "prefs.h"
 
 static FILTER_PARAM subParam={15,{"_fontsize","_subname","_fontname","_charset",
 				"_baseLine","_Y_percent","_U_percent","_V_percent",

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRTRender.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRTRender.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRTRender.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -14,19 +14,15 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
 
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
+#include "default.h"
+
 #include <math.h>
-#include <math.h>
 #include <iconv.h>
 
 
 #ifdef USE_FREETYPE
 
-#include "default.h"
 #include "ADM_osSupport/ADM_misc.h"
 
 
@@ -37,7 +33,7 @@
 
 #include "ADM_video/ADM_vidFont.h"
 #include "ADM_videoFilter/ADM_vidSRT.h"
-#include <ADM_assert.h>
+#include "ADM_assert.h"
 
 #include "ADM_osSupport/ADM_debugID.h"
 #define MODULE_NAME MODULE_FILTER

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRTload.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRTload.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSRTload.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -24,20 +24,16 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#include "config.h"
 
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
+#include "default.h"
+
 #include <math.h>
-#include <math.h>
 #include <iconv.h>
 #include <errno.h>
 
 
 #ifdef USE_FREETYPE
 //#define __STDC_ISO_10646__
-#include "default.h"
 #include "ADM_osSupport/ADM_misc.h"
 
 #include "ADM_toolkit/toolkit.hxx"
@@ -48,7 +44,7 @@
 
 #include "ADM_video/ADM_vidFont.h"
 #include "ADM_videoFilter/ADM_vidSRT.h"
-#include <ADM_assert.h>
+#include "ADM_assert.h"
 
 #include "ADM_osSupport/ADM_debugID.h"
 #define MODULE_NAME MODULE_FILTER

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -15,13 +15,10 @@
  *                                                                         *
  ***************************************************************************/
  
- 
+#include "default.h"
+
 #include <ctype.h>
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
 #include <errno.h>
-#include <ADM_assert.h>
 #include <math.h>
 #include <sys/types.h>
 #include <sys/stat.h>
@@ -30,10 +27,9 @@
 #include <fstream>
 #include <iterator>
 
-#include "config.h"
+#include "ADM_assert.h"
 #include "fourcc.h"
 #include "avio.hxx"
-#include "config.h"
 #include "avi_vars.h"
 
 #include "ADM_toolkit/toolkit.hxx"
@@ -50,6 +46,7 @@
 #include "ADM_vidSwissArmyKnife.h"
 #include "ADM_vidParticle.h" // for ImageTool
 #include "ADM_vidComputeAverage.h" // for ADMVideoComputeAverage::FileHeader
+#include "DIA_flyDialog.h" // for MenuMapping
 
 static const int MAX_PIXEL_LUMA = 255;
 
@@ -57,27 +54,27 @@
 {
     15,
     { "tool", "input_type", "input_file", "load_bias",              // 4
-      "load_multiplier", "input_constant", "memory_constant_denom", // + 3 = 7
+      "load_multiplier", "input_constant", "memory_constant_alpha", // + 3 = 7
       "init_start_frame", "init_end_frame", "init_by_rolling",      // + 3 = 10
-      "bias", "scale_from_min", "scale_from_max",                   // + 3 = 13
+      "bias", "result_bias", "result_multiplier",                   // + 3 = 13
       "histogram_frame_interval", "debug"                           // + 2 = 15
     }
 };
 
 ADMVideoSwissArmyKnife::ToolMap ADMVideoSwissArmyKnife::tool_map [] =
 {
-    { TOOL_A,         "A",        "%s" },
-    { TOOL_P,         "P",        "P" },
-    { TOOL_P_MINUS_A, "P-A",      "P-%s" },
-    { TOOL_A_MINUS_P, "A-P",      "%s-P" },
-    { TOOL_P_PLUS_A,  "P+A",      "P+%s" },
-    { TOOL_P_TIMES_A, "P*A",      "P*%s" },
-    { TOOL_P_DIVBY_A, "P/A",      "P/%s" },
-    { TOOL_A_DIVBY_P, "A/P",      "%s/P" },
-    { TOOL_MIN_P_A,   "min(P,A)", "min(P,%s)" },
-    { TOOL_MAX_P_A,   "max(P,A)", "max(P,%s)" },
+    { TOOL_A,         "A",        "%s",        "%s"     },
+    { TOOL_P,         "P",        "P",         "P"      },
+    { TOOL_P_MINUS_A, "P-A",      "P-%s",      "P - %s" },
+    { TOOL_A_MINUS_P, "A-P",      "%s-P",      "%s - P" },
+    { TOOL_P_PLUS_A,  "P+A",      "P+%s",      "P + %s" },
+    { TOOL_P_TIMES_A, "P*A",      "P*%s",      "P * %s" },
+    { TOOL_P_DIVBY_A, "P/A",      "P/%s",      "P / %s" },
+    { TOOL_A_DIVBY_P, "A/P",      "%s/P",      "%s / P" },
+    { TOOL_MIN_P_A,   "min(P,A)", "min(P,%s)", "min (P, %s)" },
+    { TOOL_MAX_P_A,   "max(P,A)", "max(P,%s)", "max (P, %s)" },
 
-    { TOOL_INVALID, 0, 0 }
+    { TOOL_INVALID, 0, 0, 0 }
 };
 
 // This is a hack to work around the fact that the ctor & dtor get called
@@ -104,52 +101,56 @@
     _info.encoding = 1;
     _uncompressed = new ADMImage(_in->getInfo()->width, _in->getInfo()->height);
     ADM_assert(_uncompressed);
-    _param=NEW(SWISSARMYKNIFE_PARAM);
+    _param = new SWISSARMYKNIFE_PARAM;
 
     if (couples)
     {
         GET(tool);
         GET(input_type);
 
-        char * tmp;
-        GET2(input_file, tmp);
+        GET(input_file);
         GET(load_bias);
         GET(load_multiplier);
 
         GET(input_constant);
 
-        GET(memory_constant_denom);
+        GET(memory_constant_alpha);
         GET(init_start_frame);
         GET(init_end_frame);
         GET(init_by_rolling);
 
         GET(bias);
-        GET(scale_from_min);
-        GET(scale_from_max);
+        GET(result_bias);
+        GET(result_multiplier);
         GET(histogram_frame_interval);
         GET(debug);
+
+        _param->enable_preview
+            = (_param->input_type != INPUT_ROLLING_AVERAGE);
     }
     else
     {
         _param->tool = TOOL_P_MINUS_A;
         _param->input_type = INPUT_ROLLING_AVERAGE;
 
-        _param->input_file = ADM_strdup ("");
+        // _param->input_file = ""; // implicit
         _param->load_bias = 0.0;
         _param->load_multiplier = 1.0;
 
         _param->input_constant = 0;
 
-        _param->memory_constant_denom = 100;
         _param->init_start_frame = 1;
         _param->init_end_frame = 100;
+        _param->memory_constant_alpha = 1.0 / _param->init_end_frame;
         _param->init_by_rolling = false;
 
         _param->bias = 128;
-        _param->scale_from_min = 0;
-        _param->scale_from_max = 255;
+        _param->result_bias = 0.0;
+        _param->result_multiplier = 1.0;
         _param->histogram_frame_interval = 0;
         _param->debug = 0;
+
+        _param->enable_preview = false;
     }
 
     // This is a hack to work around the fact that the ctor & dtor get called
@@ -238,24 +239,22 @@
 
     CSET(input_constant);
 
-    CSET(memory_constant_denom);
+    CSET(memory_constant_alpha);
     CSET(init_start_frame);
     CSET(init_end_frame);
     CSET(init_by_rolling);
 
     CSET(bias);
-    CSET(scale_from_min);
-    CSET(scale_from_max);
+    CSET(result_bias);
+    CSET(result_multiplier);
     CSET(histogram_frame_interval);
     CSET(debug);
 
     return 1;
 }
 
-uint8_t ADMVideoSwissArmyKnife::configure(AVDMGenericVideoStream *in)
+uint8_t ADMVideoSwissArmyKnife::configure (AVDMGenericVideoStream *in)
 {
-    UNUSED_ARG(in);
-
     diaMenuEntry tTool [] = {
         { TOOL_A,          QT_TR_NOOP("P' = A"), NULL },
         { TOOL_P,          QT_TR_NOOP("P' = P"), NULL },
@@ -286,13 +285,38 @@
         (&(_param->tool),
          QT_TR_NOOP("Select _Operation on each pixel P and input A:"),
          sizeof (tTool) / sizeof (diaMenuEntry), tTool);
+
     diaElemMenu input_type
         (&(_param->input_type),
          QT_TR_NOOP("Input _Type:"),
          sizeof (tInputType) / sizeof (diaMenuEntry), tInputType);
 
+    MenuMapping menu_mapping [] = {
+        { "operationMenu", my_offsetof (SWISSARMYKNIFE_PARAM, tool),
+          sizeof (tTool) / sizeof (diaMenuEntry), tTool },
+        { "inputTypeMenu", my_offsetof (SWISSARMYKNIFE_PARAM, input_type),
+          sizeof (tInputType) / sizeof (diaMenuEntry), tInputType },
+    };
+
+    // printf ("ADM_vidSwissArmyKnife: _param = %p\n", _param);
+    uint8_t ret = DIA_SwissArmyKnife (_in, this, _param, menu_mapping,
+                                      sizeof (menu_mapping)
+                                      / sizeof (MenuMapping));
+    if (ret == 1)
+    {
+        return ret;
+    }
+    else if (ret == 0) // 0 = cancel
+    {
+        return ret;
+    }
+    else
+    {
+        ADM_assert (ret == 255); // 255 = whizzy dialog not implemented
+    }
+
     diaElemFile input_file
-        (0, const_cast<char **>(&(_param->input_file)),
+        (0, &(_param->input_file),
          QT_TR_NOOP("Input _File (image or convolution kernel):"));
     diaElemFloat load_bias
         (&(_param->load_bias),
@@ -309,9 +333,9 @@
         (&(_param->input_constant),
          QT_TR_NOOP("Input _Constant:"), -99999, +99999); // arbitrary!
 
-    diaElemUInteger memory_constant_denom
-        (&(_param->memory_constant_denom),
-         QT_TR_NOOP("Denominator of memory constant _alpha\n"
+    diaElemFloat memory_constant_alpha
+        (&(_param->memory_constant_alpha),
+         QT_TR_NOOP("Memory constant _alpha\n"
            "(where A = (1-alpha)*A + alpha*curr_frame):"),
          0, 0x7fffffff);
     diaElemUInteger init_start_frame
@@ -330,12 +354,15 @@
     diaElemSlider bias
         (&(_param->bias),
          QT_TR_NOOP("_Bias (will be added to result):"), -256, +256);
-    diaElemSlider scale_from_min
-        (&(_param->scale_from_min),
-         QT_TR_NOOP("Mi_nimum value (will be scaled to 0):"), -1024, +1024);
-    diaElemSlider scale_from_max
-        (&(_param->scale_from_max),
-         QT_TR_NOOP("Ma_ximum value (will be scaled to 255):"), -1024, +1024);
+    diaElemFloat result_bias
+        (&(_param->result_bias),
+         QT_TR_NOOP("_Result Bias (added to each result pixel):"),
+         -99999, +99999); // arbitrary!
+    diaElemFloat result_multiplier
+        (&(_param->result_multiplier),
+         QT_TR_NOOP("Result _Multiplier (each result pixel\n"
+           "multiplied by this):"),
+         -99999, +99999); // arbitrary!
     diaElemUInteger histogram_frame_interval
         (&(_param->histogram_frame_interval),
          QT_TR_NOOP("_Histogram every N frames (0 to disable):"), 0, 0x7fffffff);
@@ -344,19 +371,19 @@
 
     diaElem * elems[] = { &tool, &input_type, &input_file, &load_bias,
                           &load_multiplier, &input_constant,
-                          &memory_constant_denom, &init_start_frame,
+                          &memory_constant_alpha, &init_start_frame,
                           &init_end_frame, &init_by_rolling,
-                          &bias, &scale_from_min, &scale_from_max,
+                          &bias, &result_bias, &result_multiplier,
                           &histogram_frame_interval, &debug };
 
-    uint8_t ret = diaFactoryRun("SwissArmyKnife", sizeof (elems) / sizeof (diaElem *), elems);
+    ret = diaFactoryRun ("Swiss Army Knife Configuration",
+                         sizeof (elems) / sizeof (diaElem *), elems);
     if (ret) // 0 = cancel
     {
         myInfo->image_data_invalid = true;
         myInfo->histogram_data_invalid = true;
     }
     return ret;
-	
 }
 
 ADMVideoSwissArmyKnife::~ADMVideoSwissArmyKnife()
@@ -391,14 +418,20 @@
     _uncompressed = NULL;
 }
 
-char * ADMVideoSwissArmyKnife::printConf( void) 
+char * ADMVideoSwissArmyKnife::printConf ()
 {
+    return getConf (_param, false);
+}
+
+char * ADMVideoSwissArmyKnife::getConf (SWISSARMYKNIFE_PARAM * param,
+                                        bool forDialog)
+{
     const int CONF_LEN = 1024;
     static char conf[CONF_LEN];
 
     ToolMap * tm;
     for (tm = tool_map; tm->outputName; tm++)
-        if (tm->toolid == _param->tool)
+        if (tm->toolid == param->tool)
             break;
 
     char inputstr [CONF_LEN];
@@ -406,75 +439,91 @@
     where[0] = '\0';
     char moreinfo [256];
     moreinfo[0] = '\0';
-    const char * input_file = _param->input_file;
+    const char * input_file = param->input_file.c_str();
     if (!input_file || !*input_file)
         input_file = "**** no file selected ****";
-    switch (_param->input_type)
+
+    const char * space = forDialog ? " " : "";
+
+    switch (param->input_type)
     {
     case INPUT_CUSTOM_CONVOLUTION:
-        snprintf (inputstr, CONF_LEN, "convolve(P,%s)", input_file);
+        snprintf (inputstr, CONF_LEN, "convolve%s(P,%s%s)",
+                  space, space, input_file);
         break;
     case INPUT_FILE_IMAGE_FLOAT:
         snprintf (inputstr, CONF_LEN,
-                  (_param->load_bias == 0.0 && _param->load_multiplier == 1.0)
-                  ? "pixel_from(%s)"
-                  : "((pixel_from(%s)%+.6f)*%.6f)",
-                  input_file, _param->load_bias, _param->load_multiplier);
+                  (param->load_bias == 0.0 && param->load_multiplier == 1.0)
+                  ? "pixel_from%s(%s)"
+                  : (forDialog ? "((pixel_from%s(%s) + %.6f) * %.6f)"
+                     : "((pixel_from%s(%s)%+.6f)*%.6f)"),
+                  space, input_file,
+                  param->load_bias, param->load_multiplier);
         break;
     case INPUT_FILE_IMAGE_INTEGER:
         snprintf (inputstr, CONF_LEN,
-                  (_param->load_bias == 0.0 && _param->load_multiplier == 1.0)
-                  ? "integer(pixel_from(%s))"
-                  : "integer((pixel_from(%s)%+.6f)*%.6f)",
-                  input_file, _param->load_bias, _param->load_multiplier);
+                  (param->load_bias == 0.0 && param->load_multiplier == 1.0)
+                  ? "integer(pixel_from%s(%s))"
+                  : (forDialog ? "integer((pixel_from%s(%s) + %.6f) * %.6f)"
+                     : "integer((pixel_from%s(%s)%+.6f)*%.6f)"),
+                  space, input_file,
+                  param->load_bias, param->load_multiplier);
         break;
     case INPUT_CONSTANT_VALUE:
-        if (int (_param->input_constant) == _param->input_constant)
-            sprintf (inputstr, "%d", int (_param->input_constant));
+        if (int (param->input_constant) == param->input_constant)
+            sprintf (inputstr, "%d", int (param->input_constant));
         else
-            sprintf (inputstr, "%.6f", _param->input_constant);
+            sprintf (inputstr, "%.6f", param->input_constant);
         break;
     case INPUT_ROLLING_AVERAGE:
         sprintf (inputstr, "A");
         sprintf (where, " (where each frame, A=(A*(1-alpha))+(P*alpha), "
-                 "alpha=1/%u=%.6f)", _param->memory_constant_denom,
-                 1.0 / _param->memory_constant_denom);
-        if (_param->init_start_frame)
+                 "alpha%s=%s%.6f)",
+                 space, space, param->memory_constant_alpha);
+        if (param->init_start_frame)
             sprintf (moreinfo, ", initial A = %s avg of frames %u - %u",
-                     _param->init_by_rolling ? "rolling" : "straight",
-                     _param->init_start_frame, _param->init_end_frame);
+                     param->init_by_rolling ? "rolling" : "straight",
+                     param->init_start_frame, param->init_end_frame);
         break;
     default:
         sprintf (inputstr, "OOOPS!! (unexpected type %d)",
-                 _param->input_type);
+                 param->input_type);
         break;
     }
 
     char * cptr = conf;
 
-    cptr += snprintf (conf, CONF_LEN, "Swiss Army Knife: P' = ");
-    cptr += snprintf (cptr, CONF_LEN - (cptr - conf), tm->format, inputstr);
-    if (_param->bias)
-        cptr += snprintf (cptr, CONF_LEN - (cptr - conf), "%+d",
-                          _param->bias);
+    bool result_is_scaled
+        = (param->result_bias != 0.0 || param->result_multiplier != 1.0);
+
+    if (!forDialog)
+        cptr += snprintf (conf, CONF_LEN, "Swiss Army Knife: ");
+    cptr += snprintf (cptr, CONF_LEN - (cptr - conf), "P' = %s",
+                      result_is_scaled ? "((" : "");
+    cptr += snprintf (cptr, CONF_LEN - (cptr - conf),
+                      forDialog ? tm->spacy_format : tm->format, inputstr);
+    if (param->bias)
+        cptr += snprintf (cptr, CONF_LEN - (cptr - conf),
+                          forDialog ? " + %d" : "%+d", param->bias);
     cptr += snprintf (cptr, CONF_LEN - (cptr - conf), "%s", where);
-    if (_param->scale_from_min != 0 || _param->scale_from_max != 255)
+    if (result_is_scaled)
         cptr += snprintf (cptr, CONF_LEN - (cptr - conf),
-                          ", scaled from %d..%d to 0..255",
-                          _param->scale_from_min, _param->scale_from_max);
+                          forDialog ? ") + %.6f) * %.6f" : ")%+.6f)*%.6f",
+                          param->result_bias, param->result_multiplier);
     cptr += snprintf (cptr, CONF_LEN - (cptr - conf), "%s", moreinfo);
-    if (_param->histogram_frame_interval)
+    if (param->histogram_frame_interval)
         cptr += snprintf (cptr, CONF_LEN - (cptr - conf),
                           ", histogram every %u frames",
-                          _param->histogram_frame_interval);
-    if (_param->debug)
+                          param->histogram_frame_interval);
+    if (param->debug)
         cptr += snprintf (cptr, CONF_LEN - (cptr - conf),
-                          ", debug=0x%x", _param->debug);
-    fprintf (stderr, "conf is (%d) \"%s\"\n", cptr - conf, conf);
+                          ", debug%s=%s0x%x", space, space, param->debug);
+    if (!forDialog)
+        fprintf (stderr, "SAK conf is (%d) \"%s\"\n", cptr - conf, conf);
     return conf;
 }
 
-//==============================================================================
+//============================================================================
 
 // Note: The structure of the following code (with the template functions, and
 // the functor objects, etc.) is all about minimizing the code executed
@@ -488,7 +537,7 @@
 // point of templates.  So, buckle your seat belts, because this is where C++
 // gets really fun!
 
-//==============================================================================
+//============================================================================
 
 class HistogramNull // do-nothing version
 {
@@ -516,7 +565,7 @@
     }
 };
 
-//------------------------------------------------------------------------------
+//----------------------------------------------------------------------------
 
 class Histogram
 {
@@ -709,7 +758,7 @@
     }
 };
 
-//==============================================================================
+//============================================================================
 
 template <typename Oper, typename Histo>
 void ImageTool::convolve (const std::vector <float> & kernel,
@@ -819,12 +868,13 @@
     }
 }
 
-//==============================================================================
+//============================================================================
 
 template <typename Oper, typename Histo>
 void ADMVideoSwissArmyKnife::computeRollingAverage (ADMImage * image,
                                                     ADMImage * data,
                                                     uint32_t planesize,
+                                                    SWISSARMYKNIFE_PARAM * param,
                                                     int32_t bias,
                                                     const Oper & op_in,
                                                     const Histo & histogram_in)
@@ -837,7 +887,7 @@
     Histo histogram = histogram_in;
     Oper op = op_in;
 
-    float alpha = 1.0 / _param->memory_constant_denom;
+    float alpha = param->memory_constant_alpha;
     float oneminusalpha = 1 - alpha;
 
     // HERE: for speed, we do luma (Y plane) only.  However, some
@@ -881,18 +931,20 @@
         *--destp = result;
     }
 
-    if (_param->debug & 2)
+    if (param->debug & 2)
     {
         if (satlow || sathigh)
             printf ("    Saturated %d low, %d high\n", satlow, sathigh);
     }
 }
 
-//==============================================================================
+//============================================================================
 
 template <typename InputImageType, typename Oper, typename Histo>
 void ADMVideoSwissArmyKnife::applyImage (ADMImage * image, ADMImage * data,
-                                         uint32_t planesize, int32_t bias,
+                                         uint32_t planesize,
+                                         SWISSARMYKNIFE_PARAM * param,
+                                         int32_t bias,
                                          InputImageType * input_image,
                                          const Oper & op_in,
                                          const Histo & histogram_in)
@@ -944,18 +996,20 @@
         *--destp = result;
     }
 
-    if (_param->debug & 2)
+    if (param->debug & 2)
     {
         if (satlow || sathigh)
             printf ("    Saturated %d low, %d high\n", satlow, sathigh);
     }
 }
 
-//==============================================================================
+//============================================================================
 
 template <typename Oper, typename Histo>
 void ADMVideoSwissArmyKnife::applyConstant (ADMImage * image, ADMImage * data,
-                                            uint32_t planesize, int32_t bias,
+                                            uint32_t planesize,
+                                            SWISSARMYKNIFE_PARAM * param,
+                                            int32_t bias,
                                             const Oper & op_in,
                                             const Histo & histogram_in)
 {
@@ -973,7 +1027,7 @@
 
     uint8_t * currp = YPLANE (image) + planesize;
     uint8_t * destp = YPLANE (data) + planesize;
-    float A = _param->input_constant;
+    float A = param->input_constant;
     uint32_t pixremaining = planesize + 1;
 
     uint32_t sathigh = 0;
@@ -1005,14 +1059,14 @@
         *--destp = result;
     }
 
-    if (_param->debug & 2)
+    if (param->debug & 2)
     {
         if (satlow || sathigh)
             printf ("    Saturated %d low, %d high\n", satlow, sathigh);
     }
 }
 
-//==============================================================================
+//============================================================================
 
 class OpPequalsA
 {
@@ -1156,195 +1210,218 @@
     }
 };
 
-//------------------------------------------------------------------------------
+//----------------------------------------------------------------------------
 
 class OpPequalsA_Scaled
 {
-    float scale_min;
+    float bias;
     float multiplier;
 public:
-    OpPequalsA_Scaled (int32_t scale_min, int32_t scale_max)
-        : scale_min (scale_min),
-          multiplier (MAX_PIXEL_LUMA / float (scale_max - scale_min))  { }
+    OpPequalsA_Scaled (float bias, float multiplier)
+        : bias (bias),
+          multiplier (multiplier)  { }
 
     int32_t operator () (int32_t P, float A) const
     {
-        return static_cast <int32_t> (((A - scale_min) * multiplier) + .5);
+        return static_cast <int32_t> (((A + bias) * multiplier) + .5);
     }
 };
 
 class OpPequalsP_Scaled
 {
-    float scale_min;
+    float bias;
     float multiplier;
 public:
-    OpPequalsP_Scaled (int32_t scale_min, int32_t scale_max)
-        : scale_min (scale_min),
-          multiplier (MAX_PIXEL_LUMA / float (scale_max - scale_min))  { }
+    OpPequalsP_Scaled (float bias, float multiplier)
+        : bias (bias),
+          multiplier (multiplier)  { }
 
     int32_t operator () (int32_t P, float A) const
     {
-        return static_cast <int32_t> (((P - scale_min) * multiplier) + .5);
+        return static_cast <int32_t> (((P + bias) * multiplier) + .5);
     }
 };
 
 class OpPequalsPminusA_Scaled
 {
-    float scale_min;
+    float bias;
     float multiplier;
 public:
-    OpPequalsPminusA_Scaled (int32_t scale_min, int32_t scale_max)
-        : scale_min (scale_min),
-          multiplier (MAX_PIXEL_LUMA / float (scale_max - scale_min))  { }
+    OpPequalsPminusA_Scaled (float bias, float multiplier)
+        : bias (bias),
+          multiplier (multiplier)  { }
 
     int32_t operator () (int32_t P, float A) const
     {
         return (static_cast <int32_t>
-                ((((P - A) - scale_min) * multiplier) + .5));
+                ((((P - A) + bias) * multiplier) + .5));
     }
 };
 
 class OpPequalsAminusP_Scaled
 {
-    float scale_min;
+    float bias;
     float multiplier;
 public:
-    OpPequalsAminusP_Scaled (int32_t scale_min, int32_t scale_max)
-        : scale_min (scale_min),
-          multiplier (MAX_PIXEL_LUMA / float (scale_max - scale_min))  { }
+    OpPequalsAminusP_Scaled (float bias, float multiplier)
+        : bias (bias),
+          multiplier (multiplier)  { }
 
     int32_t operator () (int32_t P, float A) const
     {
         return (static_cast <int32_t>
-                ((((A - P) - scale_min) * multiplier) + .5));
+                ((((A - P) + bias) * multiplier) + .5));
     }
 };
 
 class OpPequalsPplusA_Scaled
 {
-    float scale_min;
+    float bias;
     float multiplier;
 public:
-    OpPequalsPplusA_Scaled (int32_t scale_min, int32_t scale_max)
-        : scale_min (scale_min),
-          multiplier (MAX_PIXEL_LUMA / float (scale_max - scale_min))  { }
+    OpPequalsPplusA_Scaled (float bias, float multiplier)
+        : bias (bias),
+          multiplier (multiplier)  { }
 
     int32_t operator () (int32_t P, float A) const
     {
         return (static_cast <int32_t>
-                ((((P + A) - scale_min) * multiplier) + .5));
+                ((((P + A) + bias) * multiplier) + .5));
     }
 };
 
 class OpPequalsPtimesA_Scaled
 {
-    float scale_min;
+    float bias;
     float multiplier;
 public:
-    OpPequalsPtimesA_Scaled (int32_t scale_min, int32_t scale_max)
-        : scale_min (scale_min),
-          multiplier (MAX_PIXEL_LUMA / float (scale_max - scale_min))  { }
+    OpPequalsPtimesA_Scaled (float bias, float multiplier)
+        : bias (bias),
+          multiplier (multiplier)  { }
 
     int32_t operator () (int32_t P, float A) const
     {
         return (static_cast <int32_t>
-                ((((P * A) - scale_min) * multiplier) + .5));
+                ((((P * A) + bias) * multiplier) + .5));
     }
 };
 
 class OpPequalsPdivByA_Scaled
 {
-    float scale_min;
+    float bias;
     float multiplier;
 public:
-    OpPequalsPdivByA_Scaled (int32_t scale_min, int32_t scale_max)
-        : scale_min (scale_min),
-          multiplier (MAX_PIXEL_LUMA / float (scale_max - scale_min))  { }
+    OpPequalsPdivByA_Scaled (float bias, float multiplier)
+        : bias (bias),
+          multiplier (multiplier)  { }
 
     int32_t operator () (int32_t P, float A) const
     {
         return (static_cast <int32_t>
-                ((((P / A) - scale_min) * multiplier) + .5));
+                ((((P / A) + bias) * multiplier) + .5));
     }
 };
 
 class OpPequalsAdivByP_Scaled
 {
-    float scale_min;
+    float bias;
     float multiplier;
 public:
-    OpPequalsAdivByP_Scaled (int32_t scale_min, int32_t scale_max)
-        : scale_min (scale_min),
-          multiplier (MAX_PIXEL_LUMA / float (scale_max - scale_min))  { }
+    OpPequalsAdivByP_Scaled (float bias, float multiplier)
+        : bias (bias),
+          multiplier (multiplier)  { }
 
     int32_t operator () (int32_t P, float A) const
     {
         return (static_cast <int32_t>
-                ((((A / P) - scale_min) * multiplier) + .5));
+                ((((A / P) + bias) * multiplier) + .5));
     }
 };
 
 class OpPequalsMinPA_Scaled
 {
-    float scale_min;
+    float bias;
     float multiplier;
 public:
-    OpPequalsMinPA_Scaled (int32_t scale_min, int32_t scale_max)
-        : scale_min (scale_min),
-          multiplier (MAX_PIXEL_LUMA / float (scale_max - scale_min))  { }
+    OpPequalsMinPA_Scaled (float bias, float multiplier)
+        : bias (bias),
+          multiplier (multiplier)  { }
 
     int32_t operator () (int32_t P, float A) const
     {
         return (static_cast <int32_t>
-                ((((A > P ? P : A) - scale_min) * multiplier) + .5));
+                ((((A > P ? P : A) + bias) * multiplier) + .5));
     }
 };
 
 class OpPequalsMaxPA_Scaled
 {
-    float scale_min;
+    float bias;
     float multiplier;
 public:
-    OpPequalsMaxPA_Scaled (int32_t scale_min, int32_t scale_max)
-        : scale_min (scale_min),
-          multiplier (MAX_PIXEL_LUMA / float (scale_max - scale_min))  { }
+    OpPequalsMaxPA_Scaled (float bias, float multiplier)
+        : bias (bias),
+          multiplier (multiplier)  { }
 
     int32_t operator () (int32_t P, float A) const
     {
         return (static_cast <int32_t>
-                ((((A > P ? A : P) - scale_min) * multiplier) + .5));
+                ((((A > P ? A : P) + bias) * multiplier) + .5));
     }
 };
 
-//==============================================================================
+//============================================================================
 
-uint8_t ADMVideoSwissArmyKnife::getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-          			ADMImage *data, uint32_t *flags)
+uint8_t ADMVideoSwissArmyKnife::getFrameNumberNoAlloc(uint32_t frame,
+                                                      uint32_t *len,
+                                                      ADMImage *data,
+                                                      uint32_t *flags)
 {
     if (frame >= _info.nb_frames)
         return 0;
 
-    uint32_t debug = _param->debug;
-
-    if (debug & 1)
+    if (_param->debug & 1)
         printf ("in ADMVideoSwissArmyKnife::getFrameNumberNoAlloc(%d, ...)\n",
                 frame);
 
-    bool doingConvolution = (_param->input_type == INPUT_CUSTOM_CONVOLUTION);
-    bool doingRollingAvg = (_param->input_type == INPUT_ROLLING_AVERAGE);
-    bool doingFileImage = (_param->input_type == INPUT_FILE_IMAGE_FLOAT
-                           || _param->input_type == INPUT_FILE_IMAGE_INTEGER);
-    bool doingFileImageFloat = (_param->input_type == INPUT_FILE_IMAGE_FLOAT);
-    bool doingApplyConstant = (_param->input_type == INPUT_CONSTANT_VALUE);
+    if (!_in->getFrameNumberNoAlloc (frame, len, _uncompressed, flags))
+        return 0;
 
+    uint32_t planesize = _info.width * _info.height;
+    uint32_t size = (planesize * 3) >> 1;
+    *len = size;
+
+    uint8_t ret = doSwissArmyKnife (_uncompressed, data, _in, this, _param,
+                                    _info.width, _info.height);
+    return ret;
+}
+
+uint8_t
+ADMVideoSwissArmyKnife::doSwissArmyKnife (ADMImage * image,
+                                          ADMImage * data,
+                                          AVDMGenericVideoStream * in,
+                                          ADMVideoSwissArmyKnife * sak,
+                                          SWISSARMYKNIFE_PARAM * param,
+                                          uint32_t width, uint32_t height)
+{
+    PersistentInfo * myInfo = sak->myInfo;
+    uint32_t debug = param->debug;
+
+    bool doingConvolution = (param->input_type == INPUT_CUSTOM_CONVOLUTION);
+    bool doingRollingAvg = (param->input_type == INPUT_ROLLING_AVERAGE);
+    bool doingFileImage = (param->input_type == INPUT_FILE_IMAGE_FLOAT
+                           || param->input_type == INPUT_FILE_IMAGE_INTEGER);
+    bool doingFileImageFloat = (param->input_type == INPUT_FILE_IMAGE_FLOAT);
+    bool doingApplyConstant = (param->input_type == INPUT_CONSTANT_VALUE);
+
     bool needRead = false;
     bool needFile = doingConvolution || doingFileImage;
 
     if (needFile)
     {
-        if (myInfo->input_file_name != _param->input_file)
+        if (myInfo->input_file_name != param->input_file)
         {
-            myInfo->input_file_name = _param->input_file;
+            myInfo->input_file_name = param->input_file;
             myInfo->input_file_mtime = 0;
             printf ("SwissArmyKnife: new input file has been selected: %s\n",
                     myInfo->input_file_name.c_str());
@@ -1369,19 +1446,22 @@
             needRead = true;
             myInfo->input_file_mtime = st.st_mtime;
         }
-        else if (!needRead && myInfo->image_data_invalid)
-            needRead = true;
+        else if (!needRead)
+        {
+            if (myInfo->image_data_invalid
+                || myInfo->image_bias != param->load_bias
+                || myInfo->image_multiplier != param->load_multiplier)
+            {
+                needRead = true;
+            }
+        }
     }
 
     FloatVector & kernel = myInfo->kernel;
     uint32_t & kernel_w = myInfo->kernel_w;
     uint32_t & kernel_h = myInfo->kernel_h;
 
-    uint32_t w = _info.width;
-    uint32_t h = _info.height;
-    uint32_t planesize = w * h;
-    uint32_t size = (planesize * 3) >> 1;
-    *len = size;
+    uint32_t planesize = width * height;
 			
     if (needRead)
     {
@@ -1475,8 +1555,8 @@
         }
         else // file image (not convolution)
         {
-            ADM_assert (_param->input_type == INPUT_FILE_IMAGE_FLOAT
-                        || _param->input_type == INPUT_FILE_IMAGE_INTEGER);
+            ADM_assert (param->input_type == INPUT_FILE_IMAGE_FLOAT
+                        || param->input_type == INPUT_FILE_IMAGE_INTEGER);
 
             const char * filename = myInfo->input_file_name.c_str();
             FILE * fin = fopen (filename, "rb");
@@ -1537,7 +1617,7 @@
             float * floatpixp = myInfo->image_float + pixelcount;
             uint8_t * intpixp = myInfo->image_int + pixelcount;
 
-            if (_param->load_bias == 0.0 && _param->load_multiplier == 1.0)
+            if (param->load_bias == 0.0 && param->load_multiplier == 1.0)
             {
                 printf ("Converting %u pixels to integer values (and keeping "
                         "the floats, too)\n", pixelcount);
@@ -1550,8 +1630,8 @@
             }
             else
             {
-                float load_bias = _param->load_bias;
-                float load_multiplier = _param->load_multiplier;
+                float load_bias = param->load_bias;
+                float load_multiplier = param->load_multiplier;
 
                 printf ("applying P = (P + %.6f) * %.6f to %u pixels\n",
                         load_bias, load_multiplier, pixelcount);
@@ -1577,32 +1657,34 @@
 
             myInfo->image_w = width;
             myInfo->image_h = height;
+            myInfo->image_bias = param->load_bias;
+            myInfo->image_multiplier = param->load_multiplier;
             myInfo->image_data_invalid = false;
         }
     }
     else if (doingRollingAvg)
     {
         if (!myInfo->bg
-            || myInfo->bg_x != w || myInfo->bg_y != h
-            || myInfo->bg_mc != _param->memory_constant_denom
-            || myInfo->bg_isf != _param->init_start_frame
-            || myInfo->bg_ief != _param->init_end_frame
-            || myInfo->bg_ibr != _param->init_by_rolling)
+            || myInfo->bg_x != width || myInfo->bg_y != height
+            || myInfo->bg_mca != param->memory_constant_alpha
+            || myInfo->bg_isf != param->init_start_frame
+            || myInfo->bg_ief != param->init_end_frame
+            || myInfo->bg_ibr != param->init_by_rolling)
         {
-            if (!myInfo->bg || myInfo->bg_x != w || myInfo->bg_y != h)
+            if (!myInfo->bg || myInfo->bg_x != width || myInfo->bg_y != height)
             {
-                myInfo->bg_x = w;
-                myInfo->bg_y = h;
+                myInfo->bg_x = width;
+                myInfo->bg_y = height;
                 delete [] myInfo->bg;
                 myInfo->bg = new float [planesize];
             }
 
             myInfo->histogram_data_invalid = true;
 
-            myInfo->bg_mc = _param->memory_constant_denom;
-            myInfo->bg_isf = _param->init_start_frame;
-            myInfo->bg_ief = _param->init_end_frame;
-            myInfo->bg_ibr = _param->init_by_rolling;
+            myInfo->bg_mca = param->memory_constant_alpha;
+            myInfo->bg_isf = param->init_start_frame;
+            myInfo->bg_ief = param->init_end_frame;
+            myInfo->bg_ibr = param->init_by_rolling;
 
             if (myInfo->bg_isf && myInfo->bg_isf <= myInfo->bg_ief)
             {
@@ -1610,27 +1692,28 @@
 
                 uint32_t firstframe = myInfo->bg_isf - 1;
                 uint32_t lastframe = myInfo->bg_ief - 1;
-                if (lastframe >= _info.nb_frames)
+                const ADV_Info & info = sak->getInfo();
+                if (lastframe >= info.nb_frames)
                 {
-                    lastframe = _info.nb_frames - 1;
-                    if (firstframe > _info.nb_frames)
+                    lastframe = info.nb_frames - 1;
+                    if (firstframe > info.nb_frames)
                     {
                         firstframe = lastframe - do_frames + 1;
-                        if (firstframe > _info.nb_frames)
+                        if (firstframe > info.nb_frames)
                             firstframe = 0;
                     }
                     do_frames = lastframe - firstframe + 1;
                 }
 
                 // if (debug & 2)
-                printf ("Getting a \"head start\" on rolling average by computing %s "
-                        "%d frames of size %dx%d from %d to %d with alpha = %.5f (1/%d)\n",
-                        myInfo->bg_ibr ? "rolling average over" : "straight average of",
+                printf ("Getting a \"head start\" on rolling average by "
+                        "computing a %s %d frames of size %dx%d from %d to "
+                        "%d with alpha = %.6f\n",
+                        myInfo->bg_ibr ? "rolling average over"
+                        : "straight average of",
                         do_frames, myInfo->bg_x, myInfo->bg_y,
-                        firstframe + 1, lastframe + 1,
-                        1.0 / myInfo->bg_mc, myInfo->bg_mc);
+                        firstframe + 1, lastframe + 1, myInfo->bg_mca);
 
-
                 ADMImage aimage (myInfo->bg_x, myInfo->bg_y);
 
                 // HERE: for speed, we do luma (Y plane) only.  However, some
@@ -1647,9 +1730,9 @@
                     // loop that follows:
                     {
                         uint32_t flen;
-                        uint32_t fflags = *flags;
-                        if (!_in->getFrameNumberNoAlloc (firstframe, &flen,
-                                                         &aimage, &fflags))
+                        uint32_t fflags = 0;
+                        if (!in->getFrameNumberNoAlloc (firstframe, &flen,
+                                                        &aimage, &fflags))
                             return 0;
 
                         uint8_t * currp = YPLANE (&aimage) + planesize;
@@ -1663,15 +1746,15 @@
                         ++firstframe; // don't include this one again
                     }
 
-                    float alpha = 1.0 / _param->memory_constant_denom;
+                    float alpha = param->memory_constant_alpha;
                     float oneminusalpha = 1 - alpha;
 
                     for (int fnum = firstframe; fnum <= lastframe; fnum++)
                     {
                         uint32_t flen;
-                        uint32_t fflags = *flags;
-                        if (!_in->getFrameNumberNoAlloc (fnum, &flen,
-                                                         &aimage, &fflags))
+                        uint32_t fflags = 0;
+                        if (!in->getFrameNumberNoAlloc (fnum, &flen,
+                                                        &aimage, &fflags))
                             return 0;
 
                         uint8_t * currp = YPLANE (&aimage) + planesize;
@@ -1692,9 +1775,9 @@
                     for (int fnum = firstframe; fnum <= lastframe; fnum++)
                     {
                         uint32_t flen;
-                        uint32_t fflags = *flags;
-                        if (!_in->getFrameNumberNoAlloc (fnum, &flen,
-                                                         &aimage, &fflags))
+                        uint32_t fflags = 0;
+                        if (!in->getFrameNumberNoAlloc (fnum, &flen,
+                                                        &aimage, &fflags))
                             return 0;
 
                         uint8_t * currp = YPLANE (&aimage) + planesize;
@@ -1732,42 +1815,38 @@
         {
             if (debug & 4)
                 printf ("Using existing baseline background of size %dx%d with "
-                        "alpha = %.5f (1/%d)\n", myInfo->bg_x, myInfo->bg_y,
-                        1.0 / myInfo->bg_mc, myInfo->bg_mc);
+                        "alpha = %.6f (1/%d)\n", myInfo->bg_x, myInfo->bg_y,
+                        myInfo->bg_mca);
         }
     }			
 
-    if (!_in->getFrameNumberNoAlloc (frame, len, _uncompressed, flags))
-        return 0;
-
-    ADMImage * image = _uncompressed;
     uint8_t * imagePixels = YPLANE (image);
 
-    ImageTool imtool (imagePixels, w, h, data);
+    ImageTool imtool (imagePixels, width, height, data);
     imtool.setDebug (debug);
 
     Histogram * histogram = 0;
-    int32_t bias = _param->bias;
-    uint32_t tool = _param->tool;
+    int32_t bias = param->bias;
+    uint32_t tool = param->tool;
 
-    // HERE: give some thought to the general issue of keeping myInfo & _param
+    // HERE: give some thought to the general issue of keeping myInfo & param
     // in sync, and resetting the histogram (or whatever) when things change.
 
-    if (_param->histogram_frame_interval != 0)
+    if (param->histogram_frame_interval != 0)
     {
         histogram = new Histogram (myInfo->histogram_input_data,
                                    myInfo->histogram_output_data,
-                                   _param->histogram_frame_interval,
+                                   param->histogram_frame_interval,
                                    myInfo->histogram_frame_count,
-                                   w * h);
+                                   width * height);
         tool += TOOL_ADD_HISTOGRAM;
         if (myInfo->histogram_frame_interval !=
-            _param->histogram_frame_interval)
+            param->histogram_frame_interval)
         {
             if (myInfo->histogram_frame_interval)
                 myInfo->histogram_data_invalid = true;
             myInfo->histogram_frame_interval
-                = _param->histogram_frame_interval;
+                = param->histogram_frame_interval;
         }
 
         if (myInfo->histogram_data_invalid)
@@ -1777,12 +1856,10 @@
         }
     }
 
-    int32_t scale_min = _param->scale_from_min;
-    int32_t scale_max = _param->scale_from_max;
-    if (scale_min != 0 || scale_max != 255)
+    float rbias = param->result_bias;
+    float rmultiplier = param->result_multiplier;
+    if (fabsf (rbias) >= 0.0001 || fabsf (rmultiplier - 1.0) >= 0.0001)
     {
-        // printf ("Scaling enabled (from %d..%d to 0..255)\n",
-        //         scale_min, scale_max);
         tool += TOOL_ADD_SCALING;
     }
 
@@ -1854,89 +1931,89 @@
 
         case TOOL_A_SCALED:
             imtool.convolve (kernel, kernel_w, kernel_h, bias,
-                             OpPequalsA_Scaled (scale_min, scale_max), HistogramNull());
+                             OpPequalsA_Scaled (rbias, rmultiplier), HistogramNull());
             break;
         case TOOL_P_SCALED: // HERE_SCALED: we could optimize this if we wanted to
             imtool.convolve (kernel, kernel_w, kernel_h, bias,
-                             OpPequalsP_Scaled (scale_min, scale_max), HistogramNull());
+                             OpPequalsP_Scaled (rbias, rmultiplier), HistogramNull());
             break;
         case TOOL_P_MINUS_A_SCALED:
             imtool.convolve (kernel, kernel_w, kernel_h, bias,
-                             OpPequalsPminusA_Scaled (scale_min, scale_max), HistogramNull());
+                             OpPequalsPminusA_Scaled (rbias, rmultiplier), HistogramNull());
             break;
         case TOOL_A_MINUS_P_SCALED:
             imtool.convolve (kernel, kernel_w, kernel_h, bias,
-                             OpPequalsAminusP_Scaled (scale_min, scale_max), HistogramNull());
+                             OpPequalsAminusP_Scaled (rbias, rmultiplier), HistogramNull());
             break;
         case TOOL_P_PLUS_A_SCALED:
             imtool.convolve (kernel, kernel_w, kernel_h, bias,
-                             OpPequalsPplusA_Scaled (scale_min, scale_max), HistogramNull());
+                             OpPequalsPplusA_Scaled (rbias, rmultiplier), HistogramNull());
             break;
         case TOOL_P_TIMES_A_SCALED:
             imtool.convolve (kernel, kernel_w, kernel_h, bias,
-                             OpPequalsPtimesA_Scaled (scale_min, scale_max), HistogramNull());
+                             OpPequalsPtimesA_Scaled (rbias, rmultiplier), HistogramNull());
             break;
         case TOOL_P_DIVBY_A_SCALED:
             imtool.convolve (kernel, kernel_w, kernel_h, bias,
-                             OpPequalsPdivByA_Scaled (scale_min, scale_max), HistogramNull());
+                             OpPequalsPdivByA_Scaled (rbias, rmultiplier), HistogramNull());
             break;
         case TOOL_A_DIVBY_P_SCALED:
             imtool.convolve (kernel, kernel_w, kernel_h, bias,
-                             OpPequalsAdivByP_Scaled (scale_min, scale_max), HistogramNull());
+                             OpPequalsAdivByP_Scaled (rbias, rmultiplier), HistogramNull());
             break;
         case TOOL_MIN_P_A_SCALED:
             imtool.convolve (kernel, kernel_w, kernel_h, bias,
-                             OpPequalsMinPA_Scaled (scale_min, scale_max), HistogramNull());
+                             OpPequalsMinPA_Scaled (rbias, rmultiplier), HistogramNull());
             break;
         case TOOL_MAX_P_A_SCALED:
             imtool.convolve (kernel, kernel_w, kernel_h, bias,
-                             OpPequalsMaxPA_Scaled (scale_min, scale_max), HistogramNull());
+                             OpPequalsMaxPA_Scaled (rbias, rmultiplier), HistogramNull());
             break;
 
         case TOOL_A_SCALED_WITH_HISTOGRAM:
             imtool.convolve (kernel, kernel_w, kernel_h, bias,
-                             OpPequalsA_Scaled (scale_min, scale_max), *histogram);
+                             OpPequalsA_Scaled (rbias, rmultiplier), *histogram);
             break;
         case TOOL_P_SCALED_WITH_HISTOGRAM: // HERE: we could optimize this if we wanted to
             imtool.convolve (kernel, kernel_w, kernel_h, bias,
-                             OpPequalsP_Scaled (scale_min, scale_max), *histogram);
+                             OpPequalsP_Scaled (rbias, rmultiplier), *histogram);
             break;
         case TOOL_P_MINUS_A_SCALED_WITH_HISTOGRAM:
             imtool.convolve (kernel, kernel_w, kernel_h, bias,
-                             OpPequalsPminusA_Scaled (scale_min, scale_max), *histogram);
+                             OpPequalsPminusA_Scaled (rbias, rmultiplier), *histogram);
             break;
         case TOOL_A_MINUS_P_SCALED_WITH_HISTOGRAM:
             imtool.convolve (kernel, kernel_w, kernel_h, bias,
-                             OpPequalsAminusP_Scaled (scale_min, scale_max), *histogram);
+                             OpPequalsAminusP_Scaled (rbias, rmultiplier), *histogram);
             break;
         case TOOL_P_PLUS_A_SCALED_WITH_HISTOGRAM:
             imtool.convolve (kernel, kernel_w, kernel_h, bias,
-                             OpPequalsPplusA_Scaled (scale_min, scale_max), *histogram);
+                             OpPequalsPplusA_Scaled (rbias, rmultiplier), *histogram);
             break;
         case TOOL_P_TIMES_A_SCALED_WITH_HISTOGRAM:
             imtool.convolve (kernel, kernel_w, kernel_h, bias,
-                             OpPequalsPtimesA_Scaled (scale_min, scale_max), *histogram);
+                             OpPequalsPtimesA_Scaled (rbias, rmultiplier), *histogram);
             break;
         case TOOL_P_DIVBY_A_SCALED_WITH_HISTOGRAM:
             imtool.convolve (kernel, kernel_w, kernel_h, bias,
-                             OpPequalsPdivByA_Scaled (scale_min, scale_max), *histogram);
+                             OpPequalsPdivByA_Scaled (rbias, rmultiplier), *histogram);
             break;
         case TOOL_A_DIVBY_P_SCALED_WITH_HISTOGRAM:
             imtool.convolve (kernel, kernel_w, kernel_h, bias,
-                             OpPequalsAdivByP_Scaled (scale_min, scale_max), *histogram);
+                             OpPequalsAdivByP_Scaled (rbias, rmultiplier), *histogram);
             break;
         case TOOL_MIN_P_A_SCALED_WITH_HISTOGRAM:
             imtool.convolve (kernel, kernel_w, kernel_h, bias,
-                             OpPequalsMinPA_Scaled (scale_min, scale_max), *histogram);
+                             OpPequalsMinPA_Scaled (rbias, rmultiplier), *histogram);
             break;
         case TOOL_MAX_P_A_SCALED_WITH_HISTOGRAM:
             imtool.convolve (kernel, kernel_w, kernel_h, bias,
-                             OpPequalsMaxPA_Scaled (scale_min, scale_max), *histogram);
+                             OpPequalsMaxPA_Scaled (rbias, rmultiplier), *histogram);
             break;
 
         default:
             printf ("SwissArmyKnife: unknown operation (tool) %d!\n",
-                    _param->tool);
+                    param->tool);
             return 0;
         }
     }
@@ -1945,185 +2022,205 @@
         switch (tool)
         {
         case TOOL_A:
-            computeRollingAverage (image, data, planesize, bias, OpPequalsA(), HistogramNull());
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsA(), HistogramNull());
             break;
         case TOOL_P: // HERE: we could optimize this if we wanted to
-            computeRollingAverage (image, data, planesize, bias, OpPequalsP(), HistogramNull());
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsP(), HistogramNull());
             break;
         case TOOL_P_MINUS_A:
-            computeRollingAverage (image, data, planesize, bias, OpPequalsPminusA(), HistogramNull());
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsPminusA(), HistogramNull());
             break;
         case TOOL_A_MINUS_P:
-            computeRollingAverage (image, data, planesize, bias, OpPequalsAminusP(), HistogramNull());
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsAminusP(), HistogramNull());
             break;
         case TOOL_P_PLUS_A:
-            computeRollingAverage (image, data, planesize, bias, OpPequalsPplusA(), HistogramNull());
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsPplusA(), HistogramNull());
             break;
         case TOOL_P_TIMES_A:
-            computeRollingAverage (image, data, planesize, bias, OpPequalsPtimesA(), HistogramNull());
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsPtimesA(), HistogramNull());
             break;
         case TOOL_P_DIVBY_A:
-            computeRollingAverage (image, data, planesize, bias, OpPequalsPdivByA(), HistogramNull());
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsPdivByA(), HistogramNull());
             break;
         case TOOL_A_DIVBY_P:
-            computeRollingAverage (image, data, planesize, bias, OpPequalsAdivByP(), HistogramNull());
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsAdivByP(), HistogramNull());
             break;
         case TOOL_MIN_P_A:
-            computeRollingAverage (image, data, planesize, bias, OpPequalsMinPA(), HistogramNull());
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsMinPA(), HistogramNull());
             break;
         case TOOL_MAX_P_A:
-            computeRollingAverage (image, data, planesize, bias, OpPequalsMaxPA(), HistogramNull());
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsMaxPA(), HistogramNull());
             break;
 
         case TOOL_A_WITH_HISTOGRAM:
-            computeRollingAverage (image, data, planesize, bias, OpPequalsA(), *histogram);
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsA(), *histogram);
             break;
         case TOOL_P_WITH_HISTOGRAM: // HERE: we could optimize this if we wanted to
-            computeRollingAverage (image, data, planesize, bias, OpPequalsP(), *histogram);
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsP(), *histogram);
             break;
         case TOOL_P_MINUS_A_WITH_HISTOGRAM:
-            computeRollingAverage (image, data, planesize, bias, OpPequalsPminusA(), *histogram);
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsPminusA(), *histogram);
             break;
         case TOOL_A_MINUS_P_WITH_HISTOGRAM:
-            computeRollingAverage (image, data, planesize, bias, OpPequalsAminusP(), *histogram);
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsAminusP(), *histogram);
             break;
         case TOOL_P_PLUS_A_WITH_HISTOGRAM:
-            computeRollingAverage (image, data, planesize, bias, OpPequalsPplusA(), *histogram);
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsPplusA(), *histogram);
             break;
         case TOOL_P_TIMES_A_WITH_HISTOGRAM:
-            computeRollingAverage (image, data, planesize, bias, OpPequalsPtimesA(), *histogram);
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsPtimesA(), *histogram);
             break;
         case TOOL_P_DIVBY_A_WITH_HISTOGRAM:
-            computeRollingAverage (image, data, planesize, bias, OpPequalsPdivByA(), *histogram);
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsPdivByA(), *histogram);
             break;
         case TOOL_A_DIVBY_P_WITH_HISTOGRAM:
-            computeRollingAverage (image, data, planesize, bias, OpPequalsAdivByP(), *histogram);
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsAdivByP(), *histogram);
             break;
         case TOOL_MIN_P_A_WITH_HISTOGRAM:
-            computeRollingAverage (image, data, planesize, bias, OpPequalsMinPA(), *histogram);
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsMinPA(), *histogram);
             break;
         case TOOL_MAX_P_A_WITH_HISTOGRAM:
-            computeRollingAverage (image, data, planesize, bias, OpPequalsMaxPA(), *histogram);
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsMaxPA(), *histogram);
             break;
 
         case TOOL_A_SCALED:
-            computeRollingAverage (image, data, planesize, bias,
-                                   OpPequalsA_Scaled (scale_min, scale_max),
-                                   HistogramNull());
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsA_Scaled (rbias, rmultiplier),
+                                        HistogramNull());
             break;
         case TOOL_P_SCALED: // HERE_SCALED: we could optimize this if we wanted to
-            computeRollingAverage (image, data, planesize, bias,
-                                   OpPequalsP_Scaled (scale_min, scale_max),
-                                   HistogramNull());
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsP_Scaled (rbias, rmultiplier),
+                                        HistogramNull());
             break;
         case TOOL_P_MINUS_A_SCALED:
-            computeRollingAverage (image, data, planesize, bias,
-                                   OpPequalsPminusA_Scaled (scale_min, scale_max),
-                                   HistogramNull());
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsPminusA_Scaled (rbias, rmultiplier),
+                                        HistogramNull());
             break;
         case TOOL_A_MINUS_P_SCALED:
-            computeRollingAverage (image, data, planesize, bias,
-                                   OpPequalsAminusP_Scaled (scale_min, scale_max),
-                                   HistogramNull());
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsAminusP_Scaled (rbias, rmultiplier),
+                                        HistogramNull());
             break;
         case TOOL_P_PLUS_A_SCALED:
-            computeRollingAverage (image, data, planesize, bias,
-                                   OpPequalsPplusA_Scaled (scale_min, scale_max),
-                                   HistogramNull());
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsPplusA_Scaled (rbias, rmultiplier),
+                                        HistogramNull());
             break;
         case TOOL_P_TIMES_A_SCALED:
-            computeRollingAverage (image, data, planesize, bias,
-                                   OpPequalsPtimesA_Scaled (scale_min, scale_max),
-                                   HistogramNull());
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsPtimesA_Scaled (rbias, rmultiplier),
+                                        HistogramNull());
             break;
         case TOOL_P_DIVBY_A_SCALED:
-            computeRollingAverage (image, data, planesize, bias,
-                                   OpPequalsPdivByA_Scaled (scale_min, scale_max),
-                                   HistogramNull());
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsPdivByA_Scaled (rbias, rmultiplier),
+                                        HistogramNull());
             break;
         case TOOL_A_DIVBY_P_SCALED:
-            computeRollingAverage (image, data, planesize, bias,
-                                   OpPequalsAdivByP_Scaled (scale_min, scale_max),
-                                   HistogramNull());
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsAdivByP_Scaled (rbias, rmultiplier),
+                                        HistogramNull());
             break;
         case TOOL_MIN_P_A_SCALED:
-            computeRollingAverage (image, data, planesize, bias,
-                                   OpPequalsMinPA_Scaled (scale_min, scale_max),
-                                   HistogramNull());
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsMinPA_Scaled (rbias, rmultiplier),
+                                        HistogramNull());
             break;
         case TOOL_MAX_P_A_SCALED:
-            computeRollingAverage (image, data, planesize, bias,
-                                   OpPequalsMaxPA_Scaled (scale_min, scale_max),
-                                   HistogramNull());
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsMaxPA_Scaled (rbias, rmultiplier),
+                                        HistogramNull());
             break;
 
         case TOOL_A_SCALED_WITH_HISTOGRAM:
-            computeRollingAverage (image, data, planesize, bias,
-                                   OpPequalsA_Scaled (scale_min, scale_max),
-                                   *histogram);
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsA_Scaled (rbias, rmultiplier),
+                                        *histogram);
             break;
         case TOOL_P_SCALED_WITH_HISTOGRAM: // HERE: we could optimize this if we wanted to
-            computeRollingAverage (image, data, planesize, bias,
-                                   OpPequalsP_Scaled (scale_min, scale_max),
-                                   *histogram);
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsP_Scaled (rbias, rmultiplier),
+                                        *histogram);
             break;
         case TOOL_P_MINUS_A_SCALED_WITH_HISTOGRAM:
-            computeRollingAverage (image, data, planesize, bias,
-                                   OpPequalsPminusA_Scaled (scale_min, scale_max),
-                                   *histogram);
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsPminusA_Scaled (rbias, rmultiplier),
+                                        *histogram);
             break;
         case TOOL_A_MINUS_P_SCALED_WITH_HISTOGRAM:
-            computeRollingAverage (image, data, planesize, bias,
-                                   OpPequalsAminusP_Scaled (scale_min, scale_max),
-                                   *histogram);
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsAminusP_Scaled (rbias, rmultiplier),
+                                        *histogram);
             break;
         case TOOL_P_PLUS_A_SCALED_WITH_HISTOGRAM:
-            computeRollingAverage (image, data, planesize, bias,
-                                   OpPequalsPplusA_Scaled (scale_min, scale_max),
-                                   *histogram);
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsPplusA_Scaled (rbias, rmultiplier),
+                                        *histogram);
             break;
         case TOOL_P_TIMES_A_SCALED_WITH_HISTOGRAM:
-            computeRollingAverage (image, data, planesize, bias,
-                                   OpPequalsPtimesA_Scaled (scale_min, scale_max),
-                                   *histogram);
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsPtimesA_Scaled (rbias, rmultiplier),
+                                        *histogram);
             break;
         case TOOL_P_DIVBY_A_SCALED_WITH_HISTOGRAM:
-            computeRollingAverage (image, data, planesize, bias,
-                                   OpPequalsPdivByA_Scaled (scale_min, scale_max),
-                                   *histogram);
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsPdivByA_Scaled (rbias, rmultiplier),
+                                        *histogram);
             break;
         case TOOL_A_DIVBY_P_SCALED_WITH_HISTOGRAM:
-            computeRollingAverage (image, data, planesize, bias,
-                                   OpPequalsAdivByP_Scaled (scale_min, scale_max),
-                                   *histogram);
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsAdivByP_Scaled (rbias, rmultiplier),
+                                        *histogram);
             break;
         case TOOL_MIN_P_A_SCALED_WITH_HISTOGRAM:
-            computeRollingAverage (image, data, planesize, bias,
-                                   OpPequalsMinPA_Scaled (scale_min, scale_max),
-                                   *histogram);
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsMinPA_Scaled (rbias, rmultiplier),
+                                        *histogram);
             break;
         case TOOL_MAX_P_A_SCALED_WITH_HISTOGRAM:
-            computeRollingAverage (image, data, planesize, bias,
-                                   OpPequalsMaxPA_Scaled (scale_min, scale_max),
-                                   *histogram);
+            sak->computeRollingAverage (image, data, planesize, param, bias,
+                                        OpPequalsMaxPA_Scaled (rbias, rmultiplier),
+                                        *histogram);
             break;
 
         default:
             printf ("SwissArmyKnife: unknown operation (tool) %d!\n",
-                    _param->tool);
+                    param->tool);
             return 0;
         }
     }
     else if (doingFileImageFloat)
     {
-        if (w != myInfo->image_w || h != myInfo->image_h)
+        if (width != myInfo->image_w || height != myInfo->image_h)
         {
             const char * bar = "*************************";
             printf ("\n%s%s%s\nAttempting to apply a %ux%u input image to "
                     "%ux%u video - even if I could do that, it probably "
                     "wouldn't be what you wanted...\n%s%s%s\n",
                     bar, bar, bar, myInfo->image_w, myInfo->image_h,
-                    w, h, bar, bar, bar);
+                    width, height, bar, bar, bar);
             return 0;
         }
 
@@ -2132,185 +2229,205 @@
         switch (tool)
         {
         case TOOL_A:
-            applyImage (image, data, planesize, bias, flt_img, OpPequalsA(), HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsA(), HistogramNull());
             break;
         case TOOL_P: // HERE: we could optimize this if we wanted to
-            applyImage (image, data, planesize, bias, flt_img, OpPequalsP(), HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsP(), HistogramNull());
             break;
         case TOOL_P_MINUS_A:
-            applyImage (image, data, planesize, bias, flt_img, OpPequalsPminusA(), HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsPminusA(), HistogramNull());
             break;
         case TOOL_A_MINUS_P:
-            applyImage (image, data, planesize, bias, flt_img, OpPequalsAminusP(), HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsAminusP(), HistogramNull());
             break;
         case TOOL_P_PLUS_A:
-            applyImage (image, data, planesize, bias, flt_img, OpPequalsPplusA(), HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsPplusA(), HistogramNull());
             break;
         case TOOL_P_TIMES_A:
-            applyImage (image, data, planesize, bias, flt_img, OpPequalsPtimesA(), HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsPtimesA(), HistogramNull());
             break;
         case TOOL_P_DIVBY_A:
-            applyImage (image, data, planesize, bias, flt_img, OpPequalsPdivByA(), HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsPdivByA(), HistogramNull());
             break;
         case TOOL_A_DIVBY_P:
-            applyImage (image, data, planesize, bias, flt_img, OpPequalsAdivByP(), HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsAdivByP(), HistogramNull());
             break;
         case TOOL_MIN_P_A:
-            applyImage (image, data, planesize, bias, flt_img, OpPequalsMinPA(), HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsMinPA(), HistogramNull());
             break;
         case TOOL_MAX_P_A:
-            applyImage (image, data, planesize, bias, flt_img, OpPequalsMaxPA(), HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsMaxPA(), HistogramNull());
             break;
 
         case TOOL_A_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, flt_img, OpPequalsA(), *histogram);
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsA(), *histogram);
             break;
         case TOOL_P_WITH_HISTOGRAM: // HERE: we could optimize this if we wanted to
-            applyImage (image, data, planesize, bias, flt_img, OpPequalsP(), *histogram);
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsP(), *histogram);
             break;
         case TOOL_P_MINUS_A_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, flt_img, OpPequalsPminusA(), *histogram);
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsPminusA(), *histogram);
             break;
         case TOOL_A_MINUS_P_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, flt_img, OpPequalsAminusP(), *histogram);
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsAminusP(), *histogram);
             break;
         case TOOL_P_PLUS_A_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, flt_img, OpPequalsPplusA(), *histogram);
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsPplusA(), *histogram);
             break;
         case TOOL_P_TIMES_A_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, flt_img, OpPequalsPtimesA(), *histogram);
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsPtimesA(), *histogram);
             break;
         case TOOL_P_DIVBY_A_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, flt_img, OpPequalsPdivByA(), *histogram);
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsPdivByA(), *histogram);
             break;
         case TOOL_A_DIVBY_P_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, flt_img, OpPequalsAdivByP(), *histogram);
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsAdivByP(), *histogram);
             break;
         case TOOL_MIN_P_A_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, flt_img, OpPequalsMinPA(), *histogram);
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsMinPA(), *histogram);
             break;
         case TOOL_MAX_P_A_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, flt_img, OpPequalsMaxPA(), *histogram);
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsMaxPA(), *histogram);
             break;
 
         case TOOL_A_SCALED:
-            applyImage (image, data, planesize, bias, flt_img,
-                           OpPequalsA_Scaled (scale_min, scale_max),
-                           HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsA_Scaled (rbias, rmultiplier),
+                             HistogramNull());
             break;
         case TOOL_P_SCALED: // HERE_SCALED: we could optimize this if we wanted to
-            applyImage (image, data, planesize, bias, flt_img,
-                           OpPequalsP_Scaled (scale_min, scale_max),
-                           HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsP_Scaled (rbias, rmultiplier),
+                             HistogramNull());
             break;
         case TOOL_P_MINUS_A_SCALED:
-            applyImage (image, data, planesize, bias, flt_img,
-                           OpPequalsPminusA_Scaled (scale_min, scale_max),
-                           HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsPminusA_Scaled (rbias, rmultiplier),
+                             HistogramNull());
             break;
         case TOOL_A_MINUS_P_SCALED:
-            applyImage (image, data, planesize, bias, flt_img,
-                           OpPequalsAminusP_Scaled (scale_min, scale_max),
-                           HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsAminusP_Scaled (rbias, rmultiplier),
+                             HistogramNull());
             break;
         case TOOL_P_PLUS_A_SCALED:
-            applyImage (image, data, planesize, bias, flt_img,
-                           OpPequalsPplusA_Scaled (scale_min, scale_max),
-                           HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsPplusA_Scaled (rbias, rmultiplier),
+                             HistogramNull());
             break;
         case TOOL_P_TIMES_A_SCALED:
-            applyImage (image, data, planesize, bias, flt_img,
-                           OpPequalsPtimesA_Scaled (scale_min, scale_max),
-                           HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsPtimesA_Scaled (rbias, rmultiplier),
+                             HistogramNull());
             break;
         case TOOL_P_DIVBY_A_SCALED:
-            applyImage (image, data, planesize, bias, flt_img,
-                           OpPequalsPdivByA_Scaled (scale_min, scale_max),
-                           HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsPdivByA_Scaled (rbias, rmultiplier),
+                             HistogramNull());
             break;
         case TOOL_A_DIVBY_P_SCALED:
-            applyImage (image, data, planesize, bias, flt_img,
-                           OpPequalsAdivByP_Scaled (scale_min, scale_max),
-                           HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsAdivByP_Scaled (rbias, rmultiplier),
+                             HistogramNull());
             break;
         case TOOL_MIN_P_A_SCALED:
-            applyImage (image, data, planesize, bias, flt_img,
-                           OpPequalsMinPA_Scaled (scale_min, scale_max),
-                           HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsMinPA_Scaled (rbias, rmultiplier),
+                             HistogramNull());
             break;
         case TOOL_MAX_P_A_SCALED:
-            applyImage (image, data, planesize, bias, flt_img,
-                           OpPequalsMaxPA_Scaled (scale_min, scale_max),
-                           HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsMaxPA_Scaled (rbias, rmultiplier),
+                             HistogramNull());
             break;
 
         case TOOL_A_SCALED_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, flt_img,
-                           OpPequalsA_Scaled (scale_min, scale_max),
-                           *histogram);
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsA_Scaled (rbias, rmultiplier),
+                             *histogram);
             break;
         case TOOL_P_SCALED_WITH_HISTOGRAM: // HERE: we could optimize this if we wanted to
-            applyImage (image, data, planesize, bias, flt_img,
-                           OpPequalsP_Scaled (scale_min, scale_max),
-                           *histogram);
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsP_Scaled (rbias, rmultiplier),
+                             *histogram);
             break;
         case TOOL_P_MINUS_A_SCALED_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, flt_img,
-                           OpPequalsPminusA_Scaled (scale_min, scale_max),
-                           *histogram);
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsPminusA_Scaled (rbias, rmultiplier),
+                             *histogram);
             break;
         case TOOL_A_MINUS_P_SCALED_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, flt_img,
-                           OpPequalsAminusP_Scaled (scale_min, scale_max),
-                           *histogram);
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsAminusP_Scaled (rbias, rmultiplier),
+                             *histogram);
             break;
         case TOOL_P_PLUS_A_SCALED_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, flt_img,
-                           OpPequalsPplusA_Scaled (scale_min, scale_max),
-                           *histogram);
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsPplusA_Scaled (rbias, rmultiplier),
+                             *histogram);
             break;
         case TOOL_P_TIMES_A_SCALED_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, flt_img,
-                           OpPequalsPtimesA_Scaled (scale_min, scale_max),
-                           *histogram);
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsPtimesA_Scaled (rbias, rmultiplier),
+                             *histogram);
             break;
         case TOOL_P_DIVBY_A_SCALED_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, flt_img,
-                           OpPequalsPdivByA_Scaled (scale_min, scale_max),
-                           *histogram);
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsPdivByA_Scaled (rbias, rmultiplier),
+                             *histogram);
             break;
         case TOOL_A_DIVBY_P_SCALED_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, flt_img,
-                           OpPequalsAdivByP_Scaled (scale_min, scale_max),
-                           *histogram);
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsAdivByP_Scaled (rbias, rmultiplier),
+                             *histogram);
             break;
         case TOOL_MIN_P_A_SCALED_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, flt_img,
-                           OpPequalsMinPA_Scaled (scale_min, scale_max),
-                           *histogram);
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsMinPA_Scaled (rbias, rmultiplier),
+                             *histogram);
             break;
         case TOOL_MAX_P_A_SCALED_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, flt_img,
-                           OpPequalsMaxPA_Scaled (scale_min, scale_max),
-                           *histogram);
+            sak->applyImage (image, data, planesize, param, bias, flt_img,
+                             OpPequalsMaxPA_Scaled (rbias, rmultiplier),
+                             *histogram);
             break;
 
         default:
             printf ("SwissArmyKnife: unknown operation (tool) %d!\n",
-                    _param->tool);
+                    param->tool);
             return 0;
         }
     }
     else if (doingFileImage)
     {
-        if (w != myInfo->image_w || h != myInfo->image_h)
+        if (width != myInfo->image_w || height != myInfo->image_h)
         {
             const char * bar = "*************************";
             printf ("\n%s%s%s\nAttempting to apply a %ux%u input image to "
                     "%ux%u video - even if I could do that, it probably "
                     "wouldn't be what you wanted...\n%s%s%s\n",
                     bar, bar, bar, myInfo->image_w, myInfo->image_h,
-                    w, h, bar, bar, bar);
+                    width, height, bar, bar, bar);
             return 0;
         }
 
@@ -2319,172 +2436,192 @@
         switch (tool)
         {
         case TOOL_A:
-            applyImage (image, data, planesize, bias, int_img, OpPequalsA(), HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsA(), HistogramNull());
             break;
         case TOOL_P: // HERE: we could optimize this if we wanted to
-            applyImage (image, data, planesize, bias, int_img, OpPequalsP(), HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsP(), HistogramNull());
             break;
         case TOOL_P_MINUS_A:
-            applyImage (image, data, planesize, bias, int_img, OpPequalsPminusA(), HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsPminusA(), HistogramNull());
             break;
         case TOOL_A_MINUS_P:
-            applyImage (image, data, planesize, bias, int_img, OpPequalsAminusP(), HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsAminusP(), HistogramNull());
             break;
         case TOOL_P_PLUS_A:
-            applyImage (image, data, planesize, bias, int_img, OpPequalsPplusA(), HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsPplusA(), HistogramNull());
             break;
         case TOOL_P_TIMES_A:
-            applyImage (image, data, planesize, bias, int_img, OpPequalsPtimesA(), HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsPtimesA(), HistogramNull());
             break;
         case TOOL_P_DIVBY_A:
-            applyImage (image, data, planesize, bias, int_img, OpPequalsPdivByA(), HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsPdivByA(), HistogramNull());
             break;
         case TOOL_A_DIVBY_P:
-            applyImage (image, data, planesize, bias, int_img, OpPequalsAdivByP(), HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsAdivByP(), HistogramNull());
             break;
         case TOOL_MIN_P_A:
-            applyImage (image, data, planesize, bias, int_img, OpPequalsMinPA(), HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsMinPA(), HistogramNull());
             break;
         case TOOL_MAX_P_A:
-            applyImage (image, data, planesize, bias, int_img, OpPequalsMaxPA(), HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsMaxPA(), HistogramNull());
             break;
 
         case TOOL_A_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, int_img, OpPequalsA(), *histogram);
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsA(), *histogram);
             break;
         case TOOL_P_WITH_HISTOGRAM: // HERE: we could optimize this if we wanted to
-            applyImage (image, data, planesize, bias, int_img, OpPequalsP(), *histogram);
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsP(), *histogram);
             break;
         case TOOL_P_MINUS_A_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, int_img, OpPequalsPminusA(), *histogram);
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsPminusA(), *histogram);
             break;
         case TOOL_A_MINUS_P_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, int_img, OpPequalsAminusP(), *histogram);
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsAminusP(), *histogram);
             break;
         case TOOL_P_PLUS_A_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, int_img, OpPequalsPplusA(), *histogram);
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsPplusA(), *histogram);
             break;
         case TOOL_P_TIMES_A_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, int_img, OpPequalsPtimesA(), *histogram);
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsPtimesA(), *histogram);
             break;
         case TOOL_P_DIVBY_A_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, int_img, OpPequalsPdivByA(), *histogram);
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsPdivByA(), *histogram);
             break;
         case TOOL_A_DIVBY_P_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, int_img, OpPequalsAdivByP(), *histogram);
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsAdivByP(), *histogram);
             break;
         case TOOL_MIN_P_A_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, int_img, OpPequalsMinPA(), *histogram);
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsMinPA(), *histogram);
             break;
         case TOOL_MAX_P_A_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, int_img, OpPequalsMaxPA(), *histogram);
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsMaxPA(), *histogram);
             break;
 
         case TOOL_A_SCALED:
-            applyImage (image, data, planesize, bias, int_img,
-                        OpPequalsA_Scaled (scale_min, scale_max),
-                        HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsA_Scaled (rbias, rmultiplier),
+                             HistogramNull());
             break;
         case TOOL_P_SCALED: // HERE_SCALED: we could optimize this if we wanted to
-            applyImage (image, data, planesize, bias, int_img,
-                        OpPequalsP_Scaled (scale_min, scale_max),
-                        HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsP_Scaled (rbias, rmultiplier),
+                             HistogramNull());
             break;
         case TOOL_P_MINUS_A_SCALED:
-            applyImage (image, data, planesize, bias, int_img,
-                        OpPequalsPminusA_Scaled (scale_min, scale_max),
-                        HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsPminusA_Scaled (rbias, rmultiplier),
+                             HistogramNull());
             break;
         case TOOL_A_MINUS_P_SCALED:
-            applyImage (image, data, planesize, bias, int_img,
-                        OpPequalsAminusP_Scaled (scale_min, scale_max),
-                        HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsAminusP_Scaled (rbias, rmultiplier),
+                             HistogramNull());
             break;
         case TOOL_P_PLUS_A_SCALED:
-            applyImage (image, data, planesize, bias, int_img,
-                        OpPequalsPplusA_Scaled (scale_min, scale_max),
-                        HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsPplusA_Scaled (rbias, rmultiplier),
+                             HistogramNull());
             break;
         case TOOL_P_TIMES_A_SCALED:
-            applyImage (image, data, planesize, bias, int_img,
-                        OpPequalsPtimesA_Scaled (scale_min, scale_max),
-                        HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsPtimesA_Scaled (rbias, rmultiplier),
+                             HistogramNull());
             break;
         case TOOL_P_DIVBY_A_SCALED:
-            applyImage (image, data, planesize, bias, int_img,
-                        OpPequalsPdivByA_Scaled (scale_min, scale_max),
-                        HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsPdivByA_Scaled (rbias, rmultiplier),
+                             HistogramNull());
             break;
         case TOOL_A_DIVBY_P_SCALED:
-            applyImage (image, data, planesize, bias, int_img,
-                        OpPequalsAdivByP_Scaled (scale_min, scale_max),
-                        HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsAdivByP_Scaled (rbias, rmultiplier),
+                             HistogramNull());
             break;
         case TOOL_MIN_P_A_SCALED:
-            applyImage (image, data, planesize, bias, int_img,
-                        OpPequalsMinPA_Scaled (scale_min, scale_max),
-                        HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsMinPA_Scaled (rbias, rmultiplier),
+                             HistogramNull());
             break;
         case TOOL_MAX_P_A_SCALED:
-            applyImage (image, data, planesize, bias, int_img,
-                        OpPequalsMaxPA_Scaled (scale_min, scale_max),
-                        HistogramNull());
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsMaxPA_Scaled (rbias, rmultiplier),
+                             HistogramNull());
             break;
 
         case TOOL_A_SCALED_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, int_img,
-                        OpPequalsA_Scaled (scale_min, scale_max),
-                        *histogram);
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsA_Scaled (rbias, rmultiplier),
+                             *histogram);
             break;
         case TOOL_P_SCALED_WITH_HISTOGRAM: // HERE: we could optimize this if we wanted to
-            applyImage (image, data, planesize, bias, int_img,
-                        OpPequalsP_Scaled (scale_min, scale_max),
-                        *histogram);
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsP_Scaled (rbias, rmultiplier),
+                             *histogram);
             break;
         case TOOL_P_MINUS_A_SCALED_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, int_img,
-                        OpPequalsPminusA_Scaled (scale_min, scale_max),
-                        *histogram);
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsPminusA_Scaled (rbias, rmultiplier),
+                             *histogram);
             break;
         case TOOL_A_MINUS_P_SCALED_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, int_img,
-                        OpPequalsAminusP_Scaled (scale_min, scale_max),
-                        *histogram);
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsAminusP_Scaled (rbias, rmultiplier),
+                             *histogram);
             break;
         case TOOL_P_PLUS_A_SCALED_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, int_img,
-                        OpPequalsPplusA_Scaled (scale_min, scale_max),
-                        *histogram);
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsPplusA_Scaled (rbias, rmultiplier),
+                             *histogram);
             break;
         case TOOL_P_TIMES_A_SCALED_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, int_img,
-                        OpPequalsPtimesA_Scaled (scale_min, scale_max),
-                        *histogram);
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsPtimesA_Scaled (rbias, rmultiplier),
+                             *histogram);
             break;
         case TOOL_P_DIVBY_A_SCALED_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, int_img,
-                        OpPequalsPdivByA_Scaled (scale_min, scale_max),
-                        *histogram);
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsPdivByA_Scaled (rbias, rmultiplier),
+                             *histogram);
             break;
         case TOOL_A_DIVBY_P_SCALED_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, int_img,
-                        OpPequalsAdivByP_Scaled (scale_min, scale_max),
-                        *histogram);
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsAdivByP_Scaled (rbias, rmultiplier),
+                             *histogram);
             break;
         case TOOL_MIN_P_A_SCALED_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, int_img,
-                        OpPequalsMinPA_Scaled (scale_min, scale_max),
-                        *histogram);
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsMinPA_Scaled (rbias, rmultiplier),
+                             *histogram);
             break;
         case TOOL_MAX_P_A_SCALED_WITH_HISTOGRAM:
-            applyImage (image, data, planesize, bias, int_img,
-                        OpPequalsMaxPA_Scaled (scale_min, scale_max),
-                        *histogram);
+            sak->applyImage (image, data, planesize, param, bias, int_img,
+                             OpPequalsMaxPA_Scaled (rbias, rmultiplier),
+                             *histogram);
             break;
 
         default:
             printf ("SwissArmyKnife: unknown operation (tool) %d!\n",
-                    _param->tool);
+                    param->tool);
             return 0;
         }
     }
@@ -2493,172 +2630,192 @@
         switch (tool)
         {
         case TOOL_A:
-            applyConstant (image, data, planesize, bias, OpPequalsA(), HistogramNull());
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsA(), HistogramNull());
             break;
         case TOOL_P: // HERE: we could optimize this if we wanted to
-            applyConstant (image, data, planesize, bias, OpPequalsP(), HistogramNull());
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsP(), HistogramNull());
             break;
         case TOOL_P_MINUS_A:
-            applyConstant (image, data, planesize, bias, OpPequalsPminusA(), HistogramNull());
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsPminusA(), HistogramNull());
             break;
         case TOOL_A_MINUS_P:
-            applyConstant (image, data, planesize, bias, OpPequalsAminusP(), HistogramNull());
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsAminusP(), HistogramNull());
             break;
         case TOOL_P_PLUS_A:
-            applyConstant (image, data, planesize, bias, OpPequalsPplusA(), HistogramNull());
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsPplusA(), HistogramNull());
             break;
         case TOOL_P_TIMES_A:
-            applyConstant (image, data, planesize, bias, OpPequalsPtimesA(), HistogramNull());
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsPtimesA(), HistogramNull());
             break;
         case TOOL_P_DIVBY_A:
-            applyConstant (image, data, planesize, bias, OpPequalsPdivByA(), HistogramNull());
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsPdivByA(), HistogramNull());
             break;
         case TOOL_A_DIVBY_P:
-            applyConstant (image, data, planesize, bias, OpPequalsAdivByP(), HistogramNull());
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsAdivByP(), HistogramNull());
             break;
         case TOOL_MIN_P_A:
-            applyConstant (image, data, planesize, bias, OpPequalsMinPA(), HistogramNull());
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsMinPA(), HistogramNull());
             break;
         case TOOL_MAX_P_A:
-            applyConstant (image, data, planesize, bias, OpPequalsMaxPA(), HistogramNull());
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsMaxPA(), HistogramNull());
             break;
 
         case TOOL_A_WITH_HISTOGRAM:
-            applyConstant (image, data, planesize, bias, OpPequalsA(), *histogram);
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsA(), *histogram);
             break;
         case TOOL_P_WITH_HISTOGRAM: // HERE: we could optimize this if we wanted to
-            applyConstant (image, data, planesize, bias, OpPequalsP(), *histogram);
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsP(), *histogram);
             break;
         case TOOL_P_MINUS_A_WITH_HISTOGRAM:
-            applyConstant (image, data, planesize, bias, OpPequalsPminusA(), *histogram);
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsPminusA(), *histogram);
             break;
         case TOOL_A_MINUS_P_WITH_HISTOGRAM:
-            applyConstant (image, data, planesize, bias, OpPequalsAminusP(), *histogram);
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsAminusP(), *histogram);
             break;
         case TOOL_P_PLUS_A_WITH_HISTOGRAM:
-            applyConstant (image, data, planesize, bias, OpPequalsPplusA(), *histogram);
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsPplusA(), *histogram);
             break;
         case TOOL_P_TIMES_A_WITH_HISTOGRAM:
-            applyConstant (image, data, planesize, bias, OpPequalsPtimesA(), *histogram);
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsPtimesA(), *histogram);
             break;
         case TOOL_P_DIVBY_A_WITH_HISTOGRAM:
-            applyConstant (image, data, planesize, bias, OpPequalsPdivByA(), *histogram);
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsPdivByA(), *histogram);
             break;
         case TOOL_A_DIVBY_P_WITH_HISTOGRAM:
-            applyConstant (image, data, planesize, bias, OpPequalsAdivByP(), *histogram);
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsAdivByP(), *histogram);
             break;
         case TOOL_MIN_P_A_WITH_HISTOGRAM:
-            applyConstant (image, data, planesize, bias, OpPequalsMinPA(), *histogram);
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsMinPA(), *histogram);
             break;
         case TOOL_MAX_P_A_WITH_HISTOGRAM:
-            applyConstant (image, data, planesize, bias, OpPequalsMaxPA(), *histogram);
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsMaxPA(), *histogram);
             break;
 
         case TOOL_A_SCALED:
-            applyConstant (image, data, planesize, bias,
-                           OpPequalsA_Scaled (scale_min, scale_max),
-                           HistogramNull());
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsA_Scaled (rbias, rmultiplier),
+                                HistogramNull());
             break;
         case TOOL_P_SCALED: // HERE_SCALED: we could optimize this if we wanted to
-            applyConstant (image, data, planesize, bias,
-                           OpPequalsP_Scaled (scale_min, scale_max),
-                           HistogramNull());
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsP_Scaled (rbias, rmultiplier),
+                                HistogramNull());
             break;
         case TOOL_P_MINUS_A_SCALED:
-            applyConstant (image, data, planesize, bias,
-                           OpPequalsPminusA_Scaled (scale_min, scale_max),
-                           HistogramNull());
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsPminusA_Scaled (rbias, rmultiplier),
+                                HistogramNull());
             break;
         case TOOL_A_MINUS_P_SCALED:
-            applyConstant (image, data, planesize, bias,
-                           OpPequalsAminusP_Scaled (scale_min, scale_max),
-                           HistogramNull());
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsAminusP_Scaled (rbias, rmultiplier),
+                                HistogramNull());
             break;
         case TOOL_P_PLUS_A_SCALED:
-            applyConstant (image, data, planesize, bias,
-                           OpPequalsPplusA_Scaled (scale_min, scale_max),
-                           HistogramNull());
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsPplusA_Scaled (rbias, rmultiplier),
+                                HistogramNull());
             break;
         case TOOL_P_TIMES_A_SCALED:
-            applyConstant (image, data, planesize, bias,
-                           OpPequalsPtimesA_Scaled (scale_min, scale_max),
-                           HistogramNull());
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsPtimesA_Scaled (rbias, rmultiplier),
+                                HistogramNull());
             break;
         case TOOL_P_DIVBY_A_SCALED:
-            applyConstant (image, data, planesize, bias,
-                           OpPequalsPdivByA_Scaled (scale_min, scale_max),
-                           HistogramNull());
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsPdivByA_Scaled (rbias, rmultiplier),
+                                HistogramNull());
             break;
         case TOOL_A_DIVBY_P_SCALED:
-            applyConstant (image, data, planesize, bias,
-                           OpPequalsAdivByP_Scaled (scale_min, scale_max),
-                           HistogramNull());
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsAdivByP_Scaled (rbias, rmultiplier),
+                                HistogramNull());
             break;
         case TOOL_MIN_P_A_SCALED:
-            applyConstant (image, data, planesize, bias,
-                           OpPequalsMinPA_Scaled (scale_min, scale_max),
-                           HistogramNull());
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsMinPA_Scaled (rbias, rmultiplier),
+                                HistogramNull());
             break;
         case TOOL_MAX_P_A_SCALED:
-            applyConstant (image, data, planesize, bias,
-                           OpPequalsMaxPA_Scaled (scale_min, scale_max),
-                           HistogramNull());
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsMaxPA_Scaled (rbias, rmultiplier),
+                                HistogramNull());
             break;
 
         case TOOL_A_SCALED_WITH_HISTOGRAM:
-            applyConstant (image, data, planesize, bias,
-                           OpPequalsA_Scaled (scale_min, scale_max),
-                           *histogram);
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsA_Scaled (rbias, rmultiplier),
+                                *histogram);
             break;
         case TOOL_P_SCALED_WITH_HISTOGRAM: // HERE: we could optimize this if we wanted to
-            applyConstant (image, data, planesize, bias,
-                           OpPequalsP_Scaled (scale_min, scale_max),
-                           *histogram);
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsP_Scaled (rbias, rmultiplier),
+                                *histogram);
             break;
         case TOOL_P_MINUS_A_SCALED_WITH_HISTOGRAM:
-            applyConstant (image, data, planesize, bias,
-                           OpPequalsPminusA_Scaled (scale_min, scale_max),
-                           *histogram);
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsPminusA_Scaled (rbias, rmultiplier),
+                                *histogram);
             break;
         case TOOL_A_MINUS_P_SCALED_WITH_HISTOGRAM:
-            applyConstant (image, data, planesize, bias,
-                           OpPequalsAminusP_Scaled (scale_min, scale_max),
-                           *histogram);
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsAminusP_Scaled (rbias, rmultiplier),
+                                *histogram);
             break;
         case TOOL_P_PLUS_A_SCALED_WITH_HISTOGRAM:
-            applyConstant (image, data, planesize, bias,
-                           OpPequalsPplusA_Scaled (scale_min, scale_max),
-                           *histogram);
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsPplusA_Scaled (rbias, rmultiplier),
+                                *histogram);
             break;
         case TOOL_P_TIMES_A_SCALED_WITH_HISTOGRAM:
-            applyConstant (image, data, planesize, bias,
-                           OpPequalsPtimesA_Scaled (scale_min, scale_max),
-                           *histogram);
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsPtimesA_Scaled (rbias, rmultiplier),
+                                *histogram);
             break;
         case TOOL_P_DIVBY_A_SCALED_WITH_HISTOGRAM:
-            applyConstant (image, data, planesize, bias,
-                           OpPequalsPdivByA_Scaled (scale_min, scale_max),
-                           *histogram);
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsPdivByA_Scaled (rbias, rmultiplier),
+                                *histogram);
             break;
         case TOOL_A_DIVBY_P_SCALED_WITH_HISTOGRAM:
-            applyConstant (image, data, planesize, bias,
-                           OpPequalsAdivByP_Scaled (scale_min, scale_max),
-                           *histogram);
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsAdivByP_Scaled (rbias, rmultiplier),
+                                *histogram);
             break;
         case TOOL_MIN_P_A_SCALED_WITH_HISTOGRAM:
-            applyConstant (image, data, planesize, bias,
-                           OpPequalsMinPA_Scaled (scale_min, scale_max),
-                           *histogram);
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsMinPA_Scaled (rbias, rmultiplier),
+                                *histogram);
             break;
         case TOOL_MAX_P_A_SCALED_WITH_HISTOGRAM:
-            applyConstant (image, data, planesize, bias,
-                           OpPequalsMaxPA_Scaled (scale_min, scale_max),
-                           *histogram);
+            sak->applyConstant (image, data, planesize, param, bias,
+                                OpPequalsMaxPA_Scaled (rbias, rmultiplier),
+                                *histogram);
             break;
 
         default:
             printf ("SwissArmyKnife: unknown operation (tool) %d!\n",
-                    _param->tool);
+                    param->tool);
             return 0;
         }
     }
@@ -2680,5 +2837,6 @@
     memset (VPLANE (data), 128, planesize >> 2);
 
     data->copyInfo(image);
+
     return 1;
 }	                           

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.h	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwissArmyKnife.h	2007-09-30 16:49:31 UTC (rev 3608)
@@ -32,25 +32,36 @@
     uint32_t tool; // ADMVideoSwissArmyKnife::Tool
     uint32_t input_type; // ADMVideoSwissArmyKnife::Input
 
-    const char * input_file;
+    std::string input_file;
     float load_bias;
     float load_multiplier;
 
     float input_constant;
 
-    uint32_t memory_constant_denom;
+    float    memory_constant_alpha;
     uint32_t init_start_frame;
     uint32_t init_end_frame;
     uint32_t init_by_rolling;
 
     int32_t  bias;
-    int32_t  scale_from_min;
-    int32_t  scale_from_max;
+    float    result_bias;
+    float    result_multiplier;
     uint32_t histogram_frame_interval;
     uint32_t debug;
 
+    bool     enable_preview;  // not loaded/stored; only for dialog
 };
 
+// Alas, because offsetof() is only supposed to work on POD (plain old data)
+// structs, and our SWISSARMYKNIFE_PARAM includes a std::string (which has a
+// constructor, and which causes SWISSARMYKNIFE_PARAM to therefore have an
+// implicit constructor), we need to define our own offsetof() to use for the
+// dialog menus.  See
+// http://www.cplusplus.com/reference/clibrary/cstddef/offsetof.html for more
+// on offsetof().
+
+#define my_offsetof(_type, _memb) (size_t (&(((_type *)1)->_memb)) - 1)
+
 class ADMVideoSwissArmyKnife : public AVDMGenericVideoStream
 {
 protected:
@@ -79,6 +90,8 @@
 
         uint32_t      image_w;
         uint32_t      image_h;
+        float         image_bias;
+        float         image_multiplier;
         uint8_t *     image_int;
         float *       image_float;
 
@@ -86,7 +99,7 @@
         time_t        input_file_mtime;
 
         float *       bg;
-        uint32_t      bg_mc;
+        float         bg_mca;
         uint32_t      bg_isf;
         uint32_t      bg_ief;
         uint32_t      bg_x;
@@ -111,13 +124,15 @@
 
               image_w (0),
               image_h (0),
+              image_bias (0),
+              image_multiplier (0),
               image_int (0),
               image_float (0),
 
               input_file_mtime (0),
 
               bg (0),
-              bg_mc (0),
+              bg_mca (0),
               bg_isf (0),
               bg_ief (0),
               bg_x (0),
@@ -149,6 +164,7 @@
 
     PersistentInfo * myInfo;
 
+public:
     enum Input
     {
         INPUT_INVALID = 0,
@@ -162,6 +178,7 @@
         INPUT_COUNT
     };
 
+protected:
     enum Tool
     {
         TOOL_INVALID = 0,
@@ -214,7 +231,6 @@
 
         TOOL_ADD_HISTOGRAM = TOOL_A_WITH_HISTOGRAM - TOOL_A,
         TOOL_ADD_SCALING = TOOL_A_SCALED - TOOL_A,
-
     };
 
     struct ToolMap
@@ -222,11 +238,12 @@
         Tool toolid;
         const char * outputName; // displayed name
         const char * format;     // printf format (%s is A)
+        const char * spacy_format; // same with more whitespace
     };
 
     static ToolMap tool_map [];
 
-    SWISSARMYKNIFE_PARAM *  _param;
+    SWISSARMYKNIFE_PARAM * _param;
 
 public:
 
@@ -237,28 +254,53 @@
                                            ADMImage *data, uint32_t *flags);
 
     virtual uint8_t configure (AVDMGenericVideoStream *instream);
-    virtual char * printConf(void);
+    virtual char * printConf (void);
     virtual uint8_t getCoupledConf (CONFcouple **couples);
 
+    static char * getConf (SWISSARMYKNIFE_PARAM * param, bool forDialog);
+
+    static uint8_t doSwissArmyKnife (ADMImage * from_image,
+                                     ADMImage * to_image,
+                                     AVDMGenericVideoStream * in,
+                                     ADMVideoSwissArmyKnife * sak,
+                                     SWISSARMYKNIFE_PARAM * param,
+                                     uint32_t width, uint32_t height);
+
 private:
 
     template <typename Oper, typename Histo>
     void computeRollingAverage (ADMImage * image, ADMImage * data,
-                                uint32_t planesize, int32_t bias,
+                                uint32_t planesize,
+                                SWISSARMYKNIFE_PARAM * param,
+                                int32_t bias,
                                 const Oper & op_in,
                                 const Histo & histogram_in);
 
     template <typename InputImageType, typename Oper, typename Histo>
     void applyImage (ADMImage * image, ADMImage * data,
-                     uint32_t planesize, int32_t bias,
-                     InputImageType * input_image,
+                     uint32_t planesize,
+                     SWISSARMYKNIFE_PARAM * param,
+                     int32_t bias, InputImageType * input_image,
                      const Oper & op_in, const Histo & histogram_in);
 
     template <typename Oper, typename Histo>
     void applyConstant (ADMImage * image, ADMImage * data,
-                        uint32_t planesize, int32_t bias,
+                        uint32_t planesize,
+                        SWISSARMYKNIFE_PARAM * param,
+                        int32_t bias,
                         const Oper & op_in,
                         const Histo & histogram_in);
+    const ADV_Info & getInfo () const
+    {
+        return _info;
+    }
+};
 
-};
+struct MenuMapping;
+uint8_t DIA_SwissArmyKnife (AVDMGenericVideoStream * in,
+                            ADMVideoSwissArmyKnife * sakp,
+                            SWISSARMYKNIFE_PARAM * param,
+                            const MenuMapping * menu_mapping,
+                            uint32_t menu_mapping_count);
+
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.cpp	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.cpp	2007-09-30 16:49:31 UTC (rev 3608)
@@ -14,20 +14,13 @@
  *                                                                         *
  ***************************************************************************/
  
- 
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <ADM_assert.h>
-#include <math.h>
+#include "default.h"
 
-#include "config.h"
+#include "ADM_assert.h"
 #include "fourcc.h"
 #include "avio.hxx"
-#include "config.h"
 #include "avi_vars.h"
 
-
 #include "ADM_toolkit/toolkit.hxx"
 #include "ADM_editor/ADM_edit.hxx"
 #include "ADM_video/ADM_genvideo.hxx"
@@ -50,13 +43,13 @@
 			
 {
     printf ("ADMVideoThreshold ctor (%p)\n", this);
-    _in=in;
+    _in = in;
     memcpy(&_info,in->getInfo(),sizeof(_info));
-    _info.encoding=1;	
-    _uncompressed=new ADMImage(_in->getInfo()->width,_in->getInfo()->height);
-    ADM_assert(_uncompressed);    	  	
-    _param=NEW( THRESHOLD_PARAM );
-    if(couples)
+    _info.encoding = 1;
+    _uncompressed = new ADMImage(_in->getInfo()->width, _in->getInfo()->height);
+    ADM_assert(_uncompressed);
+    _param = new THRESHOLD_PARAM;
+    if (couples)
     {
         GET(min);
         GET(max);
@@ -71,27 +64,31 @@
         _param->debug = 0;
     }
 
-    computeLookupTable();
+    computeLookupTable (_param, lookup_table);
 }
 
-void ADMVideoThreshold::computeLookupTable ()
+uint8_t ADMVideoThreshold::computeLookupTable (THRESHOLD_PARAM * param,
+                                               uint8_t lookup_table [256])
 {
-    if (_param->min > _param->max)
+    uint8_t changed = false;
+
+    if (param->min > param->max)
     {
-        uint32_t tmp = _param->min;
-        _param->min = _param->max;
-        _param->max = tmp;
-        _param->in_range_is_white = !_param->in_range_is_white;
+        uint32_t tmp = param->min;
+        param->min = param->max;
+        param->max = tmp;
+        param->in_range_is_white = !param->in_range_is_white;
+        changed = true;
     }
 
-    uint32_t min = _param->min;
-    uint32_t max = _param->max;
+    uint32_t min = param->min;
+    uint32_t max = param->max;
     ADM_assert (min <= max);
 
     uint8_t in_range_value;
     uint8_t out_of_range_value;
 
-    if (_param->in_range_is_white)
+    if (param->in_range_is_white)
     {
         in_range_value = 255;
         out_of_range_value = 0;
@@ -109,6 +106,8 @@
         else
             lookup_table [i] = in_range_value;
     }
+
+    return changed;
 }
 
 uint8_t	ADMVideoThreshold::getCoupledConf( CONFcouple **couples)
@@ -129,7 +128,20 @@
 
 uint8_t ADMVideoThreshold::configure(AVDMGenericVideoStream *in)
 {
-    UNUSED_ARG(in);
+    uint8_t ret = DIA_threshold (_in, _param);
+    if (ret == 1)
+    {
+        computeLookupTable (_param, lookup_table);
+        return ret;
+    }
+    else if (ret == 0) // 0 = cancel
+    {
+        return ret;
+    }
+    else
+    {
+        ADM_assert (ret == 255); // 255 = whizzy dialog not implemented
+    }
 
     diaElemUSlider minslide(&(_param->min), QT_TR_NOOP("Mi_nimum value to be in-range:"), 0, 255);
     diaElemUSlider maxslide(&(_param->max), QT_TR_NOOP("Ma_ximum value to be in-range:"), 0, 255);
@@ -148,11 +160,11 @@
                           0, 0x7fffffff);
     diaElem * elems[] = { &minslide, &maxslide, &in_range_is_white, &debug };
 
-    uint8_t ret = diaFactoryRun("Threshold", sizeof (elems) / sizeof (diaElem *), elems);
+    ret = diaFactoryRun("Threshold Configuration", sizeof (elems) / sizeof (diaElem *), elems);
 
     if (ret) // 0 = cancel
     {
-        computeLookupTable();
+        computeLookupTable (_param, lookup_table);
     }
 
     return ret;
@@ -162,8 +174,8 @@
 {
     printf ("ADMVideoThreshold dtor (%p)\n", this);
     DELETE(_param);
-    delete  _uncompressed;	
-    _uncompressed=NULL;
+    delete _uncompressed;	
+    _uncompressed = NULL;
 }
 
 char *ADMVideoThreshold::printConf (void) 
@@ -195,7 +207,7 @@
                 frame);
 
     uint32_t planesize = _info.width * _info.height;
-    uint32_t size = (planesize*3)>>1;
+    uint32_t size = (planesize * 3) >> 1;
     *len = size;
 			
     if (!_in->getFrameNumberNoAlloc (frame, len, _uncompressed, flags))
@@ -210,56 +222,13 @@
     uint8_t * destp = YPLANE (data) + planesize;
     uint32_t pixremaining = planesize + 1;
 
-#ifdef THRESHOLD_HISTO
-    uint32_t histo_before [256];
-    uint32_t histo_after [256];
-
-    memset (histo_before, 0, 256 * sizeof (uint32_t));
-    memset (histo_after, 0, 256 * sizeof (uint32_t));
-#endif
-
-#ifdef DUMP_FRAME_DATA
-    FILE * fp = fopen ("/tmp/framedump.new.out", "a");
-    ADM_assert(fp);
-#endif
-
     while (--pixremaining)
     {
         int32_t curr = *--currp;
 
-#ifdef THRESHOLD_HISTO
-        histo_before [curr]++;
-#endif
-
-#ifdef DUMP_FRAME_DATA
-        fprintf (fp, "%x\n", curr);
-#endif
-
         *--destp = lookup_table [curr];
-
-#ifdef THRESHOLD_HISTO
-        histo_after [*destp]++;
-#endif
     }
 
-#ifdef DUMP_FRAME_DATA
-    fclose (fp);
-#endif
-
-#ifdef THRESHOLD_HISTO
-    if (debug & 0x800)
-    {
-        printf ("    Histogram:\n\tValue\tBefore\tAfter\tValue\tBefore\tAfter"
-                "\tValue\tBefore\tAfter\tValue\tBefore\tAfter\n");
-        for (int val = 0; val <= 63; val++)
-            printf ("\t%3d:\t%6d\t%6d\t%3d:\t%6d\t%6d\t%3d:\t%6d\t%6d\t%3d:\t%6d\t%6d\n",
-                    val, histo_before [val], histo_after [val],
-                    val + 64, histo_before [val + 64], histo_after [val + 64],
-                    val + 128, histo_before [val + 128], histo_after [val + 128],
-                    val + 192, histo_before [val + 192], histo_after [val + 192]);
-    }
-#endif
-
     // HERE: the following two lines do a luma-only-ize
 
     memset (UPLANE (data), 128, planesize >> 2);
@@ -268,3 +237,27 @@
     data->copyInfo(image);
     return 1;
 }	                           
+
+// This is used by the preview code for the configuration dialog.
+
+void ADMVideoThreshold::doThreshold (ADMImage * from, ADMImage * to,
+                                     uint8_t * lookup_table,
+                                     uint32_t pixelcount)
+{
+    uint8_t * currp = YPLANE (from) + pixelcount;
+    uint8_t * destp = YPLANE (to) + pixelcount;
+    uint32_t pixremaining = pixelcount + 1;
+    uint8_t * table = lookup_table;
+
+    while (--pixremaining)
+    {
+        int32_t curr = *--currp;
+
+        *--destp = table [curr];
+    }
+
+    // HERE: the following two lines do a luma-only-ize
+
+    memset (UPLANE (to), 128, pixelcount >> 2);
+    memset (VPLANE (to), 128, pixelcount >> 2);
+}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.h	2007-09-30 16:29:29 UTC (rev 3607)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidThreshold.h	2007-09-30 16:49:31 UTC (rev 3608)
@@ -16,7 +16,9 @@
  
 #ifndef __THRESHOLD__
 #define __THRESHOLD__   
+
 #include "ADM_video/ADM_cache.h"
+
 typedef struct THRESHOLD_PARAM
 {
 
@@ -27,27 +29,34 @@
 
 } THRESHOLD_PARAM;
 
-class  ADMVideoThreshold:public AVDMGenericVideoStream
- {
-
+class ADMVideoThreshold : public AVDMGenericVideoStream
+{
  protected:
     	
-     THRESHOLD_PARAM *  _param;
+     THRESHOLD_PARAM * _param;
      uint8_t lookup_table [256];
 
  public:
  		
 
-     ADMVideoThreshold(  AVDMGenericVideoStream *in,CONFcouple *setup);
+     ADMVideoThreshold (AVDMGenericVideoStream *in, CONFcouple *setup);
 
      ~ADMVideoThreshold();
 
-     virtual uint8_t 	getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-                                              ADMImage *data,uint32_t *flags);
+     virtual uint8_t 	getFrameNumberNoAlloc (uint32_t frame, uint32_t *len,
+                                               ADMImage *data,uint32_t *flags);
 
-     virtual uint8_t 	configure( AVDMGenericVideoStream *instream);
+     virtual uint8_t 	configure (AVDMGenericVideoStream *instream);
      virtual char 		   *printConf(void);
-     virtual uint8_t 	getCoupledConf( CONFcouple **couples);
-     void computeLookupTable();
- };
+     virtual uint8_t 	getCoupledConf (CONFcouple **couples);
+
+     static uint8_t computeLookupTable (THRESHOLD_PARAM * param,
+                                        uint8_t lookup_table [256]);
+     static void doThreshold (ADMImage * from, ADMImage * to,
+                              uint8_t * lookup_table, uint32_t pixelcount);
+};
+
+uint8_t DIA_threshold (AVDMGenericVideoStream *in,
+                       THRESHOLD_PARAM * param);
+
 #endif



