<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r2720 - in	branches/avidemux_2.4_branch/avidemux: . ADM_video ADM_videoFilter
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-January/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r2720%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20.%20ADM_video%20ADM_videoFilter&In-Reply-To=%3C200701131208.l0DC8Suw013407%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000047.html">
   <LINK REL="Next"  HREF="000049.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r2720 - in	branches/avidemux_2.4_branch/avidemux: . ADM_video ADM_videoFilter</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r2720%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20.%20ADM_video%20ADM_videoFilter&In-Reply-To=%3C200701131208.l0DC8Suw013407%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r2720 - in	branches/avidemux_2.4_branch/avidemux: . ADM_video ADM_videoFilter">mean at mail.berlios.de
       </A><BR>
    <I>Sat Jan 13 13:08:28 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000047.html">[Avidemux-svn-commit] r2719 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters
</A></li>
        <LI>Next message: <A HREF="000049.html">[Avidemux-svn-commit] r2721 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog ADM_video ADM_videoFilter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48">[ date ]</a>
              <a href="thread.html#48">[ thread ]</a>
              <a href="subject.html#48">[ subject ]</a>
              <a href="author.html#48">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2007-01-13 13:08:21 +0100 (Sat, 13 Jan 2007)
New Revision: 2720

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidPalShift.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidPalShift.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidPalSmart.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidPalSmart.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidReverse.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSeparateField.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSeparateField.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwapFields.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwapFields.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwapSmart.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwapSmart.h
Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidPalShift.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidPalShift.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidReverse.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSalt.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSalt.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSeparateField.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSeparateField.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapFields.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapFields.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapSmart.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapSmart.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidTelecide.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidTelecide.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidTempSmooth.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidTempSmooth.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ASM_vidDenoise.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
   branches/avidemux_2.4_branch/avidemux/Makefile.am
Log:
cleanup

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidPalShift.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidPalShift.cpp	2007-01-13 11:40:52 UTC (rev 2719)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidPalShift.cpp	2007-01-13 12:08:21 UTC (rev 2720)
@@ -1,160 +0,0 @@
-/***************************************************************************
-                          ADM_vidPalShift.cpp  -  description
-                             -------------------
-    begin                : Sat Aug 24 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
- #include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;ADM_assert.h&gt;
-
-#include &quot;config.h&quot;
-#include &quot;fourcc.h&quot;
-#include &quot;avio.hxx&quot;
-#include &quot;config.h&quot;
-#include &quot;avi_vars.h&quot;
-#ifdef HAVE_ENCODER
-
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_video/ADM_vidPalShift.h&quot;
-#include &quot;ADM_filter/video_filters.h&quot;
-
-
-static FILTER_PARAM nullParam={0,{&quot;&quot;}};
-
-
-SCRIPT_CREATE(addPALShift_script,ADMVideoPalShift,nullParam);
-BUILD_CREATE(addPALShift_create,ADMVideoPalShift);
-
-
-char *ADMVideoPalShift::printConf( void )
-{
- 	static char buf[50];
- 	
- 	sprintf((char *)buf,&quot; PAL field shift&quot;);
-        return buf;
-}
-
-ADMVideoPalShift::ADMVideoPalShift(  AVDMGenericVideoStream *in,CONFcouple *setup)
-{
-	UNUSED_ARG(setup);
-	
-
-	_reverse=NULL;
- 	_in=in;		
-	memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));  		
-	
-
-	_reverse=new uint8_t;;
-	*_reverse=1;
-	
-  	_info.encoding=1;
-
-	vidCache=new VideoCache(5,in);
-
-
-  	  	
-}
- uint8_t ADMVideoPalShift::configure( AVDMGenericVideoStream *instream) 
-{
-  if(GUI_Question(_(&quot;Try reverse ?&quot;)))
-	{
-		*_reverse=1;
-	}
-	else
-	{
-		*_reverse=0;
-	}
-	return 1;
-
-} 
-ADMVideoPalShift::~ADMVideoPalShift()
-{
-	delete vidCache;
-	delete _reverse;
-}
-uint8_t ADMVideoPalShift::getFrameNumberNoAlloc(uint32_t frame,
-				uint32_t *len,
-   				ADMImage *data,
-				uint32_t *flags)
-{
-
-uint32_t full,half;
-ADMImage *cur,*next;
-
-		full=_info.width*_info.height;
-		half=full&gt;&gt;2;
-
-		if(frame&gt;=_info.nb_frames) return 0;
-		
-		cur=vidCache-&gt;getImage(frame);
-		if(!cur) return 0;
-			
-		// for first or last frame do nothing
-		if(!frame || frame==_info.nb_frames-1)
-		{
-
-			data-&gt;duplicate(cur);
-			vidCache-&gt;unlockAll();
-			return 1;	
-		}				
-								
-		// copy u &amp; v as they are			
-
-		memcpy(UPLANE(data),UPLANE(cur),half);
-		memcpy(VPLANE(data),VPLANE(cur),half);
-
-		// now copy odd field from framei and even frame from frame i-1		
-		// OR the other way around
-		uint32_t dline=_info.width;
-		
-		next=vidCache-&gt;getImage(frame+1);
-		if(!next) return 0;
-
-		//
-		uint8_t *src,*dst,*src2;
-		if(!*_reverse)
-		{
-			src2=YPLANE(cur)+dline;
-			src=YPLANE(next);
-			dst=YPLANE(data);
-		}
-		else
-		{
-			src2=YPLANE(next)+dline;
-			src=YPLANE(cur);
-			dst=YPLANE(data);
-		
-		}
-		for(uint32_t y=(_info.height&gt;&gt;1);y&gt;0;y--)
-		{
-                	memcpy(dst,src, dline);
-			dst+=dline;
-                	memcpy(dst,src2, dline);
-			dst+=dline;
-			src+=dline*2;
-			src2+=dline*2;
-		}
-		
-	vidCache-&gt;unlockAll();
-			data-&gt;copyInfo(cur);
-      return 1;
-}
-
-
-
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidPalShift.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidPalShift.h	2007-01-13 11:40:52 UTC (rev 2719)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidPalShift.h	2007-01-13 12:08:21 UTC (rev 2720)
@@ -1,42 +0,0 @@
-/***************************************************************************
-                          ADM_vidPalShift.h  -  description
-                             -------------------
-    begin                : Sat Aug 24 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef PALSHIFT__
-#define PALSHIFT__
-#include &quot;ADM_video/ADM_cache.h&quot; 
- class  ADMVideoPalShift:public AVDMGenericVideoStream
- {
-
- protected:
-    		
-		VideoCache			*vidCache;
-     virtual 	char 				*printConf(void);
-
-		uint8_t				*_reverse;
-
-
- public:
-
-
-  				ADMVideoPalShift(  AVDMGenericVideoStream *in,CONFcouple *setup);
-
-  	virtual 		~ADMVideoPalShift();
-	virtual uint8_t 	getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-          								ADMImage *data,uint32_t *flags);
-	virtual uint8_t configure( AVDMGenericVideoStream *instream) ;
-
- }     ;
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidReverse.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidReverse.cpp	2007-01-13 11:40:52 UTC (rev 2719)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidReverse.cpp	2007-01-13 12:08:21 UTC (rev 2720)
@@ -1,120 +0,0 @@
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &quot;config.h&quot;
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;ADM_assert.h&gt;
-
-#include &quot;config.h&quot;
-#include &quot;fourcc.h&quot;
-#include &quot;avio.hxx&quot;
-#include &quot;avi_vars.h&quot;
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include&quot;ADM_video/ADM_vidField.h&quot;
-#include&quot;ADM_video/ADM_cache.h&quot;
-
-#include &quot;ADM_osSupport/ADM_debugID.h&quot;
-#define MODULE_NAME MODULE_FILTER
-#include &quot;ADM_osSupport/ADM_debug.h&quot;
-#include &quot;ADM_filter/video_filters.h&quot;
-
-
-class AVDM_Reverse : public AVDMGenericVideoStream
-{
-  VideoCache      *vidCache;
-  public:
-                                
-    AVDM_Reverse(AVDMGenericVideoStream *in,CONFcouple *couples);    
-    ~AVDM_Reverse(void);
-    uint8_t         getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-                                          ADMImage *data,uint32_t *flags);
-        
-    char            *printConf( void );
-    uint8_t         configure(AVDMGenericVideoStream *in);
-    uint8_t         getCoupledConf( CONFcouple **couples);
-};
-
-static FILTER_PARAM reverseParam={0,{&quot;&quot;}};
-
-BUILD_CREATE(reverse_create,AVDM_Reverse);
-SCRIPT_CREATE(reverse_script,AVDM_Reverse,reverseParam);
-
-/*************************************/
-
-uint8_t AVDM_Reverse::configure(AVDMGenericVideoStream *in)
-{
-  _in=in;
-  return 1;
-        
-}
-
-char *AVDM_Reverse::printConf( void )
-{
-  static char buf[50];
-
-        //ADM_assert(_param);
-  sprintf((char *)buf,&quot; Reverse&quot;);
-  return buf;
-}
-
-
-AVDM_Reverse::AVDM_Reverse(AVDMGenericVideoStream *in,CONFcouple *couples)
-
-{
-                
-  int count = 0;
-  char buf[80];
-  unsigned int *p;
-
-  _in=in;         
-  memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));    
-  _info.encoding=1;
-  vidCache=new VideoCache(18,in);
-}
-//________________________________________________________
-uint8_t AVDM_Reverse::getCoupledConf( CONFcouple **couples)
-{
-  *couples=NULL;
-  return 1;
-}
-//________________________________________________________
-AVDM_Reverse::~AVDM_Reverse(void)
-{
-                
-  if(vidCache) delete vidCache;                
-  vidCache=NULL;   
-}
-uint8_t AVDM_Reverse::getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-                                     ADMImage *data,uint32_t *flags)
-{
-
-  uint32_t num_frames,tgt;
-  ADMImage *src;
-
-  num_frames=_in-&gt;getInfo()-&gt;nb_frames;   // ??
-  if(frame&gt;=num_frames) return 0;
-  
-  tgt=num_frames-frame-1;
-
-  src=vidCache-&gt;getImage(tgt);
-  if(!src) return 0;
-  data-&gt;duplicate(src);
-
-  vidCache-&gt;unlockAll();
-  return 1;
-}
-//EOF
-
-
-

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSalt.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSalt.cpp	2007-01-13 11:40:52 UTC (rev 2719)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSalt.cpp	2007-01-13 12:08:21 UTC (rev 2720)
@@ -1 +0,0 @@
-// RMED
\ No newline at end of file

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSalt.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSalt.h	2007-01-13 11:40:52 UTC (rev 2719)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSalt.h	2007-01-13 12:08:21 UTC (rev 2720)
@@ -1 +0,0 @@
-// RMED

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSeparateField.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSeparateField.cpp	2007-01-13 11:40:52 UTC (rev 2719)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSeparateField.cpp	2007-01-13 12:08:21 UTC (rev 2720)
@@ -1,269 +0,0 @@
-/***************************************************************************
-                          Separate Fields.cpp  -  description
-                             -------------------
-Convert a x*y * f fps video into -&gt; x*(y/2)*fps/2 video
-
-Same idea as for avisynth separatefield
-
-
-    begin                : Thu Mar 21 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;ADM_assert.h&gt;
-
-#include &quot;config.h&quot;
-#include &quot;fourcc.h&quot;
-#include &quot;avio.hxx&quot;
-#include &quot;config.h&quot;
-#include &quot;avi_vars.h&quot;
-
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_video/ADM_vidFieldUtil.h&quot;
-#include &quot;ADM_video/ADM_vidSeparateField.h&quot;
-#include &quot;ADM_filter/video_filters.h&quot;
-
-
-static FILTER_PARAM swapParam={0,{&quot;&quot;}};
-
-SCRIPT_CREATE(separatefield_script,AVDMVideoSeparateField,swapParam);
-SCRIPT_CREATE(mergefield_script,AVDMVideoMergeField,swapParam);
-SCRIPT_CREATE(stackfield_script,AVDMVideoStackField,swapParam);
-SCRIPT_CREATE(unstackfield_script,AVDMVideoUnStackField,swapParam);
-
-BUILD_CREATE(separatefield_create,AVDMVideoSeparateField);
-BUILD_CREATE(mergefield_create,AVDMVideoMergeField);
-BUILD_CREATE(stackfield_create,AVDMVideoStackField);
-BUILD_CREATE(unstackfield_create,AVDMVideoUnStackField);
-
-char *AVDMVideoSeparateField::printConf( void )
-{
- 	static char buf[50];
-
- 	sprintf((char *)buf,&quot; Separate Fields&quot;);
-        return buf;
-}
-
-//_______________________________________________________________
-AVDMVideoSeparateField::AVDMVideoSeparateField(
-									AVDMGenericVideoStream *in,CONFcouple *setup)
-{
-UNUSED_ARG(setup);
-  	_in=in;
-   	memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));
-	
-
-	_info.height&gt;&gt;=1;
-	_info.fps1000*=2;
-	_info.nb_frames*=2;
-	vidCache=new VideoCache(2,_in);
-
-}
-
-// ___ destructor_____________
-AVDMVideoSeparateField::~AVDMVideoSeparateField()
-{
- 	
-	delete vidCache;
-	vidCache=NULL;
-}
-
-//
-//	Basically ask a uncompressed frame from editor and ask
-//		GUI to decompress it .
-//
-
-uint8_t AVDMVideoSeparateField::getFrameNumberNoAlloc(uint32_t frame,
-				uint32_t *len,
-   				ADMImage *data,
-				uint32_t *flags)
-{
-uint32_t ref;
-ADMImage *ptr;
-		if(frame&gt;=_info.nb_frames) return 0;
-		ref=frame&gt;&gt;1;
-		
-		ptr=vidCache-&gt;getImage(ref);
-		if(!ptr) return 0;
-
-		ADM_assert(ptr-&gt;data);
-		ADM_assert(data-&gt;data);
-		if(frame&amp;1) // odd image
-			 vidFieldKeepOdd(_info.width,_info.height,ptr-&gt;data,data-&gt;data);
-		else
-			 vidFieldKeepEven(_info.width,_info.height,ptr-&gt;data,data-&gt;data);
-		data-&gt;copyInfo(ptr);	
-		vidCache-&gt;unlockAll();
-      return 1;
-}
-//------------------ and merge them ------------------
-
-
-char *AVDMVideoMergeField::printConf( void )
-{
- 	static char buf[50];
-
- 	sprintf((char *)buf,&quot; Merge fields&quot;);
-        return buf;
-}
-
-//_______________________________________________________________
-AVDMVideoMergeField::AVDMVideoMergeField(
-									AVDMGenericVideoStream *in,CONFcouple *setup)
-{
-UNUSED_ARG(setup);
-  	_in=in;
-   	memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));	
-	vidCache=new VideoCache(4,_in);
-	
-
-	_info.height&lt;&lt;=1;
-	_info.fps1000&gt;&gt;=1;
-	_info.nb_frames&gt;&gt;=1;
-
-
-}
-
-// ___ destructor_____________
-AVDMVideoMergeField::~AVDMVideoMergeField()
-{
- 		delete vidCache;
-		vidCache=NULL;
-}
-
-/**
-	Interleave frame*2 and frame*2+1
-*/
-uint8_t AVDMVideoMergeField::getFrameNumberNoAlloc(uint32_t frame,
-				uint32_t *len,
-   				ADMImage *data,
-				uint32_t *flags)
-{
-uint32_t ref,ref2;
-ADMImage *ptr1,*ptr2;
-		if(frame&gt;=_info.nb_frames) return 0;
-
-		ref=frame&lt;&lt;1;
-		ref2=ref+1;
-		ptr1=vidCache-&gt;getImage(ref);
-		ptr2=vidCache-&gt;getImage(ref+1);
-		
-		if(!ptr1 || !ptr2)
-		{
-			printf(&quot;Merge field : cannot read\n&quot;);
-			vidCache-&gt;unlockAll();
-		 	return 0;
-		}
-		 vidFieldMerge(_info.width,_info.height,ptr1-&gt;data,ptr2-&gt;data,data-&gt;data);
-		 vidCache-&gt;unlockAll();
-		
-      return 1;
-}
-//_______________________Stack Fields_______________________
-
-char *AVDMVideoStackField::printConf( void )
-{
- 	static char buf[50];
-
- 	sprintf((char *)buf,&quot; Stack fields&quot;);
-        return buf;
-}
-
-//_______________________________________________________________
-AVDMVideoStackField::AVDMVideoStackField(	AVDMGenericVideoStream *in,CONFcouple *setup)
-{
-UNUSED_ARG(setup);
-  	_in=in;
-   	memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));	
-	_uncompressed=new ADMImage(_info.width,_info.height);	
-
-}
-
-// ___ destructor_____________
-AVDMVideoStackField::AVDMVideoStackField()
-{
- 		delete _uncompressed;
-		_uncompressed=NULL;
-}
-
-/**
-	Interleave frame*2 and frame*2+1
-*/
-uint8_t AVDMVideoStackField::getFrameNumberNoAlloc(uint32_t frame,
-				uint32_t *len,
-   				ADMImage *data,
-				uint32_t *flags)
-{
-uint32_t ref,ref2;
-ADMImage *ptr1,*ptr2;
-		if(frame&gt;=_info.nb_frames) return 0;
-
-		 if(!_in-&gt;getFrameNumberNoAlloc(frame, len, _uncompressed, flags)) return 0;
-		 
-		  vidFielStack(_info.width ,_info.height,YPLANE(_uncompressed),YPLANE(data));
-		data-&gt;copyInfo(_uncompressed);	
-      return 1;
-}
-
-/****/
-//_______________________Stack Fields_______________________
-
-char *AVDMVideoUnStackField::printConf( void )
-{
-        static char buf[50];
-
-        sprintf((char *)buf,&quot; UnStack fields&quot;);
-        return buf;
-}
-
-//_______________________________________________________________
-AVDMVideoUnStackField::AVDMVideoUnStackField(       AVDMGenericVideoStream *in,CONFcouple *setup)
-{
-UNUSED_ARG(setup);
-        _in=in;
-        memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));    
-        _uncompressed=new ADMImage(_info.width,_info.height);   
-
-}
-
-// ___ destructor_____________
-AVDMVideoUnStackField::AVDMVideoUnStackField()
-{
-                delete _uncompressed;
-                _uncompressed=NULL;
-}
-
-/**
-        Interleave frame*2 and frame*2+1
-*/
-uint8_t AVDMVideoUnStackField::getFrameNumberNoAlloc(uint32_t frame,
-                                uint32_t *len,
-                                ADMImage *data,
-                                uint32_t *flags)
-{
-uint32_t ref,ref2;
-ADMImage *ptr1,*ptr2;
-                if(frame&gt;=_info.nb_frames) return 0;
-
-                 if(!_in-&gt;getFrameNumberNoAlloc(frame, len, _uncompressed, flags)) return 0;
-                 
-                  vidFielUnStack(_info.width ,_info.height,YPLANE(_uncompressed),YPLANE(data));
-                data-&gt;copyInfo(_uncompressed);  
-      return 1;
-}

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSeparateField.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSeparateField.h	2007-01-13 11:40:52 UTC (rev 2719)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSeparateField.h	2007-01-13 12:08:21 UTC (rev 2720)
@@ -1,74 +0,0 @@
-/*
-
-*/
-#include &quot;ADM_video/ADM_cache.h&quot;
-  class  AVDMVideoSeparateField:public AVDMGenericVideoStream
- {
-
- protected:
-
-        virtual char 				*printConf(void) ;
-						VideoCache	*vidCache;
-
- public:
- 					
-  						AVDMVideoSeparateField(  AVDMGenericVideoStream *in,CONFcouple *setup);
-  						~AVDMVideoSeparateField();
-		      virtual uint8_t 	getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-          									ADMImage *data,uint32_t *flags);
-
-		      virtual uint8_t 	configure( AVDMGenericVideoStream *instream) {return 1;};
-
- }     ;
-   class  AVDMVideoMergeField:public AVDMGenericVideoStream
- {
-
- protected:
-
-				VideoCache	*vidCache;
-       			 virtual char 		*printConf(void) ;
-
- public:
-  						AVDMVideoMergeField(  AVDMGenericVideoStream *in,CONFcouple *setup);
-  						~AVDMVideoMergeField();
-		      virtual uint8_t 	getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-          									ADMImage *data,uint32_t *flags);
-
-			virtual uint8_t configure( AVDMGenericVideoStream *instream) {return 1;};
-
- }     ;
-   class  AVDMVideoStackField:public AVDMGenericVideoStream
- {
-
- protected:
-
-				
-       			 virtual char 		*printConf(void) ;
-
- public:
-  						AVDMVideoStackField(  AVDMGenericVideoStream *in,CONFcouple *setup);
-  						AVDMVideoStackField();
-		      virtual uint8_t 	getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-          									ADMImage *data,uint32_t *flags);
-
-			virtual uint8_t configure( AVDMGenericVideoStream *instream) {return 1;};
-
- }     ;
-   class  AVDMVideoUnStackField:public AVDMGenericVideoStream
- {
-
- protected:
-
-                                
-                         virtual char           *printConf(void) ;
-
- public:
-                                                AVDMVideoUnStackField(  AVDMGenericVideoStream *in,CONFcouple *setup);
-                                                AVDMVideoUnStackField();
-                      virtual uint8_t   getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-                                                                                ADMImage *data,uint32_t *flags);
-
-                        virtual uint8_t configure( AVDMGenericVideoStream *instream) {return 1;};
-
- }     ;
-

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapFields.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapFields.cpp	2007-01-13 11:40:52 UTC (rev 2719)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapFields.cpp	2007-01-13 12:08:21 UTC (rev 2720)
@@ -1,200 +0,0 @@
-/***************************************************************************
-                          Swap Fields.cpp  -  description
-                             -------------------
-Swap each line  (shift up for odd, down for even)
-
-
-    begin                : Thu Mar 21 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;ADM_assert.h&gt;
-
-#include &quot;config.h&quot;
-#include &quot;fourcc.h&quot;
-#include &quot;avio.hxx&quot;
-#include &quot;config.h&quot;
-#include &quot;avi_vars.h&quot;
-#ifdef HAVE_ENCODER
-
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_video/ADM_vidFieldUtil.h&quot;
-#include &quot;ADM_video/ADM_vidSwapFields.h&quot;
-//static void decimate(uint8_t *src,uint8_t *target, uint32_t linessrc, uint32_t width);
-#include &quot;ADM_filter/video_filters.h&quot;
-
-
-static FILTER_PARAM swapParam={0,{&quot;&quot;}};
-
-
-
-BUILD_CREATE(swapfield_create,AVDMVideoSwapField);
-BUILD_CREATE(keepeven_create,AVDMVideoKeepEven);
-BUILD_CREATE(keepodd_create,AVDMVideoKeepOdd);
-
-SCRIPT_CREATE(swapfield_script,AVDMVideoSwapField,swapParam);
-SCRIPT_CREATE(keepeven_script,AVDMVideoKeepEven,swapParam);
-SCRIPT_CREATE(keepodd_script,AVDMVideoKeepOdd,swapParam);
-
-char *AVDMVideoSwapField::printConf( void )
-{
- 	static char buf[50];
-
- 	sprintf((char *)buf,&quot; Swap fields&quot;);
-        return buf;
-}
-char *AVDMVideoKeepEven::printConf( void )
-{
- 	static char buf[50];
-
- 	sprintf((char *)buf,&quot; Keep Even Fields&quot;);
-        return buf;
-}char *AVDMVideoKeepOdd::printConf( void )
-{
- 	static char buf[50];
-
- 	sprintf((char *)buf,&quot; Keep Odd Fields&quot;);
-        return buf;
-}
-//_______________________________________________________________
-AVDMVideoSwapField::AVDMVideoSwapField(
-									AVDMGenericVideoStream *in,CONFcouple *setup)
-{
-UNUSED_ARG(setup);
-  	_in=in;
-   	memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));
-	_uncompressed=new ADMImage(_info.width,_info.height);
-
-
-}
-//_______________________________________________________________
-AVDMVideoKeepOdd::AVDMVideoKeepOdd(
-									AVDMGenericVideoStream *in,CONFcouple *setup)
-{
-UNUSED_ARG(setup);
-  	_in=in;
-	memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));
-	_uncompressed=new ADMImage(_info.width,_info.height);
-	_info.height&gt;&gt;=1;
-
-}
-// ___ destructor_____________
-AVDMVideoSwapField::~AVDMVideoSwapField()
-{
- 	delete  _uncompressed;
-	_uncompressed=NULL;
-
-}
-// ___ destructor_____________
-AVDMVideoKeepOdd::~AVDMVideoKeepOdd()
-{
- 	delete _uncompressed;
-	_uncompressed=NULL;
-
-}
-
-//
-//	Basically ask a uncompressed frame from editor and ask
-//		GUI to decompress it .
-//
-
-uint8_t AVDMVideoSwapField::getFrameNumberNoAlloc(uint32_t frame,
-				uint32_t *len,
-   				ADMImage *data,
-				uint32_t *flags)
-{
-//static Image in,out;
-			if(frame&gt;=_info.nb_frames) return 0;
-
-
-			// read uncompressed frame
-       		if(!_in-&gt;getFrameNumberNoAlloc(frame, len,_uncompressed,flags)) return 0;
-
-		uint32_t w=_info.width;
-		uint32_t h=_info.height;
-		uint32_t page=w*h;
-		uint32_t stride;
-
-		// copy u &amp; v
-		memcpy(UPLANE(data),UPLANE(_uncompressed),page&gt;&gt;2);
-		memcpy(VPLANE(data),VPLANE(_uncompressed),page&gt;&gt;2);
-		
-		uint8_t *odd,*even,*target,*target2;
-
-		even=YPLANE(_uncompressed);
-		odd=even+w;
-		target=YPLANE(data);
-		target2=YPLANE(data)+w;
-		stride=2*w;
-
-		h&gt;&gt;=1;
-		for(;h--;h&gt;0)
-		{
-			memcpy(target,odd,w);
-			memcpy(target2,even,w);
-			target+=stride;
-			target2+=stride;
-			odd+=stride;
-			even+=stride;
-		}
-		data-&gt;copyInfo(_uncompressed);
-
-      return 1;
-}
-
-uint8_t AVDMVideoKeepOdd::getFrameNumberNoAlloc(uint32_t frame,
-				uint32_t *len,
-   				ADMImage *data,
-				uint32_t *flags)
-{
-//static Image in,out;
-			if(!_in-&gt;getFrameNumberNoAlloc(frame, len,_uncompressed,flags)) return 0;
-
-
-		uint32_t w=_info.width;
-		uint32_t h=_info.height;
-
-		vidFieldKeepOdd(  w,  h, YPLANE(_uncompressed),YPLANE(data));
-		data-&gt;copyInfo(_uncompressed);
-
-      return 1;
-}
-
-uint8_t AVDMVideoKeepEven::getFrameNumberNoAlloc(uint32_t frame,
-				uint32_t *len,
-   				ADMImage *data,
-				uint32_t *flags)
-{
-//static Image in,out;
-			if(frame&gt;=_info.nb_frames) return 0;
-
-
-			// read uncompressed frame
-       		if(!_in-&gt;getFrameNumberNoAlloc(frame, len,_uncompressed,flags)) return 0;
-
-		uint32_t w=_info.width;
-		uint32_t h=_info.height;
-
-
-		data-&gt;copyInfo(_uncompressed);
-		vidFieldKeepEven(  w,  h, YPLANE(_uncompressed),YPLANE(data));
-      return 1;
-}
-
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapFields.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapFields.h	2007-01-13 11:40:52 UTC (rev 2719)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapFields.h	2007-01-13 12:08:21 UTC (rev 2720)
@@ -1,69 +0,0 @@
-/***************************************************************************
-                          Swap Fields.h  -  description
-                             -------------------
-Swap each line  (shift up for odd, down for even)
-
-
-    begin                : Thu Mar 21 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-
-  class  AVDMVideoSwapField:public AVDMGenericVideoStream
- {
-
- protected:
-    		AVDMGenericVideoStream 	*_in;
-        virtual char 					*printConf(void) ;
-
- public:
-  						AVDMVideoSwapField(  AVDMGenericVideoStream *in,CONFcouple *setup);
-  						~AVDMVideoSwapField();
-		      virtual uint8_t 	getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-          									ADMImage *data,uint32_t *flags);
-			virtual uint8_t	*getBinaryConf( uint16_t *size) { *size=0;return (uint8_t *)0;}
-			virtual uint8_t 	configure( AVDMGenericVideoStream *instream) {return 1;};
-
- }     ;
-  class  AVDMVideoKeepOdd:public AVDMGenericVideoStream
- {
-
- protected:
-    		AVDMGenericVideoStream 	*_in;
-        virtual char 					*printConf(void) ;
-
- public:
-  						AVDMVideoKeepOdd(  AVDMGenericVideoStream *in,CONFcouple *setup);
-  						~AVDMVideoKeepOdd();
-		      virtual uint8_t 	getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-          									ADMImage *data,uint32_t *flags);
-
-			virtual uint8_t 	configure( AVDMGenericVideoStream *instream) {return 1;};
-
- }     ;
-  class  AVDMVideoKeepEven:public AVDMVideoKeepOdd
- {
-
- protected:
-
-       			 virtual char 					*printConf(void) ;
-
- public:
- 			AVDMVideoKeepEven(  AVDMGenericVideoStream *in,CONFcouple *setup) : AVDMVideoKeepOdd(  in,setup) 
-			{}
-
-		      virtual uint8_t 	getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-          							ADMImage *data,uint32_t *flags);
-
- }     ;
-

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapSmart.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapSmart.cpp	2007-01-13 11:40:52 UTC (rev 2719)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapSmart.cpp	2007-01-13 12:08:21 UTC (rev 2720)
@@ -1,143 +0,0 @@
-/***************************************************************************
-                          Swap Fields.cpp  -  description
-                             -------------------
-Swap each line  (shift up for odd, down for even)
-
-
-    begin                : Thu Mar 21 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;ADM_assert.h&gt;
-
-#include &quot;config.h&quot;
-#include &quot;fourcc.h&quot;
-#include &quot;avio.hxx&quot;
-#include &quot;config.h&quot;
-#include &quot;avi_vars.h&quot;
-#ifdef HAVE_ENCODER
-
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_video/ADM_vidSwapSmart.h&quot;
-#include &quot;ADM_video/ADM_interlaced.h&quot;
-
-#include &quot;ADM_osSupport/ADM_debugID.h&quot;
-#define MODULE_NAME MODULE_FILTER
-#include &quot;ADM_osSupport/ADM_debug.h&quot;
-#include &quot;ADM_filter/video_filters.h&quot;
-
-
-static FILTER_PARAM nullParam={0,{&quot;&quot;}};
-
-
-SCRIPT_CREATE(swapsmart_script,AVDMVideoSwapSmart,nullParam);
-BUILD_CREATE(swapsmart_create,AVDMVideoSwapSmart);
-
-
-char *AVDMVideoSwapSmart::printConf( void )
-{
- 	static char buf[50];
-
- 	sprintf((char *)buf,&quot; Smart Swap fields&quot;);
-        return buf;
-}
-
-//_______________________________________________________________
-AVDMVideoSwapSmart::AVDMVideoSwapSmart(
-									AVDMGenericVideoStream *in,CONFcouple *setup)
-{
-UNUSED_ARG(setup);
-  	_in=in;
-   	memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));	
-	_uncompressed=new ADMImage(_info.width,_info.height);
-
-
-
-}
-// ___ destructor_____________
-AVDMVideoSwapSmart::~AVDMVideoSwapSmart()
-{
- 	delete  _uncompressed;
-	_uncompressed=NULL;
-
-}
-
-//
-//	Basically ask a uncompressed frame from editor and ask
-//		GUI to decompress it .
-//
-
-uint8_t AVDMVideoSwapSmart::getFrameNumberNoAlloc(uint32_t frame,
-				uint32_t *len,
-   				ADMImage *data,
-				uint32_t *flags)
-{
-//static Image in,out;
-			if(frame&gt;=_info.nb_frames) return 0;
-
-
-			// read uncompressed frame
-       		if(!_in-&gt;getFrameNumberNoAlloc(frame, len,data,flags)) return 0;
-
-		uint32_t w=_info.width;
-		uint32_t h=_info.height;
-		uint32_t page=w*h;
-		uint32_t stride;
-
-
-
-		uint8_t *odd,*even,*target,*target2;
-
-		even=YPLANE(data);
-		odd=even+w;
-		target=YPLANE(_uncompressed);
-		target2=_uncompressed-&gt;data+w;
-		stride=2*w;
-
-		h&gt;&gt;=1;
-		for(;h--;h&gt;0)
-		{
-			memcpy(target,odd,w);
-			memcpy(target2,even,w);
-			target+=stride;
-			target2+=stride;
-			odd+=stride;
-			even+=stride;
-		}
-		// now we have straight and swapped
-		// which one is better ?
-		uint32_t s,m;
-		s=      ADMVideo_interlaceCount( YPLANE(data),_info.width, _info.height);
-		m=      ADMVideo_interlaceCount( YPLANE(_uncompressed),_info.width, _info.height);
-
-		aprintf(&quot; %lu straight vs %lu swapped =&gt; %s\n&quot;,s,m,(s*2&gt;m*3?&quot;swapped&quot;:&quot;straight&quot;));
-
-		// if swapped &lt;= 66 % straight
-
-		if(s*2&gt;m*3)  // swapped is better
-		{
-			memcpy(YPLANE(data),YPLANE(_uncompressed),page);
-
-		}
-
-      return 1;
-}
-
-
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapSmart.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapSmart.h	2007-01-13 11:40:52 UTC (rev 2719)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapSmart.h	2007-01-13 12:08:21 UTC (rev 2720)
@@ -1,36 +0,0 @@
-/***************************************************************************
-                          ADM_vidTelecide.h  -  description
-                             -------------------
-    begin                : Sun Aug 25 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-class  AVDMVideoSwapSmart:public AVDMGenericVideoStream
- {
-
- protected:
-
-
-        virtual char 					*printConf(void) ;
-
- public:
-  						AVDMVideoSwapSmart(  AVDMGenericVideoStream *in,CONFcouple *setup);
-  						~AVDMVideoSwapSmart();
-		      virtual uint8_t 	getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-          									ADMImage *data,uint32_t *flags);
-
-			virtual uint8_t 	configure( AVDMGenericVideoStream *instream) {return 1;};
-				 uint32_t   getMatch( uint8_t *src );
-
- }     ;
-
- 

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidTelecide.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidTelecide.cpp	2007-01-13 11:40:52 UTC (rev 2719)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidTelecide.cpp	2007-01-13 12:08:21 UTC (rev 2720)
@@ -1,259 +0,0 @@
-
-/***************************************************************************
-                          ADM_vidTelecide.cpp  -  description
-                             -------------------
-	Strongly inspired by Donal Graft deinterlacer (decomb)
-
-***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;ADM_assert.h&gt;
-
-#include &quot;config.h&quot;
-#include &quot;fourcc.h&quot;
-#include &quot;avio.hxx&quot;
-#include &quot;config.h&quot;
-#include &quot;avi_vars.h&quot;
-#ifdef HAVE_ENCODER
-//#define EVEN_INTERLEAVE	
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-
-#include&quot;ADM_video/ADM_vidDeinterlace.h&quot;
-#include&quot;ADM_video/ADM_vidTelecide.h&quot;
-#include &quot;ADM_filter/video_filters.h&quot;
-
-#define MATCH_THRESH 100
-#define ASM_DEINT
-#define ASM_BLEND
-static FILTER_PARAM nullParam={0,{&quot;&quot;}};
-
-
-SCRIPT_CREATE(telecide_script,ADMVideoTelecide,nullParam);
-extern  int32_t _l_w,_l_h;
-extern uint8_t *_l_p,*_l_c,*_l_n;
-extern uint8_t *_l_e,*_l_e2;
-
-BUILD_CREATE(telecide_create,ADMVideoTelecide);
-
-
-char *ADMVideoTelecide::printConf(void)
-{
- 		return (char *)&quot;Pal Smart&quot;;;
-}
-
-//_______________________________________________________________
-
-
-ADMVideoTelecide::ADMVideoTelecide(	AVDMGenericVideoStream *in,CONFcouple *setup)
-										: ADMVideoFields(in,setup)
-{
-	vidCache=new VideoCache(4,in);
-	_uncompressed=new ADMImage(_info.width,_info.height);
-  	
-}
-ADMVideoTelecide::~ADMVideoTelecide()
-{
- 	
-	delete vidCache;
-	vidCache=NULL;
-	delete _uncompressed;
-	
-}
-/*
-  	Interleave _uncompressed with in2
-   		even line from in2 odd=0
-      odd  line          odd=1
-*/
-uint8_t ADMVideoTelecide::interleave(	ADMImage *imgsrc, ADMImage *imgdst,uint8_t odd)
-{
- 	uint32_t w=_info.width;
-	uint8_t  *src1,*dst;
-	
-	src1=YPLANE(imgsrc);
-	dst=YPLANE(imgdst);
-	if(odd)
-	{
-		src1+=w;
-		dst+=w;
-	}
-	for(uint32_t y=(_info.height&gt;&gt;1);y&gt;0;y--)
-		{
-        		memcpy(dst,src1,w);
-			src1+=w&lt;&lt;1;
-			dst+=w&lt;&lt;1;
-		}
-	return 1;
-}
-
-//
-//		Try to march fields of a frame with previous  / next until it is not interlaced	
-//
-//
-
-uint8_t ADMVideoTelecide::getFrameNumberNoAlloc(uint32_t frame,
-			uint32_t *len,
-			ADMImage *data,
-			uint32_t *flags)
-{
-uint32_t uvlen;
-uint32_t dummylen;
-uint8_t motion;
-
-uint32_t 	cmatch,nmatch,n2match;
-ADMImage	*cur,*next;
-
-			
-		if(frame&gt;=_info.nb_frames) return 0;			
-		uvlen=    _info.width*_info.height;
-		*len=uvlen+(uvlen&gt;&gt;1);
-		
-		cur=vidCache-&gt;getImage(frame);
-		if(!cur) return 0;
-		data-&gt;copyInfo(cur);
-		if(!frame || frame==_info.nb_frames-1)
-		{
-
-			data-&gt;duplicate(cur);
-			vidCache-&gt;unlockAll();
-			return 1;
-		
-		}
-		
-		next=vidCache-&gt;getImage(frame-1);
-		if(!next) 
-		{
-			vidCache-&gt;unlockAll();
-			return 0;
-		}		
-		
-
-		// for u &amp; v , no action -&gt; copy it as is
-		memcpy(UPLANE(data),UPLANE(cur),uvlen&gt;&gt;2);
-		memcpy(VPLANE(data),VPLANE(cur),uvlen&gt;&gt;2);
-		data-&gt;copyInfo(cur);
-
-        	// No interleaving detected
-           	if(!(motion=hasMotion(data)) )
-		{
-			printf(&quot;\n Not interlaced !\n&quot;);
-			memcpy(YPLANE(data),YPLANE(cur),uvlen);
-			vidCache-&gt;unlockAll();
-      			return 1; // over !
-		}
-		// else cmatch is the current match
-		cmatch=getMatch(cur);
-
-/*	------------------------------------------------------------------------------------
-			Try to complete with next frame  fields
------------------------------------------------------------------------------------
-*/
-		// Interleav next in even field
-		
-		interleave(cur,_uncompressed,1);
-		interleave(next,_uncompressed,0);
-		nmatch=getMatch(_uncompressed);
-		
-		interleave(cur,_uncompressed,0);
-		interleave(next,_uncompressed,1);
-		n2match=getMatch(_uncompressed);
-
-		printf(&quot; Cur  : %lu \n&quot;,cmatch);
-		printf(&quot; Next : %lu \n&quot;,nmatch);
-		printf(&quot; NextP: %lu \n&quot;,n2match);
-
-		if((cmatch&lt;nmatch)&amp;&amp;(cmatch&lt;n2match))
-		{
-			printf(&quot;\n __ pure interlaced __\n&quot;);
-			interleave(cur,_uncompressed,0);
-			interleave(cur,_uncompressed,1);
-			hasMotion(_uncompressed);
-	  		doBlend(_uncompressed,data);			
-			vidCache-&gt;unlockAll();
-			return 1;
-		}
-		if( nmatch &gt; n2match)
-		{
-			printf(&quot;\n -------Shifted-P is better \n&quot;);	
-			if(hasMotion(_uncompressed))
-			{
-				 doBlend(_uncompressed,data);
-				 printf(&quot; but there is still motion \n&quot;);
-			}
-			else
-				data-&gt;duplicate(_uncompressed);
-
-		}
-		else
-		{
-			printf(&quot;\n -------Shifted-O is better \n&quot;);
-			interleave(cur,_uncompressed,1);
-			interleave(next,_uncompressed,0);
-			if(hasMotion(_uncompressed))
-			{
-				 doBlend(_uncompressed,data);
-				 printf(&quot; but there is still motion \n&quot;);
-			}
-			else
-				data-&gt;duplicate(_uncompressed);
-		}
-		// which chroma is better ? from current or from next ?
-		// search for a transition and see if there is also one ?
-		vidCache-&gt;unlockAll();				
-		return 1;						
-}
-
-/*
-   	Returns the number of difference (interlacing) found
-
-
-*/
-uint32_t      ADMVideoTelecide::getMatch( ADMImage *image )
-{
-
-			uint32_t m=0,x,y;
-
-			uint8_t *p,*n,*c;
-
-			p=YPLANE(image) ;
-			c=p+ _info.width;
-			n=c+ _info.width;
-			
-			for(y=_info.height&gt;&gt;2;  y &gt;2 ; y--)
-			{
-           			for(x=_info.width;x&gt;0;x--)
-				{
-					if(  (*c-*p)*(*c-*n) &gt;MATCH_THRESH) 
-						m++;
-					p++;c++;n++;
-				}
-				p+=3*_info.width;
-				c+=3*_info.width;
-				n+=3*_info.width;
-
-			}
-
-                 return m;
-}
-
-
-
-#endif
-
-
-
-
-
-

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidTelecide.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidTelecide.h	2007-01-13 11:40:52 UTC (rev 2719)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidTelecide.h	2007-01-13 12:08:21 UTC (rev 2720)
@@ -1,37 +0,0 @@
-/***************************************************************************
-                          ADM_vidTelecide.h  -  description
-                             -------------------
-    begin                : Sun Aug 25 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;ADM_video/ADM_vidField.h&quot;
-#include &quot;ADM_video/ADM_cache.h&quot;
-class  ADMVideoTelecide:public ADMVideoFields
- {
-
- protected:
-    		uint32_t 		getMatch(ADMImage *image);
-             	uint8_t 		interleave(ADMImage *src1, ADMImage *dst,uint8_t odd);
-              	VideoCache		*vidCache;
- public:
- 		
-  					
-					ADMVideoTelecide(  AVDMGenericVideoStream *in,CONFcouple *setup);
-  			virtual 	~ADMVideoTelecide();
-			virtual uint8_t getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-          					ADMImage *data,uint32_t *flags);
-			 virtual char 	*printConf(void);		
- }     ;
-
-
- 

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidTempSmooth.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidTempSmooth.cpp	2007-01-13 11:40:52 UTC (rev 2719)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidTempSmooth.cpp	2007-01-13 12:08:21 UTC (rev 2720)
@@ -1,288 +0,0 @@
-/***************************************************************************
-                          ADM_vidTempSmooth.cpp  -  description
-                             -------------------
-
-	Temporal smoother
-	Adapted from avisynth
-	
-	For each pixel we check toward radius previous image if
-			u,v are within chroma_threshold
-			y   is within luma_threshold
-
-	if so, we blend them with the average value
-	
-	If more than 50% of pixels differs, it is probably a scene change
-	we refill the &quot;previous&quot; screens with present screen and send it as is.
-
-	That avoid blending when there is fade to black or whatever
-
-	For the moment, only u &amp; v are used. Y will follow later.
-	A radius of 6 seems good.
-
-
-    begin                : Sun Jul 28 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-#if 0
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;ADM_assert.h&gt;
-
-#include &quot;config.h&quot;
-#include &quot;fourcc.h&quot;
-#include &quot;avio.hxx&quot;
-#include &quot;config.h&quot;
-#include &quot;avi_vars.h&quot;
-
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_video/ADM_vidTempSmooth.h&quot;
-BUILD_CREATE(tempsmooth_create,AVDMVideoTempSmooth);
- char *AVDMVideoTempSmooth::printConf(void)
-{
-static char str[100];
-		sprintf(str,&quot;Temp Smooth : R = %02lu, chroma=%01lu,luma %01lu&quot;,_param-&gt;radius,
-					_param-&gt;luma_threshold,_param-&gt;chroma_threshold);
- 		return str;
-}
-
-uint8_t AVDMVideoTempSmooth::configure( AVDMGenericVideoStream *instream)
-{
-    UNUSED_ARG(instream);
- 	return 0;
-}
-
-//_______________________________________________________________
-
-AVDMVideoTempSmooth::AVDMVideoTempSmooth(
-									AVDMGenericVideoStream *in,CONFcouple *couples)
-{
-
-   	 _ptr_to_screen=NULL;
-	_screen=NULL;
-  	_in=in;		
-   	memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));  		
-	if(couples)
-	{
-		_param=NEW(TEMPSMOOTH_PARAMS);
-		GET(radius);
-		GET(chroma_threshold);
-		GET(luma_threshold);
-	}
-    else
-    		{
-         			_param=NEW( TEMPSMOOTH_PARAMS);
-            		_param-&gt;radius=7;
-              	_param-&gt;luma_threshold=16;
-              	_param-&gt;chroma_threshold=12;
-
-
-        }
-
-					
-  _info.encoding=1;
-
-  	  	
-}
-
-uint8_t	AVDMVideoTempSmooth::getCoupledConf( CONFcouple **couples)
-{
-
-			ADM_assert(_param);
-			*couples=new CONFcouple(3);
-
-#define CSET(x)  (*couples)-&gt;setCouple((char *)#x,(_param-&gt;x))
-	CSET(radius);
-	CSET(chroma_threshold);
-	CSET(luma_threshold);
-
-			return 1;
-
-}
-AVDMVideoTempSmooth::~AVDMVideoTempSmooth()
-{
-DELETE(_param);
-	if(  _ptr_to_screen) free( _ptr_to_screen);
-	if(_screen) delete [] _screen;
- 	
-}
-
-uint8_t AVDMVideoTempSmooth::getFrameNumberNoAlloc(uint32_t frame,
-				uint32_t *len,
-   				ADMImage *data,
-				uint32_t *flags)
-{
-	uint32_t one_screen;
-	uint8_t *p;
-
-
-		one_screen=  _info.width*_info.height;
-		one_screen+=one_screen&gt;&gt;1;
-
-		if(!_screen) // first time -&gt; allocate and fill the whole stuff
-			{
-
-         			// allocate ptr
-				//_ptr_to_screen=new *uint8_t[_param-&gt;_radius];
-				_ptr_to_screen=(uint8_t **)malloc(_param-&gt;radius*sizeof(uint8_t *));
-				_screen=new uint8_t[_param-&gt;radius*_info.width*_info.height*2];
-
-				p=_screen;
-
-				for(uint32_t i=0;i&lt;_param-&gt;radius;i++)
-				{
-                          	
-					_ptr_to_screen[i]=p;
-					p+=one_screen;
-				}
-	        		if(!_in-&gt;getFrameNumberNoAlloc(frame, len,_screen,flags)) return 0;
-				// copy it to next ones
-				for(uint32_t i=1;i&lt;_param-&gt;radius;i++)
-				{
-					memcpy( _ptr_to_screen[i],_screen,one_screen);
-				}
-
-				// ready !
-				memcpy(data,_screen,one_screen);
-				*len=one_screen;
-				return 1;							
-			}
-       	// now is the generic case
-	// first round rubbing the screens (0 being the most recent...)
-			uint8_t *o;
-			o=_ptr_to_screen[_param-&gt;radius-1];
-    			for(uint32_t i=1;i&lt;_param-&gt;radius;i++)	
-			{
-			   	_ptr_to_screen[i]=_ptr_to_screen[i-1];
-            		}
-			_ptr_to_screen[0]=o;
-  			if(!_in-&gt;getFrameNumberNoAlloc(frame, len,o,flags)) return 0;
-	
-    		// now copy Y  will be dealt with later
-			memcpy(data ,o,     _info.width*_info.height);
-		
-			uint8_t cont1;
-			uint8_t u,v,nu,nv;
-//			uint8_t y1,y2,y3,y4,ny;
-//			uint8_t ny1,ny2,ny3,ny4;
-
-
-			uint32_t  same,diff;
-			int32_t delta,ru,rv;
-//			int32_t ry1,ry2,ry3,ry4;
-
-			uint8_t *out,*outu,*outv,*in,*inu,*inv;
-			uint32_t thres_chroma=		_param-&gt;chroma_threshold*_param-&gt;chroma_threshold;	
-//          	uint32_t thres_luma=		_param-&gt;luma_threshold*_param-&gt;luma_threshold;	
-
-			uint8_t **ptr  = (uint8_t **)malloc(_param-&gt;radius * sizeof(uint8_t *));
-			uint8_t **ptru = (uint8_t **)malloc(_param-&gt;radius * sizeof(uint8_t *));
-			uint8_t **ptrv = (uint8_t **)malloc(_param-&gt;radius * sizeof(uint8_t *));
-						ADM_assert(ptr);
-						ADM_assert(ptru);
-						ADM_assert(ptrv);
-
-						for(uint8_t j=1;j&lt;_param-&gt;radius;j++)
-						{
-                      		ptr[j]=_ptr_to_screen[j];
-								ptru[j]=ptr[j]+_info.width*_info.height;
-								ptrv[j]=ptru[j]+(_info.width*_info.height&gt;&gt;2);
-
-						}
-
-
-	       same=diff=0;
-
-			out=data;
-			outu= out+_info.width*_info.height;
-			outv=outu+(_info.width*_info.height&gt;&gt;2);;
-
-			inu= o+_info.width*_info.height;
-			inv=inu+(_info.width*_info.height&gt;&gt;2);;
-
-			in=o;
-
-			
-
-       	for(uint32_t z=(_info.height&gt;&gt;1);z&gt;0;z--)
-			{
-       	for(uint32_t x=(_info.width&gt;&gt;1);x&gt;0;x--)
-			{
-	             		cont1=1;						
-
-						ru=u=*inu++;
-						rv=v=*inv++;
-#define IFF(w,t)  delta=n##w-w;delta*=delta; 	if((int32_t)delta&lt;(int32_t)t)
-						for(uint8_t j=1;j&lt;_param-&gt;radius;j++)
-						{
-								nu= *(ptru[j]++);
-								nv= *(ptrv[j]++);
-
-								IFF(u,thres_chroma)								
-									{                      	
-                            					IFF(v,thres_chroma)						
-													{
-#define IFFY(x) IFF(y##x,thres_luma) { ry##x## +=ny##x##;cont##x##++;ru+=nu;rv+=nv;}
-														
-															ru+=nu;
-															rv+=nv;
-															cont1++;														
-                                   			}              // end if chroma
-									
-									}                           // end if chroma
-
-                           } // end loop throught radius
-
-					// now check result
-					if(cont1!=1) 	same++; // we got a match!
-
-					if(cont1&gt;1)
-					{					
-						*outu++= ( ru+(cont1&gt;&gt;1))/cont1;			
-						*outv++= ( rv+(cont1&gt;&gt;1))/cont1;
-					}
-					else
-					{
-                   	*outu++=128;          // hig light moving sections
-                   	*outv++=0;
-
-					}
-
-			} // end 140x
-		} // end y
-		*len=one_screen;
-		*flags=0;
-
-		 diff=(_info.width*_info.height&gt;&gt;2)-same;
-		if(diff&gt;same) // scene change !
-		{
-        	printf(&quot;scene change detected\n&quot;);
-							for(uint32_t i=1;i&lt;_param-&gt;radius;i++)
-							{
-								memcpy( _ptr_to_screen[i],o,one_screen);
-							}
-							memcpy(data,o,one_screen);
-
-
-		}
-		printf(&quot;same : %08lu diff: %08lu  total %08lu\n&quot;,same,diff,same+diff);
-	
-	free(ptr);
-	free(ptru);
-	free(ptrv);
-        return 1;
-}
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidTempSmooth.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidTempSmooth.h	2007-01-13 11:40:52 UTC (rev 2719)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidTempSmooth.h	2007-01-13 12:08:21 UTC (rev 2720)
@@ -1,46 +0,0 @@
-/***************************************************************************
-                          ADM_vidTempSmooth.h  -  description
-                             -------------------
-    begin                : Sun Jul 28 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
- typedef struct
- {
-	   	uint32_t radius,chroma_threshold,luma_threshold;
-   }TEMPSMOOTH_PARAMS;
-
-
-    class  AVDMVideoTempSmooth:public AVDMGenericVideoStream
- {
-
- protected:
-
-    			uint8_t						*_unpack;
-           virtual 	char 						*printConf(void);
-    			TEMPSMOOTH_PARAMS				*_param;
-			uint8_t						**_ptr_to_screen;
-			uint8_t						*_screen;
- public:
-
-
-
-						AVDMVideoTempSmooth(  AVDMGenericVideoStream *in,CONFcouple *setup);
-  			virtual 		~AVDMVideoTempSmooth();
-		        virtual uint8_t 	getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-          						ADMImage *data,uint32_t *flags);
-			virtual uint8_t configure( AVDMGenericVideoStream *instream) ;
-			virtual uint8_t	getCoupledConf( CONFcouple **couples)		;
- }     ;
-
- AVDMGenericVideoStream *tempsmooth_create(AVDMGenericVideoStream *in, void *param);

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ASM_vidDenoise.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ASM_vidDenoise.cpp	2007-01-13 11:40:52 UTC (rev 2719)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ASM_vidDenoise.cpp	2007-01-13 12:08:21 UTC (rev 2720)
@@ -1,360 +0,0 @@
-/***************************************************************************
-                          ADM_vidDenoise.cpp  -  description
-                             -------------------
-    begin                : Mon Nov 25 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
-    
-    Denoiser inspired from DNR in transcode
-    Ported to YV12 and simplified
-    
-   Original code  Copyright (C) Gerhard Monzel - November 2001
-
-    
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;ADM_ADM_assert.h&gt;
-#include &lt;ADM_ADM_assert.h&gt;
-#include &lt;math.h&gt;
-
-
-#include &quot;fourcc.h&quot;
-#include &quot;avio.hxx&quot;
-#include &quot;config.h&quot;
-#include &quot;avi_vars.h&quot;
-
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_video/ADM_vidDenoise.h&quot;
-
-uint8_t distMatrix[256][256];
-
-//static uint8_t matrixReady=0;
-//static uint8_t doOnePix(uint8_t *in,uint8_t *out,uint8_t *lock,uint8_t *nb);
-
-
-
-
-
-
-char *ADMVideoDenoise::printConf( void )
-{
- 	static char buf[50];
-
-  ADM_ADM_assert(_param);
- 	sprintf((char *)buf,&quot; Denoise : Lum :%02ld/:%02ld / Chm :%02ld/%02ld&quot;,
-  								_param-&gt;lumaLock,
-          				_param-&gt;lumaThreshold,
-              		_param-&gt;chromaLock,
-                	_param-&gt;chromaThreshold);
-        return buf;
-}
-void buildDistMatrix( void );
-void buildDistMatrix( void )
-{
-int d;	
-	for(uint32_t y=255;y&gt;0;y--)
-	for(uint32_t x=255;x&gt;0;x--)
-	{
-		  d=x-y;
-		  if(d&lt;0) d=-d;
-		  distMatrix[x][y]=d;
-		
-	}
-	
-	
-}
-
-//_______________________________________________________________
-
-ADMVideoDenoise::ADMVideoDenoise(
-									AVDMGenericVideoStream *in,void *setup)
-{
-
-
-  	_in=in;		
-   	memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));  			 	
-    uint32_t page;
-    
-  _info.encoding=1;
-  
-  page= 3*_in-&gt;getInfo()-&gt;width*_in-&gt;getInfo()-&gt;height;
-  
-  _uncompressed=new uint8_t [page];
-  ADM_ADM_assert(_uncompressed);
-  
-  _locked=new uint8_t [page];
-  ADM_ADM_assert(_locked);
- 
-	_lockcount=new uint8_t [page];
-  ADM_ADM_assert(_lockcount);  
-  
-  memset(_lockcount,0,page);  
-        
-  _param=NULL;
-  
-  if(setup)
-  	{
-				_param=(NOISE_PARAM *)setup;	  	
-		 }
-	else
-		{
-			  #define XXX 1
-			  _param=NEW( NOISE_PARAM);
-			  _param-&gt;lumaLock=  4*XXX;
-			  _param-&gt;lumaThreshold= 10*XXX;
-			  _param-&gt;chromaLock=  8*XXX;
-			  _param-&gt;chromaThreshold= 16*XXX;
-        		  _param-&gt;sceneChange=  30*XXX;
-			}
-  	  _lastFrame=0xfffffff0;	
-}
-
-ADMVideoDenoise::ADMVideoDenoise(  AVDMGenericVideoStream *in,CONFcouple *couples)
-{
-	_param=NEW(NOISE_PARAM);
-	#define GET(x) ADM_ADM_assert(couples-&gt;getCouple((char *)#x,&amp;(_param-&gt;x)))
-
-	GET(lumaLock);
-	GET(lumaThreshold);
-	GET(chromaLock);
-	GET(chromaThreshold);
-	GET(sceneChange);
-
-
-	ADMVideoDenoise(in,_param);
-
-
-}
-uint8_t	ADMVideoDenoise::getCoupledConf( CONFcouple **couples)
-{
-
-			ADM_ADM_assert(_param);
-			*couples=new CONFcouple(5);
-
-#define CSET(x)  (*couples)-&gt;setCouple((char *)#x,(_param-&gt;x))
-	CSET(lumaLock);
-	CSET(lumaThreshold);
-	CSET(chromaLock);
-	CSET(chromaThreshold);
-	CSET(sceneChange);
-
-	return 1;
-
-}
-
-ADMVideoDenoise::~ADMVideoDenoise()
-{
- 	
-	delete [] _uncompressed;
- 	delete [] _locked;
-  delete [] _lockcount;
-  
-  _uncompressed=_locked=_lockcount=NULL;
-}
-
-//
-//	Remove y and v just keep U and expand it
-//
-uint8_t ADMVideoDenoise::getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-          																	uint8_t *data,uint32_t *flags)
-{
-   //uint32_t x,w;
-  	uint32_t page; 
-   		ADM_ADM_assert(_param);
-			ADM_ADM_assert(frame&lt;_info.nb_frames);
-								
-			
-       		if(!_in-&gt;getFrameNumberNoAlloc(frame, len,_uncompressed,flags)) return 0;
-       		  *len= _info.width*_info.height+(_info.width*_info.height&gt;&gt;1);       			
-                     
-           //uint32_t sz=_info.width*_info.height;
-
-          if((_lastFrame+1)!=frame) // async jump
-          {
-							// just copy it 
-								memcpy(data,_uncompressed,*len);
-								memcpy(_locked,_uncompressed,*len);
-								_lastFrame=frame;
-								return 1;
-					}          
-				_lastFrame=frame;
-          
-          // copy chroma for now
-          page=  _info.width*_info.height&gt;&gt;2;
-         
-          
-          //
-          //uint32_t count=0;
-          //uint32_t cell=page*4; // size of luma
-          uint8_t *in,*out,*lock,*nb;
-          uint8_t *uin,*uout,*ulock,*unb;
-          uint8_t *vin,*vout,*vlock,*vnb;
-          
-          
-          //uint32_t d;
-          // init all
-          
-          // luma
-          nb=_lockcount;
-          lock=_locked;
-          in=_uncompressed;
-          out=data;
-          // u
-          unb=nb+page*4;
-          ulock=lock+page*4;
-          uin=in+page*4;
-          uout=data+page*4;
-          // v
-          vnb=unb+page;
-          vlock=ulock+page;
-          vin=uin+page;
-          vout=uout+page;
-          
-          
-          uint32_t xx,yy/*,dl*/,du,dv;
-          uint32_t locked=0;
-          for(yy=_info.height&gt;&gt;1;yy&gt;0;yy--)
-          {
-	          for(xx=_info.width&gt;&gt;1;xx&gt;0;xx--)          
-  	        {
-								du=distMatrix[*uin][*ulock];														
-								dv=distMatrix[*vin][*vlock];														
-						
-								// if chroma is locked , we try to lock luma
-								if( (du&lt;_param-&gt;chromaLock)
-									 &amp;&amp; (dv&lt;_param-&gt;chromaLock))
-									 {  
-										 			*uout=*ulock;
- 										 			*vout=*vlock;
-
-#define PIX(z) 		doOnePix(in+z,out+z,lock+z,nb+z)									 
-										 			locked+=PIX(0)+	PIX(1)+ 	PIX(_info.width)+
-										     	PIX(_info.width+1);										      										 
-										}
-										else
-								  // if chroma is blended, we blend luma
-#undef PIX								  
-#define PIX(z) 		doBlend(in+z,out+z,lock+z,nb+z)									 
-									if( (du&lt;_param-&gt;chromaThreshold)
-									 &amp;&amp; (dv&lt;_param-&gt;chromaThreshold))
-										{
-											 		PIX(0);
-										    	PIX(1);
-										     	PIX(_info.width);
-										     	PIX(_info.width+1);															
-										      *uout=*ulock=(*uin+*uin)&gt;&gt;1;
- 										 			*vout=*vlock=(*vin+*vin)&gt;&gt;1;
-										}
-#undef PIX											
-										
-										else
-										{
-#define PIX(z) *(out+z)=*(lock+z)=*(in+z);*(nb+z)=0											
-											
-													PIX(0);
-										    	PIX(1);
-										     	PIX(_info.width);
-										     	PIX(_info.width+1);		
-										 			*uout=*ulock=*uin;
- 										 			*vout=*vlock=*vin;
-											
-#undef PIX											
-										}
-								  
-											                        				                        
-							uin++;uout++;ulock++;unb++;   
-							vin++;vout++;vlock++;vnb++;   
-							in++;out++;lock++;nb++;   
-							in++;out++;lock++;nb++;   
-							
-						}
-            // 
-            in+=_info.width;
-            out+=_info.width;
-            lock+=_info.width;
-            nb+=_info.width;            						
-					};
-          
-          if(locked&gt;page*3) // if more than 75% pixel not locked -&gt; scene change
-          {
-						  	memcpy(data,_uncompressed,*len);
-								memcpy(_locked,_uncompressed,*len);
-					}
-           
-      return 1;
-}
-
-//
-//	0 copy
-//  1 lock
-//  2 threshold
-//
-uint8_t ADMVideoDenoise::doOnePix(uint8_t *in,uint8_t *out,uint8_t *lock,uint8_t *nb)
-{
-unsigned int d;
-							d=distMatrix[*(in)][*(lock)]; 
-							if(d&lt;_param-&gt;lumaLock)         
-							{								                
-								if(*(nb)&gt;30)  // out of scope -&gt; copy new                   
-								{  						// too much copy -&gt;                              
-										*(nb)=0;                       
-										*(out)=(*(in)+*(lock))&gt;&gt;1;
-										*(lock)=*(out);    										
-										return DN_COPY;      
-								}                                 
-								else                               
-								{                                   
-									*(out)=*(lock);		
-									*nb += 1; // *(nb)++;	
-									return DN_LOCK;		
-								}                  
-							}                     
-							else if(d&lt; _param-&gt;lumaThreshold) 
-							{                                  
-								 *(nb)=0;                           
-									*(out)=(*(in)+*(lock))&gt;&gt;1;	
-									return DN_BLEND;							
-							}
-							else   // too big delta
-							{    
-								 *(nb)=0; 
-									*(out)=*(in);	  
-									*(lock)=*(in);    
-									return DN_COPY;
-							}                     
-					                           
-							ADM_ADM_assert(0);
-							return 0;
-
-}
-uint8_t ADMVideoDenoise::doBlend(uint8_t *in,uint8_t *out,uint8_t *lock,uint8_t *nb)
-{
-unsigned int d;
-		   d=distMatrix[*(in)][*(lock)]; 
-		   *nb=0;
-		   
-			if(d&lt;_param-&gt;lumaThreshold)         
-			{
-					*(out)=(*(in)+*(lock))&gt;&gt;1;					
-			}
-			else
-			*out=*in;
-			return 0;
-	
-}
-
-// EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-01-13 11:40:52 UTC (rev 2719)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-01-13 12:08:21 UTC (rev 2720)
@@ -8,7 +8,6 @@
 
 libADM_video_a_SOURCES = ADM_vidFields.cpp \
  ADM_vidDeintASM.cpp \
- ADM_vidSalt.cpp \
  ADM_vidCached.cpp \
  ADM_vidPartial.cpp \
  ADM_vidFont.cpp \
@@ -18,25 +17,18 @@
  ADM_vidCrop.cpp \
  ADM_vidDeinterlace.cpp \
  ADM_vidNull.cpp \
- ADM_vidPalShift.cpp \
 	ADM_vidResize.cpp \
- ADM_vidTelecide.cpp \
- ADM_vidTempSmooth.cpp \
 	ADM_vidClean.cpp \
 	ADM_resizebis.cpp \
  ADM_genvideo.cpp \
  ADM_vidRotate.cpp \
  ADM_vidRotate.h \
  ADM_vidResize25.cpp \
- ADM_vidSwapFields.cpp \
-	ADM_vidSwapFields.h ADM_vidSeparateField.cpp \
  ADM_vidFieldUtil.cpp \
  ADM_vidFieldUtil.h \
-	ADM_vidSeparateField.h ADM_confCouples.cpp \
+ ADM_confCouples.cpp \
  ADM_confCouple.h ADM_vidCommonFilter.h \
 	ADM_vidChromaShift.h ADM_vidChromaShift.cpp \
- ADM_vidSwapSmart.cpp \
- ADM_vidSwapSmart.h \
 	ADM_vidMPLResize.cpp \
  ADM_vidIVTC.cpp \
  ADM_vidIVTC.h ADM_interlaced.cpp \
@@ -64,7 +56,6 @@
  ADM_vidColorYuv.cpp  \
  ADM_guiResize.cpp \
  ADM_vidAnimated.cpp \
- ADM_vidReverse.cpp  \
  ADM_vidASS.cpp
 
 				
@@ -73,8 +64,8 @@
 EXTRA_DIST =  ADM_cache.cpp  ADM_vidDecDec_param.h \
 ADM_cache.h  ADM_vidDecTel_param.h \
 ADM_confCouple.h ADM_vidDecTelecide.cpp  ADM_vidNull.cpp \
-ADM_confCouples.cpp  ADM_vidDecTelecide.h  ADM_vidPalShift.cpp \
-ADM_genvideo.cpp ADM_vidDeintASM.cpp ADM_vidPalShift.h \
+ADM_confCouples.cpp  ADM_vidDecTelecide.h  \
+ADM_genvideo.cpp ADM_vidDeintASM.cpp \
 ADM_genvideo.hxx ADM_vidDeinterlace.cpp  ADM_vidPartial.cpp \
 ADM_vidDeinterlace.h  ADM_vidPartial.h \
 ADM_vidDelta.cpp  ADM_vidPartial_param.h \
@@ -82,31 +73,27 @@
 ADM_interlaced.cpp  \
 ADM_interlaced.h ADM_vidEq2.cpp  ADM_vidResize.cpp \
 ADM_vidEq2.h  ADM_vidResize25.cpp \
-ADM_vidEqualizer.cpp  ADM_vidReverse.cpp \
+ADM_vidEqualizer.cpp  \
 ADM_mpdetc.cpp ADM_vidEqualizer.h  ADM_vidRotate.cpp \
 ADM_mpdetc.h ADM_vidRotate.h \
 ADM_resizebis.cpp   ADM_vidSRT.cpp \
 ADM_resizebis.hxx    ADM_vidSRT.h \
 ADM_resizeter.cpp  ADM_vidField.h  ADM_vidSRTRender.cpp \
 ADM_vidFieldUnblend.cpp ADM_vidSRTload.cpp \
-ADM_vidASharp_param.h  ADM_vidFieldUtil.cpp  ADM_vidSalt.cpp \
-ADM_vidFieldUtil.h  ADM_vidSalt.h \
-ADM_vidFields.cpp ADM_vidSeparateField.cpp \
-ADM_vidAnimated.cpp  ADM_vidSeparateField.h \
+ADM_vidASharp_param.h  ADM_vidFieldUtil.cpp  \
+ADM_vidFieldUtil.h  \
+ADM_vidFields.cpp \
+ADM_vidAnimated.cpp  \
 ADM_vidAnimated.h  \
 ADM_vidAnimated_param.h   \
 ADM_vidAsharp.cpp   \
 ADM_vidFont.cpp \
-ADM_vidBlend.cpp ADM_vidFont.h ADM_vidSwapFields.cpp \
-ADM_vidSwapFields.h \
-ADM_vidSwapSmart.cpp \
-ADM_vidCNR2.cpp  ADM_vidSwapSmart.h \
+ADM_vidBlend.cpp ADM_vidFont.h \
+ADM_vidCNR2.cpp  \
 ADM_vidCNR2_param.h  ADM_vidHue.cpp  ADM_vidTDeint_param.h \
 ADM_vidCached.cpp  ADM_vidHue.h  ADM_vidTdeint.cpp \
-ADM_vidCached.h  ADM_vidIVTC.cpp ADM_vidTelecide.cpp \
-ADM_vidIVTC.h ADM_vidTelecide.h \
-ADM_vidTempSmooth.cpp \
-ADM_vidTempSmooth.h \
+ADM_vidCached.h  ADM_vidIVTC.cpp \
+ADM_vidIVTC.h \
 ADM_vidChromaShift.cpp \
 ADM_vidChromaShift.h ADM_vidUnblend.cpp \
 ADM_vidClean.cpp ADM_vidUnblend_param.h \
@@ -119,7 +106,6 @@
 ADM_vidContrast.h  ADM_vidMPdelogo.h \
 ADM_vobsubinfo.cpp \
 ADM_vidCrop.cpp  ADM_vidMSmooth_param.h  ADM_vobsubinfo.h \
-ASM_vidDenoise.cpp \
 ADM_vidDecDec.cpp  swscale_internal.h \
 ADM_vidTdeint_util.txt ADM_vidASS.h ADM_vidASS.cpp \
 ADM_vidAss_Params.h mmx_macros.h

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidPalShift.cpp (from rev 2489, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidPalShift.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidPalShift.cpp	2006-10-31 15:59:58 UTC (rev 2489)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidPalShift.cpp	2007-01-13 12:08:21 UTC (rev 2720)
@@ -0,0 +1,158 @@
+/***************************************************************************
+                          ADM_vidPalShift.cpp  -  description
+                             -------------------
+    begin                : Sat Aug 24 2002
+    copyright            : (C) 2002 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+ #include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;ADM_assert.h&gt;
+
+#include &quot;config.h&quot;
+#include &quot;fourcc.h&quot;
+#include &quot;avio.hxx&quot;
+#include &quot;config.h&quot;
+#include &quot;avi_vars.h&quot;
+#ifdef HAVE_ENCODER
+
+
+#include &quot;ADM_toolkit/toolkit.hxx&quot;
+#include &quot;ADM_editor/ADM_edit.hxx&quot;
+#include &quot;ADM_video/ADM_genvideo.hxx&quot;
+#include &quot;ADM_vidPalShift.h&quot;
+#include &quot;ADM_filter/video_filters.h&quot;
+
+#include &quot;ADM_userInterfaces/ADM_commonUI/DIA_factory.h&quot;
+
+static FILTER_PARAM nullParam={0,{&quot;&quot;}};
+
+
+SCRIPT_CREATE(addPALShift_script,ADMVideoPalShift,nullParam);
+BUILD_CREATE(addPALShift_create,ADMVideoPalShift);
+
+
+char *ADMVideoPalShift::printConf( void )
+{
+ 	static char buf[50];
+ 	
+ 	sprintf((char *)buf,&quot; PAL field shift&quot;);
+        return buf;
+}
+
+ADMVideoPalShift::ADMVideoPalShift(  AVDMGenericVideoStream *in,CONFcouple *setup)
+{
+	UNUSED_ARG(setup);
+	
+
+	_reverse=NULL;
+ 	_in=in;		
+	memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));  		
+	
+
+	_reverse=new uint32_t;;
+	*_reverse=1;
+	
+  	_info.encoding=1;
+
+	vidCache=new VideoCache(5,in);
+
+
+  	  	
+}
+ uint8_t ADMVideoPalShift::configure( AVDMGenericVideoStream *instream) 
+{
+  
+  diaElemToggle chroma(_reverse,_(&quot;Try reverse&quot;));
+    
+    diaElem *elems[]={&amp;chroma};
+  
+    return diaFactoryRun(&quot;Pal Shift&quot;,sizeof(elems)/sizeof(diaElem *),elems);
+
+} 
+ADMVideoPalShift::~ADMVideoPalShift()
+{
+	delete vidCache;
+	delete _reverse;
+}
+uint8_t ADMVideoPalShift::getFrameNumberNoAlloc(uint32_t frame,
+				uint32_t *len,
+   				ADMImage *data,
+				uint32_t *flags)
+{
+
+uint32_t full,half;
+ADMImage *cur,*next;
+
+		full=_info.width*_info.height;
+		half=full&gt;&gt;2;
+
+		if(frame&gt;=_info.nb_frames) return 0;
+		
+		cur=vidCache-&gt;getImage(frame);
+		if(!cur) return 0;
+			
+		// for first or last frame do nothing
+		if(!frame || frame==_info.nb_frames-1)
+		{
+
+			data-&gt;duplicate(cur);
+			vidCache-&gt;unlockAll();
+			return 1;	
+		}				
+								
+		// copy u &amp; v as they are			
+
+		memcpy(UPLANE(data),UPLANE(cur),half);
+		memcpy(VPLANE(data),VPLANE(cur),half);
+
+		// now copy odd field from framei and even frame from frame i-1		
+		// OR the other way around
+		uint32_t dline=_info.width;
+		
+		next=vidCache-&gt;getImage(frame+1);
+		if(!next) return 0;
+
+		//
+		uint8_t *src,*dst,*src2;
+		if(!*_reverse)
+		{
+			src2=YPLANE(cur)+dline;
+			src=YPLANE(next);
+			dst=YPLANE(data);
+		}
+		else
+		{
+			src2=YPLANE(next)+dline;
+			src=YPLANE(cur);
+			dst=YPLANE(data);
+		
+		}
+		for(uint32_t y=(_info.height&gt;&gt;1);y&gt;0;y--)
+		{
+                	memcpy(dst,src, dline);
+			dst+=dline;
+                	memcpy(dst,src2, dline);
+			dst+=dline;
+			src+=dline*2;
+			src2+=dline*2;
+		}
+		
+	vidCache-&gt;unlockAll();
+			data-&gt;copyInfo(cur);
+      return 1;
+}
+
+
+
+#endif

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidPalShift.h (from rev 2489, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidPalShift.h)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidPalShift.h	2006-10-31 15:59:58 UTC (rev 2489)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidPalShift.h	2007-01-13 12:08:21 UTC (rev 2720)
@@ -0,0 +1,42 @@
+/***************************************************************************
+                          ADM_vidPalShift.h  -  description
+                             -------------------
+    begin                : Sat Aug 24 2002
+    copyright            : (C) 2002 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#ifndef PALSHIFT__
+#define PALSHIFT__
+#include &quot;ADM_video/ADM_cache.h&quot; 
+ class  ADMVideoPalShift:public AVDMGenericVideoStream
+ {
+
+ protected:
+    		
+		VideoCache			*vidCache;
+     virtual 	char 				*printConf(void);
+
+		uint32_t			*_reverse;
+
+
+ public:
+
+
+  				ADMVideoPalShift(  AVDMGenericVideoStream *in,CONFcouple *setup);
+
+  	virtual 		~ADMVideoPalShift();
+	virtual uint8_t 	getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
+          								ADMImage *data,uint32_t *flags);
+	virtual uint8_t configure( AVDMGenericVideoStream *instream) ;
+
+ }     ;
+#endif

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidPalSmart.cpp (from rev 2489, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidTelecide.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidTelecide.cpp	2006-10-31 15:59:58 UTC (rev 2489)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidPalSmart.cpp	2007-01-13 12:08:21 UTC (rev 2720)
@@ -0,0 +1,259 @@
+
+/***************************************************************************
+                          ADM_vidTelecide.cpp  -  description
+                             -------------------
+	Strongly inspired by Donal Graft deinterlacer (decomb)
+
+***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;ADM_assert.h&gt;
+
+#include &quot;config.h&quot;
+#include &quot;fourcc.h&quot;
+#include &quot;avio.hxx&quot;
+#include &quot;config.h&quot;
+#include &quot;avi_vars.h&quot;
+#ifdef HAVE_ENCODER
+//#define EVEN_INTERLEAVE	
+
+#include &quot;ADM_toolkit/toolkit.hxx&quot;
+#include &quot;ADM_editor/ADM_edit.hxx&quot;
+#include &quot;ADM_video/ADM_genvideo.hxx&quot;
+
+#include&quot;ADM_video/ADM_vidDeinterlace.h&quot;
+#include&quot;ADM_vidPalSmart.h&quot;
+#include &quot;ADM_filter/video_filters.h&quot;
+
+#define MATCH_THRESH 100
+#define ASM_DEINT
+#define ASM_BLEND
+static FILTER_PARAM nullParam={0,{&quot;&quot;}};
+
+
+SCRIPT_CREATE(telecide_script,ADMVideoTelecide,nullParam);
+extern  int32_t _l_w,_l_h;
+extern uint8_t *_l_p,*_l_c,*_l_n;
+extern uint8_t *_l_e,*_l_e2;
+
+BUILD_CREATE(telecide_create,ADMVideoTelecide);
+
+
+char *ADMVideoTelecide::printConf(void)
+{
+ 		return (char *)&quot;Pal Smart&quot;;;
+}
+
+//_______________________________________________________________
+
+
+ADMVideoTelecide::ADMVideoTelecide(	AVDMGenericVideoStream *in,CONFcouple *setup)
+										: ADMVideoFields(in,setup)
+{
+	vidCache=new VideoCache(4,in);
+	_uncompressed=new ADMImage(_info.width,_info.height);
+  	
+}
+ADMVideoTelecide::~ADMVideoTelecide()
+{
+ 	
+	delete vidCache;
+	vidCache=NULL;
+	delete _uncompressed;
+	
+}
+/*
+  	Interleave _uncompressed with in2
+   		even line from in2 odd=0
+      odd  line          odd=1
+*/
+uint8_t ADMVideoTelecide::interleave(	ADMImage *imgsrc, ADMImage *imgdst,uint8_t odd)
+{
+ 	uint32_t w=_info.width;
+	uint8_t  *src1,*dst;
+	
+	src1=YPLANE(imgsrc);
+	dst=YPLANE(imgdst);
+	if(odd)
+	{
+		src1+=w;
+		dst+=w;
+	}
+	for(uint32_t y=(_info.height&gt;&gt;1);y&gt;0;y--)
+		{
+        		memcpy(dst,src1,w);
+			src1+=w&lt;&lt;1;
+			dst+=w&lt;&lt;1;
+		}
+	return 1;
+}
+
+//
+//		Try to march fields of a frame with previous  / next until it is not interlaced	
+//
+//
+
+uint8_t ADMVideoTelecide::getFrameNumberNoAlloc(uint32_t frame,
+			uint32_t *len,
+			ADMImage *data,
+			uint32_t *flags)
+{
+uint32_t uvlen;
+uint32_t dummylen;
+uint8_t motion;
+
+uint32_t 	cmatch,nmatch,n2match;
+ADMImage	*cur,*next;
+
+			
+		if(frame&gt;=_info.nb_frames) return 0;			
+		uvlen=    _info.width*_info.height;
+		*len=uvlen+(uvlen&gt;&gt;1);
+		
+		cur=vidCache-&gt;getImage(frame);
+		if(!cur) return 0;
+		data-&gt;copyInfo(cur);
+		if(!frame || frame==_info.nb_frames-1)
+		{
+
+			data-&gt;duplicate(cur);
+			vidCache-&gt;unlockAll();
+			return 1;
+		
+		}
+		
+		next=vidCache-&gt;getImage(frame-1);
+		if(!next) 
+		{
+			vidCache-&gt;unlockAll();
+			return 0;
+		}		
+		
+
+		// for u &amp; v , no action -&gt; copy it as is
+		memcpy(UPLANE(data),UPLANE(cur),uvlen&gt;&gt;2);
+		memcpy(VPLANE(data),VPLANE(cur),uvlen&gt;&gt;2);
+		data-&gt;copyInfo(cur);
+
+        	// No interleaving detected
+           	if(!(motion=hasMotion(data)) )
+		{
+			printf(&quot;\n Not interlaced !\n&quot;);
+			memcpy(YPLANE(data),YPLANE(cur),uvlen);
+			vidCache-&gt;unlockAll();
+      			return 1; // over !
+		}
+		// else cmatch is the current match
+		cmatch=getMatch(cur);
+
+/*	------------------------------------------------------------------------------------
+			Try to complete with next frame  fields
+-----------------------------------------------------------------------------------
+*/
+		// Interleav next in even field
+		
+		interleave(cur,_uncompressed,1);
+		interleave(next,_uncompressed,0);
+		nmatch=getMatch(_uncompressed);
+		
+		interleave(cur,_uncompressed,0);
+		interleave(next,_uncompressed,1);
+		n2match=getMatch(_uncompressed);
+
+		printf(&quot; Cur  : %lu \n&quot;,cmatch);
+		printf(&quot; Next : %lu \n&quot;,nmatch);
+		printf(&quot; NextP: %lu \n&quot;,n2match);
+
+		if((cmatch&lt;nmatch)&amp;&amp;(cmatch&lt;n2match))
+		{
+			printf(&quot;\n __ pure interlaced __\n&quot;);
+			interleave(cur,_uncompressed,0);
+			interleave(cur,_uncompressed,1);
+			hasMotion(_uncompressed);
+	  		doBlend(_uncompressed,data);			
+			vidCache-&gt;unlockAll();
+			return 1;
+		}
+		if( nmatch &gt; n2match)
+		{
+			printf(&quot;\n -------Shifted-P is better \n&quot;);	
+			if(hasMotion(_uncompressed))
+			{
+				 doBlend(_uncompressed,data);
+				 printf(&quot; but there is still motion \n&quot;);
+			}
+			else
+				data-&gt;duplicate(_uncompressed);
+
+		}
+		else
+		{
+			printf(&quot;\n -------Shifted-O is better \n&quot;);
+			interleave(cur,_uncompressed,1);
+			interleave(next,_uncompressed,0);
+			if(hasMotion(_uncompressed))
+			{
+				 doBlend(_uncompressed,data);
+				 printf(&quot; but there is still motion \n&quot;);
+			}
+			else
+				data-&gt;duplicate(_uncompressed);
+		}
+		// which chroma is better ? from current or from next ?
+		// search for a transition and see if there is also one ?
+		vidCache-&gt;unlockAll();				
+		return 1;						
+}
+
+/*
+   	Returns the number of difference (interlacing) found
+
+
+*/
+uint32_t      ADMVideoTelecide::getMatch( ADMImage *image )
+{
+
+			uint32_t m=0,x,y;
+
+			uint8_t *p,*n,*c;
+
+			p=YPLANE(image) ;
+			c=p+ _info.width;
+			n=c+ _info.width;
+			
+			for(y=_info.height&gt;&gt;2;  y &gt;2 ; y--)
+			{
+           			for(x=_info.width;x&gt;0;x--)
+				{
+					if(  (*c-*p)*(*c-*n) &gt;MATCH_THRESH) 
+						m++;
+					p++;c++;n++;
+				}
+				p+=3*_info.width;
+				c+=3*_info.width;
+				n+=3*_info.width;
+
+			}
+
+                 return m;
+}
+
+
+
+#endif
+
+
+
+
+
+

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidPalSmart.h (from rev 2489, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidTelecide.h)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidReverse.cpp (from rev 2489, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidReverse.cpp)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSeparateField.cpp (from rev 2489, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSeparateField.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSeparateField.cpp	2006-10-31 15:59:58 UTC (rev 2489)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSeparateField.cpp	2007-01-13 12:08:21 UTC (rev 2720)
@@ -0,0 +1,269 @@
+/***************************************************************************
+                          Separate Fields.cpp  -  description
+                             -------------------
+Convert a x*y * f fps video into -&gt; x*(y/2)*fps/2 video
+
+Same idea as for avisynth separatefield
+
+
+    begin                : Thu Mar 21 2002
+    copyright            : (C) 2002 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;ADM_assert.h&gt;
+
+#include &quot;config.h&quot;
+#include &quot;fourcc.h&quot;
+#include &quot;avio.hxx&quot;
+#include &quot;config.h&quot;
+#include &quot;avi_vars.h&quot;
+
+
+#include &quot;ADM_toolkit/toolkit.hxx&quot;
+#include &quot;ADM_editor/ADM_edit.hxx&quot;
+#include &quot;ADM_video/ADM_genvideo.hxx&quot;
+#include &quot;ADM_video/ADM_vidFieldUtil.h&quot;
+#include &quot;ADM_vidSeparateField.h&quot;
+#include &quot;ADM_filter/video_filters.h&quot;
+
+
+static FILTER_PARAM swapParam={0,{&quot;&quot;}};
+
+SCRIPT_CREATE(separatefield_script,AVDMVideoSeparateField,swapParam);
+SCRIPT_CREATE(mergefield_script,AVDMVideoMergeField,swapParam);
+SCRIPT_CREATE(stackfield_script,AVDMVideoStackField,swapParam);
+SCRIPT_CREATE(unstackfield_script,AVDMVideoUnStackField,swapParam);
+
+BUILD_CREATE(separatefield_create,AVDMVideoSeparateField);
+BUILD_CREATE(mergefield_create,AVDMVideoMergeField);
+BUILD_CREATE(stackfield_create,AVDMVideoStackField);
+BUILD_CREATE(unstackfield_create,AVDMVideoUnStackField);
+
+char *AVDMVideoSeparateField::printConf( void )
+{
+ 	static char buf[50];
+
+ 	sprintf((char *)buf,&quot; Separate Fields&quot;);
+        return buf;
+}
+
+//_______________________________________________________________
+AVDMVideoSeparateField::AVDMVideoSeparateField(
+									AVDMGenericVideoStream *in,CONFcouple *setup)
+{
+UNUSED_ARG(setup);
+  	_in=in;
+   	memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));
+	
+
+	_info.height&gt;&gt;=1;
+	_info.fps1000*=2;
+	_info.nb_frames*=2;
+	vidCache=new VideoCache(2,_in);
+
+}
+
+// ___ destructor_____________
+AVDMVideoSeparateField::~AVDMVideoSeparateField()
+{
+ 	
+	delete vidCache;
+	vidCache=NULL;
+}
+
+//
+//	Basically ask a uncompressed frame from editor and ask
+//		GUI to decompress it .
+//
+
+uint8_t AVDMVideoSeparateField::getFrameNumberNoAlloc(uint32_t frame,
+				uint32_t *len,
+   				ADMImage *data,
+				uint32_t *flags)
+{
+uint32_t ref;
+ADMImage *ptr;
+		if(frame&gt;=_info.nb_frames) return 0;
+		ref=frame&gt;&gt;1;
+		
+		ptr=vidCache-&gt;getImage(ref);
+		if(!ptr) return 0;
+
+		ADM_assert(ptr-&gt;data);
+		ADM_assert(data-&gt;data);
+		if(frame&amp;1) // odd image
+			 vidFieldKeepOdd(_info.width,_info.height,ptr-&gt;data,data-&gt;data);
+		else
+			 vidFieldKeepEven(_info.width,_info.height,ptr-&gt;data,data-&gt;data);
+		data-&gt;copyInfo(ptr);	
+		vidCache-&gt;unlockAll();
+      return 1;
+}
+//------------------ and merge them ------------------
+
+
+char *AVDMVideoMergeField::printConf( void )
+{
+ 	static char buf[50];
+
+ 	sprintf((char *)buf,&quot; Merge fields&quot;);
+        return buf;
+}
+
+//_______________________________________________________________
+AVDMVideoMergeField::AVDMVideoMergeField(
+									AVDMGenericVideoStream *in,CONFcouple *setup)
+{
+UNUSED_ARG(setup);
+  	_in=in;
+   	memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));	
+	vidCache=new VideoCache(4,_in);
+	
+
+	_info.height&lt;&lt;=1;
+	_info.fps1000&gt;&gt;=1;
+	_info.nb_frames&gt;&gt;=1;
+
+
+}
+
+// ___ destructor_____________
+AVDMVideoMergeField::~AVDMVideoMergeField()
+{
+ 		delete vidCache;
+		vidCache=NULL;
+}
+
+/**
+	Interleave frame*2 and frame*2+1
+*/
+uint8_t AVDMVideoMergeField::getFrameNumberNoAlloc(uint32_t frame,
+				uint32_t *len,
+   				ADMImage *data,
+				uint32_t *flags)
+{
+uint32_t ref,ref2;
+ADMImage *ptr1,*ptr2;
+		if(frame&gt;=_info.nb_frames) return 0;
+
+		ref=frame&lt;&lt;1;
+		ref2=ref+1;
+		ptr1=vidCache-&gt;getImage(ref);
+		ptr2=vidCache-&gt;getImage(ref+1);
+		
+		if(!ptr1 || !ptr2)
+		{
+			printf(&quot;Merge field : cannot read\n&quot;);
+			vidCache-&gt;unlockAll();
+		 	return 0;
+		}
+		 vidFieldMerge(_info.width,_info.height,ptr1-&gt;data,ptr2-&gt;data,data-&gt;data);
+		 vidCache-&gt;unlockAll();
+		
+      return 1;
+}
+//_______________________Stack Fields_______________________
+
+char *AVDMVideoStackField::printConf( void )
+{
+ 	static char buf[50];
+
+ 	sprintf((char *)buf,&quot; Stack fields&quot;);
+        return buf;
+}
+
+//_______________________________________________________________
+AVDMVideoStackField::AVDMVideoStackField(	AVDMGenericVideoStream *in,CONFcouple *setup)
+{
+UNUSED_ARG(setup);
+  	_in=in;
+   	memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));	
+	_uncompressed=new ADMImage(_info.width,_info.height);	
+
+}
+
+// ___ destructor_____________
+AVDMVideoStackField::AVDMVideoStackField()
+{
+ 		delete _uncompressed;
+		_uncompressed=NULL;
+}
+
+/**
+	Interleave frame*2 and frame*2+1
+*/
+uint8_t AVDMVideoStackField::getFrameNumberNoAlloc(uint32_t frame,
+				uint32_t *len,
+   				ADMImage *data,
+				uint32_t *flags)
+{
+uint32_t ref,ref2;
+ADMImage *ptr1,*ptr2;
+		if(frame&gt;=_info.nb_frames) return 0;
+
+		 if(!_in-&gt;getFrameNumberNoAlloc(frame, len, _uncompressed, flags)) return 0;
+		 
+		  vidFielStack(_info.width ,_info.height,YPLANE(_uncompressed),YPLANE(data));
+		data-&gt;copyInfo(_uncompressed);	
+      return 1;
+}
+
+/****/
+//_______________________Stack Fields_______________________
+
+char *AVDMVideoUnStackField::printConf( void )
+{
+        static char buf[50];
+
+        sprintf((char *)buf,&quot; UnStack fields&quot;);
+        return buf;
+}
+
+//_______________________________________________________________
+AVDMVideoUnStackField::AVDMVideoUnStackField(       AVDMGenericVideoStream *in,CONFcouple *setup)
+{
+UNUSED_ARG(setup);
+        _in=in;
+        memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));    
+        _uncompressed=new ADMImage(_info.width,_info.height);   
+
+}
+
+// ___ destructor_____________
+AVDMVideoUnStackField::AVDMVideoUnStackField()
+{
+                delete _uncompressed;
+                _uncompressed=NULL;
+}
+
+/**
+        Interleave frame*2 and frame*2+1
+*/
+uint8_t AVDMVideoUnStackField::getFrameNumberNoAlloc(uint32_t frame,
+                                uint32_t *len,
+                                ADMImage *data,
+                                uint32_t *flags)
+{
+uint32_t ref,ref2;
+ADMImage *ptr1,*ptr2;
+                if(frame&gt;=_info.nb_frames) return 0;
+
+                 if(!_in-&gt;getFrameNumberNoAlloc(frame, len, _uncompressed, flags)) return 0;
+                 
+                  vidFielUnStack(_info.width ,_info.height,YPLANE(_uncompressed),YPLANE(data));
+                data-&gt;copyInfo(_uncompressed);  
+      return 1;
+}

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSeparateField.h (from rev 2489, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSeparateField.h)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwapFields.cpp (from rev 2489, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapFields.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapFields.cpp	2006-10-31 15:59:58 UTC (rev 2489)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwapFields.cpp	2007-01-13 12:08:21 UTC (rev 2720)
@@ -0,0 +1,200 @@
+/***************************************************************************
+                          Swap Fields.cpp  -  description
+                             -------------------
+Swap each line  (shift up for odd, down for even)
+
+
+    begin                : Thu Mar 21 2002
+    copyright            : (C) 2002 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;ADM_assert.h&gt;
+
+#include &quot;config.h&quot;
+#include &quot;fourcc.h&quot;
+#include &quot;avio.hxx&quot;
+#include &quot;config.h&quot;
+#include &quot;avi_vars.h&quot;
+#ifdef HAVE_ENCODER
+
+
+#include &quot;ADM_toolkit/toolkit.hxx&quot;
+#include &quot;ADM_editor/ADM_edit.hxx&quot;
+#include &quot;ADM_video/ADM_genvideo.hxx&quot;
+#include &quot;ADM_video/ADM_vidFieldUtil.h&quot;
+#include &quot;ADM_vidSwapFields.h&quot;
+//static void decimate(uint8_t *src,uint8_t *target, uint32_t linessrc, uint32_t width);
+#include &quot;ADM_filter/video_filters.h&quot;
+
+
+static FILTER_PARAM swapParam={0,{&quot;&quot;}};
+
+
+
+BUILD_CREATE(swapfield_create,AVDMVideoSwapField);
+BUILD_CREATE(keepeven_create,AVDMVideoKeepEven);
+BUILD_CREATE(keepodd_create,AVDMVideoKeepOdd);
+
+SCRIPT_CREATE(swapfield_script,AVDMVideoSwapField,swapParam);
+SCRIPT_CREATE(keepeven_script,AVDMVideoKeepEven,swapParam);
+SCRIPT_CREATE(keepodd_script,AVDMVideoKeepOdd,swapParam);
+
+char *AVDMVideoSwapField::printConf( void )
+{
+ 	static char buf[50];
+
+ 	sprintf((char *)buf,&quot; Swap fields&quot;);
+        return buf;
+}
+char *AVDMVideoKeepEven::printConf( void )
+{
+ 	static char buf[50];
+
+ 	sprintf((char *)buf,&quot; Keep Even Fields&quot;);
+        return buf;
+}char *AVDMVideoKeepOdd::printConf( void )
+{
+ 	static char buf[50];
+
+ 	sprintf((char *)buf,&quot; Keep Odd Fields&quot;);
+        return buf;
+}
+//_______________________________________________________________
+AVDMVideoSwapField::AVDMVideoSwapField(
+									AVDMGenericVideoStream *in,CONFcouple *setup)
+{
+UNUSED_ARG(setup);
+  	_in=in;
+   	memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));
+	_uncompressed=new ADMImage(_info.width,_info.height);
+
+
+}
+//_______________________________________________________________
+AVDMVideoKeepOdd::AVDMVideoKeepOdd(
+									AVDMGenericVideoStream *in,CONFcouple *setup)
+{
+UNUSED_ARG(setup);
+  	_in=in;
+	memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));
+	_uncompressed=new ADMImage(_info.width,_info.height);
+	_info.height&gt;&gt;=1;
+
+}
+// ___ destructor_____________
+AVDMVideoSwapField::~AVDMVideoSwapField()
+{
+ 	delete  _uncompressed;
+	_uncompressed=NULL;
+
+}
+// ___ destructor_____________
+AVDMVideoKeepOdd::~AVDMVideoKeepOdd()
+{
+ 	delete _uncompressed;
+	_uncompressed=NULL;
+
+}
+
+//
+//	Basically ask a uncompressed frame from editor and ask
+//		GUI to decompress it .
+//
+
+uint8_t AVDMVideoSwapField::getFrameNumberNoAlloc(uint32_t frame,
+				uint32_t *len,
+   				ADMImage *data,
+				uint32_t *flags)
+{
+//static Image in,out;
+			if(frame&gt;=_info.nb_frames) return 0;
+
+
+			// read uncompressed frame
+       		if(!_in-&gt;getFrameNumberNoAlloc(frame, len,_uncompressed,flags)) return 0;
+
+		uint32_t w=_info.width;
+		uint32_t h=_info.height;
+		uint32_t page=w*h;
+		uint32_t stride;
+
+		// copy u &amp; v
+		memcpy(UPLANE(data),UPLANE(_uncompressed),page&gt;&gt;2);
+		memcpy(VPLANE(data),VPLANE(_uncompressed),page&gt;&gt;2);
+		
+		uint8_t *odd,*even,*target,*target2;
+
+		even=YPLANE(_uncompressed);
+		odd=even+w;
+		target=YPLANE(data);
+		target2=YPLANE(data)+w;
+		stride=2*w;
+
+		h&gt;&gt;=1;
+		for(;h--;h&gt;0)
+		{
+			memcpy(target,odd,w);
+			memcpy(target2,even,w);
+			target+=stride;
+			target2+=stride;
+			odd+=stride;
+			even+=stride;
+		}
+		data-&gt;copyInfo(_uncompressed);
+
+      return 1;
+}
+
+uint8_t AVDMVideoKeepOdd::getFrameNumberNoAlloc(uint32_t frame,
+				uint32_t *len,
+   				ADMImage *data,
+				uint32_t *flags)
+{
+//static Image in,out;
+			if(!_in-&gt;getFrameNumberNoAlloc(frame, len,_uncompressed,flags)) return 0;
+
+
+		uint32_t w=_info.width;
+		uint32_t h=_info.height;
+
+		vidFieldKeepOdd(  w,  h, YPLANE(_uncompressed),YPLANE(data));
+		data-&gt;copyInfo(_uncompressed);
+
+      return 1;
+}
+
+uint8_t AVDMVideoKeepEven::getFrameNumberNoAlloc(uint32_t frame,
+				uint32_t *len,
+   				ADMImage *data,
+				uint32_t *flags)
+{
+//static Image in,out;
+			if(frame&gt;=_info.nb_frames) return 0;
+
+
+			// read uncompressed frame
+       		if(!_in-&gt;getFrameNumberNoAlloc(frame, len,_uncompressed,flags)) return 0;
+
+		uint32_t w=_info.width;
+		uint32_t h=_info.height;
+
+
+		data-&gt;copyInfo(_uncompressed);
+		vidFieldKeepEven(  w,  h, YPLANE(_uncompressed),YPLANE(data));
+      return 1;
+}
+
+#endif

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwapFields.h (from rev 2489, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapFields.h)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwapSmart.cpp (from rev 2489, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapSmart.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapSmart.cpp	2006-10-31 15:59:58 UTC (rev 2489)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwapSmart.cpp	2007-01-13 12:08:21 UTC (rev 2720)
@@ -0,0 +1,143 @@
+/***************************************************************************
+                          Swap Fields.cpp  -  description
+                             -------------------
+Swap each line  (shift up for odd, down for even)
+
+
+    begin                : Thu Mar 21 2002
+    copyright            : (C) 2002 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;ADM_assert.h&gt;
+
+#include &quot;config.h&quot;
+#include &quot;fourcc.h&quot;
+#include &quot;avio.hxx&quot;
+#include &quot;config.h&quot;
+#include &quot;avi_vars.h&quot;
+#ifdef HAVE_ENCODER
+
+
+#include &quot;ADM_toolkit/toolkit.hxx&quot;
+#include &quot;ADM_editor/ADM_edit.hxx&quot;
+#include &quot;ADM_video/ADM_genvideo.hxx&quot;
+#include &quot;ADM_vidSwapSmart.h&quot;
+#include &quot;ADM_video/ADM_interlaced.h&quot;
+
+#include &quot;ADM_osSupport/ADM_debugID.h&quot;
+#define MODULE_NAME MODULE_FILTER
+#include &quot;ADM_osSupport/ADM_debug.h&quot;
+#include &quot;ADM_filter/video_filters.h&quot;
+
+
+static FILTER_PARAM nullParam={0,{&quot;&quot;}};
+
+
+SCRIPT_CREATE(swapsmart_script,AVDMVideoSwapSmart,nullParam);
+BUILD_CREATE(swapsmart_create,AVDMVideoSwapSmart);
+
+
+char *AVDMVideoSwapSmart::printConf( void )
+{
+ 	static char buf[50];
+
+ 	sprintf((char *)buf,&quot; Smart Swap fields&quot;);
+        return buf;
+}
+
+//_______________________________________________________________
+AVDMVideoSwapSmart::AVDMVideoSwapSmart(
+									AVDMGenericVideoStream *in,CONFcouple *setup)
+{
+UNUSED_ARG(setup);
+  	_in=in;
+   	memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));	
+	_uncompressed=new ADMImage(_info.width,_info.height);
+
+
+
+}
+// ___ destructor_____________
+AVDMVideoSwapSmart::~AVDMVideoSwapSmart()
+{
+ 	delete  _uncompressed;
+	_uncompressed=NULL;
+
+}
+
+//
+//	Basically ask a uncompressed frame from editor and ask
+//		GUI to decompress it .
+//
+
+uint8_t AVDMVideoSwapSmart::getFrameNumberNoAlloc(uint32_t frame,
+				uint32_t *len,
+   				ADMImage *data,
+				uint32_t *flags)
+{
+//static Image in,out;
+			if(frame&gt;=_info.nb_frames) return 0;
+
+
+			// read uncompressed frame
+       		if(!_in-&gt;getFrameNumberNoAlloc(frame, len,data,flags)) return 0;
+
+		uint32_t w=_info.width;
+		uint32_t h=_info.height;
+		uint32_t page=w*h;
+		uint32_t stride;
+
+
+
+		uint8_t *odd,*even,*target,*target2;
+
+		even=YPLANE(data);
+		odd=even+w;
+		target=YPLANE(_uncompressed);
+		target2=_uncompressed-&gt;data+w;
+		stride=2*w;
+
+		h&gt;&gt;=1;
+		for(;h--;h&gt;0)
+		{
+			memcpy(target,odd,w);
+			memcpy(target2,even,w);
+			target+=stride;
+			target2+=stride;
+			odd+=stride;
+			even+=stride;
+		}
+		// now we have straight and swapped
+		// which one is better ?
+		uint32_t s,m;
+		s=      ADMVideo_interlaceCount( YPLANE(data),_info.width, _info.height);
+		m=      ADMVideo_interlaceCount( YPLANE(_uncompressed),_info.width, _info.height);
+
+		aprintf(&quot; %lu straight vs %lu swapped =&gt; %s\n&quot;,s,m,(s*2&gt;m*3?&quot;swapped&quot;:&quot;straight&quot;));
+
+		// if swapped &lt;= 66 % straight
+
+		if(s*2&gt;m*3)  // swapped is better
+		{
+			memcpy(YPLANE(data),YPLANE(_uncompressed),page);
+
+		}
+
+      return 1;
+}
+
+
+#endif

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSwapSmart.h (from rev 2489, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSwapSmart.h)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-01-13 11:40:52 UTC (rev 2719)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-01-13 12:08:21 UTC (rev 2720)
@@ -7,10 +7,16 @@
 #INCLUDES = $(all_includes) 
 
 libADM_videoFilter_a_SOURCES =  \
+ ADM_vidPalShift.cpp \
+ ADM_vidReverse.cpp \
+ ADM_vidSeparateField.cpp \
+ ADM_vidSwapSmart.cpp \
+ ADM_vidSwapFields.cpp \
+ ADM_vidPalSmart.cpp \
  ADM_vidUVSwap.cpp \
  ADM_vidStabilize.cpp \
  ADM_vidDropOut.cpp \
- ADM_vidVlad.cpp \ 
+ ADM_vidVlad.cpp \
  ADM_vidWhirl.cpp \
  ADM_vidPulldown.cpp \
  ADM_vidFlipV.cpp \

Modified: branches/avidemux_2.4_branch/avidemux/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/Makefile.am	2007-01-13 11:40:52 UTC (rev 2719)
+++ branches/avidemux_2.4_branch/avidemux/Makefile.am	2007-01-13 12:08:21 UTC (rev 2720)
@@ -80,8 +80,8 @@
 ./ADM_audiocodec/libADM_audiocodec.a			\
 ./ADM_audio/libADM_audio.a				\
 ./ADM_script/libADM_script.a				\
+./ADM_videoFilter/libADM_videoFilter.a			\
 ./ADM_video/libADM_video.a				\
-./ADM_videoFilter/libADM_videoFilter.a			\
 ./ADM_colorspace/libADM_colorspace.a			\
 ./ADM_audiodevice/libADM_audiodevice.a			\
 ./ADM_ocr/libADM_ocr.a					\


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000047.html">[Avidemux-svn-commit] r2719 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_filters
</A></li>
	<LI>Next message: <A HREF="000049.html">[Avidemux-svn-commit] r2721 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog ADM_video ADM_videoFilter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48">[ date ]</a>
              <a href="thread.html#48">[ thread ]</a>
              <a href="subject.html#48">[ subject ]</a>
              <a href="author.html#48">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
