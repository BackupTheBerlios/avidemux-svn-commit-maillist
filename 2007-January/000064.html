<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r2737 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-January/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r2737%20-%0A%09branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters&In-Reply-To=%3C200701150746.l0F7kvsg004475%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000063.html">
   <LINK REL="Next"  HREF="000065.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r2737 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r2737%20-%0A%09branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters&In-Reply-To=%3C200701150746.l0F7kvsg004475%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r2737 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters">mean at mail.berlios.de
       </A><BR>
    <I>Mon Jan 15 08:46:57 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000063.html">[Avidemux-svn-commit] r2735 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4:	ADM_dialogFactory ADM_filters
</A></li>
        <LI>Next message: <A HREF="000065.html">[Avidemux-svn-commit] r2738 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4:	ADM_filters ADM_filters/icons ADM_gui
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64">[ date ]</a>
              <a href="thread.html#64">[ thread ]</a>
              <a href="subject.html#64">[ subject ]</a>
              <a href="author.html#64">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2007-01-15 08:46:56 +0100 (Mon, 15 Jan 2007)
New Revision: 2737

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/mainfilter.ui
Log:
improved QT4 filter dialog

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp	2007-01-14 22:38:57 UTC (rev 2736)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/Q_mainfilter.cpp	2007-01-15 07:46:56 UTC (rev 2737)
@@ -1,8 +1,26 @@
-//
-/*
- * DO NOT EDIT THIS FILE - it is generated by Glade.
- */
+/***************************************************************************
+    copyright            : (C) 2007 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+    
+    * We hide some info the the &quot;type&quot;
+    * I.e.
+    0--1000 : QT4 internal
+    2000-3000: Filters
+    3000-4000  External Filter
+    8000-9000  Active Filter
+    
+    
+ ***************************************************************************/
 
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
 #include &quot;config.h&quot;
 #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
@@ -36,6 +54,10 @@
 static int filterSize[NB_TREE];
 static int max=0;
 /******************************************************/
+#define ALL_FILTER_BASE       1000
+#define EXTERNAL_FILTER_BASE  2000
+#define ACTIVE_FILTER_BASE    3000
+/******************************************************/
 extern FILTER_ENTRY allfilters[MAX_FILTER];
 extern uint32_t nb_video_filter;
 extern FILTER videofilters[MAX_FILTER];
@@ -58,15 +80,17 @@
      QListWidget      *allList[NB_TREE];
      
      
-     QStringList      activeList;
-     QStringListModel activeModel;
+     QListWidget      *activeList;
      
      
+     
  public slots:
         void add(bool b);
         void remove(bool b);
         void configure(bool b);
         void partial(bool b);
+        void activeDoubleClick( QListWidgetItem  *item);
+        void allDoubleClick( QListWidgetItem  *item);
  private slots:
  private:
 };
@@ -82,18 +106,25 @@
   ADM_assert(tab&gt;=0 &amp;&amp; tab &lt; NB_TREE);
   /* Now that we have the tab, get the selection */
    QListWidgetItem *item=allList[tab]-&gt;currentItem();
+   VF_FILTERS tag;
    if(item)
    {
-     int itag=item-&gt;type()-1000;
+     int itag=item-&gt;type();
+     if(itag&gt;=ALL_FILTER_BASE &amp;&amp; itag &lt; EXTERNAL_FILTER_BASE)
+     {
+       tag=allfilters[itag-ALL_FILTER_BASE].tag;
+       
+     }else
+     {
+        ADM_assert(0); 
+     }
       printf(&quot;Tag : %d\n&quot;,itag);
-      VF_FILTERS tag=(VF_FILTERS) itag;
+      
       // Create our filter...
       
        CONFcouple *coup;
-        videofilters[nb_active_filter].filter =
-            filterCreateFromTag (tag, NULL, videofilters[nb_active_filter - 1].filter);
-        if(!videofilters[nb_active_filter].filter-&gt;
-                    configure (videofilters[nb_active_filter - 1].filter))
+        videofilters[nb_active_filter].filter = filterCreateFromTag (tag, NULL, videofilters[nb_active_filter - 1].filter);
+        if(!videofilters[nb_active_filter].filter-&gt;    configure (videofilters[nb_active_filter - 1].filter))
         {
             delete videofilters[nb_active_filter].filter;
             return;
@@ -106,20 +137,99 @@
    }
 }
 /**
-
+        \fn     remove( bool b)
+        \brief  Remove selected filters from the active window list
 */
 void filtermainWindow::remove( bool b)
 {
-  printf(&quot;remove\n&quot;); 
+   /* Get selection if any */
+  /* Now that we have the tab, get the selection */
+   QListWidgetItem *item=activeList-&gt;currentItem();
+   if(!item)
+   {
+      printf(&quot;No selection\n&quot;);
+      return;
+   }
+    
+     int itag=item-&gt;type();
+     ADM_assert(itag&gt;ACTIVE_FILTER_BASE);
+     itag-=ACTIVE_FILTER_BASE;
+     /* Filter 0 is the decoder ...*/
+      printf(&quot;Rank : %d\n&quot;,itag); 
+     ADM_assert(itag);
+     /**/
+      if (videofilters[itag].conf)
+            {
+                    delete videofilters[itag].conf;
+                    videofilters[itag].conf = NULL;
+            }
+        // recreate derivated filters
+        for (uint32_t i = itag ; i &lt; nb_active_filter-1; i++)
+        {
+                    delete videofilters[i ].filter;
+                    videofilters[i ].filter = filterCreateFromTag(videofilters[i+1].tag,
+                                                    videofilters[i+1].conf,
+                                                    videofilters[i - 1].filter);
+                    videofilters[i ].conf = videofilters[i+1].conf;
+                    videofilters[i ].tag = videofilters[i+1].tag;
+        }
+        /* Delete last filter which is now at last filter -1 */
+            delete videofilters[nb_active_filter - 1].filter;
+            videofilters[nb_active_filter - 1].filter = NULL;
+            nb_active_filter--;
+            buildActiveFilterList ();
+  
 }
 /**
-
+        \fn     configure( bool b)
+        \brief  Configure the selected active filter
 */
 void filtermainWindow::configure( bool b)
 {
-  printf(&quot;configure\n&quot;); 
+   /* Get selection if any */
+  /* Now that we have the tab, get the selection */
+   QListWidgetItem *item=activeList-&gt;currentItem();
+   if(!item)
+   {
+      printf(&quot;No selection\n&quot;);
+      return;
+   }
+    
+     int itag=item-&gt;type();
+     ADM_assert(itag&gt;ACTIVE_FILTER_BASE);
+     itag-=ACTIVE_FILTER_BASE;
+     /* Filter 0 is the decoder ...*/
+      printf(&quot;Rank : %d\n&quot;,itag); 
+     ADM_assert(itag);
+     /**/
+     
+        if(!videofilters[itag].filter-&gt;configure (videofilters[itag - 1].filter)) return;
+        /* Recreate chain if needed , config has changed */
+        CONFcouple *couple;
+        videofilters[itag].filter-&gt;getCoupledConf (&amp;couple);
+        videofilters[itag].conf = couple;
+        getFirstVideoFilter ();
+        buildActiveFilterList ();
 }
 /**
+        \fn     filtermainWindow::activeDoubleClick( QListWidgetItem  *item)
+        \brief  One of the active window has been double clicked, call configure
+*/
+void filtermainWindow::activeDoubleClick( QListWidgetItem  *item)
+{
+  
+    configure(0);
+}
+/**
+        \fn     filtermainWindow::activeDoubleClick( QListWidgetItem  *item)
+        \brief  One of the active window has been double clicked, call configure
+*/
+void filtermainWindow::allDoubleClick( QListWidgetItem  *item)
+{
+  
+    add(0);
+}
+/**
 
 */
 void filtermainWindow::partial( bool b)
@@ -144,11 +254,14 @@
           QString str; //=&quot;&lt;b&gt;&quot;;
           str+=allfilters[i].name;
           str+=&quot;:&quot;;//&quot;&lt;/b&gt;&lt;br&gt;&quot;;
-          str+=allfilters[i].description;
+//           str+=&quot;&lt;b&gt;&quot;;
+          str+=allfilters[i].description; // Mem leak ?
+//           str+=&quot;&lt;/b&gt;&quot;;
           max++;
+          
+          QListWidgetItem *item=new QListWidgetItem(str,allList[current_tree],ALL_FILTER_BASE+i);
+          allList[current_tree]-&gt;addItem(item);
           current_raw++;
-          QListWidgetItem *item=new QListWidgetItem(str,allList[current_tree],1000+allfilters[i].tag);
-          allList[current_tree]-&gt;addItem(item);
           
         }else 
         {
@@ -173,7 +286,7 @@
 void filtermainWindow::buildActiveFilterList(void)
 {
   VF_FILTERS fil;
-  activeList.clear();
+  activeList-&gt;clear();
   for (uint32_t i = 1; i &lt; nb_active_filter; i++)
     {
                 QString str;
@@ -181,9 +294,10 @@
 
                  str =filterGetNameFromTag(fil);
                  str+= videofilters[i].filter-&gt;printConf ();
-                 activeList+=str;
+                 QListWidgetItem *item=new QListWidgetItem(str,activeList,ACTIVE_FILTER_BASE+i);
+                 activeList-&gt;addItem(item);
     }
-    activeModel.setStringList(activeList);
+    
 
 }
   /**
@@ -192,7 +306,7 @@
  {
       ui.setupUi(this);
       
-#define ASSOCIATE(x,y)   allList[x]=ui.listWidget##y
+#define ASSOCIATE(x,y)   allList[x]=ui.listWidget##y;
       ASSOCIATE(0,Transform);
       ASSOCIATE(1,Interlacing);
       ASSOCIATE(2,Colors);
@@ -201,13 +315,18 @@
       ASSOCIATE(5,Subtitles);
       ASSOCIATE(6,Misc);
       
+      activeList=ui.listWidgetActive;
       
       buildAvailableFilterList();
       buildActiveFilterList();
       
       
       
-    ui.listViewActive-&gt;setModel(&amp;activeModel);
+    connect(activeList,SIGNAL(itemDoubleClicked(QListWidgetItem *)),this,SLOT(activeDoubleClick(QListWidgetItem *)));
+    for(int i=0;i&lt;NB_TREE;i++)
+    {
+      connect(allList[i],SIGNAL(itemDoubleClicked(QListWidgetItem *)),this,SLOT(allDoubleClick(QListWidgetItem *)));
+    }
 
     connect((ui.toolButtonConfigure),SIGNAL(clicked(bool)),this,SLOT(configure(bool)));
     connect((ui.toolButtonAdd),SIGNAL(clicked(bool)),this,SLOT(add(bool)));

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/mainfilter.ui
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/mainfilter.ui	2007-01-14 22:38:57 UTC (rev 2736)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_filters/mainfilter.ui	2007-01-15 07:46:56 UTC (rev 2737)
@@ -290,7 +290,7 @@
     &lt;/widget&gt;
    &lt;/item&gt;
    &lt;item row=&quot;1&quot; column=&quot;1&quot; &gt;
-    &lt;widget class=&quot;QListView&quot; name=&quot;listViewActive&quot; /&gt;
+    &lt;widget class=&quot;QListWidget&quot; name=&quot;listWidgetActive&quot; /&gt;
    &lt;/item&gt;
   &lt;/layout&gt;
  &lt;/widget&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000063.html">[Avidemux-svn-commit] r2735 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4:	ADM_dialogFactory ADM_filters
</A></li>
	<LI>Next message: <A HREF="000065.html">[Avidemux-svn-commit] r2738 - in	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4:	ADM_filters ADM_filters/icons ADM_gui
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64">[ date ]</a>
              <a href="thread.html#64">[ thread ]</a>
              <a href="subject.html#64">[ subject ]</a>
              <a href="author.html#64">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
