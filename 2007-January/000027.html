<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r2699 - in	branches/avidemux_2.4_branch/avidemux:	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-January/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r2699%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialog%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_commonUI%20ADM_video%20ADM_videoFilter&In-Reply-To=%3C200701101952.l0AJqctV011040%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000026.html">
   <LINK REL="Next"  HREF="000028.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r2699 - in	branches/avidemux_2.4_branch/avidemux:	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r2699%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialog%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_commonUI%20ADM_video%20ADM_videoFilter&In-Reply-To=%3C200701101952.l0AJqctV011040%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r2699 - in	branches/avidemux_2.4_branch/avidemux:	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter">mean at mail.berlios.de
       </A><BR>
    <I>Wed Jan 10 20:52:38 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000026.html">[Avidemux-svn-commit] r2698 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory
</A></li>
        <LI>Next message: <A HREF="000028.html">[Avidemux-svn-commit] r2700 -	branches/avidemux_2.4_branch/avidemux/ADM_video
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27">[ date ]</a>
              <a href="thread.html#27">[ thread ]</a>
              <a href="subject.html#27">[ subject ]</a>
              <a href="author.html#27">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2007-01-10 20:52:36 +0100 (Wed, 10 Jan 2007)
New Revision: 2699

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_menu.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidFade.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidFade_param.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidResampleFPS.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSoften.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSoften.h
Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_4entries.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audiodevice.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_fade.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_guiMedianBig.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidFade.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidFade_param.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidResampleFPS.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSoften.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSoften.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_float.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_toggle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
Log:
more use of dialogFactory

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_4entries.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_4entries.cpp	2007-01-09 19:59:26 UTC (rev 2698)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_4entries.cpp	2007-01-10 19:52:36 UTC (rev 2699)
@@ -1,188 +0,0 @@
-
-#include &quot;config.h&quot;
-
-#include &lt;sys/types.h&gt;
-#include &lt;sys/stat.h&gt;
-#include &lt;string.h&gt;
-#include &lt;stdio.h&gt;
-
-#include &quot;default.h&quot;
-#include &quot;ADM_toolkit_gtk/toolkit_gtk_include.h&quot;
-#include &quot;ADM_toolkit_gtk/ADM_gladeSupport.h&quot;
-#include &quot;ADM_toolkit_gtk/toolkit_gtk.h&quot;
-
-static GtkWidget	*create_dialog1 (void);
-
-uint8_t DIA_4entries(char *title,uint32_t *left,uint32_t *right,uint32_t *top,uint32_t *bottom)
-{
-	GtkWidget *dialog;
-
-	char str[100];
-	uint8_t ret=0;
-
-	gint r;
-
-#define FILL_ENTRY(widget_name,value) 		{sprintf(str,&quot;%ld&quot;,*value);r=-1;   \
-gtk_editable_delete_text(GTK_EDITABLE(lookup_widget(dialog,#widget_name)), 0,-1);\
-gtk_editable_insert_text(GTK_EDITABLE(lookup_widget(dialog,#widget_name)), str, strlen(str), &amp;r);}
-
-	dialog=create_dialog1();
-//	gtk_transient(dialog);
-        gtk_register_dialog(dialog);
-  	gtk_window_set_title (GTK_WINDOW (dialog), title);
-	FILL_ENTRY(entryLeft,left);
-	FILL_ENTRY(entryRight,right);
-	FILL_ENTRY(entryTop,top);
-	FILL_ENTRY(entryBottom,bottom);
-
-
-	ret=0;
-	if(gtk_dialog_run(GTK_DIALOG(dialog))==GTK_RESPONSE_OK)
-	{
-
-			*left=gtk_read_entry(WID(entryLeft));
-			*right=gtk_read_entry(WID(entryRight));
-			*top=gtk_read_entry(WID(entryTop));
-			*bottom=gtk_read_entry(WID(entryBottom));
-			ret=1;
-	}
-        gtk_unregister_dialog(dialog);
-	gtk_widget_destroy(dialog);
-
-	return ret;
-
-}
-
-
-GtkWidget	*create_dialog1 (void)
-{
-  GtkWidget *dialog1;
-  GtkWidget *dialog_vbox1;
-  GtkWidget *table1;
-  GtkWidget *hbox1;
-  GtkWidget *label1;
-  GtkWidget *entryLeft;
-  GtkWidget *hbox2;
-  GtkWidget *label2;
-  GtkWidget *entryRight;
-  GtkWidget *hbox3;
-  GtkWidget *label3;
-  GtkWidget *entryTop;
-  GtkWidget *hbox4;
-  GtkWidget *label4;
-  GtkWidget *entryBottom;
-  GtkWidget *dialog_action_area1;
-  GtkWidget *cancelbutton1;
-  GtkWidget *okbutton1;
-
-  dialog1 = gtk_dialog_new ();
-  gtk_window_set_title (GTK_WINDOW (dialog1), _(&quot;dialog1&quot;));
-
-  dialog_vbox1 = GTK_DIALOG (dialog1)-&gt;vbox;
-  gtk_widget_show (dialog_vbox1);
-
-  table1 = gtk_table_new (2, 2, FALSE);
-  gtk_widget_show (table1);
-  gtk_box_pack_start (GTK_BOX (dialog_vbox1), table1, TRUE, TRUE, 0);
-
-  hbox1 = gtk_hbox_new (FALSE, 0);
-  gtk_widget_show (hbox1);
-  gtk_table_attach (GTK_TABLE (table1), hbox1, 0, 1, 0, 1,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL), 0, 0);
-
-  label1 = gtk_label_new (_(&quot;Left:&quot;));
-  gtk_widget_show (label1);
-  gtk_box_pack_start (GTK_BOX (hbox1), label1, TRUE, TRUE, 0);
-  gtk_label_set_justify (GTK_LABEL (label1), GTK_JUSTIFY_LEFT);
-
-  entryLeft = gtk_entry_new ();
-  gtk_widget_show (entryLeft);
-  gtk_box_pack_start (GTK_BOX (hbox1), entryLeft, TRUE, TRUE, 0);
-  gtk_widget_set_size_request (entryLeft, 60, -1);
-
-  hbox2 = gtk_hbox_new (FALSE, 0);
-  gtk_widget_show (hbox2);
-  gtk_table_attach (GTK_TABLE (table1), hbox2, 1, 2, 0, 1,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (GTK_FILL), 0, 0);
-
-  label2 = gtk_label_new (_(&quot;Right:&quot;));
-  gtk_widget_show (label2);
-  gtk_box_pack_start (GTK_BOX (hbox2), label2, TRUE, TRUE, 0);
-  gtk_label_set_justify (GTK_LABEL (label2), GTK_JUSTIFY_LEFT);
-
-  entryRight = gtk_entry_new ();
-  gtk_widget_show (entryRight);
-  gtk_box_pack_start (GTK_BOX (hbox2), entryRight, TRUE, TRUE, 0);
-  gtk_widget_set_size_request (entryRight, 60, -1);
-
-  hbox3 = gtk_hbox_new (FALSE, 0);
-  gtk_widget_show (hbox3);
-  gtk_table_attach (GTK_TABLE (table1), hbox3, 0, 1, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL), 0, 0);
-
-  label3 = gtk_label_new (_(&quot;Top:&quot;));
-  gtk_widget_show (label3);
-  gtk_box_pack_start (GTK_BOX (hbox3), label3, TRUE, TRUE, 0);
-  gtk_label_set_justify (GTK_LABEL (label3), GTK_JUSTIFY_LEFT);
-
-  entryTop = gtk_entry_new ();
-  gtk_widget_show (entryTop);
-  gtk_box_pack_start (GTK_BOX (hbox3), entryTop, TRUE, TRUE, 0);
-  gtk_widget_set_size_request (entryTop, 60, -1);
-
-  hbox4 = gtk_hbox_new (FALSE, 0);
-  gtk_widget_show (hbox4);
-  gtk_table_attach (GTK_TABLE (table1), hbox4, 1, 2, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (GTK_FILL), 0, 0);
-
-  label4 = gtk_label_new (_(&quot;Bottom:&quot;));
-  gtk_widget_show (label4);
-  gtk_box_pack_start (GTK_BOX (hbox4), label4, TRUE, TRUE, 0);
-  gtk_label_set_justify (GTK_LABEL (label4), GTK_JUSTIFY_LEFT);
-
-  entryBottom = gtk_entry_new ();
-  gtk_widget_show (entryBottom);
-  gtk_box_pack_start (GTK_BOX (hbox4), entryBottom, TRUE, TRUE, 0);
-  gtk_widget_set_size_request (entryBottom, 60, -1);
-
-  dialog_action_area1 = GTK_DIALOG (dialog1)-&gt;action_area;
-  gtk_widget_show (dialog_action_area1);
-  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialog_action_area1), GTK_BUTTONBOX_END);
-
-  cancelbutton1 = gtk_button_new_from_stock (&quot;gtk-cancel&quot;);
-  gtk_widget_show (cancelbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), cancelbutton1, GTK_RESPONSE_CANCEL);
-  GTK_WIDGET_SET_FLAGS (cancelbutton1, GTK_CAN_DEFAULT);
-
-  okbutton1 = gtk_button_new_from_stock (&quot;gtk-ok&quot;);
-  gtk_widget_show (okbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), okbutton1, GTK_RESPONSE_OK);
-  GTK_WIDGET_SET_FLAGS (okbutton1, GTK_CAN_DEFAULT);
-
-  /* Store pointers to all widgets, for use by lookup_widget(). */
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog1, &quot;dialog1&quot;);
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_vbox1, &quot;dialog_vbox1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, table1, &quot;table1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, hbox1, &quot;hbox1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label1, &quot;label1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, entryLeft, &quot;entryLeft&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, hbox2, &quot;hbox2&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label2, &quot;label2&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, entryRight, &quot;entryRight&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, hbox3, &quot;hbox3&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label3, &quot;label3&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, entryTop, &quot;entryTop&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, hbox4, &quot;hbox4&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label4, &quot;label4&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, entryBottom, &quot;entryBottom&quot;);
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_action_area1, &quot;dialog_action_area1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, cancelbutton1, &quot;cancelbutton1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, okbutton1, &quot;okbutton1&quot;);
-
-  return dialog1;
-}
-

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audiodevice.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audiodevice.cpp	2007-01-09 19:59:26 UTC (rev 2698)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_audiodevice.cpp	2007-01-10 19:52:36 UTC (rev 2699)
@@ -1 +0,0 @@
-// Obsoleted by our UI manager

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_fade.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_fade.cpp	2007-01-09 19:59:26 UTC (rev 2698)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_fade.cpp	2007-01-10 19:52:36 UTC (rev 2699)
@@ -1,224 +0,0 @@
-
-//
-// C++ Implementation: DIA_Fade
-//
-// Description: 
-//
-//
-// Author: mean &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>&gt;, (C) 2002-206
-//
-// Copyright: See COPYING file that comes with this distribution
-//
-//
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-
-#include &lt;config.h&gt;
-
-#include &lt;sys/types.h&gt;
-#include &lt;sys/stat.h&gt;
-
-
-#include &lt;gdk/gdkkeysyms.h&gt;
-#include &lt;gtk/gtk.h&gt;
-
-
-#include &lt;gdk/gdkkeysyms.h&gt;
-#include &lt;gtk/gtk.h&gt;
-# include &lt;math.h&gt;
-
-#include &quot;default.h&quot;
-#include &quot;ADM_toolkit_gtk/ADM_gladeSupport.h&quot;
-#include &quot;ADM_toolkit_gtk/toolkit_gtk.h&quot;
-#include &quot;ADM_toolkit_gtk/toolkit_gtk_include.h&quot;
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-
-#include &quot;ADM_video/ADM_vidFade_param.h&quot;
-
-
-#define SPIN_GET(x,y) {param-&gt;y= gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(x))) ;}
-#define SPIN_SET(x,y)  {gtk_spin_button_set_value(GTK_SPIN_BUTTON(WID(x)),(gfloat)param-&gt;y) ;}
-#define SGET(x) gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(WID(x))) 
-
-#define CHECK_GET(x,y) {param-&gt;y=gtk_toggle_button_get_active( GTK_TOGGLE_BUTTON(WID(x)));}
-#define CHECK_SET(x,y) {gtk_toggle_button_set_active( GTK_TOGGLE_BUTTON(WID(x)),param-&gt;y);}	
-
-static GtkWidget        *create_dialog1 (void);
-uint8_t DIA_fade(VIDFADE_PARAM *param)
-{
-  
-  GtkWidget *dialog;
-  int ret=0,done=0;
-  dialog=create_dialog1();
-        
-    // Update
-  SPIN_SET(spinbuttonStart,startFade);
-  SPIN_SET(spinbuttonEnd,endFade);
-  gtk_combo_box_set_active(GTK_COMBO_BOX(WID(comboboxinOut)),param-&gt;inOut);
-  CHECK_SET(checkbuttonBlack,toBlack);
-    // Run
-  gtk_register_dialog(dialog);
-  while(!done)
-  {
-    switch(gtk_dialog_run(GTK_DIALOG(dialog)))
-    {
-      case GTK_RESPONSE_OK:
-      {
-        uint32_t s,e;
-        s=SGET(spinbuttonStart);
-        e=SGET(spinbuttonEnd);
-        if(e&lt;s)
-        {
-          GUI_Error_HIG(&quot;Bad parameters&quot;,&quot;The end frame must be after the start frame !&quot;); 
-        }
-        else
-        {
-          param-&gt;startFade=s;
-          param-&gt;endFade=e;
-          param-&gt;inOut=gtk_combo_box_get_active(GTK_COMBO_BOX(WID(comboboxinOut)));
-          CHECK_GET(checkbuttonBlack,toBlack);
-          done=1;
-          ret=1;
-        }
-      }
-      break;
-      default:
-        done=1;
-        break;
-                
-    }
-  }
-  gtk_unregister_dialog(dialog);
-  gtk_widget_destroy(dialog);
-  return ret;
-}
-
-GtkWidget*
-create_dialog1 (void)
-{
-  GtkWidget *dialog1;
-  GtkWidget *dialog_vbox1;
-  GtkWidget *table1;
-  GtkWidget *label1;
-  GtkWidget *comboboxinOut;
-  GtkWidget *label2;
-  GtkWidget *label3;
-  GtkObject *spinbuttonStart_adj;
-  GtkWidget *spinbuttonStart;
-  GtkObject *spinbuttonEnd_adj;
-  GtkWidget *spinbuttonEnd;
-  GtkWidget *label4;
-  GtkWidget *checkbuttonBlack;
-  GtkWidget *dialog_action_area1;
-  GtkWidget *cancelbutton1;
-  GtkWidget *okbutton1;
-
-  dialog1 = gtk_dialog_new ();
-  gtk_window_set_title (GTK_WINDOW (dialog1), _(&quot;Fade Filter&quot;));
-  gtk_window_set_type_hint (GTK_WINDOW (dialog1), GDK_WINDOW_TYPE_HINT_DIALOG);
-
-  dialog_vbox1 = GTK_DIALOG (dialog1)-&gt;vbox;
-  gtk_widget_show (dialog_vbox1);
-
-  table1 = gtk_table_new (4, 2, FALSE);
-  gtk_widget_show (table1);
-  gtk_box_pack_start (GTK_BOX (dialog_vbox1), table1, TRUE, TRUE, 0);
-
-  label1 = gtk_label_new (_(&quot;Fade Type&quot;));
-  gtk_widget_show (label1);
-  gtk_table_attach (GTK_TABLE (table1), label1, 0, 1, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label1), 0, 0.5);
-
-  comboboxinOut = gtk_combo_box_new_text ();
-  gtk_widget_show (comboboxinOut);
-  gtk_table_attach (GTK_TABLE (table1), comboboxinOut, 1, 2, 0, 1,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (GTK_FILL), 0, 0);
-  gtk_combo_box_append_text (GTK_COMBO_BOX (comboboxinOut), _(&quot;Out&quot;));
-  gtk_combo_box_append_text (GTK_COMBO_BOX (comboboxinOut), _(&quot;In&quot;));
-
-  label2 = gtk_label_new (_(&quot;Start Frame&quot;));
-  gtk_widget_show (label2);
-  gtk_table_attach (GTK_TABLE (table1), label2, 0, 1, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label2), 0, 0.5);
-
-  label3 = gtk_label_new (_(&quot;End Frame&quot;));
-  gtk_widget_show (label3);
-  gtk_table_attach (GTK_TABLE (table1), label3, 0, 1, 2, 3,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label3), 0, 0.5);
-
-  spinbuttonStart_adj = gtk_adjustment_new (1, 0, 1000000, 1, 10, 10);
-  spinbuttonStart = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonStart_adj), 1, 0);
-  gtk_widget_show (spinbuttonStart);
-  gtk_table_attach (GTK_TABLE (table1), spinbuttonStart, 1, 2, 1, 2,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonStart), TRUE);
-
-  spinbuttonEnd_adj = gtk_adjustment_new (1, 0, 1000000, 1, 10, 10);
-  spinbuttonEnd = gtk_spin_button_new (GTK_ADJUSTMENT (spinbuttonEnd_adj), 1, 0);
-  gtk_widget_show (spinbuttonEnd);
-  gtk_table_attach (GTK_TABLE (table1), spinbuttonEnd, 1, 2, 2, 3,
-                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_spin_button_set_numeric (GTK_SPIN_BUTTON (spinbuttonEnd), TRUE);
-
-  label4 = gtk_label_new (_(&quot;Fade to black &quot;));
-  gtk_widget_show (label4);
-  gtk_table_attach (GTK_TABLE (table1), label4, 0, 1, 3, 4,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label4), 0, 0.5);
-
-  checkbuttonBlack = gtk_check_button_new_with_mnemonic (&quot;&quot;);
-  gtk_widget_show (checkbuttonBlack);
-  gtk_table_attach (GTK_TABLE (table1), checkbuttonBlack, 1, 2, 3, 4,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-
-  dialog_action_area1 = GTK_DIALOG (dialog1)-&gt;action_area;
-  gtk_widget_show (dialog_action_area1);
-  gtk_button_box_set_layout (GTK_BUTTON_BOX (dialog_action_area1), GTK_BUTTONBOX_END);
-
-  cancelbutton1 = gtk_button_new_from_stock (&quot;gtk-cancel&quot;);
-  gtk_widget_show (cancelbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), cancelbutton1, GTK_RESPONSE_CANCEL);
-  GTK_WIDGET_SET_FLAGS (cancelbutton1, GTK_CAN_DEFAULT);
-
-  okbutton1 = gtk_button_new_from_stock (&quot;gtk-ok&quot;);
-  gtk_widget_show (okbutton1);
-  gtk_dialog_add_action_widget (GTK_DIALOG (dialog1), okbutton1, GTK_RESPONSE_OK);
-  GTK_WIDGET_SET_FLAGS (okbutton1, GTK_CAN_DEFAULT);
-
-  /* Store pointers to all widgets, for use by lookup_widget(). */
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog1, &quot;dialog1&quot;);
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_vbox1, &quot;dialog_vbox1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, table1, &quot;table1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label1, &quot;label1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, comboboxinOut, &quot;comboboxinOut&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label2, &quot;label2&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label3, &quot;label3&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonStart, &quot;spinbuttonStart&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, spinbuttonEnd, &quot;spinbuttonEnd&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, label4, &quot;label4&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, checkbuttonBlack, &quot;checkbuttonBlack&quot;);
-  GLADE_HOOKUP_OBJECT_NO_REF (dialog1, dialog_action_area1, &quot;dialog_action_area1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, cancelbutton1, &quot;cancelbutton1&quot;);
-  GLADE_HOOKUP_OBJECT (dialog1, okbutton1, &quot;okbutton1&quot;);
-
-  return dialog1;
-}
-

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am	2007-01-09 19:59:26 UTC (rev 2698)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/Makefile.am	2007-01-10 19:52:36 UTC (rev 2699)
@@ -10,12 +10,12 @@
 
 libADM_dialog_a_SOURCES = DIA_audio.cpp DIA_vcodec.cpp DIA_acodec.cpp \
 	DIA_audiocodec.cpp DIA_properties.cpp DIA_mjpeg.cpp DIA_about.cpp DIA_recent.cpp \
-	DIA_indexer.cpp DIA_resize.cpp DIA_4entries.cpp DIA_dnr.cpp DIA_working.cpp \
+	DIA_indexer.cpp DIA_resize.cpp DIA_dnr.cpp DIA_working.cpp \
 	DIA_working.h DIA_busy.cpp DIA_busy.h DIA_exLame.cpp DIA_pipe.cpp DIA_mpeg2opt.cpp \
 	DIA_d3d.cpp DIA_postproc.cpp DIA_enter.cpp DIA_enter.h DIA_xvcd.cpp DIA_muxer.cpp \
 	DIA_xvid.cpp DIA_crop.cpp DIA_color.cpp DIA_encoding.cpp DIA_SVCD.cpp DIA_prefs.cpp \
 	DIA_requant.cpp DIA_xvid4.cpp DIA_lavcodec.cpp DIA_kerneldeint.cpp \
-	DIA_audiodevice.cpp DIA_dectel.cpp DIA_decimate.cpp DIA_pause.cpp \
+	DIA_dectel.cpp DIA_decimate.cpp DIA_pause.cpp \
 	DIA_DVDff.cpp DIA_lavdecoder.cpp DIA_lame.cpp DIA_calculator.cpp DIA_equalizer.cpp \
 	DIA_vobsub.cpp DIA_x264.cpp DIA_ocr.cpp DIA_lavpp_deint.cpp DIA_hue.cpp DIA_eq2.cpp \
 	DIA_dgbob.cpp DIA_msharpen.cpp DIA_asharp.cpp DIA_dmx.cpp DIA_idx_pg.cpp DIA_gototime.cpp \
@@ -34,26 +34,25 @@
 	DIA_mcdeint.cpp \
 	DIA_defaultAudio.cpp \
 	DIA_partial.cpp \
-	DIA_fade.cpp \
 	DIA_ass.cpp DIA_bitrateHisto.cpp
 
 
 
 
-EXTRA_DIST =  DIA_4entries.cpp              DIA_enter.cpp     \
+EXTRA_DIST =  DIA_enter.cpp     \
 DIA_mcdeint.cpp     DIA_resize.cpp \
 DIA_cnr2.cpp          DIA_enter.h          DIA_mjpeg.cpp       DIA_resizeWiz.cpp \
 DIA_DVDff.cpp        DIA_color.cpp         DIA_eq2.cpp          DIA_mosaic.cpp      DIA_resizeWiz.h \
 DIA_coloryuv.cpp      DIA_equalizer.cpp    DIA_mpdelogo.cpp    DIA_rotate.cpp \
 DIA_SVCD.cpp         DIA_contrast.cpp      DIA_exLame.cpp       DIA_mpeg2opt.cpp    DIA_srt.cpp \
-DIA_about.cpp        DIA_conv.cpp          DIA_fade.cpp         DIA_msharpen.cpp    DIA_tdeint.cpp \
+DIA_about.cpp        DIA_conv.cpp          DIA_msharpen.cpp    DIA_tdeint.cpp \
 DIA_acodec.cpp       DIA_crop.cpp          DIA_gototime.cpp     DIA_muxer.cpp       DIA_v2v.cpp \
 DIA_animated.cpp     DIA_d3d.cpp           DIA_hue.cpp          DIA_ocr.cpp         DIA_vcodec.cpp \
 DIA_asharp.cpp       DIA_deblend.cpp       DIA_idx_pg.cpp       DIA_partial.cpp     DIA_vobsub.cpp \
 DIA_audio.cpp        DIA_decimate.cpp      DIA_idx_pg.h         DIA_pause.cpp       DIA_vorbis.cpp \
 DIA_audioTrack.cpp   DIA_dectel.cpp        DIA_indexer.cpp      DIA_pipe.cpp        DIA_working.cpp \
 DIA_audiocodec.cpp   DIA_defaultAudio.cpp  DIA_jobs.cpp         DIA_postproc.cpp    DIA_working.h \
-DIA_audiodevice.cpp  DIA_denoise.cpp       DIA_jobs_save.cpp    DIA_prefs.cpp       DIA_x264.cpp \
+DIA_denoise.cpp       DIA_jobs_save.cpp    DIA_prefs.cpp       DIA_x264.cpp \
 DIA_builtin.cpp      DIA_dgbob.cpp         DIA_kerneldeint.cpp  DIA_preview.cpp     DIA_xvcd.cpp \
 DIA_busy.cpp         DIA_dmx.cpp           DIA_lame.cpp         DIA_properties.cpp  DIA_xvid.cpp \
 DIA_busy.h           DIA_dnr.cpp           DIA_lavcodec.cpp     DIA_quota.cpp       DIA_xvid4.cpp \

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_float.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_float.cpp	2007-01-09 19:59:26 UTC (rev 2698)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_float.cpp	2007-01-10 19:52:36 UTC (rev 2699)
@@ -62,8 +62,8 @@
   widget = gtk_spin_button_new_with_range(min,max,0.1);
   gtk_spin_button_set_numeric (GTK_SPIN_BUTTON(widget),TRUE);
   gtk_spin_button_set_digits  (GTK_SPIN_BUTTON(widget),2);
+  gtk_spin_button_set_value (GTK_SPIN_BUTTON(widget),*(ELEM_TYPE_FLOAT *)param);
   
-  
   gtk_widget_show (widget);
   
   gtk_table_attach (GTK_TABLE (opaque), widget, 1, 2, line, line+1,

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_menu.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_menu.cpp	2007-01-09 19:59:26 UTC (rev 2698)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_menu.cpp	2007-01-10 19:52:36 UTC (rev 2699)
@@ -0,0 +1,99 @@
+/***************************************************************************
+  FAC_toggle.cpp
+  Handle dialog factory element : Menu
+  (C) 2006 Mean <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">Fixounet at free.fr</A> 
+***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &lt;config.h&gt;
+
+
+#include &lt;string.h&gt;
+#include &lt;stdio.h&gt;
+#include &lt;math.h&gt;
+
+#include &quot;default.h&quot;
+#include &quot;ADM_toolkit_gtk/ADM_gladeSupport.h&quot;
+#include &quot;ADM_toolkit_gtk/toolkit_gtk.h&quot;
+#include &quot;ADM_toolkit_gtk/toolkit_gtk_include.h&quot;
+#include &quot;ADM_commonUI/DIA_factory.h&quot;
+#include &quot;ADM_assert.h&quot;
+
+
+
+
+diaElemMenu::diaElemMenu(uint32_t *intValue,const char *itle, uint32_t nb, 
+               const diaMenuEntry *menu,const char *tip)
+  : diaElem(ELEM_MENU)
+{
+  param=(void *)intValue;
+  paramTitle=itle;
+  this-&gt;tip=tip;
+  this-&gt;menu=menu;
+  this-&gt;nbMenu=nb;
+}
+
+diaElemMenu::~diaElemMenu()
+{
+  
+}
+void diaElemMenu::setMe(void *dialog, void *opaque,uint32_t line)
+{
+  GtkWidget *widget;
+  GtkWidget *label;
+  GtkWidget *item;
+  GtkWidget *combo;
+  
+  
+  label = gtk_label_new (paramTitle);
+  gtk_widget_show(label);
+  
+  gtk_table_attach (GTK_TABLE (opaque), label, 0, 1, line, line+1,
+                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  
+  combo = gtk_combo_box_new_text ();
+  gtk_widget_show (combo);
+  gtk_table_attach (GTK_TABLE (opaque), combo, 1, 2, line, line+1,
+                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  
+  for(int i=0;i&lt;nbMenu;i++)
+  {
+    gtk_combo_box_append_text (GTK_COMBO_BOX (combo),this-&gt;menu[i].text);
+  }
+  
+  for(int i=0;i&lt;nbMenu;i++)
+  {
+    if(this-&gt;menu[i].val==*(uint32_t *)param) 
+    {
+      gtk_combo_box_set_active(GTK_COMBO_BOX(combo),i);
+    }
+  }
+  
+  
+  myWidget=(void *)combo;
+}
+
+void diaElemMenu::getMe(void)
+{
+  GtkWidget *widget=(GtkWidget *)myWidget;
+  uint32_t *val=(uint32_t *)param;
+  uint32_t rank;
+  ADM_assert(widget);
+  
+  
+  rank=gtk_combo_box_get_active(GTK_COMBO_BOX(widget));
+  ADM_assert(rank&lt;this-&gt;nbMenu);
+  *(uint32_t *)param=this-&gt;menu[rank].val;
+}
+
+//EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am	2007-01-09 19:59:26 UTC (rev 2698)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am	2007-01-10 19:52:36 UTC (rev 2699)
@@ -8,6 +8,6 @@
 
 libADM_dialogFactory_a_METASOURCES = AUTO
 
-libADM_dialogFactory_a_SOURCES = DIA_dialogFactory.cpp FAC_toggle.cpp FAC_integer.cpp FAC_float.cpp
+libADM_dialogFactory_a_SOURCES = DIA_dialogFactory.cpp FAC_toggle.cpp FAC_integer.cpp FAC_float.cpp FAC_menu.cpp
 
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-01-09 19:59:26 UTC (rev 2698)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-01-10 19:52:36 UTC (rev 2699)
@@ -43,7 +43,6 @@
 #include &quot;ADM_video/ADM_vidDecTel_param.h&quot;
 #include &quot;ADM_audiofilter/audioencoder_lame_param.h&quot;
 #include &quot;ADM_video/ADM_vidDGbob_param.h&quot;
-#include &quot;ADM_video/ADM_vidFade_param.h&quot;
 #include &quot;ADM_audiofilter/audioencoder_lame_param.h&quot;
 #include &quot;ADM_video/ADM_vidMcDeint_param.h&quot;
 #include &quot;ADM_encoder/adm_encmjpeg_param.h&quot;
@@ -99,7 +98,6 @@
 uint8_t  DIA_blendRemoval(BLEND_REMOVER_PARAM *mosaic){return 0;}
 uint8_t DIA_cnr2(CNR2Param *param){return 0;}
 uint8_t DIA_DVDffParam(COMPRES_PARAMS *incoming){return 0;}
-uint8_t DIA_fade(VIDFADE_PARAM *param){return 0;}
 uint8_t DIA_getASharp(ASHARP_PARAM *param, AVDMGenericVideoStream *in){return 0;}
 uint8_t DIA_getDecombDecimate(DECIMATE_PARAM *param){return 0;}
 uint8_t DIA_getDecombTelecide(TelecideParam *param){return 0;}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-01-09 19:59:26 UTC (rev 2698)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-01-10 19:52:36 UTC (rev 2699)
@@ -102,7 +102,27 @@
  
 }
 
+//******************************************************
 
+diaElemMenu::diaElemMenu(uint32_t *intValue,const char *itle, uint32_t nb, 
+               const diaMenuEntry *menu,const char *tip)
+  : diaElem(ELEM_MENU)
+{
+}
 
+diaElemMenu::~diaElemMenu()
+{
+  
+}
+void diaElemMenu::setMe(void *dialog, void *opaque,uint32_t line)
+{
+  
+}
+void diaElemMenu::getMe(void)
+{
+ 
+}
+
+
 //******************************************************
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-01-09 19:59:26 UTC (rev 2698)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-01-10 19:52:36 UTC (rev 2699)
@@ -43,7 +43,6 @@
 #include &quot;ADM_video/ADM_vidDecTel_param.h&quot;
 #include &quot;ADM_audiofilter/audioencoder_lame_param.h&quot;
 #include &quot;ADM_video/ADM_vidDGbob_param.h&quot;
-#include &quot;ADM_video/ADM_vidFade_param.h&quot;
 #include &quot;ADM_audiofilter/audioencoder_lame_param.h&quot;
 #include &quot;ADM_video/ADM_vidMcDeint_param.h&quot;
 #include &quot;ADM_encoder/adm_encmjpeg_param.h&quot;
@@ -99,7 +98,6 @@
 uint8_t  DIA_blendRemoval(BLEND_REMOVER_PARAM *mosaic){return 0;}
 uint8_t DIA_cnr2(CNR2Param *param){return 0;}
 uint8_t DIA_DVDffParam(COMPRES_PARAMS *incoming){return 0;}
-uint8_t DIA_fade(VIDFADE_PARAM *param){return 0;}
 uint8_t DIA_getASharp(ASHARP_PARAM *param, AVDMGenericVideoStream *in){return 0;}
 uint8_t DIA_getDecombDecimate(DECIMATE_PARAM *param){return 0;}
 uint8_t DIA_getDecombTelecide(TelecideParam *param){return 0;}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_toggle.cpp	2007-01-09 19:59:26 UTC (rev 2698)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/FAC_toggle.cpp	2007-01-10 19:52:36 UTC (rev 2699)
@@ -102,5 +102,25 @@
 {
  
 }
+//******************************************************
 
+diaElemMenu::diaElemMenu(uint32_t *intValue,const char *itle, uint32_t nb, 
+               const diaMenuEntry *menu,const char *tip)
+  : diaElem(ELEM_MENU)
+{
+}
+
+diaElemMenu::~diaElemMenu()
+{
+  
+}
+void diaElemMenu::setMe(void *dialog, void *opaque,uint32_t line)
+{
+  
+}
+void diaElemMenu::getMe(void)
+{
+ 
+}
+
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-01-09 19:59:26 UTC (rev 2698)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-01-10 19:52:36 UTC (rev 2699)
@@ -22,6 +22,7 @@
   ELEM_TOGGLE,
   ELEM_INTEGER,
   ELEM_FLOAT,
+  ELEM_MENU,
   ELEM_MAX=ELEM_TOGGLE
 };
 /*********************************************/
@@ -86,6 +87,29 @@
   void setMe(void *dialog, void *opaque,uint32_t line);
   void getMe(void);
 };
+/*************************************************/
+typedef struct diaMenuEntry
+{
+  uint32_t    val;
+  const char *text;
+  const char *desc;
+}diaMenuEntry;
+
+class diaElemMenu : public diaElem
+{
+const diaMenuEntry *menu;
+uint32_t     nbMenu;
+
+public:
+  diaElemMenu(uint32_t *intValue,const char *itle, uint32_t nb, 
+               const diaMenuEntry *menu,const char *tip=NULL);
+  
+  virtual ~diaElemMenu() ;
+  void setMe(void *dialog, void *opaque,uint32_t line);
+  void getMe(void);
+};
+
+/*************************************************/
 /*********************************************/
 uint8_t diaFactoryRun(const char *title,uint32_t nb,diaElem **elems);
 

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_guiMedianBig.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_guiMedianBig.cpp	2007-01-09 19:59:26 UTC (rev 2698)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_guiMedianBig.cpp	2007-01-10 19:52:36 UTC (rev 2699)
@@ -1 +0,0 @@
-// rmed

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidFade.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidFade.cpp	2007-01-09 19:59:26 UTC (rev 2698)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidFade.cpp	2007-01-10 19:52:36 UTC (rev 2699)
@@ -1,263 +0,0 @@
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &quot;config.h&quot;
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;math.h&gt;
-#include &lt;ADM_assert.h&gt;
-
-#include &quot;config.h&quot;
-#include &quot;fourcc.h&quot;
-#include &quot;avio.hxx&quot;
-#include &quot;avi_vars.h&quot;
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include&quot;ADM_video/ADM_vidField.h&quot;
-#include&quot;ADM_video/ADM_cache.h&quot;
-
-#include &quot;ADM_osSupport/ADM_debugID.h&quot;
-#define MODULE_NAME MODULE_FILTER
-#include &quot;ADM_osSupport/ADM_debug.h&quot;
-#include &quot;ADM_filter/video_filters.h&quot;
-#include &quot;ADM_vidFade_param.h&quot;
-
-class AVDM_Fade : public AVDMGenericVideoStream
-{
-  VideoCache      *vidCache;
-  VIDFADE_PARAM   *_param;
-  uint16_t         lookupLuma[256][256];
-  uint16_t         lookupChroma[256][256];
-  uint8_t         buildLut(void);
-  public:
-                                
-                    AVDM_Fade(AVDMGenericVideoStream *in,CONFcouple *couples);    
-                    ~AVDM_Fade(void);
-    uint8_t         getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-                                          ADMImage *data,uint32_t *flags);
-        
-    char            *printConf( void );
-    uint8_t         configure(AVDMGenericVideoStream *in);
-    uint8_t         getCoupledConf( CONFcouple **couples);
-};
-
-static FILTER_PARAM fadeParam={4,{&quot;startFade&quot;,&quot;endFade&quot;,&quot;inOut&quot;,&quot;toBlack&quot;}};
-
-BUILD_CREATE(fade_create,AVDM_Fade);
-SCRIPT_CREATE(fade_script,AVDM_Fade,fadeParam);
-
-/*************************************/
-uint8_t DIA_fade(VIDFADE_PARAM *param);
-uint8_t AVDM_Fade::configure(AVDMGenericVideoStream *in)
-{
-  _in=in;
-  return DIA_fade(_param);
-}
-
-char *AVDM_Fade::printConf( void )
-{
-  static char buf[50];
-
-        //ADM_assert(_param);
-  sprintf((char *)buf,&quot; Fade : Start %u End %u&quot;,_param-&gt;startFade,_param-&gt;endFade);
-  if(_param-&gt;inOut) strcat(buf,&quot; In&quot;); else strcat(buf,&quot; Out&quot;);
-  return buf;
-}
-
-
-AVDM_Fade::AVDM_Fade(AVDMGenericVideoStream *in,CONFcouple *couples)
-
-{
-                
-  int count = 0;
-  char buf[80];
-  unsigned int *p;
-
-  _in=in;         
-  memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));    
-  _info.encoding=1;
-  vidCache=new VideoCache(3,in);
-  
-  _param=new VIDFADE_PARAM;
-  if(couples)
-  {
-    GET(startFade);
-    GET(endFade);
-    GET(inOut);
-    GET(toBlack);
-    
-  }else
-  {
-    _param-&gt;startFade=0; 
-    _param-&gt;endFade=_info.nb_frames-1;
-    _param-&gt;inOut=0;
-    _param-&gt;toBlack=0;
-  }
-  buildLut();
-}
-//________________________________________________________
-uint8_t AVDM_Fade::getCoupledConf( CONFcouple **couples)
-{
-  *couples=new CONFcouple(4);
-  CSET(startFade);
-  CSET(endFade);
-  CSET(inOut);
-  CSET(toBlack);
-  return 1;
-}
-//________________________________________________________
-AVDM_Fade::~AVDM_Fade(void)
-{
-                
-  if(vidCache) delete vidCache;                
-  vidCache=NULL;   
-  if(_param) delete _param;
-  _param=NULL;
-}
-uint8_t AVDM_Fade::getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-                                            ADMImage *data,uint32_t *flags)
-{
-
-  uint32_t num_frames,tgt;
-  
-  ADMImage *src;
-
-  num_frames=_info.nb_frames;   // ??
-
-  tgt=frame+_info.orgFrame;
-  if(frame&gt;=num_frames)
-  {
-    printf(&quot;[Fade] out of bound\n&quot;);
-    return 0;
-  }
-
-  src=vidCache-&gt;getImage(frame);
-  if(!src) return 0;
-  if(tgt&gt;_param-&gt;endFade || tgt &lt;_param-&gt;startFade ||_param-&gt;endFade==_param-&gt;startFade )
-  {
-    //printf(&quot;Cur %u start %u end %u\n&quot;,tgt,_param-&gt;startFade,_param-&gt;endFade);
-    data-&gt;duplicate(src);
-    vidCache-&gt;unlockAll();
-    return 1;
-  }
-  uint8_t *s,*d,*s2;
-  uint16_t *index,*invertedIndex;
-  uint32_t count=_info.width*_info.height,w;
-  float num,den;
-  
-  den=_param-&gt;endFade-_param-&gt;startFade;
-  
-  num=tgt-_param-&gt;startFade;
-  
-  num=num/den;
-  num*=255.;
-  w=(uint32_t)floor(num+0.4);
-  
-//printf(&quot;w :%u\n&quot;,w);
-
-  s=src-&gt;data;
-  d=data-&gt;data;
-  if(_param-&gt;toBlack)
-  {
-        index=lookupLuma[w];
-        for(int i=0;i&lt;count;i++)
-        {
-          *d++=(index[*s++]&gt;&gt;8);
-        }
-        // Now do chroma
-        count&gt;&gt;=2;
-        s=UPLANE(src);
-        d=UPLANE(data);
-        index=lookupChroma[w];
-        for(int i=0;i&lt;count;i++)
-        {
-          *d++=(index[*s++]&gt;&gt;8);
-        }
-        s=VPLANE(src);
-        d=VPLANE(data);
-        for(int i=0;i&lt;count;i++)
-        {
-          *d++=(index[*s++]&gt;&gt;8);
-        }
-  }
-  else
-  {
-        uint32_t x,alpha;
-        ADMImage *final;
-
-        final=vidCache-&gt;getImage(_param-&gt;endFade-_info.orgFrame);
-        if(!final)
-        {
-              data-&gt;duplicate(src);
-              vidCache-&gt;unlockAll();
-              return 1;
-        }
-
-        s2=final-&gt;data;
-
-        index=lookupLuma[w];
-        
-        invertedIndex=lookupLuma[255-w];
-        for(int i=0;i&lt;count;i++)
-        {
-          *d++=(index[*s++]+invertedIndex[*s2++])&gt;&gt;8;
-        }
-        // Now do chroma
-        count&gt;&gt;=2;
-        s=UPLANE(src);
-        d=UPLANE(data);
-        s2=UPLANE(final);
-        index=lookupChroma[w];
-        invertedIndex=lookupChroma[255-w];
-        for(int i=0;i&lt;count;i++)
-        {
-            *d++=(index[*s++]+invertedIndex[*s2++]-(128&lt;&lt;8))&gt;&gt;8;
-        }
-        s=VPLANE(src);
-        d=VPLANE(data);
-        s2=VPLANE(final);
-        for(int i=0;i&lt;count;i++)
-        {
-            *d++=(index[*s++]+invertedIndex[*s2++]-(128&lt;&lt;8))&gt;&gt;8;
-            
-        }
-  }
-  vidCache-&gt;unlockAll();
-  return 1;
-}
-
-uint8_t AVDM_Fade::buildLut(void)
-{
-  float f,ration;
-  for(int i=0;i&lt;256;i++)
-  {
-    if(!_param-&gt;inOut) ration=255-i;
-    else ration=i;
-    for(int r=0;r&lt;256;r++)
-    {
-      f=r;
-      f=f*ration;
-      lookupLuma[i][r]=(uint16_t)(f+0.4);
-
-      f=r-128;
-      f=f*ration;
-      lookupChroma[i][r]=(128&lt;&lt;8)+(uint16_t)(f+0.4);
-
-    }
-    
-  }
-  return 1;
-}
-//EOF
-
-
-

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidFade_param.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidFade_param.h	2007-01-09 19:59:26 UTC (rev 2698)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidFade_param.h	2007-01-10 19:52:36 UTC (rev 2699)
@@ -1,23 +0,0 @@
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifndef ADM_VIDFADE_PARAM_H
-#define ADM_VIDFADE_PARAM_H
-
-typedef struct VIDFADE_PARAM
-{
-  uint32_t startFade;
-  uint32_t endFade;
-  uint32_t inOut; //0 Out 1 In
-  uint32_t toBlack; // =1 else fade to endFrame
-}VIDFADE_PARAM;
-
-
-
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidResampleFPS.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidResampleFPS.cpp	2007-01-09 19:59:26 UTC (rev 2698)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidResampleFPS.cpp	2007-01-10 19:52:36 UTC (rev 2699)
@@ -1,363 +0,0 @@
-/***************************************************************************
-                          Resample fps
-                             -------------------
-    begin                : Wed Nov 6 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#include &lt;stdio.h&gt;
-#include &lt;math.h&gt;
-
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;ADM_assert.h&gt;
-
-#include &quot;config.h&quot;
-#include &quot;fourcc.h&quot;
-#include &quot;avio.hxx&quot;
-#include &quot;config.h&quot;
-#include &quot;avi_vars.h&quot;
-#ifdef HAVE_ENCODER
-
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_video/ADM_vidFlipV.h&quot;
-#include &quot;ADM_filter/video_filters.h&quot;
-#include &quot;DIA_enter.h&quot;
-#include &quot;ADM_video/ADM_cache.h&quot;
-#include &quot;ADM_osSupport/ADM_cpuCap.h&quot;
-#include &quot;admmangle.h&quot;
-
-static FILTER_PARAM ResampParam={2,{&quot;newfps&quot;,&quot;use_linear&quot;}};
-typedef struct FPS_Param
-{
-  uint32_t  newfps; 
-  uint32_t  use_linear;
-}FPS_Param;
-class  ADMVideoResampleFPS:public AVDMGenericVideoStream
-{
-
-  protected:
-    AVDMGenericVideoStream  *_in;           
-    virtual char            *printConf(void);
-            FPS_Param       *_param;    
-            VideoCache      *vidCache; 
-  public:
-                
-                        ADMVideoResampleFPS(  AVDMGenericVideoStream *in,CONFcouple *setup);
-                        ADMVideoResampleFPS(  AVDMGenericVideoStream *in,uint32_t target1000);
-    virtual             ~ADMVideoResampleFPS();
-    virtual uint8_t     configure(AVDMGenericVideoStream *in);
-    virtual uint8_t     getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-                                          ADMImage *data,uint32_t *flags);
-
-             uint8_t     getCoupledConf( CONFcouple **couples);
-}     ;
-
-SCRIPT_CREATE(resamplefps_script,ADMVideoResampleFPS,ResampParam);
-BUILD_CREATE(resamplefps_create,ADMVideoResampleFPS);
-
-AVDMGenericVideoStream *createResampleFps(AVDMGenericVideoStream *in,uint32_t targetfps1000)
-{
-  return new ADMVideoResampleFPS(in,targetfps1000);
-}
-
-uint8_t ADMVideoResampleFPS::configure(AVDMGenericVideoStream *in)
-{
-  uint8_t r=0;
-  float f=_param-&gt;newfps;
-  
-  f/=1000;
-  
-  _in=in;     
-  if(DIA_GetFloatValue(&amp;f, 1.0, 200., &quot;Enter new fps&quot;,&quot;New fps:&quot;))
-  {
-    f*=1000;
-    _param-&gt;newfps=(uint32_t)floor(f+0.4); 
-    _info.fps1000=_param-&gt;newfps;   
-    
-    if(GUI_Question(_(&quot;Use linear blend ?&quot;)))
-    {
-        _param-&gt;use_linear=1;        
-    }
-    else
-    {
-        _param-&gt;use_linear=0;        
-    }
-    r=1;
-  } 
-  return r;        
-}
-char *ADMVideoResampleFPS::printConf( void )
-{
-  static char buf[50];
-        
-  sprintf((char *)buf,&quot; Resample to %2.2f fps (blend:%d)&quot;,(double)_param-&gt;newfps/1000.,
-                _param-&gt;use_linear);
-  return buf;
-}
-
-ADMVideoResampleFPS::ADMVideoResampleFPS(  AVDMGenericVideoStream *in,uint32_t target)
-{
-
-  _in=in;         
-  memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));    
-  _info.encoding=1; 
-  _param=new  FPS_Param;
-   
-    _param-&gt;newfps =target;                
-    _param-&gt;use_linear=1;
- 
-  double newlength;
-  
-  newlength=_info.nb_frames;
-  newlength/=_info.fps1000;
-  newlength*=_param-&gt;newfps;
-  _info.nb_frames=(uint32_t)floor(newlength);
-  _info.fps1000=_param-&gt;newfps;
-  printf(&quot;[Resample FPS] %u -&gt; %u\n&quot;,_in-&gt;getInfo()-&gt;nb_frames,_info.nb_frames);
-  vidCache=new VideoCache(3,_in);
-
-}
-
-ADMVideoResampleFPS::ADMVideoResampleFPS(  AVDMGenericVideoStream *in,CONFcouple *couples)
-{
-  
-  _in=in;         
-  memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));    
-  _info.encoding=1; 
-  _param=new  FPS_Param;
-   
-  if(couples)
-  {                 
-    GET(newfps);    
-    GET(use_linear); 
-  }
-  else
-  {
-    _param-&gt;newfps =_info.fps1000;                
-    _param-&gt;use_linear=0;
-  }      
- 
-  double newlength;
-  
-  newlength=_info.nb_frames;
-  newlength/=_info.fps1000;
-  newlength*=_param-&gt;newfps;
-  _info.nb_frames=(uint32_t)floor(newlength);
-  _info.fps1000=_param-&gt;newfps;
-  vidCache=new VideoCache(3,_in);
-  
-}
-ADMVideoResampleFPS::~ADMVideoResampleFPS()
-{
-  delete _param;
-  delete vidCache;
-  
-}
-uint8_t ADMVideoResampleFPS::getCoupledConf( CONFcouple **couples)
-{
-  ADM_assert(_param);
-  *couples=new CONFcouple(2);
-
-
-                CSET(newfps);
-                CSET(use_linear);
-                return 1;
-}
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
-static uint64_t low,high;
-static void blendMMX(uint8_t *src, uint8_t *src2, uint8_t *dst, uint8_t alpha, uint8_t beta,uint32_t count)
-{
-uint32_t left=count&amp;3;
-#define EXPAND(x) (x)+((x)&lt;&lt;16)+((x)&lt;&lt;32) +((x)&lt;&lt;48)
-        high=alpha;
-        low=beta;
-        high=EXPAND(high);
-        low=EXPAND(low);
-        count&gt;&gt;=2;
-#ifdef GCC_2_95_X
-         __asm__ __volatile__ (
-                                &quot;movq &quot;Mangle(high)&quot;, %mm0\n&quot;
-                                &quot;movq &quot;Mangle(low)&quot;,  %mm1\n&quot;                                
-                                &quot;pxor %mm7        ,  %mm7\n&quot;
-                                :: );
-#else
-         __asm__ __volatile__ (
-                                &quot;movq &quot;Mangle(high)&quot;, %%mm0\n&quot;
-                                &quot;movq &quot;Mangle(low)&quot;,  %%mm1\n&quot;                                
-                                &quot;pxor %%mm7        ,  %%mm7\n&quot;
-                                :: );
-#endif
-
-        while(count&gt;0)
-        {
-                __asm__ __volatile__ (
-                               
-                                &quot;movd      (%0),  %%mm2\n&quot;
-                                &quot;movd      (%1),  %%mm3\n&quot;                               
-
-                                &quot;punpcklbw %%mm7, %%mm2\n&quot;
-                                &quot;punpcklbw %%mm7, %%mm3\n&quot;
-
-                                &quot;pmullw   %%mm0, %%mm2\n&quot;
-                                &quot;pmullw   %%mm1, %%mm3\n&quot;
-                
-                                &quot;paddw    %%mm3, %%mm2\n&quot;
-
-                                &quot;psrlw    $8,    %%mm2 \n&quot;
-
-                                &quot;packuswb %%mm2,%%mm2\n&quot;
-                                &quot;movd     %%mm2, (%2)\n&quot;
-
-                                :: &quot;r&quot; (src), &quot;r&quot; (src2), &quot;r&quot; (dst) );
-                                
-                src+=4;
-                src2+=4;
-                dst+=4;
-                count--;
-        }
-        __asm__ __volatile__ (
-                                &quot;emms\n&quot;
-                                :: );
-        for(uint32_t i=0;i&lt;left;i++)
-        {
-                dst[i] = ((src[i]*alpha) + (src2[i]*beta))&gt;&gt;8;
-        }
-}
-
-#endif
-
-uint8_t ADMVideoResampleFPS::getFrameNumberNoAlloc(uint32_t frame,
-                                             uint32_t *len,
-                                             ADMImage *data,
-                                             uint32_t *flags)
-{
-  ADMImage *mysrc1=NULL;
-  ADMImage *mysrc2=NULL;
-
-  ADM_assert(frame&lt;_info.nb_frames);
-  // read uncompressed frame
-  
-  // What frame are we seeking ?
-  double f;
-  uint32_t page=_info.width*_info.height;
-  
-  f=frame;
-  f*=_in-&gt;getInfo()-&gt;fps1000;
-  f/=_param-&gt;newfps;
-  
-  if(!_param-&gt;use_linear)
-  {
-      uint32_t nw;
-      
-      nw=(uint32_t)floor(f+0.4);
-      if(nw&gt;_in-&gt;getInfo()-&gt;nb_frames-1)
-        nw=_in-&gt;getInfo()-&gt;nb_frames-1;
-    
-      mysrc1=vidCache-&gt;getImage(nw);
-      if(!mysrc1) return 0;
-      
-      memcpy(YPLANE(data),YPLANE(mysrc1),page);
-      memcpy(UPLANE(data),UPLANE(mysrc1),page&gt;&gt;2);
-      memcpy(VPLANE(data),VPLANE(mysrc1),page&gt;&gt;2);
-    
-      vidCache-&gt;unlockAll();
-      
-      return 1;
-  }
-  /* With linear blending */
-  uint32_t nw;
-  uint8_t lowweight;
-  uint8_t highweight;
-  
-  double diff;
-  
-  nw=(uint32_t)floor(f);
-  diff=f-floor(f);
-  highweight = (uint8_t)floor(diff*256);
-  lowweight = 256 - highweight;
-
-  if(nw&gt;=_in-&gt;getInfo()-&gt;nb_frames-1)
-    {
-      printf(&quot;[ResampleFps] In %u Out %u\n&quot;,frame,nw);
-      nw=_in-&gt;getInfo()-&gt;nb_frames-1;
-      highweight=0;
-    }
-  //printf(&quot;New:%lu old:%lu\n&quot;,frame,nw);
-
-  if(highweight == 0)
-    {
-      mysrc1=vidCache-&gt;getImage(nw);  
-      if(!mysrc1) return 0;
-      
-      memcpy(YPLANE(data),YPLANE(mysrc1),page);
-      memcpy(UPLANE(data),UPLANE(mysrc1),page&gt;&gt;2);
-      memcpy(VPLANE(data),VPLANE(mysrc1),page&gt;&gt;2);
-      
-      vidCache-&gt;unlockAll();
-    }
-  else
-    {
-      mysrc1=vidCache-&gt;getImage(nw);
-      mysrc2=vidCache-&gt;getImage(nw+1);
-      if(!mysrc1 || !mysrc2) return 0;
-      
-      uint8_t *out, *in1, *in2;
-      uint32_t count;
-      uint32_t idx;
-      
-      out = YPLANE(data);
-      in1 = YPLANE(mysrc1);
-      in2 = YPLANE(mysrc2);
-        
-      count = page;
-
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
-        if(CpuCaps::hasMMX())
-                blendMMX(in1,in2,out,lowweight,highweight,(count*3)&gt;&gt;1);
-        else
-#endif
-      {
-      for(idx = 0; idx &lt; count; ++idx)
-	out[idx] = ((in1[idx]*lowweight) + (in2[idx]*highweight))&gt;&gt;8;
-
-      out = UPLANE(data);
-      in1 = UPLANE(mysrc1);
-      in2 = UPLANE(mysrc2);
-      count = page&gt;&gt;2;
-
-      for(idx = 0; idx &lt; count; ++idx)
-        out[idx] = ((in1[idx]*lowweight) + (in2[idx]*highweight))&gt;&gt;8;      
-
-
-      out = VPLANE(data);
-      in1 = VPLANE(mysrc1);
-      in2 = VPLANE(mysrc2);
-      count = page&gt;&gt;2;
-
-      for(idx = 0; idx &lt; count; ++idx)
-	out[idx] = ((in1[idx]*lowweight) + (in2[idx]*highweight))&gt;&gt;8;
-      }
-
-      vidCache-&gt;unlockAll();
-    }
-  return 1;
- 
-}
-
-
-
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSoften.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSoften.cpp	2007-01-09 19:59:26 UTC (rev 2698)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSoften.cpp	2007-01-10 19:52:36 UTC (rev 2699)
@@ -1,338 +0,0 @@
-//
-// C++ Implementation: Soften
-//
-// Description: 
-//
-// See .h file
-//
-// Author: mean &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>&gt;, (C) 2004
-//
-// Copyright: See COPYING file that comes with this distribution
-//
-//
-
-//
-//	This is the very unoptimized version
-//	could use some stuff and some mmx too
-//
-
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;ADM_assert.h&gt;
-#include &lt;math.h&gt;
-#include &lt;math.h&gt;
-#include &lt;iconv.h&gt;
-#include &quot;config.h&quot;
-
-
-#include &quot;fourcc.h&quot;
-#include &quot;avio.hxx&quot;
-
-#include &quot;avi_vars.h&quot;
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-
-#include &quot;ADM_osSupport/ADM_debugID.h&quot;
-#define MODULE_NAME MODULE_FILTER
-#include &quot;ADM_osSupport/ADM_debug.h&quot;
-
-
-
-#include &quot;ADM_vidSoften.h&quot;
-#include &quot;DIA_enter.h&quot;
-#include &quot;ADM_filter/video_filters.h&quot;
-
-
-static FILTER_PARAM softParam={3,{&quot;radius&quot;,&quot;luma&quot;,&quot;chroma&quot;}};
-
-
-SCRIPT_CREATE(soften_script,ADMVideoMaskedSoften,softParam);
-BUILD_CREATE(soften_create,ADMVideoMaskedSoften);
-
-extern uint8_t distMatrix[256][256];
-extern uint32_t fixMul[16];
-
-
-uint8_t ADMVideoMaskedSoften::configure( AVDMGenericVideoStream *instream)
-{
-	_in=instream;
-	int radius, luma, chroma;
-	
-		radius=_param-&gt;radius;
-		luma=_param-&gt;luma;
-		chroma=_param-&gt;chroma;
-		if(DIA_GetIntegerValue(&amp;radius,1,60, &quot;Radius&quot;,&quot;Radius:&quot;))
-		{
-			if(DIA_GetIntegerValue(&amp;luma,0,255, &quot;Luma Threshold&quot;,&quot;Luma Threshold:&quot;))
-			{	
-				if(DIA_GetIntegerValue(&amp;chroma,0,255, &quot;Chroma Threshold&quot;,&quot;Chroma Threshold:&quot;))
-				{
-					_param-&gt;radius=radius;
-					_param-&gt;luma=luma;
-					_param-&gt;chroma=chroma;
-					return 1;
-				}
-			}
-
-		}
-		return 0;
-}
-uint8_t	ADMVideoMaskedSoften::getCoupledConf( CONFcouple **couples)
-{
-
-			*couples=new CONFcouple(3);
-
-			CSET(radius);
-			CSET(luma);
-			CSET(chroma);
-
-		return 1;	
-}
-char *ADMVideoMaskedSoften::printConf( void )
-{
- 	static char buf[50];
- 	
- 	sprintf((char *)buf,&quot; Soften : radius: %lu l:%lu c:%lu&quot;, 
-		_param-&gt;radius,_param-&gt;luma, _param-&gt;chroma);
-        return buf;
-}
-
-ADMVideoMaskedSoften::~ADMVideoMaskedSoften()
-{
-	if(_uncompressed)
- 		delete _uncompressed;	
- 	_uncompressed=NULL;
-}
-
-
- ADMVideoMaskedSoften::ADMVideoMaskedSoften( AVDMGenericVideoStream *in,CONFcouple *couples)
-{
-		
-		_uncompressed=NULL;
-		_in=in;
-		ADM_assert(in);
-		if(!couples)
-		{
-			
-			_param=NEW(MaskedSoften_CONF);
-	    		_param-&gt;radius=2; 
-	    		_param-&gt;luma=5;
-			_param-&gt;chroma=5;
-			
-	    	}
-		else
-		{
-			_param=NEW(MaskedSoften_CONF);
-			GET(radius);
-			GET(luma);
-			GET(chroma);
-			
-						
-		}
-		ADM_assert(in);
-		
-		memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));	
-			    	
-	    	//_uncompressed=new uint8_t[3*_info.width*_info.height];	
-		_uncompressed=new ADMImage(_info.width,_info.height);	
-		
-
-}
-uint8_t ADMVideoMaskedSoften::getFrameNumberNoAlloc(uint32_t frame,
-				uint32_t *len,
-   				ADMImage *data,
-				uint32_t *flags)
-{
-		uint32_t page=_info.width*_info.height;
-		int32_t radius=_param-&gt;radius;
-		uint32_t offset;
-		
-		int blockx,blocky;
-		
-		*len=(page*3)&gt;&gt;1;
-		if(frame&gt;=_info.nb_frames) return 0;		
-		
-				
-		if(!_in-&gt;getFrameNumberNoAlloc(frame, len,_uncompressed,flags))
-				 		return 0;
-
-		// do luma only ATM
-		// copy chroma
-		memcpy(UPLANE(data),UPLANE(_uncompressed),page&gt;&gt;2);
-		memcpy(VPLANE(data),VPLANE(_uncompressed),page&gt;&gt;2);
-		
-		// for luma, the radius first lines /last lines are unchanged
-		memcpy(YPLANE(data),YPLANE(_uncompressed),radius*_info.width);
-		
-		offset=page-_info.width*radius-1;
-		
-		memcpy(YPLANE(data)+offset,
-			YPLANE(_uncompressed)+offset,
-			radius*_info.width);
-
-		uint8_t *src,*dst;
-		uint32_t val,cur,coef;
-		//
-		data-&gt;copyInfo(_uncompressed);
-		// optimized one
-		if(radius==2) return radius5(YPLANE(_uncompressed),YPLANE(data));
-		if(radius==1) return radius3(YPLANE(_uncompressed),YPLANE(data));
-		
-		for(uint32_t y=radius;y&lt;_info.height-radius;y++)
-		{
-			src=YPLANE(_uncompressed)+y*_info.width;
-			dst=YPLANE(data)+y*_info.width;
-			
-			memcpy(dst,src,radius);
-			src+=radius;
-			dst+=radius;
-			
-			for(uint32_t x=radius;x&lt;_info.width-radius;x++)
-			{
-				coef=0;
-				val=0;
-			
-				for( blocky=-radius;blocky&lt;=radius;blocky++)
-				{
-					for( blockx=-radius;blockx&lt;=radius;blockx++)
-					{
-						cur=*(src+blockx+blocky*_info.width);
-						
-						if( distMatrix[cur][*src]&lt;=_param-&gt;luma)
-						{
-							coef++;
-							val+=cur;
-						}
-					
-					
-					}
-				}
-				ADM_assert(coef);
-				if(coef!=1)
-					val=(val+(coef&gt;&gt;1)-1)/coef;
-				*dst++=val;
-				src++;
-				
-				//*dst++=*src++;
-			}
-			memcpy(dst,src,radius);
-		
-		}	
-	return 1;
-}
-uint8_t ADMVideoMaskedSoften::radius5(uint8_t *_uncompressed, uint8_t *data) 
-{
-int blockx,blocky;
-uint32_t val,coef;
-
-uint8_t *src,*dst;
-uint8_t cur;
-
-uint8_t *c0,*c1,*c2,*c3,*c4,ref;
-
-
-
-	for(uint32_t y=2;y&lt;_info.height-2;y++)
-		{
-			src=_uncompressed+y*_info.width;
-			dst=data+y*_info.width;
-			
-			*dst++=*src++;
-			*dst++=*src++;
-			
-			for(uint32_t x=2;x&lt;_info.width-2;x++)
-			{
-				coef=0;
-				val=0;
-				c0=src-2-2*_info.width;
-				c1=c0+_info.width;
-				c2=c1+_info.width;
-				c3=c2+_info.width;
-				c4=c3+_info.width;
-				
-				ref=*src;
-					
-#define CHECK(x) cur=*x;if(distMatrix[cur][ref]&lt;=_param-&gt;luma) {coef++;val+=cur;}x++;					
-				for( blockx=5;blockx&gt;0;blockx--)
-				{
-					CHECK(c0);
-					CHECK(c1);
-					CHECK(c2);
-					CHECK(c3);
-					CHECK(c4);
-				}
-				ADM_assert(coef);
-				if(coef!=1)
-					val=(val+(coef&gt;&gt;1)-1)/coef;
-
-				*dst++=val;
-				src++;
-			}
-			*dst++=*src++;
-			*dst++=*src++;		
-		}	
-}
-uint8_t ADMVideoMaskedSoften::radius3(uint8_t *_uncompressed, uint8_t *data) 
-{
-int blockx,blocky;
-uint32_t val,coef;
-
-uint8_t *src,*dst;
-uint8_t cur;
-
-uint8_t *c0,*c1,*c2,ref;
-
-uint8_t *dist;
-
-	for(uint32_t y=1;y&lt;_info.height-1;y++)
-		{
-			src=_uncompressed+y*_info.width;
-			dst=data+y*_info.width;
-			
-			*dst++=*src++;
-			
-			
-			for(uint32_t x=1;x&lt;_info.width-1;x++)
-			{
-				coef=0;
-				val=0;
-				c0=src-1-_info.width;
-				c1=c0+_info.width;
-				c2=c1+_info.width;
-				
-				ref=*src;
-				dist=distMatrix[ref];
-#undef CHECK				
-#define CHECK(x) cur=*x;if(dist[cur]&lt;=_param-&gt;luma) {coef++;val+=cur;}x++;					
-					CHECK(c0);
-					CHECK(c0);
-					CHECK(c0);
-					
-					CHECK(c1);
-					CHECK(c1);					
-					CHECK(c1);
-					
-					CHECK(c2);
-					CHECK(c2);					
-					CHECK(c2);
-				
-					
-				ADM_assert(coef);
-				if(coef!=1)
-					val=(val+(coef&gt;&gt;1)-1)/coef;
-				*dst++=val;
-				src++;
-			}
-			*dst++=*src++;
-			
-		}	
-}
-
-
-
-
-
-

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSoften.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSoften.h	2007-01-09 19:59:26 UTC (rev 2698)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSoften.h	2007-01-10 19:52:36 UTC (rev 2699)
@@ -1,49 +0,0 @@
-//
-// C++ Interface: ADM_vidSoften
-//
-// Description: 
-//
-// Very similar to Avisynth spatial soften
-// you might even say inspired by
-//
-//
-// Author: mean &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>&gt;, (C) 2004
-//
-// Copyright: See COPYING file that comes with this distribution
-//
-//
-
-#ifndef MSOFTEN_
-#define MSOFTEN_
-
-typedef struct MaskedSoften_CONF
-{
-	uint32_t luma,chroma;
-	uint32_t radius;
-}MaskedSoften_CONF;
-
- class  ADMVideoMaskedSoften:public AVDMGenericVideoStream
- {
-
- protected:
-    		
-		
-     virtual 	char 			*printConf(void);
-		uint8_t			*_reverse;
-		uint8_t 		radius5(uint8_t *_uncompressed, uint8_t *data) ;
-		uint8_t 		radius3(uint8_t *_uncompressed, uint8_t *data) ;
-
- public:
-		MaskedSoften_CONF *_param;
-
-  				ADMVideoMaskedSoften(  AVDMGenericVideoStream *in,
-							CONFcouple *setup);
-
-  	virtual 		~ADMVideoMaskedSoften();
-	virtual uint8_t 	getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-          						ADMImage *data,uint32_t *flags);
-	virtual uint8_t 	configure( AVDMGenericVideoStream *instream) ;
-	virtual uint8_t		getCoupledConf( CONFcouple **couples);
-	
- }     ;
-#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-01-09 19:59:26 UTC (rev 2698)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-01-10 19:52:36 UTC (rev 2699)
@@ -9,7 +9,6 @@
 libADM_video_a_SOURCES = ADM_vidFields.cpp \
  ADM_vidDeintASM.cpp \
  ADM_vidVlad.cpp \
- ADM_guiMedianBig.cpp \
  ADM_vidLargeMedian.cpp \
  ADM_vidSalt.cpp \
  ADM_vidCached.cpp \
@@ -63,7 +62,6 @@
 	ADM_mpdetc.cpp \
  ADM_vidKernelDeint.cpp \
  ADM_vidForcedPP.cpp \
- ADM_vidSoften.cpp \
  ADM_vidDecTelecide.cpp \
  ADM_vidDecTelecide.h ADM_cache.cpp \
  ADM_vidDecDec.cpp \
@@ -73,7 +71,6 @@
  ADM_vobsubinfo.cpp \
  ADM_vidChangeFPS.cpp \
  ADM_vidVobSubRender.cpp \
- ADM_vidResampleFPS.cpp \
  ADM_lavpp_deint.cpp \
  ADM_vidHue.cpp \
  ADM_vidEq2.cpp \
@@ -93,7 +90,7 @@
  ADM_guiResize.cpp \
  ADM_vidAnimated.cpp \
  ADM_vidMcDeint.cpp \
- ADM_vidReverse.cpp ADM_vidFade.cpp \
+ ADM_vidReverse.cpp  \
  ADM_vidASS.cpp
 
 				
@@ -108,15 +105,15 @@
 ADM_vidDeinterlace.h  ADM_vidPartial.h \
 ADM_vidDelta.cpp  ADM_vidPartial_param.h \
 ADM_guiCrop.cpp  ADM_vidDenoise.cpp  ADM_vidPulldown.cpp \
-ADM_guiMedianBig.cpp ADM_vidDenoise.h  ADM_vidPulldown.h \
+ADM_vidDenoise.h  ADM_vidPulldown.h \
 ADM_guiResize.cpp  ADM_vidDropOut.cpp  ADM_vidRaw.cpp \
-ADM_interlaced.cpp ADM_vidDropOut.h  ADM_vidResampleFPS.cpp \
+ADM_interlaced.cpp ADM_vidDropOut.h  \
 ADM_interlaced.h ADM_vidEq2.cpp  ADM_vidResize.cpp \
 ADM_lavpp_deint.cpp  ADM_vidEq2.h  ADM_vidResize25.cpp \
 ADM_lavpp_deintparam.h ADM_vidEqualizer.cpp  ADM_vidReverse.cpp \
 ADM_mpdetc.cpp ADM_vidEqualizer.h  ADM_vidRotate.cpp \
-ADM_mpdetc.h ADM_vidFade.cpp ADM_vidRotate.h \
-ADM_resizebis.cpp  ADM_vidFade_param.h ADM_vidSRT.cpp \
+ADM_mpdetc.h ADM_vidRotate.h \
+ADM_resizebis.cpp   ADM_vidSRT.cpp \
 ADM_resizebis.hxx    ADM_vidSRT.h \
 ADM_resizeter.cpp  ADM_vidField.h  ADM_vidSRTRender.cpp \
 ADM_separateField.cpp  ADM_vidFieldUnblend.cpp ADM_vidSRTload.cpp \
@@ -124,8 +121,8 @@
 ADM_vidFieldUtil.h  ADM_vidSalt.h \
 ADM_vidFields.cpp ADM_vidSeparateField.cpp \
 ADM_vidAnimated.cpp  ADM_vidFlipV.cpp  ADM_vidSeparateField.h \
-ADM_vidAnimated.h  ADM_vidFlipV.h  ADM_vidSoften.cpp \
-ADM_vidAnimated_param.h   ADM_vidSoften.h \
+ADM_vidAnimated.h  ADM_vidFlipV.h  \
+ADM_vidAnimated_param.h   \
 ADM_vidAsharp.cpp   ADM_vidStabilize.cpp \
 ADM_vidFont.cpp ADM_vidStabilize.h \
 ADM_vidBlend.cpp ADM_vidFont.h ADM_vidSwapFields.cpp \
@@ -162,6 +159,6 @@
 INCLUDES = $(all_includes) -I../ADM_libraries -I../ADM_libraries/ADM_utilities -I../ADM_libraries/ADM_lavutil \
 			 $(FREETYPE_CFLAGS) $(ALTIVEC_SWITCH) -I../ADM_userInterfaces/ADM_commonUI -I../ADM_inputs
 noinst_HEADERS = ADM_vidlavdeint.h ADM_mpdetc.h ADM_vidKernelDeint.h \
-					ADM_vidForcedPP.h ADM_vidSoften.h ADM_cache.h ADM_vidDecTel_param.h ADM_vidDecDec_param.h \
+					ADM_vidForcedPP.h  ADM_cache.h ADM_vidDecTel_param.h ADM_vidDecDec_param.h \
 					ADM_vidMSmooth_param.h ADM_vidEqualizer.h ADM_vobsubinfo.h ADM_vidVobSub.h \
 		ADM_lavpp_deintparam.h ADM_vidEq2.h ADM_vidASS.h

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidFade.cpp (from rev 2489, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidFade.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidFade.cpp	2006-10-31 15:59:58 UTC (rev 2489)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidFade.cpp	2007-01-10 19:52:36 UTC (rev 2699)
@@ -0,0 +1,293 @@
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &quot;config.h&quot;
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;math.h&gt;
+#include &lt;ADM_assert.h&gt;
+
+#include &quot;config.h&quot;
+#include &quot;fourcc.h&quot;
+#include &quot;avio.hxx&quot;
+#include &quot;avi_vars.h&quot;
+
+#include &quot;ADM_toolkit/toolkit.hxx&quot;
+#include &quot;ADM_editor/ADM_edit.hxx&quot;
+#include &quot;ADM_video/ADM_genvideo.hxx&quot;
+#include&quot;ADM_video/ADM_vidField.h&quot;
+#include&quot;ADM_video/ADM_cache.h&quot;
+
+#include &quot;ADM_osSupport/ADM_debugID.h&quot;
+#define MODULE_NAME MODULE_FILTER
+#include &quot;ADM_osSupport/ADM_debug.h&quot;
+#include &quot;ADM_filter/video_filters.h&quot;
+#include &quot;ADM_vidFade_param.h&quot;
+
+#include &quot;ADM_userInterfaces/ADM_commonUI/DIA_factory.h&quot;
+
+class AVDM_Fade : public AVDMGenericVideoStream
+{
+  VideoCache      *vidCache;
+  VIDFADE_PARAM   *_param;
+  uint16_t         lookupLuma[256][256];
+  uint16_t         lookupChroma[256][256];
+  uint8_t         buildLut(void);
+  public:
+                                
+                    AVDM_Fade(AVDMGenericVideoStream *in,CONFcouple *couples);    
+                    ~AVDM_Fade(void);
+    uint8_t         getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
+                                          ADMImage *data,uint32_t *flags);
+        
+    char            *printConf( void );
+    uint8_t         configure(AVDMGenericVideoStream *in);
+    uint8_t         getCoupledConf( CONFcouple **couples);
+};
+
+static FILTER_PARAM fadeParam={4,{&quot;startFade&quot;,&quot;endFade&quot;,&quot;inOut&quot;,&quot;toBlack&quot;}};
+
+BUILD_CREATE(fade_create,AVDM_Fade);
+SCRIPT_CREATE(fade_script,AVDM_Fade,fadeParam);
+
+/*************************************/
+uint8_t AVDM_Fade::configure(AVDMGenericVideoStream *in)
+{
+  uint32_t mx=_info.nb_frames;
+  _in=in;
+  
+  diaMenuEntry menuE[2]={{0,_(&quot;Out&quot;),_(&quot;Fade out&quot;)},{1,_(&quot;In&quot;),_(&quot;Fade in&quot;)}};
+  uint32_t start,end;
+  VIDFADE_PARAM param=*_param;
+  
+while(1)
+{
+    diaElemMenu     menu(&amp;(param.inOut),_(&quot;Fade Type&quot;), 2,menuE);
+    diaElemUInteger start(&amp;(param.startFade),_(&quot;Start frame&quot;),0,mx);
+    diaElemUInteger end(&amp;(param.endFade),_(&quot;End frame&quot;),0,mx);
+    diaElemToggle   black(&amp;(param.toBlack),_(&quot;Fade to black&quot;));
+    
+    diaElem *elems[4]={&amp;menu,&amp;start,&amp;end,&amp;black};
+  
+    if( diaFactoryRun(&quot;Fade&quot;,4,elems))
+    {
+      // Check it is consistent
+      if(param.startFade&gt;=param.endFade || (param.startFade&gt;=mx) || (param.endFade&gt;=mx))
+      {
+        GUI_Error_HIG(_(&quot;Parameter Error&quot;),_(&quot;Start must be before end, and both within video # of frames.&quot;));
+        continue; 
+      }
+      //
+      *_param=param;
+      return 1;
+    }else
+        return 0;
+} 
+  return 1;
+}
+
+char *AVDM_Fade::printConf( void )
+{
+  static char buf[50];
+
+        //ADM_assert(_param);
+  sprintf((char *)buf,&quot; Fade : Start %u End %u&quot;,_param-&gt;startFade,_param-&gt;endFade);
+  if(_param-&gt;inOut) strcat(buf,&quot; In&quot;); else strcat(buf,&quot; Out&quot;);
+  return buf;
+}
+
+
+AVDM_Fade::AVDM_Fade(AVDMGenericVideoStream *in,CONFcouple *couples)
+
+{
+                
+  int count = 0;
+  char buf[80];
+  unsigned int *p;
+
+  _in=in;         
+  memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));    
+  _info.encoding=1;
+  vidCache=new VideoCache(3,in);
+  
+  _param=new VIDFADE_PARAM;
+  if(couples)
+  {
+    GET(startFade);
+    GET(endFade);
+    GET(inOut);
+    GET(toBlack);
+    
+  }else
+  {
+    _param-&gt;startFade=0; 
+    _param-&gt;endFade=_info.nb_frames-1;
+    _param-&gt;inOut=0;
+    _param-&gt;toBlack=0;
+  }
+  buildLut();
+}
+//________________________________________________________
+uint8_t AVDM_Fade::getCoupledConf( CONFcouple **couples)
+{
+  *couples=new CONFcouple(4);
+  CSET(startFade);
+  CSET(endFade);
+  CSET(inOut);
+  CSET(toBlack);
+  return 1;
+}
+//________________________________________________________
+AVDM_Fade::~AVDM_Fade(void)
+{
+                
+  if(vidCache) delete vidCache;                
+  vidCache=NULL;   
+  if(_param) delete _param;
+  _param=NULL;
+}
+uint8_t AVDM_Fade::getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
+                                            ADMImage *data,uint32_t *flags)
+{
+
+  uint32_t num_frames,tgt;
+  
+  ADMImage *src;
+
+  num_frames=_info.nb_frames;   // ??
+
+  tgt=frame+_info.orgFrame;
+  if(frame&gt;=num_frames)
+  {
+    printf(&quot;[Fade] out of bound\n&quot;);
+    return 0;
+  }
+
+  src=vidCache-&gt;getImage(frame);
+  if(!src) return 0;
+  if(tgt&gt;_param-&gt;endFade || tgt &lt;_param-&gt;startFade ||_param-&gt;endFade==_param-&gt;startFade )
+  {
+    //printf(&quot;Cur %u start %u end %u\n&quot;,tgt,_param-&gt;startFade,_param-&gt;endFade);
+    data-&gt;duplicate(src);
+    vidCache-&gt;unlockAll();
+    return 1;
+  }
+  uint8_t *s,*d,*s2;
+  uint16_t *index,*invertedIndex;
+  uint32_t count=_info.width*_info.height,w;
+  float num,den;
+  
+  den=_param-&gt;endFade-_param-&gt;startFade;
+  
+  num=tgt-_param-&gt;startFade;
+  
+  num=num/den;
+  num*=255.;
+  w=(uint32_t)floor(num+0.4);
+  
+//printf(&quot;w :%u\n&quot;,w);
+
+  s=src-&gt;data;
+  d=data-&gt;data;
+  if(_param-&gt;toBlack)
+  {
+        index=lookupLuma[w];
+        for(int i=0;i&lt;count;i++)
+        {
+          *d++=(index[*s++]&gt;&gt;8);
+        }
+        // Now do chroma
+        count&gt;&gt;=2;
+        s=UPLANE(src);
+        d=UPLANE(data);
+        index=lookupChroma[w];
+        for(int i=0;i&lt;count;i++)
+        {
+          *d++=(index[*s++]&gt;&gt;8);
+        }
+        s=VPLANE(src);
+        d=VPLANE(data);
+        for(int i=0;i&lt;count;i++)
+        {
+          *d++=(index[*s++]&gt;&gt;8);
+        }
+  }
+  else
+  {
+        uint32_t x,alpha;
+        ADMImage *final;
+
+        final=vidCache-&gt;getImage(_param-&gt;endFade-_info.orgFrame);
+        if(!final)
+        {
+              data-&gt;duplicate(src);
+              vidCache-&gt;unlockAll();
+              return 1;
+        }
+
+        s2=final-&gt;data;
+
+        index=lookupLuma[w];
+        
+        invertedIndex=lookupLuma[255-w];
+        for(int i=0;i&lt;count;i++)
+        {
+          *d++=(index[*s++]+invertedIndex[*s2++])&gt;&gt;8;
+        }
+        // Now do chroma
+        count&gt;&gt;=2;
+        s=UPLANE(src);
+        d=UPLANE(data);
+        s2=UPLANE(final);
+        index=lookupChroma[w];
+        invertedIndex=lookupChroma[255-w];
+        for(int i=0;i&lt;count;i++)
+        {
+            *d++=(index[*s++]+invertedIndex[*s2++]-(128&lt;&lt;8))&gt;&gt;8;
+        }
+        s=VPLANE(src);
+        d=VPLANE(data);
+        s2=VPLANE(final);
+        for(int i=0;i&lt;count;i++)
+        {
+            *d++=(index[*s++]+invertedIndex[*s2++]-(128&lt;&lt;8))&gt;&gt;8;
+            
+        }
+  }
+  vidCache-&gt;unlockAll();
+  return 1;
+}
+
+uint8_t AVDM_Fade::buildLut(void)
+{
+  float f,ration;
+  for(int i=0;i&lt;256;i++)
+  {
+    if(!_param-&gt;inOut) ration=255-i;
+    else ration=i;
+    for(int r=0;r&lt;256;r++)
+    {
+      f=r;
+      f=f*ration;
+      lookupLuma[i][r]=(uint16_t)(f+0.4);
+
+      f=r-128;
+      f=f*ration;
+      lookupChroma[i][r]=(128&lt;&lt;8)+(uint16_t)(f+0.4);
+
+    }
+    
+  }
+  return 1;
+}
+//EOF
+
+
+

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidFade_param.h (from rev 2489, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidFade_param.h)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidResampleFPS.cpp (from rev 2530, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidResampleFPS.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidResampleFPS.cpp	2006-11-01 11:17:21 UTC (rev 2530)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidResampleFPS.cpp	2007-01-10 19:52:36 UTC (rev 2699)
@@ -0,0 +1,360 @@
+/***************************************************************************
+                          Resample fps
+                             -------------------
+    begin                : Wed Nov 6 2002
+    copyright            : (C) 2002 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &lt;stdio.h&gt;
+#include &lt;math.h&gt;
+
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;ADM_assert.h&gt;
+
+#include &quot;config.h&quot;
+#include &quot;fourcc.h&quot;
+#include &quot;avio.hxx&quot;
+#include &quot;config.h&quot;
+#include &quot;avi_vars.h&quot;
+#ifdef HAVE_ENCODER
+
+
+#include &quot;ADM_toolkit/toolkit.hxx&quot;
+#include &quot;ADM_editor/ADM_edit.hxx&quot;
+#include &quot;ADM_video/ADM_genvideo.hxx&quot;
+#include &quot;ADM_video/ADM_vidFlipV.h&quot;
+#include &quot;ADM_filter/video_filters.h&quot;
+#include &quot;DIA_enter.h&quot;
+#include &quot;ADM_video/ADM_cache.h&quot;
+#include &quot;ADM_osSupport/ADM_cpuCap.h&quot;
+#include &quot;admmangle.h&quot;
+
+#include &quot;ADM_userInterfaces/ADM_commonUI/DIA_factory.h&quot;
+
+static FILTER_PARAM ResampParam={2,{&quot;newfps&quot;,&quot;use_linear&quot;}};
+typedef struct FPS_Param
+{
+  uint32_t  newfps; 
+  uint32_t  use_linear;
+}FPS_Param;
+class  ADMVideoResampleFPS:public AVDMGenericVideoStream
+{
+
+  protected:
+    AVDMGenericVideoStream  *_in;           
+    virtual char            *printConf(void);
+            FPS_Param       *_param;    
+            VideoCache      *vidCache; 
+  public:
+                
+                        ADMVideoResampleFPS(  AVDMGenericVideoStream *in,CONFcouple *setup);
+                        ADMVideoResampleFPS(  AVDMGenericVideoStream *in,uint32_t target1000);
+    virtual             ~ADMVideoResampleFPS();
+    virtual uint8_t     configure(AVDMGenericVideoStream *in);
+    virtual uint8_t     getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
+                                          ADMImage *data,uint32_t *flags);
+
+             uint8_t     getCoupledConf( CONFcouple **couples);
+}     ;
+
+SCRIPT_CREATE(resamplefps_script,ADMVideoResampleFPS,ResampParam);
+BUILD_CREATE(resamplefps_create,ADMVideoResampleFPS);
+
+AVDMGenericVideoStream *createResampleFps(AVDMGenericVideoStream *in,uint32_t targetfps1000)
+{
+  return new ADMVideoResampleFPS(in,targetfps1000);
+}
+
+uint8_t ADMVideoResampleFPS::configure(AVDMGenericVideoStream *in)
+{
+  float f=_param-&gt;newfps; 
+  f/=1000;
+  
+  _in=in;
+  
+    diaElemFloat fps(&amp;f,_(&quot;New FPS&quot;),1,200.);
+    diaElemToggle blend(&amp;(_param-&gt;use_linear),_(&quot;Blend&quot;));
+    
+    diaElem *elems[2]={&amp;fps,&amp;blend};
+  
+    if( diaFactoryRun(&quot;Resample FPS&quot;,2,elems))
+    {
+        f*=1000;
+      _param-&gt;newfps=(uint32_t)floor(f+0.4); 
+      _info.fps1000=_param-&gt;newfps;
+      return 1;
+    }
+    return 0;
+}
+char *ADMVideoResampleFPS::printConf( void )
+{
+  static char buf[50];
+        
+  sprintf((char *)buf,&quot; Resample to %2.2f fps (blend:%d)&quot;,(double)_param-&gt;newfps/1000.,
+                _param-&gt;use_linear);
+  return buf;
+}
+
+ADMVideoResampleFPS::ADMVideoResampleFPS(  AVDMGenericVideoStream *in,uint32_t target)
+{
+
+  _in=in;         
+  memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));    
+  _info.encoding=1; 
+  _param=new  FPS_Param;
+   
+    _param-&gt;newfps =target;                
+    _param-&gt;use_linear=1;
+ 
+  double newlength;
+  
+  newlength=_info.nb_frames;
+  newlength/=_info.fps1000;
+  newlength*=_param-&gt;newfps;
+  _info.nb_frames=(uint32_t)floor(newlength);
+  _info.fps1000=_param-&gt;newfps;
+  printf(&quot;[Resample FPS] %u -&gt; %u\n&quot;,_in-&gt;getInfo()-&gt;nb_frames,_info.nb_frames);
+  vidCache=new VideoCache(3,_in);
+
+}
+
+ADMVideoResampleFPS::ADMVideoResampleFPS(  AVDMGenericVideoStream *in,CONFcouple *couples)
+{
+  
+  _in=in;         
+  memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));    
+  _info.encoding=1; 
+  _param=new  FPS_Param;
+   
+  if(couples)
+  {                 
+    GET(newfps);    
+    GET(use_linear); 
+  }
+  else
+  {
+    _param-&gt;newfps =_info.fps1000;                
+    _param-&gt;use_linear=0;
+  }      
+ 
+  double newlength;
+  
+  newlength=_info.nb_frames;
+  newlength/=_info.fps1000;
+  newlength*=_param-&gt;newfps;
+  _info.nb_frames=(uint32_t)floor(newlength);
+  _info.fps1000=_param-&gt;newfps;
+  vidCache=new VideoCache(3,_in);
+  
+}
+ADMVideoResampleFPS::~ADMVideoResampleFPS()
+{
+  delete _param;
+  delete vidCache;
+  
+}
+uint8_t ADMVideoResampleFPS::getCoupledConf( CONFcouple **couples)
+{
+  ADM_assert(_param);
+  *couples=new CONFcouple(2);
+
+
+                CSET(newfps);
+                CSET(use_linear);
+                return 1;
+}
+#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+static uint64_t low,high;
+static void blendMMX(uint8_t *src, uint8_t *src2, uint8_t *dst, uint8_t alpha, uint8_t beta,uint32_t count)
+{
+uint32_t left=count&amp;3;
+#define EXPAND(x) (x)+((x)&lt;&lt;16)+((x)&lt;&lt;32) +((x)&lt;&lt;48)
+        high=alpha;
+        low=beta;
+        high=EXPAND(high);
+        low=EXPAND(low);
+        count&gt;&gt;=2;
+#ifdef GCC_2_95_X
+         __asm__ __volatile__ (
+                                &quot;movq &quot;Mangle(high)&quot;, %mm0\n&quot;
+                                &quot;movq &quot;Mangle(low)&quot;,  %mm1\n&quot;                                
+                                &quot;pxor %mm7        ,  %mm7\n&quot;
+                                :: );
+#else
+         __asm__ __volatile__ (
+                                &quot;movq &quot;Mangle(high)&quot;, %%mm0\n&quot;
+                                &quot;movq &quot;Mangle(low)&quot;,  %%mm1\n&quot;                                
+                                &quot;pxor %%mm7        ,  %%mm7\n&quot;
+                                :: );
+#endif
+
+        while(count&gt;0)
+        {
+                __asm__ __volatile__ (
+                               
+                                &quot;movd      (%0),  %%mm2\n&quot;
+                                &quot;movd      (%1),  %%mm3\n&quot;                               
+
+                                &quot;punpcklbw %%mm7, %%mm2\n&quot;
+                                &quot;punpcklbw %%mm7, %%mm3\n&quot;
+
+                                &quot;pmullw   %%mm0, %%mm2\n&quot;
+                                &quot;pmullw   %%mm1, %%mm3\n&quot;
+                
+                                &quot;paddw    %%mm3, %%mm2\n&quot;
+
+                                &quot;psrlw    $8,    %%mm2 \n&quot;
+
+                                &quot;packuswb %%mm2,%%mm2\n&quot;
+                                &quot;movd     %%mm2, (%2)\n&quot;
+
+                                :: &quot;r&quot; (src), &quot;r&quot; (src2), &quot;r&quot; (dst) );
+                                
+                src+=4;
+                src2+=4;
+                dst+=4;
+                count--;
+        }
+        __asm__ __volatile__ (
+                                &quot;emms\n&quot;
+                                :: );
+        for(uint32_t i=0;i&lt;left;i++)
+        {
+                dst[i] = ((src[i]*alpha) + (src2[i]*beta))&gt;&gt;8;
+        }
+}
+
+#endif
+
+uint8_t ADMVideoResampleFPS::getFrameNumberNoAlloc(uint32_t frame,
+                                             uint32_t *len,
+                                             ADMImage *data,
+                                             uint32_t *flags)
+{
+  ADMImage *mysrc1=NULL;
+  ADMImage *mysrc2=NULL;
+
+  ADM_assert(frame&lt;_info.nb_frames);
+  // read uncompressed frame
+  
+  // What frame are we seeking ?
+  double f;
+  uint32_t page=_info.width*_info.height;
+  
+  f=frame;
+  f*=_in-&gt;getInfo()-&gt;fps1000;
+  f/=_param-&gt;newfps;
+  
+  if(!_param-&gt;use_linear)
+  {
+      uint32_t nw;
+      
+      nw=(uint32_t)floor(f+0.4);
+      if(nw&gt;_in-&gt;getInfo()-&gt;nb_frames-1)
+        nw=_in-&gt;getInfo()-&gt;nb_frames-1;
+    
+      mysrc1=vidCache-&gt;getImage(nw);
+      if(!mysrc1) return 0;
+      
+      memcpy(YPLANE(data),YPLANE(mysrc1),page);
+      memcpy(UPLANE(data),UPLANE(mysrc1),page&gt;&gt;2);
+      memcpy(VPLANE(data),VPLANE(mysrc1),page&gt;&gt;2);
+    
+      vidCache-&gt;unlockAll();
+      
+      return 1;
+  }
+  /* With linear blending */
+  uint32_t nw;
+  uint8_t lowweight;
+  uint8_t highweight;
+  
+  double diff;
+  
+  nw=(uint32_t)floor(f);
+  diff=f-floor(f);
+  highweight = (uint8_t)floor(diff*256);
+  lowweight = 256 - highweight;
+
+  if(nw&gt;=_in-&gt;getInfo()-&gt;nb_frames-1)
+    {
+      printf(&quot;[ResampleFps] In %u Out %u\n&quot;,frame,nw);
+      nw=_in-&gt;getInfo()-&gt;nb_frames-1;
+      highweight=0;
+    }
+  //printf(&quot;New:%lu old:%lu\n&quot;,frame,nw);
+
+  if(highweight == 0)
+    {
+      mysrc1=vidCache-&gt;getImage(nw);  
+      if(!mysrc1) return 0;
+      
+      memcpy(YPLANE(data),YPLANE(mysrc1),page);
+      memcpy(UPLANE(data),UPLANE(mysrc1),page&gt;&gt;2);
+      memcpy(VPLANE(data),VPLANE(mysrc1),page&gt;&gt;2);
+      
+      vidCache-&gt;unlockAll();
+    }
+  else
+    {
+      mysrc1=vidCache-&gt;getImage(nw);
+      mysrc2=vidCache-&gt;getImage(nw+1);
+      if(!mysrc1 || !mysrc2) return 0;
+      
+      uint8_t *out, *in1, *in2;
+      uint32_t count;
+      uint32_t idx;
+      
+      out = YPLANE(data);
+      in1 = YPLANE(mysrc1);
+      in2 = YPLANE(mysrc2);
+        
+      count = page;
+
+#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
+        if(CpuCaps::hasMMX())
+                blendMMX(in1,in2,out,lowweight,highweight,(count*3)&gt;&gt;1);
+        else
+#endif
+      {
+      for(idx = 0; idx &lt; count; ++idx)
+	out[idx] = ((in1[idx]*lowweight) + (in2[idx]*highweight))&gt;&gt;8;
+
+      out = UPLANE(data);
+      in1 = UPLANE(mysrc1);
+      in2 = UPLANE(mysrc2);
+      count = page&gt;&gt;2;
+
+      for(idx = 0; idx &lt; count; ++idx)
+        out[idx] = ((in1[idx]*lowweight) + (in2[idx]*highweight))&gt;&gt;8;      
+
+
+      out = VPLANE(data);
+      in1 = VPLANE(mysrc1);
+      in2 = VPLANE(mysrc2);
+      count = page&gt;&gt;2;
+
+      for(idx = 0; idx &lt; count; ++idx)
+	out[idx] = ((in1[idx]*lowweight) + (in2[idx]*highweight))&gt;&gt;8;
+      }
+
+      vidCache-&gt;unlockAll();
+    }
+  return 1;
+ 
+}
+
+
+
+#endif

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSoften.cpp (from rev 2530, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSoften.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSoften.cpp	2006-11-01 11:17:21 UTC (rev 2530)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSoften.cpp	2007-01-10 19:52:36 UTC (rev 2699)
@@ -0,0 +1,331 @@
+//
+// C++ Implementation: Soften
+//
+// Description: 
+//
+// See .h file
+//
+// Author: mean &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>&gt;, (C) 2004
+//
+// Copyright: See COPYING file that comes with this distribution
+//
+//
+
+//
+//	This is the very unoptimized version
+//	could use some stuff and some mmx too
+//
+
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;ADM_assert.h&gt;
+#include &lt;math.h&gt;
+#include &lt;math.h&gt;
+#include &lt;iconv.h&gt;
+#include &quot;config.h&quot;
+
+
+#include &quot;fourcc.h&quot;
+#include &quot;avio.hxx&quot;
+
+#include &quot;avi_vars.h&quot;
+
+#include &quot;ADM_toolkit/toolkit.hxx&quot;
+#include &quot;ADM_editor/ADM_edit.hxx&quot;
+#include &quot;ADM_video/ADM_genvideo.hxx&quot;
+
+#include &quot;ADM_osSupport/ADM_debugID.h&quot;
+#define MODULE_NAME MODULE_FILTER
+#include &quot;ADM_osSupport/ADM_debug.h&quot;
+
+
+
+#include &quot;ADM_vidSoften.h&quot;
+#include &quot;DIA_enter.h&quot;
+#include &quot;ADM_filter/video_filters.h&quot;
+
+
+#include &quot;ADM_userInterfaces/ADM_commonUI/DIA_factory.h&quot;
+
+static FILTER_PARAM softParam={3,{&quot;radius&quot;,&quot;luma&quot;,&quot;chroma&quot;}};
+
+
+SCRIPT_CREATE(soften_script,ADMVideoMaskedSoften,softParam);
+BUILD_CREATE(soften_create,ADMVideoMaskedSoften);
+
+extern uint8_t distMatrix[256][256];
+extern uint32_t fixMul[16];
+
+
+uint8_t ADMVideoMaskedSoften::configure( AVDMGenericVideoStream *instream)
+{
+        _in=instream;
+        /*uint32_t luma,chroma;
+	uint32_t radius;
+	*/
+        
+        diaElemUInteger luma(&amp;(_param-&gt;luma),_(&quot;Luma Treshold&quot;),0,255);
+        diaElemUInteger chroma(&amp;(_param-&gt;chroma),_(&quot;Chroma Treshold&quot;),0,255);
+        diaElemUInteger radius(&amp;(_param-&gt;radius),_(&quot;Radius&quot;),1,60);
+	  
+    diaElem *elems[3]={&amp;luma,&amp;chroma,&amp;radius};
+  
+    return diaFactoryRun(&quot;Soften&quot;,3,elems);
+}
+uint8_t	ADMVideoMaskedSoften::getCoupledConf( CONFcouple **couples)
+{
+
+			*couples=new CONFcouple(3);
+
+			CSET(radius);
+			CSET(luma);
+			CSET(chroma);
+
+		return 1;	
+}
+char *ADMVideoMaskedSoften::printConf( void )
+{
+ 	static char buf[50];
+ 	
+ 	sprintf((char *)buf,&quot; Soften : radius: %lu l:%lu c:%lu&quot;, 
+		_param-&gt;radius,_param-&gt;luma, _param-&gt;chroma);
+        return buf;
+}
+
+ADMVideoMaskedSoften::~ADMVideoMaskedSoften()
+{
+	if(_uncompressed)
+ 		delete _uncompressed;	
+ 	_uncompressed=NULL;
+}
+
+
+ ADMVideoMaskedSoften::ADMVideoMaskedSoften( AVDMGenericVideoStream *in,CONFcouple *couples)
+{
+		
+		_uncompressed=NULL;
+		_in=in;
+		ADM_assert(in);
+		if(!couples)
+		{
+			
+			_param=NEW(MaskedSoften_CONF);
+	    		_param-&gt;radius=2; 
+	    		_param-&gt;luma=5;
+			_param-&gt;chroma=5;
+			
+	    	}
+		else
+		{
+			_param=NEW(MaskedSoften_CONF);
+			GET(radius);
+			GET(luma);
+			GET(chroma);
+			
+						
+		}
+		ADM_assert(in);
+		
+		memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));	
+			    	
+	    	//_uncompressed=new uint8_t[3*_info.width*_info.height];	
+		_uncompressed=new ADMImage(_info.width,_info.height);	
+		
+
+}
+uint8_t ADMVideoMaskedSoften::getFrameNumberNoAlloc(uint32_t frame,
+				uint32_t *len,
+   				ADMImage *data,
+				uint32_t *flags)
+{
+		uint32_t page=_info.width*_info.height;
+		int32_t radius=_param-&gt;radius;
+		uint32_t offset;
+		
+		int blockx,blocky;
+		
+		*len=(page*3)&gt;&gt;1;
+		if(frame&gt;=_info.nb_frames) return 0;		
+		
+				
+		if(!_in-&gt;getFrameNumberNoAlloc(frame, len,_uncompressed,flags))
+				 		return 0;
+
+		// do luma only ATM
+		// copy chroma
+		memcpy(UPLANE(data),UPLANE(_uncompressed),page&gt;&gt;2);
+		memcpy(VPLANE(data),VPLANE(_uncompressed),page&gt;&gt;2);
+		
+		// for luma, the radius first lines /last lines are unchanged
+		memcpy(YPLANE(data),YPLANE(_uncompressed),radius*_info.width);
+		
+		offset=page-_info.width*radius-1;
+		
+		memcpy(YPLANE(data)+offset,
+			YPLANE(_uncompressed)+offset,
+			radius*_info.width);
+
+		uint8_t *src,*dst;
+		uint32_t val,cur,coef;
+		//
+		data-&gt;copyInfo(_uncompressed);
+		// optimized one
+		if(radius==2) return radius5(YPLANE(_uncompressed),YPLANE(data));
+		if(radius==1) return radius3(YPLANE(_uncompressed),YPLANE(data));
+		
+		for(uint32_t y=radius;y&lt;_info.height-radius;y++)
+		{
+			src=YPLANE(_uncompressed)+y*_info.width;
+			dst=YPLANE(data)+y*_info.width;
+			
+			memcpy(dst,src,radius);
+			src+=radius;
+			dst+=radius;
+			
+			for(uint32_t x=radius;x&lt;_info.width-radius;x++)
+			{
+				coef=0;
+				val=0;
+			
+				for( blocky=-radius;blocky&lt;=radius;blocky++)
+				{
+					for( blockx=-radius;blockx&lt;=radius;blockx++)
+					{
+						cur=*(src+blockx+blocky*_info.width);
+						
+						if( distMatrix[cur][*src]&lt;=_param-&gt;luma)
+						{
+							coef++;
+							val+=cur;
+						}
+					
+					
+					}
+				}
+				ADM_assert(coef);
+				if(coef!=1)
+					val=(val+(coef&gt;&gt;1)-1)/coef;
+				*dst++=val;
+				src++;
+				
+				//*dst++=*src++;
+			}
+			memcpy(dst,src,radius);
+		
+		}	
+	return 1;
+}
+uint8_t ADMVideoMaskedSoften::radius5(uint8_t *_uncompressed, uint8_t *data) 
+{
+int blockx,blocky;
+uint32_t val,coef;
+
+uint8_t *src,*dst;
+uint8_t cur;
+
+uint8_t *c0,*c1,*c2,*c3,*c4,ref;
+
+
+
+	for(uint32_t y=2;y&lt;_info.height-2;y++)
+		{
+			src=_uncompressed+y*_info.width;
+			dst=data+y*_info.width;
+			
+			*dst++=*src++;
+			*dst++=*src++;
+			
+			for(uint32_t x=2;x&lt;_info.width-2;x++)
+			{
+				coef=0;
+				val=0;
+				c0=src-2-2*_info.width;
+				c1=c0+_info.width;
+				c2=c1+_info.width;
+				c3=c2+_info.width;
+				c4=c3+_info.width;
+				
+				ref=*src;
+					
+#define CHECK(x) cur=*x;if(distMatrix[cur][ref]&lt;=_param-&gt;luma) {coef++;val+=cur;}x++;					
+				for( blockx=5;blockx&gt;0;blockx--)
+				{
+					CHECK(c0);
+					CHECK(c1);
+					CHECK(c2);
+					CHECK(c3);
+					CHECK(c4);
+				}
+				ADM_assert(coef);
+				if(coef!=1)
+					val=(val+(coef&gt;&gt;1)-1)/coef;
+
+				*dst++=val;
+				src++;
+			}
+			*dst++=*src++;
+			*dst++=*src++;		
+		}	
+}
+uint8_t ADMVideoMaskedSoften::radius3(uint8_t *_uncompressed, uint8_t *data) 
+{
+int blockx,blocky;
+uint32_t val,coef;
+
+uint8_t *src,*dst;
+uint8_t cur;
+
+uint8_t *c0,*c1,*c2,ref;
+
+uint8_t *dist;
+
+	for(uint32_t y=1;y&lt;_info.height-1;y++)
+		{
+			src=_uncompressed+y*_info.width;
+			dst=data+y*_info.width;
+			
+			*dst++=*src++;
+			
+			
+			for(uint32_t x=1;x&lt;_info.width-1;x++)
+			{
+				coef=0;
+				val=0;
+				c0=src-1-_info.width;
+				c1=c0+_info.width;
+				c2=c1+_info.width;
+				
+				ref=*src;
+				dist=distMatrix[ref];
+#undef CHECK				
+#define CHECK(x) cur=*x;if(dist[cur]&lt;=_param-&gt;luma) {coef++;val+=cur;}x++;					
+					CHECK(c0);
+					CHECK(c0);
+					CHECK(c0);
+					
+					CHECK(c1);
+					CHECK(c1);					
+					CHECK(c1);
+					
+					CHECK(c2);
+					CHECK(c2);					
+					CHECK(c2);
+				
+					
+				ADM_assert(coef);
+				if(coef!=1)
+					val=(val+(coef&gt;&gt;1)-1)/coef;
+				*dst++=val;
+				src++;
+			}
+			*dst++=*src++;
+			
+		}	
+}
+
+
+
+
+
+

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidSoften.h (from rev 2489, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidSoften.h)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-01-09 19:59:26 UTC (rev 2698)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-01-10 19:52:36 UTC (rev 2699)
@@ -7,6 +7,9 @@
 #INCLUDES = $(all_includes) 
 
 libADM_videoFilter_a_SOURCES =  \
+ ADM_vidFade.cpp \
+ ADM_vidResampleFPS.cpp \
+ ADM_vidSoften.cpp \
  ADM_vidBSmear.cpp \
  ADM_vidAddBorder.cpp \
  ADM_vidFlux.cpp \


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000026.html">[Avidemux-svn-commit] r2698 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory
</A></li>
	<LI>Next message: <A HREF="000028.html">[Avidemux-svn-commit] r2700 -	branches/avidemux_2.4_branch/avidemux/ADM_video
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27">[ date ]</a>
              <a href="thread.html#27">[ thread ]</a>
              <a href="subject.html#27">[ subject ]</a>
              <a href="author.html#27">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
