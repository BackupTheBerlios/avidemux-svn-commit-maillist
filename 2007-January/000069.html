<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r2742 - in branches/avidemux_2.4_branch:	autononreg/utils avidemux/ADM_script avidemux/ADM_toolkit	avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk	avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-January/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r2742%20-%20in%20branches/avidemux_2.4_branch%3A%0A%09autononreg/utils%20avidemux/ADM_script%20avidemux/ADM_toolkit%0A%09avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk%0A%09avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2%0A%09avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui&In-Reply-To=%3C200701171951.l0HJpXgb018968%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000068.html">
   <LINK REL="Next"  HREF="000070.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r2742 - in branches/avidemux_2.4_branch:	autononreg/utils avidemux/ADM_script avidemux/ADM_toolkit	avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk	avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r2742%20-%20in%20branches/avidemux_2.4_branch%3A%0A%09autononreg/utils%20avidemux/ADM_script%20avidemux/ADM_toolkit%0A%09avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk%0A%09avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2%0A%09avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui&In-Reply-To=%3C200701171951.l0HJpXgb018968%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r2742 - in branches/avidemux_2.4_branch:	autononreg/utils avidemux/ADM_script avidemux/ADM_toolkit	avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk	avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2	avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui">mean at mail.berlios.de
       </A><BR>
    <I>Wed Jan 17 20:51:33 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000068.html">[Avidemux-svn-commit] r2741 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade
</A></li>
        <LI>Next message: <A HREF="000070.html">[Avidemux-svn-commit] r2743 - in	branches/avidemux_2.4_branch/avidemux:	ADM_inputs/ADM_mpegdemuxer ADM_toolkit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#69">[ date ]</a>
              <a href="thread.html#69">[ thread ]</a>
              <a href="subject.html#69">[ subject ]</a>
              <a href="author.html#69">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2007-01-17 20:51:32 +0100 (Wed, 17 Jan 2007)
New Revision: 2742

Added:
   branches/avidemux_2.4_branch/autononreg/utils/dirselect.js
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_toolkit/filesel.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/file_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/file_qt4.cpp
Log:
added directory selection + corresponding ecmascript

Added: branches/avidemux_2.4_branch/autononreg/utils/dirselect.js
===================================================================
--- branches/avidemux_2.4_branch/autononreg/utils/dirselect.js	2007-01-17 07:02:28 UTC (rev 2741)
+++ branches/avidemux_2.4_branch/autononreg/utils/dirselect.js	2007-01-17 19:51:32 UTC (rev 2742)
@@ -0,0 +1,30 @@
+//AD  &lt;- 
+/*
+	Simple script that scans the orgDir directory
+	and unpack all avi files
+	The resuling file is put in destDir directory
+
+	Using new directorySearch API
+
+*/
+var app = new Avidemux();
+var orgDir;
+var destDir;
+var reg =new RegExp(&quot;.$&quot;);
+/*
+	This is for unix
+	For windows change to
+	sep=&quot;\\&quot;;
+	reg2=new RegExp(&quot;\\.*\\&quot;);
+*/
+var sep=&quot;/&quot;;
+var extension;
+var target;
+//
+//
+//
+// 	select files from original &amp; target directories
+//
+	orgDir=dirSelect();
+	displayInfo(&quot;Selected :&quot;+orgDir);
+

Modified: branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp	2007-01-17 07:02:28 UTC (rev 2741)
+++ branches/avidemux_2.4_branch/avidemux/ADM_script/ADM_JSFunctions.cpp	2007-01-17 19:51:32 UTC (rev 2742)
@@ -53,6 +53,7 @@
 JSBool displayError(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
 JSBool displayInfo(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
 JSBool fileWriteSelect(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
+JSBool dirSelect(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
 JSBool fileReadSelect(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
 JSBool print(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval);
 
@@ -78,6 +79,7 @@
   {&quot;displayInfo&quot;,       displayInfo,        1},
   {&quot;fileReadSelect&quot;,    fileReadSelect,        0},
   {&quot;fileWriteSelect&quot;,   fileWriteSelect,        0},
+  {&quot;dirSelect&quot;,         dirSelect,        0},
   {&quot;print&quot;,             print,        1},
   {&quot;allFilesFrom&quot;,      allFilesFrom,        0},
   {&quot;nextFile&quot;,          nextFile,        0},
@@ -198,7 +200,18 @@
         ADM_dealloc(name);
         return JS_TRUE;
 }// end fileWriteSelect
-
+JSBool dirSelect(JSContext *cx, JSObject *obj, uintN argc, 
+                                       jsval *argv, jsval *rval)
+{
+        char name[1024];
+        // default return value
+        if(argc != 0)
+                return JS_FALSE;
+        if(!FileSel_SelectDir(_(&quot;Select a directory&quot;),name,1023, NULL))
+         return JS_FALSE;
+        *rval=STRING_TO_JSVAL(JS_NewStringCopyZ(cx,name));
+        return JS_TRUE;
+}
 JSBool print(JSContext *cx, JSObject *obj, uintN argc, 
                                        jsval *argv, jsval *rval)
 {// begin print

Modified: branches/avidemux_2.4_branch/avidemux/ADM_toolkit/filesel.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_toolkit/filesel.h	2007-01-17 07:02:28 UTC (rev 2741)
+++ branches/avidemux_2.4_branch/avidemux/ADM_toolkit/filesel.h	2007-01-17 19:51:32 UTC (rev 2742)
@@ -22,6 +22,7 @@
 void GUI_FileSelWrite(const char *label, char * * name);
 
 uint8_t FileSel_SelectRead(const char *title,char *target,uint32_t max, const char *source);
+uint8_t FileSel_SelectDir(const char *title,char *target,uint32_t max, const char *source);
 
 char *ADM_getBaseDir(void);
 char *ADM_getJobDir(void);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp	2007-01-17 07:02:28 UTC (rev 2741)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_toolkit_gtk/TLK_filesel.cpp	2007-01-17 19:51:32 UTC (rev 2742)
@@ -52,14 +52,13 @@
 static uint8_t          setFilter( GtkWidget *dialog);
 
 /**
-	Select a file
-		Target is the string allocated by caller that will receive the resule, maxlen byte
-		Source is a optionnal last file to replace the selector at the last dir used
-	@Title@ is the title of the dialog window
-	
-	Returns : 0 if error, 1 on success
-	
-
+    \fn FileSel_SelectRead(const char *title,char *target,uint32_t max, const char *source)
+    \brief allow to select a file
+    @return 0 on failure, 1 on success
+    @param title : window title 
+    @param target : where to copy the result (must be allocated by caller)
+    @param max : Max # of bytes that target can hold
+    @param source : where we start from
 */
 uint8_t FileSel_SelectRead(const char *title,char *target,uint32_t max, const char *source)
 {
@@ -142,7 +141,81 @@
 	gtk_widget_destroy(dialog);
 	return ret;
 }
+/**
+    \fn FileSel_SelectDir(const char *title,char *target,uint32_t max, const char *source)
+    \brief allow to select a directory
+    @return 0 on failure, 1 on success
+    @param title : window title 
+    @param target : where to copy the result (must be allocated by caller)
+    @param max : Max # of bytes that target can hold
+    @param source : where we start from
+*/
+uint8_t FileSel_SelectDir(const char *title,char *target,uint32_t max, const char *source)
+{
+	
+GtkWidget *dialog;
+uint8_t ret=0;
+gchar *selected_filename;
+gchar last;
+char *dupe=NULL,*tmpname=NULL;
+DIR *dir=NULL;
+	
+        dialog = gtk_file_chooser_dialog_new (&quot;Open File&quot;,
+                                      NULL,
+                                      GTK_FILE_CHOOSER_ACTION_SELECT_FOLDER,
+                                      GTK_STOCK_CANCEL, GTK_RESPONSE_CANCEL,
+                                      GTK_STOCK_OPEN, GTK_RESPONSE_ACCEPT,
+                                      NULL);
+        gtk_window_set_title (GTK_WINDOW (dialog),title);
+        gtk_register_dialog(dialog);
+        /* Set default dir if provided ..*/
+        if(source)
+        {
+                dupe=PathCanonize(source);
+                PathStripName(dupe);
+                if( (dir=opendir(dupe)) )
+                        {
+                                closedir(dir);
+                                gtk_file_chooser_set_filename(GTK_FILE_CHOOSER(dialog),(gchar *)source);
+                        }
+                delete [] dupe;
+        
+        }
+        else	//use pref
+        {
+                if( prefs-&gt;get(LASTDIR_READ,(ADM_filename **)&amp;tmpname))
+                {
+                        
+        
+                        dupe=PathCanonize(tmpname);
+                        PathStripName(dupe);
+  
+                        if( (dir=opendir(dupe)) )
+                        {
+                                closedir(dir);
+                                gtk_file_chooser_set_filename(GTK_FILE_CHOOSER(dialog),(gchar *)dupe);
+                        }
+                        delete [] dupe;
+                }
+        }
 
+        if(gtk_dialog_run(GTK_DIALOG(dialog))==GTK_RESPONSE_ACCEPT)
+        {
+          selected_filename= (gchar *) 	gtk_file_chooser_get_filename(GTK_FILE_CHOOSER(dialog));
+          if(strlen(selected_filename))  /* Nothing selected */
+          {
+            /* Check it is a dir ...*/
+            printf(&quot;&lt;%s&gt;\n&quot;,selected_filename);; 
+            strncpy(target,selected_filename,max);
+            target[max-1]=0;
+            ret=1;
+          }
+        }	
+        gtk_unregister_dialog(dialog);
+        gtk_widget_destroy(dialog);
+        return ret;
+}
+
 void GUI_FileSelWrite(const char *label, SELFILE_CB * cb)
 {				/* Create the selector */
     GUI_FileSel(label, cb, 1);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/file_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/file_none.cpp	2007-01-17 07:02:28 UTC (rev 2741)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/file_none.cpp	2007-01-17 19:51:32 UTC (rev 2742)
@@ -16,7 +16,10 @@
 #include &quot;ADM_toolkit/toolkit.hxx&quot;
 #include &quot;ADM_toolkit/filesel.h&quot;
 
-
+uint8_t FileSel_SelectDir(const char *title,char *target,uint32_t max, const char *source)
+{ 
+  return 0;
+}
 void GUI_FileSelRead(const char *label,SELFILE_CB cb) 
 {}
 void GUI_FileSelWrite(const char *label,SELFILE_CB cb) 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/file_qt4.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/file_qt4.cpp	2007-01-17 07:02:28 UTC (rev 2741)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/file_qt4.cpp	2007-01-17 19:51:32 UTC (rev 2742)
@@ -25,6 +25,13 @@
 extern QWidget *QuiMainWindows;
 static void GUI_FileSelSelect(const char *label, char **name, uint32_t access) ;
 //****************************************************************************************************
+uint8_t FileSel_SelectDir(const char *title,char *target,uint32_t max, const char *source)
+{
+  
+  GUI_Error_HIG(&quot;NOT DONE&quot;,&quot;This function has not been implemented yet.&quot;);
+  return 0; 
+}
+//****************************************************************************************************
 void GUI_FileSelRead(const char *label,SELFILE_CB cb) 
 {
   char *name;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000068.html">[Avidemux-svn-commit] r2741 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/glade
</A></li>
	<LI>Next message: <A HREF="000070.html">[Avidemux-svn-commit] r2743 - in	branches/avidemux_2.4_branch/avidemux:	ADM_inputs/ADM_mpegdemuxer ADM_toolkit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#69">[ date ]</a>
              <a href="thread.html#69">[ thread ]</a>
              <a href="subject.html#69">[ subject ]</a>
              <a href="author.html#69">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
