<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r2748 -	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-January/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r2748%20-%0A%09branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil&In-Reply-To=%3C200701211804.l0LI4x16030321%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000074.html">
   <LINK REL="Next"  HREF="000076.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r2748 -	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r2748%20-%0A%09branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil&In-Reply-To=%3C200701211804.l0LI4x16030321%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r2748 -	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil">mean at mail.berlios.de
       </A><BR>
    <I>Sun Jan 21 19:04:59 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000074.html">[Avidemux-svn-commit] r2747 -	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat
</A></li>
        <LI>Next message: <A HREF="000076.html">[Avidemux-svn-commit] r2750 - in branches/avidemux_2.4_branch: .	addons/tsscan avidemux/ADM_audio avidemux/ADM_audiocodec	avidemux/ADM_codecs avidemux/ADM_encoder	avidemux/ADM_inputs/ADM_matroska avidemux/ADM_osSupport	avidemux/ADM_video
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#75">[ date ]</a>
              <a href="thread.html#75">[ thread ]</a>
              <a href="subject.html#75">[ subject ]</a>
              <a href="author.html#75">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2007-01-21 19:04:51 +0100 (Sun, 21 Jan 2007)
New Revision: 2748

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/fifo.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/fifo.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/adler32.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/adler32.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/avutil.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/bswap.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/common.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/crc.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/crc.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/integer.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/integer.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/internal.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/intfloat_readwrite.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/intfloat_readwrite.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/lls.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/lls.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/log.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/log.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/mathematics.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/mathematics.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/md5.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/md5.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/mem.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/rational.c
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/rational.h
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/x86_cpu.h
Log:
update to ffmpeg svn

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/Makefile.am	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/Makefile.am	2007-01-21 18:04:51 UTC (rev 2748)
@@ -10,7 +10,8 @@
 EXTRA_DIST = avutil.h  common.h  integer.h   \
 mathematics.h  rational.h \
 bswap.h crc.h   intfloat_readwrite.h  md5.h    x86_cpu.h log.c \
-lls.h adler32.h adler32.c mem.c internal.h log.h lls.c
+lls.h adler32.h adler32.c mem.c internal.h log.h lls.c \
+fifo.c crc.c 
 
 
 ####### kdevelop will overwrite this part!!! (end)############

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/adler32.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/adler32.c	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/adler32.c	2007-01-21 18:04:51 UTC (rev 2748)
@@ -1,6 +1,24 @@
 /* adler32.c -- compute the Adler-32 checksum of a data stream
+ * This is a modified version based on adler32.c from the zlib library.
+ *
  * Copyright (C) 1995 Mark Adler
- * For conditions of distribution and use, see copyright notice in zlib.h
+ *
+ * This software is provided 'as-is', without any express or implied
+ * warranty.  In no event will the authors be held liable for any damages
+ * arising from the use of this software.
+ *
+ * Permission is granted to anyone to use this software for any purpose,
+ * including commercial applications, and to alter it and redistribute it
+ * freely, subject to the following restrictions:
+ *
+ * 1. The origin of this software must not be misrepresented; you must not
+ *    claim that you wrote the original software. If you use this software
+ *    in a product, an acknowledgment in the product documentation would be
+ *    appreciated but is not required.
+ * 2. Altered source versions must be plainly marked as such, and must not be
+ *    misrepresented as being the original software.
+ * 3. This notice may not be removed or altered from any source distribution.
+ *
  */
 
 #include &quot;common.h&quot;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/adler32.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/adler32.h	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/adler32.h	2007-01-21 18:04:51 UTC (rev 2748)
@@ -1,3 +1,23 @@
+/*
+ * copyright (c) 2006 Mans Rullgard
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
 #ifndef ADLER32_H
 #define ADLER32_H
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/avutil.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/avutil.h	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/avutil.h	2007-01-21 18:04:51 UTC (rev 2748)
@@ -1,18 +1,20 @@
 /*
  * copyright (c) 2006 Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michaelni at gmx.at</A>&gt;
  *
- * This library is free software; you can redistribute it and/or
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Lesser General Public
  * License as published by the Free Software Foundation; either
- * version 2 of the License, or (at your option) any later version.
+ * version 2.1 of the License, or (at your option) any later version.
  *
- * This library is distributed in the hope that it will be useful,
+ * FFmpeg is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  * Lesser General Public License for more details.
  *
  * You should have received a copy of the GNU Lesser General Public
- * License along with this library; if not, write to the Free Software
+ * License along with FFmpeg; if not, write to the Free Software
  * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
  */
 
@@ -33,11 +35,12 @@
 	#define ASMALIGN(ZEROBITS) &quot;.align 1&lt;&lt;&quot; #ZEROBITS &quot;\n\t&quot; 
 /* /MEANX
  */
+
 #define AV_STRINGIFY(s)         AV_TOSTRING(s)
 #define AV_TOSTRING(s) #s
 
-#define LIBAVUTIL_VERSION_INT   ((49&lt;&lt;16)+(0&lt;&lt;8)+0)
-#define LIBAVUTIL_VERSION       49.0.0
+#define LIBAVUTIL_VERSION_INT   ((49&lt;&lt;16)+(2&lt;&lt;8)+0)
+#define LIBAVUTIL_VERSION       49.2.0
 #define LIBAVUTIL_BUILD         LIBAVUTIL_VERSION_INT
 
 #define LIBAVUTIL_IDENT         &quot;Lavu&quot; AV_STRINGIFY(LIBAVUTIL_VERSION)
@@ -80,7 +83,7 @@
     PIX_FMT_YUV410P,   ///&lt; Planar YUV 4:1:0,  9bpp, (1 Cr &amp; Cb sample per 4x4 Y samples)
     PIX_FMT_YUV411P,   ///&lt; Planar YUV 4:1:1, 12bpp, (1 Cr &amp; Cb sample per 4x1 Y samples)
     PIX_FMT_RGB565,    ///&lt; Packed RGB 5:6:5, 16bpp, (msb)   5R 6G 5B(lsb), in cpu endianness
-    PIX_FMT_RGB555,    ///&lt; Packed RGB 5:5:5, 16bpp, (msb)1A 5R 5G 5B(lsb), in cpu endianness most significant bit to 1
+    PIX_FMT_RGB555,    ///&lt; Packed RGB 5:5:5, 16bpp, (msb)1A 5R 5G 5B(lsb), in cpu endianness most significant bit to 0
     PIX_FMT_GRAY8,     ///&lt;        Y        ,  8bpp
     PIX_FMT_MONOWHITE, ///&lt;        Y        ,  1bpp, 1 is white
     PIX_FMT_MONOBLACK, ///&lt;        Y        ,  1bpp, 0 is black
@@ -106,10 +109,9 @@
 
     PIX_FMT_RGB32_1,   ///&lt; Packed RGB 8:8:8, 32bpp, (msb)8R 8G 8B 8A(lsb), in cpu endianness
     PIX_FMT_BGR32_1,   ///&lt; Packed RGB 8:8:8, 32bpp, (msb)8B 8G 8R 8A(lsb), in cpu endianness
-  
+
     PIX_FMT_GRAY16BE,  ///&lt;        Y        , 16bpp, big-endian
     PIX_FMT_GRAY16LE,  ///&lt;        Y        , 16bpp, little-endian
-
     PIX_FMT_NB,        ///&lt; number of pixel formats, DO NOT USE THIS if you want to link with shared libav* because the number of formats might differ between versions
 };
 
@@ -118,11 +120,13 @@
 #define PIX_FMT_BGRA PIX_FMT_BGR32_1
 #define PIX_FMT_ARGB PIX_FMT_RGB32
 #define PIX_FMT_ABGR PIX_FMT_BGR32
+#define PIX_FMT_GRAY16 PIX_FMT_GRAY16BE
 #else
 #define PIX_FMT_RGBA PIX_FMT_BGR32
 #define PIX_FMT_BGRA PIX_FMT_RGB32
 #define PIX_FMT_ARGB PIX_FMT_BGR32_1
 #define PIX_FMT_ABGR PIX_FMT_RGB32_1
+#define PIX_FMT_GRAY16 PIX_FMT_GRAY16LE
 #endif
 
 #if LIBAVUTIL_VERSION_INT &lt; (50&lt;&lt;16)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/bswap.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/bswap.h	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/bswap.h	2007-01-21 18:04:51 UTC (rev 2748)
@@ -1,3 +1,23 @@
+/*
+ * copyright (c) 2006 Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michaelni at gmx.at</A>&gt;
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
 /**
  * @file bswap.h
  * byte swap.
@@ -16,8 +36,8 @@
 #  define LEGACY_REGS &quot;=q&quot;
 #endif
 
-#if defined(ARCH_X86) || defined(ARCH_X86_64)
-static always_inline uint16_t bswap_16(uint16_t x)
+#if defined(ARCH_X86)
+static av_always_inline uint16_t bswap_16(uint16_t x)
 {
   __asm(&quot;rorw $8, %0&quot;   :
         LEGACY_REGS (x) :
@@ -25,7 +45,7 @@
     return x;
 }
 
-static always_inline uint32_t bswap_32(uint32_t x)
+static av_always_inline uint32_t bswap_32(uint32_t x)
 {
 #if __CPU__ != 386
  __asm(&quot;bswap   %0&quot;:
@@ -62,12 +82,12 @@
 
 #elif defined(ARCH_SH4)
 
-static always_inline uint16_t bswap_16(uint16_t x) {
+static av_always_inline uint16_t bswap_16(uint16_t x) {
         __asm__(&quot;swap.b %0,%0&quot;:&quot;=r&quot;(x):&quot;0&quot;(x));
         return x;
 }
 
-static always_inline uint32_t bswap_32(uint32_t x) {
+static av_always_inline uint32_t bswap_32(uint32_t x) {
         __asm__(
         &quot;swap.b %0,%0\n&quot;
         &quot;swap.w %0,%0\n&quot;
@@ -90,12 +110,12 @@
 }
 #else
 
-static always_inline uint16_t bswap_16(uint16_t x){
+static av_always_inline uint16_t bswap_16(uint16_t x){
     return (x&gt;&gt;8) | (x&lt;&lt;8);
 }
 
 #ifdef ARCH_ARM
-static always_inline uint32_t bswap_32(uint32_t x){
+static av_always_inline uint32_t bswap_32(uint32_t x){
     uint32_t t;
     __asm__ (
       &quot;eor %1, %0, %0, ror #16 \n\t&quot;
@@ -106,7 +126,7 @@
     return x;
 }
 #else
-static always_inline uint32_t bswap_32(uint32_t x){
+static av_always_inline uint32_t bswap_32(uint32_t x){
     x= ((x&lt;&lt;8)&amp;0xFF00FF00) | ((x&gt;&gt;8)&amp;0x00FF00FF);
     return (x&gt;&gt;16) | (x&lt;&lt;16);
 }
@@ -129,7 +149,7 @@
     return r.ll;
 #endif
 }
-#endif  /* !ARCH_X86 */
+#endif  /* defined(ARCH_X86) */
 
 #endif  /* !HAVE_BYTESWAP_H */
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/common.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/common.h	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/common.h	2007-01-21 18:04:51 UTC (rev 2748)
@@ -1,3 +1,23 @@
+/*
+ * copyright (c) 2006 Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michaelni at gmx.at</A>&gt;
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
 /**
  * @file common.h
  * common internal and external api header.
@@ -6,9 +26,7 @@
 #ifndef COMMON_H
 #define COMMON_H
 
-#ifndef M_PI
-#define M_PI    3.14159265358979323846
-#endif
+#include &lt;inttypes.h&gt;
 
 #ifdef HAVE_AV_CONFIG_H
 /* only include the following when compiling package */
@@ -27,155 +45,45 @@
 #    include &lt;math.h&gt;
 #endif /* HAVE_AV_CONFIG_H */
 
-/* Suppress restrict if it was not defined in config.h.  */
-#ifndef restrict
-#    define restrict
-#endif
-
-#ifndef always_inline
+#ifndef av_always_inline
 #if defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 3 || __GNUC__ == 3 &amp;&amp; __GNUC_MINOR__ &gt; 0)
-#    define always_inline __attribute__((always_inline)) inline
+#    define av_always_inline __attribute__((always_inline)) inline
 #else
-#    define always_inline inline
+#    define av_always_inline inline
 #endif
 #endif
 
-#ifndef attribute_used
-#if defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 3 || __GNUC__ == 3 &amp;&amp; __GNUC_MINOR__ &gt; 0)
-#    define attribute_used __attribute__((used))
-#else
-#    define attribute_used
-#endif
-#endif
+#ifdef HAVE_AV_CONFIG_H
+#    include &quot;internal.h&quot;
+#endif /* HAVE_AV_CONFIG_H */
 
-#ifndef attribute_unused
+#ifndef attribute_deprecated
 #if defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 3 || __GNUC__ == 3 &amp;&amp; __GNUC_MINOR__ &gt; 0)
-#    define attribute_unused __attribute__((unused))
+#    define attribute_deprecated __attribute__((deprecated))
 #else
-#    define attribute_unused
+#    define attribute_deprecated
 #endif
 #endif
 
-#ifndef EMULATE_INTTYPES
-#   include &lt;inttypes.h&gt;
-#else
-    typedef signed char  int8_t;
-    typedef signed short int16_t;
-    typedef signed int   int32_t;
-    typedef unsigned char  uint8_t;
-    typedef unsigned short uint16_t;
-    typedef unsigned int   uint32_t;
-    typedef signed long long   int64_t;
-    typedef unsigned long long uint64_t;
-#endif /* EMULATE_INTTYPES */
-
-#ifndef PRId64
-#define PRId64 &quot;lld&quot;
+#ifndef INT64_C
+#define INT64_C(c)     (c ## LL)
+#define UINT64_C(c)    (c ## ULL)
 #endif
 
-#ifndef PRIu64
-#define PRIu64 &quot;llu&quot;
-#endif
-
-#ifndef PRIx64
-#define PRIx64 &quot;llx&quot;
-#endif
-
-#ifndef PRId32
-#define PRId32 &quot;d&quot;
-#endif
-
-#ifndef PRIdFAST16
-#define PRIdFAST16 PRId32
-#endif
-
-#ifndef PRIdFAST32
-#define PRIdFAST32 PRId32
-#endif
-
-#ifndef INT16_MIN
-#define INT16_MIN       (-0x7fff-1)
-#endif
-
-#ifndef INT16_MAX
-#define INT16_MAX       0x7fff
-#endif
-
-#ifndef INT32_MIN
-#define INT32_MIN       (-0x7fffffff-1)
-#endif
-
-#ifndef INT32_MAX
-#define INT32_MAX       0x7fffffff
-#endif
-
-#ifndef UINT32_MAX
-#define UINT32_MAX      0xffffffff
-#endif
-
-#ifndef INT64_MIN
-#define INT64_MIN       (-0x7fffffffffffffffLL-1)
-#endif
-
-#ifndef INT64_MAX
-#define INT64_MAX int64_t_C(9223372036854775807)
-#endif
-
-#ifndef UINT64_MAX
-#define UINT64_MAX uint64_t_C(0xFFFFFFFFFFFFFFFF)
-#endif
-
-#ifdef EMULATE_FAST_INT
-typedef signed char int_fast8_t;
-typedef signed int  int_fast16_t;
-typedef signed int  int_fast32_t;
-typedef unsigned char uint_fast8_t;
-typedef unsigned int  uint_fast16_t;
-typedef unsigned int  uint_fast32_t;
-typedef uint64_t      uint_fast64_t;
-#endif
-
-#ifndef INT_BIT
-#    if INT_MAX != 2147483647
-#        define INT_BIT 64
-#    else
-#        define INT_BIT 32
-#    endif
-#endif
-
-#ifndef int64_t_C
-#define int64_t_C(c)     (c ## LL)
-#define uint64_t_C(c)    (c ## ULL)
-#endif
-
-#if defined(__MINGW32__) &amp;&amp; !defined(BUILD_AVUTIL) &amp;&amp; defined(BUILD_SHARED_AV)
-#  define FF_IMPORT_ATTR __declspec(dllimport)
-#else
-#  define FF_IMPORT_ATTR
-#endif
-
-
-#ifdef HAVE_AV_CONFIG_H
-/* only include the following when compiling package */
-#    include &quot;internal.h&quot;
-#endif
-
 //rounded divison &amp; shift
 #define RSHIFT(a,b) ((a) &gt; 0 ? ((a) + ((1&lt;&lt;(b))&gt;&gt;1))&gt;&gt;(b) : ((a) + ((1&lt;&lt;(b))&gt;&gt;1)-1)&gt;&gt;(b))
 /* assume b&gt;0 */
 #define ROUNDED_DIV(a,b) (((a)&gt;0 ? (a) + ((b)&gt;&gt;1) : (a) - ((b)&gt;&gt;1))/(b))
-/* MEANX */
-#ifdef ABS
-#undef ABS
-#endif
-/* MEANX */
-#define ABS(a) ((a) &gt;= 0 ? (a) : (-(a)))
+#define FFABS(a) ((a) &gt;= 0 ? (a) : (-(a)))
+#define FFSIGN(a) ((a) &gt; 0 ? 1 : -1)
 
 #define FFMAX(a,b) ((a) &gt; (b) ? (a) : (b))
 #define FFMIN(a,b) ((a) &gt; (b) ? (b) : (a))
 
+#define FFSWAP(type,a,b) do{type SWAP_tmp= b; b= a; a= SWAP_tmp;}while(0)
+
 /* misc math functions */
-extern FF_IMPORT_ATTR const uint8_t ff_log2_tab[256];
+extern const uint8_t ff_log2_tab[256];
 
 static inline int av_log2(unsigned int v)
 {
@@ -212,7 +120,21 @@
 /* median of 3 */
 static inline int mid_pred(int a, int b, int c)
 {
-#if 0
+#ifdef HAVE_CMOV
+    int i=b;
+    asm volatile(
+        &quot;cmp    %2, %1 \n\t&quot;
+        &quot;cmovg  %1, %0 \n\t&quot;
+        &quot;cmovg  %2, %1 \n\t&quot;
+        &quot;cmp    %3, %1 \n\t&quot;
+        &quot;cmovl  %3, %1 \n\t&quot;
+        &quot;cmp    %1, %0 \n\t&quot;
+        &quot;cmovg  %1, %0 \n\t&quot;
+        :&quot;+&amp;r&quot;(i), &quot;+&amp;r&quot;(a)
+        :&quot;r&quot;(b), &quot;r&quot;(c)
+    );
+    return i;
+#elif 0
     int t= (a-b)&amp;((a-b)&gt;&gt;31);
     a-=t;
     b+=t;
@@ -241,7 +163,7 @@
  * @param a value to clip
  * @param amin minimum value of the clip range
  * @param amax maximum value of the clip range
- * @return cliped value
+ * @return clipped value
  */
 static inline int clip(int a, int amin, int amax)
 {
@@ -253,7 +175,7 @@
 /**
  * clip a signed integer value into the 0-255 range
  * @param a value to clip
- * @return cliped value
+ * @return clipped value
  */
 static inline uint8_t clip_uint8(int a)
 {
@@ -278,7 +200,19 @@
 #define MKTAG(a,b,c,d) (a | (b &lt;&lt; 8) | (c &lt;&lt; 16) | (d &lt;&lt; 24))
 #define MKBETAG(a,b,c,d) (d | (c &lt;&lt; 8) | (b &lt;&lt; 16) | (a &lt;&lt; 24))
 
-
+/*!
+ * \def GET_UTF8(val, GET_BYTE, ERROR)
+ * converts a utf-8 character (up to 4 bytes long) to its 32-bit ucs-4 encoded form
+ * \param val is the output and should be of type uint32_t. It holds the converted
+ * ucs-4 character and should be a left value.
+ * \param GET_BYTE gets utf-8 encoded bytes from any proper source. It can be
+ * a function or a statement whose return value or evaluated value is of type
+ * uint8_t. It will be executed up to 4 times for values in the valid utf-8 range,
+ * and up to 7 times in the general case.
+ * \param ERROR action that should be taken when an invalid utf-8 byte is returned
+ * from GET_BYTE. It should be a statement that jumps out of the macro,
+ * like exit(), goto, return, break, or continue.
+ */
 #define GET_UTF8(val, GET_BYTE, ERROR)\
     val= GET_BYTE;\
     {\
@@ -294,7 +228,43 @@
         }\
     }
 
-#if defined(ARCH_X86) || defined(ARCH_X86_64) || defined(ARCH_POWERPC)
+/*!
+ * \def PUT_UTF8(val, tmp, PUT_BYTE)
+ * converts a 32-bit unicode character to its utf-8 encoded form (up to 4 bytes long).
+ * \param val is an input only argument and should be of type uint32_t. It holds
+ * a ucs4 encoded unicode character that is to be converted to utf-8. If
+ * val is given as a function it's executed only once.
+ * \param tmp is a temporary variable and should be of type uint8_t. It
+ * represents an intermediate value during conversion that is to be
+ * outputted by PUT_BYTE.
+ * \param PUT_BYTE writes the converted utf-8 bytes to any proper destination.
+ * It could be a function or a statement, and uses tmp as the input byte.
+ * For example, PUT_BYTE could be &quot;*output++ = tmp;&quot; PUT_BYTE will be
+ * executed up to 4 times for values in the valid utf-8 range and up to
+ * 7 times in the general case, depending on the length of the converted
+ * unicode character.
+ */
+#define PUT_UTF8(val, tmp, PUT_BYTE)\
+    {\
+        int bytes, shift;\
+        uint32_t in = val;\
+        if (in &lt; 0x80) {\
+            tmp = in;\
+            PUT_BYTE\
+        } else {\
+            bytes = (av_log2(in) + 4) / 5;\
+            shift = (bytes - 1) * 6;\
+            tmp = (256 - (256 &gt;&gt; bytes)) | (in &gt;&gt; shift);\
+            PUT_BYTE\
+            while (shift &gt;= 6) {\
+                shift -= 6;\
+                tmp = 0x80 | ((in &gt;&gt; shift) &amp; 0x3f);\
+                PUT_BYTE\
+            }\
+        }\
+    }
+
+#if defined(ARCH_X86) || defined(ARCH_POWERPC)
 #if defined(ARCH_X86_64)
 static inline uint64_t read_time(void)
 {
@@ -304,7 +274,7 @@
         );
         return (d &lt;&lt; 32) | (a &amp; 0xffffffff);
 }
-#elif defined(ARCH_X86)
+#elif defined(ARCH_X86_32)
 static inline long long read_time(void)
 {
         long long l;
@@ -349,7 +319,7 @@
       tcount++;\
   }else\
       tskip_count++;\
-  if(256*256*256*64%(tcount+tskip_count)==0){\
+  if(((tcount+tskip_count)&amp;(tcount+tskip_count-1))==0){\
       av_log(NULL, AV_LOG_DEBUG, &quot;%&quot;PRIu64&quot; dezicycles in %s, %d runs, %d skips\n&quot;, tsum*10/tcount, id, tcount, tskip_count);\
   }\
 }
@@ -359,8 +329,20 @@
 #endif
 
 /* memory */
+
+#ifdef __GNUC__
+  #define DECLARE_ALIGNED(n,t,v)       t v __attribute__ ((aligned (n)))
+#else
+  #define DECLARE_ALIGNED(n,t,v)      __declspec(align(n)) t v
+#endif
+
+/* memory */
 void *av_malloc(unsigned int size);
 void *av_realloc(void *ptr, unsigned int size);
 void av_free(void *ptr);
 
+void *av_mallocz(unsigned int size);
+char *av_strdup(const char *s);
+void av_freep(void *ptr);
+
 #endif /* COMMON_H */

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/crc.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/crc.c	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/crc.c	2007-01-21 18:04:51 UTC (rev 2748)
@@ -1,3 +1,23 @@
+/*
+ * copyright (c) 2006 Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michaelni at gmx.at</A>&gt;
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
 #include &quot;common.h&quot;
 #include &quot;crc.h&quot;
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/crc.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/crc.h	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/crc.h	2007-01-21 18:04:51 UTC (rev 2748)
@@ -1,3 +1,23 @@
+/*
+ * copyright (c) 2006 Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michaelni at gmx.at</A>&gt;
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
 #ifndef CRC_H
 #define CRC_H
 

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/fifo.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/fifo.c	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/fifo.c	2007-01-21 18:04:51 UTC (rev 2748)
@@ -0,0 +1,114 @@
+/*
+ * A very simple circular buffer FIFO implementation
+ * Copyright (c) 2000, 2001, 2002 Fabrice Bellard
+ * Copyright (c) 2006 Roman Shaposhnik
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+#include &quot;common.h&quot;
+#include &quot;fifo.h&quot;
+
+int av_fifo_init(AVFifoBuffer *f, int size)
+{
+    f-&gt;wptr = f-&gt;rptr =
+    f-&gt;buffer = av_malloc(size);
+    f-&gt;end = f-&gt;buffer + size;
+    if (!f-&gt;buffer)
+        return -1;
+    return 0;
+}
+
+void av_fifo_free(AVFifoBuffer *f)
+{
+    av_free(f-&gt;buffer);
+}
+
+int av_fifo_size(AVFifoBuffer *f)
+{
+    int size = f-&gt;wptr - f-&gt;rptr;
+    if (size &lt; 0)
+        size += f-&gt;end - f-&gt;buffer;
+    return size;
+}
+
+/**
+ * Get data from the fifo (returns -1 if not enough data).
+ */
+int av_fifo_read(AVFifoBuffer *f, uint8_t *buf, int buf_size)
+{
+    return av_fifo_generic_read(f, buf_size, NULL, buf);
+}
+
+/**
+ * Resizes a FIFO.
+ */
+void av_fifo_realloc(AVFifoBuffer *f, unsigned int new_size) {
+    unsigned int old_size= f-&gt;end - f-&gt;buffer;
+
+    if(old_size &lt; new_size){
+        int len= av_fifo_size(f);
+        AVFifoBuffer f2;
+
+        av_fifo_init(&amp;f2, new_size);
+        av_fifo_read(f, f2.buffer, len);
+        f2.wptr += len;
+        av_free(f-&gt;buffer);
+        *f= f2;
+    }
+}
+
+void av_fifo_write(AVFifoBuffer *f, const uint8_t *buf, int size)
+{
+    do {
+        int len = FFMIN(f-&gt;end - f-&gt;wptr, size);
+        memcpy(f-&gt;wptr, buf, len);
+        f-&gt;wptr += len;
+        if (f-&gt;wptr &gt;= f-&gt;end)
+            f-&gt;wptr = f-&gt;buffer;
+        buf += len;
+        size -= len;
+    } while (size &gt; 0);
+}
+
+
+/** get data from the fifo (return -1 if not enough data) */
+int av_fifo_generic_read(AVFifoBuffer *f, int buf_size, void (*func)(void*, void*, int), void* dest)
+{
+    int size = av_fifo_size(f);
+
+    if (size &lt; buf_size)
+        return -1;
+    do {
+        int len = FFMIN(f-&gt;end - f-&gt;rptr, buf_size);
+        if(func) func(dest, f-&gt;rptr, len);
+        else{
+            memcpy(dest, f-&gt;rptr, len);
+            dest = (uint8_t*)dest + len;
+        }
+        av_fifo_drain(f, len);
+        buf_size -= len;
+    } while (buf_size &gt; 0);
+    return 0;
+}
+
+/** discard data from the fifo */
+void av_fifo_drain(AVFifoBuffer *f, int size)
+{
+    f-&gt;rptr += size;
+    if (f-&gt;rptr &gt;= f-&gt;end)
+        f-&gt;rptr -= f-&gt;end - f-&gt;buffer;
+}

Added: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/fifo.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/fifo.h	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/fifo.h	2007-01-21 18:04:51 UTC (rev 2748)
@@ -0,0 +1,25 @@
+#ifndef FIFO_H
+#define FIFO_H
+
+typedef struct AVFifoBuffer {
+    uint8_t *buffer;
+    uint8_t *rptr, *wptr, *end;
+} AVFifoBuffer;
+
+int av_fifo_init(AVFifoBuffer *f, int size);
+void av_fifo_free(AVFifoBuffer *f);
+int av_fifo_size(AVFifoBuffer *f);
+int av_fifo_read(AVFifoBuffer *f, uint8_t *buf, int buf_size);
+int av_fifo_generic_read(AVFifoBuffer *f, int buf_size, void (*func)(void*, void*, int), void* dest);
+void av_fifo_write(AVFifoBuffer *f, const uint8_t *buf, int size);
+void av_fifo_realloc(AVFifoBuffer *f, unsigned int size);
+void av_fifo_drain(AVFifoBuffer *f, int size);
+
+static inline uint8_t av_fifo_peek(AVFifoBuffer *f, int offs)
+{
+    uint8_t *ptr = f-&gt;rptr + offs;
+    if (ptr &gt;= f-&gt;end)
+        ptr -= f-&gt;end - f-&gt;buffer;
+    return *ptr;
+}
+#endif /* FIFO_H */

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/integer.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/integer.c	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/integer.c	2007-01-21 18:04:51 UTC (rev 2748)
@@ -2,18 +2,20 @@
  * arbitrary precision integers
  * Copyright (c) 2004 Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michaelni at gmx.at</A>&gt;
  *
- * This library is free software; you can redistribute it and/or
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Lesser General Public
  * License as published by the Free Software Foundation; either
- * version 2 of the License, or (at your option) any later version.
+ * version 2.1 of the License, or (at your option) any later version.
  *
- * This library is distributed in the hope that it will be useful,
+ * FFmpeg is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  * Lesser General Public License for more details.
  *
  * You should have received a copy of the GNU Lesser General Public
- * License along with this library; if not, write to the Free Software
+ * License along with FFmpeg; if not, write to the Free Software
  * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
  *
  */

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/integer.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/integer.h	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/integer.h	2007-01-21 18:04:51 UTC (rev 2748)
@@ -2,18 +2,20 @@
  * arbitrary precision integers
  * Copyright (c) 2004 Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michaelni at gmx.at</A>&gt;
  *
- * This library is free software; you can redistribute it and/or
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Lesser General Public
  * License as published by the Free Software Foundation; either
- * version 2 of the License, or (at your option) any later version.
+ * version 2.1 of the License, or (at your option) any later version.
  *
- * This library is distributed in the hope that it will be useful,
+ * FFmpeg is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  * Lesser General Public License for more details.
  *
  * You should have received a copy of the GNU Lesser General Public
- * License along with this library; if not, write to the Free Software
+ * License along with FFmpeg; if not, write to the Free Software
  * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
  *
  */

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/internal.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/internal.h	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/internal.h	2007-01-21 18:04:51 UTC (rev 2748)
@@ -1,3 +1,23 @@
+/*
+ * copyright (c) 2006 Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michaelni at gmx.at</A>&gt;
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
 /**
  * @file internal.h
  * common internal api header.
@@ -6,36 +26,110 @@
 #ifndef INTERNAL_H
 #define INTERNAL_H
 
+#ifndef attribute_used
+#if defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 3 || __GNUC__ == 3 &amp;&amp; __GNUC_MINOR__ &gt; 0)
+#    define attribute_used __attribute__((used))
+#else
+#    define attribute_used
+#endif
+#endif
+
+#ifndef attribute_unused
+#if defined(__GNUC__)
+#    define attribute_unused __attribute__((unused))
+#else
+#    define attribute_unused
+#endif
+#endif
+
+#ifndef M_PI
+#define M_PI    3.14159265358979323846
+#endif
+
+#ifndef PRId64
+#define PRId64 &quot;lld&quot;
+#endif
+
+#ifndef PRIu64
+#define PRIu64 &quot;llu&quot;
+#endif
+
+#ifndef PRIx64
+#define PRIx64 &quot;llx&quot;
+#endif
+
+#ifndef PRIX64
+#define PRIX64 &quot;llX&quot;
+#endif
+
+#ifndef PRId32
+#define PRId32 &quot;d&quot;
+#endif
+
+#ifndef PRIdFAST16
+#define PRIdFAST16 PRId32
+#endif
+
+#ifndef PRIdFAST32
+#define PRIdFAST32 PRId32
+#endif
+
+#ifndef INT16_MIN
+#define INT16_MIN       (-0x7fff-1)
+#endif
+
+#ifndef INT16_MAX
+#define INT16_MAX       0x7fff
+#endif
+
+#ifndef INT32_MIN
+#define INT32_MIN       (-0x7fffffff-1)
+#endif
+
+#ifndef INT32_MAX
+#define INT32_MAX       0x7fffffff
+#endif
+
+#ifndef UINT32_MAX
+#define UINT32_MAX      0xffffffff
+#endif
+
+#ifndef INT64_MIN
+#define INT64_MIN       (-0x7fffffffffffffffLL-1)
+#endif
+
+#ifndef INT64_MAX
+#define INT64_MAX INT64_C(9223372036854775807)
+#endif
+
+#ifndef UINT64_MAX
+#define UINT64_MAX UINT64_C(0xFFFFFFFFFFFFFFFF)
+#endif
+
+#ifndef INT_BIT
+#    if INT_MAX != 2147483647
+#        define INT_BIT 64
+#    else
+#        define INT_BIT 32
+#    endif
+#endif
+
 #if ( defined(__PIC__) || defined(__pic__) ) &amp;&amp; ! defined(PIC)
 #    define PIC
 #endif
 
-#    ifndef ENODATA
-#        define ENODATA  61
-#    endif
+#ifndef ENODATA
+#    define ENODATA  61
+#endif
 
+#include &quot;intreadwrite.h&quot;
 #include &quot;bswap.h&quot;
 
 #include &lt;stddef.h&gt;
 #ifndef offsetof
-# define offsetof(T,F) ((unsigned int)((char *)&amp;((T *)0)-&gt;F))
+#    define offsetof(T,F) ((unsigned int)((char *)&amp;((T *)0)-&gt;F))
 #endif
 
-#define AVOPTION_CODEC_BOOL(name, help, field) \
-    { name, help, offsetof(AVCodecContext, field), FF_OPT_TYPE_BOOL }
-#define AVOPTION_CODEC_DOUBLE(name, help, field, minv, maxv, defval) \
-    { name, help, offsetof(AVCodecContext, field), FF_OPT_TYPE_DOUBLE, minv, maxv, defval }
-#define AVOPTION_CODEC_FLAG(name, help, field, flag, defval) \
-    { name, help, offsetof(AVCodecContext, field), FF_OPT_TYPE_FLAG, flag, 0, defval }
-#define AVOPTION_CODEC_INT(name, help, field, minv, maxv, defval) \
-    { name, help, offsetof(AVCodecContext, field), FF_OPT_TYPE_INT, minv, maxv, defval }
-#define AVOPTION_CODEC_STRING(name, help, field, str, val) \
-    { name, help, offsetof(AVCodecContext, field), FF_OPT_TYPE_STRING, .defval = val, .defstr = str }
-#define AVOPTION_CODEC_RCOVERRIDE(name, help, field) \
-    { name, help, offsetof(AVCodecContext, field), FF_OPT_TYPE_RCOVERRIDE, .defval = 0, .defstr = NULL }
-#define AVOPTION_SUB(ptr) { .name = NULL, .help = (const char*)ptr }
-#define AVOPTION_END() AVOPTION_SUB(NULL)
-
 #ifdef __MINGW32__
 #    ifdef _DEBUG
 #        define DEBUG
@@ -46,79 +140,88 @@
 
 #    ifdef CONFIG_WINCE
 #        define perror(a)
+#        define abort()
 #    endif
 
 /* __MINGW32__ end */
 #elif defined (CONFIG_OS2)
 /* OS/2 EMX */
 
-#include &lt;float.h&gt;
+#    include &lt;float.h&gt;
 
 #endif /* !__MINGW32__ &amp;&amp; CONFIG_OS2 */
 
-#    ifdef USE_FASTMEMCPY
-#        include &quot;fastmemcpy.h&quot;
-#    endif
+#ifdef USE_FASTMEMCPY
+#    include &quot;libvo/fastmemcpy.h&quot;
+#endif
 
 // Use rip-relative addressing if compiling PIC code on x86-64.
-#    if defined(__MINGW32__) || defined(__CYGWIN__) || \
-        defined(__OS2__) || (defined (__OpenBSD__) &amp;&amp; !defined(__ELF__))
-#        if defined(ARCH_X86_64) &amp;&amp; defined(PIC)
-#            define MANGLE(a) &quot;_&quot; #a&quot;(%%rip)&quot;
-#        else
-#            define MANGLE(a) &quot;_&quot; #a
-#        endif
+#if defined(__MINGW32__) || defined(__CYGWIN__) || \
+    defined(__OS2__) || (defined (__OpenBSD__) &amp;&amp; !defined(__ELF__))
+#    if defined(ARCH_X86_64) &amp;&amp; defined(PIC)
+#        define MANGLE(a) &quot;_&quot; #a&quot;(%%rip)&quot;
 #    else
-#        if defined(ARCH_X86_64) &amp;&amp; defined(PIC)
-#            define MANGLE(a) #a&quot;(%%rip)&quot;
-#        elif defined(CONFIG_DARWIN)
-#            define MANGLE(a) &quot;_&quot; #a
-#        else
-#            define MANGLE(a) #a
-#        endif
+#        define MANGLE(a) &quot;_&quot; #a
 #    endif
+#else
+#    if defined(ARCH_X86_64) &amp;&amp; defined(PIC)
+#        define MANGLE(a) #a&quot;(%%rip)&quot;
+#    elif defined(CONFIG_DARWIN)
+#        define MANGLE(a) &quot;_&quot; #a
+#    else
+#        define MANGLE(a) #a
+#    endif
+#endif
 
 /* debug stuff */
 
-#    if !defined(DEBUG) &amp;&amp; !defined(NDEBUG)
-#        define NDEBUG
-#    endif
-#    include &lt;assert.h&gt;
+#if !defined(DEBUG) &amp;&amp; !defined(NDEBUG)
+#    define NDEBUG
+#endif
+#include &lt;assert.h&gt;
 
 /* dprintf macros */
-#    ifdef DEBUG
-#        define dprintf(fmt,...) av_log(NULL, AV_LOG_DEBUG, fmt, __VA_ARGS__)
-#    else
-#        define dprintf(fmt,...)
-#    endif
+#ifdef DEBUG
+#    define dprintf(fmt,...) av_log(NULL, AV_LOG_DEBUG, fmt, __VA_ARGS__)
+#else
+#    define dprintf(fmt,...)
+#endif
 
-#    ifdef CONFIG_WINCE
-#            define abort()
-#    endif
+#define av_abort()      do { av_log(NULL, AV_LOG_ERROR, &quot;Abort at %s:%d\n&quot;, __FILE__, __LINE__); abort(); } while (0)
 
-#    define av_abort()      do { av_log(NULL, AV_LOG_ERROR, &quot;Abort at %s:%d\n&quot;, __FILE__, __LINE__); abort(); } while (0)
+/* math */
 
-extern const uint32_t inverse[256];
+extern const uint32_t ff_inverse[256];
 
-#if defined(ARCH_X86) || defined(ARCH_X86_64)
+#if defined(ARCH_X86)
 #    define FASTDIV(a,b) \
     ({\
         int ret,dmy;\
         asm volatile(\
             &quot;mull %3&quot;\
             :&quot;=d&quot;(ret),&quot;=a&quot;(dmy)\
-            :&quot;1&quot;(a),&quot;g&quot;(inverse[b])\
+            :&quot;1&quot;(a),&quot;g&quot;(ff_inverse[b])\
             );\
         ret;\
     })
+#elif defined(ARCH_ARMV4L)
+#    define FASTDIV(a,b) \
+    ({\
+        int ret,dmy;\
+        asm volatile(\
+            &quot;umull %1, %0, %2, %3&quot;\
+            :&quot;=&amp;r&quot;(ret),&quot;=&amp;r&quot;(dmy)\
+            :&quot;r&quot;(a),&quot;r&quot;(ff_inverse[b])\
+            );\
+        ret;\
+    })
 #elif defined(CONFIG_FASTDIV)
-#    define FASTDIV(a,b)   ((uint32_t)((((uint64_t)a)*inverse[b])&gt;&gt;32))
+#    define FASTDIV(a,b)   ((uint32_t)((((uint64_t)a)*ff_inverse[b])&gt;&gt;32))
 #else
 #    define FASTDIV(a,b)   ((a)/(b))
 #endif
 
-/* math */
-extern FF_IMPORT_ATTR const uint8_t ff_sqrt_tab[128];
+extern const uint8_t ff_sqrt_tab[128];
 
 static inline int ff_sqrt(int a)
 {
@@ -138,7 +241,7 @@
     return ret;
 }
 
-#if defined(ARCH_X86) || defined(ARCH_X86_64)
+#if defined(ARCH_X86)
 #define MASK_ABS(mask, level)\
             asm volatile(\
                 &quot;cdq                    \n\t&quot;\
@@ -152,7 +255,7 @@
             level= (level^mask)-mask;
 #endif
 
-#if __CPU__ &gt;= 686 &amp;&amp; !defined(RUNTIME_CPUDETECT)
+#ifdef HAVE_CMOV
 #define COPY3_IF_LT(x,y,a,b,c,d)\
 asm volatile (\
     &quot;cmpl %0, %3        \n\t&quot;\
@@ -198,10 +301,10 @@
 /* XXX: add ISOC specific test to avoid specific BSD testing. */
 /* better than nothing implementation. */
 /* btw, rintf() is existing on fbsd too -- alex */
-static always_inline long int lrintf(float x)
+static av_always_inline long int lrintf(float x)
 {
 #ifdef __MINGW32__
-#  ifdef ARCH_X86
+#  ifdef ARCH_X86_32
     int32_t i;
     asm volatile(
         &quot;fistpl %0\n\t&quot;
@@ -211,7 +314,7 @@
 #  else
     /* XXX: incorrect, but make it compile */
     return (int)(x + (x &lt; 0 ? -0.5 : 0.5));
-#  endif /* ARCH_X86 */
+#  endif /* ARCH_X86_32 */
 #else
     return (int)(rint(x));
 #endif /* __MINGW32__ */

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/intfloat_readwrite.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/intfloat_readwrite.c	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/intfloat_readwrite.c	2007-01-21 18:04:51 UTC (rev 2748)
@@ -3,18 +3,20 @@
  *
  * Copyright (c) 2005 Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michaelni at gmx.at</A>&gt;
  *
- * This library is free software; you can redistribute it and/or
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Lesser General Public
  * License as published by the Free Software Foundation; either
- * version 2 of the License, or (at your option) any later version.
+ * version 2.1 of the License, or (at your option) any later version.
  *
- * This library is distributed in the hope that it will be useful,
+ * FFmpeg is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  * Lesser General Public License for more details.
  *
  * You should have received a copy of the GNU Lesser General Public
- * License along with this library; if not, write to the Free Software
+ * License along with FFmpeg; if not, write to the Free Software
  * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
  */
 
@@ -27,7 +29,7 @@
 #include &quot;intfloat_readwrite.h&quot;
 
 double av_int2dbl(int64_t v){
-    if(v+v &gt; 0xFFELLU&lt;&lt;52)
+    if(v+v &gt; 0xFFEULL&lt;&lt;52)
         return 0.0/0.0;
     return ldexp(((v&amp;((1LL&lt;&lt;52)-1)) + (1LL&lt;&lt;52)) * (v&gt;&gt;63|1), (v&gt;&gt;52&amp;0x7FF)-1075);
 }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/intfloat_readwrite.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/intfloat_readwrite.h	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/intfloat_readwrite.h	2007-01-21 18:04:51 UTC (rev 2748)
@@ -1,3 +1,23 @@
+/*
+ * copyright (c) 2005 Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michaelni at gmx.at</A>&gt;
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
 #ifndef INTFLOAT_READWRITE_H
 #define INTFLOAT_READWRITE_H
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/lls.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/lls.c	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/lls.c	2007-01-21 18:04:51 UTC (rev 2748)
@@ -3,18 +3,20 @@
  *
  * Copyright (c) 2006 Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michaelni at gmx.at</A>&gt;
  *
- * This library is free software; you can redistribute it and/or
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Lesser General Public
  * License as published by the Free Software Foundation; either
- * version 2 of the License, or (at your option) any later version.
+ * version 2.1 of the License, or (at your option) any later version.
  *
- * This library is distributed in the hope that it will be useful,
+ * FFmpeg is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  * Lesser General Public License for more details.
  *
  * You should have received a copy of the GNU Lesser General Public
- * License along with this library; if not, write to the Free Software
+ * License along with FFmpeg; if not, write to the Free Software
  * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
  */
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/lls.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/lls.h	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/lls.h	2007-01-21 18:04:51 UTC (rev 2748)
@@ -3,18 +3,20 @@
  *
  * Copyright (c) 2006 Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michaelni at gmx.at</A>&gt;
  *
- * This library is free software; you can redistribute it and/or
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Lesser General Public
  * License as published by the Free Software Foundation; either
- * version 2 of the License, or (at your option) any later version.
+ * version 2.1 of the License, or (at your option) any later version.
  *
- * This library is distributed in the hope that it will be useful,
+ * FFmpeg is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  * Lesser General Public License for more details.
  *
  * You should have received a copy of the GNU Lesser General Public
- * License along with this library; if not, write to the Free Software
+ * License along with FFmpeg; if not, write to the Free Software
  * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
  */
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/log.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/log.c	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/log.c	2007-01-21 18:04:51 UTC (rev 2748)
@@ -2,18 +2,20 @@
  * log functions
  * Copyright (c) 2003 Michel Bardiaux
  *
- * This library is free software; you can redistribute it and/or
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Lesser General Public
  * License as published by the Free Software Foundation; either
- * version 2 of the License, or (at your option) any later version.
+ * version 2.1 of the License, or (at your option) any later version.
  *
- * This library is distributed in the hope that it will be useful,
+ * FFmpeg is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  * Lesser General Public License for more details.
  *
  * You should have received a copy of the GNU Lesser General Public
- * License along with this library; if not, write to the Free Software
+ * License along with FFmpeg; if not, write to the Free Software
  * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
  */
 
@@ -26,7 +28,7 @@
 
 int av_log_level = AV_LOG_INFO;
 
-static void av_log_default_callback(void* ptr, int level, const char* fmt, va_list vl)
+void av_log_default_callback(void* ptr, int level, const char* fmt, va_list vl)
 {
     static int print_prefix=1;
     AVClass* avc= ptr ? *(AVClass**)ptr : NULL;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/log.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/log.h	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/log.h	2007-01-21 18:04:51 UTC (rev 2748)
@@ -1,3 +1,23 @@
+/*
+ * copyright (c) 2006 Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michaelni at gmx.at</A>&gt;
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
 #ifndef LOG_H
 #define LOG_H
 
@@ -13,7 +33,7 @@
                                         or AVFormatContext, which begin with an AVClass.
                                         Needed because av_log is in libavcodec and has no visibility
                                         of AVIn/OutputFormat */
-    struct AVOption *option;
+    const struct AVOption *option;
 };
 
 /* av_log API */
@@ -35,6 +55,7 @@
 extern int av_log_get_level(void);
 extern void av_log_set_level(int);
 extern void av_log_set_callback(void (*)(void*, int, const char*, va_list));
+extern void av_log_default_callback(void* ptr, int level, const char* fmt, va_list vl);
 #else
 extern void (*av_vlog)(void*, int, const char*, va_list);
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/mathematics.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/mathematics.c	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/mathematics.c	2007-01-21 18:04:51 UTC (rev 2748)
@@ -1,18 +1,20 @@
 /*
  * Copyright (c) 2005 Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michaelni at gmx.at</A>&gt;
  *
- * This library is free software; you can redistribute it and/or
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Lesser General Public
  * License as published by the Free Software Foundation; either
- * version 2 of the License, or (at your option) any later version.
+ * version 2.1 of the License, or (at your option) any later version.
  *
- * This library is distributed in the hope that it will be useful,
+ * FFmpeg is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  * Lesser General Public License for more details.
  *
  * You should have received a copy of the GNU Lesser General Public
- * License along with this library; if not, write to the Free Software
+ * License along with FFmpeg; if not, write to the Free Software
  * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
  */
 
@@ -129,7 +131,7 @@
                 if((double)a * (double)b / (double)c &gt; (1LL&lt;&lt;63))
                     continue;
 
-                if(d!=e) printf(&quot;%Ld*%Ld/%Ld= %Ld=%Ld\n&quot;, a, b, c, d, e);
+                if(d!=e) printf(&quot;%&quot;PRId64&quot;*%&quot;PRId64&quot;/%&quot;PRId64&quot;= %&quot;PRId64&quot;=%&quot;PRId64&quot;\n&quot;, a, b, c, d, e);
             }
         }
     }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/mathematics.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/mathematics.h	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/mathematics.h	2007-01-21 18:04:51 UTC (rev 2748)
@@ -1,3 +1,23 @@
+/*
+ * copyright (c) 2005 Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michaelni at gmx.at</A>&gt;
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
 #ifndef MATHEMATICS_H
 #define MATHEMATICS_H
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/md5.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/md5.c	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/md5.c	2007-01-21 18:04:51 UTC (rev 2748)
@@ -2,18 +2,20 @@
  * Copyright (C) 2006 Michael Niedermayer (<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michaelni at gmx.at</A>)
  * Copyright (C) 2003-2005 by Christopher R. Hertel (<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">crh at ubiqx.mn.org</A>)
  *
- * This library is free software; you can redistribute it and/or
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Lesser General Public
  * License as published by the Free Software Foundation; either
- * version 2 of the License, or (at your option) any later version.
+ * version 2.1 of the License, or (at your option) any later version.
  *
- * This library is distributed in the hope that it will be useful,
+ * FFmpeg is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  * Lesser General Public License for more details.
  *
  * You should have received a copy of the GNU Lesser General Public
- * License along with this library; if not, write to the Free Software
+ * License along with FFmpeg; if not, write to the Free Software
  * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
  *
  * References:
@@ -174,11 +176,11 @@
     uint8_t in[1000];
 
     for(i=0; i&lt;1000; i++) in[i]= i*i;
-    av_md5_sum( (uint8_t*)&amp;md5val, in,  1000); printf(&quot;%lld\n&quot;, md5val);
-    av_md5_sum( (uint8_t*)&amp;md5val, in,  63); printf(&quot;%lld\n&quot;, md5val);
-    av_md5_sum( (uint8_t*)&amp;md5val, in,  64); printf(&quot;%lld\n&quot;, md5val);
-    av_md5_sum( (uint8_t*)&amp;md5val, in,  65); printf(&quot;%lld\n&quot;, md5val);
+    av_md5_sum( (uint8_t*)&amp;md5val, in,  1000); printf(&quot;%&quot;PRId64&quot;\n&quot;, md5val);
+    av_md5_sum( (uint8_t*)&amp;md5val, in,  63); printf(&quot;%&quot;PRId64&quot;\n&quot;, md5val);
+    av_md5_sum( (uint8_t*)&amp;md5val, in,  64); printf(&quot;%&quot;PRId64&quot;\n&quot;, md5val);
+    av_md5_sum( (uint8_t*)&amp;md5val, in,  65); printf(&quot;%&quot;PRId64&quot;\n&quot;, md5val);
     for(i=0; i&lt;1000; i++) in[i]= i % 127;
-    av_md5_sum( (uint8_t*)&amp;md5val, in,  999); printf(&quot;%lld\n&quot;, md5val);
+    av_md5_sum( (uint8_t*)&amp;md5val, in,  999); printf(&quot;%&quot;PRId64&quot;\n&quot;, md5val);
 }
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/md5.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/md5.h	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/md5.h	2007-01-21 18:04:51 UTC (rev 2748)
@@ -1,3 +1,23 @@
+/*
+ * copyright (c) 2006 Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michaelni at gmx.at</A>&gt;
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
 #ifndef MD5_H
 #define MD5_H
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/mem.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/mem.c	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/mem.c	2007-01-21 18:04:51 UTC (rev 2748)
@@ -2,18 +2,20 @@
  * default memory allocator for libavutil
  * Copyright (c) 2002 Fabrice Bellard.
  *
- * This library is free software; you can redistribute it and/or
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Lesser General Public
  * License as published by the Free Software Foundation; either
- * version 2 of the License, or (at your option) any later version.
+ * version 2.1 of the License, or (at your option) any later version.
  *
- * This library is distributed in the hope that it will be useful,
+ * FFmpeg is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  * Lesser General Public License for more details.
  *
  * You should have received a copy of the GNU Lesser General Public
- * License along with this library; if not, write to the Free Software
+ * License along with FFmpeg; if not, write to the Free Software
  * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
  */
 
@@ -45,7 +47,7 @@
 void *av_malloc(unsigned int size)
 {
     void *ptr;
-#ifdef MEMALIGN_HACK
+#ifdef CONFIG_MEMALIGN_HACK
     long diff;
 #endif
 
@@ -53,7 +55,7 @@
     if(size &gt; (INT_MAX-16) )
         return NULL;
 
-#ifdef MEMALIGN_HACK
+#ifdef CONFIG_MEMALIGN_HACK
     ptr = malloc(size+16);
     if(!ptr)
         return ptr;
@@ -101,7 +103,7 @@
  */
 void *av_realloc(void *ptr, unsigned int size)
 {
-#ifdef MEMALIGN_HACK
+#ifdef CONFIG_MEMALIGN_HACK
     int diff;
 #endif
 
@@ -109,7 +111,7 @@
     if(size &gt; (INT_MAX-16) )
         return NULL;
 
-#ifdef MEMALIGN_HACK
+#ifdef CONFIG_MEMALIGN_HACK
     //FIXME this isn't aligned correctly, though it probably isn't needed
     if(!ptr) return av_malloc(size);
     diff= ((char*)ptr)[-1];
@@ -128,10 +130,42 @@
 {
     /* XXX: this test should not be needed on most libcs */
     if (ptr)
-#ifdef MEMALIGN_HACK
+#ifdef CONFIG_MEMALIGN_HACK
         free(ptr - ((char*)ptr)[-1]);
 #else
         free(ptr);
 #endif
 }
 
+/**
+ * Frees memory and sets the pointer to NULL.
+ * @param arg pointer to the pointer which should be freed
+ */
+void av_freep(void *arg)
+{
+    void **ptr= (void**)arg;
+    av_free(*ptr);
+    *ptr = NULL;
+}
+
+void *av_mallocz(unsigned int size)
+{
+    void *ptr;
+
+    ptr = av_malloc(size);
+    if (ptr)
+        memset(ptr, 0, size);
+    return ptr;
+}
+
+char *av_strdup(const char *s)
+{
+    char *ptr;
+    int len;
+    len = strlen(s) + 1;
+    ptr = av_malloc(len);
+    if (ptr)
+        memcpy(ptr, s, len);
+    return ptr;
+}
+

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/rational.c
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/rational.c	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/rational.c	2007-01-21 18:04:51 UTC (rev 2748)
@@ -2,18 +2,20 @@
  * Rational numbers
  * Copyright (c) 2003 Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michaelni at gmx.at</A>&gt;
  *
- * This library is free software; you can redistribute it and/or
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Lesser General Public
  * License as published by the Free Software Foundation; either
- * version 2 of the License, or (at your option) any later version.
+ * version 2.1 of the License, or (at your option) any later version.
  *
- * This library is distributed in the hope that it will be useful,
+ * FFmpeg is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  * Lesser General Public License for more details.
  *
  * You should have received a copy of the GNU Lesser General Public
- * License along with this library; if not, write to the Free Software
+ * License along with FFmpeg; if not, write to the Free Software
  * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
  *
  */
@@ -34,29 +36,38 @@
 int av_reduce(int *dst_nom, int *dst_den, int64_t nom, int64_t den, int64_t max){
     AVRational a0={0,1}, a1={1,0};
     int sign= (nom&lt;0) ^ (den&lt;0);
-    int64_t gcd= ff_gcd(ABS(nom), ABS(den));
+    int64_t gcd= ff_gcd(FFABS(nom), FFABS(den));
 
-    nom = ABS(nom)/gcd;
-    den = ABS(den)/gcd;
+    if(gcd){
+        nom = FFABS(nom)/gcd;
+        den = FFABS(den)/gcd;
+    }
     if(nom&lt;=max &amp;&amp; den&lt;=max){
         a1= (AVRational){nom, den};
         den=0;
     }
 
     while(den){
-        int64_t x       = nom / den;
+        uint64_t x      = nom / den;
         int64_t next_den= nom - den*x;
         int64_t a2n= x*a1.num + a0.num;
         int64_t a2d= x*a1.den + a0.den;
 
-        if(a2n &gt; max || a2d &gt; max) break;
+        if(a2n &gt; max || a2d &gt; max){
+            if(a1.num) x= (max - a0.num) / a1.num;
+            if(a1.den) x= FFMIN(x, (max - a0.den) / a1.den);
 
+            if (den*(2*x*a1.den + a0.den) &gt; nom*a1.den)
+                a1 = (AVRational){x*a1.num + a0.num, x*a1.den + a0.den};
+            break;
+        }
+
         a0= a1;
         a1= (AVRational){a2n, a2d};
         nom= den;
         den= next_den;
     }
-    assert(ff_gcd(a1.num, a1.den) == 1);
+    assert(ff_gcd(a1.num, a1.den) &lt;= 1U);
 
     *dst_nom = sign ? -a1.num : a1.num;
     *dst_den = a1.den;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/rational.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/rational.h	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/rational.h	2007-01-21 18:04:51 UTC (rev 2748)
@@ -2,18 +2,20 @@
  * Rational numbers
  * Copyright (c) 2003 Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michaelni at gmx.at</A>&gt;
  *
- * This library is free software; you can redistribute it and/or
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Lesser General Public
  * License as published by the Free Software Foundation; either
- * version 2 of the License, or (at your option) any later version.
+ * version 2.1 of the License, or (at your option) any later version.
  *
- * This library is distributed in the hope that it will be useful,
+ * FFmpeg is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  * Lesser General Public License for more details.
  *
  * You should have received a copy of the GNU Lesser General Public
- * License along with this library; if not, write to the Free Software
+ * License along with FFmpeg; if not, write to the Free Software
  * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
  *
  */

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/x86_cpu.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/x86_cpu.h	2007-01-21 18:04:24 UTC (rev 2747)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavutil/x86_cpu.h	2007-01-21 18:04:51 UTC (rev 2748)
@@ -1,3 +1,23 @@
+/*
+ * copyright (c) 2006 Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michaelni at gmx.at</A>&gt;
+ *
+ * This file is part of FFmpeg.
+ *
+ * FFmpeg is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * FFmpeg is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with FFmpeg; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ */
+
 #ifndef AVUTIL_X86CPU_H
 #define AVUTIL_X86CPU_H
 
@@ -15,6 +35,7 @@
 #  define REGBP   rbp
 #  define REGa    rax
 #  define REGb    rbx
+#  define REGc    rcx
 #  define REGSP   rsp
 
 #else
@@ -32,6 +53,7 @@
 #  define REGBP   ebp
 #  define REGa    eax
 #  define REGb    ebx
+#  define REGc    ecx
 #  define REGSP   esp
 #endif
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000074.html">[Avidemux-svn-commit] r2747 -	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavformat
</A></li>
	<LI>Next message: <A HREF="000076.html">[Avidemux-svn-commit] r2750 - in branches/avidemux_2.4_branch: .	addons/tsscan avidemux/ADM_audio avidemux/ADM_audiocodec	avidemux/ADM_codecs avidemux/ADM_encoder	avidemux/ADM_inputs/ADM_matroska avidemux/ADM_osSupport	avidemux/ADM_video
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#75">[ date ]</a>
              <a href="thread.html#75">[ thread ]</a>
              <a href="subject.html#75">[ subject ]</a>
              <a href="author.html#75">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
