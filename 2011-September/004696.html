<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r7549 - in branches/avidemux_2.6_branch_mean:	avidemux/qt4/ADM_userInterfaces/ADM_dialog	avidemux/qt4/ADM_userInterfaces/ADM_filters	avidemux/qt4/ADM_userInterfaces/ADM_gui	avidemux/qt4/ADM_userInterfaces/ADM_ocr	avidemux/qt4/ADM_userInterfaces/ADM_shell	avidemux_plugins/ADM_videoEncoder/x264/qt4	avidemux_plugins/ADM_videoFilters/ASharp/qt4	avidemux_plugins/ADM_videoFilters/ChromaShift/qt4	avidemux_plugins/ADM_videoFilters/Contrast/qt4	avidemux_plugins/ADM_videoFilters/Eq2/qt4	avidemux_plugins/ADM_videoFilters/Hue/qt4	avidemux_plugins/ADM_videoFilters/Srt/qt4	avidemux_plugins/ADM_videoFilters6/crop/qt4	avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D cmake
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2011-September/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r7549%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux/qt4/ADM_userInterfaces/ADM_dialog%0A%09avidemux/qt4/ADM_userInterfaces/ADM_filters%0A%09avidemux/qt4/ADM_userInterfaces/ADM_gui%0A%09avidemux/qt4/ADM_userInterfaces/ADM_ocr%0A%09avidemux/qt4/ADM_userInterfaces/ADM_shell%0A%09avidemux_plugins/ADM_videoEncoder/x264/qt4%0A%09avidemux_plugins/ADM_videoFilters/ASharp/qt4%0A%09avidemux_plugins/ADM_videoFilters/ChromaShift/qt4%0A%09avidemux_plugins/ADM_videoFilters/Contrast/qt4%0A%09avidemux_plugins/ADM_videoFilters/Eq2/qt4%0A%09avidemux_plugins/ADM_videoFilters/Hue/qt4%0A%09avidemux_plugins/ADM_videoFilters/Srt/qt4%0A%09avidemux_plugins/ADM_videoFilters6/crop/qt4%0A%09avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D%20cmake&In-Reply-To=%3C20110914180158.4011D48122D%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004695.html">
   <LINK REL="Next"  HREF="004697.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r7549 - in branches/avidemux_2.6_branch_mean:	avidemux/qt4/ADM_userInterfaces/ADM_dialog	avidemux/qt4/ADM_userInterfaces/ADM_filters	avidemux/qt4/ADM_userInterfaces/ADM_gui	avidemux/qt4/ADM_userInterfaces/ADM_ocr	avidemux/qt4/ADM_userInterfaces/ADM_shell	avidemux_plugins/ADM_videoEncoder/x264/qt4	avidemux_plugins/ADM_videoFilters/ASharp/qt4	avidemux_plugins/ADM_videoFilters/ChromaShift/qt4	avidemux_plugins/ADM_videoFilters/Contrast/qt4	avidemux_plugins/ADM_videoFilters/Eq2/qt4	avidemux_plugins/ADM_videoFilters/Hue/qt4	avidemux_plugins/ADM_videoFilters/Srt/qt4	avidemux_plugins/ADM_videoFilters6/crop/qt4	avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D cmake</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r7549%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux/qt4/ADM_userInterfaces/ADM_dialog%0A%09avidemux/qt4/ADM_userInterfaces/ADM_filters%0A%09avidemux/qt4/ADM_userInterfaces/ADM_gui%0A%09avidemux/qt4/ADM_userInterfaces/ADM_ocr%0A%09avidemux/qt4/ADM_userInterfaces/ADM_shell%0A%09avidemux_plugins/ADM_videoEncoder/x264/qt4%0A%09avidemux_plugins/ADM_videoFilters/ASharp/qt4%0A%09avidemux_plugins/ADM_videoFilters/ChromaShift/qt4%0A%09avidemux_plugins/ADM_videoFilters/Contrast/qt4%0A%09avidemux_plugins/ADM_videoFilters/Eq2/qt4%0A%09avidemux_plugins/ADM_videoFilters/Hue/qt4%0A%09avidemux_plugins/ADM_videoFilters/Srt/qt4%0A%09avidemux_plugins/ADM_videoFilters6/crop/qt4%0A%09avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D%20cmake&In-Reply-To=%3C20110914180158.4011D48122D%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r7549 - in branches/avidemux_2.6_branch_mean:	avidemux/qt4/ADM_userInterfaces/ADM_dialog	avidemux/qt4/ADM_userInterfaces/ADM_filters	avidemux/qt4/ADM_userInterfaces/ADM_gui	avidemux/qt4/ADM_userInterfaces/ADM_ocr	avidemux/qt4/ADM_userInterfaces/ADM_shell	avidemux_plugins/ADM_videoEncoder/x264/qt4	avidemux_plugins/ADM_videoFilters/ASharp/qt4	avidemux_plugins/ADM_videoFilters/ChromaShift/qt4	avidemux_plugins/ADM_videoFilters/Contrast/qt4	avidemux_plugins/ADM_videoFilters/Eq2/qt4	avidemux_plugins/ADM_videoFilters/Hue/qt4	avidemux_plugins/ADM_videoFilters/Srt/qt4	avidemux_plugins/ADM_videoFilters6/crop/qt4	avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D cmake">gruntster at mail.berlios.de
       </A><BR>
    <I>Wed Sep 14 20:01:57 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004695.html">[Avidemux-svn-commit] r7548 - in	branches/avidemux_2.6_branch_mean/avidemux: cli gtk qt4	qt4/ADM_jobs/src winInstaller
</A></li>
        <LI>Next message: <A HREF="004697.html">[Avidemux-svn-commit] r7550 - in branches/avidemux_2.6_branch_mean:	avidemux/cli avidemux/gtk avidemux/qt4	avidemux/qt4/ADM_jobs/src cmake
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4696">[ date ]</a>
              <a href="thread.html#4696">[ thread ]</a>
              <a href="subject.html#4696">[ subject ]</a>
              <a href="author.html#4696">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2011-09-14 20:01:57 +0200 (Wed, 14 Sep 2011)
New Revision: 7549

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_about.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_about.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_calculator.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_calculator.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_license.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_license.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_props.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_props.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_vobsub.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_vobsub.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_working.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_working.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/T_index_pg.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/T_index_pg.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/alert_qt4.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters/Q_mainfilter.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters/Q_mainfilter.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_ocr/Q_ocr.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_ocr/Q_ocr.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.cpp
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.h
   branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/qt4Shell.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264/qt4/Q_x264.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ASharp/qt4/Q_asharp.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ASharp/qt4/Q_asharp.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ChromaShift/qt4/Q_chromashift.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ChromaShift/qt4/Q_chromashift.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Contrast/qt4/Q_contrast.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Contrast/qt4/Q_contrast.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Eq2/qt4/Q_eq2.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Eq2/qt4/Q_eq2.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Hue/qt4/Q_hue.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Hue/qt4/Q_hue.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Srt/qt4/Q_srt.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Srt/qt4/Q_srt.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.h
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/CMakeLists.txt
   branches/avidemux_2.6_branch_mean/cmake/ve_plugin_qt4.cmake
Log:
[qt] r4390 &amp; r4557

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_about.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_about.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_about.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -18,10 +18,11 @@
 #include &quot;config.h&quot;
 #include &quot;Q_about.h&quot;
 #include &quot;ADM_inttype.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
 
 extern uint8_t DIA_license(void);
 
-Ui_aboutWindow::Ui_aboutWindow()
+Ui_aboutWindow::Ui_aboutWindow(QWidget* parent) : QDialog(parent)
 {
 	Q_INIT_RESOURCE(about);
 
@@ -44,9 +45,12 @@
 
 uint8_t DIA_about(void)
 {
-	Ui_aboutWindow dialog;
+	Ui_aboutWindow dialog(qtLastRegisteredDialog());
+	qtRegisterDialog(&amp;dialog);
 
 	dialog.exec();
 
+	qtUnregisterDialog(&amp;dialog);
+
 	return 1;
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_about.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_about.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_about.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -10,7 +10,7 @@
 	Ui_aboutDialog ui;
 
 public:
-	Ui_aboutWindow();
+	Ui_aboutWindow(QWidget* parent);
 
 private slots:
 	void licenseButton_clicked(bool);

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_calculator.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_calculator.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_calculator.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -24,8 +24,9 @@
 #include &quot;audioeng_buildfilters.h&quot;
 #include &quot;ADM_video/ADM_vidMisc.h&quot;
 #include &quot;ADM_encoder/adm_encConfig.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
 
-calculatorDialog::calculatorDialog()
+calculatorDialog::calculatorDialog(QWidget* parent) : QDialog(parent)
 {
 	ui.setupUi(this);
 
@@ -249,11 +250,14 @@
 	if (!avifileinfo)
 		return;
 
-	calculatorDialog dialog;
+	calculatorDialog dialog(qtLastRegisteredDialog());
+	qtRegisterDialog(&amp;dialog);
 
 	if (dialog.exec() == QDialog::Accepted)
 		videoCodecSetFinalSize(dialog.videoSize());
 
+	qtUnregisterDialog(&amp;dialog);
+
 	*sizeInMeg = dialog.videoSize();
 	*avgBitrate = dialog.videoBitrate();
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_calculator.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_calculator.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_calculator.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -16,7 +16,7 @@
 	unsigned int getPictureSize(void);
 
 public:
-	calculatorDialog();
+	calculatorDialog(QWidget* parent);
 	~calculatorDialog();
 
 	unsigned int videoSize(void);

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -21,11 +21,13 @@
 #include &quot;DIA_coreToolkit.h&quot;
 #include &quot;avidemutils.h&quot;
 #include &quot;ADM_vidMisc.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
 
 extern void UI_purge(void);
 static int stopReq=0;
 extern bool ADM_slaveReportProgress(uint32_t percent);
-encodingWindow::encodingWindow() : QDialog()
+
+encodingWindow::encodingWindow(QWidget *parent) : QDialog(parent, Qt::WindowTitleHint | Qt::WindowSystemMenuHint | Qt::WindowMinimizeButtonHint)
  {
 	ui.setupUi(this);
 
@@ -109,7 +111,8 @@
 {
         WINDOW=NULL;
         stopReq=0;
-        WINDOW=(void *)new encodingWindow();
+        WINDOW=(void *)new encodingWindow(qtLastRegisteredDialog());
+		qtRegisterDialog(window);
         window-&gt;setModal(TRUE);
         window-&gt;show();
 
@@ -132,6 +135,7 @@
 {
 	bool shutdownRequired = (window-&gt;ui.checkBoxShutdown-&gt;checkState() == Qt::Checked);
     encodingWindow *w=window;
+	qtUnregisterDialog(w);
 	if(w) delete w;
 	WINDOW=NULL;
 #if 0

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_encoding.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -30,7 +30,7 @@
      Q_OBJECT
 
  public:
-     encodingWindow();
+     encodingWindow(QWidget *parent);
      Ui_encodingDialog ui;
 
  public slots:

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_license.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_license.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_license.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -16,8 +16,9 @@
  ***************************************************************************/
 #include &quot;ADM_inttype.h&quot;
 #include &quot;Q_license.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
 
-Ui_licenseWindow::Ui_licenseWindow()
+Ui_licenseWindow::Ui_licenseWindow(QWidget *parent) : QDialog(parent)
 {
 	ui.setupUi(this);
 
@@ -697,9 +698,11 @@
 
 uint8_t DIA_license(void)
 {
-	Ui_licenseWindow dialog;
+	Ui_licenseWindow dialog(qtLastRegisteredDialog());
 
+	qtRegisterDialog(&amp;dialog);
 	dialog.exec();
+	qtUnregisterDialog(&amp;dialog);
 
 	return 1;
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_license.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_license.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_license.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -11,7 +11,7 @@
 	Ui_licenseDialog ui;
 
 public:
-	Ui_licenseWindow();
+	Ui_licenseWindow(QWidget *parent);
 };
 
 #endif	// Q_license_h

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_props.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_props.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_props.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -18,11 +18,12 @@
 #include &quot;avi_vars.h&quot;
 #include &quot;avidemutils.h&quot;
 #include &quot;ADM_vidMisc.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
 
 static const char *yesno[2]={QT_TR_NOOP(&quot;No&quot;),QT_TR_NOOP(&quot;Yes&quot;)};
 extern const char *getStrFromAudioCodec( uint32_t codec);
 
-propWindow::propWindow() : QDialog()
+propWindow::propWindow(QWidget *parent) : QDialog(parent)
  {
      ui.setupUi(this);
      uint8_t gmc, qpel,vop;
@@ -109,15 +110,16 @@
 */
 void DIA_properties( void )
 {
+	if (playing)
+		return;
 
-      if (playing)
-        return;
-      if (!avifileinfo)
-        return;
-     // Fetch info
-     propWindow *propwindow=new propWindow ;
-     propwindow-&gt;exec();
-     delete propwindow;
+	if (!avifileinfo)
+		return;
+
+	propWindow propwindow(qtLastRegisteredDialog());
+	qtRegisterDialog(&amp;propwindow);
+	propwindow.exec();
+	qtUnregisterDialog(&amp;propwindow);
 }  
 //********************************************
 //EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_props.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_props.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_props.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -3,12 +3,12 @@
 
 #include &quot;ui_props.h&quot;
 
-class propWindow : public QDialog
-{
-	Q_OBJECT
-
-public:
-	propWindow();
-	Ui_propsDialog ui;
-};
-#endif	// Q_props_h
+class propWindow : public QDialog
+{
+	Q_OBJECT
+
+public:
+	propWindow(QWidget *parent);
+	Ui_propsDialog ui;
+};
+#endif	// Q_props_h

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_vobsub.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_vobsub.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_vobsub.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -18,12 +18,13 @@
 
 #include &quot;Q_vobsub.h&quot;
 #include &quot;DIA_fileSel.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
 #if 0
 //
 //	Video is in YV12 Colorspace
 //
 //
-  Ui_vobsubWindow::Ui_vobsubWindow(vobSubParam *parm)
+  Ui_vobsubWindow::Ui_vobsubWindow(QWidget *parent, vobSubParam *parm) : QDialog(parent)
   {
     uint32_t width,height;
     	this-&gt;param=parm;
@@ -99,14 +100,20 @@
 */
 uint8_t DIA_vobsub(vobSubParam *param)
 {
-        uint8_t ret=0;
-        Ui_vobsubWindow dialog(param);        
-        if(dialog.exec()==QDialog::Accepted)
-        {
-        	dialog.gather();
-            ret=1;
-        }
-        return ret;
+	uint8_t ret=0;
+	Ui_vobsubWindow dialog(param);
+
+	qtRegisterDialog(&amp;dialog);
+
+	if(dialog.exec()==QDialog::Accepted)
+	{
+		dialog.gather();
+		ret=1;
+	}
+
+	qtUnregisterDialog(&amp;dialog);
+
+	return ret;
 }
 //____________________________________
 // EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_vobsub.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_vobsub.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_vobsub.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -16,7 +16,7 @@
 	void fillLanguage(const char *file);
 
 public:
-	Ui_vobsubWindow(vobSubParam *param);
+	Ui_vobsubWindow(QWidget *parent, vobSubParam *param);
 	~Ui_vobsubWindow();
 	Ui_vobSubDialog ui;
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_working.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_working.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_working.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -17,14 +17,15 @@
 #include &quot;ADM_default.h&quot;
 #include &quot;ADM_vidMisc.h&quot;
 #include &quot;DIA_working.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
 
 extern void UI_purge(void);
 
-workWindow::workWindow()     : QDialog()
+workWindow::workWindow(QWidget *parent) : QDialog(parent)
  {
      ui.setupUi(this);
      active=true;
-     setWindowModality (Qt::ApplicationModal);
+     setWindowModality(Qt::ApplicationModal);
      connect( ui.buttonCancel,SIGNAL(clicked(bool)),this,SLOT(stop(bool)));
  }
  void workWindow::stop(bool a) 
@@ -54,16 +55,15 @@
 };
 //********************************************************
 
-DIA_workingQt4::DIA_workingQt4( const char *title ) : DIA_workingBase(title)
+DIA_workingQt4::DIA_workingQt4(const char *title) : DIA_workingBase(title)
 {
-  workWindow *wind;
-  wind=new workWindow();
-  _priv=(void *)wind;
-  wind-&gt;setWindowTitle(title);
-  postCtor();
+	workWindow *wind = new workWindow(qtLastRegisteredDialog());
+	qtRegisterDialog(wind);
+    _priv=(void *)wind;
+	wind-&gt;setWindowTitle(title);
+	postCtor();  
+}
 
-  
-}
 void DIA_workingQt4 :: postCtor( void )
 {
   workWindow *wind=(workWindow *)_priv; ADM_assert(wind);
@@ -140,14 +140,21 @@
     closeDialog();
 }
 
-void DIA_workingQt4::closeDialog( void )
+void DIA_workingQt4::closeDialog(void)
 {
-  workWindow *wind=(workWindow *)_priv; ADM_assert(wind);
-    if(wind) delete wind;
-    wind=NULL;
-    _priv=NULL;
-   
+	workWindow *wind = (workWindow*)_priv;
+	ADM_assert(wind);
+
+	if (wind)
+	{
+		qtUnregisterDialog(wind);
+		delete wind;
+	}
+
+	wind = NULL;
+	_priv = NULL;
 }
+
 /**
     \fn createWorking
 */

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_working.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_working.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/Q_working.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -7,11 +7,11 @@
 {
 	Q_OBJECT
     
-public:
+public:
     bool active;
-	workWindow();
-	Ui_workingDialog ui;
-public slots:
+	workWindow(QWidget *parent);
+	Ui_workingDialog ui;
+public slots:
     void stop(bool a);
 };
 #endif	// Q_working_h

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/T_index_pg.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/T_index_pg.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/T_index_pg.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -21,11 +21,9 @@
 
 #include &quot;T_index_pg.h&quot;
 #include &quot;ADM_default.h&quot;
-//#include &quot;ADM_videoFilter.h&quot;
-//#include &quot;ADM_encoderConf.h&quot;
-//#include &quot;ADM_encoder/adm_encoder.h&quot;
 #include &quot;DIA_idx_pg.h&quot;
 #include &quot;ADM_vidMisc.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
 
 extern void UI_purge( void );
 
@@ -94,7 +92,8 @@
 
 DIA_progressIndexing::DIA_progressIndexing(const char *name)
 {
-        dialog=new Ui_indexingDialog(name);
+        dialog=new Ui_indexingDialog(qtLastRegisteredDialog(), name);
+		qtRegisterDialog(dialog);
         clock.reset();
         aborted=0;
 	_nextUpdate=0;
@@ -105,6 +104,7 @@
 DIA_progressIndexing::~DIA_progressIndexing()
 {
         ADM_assert(dialog);
+		qtUnregisterDialog(dialog);
         delete dialog;
         dialog=NULL;
 }
@@ -162,7 +162,7 @@
         return 1;
 }
 //****************************** CLASS ***********************
-Ui_indexingDialog::Ui_indexingDialog(const char *name)
+Ui_indexingDialog::Ui_indexingDialog(QWidget *parent, const char *name) : QDialog(parent)
 {
       abted=0;
       ui.setupUi(this);

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/T_index_pg.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/T_index_pg.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/T_index_pg.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -34,7 +34,7 @@
 public:
 	int abted;
 	Ui_iDialog ui;
-	Ui_indexingDialog(const char *name);
+	Ui_indexingDialog(QWidget *parent, const char *name);
 	~Ui_indexingDialog();
 	void setTime(const char *f);
 	void setImage(const char *f);

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/alert_qt4.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/alert_qt4.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_dialog/alert_qt4.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -21,228 +21,217 @@
 #include &quot;DIA_coreUI_internal.h&quot;
 #include &quot;ADM_default.h&quot;
 #include &quot;prefs.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
 
 static int beQuiet=0;
-extern QWidget *QuiMainWindows;
+
 namespace ADM_Qt4CoreUIToolkit
 {
-//****************************************************************************************************
-void            GUI_Alert(const char *alertstring)
-{
-    QMessageBox::StandardButton reply;
-              reply = QMessageBox::critical(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP(&quot;Alert&quot;)),
-                                        QString::fromUtf8(alertstring),
-                                        QMessageBox::Ok );
-}
-//****************************************************************************************************
-void            GUI_Info(const char *alertstring)
-{
-    QMessageBox::StandardButton reply;
-              reply = QMessageBox::information(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP(&quot;Info&quot;)),
-                                        QString::fromUtf8(alertstring),
-                                        QMessageBox::Ok );
-}
+	void GUI_Alert(const char *alertstring)
+	{
+		QMessageBox::critical(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP(&quot;Alert&quot;)),
+			QString::fromUtf8(alertstring), QMessageBox::Ok );
+	}
 
-//****************************************************************************************************
-void            GUI_Info_HIG(const ADM_LOG_LEVEL level,const char *primary, const char *secondary_format)
-{
-  uint32_t msglvl=2;
-  char alertstring[1024];
+	void GUI_Info(const char *alertstring)
+	{
+		QMessageBox::information(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP(&quot;Info&quot;)),
+			QString::fromUtf8(alertstring), QMessageBox::Ok );
+	}
 
-        prefs-&gt;get(MESSAGE_LEVEL,&amp;msglvl);
+	void GUI_Info_HIG(const ADM_LOG_LEVEL level,const char *primary, const char *secondary_format)
+	{
+		uint32_t msglvl=2;
+		QString alertString;
 
-        if(msglvl&lt;level)
-        {
-                printf(&quot;Info : %s \n&quot;,primary);
-                return;
-        }
+		prefs-&gt;get(MESSAGE_LEVEL,&amp;msglvl);
 
-        if(! secondary_format)
-        {
-            snprintf(alertstring,1024,&quot;&lt;big&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/big&gt;&quot;,primary);
-         }else
-         {
-        	 snprintf(alertstring,1024,&quot;&lt;big&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/big&gt;&lt;br&gt;&lt;br&gt;%s&quot;,primary,secondary_format);
-         }
-        QString info=QString::fromUtf8(alertstring);
-        QString info2=info.replace(&quot;\n&quot;,&quot;&lt;br&gt;&quot;);
-        QMessageBox::StandardButton reply;
-        reply = QMessageBox::information(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP(&quot;Info&quot;)),
-                                    info,
-                                    QMessageBox::Ok );
+		if(msglvl&lt;level)
+		{
+			printf(&quot;Info : %s \n&quot;,primary);
+			return;
+		}
 
-}
-//****************************************************************************************************
-void            GUI_Error_HIG(const char *primary, const char *secondary_format)
-{
-  uint32_t msglvl=2;
-  char alertstring[1024];
-  
-  
-        prefs-&gt;get(MESSAGE_LEVEL,&amp;msglvl);
+		if(! secondary_format)
+			alertString = &quot;&lt;big&gt;&lt;b&gt;&quot; + QString::fromUtf8(primary) + &quot;&lt;/b&gt;&lt;/big&gt;&quot;;
+		else
+		{
+			alertString = &quot;&lt;big&gt;&lt;b&gt;&quot; + QString::fromUtf8(primary) + &quot;&lt;/b&gt;&lt;/big&gt;&lt;br&gt;&lt;br&gt;&quot; + QString::fromUtf8(secondary_format);
+			alertString.replace(&quot;\n&quot;, &quot;&lt;br&gt;&quot;);
+		}
 
-        if(msglvl==ADM_LOG_NONE) 
-        {
-                printf(&quot;Error :%s\n&quot;,primary);
-                return;
-        }
+		QMessageBox::information(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP(&quot;Info&quot;)),
+			alertString, QMessageBox::Ok);
+	}
 
-        if(! secondary_format)
-        {
-            snprintf(alertstring,1024,&quot;&lt;big&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/big&gt;&quot;,primary);
-         }else
-         {
-        	 snprintf(alertstring,1024,&quot;&lt;big&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/big&gt;&lt;br&gt;&lt;br&gt;%s&quot;,primary,secondary_format);
-         }
-          QMessageBox::StandardButton reply;
-          QString info=QString::fromUtf8(alertstring);
-          QString info2=info.replace(&quot;\n&quot;,&quot;&lt;br&gt;&quot;);
-          reply = QMessageBox::critical(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP(&quot;Info&quot;)),
-                                    info2,
-                                    QMessageBox::Ok );
-}
-//****************************************************************************************************
-int             GUI_Confirmation_HIG(const char *button_confirm, const char *primary, const char *secondary_format)
-{
-uint32_t msglvl=2;
-char alertstring[1024];
+	void GUI_Error_HIG(const char *primary, const char *secondary_format)
+	{
+		uint32_t msglvl=2;
+		QString alertString;
 
-        if (beQuiet)
-              {
-                      printf(&quot;Info: %s\n&quot;, primary);
-                      return 0;
-              }
-        
-        if (!secondary_format)
-        {
-              snprintf(alertstring,1024,&quot;&lt;big&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/big&gt;&quot;,primary);
-        }
-        else
-        {	
-        	snprintf(alertstring,1024,&quot;&lt;big&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/big&gt;&lt;br&gt;&lt;br&gt;%s&quot;,primary,secondary_format);
-        }
-          QMessageBox::StandardButton reply;
-          reply = QMessageBox::question(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP(&quot;Confirmation&quot;)),
-                                    QString::fromUtf8(alertstring),
-                                    QMessageBox::Yes | QMessageBox::No );
-          if(reply==QMessageBox::Yes) return 1;
-        return 0; 
-}
-//****************************************************************************************************
-int             GUI_YesNo(const char *primary, const char *secondary_format)
-{
-uint32_t msglvl=2;
-char alertstring[1024];
-        if (beQuiet)
-              {
-                      printf(&quot;Info: %s\n&quot;, primary);
-                      return 0;
-              }
-        
-        if (!secondary_format)
-        {
-              snprintf(alertstring,1024,&quot;&lt;big&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/big&gt;&quot;,primary);
-        }
-        else
-        {	
-        	snprintf(alertstring,1024,&quot;&lt;big&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/big&gt;&lt;br&gt;&lt;br&gt;%s&quot;,primary,secondary_format);
-        }
-          QMessageBox::StandardButton reply;
-          reply = QMessageBox::question(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP(&quot;Confirmation&quot;)),
-                                    QString::fromUtf8(alertstring),
-                                    QMessageBox::Yes | QMessageBox::No );
-          if(reply==QMessageBox::Yes) return 1;
-        return 0; 
-}
-//****************************************************************************************************
-int             GUI_Question(const char *alertstring)
-{
- QMessageBox::StandardButton reply;
-          if (beQuiet)
-              {
-                      printf(&quot;Question: %s\n&quot;, alertstring);
-                      return 0;
-              }
-          reply = QMessageBox::question(QuiMainWindows, QString::fromUtf8(QT_TR_NOOP(&quot;Question&quot;)),
-                                    QString::fromUtf8(alertstring),
-                                    QMessageBox::Yes | QMessageBox::No );
-          if(reply==QMessageBox::Yes) return 1;
-          return 0;
-}
-/**
-    \fn GUI_Alternate(char *title,char *choice1,char *choice2)
-    \brief Popup a dialog box name title with 2 buttons (choice1/choice2)
-    \return 0 if first is selected, 1 if second
-*/
+		prefs-&gt;get(MESSAGE_LEVEL,&amp;msglvl);
+
+		if(msglvl==ADM_LOG_NONE) 
+		{
+			printf(&quot;Error :%s\n&quot;,primary);
+			return;
+		}
+
+		if(! secondary_format)
+			alertString = &quot;&lt;big&gt;&lt;b&gt;&quot; + QString::fromUtf8(primary) + &quot;&lt;/b&gt;&lt;/big&gt;&quot;;
+		else
+		{
+			alertString = &quot;&lt;big&gt;&lt;b&gt;&quot; + QString::fromUtf8(primary) + &quot;&lt;/b&gt;&lt;/big&gt;&lt;br&gt;&lt;br&gt;&quot; + QString::fromUtf8(secondary_format);
+			alertString.replace(&quot;\n&quot;, &quot;&lt;br&gt;&quot;);
+		}
+
+		QMessageBox::critical(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP(&quot;Info&quot;)),
+			alertString, QMessageBox::Ok);
+	}
+
+	int GUI_Confirmation_HIG(const char *button_confirm, const char *primary, const char *secondary_format)
+	{
+		QString alertString;
+
+		if (beQuiet)
+		{
+			printf(&quot;Info: %s\n&quot;, primary);
+			return 0;
+		}
+
+		if (!secondary_format)
+			alertString = &quot;&lt;big&gt;&lt;b&gt;&quot; + QString::fromUtf8(primary) + &quot;&lt;/b&gt;&lt;/big&gt;&quot;;
+		else
+		{	
+			alertString = &quot;&lt;big&gt;&lt;b&gt;&quot; + QString::fromUtf8(primary) + &quot;&lt;/b&gt;&lt;/big&gt;&lt;br&gt;&lt;br&gt;&quot; + QString::fromUtf8(secondary_format);
+			alertString.replace(&quot;\n&quot;, &quot;&lt;br&gt;&quot;);
+		}
+
+		QMessageBox::StandardButton reply;
+
+		reply = QMessageBox::question(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP(&quot;Confirmation&quot;)),
+			alertString, QMessageBox::Yes | QMessageBox::No);
+
+		if (reply == QMessageBox::Yes)
+			return 1;
+
+		return 0; 
+	}
+
+	int GUI_YesNo(const char *primary, const char *secondary_format)
+	{
+		uint32_t msglvl=2;
+		QString alertString;
+
+		if (beQuiet)
+		{
+			printf(&quot;Info: %s\n&quot;, primary);
+			return 0;
+		}
+
+		if (!secondary_format)
+			alertString = &quot;&lt;big&gt;&lt;b&gt;&quot; + QString::fromUtf8(primary) + &quot;&lt;/b&gt;&lt;/big&gt;&quot;;
+		else
+		{	
+			alertString = &quot;&lt;big&gt;&lt;b&gt;&quot; + QString::fromUtf8(primary) + &quot;&lt;/b&gt;&lt;/big&gt;&lt;br&gt;&lt;br&gt;&quot; + QString::fromUtf8(secondary_format);
+			alertString.replace(&quot;\n&quot;, &quot;&lt;br&gt;&quot;);
+		}
+
+		QMessageBox::StandardButton reply;
+
+		reply = QMessageBox::question(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP(&quot;Confirmation&quot;)),
+			alertString, QMessageBox::Yes | QMessageBox::No );
+
+		if (reply == QMessageBox::Yes)
+			return 1;
+
+		return 0; 
+	}
+
+	int GUI_Question(const char *alertstring)
+	{
+		QMessageBox::StandardButton reply;
+
+		if (beQuiet)
+		{
+			printf(&quot;Question: %s\n&quot;, alertstring);
+			return 0;
+		}
+
+		reply = QMessageBox::question(qtLastRegisteredDialog(), QString::fromUtf8(QT_TR_NOOP(&quot;Question&quot;)),
+			QString::fromUtf8(alertstring), QMessageBox::Yes | QMessageBox::No);
+
+		if (reply==QMessageBox::Yes)
+			return 1;
+
+		return 0;
+	}
+	/**
+	\fn GUI_Alternate(char *title,char *choice1,char *choice2)
+	\brief Popup a dialog box name title with 2 buttons (choice1/choice2)
+	\return 0 if first is selected, 1 if second
+	*/
 int      GUI_Alternate(const char *title,const char *choice1,const char *choice2)
-{
-int reply;
-QMessageBox *box;
-    if (beQuiet)
-              {
-                      printf(&quot;Alternate&lt;%s&gt;: %s or %s\n&quot;, title,choice1,choice2);
-                      return 0;
-              }
+	{
+		if (beQuiet)
+		{
+			printf(&quot;Alternate&lt;%s&gt;: %s or %s\n&quot;, title,choice1,choice2);
+			return 0;
+		}
 
-char alertstring[1024];
+		QMessageBox box(qtLastRegisteredDialog());
 
-        box=new QMessageBox(QuiMainWindows);
-        box-&gt;setWindowTitle(QString::fromUtf8(QT_TR_NOOP(&quot;Question ?&quot;)));
-        box-&gt;addButton(choice1,QMessageBox::YesRole);
-        box-&gt;addButton(choice2,QMessageBox::NoRole);
-         if (title)
-        {
-              snprintf(alertstring,1024,&quot;%s&quot;,title);
-        }else
-        {
-            snprintf(alertstring,1024,QT_TR_NOOP(&quot;Question&quot;));
-        }
-        box-&gt;setText(QString::fromUtf8(alertstring));
-        box-&gt;setIcon(QMessageBox::Question);
-        reply = box-&gt;exec();
-        delete box;
-        printf(&quot;Reply:%d\n&quot;,reply);
-        if(reply==0) return 1;
-        return 0;
+		box.setWindowTitle(QString::fromUtf8(QT_TR_NOOP(&quot;Question?&quot;)));
+		box.addButton(QString::fromUtf8(choice1),QMessageBox::YesRole);
+		box.addButton(QString::fromUtf8(choice2),QMessageBox::NoRole);
 
-}
-//****************************************************************************************************
-uint8_t  GUI_getDoubleValue(double *valye, float min, float max, const char *title)
-{
-  
-  
-  return 0; 
-}
-//****************************************************************************************************
-uint8_t		GUI_isQuiet(void)
-{
-    return beQuiet;
-}
-//****************************************************************************************************
-void            GUI_Verbose(void)
-{
-    beQuiet=0;
-}
-//****************************************************************************************************
-void            GUI_Quiet(void)
-{
-  beQuiet=1;
-}
-//****************************************************************************************************
-extern DIA_workingBase *createWorking(const char *title);
-extern DIA_encodingBase *createEncoding(uint64_t duration);
+		if (title)
+			box.setText(QString::fromUtf8(title));
+		else
+			box.setText(QObject::tr(&quot;Question&quot;));
 
-void getVersion(uint32_t *maj,uint32_t *minor)
-{
-    *maj=ADM_CORE_TOOLKIT_MAJOR;
-    *minor=ADM_CORE_TOOLKIT_MINOR;
-}
+		box.setIcon(QMessageBox::Question);
 
-void UI_purge( void )
-{
-	QCoreApplication::processEvents ();
+		if (box.exec() == 0)
+			return 1;
+		else
+			return 0;
+	}
+
+	uint8_t  GUI_getDoubleValue(double *valye, float min, float max, const char *title)
+	{
+		return 0; 
+	}
+
+	uint8_t	GUI_isQuiet(void)
+	{
+		return beQuiet;
+	}
+
+	void GUI_Verbose(void)
+	{
+		beQuiet=0;
+	}
+
+	void GUI_Quiet(void)
+	{
+		beQuiet=1;
+	}
+
+	extern DIA_workingBase *createWorking(const char *title);
+	extern DIA_encodingBase *createEncoding(uint64_t duration);
+
+	void getVersion(uint32_t *maj,uint32_t *minor)
+	{
+		*maj=ADM_CORE_TOOLKIT_MAJOR;
+		*minor=ADM_CORE_TOOLKIT_MINOR;
+	}
+
+	void UI_purge( void )
+	{
+		QCoreApplication::processEvents ();
+	}
 }
-}
 
 static CoreToolkitDescriptor Qt4CoreToolkitDescriptor=
 {
@@ -264,6 +253,5 @@
 void InitCoreToolkit(void )
 {
 	DIA_toolkitInit(&amp;Qt4CoreToolkitDescriptor);
-	
 }
 //EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters/Q_mainfilter.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters/Q_mainfilter.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters/Q_mainfilter.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -39,6 +39,7 @@
 #include &quot;ADM_filterCategory.h&quot;
 #include &quot;ADM_videoFilterApi.h&quot;
 #include &quot;ADM_videoFilters.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
 
 #include &quot;prefs.h&quot;
 
@@ -480,7 +481,7 @@
 }
   /**
   */
-filtermainWindow::filtermainWindow()     : QDialog()
+filtermainWindow::filtermainWindow(QWidget* parent) : QDialog(parent)
  {
         
     ui.setupUi(this);
@@ -561,10 +562,13 @@
 */
 int GUI_handleVFilter(void)
 {
-        filtermainWindow dialog;
-        if(QDialog::Accepted==dialog.exec())
-        {
-        }
+	filtermainWindow dialog(qtLastRegisteredDialog());
+	qtRegisterDialog(&amp;dialog);
+
+	dialog.exec();
+
+	qtUnregisterDialog(&amp;dialog);
+
 	return 0;
 }
 /** 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters/Q_mainfilter.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters/Q_mainfilter.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_filters/Q_mainfilter.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -33,7 +33,7 @@
 	Q_OBJECT
 
 public:
-	filtermainWindow();
+	filtermainWindow(QWidget* parent);
     ~filtermainWindow();
 	void buildActiveFilterList(void);
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_gui/Q_gui2.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -1,1251 +1,1253 @@
-/***************************************************************************
-    copyright            : (C) 2001 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;ADM_cpp.h&quot;
-#include &quot;config.h&quot;
-
-#include &quot;ADM_inttype.h&quot;
-#include &lt;QtCore/QFileInfo&gt;
-#include &lt;QtCore/QUrl&gt;
-#include &lt;QtGui/QKeyEvent&gt;
-#include &lt;QtGui/QGraphicsView&gt;
-
-#define MENU_DECLARE
-#include &quot;Q_gui2.h&quot;
-#include &quot;ADM_default.h&quot;
-
-#include &quot;DIA_fileSel.h&quot;
-#include &quot;ADM_vidMisc.h&quot;
-#include &quot;prefs.h&quot;
-#include &quot;avi_vars.h&quot;
-
-#include &quot;ADM_render/GUI_renderInternal.h&quot;
-#include &quot;ADM_coreVideoEncoderInternal.h&quot;
-#include &quot;ADM_muxerProto.h&quot;
-#include &quot;T_vumeter.h&quot;
-#include &quot;DIA_coreToolkit.h&quot;
-
-#ifdef USE_OPENGL
-extern bool ADM_glHasActiveTexture(void);
-void UI_Qt4InitGl(void);
-void UI_Qt4CleanGl(void);
-#endif
-
-extern int global_argc;
-extern char **global_argv;
-
-extern uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w,uint32_t *h);
-extern int automation(void );
-extern void HandleAction(Action a);
-extern int encoderGetEncoderCount (void);
-extern const char *encoderGetIndexedName (uint32_t i);
-uint32_t audioEncoderGetNumberOfEncoders(void);
-const char  *audioEncoderGetDisplayName(uint32_t i);
-extern void checkCrashFile(void);
-extern void UI_QT4VideoWidget(QFrame *frame);
-extern void loadTranslator(void);
-extern void initTranslator(void);
-extern void destroyTranslator(void);
-extern ADM_RENDER_TYPE UI_getPreferredRender(void);
-extern int A_openAvi(const char *name);
-extern int A_appendAvi(const char *name);
-extern void FileSel_ReadWrite(SELFILE_CB *cb, int rw, const char *name, const char *actual_workbench_file);
-
-
-int SliderIsShifted=0;
-static void setupMenus(void);
-static int shiftKeyHeld=0;
-static ADM_QSlider *slider=NULL;
-static int _upd_in_progres=0;
-static int currentFps = 0;
-static int frameCount = 0;
-static int currentFrame = 0;
-bool     ADM_ve6_getEncoderInfo(int filter, const char **name, uint32_t *major,uint32_t *minor,uint32_t *patch);
-uint32_t ADM_ve6_getNbEncoders(void);
-void UI_refreshCustomMenu(void);
-QWidget *QuiMainWindows=NULL;
-QWidget *VuMeter=NULL;
-QGraphicsView *drawWindow=NULL;
-uint8_t UI_updateRecentMenu( void );
-extern void saveCrashProject(void);
-extern uint8_t AVDM_setVolume(int volume);
-extern bool ADM_QPreviewCleanup(void);
-
-
-
-#define WIDGET(x)  (((MainWindow *)QuiMainWindows)-&gt;ui.x)
-
-#define CONNECT(object,zzz) connect( (ui.object),SIGNAL(triggered()),this,SLOT(buttonPressed()));
-#define CONNECT_TB(object,zzz) connect( (ui.object),SIGNAL(clicked(bool)),this,SLOT(toolButtonPressed(bool)));
-#define DECLARE_VAR(object,signal_name) {#object,signal_name},
-
-#include &quot;translation_table.h&quot;   
-/*
-    Declare the table converting widget name to our internal signal           
-*/
-typedef struct 
-{
-	const char *name;
-	Action     action; 
-}adm_qt4_translation;
-
-const adm_qt4_translation myTranslationTable[]=
-{
-#define PROCESS DECLARE_VAR
-	LIST_OF_BUTTONS
-#undef PROCESS
-};
-static Action searchTranslationTable(const char *name);
-#define SIZEOF_MY_TRANSLATION sizeof(myTranslationTable)/sizeof(adm_qt4_translation)
-
-int UI_readCurTime(uint16_t &amp;hh, uint16_t &amp;mm, uint16_t &amp;ss, uint16_t &amp;ms);
-void UI_updateFrameCount(uint32_t curFrame);
-void UI_updateTimeCount(uint32_t curFrame,uint32_t fps);
-extern void UI_purge(void);
-/*
-    Declare the class that will be our main window
-
-*/
-
-void MainWindow::comboChanged(int z)
-{
-	const char *source=qPrintable(sender()-&gt;objectName());
-
-	if(!strcmp(source,&quot;comboBoxVideo&quot;))  
-	{
-		bool b=FALSE;
-		if(ui.comboBoxVideo-&gt;currentIndex())
-		{
-			b=TRUE;
-		}
-		ui.pushButtonVideoConf-&gt;setEnabled(b);
-		ui.pushButtonVideoFilter-&gt;setEnabled(b);
-		HandleAction (ACT_VIDEO_CODEC_CHANGED) ;
-	}
-	else if(!strcmp(source,&quot;comboBoxAudio&quot;))  
-	{
-		bool b=FALSE;
-		if(ui.comboBoxAudio-&gt;currentIndex())
-		{
-			b=TRUE;
-		}
-		ui.pushButtonAudioConf-&gt;setEnabled(b);
-		ui.pushButtonAudioFilter-&gt;setEnabled(b);
-		HandleAction (ACT_AUDIO_CODEC_CHANGED) ;
-	}
-	else
-		printf(&quot;From +: %s\n&quot;,source);
-}
-
-void MainWindow::sliderValueChanged(int u) 
-{
-	if(!_upd_in_progres)
-		HandleAction(ACT_Scale);
-}
-
-void MainWindow::sliderMoved(int value)
-{
-	SliderIsShifted = shiftKeyHeld;
-}
-
-void MainWindow::sliderReleased(void)
-{
-	SliderIsShifted = 0;
-}
-
-void MainWindow::thumbSlider_valueEmitted(int value)
-{
-        if (value &gt; 0)
-                nextIntraFrame();
-        else
-                previousIntraFrame();
-}
-
-void MainWindow::volumeChange( int u )
-{
-	if (_upd_in_progres || !ui.toolButtonAudioToggle-&gt;isChecked())
-		return;
-
-	_upd_in_progres++;
-
-	int vol = ui.horizontalSlider_2-&gt;value();
-
-	AVDM_setVolume(vol);
-	_upd_in_progres--;
-}
-
-void MainWindow::audioToggled(bool checked)
-{
-	if (checked)
-		AVDM_setVolume(ui.horizontalSlider_2-&gt;value());
-	else
-		AVDM_setVolume(0);
-}
-
-void MainWindow::previewModeChanged(QAction *action)
-{
-	HandleAction(ACT_PreviewChanged);
-}
-
-void MainWindow::timeChangeFinished(void)
-{
-	this-&gt;setFocus(Qt::OtherFocusReason);
-}
-
-void MainWindow::currentFrameChanged(void)
-{
-//	HandleAction(ACT_JumpToFrame);
-
-	this-&gt;setFocus(Qt::OtherFocusReason);
-}
-
-void MainWindow::currentTimeChanged(void)
-{
-	HandleAction(ACT_GotoTime);
-
-	this-&gt;setFocus(Qt::OtherFocusReason);
-}
-
-/**
-    \fn ctor
-*/
-MainWindow::MainWindow() : QMainWindow()
-{
-	ui.setupUi(this);
-
-#if defined(__APPLE__) &amp;&amp; defined(USE_SDL)
-	ui.actionAbout_avidemux-&gt;setMenuRole(QAction::NoRole);
-	ui.actionPreferences-&gt;setMenuRole(QAction::NoRole);
-	ui.actionQuit-&gt;setMenuRole(QAction::NoRole);
-#endif
-
-	// Preview modes
-	QActionGroup *groupPreviewModes = new QActionGroup(this);
-
-	groupPreviewModes-&gt;addAction(ui.actionPreviewInput);
-	groupPreviewModes-&gt;addAction(ui.actionPreviewOutput);
-	connect(groupPreviewModes, SIGNAL(triggered(QAction*)), this, SLOT(previewModeChanged(QAction*)));
-
-	/*
-	Connect our button to buttonPressed
-	*/
-#define PROCESS CONNECT_TB
-	LIST_OF_BUTTONS
-#undef PROCESS
-
-	//ACT_VideoCodecChanged
-	connect( ui.comboBoxVideo,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
-	connect( ui.comboBoxAudio,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
-
-	// Slider
-	slider=ui.horizontalSlider;
-	slider-&gt;setMinimum(0);
-	slider-&gt;setMaximum(1000000000);
-	connect( slider,SIGNAL(valueChanged(int)),this,SLOT(sliderValueChanged(int)));
-	connect( slider,SIGNAL(sliderMoved(int)),this,SLOT(sliderMoved(int)));
-	connect( slider,SIGNAL(sliderReleased()),this,SLOT(sliderReleased()));
-
-   // Thumb slider
-    ui.sliderPlaceHolder-&gt;installEventFilter(this);
-    thumbSlider = new ThumbSlider(ui.sliderPlaceHolder);
-    connect(thumbSlider, SIGNAL(valueEmitted(int)), this, SLOT(thumbSlider_valueEmitted(int)));
-
-	// Volume slider
-	QSlider *volSlider=ui.horizontalSlider_2;
-	volSlider-&gt;setMinimum(0);
-	volSlider-&gt;setMaximum(100);
-	connect(volSlider,SIGNAL(valueChanged(int)),this,SLOT(volumeChange(int)));
-	connect(ui.toolButtonAudioToggle,SIGNAL(clicked(bool)),this,SLOT(audioToggled(bool)));
-
-	// default state
-	bool b=0;
-	ui.pushButtonVideoConf-&gt;setEnabled(b);
-	ui.pushButtonVideoFilter-&gt;setEnabled(b);
-	ui.pushButtonAudioConf-&gt;setEnabled(b);
-	ui.pushButtonAudioFilter-&gt;setEnabled(b);
-
-	/* Time Shift */
-	connect(ui.checkBox_TimeShift,SIGNAL(stateChanged(int)),this,SLOT(timeChanged(int)));
-	connect(ui.spinBox_TimeValue,SIGNAL(valueChanged(int)),this,SLOT(timeChanged(int)));
-	connect(ui.spinBox_TimeValue, SIGNAL(editingFinished()), this, SLOT(timeChangeFinished()));
-
-	QRegExp timeRegExp(&quot;^[0-9]{2}:[0-5][0-9]:[0-5][0-9]\\.[0-9]{3}$&quot;);
-	QRegExpValidator *timeValidator = new QRegExpValidator(timeRegExp, this);
-	ui.currentTime-&gt;setValidator(timeValidator);
-	ui.currentTime-&gt;setInputMask(&quot;99:99:99.999&quot;);
-
-	//connect(ui.currentTime, SIGNAL(editingFinished()), this, SLOT(currentTimeChanged()));
-
-    // Build file,... menu
-    buildMyMenu();
-
-	/* Build the custom menu */
-    jsMenu=new QMenu(&quot;javaScript&quot;);
-    pyMenu=new QMenu(&quot;tinyPython&quot;);
-    autoMenu=ui.menuAuto ;//new QMenu(&quot;autoPython&quot;);
-    ui.menuCustom-&gt;addMenu(jsMenu);
-    ui.menuCustom-&gt;addMenu(pyMenu);
-    //ui.menuAuto-&gt;addMenu(autoMenu);
-	buildCustomMenu();
-
-    recentFiles=new QMenu(&quot;Recent Files&quot;);
-    recentProjects=new QMenu(&quot;Recent Projects&quot;);
-    ui.menuRecent-&gt;addMenu(recentFiles);
-    ui.menuRecent-&gt;addMenu(recentProjects);
-    connect( ui.menuRecent,SIGNAL(triggered(QAction*)),this,SLOT(searchRecentFiles(QAction*)));
-
-	this-&gt;installEventFilter(this);
-	slider-&gt;installEventFilter(this);
-    
-	//ui.currentTime-&gt;installEventFilter(this);
-
-	this-&gt;setFocus(Qt::OtherFocusReason);
-
-	setAcceptDrops(true);
-    setWindowIcon(QIcon(&quot;:/new/prefix1/pics/avidemux_icon_small.png&quot;));
-
-    // Hook also the toolbar
-    connect(ui.toolBar,  SIGNAL(actionTriggered ( QAction *)),this,SLOT(searchToolBar(QAction *)));
-    connect(ui.toolBar_2,SIGNAL(actionTriggered ( QAction *)),this,SLOT(searchToolBar(QAction *)));
-
-	QWidget* dummy0 = new QWidget();
-	QWidget* dummy1 = new QWidget();
-	QWidget* dummy2 = new QWidget();
-	QWidget* dummy3 = new QWidget();
-	QWidget* dummy4 = new QWidget();
-
-	ui.codecWidget-&gt;setTitleBarWidget(dummy0);
-	ui.navigationWidget-&gt;setTitleBarWidget(dummy1);
-	ui.selectionWidget-&gt;setTitleBarWidget(dummy2);
-	ui.volumeWidget-&gt;setTitleBarWidget(dummy3);
-	ui.audioMetreWidget-&gt;setTitleBarWidget(dummy4);
-
-	this-&gt;resize(1, 1);
-}
-/**
-    \fn searchToolBar
-*/
-typedef struct 
-{
-    const char *name;
-    Action event;
-}toolBarTranslate;
-
-toolBarTranslate toolbar[]=
-{
-{&quot;actionOpen&quot;,              ACT_OPEN_VIDEO},
-{&quot;actionSave_video&quot;,        ACT_SAVE_VIDEO},
-{&quot;actionProperties&quot;,        ACT_VIDEO_PROPERTIES},
-{&quot;actionLoad_run_project&quot;,  ACT_RUN_PY_PROJECT},
-{&quot;actionSave_project&quot;,      ACT_SAVE_PY_PROJECT},
-//{&quot;actionPreviewInput&quot;,ACT_PreviewToggle},
-//{&quot;actionPreviewOutput&quot;,ACT_PreviewToggle},
-
-{NULL,ACT_DUMMY}
-};
-void MainWindow::searchToolBar(QAction *action)
-{
-        toolBarTranslate *t=toolbar;
-        QString me(action-&gt;objectName());
-        const char *name=me.toUtf8().constData();
-        while(t-&gt;name)
-        {
-            if(!strcmp(name,t-&gt;name))
-            {
-                HandleAction(t-&gt;event);
-                return;
-            }
-            t++;
-        }
-        ADM_warning(&quot;Toolbar:Cannot handle %s\n&quot;,name);
-}
-/**
-    \fn buildFileMenu
-*/
-bool MainWindow::buildMenu(QMenu *root,MenuEntry *menu, int nb)
-{
-    QMenu *subMenu=NULL;
-    for(int i=0;i&lt;nb;i++)
-    {
-        MenuEntry *m=menu+i;
-        switch(m-&gt;type)
-        {
-            case MENU_SEPARATOR:
-                root-&gt;addSeparator();
-                break;
-            case MENU_SUBMENU:
-                {
-                    subMenu=root-&gt;addMenu(m-&gt;text);
-                }
-                break;
-            case MENU_SUBACTION:
-            case MENU_ACTION:
-                {   
-                        QMenu *insert=root;
-                        if(m-&gt;type==MENU_SUBACTION) insert=subMenu;
-                        QAction *a=NULL;
-                        if(m-&gt;icon) 
-                        {
-                            QIcon icon(m-&gt;icon);
-                            a=insert-&gt;addAction(icon,m-&gt;text);
-                        }else
-                            a=insert-&gt;addAction(m-&gt;text);
-                        m-&gt;cookie=(void *)a;
-                        if(m-&gt;shortCut)
-                        {
-                            QKeySequence s(m-&gt;shortCut);
-                            a-&gt;setShortcut(s);
-                        }
-                        break;
-                }
-            default:
-                break;
-        }
-    }
-    return true;
-}
-/**
-    buildFileMenu
-*/
-bool MainWindow::buildMyMenu(void)
-{
-    connect( ui.menuFile,SIGNAL(triggered(QAction*)),this,SLOT(searchFileMenu(QAction*)));
-    buildMenu(ui.menuFile,myMenuFile, sizeof(myMenuFile)/sizeof(MenuEntry));
-
-    connect( ui.menuEdit,SIGNAL(triggered(QAction*)),this,SLOT(searchEditMenu(QAction*)));
-    buildMenu(ui.menuEdit,myMenuEdit, sizeof(myMenuEdit)/sizeof(MenuEntry));
-
-    connect( ui.menuVideo,SIGNAL(triggered(QAction*)),this,SLOT(searchVideoMenu(QAction*)));
-    buildMenu(ui.menuVideo,myMenuVideo, sizeof(myMenuVideo)/sizeof(MenuEntry));
-
-    connect( ui.menuAudio,SIGNAL(triggered(QAction*)),this,SLOT(searchAudioMenu(QAction*)));
-    buildMenu(ui.menuAudio,myMenuAudio, sizeof(myMenuAudio)/sizeof(MenuEntry));
-
-    connect( ui.menuHelp,SIGNAL(triggered(QAction*)),this,SLOT(searchHelpMenu(QAction*)));
-    buildMenu(ui.menuHelp,myMenuHelp, sizeof(myMenuHelp)/sizeof(MenuEntry));
-
-    connect( ui.menuTools,SIGNAL(triggered(QAction*)),this,SLOT(searchToolMenu(QAction*)));
-    buildMenu(ui.menuTools,myMenuTool, sizeof(myMenuTool)/sizeof(MenuEntry));
-
-    connect( ui.menuGo,SIGNAL(triggered(QAction*)),this,SLOT(searchGoMenu(QAction*)));
-    buildMenu(ui.menuGo,myMenuGo, sizeof(myMenuGo)/sizeof(MenuEntry));
-
-    connect( ui.menuView,SIGNAL(triggered(QAction*)),this,SLOT(searchViewMenu(QAction*)));
-    buildMenu(ui.menuView,myMenuView, sizeof(myMenuView)/sizeof(MenuEntry));
-
-    return true;
-}
-
-/**
-    \fn timeChanged
-    \brief Called whenever timeshift is on/off'ed or value changes
-*/
-void MainWindow::timeChanged(int)
-{
-	HandleAction (ACT_TimeShift) ;
-}
-/**
-    \fn searchMenu
-*/
-void MainWindow::searchMenu(QAction * action,MenuEntry *menu, int nb)
-{
-    for(int i=0;i&lt;nb;i++)
-    {
-        MenuEntry *m=menu+i;
-        if(m-&gt;cookie==(void*)action)
-        {
-            HandleAction (m-&gt;event);
-        }
-    }
-}
-
-/**
-    \fn searchFileMenu
-*/
-#define MKMENU(name) void MainWindow::search##name##Menu(QAction * action) \
-    {searchMenu(action,myMenu##name,sizeof(myMenu##name)/sizeof(MenuEntry));}
-
-MKMENU(File)
-MKMENU(Edit)
-//MKMENU(Recent)
-MKMENU(View)
-MKMENU(Tool)
-MKMENU(Go)
-//MKMENU(Custom)
-MKMENU(Audio)
-MKMENU(Video)
-MKMENU(Help)
-
-
-
-/*
-      We receive a button press event
-*/
-void MainWindow::buttonPressed(void)
-{
-	// Receveid a key press Event, look into table..
-    QObject *obj=sender();
-    if(!obj) return;
-    QString me(obj-&gt;objectName());
-    
-	Action action=searchTranslationTable(qPrintable(me));
-    
-
-	if(action!=ACT_DUMMY)
-		HandleAction (action);
-
-}
-void MainWindow::toolButtonPressed(bool i)
-{
-	buttonPressed();
-}
-
-bool MainWindow::eventFilter(QObject* watched, QEvent* event)
-{
-	QKeyEvent *keyEvent;
-
-	switch (event-&gt;type())
-	{
-		case QEvent::KeyPress:
-			keyEvent = (QKeyEvent*)event;
-
-			if (watched == slider)
-			{
-				switch (keyEvent-&gt;key())
-				{
-					case Qt::Key_Left:
-						if (keyEvent-&gt;modifiers() == Qt::ShiftModifier)
-							HandleAction(ACT_Back25Frames);
-						else if (keyEvent-&gt;modifiers() == Qt::ControlModifier)
-							HandleAction(ACT_Back50Frames);
-						else
-							HandleAction(ACT_PreviousFrame);
-
-						return true;
-					case Qt::Key_Right:
-						if (keyEvent-&gt;modifiers() == Qt::ShiftModifier)
-							HandleAction(ACT_Forward25Frames);
-						else if (keyEvent-&gt;modifiers() == Qt::ControlModifier)
-							HandleAction(ACT_Forward50Frames);
-						else
-							HandleAction(ACT_NextFrame);
-
-						return true;
-					case Qt::Key_Up:
-						HandleAction(ACT_NextKFrame);
-						return true;
-					case Qt::Key_Down:
-						HandleAction(ACT_PreviousKFrame);
-						return true;
-					case Qt::Key_Shift:
-						shiftKeyHeld = 1;
-						break;
-				}
-			}
-			else if (keyEvent-&gt;key() == Qt::Key_Space)
-			{
-				HandleAction(ACT_PlayAvi);
-				return true;
-			}
-
-			break;
-        case QEvent::Resize:
-            if (watched == ui.sliderPlaceHolder)
-            {
-                    thumbSlider-&gt;resize(ui.sliderPlaceHolder-&gt;width(), 16);
-                    thumbSlider-&gt;move(0, (ui.sliderPlaceHolder-&gt;height() - thumbSlider-&gt;height()) / 2);
-            }
-            break;
-
-		case QEvent::KeyRelease:
-			keyEvent = (QKeyEvent*)event;
-
-			if (keyEvent-&gt;key() == Qt::Key_Shift)
-				shiftKeyHeld = 0;
-
-			break;
-		case QEvent::FocusOut:
-            break;
-        default:
-            break;
-	}
-
-	return QObject::eventFilter(watched, event);
-}
-/**
-    \fn buildRecentMenu
-*/
-bool MainWindow::buildRecentMenu(void)
-{
-    const char **names;
-	names=prefs-&gt;get_lastfiles();
-    // Purge entries...
-    recentFiles-&gt;clear();
-    for(int i=0;i&lt;4;i++)
-    {
-        if(names[i])
-        {
-            recentFileAction[i]=recentFiles-&gt;addAction(QString('0'+i)+QString(&quot;:&quot;)+QString::fromUtf8(names[i]));
-        }else
-            recentFileAction[i]=NULL;
-    }
-	return true;
-}
-/**
-    \fn searchRecentFiles
-*/
-void MainWindow::searchRecentFiles(QAction * action)
-{
-    for(int i=0;i&lt;4;i++)
-    {
-            QAction *a= recentFileAction[i];
-            if(!a) continue;
-
-            if(a==action) 
-            {
-                HandleAction((Action)(ACT_RECENT0+i));
-                return;
-            }
-    }
-}
-void MainWindow::mousePressEvent(QMouseEvent* event)
-{
-	this-&gt;setFocus(Qt::OtherFocusReason);
-}
-
-void MainWindow::dragEnterEvent(QDragEnterEvent *event)
-{
-	if (event-&gt;mimeData()-&gt;hasFormat(&quot;text/uri-list&quot;))
-		event-&gt;acceptProposedAction();
-}
-
-void MainWindow::dropEvent(QDropEvent *event)
-{
-	QList&lt;QUrl&gt; urlList;
-	QString fileName;
-	QFileInfo info;
-    const char *cFileName;
-
-	if (event-&gt;mimeData()-&gt;hasUrls())
-	{
-		urlList = event-&gt;mimeData()-&gt;urls();
-
-		for (int fileIndex = 0; fileIndex &lt; urlList.size(); fileIndex++)
-		{
-			fileName = urlList[fileIndex].toLocalFile();
-			info.setFile(fileName);
-            cFileName=ADM_strdup(fileName.toUtf8().constData());
-            ADM_info(&quot;Drop event %s\n&quot;,cFileName);
-			if (info.isFile())
-			{
-				if (avifileinfo)
-                {
-                    ADM_info(&quot;Appending..\n&quot;);
-                    A_appendAvi(cFileName);
-                }
-				else
-                {
-                    ADM_info(&quot;Opening..\n&quot;);
-                    A_openAvi(cFileName);
-                }
-			}else
-            {
-                ADM_warning(&quot;Dropped item is not a file\n&quot;);
-            }
-            ADM_dealloc(cFileName);
-		}
-	}
-
-	event-&gt;acceptProposedAction();
-}
-
-void MainWindow::previousIntraFrame(void)
-{
-	if (ui.spinBox_TimeValue-&gt;hasFocus())
-		ui.spinBox_TimeValue-&gt;stepDown();
-	else
-		HandleAction(ACT_PreviousKFrame);
-}
-
-void MainWindow::nextIntraFrame(void)
-{
-	if (ui.spinBox_TimeValue-&gt;hasFocus())
-		ui.spinBox_TimeValue-&gt;stepUp();
-	else
-		HandleAction(ACT_NextKFrame);
-}
-
-MainWindow::~MainWindow()
-{
-	clearCustomMenu();
-    delete thumbSlider;
-    thumbSlider=NULL;
-}
-
-void MainWindow::closeEvent(QCloseEvent *event)
-{
-static bool first=true;
-    ADM_warning(&quot;Close event\n&quot;);
-    if(first)
-    {
-        first=false;
-        HandleAction(ACT_EXIT);
-    }
-    event-&gt;accept();
-//         event-&gt;ignore();
-
-}
-
-
-static const UI_FUNCTIONS_T UI_Hooks=
-    {
-        ADM_RENDER_API_VERSION_NUMBER,
-        UI_getWindowInfo,
-        UI_updateDrawWindowSize,
-        UI_rgbDraw,
-        UI_getDrawWidget,
-        UI_getPreferredRender
-        
-    };
-QApplication *myApplication=NULL;
-/**
-    \fn  UI_Init
-    \brief First part of UI initialization
-
-*/
-int UI_Init(int nargc,char **nargv)
-{
-    ADM_info(&quot;Starting QT4 GUI...\n&quot;);
-	initTranslator();
-
-	global_argc=nargc;
-	global_argv=nargv;
-	ADM_renderLibInit(&amp;UI_Hooks);
-    Q_INIT_RESOURCE(avidemux);
-	Q_INIT_RESOURCE(filter);
-
-	myApplication=new QApplication (global_argc, global_argv);
-	myApplication-&gt;connect(myApplication, SIGNAL(lastWindowClosed()), myApplication, SLOT(quit()));
-
-	loadTranslator();
-
-	MainWindow *mw = new MainWindow();
-	mw-&gt;show();
-
-	QuiMainWindows = (QWidget*)mw;
-
-	uint32_t w, h;
-
-	UI_getPhysicalScreenSize(QuiMainWindows, &amp;w,&amp;h);
-	printf(&quot;The screen seems to be %u x %u px\n&quot;,w,h);
-
-	UI_QT4VideoWidget(mw-&gt;ui.frame_video);  // Add the widget that will handle video display
-	UI_updateRecentMenu();
-
-    // Init vumeter
-    VuMeter=mw-&gt;ui.frameVU;
-    UI_InitVUMeter(mw-&gt;ui.frameVU);
-	return 0;
-}
-/**
-
-*/
-bool UI_End(void)
-{
-    ADM_QPreviewCleanup();
-    return true;
-}
-void UI_refreshCustomMenu(void)
-{
-	((MainWindow*)QuiMainWindows)-&gt;buildCustomMenu();
-}
-
-/**
-    \fn UI_getCurrentPreview(void)
-    \brief Read previewmode from comboxbox 
-*/
-int UI_getCurrentPreview(void)
-{
-	int index;
-
-	if (WIDGET(actionPreviewOutput)-&gt;isChecked())
-		index = 1;
-	else if (WIDGET(actionPreviewSide)-&gt;isChecked())
-		index = 2;
-	else if (WIDGET(actionPreviewTop)-&gt;isChecked())
-		index = 3;
-	else if (WIDGET(actionPreviewSeparate)-&gt;isChecked())
-		index = 4;
-	else
-		index = 0;
-
-	return index;
-}
-
-/**
-    \fn UI_setCurrentPreview(int ne)
-    \brief Update comboxbox with previewmode
-*/
-void UI_setCurrentPreview(int ne)
-{
-	switch (ne)
-	{
-		case 1:
-			WIDGET(actionPreviewOutput)-&gt;setChecked(true);
-			break;
-		case 2:
-			WIDGET(actionPreviewSide)-&gt;setChecked(true);
-			break;
-		case 3:
-			WIDGET(actionPreviewTop)-&gt;setChecked(true);
-			break;
-		case 4:
-			WIDGET(actionPreviewSeparate)-&gt;setChecked(true);
-			break;
-		default:
-			WIDGET(actionPreviewInput)-&gt;setChecked(true);
-	}
-}
-/**
-        \fn FatalFunctionQt
-*/
-static void FatalFunctionQt(const char *title, const char *info)
-{
-	GUI_Info_HIG(ADM_LOG_IMPORTANT, title, info);
-}
-
-/**
-    \fn UI_RunApp(void)
-    \brief Main entry point for the GUI application
-*/
-int UI_RunApp(void)
-{
-	
-	setupMenus();
-    ADM_setCrashHook(&amp;saveCrashProject, &amp;FatalFunctionQt);
-	checkCrashFile();
-    // Create an openGL context
-#ifdef USE_OPENGL
-    bool enabled;
-    prefs-&gt;get(FEATURES_ENABLE_OPENGL,&amp;enabled);
-    if(enabled)
-        UI_Qt4InitGl();
+/***************************************************************************
+    copyright            : (C) 2001 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &quot;ADM_cpp.h&quot;
+#include &quot;config.h&quot;
+
+#include &quot;ADM_inttype.h&quot;
+#include &lt;QtCore/QFileInfo&gt;
+#include &lt;QtCore/QUrl&gt;
+#include &lt;QtGui/QKeyEvent&gt;
+#include &lt;QtGui/QGraphicsView&gt;
+
+#define MENU_DECLARE
+#include &quot;Q_gui2.h&quot;
+#include &quot;ADM_default.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
+
+#include &quot;DIA_fileSel.h&quot;
+#include &quot;ADM_vidMisc.h&quot;
+#include &quot;prefs.h&quot;
+#include &quot;avi_vars.h&quot;
+
+#include &quot;ADM_render/GUI_renderInternal.h&quot;
+#include &quot;ADM_coreVideoEncoderInternal.h&quot;
+#include &quot;ADM_muxerProto.h&quot;
+#include &quot;T_vumeter.h&quot;
+#include &quot;DIA_coreToolkit.h&quot;
+
+#ifdef USE_OPENGL
+extern bool ADM_glHasActiveTexture(void);
+void UI_Qt4InitGl(void);
+void UI_Qt4CleanGl(void);
 #endif
-
-	if (global_argc &gt;= 2)
-		automation();
-
-    myApplication-&gt;exec();
-#ifdef USE_OPENGL
-    if(enabled)
-        UI_Qt4CleanGl();
-#endif
-	destroyTranslator();
-    delete myApplication;
-    myApplication=NULL;
-    return 1;
-}
-/**
-    \fn searchTranslationTable(const char *name))
-    \brief return the action corresponding to a give button. The translation table is in translation_table.h
-*/
-Action searchTranslationTable(const char *name)
-{
-	for(int i=0;i&lt; SIZEOF_MY_TRANSLATION;i++)
-	{
-		if(!strcmp(name, myTranslationTable[i].name))
-		{
-			return  myTranslationTable[i].action;
-		}
-	}
-	printf(&quot;WARNING: Signal not found in translation table %s\n&quot;,name);
-	return ACT_DUMMY;
-}
-/**
-    \fn     UI_updateRecentMenu( void )
-    \brief  Update the recent submenu with the latest files loaded
-*/
-uint8_t UI_updateRecentMenu( void )
-{
-    return  ((MainWindow *)QuiMainWindows)-&gt;buildRecentMenu();
-}
-/** 
-  \fn    setupMenus(void)
-  \brief Fill in video &amp; audio co
-*/
-void setupMenus(void)
-{
-	uint32_t nbVid;
-    uint32_t maj,mn,pa;
-	const char *name;
-
-	nbVid=ADM_ve6_getNbEncoders();
-	printf(&quot;Found %d video encoder(s)\n&quot;,nbVid);
-	for(uint32_t i=1;i&lt;nbVid;i++)
-	{
-		ADM_ve6_getEncoderInfo(i,&amp;name,&amp;maj,&amp;mn,&amp;pa);
-		WIDGET(comboBoxVideo)-&gt;addItem(name);
-	}
-
-	// And A codec
-
-	uint32_t nbAud;
-
-    nbAud=audioEncoderGetNumberOfEncoders();
-	printf(&quot;Found %d audio encoder(s)\n&quot;,nbAud);		       
-	for(uint32_t i=1;i&lt;nbAud;i++)
-	{
-		name=audioEncoderGetDisplayName(i);
-		WIDGET(comboBoxAudio)-&gt;addItem(name);
-	}
-
-	/*   Fill in output format window */
-	uint32_t nbFormat=ADM_mx_getNbMuxers();
-
-	printf(&quot;Found %d format(s)\n&quot;,nbFormat);
-	for(uint32_t i=0;i&lt;nbFormat;i++)
-	{
-        const char *name=ADM_mx_getDisplayName(i);
-		WIDGET(comboBoxFormat)-&gt;addItem(name);	
-	}
-
-}
-/*
-    Return % of scale (between 0 and 1)
-*/
-double 	UI_readScale( void )
-{
-	double v;
-	if(!slider) v=0;
-	v= (double)(slider-&gt;value());
-	v/=10000000;
-	return v;
-}
-void UI_setScale( double val )
-{
-	if(_upd_in_progres) return;
-	_upd_in_progres++;
-	slider-&gt;setValue( (int)(val * 10000000));
-	_upd_in_progres--;
-}
-
-int UI_readCurFrame(void)
-{
-	return 0;
-}
-
-int UI_readCurTime(uint16_t &amp;hh, uint16_t &amp;mm, uint16_t &amp;ss, uint16_t &amp;ms)
-{
-	int success = 0;
-
-	QString timeText = WIDGET(currentTime)-&gt;text();
-	int pos;
-
-	if (WIDGET(currentTime)-&gt;validator()-&gt;validate(timeText, pos) == QValidator::Acceptable)
-	{
-		uint32_t frame;
-
-		hh = (uint16_t)timeText.left(2).toUInt();
-		mm = (uint16_t)timeText.mid(3, 2).toUInt();
-		ss = (uint16_t)timeText.mid(6, 2).toUInt();
-		ms = (uint16_t)timeText.right(3).toUInt();
-
-		time2frame(&amp;frame, currentFps, hh, mm, ss, ms);
-
-		if (frame &lt;= frameCount)
-			success = 1;
-	}
-
-	return success;
-}
-
-
-
-//*******************************************
-
-/**
-    \fn UI_setTitle(char *name)
-    \brief Set the main window title, usually name if the file being edited
-*/
-void UI_setTitle(const char *name)
-{
-	char *title;
-	const char* defaultTitle = &quot;Avidemux&quot;;
-
-	if (name &amp;&amp; (*name) )
-	{
-		title = new char[strlen(defaultTitle) + strlen(name) + 3 + 1];
-
-		strcpy(title, name);
-		strcat(title, &quot; - &quot;);
-		strcat(title, defaultTitle);
-	}
-	else
-	{
-		title = new char[strlen(defaultTitle) + 1];
-
-		strcpy(title, defaultTitle);
-	}
-
-	QuiMainWindows-&gt;setWindowTitle(QString::fromUtf8(title));
-	delete [] title;
-}
-
-/**
-    \fn     UI_setFrameType( uint32_t frametype,uint32_t qp)
-    \brief  Display frametype (I/P/B) and associated quantizer
-*/
-
-void UI_setFrameType( uint32_t frametype,uint32_t qp)
-{
-	char string[100];
-	char	c='?';
-    const char *f=&quot;???&quot;;
-	switch(frametype&amp;AVI_FRAME_TYPE_MASK)
-	{
-	case AVI_KEY_FRAME: c='I';break;
-	case AVI_B_FRAME: c='B';break;
-	case 0: c='P';break;
-	default:c='?';break;
-
-	}
-    switch(frametype&amp;AVI_STRUCTURE_TYPE_MASK)
-	{
-	case AVI_TOP_FIELD+AVI_FIELD_STRUCTURE: f=&quot;TFF&quot;;break;
-    case AVI_BOTTOM_FIELD+AVI_FIELD_STRUCTURE: f=&quot;BFF&quot;;break;
-    case AVI_FRAME_STRUCTURE: f=&quot;FRM&quot;;break;
-	default:f=&quot;???&quot;;
-
-                    break;
-	}
-	sprintf(string,QT_TR_NOOP(&quot;%c-%s (%02d)&quot;),c,f,qp);
-	WIDGET(label_8)-&gt;setText(string);	
-
-}
-
-/**
-    \fn     UI_updateFrameCount(uint32_t curFrame)
-    \brief  Display the current displayed frame #
-*/
-void UI_updateFrameCount(uint32_t curFrame)
-{
-	
-}
-
-/**
-    \fn      UI_setFrameCount(uint32_t curFrame,uint32_t total)
-    \brief  Display the current displayed frame # and total frame #
-*/
-void UI_setFrameCount(uint32_t curFrame,uint32_t total)
-{
-	
-}
-
-/**
-    \fn     UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
-    \brief  Display the time corresponding to current frame according to fps (fps1000)
-*/
-void UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
-{
-	char text[80];   
-	uint32_t mm,hh,ss,ms;
-
-	frame2time(curFrame,fps, &amp;hh, &amp;mm, &amp;ss, &amp;ms);
-	sprintf(text, &quot;%02d:%02d:%02d.%03d&quot;, hh, mm, ss, ms);
-	WIDGET(currentTime)-&gt;setText(text);
-}
-
-
-
-/**
-    \fn UI_setCurrentTime
-    \brief Set current PTS of displayed video
-*/
-void UI_setCurrentTime(uint64_t curTime)
-{
-  char text[80];
- uint32_t mm,hh,ss,ms;
- uint32_t shorty=(uint32_t)(curTime/1000);
-
-    ms2time(shorty,&amp;hh,&amp;mm,&amp;ss,&amp;ms);
-  	sprintf(text, &quot;%02d:%02d:%02d.%03d&quot;, hh, mm, ss, ms);
-	WIDGET(currentTime)-&gt;setText(text);
-
-}
-
-/**
-    \fn UI_setTotalTime
-    \brief SEt the total duration of video
-*/
-void UI_setTotalTime(uint64_t curTime)
-{
-  char text[80];
- uint32_t mm,hh,ss,ms;
- uint32_t shorty=(uint32_t)(curTime/1000);
-
-    ms2time(shorty,&amp;hh,&amp;mm,&amp;ss,&amp;ms);
-  	sprintf(text, &quot;/%02d:%02d:%02d.%03d&quot;, hh, mm, ss, ms);
-    WIDGET(totalTime)-&gt;setText(text);
-    slider-&gt;setTotalDuration(curTime);
-}
-/**
-    \fn     UI_setMarkers(uint64_t Ptsa, uint32_t Ptsb )
-    \brief  Display frame # for marker A &amp; B
-*/
-void UI_setMarkers(uint64_t a, uint64_t b)
-{
-	char text[80];
-    uint64_t absoluteA=a,absoluteB=b;
-    uint32_t hh,mm,ss,ms;
-    uint32_t timems;
-    a/=1000;
-    b/=1000;
-
-    timems=(uint32_t)(a);
-    ms2time(timems,&amp;hh,&amp;mm,&amp;ss,&amp;ms);
-	snprintf(text,79,&quot;%02&quot;LU&quot;:%02&quot;LU&quot;:%02&quot;LU&quot;.%02&quot;LU,hh,mm,ss,ms);
-	WIDGET(pushButtonJumpToMarkerA)-&gt;setText(text);
-
-	timems=(uint32_t)(b);
-    ms2time(timems,&amp;hh,&amp;mm,&amp;ss,&amp;ms);
-	snprintf(text,79,&quot;%02&quot;LU&quot;:%02&quot;LU&quot;:%02&quot;LU&quot;.%02&quot;LU,hh,mm,ss,ms);
-	WIDGET(pushButtonJumpToMarkerB)-&gt;setText(text);
-
-	slider-&gt;setMarkers(absoluteA, absoluteB);
-}
-
-/**
-    \fn     UI_getCurrentVCodec(void)
-    \brief  Returns the current selected video code in menu, i.e its number (0 being the first)
-*/
-int 	UI_getCurrentVCodec(void)
-{
-	int i=WIDGET(comboBoxVideo)-&gt;currentIndex();
-	if(i&lt;0) i=0;
-	return i; 
-}
-/**
-    \fn     UI_setVideoCodec( int i)
-    \brief  Select the video codec which is # x in pulldown menu (starts at zero :copy)
-*/
-
-void UI_setVideoCodec( int i)
-{
-	int b=!!i;
-	WIDGET(comboBoxVideo)-&gt;setCurrentIndex(i);
-
-	WIDGET(pushButtonVideoConf)-&gt;setEnabled(b);
-	WIDGET(pushButtonVideoFilter)-&gt;setEnabled(b);
-}
-/**
-    \fn     UI_getCurrentACodec(void)
-    \brief  Returns the current selected audio code in menu, i.e its number (0 being the first)
-*/
-
-int 	UI_getCurrentACodec(void)
-{
-	int i=WIDGET(comboBoxAudio)-&gt;currentIndex();
-	if(i&lt;0) i=0;
-	return i; 
-}
-/**
-    \fn     UI_setAudioCodec( int i)
-    \brief  Select the audio codec which is # x in pulldown menu (starts at zero :copy)
-*/
-
-void UI_setAudioCodec( int i)
-{ int b=!!i;
-WIDGET(comboBoxAudio)-&gt;setCurrentIndex(i);
-WIDGET(pushButtonAudioConf)-&gt;setEnabled(b);
-WIDGET(pushButtonAudioFilter)-&gt;setEnabled(b);
-}
-/**
-    \fn     UI_GetCurrentFormat(void)
-    \brief  Returns the current selected output format
-*/
-
-int 	UI_GetCurrentFormat( void )
-{
-	int i=WIDGET(comboBoxFormat)-&gt;currentIndex();
-	if(i&lt;0) i=0;
-	return (int)i; 
-}
-/**
-    \fn     UI_SetCurrentFormat( ADM_OUT_FORMAT fmt )
-    \brief  Select  output format
-*/
-uint8_t 	UI_SetCurrentFormat( uint32_t fmt )
-{
-	WIDGET(comboBoxFormat)-&gt;setCurrentIndex((int)fmt);
-    return 1;
-}
-
-/**
-      \fn UI_getTimeShift
-      \brief get state (on/off) and value for time Shift
-*/
-uint8_t UI_getTimeShift(int *onoff,int *value)
-{
-	if(WIDGET(checkBox_TimeShift)-&gt;checkState()==Qt::Checked)
-		*onoff=1;
-	else
-		*onoff=0;
-	*value=WIDGET(spinBox_TimeValue)-&gt;value();
-	return 1;
-}
-/**
-      \fn UI_setTimeShift
-      \brief get state (on/off) and value for time Shift
-*/
-
-uint8_t UI_setTimeShift(int onoff,int value)
-{
-	if (onoff &amp;&amp; value)
-		WIDGET(checkBox_TimeShift)-&gt;setCheckState(Qt::Checked);
-	else
-		WIDGET(checkBox_TimeShift)-&gt;setCheckState(Qt::Unchecked);
-	WIDGET(spinBox_TimeValue)-&gt;setValue(value);
-	return 1;
-}
-/**
-    \fn UI_setVUMeter
-*/
-bool UI_setVUMeter( uint32_t volume[6])
-{
-    UI_vuUpdate( volume);
-    return true;
-}
-/**
-    \fn setDecodeName
-*/
-bool UI_setDecoderName(const char *name)
-{
-    WIDGET(labelVideoDecoder)-&gt;setText(name);	
-    return true;
-}
-/**
-    \fn UI_hasOpengl
-*/
-bool UI_hasOpenGl(void)
-{
-#ifndef USE_OPENGL
-    return false;
-#else
-    if(!ADM_glHasActiveTexture()) return false; // ADM_setActiveTexure
-    bool enabled;
-    prefs-&gt;get(FEATURES_ENABLE_OPENGL,&amp;enabled);
-    return enabled;
-#endif
-}
-//********************************************
-//EOF
+
+extern int global_argc;
+extern char **global_argv;
+
+extern uint8_t UI_getPhysicalScreenSize(void* window, uint32_t *w,uint32_t *h);
+extern int automation(void );
+extern void HandleAction(Action a);
+extern int encoderGetEncoderCount (void);
+extern const char *encoderGetIndexedName (uint32_t i);
+uint32_t audioEncoderGetNumberOfEncoders(void);
+const char  *audioEncoderGetDisplayName(uint32_t i);
+extern void checkCrashFile(void);
+extern void UI_QT4VideoWidget(QFrame *frame);
+extern void loadTranslator(void);
+extern void initTranslator(void);
+extern void destroyTranslator(void);
+extern ADM_RENDER_TYPE UI_getPreferredRender(void);
+extern int A_openAvi(const char *name);
+extern int A_appendAvi(const char *name);
+extern void FileSel_ReadWrite(SELFILE_CB *cb, int rw, const char *name, const char *actual_workbench_file);
+
+
+int SliderIsShifted=0;
+static void setupMenus(void);
+static int shiftKeyHeld=0;
+static ADM_QSlider *slider=NULL;
+static int _upd_in_progres=0;
+static int currentFps = 0;
+static int frameCount = 0;
+static int currentFrame = 0;
+bool     ADM_ve6_getEncoderInfo(int filter, const char **name, uint32_t *major,uint32_t *minor,uint32_t *patch);
+uint32_t ADM_ve6_getNbEncoders(void);
+void UI_refreshCustomMenu(void);
+QWidget *QuiMainWindows=NULL;
+QWidget *VuMeter=NULL;
+QGraphicsView *drawWindow=NULL;
+uint8_t UI_updateRecentMenu( void );
+extern void saveCrashProject(void);
+extern uint8_t AVDM_setVolume(int volume);
+extern bool ADM_QPreviewCleanup(void);
+
+
+
+#define WIDGET(x)  (((MainWindow *)QuiMainWindows)-&gt;ui.x)
+
+#define CONNECT(object,zzz) connect( (ui.object),SIGNAL(triggered()),this,SLOT(buttonPressed()));
+#define CONNECT_TB(object,zzz) connect( (ui.object),SIGNAL(clicked(bool)),this,SLOT(toolButtonPressed(bool)));
+#define DECLARE_VAR(object,signal_name) {#object,signal_name},
+
+#include &quot;translation_table.h&quot;   
+/*
+    Declare the table converting widget name to our internal signal           
+*/
+typedef struct 
+{
+	const char *name;
+	Action     action; 
+}adm_qt4_translation;
+
+const adm_qt4_translation myTranslationTable[]=
+{
+#define PROCESS DECLARE_VAR
+	LIST_OF_BUTTONS
+#undef PROCESS
+};
+static Action searchTranslationTable(const char *name);
+#define SIZEOF_MY_TRANSLATION sizeof(myTranslationTable)/sizeof(adm_qt4_translation)
+
+int UI_readCurTime(uint16_t &amp;hh, uint16_t &amp;mm, uint16_t &amp;ss, uint16_t &amp;ms);
+void UI_updateFrameCount(uint32_t curFrame);
+void UI_updateTimeCount(uint32_t curFrame,uint32_t fps);
+extern void UI_purge(void);
+/*
+    Declare the class that will be our main window
+
+*/
+
+void MainWindow::comboChanged(int z)
+{
+	const char *source=qPrintable(sender()-&gt;objectName());
+
+	if(!strcmp(source,&quot;comboBoxVideo&quot;))  
+	{
+		bool b=FALSE;
+		if(ui.comboBoxVideo-&gt;currentIndex())
+		{
+			b=TRUE;
+		}
+		ui.pushButtonVideoConf-&gt;setEnabled(b);
+		ui.pushButtonVideoFilter-&gt;setEnabled(b);
+		HandleAction (ACT_VIDEO_CODEC_CHANGED) ;
+	}
+	else if(!strcmp(source,&quot;comboBoxAudio&quot;))  
+	{
+		bool b=FALSE;
+		if(ui.comboBoxAudio-&gt;currentIndex())
+		{
+			b=TRUE;
+		}
+		ui.pushButtonAudioConf-&gt;setEnabled(b);
+		ui.pushButtonAudioFilter-&gt;setEnabled(b);
+		HandleAction (ACT_AUDIO_CODEC_CHANGED) ;
+	}
+	else
+		printf(&quot;From +: %s\n&quot;,source);
+}
+
+void MainWindow::sliderValueChanged(int u) 
+{
+	if(!_upd_in_progres)
+		HandleAction(ACT_Scale);
+}
+
+void MainWindow::sliderMoved(int value)
+{
+	SliderIsShifted = shiftKeyHeld;
+}
+
+void MainWindow::sliderReleased(void)
+{
+	SliderIsShifted = 0;
+}
+
+void MainWindow::thumbSlider_valueEmitted(int value)
+{
+        if (value &gt; 0)
+                nextIntraFrame();
+        else
+                previousIntraFrame();
+}
+
+void MainWindow::volumeChange( int u )
+{
+	if (_upd_in_progres || !ui.toolButtonAudioToggle-&gt;isChecked())
+		return;
+
+	_upd_in_progres++;
+
+	int vol = ui.horizontalSlider_2-&gt;value();
+
+	AVDM_setVolume(vol);
+	_upd_in_progres--;
+}
+
+void MainWindow::audioToggled(bool checked)
+{
+	if (checked)
+		AVDM_setVolume(ui.horizontalSlider_2-&gt;value());
+	else
+		AVDM_setVolume(0);
+}
+
+void MainWindow::previewModeChanged(QAction *action)
+{
+	HandleAction(ACT_PreviewChanged);
+}
+
+void MainWindow::timeChangeFinished(void)
+{
+	this-&gt;setFocus(Qt::OtherFocusReason);
+}
+
+void MainWindow::currentFrameChanged(void)
+{
+//	HandleAction(ACT_JumpToFrame);
+
+	this-&gt;setFocus(Qt::OtherFocusReason);
+}
+
+void MainWindow::currentTimeChanged(void)
+{
+	HandleAction(ACT_GotoTime);
+
+	this-&gt;setFocus(Qt::OtherFocusReason);
+}
+
+/**
+    \fn ctor
+*/
+MainWindow::MainWindow() : QMainWindow()
+{
+	qtRegisterDialog(this);
+	ui.setupUi(this);
+
+#if defined(__APPLE__) &amp;&amp; defined(USE_SDL)
+	ui.actionAbout_avidemux-&gt;setMenuRole(QAction::NoRole);
+	ui.actionPreferences-&gt;setMenuRole(QAction::NoRole);
+	ui.actionQuit-&gt;setMenuRole(QAction::NoRole);
+#endif
+
+	// Preview modes
+	QActionGroup *groupPreviewModes = new QActionGroup(this);
+
+	groupPreviewModes-&gt;addAction(ui.actionPreviewInput);
+	groupPreviewModes-&gt;addAction(ui.actionPreviewOutput);
+	connect(groupPreviewModes, SIGNAL(triggered(QAction*)), this, SLOT(previewModeChanged(QAction*)));
+
+	/*
+	Connect our button to buttonPressed
+	*/
+#define PROCESS CONNECT_TB
+	LIST_OF_BUTTONS
+#undef PROCESS
+
+	//ACT_VideoCodecChanged
+	connect( ui.comboBoxVideo,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
+	connect( ui.comboBoxAudio,SIGNAL(activated(int)),this,SLOT(comboChanged(int)));
+
+	// Slider
+	slider=ui.horizontalSlider;
+	slider-&gt;setMinimum(0);
+	slider-&gt;setMaximum(1000000000);
+	connect( slider,SIGNAL(valueChanged(int)),this,SLOT(sliderValueChanged(int)));
+	connect( slider,SIGNAL(sliderMoved(int)),this,SLOT(sliderMoved(int)));
+	connect( slider,SIGNAL(sliderReleased()),this,SLOT(sliderReleased()));
+
+   // Thumb slider
+    ui.sliderPlaceHolder-&gt;installEventFilter(this);
+    thumbSlider = new ThumbSlider(ui.sliderPlaceHolder);
+    connect(thumbSlider, SIGNAL(valueEmitted(int)), this, SLOT(thumbSlider_valueEmitted(int)));
+
+	// Volume slider
+	QSlider *volSlider=ui.horizontalSlider_2;
+	volSlider-&gt;setMinimum(0);
+	volSlider-&gt;setMaximum(100);
+	connect(volSlider,SIGNAL(valueChanged(int)),this,SLOT(volumeChange(int)));
+	connect(ui.toolButtonAudioToggle,SIGNAL(clicked(bool)),this,SLOT(audioToggled(bool)));
+
+	// default state
+	bool b=0;
+	ui.pushButtonVideoConf-&gt;setEnabled(b);
+	ui.pushButtonVideoFilter-&gt;setEnabled(b);
+	ui.pushButtonAudioConf-&gt;setEnabled(b);
+	ui.pushButtonAudioFilter-&gt;setEnabled(b);
+
+	/* Time Shift */
+	connect(ui.checkBox_TimeShift,SIGNAL(stateChanged(int)),this,SLOT(timeChanged(int)));
+	connect(ui.spinBox_TimeValue,SIGNAL(valueChanged(int)),this,SLOT(timeChanged(int)));
+	connect(ui.spinBox_TimeValue, SIGNAL(editingFinished()), this, SLOT(timeChangeFinished()));
+
+	QRegExp timeRegExp(&quot;^[0-9]{2}:[0-5][0-9]:[0-5][0-9]\\.[0-9]{3}$&quot;);
+	QRegExpValidator *timeValidator = new QRegExpValidator(timeRegExp, this);
+	ui.currentTime-&gt;setValidator(timeValidator);
+	ui.currentTime-&gt;setInputMask(&quot;99:99:99.999&quot;);
+
+	//connect(ui.currentTime, SIGNAL(editingFinished()), this, SLOT(currentTimeChanged()));
+
+    // Build file,... menu
+    buildMyMenu();
+
+	/* Build the custom menu */
+    jsMenu=new QMenu(&quot;javaScript&quot;);
+    pyMenu=new QMenu(&quot;tinyPython&quot;);
+    autoMenu=ui.menuAuto ;//new QMenu(&quot;autoPython&quot;);
+    ui.menuCustom-&gt;addMenu(jsMenu);
+    ui.menuCustom-&gt;addMenu(pyMenu);
+    //ui.menuAuto-&gt;addMenu(autoMenu);
+	buildCustomMenu();
+
+    recentFiles=new QMenu(&quot;Recent Files&quot;);
+    recentProjects=new QMenu(&quot;Recent Projects&quot;);
+    ui.menuRecent-&gt;addMenu(recentFiles);
+    ui.menuRecent-&gt;addMenu(recentProjects);
+    connect( ui.menuRecent,SIGNAL(triggered(QAction*)),this,SLOT(searchRecentFiles(QAction*)));
+
+	this-&gt;installEventFilter(this);
+	slider-&gt;installEventFilter(this);
+    
+	//ui.currentTime-&gt;installEventFilter(this);
+
+	this-&gt;setFocus(Qt::OtherFocusReason);
+
+	setAcceptDrops(true);
+    setWindowIcon(QIcon(&quot;:/new/prefix1/pics/avidemux_icon_small.png&quot;));
+
+    // Hook also the toolbar
+    connect(ui.toolBar,  SIGNAL(actionTriggered ( QAction *)),this,SLOT(searchToolBar(QAction *)));
+    connect(ui.toolBar_2,SIGNAL(actionTriggered ( QAction *)),this,SLOT(searchToolBar(QAction *)));
+
+	QWidget* dummy0 = new QWidget();
+	QWidget* dummy1 = new QWidget();
+	QWidget* dummy2 = new QWidget();
+	QWidget* dummy3 = new QWidget();
+	QWidget* dummy4 = new QWidget();
+
+	ui.codecWidget-&gt;setTitleBarWidget(dummy0);
+	ui.navigationWidget-&gt;setTitleBarWidget(dummy1);
+	ui.selectionWidget-&gt;setTitleBarWidget(dummy2);
+	ui.volumeWidget-&gt;setTitleBarWidget(dummy3);
+	ui.audioMetreWidget-&gt;setTitleBarWidget(dummy4);
+
+	this-&gt;resize(1, 1);
+}
+/**
+    \fn searchToolBar
+*/
+typedef struct 
+{
+    const char *name;
+    Action event;
+}toolBarTranslate;
+
+toolBarTranslate toolbar[]=
+{
+{&quot;actionOpen&quot;,              ACT_OPEN_VIDEO},
+{&quot;actionSave_video&quot;,        ACT_SAVE_VIDEO},
+{&quot;actionProperties&quot;,        ACT_VIDEO_PROPERTIES},
+{&quot;actionLoad_run_project&quot;,  ACT_RUN_PY_PROJECT},
+{&quot;actionSave_project&quot;,      ACT_SAVE_PY_PROJECT},
+//{&quot;actionPreviewInput&quot;,ACT_PreviewToggle},
+//{&quot;actionPreviewOutput&quot;,ACT_PreviewToggle},
+
+{NULL,ACT_DUMMY}
+};
+void MainWindow::searchToolBar(QAction *action)
+{
+        toolBarTranslate *t=toolbar;
+        QString me(action-&gt;objectName());
+        const char *name=me.toUtf8().constData();
+        while(t-&gt;name)
+        {
+            if(!strcmp(name,t-&gt;name))
+            {
+                HandleAction(t-&gt;event);
+                return;
+            }
+            t++;
+        }
+        ADM_warning(&quot;Toolbar:Cannot handle %s\n&quot;,name);
+}
+/**
+    \fn buildFileMenu
+*/
+bool MainWindow::buildMenu(QMenu *root,MenuEntry *menu, int nb)
+{
+    QMenu *subMenu=NULL;
+    for(int i=0;i&lt;nb;i++)
+    {
+        MenuEntry *m=menu+i;
+        switch(m-&gt;type)
+        {
+            case MENU_SEPARATOR:
+                root-&gt;addSeparator();
+                break;
+            case MENU_SUBMENU:
+                {
+                    subMenu=root-&gt;addMenu(m-&gt;text);
+                }
+                break;
+            case MENU_SUBACTION:
+            case MENU_ACTION:
+                {   
+                        QMenu *insert=root;
+                        if(m-&gt;type==MENU_SUBACTION) insert=subMenu;
+                        QAction *a=NULL;
+                        if(m-&gt;icon) 
+                        {
+                            QIcon icon(m-&gt;icon);
+                            a=insert-&gt;addAction(icon,m-&gt;text);
+                        }else
+                            a=insert-&gt;addAction(m-&gt;text);
+                        m-&gt;cookie=(void *)a;
+                        if(m-&gt;shortCut)
+                        {
+                            QKeySequence s(m-&gt;shortCut);
+                            a-&gt;setShortcut(s);
+                        }
+                        break;
+                }
+            default:
+                break;
+        }
+    }
+    return true;
+}
+/**
+    buildFileMenu
+*/
+bool MainWindow::buildMyMenu(void)
+{
+    connect( ui.menuFile,SIGNAL(triggered(QAction*)),this,SLOT(searchFileMenu(QAction*)));
+    buildMenu(ui.menuFile,myMenuFile, sizeof(myMenuFile)/sizeof(MenuEntry));
+
+    connect( ui.menuEdit,SIGNAL(triggered(QAction*)),this,SLOT(searchEditMenu(QAction*)));
+    buildMenu(ui.menuEdit,myMenuEdit, sizeof(myMenuEdit)/sizeof(MenuEntry));
+
+    connect( ui.menuVideo,SIGNAL(triggered(QAction*)),this,SLOT(searchVideoMenu(QAction*)));
+    buildMenu(ui.menuVideo,myMenuVideo, sizeof(myMenuVideo)/sizeof(MenuEntry));
+
+    connect( ui.menuAudio,SIGNAL(triggered(QAction*)),this,SLOT(searchAudioMenu(QAction*)));
+    buildMenu(ui.menuAudio,myMenuAudio, sizeof(myMenuAudio)/sizeof(MenuEntry));
+
+    connect( ui.menuHelp,SIGNAL(triggered(QAction*)),this,SLOT(searchHelpMenu(QAction*)));
+    buildMenu(ui.menuHelp,myMenuHelp, sizeof(myMenuHelp)/sizeof(MenuEntry));
+
+    connect( ui.menuTools,SIGNAL(triggered(QAction*)),this,SLOT(searchToolMenu(QAction*)));
+    buildMenu(ui.menuTools,myMenuTool, sizeof(myMenuTool)/sizeof(MenuEntry));
+
+    connect( ui.menuGo,SIGNAL(triggered(QAction*)),this,SLOT(searchGoMenu(QAction*)));
+    buildMenu(ui.menuGo,myMenuGo, sizeof(myMenuGo)/sizeof(MenuEntry));
+
+    connect( ui.menuView,SIGNAL(triggered(QAction*)),this,SLOT(searchViewMenu(QAction*)));
+    buildMenu(ui.menuView,myMenuView, sizeof(myMenuView)/sizeof(MenuEntry));
+
+    return true;
+}
+
+/**
+    \fn timeChanged
+    \brief Called whenever timeshift is on/off'ed or value changes
+*/
+void MainWindow::timeChanged(int)
+{
+	HandleAction (ACT_TimeShift) ;
+}
+/**
+    \fn searchMenu
+*/
+void MainWindow::searchMenu(QAction * action,MenuEntry *menu, int nb)
+{
+    for(int i=0;i&lt;nb;i++)
+    {
+        MenuEntry *m=menu+i;
+        if(m-&gt;cookie==(void*)action)
+        {
+            HandleAction (m-&gt;event);
+        }
+    }
+}
+
+/**
+    \fn searchFileMenu
+*/
+#define MKMENU(name) void MainWindow::search##name##Menu(QAction * action) \
+    {searchMenu(action,myMenu##name,sizeof(myMenu##name)/sizeof(MenuEntry));}
+
+MKMENU(File)
+MKMENU(Edit)
+//MKMENU(Recent)
+MKMENU(View)
+MKMENU(Tool)
+MKMENU(Go)
+//MKMENU(Custom)
+MKMENU(Audio)
+MKMENU(Video)
+MKMENU(Help)
+
+
+
+/*
+      We receive a button press event
+*/
+void MainWindow::buttonPressed(void)
+{
+	// Receveid a key press Event, look into table..
+    QObject *obj=sender();
+    if(!obj) return;
+    QString me(obj-&gt;objectName());
+    
+	Action action=searchTranslationTable(qPrintable(me));
+    
+
+	if(action!=ACT_DUMMY)
+		HandleAction (action);
+
+}
+void MainWindow::toolButtonPressed(bool i)
+{
+	buttonPressed();
+}
+
+bool MainWindow::eventFilter(QObject* watched, QEvent* event)
+{
+	QKeyEvent *keyEvent;
+
+	switch (event-&gt;type())
+	{
+		case QEvent::KeyPress:
+			keyEvent = (QKeyEvent*)event;
+
+			if (watched == slider)
+			{
+				switch (keyEvent-&gt;key())
+				{
+					case Qt::Key_Left:
+						if (keyEvent-&gt;modifiers() == Qt::ShiftModifier)
+							HandleAction(ACT_Back25Frames);
+						else if (keyEvent-&gt;modifiers() == Qt::ControlModifier)
+							HandleAction(ACT_Back50Frames);
+						else
+							HandleAction(ACT_PreviousFrame);
+
+						return true;
+					case Qt::Key_Right:
+						if (keyEvent-&gt;modifiers() == Qt::ShiftModifier)
+							HandleAction(ACT_Forward25Frames);
+						else if (keyEvent-&gt;modifiers() == Qt::ControlModifier)
+							HandleAction(ACT_Forward50Frames);
+						else
+							HandleAction(ACT_NextFrame);
+
+						return true;
+					case Qt::Key_Up:
+						HandleAction(ACT_NextKFrame);
+						return true;
+					case Qt::Key_Down:
+						HandleAction(ACT_PreviousKFrame);
+						return true;
+					case Qt::Key_Shift:
+						shiftKeyHeld = 1;
+						break;
+				}
+			}
+			else if (keyEvent-&gt;key() == Qt::Key_Space)
+			{
+				HandleAction(ACT_PlayAvi);
+				return true;
+			}
+
+			break;
+        case QEvent::Resize:
+            if (watched == ui.sliderPlaceHolder)
+            {
+                    thumbSlider-&gt;resize(ui.sliderPlaceHolder-&gt;width(), 16);
+                    thumbSlider-&gt;move(0, (ui.sliderPlaceHolder-&gt;height() - thumbSlider-&gt;height()) / 2);
+            }
+            break;
+
+		case QEvent::KeyRelease:
+			keyEvent = (QKeyEvent*)event;
+
+			if (keyEvent-&gt;key() == Qt::Key_Shift)
+				shiftKeyHeld = 0;
+
+			break;
+		case QEvent::FocusOut:
+            break;
+        default:
+            break;
+	}
+
+	return QObject::eventFilter(watched, event);
+}
+/**
+    \fn buildRecentMenu
+*/
+bool MainWindow::buildRecentMenu(void)
+{
+    const char **names;
+	names=prefs-&gt;get_lastfiles();
+    // Purge entries...
+    recentFiles-&gt;clear();
+    for(int i=0;i&lt;4;i++)
+    {
+        if(names[i])
+        {
+            recentFileAction[i]=recentFiles-&gt;addAction(QString('0'+i)+QString(&quot;:&quot;)+QString::fromUtf8(names[i]));
+        }else
+            recentFileAction[i]=NULL;
+    }
+	return true;
+}
+/**
+    \fn searchRecentFiles
+*/
+void MainWindow::searchRecentFiles(QAction * action)
+{
+    for(int i=0;i&lt;4;i++)
+    {
+            QAction *a= recentFileAction[i];
+            if(!a) continue;
+
+            if(a==action) 
+            {
+                HandleAction((Action)(ACT_RECENT0+i));
+                return;
+            }
+    }
+}
+void MainWindow::mousePressEvent(QMouseEvent* event)
+{
+	this-&gt;setFocus(Qt::OtherFocusReason);
+}
+
+void MainWindow::dragEnterEvent(QDragEnterEvent *event)
+{
+	if (event-&gt;mimeData()-&gt;hasFormat(&quot;text/uri-list&quot;))
+		event-&gt;acceptProposedAction();
+}
+
+void MainWindow::dropEvent(QDropEvent *event)
+{
+	QList&lt;QUrl&gt; urlList;
+	QString fileName;
+	QFileInfo info;
+    const char *cFileName;
+
+	if (event-&gt;mimeData()-&gt;hasUrls())
+	{
+		urlList = event-&gt;mimeData()-&gt;urls();
+
+		for (int fileIndex = 0; fileIndex &lt; urlList.size(); fileIndex++)
+		{
+			fileName = urlList[fileIndex].toLocalFile();
+			info.setFile(fileName);
+            cFileName=ADM_strdup(fileName.toUtf8().constData());
+            ADM_info(&quot;Drop event %s\n&quot;,cFileName);
+			if (info.isFile())
+			{
+				if (avifileinfo)
+                {
+                    ADM_info(&quot;Appending..\n&quot;);
+                    A_appendAvi(cFileName);
+                }
+				else
+                {
+                    ADM_info(&quot;Opening..\n&quot;);
+                    A_openAvi(cFileName);
+                }
+			}else
+            {
+                ADM_warning(&quot;Dropped item is not a file\n&quot;);
+            }
+            ADM_dealloc(cFileName);
+		}
+	}
+
+	event-&gt;acceptProposedAction();
+}
+
+void MainWindow::previousIntraFrame(void)
+{
+	if (ui.spinBox_TimeValue-&gt;hasFocus())
+		ui.spinBox_TimeValue-&gt;stepDown();
+	else
+		HandleAction(ACT_PreviousKFrame);
+}
+
+void MainWindow::nextIntraFrame(void)
+{
+	if (ui.spinBox_TimeValue-&gt;hasFocus())
+		ui.spinBox_TimeValue-&gt;stepUp();
+	else
+		HandleAction(ACT_NextKFrame);
+}
+
+MainWindow::~MainWindow()
+{
+	clearCustomMenu();
+    delete thumbSlider;
+    thumbSlider=NULL;
+}
+
+void MainWindow::closeEvent(QCloseEvent *event)
+{
+static bool first=true;
+    ADM_warning(&quot;Close event\n&quot;);
+    if(first)
+    {
+        first=false;
+        HandleAction(ACT_EXIT);
+    }
+    event-&gt;accept();
+//         event-&gt;ignore();
+
+}
+
+
+static const UI_FUNCTIONS_T UI_Hooks=
+    {
+        ADM_RENDER_API_VERSION_NUMBER,
+        UI_getWindowInfo,
+        UI_updateDrawWindowSize,
+        UI_rgbDraw,
+        UI_getDrawWidget,
+        UI_getPreferredRender
+        
+    };
+QApplication *myApplication=NULL;
+/**
+    \fn  UI_Init
+    \brief First part of UI initialization
+
+*/
+int UI_Init(int nargc,char **nargv)
+{
+    ADM_info(&quot;Starting QT4 GUI...\n&quot;);
+	initTranslator();
+
+	global_argc=nargc;
+	global_argv=nargv;
+	ADM_renderLibInit(&amp;UI_Hooks);
+    Q_INIT_RESOURCE(avidemux);
+	Q_INIT_RESOURCE(filter);
+
+	myApplication=new QApplication (global_argc, global_argv);
+	myApplication-&gt;connect(myApplication, SIGNAL(lastWindowClosed()), myApplication, SLOT(quit()));
+
+	loadTranslator();
+
+	MainWindow *mw = new MainWindow();
+	mw-&gt;show();
+
+	QuiMainWindows = (QWidget*)mw;
+
+	uint32_t w, h;
+
+	UI_getPhysicalScreenSize(QuiMainWindows, &amp;w,&amp;h);
+	printf(&quot;The screen seems to be %u x %u px\n&quot;,w,h);
+
+	UI_QT4VideoWidget(mw-&gt;ui.frame_video);  // Add the widget that will handle video display
+	UI_updateRecentMenu();
+
+    // Init vumeter
+    VuMeter=mw-&gt;ui.frameVU;
+    UI_InitVUMeter(mw-&gt;ui.frameVU);
+	return 0;
+}
+/**
+
+*/
+bool UI_End(void)
+{
+    ADM_QPreviewCleanup();
+    return true;
+}
+void UI_refreshCustomMenu(void)
+{
+	((MainWindow*)QuiMainWindows)-&gt;buildCustomMenu();
+}
+
+/**
+    \fn UI_getCurrentPreview(void)
+    \brief Read previewmode from comboxbox 
+*/
+int UI_getCurrentPreview(void)
+{
+	int index;
+
+	if (WIDGET(actionPreviewOutput)-&gt;isChecked())
+		index = 1;
+	else if (WIDGET(actionPreviewSide)-&gt;isChecked())
+		index = 2;
+	else if (WIDGET(actionPreviewTop)-&gt;isChecked())
+		index = 3;
+	else if (WIDGET(actionPreviewSeparate)-&gt;isChecked())
+		index = 4;
+	else
+		index = 0;
+
+	return index;
+}
+
+/**
+    \fn UI_setCurrentPreview(int ne)
+    \brief Update comboxbox with previewmode
+*/
+void UI_setCurrentPreview(int ne)
+{
+	switch (ne)
+	{
+		case 1:
+			WIDGET(actionPreviewOutput)-&gt;setChecked(true);
+			break;
+		case 2:
+			WIDGET(actionPreviewSide)-&gt;setChecked(true);
+			break;
+		case 3:
+			WIDGET(actionPreviewTop)-&gt;setChecked(true);
+			break;
+		case 4:
+			WIDGET(actionPreviewSeparate)-&gt;setChecked(true);
+			break;
+		default:
+			WIDGET(actionPreviewInput)-&gt;setChecked(true);
+	}
+}
+/**
+        \fn FatalFunctionQt
+*/
+static void FatalFunctionQt(const char *title, const char *info)
+{
+	GUI_Info_HIG(ADM_LOG_IMPORTANT, title, info);
+}
+
+/**
+    \fn UI_RunApp(void)
+    \brief Main entry point for the GUI application
+*/
+int UI_RunApp(void)
+{
+	
+	setupMenus();
+    ADM_setCrashHook(&amp;saveCrashProject, &amp;FatalFunctionQt);
+	checkCrashFile();
+    // Create an openGL context
+#ifdef USE_OPENGL
+    bool enabled;
+    prefs-&gt;get(FEATURES_ENABLE_OPENGL,&amp;enabled);
+    if(enabled)
+        UI_Qt4InitGl();
+#endif
+
+	if (global_argc &gt;= 2)
+		automation();
+
+    myApplication-&gt;exec();
+#ifdef USE_OPENGL
+    if(enabled)
+        UI_Qt4CleanGl();
+#endif
+	destroyTranslator();
+    delete myApplication;
+    myApplication=NULL;
+    return 1;
+}
+/**
+    \fn searchTranslationTable(const char *name))
+    \brief return the action corresponding to a give button. The translation table is in translation_table.h
+*/
+Action searchTranslationTable(const char *name)
+{
+	for(int i=0;i&lt; SIZEOF_MY_TRANSLATION;i++)
+	{
+		if(!strcmp(name, myTranslationTable[i].name))
+		{
+			return  myTranslationTable[i].action;
+		}
+	}
+	printf(&quot;WARNING: Signal not found in translation table %s\n&quot;,name);
+	return ACT_DUMMY;
+}
+/**
+    \fn     UI_updateRecentMenu( void )
+    \brief  Update the recent submenu with the latest files loaded
+*/
+uint8_t UI_updateRecentMenu( void )
+{
+    return  ((MainWindow *)QuiMainWindows)-&gt;buildRecentMenu();
+}
+/** 
+  \fn    setupMenus(void)
+  \brief Fill in video &amp; audio co
+*/
+void setupMenus(void)
+{
+	uint32_t nbVid;
+    uint32_t maj,mn,pa;
+	const char *name;
+
+	nbVid=ADM_ve6_getNbEncoders();
+	printf(&quot;Found %d video encoder(s)\n&quot;,nbVid);
+	for(uint32_t i=1;i&lt;nbVid;i++)
+	{
+		ADM_ve6_getEncoderInfo(i,&amp;name,&amp;maj,&amp;mn,&amp;pa);
+		WIDGET(comboBoxVideo)-&gt;addItem(name);
+	}
+
+	// And A codec
+
+	uint32_t nbAud;
+
+    nbAud=audioEncoderGetNumberOfEncoders();
+	printf(&quot;Found %d audio encoder(s)\n&quot;,nbAud);		       
+	for(uint32_t i=1;i&lt;nbAud;i++)
+	{
+		name=audioEncoderGetDisplayName(i);
+		WIDGET(comboBoxAudio)-&gt;addItem(name);
+	}
+
+	/*   Fill in output format window */
+	uint32_t nbFormat=ADM_mx_getNbMuxers();
+
+	printf(&quot;Found %d format(s)\n&quot;,nbFormat);
+	for(uint32_t i=0;i&lt;nbFormat;i++)
+	{
+        const char *name=ADM_mx_getDisplayName(i);
+		WIDGET(comboBoxFormat)-&gt;addItem(name);	
+	}
+
+}
+/*
+    Return % of scale (between 0 and 1)
+*/
+double 	UI_readScale( void )
+{
+	double v;
+	if(!slider) v=0;
+	v= (double)(slider-&gt;value());
+	v/=10000000;
+	return v;
+}
+void UI_setScale( double val )
+{
+	if(_upd_in_progres) return;
+	_upd_in_progres++;
+	slider-&gt;setValue( (int)(val * 10000000));
+	_upd_in_progres--;
+}
+
+int UI_readCurFrame(void)
+{
+	return 0;
+}
+
+int UI_readCurTime(uint16_t &amp;hh, uint16_t &amp;mm, uint16_t &amp;ss, uint16_t &amp;ms)
+{
+	int success = 0;
+
+	QString timeText = WIDGET(currentTime)-&gt;text();
+	int pos;
+
+	if (WIDGET(currentTime)-&gt;validator()-&gt;validate(timeText, pos) == QValidator::Acceptable)
+	{
+		uint32_t frame;
+
+		hh = (uint16_t)timeText.left(2).toUInt();
+		mm = (uint16_t)timeText.mid(3, 2).toUInt();
+		ss = (uint16_t)timeText.mid(6, 2).toUInt();
+		ms = (uint16_t)timeText.right(3).toUInt();
+
+		time2frame(&amp;frame, currentFps, hh, mm, ss, ms);
+
+		if (frame &lt;= frameCount)
+			success = 1;
+	}
+
+	return success;
+}
+
+
+
+//*******************************************
+
+/**
+    \fn UI_setTitle(char *name)
+    \brief Set the main window title, usually name if the file being edited
+*/
+void UI_setTitle(const char *name)
+{
+	char *title;
+	const char* defaultTitle = &quot;Avidemux&quot;;
+
+	if (name &amp;&amp; (*name) )
+	{
+		title = new char[strlen(defaultTitle) + strlen(name) + 3 + 1];
+
+		strcpy(title, name);
+		strcat(title, &quot; - &quot;);
+		strcat(title, defaultTitle);
+	}
+	else
+	{
+		title = new char[strlen(defaultTitle) + 1];
+
+		strcpy(title, defaultTitle);
+	}
+
+	QuiMainWindows-&gt;setWindowTitle(QString::fromUtf8(title));
+	delete [] title;
+}
+
+/**
+    \fn     UI_setFrameType( uint32_t frametype,uint32_t qp)
+    \brief  Display frametype (I/P/B) and associated quantizer
+*/
+
+void UI_setFrameType( uint32_t frametype,uint32_t qp)
+{
+	char string[100];
+	char	c='?';
+    const char *f=&quot;???&quot;;
+	switch(frametype&amp;AVI_FRAME_TYPE_MASK)
+	{
+	case AVI_KEY_FRAME: c='I';break;
+	case AVI_B_FRAME: c='B';break;
+	case 0: c='P';break;
+	default:c='?';break;
+
+	}
+    switch(frametype&amp;AVI_STRUCTURE_TYPE_MASK)
+	{
+	case AVI_TOP_FIELD+AVI_FIELD_STRUCTURE: f=&quot;TFF&quot;;break;
+    case AVI_BOTTOM_FIELD+AVI_FIELD_STRUCTURE: f=&quot;BFF&quot;;break;
+    case AVI_FRAME_STRUCTURE: f=&quot;FRM&quot;;break;
+	default:f=&quot;???&quot;;
+
+                    break;
+	}
+	sprintf(string,QT_TR_NOOP(&quot;%c-%s (%02d)&quot;),c,f,qp);
+	WIDGET(label_8)-&gt;setText(string);	
+
+}
+
+/**
+    \fn     UI_updateFrameCount(uint32_t curFrame)
+    \brief  Display the current displayed frame #
+*/
+void UI_updateFrameCount(uint32_t curFrame)
+{
+	
+}
+
+/**
+    \fn      UI_setFrameCount(uint32_t curFrame,uint32_t total)
+    \brief  Display the current displayed frame # and total frame #
+*/
+void UI_setFrameCount(uint32_t curFrame,uint32_t total)
+{
+	
+}
+
+/**
+    \fn     UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
+    \brief  Display the time corresponding to current frame according to fps (fps1000)
+*/
+void UI_updateTimeCount(uint32_t curFrame,uint32_t fps)
+{
+	char text[80];   
+	uint32_t mm,hh,ss,ms;
+
+	frame2time(curFrame,fps, &amp;hh, &amp;mm, &amp;ss, &amp;ms);
+	sprintf(text, &quot;%02d:%02d:%02d.%03d&quot;, hh, mm, ss, ms);
+	WIDGET(currentTime)-&gt;setText(text);
+}
+
+
+
+/**
+    \fn UI_setCurrentTime
+    \brief Set current PTS of displayed video
+*/
+void UI_setCurrentTime(uint64_t curTime)
+{
+  char text[80];
+ uint32_t mm,hh,ss,ms;
+ uint32_t shorty=(uint32_t)(curTime/1000);
+
+    ms2time(shorty,&amp;hh,&amp;mm,&amp;ss,&amp;ms);
+  	sprintf(text, &quot;%02d:%02d:%02d.%03d&quot;, hh, mm, ss, ms);
+	WIDGET(currentTime)-&gt;setText(text);
+
+}
+
+/**
+    \fn UI_setTotalTime
+    \brief SEt the total duration of video
+*/
+void UI_setTotalTime(uint64_t curTime)
+{
+  char text[80];
+ uint32_t mm,hh,ss,ms;
+ uint32_t shorty=(uint32_t)(curTime/1000);
+
+    ms2time(shorty,&amp;hh,&amp;mm,&amp;ss,&amp;ms);
+  	sprintf(text, &quot;/%02d:%02d:%02d.%03d&quot;, hh, mm, ss, ms);
+    WIDGET(totalTime)-&gt;setText(text);
+    slider-&gt;setTotalDuration(curTime);
+}
+/**
+    \fn     UI_setMarkers(uint64_t Ptsa, uint32_t Ptsb )
+    \brief  Display frame # for marker A &amp; B
+*/
+void UI_setMarkers(uint64_t a, uint64_t b)
+{
+	char text[80];
+    uint64_t absoluteA=a,absoluteB=b;
+    uint32_t hh,mm,ss,ms;
+    uint32_t timems;
+    a/=1000;
+    b/=1000;
+
+    timems=(uint32_t)(a);
+    ms2time(timems,&amp;hh,&amp;mm,&amp;ss,&amp;ms);
+	snprintf(text,79,&quot;%02&quot;LU&quot;:%02&quot;LU&quot;:%02&quot;LU&quot;.%02&quot;LU,hh,mm,ss,ms);
+	WIDGET(pushButtonJumpToMarkerA)-&gt;setText(text);
+
+	timems=(uint32_t)(b);
+    ms2time(timems,&amp;hh,&amp;mm,&amp;ss,&amp;ms);
+	snprintf(text,79,&quot;%02&quot;LU&quot;:%02&quot;LU&quot;:%02&quot;LU&quot;.%02&quot;LU,hh,mm,ss,ms);
+	WIDGET(pushButtonJumpToMarkerB)-&gt;setText(text);
+
+	slider-&gt;setMarkers(absoluteA, absoluteB);
+}
+
+/**
+    \fn     UI_getCurrentVCodec(void)
+    \brief  Returns the current selected video code in menu, i.e its number (0 being the first)
+*/
+int 	UI_getCurrentVCodec(void)
+{
+	int i=WIDGET(comboBoxVideo)-&gt;currentIndex();
+	if(i&lt;0) i=0;
+	return i; 
+}
+/**
+    \fn     UI_setVideoCodec( int i)
+    \brief  Select the video codec which is # x in pulldown menu (starts at zero :copy)
+*/
+
+void UI_setVideoCodec( int i)
+{
+	int b=!!i;
+	WIDGET(comboBoxVideo)-&gt;setCurrentIndex(i);
+
+	WIDGET(pushButtonVideoConf)-&gt;setEnabled(b);
+	WIDGET(pushButtonVideoFilter)-&gt;setEnabled(b);
+}
+/**
+    \fn     UI_getCurrentACodec(void)
+    \brief  Returns the current selected audio code in menu, i.e its number (0 being the first)
+*/
+
+int 	UI_getCurrentACodec(void)
+{
+	int i=WIDGET(comboBoxAudio)-&gt;currentIndex();
+	if(i&lt;0) i=0;
+	return i; 
+}
+/**
+    \fn     UI_setAudioCodec( int i)
+    \brief  Select the audio codec which is # x in pulldown menu (starts at zero :copy)
+*/
+
+void UI_setAudioCodec( int i)
+{ int b=!!i;
+WIDGET(comboBoxAudio)-&gt;setCurrentIndex(i);
+WIDGET(pushButtonAudioConf)-&gt;setEnabled(b);
+WIDGET(pushButtonAudioFilter)-&gt;setEnabled(b);
+}
+/**
+    \fn     UI_GetCurrentFormat(void)
+    \brief  Returns the current selected output format
+*/
+
+int 	UI_GetCurrentFormat( void )
+{
+	int i=WIDGET(comboBoxFormat)-&gt;currentIndex();
+	if(i&lt;0) i=0;
+	return (int)i; 
+}
+/**
+    \fn     UI_SetCurrentFormat( ADM_OUT_FORMAT fmt )
+    \brief  Select  output format
+*/
+uint8_t 	UI_SetCurrentFormat( uint32_t fmt )
+{
+	WIDGET(comboBoxFormat)-&gt;setCurrentIndex((int)fmt);
+    return 1;
+}
+
+/**
+      \fn UI_getTimeShift
+      \brief get state (on/off) and value for time Shift
+*/
+uint8_t UI_getTimeShift(int *onoff,int *value)
+{
+	if(WIDGET(checkBox_TimeShift)-&gt;checkState()==Qt::Checked)
+		*onoff=1;
+	else
+		*onoff=0;
+	*value=WIDGET(spinBox_TimeValue)-&gt;value();
+	return 1;
+}
+/**
+      \fn UI_setTimeShift
+      \brief get state (on/off) and value for time Shift
+*/
+
+uint8_t UI_setTimeShift(int onoff,int value)
+{
+	if (onoff &amp;&amp; value)
+		WIDGET(checkBox_TimeShift)-&gt;setCheckState(Qt::Checked);
+	else
+		WIDGET(checkBox_TimeShift)-&gt;setCheckState(Qt::Unchecked);
+	WIDGET(spinBox_TimeValue)-&gt;setValue(value);
+	return 1;
+}
+/**
+    \fn UI_setVUMeter
+*/
+bool UI_setVUMeter( uint32_t volume[6])
+{
+    UI_vuUpdate( volume);
+    return true;
+}
+/**
+    \fn setDecodeName
+*/
+bool UI_setDecoderName(const char *name)
+{
+    WIDGET(labelVideoDecoder)-&gt;setText(name);	
+    return true;
+}
+/**
+    \fn UI_hasOpengl
+*/
+bool UI_hasOpenGl(void)
+{
+#ifndef USE_OPENGL
+    return false;
+#else
+    if(!ADM_glHasActiveTexture()) return false; // ADM_setActiveTexure
+    bool enabled;
+    prefs-&gt;get(FEATURES_ENABLE_OPENGL,&amp;enabled);
+    return enabled;
+#endif
+}
+//********************************************
+//EOF

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_ocr/Q_ocr.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_ocr/Q_ocr.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_ocr/Q_ocr.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -17,6 +17,7 @@
  ***************************************************************************/
 
 #include &quot;Q_ocr.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
 
 extern void UI_purge(void);
 
@@ -46,7 +47,7 @@
 	smallCanvas-&gt;resize(w*2, h*2); 
 }
 
-Ui_ocrWindow::Ui_ocrWindow(void)
+Ui_ocrWindow::Ui_ocrWindow(QWidget *parent) : QDialog(parent)
 {
 	ui.setupUi(this);
 	ui.textEdit-&gt;setReadOnly(TRUE);
@@ -260,8 +261,9 @@
 {
 	   Ui_ocrWindow *dialog=( Ui_ocrWindow *)d;
 	   ADM_assert(dialog==gDialog);
-		
-		
+
+	   qtUnregisterDialog(dialog);
+
 	   gDialog=NULL;
 	   delete dialog;
 	   return 1;	
@@ -273,8 +275,8 @@
 
 void 	*ADM_ocrUiSetup(void)
 {
-	
-	   Ui_ocrWindow *dialog=new Ui_ocrWindow;
+	   Ui_ocrWindow *dialog=new Ui_ocrWindow(qtLastRegisteredDialog());
+	   qtRegisterDialog(dialog);
 	   dialog-&gt;setModal(TRUE);
 	   dialog-&gt;show();
 	   gDialog=dialog;

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_ocr/Q_ocr.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_ocr/Q_ocr.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_ocr/Q_ocr.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -13,7 +13,7 @@
 	Q_OBJECT
 
 public:
-	Ui_ocrWindow(void);
+	Ui_ocrWindow(QWidget *parent);
 	~Ui_ocrWindow();
 	Ui_DialogOcr ui;
 

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -1,157 +1,159 @@
-/***************************************************************************
-
-    \file Q_shell.cpp
-    \brief UI for qt4 shell interface
-    \author mean, <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixount at free.fr</A> 2007/2009
-        
-    
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &lt;vector&gt;
-#include &quot;ADM_inttype.h&quot;
-#include &lt;QtCore/QFileInfo&gt;
-#include &lt;QtCore/QUrl&gt;
-#include &lt;QtGui/QKeyEvent&gt;
-#include &lt;QtGui/QGraphicsView&gt;
-#include &quot;Q_shell.h&quot;
-#include &quot;ADM_default.h&quot;
-#include &quot;ui_shell.h&quot;
-/**
-    \fn qShell
-*/
-qShell::qShell(jsShellEvaluate *s) : QDialog()
-{
-    ADM_info(&quot;Setting up JS shell..\n&quot;);
-    evaluator=s;
-    for(int i=0;i&lt;Q_SHELL_HISTORY;i++)
-                    history[i]=NULL;
-
-    ui.setupUi(this);
-    ui.textBrowser_2-&gt;installEventFilter(this);
-    connect((ui.evalute),SIGNAL(clicked(bool)),this,SLOT(evaluate(bool)));
-    connect((ui.clear),SIGNAL(clicked(bool)),this,SLOT(clear(bool)));
-    print(SCRIPT_LOG_NORMAL,&quot;Enter your commands then press the evaluate button or CTRL+ENTER.\n&quot;);
-    print(SCRIPT_LOG_NORMAL,&quot;You can use CTRL+PageUP and CTRL+Page Down to recall previous commands\nReady.\n&quot;);
-    indexRead=indexWrite=0;
-}
-/**
-    \fn ~qShell
-*/
-qShell::~qShell()
-{
-    ADM_info(&quot;Destroying JS shell..\n&quot;);
-    for(int i=0;i&lt;Q_SHELL_HISTORY;i++)
-    {
-            if(history[i]) delete history[i];
-            history[i]=NULL;
-    }
-
-} 
-bool qShell::run(void)
-{
-    this-&gt;exec();
-    return true;
-}
-/**
-        \fn evaluate
-        \brief callback for the evaluate button
-*/
-bool            qShell::evaluate(bool x)
-{
-    ADM_info(&quot;Evaluating...\n&quot;);
-    // 1 Get text from UI
-    QString text=ui.textBrowser_2-&gt;toPlainText();
-    int dex=indexWrite &amp; (Q_SHELL_HISTORY-1);
-    if(history[dex]) delete history[dex];
-    history[dex]=new QString(text);
-    indexWrite++;
-    indexRead=indexWrite-1; // Points to the last one
-
-    ui.textBrowser-&gt;setFontItalic(true);
-    ui.textBrowser-&gt;append(text);
-    ui.textBrowser-&gt;setFontItalic(false);
-    ui.textBrowser_2-&gt;setPlainText(&quot;&quot;);
-    evaluator(text.toAscii());
-    return true;
-}
-/**
-    \fn print
-*/
-bool qShell::print(SCRIPT_LOG_TYPE type,const char *s)
-{
-    QString string(s);
-    //printf(&quot;**%s&quot;,s);
-    switch(type)
-    {
-        case SCRIPT_LOG_NORMAL: ui.textBrowser-&gt;setTextColor(QColor(0,0,0));break;
-        case SCRIPT_LOG_ERROR : ui.textBrowser-&gt;setTextColor(QColor(255,0,0));break;
-    }
-    ui.textBrowser-&gt;insertPlainText(string);
-    ui.textBrowser-&gt;setTextColor(QColor(0,0,0));
-    return true;
-}
-/**
-    \fn clear
-*/
-bool qShell::clear(bool x)
-{
-    ui.textBrowser-&gt;clear();
-    return true;
-}
-/**
-    \fn eventFilter
-    \brief 
-*/
+/***************************************************************************
+
+    \file Q_shell.cpp
+    \brief UI for qt4 shell interface
+    \author mean, <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixount at free.fr</A> 2007/2009
+        
+    
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &lt;vector&gt;
+#include &quot;ADM_inttype.h&quot;
+#include &lt;QtCore/QFileInfo&gt;
+#include &lt;QtCore/QUrl&gt;
+#include &lt;QtGui/QKeyEvent&gt;
+#include &lt;QtGui/QGraphicsView&gt;
+#include &quot;Q_shell.h&quot;
+#include &quot;ADM_default.h&quot;
+#include &quot;ui_shell.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
+
+/**
+    \fn qShell
+*/
+qShell::qShell(QWidget *parent, jsShellEvaluate *s) : QDialog(parent)
+{
+    ADM_info(&quot;Setting up JS shell..\n&quot;);
+    evaluator=s;
+    for(int i=0;i&lt;Q_SHELL_HISTORY;i++)
+                    history[i]=NULL;
+
+    ui.setupUi(this);
+    ui.textBrowser_2-&gt;installEventFilter(this);
+    connect((ui.evalute),SIGNAL(clicked(bool)),this,SLOT(evaluate(bool)));
+    connect((ui.clear),SIGNAL(clicked(bool)),this,SLOT(clear(bool)));
+    print(SCRIPT_LOG_NORMAL,&quot;Enter your commands then press the evaluate button or CTRL+ENTER.\n&quot;);
+    print(SCRIPT_LOG_NORMAL,&quot;You can use CTRL+PageUP and CTRL+Page Down to recall previous commands\nReady.\n&quot;);
+    indexRead=indexWrite=0;
+}
+/**
+    \fn ~qShell
+*/
+qShell::~qShell()
+{
+    ADM_info(&quot;Destroying JS shell..\n&quot;);
+    for(int i=0;i&lt;Q_SHELL_HISTORY;i++)
+    {
+            if(history[i]) delete history[i];
+            history[i]=NULL;
+    }
+
+} 
+bool qShell::run(void)
+{
+    this-&gt;exec();
+    return true;
+}
+/**
+        \fn evaluate
+        \brief callback for the evaluate button
+*/
+bool            qShell::evaluate(bool x)
+{
+    ADM_info(&quot;Evaluating...\n&quot;);
+    // 1 Get text from UI
+    QString text=ui.textBrowser_2-&gt;toPlainText();
+    int dex=indexWrite &amp; (Q_SHELL_HISTORY-1);
+    if(history[dex]) delete history[dex];
+    history[dex]=new QString(text);
+    indexWrite++;
+    indexRead=indexWrite-1; // Points to the last one
+
+    ui.textBrowser-&gt;setFontItalic(true);
+    ui.textBrowser-&gt;append(text);
+    ui.textBrowser-&gt;setFontItalic(false);
+    ui.textBrowser_2-&gt;setPlainText(&quot;&quot;);
+    evaluator(text.toAscii());
+    return true;
+}
+/**
+    \fn print
+*/
+bool qShell::print(SCRIPT_LOG_TYPE type,const char *s)
+{
+    QString string(s);
+    //printf(&quot;**%s&quot;,s);
+    switch(type)
+    {
+        case SCRIPT_LOG_NORMAL: ui.textBrowser-&gt;setTextColor(QColor(0,0,0));break;
+        case SCRIPT_LOG_ERROR : ui.textBrowser-&gt;setTextColor(QColor(255,0,0));break;
+    }
+    ui.textBrowser-&gt;insertPlainText(string);
+    ui.textBrowser-&gt;setTextColor(QColor(0,0,0));
+    return true;
+}
+/**
+    \fn clear
+*/
+bool qShell::clear(bool x)
+{
+    ui.textBrowser-&gt;clear();
+    return true;
+}
+/**
+    \fn eventFilter
+    \brief 
+*/
 bool qShell::eventFilter(QObject* watched, QEvent* event)
 {
-	if(event-&gt;type()==QEvent::KeyPress)
+	if(event-&gt;type()==QEvent::KeyPress)
     {
-			QKeyEvent *keyEvent = (QKeyEvent*)event;
+			QKeyEvent *keyEvent = (QKeyEvent*)event;
             if(keyEvent-&gt;modifiers() == Qt::ControlModifier)
                 switch (keyEvent-&gt;key())
                 {
-                    case Qt::Key_PageUp:   previousCommand();return true;break;
-                    case Qt::Key_PageDown: nextCommand();return true;break;
-                    default:break;
-                }
-    }
-    return QObject::eventFilter(watched, event);
-}
-/**
-    \fn previousCommand
-*/
-bool   qShell::previousCommand(void)
-{
-    int dex=indexRead &amp; (Q_SHELL_HISTORY-1);
-    QString *copy=history[dex];
-    if(indexRead) indexRead--;
-    if(!copy) return true;
-    ui.textBrowser_2-&gt;clear();
-    ui.textBrowser_2-&gt;append(*copy);
-    return true;
-}
-/**
-    \fn nextCommand
-*/
-bool   qShell::nextCommand(void)
-{
-    if(indexRead+1&lt;indexWrite) indexRead++;
-            else return true;
-    int dex=indexRead &amp; (Q_SHELL_HISTORY-1);
-    QString *copy=history[dex];
-    if(!copy) return true;
-    ui.textBrowser_2-&gt;clear();
-    ui.textBrowser_2-&gt;append(*copy);
-    return true;
-}
-//EOF
-
-
+                    case Qt::Key_PageUp:   previousCommand();return true;break;
+                    case Qt::Key_PageDown: nextCommand();return true;break;
+                    default:break;
+                }
+    }
+    return QObject::eventFilter(watched, event);
+}
+/**
+    \fn previousCommand
+*/
+bool   qShell::previousCommand(void)
+{
+    int dex=indexRead &amp; (Q_SHELL_HISTORY-1);
+    QString *copy=history[dex];
+    if(indexRead) indexRead--;
+    if(!copy) return true;
+    ui.textBrowser_2-&gt;clear();
+    ui.textBrowser_2-&gt;append(*copy);
+    return true;
+}
+/**
+    \fn nextCommand
+*/
+bool   qShell::nextCommand(void)
+{
+    if(indexRead+1&lt;indexWrite) indexRead++;
+            else return true;
+    int dex=indexRead &amp; (Q_SHELL_HISTORY-1);
+    QString *copy=history[dex];
+    if(!copy) return true;
+    ui.textBrowser_2-&gt;clear();
+    ui.textBrowser_2-&gt;append(*copy);
+    return true;
+}
+//EOF
+
+

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/Q_shell.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -24,7 +24,7 @@
     int                  indexWrite;
     int                  indexRead;
 public:
-                    qShell(jsShellEvaluate *s) ;
+                    qShell(QWidget *parent, jsShellEvaluate *s);
     virtual         ~qShell() ;
     bool            run(void);
     bool            print(SCRIPT_LOG_TYPE type, const char *s);

Modified: branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/qt4Shell.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/qt4Shell.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux/qt4/ADM_userInterfaces/ADM_shell/qt4Shell.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -5,6 +5,7 @@
 
 #include &quot;Q_shell.h&quot;
 #include &quot;ADM_default.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
 /**
     \fn qt4ShellLogger
     \brief Redirect output to the shell
@@ -22,10 +23,15 @@
 */
 bool ADM_startShell(jsShellEvaluate eval)
 {
-        qShell *s= new qShell(eval);
+        qShell *s= new qShell(qtLastRegisteredDialog(), eval);
+		qtRegisterDialog(s);
+
         ADM_scriptRegisterLogger((void *)s,qt4ShellLogger);
         s-&gt;run();
+
         ADM_scriptUnregisterLogger();
+		qtUnregisterDialog(s);
+
         delete s;
         return true;
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264/qt4/Q_x264.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264/qt4/Q_x264.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoEncoder/x264/qt4/Q_x264.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -18,6 +18,7 @@
 #include &quot;Q_x264.h&quot;
 #include &quot;ADM_paramList.h&quot;
 #include &quot;DIA_coreToolkit.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
 
 static int pluginVersion=1;
 
@@ -61,19 +62,26 @@
 */
 bool x264_ui(x264_encoder *settings)
 {
-    x264Dialog dialog(NULL,settings);
+	bool success = false;
+    x264Dialog dialog(qtLastRegisteredDialog(), settings);
+
+	qtRegisterDialog(&amp;dialog);
+
     if (dialog.exec() == QDialog::Accepted)
     {
             dialog.download();
             memcpy(settings,&amp;myCopy,sizeof(myCopy));
-            return true;
+            success = true;
     }
-    return false;
+
+	qtUnregisterDialog(&amp;dialog);
+
+    return success;
 }
 /**
 
 */  
-x264Dialog::x264Dialog(QWidget *parent, void *param)
+x264Dialog::x264Dialog(QWidget *parent, void *param) : QDialog(parent)
 {
        ui.setupUi(this);
         connect(ui.encodingModeComboBox, SIGNAL(currentIndexChanged(int)), this, SLOT(encodingModeComboBox_currentIndexChanged(int)));

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ASharp/qt4/Q_asharp.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ASharp/qt4/Q_asharp.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ASharp/qt4/Q_asharp.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -21,12 +21,13 @@
  ***************************************************************************/
 
 #include &quot;Q_asharp.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
 
 //
 //	Video is in YV12 Colorspace
 //
 //
-  Ui_asharpWindow::Ui_asharpWindow(ASHARP_PARAM *param,AVDMGenericVideoStream *in)
+  Ui_asharpWindow::Ui_asharpWindow(QWidget *parent, ASHARP_PARAM *param,AVDMGenericVideoStream *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -111,12 +112,16 @@
 {
         uint8_t ret=0;
         
-        Ui_asharpWindow dialog(param,in);        
+        Ui_asharpWindow dialog(qtLastRegisteredDialog(), param,in);
+		qtRegisterDialog(&amp;dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(param); 
             ret=1;
         }
+
+		qtUnregisterDialog(&amp;dialog);
         return ret;
 }
 //____________________________________

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ASharp/qt4/Q_asharp.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ASharp/qt4/Q_asharp.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ASharp/qt4/Q_asharp.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -19,7 +19,7 @@
 public:
 	flyASharp *myCrop;
 	ADM_QCanvas *canvas;
-	Ui_asharpWindow(ASHARP_PARAM *param, AVDMGenericVideoStream *in);
+	Ui_asharpWindow(QWidget *parent, ASHARP_PARAM *param, AVDMGenericVideoStream *in);
 	~Ui_asharpWindow();
 	Ui_asharpDialog ui;
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ChromaShift/qt4/Q_chromashift.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ChromaShift/qt4/Q_chromashift.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ChromaShift/qt4/Q_chromashift.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -21,8 +21,9 @@
  ***************************************************************************/
 
 #include &quot;Q_chromashift.h&quot;
-#include &lt;math.h&gt;
-Ui_chromaShiftWindow::Ui_chromaShiftWindow(CHROMASHIFT_PARAM *param,AVDMGenericVideoStream *in)
+#include &quot;ADM_toolkitQt.h&quot;
+
+Ui_chromaShiftWindow::Ui_chromaShiftWindow(QWidget* parent, CHROMASHIFT_PARAM *param,AVDMGenericVideoStream *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -103,13 +104,18 @@
 uint8_t DIA_getChromaShift( AVDMGenericVideoStream *in,CHROMASHIFT_PARAM    *param )
 {
         uint8_t ret=0;
-        
-        Ui_chromaShiftWindow dialog(param,in);        
+
+        Ui_chromaShiftWindow dialog(qtLastRegisteredDialog(), param,in);
+		qtRegisterDialog(&amp;dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(param); 
             ret=1;
         }
+
+		qtUnregisterDialog(&amp;dialog);
+
         return ret;
 }
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ChromaShift/qt4/Q_chromashift.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ChromaShift/qt4/Q_chromashift.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/ChromaShift/qt4/Q_chromashift.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -14,7 +14,7 @@
  public:
      flyChromaShift *myCrop;
      ADM_QCanvas *canvas;
-     Ui_chromaShiftWindow(CHROMASHIFT_PARAM *param,AVDMGenericVideoStream *in);
+     Ui_chromaShiftWindow(CQWidget* parent, CHROMASHIFT_PARAM *param,AVDMGenericVideoStream *in);
      ~Ui_chromaShiftWindow();
      Ui_chromashiftDialog ui;
  public slots:

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Contrast/qt4/Q_contrast.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Contrast/qt4/Q_contrast.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Contrast/qt4/Q_contrast.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -21,12 +21,13 @@
  ***************************************************************************/
 
 #include &quot;Q_contrast.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
 
 //
 //	Video is in YV12 Colorspace
 //
 //
-  Ui_contrastWindow::Ui_contrastWindow(CONTRAST_PARAM *param,AVDMGenericVideoStream *in)
+  Ui_contrastWindow::Ui_contrastWindow(QWidget* parent, CONTRAST_PARAM *param,AVDMGenericVideoStream *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -115,13 +116,17 @@
 uint8_t DIA_contrast(AVDMGenericVideoStream *in,CONTRAST_PARAM *param)
 {
         uint8_t ret=0;
-        
-        Ui_contrastWindow dialog(param,in);        
+        Ui_contrastWindow dialog(qtLastRegisteredDialog(), param,in);
+		qtRegisterDialog(&amp;dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(param); 
             ret=1;
         }
+
+		qtUnregisterDialog(&amp;dialog);
+
         return ret;
 }
 //____________________________________

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Contrast/qt4/Q_contrast.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Contrast/qt4/Q_contrast.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Contrast/qt4/Q_contrast.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -19,7 +19,7 @@
 public:
 	flyContrast *myCrop;
 	ADM_QCanvas *canvas;
-	Ui_contrastWindow(CONTRAST_PARAM *param,AVDMGenericVideoStream *in);
+	Ui_contrastWindow(QWidget* parent, CONTRAST_PARAM *param,AVDMGenericVideoStream *in);
 	~Ui_contrastWindow();
 	Ui_contrastDialog ui;
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Eq2/qt4/Q_eq2.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Eq2/qt4/Q_eq2.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Eq2/qt4/Q_eq2.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -15,12 +15,13 @@
  ***************************************************************************/
 
 #include &quot;Q_eq2.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
 
 //
 //	Video is in YV12 Colorspace
 //
 //
-  Ui_eq2Window::Ui_eq2Window(Eq2_Param *param,AVDMGenericVideoStream *in)
+  Ui_eq2Window::Ui_eq2Window(QWidget *parent, Eq2_Param *param,AVDMGenericVideoStream *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -122,13 +123,18 @@
 uint8_t DIA_getEQ2Param(Eq2_Param *param, AVDMGenericVideoStream *in)
 {
         uint8_t ret=0;
-        
-        Ui_eq2Window dialog(param,in);        
+        Ui_eq2Window dialog(qtLastRegisteredDialog(), param,in);
+
+		qtRegisterDialog(&amp;dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(param); 
             ret=1;
         }
+
+		qtUnregisterDialog(&amp;dialog);
+
         return ret;
 }
 //____________________________________

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Eq2/qt4/Q_eq2.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Eq2/qt4/Q_eq2.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Eq2/qt4/Q_eq2.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -17,7 +17,7 @@
 public:
 	flyEq2 *myCrop;
 	ADM_QCanvas *canvas;
-	Ui_eq2Window(Eq2_Param *param,AVDMGenericVideoStream *in);
+	Ui_eq2Window(QWidget *parent, Eq2_Param *param,AVDMGenericVideoStream *in);
 	~Ui_eq2Window();
 	Ui_eq2Dialog ui;
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Hue/qt4/Q_hue.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Hue/qt4/Q_hue.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Hue/qt4/Q_hue.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -21,12 +21,13 @@
  ***************************************************************************/
 
 #include &quot;Q_hue.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
 
 //
 //	Video is in YV12 Colorspace
 //
 //
-  Ui_hueWindow::Ui_hueWindow(Hue_Param *param,AVDMGenericVideoStream *in)
+  Ui_hueWindow::Ui_hueWindow(QWidget *parent, Hue_Param *param,AVDMGenericVideoStream *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -101,13 +102,18 @@
 uint8_t DIA_getHue(Hue_Param *param,AVDMGenericVideoStream *in)
 {
         uint8_t ret=0;
-        
-        Ui_hueWindow dialog(param,in);        
+        Ui_hueWindow dialog(qtLastRegisteredDialog(), param,in);
+
+		qtRegisterDialog(&amp;dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(param); 
             ret=1;
         }
+
+		qtUnregisterDialog(&amp;dialog);
+
         return ret;
 }
 //____________________________________

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Hue/qt4/Q_hue.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Hue/qt4/Q_hue.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Hue/qt4/Q_hue.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -19,7 +19,7 @@
 public:
 	flyHue *myCrop;
 	ADM_QCanvas *canvas;
-	Ui_hueWindow(Hue_Param *param,AVDMGenericVideoStream *in);
+	Ui_hueWindow(QWidget *parent, Hue_Param *param,AVDMGenericVideoStream *in);
 	~Ui_hueWindow();
 	Ui_hueDialog ui;
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Srt/qt4/Q_srt.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Srt/qt4/Q_srt.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Srt/qt4/Q_srt.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -18,12 +18,13 @@
 
 //#include &quot;config.h&quot;
 #include &quot;Q_srt.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
 
 //
 //	Video is in YV12 Colorspace
 //
 //
-  Ui_srtWindow::Ui_srtWindow(SRT_POS_PARAM *param,AVDMGenericVideoStream *in)
+  Ui_srtWindow::Ui_srtWindow(QWidget *parent, SRT_POS_PARAM *param,AVDMGenericVideoStream *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -123,7 +124,10 @@
         SRT_POS_PARAM param;
         param.fontSize=*size;
         param.position=*position;
-        Ui_srtWindow dialog(&amp;param,in);        
+        Ui_srtWindow dialog(qtLastRegisteredDialog(), &amp;param,in);
+
+		qtRegisterDialog(&amp;dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(&amp;param);
@@ -131,6 +135,9 @@
             *position=param.position;
             ret=1;
         }
+
+		qtUnregisterDialog(&amp;dialog);
+
         return ret;
 }
 //____________________________________

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Srt/qt4/Q_srt.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Srt/qt4/Q_srt.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters/Srt/qt4/Q_srt.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -22,7 +22,7 @@
 public:
 	flySrtPos *myCrop;
 	ADM_QCanvas *canvas;
-	Ui_srtWindow(SRT_POS_PARAM *param, AVDMGenericVideoStream *in);
+	Ui_srtWindow(QWidget *parent, SRT_POS_PARAM *param, AVDMGenericVideoStream *in);
 	~Ui_srtWindow();
 	Ui_srtDialog ui;
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.cpp	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.cpp	2011-09-14 18:01:57 UTC (rev 7549)
@@ -19,14 +19,14 @@
  *   (at your option) any later version.                                   *
  *                                                                         *
  ***************************************************************************/
-#if 1
 #include &quot;Q_crop.h&quot;
+#include &quot;ADM_toolkitQt.h&quot;
 
 //
 //	Video is in YV12 Colorspace
 //
 //
-  Ui_cropWindow::Ui_cropWindow(crop *param,ADM_coreVideoFilter *in)
+Ui_cropWindow::Ui_cropWindow(QWidget* parent, crop *param,ADM_coreVideoFilter *in) : QDialog(parent)
   {
     uint32_t width,height;
         ui.setupUi(this);
@@ -155,15 +155,18 @@
 {
         uint8_t ret=0;
         
-        Ui_cropWindow dialog(param,in);        
+        Ui_cropWindow dialog(qtLastRegisteredDialog(), param,in);
+		qtRegisterDialog(&amp;dialog);
+
         if(dialog.exec()==QDialog::Accepted)
         {
             dialog.gather(param); 
             ret=1;
         }
+
+		qtUnregisterDialog(&amp;dialog);
+
         return ret;
 }
 //____________________________________
 // EOF
-
-#endif

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.h	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/crop/qt4/Q_crop.h	2011-09-14 18:01:57 UTC (rev 7549)
@@ -17,7 +17,7 @@
 public:
 	flyCrop *myCrop;
 	ADM_QCanvas *canvas;
-	Ui_cropWindow(crop *param,ADM_coreVideoFilter *in);
+	Ui_cropWindow(QWidget* parent, crop *param,ADM_coreVideoFilter *in);
 	~Ui_cropWindow();
 	Ui_cropDialog ui;
 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/CMakeLists.txt
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/CMakeLists.txt	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_videoFilters6/mplayerDenoise3D/CMakeLists.txt	2011-09-14 18:01:57 UTC (rev 7549)
@@ -1,10 +1,10 @@
 INCLUDE(vf_plugin)
 
 
-SET(ADM_vf_denoise3dhq_SRCS ADM_vidMPLD3D.cpp)
-ADD_VIDEO_FILTER(ADM_vf_denoise3dhq SHARED ${ADM_vf_denoise3dhq_SRCS})
-INIT_VIDEO_FILTER(ADM_vf_denoise3dhq)
-INSTALL_VIDEO_FILTER(ADM_vf_denoise3dhq)
+#SET(ADM_vf_denoise3dhq_SRCS ADM_vidMPLD3D.cpp)
+#ADD_VIDEO_FILTER(ADM_vf_denoise3dhq SHARED ${ADM_vf_denoise3dhq_SRCS})
+#INIT_VIDEO_FILTER(ADM_vf_denoise3dhq)
+#INSTALL_VIDEO_FILTER(ADM_vf_denoise3dhq)
 
 SET(ADM_vf_denoise3d_SRCS ADM_vidMPLD3Dlow.cpp)
 ADD_VIDEO_FILTER(ADM_vf_denoise3d SHARED ${ADM_vf_denoise3d_SRCS})

Modified: branches/avidemux_2.6_branch_mean/cmake/ve_plugin_qt4.cmake
===================================================================
--- branches/avidemux_2.6_branch_mean/cmake/ve_plugin_qt4.cmake	2011-09-14 17:26:43 UTC (rev 7548)
+++ branches/avidemux_2.6_branch_mean/cmake/ve_plugin_qt4.cmake	2011-09-14 18:01:57 UTC (rev 7549)
@@ -5,12 +5,13 @@
 MACRO(ADD_VIDEO_ENCODER_QT4 name srcQ headerQ uiQ)
         #INIT_VIDEO_ENCODER(${name})
         INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR} ${QT_INCLUDE_DIR})
+		INCLUDE_DIRECTORIES(${AVIDEMUX_TOP_SOURCE_DIR}/avidemux/qt4/ADM_UIs/include/)
         QT4_WRAP_UI(qt4_ui ${uiQ}.ui)
         QT4_WRAP_CPP(qt4_cpp ${headerQ})
         ADD_LIBRARY(${name} SHARED ${ARGN} ${srcQ} ${qt4_cpp} ${qt4_ui})
 	AS_NEEDED(${name})
         ADD_TARGET_CFLAGS(${name} &quot;-DADM_UI_TYPE_BUILD=4&quot;)
-        #TARGET_LINK_LIBRARIES( ${name} ADM_UIQT46  ADM_render6_qt4)
+        TARGET_LINK_LIBRARIES( ${name} ADM_UIQT46 )
         TARGET_LINK_LIBRARIES(${name} ${QT_QTGUI_LIBRARY} ${QT_QTCORE_LIBRARY})
 
 ENDMACRO(ADD_VIDEO_ENCODER_QT4 )


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004695.html">[Avidemux-svn-commit] r7548 - in	branches/avidemux_2.6_branch_mean/avidemux: cli gtk qt4	qt4/ADM_jobs/src winInstaller
</A></li>
	<LI>Next message: <A HREF="004697.html">[Avidemux-svn-commit] r7550 - in branches/avidemux_2.6_branch_mean:	avidemux/cli avidemux/gtk avidemux/qt4	avidemux/qt4/ADM_jobs/src cmake
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4696">[ date ]</a>
              <a href="thread.html#4696">[ thread ]</a>
              <a href="subject.html#4696">[ subject ]</a>
              <a href="author.html#4696">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
