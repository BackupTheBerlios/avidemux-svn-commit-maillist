<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r7197 - in branches/avidemux_2.6_branch_mean:	avidemux/common/ADM_audiocodec avidemux_core/ADM_coreAudio/include	avidemux_core/ADM_coreAudio/src	avidemux_plugins/ADM_audioDecoders/ADM_ad_ac3	avidemux_plugins/ADM_audioDecoders/ADM_ad_faad	avidemux_plugins/ADM_audioDecoders/ADM_ad_ima_adpcm	avidemux_plugins/ADM_audioDecoders/ADM_ad_lav	avidemux_plugins/ADM_audioDecoders/ADM_ad_mad	avidemux_plugins/ADM_audioDecoders/ADM_ad_ms_adpcm	avidemux_plugins/ADM_audioDecoders/ADM_ad_ulaw	avidemux_plugins/ADM_audioDecoders/ADM_ad_vorbis
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2011-May/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r7197%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux/common/ADM_audiocodec%20avidemux_core/ADM_coreAudio/include%0A%09avidemux_core/ADM_coreAudio/src%0A%09avidemux_plugins/ADM_audioDecoders/ADM_ad_ac3%0A%09avidemux_plugins/ADM_audioDecoders/ADM_ad_faad%0A%09avidemux_plugins/ADM_audioDecoders/ADM_ad_ima_adpcm%0A%09avidemux_plugins/ADM_audioDecoders/ADM_ad_lav%0A%09avidemux_plugins/ADM_audioDecoders/ADM_ad_mad%0A%09avidemux_plugins/ADM_audioDecoders/ADM_ad_ms_adpcm%0A%09avidemux_plugins/ADM_audioDecoders/ADM_ad_ulaw%0A%09avidemux_plugins/ADM_audioDecoders/ADM_ad_vorbis&In-Reply-To=%3C20110510054052.21840480F9E%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004351.html">
   <LINK REL="Next"  HREF="004353.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r7197 - in branches/avidemux_2.6_branch_mean:	avidemux/common/ADM_audiocodec avidemux_core/ADM_coreAudio/include	avidemux_core/ADM_coreAudio/src	avidemux_plugins/ADM_audioDecoders/ADM_ad_ac3	avidemux_plugins/ADM_audioDecoders/ADM_ad_faad	avidemux_plugins/ADM_audioDecoders/ADM_ad_ima_adpcm	avidemux_plugins/ADM_audioDecoders/ADM_ad_lav	avidemux_plugins/ADM_audioDecoders/ADM_ad_mad	avidemux_plugins/ADM_audioDecoders/ADM_ad_ms_adpcm	avidemux_plugins/ADM_audioDecoders/ADM_ad_ulaw	avidemux_plugins/ADM_audioDecoders/ADM_ad_vorbis</H1>
    <B>mean at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r7197%20-%20in%20branches/avidemux_2.6_branch_mean%3A%0A%09avidemux/common/ADM_audiocodec%20avidemux_core/ADM_coreAudio/include%0A%09avidemux_core/ADM_coreAudio/src%0A%09avidemux_plugins/ADM_audioDecoders/ADM_ad_ac3%0A%09avidemux_plugins/ADM_audioDecoders/ADM_ad_faad%0A%09avidemux_plugins/ADM_audioDecoders/ADM_ad_ima_adpcm%0A%09avidemux_plugins/ADM_audioDecoders/ADM_ad_lav%0A%09avidemux_plugins/ADM_audioDecoders/ADM_ad_mad%0A%09avidemux_plugins/ADM_audioDecoders/ADM_ad_ms_adpcm%0A%09avidemux_plugins/ADM_audioDecoders/ADM_ad_ulaw%0A%09avidemux_plugins/ADM_audioDecoders/ADM_ad_vorbis&In-Reply-To=%3C20110510054052.21840480F9E%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r7197 - in branches/avidemux_2.6_branch_mean:	avidemux/common/ADM_audiocodec avidemux_core/ADM_coreAudio/include	avidemux_core/ADM_coreAudio/src	avidemux_plugins/ADM_audioDecoders/ADM_ad_ac3	avidemux_plugins/ADM_audioDecoders/ADM_ad_faad	avidemux_plugins/ADM_audioDecoders/ADM_ad_ima_adpcm	avidemux_plugins/ADM_audioDecoders/ADM_ad_lav	avidemux_plugins/ADM_audioDecoders/ADM_ad_mad	avidemux_plugins/ADM_audioDecoders/ADM_ad_ms_adpcm	avidemux_plugins/ADM_audioDecoders/ADM_ad_ulaw	avidemux_plugins/ADM_audioDecoders/ADM_ad_vorbis">mean at mail.berlios.de
       </A><BR>
    <I>Tue May 10 07:40:52 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004351.html">[Avidemux-svn-commit] r7196 - in	branches/avidemux_2.6_branch_mean/avidemux/common:	ADM_audioFilter/src ADM_editor
</A></li>
        <LI>Next message: <A HREF="004353.html">[Avidemux-svn-commit] r7198 - in	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders:	ADM_ad_lav ADM_ad_opencore_amrnb ADM_ad_opencore_amrwb
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4352">[ date ]</a>
              <a href="thread.html#4352">[ thread ]</a>
              <a href="subject.html#4352">[ subject ]</a>
              <a href="author.html#4352">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2011-05-10 07:40:51 +0200 (Tue, 10 May 2011)
New Revision: 7197

Modified:
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_8bits.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_audiocodec.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_audiocodec.h
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_codecwav.cpp
   branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_lpcm.cpp
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/include/ADM_audioStream.h
   branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/src/ADM_audioStream.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ac3/ADM_ad_a52.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_faad/ADM_ad_faad.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ima_adpcm/ADM_ad_ima_adpcm.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_lav/ADM_ad_lav.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_mad/ADM_ad_mad.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ms_adpcm/ADM_ad_ms_adpcm.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ulaw/ADM_ad_ulaw.cpp
   branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_vorbis/ADM_ad_vorbis.cpp
Log:
[audio] Add a copy of wavinfo at constructor level, might be needed later

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_8bits.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_8bits.cpp	2011-05-10 05:40:49 UTC (rev 7196)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_8bits.cpp	2011-05-10 05:40:51 UTC (rev 7197)
@@ -30,7 +30,8 @@
 #include &quot;ADM_audiocodec/ADM_audiocodec.h&quot;
 
 
-ADM_Audiocodec8Bits::ADM_Audiocodec8Bits( uint32_t fourcc) :   ADM_Audiocodec(fourcc)
+ADM_Audiocodec8Bits::ADM_Audiocodec8Bits( uint32_t fourcc,const WAVHeader &amp;info) :  
+            ADM_Audiocodec(fourcc,info)
 {
  	ADM_assert(fourcc==WAV_8BITS||fourcc==WAV_8BITS_UNSIGNED);
 	if(fourcc==WAV_8BITS_UNSIGNED)

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_audiocodec.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_audiocodec.cpp	2011-05-10 05:40:49 UTC (rev 7196)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_audiocodec.cpp	2011-05-10 05:40:51 UTC (rev 7197)
@@ -40,25 +40,25 @@
 				case WAV_PCM:
                     printf(&quot;[audioCodec] Audio codec:  WAV\n&quot;);
 #ifdef ADM_BIG_ENDIAN
-                    out= (ADM_Audiocodec *)new ADM_AudiocodecWavSwapped(fourcc);
+                    out= (ADM_Audiocodec *)new ADM_AudiocodecWavSwapped(fourcc,*info);
 #else
-					out= (ADM_Audiocodec *)new ADM_AudiocodecWav(fourcc);
+					out= (ADM_Audiocodec *)new ADM_AudiocodecWav(fourcc,*info);
 #endif
                   			break;
 				case WAV_8BITS:
 					printf(&quot;[audioCodec] 8 BIts pseudo codec\n&quot;);
-                    out= (ADM_Audiocodec *)new ADM_Audiocodec8Bits(fourcc);
+                    out= (ADM_Audiocodec *)new ADM_Audiocodec8Bits(fourcc,*info);
 					break;
 				case WAV_8BITS_UNSIGNED:
 					printf(&quot;[audioCodec] 8 BIts pseudo codec unsigned\n&quot;);
-    					out= (ADM_Audiocodec *)new ADM_Audiocodec8Bits(fourcc);
+    					out= (ADM_Audiocodec *)new ADM_Audiocodec8Bits(fourcc,*info);
 					break;
 		  		case WAV_LPCM:
 					printf(&quot;[audioCodec] Audio codec:  LPCM swapped\n&quot;);
 #ifndef ADM_BIG_ENDIAN
-                    out= (ADM_Audiocodec *)new ADM_AudiocodecWavSwapped(fourcc);
+                    out= (ADM_Audiocodec *)new ADM_AudiocodecWavSwapped(fourcc,*info);
 #else
-					out= (ADM_Audiocodec *)new ADM_AudiocodecWav(fourcc);
+					out= (ADM_Audiocodec *)new ADM_AudiocodecWav(fourcc,*info);
 #endif
                   		break;
             default:
@@ -68,7 +68,7 @@
 	if (out == NULL)
 	{
 		printf(&quot;[audioCodec] Unknown codec : %&quot;LU&quot;\n&quot;,fourcc);
-		out = (ADM_Audiocodec *) new ADM_AudiocodecUnknown(fourcc);
+		out = (ADM_Audiocodec *) new ADM_AudiocodecUnknown(fourcc,*info);
 	}
 	// For channel mapping, simple case we do it here so that the decoder does not have
 	// to worry.

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_audiocodec.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_audiocodec.h	2011-05-10 05:40:49 UTC (rev 7196)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_audiocodec.h	2011-05-10 05:40:51 UTC (rev 7197)
@@ -24,15 +24,15 @@
 {
     protected:
         uint8_t	_init;
-        WAVHeader *_wavHeader;
+        WAVHeader wavHeader;
     public:
-        ADM_Audiocodec(uint32_t fourcc)
+        ADM_Audiocodec(uint32_t fourcc,const WAVHeader &amp;info)
         {
             UNUSED_ARG(fourcc);
             _init=0;
-            _wavHeader=NULL;
+            wavHeader=info;
         };
-        virtual uint32_t getOutputFrequency(void)  {return _wavHeader-&gt;frequency;}
+        virtual uint32_t getOutputFrequency(void)  {return wavHeader.frequency;}
         virtual	        ~ADM_Audiocodec() {};
         virtual	        void purge(void) {}
         virtual	uint8_t beginDecompress(void)=0;
@@ -49,7 +49,7 @@
 class ADM_AudiocodecWav : public     ADM_Audiocodec
 {
 	public:
-		ADM_AudiocodecWav(uint32_t fourcc);
+		ADM_AudiocodecWav(uint32_t fourcc,const WAVHeader &amp;info);
 		virtual	~ADM_AudiocodecWav();
 		virtual	uint8_t beginDecompress(void);
 		virtual	uint8_t endDecompress(void);
@@ -60,7 +60,7 @@
 class ADM_AudiocodecWavSwapped : public     ADM_Audiocodec
 {
 	public:
-		ADM_AudiocodecWavSwapped(uint32_t fourcc);
+		ADM_AudiocodecWavSwapped(uint32_t fourcc,const WAVHeader &amp;info);
 		virtual	~ADM_AudiocodecWavSwapped();
 		virtual	uint8_t beginDecompress(void);
 		virtual	uint8_t endDecompress(void);
@@ -72,7 +72,7 @@
 class ADM_AudiocodecUnknown : public     ADM_Audiocodec
 {
 	public:
-		ADM_AudiocodecUnknown(uint32_t fourcc) : ADM_Audiocodec(fourcc) {}
+		ADM_AudiocodecUnknown(uint32_t fourcc,const WAVHeader &amp;info) : ADM_Audiocodec(fourcc,info) {}
 		~ADM_AudiocodecUnknown() {}
 		uint8_t beginDecompress(void) {return 0;}
 		uint8_t endDecompress(void) {return 0;}
@@ -89,7 +89,7 @@
 		uint8_t _unsign;
 
 	public:
-		ADM_Audiocodec8Bits(uint32_t fourcc);
+		ADM_Audiocodec8Bits(uint32_t fourcc,const WAVHeader &amp;info);
 		virtual	~ADM_Audiocodec8Bits();
 		virtual	uint8_t beginDecompress(void) {return 1;}
 		virtual	uint8_t endDecompress(void) {return 1;}

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_codecwav.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_codecwav.cpp	2011-05-10 05:40:49 UTC (rev 7196)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_codecwav.cpp	2011-05-10 05:40:51 UTC (rev 7197)
@@ -18,7 +18,7 @@
 #include &lt;math.h&gt;
 #include &quot;ADM_audiocodec/ADM_audiocodec.h&quot;
 
-ADM_AudiocodecWav::ADM_AudiocodecWav( uint32_t fourcc ) : ADM_Audiocodec(fourcc)
+ADM_AudiocodecWav::ADM_AudiocodecWav( uint32_t fourcc,const WAVHeader &amp;info ) : ADM_Audiocodec(fourcc,info)
 {
     ADM_info(&quot;Creating not swapped wav decoder (PCM)\n&quot;);
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_lpcm.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_lpcm.cpp	2011-05-10 05:40:49 UTC (rev 7196)
+++ branches/avidemux_2.6_branch_mean/avidemux/common/ADM_audiocodec/ADM_lpcm.cpp	2011-05-10 05:40:51 UTC (rev 7197)
@@ -25,7 +25,7 @@
 #include &quot;ADM_audiocodec/ADM_audiocodec.h&quot;
 
 
-ADM_AudiocodecWavSwapped::ADM_AudiocodecWavSwapped( uint32_t fourcc ) : ADM_Audiocodec(fourcc)
+ADM_AudiocodecWavSwapped::ADM_AudiocodecWavSwapped( uint32_t fourcc,const WAVHeader &amp;info ) : ADM_Audiocodec(fourcc,info)
 {
 	channelMapping[0] = ADM_CH_FRONT_LEFT;
 	channelMapping[1] = ADM_CH_FRONT_RIGHT;

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/include/ADM_audioStream.h
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/include/ADM_audioStream.h	2011-05-10 05:40:49 UTC (rev 7196)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/include/ADM_audioStream.h	2011-05-10 05:40:51 UTC (rev 7197)
@@ -84,6 +84,8 @@
                         void                    setDts(uint64_t newDts);
     /// increment DTS by samples
                        bool                     advanceDtsBySample(uint32_t samples);
+    /// Same with provided frequency (SBR)
+                       bool                     advanceDtsByCustomSample(uint32_t samples,uint32_t fq);
         public:
 /// Default constructor
                        ADM_audioStream(WAVHeader *header,ADM_audioAccess *access);  

Modified: branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/src/ADM_audioStream.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/src/ADM_audioStream.cpp	2011-05-10 05:40:49 UTC (rev 7196)
+++ branches/avidemux_2.6_branch_mean/avidemux_core/ADM_coreAudio/src/ADM_audioStream.cpp	2011-05-10 05:40:51 UTC (rev 7197)
@@ -130,6 +130,19 @@
         return true;
 }
 /**
+        \fn advanceDtsByCustomSample
+*/
+bool    ADM_audioStream::advanceDtsByCustomSample(uint32_t samples,uint32_t fq)
+{
+        sampleElapsed+=samples;
+        float f=sampleElapsed*1000;
+            f/=fq;
+            f*=1000;
+            lastDts=lastDtsBase+(uint64_t)(f+0.5);
+        return true;
+}
+
+/**
                 Create the appropriate audio stream
 */
 ADM_audioStream  *ADM_audioCreateStream(WAVHeader *wavheader, ADM_audioAccess *access,bool makeTimeMap)

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ac3/ADM_ad_a52.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ac3/ADM_ad_a52.cpp	2011-05-10 05:40:49 UTC (rev 7196)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ac3/ADM_ad_a52.cpp	2011-05-10 05:40:51 UTC (rev 7197)
@@ -50,10 +50,10 @@
    //********************************************************
 
 ADM_AudiocodecAC3::ADM_AudiocodecAC3( uint32_t fourcc, WAVHeader *info,uint32_t extraLength,uint8_t *extraData)
-		:   ADM_Audiocodec(fourcc)
+		:   ADM_Audiocodec(fourcc,*info)
 {
     int flags=0;
-    _wavHeader = new WAVHeader;
+    
     ADM_assert(fourcc==WAV_AC3);
     ac3_handle=NULL;
     ac3_sample=NULL;
@@ -76,8 +76,8 @@
         ADM_warning(&quot;Cannot init a52 sample\n&quot;);
         ADM_assert(0);
     }
-      _wavHeader = new WAVHeader;
-      *_wavHeader=*info;
+
+      
 }
 
 ADM_AudiocodecAC3::~ADM_AudiocodecAC3( )
@@ -88,11 +88,7 @@
         ac3_handle=NULL;
         ac3_sample=NULL;
     }
-    if( _wavHeader)
-    {
-        delete  _wavHeader;
-        _wavHeader=NULL;
-    }
+    
 }
 
 uint8_t ADM_AudiocodecAC3::beginDecompress( void )
@@ -110,7 +106,7 @@
     uint32_t avail;
     uint32_t length;
     int flags = 0, samprate = 0, bitrate = 0;
-    uint8_t chan = _wavHeader-&gt;channels;
+    uint8_t chan = wavHeader.channels;
     *nbOut=0;
 
     //  Ready to decode

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_faad/ADM_ad_faad.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_faad/ADM_ad_faad.cpp	2011-05-10 05:40:49 UTC (rev 7196)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_faad/ADM_ad_faad.cpp	2011-05-10 05:40:51 UTC (rev 7197)
@@ -30,7 +30,7 @@
 		uint8_t  _buffer[FAAD_BUFFER*2];
 		uint32_t head, tail;
         bool     monoFaadBug; // if true, the stream is mono, but faad outputs stereo
-        bool     sbr;
+        uint32_t fq;
 	public:
 		ADM_faad(uint32_t fourcc, WAVHeader *info, uint32_t l, uint8_t *d);
 		virtual	~ADM_faad();
@@ -60,12 +60,10 @@
 */
 uint32_t ADM_faad::getOutputFrequency(void)
 {
-    uint32_t fq=_wavHeader-&gt;frequency;
-    if(sbr) return fq*2;
-    else return fq;
+    return fq;
 
 }
-ADM_faad::ADM_faad( uint32_t fourcc ,WAVHeader *info,uint32_t l,uint8_t *d) :   ADM_Audiocodec(fourcc)
+ADM_faad::ADM_faad( uint32_t fourcc ,WAVHeader *info,uint32_t l,uint8_t *d) :   ADM_Audiocodec(fourcc,*info)
 {
 faacDecConfigurationPtr conf;
 #ifdef FAAD_OLD_PROTOTYPE
@@ -74,7 +72,7 @@
 uint32_t srate;
 #endif
 unsigned char chan;
-        sbr=false;
+        
 		_inited=0;
 		_instance=NULL;
         head=tail=0;
@@ -86,7 +84,8 @@
 		conf-&gt;defSampleRate=info-&gt;frequency;
   	    conf-&gt;defObjectType =LC;
         // Disable SBR...
-        conf-&gt;dontUpSampleImplicitSBR=1;
+        //conf-&gt;dontUpSampleImplicitSBR=1;
+        fq=info-&gt;frequency;
         //
 		faacDecSetConfiguration(_instance, conf);
         printf(&quot;[FAAD] using %u bytes of extradata\n&quot;,l);
@@ -107,7 +106,7 @@
                             if(srate==2*info-&gt;frequency)
                             {
                                 ADM_info(&quot;Sbr detected\n&quot;);
-                                sbr=true;
+                                fq=srate;
                             }
                             
                             //info-&gt;frequency=srate;

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ima_adpcm/ADM_ad_ima_adpcm.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ima_adpcm/ADM_ad_ima_adpcm.cpp	2011-05-10 05:40:49 UTC (rev 7196)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ima_adpcm/ADM_ad_ima_adpcm.cpp	2011-05-10 05:40:51 UTC (rev 7197)
@@ -131,7 +131,7 @@
 // };
 
 ADM_AudiocodecImaAdpcm::ADM_AudiocodecImaAdpcm( uint32_t fourcc, WAVHeader *info, uint32_t l, uint8_t *d)
-        : ADM_Audiocodec(fourcc)
+        : ADM_Audiocodec(fourcc,*info)
 {
         _me=info-&gt;encoding;
         _channels=info-&gt;channels;

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_lav/ADM_ad_lav.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_lav/ADM_ad_lav.cpp	2011-05-10 05:40:49 UTC (rev 7196)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_lav/ADM_ad_lav.cpp	2011-05-10 05:40:51 UTC (rev 7197)
@@ -97,7 +97,7 @@
 */
 
  ADM_AudiocoderLavcodec::ADM_AudiocoderLavcodec(uint32_t fourcc,WAVHeader *info,uint32_t l,uint8_t *d)
-       :  ADM_Audiocodec(fourcc)
+       :  ADM_Audiocodec(fourcc,*info)
  {
     ADM_info(&quot; [ADM_AD_LAV] Using decoder for type 0x%x\n&quot;,info-&gt;encoding);
     ADM_info(&quot; [ADM_AD_LAV] #of channels %d\n&quot;,info-&gt;channels);

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_mad/ADM_ad_mad.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_mad/ADM_ad_mad.cpp	2011-05-10 05:40:49 UTC (rev 7196)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_mad/ADM_ad_mad.cpp	2011-05-10 05:40:51 UTC (rev 7197)
@@ -57,7 +57,8 @@
 			&quot;LibMad decoder plugin for avidemux (c) Mean\n&quot;); 	// Desc
 //********************************************************
 
-ADM_AudiocodecMP3::ADM_AudiocodecMP3( uint32_t fourcc,WAVHeader *info,uint32_t extraLength,uint8_t *extraData) :   ADM_Audiocodec(fourcc)
+ADM_AudiocodecMP3::ADM_AudiocodecMP3( uint32_t fourcc,WAVHeader *info,uint32_t extraLength,uint8_t *extraData) 
+        :   ADM_Audiocodec(fourcc,*info)
 {
         if((fourcc!=WAV_MP3) &amp;&amp; (fourcc!=WAV_MP2))
             ADM_assert(0); 

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ms_adpcm/ADM_ad_ms_adpcm.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ms_adpcm/ADM_ad_ms_adpcm.cpp	2011-05-10 05:40:49 UTC (rev 7196)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ms_adpcm/ADM_ad_ms_adpcm.cpp	2011-05-10 05:40:51 UTC (rev 7197)
@@ -219,7 +219,7 @@
     \brief
 */
 ADM_AudiocodecMsAdpcm::ADM_AudiocodecMsAdpcm( uint32_t fourcc, WAVHeader *info, uint32_t l, uint8_t *d)
-        : ADM_Audiocodec(fourcc)
+        : ADM_Audiocodec(fourcc,*info)
 {
         _me=info-&gt;encoding;
         _channels=info-&gt;channels;

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ulaw/ADM_ad_ulaw.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ulaw/ADM_ad_ulaw.cpp	2011-05-10 05:40:49 UTC (rev 7196)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_ulaw/ADM_ad_ulaw.cpp	2011-05-10 05:40:51 UTC (rev 7197)
@@ -51,7 +51,8 @@
     \fn ADM_AudiocodecUlaw
     \brief
 */
-ADM_AudiocodecUlaw::ADM_AudiocodecUlaw(uint32_t fourcc, WAVHeader *info, uint32_t l, uint8_t *d) : ADM_Audiocodec(fourcc)
+ADM_AudiocodecUlaw::ADM_AudiocodecUlaw(uint32_t fourcc, WAVHeader *info, uint32_t l, uint8_t *d) 
+: ADM_Audiocodec(fourcc,*info)
 {
 		
 }

Modified: branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_vorbis/ADM_ad_vorbis.cpp
===================================================================
--- branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_vorbis/ADM_ad_vorbis.cpp	2011-05-10 05:40:49 UTC (rev 7196)
+++ branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders/ADM_ad_vorbis/ADM_ad_vorbis.cpp	2011-05-10 05:40:51 UTC (rev 7197)
@@ -76,7 +76,7 @@
  }
 
  ADM_vorbis::ADM_vorbis(uint32_t fcc, WAVHeader *info, uint32_t extra, uint8_t *extraData)
- 	: ADM_Audiocodec(fcc)
+ 	: ADM_Audiocodec(fcc,*info)
  {
  ogg_packet packet;
  vorbis_comment comment;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004351.html">[Avidemux-svn-commit] r7196 - in	branches/avidemux_2.6_branch_mean/avidemux/common:	ADM_audioFilter/src ADM_editor
</A></li>
	<LI>Next message: <A HREF="004353.html">[Avidemux-svn-commit] r7198 - in	branches/avidemux_2.6_branch_mean/avidemux_plugins/ADM_audioDecoders:	ADM_ad_lav ADM_ad_opencore_amrnb ADM_ad_opencore_amrwb
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4352">[ date ]</a>
              <a href="thread.html#4352">[ thread ]</a>
              <a href="subject.html#4352">[ subject ]</a>
              <a href="author.html#4352">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
