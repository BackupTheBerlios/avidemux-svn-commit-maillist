<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3511 - in	branches/avidemux_2.4_branch/avidemux:	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-August/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3511%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09ADM_userInterfaces/ADM_commonUI%20ADM_video%20ADM_videoFilter&In-Reply-To=%3C200708140834.l7E8YDaH019067%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000784.html">
   <LINK REL="Next"  HREF="000786.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3511 - in	branches/avidemux_2.4_branch/avidemux:	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3511%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09ADM_userInterfaces/ADM_commonUI%20ADM_video%20ADM_videoFilter&In-Reply-To=%3C200708140834.l7E8YDaH019067%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3511 - in	branches/avidemux_2.4_branch/avidemux:	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter">mean at mail.berlios.de
       </A><BR>
    <I>Tue Aug 14 10:34:13 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000784.html">[Avidemux-svn-commit] r3510 - in	branches/avidemux_2.4_branch/avidemux: ADM_libraries/ADM_utilities	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI ADM_video
</A></li>
        <LI>Next message: <A HREF="000786.html">[Avidemux-svn-commit] r3512 -	branches/avidemux_2.4_branch/avidemux/ADM_video
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#785">[ date ]</a>
              <a href="thread.html#785">[ thread ]</a>
              <a href="subject.html#785">[ subject ]</a>
              <a href="author.html#785">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2007-08-14 10:34:12 +0200 (Tue, 14 Aug 2007)
New Revision: 3511

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidEq2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidEq2.h
Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_eq2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
Log:
[Filter] Move Eq2 to videoFilter

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp	2007-08-14 08:29:00 UTC (rev 3510)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_eq2.cpp	2007-08-14 08:34:12 UTC (rev 3511)
@@ -34,7 +34,7 @@
 #include &quot;ADM_image.h&quot;
 #include &quot;ADM_video/ADM_genvideo.hxx&quot;
 
-#include &quot;ADM_video/ADM_vidEq2.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidEq2.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
 #include &quot;DIA_flyEq2.h&quot;
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-08-14 08:29:00 UTC (rev 3510)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-08-14 08:34:12 UTC (rev 3511)
@@ -48,7 +48,7 @@
 #include &quot;ADM_video/ADM_vidVobSub.h&quot;
 #include &quot;ADM_videoFilter/ADM_vidChromaShift_param.h&quot;
 #include &quot;ADM_video/ADM_vidMPdelogo.h&quot;
-#include &quot;ADM_video/ADM_vidEq2.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidEq2.h&quot;
 #include &quot;ADM_video/ADM_vidContrast.h&quot;
 //#include &quot;ADM_video/ADM_vidFont.h&quot;
 class ADMfont;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_eq2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_eq2.cpp	2007-08-14 08:29:00 UTC (rev 3510)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_eq2.cpp	2007-08-14 08:34:12 UTC (rev 3511)
@@ -27,11 +27,11 @@
 #include &quot;ADM_video/ADM_genvideo.hxx&quot;
 #include &quot;ADM_colorspace/ADM_rgb.h&quot;
 #include &quot;ADM_assert.h&quot;
-#include &quot;ADM_video/ADM_vidEq2.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidEq2.h&quot;
 
 #include &quot;DIA_flyDialog.h&quot;
 #include &quot;DIA_flyDialogQt4.h&quot;
-#include &quot;ADM_video/ADM_vidEq2.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidEq2.h&quot;
 #include &quot;DIA_flyEq2.h&quot;
 
 //

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.h	2007-08-14 08:29:00 UTC (rev 3510)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.h	2007-08-14 08:34:12 UTC (rev 3511)
@@ -14,7 +14,7 @@
  ***************************************************************************/
 #ifndef FLY_EQ2_H
 #define FLY_EQ2_H
-#include &quot;ADM_video/ADM_vidEq2.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidEq2.h&quot;
 class flyEq2 : public ADM_flyDialog
 {
   

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.cpp	2007-08-14 08:29:00 UTC (rev 3510)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.cpp	2007-08-14 08:34:12 UTC (rev 3511)
@@ -1,398 +0,0 @@
-/***************************************************************************
-                          Hue/Saturation filter ported from mplayer 
- (c)  * Software equalizer (brightness, contrast, gamma, saturation)
- *
- * Hampa Hug &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">hampa at hampa.ch</A>&gt; (original LUT gamma/contrast/brightness filter)
- * Daniel Moreno &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">comac at comac.darktech.org</A>&gt; (saturation, R/G/B gamma support)
- * Richard Felker (original MMX contrast/brightness code (vf_eq.c))
- * Michael Niedermayer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">michalni at gmx.at</A>&gt; (LUT16)
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &quot;config.h&quot;
-#include &lt;stdio.h&gt;
-#include &lt;math.h&gt;
-
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;ADM_assert.h&gt;
-
-
-#include &quot;default.h&quot;
-
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_filter/video_filters.h&quot;
-#include &quot;ADM_userInterfaces/ADM_commonUI/DIA_enter.h&quot;
-#include &quot;ADM_video/ADM_cache.h&quot;
-
-#include &quot;admmangle.h&quot;
-#include &quot;ADM_osSupport/ADM_cpuCap.h&quot;
-#include &quot;ADM_vidEq2.h&quot;
-static FILTER_PARAM Eq2Param={8,{&quot;contrast&quot;,&quot;brightness&quot;,&quot;saturation&quot;,
-                                &quot;gamma&quot;,&quot;gamma_weight&quot;,&quot;rgamma&quot;,&quot;ggamma&quot;,&quot;bgamma&quot;}};
-
-/*=====================================*/
-/*=====================================*/
-class  ADMVideoEq2:public AVDMGenericVideoStream
-{
-
-  protected:
-    AVDMGenericVideoStream  *_in;           
-    virtual char            *printConf(void);
-            void            update(void);
-            Eq2_Param       *_param;    
-            VideoCache      *vidCache; 
-            float           _hue;
-            float           _saturation;
-            Eq2Settings     settings;            
-  public:
-                
-                        ADMVideoEq2(  AVDMGenericVideoStream *in,CONFcouple *setup);
-    virtual             ~ADMVideoEq2();
-    virtual uint8_t     configure(AVDMGenericVideoStream *in);
-    virtual uint8_t     getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-                                          ADMImage *data,uint32_t *flags);
-
-             uint8_t     getCoupledConf( CONFcouple **couples);
-}     ;
-
-SCRIPT_CREATE(Eq2_script,ADMVideoEq2,Eq2Param);
-BUILD_CREATE(Eq2_create,ADMVideoEq2);
-
-
-uint8_t ADMVideoEq2::configure(AVDMGenericVideoStream *in)
-{
-  uint8_t r=1;
-  float h,s;
-  _in=in;   
-  r=DIA_getEQ2Param(_param,in);
-  update();
-  return r;        
-}
-char *ADMVideoEq2::printConf( void )
-{
-  static char buf[50];
-        
-  sprintf((char *)buf,&quot; Eq2 :Cont:%1.2f Brigh:%1.2f Sat:%1.2f&quot;,
-                _param-&gt;contrast,_param-&gt;brightness,_param-&gt;saturation);
-  return buf;
-}
-
-ADMVideoEq2::ADMVideoEq2(  AVDMGenericVideoStream *in,CONFcouple *couples)
-{
-  
-  _in=in;         
-  memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));    
-  _info.encoding=1; 
-  _param=new  Eq2_Param;
-  if(couples)
-  {                 
-    GET(contrast); 
-    GET(brightness);    
-    GET(saturation); 
-    GET(gamma); 
-    GET(gamma_weight); 
-    GET(rgamma); 
-    GET(ggamma); 
-    GET(bgamma); 
-  }
-  else
-  {
-    _param-&gt;contrast =1.0;                
-    _param-&gt;brightness=0.0;
-    _param-&gt;saturation =1.0;  
-    _param-&gt;gamma =1.0; 
-    _param-&gt;gamma_weight=1.0; 
-    _param-&gt;rgamma =1.0; 
-    _param-&gt;ggamma =1.0; 
-    _param-&gt;bgamma =1.0;    
-  }      
-  vidCache=new VideoCache(1,_in);
-  update();
-    
-   
-}
-void ADMVideoEq2::update(void)
-{
-   update_lut(&amp;settings,_param);      
-}
-ADMVideoEq2::~ADMVideoEq2()
-{
-  delete _param;
-  delete vidCache;
-  
-}
-uint8_t ADMVideoEq2::getCoupledConf( CONFcouple **couples)
-{
-  ADM_assert(_param);
-  *couples=new CONFcouple(8);
-
-
-                CSET(contrast);
-                CSET(brightness);
-                CSET(saturation);
-                CSET(gamma); 
-                CSET(gamma_weight); 
-                CSET(rgamma); 
-                CSET(ggamma); 
-                CSET(bgamma); 
-                return 1;
-}
-
-
-uint8_t ADMVideoEq2::getFrameNumberNoAlloc(uint32_t frame,
-                                             uint32_t *len,
-                                             ADMImage *data,
-                                             uint32_t *flags)
-{
-  ADMImage *mysrc=NULL;
-  
-
-  if(frame&gt;=_info.nb_frames) return 0;
-  
-  mysrc=vidCache-&gt;getImage(frame);
-  if(!mysrc) return 0;
-  
-  uint32_t w,h;
-  w=_info.width;
-  h=_info.height;
-
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
-  if(CpuCaps::hasMMX())
-  {
-        affine_1d_MMX(&amp;(settings.param[0]),YPLANE(data),YPLANE(mysrc),w,h);
-        w&gt;&gt;=1;
-        h&gt;&gt;=1;
-        affine_1d_MMX(&amp;(settings.param[2]),UPLANE(data),UPLANE(mysrc),w,h);
-        affine_1d_MMX(&amp;(settings.param[1]),VPLANE(data),VPLANE(mysrc),w,h);       
-   }
-   else
-#endif
-   {
-        apply_lut(&amp;(settings.param[0]),YPLANE(data),YPLANE(mysrc),w,h);
-        w&gt;&gt;=1;
-        h&gt;&gt;=1;
-        apply_lut(&amp;(settings.param[2]),UPLANE(data),UPLANE(mysrc),w,h);
-        apply_lut(&amp;(settings.param[1]),VPLANE(data),VPLANE(mysrc),w,h);       
-    }
-  vidCache-&gt;unlockAll();
-  
-  
-  return 1;
-}
-
-void update_lut(Eq2Settings *settings,Eq2_Param *_param)
-{
-     memset(settings,0,sizeof(settings));
-
-    settings-&gt;param[0].lut_clean=0;
-    settings-&gt;param[1].lut_clean=0;
-    settings-&gt;param[2].lut_clean=0;
-    settings-&gt;contrast=_param-&gt;contrast;
-    settings-&gt;brightness=_param-&gt;brightness;
-    settings-&gt;saturation=_param-&gt;saturation;
-    
-    settings-&gt;ggamma=_param-&gt;ggamma;
-    settings-&gt;bgamma=_param-&gt;bgamma;
-    settings-&gt;rgamma=_param-&gt;rgamma;
-    settings-&gt;gamma=_param-&gt;gamma;
-
-    settings-&gt;gamma_weight=_param-&gt;gamma_weight;
-    
-    if(settings-&gt;ggamma&lt;0.1) settings-&gt;ggamma=0.1;
-    
-    settings-&gt;param[0].c=_param-&gt;contrast;  
-    settings-&gt;param[0].b=_param-&gt;brightness;;
-    settings-&gt;param[0].g=settings-&gt;gamma*settings-&gt;ggamma;
-    settings-&gt;param[0].w=settings-&gt;gamma_weight;
-    
-    
-    	
-    settings-&gt;param[1].c=_param-&gt;saturation;
-    settings-&gt;param[1].b=0;
-    settings-&gt;param[1].g=sqrt(settings-&gt;bgamma/settings-&gt;ggamma);
-    settings-&gt;param[1].w=settings-&gt;gamma_weight;
-    
-    settings-&gt;param[2].c=_param-&gt;saturation;
-    settings-&gt;param[2].b=0;
-    settings-&gt;param[2].g=sqrt(settings-&gt;rgamma/settings-&gt;ggamma);
-    settings-&gt;param[2].w=settings-&gt;gamma_weight;
-    
-    //printf(&quot;GGamma:%f\n&quot;,settings-&gt;ggamma);
-    create_lut(&amp;(settings-&gt;param[0]));
-    create_lut(&amp;(settings-&gt;param[1]));
-    create_lut(&amp;(settings-&gt;param[2])); 
-}          
-
-void create_lut (oneSetting *par)
-{
-  unsigned i;
-  double   g, v;
-  double   lw, gw;
-
-  g = par-&gt;g;
-  gw = par-&gt;w;
-  lw = 1.0 - gw;
-
-  if ((g &lt; 0.001) || (g &gt; 1000.0)) {
-    g = 1.0;
-  }
-
-  g = 1.0 / g;
-
-  for (i = 0; i &lt; 256; i++) {
-    v = (double) i / 255.0;
-    v = par-&gt;c * (v - 0.5) + 0.5 + par-&gt;b;
-
-    if (v &lt;= 0.0) {
-      par-&gt;lut[i] = 0;
-    }
-    else {
-      v = v*lw + pow(v, g)*gw;
-
-      if (v &gt;= 1.0) {
-        par-&gt;lut[i] = 255;
-      }
-      else {
-        par-&gt;lut[i] = (unsigned char) (256.0 * v);
-      }
-    }
-  }
-
-#ifdef LUT16
-  for(i=0; i&lt;256*256; i++){
-    par-&gt;lut16[i]= par-&gt;lut[i&amp;0xFF] + (par-&gt;lut[i&gt;&gt;8]&lt;&lt;8);
-  }
-#endif
-
-  par-&gt;lut_clean = 1;
-}
-
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
-
-void affine_1d_MMX (oneSetting *par, unsigned char *dst, unsigned char *src,
-  unsigned int w, unsigned int h)
-{
-  unsigned i;
-  int      contrast, brightness;
-  unsigned dstep, sstep,w3;
-  int      pel;
-  short    int brvec[4];
-  short    int contvec[4];
-  w3=w&gt;&gt;3;
-//  printf(&quot;\nmmx: src=%p dst=%p w=%d h=%d ds=%d ss=%d\n&quot;,src,dst,w,h,dstride,sstride);
-  if(par-&gt;g!=1.0) return apply_lut(par,dst,src,w,h);
-  //printf(&quot;MMX\n&quot;);
-  contrast = (int) (par-&gt;c * 256 * 16);
-  brightness = ((int) (100.0 * par-&gt;b + 100.0) * 511) / 200 - 128 - contrast / 32;
-
-  brvec[0] = brvec[1] = brvec[2] = brvec[3] = brightness;
-  contvec[0] = contvec[1] = contvec[2] = contvec[3] = contrast;
-
-  
-  asm volatile (
-        &quot;movq (%0), %%mm3 \n\t&quot;
-        &quot;movq (%1), %%mm4 \n\t&quot;
-        ::  &quot;r&quot; (brvec),&quot;r&quot; (contvec)
-        
-        );
-  while (h-- &gt; 0) {
-    asm volatile (
-      &quot;pxor %%mm0, %%mm0 \n\t&quot;
-      &quot;movl %4, %%eax\n\t&quot;
-      &quot;.p2align 4 \n\t&quot;
-      &quot;lop%=: \n\t&quot;
-      &quot;movq (%0), %%mm1 \n\t&quot;
-      &quot;movq (%0), %%mm2 \n\t&quot;
-      &quot;punpcklbw %%mm0, %%mm1 \n\t&quot;
-      &quot;punpckhbw %%mm0, %%mm2 \n\t&quot;
-      &quot;psllw $4, %%mm1 \n\t&quot;
-      &quot;psllw $4, %%mm2 \n\t&quot;
-      &quot;pmulhw %%mm4, %%mm1 \n\t&quot;
-      &quot;pmulhw %%mm4, %%mm2 \n\t&quot;
-      &quot;paddw %%mm3, %%mm1 \n\t&quot;
-      &quot;paddw %%mm3, %%mm2 \n\t&quot;
-      &quot;packuswb %%mm2, %%mm1 \n\t&quot;
-      &quot;add $8, %0 \n\t&quot;
-      &quot;movq %%mm1, (%1) \n\t&quot;
-      &quot;add $8, %1 \n\t&quot;
-      &quot;decl %%eax \n\t&quot;
-      &quot;jnz lop%= \n\t&quot;
-      : &quot;=r&quot; (src), &quot;=r&quot; (dst)
-      : &quot;0&quot; (src), &quot;1&quot; (dst), &quot;r&quot; (w3)
-      : &quot;%eax&quot;
-    );
-
-    for (i = w &amp; 7; i &gt; 0; i--) {
-      pel = ((*src++ * contrast) &gt;&gt; 12) + brightness;
-      if (pel &amp; 768) {
-        pel = (-pel) &gt;&gt; 31;
-      }
-      *dst++ = pel;
-    }
-
-  }
-
-  asm volatile ( &quot;emms \n\t&quot; ::: &quot;memory&quot; );
-}
-#endif
-
-void apply_lut (oneSetting *par, unsigned char *dst, unsigned char *src,
-  unsigned int w, unsigned int h)
-{           
-            
-    
-  unsigned int dstride,  sstride;
-  unsigned int i, j, w2;
-  unsigned char *lut;
-  uint16_t *lut16;
-
-   dstride=sstride=w;
-
-  lut = par-&gt;lut;
-#ifdef LUT16
-  lut16 = par-&gt;lut16;
-  w2= (w&gt;&gt;3)&lt;&lt;2;
-  for (j = 0; j &lt; h; j++) {
-    uint16_t *src16= (uint16_t*)src;
-    uint16_t *dst16= (uint16_t*)dst;
-    for (i = 0; i &lt; w2; i+=4) {
-      dst16[i+0] = lut16[src16[i+0]];
-      dst16[i+1] = lut16[src16[i+1]];
-      dst16[i+2] = lut16[src16[i+2]];
-      dst16[i+3] = lut16[src16[i+3]];
-    }
-    i &lt;&lt;= 1;
-#else
-  w2= (w&gt;&gt;3)&lt;&lt;3;
-  for (j = 0; j &lt; h; j++) {
-    for (i = 0; i &lt; w2; i+=8) {
-      dst[i+0] = lut[src[i+0]];
-      dst[i+1] = lut[src[i+1]];
-      dst[i+2] = lut[src[i+2]];
-      dst[i+3] = lut[src[i+3]];
-      dst[i+4] = lut[src[i+4]];
-      dst[i+5] = lut[src[i+5]];
-      dst[i+6] = lut[src[i+6]];
-      dst[i+7] = lut[src[i+7]];
-    }
-#endif
-    for (; i &lt; w; i++) {
-      dst[i] = lut[src[i]];
-    }
-
-    src += sstride;
-    dst += dstride;
-  }
-}  
-

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.h	2007-08-14 08:29:00 UTC (rev 3510)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.h	2007-08-14 08:34:12 UTC (rev 3511)
@@ -1,61 +0,0 @@
-
-#ifndef EQ2_PARAM
-#define EQ2_PARAM
-#define LUT16
-typedef struct Eq2_Param
-{
-  float     contrast ;      /* 1.0 means do nothing..*/    
-  float     brightness;     /* 0 means */
-  float     saturation;
-  
-  float     gamma;
-  float     gamma_weight;
-  float     rgamma;
-  float     ggamma;
-  float     bgamma;
-}Eq2_Param;
-//*************************
-
-
-typedef struct oneSetting {
-  unsigned char lut[256];
-#ifdef LUT16
-  uint16_t lut16[256*256];
-#endif
-  int           lut_clean;
-
-  double        c;
-  double        b;
-  double        g;
-  double        w;
-} oneSetting;
-typedef struct Eq2Settings {
-  oneSetting param[3];
-
-  double        contrast;
-  double        brightness;
-  double        saturation;
-
-  double        gamma;
-  double        gamma_weight;
-  double        rgamma;
-  double        ggamma;
-  double        bgamma;
-
- 
-} Eq2Settings;
-//*************************
-uint8_t DIA_getEQ2Param(Eq2_Param *param,AVDMGenericVideoStream *in);
-
-void update_lut(Eq2Settings *settings,Eq2_Param *_param);
-void apply_lut (oneSetting *par, unsigned char *dst, unsigned char *src,
-  unsigned int w, unsigned int h);
-void create_lut (oneSetting *par);
-
-#if (defined( ARCH_X86)  || defined(ARCH_X86_64))
-void affine_1d_MMX (oneSetting *par, unsigned char *dst, unsigned char *src,
-                unsigned int w, unsigned int h);
-#endif
-
-
-#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt	2007-08-14 08:29:00 UTC (rev 3510)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt	2007-08-14 08:34:12 UTC (rev 3511)
@@ -19,7 +19,6 @@
 ADM_vidDelta.cpp      
 ADM_vidMPdelogo.cpp      
 ADM_vobsubinfo.cpp
-ADM_vidEq2.cpp             
 ADM_vidClean.cpp        
 ADM_vidEqualizer.cpp  
 ADM_vidNull.cpp          

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-08-14 08:29:00 UTC (rev 3510)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-08-14 08:34:12 UTC (rev 3511)
@@ -26,7 +26,6 @@
  ADM_vidVobsub.cpp \
  ADM_vobsubinfo.cpp \
  ADM_vidVobSubRender.cpp \
- ADM_vidEq2.cpp \
  ADM_vidAsharp.cpp \
  ADM_vidCNR2.cpp \
   ADM_vidDelta.cpp \
@@ -47,8 +46,8 @@
 ADM_vidDelta.cpp  ADM_vidPartial_param.h \
 ADM_guiResize.cpp   ADM_vidRaw.cpp \
 ADM_interlaced.cpp  \
-ADM_interlaced.h ADM_vidEq2.cpp  ADM_vidResize.cpp \
-ADM_vidEq2.h  ADM_vidResize25.cpp \
+ADM_interlaced.h ADM_vidResize.cpp \
+ADM_vidResize25.cpp \
 ADM_vidEqualizer.cpp  \
 ADM_mpdetc.cpp ADM_vidEqualizer.h   \
 ADM_mpdetc.h  \
@@ -89,5 +88,4 @@
 			 $(FREETYPE_CFLAGS) $(ALTIVEC_SWITCH) -I../ADM_userInterfaces/ADM_commonUI -I../ADM_inputs
 noinst_HEADERS = ADM_mpdetc.h \
   ADM_cache.h \
-ADM_vidEqualizer.h ADM_vobsubinfo.h ADM_vidVobSub.h \
-ADM_vidEq2.h 
+ADM_vidEqualizer.h ADM_vobsubinfo.h ADM_vidVobSub.h 

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidEq2.cpp (from rev 3510, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.cpp)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidEq2.h (from rev 3497, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidEq2.h)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-08-14 08:29:00 UTC (rev 3510)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-08-14 08:34:12 UTC (rev 3511)
@@ -30,6 +30,7 @@
 ADM_vidSRTload.cpp
 ADM_vidSRTRender.cpp
 ADM_vidCrop.cpp       
+ADM_vidEq2.cpp       
 )
 ADD_LIBRARY(ADM_videoFilter STATIC ${ADM_videoFilter_SRCS})
 if(FT_FOUND)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-08-14 08:29:00 UTC (rev 3510)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-08-14 08:34:12 UTC (rev 3511)
@@ -68,6 +68,7 @@
  ADM_vidSRT.cpp \
  ADM_vidSRTload.cpp \
  ADM_vidSRTRender.cpp \
+ ADM_vidEq2.cpp \
  ADM_vidCrop.cpp       
 			
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000784.html">[Avidemux-svn-commit] r3510 - in	branches/avidemux_2.4_branch/avidemux: ADM_libraries/ADM_utilities	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI ADM_video
</A></li>
	<LI>Next message: <A HREF="000786.html">[Avidemux-svn-commit] r3512 -	branches/avidemux_2.4_branch/avidemux/ADM_video
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#785">[ date ]</a>
              <a href="thread.html#785">[ thread ]</a>
              <a href="subject.html#785">[ subject ]</a>
              <a href="author.html#785">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
