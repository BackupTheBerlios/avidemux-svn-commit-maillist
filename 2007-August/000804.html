<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3530 - in	branches/avidemux_2.4_branch/avidemux:	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-August/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3530%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09ADM_userInterfaces/ADM_commonUI%20ADM_video%20ADM_videoFilter&In-Reply-To=%3C200708181522.l7IFM5f0016659%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000803.html">
   <LINK REL="Next"  HREF="000805.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3530 - in	branches/avidemux_2.4_branch/avidemux:	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter</H1>
    <B>mean at BerliOS</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3530%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%0A%09ADM_userInterfaces/ADM_GTK/ADM_dialog%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialog%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialog%0A%09ADM_userInterfaces/ADM_commonUI%20ADM_video%20ADM_videoFilter&In-Reply-To=%3C200708181522.l7IFM5f0016659%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3530 - in	branches/avidemux_2.4_branch/avidemux:	ADM_userInterfaces/ADM_GTK/ADM_dialog	ADM_userInterfaces/ADM_NONE/ADM_dialog	ADM_userInterfaces/ADM_QT4/ADM_dialog	ADM_userInterfaces/ADM_commonUI ADM_video ADM_videoFilter">mean at mail.berlios.de
       </A><BR>
    <I>Sat Aug 18 17:22:05 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000803.html">[Avidemux-svn-commit] r3529 -	branches/avidemux_2.4_branch/avidemux/ADM_codecs
</A></li>
        <LI>Next message: <A HREF="000805.html">[Avidemux-svn-commit] r3531 - in	branches/avidemux_2.4_branch/avidemux: ADM_codecs ADM_colorspace
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#804">[ date ]</a>
              <a href="thread.html#804">[ thread ]</a>
              <a href="subject.html#804">[ subject ]</a>
              <a href="author.html#804">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mean
Date: 2007-08-18 17:22:04 +0200 (Sat, 18 Aug 2007)
New Revision: 3530

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidASharp_param.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidAsharp.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidContrast.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidContrast.h
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidDelta.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidUnblend.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidUnblend_param.h
Removed:
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASharp_param.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAsharp.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.h
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidDelta.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidUnblend.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidUnblend_param.h
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_asharp.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_contrast.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyAsharp.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyContrast.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavDecoder.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
Log:
[Filters] Move to proper place

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_asharp.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -36,7 +36,7 @@
 
 #include &quot;ADM_image.h&quot;
 #include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_video/ADM_vidASharp_param.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidASharp_param.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
 #include &quot;DIA_flyAsharp.h&quot;
 #include &quot;ADM_assert.h&quot;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialog/DIA_contrast.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -35,7 +35,7 @@
 
 #include &quot;ADM_editor/ADM_edit.hxx&quot;
 #include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_video/ADM_vidContrast.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidContrast.h&quot;
 #include &quot;ADM_toolkit/toolkit.hxx&quot;
 #include &quot;ADM_colorspace/ADM_rgb.h&quot;
 #include &quot;ADM_toolkit_gtk/ADM_gladeSupport.h&quot;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialog/DIA_none.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -34,7 +34,7 @@
 
 
 #include &quot;ADM_videoFilter/ADM_vidAnimated_param.h&quot;
-#include &quot;ADM_video/ADM_vidASharp_param.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidASharp_param.h&quot;
 #include &quot;ADM_audiofilter/audiofilter_normalize_param.h&quot;
 #include &quot;ADM_video/ADM_vidCNR2_param.h&quot;
 #include &quot;ADM_video/ADM_vidColorYuv_param.h&quot;
@@ -49,7 +49,7 @@
 #include &quot;ADM_videoFilter/ADM_vidChromaShift_param.h&quot;
 #include &quot;ADM_video/ADM_vidMPdelogo.h&quot;
 #include &quot;ADM_videoFilter/ADM_vidEq2.h&quot;
-#include &quot;ADM_video/ADM_vidContrast.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidContrast.h&quot;
 //#include &quot;ADM_video/ADM_vidFont.h&quot;
 class ADMfont;
 #include &quot;ADM_videoFilter/ADM_vidSRT.h&quot;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/DIA_none.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -34,7 +34,7 @@
 
 
 #include &quot;ADM_videoFilter/ADM_vidAnimated_param.h&quot;
-#include &quot;ADM_video/ADM_vidASharp_param.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidASharp_param.h&quot;
 #include &quot;ADM_audiofilter/audiofilter_normalize_param.h&quot;
 #include &quot;ADM_video/ADM_vidCNR2_param.h&quot;
 #include &quot;ADM_video/ADM_vidColorYuv_param.h&quot;
@@ -48,7 +48,7 @@
 #include &quot;ADM_video/ADM_vidVobSub.h&quot;
 #include &quot;ADM_videoFilter/ADM_vidChromaShift_param.h&quot;
 #include &quot;ADM_video/ADM_vidMPdelogo.h&quot;
-#include &quot;ADM_video/ADM_vidContrast.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidContrast.h&quot;
 //#include &quot;ADM_video/ADM_vidFont.h&quot;
 class ADMfont;
 #include &quot;ADM_videoFilter/ADM_vidSRT.h&quot;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_asharp.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_asharp.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_asharp.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -37,7 +37,7 @@
 #include &quot;ADM_assert.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
 #include &quot;DIA_flyDialogQt4.h&quot;
-#include &quot;ADM_video/ADM_vidASharp_param.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidASharp_param.h&quot;
 #include &quot;DIA_flyAsharp.h&quot;
 
 //

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_contrast.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_contrast.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialog/Q_contrast.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -37,7 +37,7 @@
 #include &quot;ADM_assert.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
 #include &quot;DIA_flyDialogQt4.h&quot;
-#include &quot;ADM_video/ADM_vidContrast.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidContrast.h&quot;
 #include &quot;DIA_flyContrast.h&quot;
 
 //

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyAsharp.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyAsharp.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyAsharp.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -32,7 +32,7 @@
 
 #include &quot;ADM_image.h&quot;
 #include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_video/ADM_vidASharp_param.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidASharp_param.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
 #include &quot;DIA_flyAsharp.h&quot;
 #include &quot;ADM_assert.h&quot;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyContrast.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyContrast.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyContrast.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -23,7 +23,7 @@
 
 #include &quot;ADM_image.h&quot;
 #include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_video/ADM_vidContrast.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidContrast.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
 #include &quot;DIA_flyContrast.h&quot;
 /************* COMMON PART *********************/

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_flyEq2.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -23,7 +23,7 @@
 
 #include &quot;ADM_image.h&quot;
 #include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_video/ADM_vidContrast.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidContrast.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
 #include &quot;DIA_flyEq2.h&quot;
 #include &quot;ADM_osSupport/ADM_cpuCap.h&quot;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavDecoder.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavDecoder.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_lavDecoder.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -23,7 +23,7 @@
 
 #include &quot;ADM_image.h&quot;
 #include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_video/ADM_vidASharp_param.h&quot;
+#include &quot;ADM_videoFilter/ADM_vidASharp_param.h&quot;
 #include &quot;DIA_flyDialog.h&quot;
 #include &quot;DIA_flyAsharp.h&quot;
 #include &quot;ADM_assert.h&quot;

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASharp_param.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASharp_param.h	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASharp_param.h	2007-08-18 15:22:04 UTC (rev 3530)
@@ -1,18 +0,0 @@
-
-#ifndef _ASHARP_PARAM
-#define _ASHARP_PARAM
-#define uc uint8_t
-#define bool uint8_t
-
- void asharp_run_c(      uc* planeptr, int pitch,
-                                        int height, int width, 
-                                        int     T,int D, int B, int B2, bool bf );
-
-typedef struct ASHARP_PARAM
-{
-        double          t; // Threshold 0:nothing max : 5 ?
-        double          d; // Strength : 0 means nothing, &gt;0  adaptative t is maximum
-        double          b; // Block adaptative sharpening -1 disabled
-        uint32_t        bf;
-}ASHARP_PARAM;
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAsharp.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAsharp.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAsharp.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -1,299 +0,0 @@
-/**/
-/***************************************************************************
-                          ADM_vidASharp  -  description
-                             -------------------   
-    Port of avisynth one
-
- ***************************************************************************/
-/*
-        
-        Copyright (C) 2003 Donald A. Graft
-        Copyright (C) 2002 Marc Fauconneau
-        This program is free software; you can redistribute it and/or modify
-        it under the terms of the GNU General Public License as published by
-        the Free Software Foundation.
-
-        This program is distributed in the hope that it will be useful,
-        but WITHOUT ANY WARRANTY; without even the implied warranty of
-        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-        GNU General Public License for more details.
-
-        You should have received a copy of the GNU General Public License
-        along with this program; if not, write to the Free Software
-        Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
-*/
-
-#include &quot;config.h&quot;
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;ADM_assert.h&gt;
-
-#include &quot;config.h&quot;
-#include &quot;fourcc.h&quot;
-#include &quot;avio.hxx&quot;
-#include &quot;avi_vars.h&quot;
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include&quot;ADM_video/ADM_cache.h&quot;
-
-#include &quot;ADM_osSupport/ADM_debugID.h&quot;
-#define MODULE_NAME MODULE_FILTER
-#include &quot;ADM_osSupport/ADM_debug.h&quot;
-
-#include &quot;ADM_osSupport/ADM_cpuCap.h&quot;
-#include &quot;ADM_filter/video_filters.h&quot;
-
-#include &quot;ADM_vidASharp_param.h&quot;
-class ASharp : public AVDMGenericVideoStream
-{
-private:
-        
-        VideoCache      *vidCache;
-        ASHARP_PARAM    *_param;
-        int32_t        T,D,B,B2;
-        
-public:    
-
-                        ASharp(AVDMGenericVideoStream *in,CONFcouple *couples)   ;
-                        ~ASharp();
-
-
-                        void update(void);         
-        char            *printConf( void );
-        uint8_t         configure(AVDMGenericVideoStream *in);
-        uint8_t         getCoupledConf( CONFcouple **couples);
-        uint8_t         getFrameNumberNoAlloc(uint32_t frame, uint32_t *len, ADMImage *data,uint32_t *flags);
-};
-
-BUILD_CREATE(asharp_create,ASharp);
-static FILTER_PARAM asharp_param={4,{&quot;t&quot;, &quot;b&quot;,&quot;d&quot;, &quot;bf&quot;}};
-
-
-SCRIPT_CREATE(asharp_script,ASharp,asharp_param);
-//_______________________________________________
-
-ASharp::ASharp(AVDMGenericVideoStream *in,CONFcouple *couples)
-
-{
-        _in=in;         
-        memcpy(&amp;_info,_in-&gt;getInfo(),sizeof(_info));    
-        _info.encoding=1;
-        _uncompressed=NULL;             
-        _info.encoding=1;
-
-
-        _param=new ASHARP_PARAM;
-       
-        if(couples)
-                {
-                     GET(t);
-                     GET(d);
-                     GET(b);
-                     GET(bf); 
-                }
-                else // Default
-                {
-                        _param-&gt;t=2;
-                        _param-&gt;d=4;
-                        _param-&gt;b=-1;
-                        _param-&gt;bf=0;
-                }                              
-                update();
-                vidCache=new VideoCache(5,in);
-}
-//________________________________________________________
-void ASharp::update( void)
-{
-                // parameters floating point to fixed point convertion
-                T = (int)(_param-&gt;t*(4&lt;&lt;7));
-                D = (int)(_param-&gt;d*(4&lt;&lt;7));
-                B = (int)(256-_param-&gt;b*64);
-                B2= (int)(256-_param-&gt;b*48);
-
-                // clipping (recommended for SIMD code)
-
-                if (T&lt;-(4&lt;&lt;7)) T = -(4&lt;&lt;7); // yes, negatives values are accepted
-                if (D&lt;0) D = 0;
-                if (B&lt;0) B = 0;
-                if (B2&lt;0) B2 = 0;
-
-                if (T&gt;(32*(4&lt;&lt;7))) T = (32*(4&lt;&lt;7));
-                if (D&gt;(16*(4&lt;&lt;7))) D = (16*(4&lt;&lt;7));
-                if (B&gt;256) B = 256;
-                if (B2&gt;256) B2 = 256;
-
-}
-//________________________________________________________
-uint8_t ASharp::getCoupledConf( CONFcouple **couples)
-{
-        *couples=NULL;
-        *couples=new CONFcouple(4);
-#define CSET(x)  (*couples)-&gt;setCouple((char *)#x,(_param-&gt;x))
-               CSET(t);
-               CSET(d);
-               CSET(b);
-               CSET(bf);    
-        return 1;
-}
-//________________________________________________________
-ASharp::~ASharp(void)
-{
-
-        if(vidCache) delete vidCache;     
-
-     
-        vidCache=NULL;
-
-}
-
-extern uint8_t DIA_getASharp(ASHARP_PARAM *param, AVDMGenericVideoStream *in);
-//________________________________________________________
-uint8_t ASharp::configure(AVDMGenericVideoStream *in)
-{
-uint8_t r=0;
-        _in=in;
-        if( DIA_getASharp(_param, _in))
-        {
-                r=1;
-        }
-        update();
-        return r;
-}
-
-//________________________________________________________
-char *ASharp::printConf( void )
-{
-        static char buf[50];
-
-        ADM_assert(_param);
-        sprintf((char *)buf,&quot; ASharp (MarcFD)&quot;);
-        return buf;
-}
-        
-//________________________________________________________
-uint8_t ASharp::getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-                                ADMImage *data,uint32_t *flags)
-{
-ADMImage *src;
-ADMImage *dst;
-
-        dst=data;
-        if(frame&gt;=_info.nb_frames) return 0;
-        src=vidCache-&gt;getImage(frame);
-        dst-&gt;duplicate(src);
-        asharp_run_c(     dst-&gt;GetWritePtr(PLANAR_Y),
-                        dst-&gt;GetPitch(PLANAR_Y), 
-                        _info.height,
-                        _info.width,
-                        T,
-                        D,
-                        B,
-                        B2,
-                        _param-&gt;bf);
-
-        vidCache-&gt;unlockAll();
-
-        return 1;
-}
-
-
-
-
-void asharp_run_c(      uc* planeptr, int pitch,
-                                        int height, int width, 
-                                        int     T,int D, int B, int B2, bool bf )
-        {
-                uc* lineptr = new uc[width];
-                int p = pitch;
-                int y,x;
-                uc* cfp = planeptr+pitch;
-                uc* lp = lineptr;
-                memcpy(lp,planeptr,width);
-                for (y=1;y&lt;height-1;y++) {
-                        int last = cfp[0];
-                        for (x=0;x&lt;width-1;x++) {
-
-                                int avg = 0;
-                                int dev = 0;
-                                int T2;
-                                int diff;
-                                int tmp;
-
-                                avg += lp[x-1];
-                                avg += lp[x  ];
-                                avg += lp[x+1];
-                                avg += last;
-                                avg += cfp[x    ];
-                                avg += cfp[x  +1];
-                                avg += cfp[x+p-1];
-                                avg += cfp[x+p  ];
-                                avg += cfp[x+p+1];
-
-                                avg *= (65535/9);
-                                avg &gt;&gt;= 16;
-
-                                #define CHECK(A) \
-                                if (abs(A-cfp[x])&gt;dev) dev = abs(A-cfp[x]);
-                                
-                                if (bf) {
-
-                                if (y%8&gt;0) {
-                                        if (x%8&gt;0) CHECK(lp[x-1])
-                                        CHECK(lp[x  ])
-                                        if (x%8&lt;7) CHECK(lp[x+1])
-                                }
-                                if (x%8&gt;0) CHECK(last)
-                                if (x%8&lt;7) CHECK(cfp[x  +1])
-                                if (y%8&lt;7) {
-                                        if (x%8&gt;0) CHECK(cfp[x+p-1])
-                                        CHECK(cfp[x+p  ])
-                                        if (x%8&lt;7) CHECK(cfp[x+p+1])
-                                }
-
-                                } else {
-                                        CHECK(lp[x-p-1])
-                                        CHECK(lp[x-p  ])
-                                        CHECK(lp[x-p+1])
-                                        CHECK(last)
-                                        CHECK(cfp[x  +1])
-                                        CHECK(cfp[x+p-1])
-                                        CHECK(cfp[x+p  ])
-                                        CHECK(cfp[x+p+1])
-                                }
-
-                                T2 = T;
-                                diff = cfp[x]-avg;
-                                int D2 = D;
-
-                                if (x%8==6) D2=(D2*B2)&gt;&gt;8;
-                                if (x%8==7) D2=(D2*B)&gt;&gt;8;
-                                if (x%8==0) D2=(D2*B)&gt;&gt;8;
-                                if (x%8==1) D2=(D2*B2)&gt;&gt;8;
-                                if (y%8==6) D2=(D2*B2)&gt;&gt;8;
-                                if (y%8==7) D2=(D2*B)&gt;&gt;8;
-                                if (y%8==0) D2=(D2*B)&gt;&gt;8;
-                                if (y%8==1) D2=(D2*B2)&gt;&gt;8;
-
-                                int Da = -32+(D&gt;&gt;7);
-                                if (D&gt;0) T2 = ((((dev&lt;&lt;7)*D2)&gt;&gt;16)+Da)&lt;&lt;4;
-
-                                if (T2&gt;T) T2=T;
-                                if (T2&lt;-32) T2=-32;
-
-                                tmp = (((diff&lt;&lt;7)*T2)&gt;&gt;16)+cfp[x];
-
-                                if (tmp &lt; 0) tmp = 0;
-                                if (tmp &gt; 255) tmp = 255;
-                                lp[x-1] = last;
-                                last = cfp[x];
-                                cfp[x] = tmp;
-                        }
-                        lp[x] = cfp[x];
-                        cfp += pitch;
-                }
-        delete[] lineptr;
-} 
-//**********************************

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -1,243 +0,0 @@
-/***************************************************************************
-                          ADM_vidContrast.cpp  -  description
-                             -------------------
-    begin                : Sun Sep 22 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;ADM_assert.h&gt;
-#include &lt;math.h&gt;
-
-#include &quot;config.h&quot;
-#include &quot;fourcc.h&quot;
-#include &quot;avio.hxx&quot;
-#include &quot;config.h&quot;
-#include &quot;avi_vars.h&quot;
-
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-#include &quot;ADM_video/ADM_vidContrast.h&quot;
-#include &quot;ADM_filter/video_filters.h&quot;
-
-
-
-static FILTER_PARAM contrastParam =
-  { 5, {&quot;offset&quot;, &quot;coef&quot;, &quot;doLuma&quot;, &quot;doChromaU&quot;, &quot;doChromaV&quot;} };
-
-
-SCRIPT_CREATE (contrast_script, ADMVideoContrast, contrastParam);
-
-BUILD_CREATE (contrast_create, ADMVideoContrast);
-
-char *
-ADMVideoContrast::printConf (void)
-{
-  static char buf[50];
-
-  ADM_assert (_param);
-  sprintf ((char *) buf, &quot; contrast : %1.2f %d&quot;, _param-&gt;coef,
-	   _param-&gt;offset);
-  return buf;
-}
-
-//_______________________________________________________________
-
-ADMVideoContrast::ADMVideoContrast (AVDMGenericVideoStream * in,
-				    CONFcouple * couples)
-{
-
-
-  _in = in;
-  memcpy (&amp;_info, _in-&gt;getInfo (), sizeof (_info));
-  _info.encoding = 1;
-  //   _uncompressed=new uint8_t [3*_in-&gt;getInfo()-&gt;width*_in-&gt;getInfo()-&gt;height];
-  _uncompressed =
-    new ADMImage (_in-&gt;getInfo ()-&gt;width, _in-&gt;getInfo ()-&gt;height);
-  ADM_assert (_uncompressed);
-  _param = NULL;
-  if (couples)
-    {
-      _param = NEW (CONTRAST_PARAM);
-      GET (offset);
-      GET (coef);
-      GET (doLuma);
-      GET (doChromaU);
-      GET (doChromaV);
-    }
-  else
-    {
-      _param = NEW (CONTRAST_PARAM);
-      _param-&gt;offset = 0;
-      _param-&gt;coef = 1.0f;
-      _param-&gt;doLuma = 1;
-      _param-&gt;doChromaU = 1;
-      _param-&gt;doChromaV = 1;
-
-    }
-  buildContrastTable (_param-&gt;coef, _param-&gt;offset, _tableFlat, _tableNZ);
-
-
-}
-
-
-uint8_t ADMVideoContrast::getCoupledConf (CONFcouple ** couples)
-{
-
-  ADM_assert (_param);
-  *couples = new CONFcouple (5);
-
-#define CSET(x)  (*couples)-&gt;setCouple((char *)#x,(_param-&gt;x))
-  CSET (offset);
-  CSET (coef);
-  CSET (doLuma);
-  CSET (doChromaU);
-  CSET (doChromaV);
-  return 1;
-
-}
-ADMVideoContrast::~ADMVideoContrast ()
-{
-  if (_uncompressed)
-    delete _uncompressed;
-  _uncompressed = 0;
-  DELETE (_param);
-}
-
-//
-//      Remove y and v just keep U and expand it
-//
-uint8_t
-  ADMVideoContrast::getFrameNumberNoAlloc (uint32_t frame,
-					   uint32_t * len,
-					   ADMImage * data, uint32_t * flags)
-{
-  //uint32_t x,w;
-
-  ADM_assert (_param);
- if(frame&gt;= _info.nb_frames) return 0;
-
-
-  if (!_in-&gt;getFrameNumberNoAlloc (frame, len, _uncompressed, flags))
-    return 0;
-  *len = _info.width * _info.height + (_info.width * _info.height &gt;&gt; 1);
-
-  uint32_t sz = _info.width * _info.height;
-  // luma 
-  if (_param-&gt;doLuma)
-    {
-      if (!doContrast (_uncompressed-&gt;data, data-&gt;data, _tableFlat,
-		       _info.width, _info.height))
-	return 0;
-    }
-  else
-    {
-      memcpy (data-&gt;data, _uncompressed-&gt;data, sz);
-    }
-  // ______u_____________         
-
-  if (_param-&gt;doChromaU)
-    {
-      if (!doContrast (_uncompressed-&gt;data + sz, data-&gt;data + sz, _tableNZ,
-		       _info.width &gt;&gt; 1, _info.height &gt;&gt; 1))
-	return 0;
-    }
-  else
-    {
-      memcpy (data-&gt;data + sz, _uncompressed-&gt;data + sz, sz &gt;&gt; 2);
-    }
-
-  // ______v_____________         
-  if (_param-&gt;doChromaV)
-    {
-
-      if (!doContrast
-	  (_uncompressed-&gt;data + sz + (sz &gt;&gt; 2), data-&gt;data + sz + (sz &gt;&gt; 2),
-	   _tableNZ, _info.width &gt;&gt; 1, _info.height &gt;&gt; 1))
-	return 0;
-    }
-  else
-    {
-      memcpy (data-&gt;data + sz + (sz &gt;&gt; 2),
-	      _uncompressed-&gt;data + sz + (sz &gt;&gt; 2), sz &gt;&gt; 2);
-    }
-
-
-
-
-  return 1;
-}
-
-uint8_t
-buildContrastTable (float coef, int8_t off,
-		    uint8_t * tableFlat, uint8_t * tableNZ)
-{
-  float f;
-
-  for (uint32_t i = 0; i &lt; 256; i++)
-    {
-      f = i;
-      f *= coef;
-//                                      f= (f-128)*coef+128;
-      f += off;
-      if (f &lt; 0.)
-	f = 0.;
-      if (f &gt; 255.)
-	f = 255.;
-      *(tableFlat + i) = (uint8_t) floor (f);
-
-      f = i;
-      f -= 128;
-      f *= coef;
-//                                      f= (f-128)*coef+128;
-
-//                                      f+=off;
-      if (f &lt; -127.)
-	f = -127.;
-      if (f &gt; 127.)
-	f = 127.;
-      f += 128.;
-      *(tableNZ + i) = (uint8_t) floor (f);
-    }
-  return 0;
-}
-
-uint8_t
-doContrast (uint8_t * in, uint8_t * out, uint8_t * table,
-	    uint32_t w, uint32_t h)
-{
-
-  for (uint32_t y = h * w; y &gt; 0; y--)
-    {
-      *out++ = table[*in++];
-    }
-
-  return 1;
-
-}
-uint8_t DIA_contrast(AVDMGenericVideoStream *astream,CONTRAST_PARAM *param);
-uint8_t
-ADMVideoContrast::configure (AVDMGenericVideoStream * instream)
-{
-  if(DIA_contrast(_in,_param))
-  {
-    buildContrastTable (_param-&gt;coef, _param-&gt;offset, _tableFlat, _tableNZ);
-    return 1;
-  }
-  return 0;
-}
-
-// EOF

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.h	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.h	2007-08-18 15:22:04 UTC (rev 3530)
@@ -1,57 +0,0 @@
-/***************************************************************************
-                          ADM_vidContrast.h  -  description
-                             -------------------
-    begin                : Sun Sep 22 2002
-    copyright            : (C) 2002 by mean
-    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-#ifndef _CONTRAST_
-#define _CONTRAST_
-
-typedef struct 
-{
-		float 	coef;
-		int32_t  offset;
-		uint32_t	doLuma;
-		uint32_t	doChromaU;
-		uint32_t	doChromaV;
-		
-	
-	}CONTRAST_PARAM;
-	
-  uint8_t buildContrastTable( float coef,int8_t off,	
-  								uint8_t *tableFlat,uint8_t *tableNZ);
-  uint8_t doContrast(uint8_t *in,uint8_t *out,uint8_t *table,
-												uint32_t w,uint32_t h);
-
-
- class  ADMVideoContrast:public AVDMGenericVideoStream
- {
-
- protected:
-				virtual char 					*printConf(void);
-				CONTRAST_PARAM					*_param;
-				uint8_t						_tableFlat[256];
-				uint8_t						_tableNZ[256];
-
- public:
-
-					ADMVideoContrast(  AVDMGenericVideoStream *in,CONFcouple *setup);
-  					virtual ~ADMVideoContrast();
-		          virtual uint8_t getFrameNumberNoAlloc(uint32_t frame, uint32_t *len,
-          																	ADMImage *data,uint32_t *flags);
-					virtual uint8_t 	configure( AVDMGenericVideoStream *instream) ;
-
- 					virtual uint8_t	getCoupledConf( CONFcouple **couples);
- 				
- }     ;
-#endif

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidDelta.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidDelta.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidDelta.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -1,152 +0,0 @@
-//
-//      Try to detect blended image
-//      Mean (C) 2005
-//      GPL v2.0
-//
-
-
-#include &quot;config.h&quot;
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;ADM_assert.h&gt;
-
-#include &quot;config.h&quot;
-#include &quot;fourcc.h&quot;
-#include &quot;avio.hxx&quot;
-#include &quot;avi_vars.h&quot;
-#include &quot;math.h&quot;
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-
-#include &quot;ADM_osSupport/ADM_debugID.h&quot;
-#define MODULE_NAME MODULE_FILTER
-#include &quot;ADM_osSupport/ADM_debug.h&quot;
-#include &quot;ADM_video/ADM_cache.h&quot;
-#include &quot;ADM_filter/video_filters.h&quot;
-
-#include &quot;ADM_vidCNR2_param.h&quot;
-
-//#define SUBST 1
-
-class vidDelta:public AVDMGenericVideoStream
-{
-
-protected:
-  virtual char *printConf (void);
-  VideoCache *vidCache;
-
-
-public:
-
-                        vidDelta (AVDMGenericVideoStream * in, CONFcouple * setup);
-        virtual         ~vidDelta ();
-  virtual uint8_t getFrameNumberNoAlloc (uint32_t frame, uint32_t * len,
-					 ADMImage * data, uint32_t * flags);
-  uint8_t configure (AVDMGenericVideoStream * instream);
-  virtual uint8_t getCoupledConf (CONFcouple ** couples);
-
-};
-
-static FILTER_PARAM delta_template =
-  { 0 };
-
-BUILD_CREATE (delta_create, vidDelta);
-SCRIPT_CREATE (delta_script, vidDelta, delta_template);
-
-
-/*************************************/
-uint8_t vidDelta::configure (AVDMGenericVideoStream * in)
-{
-        return 1;
-}
-/*************************************/
-char *vidDelta::printConf (void)
-{
-  static char buf[50];
-  sprintf ((char *) buf, &quot; Delta&quot;);
-  return buf;
-}
-/*************************************/
-vidDelta::vidDelta (AVDMGenericVideoStream * in, CONFcouple * couples)
-{
-
-  _in = in;
-  memcpy (&amp;_info, _in-&gt;getInfo (), sizeof (_info));
-  _info.encoding = 1;
-  vidCache = new VideoCache (4, in);
-  
-  
-}
-//____________________________________________________________________
-vidDelta::~vidDelta ()
-{
-
-  delete vidCache;
-  vidCache = NULL;
-
-}
-
-//______________________________________________________________
-uint8_t vidDelta::getFrameNumberNoAlloc (uint32_t frame,
-				uint32_t * len,
-				ADMImage * data, uint32_t * flags)
-{
-int w,h,page;
-ADMImage *cur,*prev,*next;
-        w=_info.width;
-        h=_info.height;
-        page=w*h;
-  if(frame&gt;= _info.nb_frames) return 0;
-  if(!frame || frame&gt;=_info.nb_frames-1)
-  {
-        memset(YPLANE(data),0,page);
-        memset(UPLANE(data),128,page&gt;&gt;2);
-        memset(VPLANE(data),128,page&gt;&gt;2);
-        return 1;
-  }
-  cur=vidCache-&gt;getImage (frame);
-  prev=vidCache-&gt;getImage (frame-1);
-  next=vidCache-&gt;getImage (frame+1);
-  // No chroma
-        memset(UPLANE(data),128,page&gt;&gt;2);
-        memset(VPLANE(data),128,page&gt;&gt;2);
-
-   uint8_t *c=YPLANE(cur);
-   uint8_t *p=YPLANE(prev);
-   uint8_t *n=YPLANE(next);
-   uint8_t *out=YPLANE(data);
-#define SAME_THRESH 32
-   int a,b,d,cp,cn,e;
-   for(int y=0;y&lt;h;y++)
-        for(int x=0;x&lt;w;x++)
-        {
-                a=*c++;
-                b=*p++;
-                e=*n++;
-                cp=abs(a-b);
-                cn=abs(a-e);
-                // Cp is the != between current and previous
-                // cn is the != between current and next
-                // We try to spo frames that are blended betwwen next &amp; previous
-                
-                if(cp&gt;SAME_THRESH &amp;&amp; cn &gt; SAME_THRESH &amp;&amp; abs(cp-cn) &lt; 128) *out++=255;//(cp+cn)/2;
-                        else *out++=0;
-        }
-
-
-  vidCache-&gt;unlockAll ();
-  return 1;
-}
-
-/*************************************/
-uint8_t vidDelta::getCoupledConf (CONFcouple ** couples)
-{
-
-  *couples=NULL;
-  return 1;
-}
-
-// EOF

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidUnblend.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidUnblend.cpp	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidUnblend.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -1,330 +0,0 @@
-// Port of Bach unblend avisynth filter
-//
-//      Copyright by Bach, D Graft, Ernst Pech&#65533;
-//      Probably GPL
-//
-//
-#include &quot;config.h&quot;
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-#include &lt;ADM_assert.h&gt;
-
-#include &quot;config.h&quot;
-#include &quot;fourcc.h&quot;
-#include &quot;avio.hxx&quot;
-#include &quot;avi_vars.h&quot;
-#include &quot;math.h&quot;
-
-#include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &quot;ADM_editor/ADM_edit.hxx&quot;
-#include &quot;ADM_video/ADM_genvideo.hxx&quot;
-
-#include &quot;ADM_osSupport/ADM_debugID.h&quot;
-#define MODULE_NAME MODULE_FILTER
-#include &quot;ADM_osSupport/ADM_debug.h&quot;
-#include &quot;ADM_video/ADM_cache.h&quot;
-#include &quot;ADM_filter/video_filters.h&quot;
-#include &quot;ADM_vidUnblend_param.h&quot;
-
-class vidUnblend:public AVDMGenericVideoStream
-{
-
-protected:
-  virtual char *printConf (void);
-  VideoCache *vidCache;
-  PARAM_UNBLEND *_param;
-
-  void DrawShow(ADMImage *src, int useframe, int blend, int inframe, int threshold, float dthresh);
-  void Findblend(int frame, int *bblend);
-  int  firsttime;
-  int  reference;
-  unsigned int *sum;
-
-  
-public:
-
-                        vidUnblend (AVDMGenericVideoStream * in, CONFcouple * setup);
-        virtual         ~vidUnblend ();
-  virtual uint8_t getFrameNumberNoAlloc (uint32_t frame, uint32_t * len,
-                                         ADMImage * data, uint32_t * flags);
-  uint8_t configure (AVDMGenericVideoStream * instream);
-  virtual uint8_t getCoupledConf (CONFcouple ** couples);
-
-};
-
-static FILTER_PARAM unblend_template =
-  { 3,&quot;show&quot;,&quot;threshold&quot;,&quot;dthresh&quot; };
-
-BUILD_CREATE (unblend_create, vidUnblend);
-SCRIPT_CREATE (unblend_script, vidUnblend, unblend_template);
-//*************************************
-uint8_t vidUnblend::configure (AVDMGenericVideoStream * in)
-{
-       
-        return 0;
-}
-/*************************************/
-char *vidUnblend::printConf (void)
-{
-  static char buf[50];
-  sprintf ((char *) buf, &quot; Unblend by Bach&quot;);
-  return buf;
-}
-uint8_t vidUnblend::getCoupledConf (CONFcouple ** couples)
-{
-
-  ADM_assert (_param);
-  *couples = new CONFcouple (3);
-#undef CSET
-#define CSET(x)  (*couples)-&gt;setCouple(#x,(_param-&gt;x))
-
-  CSET (show);
-  CSET (threshold);
-  CSET (dthresh);
-  return 1;
-}
-
-#define MAX_BLOCKS 50
-/*************************************/
-vidUnblend::vidUnblend (AVDMGenericVideoStream * in, CONFcouple * couples)
-{
-
-  _in = in;
-  memcpy (&amp;_info, _in-&gt;getInfo (), sizeof (_info));
-  _info.encoding = 1;
-  vidCache = new VideoCache (10, in);
-  _param=new PARAM_UNBLEND;
-  if(couples)
-  {
-#undef GET
-#define GET(x) couples-&gt;getCouple(#x,&amp;(_param-&gt;x))
-      GET (show);
-      GET (threshold);
-      GET (dthresh);
-
-  }
-  else
-  {
-                _param-&gt;show=1;
-                _param-&gt;threshold=5;
-                _param-&gt;dthresh=3./100.;
-
-  }
-  firsttime=true;
-  sum=new unsigned int[MAX_BLOCKS * MAX_BLOCKS];
-  reference=0;
-  DrawShow(NULL,0,0,0,_param-&gt;threshold,_param-&gt;dthresh);
-  
-}
-//____________________________________________________________________
-vidUnblend::~vidUnblend ()
-{
-
-  delete vidCache;
-  vidCache = NULL;
-  delete _param;
-  _param=NULL;
-  delete [] sum;
-  sum=NULL;
-
-}
-
-
-#define DrawString(x,y,z,t) printf(&quot;Unblend :%s\n&quot;,t);
-#define GETFRAME(useframe, src) src=vidCache-&gt;getImage(useframe)
-void vidUnblend::DrawShow(ADMImage *src, int useframe, int blend, int inframe, int threshold, float dthresh)
-{
-	char buf[80];
-
-	if (_param-&gt;show == true)
-	{
-		sprintf(buf, &quot;unblend %s&quot;, 0);
-		DrawString(src, 0, 0, buf);
-		sprintf(buf, &quot;Copyright 2003 Bach, based on source by D.Graft and Ernst Pech&quot;);
-		DrawString(src, 0, 1, buf);
-		sprintf(buf,&quot;Using frm %d, instead of frm %d&quot;, useframe, useframe-blend);
-		DrawString(src, 0, 2, buf);
-		sprintf(buf,&quot;the diff threshold is %d&quot;, threshold);
-		DrawString(src, 0, 4, buf);	
-		sprintf(buf,&quot;the noise threshold is  %f&quot;, dthresh);
-		DrawString(src, 0, 5, buf);	
-	}
-}
-
-uint8_t vidUnblend::getFrameNumberNoAlloc (uint32_t inframe,
-                                uint32_t * len,
-                                ADMImage * data, uint32_t * flags)
-{
-
-	int blend=0, useframe;
-	ADMImage *src;
-	char buf[255];
-        if(inframe&gt;= _info.nb_frames) return 0;
-        if(!inframe || inframe&gt;_info.nb_frames-5)
-        {
-                data-&gt;duplicate(vidCache-&gt;getImage(inframe));
-                vidCache-&gt;unlockAll();
-                return 1;
-        }
-
-	useframe = inframe;
-	Findblend(useframe, &amp;blend);
-	//useframe++; ?????
-	switch(blend)
-		{
-		case (-1):
-			useframe--;
-			break;
-		case 1:
-			useframe++;
-			break;
-		default:
-			break;
-		}
-	        
-	   	
-
-                if (_param-&gt;show == true)
-		{
-/*
-                sprintf(buf, &quot;unblend %s&quot;, VERSION);
-		DrawString(src, 0, 0, buf);
-		sprintf(buf, &quot;Copyright 2003 Bach, based on source by D.Graft and Ernst Pech&#65533;);
-		DrawString(src, 0, 1, buf);
-*/
-		sprintf(buf,&quot;Using frm %d, instead of frm %d\n*****************&quot;, useframe, useframe-blend);
-		DrawString(src, 0, 2, buf);
-/*
-		sprintf(buf,&quot;the diff threshold is %d&quot;, _param-&gt;threshold);
-		DrawString(src, 0, 4, buf);	
-		sprintf(buf,&quot;the noise threshold is  %f&quot;, _param-&gt;dthresh);
-		DrawString(src, 0, 5, buf);		
-*/
-		}
-        src=vidCache-&gt;getImage(useframe);
-        data-&gt;duplicate(src);
-        vidCache-&gt;unlockAll();
-	return 1;
-}
-
-void  vidUnblend::Findblend(int frame, int *bblend)
-
-{
-	int f, x, y,pitchY,row_sizeY,heightY;
-	ADMImage *store[5];
-	const unsigned char *storepY[5];
-	float t;
-	float metric02, metric13, metric24;
-	int metric_count02, metric_count13, metric_count24;
-	int count02, count13, count24;
-	float p0, p1, p2, p3, p4;
-	float percent02, percent13, percent24;
-        int vi_height=_info.height;
-        int vi_width=_info.width;
-		
-	if (firsttime == true || frame == 0)
-	{
-		firsttime=false;
-		reference=0;
-	}
-
-	for (f = 0; f &lt;= 4; f++)
-	{
-		GETFRAME(frame + f - 1, store[f]);
-		storepY[f] = store[f]-&gt;data; //store[f]-&gt;GetReadPtr(PLANAR_Y);
-	}
-
-    pitchY = _info.width;    //store[0]-&gt;GetPitch(PLANAR_Y);
-    row_sizeY = _info.width; //store[0]-&gt;GetRowSize(PLANAR_Y);
-    heightY = _info.height;  //store[0]-&gt;GetHeight(PLANAR_Y);
-		
-	metric_count02=1;
-	metric02=0;
-	metric_count13=1;
-	metric13=0;
-	metric_count24=1;
-	metric24=0;
-	count02=0;
-	count13=0;
-	count24=0;
-
-	for ( y=0; y&lt;vi_height-1; y=y+2) 
-	{
-	    for ( x=0; x&lt;row_sizeY-1; x=x+2) {
-			
-			p0 = (float)(storepY[0][x] + storepY[0][x+pitchY])/2;
-			p1 = (float)(storepY[1][x] + storepY[1][x+pitchY])/2;
-			p2 = (float)(storepY[2][x] + storepY[2][x+pitchY])/2;
-			p3 = (float)(storepY[3][x] + storepY[3][x+pitchY])/2;
-			p4 = (float)(storepY[4][x] + storepY[4][x+pitchY])/2;
-			
-			t=1000;
-			if (fabs(p1- p3)&gt;_param-&gt;threshold ) {
-				t = 255 * (p2 - p1)/(p3 - p1);	// tmax = +-255/1   tmin = +-1/255
-				if (t&gt;32 &amp;&amp; t&lt;224) {
-					count13++;
-					metric_count13++;
-					metric13 = metric13 + t;
-				} else {
-					count13--;
-				}
-			}
-
-			// prev frame
-			if (fabs(p0 - p2)&gt;_param-&gt;threshold ) {
-				t = 255 * (p1 - p0)/(p2 - p0);
-				if (t&gt;32 &amp;&amp; t&lt;224) {
-					count02++;
-					metric02 = metric02 + t;
-					metric_count02++;
-				} else {
-					count02--;
-				}
-			}
-			// next frame
-			if (fabs(p2 - p4)&gt;_param-&gt;threshold ) {
-				t = 255 * (p3 - p2)/(p4 - p2);
-				if (t&gt;32 &amp;&amp; t&lt;224) {
-					count24++;
-					metric24 = metric24 + t;
-					metric_count24++;
-				} else {
-					count24--;
-				}
-			}
-		}
-
-		storepY[0] += 2 * pitchY;
-		storepY[1] += 2 * pitchY;
-		storepY[2] += 2 * pitchY;
-		storepY[3] += 2 * pitchY;
-		storepY[4] += 2 * pitchY;
-	}
-
-	metric02 = metric02 / metric_count02;
-	metric13 = metric13 / metric_count13;
-	metric24 = metric24 / metric_count24;
-
-	percent02 = (float)200 * count02 / (vi_height * vi_width);
-	percent13 = (float)200 * count13 / (vi_height * vi_width);
-	percent24 = (float)200 * count24 / (vi_height * vi_width);
-
-        if(_param-&gt;show)
-        {
-                printf(&quot;PC02:%f PC13:%f PC24:%f\n&quot;,percent02,percent13,percent24);
-                printf(&quot;Metric13:%f \n&quot;,metric13);
-        }
-
-	if (percent13&gt;_param-&gt;dthresh &amp;&amp; (percent02&lt;_param-&gt;dthresh ) &amp;&amp; (percent24&lt;_param-&gt;dthresh )) 
-	{
-                if(_param-&gt;show) printf(&quot;BLENDED\n&quot;);
-		if (metric13&lt;128 &amp;&amp; metric13&gt;32) reference=(-1);
-		else if(metric13&gt;128 &amp;&amp; metric13&lt;224) reference=1;
-	}
-	else reference=0;
-	
-	*bblend = reference;
-	
-}
-//EOF

Deleted: branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidUnblend_param.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidUnblend_param.h	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidUnblend_param.h	2007-08-18 15:22:04 UTC (rev 3530)
@@ -1,26 +0,0 @@
-/***************************************************************************
-        See avisynth unblend
- ***************************************************************************/
-
-/***************************************************************************
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- ***************************************************************************/
-
-#ifndef UNBLEND_PARAM_H
-#define UNBLEND_PARAM_H
-
-typedef struct PARAM_UNBLEND
-{
-        uint32_t show;
-        uint32_t threshold;
-        float    dthresh;
-
-}PARAM_UNBLEND;
-
-
-#endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/CMakeLists.txt	2007-08-18 15:22:04 UTC (rev 3530)
@@ -7,16 +7,12 @@
 ADM_vidColorYuv.cpp   
 ADM_vidFieldUtil.cpp     
 ADM_vidRaw.cpp        
-ADM_vidUnblend.cpp
 ADM_genvideo.cpp         
-ADM_vidContrast.cpp   
 ADM_vidFont.cpp
 ADM_vidVobsub.cpp
-ADM_vidAsharp.cpp       
 ADM_vidVobSubRender.cpp
 ADM_interlaced.cpp       
 ADM_vidCached.cpp       
-ADM_vidDelta.cpp      
 ADM_vidMPdelogo.cpp      
 ADM_vobsubinfo.cpp
 ADM_vidClean.cpp        

Modified: branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_video/Makefile.am	2007-08-18 15:22:04 UTC (rev 3530)
@@ -10,7 +10,6 @@
  ADM_vidCached.cpp \
  ADM_vidPartial.cpp \
  ADM_vidFont.cpp \
- ADM_vidContrast.cpp \
  ADM_vidNull.cpp \
 	ADM_vidClean.cpp \
  ADM_genvideo.cpp \
@@ -26,10 +25,7 @@
  ADM_vidVobsub.cpp \
  ADM_vobsubinfo.cpp \
  ADM_vidVobSubRender.cpp \
- ADM_vidAsharp.cpp \
  ADM_vidCNR2.cpp \
-  ADM_vidDelta.cpp \
- ADM_vidUnblend.cpp \
  ADM_vidMPdelogo.cpp \
  ADM_vidColorYuv.cpp  
 
@@ -43,7 +39,7 @@
 ADM_genvideo.cpp \
 ADM_genvideo.hxx ADM_vidPartial.cpp \
 ADM_vidPartial.h \
-ADM_vidDelta.cpp  ADM_vidPartial_param.h \
+ADM_vidPartial_param.h \
 ADM_guiResize.cpp   ADM_vidRaw.cpp \
 ADM_interlaced.cpp  \
 ADM_interlaced.h ADM_vidResize.cpp \
@@ -55,12 +51,11 @@
 ADM_resizebis.hxx    \
 ADM_resizeter.cpp  ADM_vidField.h  \
 ADM_vidFieldUnblend.cpp \
-ADM_vidASharp_param.h  ADM_vidFieldUtil.cpp  \
+ADM_vidFieldUtil.cpp  \
 ADM_vidFieldUtil.h  \
 ADM_vidAnimated.cpp  \
 ADM_vidAnimated.h  \
 ADM_vidAnimated_param.h   \
-ADM_vidAsharp.cpp   \
 ADM_vidFont.cpp \
 ADM_vidFont.h \
 ADM_vidCNR2.cpp  \
@@ -69,15 +64,15 @@
 ADM_vidCached.h  ADM_vidIVTC.cpp \
 ADM_vidIVTC.h \
 ADM_vidChromaShift.cpp \
-ADM_vidChromaShift.h ADM_vidUnblend.cpp \
-ADM_vidClean.cpp ADM_vidUnblend_param.h \
+ADM_vidChromaShift.h  \
+ADM_vidClean.cpp  \
 ADM_vidClean.h \
 ADM_vidColorYuv.cpp  \
 ADM_vidColorYuv.h  ADM_vidVobSub.h \
 ADM_vidColorYuv_param.h  ADM_vidVobSubRender.cpp \
 ADM_vidCommonFilter.h  ADM_vidMPLResize.cpp  ADM_vidVobsub.cpp \
-ADM_vidContrast.cpp  ADM_vidMPdelogo.cpp \
-ADM_vidContrast.h  ADM_vidMPdelogo.h \
+ADM_vidMPdelogo.cpp \
+ADM_vidMPdelogo.h \
 ADM_vobsubinfo.cpp \
 ADM_vobsubinfo.h \
 swscale_internal.h \

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidASharp_param.h (from rev 3527, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidASharp_param.h)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidAsharp.cpp (from rev 3527, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidAsharp.cpp)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidContrast.cpp (from rev 3527, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.cpp	2007-08-17 18:44:58 UTC (rev 3527)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidContrast.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -0,0 +1,243 @@
+/***************************************************************************
+                          ADM_vidContrast.cpp  -  description
+                             -------------------
+    begin                : Sun Sep 22 2002
+    copyright            : (C) 2002 by mean
+    email                : <A HREF="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">fixounet at free.fr</A>
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;ADM_assert.h&gt;
+#include &lt;math.h&gt;
+
+#include &quot;config.h&quot;
+#include &quot;fourcc.h&quot;
+#include &quot;avio.hxx&quot;
+#include &quot;config.h&quot;
+#include &quot;avi_vars.h&quot;
+
+
+#include &quot;ADM_toolkit/toolkit.hxx&quot;
+#include &quot;ADM_editor/ADM_edit.hxx&quot;
+#include &quot;ADM_video/ADM_genvideo.hxx&quot;
+#include &quot;ADM_videoFilter/ADM_vidContrast.h&quot;
+#include &quot;ADM_filter/video_filters.h&quot;
+
+
+
+static FILTER_PARAM contrastParam =
+  { 5, {&quot;offset&quot;, &quot;coef&quot;, &quot;doLuma&quot;, &quot;doChromaU&quot;, &quot;doChromaV&quot;} };
+
+
+SCRIPT_CREATE (contrast_script, ADMVideoContrast, contrastParam);
+
+BUILD_CREATE (contrast_create, ADMVideoContrast);
+
+char *
+ADMVideoContrast::printConf (void)
+{
+  static char buf[50];
+
+  ADM_assert (_param);
+  sprintf ((char *) buf, &quot; contrast : %1.2f %d&quot;, _param-&gt;coef,
+	   _param-&gt;offset);
+  return buf;
+}
+
+//_______________________________________________________________
+
+ADMVideoContrast::ADMVideoContrast (AVDMGenericVideoStream * in,
+				    CONFcouple * couples)
+{
+
+
+  _in = in;
+  memcpy (&amp;_info, _in-&gt;getInfo (), sizeof (_info));
+  _info.encoding = 1;
+  //   _uncompressed=new uint8_t [3*_in-&gt;getInfo()-&gt;width*_in-&gt;getInfo()-&gt;height];
+  _uncompressed =
+    new ADMImage (_in-&gt;getInfo ()-&gt;width, _in-&gt;getInfo ()-&gt;height);
+  ADM_assert (_uncompressed);
+  _param = NULL;
+  if (couples)
+    {
+      _param = NEW (CONTRAST_PARAM);
+      GET (offset);
+      GET (coef);
+      GET (doLuma);
+      GET (doChromaU);
+      GET (doChromaV);
+    }
+  else
+    {
+      _param = NEW (CONTRAST_PARAM);
+      _param-&gt;offset = 0;
+      _param-&gt;coef = 1.0f;
+      _param-&gt;doLuma = 1;
+      _param-&gt;doChromaU = 1;
+      _param-&gt;doChromaV = 1;
+
+    }
+  buildContrastTable (_param-&gt;coef, _param-&gt;offset, _tableFlat, _tableNZ);
+
+
+}
+
+
+uint8_t ADMVideoContrast::getCoupledConf (CONFcouple ** couples)
+{
+
+  ADM_assert (_param);
+  *couples = new CONFcouple (5);
+
+#define CSET(x)  (*couples)-&gt;setCouple((char *)#x,(_param-&gt;x))
+  CSET (offset);
+  CSET (coef);
+  CSET (doLuma);
+  CSET (doChromaU);
+  CSET (doChromaV);
+  return 1;
+
+}
+ADMVideoContrast::~ADMVideoContrast ()
+{
+  if (_uncompressed)
+    delete _uncompressed;
+  _uncompressed = 0;
+  DELETE (_param);
+}
+
+//
+//      Remove y and v just keep U and expand it
+//
+uint8_t
+  ADMVideoContrast::getFrameNumberNoAlloc (uint32_t frame,
+					   uint32_t * len,
+					   ADMImage * data, uint32_t * flags)
+{
+  //uint32_t x,w;
+
+  ADM_assert (_param);
+ if(frame&gt;= _info.nb_frames) return 0;
+
+
+  if (!_in-&gt;getFrameNumberNoAlloc (frame, len, _uncompressed, flags))
+    return 0;
+  *len = _info.width * _info.height + (_info.width * _info.height &gt;&gt; 1);
+
+  uint32_t sz = _info.width * _info.height;
+  // luma 
+  if (_param-&gt;doLuma)
+    {
+      if (!doContrast (_uncompressed-&gt;data, data-&gt;data, _tableFlat,
+		       _info.width, _info.height))
+	return 0;
+    }
+  else
+    {
+      memcpy (data-&gt;data, _uncompressed-&gt;data, sz);
+    }
+  // ______u_____________         
+
+  if (_param-&gt;doChromaU)
+    {
+      if (!doContrast (_uncompressed-&gt;data + sz, data-&gt;data + sz, _tableNZ,
+		       _info.width &gt;&gt; 1, _info.height &gt;&gt; 1))
+	return 0;
+    }
+  else
+    {
+      memcpy (data-&gt;data + sz, _uncompressed-&gt;data + sz, sz &gt;&gt; 2);
+    }
+
+  // ______v_____________         
+  if (_param-&gt;doChromaV)
+    {
+
+      if (!doContrast
+	  (_uncompressed-&gt;data + sz + (sz &gt;&gt; 2), data-&gt;data + sz + (sz &gt;&gt; 2),
+	   _tableNZ, _info.width &gt;&gt; 1, _info.height &gt;&gt; 1))
+	return 0;
+    }
+  else
+    {
+      memcpy (data-&gt;data + sz + (sz &gt;&gt; 2),
+	      _uncompressed-&gt;data + sz + (sz &gt;&gt; 2), sz &gt;&gt; 2);
+    }
+
+
+
+
+  return 1;
+}
+
+uint8_t
+buildContrastTable (float coef, int8_t off,
+		    uint8_t * tableFlat, uint8_t * tableNZ)
+{
+  float f;
+
+  for (uint32_t i = 0; i &lt; 256; i++)
+    {
+      f = i;
+      f *= coef;
+//                                      f= (f-128)*coef+128;
+      f += off;
+      if (f &lt; 0.)
+	f = 0.;
+      if (f &gt; 255.)
+	f = 255.;
+      *(tableFlat + i) = (uint8_t) floor (f);
+
+      f = i;
+      f -= 128;
+      f *= coef;
+//                                      f= (f-128)*coef+128;
+
+//                                      f+=off;
+      if (f &lt; -127.)
+	f = -127.;
+      if (f &gt; 127.)
+	f = 127.;
+      f += 128.;
+      *(tableNZ + i) = (uint8_t) floor (f);
+    }
+  return 0;
+}
+
+uint8_t
+doContrast (uint8_t * in, uint8_t * out, uint8_t * table,
+	    uint32_t w, uint32_t h)
+{
+
+  for (uint32_t y = h * w; y &gt; 0; y--)
+    {
+      *out++ = table[*in++];
+    }
+
+  return 1;
+
+}
+uint8_t DIA_contrast(AVDMGenericVideoStream *astream,CONTRAST_PARAM *param);
+uint8_t
+ADMVideoContrast::configure (AVDMGenericVideoStream * instream)
+{
+  if(DIA_contrast(_in,_param))
+  {
+    buildContrastTable (_param-&gt;coef, _param-&gt;offset, _tableFlat, _tableNZ);
+    return 1;
+  }
+  return 0;
+}
+
+// EOF

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidContrast.h (from rev 3527, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidContrast.h)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidDelta.cpp (from rev 3527, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidDelta.cpp)
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidDelta.cpp	2007-08-17 18:44:58 UTC (rev 3527)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidDelta.cpp	2007-08-18 15:22:04 UTC (rev 3530)
@@ -0,0 +1,152 @@
+//
+//      Try to detect blended image
+//      Mean (C) 2005
+//      GPL v2.0
+//
+
+
+#include &quot;config.h&quot;
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;ADM_assert.h&gt;
+
+#include &quot;config.h&quot;
+#include &quot;fourcc.h&quot;
+#include &quot;avio.hxx&quot;
+#include &quot;avi_vars.h&quot;
+#include &quot;math.h&quot;
+
+#include &quot;ADM_toolkit/toolkit.hxx&quot;
+#include &quot;ADM_editor/ADM_edit.hxx&quot;
+#include &quot;ADM_video/ADM_genvideo.hxx&quot;
+
+#include &quot;ADM_osSupport/ADM_debugID.h&quot;
+#define MODULE_NAME MODULE_FILTER
+#include &quot;ADM_osSupport/ADM_debug.h&quot;
+#include &quot;ADM_video/ADM_cache.h&quot;
+#include &quot;ADM_filter/video_filters.h&quot;
+
+//#include &quot;ADM_vidCNR2_param.h&quot;
+
+//#define SUBST 1
+
+class vidDelta:public AVDMGenericVideoStream
+{
+
+protected:
+  virtual char *printConf (void);
+  VideoCache *vidCache;
+
+
+public:
+
+                        vidDelta (AVDMGenericVideoStream * in, CONFcouple * setup);
+        virtual         ~vidDelta ();
+  virtual uint8_t getFrameNumberNoAlloc (uint32_t frame, uint32_t * len,
+					 ADMImage * data, uint32_t * flags);
+  uint8_t configure (AVDMGenericVideoStream * instream);
+  virtual uint8_t getCoupledConf (CONFcouple ** couples);
+
+};
+
+static FILTER_PARAM delta_template =
+  { 0 };
+
+BUILD_CREATE (delta_create, vidDelta);
+SCRIPT_CREATE (delta_script, vidDelta, delta_template);
+
+
+/*************************************/
+uint8_t vidDelta::configure (AVDMGenericVideoStream * in)
+{
+        return 1;
+}
+/*************************************/
+char *vidDelta::printConf (void)
+{
+  static char buf[50];
+  sprintf ((char *) buf, &quot; Delta&quot;);
+  return buf;
+}
+/*************************************/
+vidDelta::vidDelta (AVDMGenericVideoStream * in, CONFcouple * couples)
+{
+
+  _in = in;
+  memcpy (&amp;_info, _in-&gt;getInfo (), sizeof (_info));
+  _info.encoding = 1;
+  vidCache = new VideoCache (4, in);
+  
+  
+}
+//____________________________________________________________________
+vidDelta::~vidDelta ()
+{
+
+  delete vidCache;
+  vidCache = NULL;
+
+}
+
+//______________________________________________________________
+uint8_t vidDelta::getFrameNumberNoAlloc (uint32_t frame,
+				uint32_t * len,
+				ADMImage * data, uint32_t * flags)
+{
+int w,h,page;
+ADMImage *cur,*prev,*next;
+        w=_info.width;
+        h=_info.height;
+        page=w*h;
+  if(frame&gt;= _info.nb_frames) return 0;
+  if(!frame || frame&gt;=_info.nb_frames-1)
+  {
+        memset(YPLANE(data),0,page);
+        memset(UPLANE(data),128,page&gt;&gt;2);
+        memset(VPLANE(data),128,page&gt;&gt;2);
+        return 1;
+  }
+  cur=vidCache-&gt;getImage (frame);
+  prev=vidCache-&gt;getImage (frame-1);
+  next=vidCache-&gt;getImage (frame+1);
+  // No chroma
+        memset(UPLANE(data),128,page&gt;&gt;2);
+        memset(VPLANE(data),128,page&gt;&gt;2);
+
+   uint8_t *c=YPLANE(cur);
+   uint8_t *p=YPLANE(prev);
+   uint8_t *n=YPLANE(next);
+   uint8_t *out=YPLANE(data);
+#define SAME_THRESH 32
+   int a,b,d,cp,cn,e;
+   for(int y=0;y&lt;h;y++)
+        for(int x=0;x&lt;w;x++)
+        {
+                a=*c++;
+                b=*p++;
+                e=*n++;
+                cp=abs(a-b);
+                cn=abs(a-e);
+                // Cp is the != between current and previous
+                // cn is the != between current and next
+                // We try to spo frames that are blended betwwen next &amp; previous
+                
+                if(cp&gt;SAME_THRESH &amp;&amp; cn &gt; SAME_THRESH &amp;&amp; abs(cp-cn) &lt; 128) *out++=255;//(cp+cn)/2;
+                        else *out++=0;
+        }
+
+
+  vidCache-&gt;unlockAll ();
+  return 1;
+}
+
+/*************************************/
+uint8_t vidDelta::getCoupledConf (CONFcouple ** couples)
+{
+
+  *couples=NULL;
+  return 1;
+}
+
+// EOF

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidUnblend.cpp (from rev 3527, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidUnblend.cpp)

Copied: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/ADM_vidUnblend_param.h (from rev 3527, branches/avidemux_2.4_branch/avidemux/ADM_video/ADM_vidUnblend_param.h)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/CMakeLists.txt	2007-08-18 15:22:04 UTC (rev 3530)
@@ -30,7 +30,11 @@
 ADM_vidSRTload.cpp
 ADM_vidSRTRender.cpp
 ADM_vidCrop.cpp       
-ADM_vidEq2.cpp       
+ADM_vidEq2.cpp      
+ADM_vidContrast.cpp 
+ADM_vidDelta.cpp 
+ADM_vidUnblend.cpp 
+ADM_vidAsharp.cpp
 )
 ADD_LIBRARY(ADM_videoFilter STATIC ${ADM_videoFilter_SRCS})
 if(FT_FOUND)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-08-18 15:21:27 UTC (rev 3529)
+++ branches/avidemux_2.4_branch/avidemux/ADM_videoFilter/Makefile.am	2007-08-18 15:22:04 UTC (rev 3530)
@@ -69,6 +69,10 @@
  ADM_vidSRTload.cpp \
  ADM_vidSRTRender.cpp \
  ADM_vidEq2.cpp \
+ ADM_vidAsharp.cpp \
+ ADM_vidContrast.cpp \
+ ADM_vidDelta.cpp  \
+ ADM_vidUnblend.cpp        \
  ADM_vidCrop.cpp       
 			
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000803.html">[Avidemux-svn-commit] r3529 -	branches/avidemux_2.4_branch/avidemux/ADM_codecs
</A></li>
	<LI>Next message: <A HREF="000805.html">[Avidemux-svn-commit] r3531 - in	branches/avidemux_2.4_branch/avidemux: ADM_codecs ADM_colorspace
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#804">[ date ]</a>
              <a href="thread.html#804">[ thread ]</a>
              <a href="subject.html#804">[ subject ]</a>
              <a href="author.html#804">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
