<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3518 - in	branches/avidemux_2.4_branch/avidemux: . ADM_audiodevice	ADM_codecs ADM_encoder ADM_libraries/ADM_utilities	ADM_osSupport ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	ADM_userInterfaces/ADM_commonUI
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-August/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3518%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20.%20ADM_audiodevice%0A%09ADM_codecs%20ADM_encoder%20ADM_libraries/ADM_utilities%0A%09ADM_osSupport%20ADM_userInterfaces/ADM_GTK/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_commonUI&In-Reply-To=%3C200708161723.l7GHNVD9032383%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000791.html">
   <LINK REL="Next"  HREF="000793.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3518 - in	branches/avidemux_2.4_branch/avidemux: . ADM_audiodevice	ADM_codecs ADM_encoder ADM_libraries/ADM_utilities	ADM_osSupport ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	ADM_userInterfaces/ADM_commonUI</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3518%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20.%20ADM_audiodevice%0A%09ADM_codecs%20ADM_encoder%20ADM_libraries/ADM_utilities%0A%09ADM_osSupport%20ADM_userInterfaces/ADM_GTK/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_NONE/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_QT4/ADM_dialogFactory%0A%09ADM_userInterfaces/ADM_commonUI&In-Reply-To=%3C200708161723.l7GHNVD9032383%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3518 - in	branches/avidemux_2.4_branch/avidemux: . ADM_audiodevice	ADM_codecs ADM_encoder ADM_libraries/ADM_utilities	ADM_osSupport ADM_userInterfaces/ADM_GTK/ADM_dialogFactory	ADM_userInterfaces/ADM_NONE/ADM_dialogFactory	ADM_userInterfaces/ADM_QT4/ADM_dialogFactory	ADM_userInterfaces/ADM_commonUI">gruntster at mail.berlios.de
       </A><BR>
    <I>Thu Aug 16 19:23:31 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000791.html">[Avidemux-svn-commit] r3517 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_libraries/ADM_lavcodec/i386 ADM_libraries/ADM_libMpeg2Dec	ADM_libraries/ADM_utilities ADM_osSupport	ADM_userInterfaces/ADM_commonUI
</A></li>
        <LI>Next message: <A HREF="000793.html">[Avidemux-svn-commit] r3519 -	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#792">[ date ]</a>
              <a href="thread.html#792">[ thread ]</a>
              <a href="subject.html#792">[ subject ]</a>
              <a href="author.html#792">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2007-08-16 19:22:50 +0200 (Thu, 16 Aug 2007)
New Revision: 3518

Added:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_threadCount.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_threadCount.cpp
Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_audiodevice/ADM_audiodevice.h
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_xvid4.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encXvid4.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encx264.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/prefs.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/CMakeLists.txt
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
   branches/avidemux_2.4_branch/avidemux/prefs.h
   branches/avidemux_2.4_branch/avidemux/prefs.in
Log:
[Codec] new auto-detect threads option for all MT codecs + permit more than 4 threads + MT can now be disabled for x264

Modified: branches/avidemux_2.4_branch/avidemux/ADM_audiodevice/ADM_audiodevice.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_audiodevice/ADM_audiodevice.h	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_audiodevice/ADM_audiodevice.h	2007-08-16 17:22:50 UTC (rev 3518)
@@ -12,7 +12,7 @@
 #ifndef ADM_AUDIODEVICE_H
 #define ADM_AUDIODEVICE_H
 
-#include &lt;ADM_assert.h&gt;
+#include &quot;ADM_assert.h&quot;
 
 void dither16(float *start, uint32_t nb, uint8_t channels);
 
@@ -34,7 +34,7 @@
 		  public:
                                         dummyAudioDevice(void) {};
                         virtual uint8_t init(uint8_t channels, uint32_t fq)
-                                {printf(&quot;\n Null audio device&quot;); UNUSED_ARG(fq); UNUSED_ARG(channels); return 1;}
+                                {printf(&quot;Null audio device\n&quot;); UNUSED_ARG(fq); UNUSED_ARG(channels); return 1;}
                         virtual uint8_t play(uint32_t len, float *data)
                                 {UNUSED_ARG(len); UNUSED_ARG(data); return 1;}
                         virtual uint8_t stop(void) {return 1;}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmp43.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -22,28 +22,20 @@
 #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
-#include &lt;math.h&gt;
+#include &lt;pthread.h&gt;
 
-
-#include &lt;ADM_assert.h&gt;
-
+#include &quot;ADM_assert.h&quot;
+#include &quot;prefs.h&quot;
 #include &quot;ADM_lavcodec.h&quot;
 #include &quot;ADM_utilities/default.h&quot;
 
-#include &quot;ADM_colorspace/colorspace.h&quot;
-
 #include &quot;ADM_codecs/ADM_codec.h&quot;
-
 #include &quot;ADM_codecs/ADM_ffmp43.h&quot;
-//#include &quot;ADM_gui/GUI_MPP.h&quot;
-
 #include &quot;ADM_toolkit/toolkit.hxx&quot;
 
 #include &quot;ADM_osSupport/ADM_debugID.h&quot;
 #define MODULE_NAME  MODULE_CODEC
 #include &quot;ADM_osSupport/ADM_debug.h&quot;
-#include &quot;ADM_osSupport/ADM_cpuCap.h&quot;
-
 #include &quot;ADM_video/ADM_videoInfoExtractor.h&quot;
 //****************************
 #define WRAP_Open(x) \
@@ -55,13 +47,13 @@
   _context-&gt;error_concealment=3; \
   if (avcodec_open(_context, codec) &lt; 0)  \
                       { \
-                                        printf(&quot; Decoder init: Lavcodec :&quot;#x&quot; video decoder failed!\n&quot;); \
+                                        printf(&quot;[lavc] Decoder init: &quot;#x&quot; video decoder failed!\n&quot;); \
                                         GUI_Alert(&quot;Internal error opening &quot;#x); \
                                         ADM_assert(0); \
                                 } \
                                 else \
                                 { \
-                                        printf(&quot; Decoder init: lavcodec &quot;#x&quot; video decoder initialized!\n&quot;); \
+                                        printf(&quot;[lavc] Decoder init: &quot;#x&quot; video decoder initialized!\n&quot;); \
                                 } \
 }
 //****************************
@@ -116,19 +108,25 @@
 void
 decoderFF::decoderMultiThread (void)
 {
-  uint32_t nbThread = 0;
+  uint32_t threads = 0;
 
-  nbThread = ADM_useNbThreads ();
-  if (nbThread)
-    {
-      printf (&quot;[codec]Enabling MT decoder with %u threads\n&quot;, nbThread);
-      if (0 &gt; avcodec_thread_init (_context, nbThread))
-	{
-	  printf (&quot;[codec]Failed!!\n&quot;);
-	  return;
-	}
-      _usingMT = 1;
-    }
+  prefs-&gt;get(FEATURE_THREADING_LAVC, &amp;threads);
+
+  if (threads == 0)
+	  threads = pthread_num_processors_np();
+
+  if (threads == 1)
+	  threads = 0;
+
+  if (threads)
+  {
+      printf (&quot;[lavc] Enabling MT decoder with %u threads\n&quot;, threads);
+
+      if (avcodec_thread_init (_context, threads) == -1)
+	      printf (&quot;[lavc] Failed!!\n&quot;);
+	  else
+          _usingMT = 1;
+  }
 }
 uint8_t decoderFF::getPARWidth (void)
 {
@@ -218,7 +216,7 @@
   _showMv = 0;
 #define FF_SHOW		(FF_DEBUG_VIS_MV_P_FOR+	FF_DEBUG_VIS_MV_B_FOR+FF_DEBUG_VIS_MV_B_BACK)
 //#define FF_SHOW               (FF_DEBUG_VIS_MV_P_FOR)
-  printf (&quot;FFMpeg build : %d\n&quot;, LIBAVCODEC_BUILD);
+  printf (&quot;[lavc] Build: %d\n&quot;, LIBAVCODEC_BUILD);
   _context-&gt;debug_mv |= FF_SHOW;
   _context-&gt;debug |= FF_DEBUG_VIS_MB_TYPE + FF_DEBUG_VIS_QP;
 }
@@ -229,7 +227,7 @@
 {
   if (_usingMT)
     {
-      printf (&quot;[decoder] Killing decoding threads\n&quot;);
+      printf (&quot;[lavc] Killing decoding threads\n&quot;);
       avcodec_thread_free (_context);
       _usingMT = 0;
     }
@@ -237,7 +235,7 @@
   avcodec_close (_context);
   ADM_dealloc (_context);
   delete[]_internalBuffer;
-  printf (&quot;FF base destroyed\n&quot;);
+  printf (&quot;[lavc] Destroyed\n&quot;);
 }
 
 //-------------------------------
@@ -248,7 +246,7 @@
 
   AVFrame *
     target;
-#define SET(x) {flag=x;aprintf(&quot; Frame is %s\n&quot;,#x);}
+#define SET(x) {flag=x;aprintf(&quot;Frame is %s\n&quot;,#x);}
 
 
   target = &amp;_frame;
@@ -257,7 +255,7 @@
     case FF_B_TYPE:
       SET (AVI_B_FRAME);
       if (target-&gt;key_frame)
-	aprintf (&quot;\n But keyframe is  set\n&quot;);
+	aprintf (&quot;\n But keyframe is set\n&quot;);
       break;
 
     case FF_I_TYPE:
@@ -277,7 +275,7 @@
     case FF_P_TYPE:
       SET (AVI_P_FRAME);
       if (target-&gt;key_frame)
-	aprintf (&quot;\n But keyframe is  set\n&quot;);
+	aprintf (&quot;\n But keyframe is set\n&quot;);
       break;
     default:
 //                              printf(&quot;\n OOops XXX frame ?\n&quot;);
@@ -291,13 +289,13 @@
     _context-&gt;hurry_up = 4;
   else
     _context-&gt;hurry_up = 5;
-  printf (&quot;\n FFmpeg: Hurry up\n&quot;);
+  printf (&quot;\n[lavc] Hurry up\n&quot;);
   return 1;
 }
 uint8_t decoderFF::decodeFull (void)
 {
   _context-&gt;hurry_up = 0;
-  printf (&quot;\n FFmpeg: full decoding\n&quot;);
+  printf (&quot;\n[lavc] full decoding\n&quot;);
   return 1;
 }
 
@@ -326,7 +324,7 @@
   if (in-&gt;dataLength == 0 &amp;&amp; !_allowNull)	// Null frame, silently skipped
     {
       
-      printf (&quot;\n ff4: null frame\n&quot;);
+      printf (&quot;\n[lavc] null frame\n&quot;);
       {
 	// search the last image
 	if (_context-&gt;coded_frame &amp;&amp; _context-&gt;coded_frame-&gt;data)
@@ -345,8 +343,8 @@
   out-&gt;_qStride = 0;		//Default = no quant
   if (0 &gt; ret &amp;&amp; !_context-&gt;hurry_up)
     {
-      printf (&quot;\n error in FFMP43/mpeg4!\n&quot;);
-      printf (&quot;Err: %d, size :%d\n&quot;, ret, in-&gt;dataLength);
+      printf (&quot;\n[lavc] error in FFMP43/mpeg4!\n&quot;);
+      printf (&quot;[lavc] Err: %d, size :%d\n&quot;, ret, in-&gt;dataLength);
       return 0;
     }
   if (!got_picture &amp;&amp; !_context-&gt;hurry_up)
@@ -356,7 +354,7 @@
       // it is meant to mean frame skipped but very dubious
       if (in-&gt;dataLength &lt;= 8 &amp;&amp; codecId == CODEC_ID_MPEG4)
 	{
-	  printf (&quot;Probably pseudo black frame...\n&quot;);
+	  printf (&quot;[lavc] Probably pseudo black frame...\n&quot;);
 	  out-&gt;_Qp = 2;
 	  out-&gt;flags = 0;	// assume P ?
 
@@ -378,12 +376,12 @@
 	    {
 	      out-&gt;_noPicture = 1;
 	    }
-	  printf (&quot;\n ignoring got pict ==0\n&quot;);
+	  printf (&quot;\n[lavc] ignoring got pict ==0\n&quot;);
 	  return 1;
 
 	}
-      printf (&quot;Err: %d, size :%d\n&quot;, ret, in-&gt;dataLength);
-      printf (&quot;\n error in FFMP43/mpeg4!: got picture \n&quot;);
+      printf (&quot;[lavc] Err: %d, size: %d\n&quot;, ret, in-&gt;dataLength);
+      printf (&quot;\n[lavc] error in FFMP43/mpeg4!: got picture\n&quot;);
       //GUI_Alert(&quot;Please retry with misc-&gt;Turbo off&quot;);
       //return 1;
       return 0;
@@ -420,14 +418,14 @@
       out-&gt;_colorspace = ADM_COLOR_BGR555;
       break;
     default:
-      printf (&quot;\n Unhandled colorspace:%d\n&quot;, _context-&gt;pix_fmt);
+      printf (&quot;\n[lavc] Unhandled colorspace: %d\n&quot;, _context-&gt;pix_fmt);
       return 0;
     }
     clonePic (&amp;_frame, out);
     #if 0
-    printf(&quot;Frame bitstream order : %u, display order %u Incoming :%u outgoing :%u\n&quot;,_frame.coded_picture_number,_frame.display_picture_number,
+    printf(&quot;[lavc] Frame bitstream order: %u, display order %u Incoming: %u outgoing: %u\n&quot;,_frame.coded_picture_number,_frame.display_picture_number,
          in-&gt;demuxerFrameNo,out-&gt;demuxerFrameno);
-    printf(&quot;in flags :%x out flags :%x\n&quot;,in-&gt;flags, out-&gt;flags);
+    printf(&quot;[lavc] in flags: %x out flags: %x\n&quot;,in-&gt;flags, out-&gt;flags);
  #endif 
   return 1;
 }
@@ -448,14 +446,14 @@
   _allowNull = 1;
   decoderMultiThread ();
   WRAP_Open (CODEC_ID_MPEG4);
-  printf(&quot;Non low delay mpeg4 decoder initialized\n&quot;);
+  printf(&quot;[lavc] Non low delay mpeg4 decoder initialized\n&quot;);
 }
 decoderFFMpeg4::decoderFFMpeg4 (uint32_t w, uint32_t h, uint32_t fcc,uint32_t l, uint8_t * d):decoderFF (w,
 	   h)
 {
 // force low delay as avidemux don't handle B-frames
   LOWDELAY();
-  printf (&quot;Using %d bytes of extradata for MPEG4 decoder\n&quot;, l);
+  printf (&quot;[lavc] Using %d bytes of extradata for MPEG4 decoder\n&quot;, l);
   
   _refCopy = 1;			// YUV420 only
   _context-&gt;extradata = (uint8_t *) d;
@@ -518,7 +516,7 @@
 {
   _context-&gt;extradata = (uint8_t *) d;
   _context-&gt;extradata_size = (int) l;
-  printf (&quot;FFhuff: We have :%d bytes of extra data\n&quot;, l);
+  printf (&quot;[lavc] FFhuff: We have %d bytes of extra data\n&quot;, l);
   WRAP_Open (CODEC_ID_FFVHUFF);
 
 }
@@ -531,7 +529,7 @@
   _context-&gt;extradata_size = (int) l;
   if(lowdelay)
     LOWDELAY();
-  printf (&quot;Initializing lavcodec H264 decoder with %d extradata\n&quot;, l);
+  printf (&quot;[lavc] Initializing H264 decoder with %d extradata\n&quot;, l);
   WRAP_Open (CODEC_ID_H264);
 
 }
@@ -676,7 +674,7 @@
                             in-&gt;data, in-&gt;dataLength); 
      if(ret&lt;0) 
      {
-        printf(&quot;[FFSUB] Error %d\n&quot;,ret);
+        printf(&quot;[lavc] FFSUB Error %d\n&quot;,ret);
         return 0; 
      }
      return 1;
@@ -712,6 +710,6 @@
     char buf[256];
   
     vsnprintf(buf, sizeof(buf), fmt, list);
-    printf(&quot;[LAV] %s\n&quot;,buf);
+    printf(&quot;[lavc] %s\n&quot;,buf);
 }
 // EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_ffmpeg.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -3,7 +3,7 @@
                              -------------------
 
 	Encoder for ffmpeg
-	Rever-enginereed from mplayer &amp; transcode
+	Reverse enginereed from mplayer &amp; transcode
 		
 
     begin                : Tue Sep 10 2002
@@ -20,29 +20,25 @@
  *                                                                         *
  ***************************************************************************/
 #include &quot;config.h&quot;
+
+#ifdef USE_FFMPEG
+
 #define __STDC_CONSTANT_MACROS // Lavcodec crap
-#include &lt;stdint.h&gt;
+#define WIN32_CLASH
+
 #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
-
 #include &lt;string.h&gt;
 #include &lt;math.h&gt;
+#include &lt;pthread.h&gt;
 
-
-#ifdef USE_FFMPEG
 #include &quot;ADM_lavcodec.h&quot;
-
 #include &quot;avi_vars.h&quot;
-#include &quot;prototype.h&quot;
-
-
-#include &quot;ADM_colorspace/colorspace.h&quot;
-//#include &quot;ADM_codecs/ADM_divxEncode.h&quot;
-
 #include &quot;ADM_toolkit/toolkit.hxx&quot;
-#include &lt;ADM_assert.h&gt;
+#include &quot;ADM_assert.h&quot;
 #include &quot;ADM_codecs/ADM_ffmpeg.h&quot;
-#include &quot;ADM_osSupport/ADM_cpuCap.h&quot;
+#include &quot;prefs.h&quot;
+
 //#define TEST_NOB 1
 
 static char LogName[500];
@@ -57,7 +53,7 @@
 /*****************************************/
 uint8_t ffmpegEncoder::stopEncoder(void)
 {
-    printf(&quot;[lavcodec] stopEncoder (%x)\n&quot;,_context);
+    printf(&quot;[lavc] stopEncoder (%x)\n&quot;,_context);
     if (_init)
     {
         _init = 0;
@@ -96,7 +92,7 @@
 ffmpegEncoder::ffmpegEncoder (uint32_t width, uint32_t height, FF_CODEC_ID id):encoder (width,
 	 height)
 {
-  printf (&quot;\n Build : %d \n&quot;, LIBAVCODEC_BUILD);
+  printf (&quot;Build: %d\n&quot;, LIBAVCODEC_BUILD);
 
   _id = id;
   _swap = 0;
@@ -130,10 +126,10 @@
 /*****************************************/
 ffmpegEncoder::~ffmpegEncoder ()
 {
-  printf (&quot;[codec] FF base encoder destroying..\n&quot;);
+  printf (&quot;[lavc] encoder destroying..\n&quot;);
   if (_isMT)
     {
-      printf (&quot;[codec] killing threads\n&quot;);
+      printf (&quot;[lavc] killing threads\n&quot;);
       avcodec_thread_free (_context);
       _isMT = 0;
     }
@@ -207,7 +203,7 @@
     {
       if (FRAME_FILM == identMovieType (rate))
 	{
-	  printf (&quot;\nPulldown activated...\n&quot;);
+	  printf (&quot;Pulldown activated...\n&quot;);
 	  _context-&gt;flags2 |= CODEC_FLAG2_32_PULLDOWN;
 	}
     }
@@ -216,7 +212,7 @@
 #else
   _context-&gt;max_b_frames = 2;
 #endif
-  printf (&quot;\n Using 2 b frames \n&quot;);
+  printf (&quot;Using 2 b frames\n&quot;);
   if (_id == FF_MPEG2)
     {
       _context-&gt;mpeg_quant = 1;	//1; // Should be mpeg quant 
@@ -361,30 +357,36 @@
 
   if (res &lt; 0)
     {
-      printf (&quot;\n Problem opening ffmpeg codec\n&quot;);
+      printf (&quot;[lavc] Problem opening codec\n&quot;);
       return 0;
     }
   return 1;
 
 }
-void
-ffmpegEncoder::encoderMT (void)
+
+void ffmpegEncoder::encoderMT (void)
 {
-  uint32_t nbThread = 0;
+  uint32_t threads = 0;
 
-  nbThread = ADM_useNbThreads ();
-  if (nbThread )
-    {
-      printf (&quot;[codec]Enabling MT encoder with %u threads\n&quot;, nbThread);
-      if (0 &gt; avcodec_thread_init (_context, nbThread))
-	{
-	  printf (&quot;[codec]Failed!!\n&quot;);
-	  return;
-	}
-      _isMT = 1;
-    }
+  prefs-&gt;get(FEATURE_THREADING_LAVC, &amp;threads);
 
+  if (threads == 0)
+	  threads = pthread_num_processors_np();
+
+  if (threads == 1)
+	  threads = 0;
+
+  if (threads)
+  {
+      printf (&quot;[lavc] Enabling MT encoder with %u threads\n&quot;, threads);
+
+      if (avcodec_thread_init (_context, threads) == -1)
+	      printf (&quot;[lavc] Failed!!\n&quot;);
+	  else
+          _isMT = 1;
+  }
 }
+
 /*
 		Set user selected matrices.
 
@@ -402,7 +404,7 @@
 {
 
   _context-&gt;gop_size = size;
-  printf (&quot;\n Gop size is now %d\n&quot;, _context-&gt;gop_size);
+  printf (&quot;Gop size is now %d\n&quot;, _context-&gt;gop_size);
   return 1;
 
 }
@@ -468,14 +470,14 @@
     {
       if (!_statfile)
 	{
-	  printf (&quot;FFmpeg using %s as log file\n&quot;, LogName);
+	  printf (&quot;[lavc] using %s as log file\n&quot;, LogName);
 	  _statfile = fopen (LogName, &quot;wb&quot;);
 	}
 
       if (!_statfile)
 	{
 	  printf
-	    (&quot;\n FF codec : cannot open log file for writing ! (%s)\n&quot;,
+	    (&quot;[lavc] cannot open log file for writing! (%s)\n&quot;,
 	     LogName);
 	  return 0;
 	}
@@ -540,7 +542,7 @@
   uint32_t statSize;
   FILE *_statfile;
 
-  printf (&quot;\n initializing FFmpeg in VBR mode \n&quot;);
+  printf (&quot;[lavc] initializing in VBR mode\n&quot;);
   _qual = val;
   mplayer_init ();
 
@@ -555,7 +557,7 @@
   _statfile = fopen (LogName, &quot;rb&quot;);
   if (!_statfile)
     {
-      printf (&quot;\n internal file does not exists ?\n&quot;);
+      printf (&quot;internal file does not exists ?\n&quot;);
       return 0;
     }
 
@@ -601,7 +603,7 @@
 ffmpegEncoderVBRExternal::init (uint32_t val, uint32_t fps1000)
 {
 
-  printf (&quot;\n initializing FFmpeg in VBRExternal  mode \n&quot;);
+  printf (&quot;[lavc] initializing in VBRExternal mode\n&quot;);
   _qual = val;
   mplayer_init ();
 
@@ -641,7 +643,7 @@
 
   if (!_settingsPresence)
     {
-      printf (&quot;\n using FFmpeg default encode settings \n&quot;);
+      printf (&quot;[lavc] using default encode settings \n&quot;);
       _context-&gt;qmin = 2;
       _context-&gt;qmax = 31;
       _context-&gt;max_b_frames = 0;
@@ -826,7 +828,7 @@
 {
   *d = (uint8_t *) _context-&gt;extradata;
   *l = _context-&gt;extradata_size;
-  printf (&quot;\n We got some extra data  : %lu \n&quot;, *l);
+  printf (&quot;We got some extra data: %lu\n&quot;, *l);
   if (*l)
     return 1;
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_x264.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -55,19 +55,17 @@
 //**********************************************************
 uint8_t X264Encoder::preamble (uint32_t fps1000, ADM_x264Param * zparam)
 {
+  x264_t *xhandle = NULL;
 
-  x264_t *
-    xhandle = NULL;
+  printf (&quot;[x264] Opening x264 for %lu x %lu\n&quot;, _w, _h);
 
-  printf (&quot;Opening X264 for %lu x %lu\n&quot;, _w, _h);
-
   param.i_threads = zparam-&gt;nbThreads;
   param.i_width = _w;
   param.i_height = _h;
   param.i_csp = X264_CSP_I420;
 
-#define MKPARAM(x,y) {param.x = zparam-&gt;y;printf(#x&quot; = %d\n&quot;,param.x);}
-#define MKPARAMF(x,y) {param.x = (float)zparam-&gt;y / 100; printf(#x&quot; = %.2f\n&quot;,param.x);}
+#define MKPARAM(x,y) {param.x = zparam-&gt;y;printf(&quot;[x264] &quot;#x&quot; = %d\n&quot;,param.x);}
+#define MKPARAMF(x,y) {param.x = (float)zparam-&gt;y / 100; printf(&quot;[x264] &quot;#x&quot; = %.2f\n&quot;,param.x);}
 
   if (zparam-&gt;AR_AsInput) {
     param.vui.i_sar_width = video_body-&gt;getPARWidth();
@@ -82,7 +80,7 @@
   if(zparam-&gt;idc)
   {
     MKPARAM(i_level_idc,idc);
-    printf(&quot;***Forcing level =%d\n&quot;,param.i_level_idc);
+    printf(&quot;[x264] *** Forcing level = %d\n&quot;,param.i_level_idc);
   }
   // KeyframeBoost ?
   // BframeReduction ?
@@ -139,7 +137,7 @@
   MKPARAM(analyse.b_mixed_references,MixedRefs);
   MKPARAM(analyse.i_noise_reduction,NoiseReduction);
   
-#define MES(x,y) if(zparam-&gt;x) {param.analyse.inter |=X264_ANALYSE_##y;printf(#x&quot; is on\n&quot;);}
+#define MES(x,y) if(zparam-&gt;x) {param.analyse.inter |=X264_ANALYSE_##y;printf(&quot;[x264] &quot;#x&quot; is on\n&quot;);}
   param.analyse.inter=0;
   MES(  _8x8P,  PSUB16x16);
   MES(  _8x8B,  BSUB16x16);
@@ -154,27 +152,30 @@
         float       f_vbv_buffer_init;
 
   */
-  printf(&quot;VBV_max_br         :%d\n&quot;, param.rc.i_vbv_max_bitrate);
-  printf(&quot;vbv_buffer_size    :%d\n&quot;, param.rc.i_vbv_buffer_size);
-  printf(&quot;f_vbv_buffer_init  :%f\n&quot;, param.rc.f_vbv_buffer_init);
+  printf(&quot;[x264] VBV_max_br = %d\n&quot;, param.rc.i_vbv_max_bitrate);
+  printf(&quot;[x264] vbv_buffer_size = %d\n&quot;, param.rc.i_vbv_buffer_size);
+  printf(&quot;[x264] f_vbv_buffer_init = %f\n&quot;, param.rc.f_vbv_buffer_init);
   
   if(zparam-&gt;globalHeader)
       param.b_repeat_headers=0;
   else
       param.b_repeat_headers=1;
+
   xhandle = x264_encoder_open (&amp;param);
   if (!xhandle)
     return 0;
 
   _handle = (void *) xhandle;
   _pic = (void *) new    x264_picture_t;
-  printf (&quot;X264 init ok (atom mode : %d)\n&quot;, zparam-&gt;globalHeader);
+  printf (&quot;[x264] init ok (atom mode: %d)\n&quot;, zparam-&gt;globalHeader);
+
   if (param.i_threads &gt; 1)
-    printf (&quot;X264 using %d threads\n&quot;, param.i_threads);
+    printf (&quot;[x264] using %d threads\n&quot;, param.i_threads);
+  else if (param.i_threads == 0)
+    printf (&quot;[x264] using threads\n&quot;);
+
   if (zparam-&gt;globalHeader)
-  {
     return createHeader ();
-  }
   else
     return 1;
 
@@ -243,7 +244,7 @@
   PICS-&gt;i_pts = curFrame++;
   if (x264_encoder_encode (HANDLE, &amp;nal, &amp;nbNal, PICS, &amp;pic_out) &lt; 0)
     {
-      printf (&quot;Error encoding with x264\n&quot;);
+      printf (&quot;[x264] Error encoding\n&quot;);
       return 0;
     }
 
@@ -298,7 +299,7 @@
       out-&gt;flags = AVI_B_FRAME;
       break;
     default:
-      printf (&quot;X264 :Unknown image type:%d\n&quot;, pic_out.i_type);
+      printf (&quot;[x264] Unknown image type: %d\n&quot;, pic_out.i_type);
       //ADM_assert(0);
 
     }
@@ -311,7 +312,7 @@
 uint8_t
   X264EncoderCQ::init (uint32_t val, uint32_t fps1000, ADM_x264Param * zparam)
 {
-  printf (&quot;X264 CQ\n&quot;);
+  printf (&quot;[x264] CQ\n&quot;);
   memset (&amp;param, 0, sizeof (param));
   x264_param_default (&amp;param);
   memcpy(&amp;admParam,zparam,sizeof(admParam));
@@ -332,7 +333,7 @@
 uint8_t
   X264EncoderAQ::init (uint32_t val, uint32_t fps1000, ADM_x264Param * zparam)
 {
-  printf (&quot;X264 AQ\n&quot;);
+  printf (&quot;[x264] AQ\n&quot;);
   memset (&amp;param, 0, sizeof (param));
   x264_param_default (&amp;param);
   memcpy(&amp;admParam,zparam,sizeof(admParam));
@@ -358,7 +359,7 @@
   X264EncoderCBR::init (uint32_t val, uint32_t fps1000,
 			ADM_x264Param * zparam)
 {
-  printf (&quot;X264 pass CBR\n&quot;);
+  printf (&quot;[x264] pass CBR\n&quot;);
   memset (&amp;param, 0, sizeof (param));
   x264_param_default (&amp;param);
   memcpy(&amp;admParam,zparam,sizeof(admParam));
@@ -381,7 +382,7 @@
   X264EncoderPass1::init (uint32_t val, uint32_t fps1000,
 			  ADM_x264Param * zparam)
 {
-  printf (&quot;X264 pass 1\n&quot;);
+  printf (&quot;[x264] pass 1\n&quot;);
   memset (&amp;param, 0, sizeof (param));
   x264_param_default (&amp;param);
   memcpy(&amp;admParam,zparam,sizeof(admParam));
@@ -411,7 +412,7 @@
     param.rc.psz_stat_out = &quot;/tmp/x264_log.tmp&quot;;
   else
     param.rc.psz_stat_out = zparam-&gt;logfile;
-  printf (&quot;x264 codec using %s as statfile\n&quot;, param.rc.psz_stat_out);
+  printf (&quot;[x264] codec using %s as statfile\n&quot;, param.rc.psz_stat_out);
   return preamble (fps1000, &amp;admParam);
 }
 X264EncoderPass1::~X264EncoderPass1 ()
@@ -424,7 +425,7 @@
 			  ADM_x264Param * zparam)
 {
     val=val/1000; // bps-&gt;kdps
-  printf (&quot;X264 pass 2, using bitrate of %u\n&quot;,val);
+  printf (&quot;[x264] pass 2, using bitrate of %u\n&quot;,val);
   memset (&amp;param, 0, sizeof (param));
   x264_param_default (&amp;param);
   
@@ -447,7 +448,7 @@
     param.rc.psz_stat_in = &quot;/tmp/x264_log.tmp&quot;;
   else
     param.rc.psz_stat_in = zparam-&gt;logfile;
-  printf (&quot;x264 codec using %s as statfile\n&quot;, param.rc.psz_stat_in);
+  printf (&quot;[x264] using %s as statfile\n&quot;, param.rc.psz_stat_in);
 
   return preamble (fps1000, &amp;admParam);
 }
@@ -535,10 +536,10 @@
 
   if (x264_encoder_headers (HANDLE, &amp;nal, &amp;nal_count))
     {
-      printf (&quot;X264 : Cannot create header\n&quot;);
+      printf (&quot;[x264] Cannot create header\n&quot;);
       return 0;
     }
-  printf (&quot;Nb nal :%d\n&quot;, nal_count);
+  printf (&quot;[x264] Nb nal: %d\n&quot;, nal_count);
 
   // Now encode them
   for (int i = 0; i &lt; nal_count; i++)
@@ -553,12 +554,12 @@
 	}
       else
 	{
-	  printf (&quot;?? type :%d in nal %d\n&quot;, nal[i].i_type, i);
+	  printf (&quot;[x264] ?? type %d in nal %d\n&quot;, nal[i].i_type, i);
 	  sz = x264_nal_encode (buffer, &amp;len, 0, &amp;nal[i]);
 	}
       if (sz &lt;= 0)
 	{
-	  printf (&quot;X264 : Cannot encode nal  header %d\n&quot;, i);
+	  printf (&quot;[x264] Cannot encode nal header %d\n&quot;, i);
 	  return 0;
 	}
     }
@@ -566,7 +567,7 @@
   // Check we have everything we want
   if (!picParamLen || !seqParamLen)
     {
-      printf (&quot;X264 : Seqparam or PicParam not found\n&quot;);
+      printf (&quot;[x264] Seqparam or PicParam not found\n&quot;);
       return 0;
     }
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_xvid4.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_xvid4.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_codecs/ADM_xvid4.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -31,8 +31,8 @@
 #include &quot;ADM_codecs/ADM_xvid4param.h&quot;
 #include &quot;ADM_codecs/ADM_xvid4.h&quot;
 #include &quot;xvid.h&quot;
-#include &lt;ADM_assert.h&gt;
-#include &quot;ADM_osSupport/ADM_cpuCap.h&quot;
+#include &quot;ADM_assert.h&quot;
+#include &quot;prefs.h&quot;
 
 #include &quot;ADM_editor/ADM_edit.hxx&quot;
 extern ADM_Composer *video_body;
@@ -92,7 +92,7 @@
                        &amp;xvid_enc_stats);
     if (ret &lt; 0)
     {
-        printf (&quot;Error calling xvid4 %d\n&quot;, ret);
+        printf (&quot;[xvid] Error calling xvid4 %d\n&quot;, ret);
         return 0;
 
     }
@@ -100,7 +100,7 @@
 
     out-&gt;len = ret;
     if (!ret)
-        printf (&quot;Skipped\n&quot;);
+        printf (&quot;[xvid] Skipped\n&quot;);
     return 1;
 
 }
@@ -116,17 +116,16 @@
   MMSET (xvid_gbl_init2);
   MMSET (xvid_gbl_info);
 
-  printf (&quot;Initializing global xvid 4\n&quot;);
+  printf (&quot;[xvid] Initializing global Xvid 4\n&quot;);
   xvid_gbl_init2.version = XVID_VERSION;
   xvid_global (NULL, XVID_GBL_INIT, &amp;xvid_gbl_init2, NULL);
   xvid_gbl_info.version = XVID_VERSION;
   xvid_global (NULL, XVID_GBL_INFO, &amp;xvid_gbl_info, NULL);
+
   if (xvid_gbl_info.build)
-    {
-      printf (&quot;\txvid build:%s\n&quot;, xvid_gbl_info.build);
-    }
-  printf (&quot;\txvid thread:%d\n&quot;, xvid_gbl_info.num_threads);
-  printf (&quot;\txvid SIMD supported:(%x)\n&quot;, xvid_gbl_info.cpu_flags);
+      printf (&quot;[xvid] Build: %s\n&quot;, xvid_gbl_info.build);
+
+  printf (&quot;[xvid] SIMD supported: (%x)\n&quot;, xvid_gbl_info.cpu_flags);
 #define CPUF(x) if(xvid_gbl_info.cpu_flags  &amp; XVID_CPU_##x) printf(&quot;\t\t&quot;#x&quot;\n&quot;);
 #if defined( ARCH_X86)  || defined(ARCH_X86_64)
   CPUF (MMX);
@@ -157,13 +156,20 @@
 void
 xvid4Encoder::createUpdate (void)
 {
-  uint32_t nbThread = 0;
-  xvid_enc_create.num_threads = 0;
-  if (nbThread = ADM_useNbThreads ())
-    {
-      printf (&quot;Xvid4 : using %u threads..\n&quot;, nbThread);
-      xvid_enc_create.num_threads = nbThread;
-    }
+  uint32_t threads = 0;
+
+  prefs-&gt;get(FEATURE_THREADING_XVID, &amp;threads);
+
+  if (threads == 0)
+	  xvid_enc_create.num_threads = xvid_gbl_info.num_threads;
+  else if (threads &gt; 1)
+	  xvid_enc_create.num_threads = threads;
+  else
+      xvid_enc_create.num_threads = 0;
+
+  if (xvid_enc_create.num_threads)
+      printf (&quot;[xvid] using %u threads\n&quot;, xvid_enc_create.num_threads);
+
   xvid_enc_create.max_bframes = _param.bframes;
   xvid_enc_create.max_key_interval = _param.max_key_interval;
   xvid_enc_create.bquant_ratio = _param.bquant_ratio;
@@ -182,9 +188,9 @@
     }
 
   preAmble (NULL);
-#define C_VOP(x) if(xvid_enc_frame.vop_flags&amp; XVID_VOP_##x) printf(&quot;Vop :&quot;#x&quot; is set\n&quot;);
-#define C_VOL(x) if(xvid_enc_frame.vol_flags&amp; XVID_VOL_##x) printf(&quot;Vol :&quot;#x&quot; is set\n&quot;);
-#define C_ME(x) if(xvid_enc_frame.motion&amp; XVID_ME_##x) printf(&quot;ME :&quot;#x&quot; is set\n&quot;);
+#define C_VOP(x) if(xvid_enc_frame.vop_flags&amp; XVID_VOP_##x) printf(&quot;[xvid] Vop: &quot;#x&quot; is set\n&quot;);
+#define C_VOL(x) if(xvid_enc_frame.vol_flags&amp; XVID_VOL_##x) printf(&quot;[xvid] Vol: &quot;#x&quot; is set\n&quot;);
+#define C_ME(x) if(xvid_enc_frame.motion&amp; XVID_ME_##x) printf(&quot;[xvid] ME: &quot;#x&quot; is set\n&quot;);
 
   C_VOP (DEBUG);
   C_VOP (CHROMAOPT);
@@ -234,15 +240,15 @@
 void
 xvid4Encoder::dump (void)
 {
-  printf (&quot;Xvid4 codec configuration:\n&quot;);
+  printf (&quot;[xvid] Configuration:\n&quot;);
   if (_param.mpegQuantizer)
-    printf (&quot;\tMPEGQUANT\n&quot;);
+    printf (&quot;\t\tMPEGQUANT\n&quot;);
   if (_param.interlaced)
-    printf (&quot;\tINTERLACED\n&quot;);
+    printf (&quot;\t\tINTERLACED\n&quot;);
 
 
 #define ST(x,y) \
-	if(_param.x) printf(&quot;\t&quot;#y&quot;\n&quot;);
+	if(_param.x) printf(&quot;\t\t&quot;#y&quot;\n&quot;);
 
 
   ST (inter4mv, INTER4V);
@@ -262,7 +268,7 @@
   if (_handle)
     {
       xvid_encore (_handle, XVID_ENC_DESTROY, NULL, NULL);
-      printf (&quot;Destroying xvid codec\n&quot;);
+      printf (&quot;[xvid] Destroying\n&quot;);
       _handle = NULL;
     }
   return 1;
@@ -383,13 +389,13 @@
   if(_param.useCustomIntra) 
   {
   if(!xvid_enc_frame.quant_intra_matrix)  
-      printf(&quot;[Xvid4]Using custom intra matrix\n&quot;);
+      printf(&quot;[xvid] Using custom intra matrix\n&quot;);
       xvid_enc_frame.quant_intra_matrix=_param.intraMatrix;
   }
   if(_param.useCustomInter)
   {
     if(!xvid_enc_frame.quant_inter_matrix)
-      printf(&quot;[Xvid4]Using custom inter matrix\n&quot;);
+      printf(&quot;[xvid] Using custom inter matrix\n&quot;);
      xvid_enc_frame.quant_inter_matrix=_param.interMatrix;
   }
   return 1;
@@ -422,7 +428,7 @@
   xvid4EncoderCQ::init (uint32_t q, uint32_t fps1000, xvid4EncParam * param)
 {
   int xerr;
-  printf (&quot;Using Xvid 4 codec with CQ mode = %lu (%dx%d)\n&quot;, q, _w, _h);
+  printf (&quot;[xvid] CQ mode = %lu (%d x %d)\n&quot;, q, _w, _h);
   _q = q;
   _fps1000 = fps1000;
   memcpy (&amp;_param, param, sizeof (_param));
@@ -456,14 +462,14 @@
   xerr = xvid_encore (NULL, XVID_ENC_CREATE, &amp;xvid_enc_create, NULL);
   if (xerr &lt; 0)
     {
-      printf (&quot;Xvid-4 init error :%d\n&quot;, xerr);
+      printf (&quot;[xvid] init error: %d\n&quot;, xerr);
       return 0;
 
     }
 
   _handle = xvid_enc_create.handle;
 
-  printf (&quot;Xvid-4 CQ init Ok\n&quot;);
+  printf (&quot;[xvid] CQ init Ok\n&quot;);
 
   return 1;
 }
@@ -489,7 +495,7 @@
 				 xvid4EncParam * param)
 {
   int xerr;
-  printf (&quot;Using Xvid 4 codec with CQ mode = %lu (%dx%d)\n&quot;, q, _w, _h);
+  printf (&quot;[xvid] CQ mode = %lu (%d x %d)\n&quot;, q, _w, _h);
   _q = q;
   _fps1000 = fps1000;
   memcpy (&amp;_param, param, sizeof (_param));
@@ -522,14 +528,14 @@
   xerr = xvid_encore (NULL, XVID_ENC_CREATE, &amp;xvid_enc_create, NULL);
   if (xerr &lt; 0)
     {
-      printf (&quot;Xvid-4 init error :%d\n&quot;, xerr);
+      printf (&quot;[xvid] init error: %d\n&quot;, xerr);
       return 0;
 
     }
 
   _handle = xvid_enc_create.handle;
 
-  printf (&quot;Xvid-4 CQ init Ok\n&quot;);
+  printf (&quot;[xvid] CQ init Ok\n&quot;);
 
   return 1;
 }
@@ -565,7 +571,7 @@
   xvid4EncoderCBR::init (uint32_t br, uint32_t fps1000, xvid4EncParam * param)
 {
   int xerr;
-  printf (&quot;Using Xvid 4 codec with CBR mode = %lu kbps\n&quot;, br);
+  printf (&quot;[xvid] CBR mode = %lu kbps\n&quot;, br);
   _bitrate = br;
   _fps1000 = fps1000;
   memcpy (&amp;_param, param, sizeof (_param));
@@ -599,14 +605,14 @@
   xerr = xvid_encore (NULL, XVID_ENC_CREATE, &amp;xvid_enc_create, NULL);
   if (xerr &lt; 0)
     {
-      printf (&quot;Xvid-4 init error :%d\n&quot;, xerr);
+      printf (&quot;[xvid] Init error: %d\n&quot;, xerr);
       return 0;
 
     }
 
   _handle = xvid_enc_create.handle;
 
-  printf (&quot;Xvid-4 CBR init Ok\n&quot;);
+  printf (&quot;[xvid] CBR init Ok\n&quot;);
 
   return 1;
 }
@@ -628,7 +634,7 @@
 			   xvid4EncParam * param)
 {
   int xerr;
-  printf (&quot;Using Xvid 4 codec pass 1 of 2 (log: %s)\n&quot;,
+  printf (&quot;[xvid] Pass 1 of 2 (log: %s)\n&quot;,
 	  (char *) param-&gt;logName);
 
   _fps1000 = fps1000;
@@ -664,14 +670,14 @@
   xerr = xvid_encore (NULL, XVID_ENC_CREATE, &amp;xvid_enc_create, NULL);
   if (xerr &lt; 0)
     {
-      printf (&quot;Xvid-4 init error :%d\n&quot;, xerr);
+      printf (&quot;[xvid] Init error: %d\n&quot;, xerr);
       return 0;
 
     }
 
   _handle = xvid_enc_create.handle;
 
-  printf (&quot;Xvid-4 Pass1 init Ok\n&quot;);
+  printf (&quot;[xvid] Pass 1 init Ok\n&quot;);
 
   return 1;
 }
@@ -689,7 +695,7 @@
 {
   int xerr;
   printf
-    (&quot;Using Xvid 4 codec with 2pass  mode pass 2 of 2, average bitrate = %lu\n&quot;,
+    (&quot;[xvid] Pass 2 of 2, average bitrate = %lu\n&quot;,
      br);
   _bitrate = br;
   _fps1000 = fps1000;
@@ -714,7 +720,7 @@
   pass2.filename = (char *) _param.logName;
 
   pass2.bitrate = br;		// Average bitrate
-#define CPY(x) pass2.x=_param.x;printf(#x&quot;=%d\n&quot;,pass2.x);
+#define CPY(x) pass2.x=_param.x;printf(&quot;[xvid] &quot;#x&quot;=%d\n&quot;,pass2.x);
 
   CPY (keyframe_boost);
   CPY (curve_compression_high);
@@ -740,14 +746,14 @@
   xerr = xvid_encore (NULL, XVID_ENC_CREATE, &amp;xvid_enc_create, NULL);
   if (xerr &lt; 0)
     {
-      printf (&quot;Xvid-4 init error :%d\n&quot;, xerr);
+      printf (&quot;[xvid] Init error: %d\n&quot;, xerr);
       return 0;
 
     }
 
   _handle = xvid_enc_create.handle;
 
-  printf (&quot;Xvid-4 init Ok\n&quot;);
+  printf (&quot;[xvid] Init Ok\n&quot;);
 
   return 1;
 }

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encXvid4.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encXvid4.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encXvid4.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -80,7 +80,7 @@
     encparam.par_height=instream-&gt;getPARHeight();
   }else
   {
-      printf(&quot;[xvid4]Using %u x %u aspect ratio\n&quot;,encparam.par_width,encparam.par_height);
+      printf(&quot;[xvid] Using %u x %u aspect ratio\n&quot;,encparam.par_width,encparam.par_height);
   }
   
   //
@@ -95,53 +95,53 @@
   switch (_param.mode)
     {
     case COMPRESS_SAME:
-      printf (&quot;Xvid4 in follow quant mode\n&quot;);
+      printf (&quot;[xvid] Follow quant mode\n&quot;);
       _state = enc_Same;
       _codec = new xvid4EncoderVBRExternal (_w, _h);
       if (!_codec-&gt;init (2, info-&gt;fps1000, &amp;encparam))
 	{
-	  printf (&quot;Error initi Xvid4 Follow mode\n&quot;);
+	  printf (&quot;[xvid] Error init Follow mode\n&quot;);
 	  return 0;
 	}
       break;
     case COMPRESS_CQ:
-      printf (&quot;\n Xvid4 cq mode: %ld&quot;, _param.qz);
+      printf (&quot;[xvid] CQ mode: %ld\n&quot;, _param.qz);
       _state = enc_CQ;
       _codec = new xvid4EncoderCQ (_w, _h);
 
       if (!_codec-&gt;init (_param.qz, info-&gt;fps1000, &amp;encparam))
 	{
-	  printf (&quot;Error initi Xvid4 CQ mode\n&quot;);
+	  printf (&quot;[xvid] Error init CQ mode\n&quot;);
 	  return 0;
 	}
       break;
     case COMPRESS_CBR:
-      printf (&quot;\n Xvid4 cbr mode: %lu&quot;, _param.bitrate);
+      printf (&quot;[xvid] CBR mode: %lu\n&quot;, _param.bitrate);
       _state = enc_CBR;
 
       _codec = new xvid4EncoderCBR (_w, _h);
       if (!_codec-&gt;init (_param.bitrate, info-&gt;fps1000, &amp;encparam))
 	{
-	  printf (&quot;Error initi Xvid4 CQ mode\n&quot;);
+	  printf (&quot;[xvid] Error init CBR mode\n&quot;);
 	  return 0;
 	}
       break;
     case COMPRESS_2PASS:
     case COMPRESS_2PASS_BITRATE:
       if(_param.mode==COMPRESS_2PASS)
-          printf (&quot;\n Xvid dual size: %lu (%s)\n&quot;, _param.finalsize, _logname);
+          printf (&quot;[xvid] Dual size: %lu (%s)\n&quot;, _param.finalsize, _logname);
       else
-          printf (&quot;\n Xvid dual avg br: %u kb/s (%s)\n&quot;, _param.avg_bitrate, _logname);
+          printf (&quot;[xvid] Dual avg br: %u kb/s (%s)\n&quot;, _param.avg_bitrate, _logname);
       _state = enc_Pass1;
       _codec = new xvid4EncoderPass1 (_w, _h);
       strcpy (encparam.logName, _logname);
-      printf (&quot;Using %s as stat file\n&quot;, encparam.logName);
+      printf (&quot;[xvid] Using %s as stat file\n&quot;, encparam.logName);
 
       break;
     default:
       ADM_assert (0);
     }
-  printf (&quot;\n Xvid4 Encoder ready , w: %lu h:%lu mode:%d&quot;, _w, _h, _state);
+  printf (&quot;[xvid] Encoder ready, w: %lu h: %lu mode: %d\n&quot;, _w, _h, _state);
   return 1;
 
 }
@@ -156,7 +156,7 @@
   info = _in-&gt;getInfo ();
   if (!_codec-&gt;init (_param.bitrate, info-&gt;fps1000, &amp;encparam))
     {
-      printf (&quot;Error initi Xvid4 pass1 mode\n&quot;);
+      printf (&quot;[xvid] Error init pass 1 mode\n&quot;);
       return 0;
     }
   return 1;
@@ -195,7 +195,7 @@
   ADM_assert (_in);
   if (!_in-&gt;getFrameNumberNoAlloc (frame, &amp;l, _vbuffer, &amp;f))
     {
-      printf (&quot;\n Error : Cannot read incoming frame !&quot;);
+      printf (&quot;[xvid] Error: Cannot read incoming frame!\n&quot;);
       return 0;
     }
 
@@ -207,12 +207,12 @@
       if (frame &lt; (encparam.bframes + 1))
 	{
 	  out-&gt;flags = AVI_KEY_FRAME;
-	  printf (&quot;Forcing keyframe for B frame\n&quot;);
+	  printf (&quot;[xvid] Forcing keyframe for B frame\n&quot;);
 	}
       q = _vbuffer-&gt;_Qp;
       if (q &lt; 2 || q &gt; 31)
 	{
-	  printf (&quot;Out of bound incoming q:%d\n&quot;, q);
+	  printf (&quot;[xvid] Out of bound incoming q: %d\n&quot;, q);
 	  if (q &lt; 2)
 	    q = 2;
 	  if (q &gt; 31)
@@ -255,17 +255,17 @@
   uint32_t         br;
 
   ADM_assert (_state == enc_Pass1);
-  printf (&quot;\n Starting pass 2 (%dx%d)\n&quot;, _w, _h);
+  printf (&quot;[xvid] Starting pass 2 (%d x %d)\n&quot;, _w, _h);
 
   if(_param.mode==COMPRESS_2PASS)
   {
     
     br=ADM_computeBitrate( _fps1000,_totalframe,_param.finalsize);
-    printf(&quot;[Xvid4] Final Size: %u MB, avg bitrate %u kb/s \n&quot;,_param.finalsize,br/1000);
+    printf(&quot;[xvid] Final Size: %u MB, avg bitrate %u kb/s\n&quot;,_param.finalsize,br/1000);
   }else if(_param.mode==COMPRESS_2PASS_BITRATE)
   {
     br=_param.avg_bitrate*1000;
-    printf(&quot;[Xvid4] 2pass avg bitrate %u kb/s\n&quot;,br/1000);
+    printf(&quot;[xvid] 2 pass avg bitrate %u kb/s\n&quot;,br/1000);
   }else ADM_assert(0);
 
   _state = enc_Pass2;
@@ -279,10 +279,10 @@
 
   _codec = new xvid4EncoderPass2 (_w, _h);
   strcpy (encparam.logName, _logname);
-  printf (&quot;Using %s as stat file, average bitrate %d kbps\n&quot;, _logname,	  br / 1000);
+  printf (&quot;[xvid] Using %s as stat file, average bitrate %d kbps\n&quot;, _logname,	  br / 1000);
   if (!_codec-&gt;init (br, _fps1000, &amp;encparam))
     {
-      printf (&quot;Error initializing Xvid4 pass1 mode\n&quot;);
+      printf (&quot;[xvid] Error initializing pass1 mode\n&quot;);
       return 0;
     }
   _frametogo = 0;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encx264.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encx264.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_encoder/adm_encx264.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -38,15 +38,15 @@
 
 #include &quot;ADM_encoder/adm_encoder.h&quot;
 #include &quot;ADM_encoder/adm_encx264.h&quot;
-#include &quot;ADM_osSupport/ADM_cpuCap.h&quot;
+#include &quot;prefs.h&quot;
 
-
 #define aprintf printf
 
 
 /*_________________________________________________*/
 EncoderX264::EncoderX264 (COMPRES_PARAMS * codecconfig)
 {
+	uint32_t threads = 0;
 
   _codec = NULL;
   strcpy (_logname, &quot;&quot;);
@@ -55,7 +55,10 @@
   memcpy (&amp;_param, codecconfig, sizeof (_param));
   ADM_assert (codecconfig-&gt;extraSettingsLen == sizeof (_codecParam));
   memcpy (&amp;_codecParam, (codecconfig-&gt;extraSettings), sizeof (_codecParam));
-  _codecParam.nbThreads = ADM_useNbThreads ();
+
+  prefs-&gt;get(FEATURE_THREADING_X264, &amp;threads);
+
+  _codecParam.nbThreads = threads;
   _logfile = NULL;
 
 };
@@ -70,7 +73,7 @@
 {
   uint8_t r = 0;
   r = _codec-&gt;getExtraData (l, data);
-  printf (&quot;x264 has %d extra bytes\n&quot;, *l);
+  printf (&quot;[x264] has %d extra bytes\n&quot;, *l);
   return r;
 
 }
@@ -93,35 +96,35 @@
     {
 
     case COMPRESS_CQ:
-      printf (&quot;\n X264 cq mode: %ld&quot;, _param.qz);
+      printf (&quot;\n[x264] cq mode: %ld&quot;, _param.qz);
       _state = enc_CQ;
       _codec = new X264EncoderCQ (_w, _h);
 
       if (!_codec-&gt;init (_param.qz, info-&gt;fps1000, &amp;_codecParam))
 	{
-	  printf (&quot;Error initi X264 CQ mode\n&quot;);
+	  printf (&quot;[x264] Error init CQ mode\n&quot;);
 	  return 0;
 	}
       break;
     case COMPRESS_AQ:
-      printf (&quot;\n X264 AQ mode: %ld&quot;, _param.qz);
+      printf (&quot;\n[x264] AQ mode: %ld&quot;, _param.qz);
       _state = enc_CQ;
       _codec = new X264EncoderAQ (_w, _h);
 
       if (!_codec-&gt;init (_param.qz, info-&gt;fps1000, &amp;_codecParam))
 	{
-	  printf (&quot;Error initi X264 AQ mode\n&quot;);
+	  printf (&quot;[x264] Error init AQ mode\n&quot;);
 	  return 0;
 	}
       break;
     case COMPRESS_CBR:
-      printf (&quot;\n X264 cbr mode: %lu&quot;, _param.bitrate);
+      printf (&quot;\n[x264] CBR mode: %lu&quot;, _param.bitrate);
       _state = enc_CBR;
 
       _codec = new X264EncoderCBR (_w, _h);
       if (!_codec-&gt;init (_param.bitrate, info-&gt;fps1000, &amp;_codecParam))
 	{
-	  printf (&quot;Error initi X264 CBR mode\n&quot;);
+	  printf (&quot;[x264] Error init CBR mode\n&quot;);
 	  return 0;
 	}
       break;
@@ -140,7 +143,7 @@
     }
 
 
-  printf (&quot;\n X264 Encoder ready , w: %lu h:%lu mode:%d&quot;, _w, _h, _state);
+  printf (&quot;\n[x264] Encoder ready, w: %lu h: %lu mode: %d&quot;, _w, _h, _state);
   return 1;
 
 }
@@ -155,7 +158,7 @@
   info = _in-&gt;getInfo ();
   if (!_codec-&gt;init (_param.bitrate, info-&gt;fps1000, &amp;(_codecParam)))
     {
-      printf (&quot;Error initi Xvid4 pass1 mode\n&quot;);
+      printf (&quot;[x264] Error init pass 1 mode\n&quot;);
       return 0;
     }
   return 1;
@@ -180,7 +183,7 @@
 {
   // strcpy (_logname, lofile);
   _logfile = ADM_strdup (lofile);
-  printf (&quot;Enc X264, using %s as logfile\n&quot;, _logfile);
+  printf (&quot;[x264] using %s as logfile\n&quot;, _logfile);
   _frametogo = nbframe;
   _totalframe = nbframe;
   return 1;
@@ -199,7 +202,7 @@
 
   if (!_in-&gt;getFrameNumberNoAlloc (frame, &amp;l, _vbuffer, &amp;f))
     {
-      printf (&quot;\n Error : Cannot read incoming frame !&quot;);
+      printf (&quot;\n[x264] Error: Cannot read incoming frame!&quot;);
       return 0;
     }
 
@@ -238,18 +241,16 @@
   return 1;
 
 }
+
 uint32_t ADM_computeBitrate(uint32_t fps1000, uint32_t nbFrame, uint32_t sizeInMB);
+
 uint8_t EncoderX264::startPass2 (void)
 {
-  
   uint32_t    bitrate;
 
   ADM_assert (_state == enc_Pass1);
-  printf (&quot;\n Starting pass 2 (%dx%d)\n&quot;, _w, _h);
+  printf (&quot;\n[x264] Starting pass 2 (%d x %d)\n&quot;, _w, _h);
 
-
-  
-
   if(_param.mode==COMPRESS_2PASS)
   {
       bitrate=ADM_computeBitrate(_fps1000, _totalframe, _param.finalsize);
@@ -268,14 +269,14 @@
 	_codec;
       _codec = NULL;
     }
-  printf (&quot;\n X264 dual size: %lu MB\n&quot;, _param.finalsize);
+  printf (&quot;\n[x264] dual size: %lu MB\n&quot;, _param.finalsize);
 
   _codec = new X264EncoderPass2 (_w, _h);
   // strcpy(encparam.logName,_logname);
   //printf(&quot;Using %s as stat file, average bitrate %d kbps\n&quot;,_logname,finalSize/1000);
   if (!_codec-&gt;init (bitrate, _fps1000, &amp;_codecParam))
     {
-      printf (&quot;Error initializing x264 pass1 mode\n&quot;);
+      printf (&quot;[x264] Error initializing x264 pass 2 mode\n&quot;);
       return 0;
     }
   _frametogo = 0;

Modified: branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/prefs.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/prefs.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_utilities/prefs.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -126,7 +126,9 @@
 	{&quot;feature.use_systray&quot;,		UINT,	&quot;0&quot;,	NULL,	&quot;0&quot;,	&quot;1&quot;	},
 	{&quot;feature.reuse_2pass_log&quot;,		UINT,	&quot;0&quot;,	NULL,	&quot;0&quot;,	&quot;1&quot;	},
 	{&quot;feature.audiobar_uses_master&quot;,		UINT,	&quot;0&quot;,	NULL,	&quot;0&quot;,	&quot;1&quot;	},
-	{&quot;feature.multi_thread&quot;,		UINT,	&quot;0&quot;,	NULL,	&quot;0&quot;,	&quot;4&quot;	},
+	{&quot;feature.threading.lavc&quot;,		UINT,	&quot;0&quot;,	NULL,	&quot;0&quot;,	&quot;32&quot;	},
+	{&quot;feature.threading.x264&quot;,		UINT,	&quot;0&quot;,	NULL,	&quot;0&quot;,	&quot;32&quot;	},
+	{&quot;feature.threading.xvid&quot;,		UINT,	&quot;0&quot;,	NULL,	&quot;0&quot;,	&quot;32&quot;	},
 	{&quot;feature.cpu_caps&quot;,		UINT,	&quot;4294967295&quot;,NULL,	&quot;0&quot;,	&quot;4294967295&quot;},
 	{&quot;feature.mpeg_no_limit&quot;,		UINT,	&quot;0&quot;,	NULL,	&quot;0&quot;,	&quot;1&quot;	},
 	{&quot;feature.auto_buildmap&quot;,		UINT,	&quot;0&quot;,	NULL,	&quot;0&quot;,	&quot;1&quot;	},
@@ -143,7 +145,7 @@
 	{&quot;priority.playback&quot;,		UINT,	&quot;0&quot;,	NULL,	&quot;0&quot;,	&quot;4&quot;	}
 };
 
-int num_opts = 79;
+int num_opts = 81;
 // &lt;/prefs_gen&gt;
 
 #ifdef USE_LIBXML2

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -131,18 +131,7 @@
 	printf(&quot;[cpuCaps]End of CPU capabilities check (cpuMask :%x)\n&quot;,myCpuMask);
 	return ;
 }
-/*
-        Returns # of threads to use,  0 means multithreading disabled
 
-*/
-uint32_t ADM_useNbThreads( void )
-{
-uint32_t multi;
-        if( prefs-&gt;get(FEATURE_MULTI_THREAD,&amp;multi) != RC_OK )
-                return  0;
-        if(multi&lt;2) multi=0; // On thread means no threading...
-        return multi;
-}
 /************************************************************************/
 #include &quot;ADM_libraries/ADM_libMpeg2Dec/mpeg2_cpu.h&quot;
 int ADM_mpeg2dec_mm_support(void)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.h	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_osSupport/ADM_cpuCap.h	2007-08-16 17:22:50 UTC (rev 3518)
@@ -51,7 +51,7 @@
 
 
 };
-uint32_t ADM_useNbThreads( void ); // FIXME, should not be here
+
 #if (defined( ARCH_X86)  || defined(ARCH_X86_64)) &amp;&amp; defined(HAVE_BUILTIN_VECTOR)
 #define USE_SSE 1
 #endif

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/CMakeLists.txt	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/CMakeLists.txt	2007-08-16 17:22:50 UTC (rev 3518)
@@ -7,6 +7,7 @@
 SET(${ADM_LIB}_SRCS
 DIA_color.cpp          DIA_filesel.cpp  FAC_bitrate.cpp  FAC_float.cpp  FAC_hex.cpp      FAC_menu.cpp   FAC_readOnlyText.cpp
 DIA_dialogFactory.cpp  FAC_bar.cpp      FAC_button.cpp   FAC_frame.cpp  FAC_integer.cpp  FAC_notch.cpp  FAC_toggle.cpp
+FAC_threadCount.cpp
 )
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
 ADD_ADM_LIB(${ADM_LIB} ADM_libraries)

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_bitrate.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -80,7 +80,7 @@
   
   
   /* Add text -&gt; encoding mode */
-  label2 = gtk_label_new_with_mnemonic (&quot;_Bitrate (kb/s):&quot;);
+  label2 = gtk_label_new_with_mnemonic (_(&quot;_Bitrate (kb/s):&quot;));
   gtk_misc_set_alignment (GTK_MISC (label2), 0.0, 0.5);
   gtk_widget_show(label2);
   /* put entry in hbox */

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_threadCount.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_threadCount.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/FAC_threadCount.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -0,0 +1,137 @@
+/***************************************************************************
+  FAC_threadCount.cpp
+  Handle dialog factory element : ThreadCount
+  (C) 2007 Gruntster
+***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include &lt;stdio.h&gt;
+
+#include &quot;config.h&quot;
+#include &quot;default.h&quot;
+#include &quot;ADM_toolkit_gtk/toolkit_gtk_include.h&quot;
+#include &quot;ADM_commonUI/DIA_factory.h&quot;
+
+static void customToggled(void *widget, void *userData);
+
+diaElemThreadCount::diaElemThreadCount(uint32_t *value, const char *title, const char *tip) : diaElem(ELEM_THREAD_COUNT)
+{
+	param=(void *)value;
+	paramTitle = title;
+	this-&gt;tip=tip;
+}
+
+diaElemThreadCount::~diaElemThreadCount()
+{
+	GtkWidget *w = (GtkWidget*)myWidget;
+	delete[] w;
+	myWidget = NULL;
+}
+
+void diaElemThreadCount::getMe(void)
+{
+	GtkWidget **widgets = (GtkWidget**)myWidget;
+	uint32_t *val = (uint32_t*)param;
+
+	if (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(widgets[0])))
+		*val = 1;   // disabled
+	else if (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(widgets[1])))
+		*val = 0;   // auto-detect
+	else
+		*val = gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(widgets[3]));   // custom
+}
+
+void diaElemThreadCount::setMe(void *dialog, void *opaque, uint32_t line)
+{
+	GtkWidget *label1;
+	GtkWidget *hbox1;
+	GtkWidget *radiobutton1;
+	GSList *radiobutton_group = NULL;
+	GtkWidget *radiobutton2;
+	GtkWidget *hbox2;
+	GtkWidget *radiobutton3;
+	GtkObject *spinbutton1_adj;
+	GtkWidget *spinbutton1;
+
+	label1 = gtk_label_new_with_mnemonic (paramTitle);
+	gtk_widget_show (label1);
+	gtk_misc_set_alignment (GTK_MISC (label1), 0.0, 0.5);
+
+	gtk_table_attach (GTK_TABLE (opaque), label1, 0, 1, line, line+1,
+					(GtkAttachOptions) (GTK_FILL),
+					(GtkAttachOptions) (0), 0, 0);
+
+	hbox1 = gtk_hbox_new (FALSE, 20);
+	gtk_widget_show (hbox1);
+
+	radiobutton1 = gtk_radio_button_new_with_mnemonic (NULL, _(&quot;Disable&quot;));
+	gtk_widget_show (radiobutton1);
+	gtk_box_pack_start (GTK_BOX (hbox1), radiobutton1, FALSE, FALSE, 0);
+
+	radiobutton2 = gtk_radio_button_new_with_label_from_widget(GTK_RADIO_BUTTON(radiobutton1), _(&quot;Auto-detect&quot;));
+	gtk_widget_show (radiobutton2);
+	gtk_box_pack_start (GTK_BOX (hbox1), radiobutton2, FALSE, FALSE, 0);
+
+	hbox2 = gtk_hbox_new (FALSE, 6);
+	gtk_widget_show (hbox2);
+	gtk_box_pack_start (GTK_BOX (hbox1), hbox2, FALSE, FALSE, 0);
+
+	radiobutton3 = gtk_radio_button_new_with_label_from_widget(GTK_RADIO_BUTTON(radiobutton1), _(&quot;Custom&quot;));
+	gtk_widget_show (radiobutton3);
+	gtk_box_pack_start (GTK_BOX (hbox2), radiobutton3, TRUE, TRUE, 0);
+
+	spinbutton1_adj = gtk_adjustment_new (2, 2, 32, 1, 10, 10);
+	spinbutton1 = gtk_spin_button_new (GTK_ADJUSTMENT (spinbutton1_adj), 1, 0);
+	gtk_widget_show (spinbutton1);
+	gtk_box_pack_start (GTK_BOX (hbox2), spinbutton1, TRUE, TRUE, 0);
+
+	gtk_table_attach (GTK_TABLE (opaque), hbox1, 1, 2, line, line+1,
+					(GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
+					(GtkAttachOptions) (0), 0, 0);
+
+	g_signal_connect(GTK_OBJECT(radiobutton3), &quot;toggled&quot;,
+					GTK_SIGNAL_FUNC(customToggled),  this);
+
+	GtkWidget **w;
+	w = new GtkWidget*[4];
+
+	w[0] = radiobutton1;
+	w[1] = radiobutton2;
+	w[2] = radiobutton3;
+	w[3] = spinbutton1;
+
+	myWidget = (void *)w;
+
+	uint32_t val = *(uint32_t *)param;
+
+	gtk_widget_set_sensitive(GTK_WIDGET(spinbutton1), val &gt; 1);
+
+	if (val == 0)
+		gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (radiobutton2), TRUE);
+	else if (val == 1)
+		gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (radiobutton1), TRUE);
+	else
+	{
+		gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (radiobutton3), TRUE);
+		gtk_spin_button_set_value (GTK_SPIN_BUTTON(spinbutton1), val);
+	}
+}
+
+void customToggled(void *widget, void *userData)
+{
+	diaElemThreadCount *elem = (diaElemThreadCount*)userData;
+
+	GtkWidget **widgets = (GtkWidget**)(elem-&gt;myWidget);
+
+	gtk_widget_set_sensitive(GTK_WIDGET(widgets[3]), gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(widgets[2])));
+}
+
+//EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_dialogFactory/Makefile.am	2007-08-16 17:22:50 UTC (rev 3518)
@@ -21,6 +21,7 @@
 FAC_frame.cpp \
 FAC_hex.cpp \
 FAC_button.cpp \
-DIA_color.cpp
+DIA_color.cpp \
+FAC_threadCount.cpp
 
 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_dialogFactory/FAC_toggle.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -413,4 +413,10 @@
 {
 }
 
+
+diaElemThreadCount::diaElemThreadCount(uint32_t *value, const char *title, const char *tip) : diaElem(ELEM_THREAD_COUNT) {}
+diaElemThreadCount::~diaElemThreadCount() {}
+void diaElemThreadCount::setMe(void *dialog, void *opaque, uint32_t line) {}
+void diaElemThreadCount::getMe(void) {}
+
 //EOF

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/CMakeLists.txt
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/CMakeLists.txt	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/CMakeLists.txt	2007-08-16 17:22:50 UTC (rev 3518)
@@ -11,6 +11,7 @@
 filesel        
 menu
 toggle
+threadCount
 )
 
 SET(${ADM_LIB}_SRCS

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/Makefile.am	2007-08-16 17:22:50 UTC (rev 3518)
@@ -4,7 +4,7 @@
 libADM_dialogFactory_a_METASOURCES = AUTO
 
 libADM_dialogFactory_a_SOURCES = AT_dialogFactory.cpp AT_toggle.cpp FAC_integer.cpp AT_menu.cpp FAC_float.cpp \
-AT_filesel.cpp AT_bitrate.cpp \
+AT_filesel.cpp AT_bitrate.cpp AT_threadCount.cpp \
 AT_button.cpp \
 FAC_bar.cpp FAC_readOnlyText.cpp FAC_notch.cpp FAC_frame.cpp FAC_hex.cpp
 

Added: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_threadCount.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_threadCount.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory/T_threadCount.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -0,0 +1,143 @@
+/***************************************************************************
+FAC_toggle.cpp
+Handle dialog factory element : Thread Count
+(C) 2007 Gruntster 
+***************************************************************************/
+
+/***************************************************************************
+*                                                                         *
+*   This program is free software; you can redistribute it and/or modify  *
+*   it under the terms of the GNU General Public License as published by  *
+*   the Free Software Foundation; either version 2 of the License, or     *
+*   (at your option) any later version.                                   *
+*                                                                         *
+***************************************************************************/
+
+#include &quot;config.h&quot;
+
+#include &lt;QGridLayout&gt;
+#include &lt;QLabel&gt;
+#include &lt;QRadioButton&gt;
+#include &lt;QButtonGroup&gt;
+#include &lt;QSpinBox&gt;
+
+#include &quot;default.h&quot;
+#include &quot;ADM_commonUI/DIA_factory.h&quot;
+
+extern const char* shortkey(const char*);
+
+class ADM_QthreadCount : public QWidget
+{
+	Q_OBJECT
+
+signals:
+
+public slots:
+
+	void radioGroupChanged(QAbstractButton *s)
+	{
+		spinBox-&gt;setEnabled(radiobutton3-&gt;isChecked());
+	}
+
+public:
+
+	QLabel *text;
+	QRadioButton *radiobutton1;
+	QRadioButton *radiobutton2;
+	QRadioButton *radiobutton3;
+	QButtonGroup *buttonGroup;
+	QSpinBox *spinBox;
+
+	ADM_QthreadCount(QWidget *widget, const char *title, uint32_t value, QGridLayout *layout, int line) : QWidget(widget) 
+	{
+		radiobutton1 = new QRadioButton(&quot;Disabled&quot;, widget);
+		radiobutton2 = new QRadioButton(&quot;Auto-detect&quot;, widget);
+		radiobutton3 = new QRadioButton(&quot;Custom&quot;, widget);
+
+		buttonGroup = new QButtonGroup;
+		buttonGroup-&gt;addButton(radiobutton1);
+		buttonGroup-&gt;addButton(radiobutton2);
+		buttonGroup-&gt;addButton(radiobutton3);
+
+		spinBox = new QSpinBox();
+		spinBox-&gt;setRange(2, 32);
+
+		text = new QLabel(title, widget);
+		text-&gt;setBuddy(radiobutton1);
+
+		layout-&gt;addWidget(text, line, 0);
+		layout-&gt;addWidget(radiobutton1, line, 1);
+		layout-&gt;addWidget(radiobutton2, line, 2);
+		layout-&gt;addWidget(radiobutton3, line, 3);
+		layout-&gt;addWidget(spinBox, line, 4);
+
+		QObject::connect(buttonGroup, SIGNAL(buttonClicked(QAbstractButton*)), this, SLOT(radioGroupChanged(QAbstractButton*)));
+
+		spinBox-&gt;setEnabled(value &gt; 1);
+
+		if (value == 0)
+			radiobutton2-&gt;setChecked(true);
+		else if (value == 1)
+			radiobutton1-&gt;setChecked(true);
+		else
+		{
+			radiobutton3-&gt;setChecked(true);
+			spinBox-&gt;setValue(value);
+		}
+	}
+
+	~ADM_QthreadCount() 
+	{
+		if (buttonGroup)
+			delete buttonGroup;
+
+		if (radiobutton1)
+			delete radiobutton1;
+
+		if (radiobutton2)
+			delete radiobutton2;
+
+		if (radiobutton3)
+			delete radiobutton3;
+
+		if (spinBox)
+			delete spinBox;
+
+		if (text)
+			delete text;
+	}
+};
+
+diaElemThreadCount::diaElemThreadCount(uint32_t *value, const char *title, const char *tip) : diaElem(ELEM_THREAD_COUNT)
+{
+	param = (void*)value;
+	paramTitle = shortkey(title);
+	this-&gt;tip = tip;
+}
+
+diaElemThreadCount::~diaElemThreadCount()
+{
+	delete paramTitle;
+}
+
+void diaElemThreadCount::setMe(void *dialog, void *opaque, uint32_t line)
+{
+	QGridLayout *layout = (QGridLayout*)opaque;
+
+	ADM_QthreadCount *threadCount = new ADM_QthreadCount((QWidget*)dialog, paramTitle, *(uint32_t *)param, layout, line);
+
+	myWidget = (void*)threadCount;
+}
+
+void diaElemThreadCount::getMe(void)
+{
+	ADM_QthreadCount *threadCount = (ADM_QthreadCount*)myWidget;
+	uint32_t *val = (uint32_t*)param;
+
+	if ((threadCount-&gt;radiobutton1)-&gt;isChecked())
+		*val = 1;
+	else if ((threadCount-&gt;radiobutton2)-&gt;isChecked())
+		*val = 0;
+	else
+		*val = (threadCount-&gt;spinBox)-&gt;value();
+}

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_factory.h	2007-08-16 17:22:50 UTC (rev 3518)
@@ -38,6 +38,7 @@
   ELEM_TOGGLE_INT,
   ELEM_BUTTON,
   ELEM_SLIDER,
+  ELEM_THREAD_COUNT,
   ELEM_MAX=ELEM_TOGGLE
 }elemEnum;
 typedef void ADM_FAC_CALLBACK(void *cookie);
@@ -412,6 +413,16 @@
   void finalize(void);
 };
 /**********************************************/
+class diaElemThreadCount : public diaElem
+{
+
+public:
+  
+  diaElemThreadCount(uint32_t *value, const char *title, const char *tip = NULL);
+  virtual ~diaElemThreadCount() ;
+  void setMe(void *dialog, void *opaque, uint32_t line);
+  void getMe(void);
+};
 /*********************************************/
 uint8_t diaFactoryRun(const char *title,uint32_t nb,diaElem **elems);
 uint8_t diaFactoryRunTabs(const char *title,uint32_t nb,diaElemTabs **tabs);

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/DIA_prefs.cpp	2007-08-16 17:22:50 UTC (rev 3518)
@@ -48,8 +48,6 @@
 */
 uint8_t DIA_Preferences(void)
 {
-uint8_t ret=0;
-
 uint32_t olddevice,newdevice;
 
 uint32_t	lavcodec_mpeg=0;
@@ -61,7 +59,7 @@
 uint32_t useAutoIndex=0;
 uint32_t useSwap=0;
 uint32_t useNuv=0;
-uint32_t mthreads=0;
+uint32_t lavcThreads=0,x264Threads=0,xvidThreads=0;
 uint32_t encodePriority=2;
 uint32_t indexPriority=2;
 uint32_t playbackPriority=0;
@@ -137,8 +135,10 @@
         if(!prefs-&gt;get(FEATURE_MPEG_NO_LIMIT,&amp;mpeg_no_limit)) mpeg_no_limit=0;
 
         // Multithreads
-        if(!prefs-&gt;get(FEATURE_MULTI_THREAD, &amp;mthreads))
-                mthreads=0;
+        prefs-&gt;get(FEATURE_THREADING_LAVC, &amp;lavcThreads);
+        prefs-&gt;get(FEATURE_THREADING_X264, &amp;x264Threads);
+        prefs-&gt;get(FEATURE_THREADING_XVID, &amp;xvidThreads);
+
 		// Encoding priority
 		if(!prefs-&gt;get(PRIORITY_ENCODING, &amp;encodePriority))
                 encodePriority=2;
@@ -197,13 +197,11 @@
         diaElemToggle togAutoVbr(&amp;autovbr,_(&quot;Automatically _build VBR map&quot;));
         diaElemToggle togAutoIndex(&amp;autoindex,_(&quot;Automatically _rebuild index&quot;));
         diaElemToggle togAutoUnpack(&amp;autounpack,_(&quot;Automatically remove _packed bitstream&quot;));
-                       
-        diaElemUInteger multiThread(&amp;mthreads,_(&quot;_Number of threads:&quot;),0,10);
 
 
         
-        diaElemToggle capsToggleAll(&amp;capsAll,_(&quot;Enable all Simd&quot;));
-        diaElemFrame      frameSimd(_(&quot;Simd&quot;));
+        diaElemToggle capsToggleAll(&amp;capsAll,_(&quot;Enable all SIMD&quot;));
+        diaElemFrame      frameSimd(_(&quot;SIMD&quot;));
         frameSimd.swallow(&amp;capsToggleAll);
         
 #define CAPS_TOGGLE(x) diaElemToggle       capsToggle##x(&amp;(caps##x),_(&quot;Enable &quot;#x));\
@@ -219,8 +217,15 @@
         CAPS_TOGGLE(SSE3);
         CAPS_TOGGLE(SSSE3);        
       
+		diaElemThreadCount lavcThreadCount(&amp;lavcThreads, _(&quot;_lavc threads:&quot;));
+		diaElemThreadCount x264ThreadCount(&amp;x264Threads, _(&quot;_x264 threads:&quot;));
+		diaElemThreadCount xvidThreadCount(&amp;xvidThreads, _(&quot;X_vid threads:&quot;));
 
-        
+		diaElemFrame frameThread(_(&quot;Multi-threading&quot;));
+		frameThread.swallow(&amp;lavcThreadCount);
+		frameThread.swallow(&amp;x264ThreadCount);
+		frameThread.swallow(&amp;xvidThreadCount);
+
 		diaMenuEntry priorityEntries[] = {
                              {0,       _(&quot;High&quot;),NULL}
                              ,{1,      _(&quot;Above normal&quot;),NULL}
@@ -232,6 +237,11 @@
 		diaElemMenu menuIndexPriority(&amp;indexPriority,_(&quot;_Indexing/unpacking priority:&quot;), sizeof(priorityEntries)/sizeof(diaMenuEntry), priorityEntries,&quot;&quot;);
 		diaElemMenu menuPlaybackPriority(&amp;playbackPriority,_(&quot;_Playback priority:&quot;), sizeof(priorityEntries)/sizeof(diaMenuEntry), priorityEntries,&quot;&quot;);
 
+		diaElemFrame framePriority(_(&quot;Prioritisation&quot;));
+		framePriority.swallow(&amp;menuEncodePriority);
+		framePriority.swallow(&amp;menuIndexPriority);
+		framePriority.swallow(&amp;menuPlaybackPriority);
+
         diaElemUInteger autoSplit(&amp;autosplit,_(&quot;_Split MPEG files every (MB):&quot;),10,4096);
         
         diaElemToggle   togTagMp3(&amp;alternate_mp3_tag,_(&quot;_Use alternative tag for MP3 in .mp4&quot;));
@@ -378,28 +388,27 @@
 #endif
         
         /* Fifth Tab : video */
-        
         diaElem *diaVideo[]={&amp;menuVideoMode,&amp;framePP};
         diaElemTabs tabVideo(_(&quot;Video&quot;),2,(diaElem **)diaVideo);
         
-        /* Sixth Tab : mthread */
-        diaElem *diaCpu[]={&amp;multiThread, &amp;frameSimd,&amp;menuEncodePriority, &amp;menuIndexPriority, &amp;menuPlaybackPriority};
-        
-        
-        
-        diaElemTabs tabCpu(_(&quot;CPU&quot;),4,(diaElem **)diaCpu);
-        
-        /* 7th Tab : Global Glyph */
+        /* CPU tab */
+		diaElem *diaCpu[]={&amp;frameSimd};
+		diaElemTabs tabCpu(_(&quot;CPU&quot;),1,(diaElem **)diaCpu);
+
+        /* Threading tab */
+		diaElem *diaThreading[]={&amp;frameThread, &amp;framePriority};
+		diaElemTabs tabThreading(_(&quot;Threading&quot;),2,(diaElem **)diaThreading);
+
+        /* Global Glyph tab */
         diaElem *diaGlyph[]={&amp;menuGlobaGlyh,&amp;entryGLyphPath};
         diaElemTabs tabGlyph(_(&quot;Global Glyphset&quot;),2,(diaElem **)diaGlyph);
-        
-        
-        /* 8th Tab : Xfilter */
+
+        /* Xfilter tab */
         diaElem *diaXFilter[]={&amp;loadEx,&amp;entryFilterPath};
         diaElemTabs tabXfilter(_(&quot;External Filters&quot;),2,(diaElem **)diaXFilter);
                                     
 // SET
-        diaElemTabs *tabs[]={&amp;tabUser,&amp;tabAuto,&amp;tabInput,&amp;tabOutput,&amp;tabAudio,&amp;tabVideo,&amp;tabCpu,&amp;tabGlyph,&amp;tabXfilter};
+        diaElemTabs *tabs[]={&amp;tabUser,&amp;tabAuto,&amp;tabInput,&amp;tabOutput,&amp;tabAudio,&amp;tabVideo,&amp;tabCpu,&amp;tabThreading,&amp;tabGlyph,&amp;tabXfilter};
         if( diaFactoryRunTabs(_(&quot;Preferences&quot;),9,tabs))
 	{
         	
@@ -422,12 +431,11 @@
         	    	CPU_CAPS(SSSE3);
         		}
         		prefs-&gt;set(FEATURE_CPU_CAPS,CpuCaps::myCpuMask);
+
         		// Glyphs
                prefs-&gt;set(FEATURE_GLOBAL_GLYPH_ACTIVE,useGlobalGlyph);
                prefs-&gt;set(FEATURE_GLOBAL_GLYPH_NAME,globalGlyphName);
 
-          
-		ret=1;
                 // Postproc
                 #undef DOME
                 #define DOME(x,y) if(y) pp_type |=x;
@@ -475,8 +483,10 @@
                 prefs-&gt;set(SETTINGS_MPEGSPLIT, autosplit);
                 
                 // number of threads
-                if(mthreads&lt;2) mthreads=0;
-                prefs-&gt;set(FEATURE_MULTI_THREAD, mthreads);
+                prefs-&gt;set(FEATURE_THREADING_LAVC, lavcThreads);
+				prefs-&gt;set(FEATURE_THREADING_X264, x264Threads);
+				prefs-&gt;set(FEATURE_THREADING_XVID, xvidThreads);
+
 				// Encoding priority
 				prefs-&gt;set(PRIORITY_ENCODING, encodePriority);
 				// Indexing / unpacking priority

Modified: branches/avidemux_2.4_branch/avidemux/prefs.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/prefs.h	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/prefs.h	2007-08-16 17:22:50 UTC (rev 3518)
@@ -72,7 +72,9 @@
 	FEATURE_USE_SYSTRAY,
 	FEATURE_REUSE_2PASS_LOG,
 	FEATURE_AUDIOBAR_USES_MASTER,
-	FEATURE_MULTI_THREAD,
+	FEATURE_THREADING_LAVC,
+	FEATURE_THREADING_X264,
+	FEATURE_THREADING_XVID,
 	FEATURE_CPU_CAPS,
 	FEATURE_MPEG_NO_LIMIT,
 	FEATURE_AUTO_BUILDMAP,

Modified: branches/avidemux_2.4_branch/avidemux/prefs.in
===================================================================
--- branches/avidemux_2.4_branch/avidemux/prefs.in	2007-08-16 15:49:50 UTC (rev 3517)
+++ branches/avidemux_2.4_branch/avidemux/prefs.in	2007-08-16 17:22:50 UTC (rev 3518)
@@ -81,7 +81,9 @@
 feature.use_systray,                    UINT,   0,      0,      1
 feature.reuse_2pass_log,                UINT,   0,      0,      1
 feature.audiobar_uses_master,           UINT,   0,      0,      1
-feature.multi_thread,                   UINT,   0,      0,      4
+feature.threading.lavc,                 UINT,   0,      0,      32
+feature.threading.x264,                 UINT,   0,      0,      32
+feature.threading.xvid,                 UINT,   0,      0,      32
 feature.cpu_caps,  		                UINT,   4294967295,      0,      4294967295
 feature.mpeg_no_limit,                  UINT,   0,      0,      1
 feature.auto_buildmap,                  UINT,   0,      0,      1


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000791.html">[Avidemux-svn-commit] r3517 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_libraries/ADM_lavcodec/i386 ADM_libraries/ADM_libMpeg2Dec	ADM_libraries/ADM_utilities ADM_osSupport	ADM_userInterfaces/ADM_commonUI
</A></li>
	<LI>Next message: <A HREF="000793.html">[Avidemux-svn-commit] r3519 -	branches/avidemux_2.4_branch/avidemux/ADM_libraries/ADM_lavcodec
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#792">[ date ]</a>
              <a href="thread.html#792">[ thread ]</a>
              <a href="subject.html#792">[ subject ]</a>
              <a href="author.html#792">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
