<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Avidemux-svn-commit] r3548 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_gui ADM_userInterfaces/ADM_commonUI
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/avidemux-svn-commit/2007-August/index.html" >
   <LINK REL="made" HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3548%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20.%0A%09ADM_userInterfaces/ADM_GTK/ADM_gui2%0A%09ADM_userInterfaces/ADM_NONE/ADM_gui2%0A%09ADM_userInterfaces/ADM_QT4/ADM_gui%20ADM_userInterfaces/ADM_commonUI&In-Reply-To=%3C200708211714.l7LHEhsd031438%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000821.html">
   <LINK REL="Next"  HREF="000823.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Avidemux-svn-commit] r3548 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_gui ADM_userInterfaces/ADM_commonUI</H1>
    <B>gruntster at mail.berlios.de</B> 
    <A HREF="mailto:avidemux-svn-commit%40lists.berlios.de?Subject=Re%3A%20%5BAvidemux-svn-commit%5D%20r3548%20-%20in%0A%09branches/avidemux_2.4_branch/avidemux%3A%20.%0A%09ADM_userInterfaces/ADM_GTK/ADM_gui2%0A%09ADM_userInterfaces/ADM_NONE/ADM_gui2%0A%09ADM_userInterfaces/ADM_QT4/ADM_gui%20ADM_userInterfaces/ADM_commonUI&In-Reply-To=%3C200708211714.l7LHEhsd031438%40sheep.berlios.de%3E"
       TITLE="[Avidemux-svn-commit] r3548 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_userInterfaces/ADM_GTK/ADM_gui2	ADM_userInterfaces/ADM_NONE/ADM_gui2	ADM_userInterfaces/ADM_QT4/ADM_gui ADM_userInterfaces/ADM_commonUI">gruntster at mail.berlios.de
       </A><BR>
    <I>Tue Aug 21 19:14:43 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000821.html">[Avidemux-svn-commit] r3547 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_userInterfaces/ADM_QT4/ADM_gui
</A></li>
        <LI>Next message: <A HREF="000823.html">[Avidemux-svn-commit] r3549 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#822">[ date ]</a>
              <a href="thread.html#822">[ thread ]</a>
              <a href="subject.html#822">[ subject ]</a>
              <a href="author.html#822">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gruntster
Date: 2007-08-21 19:14:33 +0200 (Tue, 21 Aug 2007)
New Revision: 3548

Modified:
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
   branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h
   branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
Log:
[QT] clip path from script name in Custom menu + refresh Custom menu after saving new project

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-08-21 15:02:54 UTC (rev 3547)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_GTK/ADM_gui2/GUI_bindings.cpp	2007-08-21 17:14:33 UTC (rev 3548)
@@ -921,6 +921,8 @@
 
 }
 
+void UI_refreshCustomMenu(void) {}
+
 int  UI_getCurrentPreview(void)
  {
        

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp	2007-08-21 15:02:54 UTC (rev 3547)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_NONE/ADM_gui2/gui_none.cpp	2007-08-21 17:14:33 UTC (rev 3548)
@@ -55,6 +55,8 @@
 void UI_setVProcessToggleStatus( uint8_t status )
 {}
 //**************************************************
+void UI_refreshCustomMenu(void) {}
+
 int    UI_getCurrentPreview(void)
 {
   return 0; 

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-21 15:02:54 UTC (rev 3547)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_gui/Q_gui2.cpp	2007-08-21 17:14:33 UTC (rev 3548)
@@ -46,7 +46,6 @@
 extern const char* audioFilterGetIndexedName(uint32_t i);
 extern void checkCrashFile(void);
 static void setupMenus(void);
-static void GUI_initCustom(void);
 
 int SliderIsShifted=0;
 static int shiftKeyHeld=0;
@@ -97,6 +96,7 @@
 public:
 	MainWindow();
 	Ui_MainWindow ui;
+	void buildCustomMenu(void);
 
 public slots:
 	void timeChanged(int);
@@ -250,14 +250,7 @@
 	connect(ui.spinBox_TimeValue,SIGNAL(valueChanged(int)),this,SLOT(timeChanged(int)));
 
 	/* Build the custom menu */
-	GUI_initCustom();
-	for(int i=0;i&lt;ADM_nbCustom;i++)
-	{
-		customActions[i]=new QAction(customNames[i],NULL);
-		ui.menuCustom-&gt;addAction(customActions[i]);
-		connect(customActions[i], SIGNAL(triggered()), this, SLOT(custom()));
-	}
-	printf(&quot;Menu built\n&quot;);
+	buildCustomMenu();
 
 	this-&gt;installEventFilter(this);
 	slider-&gt;installEventFilter(this);
@@ -393,6 +386,53 @@
 		HandleAction(ACT_NextKFrame);
 }
 
+void MainWindow::buildCustomMenu(void)
+{
+	if (ADM_nbCustom)
+	{
+		for(int i = 0; i &lt; ADM_nbCustom; i++)
+		{
+			disconnect(customActions[i], SIGNAL(triggered()), this, SLOT(custom()));
+			delete customActions[i];
+			customActions[i] = NULL;
+		}
+
+		ui.menuCustom-&gt;clear();
+		ADM_nbCustom = 0;
+	}
+
+	char *customdir = ADM_getCustomDir();
+
+	if (!customdir)
+	{
+		printf(&quot;No custom dir...\n&quot;);
+		return;
+	}
+
+	/* Collect the name */
+	if (! buildDirectoryContent(&amp;ADM_nbCustom, customdir, customNames, ADM_MAC_CUSTOM_SCRIPT,&quot;.js&quot;))
+	{
+		printf(&quot;Failed to build custom dir content&quot;);
+		return;
+	}
+
+	if(ADM_nbCustom)
+	{
+		printf(&quot;Found %u custom script(s), adding them\n&quot;, ADM_nbCustom);
+
+		for(int i=0; i &lt; ADM_nbCustom; i++)
+		{
+			customActions[i] = new QAction(GetFileName(customNames[i]), NULL);
+			ui.menuCustom-&gt;addAction(customActions[i]);
+			connect(customActions[i], SIGNAL(triggered()), this, SLOT(custom()));
+		}
+	}
+	else
+		printf(&quot;No custom scripts\n&quot;);
+
+	printf(&quot;Custom menu built\n&quot;);
+}
+
 //*********************************************
 //***** Hook to core                ***********
 //*********************************************
@@ -410,6 +450,11 @@
 QGraphicsView *drawWindow=NULL;
 uint8_t UI_updateRecentMenu( void );
 
+void UI_refreshCustomMenu(void)
+{
+	((MainWindow*)QuiMainWindows)-&gt;buildCustomMenu();
+}
+
 /**
     \fn UI_getCurrentPreview(void)
     \brief Read previewmode from comboxbox 
@@ -781,30 +826,6 @@
 }
 
 /**
-      \fn GUI_initCustom
-      \brief Initialize custom menu
-*/
-void GUI_initCustom(void )
-{
-	char *customdir=ADM_getCustomDir();
-	if(!customdir) 
-	{
-		printf(&quot;No custom dir...\n&quot;);
-		return;
-	}
-	/* Collect the name */
-	if(! buildDirectoryContent(&amp;ADM_nbCustom,customdir, customNames,ADM_MAC_CUSTOM_SCRIPT,&quot;.js&quot;))
-	{
-		printf(&quot;Failed to build custom dir content&quot;);
-		return;
-	}
-	if(!ADM_nbCustom)
-	{
-		printf(&quot;No custom script\n&quot;);
-	}
-	printf(&quot;Found %u custom scripts, adding them\n&quot;,ADM_nbCustom);
-}
-/**
       \fn UI_getTimeShift
       \brief get state (on/off) and value for time Shift
 */

Modified: branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h
===================================================================
--- branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h	2007-08-21 15:02:54 UTC (rev 3547)
+++ branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_commonUI/GUI_ui.h	2007-08-21 17:14:33 UTC (rev 3548)
@@ -46,5 +46,7 @@
 
 uint8_t UI_arrow_enabled(void);
 uint8_t UI_arrow_disabled(void);
+
+void UI_refreshCustomMenu(void);
 #endif
 // EOF

Modified: branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp
===================================================================
--- branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-08-21 15:02:54 UTC (rev 3547)
+++ branches/avidemux_2.4_branch/avidemux/gtk_gui.cpp	2007-08-21 17:14:33 UTC (rev 3548)
@@ -457,6 +457,7 @@
 
     case ACT_SaveWork:
       GUI_FileSelWrite (_(&quot;Select Workbench to Save&quot;), A_saveWorkbench);
+	  UI_refreshCustomMenu();
       break;
     case ACT_ADD_JOB:
         A_addJob();
@@ -468,6 +469,7 @@
          ADM_dealloc(tmp);
       }else{
         GUI_FileSelWrite (_(&quot;Select Workbench to Save&quot;), A_saveWorkbench);
+		UI_refreshCustomMenu();
       }
       break;
         case ACT_JumpToFrame: 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000821.html">[Avidemux-svn-commit] r3547 - in	branches/avidemux_2.4_branch/avidemux: .	ADM_userInterfaces/ADM_QT4/ADM_gui
</A></li>
	<LI>Next message: <A HREF="000823.html">[Avidemux-svn-commit] r3549 -	branches/avidemux_2.4_branch/avidemux/ADM_userInterfaces/ADM_QT4/ADM_dialogFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#822">[ date ]</a>
              <a href="thread.html#822">[ thread ]</a>
              <a href="subject.html#822">[ subject ]</a>
              <a href="author.html#822">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/avidemux-svn-commit">More information about the Avidemux-svn-commit
mailing list</a><br>
</body></html>
